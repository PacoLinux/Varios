VERSION E05

PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:1    
        1        1        /*M*   UEP$PMME  User Exceptional Condition PMME Handler  */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* PLM=3,IND=5,ENU=0,ECU=0    */
        8        8        UEP$PMME: PROC(CODE,USTK1$,USTK2$) ALTRET;
        9        9        %INCLUDE B$JIT;
       10      612        %INCLUDE B$MAP;
       11      711        %INCLUDE S_WSPTD_R;
       12      727        %INCLUDE MM_DATA_R;
       13     1247        %INCLUDE B$P;
       14     1331        %INCLUDE B$ROSEG;
       15     1394        %INCLUDE B$USER;
       16     1610        %INCLUDE F$DCB;
       17     1659        %INCLUDE B_MACROS_C;
       18     1770        %INCLUDE B_MAGIC_C;
       19     1888        %INCLUDE B_MLSMAC_C;
       20     2830        %INCLUDE B_ULSMAC_C;
       21     3939        %INCLUDE GJ_MSG_M;
       22     4252        %INCLUDE UE$CP6V_C;
       23     4336        %INCLUDE UE_CP6;
       24     5027        %INCLUDE UE_ERRORS_C;
       25     5045                                                /* Input parameters                   */
       26     5046    1   DCL CODE UBIN(36);
       27     5047    1   DCL USTK1$ PTR;
       28     5048    1   DCL USTK2$ PTR;
       29     5049
       30     5050                                                /* AUTO Storage                       */
       31     5051    1   DCL ALT$ PTR;
       32     5052    1   DCL CSTK$ PTR;
       33     5053    1   DCL STK$ PTR;
       34     5054    1   DCL TO$ PTR;
       35     5055    1   DCL FROM$ PTR;
       36     5056    1   DCL FRMSZ UBIN(36);
       37     5057    1   DCL I UBIN(36);
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:2    
       38     5058    1   DCL 1 U REDEF I,
       39     5059    1         2 UPR35 UBIN(35) UNAL,
       40     5060    1         2 *    BIT(1) UNAL;
       41     5061    1   DCL J UBIN(36);
       42     5062    1   DCL TEMPF BIT(9);
       43     5063                                                /* USED BY M$DRTN                     */
       44     5064    1   DCL OECC UBIN(18);                      /*REMEMBER HOW WE ENTERED DELTA       */
       45     5065    1   DCL NECC UBIN(18);                      /*HOW DELTA WANTS ECC RESET           */
       46     5066
       47     5067        %B$EXCRTN (NAME=ECP,STCLASS=AUTO);
       48     5070    1   DCL ECC UBIN(36);
       49     5071
       50     5072    1   DCL SS_RTN_IC UBIN HALF;
       51     5073    1   DCL EXCFR_IC UBIN HALF;
       52     5074        %GJ_LDTRC_MSG (FPTN=LCP6_MSG,STCLASS=AUTO,GEN_MODTIME=YES);
       53     5125
       54     5126                                                /* Internal Data                      */
       55     5127    1   DCL   TIME(0:2) UBIN(36) CONSTANT INIT(1000,1000000,60000000);
       56     5128    1   DCL   TMASK(0:2) BIT(36) CONSTANT  INIT('000377777777'O,'000000177777'O
       57     5129    1          ,'000000001777'O);
       58     5130
       59     5131    1   DCL ECCBINDX(0:7) CONSTANT UBIN(9) INIT(0,0,0,0,3,2,1,0);
       60     5132
       61     5133        /* EXTERNAL PROCEDURES */
       62     5134
       63     5135    1   DCL HFE$M$TRAP ENTRY(1);
       64     5136    1   DCL HFE$M$STRAP ENTRY(1);
       65     5137    1   DCL HFF$NILERASE ENTRY(1) ALTRET;
       66     5138    1   DCL JSS$BACKSS ENTRY;
       67     5139    1   DCL UDN$MAGIC ENTRY;
       68     5140    1   DCL UDN$MAGICLS ENTRY;
       69     5141    1   DCL UDN$MAGICRLS ENTRY;
       70     5142    1   DCL JSS$RUNDSPC ENTRY;
       71     5143    1   DCL JSA$RUNDSPC ENTRY(2);
       72     5144    1   DCL JSA$QUIT ENTRY;
       73     5145    1   DCL UDB$AUTO ENTRY;
       74     5146    1   DCL UDB$PMMEXIT ENTRY;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:3    
       75     5147    1   DCL JSE$ABORTM ENTRY;
       76     5148    1   DCL JSE$ABORTX ENTRY;
       77     5149    1   DCL JSE$ABORTY ENTRY;
       78     5150    1   DCL HFC$ASSOCCLR ENTRY(3);
       79     5151    1   DCL SSU$DELTAGO ENTRY(3);
       80     5152    1   DCL UDB$CALCOMP ENTRY;
       81     5153    1   DCL UDB$PMMEXIT2 ENTRY;
       82     5154    1   DCL EMR$FEP2HOST ENTRY(2);
       83     5155    1   DCL KIF$READ ENTRY(3) ALTRET;
       84     5156    1   DCL KIF$SEND ENTRY(3) ALTRET;
       85     5157    1   DCL KIA$8TO9 ENTRY(3);
       86     5158    1   DCL KIF$WRITE ENTRY(3) ALTRET;
       87     5159    1   DCL KIF$WRITE_IMD ENTRY(3) ALTRET;
       88     5160    1   DCL SC_UE_LCP6_FCN ENTRY CONV(2,0);
       89     5161
       90     5162        /* EXTERNAL DATA */
       91     5163
       92     5164        %B_MPT (FPTN=B_MPT,STCLASS=SYMREF);
       93     5257    1   DCL N$DCT$$ PTR SYMREF;
       94     5258    1   DCL B$MISC2$ PTR SYMREF READONLY;
       95     5259    1   DCL B$ROSEG$ PTR SYMREF READONLY;
       96     5260    1   DCL B$PS0$ PTR SYMREF READONLY;
       97     5261    1   DCL B$PS1$ PTR SYMREF READONLY;
       98     5262    1   DCL B$PS2$ PTR SYMREF READONLY;
       99     5263    1   DCL B$PS3$ PTR SYMREF READONLY;
      100     5264    1   DCL B$PS4$ PTR SYMREF READONLY;
      101     5265    1   DCL B$UPT$ PTR SYMREF READONLY;
      102     5266    1   DCL B$JIT$ PTR SYMREF READONLY;
      103     5267    1   DCL B$LS$ PTR SYMREF READONLY;
      104     5268
      105     5269        %EQU AS64SID = '4200'O;
      106     5270        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:4    
      107     5271                                                /* BASED Structures                   */
      108     5272        %GJ_FCN_MSG (FPTN=B$FCN_MSG,STCLASS=BASED);
      109     5297        %GJ_ALIB_MSG (FPTN=B$ALIB_MSG,STCLASS=BASED);
      110     5337    1   DCL B$2CHAR CHAR(2) UNAL BASED;
      111     5338    1   DCL NK$LDCT$(0:0) PTR BASED(N$DCT$$);
      112     5339    1   DCL 1 FTCB BASED ALIGNED,          /* FUNNY TCB STRUCTURE-USE WITH PINCRW     */
      113     5340    1         2 ALTFR SBIN HALF UNAL,
      114     5341    1         2 * UBIN(18) UNAL,
      115     5342    1         2 CRFR SBIN HALF UNAL,
      116     5343    1         2 * UBIN(18) UNAL,
      117     5344    1         2 UNUSED SBIN HALF UNAL,
      118     5345    1         2 CRSZ SBIN HALF UNAL;
      119     5346
      120     5347    1   DCL FRAME(0:333) BASED UBIN(36);
      121     5348    1   DCL TIM SBIN BASED;
      122     5349        %T01DESCR (NAME=B$$DESCR);
      123     5357        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:5    
      124     5358    1   DCL 1 B$SS BASED DALIGNED,
      125     5359    1         2 * BIT (36) UNAL,                /* HWMR                               */
      126     5360    1         2 ALT BIT(1) UNAL,
      127     5361    1         2 FPTCODE UBIN(17) UNAL,
      128     5362    1         2 * BIT(18) UNAL,
      129     5363    1         2 *(0:1) BIT (36) UNAL,
      130     5364    1         2 IC UBIN(18) UNAL,
      131     5365    1         2 IR,
      132     5366    1           3 * BIT(9) UNAL,
      133     5367    1           3 PM BIT(1) UNAL,
      134     5368    1           3 MMODE BIT(1) UNAL,
      135     5369    1           3 * BIT(1) UNAL,
      136     5370    1           3 MIR BIT(1) UNAL,
      137     5371    1           3 * BIT(5) UNAL,
      138     5372    1         2 * BIT(36) UNAL,
      139     5373    1         2 * BIT(18) UNAL,
      140     5374    1         2 CPUREQ BIT(1) UNAL,             /* SET BY SOFTWARE IF IR.MIR SET      */
      141     5375    1         2 CPUTYP UBIN(5) UNAL,       /* SET BY SW TO CPU TYPE IF IR.MIR SET     */
      142     5376    1         2 * BIT(12) UNAL,
      143     5377    1         2 * BIT(36) UNAL,
      144     5378    1         2 ISR,                            /* INSTRUCTION SEGMENT REGISTER       */
      145     5379    1           3 * BIT(29) UNAL,
      146     5380    1           3 WSR UBIN(3) UNAL,
      147     5381    1           3 * BIT(4) UNAL,
      148     5382    1           3 * SBIN WORD,
      149     5383    1         2 ASR BIT(72) UNAL,
      150     5384    1         2 LSR BIT(72) UNAL,
      151     5385    1         2 PSR BIT(72) UNAL,
      152     5386    1         2 PR(0:7) PTR UNAL,
      153     5387    1         2 DR(0:7) UNAL,
      154     5388    1           3 WORD1 UNAL,
      155     5389    1             4 * BIT(32) UNAL,
      156     5390    1             4 TYP UBIN(4) UNAL,
      157     5391    1           3 * BIT(36) UNAL,
      158     5392    1         2 REGS(0:6) BIT(36) UNAL,
      159     5393    1         2 *(0:16) BIT(36) UNAL;
      160     5394
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:6    
      161     5395    1   DCL 1 B$SSX BASED DALIGNED,
      162     5396    1         2 *(0:3) BIT(36) UNAL,
      163     5397    1         2 IC UBIN(18) UNAL,
      164     5398    1         2 * BIT(18) UNAL,
      165     5399    1         2 *(0:2) BIT(36) UNAL,
      166     5400    1         2 ISR,                            /* INSTRUCTION SEGMENT REGISTER       */
      167     5401    1           3 * BIT(29) UNAL,
      168     5402    1           3 WSR UBIN(3) UNAL,
      169     5403    1           3 * BIT(4) UNAL,
      170     5404    1           3 * SBIN WORD;
      171     5405
      172     5406    1   DCL FR63(0:62) BASED UBIN(36);
      173     5407        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:7    
      174     5408
      175     5409        %B$ECCB;
      176     5417        %B$ECCBI;
      177     5420        %B$TCB;
      178     5423        %B$EXCFR;
      179     5441        %B$EXCRTN;
      180     5444        %B$XCON;
      181     5454        %B$ALT;
      182     5462        %B$SVLDT (FPTN=B$SCON, STCLASS=BASED, FULL=YES);
      183     5503        %B_USRULS (FPTN=B$ULS,STCLASS=BASED);
      184     5702        %B_USRULS (FPTN=B$ULNK,STCLASS=BASED);
      185     5901        %B_MLS (FPTN=B$MLS,STCLASS=BASED);
      186     6716        %B$USERREFS;
      187     6720        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:8    
      188     6721
      189     6722        /* BASED STRUCTURES USED TO ACCESS USER PARAMETERS */
      190     6723        %FPT$DRTN_V (FPTN=FPTV);
      191     6730        %FPT$DRTN_V (FPTN=AUTO_DRTNV,BASED=AUTO);
      192     6737        %VLR_FPRG_FID (STCLASS=BASED);
      193     6745        %VLP$ECCS_V;
      194     6749        %FPT$TTIMER_V;
      195     6752        %FPT$WAIT_V;
      196     6755        %FPT$STIMER_V;
      197     6758        %FPT$STRAP_V;
      198     6761        %FPT$EVENT_V;
      199     6764    1   DCL FPTFR# UBIN(36) BASED DALIGNED;     /* M$CLRSTK                           */
      200     6765    1   DCL 1 PXCON BASED ALIGNED,              /* M$XCON                             */
      201     6766    1         2 IC UBIN(18) UNAL,
      202     6767    1         2 SID UBIN(18) UNAL;
      203     6768
      204     6769    1   DCL 1 MPARAM BASED DALIGNED,
      205     6770    1         2 ERR BIT(36) UNAL,
      206     6771    1         2 * BIT(36) UNAL;
      207     6772                                                /*                                    */
      208     6773    1   DCL FPTREGS(0:6) UBIN BASED;
      209     6774
      210     6775    1   DCL PRS(0:7) PTR BASED;
      211     6776
      212     6777    1   DCL 1 B$PTRS(0:7) BASED ALIGNED,
      213     6778    1         2 OFFSET UBIN(24) UNAL,
      214     6779    1         2 SEGID BIT(12) UNAL,
      215     6780    1         2 S REDEF SEGID,
      216     6781    1           3 SEG_TYPE BIT(2) UNAL,
      217     6782    1           3 DESCR# UBIN(10) UNAL;
      218     6783
      219     6784    1   DCL B$DESEG(0:20) BIT(72) BASED DALIGNED;
      220     6785
      221     6786                                                /* String Substitutions               */
      222     6787        %INCLUDE B_SEGIDS_C;
      223     7326        %INCLUDE CP_6_SUBS;
      224     7866        %INCLUDE J_ERRORS_C;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:9    
      225     7953        %INCLUDE J_ERRSET_C;
      226     7973        %INCLUDE SS_SCHED_C;
      227     8206        %INCLUDE UD_ERRORS_C;
      228     8248        %INCLUDE UD_SEV_C;
      229     8262        %INCLUDE UD_EQU_E;
      230     8651        %GJ_FCN#;
      231     8677        %SUB_EXC;
      232     8724        %SUB_ECCDELTA;
      233     8761        %SUB B$JIT=B$JIT$->B$JIT;
      234     8762        %SUB B$ROSEG=B$ROSEG$->B$ROSEG;
      235     8763        %SUB B$SS=B_MPT.SS$->B$SS;
      236     8764        %SUB B$ULS=B_MPT.LS$->B$ULS;
      237     8765        %SUB B$TCB=B_MPT.TCB$->B$TCB;
      238     8766        %SUB B$MAP=B$UPT$->B$MAP;
      239     8767                                                /**/
      240     8768        %ERRCODE (NAME=EDTCBFULL,FCG#='2505'O,MID#='04'O,COD#=%E$TCBFULL);
      241     8776        %ERRCODE (NAME=EJTCBFULL,FCG#='2505'O,MID#='12'O,COD#=%E$TCBFULL);
      242     8784        %SUB FCG#='2505'O;
      243     8785        %SUB MID#='20'O;
      244     8786        %ERRCODE (NAME=EBADPTR,COD#=%E$BADPTR);
      245     8794        %ERRCODE (NAME=ENOTCB,COD#=%E$NOTCB);
      246     8802        %ERRCODE (NAME=ETCBEMPTY,COD#=%E$TCBEMPTY);
      247     8810        %ERRCODE (NAME=EALTEMPTY,COD#=%E$ALTEMPTY);
      248     8818        %ERRCODE (NAME=ENOTPMME,COD#=%E$NOTPMME);
      249     8826        %ERRCODE (NAME=EDOMAIN,COD#=%E$DOMAIN);
      250     8834        %ERRCODE (NAME=EDRTN,COD#=%E$DRTN);
      251     8842        %ERRCODE (NAME=ETCBFULL,COD#=%E$TCBFULL);
      252     8850        %ERRCODE (NAME=ENOCONTROL,COD#=%E$NOCONTROL);
      253     8858        %ERRCODE (NAME=EBADCODE,COD#=%E$BADCODE);
      254     8866        %ERRCODE (NAME=EDLTALT,COD#=%E$DLTALT);
      255     8874        %ERRCODE (NAME=ENOLIB,COD#=%E$NOLIB);
      256     8882        %ERRCODE (NAME=EBADDCB,COD#=%E$BADDCB#);
      257     8890
      258     8891    1   DCL 1 MAP_DBRK CONSTANT,
      259     8892    1         2 * UBIN HALF UNAL INIT(0),
      260     8893    1         2 * BIT(10) INIT(%SCDBRK),
      261     8894    1         2 * BIT(8) INIT('0'B);
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:10   
      262     8895    1   DCL 1 MAP_PGWRITE CONSTANT,
      263     8896    1         2 * SBIN HALF UNAL INIT(0),
      264     8897    1         2 * BIT(12) INIT('0'B),
      265     8898    1         2 * BIT(6) INIT(%PGWRITE);
      266     8899    1   DCL 1 MAP_PGWRITE_MOD CONSTANT,
      267     8900    1         2 * SBIN HALF UNAL INIT(0),
      268     8901    1         2 * BIT(12) INIT('0'B),
      269     8902    1         2 * BIT(6) INIT(%(%PGWRITE|%PGMOD));
      270     8903        %ERRCODE (NAME=EASLERR,COD#=%E$ASLERR);
      271     8911        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:11   
      272     8912                                           /****************************************/
      273     8913                                                /*              UEP$PMME              */
      274     8914                                           /****************************************/
      275     8915    1      CALL UDN$MAGIC;
      276     8916    1      IF (CODE=%C$DRTN#) AND (B$SS.ISR.WSR ~= %DBWSR)
      277     8917    2      THEN DO;
      278     8918    2           B$JIT.ERR=EDOMAIN;
      279     8919    2           RETURN;
      280     8920    2           END;
      281     8921        /*E*     ERROR:  UEP-E$DOMAIN-E
      282     8922                 MESSAGE: M$DRTN allowed only by a Debugger.
      283     8923        */
      284     8924    1      IF CODE ~= %C$XCON#
      285     8925    1      THEN IF B$ULS.TCB.BOUND=0
      286     8926    2           THEN DO;
      287     8927    2                B$JIT.ERR=ENOTCB;
      288     8928    2                RETURN;
      289     8929    2                END;
      290     8930        /*E*     ERROR:  UEP-E$NOTCB-E
      291     8931                 MESSAGE: That Service Request not allowed if no TCB.
      292     8932                 MESSAGE1: One of the following Service Requests has
      293     8933                           caused you to be aborted because you have
      294     8934                           no TCB:
      295     8935                               M$STIMER   M$TTIMER   M$EVENT
      296     8936                               M$INT      M$XCON     M$TRAP
      297     8937                               M$STRAP    M$MERC     M$RETRY
      298     8938                               M$SENV     M$TRTN     M$CLRSTK
      299     8939                               M$MERCS    M$RETRYS   M$RENV
      300     8940                 MESSAGE2: That Service Request not allowed if no TCB.
      301     8941                 DESCRIPTION: Should never happen to a user level program
      302     8942                              as JST$STEP will always build a TCB for him.
      303     8943        */
      304     8944    1      SS_RTN_IC= B$SS.IC;
      305     8945                                 /* Save address of MERC, RETRY or TRTN for DELTA     */
      306     8946
      307     8947    1      ALT$ = PINCRW(B_MPT.TCB$,B_MPT.TCB$->FTCB.ALTFR);
      308     8948    1      CSTK$ = PINCRW(B_MPT.TCB$,B_MPT.TCB$->FTCB.CRFR);
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:12   
      309     8949    1      IF CODE >%C$TTIMER#
      310     8950    2      THEN DO;
      311     8951    2           IF CODE > %C$SENV#
      312     8952    2           THEN IF B$TCB.CURRSZ=0
      313     8953    3                THEN DO;
      314     8954    3                     B$JIT.ERR=ETCBEMPTY;
      315     8955    3                     IF CODE = %C$CLRSTK# THEN B$JIT.ERR.SEV=0;
      316     8956    3                     RETURN;
      317     8957    3                     END;
      318     8958    2                ELSE STK$=CSTK$;
      319     8959        /*E*     ERROR:  UEP-E$TCBEMPTY-E
      320     8960                 MESSAGE: That Service Request not allowed when the TCB stack is empty.
      321     8961                 MESSAGE1: One of the following Service Requests has
      322     8962                           caused you to be aborted because your TCB
      323     8963                           Stack is empty:
      324     8964                               M$TRTN     M$CLRSTK   M$MERCS   M$RETRYS
      325     8965                 DESCRIPTION: Could also happen on M$DRTN.
      326     8966        */
      327     8967    2           ELSE IF ALT$->B$EXCFR.PREVSZ ~=0
      328     8968    3                THEN DO;
      329     8969    3                     B$JIT.ERR=EALTEMPTY;
      330     8970    3                     RETURN;
      331     8971    3                     END;
      332     8972    2                ELSE STK$=ALT$;
      333     8973        /*E*     ERROR:  UEP-E$ALTEMPTY-E
      334     8974         MESSAGE: That Service Request is not allowed when the ALTRET frame in the TCB is em
              8974        pty.
      335     8975                 MESSAGE1: One of the following service Requests has caused
      336     8976                           you to be aborted because the ALTRET frame in
      337     8977                           your TCB is empty:
      338     8978                               M$MERC   M$RETRY   M$SENV
      339     8979        */
      340     8980
      341     8981    2           EXCFR_IC=STK$->B$EXCFR.IC;
      342     8982                  /* Addr of the IC at time of the event or exceptional condition     */
      343     8983
      344     8984    2           IF (STK$->B$EXCFR.ECC=%ECC_ALT#)
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:13   
      345     8985    2             OR (STK$->B$EXCFR.ECC=%ECC_PMME#)
      346     8986    3           THEN DO;
      347     8987    3                IF (STK$->B$ALT.FPT.FCG=%FCG_FM1#)
      348     8988    3                  OR (STK$->B$ALT.FPT.FCG=%FCG_FM2#)
      349     8989    3                THEN IF STK$->B$ALT.DCB# <= B$ROSEG.NUMDCBS
      350     8990    3                     THEN B$JIT.DCB$=DCBADDR(STK$->B$ALT.DCB#);
      351     8991                  /* Restore so IBEX message will make sense if we
      352     8992                     end up in ABORTM   */
      353     8993    3                END;
      354     8994    2           END;                            /* DO IF CODE > M$TTIMER              */
      355     8995        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:14   
      356     8996        /* NOW PROCEED WITH THE INDIVIDUAL PMMES */
      357     8997    2      DO CASE(CODE);
      358     8998                                           /****************************************/
      359     8999                                                /*              M$XCON                */
      360     9000                                           /****************************************/
      361     9001    2       CASE(%C$XCON#);
      362     9002    2         B_MPT.ECCB$->B$ECCB.XCONF.PROG = '0'B;
      363     9003    2         I=1;                              /* TO CHECK FOR PXCON                 */
      364     9004    2         CALL HFF$NILERASE(I) ALTRET(SETIC);
      365     9005    2         B$PS1$->PXCON.IC = B_MPT.ECCB$->B$ECCBI.ECIC(CODE);
      366     9006    2         B$PS1$->PXCON.SID = 0;
      367     9007    2         GOTO SETIC;
      368     9008        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:15   
      369     9009                                           /****************************************/
      370     9010                                                /*              M$EVENT               */
      371     9011                                                /*              M$INT                 */
      372     9012                                           /****************************************/
      373     9013    2       CASE(%C$EVENT#);
      374     9014    2         IF B$SS.ISR.WSR = %USERWSR
      375     9015    3         THEN DO;
      376     9016    3              I=0;
      377     9017    3              CALL HFF$NILERASE(0) ALTRET(EV1);
      378     9018    3              IF B$PS0$->FPTV.IC ~= 0
      379     9019    3              THEN I=1;
      380     9020    3   EV1:       S$CU$->B$U.FLG.EVNT=BINBIT(I,1);
      381     9021    3              END;
      382     9022    2         GOTO SETIC;
      383     9023
      384     9024
      385     9025    2       CASE(%C$INT#);
      386     9026    2   SETIC: ;
      387     9027    2         I=0;                              /*TO SEE IF SET OF RESET              */
      388     9028    2         CALL HFF$NILERASE(I) ALTRET(RESET);
      389     9029    2         IF B$PS0$->FPTV.IC=0 THEN GOTO RESET;
      390     9030    2         B_MPT.ECCB$->B$ECCBI.ECIC(CODE) = B$PS0$->FPTV.IC;
      391     9031    2         B_MPT.ECCB$->B$ECCBI.FLAGS(CODE) = '1'B;
      392     9032    2         IF (CODE=%C$EVENT#) AND (B$PS0$->FPT$EVENT_V.YC='1'B)
      393     9033    2         THEN B_MPT.ECCB$->B$ECCB.FLAGS.YCSET='1'B;
      394     9034    2         RETURN;
      395     9035    2   RESET: B_MPT.ECCB$->B$ECCBI.FLAGS(CODE) = '0'B;
      396     9036    2         B_MPT.ECCB$->B$ECCBI.ECIC(CODE)=0;
      397     9037    2         IF (CODE=%C$EVENT#)
      398     9038    2         THEN B_MPT.ECCB$->B$ECCB.FLAGS.YCSET='0'B;
      399     9039    2         RETURN;
      400     9040        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:16   
      401     9041                                           /****************************************/
      402     9042                                                /*              M$TRAP                */
      403     9043                                           /****************************************/
      404     9044    2       CASE(%C$TRAP#);
      405     9045    2         CALL HFE$M$TRAP(B$PS0$);
      406     9046                                           /****************************************/
      407     9047                                                /*              M$STRAP               */
      408     9048                                           /****************************************/
      409     9049    2       CASE(%C$STRAP#);
      410     9050    2         IF B$PS0$->FPT$STRAP_V.BRK
      411     9051    2           AND  B_MPT.ECCB$->B$ECCB.FLAGS.BRKSET
      412     9052    2           AND  B$PS0$->FPT$STRAP_V.STRAP=0
      413     9053    3         THEN DO;
      414     9054    3              S$CU$->B$U.ASYNCH=(S$CU$->B$U.ASYNCH | %U_BRK);
      415     9055    3              RETURN;
      416     9056    3              END;
      417     9057    2         ELSE CALL HFE$M$STRAP(B$PS0$);
      418     9058                                           /****************************************/
      419     9059                                                /*              M$STIMER              */
      420     9060                                           /****************************************/
      421     9061    2       CASE(%C$STIMER#);
      422     9062    2         IF B_MPT.ECCB$->B$ECCBI.FLAGS(CODE) ~= '1'B
      423     9063    3         THEN DO;
      424     9064    3              B$JIT.UTIMER=BITBIN(BINBIT(B$PS0$->FPT$STIMER_V.UNITS,36) & TMASK
      425     9065    3                (B$PS0$->FPT$STIMER_V.UTYPE)) * TIME(B$PS0$->FPT$STIMER_V.UTYPE)
      426     9066    3                + B$JIT.XTIME + B$JIT.STIME;
      427     9067    3              IF B$JIT.UTIMER < B$JIT.IDELTAT
      428     9068    3              THEN B$JIT.IDELTAT=B$JIT.UTIMER;
      429     9069    3              GOTO SETIC;
      430     9070    3              END;
      431     9071                                                /************************************/
      432     9072                                                /*              M$TTIMER              */
      433     9073                                                /************************************/
      434     9074    2       CASE(%C$TTIMER#);
      435     9075    2         CALL HFF$NILERASE(1) ALTRET(TT1);
      436     9076    2         IF B$JIT.UTIMER > (B$JIT.STIME+B$JIT.XTIME) THEN
      437     9077    3         DO;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:17   
      438     9078    3              I= B$JIT.UTIMER-(B$JIT.STIME+B$JIT.XTIME);
      439     9079    3              B$PS1$->TIM=I/(TIME(B$PS0$->FPT$TTIMER_V.UTYPE));
      440     9080    3              END;
      441     9081    2         ELSE
      442     9082    2              B$PS1$->TIM=0;
      443     9083    2   TT1:  ;
      444     9084    2         IF B$PS0$->FPT$TTIMER_V.CANCEL
      445     9085    3         THEN DO;
      446     9086    3              CODE=%C$STIMER#;
      447     9087    3              GOTO RESET;
      448     9088    3              END;
      449     9089    2         ELSE RETURN;
      450     9090        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:18   
      451     9091                                           /****************************************/
      452     9092                                                /*              M$MERC                */
      453     9093                                           /****************************************/
      454     9094    2       CASE(%C$MERC#);
      455     9095    2         ECP.ECCS=%SC_MERC#;
      456     9096    2         ALT$->B$EXCFR.ALTEMPTY = -1;
      457     9097    2         CALL DO_MERC ALTRET(ABORTM_GO);
      458     9098    2         GOTO DELTA_EXCRTN;
      459     9099        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:19   
      460     9100                                           /****************************************/
      461     9101                                                /*              M$RETRY               */
      462     9102                                           /****************************************/
      463     9103    2       CASE(%C$RETRY#);
      464     9104    2         ECP.ECCS=%SC_RETRY#;
      465     9105    2         CALL DO_RETRY ALTRET(ERR_EXIT);
      466     9106    2         ALT$->B$EXCFR.ALTEMPTY = -1;
      467     9107    2         GOTO DELTA_EXCRTN;
      468     9108        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:20   
      469     9109
      470     9110                                           /****************************************/
      471     9111                                                /*              M$SENV                */
      472     9112                                           /****************************************/
      473     9113    2       CASE(%C$SENV#);
      474     9114    2         FRMSZ = 68;
      475     9115    2         FROM$ = ALT$;
      476     9116    2         TO$ = ADDR(NIL);                  /* GET TOP STK FRAME                  */
      477     9117    2         CALL UEP$TCBTCB ALTRET(SETFULL);
      478     9118    2         IF ALT$->B$EXCFR.ECC=%ECC_TCBFULL#
      479     9119    2         THEN TO$->B$EXCFR.ECC=%ECC_XCON#;
      480     9120    2         ALT$->B$EXCFR.ALTEMPTY = -1;
      481     9121    2         RETURN;
      482     9122    2   SETFULL: B$JIT.ERR = ETCBFULL;
      483     9123        /*E*     ERROR:   UEP-E$TCBFULL-E
      484     9124                 MESSAGE: Can't M$SENV - Your TCB is full.
      485     9125                 MESSAGE1: Unfortunately, the environment you were trying to save
      486     9126                           has been destroyed by the M$SENV ALTRET environment.
      487     9127                 MESSAGE7: Can't M$SENV - Your TCB is full.
      488     9128        */
      489     9129    2         RETURN;
      490     9130        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:21   
      491     9131                                           /****************************************/
      492     9132                                                /*              M$TRTN                */
      493     9133                                           /****************************************/
      494     9134    2       CASE(%C$TRTN#);
      495     9135    2         ECP.ECCS=%SC_TRTN#;
      496     9136    2         IF STK$->B$SSX.ISR.WSR ~= B$SS.ISR.WSR
      497     9137    2         THEN GOTO MERCS;
      498     9138    2         CALL CHECK_FPT ALTRET(ERR_EXIT);
      499     9139    2         CALL UEP$TCBSSF;
      500     9140    2         CALL MERGE_FPT ALTRET(NO_IC);
      501     9141    2         CALL SET_IRIC;
      502     9142    2   NO_IC: ;
      503     9143    2         ECP.SVL = '000'O;
      504     9144    2         IF STK$->B$EXCFR.ECC = %ECC_XCON#
      505     9145    3         THEN DO;
      506     9146    3              TEMPF = STK$->B$XCON.CECCB;
      507     9147    3              IF (TEMPF & %SVL_GET#)
      508     9148    4              THEN DO;
      509     9149        /*   If TRTN from GET XCON and M$SAVE had ALTRET specified, bump IC  */
      510     9150    4                   IF STK$->B$SCON.SUBC.ALTBIT = '1'B
      511     9151    4                   THEN B$SS.IC = B$SS.IC+1;
      512     9152    4                   B_MPT.ECCB$->B$ECCB.XCONF.GET='0'B;
      513     9153    4                   GOTO NOT_SAVLDT;
      514     9154    4                   END;
      515     9155    3              IF B$SS.ISR.WSR=%USERWSR
      516     9156    4              THEN DO;
      517     9157    4                   IF (TEMPF & %SVL_ECCB#)
      518     9158    5                   THEN DO;
      519     9159    5                        IF (B_MPT.ECCBDESC$->B$$DESCR.FLGS & %DSXXX)
      520     9160    6                        THEN DO;
      521     9161    6                             ECP.SVL = %SVL_TRTN#;
      522     9162    6                             GOTO DELTA_EXCRTN;
      523     9163    6                             END;
      524     9164    5                        B$JIT.SVLDTF=(B$JIT.SVLDTF | %SVL_TRTN#);
      525     9165    5                        CALL UDB$CALCOMP;
      526     9166    5                        CALL JSE$ABORTX;
      527     9167                                                /* XCON IN PROG STILL SET             */
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:22   
      528     9168    5                        END;               /*DO IF SAVE-LDTRC*/
      529     9169    4                   END;                    /*DO IF %USERWSR                      */
      530     9170    3   NOT_SAVLDT: ;
      531     9171    3              IF CSTK$->B$XCON.ECCB.PROG='0'B
      532     9172    3              THEN B_MPT.ECCB$->B$ECCB.XCONF.PROG='0'B;
      533     9173    3              END;                         /* DO IF XCON                         */
      534     9174    2         B$SS.ALT='0'B;
      535     9175    2         B$JIT.ERR = STK$->B$EXCFR.ERR;
      536     9176    2         CALL CLEARONE;
      537     9177    2         GOTO DELTA_EXCRTN;
      538     9178
      539     9179        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:23   
      540     9180
      541     9181         /*I*  NAME:         DELTA_EXCRTN
      542     9182
      543     9183               PURPOSE:      To cause DELTA to be entered following a
      544     9184                             user Exceptional Condition return PMME:
      545     9185
      546     9186                                M$MERC - M$MERCS
      547     9187                                M$RETRY - M$RETRYS
      548     9188                                M$TRTN
      549     9189
      550     9190               CALL:         GOTO DELTA_EXCRTN;
      551     9191
      552     9192               DATA:         ECP.ECCS (in AUTO) is to contain the sub-code
      553     9193                             indicating the type of PMME.
      554     9194
      555     9195               DESCRIPTION:  If the user is not running under DELTA, or if
      556     9196                             the PMME was not for the user domain, the exit
      557     9197                             to the user is via UDB$AUTO.
      558     9198
      559     9199                             When the user is running under DELTA, the remainder
      560     9200                             of the parameters in the EXCRTN frame for DELTA
      561     9201                             are initialized and the exit to the user is
      562     9202                             via SSU$DELTAGO.
      563     9203
      564     9204         */
      565     9205
      566     9206    2   DELTA_EXCRTN: ;
      567     9207    2         CALL UDB$CALCOMP;
      568     9208    2         ECC=%ECC_EXCRTN#;
      569     9209    2         IF (B_MPT.ECCBDESC$->B$$DESCR.FLGS & %DSXXX)
      570     9210    3         THEN DO;
      571     9211    3              ECP.TYP=0;
      572     9212    3              ECP.EVID=SS_RTN_IC-2;        /* Addr of MERC, RETRY, or TRTN PMME  */
      573     9213    3              ECP.ERR=B$JIT.ERR;
      574     9214    3              ECP.P#=0;
      575     9215                                                /*                                    */
      576     9216    3              CALL SSU$DELTAGO (ECC,ECP);
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:24   
      577     9217    3              END;
      578     9218    2         CALL UDB$AUTO;
      579     9219        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:25   
      580     9220                                           /****************************************/
      581     9221                                                /*              M$CLRSTK              */
      582     9222                                           /****************************************/
      583     9223    2       CASE(%C$CLRSTK#);
      584     9224    2         IF B_MPT.PSDESC$->B$$DESCR.BOUND = 0
      585     9225    2         THEN I=1;
      586     9226    2         ELSE I = B$PS0$->FPTFR#;
      587     9227    3         DO WHILE (I>0);
      588     9228    3              IF CSTK$->B$EXCFR.ECC = %ECC_XCON#
      589     9229    4              THEN DO;
      590     9230    4                   TEMPF = CSTK$->B$XCON.CECCB;
      591     9231
      592     9232    4                   IF (TEMPF & %SVL_GET#)
      593     9233    4                   THEN B_MPT.ECCB$->B$ECCB.XCONF.GET='0'B;
      594     9234
      595     9235    4                   IF (TEMPF & %SVL_ECCB#)
      596     9236    4                     AND (B$SS.ISR.WSR = %USERWSR)
      597     9237    4                   THEN B$JIT.SVLDTF=(B$JIT.SVLDTF &~ TEMPF);
      598     9238
      599     9239    4                   IF CSTK$->B$XCON.ECCB.PROG='0'B
      600     9240    4                   THEN B_MPT.ECCB$->B$ECCB.XCONF.PROG='0'B;
      601     9241                                 /* Removing the last XCON frame resets In Progress   */
      602     9242
      603     9243    4                   END;                    /*DO IF CLEARING AN XCON FRAME        */
      604     9244    3              CALL CLEARONE ALTRET(CLRDONE);
      605     9245    3              I = I-1;
      606     9246    3              END;
      607     9247    2   CLRDONE: RETURN;
      608     9248        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:26   
      609     9249                                           /****************************************/
      610     9250                                                /*              M$MERCS               */
      611     9251                                           /****************************************/
      612     9252    2       CASE(%C$MERCS#);
      613     9253    2         ECP.ECCS=%SC_MERCS#;
      614     9254    2   MERCS: ;
      615     9255    2         IF CSTK$->B$EXCFR.ECC = %ECC_XCON#
      616     9256    3         THEN DO;
      617     9257    3              CALL DO_MERC;
      618     9258    3              B$JIT.RNST = CSTK$->B$XCON.RNST;
      619     9259                                           /* Re-establish RNST for rundown check     */
      620     9260    3              IF (B_MPT.ECCB$->B$ECCB.XCONF.PROG)
      621     9261                                      /* If the user hasn't reset the XCON address    */
      622     9262    3              THEN B_MPT.ECCB$->B$ECCB.FLAGS.XCONSET='0'B;
      623     9263                            /* Then prevent re-entry to this exit control address     */
      624     9264    3              CALL UDB$CALCOMP;
      625     9265    3              B$JIT.JUNK = B$JIT.JUNK | %JJ_SCCSET#;
      626     9266    3              CALL JSE$ABORTY;
      627     9267    3              END;                         /* DO IF ECC=XCON*/
      628     9268    2         CALL CLEARONE;
      629     9269    2         CALL DO_MERC ALTRET(ABORTM_GO);
      630     9270    2         GOTO DELTA_EXCRTN;
      631     9271        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:27   
      632     9272                                           /****************************************/
      633     9273                                                /*              M$RETRYS              */
      634     9274                                           /****************************************/
      635     9275    2       CASE(%C$RETRYS#);
      636     9276    2         ECP.ECCS=%SC_RETRYS#;
      637     9277    2         IF (STK$->B$EXCFR.ECC=99) OR (STK$->B$EXCFR.ECC=%ECC_PMME#)
      638     9278    3         THEN DO;
      639     9279    3              CALL DO_RETRY ALTRET(ERR_EXIT);
      640     9280    3              CALL CLEARONE;
      641     9281    3              GOTO DELTA_EXCRTN;
      642     9282    3              END;
      643     9283    2         B$JIT.ERR=ENOTPMME;
      644     9284    2         RETURN;
      645     9285        /*E*     ERROR:  UEP-E$NOTPMME-E
      646     9286           MESSAGE: Top TCB Stack frame does not contain a Service Request environment.
      647     9287        */
      648     9288        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:28   
      649     9289                                           /****************************************/
      650     9290                                                /*              M$RENV                */
      651     9291                                           /****************************************/
      652     9292    2       CASE(%C$RENV#);
      653     9293    2         IF CSTK$->B$EXCFR.ECC ~= 99
      654     9294    3         THEN DO;
      655     9295    3              B$JIT.ERR=ENOTPMME;
      656     9296    3              RETURN;
      657     9297    3              END;
      658     9298    2         FRMSZ = 68;
      659     9299    2         TO$ = ALT$;
      660     9300    2         FROM$ = CSTK$;
      661     9301    2         CALL UEP$TCBTCB;
      662     9302    2         CALL CLEARONE;
      663     9303    2         ALT$->B$EXCFR.PREVSZ=0;
      664     9304        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:29   
      665     9305                                           /****************************************/
      666     9306                                                /*              M$DRTN                */
      667     9307                                           /****************************************/
      668     9308         /*D* NAME: M$DRTN.
      669     9309         */
      670     9310    2       CASE(%C$DRTN#);
      671     9311
      672     9312
      673     9313    2         IF CSTK$->B$SSX.ISR.WSR = %DBWSR AND NOT B$PS2$ -> FPTV.QUIT
      674     9314    3         THEN DO;
      675     9315    3              B$JIT.ERR=EDRTN;
      676     9316    3              RETURN;
      677     9317    3              END;
      678     9318        /*E*     ERROR:  UEP-E$DRTN-E
      679     9319                 MESSAGE: M$DRTN from Debugger when top TCB frame is the Debugger's.
      680     9320                 DESCRIPTION: This error is returned only to an interactive
      681     9321                              Debugger.  The user should never see this message.
      682     9322        */
      683     9323
      684     9324        /*D* An M$DRTN request with SPCLD set is simply a request to
      685     9325             reset the Debugger's Special Access Descriptors and return
      686     9326             to the Debugger.
      687     9327        */
      688     9328
      689     9329    2         IF B$PS2$->FPTV.SPCLD
      690     9330    3         THEN DO;
      691     9331    4              DO WHILE (B$SS.ISR.WSR ~= CSTK$->B$SSX.ISR.WSR);
      692     9332    4                   CALL JSS$BACKSS;
      693     9333    4                   END;
      694     9334    3              B$ULS.SPCL1=B_MPT.SSDESC$->B$$DESCR;
      695     9335    3              B$ULS.SPCL1.TYP=1;
      696     9336    3              B$ULS.SPCL2=B$SS.LSR;
      697     9337    3              B$ULS.SPCL3=B$SS.ASR;
      698     9338    3              B$ULS.SPCL4=B$SS.PSR;
      699     9339    3              B$ULS.SPCL5=B$SS.ISR;
      700     9340    3              CALL UDN$MAGIC;
      701     9341    3              RETURN;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:30   
      702     9342    3              END;
      703     9343
      704     9344    2         CALL CHECK_FPT ALTRET(ERR_EXIT);
      705     9345                                                /* CHECK_FPT will set E$BADPTR if bad */
      706     9346
      707     9347        /*D* An M$DRTN request with MRGSS set is a request to update the
      708     9348             user's Safe-Store frame and the copy of it in the Debugger's
      709     9349             TCB with the data specified via the REGS and DRS parameters.
      710     9350             Control then returns to the debugger.
      711     9351        */
      712     9352
      713     9353    2         AUTO_DRTNV=B$PS2$->FPTV;
      714     9354    2         IF AUTO_DRTNV.MRGSS
      715     9355    3         THEN DO;
      716     9356    3              CALL MERGE_DFPT;
      717     9357    3              CALL UDN$MAGIC;
      718     9358    3              RETURN;
      719     9359    3              END;
      720     9360
      721     9361        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:31   
      722     9362        /*D* An M$DRTN request with WAKE_FD set is a request to get in sync
      723     9363             with the debugger on the FEP that is associated with the FPRG
      724     9364             specified in the DRTN.FPRG_DCB field.  A message is sent to the
      725     9365             the FEP to wakeup the FD debugger.  If the FPRG_FID option is also
      726     9366             specified, the fid for the current FPRG associated with the FPRG_DCB
      727     9367             is read from the host and returned in FPRG_FID.  Control then
      728     9368             returns to the host debugger.
      729     9369
      730     9370             If the ALIB_FD bit is set, the FD has never been associated
      731     9371             with the specified FPRG, so a message is written to the
      732     9372             FEP requesting association of the the debugger.  If the debugger
      733     9373             is not already known to the LCP-6 system, as indicated by a
      734     9374             response of GJ_DB_DATA, the KIF$SEND_FD routine is called to
      735     9375             ship the debugger up to the front end.  In any case, the front
      736     9376             end will eventually send us an ACK or NAK response which will
      737     9377             cause us to return control to the debugger.
      738     9378        */
      739     9379    2         IF (B$PS2$->FPTV.ALIB_FD) OR (B$PS2$->FPTV.WAKE_FD)
      740     9380    3         THEN DO;
      741     9381    3              LCP6_MSG='0'B;
      742     9382    3              LCP6_MSG.FCN = %GJ_WAKEDB#;
      743     9383
      744     9384    3              IF (B$PS2$->FPTV.WAKE_FD)
      745     9385    4              THEN DO;
      746     9386    4                   CALL HFF$NILERASE(4) ALTRET(NO_FID);
      747     9387    4                   LCP6_MSG.FCN = %GJ_RTNFID#;
      748     9388    4   NO_FID:         ;
      749     9389    4                   END;
      750     9390
      751     9391    3              IF B$PS2$->FPTV.FPRG_DCB <= B$ROSEG.NUMDCBS
      752     9392    4              THEN DO;
      753     9393    4                   TO$ = DCBADDR(B$PS2$->FPTV.FPRG_DCB);
      754     9394    4                   IF TO$ ~= ADDR(NIL)
      755     9395    5                   THEN DO;
      756     9396    5                        IF TO$->F$DCB.ORG=%DBGDCB# OR TO$->F$DCB.ORG=%DBGCG#
      757     9397    5                          OR TO$->F$DCB.ORG=%DBGSYSID#
      758     9398    5                        THEN TO$ = NK$LDCT$(TO$->F$DCB.LDCTX);
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:32   
      759     9399    5                        ELSE GOTO DRTN_BADDCB;
      760     9400    5                        IF TO$ = ADDR(NIL) THEN GOTO DRTN_BADDCB;
      761     9401    5                        END;
      762     9402    4                   ELSE GOTO DRTN_BADDCB;
      763     9403    4                   END/* do if dcb# <= numdcbs*/;
      764     9404
      765     9405    4              ELSE DO;
      766     9406    4   DRTN_BADDCB:    ;
      767     9407    4                   B$JIT.ERR = EBADDCB;
      768     9408    4                   RETURN;
      769     9409    4                   END/* do if dcb# > numdcbs*/;
      770     9410        /*E*   ERROR: UEP-E$BADDCB#-E
      771     9411               MESSAGE: The FPRG DCB# in the M$DRTN FPT is bad.
      772     9412        */
      773     9413
      774     9414    3              IF B$PS2$->FPTV.WAKE_FD
      775     9415    4              THEN DO;
      776     9416    4                   CALL KIF$WRITE_IMD(TO$->TIM,LCP6_MSG,LENGTHC(B$FCN_MSG))
      777     9417    5                   WHENALTRETURN DO;
      778     9418    5                        RETURN /* JIT.ERR is set by KIF$WRITE_IMD*/;
      779     9419    5                        END;
      780     9420
      781     9421    4                   IF LCP6_MSG.FCN = %GJ_RTNFID#
      782     9422    4                   THEN GOTO READ_ACK;
      783     9423    4                   ELSE RETURN;
      784     9424    4                   END;
      785     9425
      786     9426    3              LCP6_MSG.NAME = B$P$->B$P.NAME(S$CU$->B$U.DB);
      787     9427    3              FROM$ = PINCRC(ADDR(LCP6_MSG.NAME),LCP6_MSG.NAME.L+1);
      788     9428    3              FROM$->B$2CHAR = '_F';
      789     9429
      790     9430    3              LCP6_MSG.NAME.L = LCP6_MSG.NAME.L+2;
      791     9431    3              LCP6_MSG.FCN = %GJ_GETDB#;
      792     9432    3              LCP6_MSG.ERR='0'B;
      793     9433
      794     9434    3              CALL KIF$WRITE(TO$->TIM,LCP6_MSG,LENGTHC(B$ALIB_MSG))
      795     9435    4              WHENALTRETURN DO;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:33   
      796     9436    4                   RETURN /* JIT.ERR is set by KIF$WRITE*/;
      797     9437    4                   END;
      798     9438
      799     9439    3   READ_ACK:  ;
      800     9440    3              CALL KIF$READ(TO$->TIM,LCP6_MSG,LENGTHC(LCP6_MSG))
      801     9441    4              WHENALTRETURN DO;
      802     9442    4                   RETURN;
      803     9443    4                   END;
      804     9444
      805     9445    4              DO CASE(LCP6_MSG.FCN);
      806     9446    4               CASE(%GJ_ACK#);
      807     9447    4                 CALL HFF$NILERASE(4)
      808     9448    5                 WHENRETURN DO;
      809     9449    5                      B$PS4$->VLR_FPRG_FID.NAME = LCP6_MSG.NAME;
      810     9450    5                      B$PS4$->VLR_FPRG_FID.ACCT = LCP6_MSG.ACCT;
      811     9451    5                      B$PS4$->VLR_FPRG_FID.PASS = LCP6_MSG.PASS;
      812     9452    5                      B$PS4$->VLR_FPRG_FID.PSN = LCP6_MSG.PSN;
      813     9453    5                      CALL KIA$8TO9(LCP6_MSG.MODTIME,B$PS4$->VLR_FPRG_FID.MODTIME,4);
      814     9454    5                      END;
      815     9455    4                 RETURN;
      816     9456
      817     9457    4               CASE(%GJ_NAK#);
      818     9458    4                 CALL EMR$FEP2HOST(LCP6_MSG.ERR,B$JIT.ERR);
      819     9459    4                 RETURN;
      820     9460
      821     9461    4               CASE(%GJ_DB_DATA#);
      822     9462    4                 CALL KIF$SEND(TO$->TIM,LCP6_MSG.NAME,%GJ_DB_DATA#)
      823     9463    5                 WHENALTRETURN DO;
      824     9464    5                      RETURN /* JIT.ERR is set by KIF$SEND*/;
      825     9465    5                      END;
      826     9466    4                 GOTO READ_ACK;
      827     9467
      828     9468    4               CASE(ELSE);
      829     9469    4                 B$JIT.ERR=ENOLIB;
      830     9470    4                 CALL SC_UE_LCP6_FCN;
      831     9471
      832     9472        /*E* ERROR: UEP-E$NOLIB-E
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:34   
      833     9473             MESSAGE: You are not allowed to associate a debugger with that FPRG.
      834     9474             DESCRIPTION: An unknown FCN code was in the message read as a
      835     9475                          response to the GJ_GETDB request sent to LCP-6.
      836     9476        */
      837     9477
      838     9478        /*S* SCREECH_CODE: UEP-S$BAD_LCP6_FCN
      839     9479             TYPE:  SNAP
      840     9480             MESSAGE: Unknown FCN code in response to GJ_GETDB request.
      841     9481        */
      842     9482    4                 END/* Do case(fcn) */;
      843     9483
      844     9484    3              RETURN;
      845     9485    3              END/* Do if ALIB_FD */;
      846     9486        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:35   
      847     9487        /*D* When DBRK is set in the M$DRTN FPT, the entries in the user's
      848     9488             Page Table that have the %SCDBRK Software Control bit set are
      849     9489             to have the write control bit reset.  JJ2_DBRK is set in B$JIT.JUNK2
      850     9490             to signal SSU$DELTAGO to enable write access upon the next entry
      851     9491             to the Debugger.
      852     9492              Code has been added to this routine to fix, with any luck, the
      853     9493              when breakpoints on the dp8000.  Because whenbreak points break
      854     9494              down when mlrs span a page, two pages will be write protected
      855     9495              for each page with a data breakpoint on it.  The page the date
      856     9496              is on and the page following it.
      857     9497        */
      858     9498
      859     9499    2         IF AUTO_DRTNV.DBRK
      860     9500    3         THEN DO;
      861     9501    3              J = B$JIT.DUL;
      862     9502    4              DO I = B$JIT.DLL TO J;
      863     9503    4                   IF B$MAP(I) & MAP_DBRK
      864     9504    4                   THEN
      865     9505    4                        B$MAP(I) = B$MAP(I)  & ~ MAP_PGWRITE_MOD;
      866     9506    4                   IF I ~= J AND B$MAP.RPN(I+1) ~= MM_FPMC.RPN THEN
      867     9507    4                        B$MAP(I+1) = B$MAP(I+1) & ~ MAP_PGWRITE_MOD;
      868     9508    4                   END;
      869     9509
      870     9510    3              J = B$JIT.DDUL;
      871     9511    4              DO I = B$JIT.DDLL TO J;
      872     9512    4                   IF B$MAP(I) & MAP_DBRK
      873     9513    4                   THEN
      874     9514    4                        B$MAP(I) = B$MAP(I)  & ~ MAP_PGWRITE_MOD;
      875     9515    4                   IF I ~= J AND B$MAP.RPN(I+1) ~= MM_FPMC.RPN THEN
      876     9516    4                        B$MAP(I+1) = B$MAP(I+1) & ~ MAP_PGWRITE_MOD;
      877     9517    4                   END;
      878     9518
      879     9519    3              J = B$JIT.PTSIZ;
      880     9520    4              DO I = %UDSEGLO TO J;
      881     9521    4                   IF B$MAP(I) & MAP_DBRK
      882     9522    4                   THEN
      883     9523    4                        B$MAP(I) = B$MAP(I)  & ~ MAP_PGWRITE_MOD;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:36   
      884     9524    4                   IF I ~= J AND B$MAP.RPN(I+1) ~= MM_FPMC.RPN THEN
      885     9525    4                        B$MAP(I+1) = B$MAP(I+1) & ~ MAP_PGWRITE_MOD;
      886     9526    4                   END;
      887     9527    3              CALL HFC$ASSOCCLR (%USERWSQ,0,16384); /*MAX Dense PT*/
      888     9528    3              B$JIT.JUNK2 = (B$JIT.JUNK2 | %JJ2_DBRK#);
      889     9529
      890     9530    3              END;                         /*DO IF DRTN.DBRK                     */
      891     9531    2         IF AUTO_DRTNV.SETSTEPCC = '1'B
      892     9532    3         THEN DO;
      893     9533    3              B$JIT.STEPCC=AUTO_DRTNV.STEPCC;
      894     9534    3              B$JIT.JUNK = (B$JIT.JUNK | %JJ_SCCSET#);
      895     9535    3              END;
      896     9536                                                /* PICK UP DATA WE USE A LOT          */
      897     9537    2         OECC=CSTK$->B$EXCFR.ECC;
      898     9538    2         NECC = OECC;
      899     9539    2         FRMSZ = B$TCB.CURRSZ;             /* SIZE OF FRAME IN DELTA'S TCB       */
      900     9540
      901     9541
      902     9542    2         IF AUTO_DRTNV.SETECC = '1'B
      903     9543    2         THEN NECC=AUTO_DRTNV.ECC;
      904     9544    2         IF (NECC < %ECC_DELTA#) AND (NECC ~= %ECC_XCON#)
      905     9545    3         THEN DO;
      906     9546    3              TO$=ADDR(B$ROSEG.ECCB(ECCBINDX(CSTK$->B$EXCFR.ISR.WSR)));
      907     9547    3              IF TO$->B$ECCBI.FLAGS(NECC) = '0'B
      908     9548    4              THEN DO;
      909     9549    4                   B$JIT.ERR=ENOCONTROL;
      910     9550        /*E*     ERROR:  UEP-E$NOCONTROL-E
      911     9551                 MESSAGE: Control of that exceptional condition has not been established.
      912     9552                 DESCRIPTION: This error is reported to DELTA when
      913     9553                              the M$DRTN Service Request has specified
      914     9554                              that a user's Exceptional Condition processing
      915     9555                              routine is to be entered and the user has
      916     9556                              not asked for control over the specified condition.
      917     9557        */
      918     9558    4                   RETURN;
      919     9559    4                   END;
      920     9560    3              END;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:37   
      921     9561
      922     9562
      923     9563        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:38   
      924     9564        /*D* If the Debugger was entered because of an M$ALIB service request
      925     9565             the KPDELTA, DLIB, KLDELTA and ALTRTN options are inspected
      926     9566             to determine how to proceed.
      927     9567        */
      928     9568
      929     9569    2         IF OECC = %ECC_ALIB#
      930     9570    3         THEN DO;
      931     9571    3              IF AUTO_DRTNV.KPDELTA
      932     9572    4              THEN DO;
      933     9573    4                   IF CSTK$->B$SSX.ISR.WSR = %ASLWSR
      934     9574    5                   THEN DO;
      935     9575    5                        AUTO_DRTNV.KPDELTA='0'B;
      936     9576    5                        END;
      937     9577    5                   ELSE DO;
      938     9578    5                        IF ~(B$JIT.JUNK & %JJ_UDELTA#)
      939     9579    6                        THEN DO;
      940     9580    6                             B$JIT.JUNK = (B$JIT.JUNK | %JJ_UDELTA#);
      941     9581    6                             B_MPT.LSDESC$->B$$DESCR=B$LS$->B$MLS.USERLS;
      942     9582    6                             CALL UDN$MAGICLS;
      943     9583    6                             B_MPT.LS$->B$ULNK.ECCB.FLGS=B_MPT.LS$->B$ULNK.ECCB.FLGS|%
              9583                                      DSXXX;
      944     9584    6                             CALL UDN$MAGIC;
      945     9585    6                             END;
      946     9586    5                        END;
      947     9587    4                   END;
      948     9588    3              IF AUTO_DRTNV.DLIB
      949     9589    3              THEN IF (B$JIT.JUNK & %JJ_UDELTA#)
      950     9590    3                   THEN AUTO_DRTNV.DLIB='0'B;
      951     9591
      952     9592                                                /*                                    */
      953     9593    3              IF AUTO_DRTNV.ALTRTN = '1'B
      954     9594    4              THEN DO;
      955     9595    4                   B$JIT.ERR=EDLTALT;
      956     9596    4                   CALL HFF$NILERASE(3) ALTRET(NO_ALIBERR);
      957     9597    4                   B$JIT.ERR = B$PS3$->VLP$ECCS_V.ERR;
      958     9598    4   NO_ALIBERR:     ;
      959     9599    4                   CALL RUND_DELTA2;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:39   
      960     9600    4                   CALL UDB$PMMEXIT2;
      961     9601    4                   END;                    /*DO IF ALTRET*/
      962     9602
      963     9603        /*E*   ERROR:  JSP-E$DLTALT-E
      964     9604                 MESSAGE: Debugger signaled ALTRET from your M$ALIB request.
      965     9605                 MESSAGE1: Please refer to your Debugger reference manual.
      966     9606                 MESSAGE7: Debugger signaled ALTRET from your M$ALIB request.
      967     9607                 DESCRIPTION: The user should never see this message as
      968     9608                              DELTA always (?) specifies the error code
      969     9609                              to be returned to the user.
      970     9610        */
      971     9611
      972     9612    3              END;                         /*DO IF OECC=ALIB                     */
      973     9613        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:40   
      974     9614
      975     9615    2         IF AUTO_DRTNV.EVENT='1'B
      976     9616    2         THEN B$JIT.JUNK = (B$JIT.JUNK | %JJ_EVENT#);
      977     9617
      978     9618        /*D* If QUIT is specified a call is made to JSA$QUIT to set the
      979     9619             XCONF, RNST, JUNK and ERR fields of the JIT and to reset
      980     9620             the %DSXXX bit in the user's ECCB Descriptor.  However, if
      981     9621             the QUIT is from an Alternate Shared Library, the QUIT
      982     9622             becomes an M$ERR (ASL).  In any case, the Debugger is
      983     9623             run down and the abort logic is entered.
      984     9624         */
      985     9625    2         IF AUTO_DRTNV.QUIT ='1'B
      986     9626    3         THEN DO;
      987     9627    3              IF CSTK$->B$SSX.ISR.WSR = %ASLWSR
      988     9628    3              THEN B$JIT.ERR=EASLERR;
      989     9629    3              ELSE CALL JSA$QUIT;
      990     9630        /*E*   ERROR: UEP-E$ASLERR-E
      991     9631               MESSAGE: Your Alternate Shared Library has errored the job.
      992     9632               DESCRIPTION: QUIT command to the Debugger following an
      993     9633                            M$ALIB service request from an Alternate
      994     9634                            Shared Library.  Exit Control for both the
      995     9635                            user and Alternate Shared Library will be
      996     9636                            honored and the Debugger will remain
      997     9637                            associated.
      998     9638        */
      999     9639    3              CALL RUND_DELTA;
     1000     9640                                                /* JSA$QUIT has backed Safe-store     */
     1001     9641    3              CALL JSE$ABORTX;
     1002     9642    3              END;
     1003     9643        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:41   
     1004     9644        /*D* The values supplied by the REGS, DRS, IC and IR options of
     1005     9645             the M$DRTN FPT are then moved to the Safe-Store frame.
     1006     9646             If returning to the user following an M$ALIB service
     1007     9647             request, with no change to the user's IC, the IC is
     1008     9648             bumped past the ALTRET address (if any).
     1009     9649        */
     1010     9650    2         CALL MERGE_DFPT;
     1011     9651    2         B_MPT.ECCBDESC$->B$$DESCR = B$ULS.ECCB;
     1012     9652                            /* Get a ECCB descriptor we will be interested in !!!     */
     1013     9653    2         B_MPT.ECCBDESC$->B$$DESCR.FLGS =
     1014     9654    2           (B_MPT.ECCBDESC$->B$$DESCR.FLGS  | %DSWRITE );
     1015     9655
     1016     9656    2         CALL SET_IRIC;
     1017     9657
     1018     9658    2         IF OECC= %ECC_ALIB#
     1019     9659    3         THEN DO;
     1020     9660    3              IF (B$SS.IC = EXCFR_IC) AND (B$SS.ALT='1'B)
     1021     9661    3              THEN B$SS.IC = B$SS.IC+1;
     1022     9662    3              END;
     1023     9663        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:42   
     1024     9664
     1025     9665        /*D* When exiting to a user Exceptional Condition processing
     1026     9666             routine, the values specified by the ECCS option are
     1027     9667             moved to the copy of the user frame on the Debugger's
     1028     9668             TCB, so will they will be moved on the call to UEP$TCBTCB.
     1029     9669        */
     1030     9670    2         IF NECC <= %ECC_ERROR#
     1031     9671    3         THEN DO;
     1032     9672    3              I=3;
     1033     9673    3              CALL HFF$NILERASE(I) ALTRET(ECCS_OK);
     1034     9674
     1035     9675    3              CSTK$->B$EXCFR.U1=0;
     1036     9676    3              CSTK$->B$XCON.ECSC=B$PS3$->VLP$ECCS_V.ECCS.EVSC;
     1037     9677    3              CSTK$->B$EXCFR.EVID=B$PS3$->VLP$ECCS_V.EVID;
     1038     9678    3              CSTK$->B$EXCFR.ERR=B$PS3$->VLP$ECCS_V.ERR;
     1039     9679    3   ECCS_OK:   ;
     1040     9680    3              CSTK$->B$EXCFR.ECC=NECC;
     1041     9681    3              IF OECC ~= NECC
     1042     9682    4              THEN DO;
     1043     9683    4                   CSTK$->B$EXCFR.P#=0;
     1044     9684    4                   FRMSZ=68;
     1045     9685    4                   IF OECC=%ECC_XCON#
     1046     9686    4                   THEN B$JIT.SVLDTF='000'O;
     1047     9687                                                /* JUST IN CASE                       */
     1048     9688    4                   END;
     1049     9689    3              B$JIT.ERR = CSTK$->B$EXCFR.ERR;
     1050     9690    3              END;
     1051     9691                                                /*                                    */
     1052     9692        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:43   
     1053     9693
     1054     9694        /*D* If the value of the ECC parameter in the M$DRTN FPT (or
     1055     9695             the value of the ECC in the TCB frame, if SETECC is
     1056     9696             not specified) is >= ECC_DELTA#, then we are to return to
     1057     9697             the user at the address that is now in Safe-Store.
     1058     9698        */
     1059     9699
     1060     9700        /*D* If this 'GO' is aborting an entry to Exit Control processing
     1061     9701             then we must first remove the Exit Control flags that have been
     1062     9702             set in the user's ECCB and in JIT.SVLDTF.
     1063     9703        */
     1064     9704    2         IF NECC >= %ECC_DELTA#
     1065     9705    3         THEN DO;
     1066     9706    3              IF OECC = %ECC_XCON#
     1067     9707    4              THEN DO;
     1068     9708    4                   B_MPT.ECCB$->B$ECCB.XCONF =
     1069     9709    4                     (B_MPT.ECCB$->B$ECCB.XCONF &~ CSTK$->B$XCON.CECCB);
     1070     9710    4                   B$JIT.SVLDTF=(B$JIT.SVLDTF &~(CSTK$->B$XCON.CECCB & %SVL_ECCB#) );
     1071     9711    4                   END;                    /*DO IF OECC=XCON#                    */
     1072     9712
     1073     9713        /*D* If this a 'GO' following an entry to the Debugger for an
     1074     9714             M$EXIT or M$TRTN from a user's Exit Control routine that
     1075     9715             was entered for SAVE or M$LDTRC, the Debugger is run down
     1076     9716             and the abort logic is entered where the actual SAVE or
     1077     9717             LDTRC will take place.  (See JSE$EXITS).
     1078     9718        */
     1079     9719    3              IF OECC = %ECC_EXCRTN#
     1080     9720    4              THEN DO;
     1081     9721    4                   B$SS.ISR = CSTK$->B$SSX.ISR;
     1082     9722                                                /* In case the user shrunk his ISR    */
     1083     9723    4                   IF B$SS.IC = EXCFR_IC
     1084     9724    5                   THEN DO;                /* If the user hasnt changed IC*/
     1085     9725    5                        FROM$=PINCRW(CSTK$,64);
     1086     9726    5                        IF (FROM$->B$EXCRTN.SVL & %SVL_READY#)
     1087     9727    6                        THEN DO;
     1088     9728    6                             B$JIT.SVLDTF=(B$JIT.SVLDTF | FROM$->B$EXCRTN.SVL);
     1089     9729    6   FINAL_EXIT:               ;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:44   
     1090     9730    6                             CALL RUND_DELTA;
     1091     9731    6                             CALL JSE$ABORTX;
     1092     9732    6                             END;          /*DO IF READY                         */
     1093     9733
     1094     9734    5                        IF (FROM$->B$EXCRTN.ECCS = %SC_XCONXIT#)
     1095     9735    6                        THEN DO;
     1096     9736    6                             B$JIT.JUNK=(B$JIT.JUNK  | %JJ_BYPASSD#);
     1097     9737    6                             GOTO FINAL_EXIT;
     1098     9738    6                             END;
     1099     9739
     1100     9740    5                        END;               /*DO IF SS.IC NOT MODIFIED            */
     1101     9741    4                   END;                    /* DO IF OECC = EXCRTN#               */
     1102     9742
     1103     9743
     1104     9744    3              CALL RUND_DELTA;
     1105     9745
     1106     9746    3              IF NECC = %ECC_SAVLDT#  /* IF SPECIAL RETURN FROM DELTA FOR SAVE   */
     1107     9747    3              THEN CALL JSE$ABORTX;
     1108     9748                                                /* ALLOWS USER TO SKIP SCON           */
     1109     9749    3              ELSE CALL UDB$AUTO;
     1110     9750    3              END;                         /*DO IF NECC>=ECC_DELTA#              */
     1111     9751                                                /*                                    */
     1112     9752        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:45   
     1113     9753           /* DELTA was entered via an Exceptional Condition reported
     1114     9754              on the user  */
     1115     9755           /* Leaving an XCON entry - or exiting to XCON processing
     1116     9756              requires a few special checks  */
     1117     9757    2         IF NECC = %ECC_XCON#
     1118     9758    3         THEN DO;
     1119     9759    3              IF OECC = %ECC_XCON#
     1120     9760    4              THEN DO;
     1121     9761    4                   IF (CSTK$->B$XCON.CECCB & (%SVL_ECCB# | %SVL_GET#) )
     1122     9762    5                   THEN DO;
     1123     9763                                                /* If M$LDTRC or SAVE-GET             */
     1124     9764    5                        IF CSTK$->B$XCON.CECCB.PROG ='1'B
     1125     9765    6                        THEN DO;
     1126     9766    6                             IF (B_MPT.ECCB$->B$ECCB.FLAGS.XCONSET)
     1127     9767    7                             THEN DO;
     1128     9768    7                                  TEMPF=CSTK$->B$XCON.CECCB;
     1129     9769    7                                  GOTO XCON_GO;
     1130     9770    7                                  END;     /*DO IF THE USER WANTS XCON           */
     1131     9771    7                             ELSE DO;
     1132     9772    7                                  CSTK$->B$EXCFR.ECC=%ECC_SAVLDT#;
     1133     9773    7                                  END;     /*DO IF THE USER DOESNT WANT XCON     */
     1134     9774    6                             END;          /*DO IF XCON.PROG=0                   */
     1135     9775                                                /*                                    */
     1136     9776                                 /* READY TO DO IT NOW-SINCE XCON IN PROG OR NOT SET  */
     1137     9777    5                        B_MPT.ECCB$->B$ECCB.XCONF.SVLDT='1'B;
     1138     9778    5                        CALL DTCB_UTCB;
     1139     9779                                      /* CHANGE THIS IF GOTO DELTA ON TRNT FROM SVLDT */
     1140     9780    5                        GOTO DO_DRUND;
     1141     9781    5                        END;               /*DO IF SVL_ECCB#                     */
     1142     9782    4                   B$JIT.RNST = CSTK$->B$XCON.RNST;
     1143     9783    4                   END;                    /*DO IF OECC = XCON                   */
     1144     9784    4              ELSE DO;                     /* LET ASL KNOW WHATS HAPPENING       */
     1145     9785    4                   IF (OECC >%ECC_XCON#) AND (OECC < %ECC_DELTA#)
     1146     9786    4                   THEN B$JIT.RNST = (B$JIT.RNST | %RS_ABRT#);
     1147     9787    4                   ELSE B$JIT.XCONF = (B$JIT.XCONF | %XC_QUIT#);
     1148     9788    4                   END;                    /*DO IF OECC ~= XCON                  */
     1149     9789    3              B$JIT.JUNK = (B$JIT.JUNK | %JJ_BYPASSD#);
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:46   
     1150     9790    3   DO_DRUND:  ;
     1151     9791    3              CALL RUND_DELTA;
     1152     9792    3              CALL JSE$ABORTX;
     1153     9793    3              END;                         /*DO IF NECC = XCON                   */
     1154     9794        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:47   
     1155     9795
     1156     9796
     1157     9797          /* When the user has Exceptional Condition control move
     1158     9798             the frame from DELTA's TCB to the User's TCB and
     1159     9799             exit thru SSS$SEXIT (via UDB$AUTO)  */
     1160     9800    2   XCON_GO: ;
     1161     9801    2         CALL DTCB_UTCB;
     1162     9802    2         B$SS.IC = B_MPT.ECCB$->B$ECCBI.ECIC(NECC);
     1163     9803    2         B$SS.IR.MIR = '0'B;
     1164     9804    2         B$SS.CPUREQ = '0'B;
     1165     9805    2         IF NECC = %ECC_XCON#
     1166     9806    3         THEN DO;
     1167     9807    3              B_MPT.ECCB$->B$ECCB.XCONF = (B_MPT.ECCB$->B$ECCB.XCONF | TEMPF);
     1168     9808    3              B_MPT.ECCB$->B$ECCB.XCONF.PROG='1'B;
     1169     9809                                           /* In Progress for M$LDTRC or SAVE-GET     */
     1170     9810    3              END;
     1171     9811    2         CALL RUND_DELTA;
     1172     9812    2         CALL UDB$AUTO;
     1173     9813                                                /*                                    */
     1174     9814                                                /*                                    */
     1175     9815        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:48   
     1176     9816    2       CASE(ELSE);
     1177     9817    2         B$JIT.ERR=EBADCODE;
     1178     9818    2         RETURN;
     1179     9819
     1180     9820    2         END;                              /* DO CASE(CODE)                      */
     1181     9821    1      RETURN;
     1182     9822                                                /*                                    */
     1183     9823                                                /*                                    */
     1184     9824    1   ERR_EXIT: RETURN;
     1185     9825
     1186     9826    1   ABORTM_GO: ;
     1187     9827    1      CALL UDB$CALCOMP;
     1188     9828    1      CALL JSE$ABORTM;
     1189     9829
     1190     9830        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:49   
     1191     9831                                                /*                                    */
     1192     9832    1   UEP$CLEARONE: ENTRY(CODE,USTK1$,USTK2$) ALTRET;
     1193     9833                                                /*                                    */
     1194     9834                                                /*                                    */
     1195     9835    1      IF USTK1$=ADDR(NIL)
     1196     9836    1      THEN USTK1$=PINCRW(B_MPT.TCB$,B_MPT.TCB$->FTCB.CRFR);
     1197     9837    1      CSTK$=USTK1$;
     1198     9838    1      IF CODE ~= 0
     1199     9839    2      THEN DO;
     1200     9840    2           USTK1$=CSTK$;                   /* In case it was null coming in      */
     1201     9841    2           IF CSTK$->B$SSX.ISR.WSR ~= CODE
     1202     9842    2           THEN RETURN;
     1203     9843    2           END;
     1204     9844    1      CALL CLEARONE ALTRET(CLR_ALT);
     1205     9845    1      USTK1$=CSTK$;
     1206     9846    1      RETURN;
     1207     9847    1   CLR_ALT: USTK1$=CSTK$;
     1208     9848    1      ALTRETURN;
     1209     9849                                                /*                                    */
     1210     9850        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:50   
     1211     9851                                                /*                                    */
     1212     9852    1   UEP$MOVETCB: ENTRY(CODE,USTK1$,USTK2$) ALTRET;
     1213     9853           /*
     1214     9854              CODE is unused
     1215     9855              USTK2$ must point to word 0 of a TCB and be in auto or static
     1216     9856              If USTK1$=ADDR(NIL) then we will use the TCB Descriptor in the MAGIC segment
     1217     9857           */
     1218     9858                                                /*                                    */
     1219     9859                                                /*                                    */
     1220     9860    1      CSTK$ = PINCRW(B_MPT.TCB$,B_MPT.TCB$->FTCB.CRFR);
     1221     9861    1      TO$=USTK1$;
     1222     9862    1      FROM$=USTK2$;
     1223     9863    1      FRMSZ=FROM$->FTCB.CRSZ;
     1224     9864    1      FROM$=PINCRW(FROM$,FROM$->FTCB.CRFR);
     1225     9865    1      USTK2$=FROM$;
     1226     9866    1      CALL UEP$TCBTCB ALTRET(MVTCB_ALT);
     1227     9867    1      RETURN;
     1228     9868    1   MVTCB_ALT: ;
     1229     9869    1      B$JIT.ERR = EJTCBFULL;
     1230     9870        /*E*     ERROR: UEJ-E$TCBFULL-E
     1231     9871                 MESSAGE: Debugger TCB full.  Can't enter debugger for SAVE/GET user XCON.
     1232     9872        */
     1233     9873    1      ALTRETURN;
     1234     9874                                                /*                                    */
     1235     9875        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:51   
     1236     9876
     1237     9877        /*D*   NAME: DTCB_UTCB.
     1238     9878
     1239     9879               PURPOSE: To move the copy of the user's TCB frame on the
     1240     9880                        Debugger's TCB to the user's TCB.
     1241     9881
     1242     9882        */
     1243     9883
     1244     9884    1   DTCB_UTCB: PROC;
     1245     9885    3      DO INHIBIT;
     1246     9886    3           B$LS$->B$MLS.MISC2=B_MPT.TCBDESC$->B$$DESCR;
     1247     9887    3           TO$ = ADDR(NIL);                /* MEANS GET FRAME IN TCB             */
     1248     9888    3           FROM$ = PINCRW(B$MISC2$,B$MISC2$->FTCB.CRFR);
     1249     9889    3           CALL UDN$MAGICLS;
     1250     9890    3           CSTK$ = PINCRW(B_MPT.TCB$,B_MPT.TCB$->FTCB.CRFR);
     1251     9891                                                /* Remember ECCB.XCONF new flags      */
     1252     9892    3           CALL UEP$TCBTCB ALTRET(FULL_TCB);
     1253     9893    3           END;                            /* INHIBIT                            */
     1254     9894    2      RETURN;
     1255     9895
     1256     9896    2   FULL_TCB: ;
     1257     9897    2      B$JIT.SVLDTF='000'O;
     1258     9898    2      B$JIT.ERR = EDTCBFULL;
     1259     9899        /*E*     ERROR: UED-E$TCBFULL-E
     1260     9900                 MESSAGE: Can't give you control, your TCB is full.
     1261     9901                 MESSAGE1: The user's TCB is full, so DELTA cannot pass control
     1262     9902                           to the user's exceptional condition handling routine.
     1263     9903                 MESSAGE7: Can't give you control, your TCB is full.
     1264     9904        */
     1265     9905        /*E*     ERROR:      -E$TCBFULL-E
     1266     9906                 MESSAGE: A300 YOUR TCB IS FULL OR NOT THERE
     1267     9907        */
     1268     9908        /* E$TCBFULL is reported under three different conditions
     1269     9909           in module UEP$PMME.  Because it is confusing to not have
     1270     9910           an explicit message for each of the three, a different
     1271     9911           MID was used for each.  Although not legal use of FCG/MID,
     1272     9912           it does give the user the info he needs.  Note that there
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:52   
     1273     9913           currently are no modules with a UED or UEJ prefix.  If
     1274     9914           ever there should be, a different phony MID should be used
     1275     9915           in the error codes here.
     1276     9916        */
     1277     9917    2      CALL RUND_DELTA;
     1278     9918    2      CALL JSE$ABORTM;
     1279     9919    2   END;
     1280     9920        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:53   
     1281     9921                                           /****************************************/
     1282     9922                                                /*              UEP$TCBTCB            */
     1283     9923                                           /****************************************/
     1284     9924    1   UEP$TCBTCB: PROC ALTRET;
     1285     9925    2   DCL CHFRSZ UBIN;
     1286     9926    2   DCL FRVAR CHAR(CHFRSZ) BASED;
     1287     9927    3      DO INHIBIT;
     1288     9928    4           IF TO$=ADDR(NIL) THEN DO;
     1289     9929    4                IF B$TCB.TCBAVSZ < FRMSZ THEN ALTRETURN;
     1290     9930    4                TO$=PINCRW(CSTK$,B_MPT.TCB$->FTCB.CRSZ);
     1291     9931    4                B$TCB.STK$ = PINCRW(B$TCB.STK$,B_MPT.TCB$->FTCB.CRSZ);
     1292     9932    4                TO$->B$EXCFR.PREVSZ = B$TCB.CURRSZ;
     1293     9933    4                B$TCB.CURRSZ = FRMSZ;
     1294     9934    4                B$TCB.TCBAVSZ = B$TCB.TCBAVSZ-FRMSZ;
     1295     9935    4                END;
     1296     9936    3           CHFRSZ = FRMSZ * 4 - 4;
     1297     9937        /*       LEAVE WORD 0 ALONE */
     1298     9938    3           PINCRW ( TO$ , 1 ) -> FRVAR = PINCRW ( FROM$ , 1 ) -> FRVAR;
     1299     9939                                                /**/
     1300     9940    3           TO$->B$EXCFR.ECC = FROM$->B$EXCFR.ECC;
     1301     9941    3           RETURN;
     1302     9942    3           END;                            /* INHIBIT                            */
     1303     9943    2   END;
     1304     9944        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:54   
     1305     9945                                           /****************************************/
     1306     9946                                                /*              UEP$TCBSSF            */
     1307     9947                                           /****************************************/
     1308     9948    1   UEP$TCBSSF: PROC;
     1309     9949    2      TO$ = PINCRW(B_MPT.SS$,1);
     1310     9950    2      FROM$ = PINCRW(STK$,1);
     1311     9951    2      TO$->FR63 = FROM$->FR63;
     1312     9952    2      RETURN;
     1313     9953    2   END;
     1314     9954        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:55   
     1315     9955                                           /****************************************/
     1316     9956                                                /*              CLEAR_ONE             */
     1317     9957                                           /****************************************/
     1318     9958    1   CLEARONE: PROC ALTRET;                  /*REMOVES TOP STACK FRAME             */
     1319     9959    2      IF B$TCB.CURRSZ=0 THEN ALTRETURN;
     1320     9960    2      B$TCB.TCBAVSZ = B$TCB.TCBAVSZ + B$TCB.CURRSZ;
     1321     9961    2      B$TCB.CURRSZ = CSTK$->B$EXCFR.PREVSZ;
     1322     9962    2      IF B$TCB.CURRSZ = 0 THEN RETURN;
     1323     9963    2      B$TCB.STK$ = PINCRW(B$TCB.STK$,-B$TCB.CURRSZ);
     1324     9964    2      CSTK$ = PINCRW(B_MPT.TCB$,B_MPT.TCB$->FTCB.CRFR);
     1325     9965    2      RETURN;
     1326     9966    2   END;
     1327     9967        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:56   
     1328     9968                                           /****************************************/
     1329     9969                                                /*              CHECK_FPT             */
     1330     9970                                           /****************************************/
     1331     9971    1   CHECK_FPT: PROC ALTRET;
     1332     9972    2      IF B_MPT.PSDESC$->B$$DESCR.BOUND = 0 THEN RETURN;
     1333     9973    2      I=1;
     1334     9974    2      CALL HFF$NILERASE(I) ALTRET(NO_PRC);
     1335     9975    3      DO I=0 TO 7;
     1336     9976    3           IF (B$PS1$->B$PTRS.SEGID(I) >  %MAXUSERSID) OR  (B$PS1$->B$PTRS.SEGID(I) < %
              9976                    AS0SID) OR
     1337     9977    3             (B$PS1$->B$PTRS.SEGID(I) > %AS64SID AND B$PS1$->B$PTRS.SEGID(I) < %ISSID)
     1338     9978    4           THEN DO;
     1339     9979    4                B$JIT.ERR=EBADPTR;
     1340     9980    4                ALTRETURN;
     1341     9981    4                END;
     1342     9982        /*E*     ERROR:  UEP-E$BADPTR-E
     1343     9983          MESSAGE: Bad pointer specified on M$TRTN or M$RETRY.
     1344     9984          MESSAGE1: The SEGID of a pointer specified via the DRS option of M$TRTN or
     1345     9985                    M$RETRY must reference the Linkage Segment.
     1346     9986        */
     1347     9987    3           END;                            /* DO I=0 TO 7                        */
     1348     9988    2   NO_PRC: RETURN;
     1349     9989    2   END;
     1350     9990        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:57   
     1351     9991                                           /****************************************/
     1352     9992                                                /*              MERGE_DFPT            */
     1353     9993                                           /****************************************/
     1354     9994
     1355     9995    1   MERGE_DFPT: PROC;
     1356     9996
     1357     9997    3      DO WHILE (B$SS.ISR.WSR ~= CSTK$->B$SSX.ISR.WSR);
     1358     9998    3           CALL JSS$BACKSS;
     1359     9999    3           END;
     1360    10000    2      CALL UDN$MAGICRLS;
     1361    10001    2      CALL MERGE_FPT;
     1362    10002    2      CSTK$->B$EXCFR.REGS=B$SS.REGS;
     1363    10003    2      CSTK$->B$EXCFR.PRS=B$SS.PR;
     1364    10004    2      CSTK$->B$EXCFR.DRS=B$SS.DR;
     1365    10005    2      RETURN;
     1366    10006    2   END;
     1367    10007        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:58   
     1368    10008                                           /****************************************/
     1369    10009                                                /*              MERGE_FPT             */
     1370    10010                                           /****************************************/
     1371    10011    1   MERGE_FPT: PROC ALTRET;
     1372    10012    2      I=0;
     1373    10013    2      CALL HFF$NILERASE(I) ALTRET(NO_REGS);
     1374    10014    2      B$SS.REGS = B$PS0$->FPTREGS;
     1375    10015    2   NO_REGS: ;
     1376    10016    2      I=1;
     1377    10017    2      CALL HFF$NILERASE(I) ALTRET(NO_DRS);
     1378    10018    2      B$SS.PR = B$PS1$ -> PRS;
     1379    10019    2   NO_DRS: ;                               /* REFRESH DRS WITH LSEG SID          */
     1380    10020    2      TO$=ADDR(B$SS.PR);
     1381    10021    3      DO I=0 TO 7;
     1382    10022    3           IF (TO$->B$PTRS.S.SEG_TYPE(I) & '01'B) = '01'B
     1383    10023    4           THEN DO;
     1384    10024    4                J=TO$->B$PTRS.S.DESCR#(I);
     1385    10025        /* If it is a super descriptor then only move the first word */
     1386    10026    4                IF B$SS.DR.WORD1.TYP(I) = 4 OR B$SS.DR.WORD1.TYP(I) = 6
     1387    10027    4                THEN
     1388    10028    4                     B$SS.DR.WORD1(I)=B_MPT.LS$->B$DESEG(J);
     1389    10029    4                ELSE
     1390    10030    4                     B$SS.DR(I)=B_MPT.LS$->B$DESEG(J);
     1391    10031    4                END;
     1392    10032    3           END;
     1393    10033    2      IF B_MPT.PSDESC$->B$$DESCR.BOUND = 0 THEN ALTRETURN;
     1394    10034    2      RETURN;
     1395    10035    2   END;
     1396    10036        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:59   
     1397    10037                                           /****************************************/
     1398    10038                                                /*   SET_IRIC                         */
     1399    10039                                           /****************************************/
     1400    10040    1   SET_IRIC: PROC;
     1401    10041    2      IF B$PS2$->FPTV.IC ~= 0
     1402    10042    2      THEN B$SS.IC=B$PS2$->FPTV.IC;
     1403    10043                                                /*                                    */
     1404    10044    2      IF (B$PS2$->FPTV.SETIR)
     1405    10045    3      THEN DO;
     1406    10046    3           IF B$SS.IR.MIR = '1'B
     1407    10047    3           THEN B$SS.IR=(B$PS2$->FPTV.IR & '777770'O);
     1408    10048    3           ELSE B$SS.IR=(B$PS2$->FPTV.IR & '777730'O);
     1409    10049    3           END;
     1410    10050                                                /*                                    */
     1411    10051    2      IF NOT (B$JIT.PRIV.ACTIVE & %PR_TND#)
     1412    10052    2      THEN B$SS.IR.PM='0'B;
     1413    10053                                                /*                                    */
     1414    10054    2      IF NOT (B$JIT.PRIV.ACTIVE & %PR_MSYS#)
     1415    10055    2      THEN B$SS.IR.MMODE='0'B;
     1416    10056                                                /*                                    */
     1417    10057    2      IF B$SS.IC ~= EXCFR_IC
     1418    10058    2      THEN B$SS.IR.MIR='0'B;
     1419    10059                                                /*                                    */
     1420    10060    2      IF B$SS.IR.MIR = '0'B
     1421    10061    2      THEN B$SS.CPUREQ = '0'B;
     1422    10062                                                /*                                    */
     1423    10063    2      RETURN;
     1424    10064    2   END;
     1425    10065        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:60   
     1426    10066                                           /****************************************/
     1427    10067                                                /*              DO_MERC               */
     1428    10068                                           /****************************************/
     1429    10069    1   DO_MERC: PROC ALTRET;
     1430    10070    2      B$SS.ALT = '0'B;
     1431    10071    3      IF ECP.ECCS~=%SC_TRTN# THEN DO;
     1432    10072    3           CALL HFF$NILERASE(0) ALTRET(NO_MERC_FPT);
     1433    10073    3           STK$->B$EXCFR.ERR = B$PS0$->MPARAM.ERR;
     1434    10074    3           END;
     1435    10075    2      ELSE STK$->B$EXCFR.ERR = '0'B;
     1436    10076    2   NO_MERC_FPT: ;
     1437    10077    2      IF (STK$->B$EXCFR.ERR.SEV=0) AND (STK$->B$EXCFR.ECC ~= %ECC_XCON#)
     1438    10078    3      THEN DO;
     1439    10079    3           IF STK$->B$SSX.ISR.WSR ~= B$SS.ISR.WSR
     1440    10080    4           THEN DO;
     1441    10081    4                CALL UDB$CALCOMP;
     1442    10082    4                CALL JSS$RUNDSPC;
     1443    10083    4                CALL UDB$AUTO;
     1444    10084    4                END;
     1445    10085    3           CALL UEP$TCBSSF;
     1446    10086    3           IF STK$->B$EXCFR.ECC = 99 THEN B$SS.IC = B$SS.IC+3;
     1447    10087    3           IF STK$->B$EXCFR.ECC = %ECC_PMME# THEN B$SS.IC = B$SS.IC+2;
     1448    10088    3           RETURN;
     1449    10089    3           END;
     1450    10090    2      B$JIT.ERR = STK$->B$EXCFR.ERR;
     1451    10091    2      IF (STK$->B$EXCFR.ECC = %ECC_ALT#) OR (STK$->B$EXCFR.ECC = %ECC_PMME#)
     1452    10092    3      THEN DO;
     1453    10093    3           IF STK$->B$ALT.DCB# <= B$ROSEG.NUMDCBS
     1454    10094    4           THEN DO;
     1455    10095    4                B$JIT.DCB$=DCBADDR(STK$->B$ALT.DCB#);
     1456    10096    4                B$JIT.DCBNO = STK$->B$ALT.DCB#;
     1457    10097    4                END;
     1458    10098    3           END;                            /*DO IF ECC_ALT OR ECC_PMME           */
     1459    10099    2      ELSE B$JIT.DCBNO=0;
     1460    10100    2      ALTRETURN;
     1461    10101    2   END;
     1462    10102        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:61   
     1463    10103                                           /****************************************/
     1464    10104                                                /*              DO_RETRY              */
     1465    10105                                           /****************************************/
     1466    10106    1   DO_RETRY: PROC ALTRET;
     1467    10107    2      CALL CHECK_FPT ALTRET(BAD_FPT);
     1468    10108    2      CALL UEP$TCBSSF;
     1469    10109    2      CALL MERGE_FPT ALTRET(NEXT);
     1470    10110    2   NEXT: ;
     1471    10111    2      B$SS.ALT = '0'B;
     1472    10112    2      RETURN;
     1473    10113    2   BAD_FPT: ALTRETURN;
     1474    10114    2   END;
     1475    10115        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:62   
     1476    10116                                           /****************************************/
     1477    10117                                                /*              RUND_DELTA            */
     1478    10118                                           /****************************************/
     1479    10119    1   RUND_DELTA: PROC;
     1480    10120    2      CALL UDN$MAGIC;                      /* REFRESH                            */
     1481    10121    2      CALL UDB$CALCOMP;
     1482    10122    2   RUND_DELTA2: ENTRY;
     1483    10123    2      CSTK$=PINCRW(B_MPT.TCB$,B_MPT.TCB$->FTCB.CRFR);
     1484    10124    2      CALL CLEARONE;                       /*FLUSH USER FRAME FROM DELTAS TCB*/
     1485    10125    2      IF (AUTO_DRTNV.KLDELTA) OR (AUTO_DRTNV.DLIB)
     1486    10126    2      THEN CALL JSA$RUNDSPC(%DBWSR,1);
     1487    10127    2      ELSE CALL JSA$RUNDSPC(%DBWSR,0);
     1488    10128    2      CALL JSS$RUNDSPC;                    /*WHICH WILL RECALL MAGIC             */
     1489    10129
     1490    10130        /*   The Write Control bit on users procedure is reset */
     1491    10131
     1492    10132    2      IF (B$JIT.JUNK2 & %JJ2_PACCESS#)
     1493    10133    3      THEN DO;
     1494    10134    3           J = B$JIT.PUL;
     1495    10135    4           DO I = B$JIT.PLL TO J;
     1496    10136    4                B$MAP(I) = B$MAP(I) & ~MAP_PGWRITE;
     1497    10137    4                END;
     1498    10138
     1499    10139        /*   If B$JIT.PCL is non zero there is an unshared version of a
     1500    10140             library associated with this program that must be protected.
     1501    10141              */
     1502    10142    3           IF B$JIT.PCL ~= 0
     1503    10143    4           THEN DO;
     1504    10144    4                J = B$JIT.LUL;
     1505    10145    5                DO I = B$JIT.LLL TO J;
     1506    10146    5                     B$MAP(I) = B$MAP(I) & ~MAP_PGWRITE;
     1507    10147    5                     END;
     1508    10148    4                END;
     1509    10149
     1510    10150    3           B$JIT.JUNK2 = (B$JIT.JUNK2 \ %JJ2_PACCESS#);
     1511    10151    3           END;
     1512    10152    2      CALL HFC$ASSOCCLR (%USERWSQ,0,16384); /*MAX Dense PT*/
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:63   
     1513    10153    2      IF OECC=%ECC_ALIB# THEN RETURN;
     1514    10154                                                /* RESET UTIMER CONTROL AFTER M$DRTN  */
     1515    10155    2      IF (NECC = %ECC_TIMER#) OR (OECC = %ECC_TIMER#)
     1516    10156    3      THEN DO;
     1517    10157    3           B_MPT.ECCB$->B$ECCBI.FLAGS(%ECC_TIMER#) = '0'B;
     1518    10158    3           B$JIT.UTIMER=0;
     1519    10159    3           END;
     1520    10160    2      RETURN;
     1521    10161    2   END;
     1522    10162    1   END UEP$PMME;
     1523    10163        %EOD;

PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:64   
--  Include file information  --

   UD_EQU_E.:E05TOU  is referenced.
   UD_SEV_C.:E05TOU  is referenced.
   UD_ERRORS_C.:E05TOU  is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   J_ERRSET_C.:E05TOU  is referenced.
   J_ERRORS_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   B_SEGIDS_C.:E05TOU  is referenced.
   UE_ERRORS_C.:E05TOU  is referenced.
   UE_CP6.:E05TOU  is referenced.
   UE$CP6V_C.:E05TOU  is referenced.
   GJ_MSG_M.:E05TOU  is referenced.
   B_ULSMAC_C.:E05TOU  is referenced.
   B_MLSMAC_C.:E05TOU  is referenced.
   B_MAGIC_C.:E05TOU  is referenced.
   B_MACROS_C.:E05TOU  is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
   B$ROSEG.:E05TOU  cannot be made into a system file and is referenced.
   B$P.:E05TOU  cannot be made into a system file and is referenced.
   MM_MACRO_M.:E05TOU  is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   MM$SYSGEN.:E05TOU  is referenced.
   M_INFO_C.:E05TOU  is referenced.
   MM_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   S_WSPTD_R.:E05TOU  cannot be made into a system file and is referenced.
   B$MAP.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  is referenced.
   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure UEP$PMME.

   Procedure UEP$PMME requires 1974 words for executable code.
   Procedure UEP$PMME requires 54 words of local(AUTO) storage.
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:65   

PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:66   

 Object Unit name= UEP$PMME                                   File name= UEP$PMME.:E05TOU
 UTS= JUL 30 '97 06:57:21.00 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS     35     43  UEP$PMME
    1   Proc  even  none  1974   3666  UEP$PMME
    2  RoData even  none    36     44  UEP$PMME

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        3  UEP$PMME
     1   2545          yes     yes      Std        3  UEP$CLEARONE
     1   2606          yes     yes      Std        3  UEP$MOVETCB
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:67   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       0 UDN$MAGIC
 yes     yes           Std       1 HFF$NILERASE
         yes           Std       0 UDB$CALCOMP
         yes           Std       0 JSS$BACKSS
 yes     yes           Std       3 KIF$WRITE_IMD
         yes           Std       3 HFC$ASSOCCLR
         yes           Std       0 UDN$MAGICLS
 yes     yes           Std       3 KIF$READ
         yes           Std       0 UDB$PMMEXIT2
         yes           Std       1 HFE$M$TRAP
         yes           Std       1 HFE$M$STRAP
         yes           Std       3 SSU$DELTAGO
 yes     yes           Std       3 KIF$SEND
         yes           Std       0 UDB$AUTO
         yes           Std       0 JSE$ABORTM
         yes           Std       0 JSE$ABORTX
         yes           Std       3 KIA$8TO9
 yes     yes           Std       3 KIF$WRITE
         yes           Std       0 JSA$QUIT
         yes           Std       2 EMR$FEP2HOST
         yes           Std       0 JSE$ABORTY
         yes           Std       0 UDN$MAGICRLS
         yes           Std       0 JSS$RUNDSPC
         yes           Std       2 JSA$RUNDSPC
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AUTO_3
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:68   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_UE_LCP6_FCN                   r    MM_BYP$                               MM_FPMC
     B$P$                                  B_MPT                                 N$DCT$$
r    B$MISC2$                         r    B$ROSEG$                         r    B$PS0$
r    B$PS1$                           r    B$PS2$                           r    B$PS3$
r    B$PS4$                           r    B$UPT$                           r    B$JIT$
r    B$LS$                                 S$CU$                                 B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ROSID                                 ASLENTSID                             ISSID
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:69   


        1        1        /*M*   UEP$PMME  User Exceptional Condition PMME Handler  */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* PLM=3,IND=5,ENU=0,ECU=0    */
        8        8        UEP$PMME: PROC(CODE,USTK1$,USTK2$) ALTRET;

      8  1 000000   000000 700200 xent  UEP$PMME     TSX0  ! X66_AUTO_3
         1 000001   000066 000003                    ZERO    54,3

        9        9        %INCLUDE B$JIT;
       10      612        %INCLUDE B$MAP;
       11      711        %INCLUDE S_WSPTD_R;
       12      727        %INCLUDE MM_DATA_R;
       13     1247        %INCLUDE B$P;
       14     1331        %INCLUDE B$ROSEG;
       15     1394        %INCLUDE B$USER;
       16     1610        %INCLUDE F$DCB;
       17     1659        %INCLUDE B_MACROS_C;
       18     1770        %INCLUDE B_MAGIC_C;
       19     1888        %INCLUDE B_MLSMAC_C;
       20     2830        %INCLUDE B_ULSMAC_C;
       21     3939        %INCLUDE GJ_MSG_M;
       22     4252        %INCLUDE UE$CP6V_C;
       23     4336        %INCLUDE UE_CP6;
       24     5027        %INCLUDE UE_ERRORS_C;
       25     5045                                                /* Input parameters                   */
       26     5046    1   DCL CODE UBIN(36);
       27     5047    1   DCL USTK1$ PTR;
       28     5048    1   DCL USTK2$ PTR;
       29     5049
       30     5050                                                /* AUTO Storage                       */
       31     5051    1   DCL ALT$ PTR;
       32     5052    1   DCL CSTK$ PTR;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:70   
       33     5053    1   DCL STK$ PTR;
       34     5054    1   DCL TO$ PTR;
       35     5055    1   DCL FROM$ PTR;
       36     5056    1   DCL FRMSZ UBIN(36);
       37     5057    1   DCL I UBIN(36);
       38     5058    1   DCL 1 U REDEF I,
       39     5059    1         2 UPR35 UBIN(35) UNAL,
       40     5060    1         2 *    BIT(1) UNAL;
       41     5061    1   DCL J UBIN(36);
       42     5062    1   DCL TEMPF BIT(9);
       43     5063                                                /* USED BY M$DRTN                     */
       44     5064    1   DCL OECC UBIN(18);                      /*REMEMBER HOW WE ENTERED DELTA       */
       45     5065    1   DCL NECC UBIN(18);                      /*HOW DELTA WANTS ECC RESET           */
       46     5066
       47     5067        %B$EXCRTN (NAME=ECP,STCLASS=AUTO);
       48     5070    1   DCL ECC UBIN(36);
       49     5071
       50     5072    1   DCL SS_RTN_IC UBIN HALF;
       51     5073    1   DCL EXCFR_IC UBIN HALF;
       52     5074        %GJ_LDTRC_MSG (FPTN=LCP6_MSG,STCLASS=AUTO,GEN_MODTIME=YES);
       53     5125
       54     5126                                                /* Internal Data                      */
       55     5127    1   DCL   TIME(0:2) UBIN(36) CONSTANT INIT(1000,1000000,60000000);
       56     5128    1   DCL   TMASK(0:2) BIT(36) CONSTANT  INIT('000377777777'O,'000000177777'O
       57     5129    1          ,'000000001777'O);
       58     5130
       59     5131    1   DCL ECCBINDX(0:7) CONSTANT UBIN(9) INIT(0,0,0,0,3,2,1,0);
       60     5132
       61     5133        /* EXTERNAL PROCEDURES */
       62     5134
       63     5135    1   DCL HFE$M$TRAP ENTRY(1);
       64     5136    1   DCL HFE$M$STRAP ENTRY(1);
       65     5137    1   DCL HFF$NILERASE ENTRY(1) ALTRET;
       66     5138    1   DCL JSS$BACKSS ENTRY;
       67     5139    1   DCL UDN$MAGIC ENTRY;
       68     5140    1   DCL UDN$MAGICLS ENTRY;
       69     5141    1   DCL UDN$MAGICRLS ENTRY;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:71   
       70     5142    1   DCL JSS$RUNDSPC ENTRY;
       71     5143    1   DCL JSA$RUNDSPC ENTRY(2);
       72     5144    1   DCL JSA$QUIT ENTRY;
       73     5145    1   DCL UDB$AUTO ENTRY;
       74     5146    1   DCL UDB$PMMEXIT ENTRY;
       75     5147    1   DCL JSE$ABORTM ENTRY;
       76     5148    1   DCL JSE$ABORTX ENTRY;
       77     5149    1   DCL JSE$ABORTY ENTRY;
       78     5150    1   DCL HFC$ASSOCCLR ENTRY(3);
       79     5151    1   DCL SSU$DELTAGO ENTRY(3);
       80     5152    1   DCL UDB$CALCOMP ENTRY;
       81     5153    1   DCL UDB$PMMEXIT2 ENTRY;
       82     5154    1   DCL EMR$FEP2HOST ENTRY(2);
       83     5155    1   DCL KIF$READ ENTRY(3) ALTRET;
       84     5156    1   DCL KIF$SEND ENTRY(3) ALTRET;
       85     5157    1   DCL KIA$8TO9 ENTRY(3);
       86     5158    1   DCL KIF$WRITE ENTRY(3) ALTRET;
       87     5159    1   DCL KIF$WRITE_IMD ENTRY(3) ALTRET;
       88     5160    1   DCL SC_UE_LCP6_FCN ENTRY CONV(2,0);
       89     5161
       90     5162        /* EXTERNAL DATA */
       91     5163
       92     5164        %B_MPT (FPTN=B_MPT,STCLASS=SYMREF);
       93     5257    1   DCL N$DCT$$ PTR SYMREF;
       94     5258    1   DCL B$MISC2$ PTR SYMREF READONLY;
       95     5259    1   DCL B$ROSEG$ PTR SYMREF READONLY;
       96     5260    1   DCL B$PS0$ PTR SYMREF READONLY;
       97     5261    1   DCL B$PS1$ PTR SYMREF READONLY;
       98     5262    1   DCL B$PS2$ PTR SYMREF READONLY;
       99     5263    1   DCL B$PS3$ PTR SYMREF READONLY;
      100     5264    1   DCL B$PS4$ PTR SYMREF READONLY;
      101     5265    1   DCL B$UPT$ PTR SYMREF READONLY;
      102     5266    1   DCL B$JIT$ PTR SYMREF READONLY;
      103     5267    1   DCL B$LS$ PTR SYMREF READONLY;
      104     5268
      105     5269        %EQU AS64SID = '4200'O;
      106     5270        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:72   
      107     5271                                                /* BASED Structures                   */
      108     5272        %GJ_FCN_MSG (FPTN=B$FCN_MSG,STCLASS=BASED);
      109     5297        %GJ_ALIB_MSG (FPTN=B$ALIB_MSG,STCLASS=BASED);
      110     5337    1   DCL B$2CHAR CHAR(2) UNAL BASED;
      111     5338    1   DCL NK$LDCT$(0:0) PTR BASED(N$DCT$$);
      112     5339    1   DCL 1 FTCB BASED ALIGNED,          /* FUNNY TCB STRUCTURE-USE WITH PINCRW     */
      113     5340    1         2 ALTFR SBIN HALF UNAL,
      114     5341    1         2 * UBIN(18) UNAL,
      115     5342    1         2 CRFR SBIN HALF UNAL,
      116     5343    1         2 * UBIN(18) UNAL,
      117     5344    1         2 UNUSED SBIN HALF UNAL,
      118     5345    1         2 CRSZ SBIN HALF UNAL;
      119     5346
      120     5347    1   DCL FRAME(0:333) BASED UBIN(36);
      121     5348    1   DCL TIM SBIN BASED;
      122     5349        %T01DESCR (NAME=B$$DESCR);
      123     5357        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:73   
      124     5358    1   DCL 1 B$SS BASED DALIGNED,
      125     5359    1         2 * BIT (36) UNAL,                /* HWMR                               */
      126     5360    1         2 ALT BIT(1) UNAL,
      127     5361    1         2 FPTCODE UBIN(17) UNAL,
      128     5362    1         2 * BIT(18) UNAL,
      129     5363    1         2 *(0:1) BIT (36) UNAL,
      130     5364    1         2 IC UBIN(18) UNAL,
      131     5365    1         2 IR,
      132     5366    1           3 * BIT(9) UNAL,
      133     5367    1           3 PM BIT(1) UNAL,
      134     5368    1           3 MMODE BIT(1) UNAL,
      135     5369    1           3 * BIT(1) UNAL,
      136     5370    1           3 MIR BIT(1) UNAL,
      137     5371    1           3 * BIT(5) UNAL,
      138     5372    1         2 * BIT(36) UNAL,
      139     5373    1         2 * BIT(18) UNAL,
      140     5374    1         2 CPUREQ BIT(1) UNAL,             /* SET BY SOFTWARE IF IR.MIR SET      */
      141     5375    1         2 CPUTYP UBIN(5) UNAL,       /* SET BY SW TO CPU TYPE IF IR.MIR SET     */
      142     5376    1         2 * BIT(12) UNAL,
      143     5377    1         2 * BIT(36) UNAL,
      144     5378    1         2 ISR,                            /* INSTRUCTION SEGMENT REGISTER       */
      145     5379    1           3 * BIT(29) UNAL,
      146     5380    1           3 WSR UBIN(3) UNAL,
      147     5381    1           3 * BIT(4) UNAL,
      148     5382    1           3 * SBIN WORD,
      149     5383    1         2 ASR BIT(72) UNAL,
      150     5384    1         2 LSR BIT(72) UNAL,
      151     5385    1         2 PSR BIT(72) UNAL,
      152     5386    1         2 PR(0:7) PTR UNAL,
      153     5387    1         2 DR(0:7) UNAL,
      154     5388    1           3 WORD1 UNAL,
      155     5389    1             4 * BIT(32) UNAL,
      156     5390    1             4 TYP UBIN(4) UNAL,
      157     5391    1           3 * BIT(36) UNAL,
      158     5392    1         2 REGS(0:6) BIT(36) UNAL,
      159     5393    1         2 *(0:16) BIT(36) UNAL;
      160     5394
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:74   
      161     5395    1   DCL 1 B$SSX BASED DALIGNED,
      162     5396    1         2 *(0:3) BIT(36) UNAL,
      163     5397    1         2 IC UBIN(18) UNAL,
      164     5398    1         2 * BIT(18) UNAL,
      165     5399    1         2 *(0:2) BIT(36) UNAL,
      166     5400    1         2 ISR,                            /* INSTRUCTION SEGMENT REGISTER       */
      167     5401    1           3 * BIT(29) UNAL,
      168     5402    1           3 WSR UBIN(3) UNAL,
      169     5403    1           3 * BIT(4) UNAL,
      170     5404    1           3 * SBIN WORD;
      171     5405
      172     5406    1   DCL FR63(0:62) BASED UBIN(36);
      173     5407        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:75   
      174     5408
      175     5409        %B$ECCB;
      176     5417        %B$ECCBI;
      177     5420        %B$TCB;
      178     5423        %B$EXCFR;
      179     5441        %B$EXCRTN;
      180     5444        %B$XCON;
      181     5454        %B$ALT;
      182     5462        %B$SVLDT (FPTN=B$SCON, STCLASS=BASED, FULL=YES);
      183     5503        %B_USRULS (FPTN=B$ULS,STCLASS=BASED);
      184     5702        %B_USRULS (FPTN=B$ULNK,STCLASS=BASED);
      185     5901        %B_MLS (FPTN=B$MLS,STCLASS=BASED);
      186     6716        %B$USERREFS;
      187     6720        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:76   
      188     6721
      189     6722        /* BASED STRUCTURES USED TO ACCESS USER PARAMETERS */
      190     6723        %FPT$DRTN_V (FPTN=FPTV);
      191     6730        %FPT$DRTN_V (FPTN=AUTO_DRTNV,BASED=AUTO);
      192     6737        %VLR_FPRG_FID (STCLASS=BASED);
      193     6745        %VLP$ECCS_V;
      194     6749        %FPT$TTIMER_V;
      195     6752        %FPT$WAIT_V;
      196     6755        %FPT$STIMER_V;
      197     6758        %FPT$STRAP_V;
      198     6761        %FPT$EVENT_V;
      199     6764    1   DCL FPTFR# UBIN(36) BASED DALIGNED;     /* M$CLRSTK                           */
      200     6765    1   DCL 1 PXCON BASED ALIGNED,              /* M$XCON                             */
      201     6766    1         2 IC UBIN(18) UNAL,
      202     6767    1         2 SID UBIN(18) UNAL;
      203     6768
      204     6769    1   DCL 1 MPARAM BASED DALIGNED,
      205     6770    1         2 ERR BIT(36) UNAL,
      206     6771    1         2 * BIT(36) UNAL;
      207     6772                                                /*                                    */
      208     6773    1   DCL FPTREGS(0:6) UBIN BASED;
      209     6774
      210     6775    1   DCL PRS(0:7) PTR BASED;
      211     6776
      212     6777    1   DCL 1 B$PTRS(0:7) BASED ALIGNED,
      213     6778    1         2 OFFSET UBIN(24) UNAL,
      214     6779    1         2 SEGID BIT(12) UNAL,
      215     6780    1         2 S REDEF SEGID,
      216     6781    1           3 SEG_TYPE BIT(2) UNAL,
      217     6782    1           3 DESCR# UBIN(10) UNAL;
      218     6783
      219     6784    1   DCL B$DESEG(0:20) BIT(72) BASED DALIGNED;
      220     6785
      221     6786                                                /* String Substitutions               */
      222     6787        %INCLUDE B_SEGIDS_C;
      223     7326        %INCLUDE CP_6_SUBS;
      224     7866        %INCLUDE J_ERRORS_C;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:77   
      225     7953        %INCLUDE J_ERRSET_C;
      226     7973        %INCLUDE SS_SCHED_C;
      227     8206        %INCLUDE UD_ERRORS_C;
      228     8248        %INCLUDE UD_SEV_C;
      229     8262        %INCLUDE UD_EQU_E;
      230     8651        %GJ_FCN#;
      231     8677        %SUB_EXC;
      232     8724        %SUB_ECCDELTA;
      233     8761        %SUB B$JIT=B$JIT$->B$JIT;
      234     8762        %SUB B$ROSEG=B$ROSEG$->B$ROSEG;
      235     8763        %SUB B$SS=B_MPT.SS$->B$SS;
      236     8764        %SUB B$ULS=B_MPT.LS$->B$ULS;
      237     8765        %SUB B$TCB=B_MPT.TCB$->B$TCB;
      238     8766        %SUB B$MAP=B$UPT$->B$MAP;
      239     8767                                                /**/
      240     8768        %ERRCODE (NAME=EDTCBFULL,FCG#='2505'O,MID#='04'O,COD#=%E$TCBFULL);
      241     8776        %ERRCODE (NAME=EJTCBFULL,FCG#='2505'O,MID#='12'O,COD#=%E$TCBFULL);
      242     8784        %SUB FCG#='2505'O;
      243     8785        %SUB MID#='20'O;
      244     8786        %ERRCODE (NAME=EBADPTR,COD#=%E$BADPTR);
      245     8794        %ERRCODE (NAME=ENOTCB,COD#=%E$NOTCB);
      246     8802        %ERRCODE (NAME=ETCBEMPTY,COD#=%E$TCBEMPTY);
      247     8810        %ERRCODE (NAME=EALTEMPTY,COD#=%E$ALTEMPTY);
      248     8818        %ERRCODE (NAME=ENOTPMME,COD#=%E$NOTPMME);
      249     8826        %ERRCODE (NAME=EDOMAIN,COD#=%E$DOMAIN);
      250     8834        %ERRCODE (NAME=EDRTN,COD#=%E$DRTN);
      251     8842        %ERRCODE (NAME=ETCBFULL,COD#=%E$TCBFULL);
      252     8850        %ERRCODE (NAME=ENOCONTROL,COD#=%E$NOCONTROL);
      253     8858        %ERRCODE (NAME=EBADCODE,COD#=%E$BADCODE);
      254     8866        %ERRCODE (NAME=EDLTALT,COD#=%E$DLTALT);
      255     8874        %ERRCODE (NAME=ENOLIB,COD#=%E$NOLIB);
      256     8882        %ERRCODE (NAME=EBADDCB,COD#=%E$BADDCB#);
      257     8890
      258     8891    1   DCL 1 MAP_DBRK CONSTANT,
      259     8892    1         2 * UBIN HALF UNAL INIT(0),
      260     8893    1         2 * BIT(10) INIT(%SCDBRK),
      261     8894    1         2 * BIT(8) INIT('0'B);
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:78   
      262     8895    1   DCL 1 MAP_PGWRITE CONSTANT,
      263     8896    1         2 * SBIN HALF UNAL INIT(0),
      264     8897    1         2 * BIT(12) INIT('0'B),
      265     8898    1         2 * BIT(6) INIT(%PGWRITE);
      266     8899    1   DCL 1 MAP_PGWRITE_MOD CONSTANT,
      267     8900    1         2 * SBIN HALF UNAL INIT(0),
      268     8901    1         2 * BIT(12) INIT('0'B),
      269     8902    1         2 * BIT(6) INIT(%(%PGWRITE|%PGMOD));
      270     8903        %ERRCODE (NAME=EASLERR,COD#=%E$ASLERR);
      271     8911        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:79   
      272     8912                                           /****************************************/
      273     8913                                                /*              UEP$PMME              */
      274     8914                                           /****************************************/
      275     8915    1      CALL UDN$MAGIC;

   8915  1 000002   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000003   000000 701000 xent               TSX1    UDN$MAGIC
         1 000004   000000 011000                    NOP     0

      276     8916    1      IF (CODE=%C$DRTN#) AND (B$SS.ISR.WSR ~= %DBWSR)

   8916  1 000005   200003 470500                    LDP0    @CODE,,AUTO
         1 000006   000000 235100                    LDA     0,,PR0
         1 000007   000017 115007                    CMPA    15,DL
         1 000010   000022 601000 1                  TNZ     s:8924
         1 000011   000000 471400 xsym               LDP1    B_MPT
         1 000012   100010 236100                    LDQ     8,,PR1
         1 000013   000160 376007                    ANQ     112,DL
         1 000014   000120 116007                    CMPQ    80,DL
         1 000015   000022 600000 1                  TZE     s:8924

      277     8917    2      THEN DO;

      278     8918    2           B$JIT.ERR=EDOMAIN;

   8918  1 000016   000025 236000 0                  LDQ     EDOMAIN
         1 000017   000000 473400 xsym               LDP3    B$JIT$
         1 000020   300012 756100                    STQ     10,,PR3

      279     8919    2           RETURN;

   8919  1 000021   000000 702200 xent               TSX2  ! X66_ARET

      280     8920    2           END;
      281     8921        /*E*     ERROR:  UEP-E$DOMAIN-E
      282     8922                 MESSAGE: M$DRTN allowed only by a Debugger.
      283     8923        */
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:80   
      284     8924    1      IF CODE ~= %C$XCON#

   8924  1 000022   000003 115007                    CMPA    3,DL
         1 000023   000034 600000 1                  TZE     s:8944

      285     8925    1      THEN IF B$ULS.TCB.BOUND=0

   8925  1 000024   000001 471400 xsym               LDP1    B_MPT+1
         1 000025   100036 236100                    LDQ     30,,PR1
         1 000026   000034 316000 xsym               CANQ    B_VECTNIL+28
         1 000027   000034 601000 1                  TNZ     s:8944

      286     8926    2           THEN DO;

      287     8927    2                B$JIT.ERR=ENOTCB;

   8927  1 000030   000021 236000 0                  LDQ     ENOTCB
         1 000031   000000 473400 xsym               LDP3    B$JIT$
         1 000032   300012 756100                    STQ     10,,PR3

      288     8928    2                RETURN;

   8928  1 000033   000000 702200 xent               TSX2  ! X66_ARET

      289     8929    2                END;
      290     8930        /*E*     ERROR:  UEP-E$NOTCB-E
      291     8931                 MESSAGE: That Service Request not allowed if no TCB.
      292     8932                 MESSAGE1: One of the following Service Requests has
      293     8933                           caused you to be aborted because you have
      294     8934                           no TCB:
      295     8935                               M$STIMER   M$TTIMER   M$EVENT
      296     8936                               M$INT      M$XCON     M$TRAP
      297     8937                               M$STRAP    M$MERC     M$RETRY
      298     8938                               M$SENV     M$TRTN     M$CLRSTK
      299     8939                               M$MERCS    M$RETRYS   M$RENV
      300     8940                 MESSAGE2: That Service Request not allowed if no TCB.
      301     8941                 DESCRIPTION: Should never happen to a user level program
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:81   
      302     8942                              as JST$STEP will always build a TCB for him.
      303     8943        */
      304     8944    1      SS_RTN_IC= B$SS.IC;

   8944  1 000034   000000 471400 xsym               LDP1    B_MPT
         1 000035   100004 220100                    LDX0    4,,PR1
         1 000036   200026 740100                    STX0    SS_RTN_IC,,AUTO

      305     8945                                 /* Save address of MERC, RETRY or TRTN for DELTA     */
      306     8946
      307     8947    1      ALT$ = PINCRW(B_MPT.TCB$,B_MPT.TCB$->FTCB.ALTFR);

   8947  1 000037   000004 473400 xsym               LDP3    B_MPT+4
         1 000040   300000 221100                    LDX1    0,,PR3
         1 000041   000000 636011                    EAQ     0,X1
         1 000042   000004 036000 xsym               ADLQ    B_MPT+4
         1 000043   200006 756100                    STQ     ALT$,,AUTO

      308     8948    1      CSTK$ = PINCRW(B_MPT.TCB$,B_MPT.TCB$->FTCB.CRFR);

   8948  1 000044   300001 222100                    LDX2    1,,PR3
         1 000045   000000 636012                    EAQ     0,X2
         1 000046   000004 036000 xsym               ADLQ    B_MPT+4
         1 000047   200007 756100                    STQ     CSTK$,,AUTO

      309     8949    1      IF CODE >%C$TTIMER#

   8949  1 000050   000007 115007                    CMPA    7,DL
         1 000051   000133 602000 1                  TNC     s:8997

      310     8950    2      THEN DO;

      311     8951    2           IF CODE > %C$SENV#

   8951  1 000052   000012 115007                    CMPA    10,DL
         1 000053   000071 602000 1                  TNC     s:8967

PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:82   
      312     8952    2           THEN IF B$TCB.CURRSZ=0

   8952  1 000054   300002 723100                    LXL3    2,,PR3
         1 000055   000067 601000 1                  TNZ     s:8958

      313     8953    3                THEN DO;

      314     8954    3                     B$JIT.ERR=ETCBEMPTY;

   8954  1 000056   000022 236000 0                  LDQ     ETCBEMPTY
         1 000057   000000 474400 xsym               LDP4    B$JIT$
         1 000060   400012 756100                    STQ     10,,PR4

      315     8955    3                     IF CODE = %C$CLRSTK# THEN B$JIT.ERR.SEV=0;

   8955  1 000061   000000 235100                    LDA     0,,PR0
         1 000062   000013 115007                    CMPA    11,DL
         1 000063   000066 601000 1                  TNZ     s:8956

   8955  1 000064   000000 236000 2                  LDQ     0
         1 000065   400012 356100                    ANSQ    10,,PR4

      316     8956    3                     RETURN;

   8956  1 000066   000000 702200 xent               TSX2  ! X66_ARET

      317     8957    3                     END;
      318     8958    2                ELSE STK$=CSTK$;

   8958  1 000067   200010 756100                    STQ     STK$,,AUTO
         1 000070   000102 710000 1                  TRA     s:8981

      319     8959        /*E*     ERROR:  UEP-E$TCBEMPTY-E
      320     8960                 MESSAGE: That Service Request not allowed when the TCB stack is empty.
      321     8961                 MESSAGE1: One of the following Service Requests has
      322     8962                           caused you to be aborted because your TCB
      323     8963                           Stack is empty:
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:83   
      324     8964                               M$TRTN     M$CLRSTK   M$MERCS   M$RETRYS
      325     8965                 DESCRIPTION: Could also happen on M$DRTN.
      326     8966        */
      327     8967    2           ELSE IF ALT$->B$EXCFR.PREVSZ ~=0

   8967  1 000071   200006 474500                    LDP4    ALT$,,AUTO
         1 000072   400000 223100                    LDX3    0,,PR4
         1 000073   000100 600000 1                  TZE     s:8972

      328     8968    3                THEN DO;

      329     8969    3                     B$JIT.ERR=EALTEMPTY;

   8969  1 000074   000023 236000 0                  LDQ     EALTEMPTY
         1 000075   000000 475400 xsym               LDP5    B$JIT$
         1 000076   500012 756100                    STQ     10,,PR5

      330     8970    3                     RETURN;

   8970  1 000077   000000 702200 xent               TSX2  ! X66_ARET

      331     8971    3                     END;
      332     8972    2                ELSE STK$=ALT$;

   8972  1 000100   200006 236100                    LDQ     ALT$,,AUTO
         1 000101   200010 756100                    STQ     STK$,,AUTO

      333     8973        /*E*     ERROR:  UEP-E$ALTEMPTY-E
      334     8974        MESSAGE: That Service Request is not allowed when the ALTRET frame in the TCB is em
              8974        pty.
      335     8975                 MESSAGE1: One of the following service Requests has caused
      336     8976                           you to be aborted because the ALTRET frame in
      337     8977                           your TCB is empty:
      338     8978                               M$MERC   M$RETRY   M$SENV
      339     8979        */
      340     8980
      341     8981    2           EXCFR_IC=STK$->B$EXCFR.IC;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:84   

   8981  1 000102   200010 474500                    LDP4    STK$,,AUTO
         1 000103   400004 223100                    LDX3    4,,PR4
         1 000104   200027 743100                    STX3    EXCFR_IC,,AUTO

      342     8982                  /* Addr of the IC at time of the event or exceptional condition     */
      343     8983
      344     8984    2           IF (STK$->B$EXCFR.ECC=%ECC_ALT#)

   8984  1 000105   400000 724100                    LXL4    0,,PR4
         1 000106   000143 104003                    CMPX4   99,DU
         1 000107   000112 600000 1                  TZE     s:8987
         1 000110   000004 104003                    CMPX4   4,DU
         1 000111   000133 601000 1                  TNZ     s:8997

      345     8985    2             OR (STK$->B$EXCFR.ECC=%ECC_PMME#)
      346     8986    3           THEN DO;

      347     8987    3                IF (STK$->B$ALT.FPT.FCG=%FCG_FM1#)

   8987  1 000112   400100 236100                    LDQ     64,,PR4
         1 000113   770000 376007                    ANQ     -4096,DL
         1 000114   040000 116007                    CMPQ    16384,DL
         1 000115   000120 600000 1                  TZE     s:8989
         1 000116   050000 116007                    CMPQ    20480,DL
         1 000117   000133 601000 1                  TNZ     s:8997

      348     8988    3                  OR (STK$->B$ALT.FPT.FCG=%FCG_FM2#)
      349     8989    3                THEN IF STK$->B$ALT.DCB# <= B$ROSEG.NUMDCBS

   8989  1 000120   000000 475400 xsym               LDP5    B$ROSEG$
         1 000121   500002 236100                    LDQ     2,,PR5
         1 000122   000022 772000                    QRL     18
         1 000123   400101 116100                    CMPQ    65,,PR4
         1 000124   000133 602000 1                  TNC     s:8997

      350     8990    3                     THEN B$JIT.DCB$=DCBADDR(STK$->B$ALT.DCB#);
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:85   

   8990  1 000125   000001 476400 2                  LDP6    1
         1 000126   600000 477500                    LDP7    0,,PR6
         1 000127   400101 725100                    LXL5    65,,PR4
         1 000130   700000 236115                    LDQ     0,X5,PR7
         1 000131   000000 470400 xsym               LDP0    B$JIT$
         1 000132   000232 756100                    STQ     154,,PR0

      351     8991                  /* Restore so IBEX message will make sense if we
      352     8992                     end up in ABORTM   */
      353     8993    3                END;

      354     8994    2           END;                            /* DO IF CODE > M$TTIMER              */

      355     8995        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:86   
      356     8996        /* NOW PROCEED WITH THE INDIVIDUAL PMMES */
      357     8997    2      DO CASE(CODE);

   8997  1 000133   200003 470500                    LDP0    @CODE,,AUTO
         1 000134   000000 235100                    LDA     0,,PR0
         1 000135   000020 115007                    CMPA    16,DL
         1 000136   000140 602005 1                  TNC     s:8997+5,AL
         1 000137   002530 710000 1                  TRA     s:9817
         1 000140   000350 710000 1                  TRA     s:9062
         1 000141   000206 710000 1                  TRA     s:9014
         1 000142   000234 710000 1                  TRA     SETIC
         1 000143   000160 710000 1                  TRA     s:9002
         1 000144   000316 710000 1                  TRA     s:9045
         1 000145   000323 710000 1                  TRA     s:9050
         1 000146   000400 710000 1                  TRA     s:9075
         1 000147   000465 710000 1                  TRA     s:9095
         1 000150   000475 710000 1                  TRA     s:9104
         1 000151   000505 710000 1                  TRA     s:9114
         1 000152   000533 710000 1                  TRA     s:9135
         1 000153   000722 710000 1                  TRA     s:9224
         1 000154   001013 710000 1                  TRA     s:9253
         1 000155   001054 710000 1                  TRA     s:9276
         1 000156   001075 710000 1                  TRA     s:9293
         1 000157   001123 710000 1                  TRA     s:9313

      358     8998                                           /****************************************/
      359     8999                                                /*              M$XCON                */
      360     9000                                           /****************************************/
      361     9001    2       CASE(%C$XCON#);

      362     9002    2         B_MPT.ECCB$->B$ECCB.XCONF.PROG = '0'B;

   9002  1 000160   000005 474400 xsym               LDP4    B_MPT+5
         1 000161   000002 236000 2                  LDQ     2
         1 000162   400004 356100                    ANSQ    4,,PR4

      363     9003    2         I=1;                              /* TO CHECK FOR PXCON                 */
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:87   

   9003  1 000163   000001 235007                    LDA     1,DL
         1 000164   200014 755100                    STA     I,,AUTO

      364     9004    2         CALL HFF$NILERASE(I) ALTRET(SETIC);

   9004  1 000165   200014 633500                    EPPR3   I,,AUTO
         1 000166   200062 453500                    STP3    CHFRSZ+3,,AUTO
         1 000167   200062 630500                    EPPR0   CHFRSZ+3,,AUTO
         1 000170   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000171   000000 701000 xent               TSX1    HFF$NILERASE
         1 000172   000234 702000 1                  TSX2    SETIC

      365     9005    2         B$PS1$->PXCON.IC = B_MPT.ECCB$->B$ECCBI.ECIC(CODE);

   9005  1 000173   200003 470500                    LDP0    @CODE,,AUTO
         1 000174   000000 235100                    LDA     0,,PR0
         1 000175   000001 735000                    ALS     1
         1 000176   000005 471400 xsym               LDP1    B_MPT+5
         1 000177   000000 473400 xsym               LDP3    B$PS1$
         1 000200   000100 100505                    MLR     fill='000'O
         1 000201   100000 000002                    ADSC9   0,A,PR1                  cn=0,n=2
         1 000202   300000 000002                    ADSC9   0,,PR3                   cn=0,n=2

      366     9006    2         B$PS1$->PXCON.SID = 0;

   9006  1 000203   000000 220003                    LDX0    0,DU
         1 000204   300000 440100                    SXL0    0,,PR3

      367     9007    2         GOTO SETIC;

   9007  1 000205   000234 710000 1                  TRA     SETIC

      368     9008        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:88   
      369     9009                                           /****************************************/
      370     9010                                                /*              M$EVENT               */
      371     9011                                                /*              M$INT                 */
      372     9012                                           /****************************************/
      373     9013    2       CASE(%C$EVENT#);

      374     9014    2         IF B$SS.ISR.WSR = %USERWSR

   9014  1 000206   100010 236100                    LDQ     8,,PR1
         1 000207   000160 376007                    ANQ     112,DL
         1 000210   000160 116007                    CMPQ    112,DL
         1 000211   000233 601000 1                  TNZ     s:9022

      375     9015    3         THEN DO;

      376     9016    3              I=0;

   9016  1 000212   200014 450100                    STZ     I,,AUTO

      377     9017    3              CALL HFF$NILERASE(0) ALTRET(EV1);

   9017  1 000213   000003 630400 2                  EPPR0   3
         1 000214   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000215   000000 701000 xent               TSX1    HFF$NILERASE
         1 000216   000224 702000 1                  TSX2    EV1

      378     9018    3              IF B$PS0$->FPTV.IC ~= 0

   9018  1 000217   000000 470400 xsym               LDP0    B$PS0$
         1 000220   000000 220100                    LDX0    0,,PR0
         1 000221   000224 600000 1                  TZE     EV1

      379     9019    3              THEN I=1;

   9019  1 000222   000001 235007                    LDA     1,DL
         1 000223   200014 755100                    STA     I,,AUTO

PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:89   
      380     9020    3   EV1:       S$CU$->B$U.FLG.EVNT=BINBIT(I,1);

   9020  1 000224   200014 236100       EV1          LDQ     I,,AUTO
         1 000225   000043 736000                    QLS     35
         1 000226   000000 470400 xsym               LDP0    S$CU$
         1 000227   000026 772000                    QRL     22
         1 000230   000000 676100                    ERQ     0,,PR0
         1 000231   020000 376007                    ANQ     8192,DL
         1 000232   000000 656100                    ERSQ    0,,PR0

      381     9021    3              END;

      382     9022    2         GOTO SETIC;

   9022  1 000233   000234 710000 1                  TRA     SETIC

      383     9023
      384     9024
      385     9025    2       CASE(%C$INT#);

   9022  1 000234                       SETIC        null
      386     9026    2   SETIC: ;
      387     9027    2         I=0;                              /*TO SEE IF SET OF RESET              */

   9027  1 000234   200014 450100                    STZ     I,,AUTO

      388     9028    2         CALL HFF$NILERASE(I) ALTRET(RESET);

   9028  1 000235   200014 630500                    EPPR0   I,,AUTO
         1 000236   200062 450500                    STP0    CHFRSZ+3,,AUTO
         1 000237   200062 630500                    EPPR0   CHFRSZ+3,,AUTO
         1 000240   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000241   000000 701000 xent               TSX1    HFF$NILERASE
         1 000242   000273 702000 1                  TSX2    RESET

      389     9029    2         IF B$PS0$->FPTV.IC=0 THEN GOTO RESET;

PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:90   
   9029  1 000243   000000 470400 xsym               LDP0    B$PS0$
         1 000244   000000 220100                    LDX0    0,,PR0
         1 000245   000273 600000 1                  TZE     RESET

      390     9030    2         B_MPT.ECCB$->B$ECCBI.ECIC(CODE) = B$PS0$->FPTV.IC;

   9030  1 000246   200003 471500                    LDP1    @CODE,,AUTO
         1 000247   100000 235100                    LDA     0,,PR1
         1 000250   000001 735000                    ALS     1
         1 000251   000005 473400 xsym               LDP3    B_MPT+5
         1 000252   000105 100500                    MLR     fill='000'O
         1 000253   000000 000002                    ADSC9   0,,PR0                   cn=0,n=2
         1 000254   300000 000002                    ADSC9   0,A,PR3                  cn=0,n=2

      391     9031    2         B_MPT.ECCB$->B$ECCBI.FLAGS(CODE) = '1'B;

   9031  1 000255   100000 235100                    LDA     0,,PR1
         1 000256   000005 473400 xsym               LDP3    B_MPT+5
         1 000257   003105 060400                    CSL     bolr='003'O
         1 000260   000030 000001 xsym               BDSC    B_VECTNIL+24             by=0,bit=0,n=1
         1 000261   300004 000001                    BDSC    4,A,PR3                  by=0,bit=0,n=1

      392     9032    2         IF (CODE=%C$EVENT#) AND (B$PS0$->FPT$EVENT_V.YC='1'B)

   9032  1 000262   100000 235100                    LDA     0,,PR1
         1 000263   000001 115007                    CMPA    1,DL
         1 000264   000272 601000 1                  TNZ     s:9034
         1 000265   000001 234100                    SZN     1,,PR0
         1 000266   000272 605000 1                  TPL     s:9034

      393     9033    2         THEN B_MPT.ECCB$->B$ECCB.FLAGS.YCSET='1'B;

   9033  1 000267   000005 473400 xsym               LDP3    B_MPT+5
         1 000270   001000 236003                    LDQ     512,DU
         1 000271   300004 256100                    ORSQ    4,,PR3

      394     9034    2         RETURN;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:91   

   9034  1 000272   000000 702200 xent               TSX2  ! X66_ARET

      395     9035    2   RESET: B_MPT.ECCB$->B$ECCBI.FLAGS(CODE) = '0'B;

   9035  1 000273   200003 470500       RESET        LDP0    @CODE,,AUTO
         1 000274   000000 235100                    LDA     0,,PR0
         1 000275   000005 471400 xsym               LDP1    B_MPT+5
         1 000276   003105 060400                    CSL     bolr='003'O
         1 000277   000002 000001 xsym               BDSC    B_VECTNIL+2              by=0,bit=0,n=1
         1 000300   100004 000001                    BDSC    4,A,PR1                  by=0,bit=0,n=1

      396     9036    2         B_MPT.ECCB$->B$ECCBI.ECIC(CODE)=0;

   9036  1 000301   000000 235100                    LDA     0,,PR0
         1 000302   000001 735000                    ALS     1
         1 000303   000005 471400 xsym               LDP1    B_MPT+5
         1 000304   000105 101400                    MRL     fill='000'O
         1 000305   000002 000004 xsym               ADSC9   B_VECTNIL+2              cn=0,n=4
         1 000306   100000 000002                    ADSC9   0,A,PR1                  cn=0,n=2

      397     9037    2         IF (CODE=%C$EVENT#)

   9037  1 000307   000000 235100                    LDA     0,,PR0
         1 000310   000001 115007                    CMPA    1,DL
         1 000311   000315 601000 1                  TNZ     s:9039

      398     9038    2         THEN B_MPT.ECCB$->B$ECCB.FLAGS.YCSET='0'B;

   9038  1 000312   000005 471400 xsym               LDP1    B_MPT+5
         1 000313   000004 236000 2                  LDQ     4
         1 000314   100004 356100                    ANSQ    4,,PR1

      399     9039    2         RETURN;

   9039  1 000315   000000 702200 xent               TSX2  ! X66_ARET

PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:92   
      400     9040        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:93   
      401     9041                                           /****************************************/
      402     9042                                                /*              M$TRAP                */
      403     9043                                           /****************************************/
      404     9044    2       CASE(%C$TRAP#);

      405     9045    2         CALL HFE$M$TRAP(B$PS0$);

   9045  1 000316   000005 630400 2                  EPPR0   5
         1 000317   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000320   000000 701000 xent               TSX1    HFE$M$TRAP
         1 000321   000000 011000                    NOP     0
         1 000322   002534 710000 1                  TRA     s:9821

      406     9046                                           /****************************************/
      407     9047                                                /*              M$STRAP               */
      408     9048                                           /****************************************/
      409     9049    2       CASE(%C$STRAP#);

      410     9050    2         IF B$PS0$->FPT$STRAP_V.BRK

   9050  1 000323   000000 474400 xsym               LDP4    B$PS0$
         1 000324   400000 236100                    LDQ     0,,PR4
         1 000325   010000 316003                    CANQ    4096,DU
         1 000326   000343 600000 1                  TZE     s:9057
         1 000327   000005 475400 xsym               LDP5    B_MPT+5
         1 000330   500004 236100                    LDQ     4,,PR5
         1 000331   100000 316003                    CANQ    32768,DU
         1 000332   000343 600000 1                  TZE     s:9057
         1 000333   400000 236100                    LDQ     0,,PR4
         1 000334   760000 316003                    CANQ    -8192,DU
         1 000335   000343 601000 1                  TNZ     s:9057

      411     9051    2           AND  B_MPT.ECCB$->B$ECCB.FLAGS.BRKSET
      412     9052    2           AND  B$PS0$->FPT$STRAP_V.STRAP=0
      413     9053    3         THEN DO;

      414     9054    3              S$CU$->B$U.ASYNCH=(S$CU$->B$U.ASYNCH | %U_BRK);
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:94   

   9054  1 000336   000000 476400 xsym               LDP6    S$CU$
         1 000337   600001 236100                    LDQ     1,,PR6
         1 000340   000030 276000 xsym               ORQ     B_VECTNIL+24
         1 000341   600001 756100                    STQ     1,,PR6

      415     9055    3              RETURN;

   9055  1 000342   000000 702200 xent               TSX2  ! X66_ARET

      416     9056    3              END;
      417     9057    2         ELSE CALL HFE$M$STRAP(B$PS0$);

   9057  1 000343   000005 630400 2                  EPPR0   5
         1 000344   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000345   000000 701000 xent               TSX1    HFE$M$STRAP
         1 000346   000000 011000                    NOP     0
         1 000347   002534 710000 1                  TRA     s:9821

      418     9058                                           /****************************************/
      419     9059                                                /*              M$STIMER              */
      420     9060                                           /****************************************/
      421     9061    2       CASE(%C$STIMER#);

      422     9062    2         IF B_MPT.ECCB$->B$ECCBI.FLAGS(CODE) ~= '1'B

   9062  1 000350   000005 474400 xsym               LDP4    B_MPT+5
         1 000351   000000 066505                    CMPB    filb='0'B
         1 000352   400004 000001                    BDSC    4,A,PR4                  by=0,bit=0,n=1
         1 000353   000002 000022 xsym               BDSC    B_VECTNIL+2              by=0,bit=0,n=18
         1 000354   002534 601000 1                  TNZ     s:9821

      423     9063    3         THEN DO;

      424     9064    3              B$JIT.UTIMER=BITBIN(BINBIT(B$PS0$->FPT$STIMER_V.UNITS,36) & TMASK

   9064  1 000355   000000 475400 xsym               LDP5    B$PS0$
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:95   
         1 000356   500001 236100                    LDQ     1,,PR5
         1 000357   000006 376000 2                  ANQ     6
         1 000360   200062 756100                    STQ     CHFRSZ+3,,AUTO
         1 000361   500001 236100                    LDQ     1,,PR5
         1 000362   000042 772000                    QRL     34
         1 000363   000000 621006                    EAX1    0,QL
         1 000364   200062 236100                    LDQ     CHFRSZ+3,,AUTO
         1 000365   000003 376011 0                  ANQ     TMASK,X1
         1 000366   000000 402011 0                  MPY     TIME,X1
         1 000367   000000 476400 xsym               LDP6    B$JIT$
         1 000370   600262 036100                    ADLQ    178,,PR6
         1 000371   600261 036100                    ADLQ    177,,PR6
         1 000372   600301 756100                    STQ     193,,PR6

      425     9065    3                (B$PS0$->FPT$STIMER_V.UTYPE)) * TIME(B$PS0$->FPT$STIMER_V.UTYPE)
      426     9066    3                + B$JIT.XTIME + B$JIT.STIME;
      427     9067    3              IF B$JIT.UTIMER < B$JIT.IDELTAT

   9067  1 000373   000377 604000 1                  TMI     s:9069
         1 000374   600266 116100                    CMPQ    182,,PR6
         1 000375   000377 605000 1                  TPL     s:9069

      428     9068    3              THEN B$JIT.IDELTAT=B$JIT.UTIMER;

   9068  1 000376   600266 756100                    STQ     182,,PR6

      429     9069    3              GOTO SETIC;

   9069  1 000377   000234 710000 1                  TRA     SETIC

      430     9070    3              END;
      431     9071                                                /************************************/
      432     9072                                                /*              M$TTIMER              */
      433     9073                                                /************************************/
      434     9074    2       CASE(%C$TTIMER#);

      435     9075    2         CALL HFF$NILERASE(1) ALTRET(TT1);
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:96   

   9075  1 000400   000007 630400 2                  EPPR0   7
         1 000401   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000402   000000 701000 xent               TSX1    HFF$NILERASE
         1 000403   000456 702000 1                  TSX2    TT1

      436     9076    2         IF B$JIT.UTIMER > (B$JIT.STIME+B$JIT.XTIME) THEN

   9076  1 000404   000000 470400 xsym               LDP0    B$JIT$
         1 000405   000261 236100                    LDQ     177,,PR0
         1 000406   000262 036100                    ADLQ    178,,PR0
         1 000407   000412 604000 1                  TMI     s:9078
         1 000410   000301 116100                    CMPQ    193,,PR0
         1 000411   000454 603000 1                  TRC     s:9082

      437     9077    3         DO;

      438     9078    3              I= B$JIT.UTIMER-(B$JIT.STIME+B$JIT.XTIME);

   9078  1 000412   000261 236100                    LDQ     177,,PR0
         1 000413   000262 036100                    ADLQ    178,,PR0
         1 000414   200062 756100                    STQ     CHFRSZ+3,,AUTO
         1 000415   000301 236100                    LDQ     193,,PR0
         1 000416   200062 136100                    SBLQ    CHFRSZ+3,,AUTO
         1 000417   200014 756100                    STQ     I,,AUTO

      439     9079    3              B$PS1$->TIM=I/(TIME(B$PS0$->FPT$TTIMER_V.UTYPE));

   9079  1 000420   000000 471400 xsym               LDP1    B$PS0$
         1 000421   100000 236100                    LDQ     0,,PR1
         1 000422   000041 772000                    QRL     33
         1 000423   000003 376007                    ANQ     3,DL
         1 000424   000000 620006                    EAX0    0,QL
         1 000425   200014 236100                    LDQ     I,,AUTO
         1 000426   000444 605000 1                  TPL     s:9079+20
         1 000427   000000 235010 0                  LDA     TIME,X0
         1 000430   000440 604000 1                  TMI     s:9079+16
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:97   
         1 000431   000001 115007                    CMPA    1,DL
         1 000432   000451 600000 1                  TZE     s:9079+25
         1 000433   000000 235003                    LDA     0,DU
         1 000434   000001 737000                    LLS     1
         1 000435   000000 507010 0                  DVF     TIME,X0
         1 000436   000044 733000                    LRS     36
         1 000437   000451 710000 1                  TRA     s:9079+25
         1 000440   000000 116010 0                  CMPQ    TIME,X0
         1 000441   000446 602000 1                  TNC     s:9079+22
         1 000442   000001 236007                    LDQ     1,DL
         1 000443   000451 710000 1                  TRA     s:9079+25
         1 000444   000000 235010 0                  LDA     TIME,X0
         1 000445   000450 605000 1                  TPL     s:9079+24
         1 000446   000000 236003                    LDQ     0,DU
         1 000447   000451 710000 1                  TRA     s:9079+25
         1 000450   000000 506010 0                  DIV     TIME,X0
         1 000451   000000 473400 xsym               LDP3    B$PS1$
         1 000452   300000 756100                    STQ     0,,PR3

      440     9080    3              END;

   9080  1 000453   000456 710000 1                  TRA     TT1

      441     9081    2         ELSE
      442     9082    2              B$PS1$->TIM=0;

   9082  1 000454   000000 471400 xsym               LDP1    B$PS1$
         1 000455   100000 450100                    STZ     0,,PR1

   9079  1 000456                       TT1          null
      443     9083    2   TT1:  ;
      444     9084    2         IF B$PS0$->FPT$TTIMER_V.CANCEL

   9084  1 000456   000000 470400 xsym               LDP0    B$PS0$
         1 000457   000000 234100                    SZN     0,,PR0
         1 000460   000464 605000 1                  TPL     s:9089

PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:98   
      445     9085    3         THEN DO;

      446     9086    3              CODE=%C$STIMER#;

   9086  1 000461   200003 471500                    LDP1    @CODE,,AUTO
         1 000462   100000 450100                    STZ     0,,PR1

      447     9087    3              GOTO RESET;

   9087  1 000463   000273 710000 1                  TRA     RESET

      448     9088    3              END;
      449     9089    2         ELSE RETURN;

   9089  1 000464   000000 702200 xent               TSX2  ! X66_ARET

      450     9090        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:99   
      451     9091                                           /****************************************/
      452     9092                                                /*              M$MERC                */
      453     9093                                           /****************************************/
      454     9094    2       CASE(%C$MERC#);

      455     9095    2         ECP.ECCS=%SC_MERC#;

   9095  1 000465   000002 221003                    LDX1    2,DU
         1 000466   200021 441100                    SXL1    ECP,,AUTO

      456     9096    2         ALT$->B$EXCFR.ALTEMPTY = -1;

   9096  1 000467   777777 222003                    LDX2    -1,DU
         1 000470   200006 474500                    LDP4    ALT$,,AUTO
         1 000471   400000 742100                    STX2    0,,PR4

      457     9097    2         CALL DO_MERC ALTRET(ABORTM_GO);

   9097  1 000472   003360 701000 1                  TSX1    DO_MERC
         1 000473   002536 702000 1                  TSX2    ABORTM_GO

      458     9098    2         GOTO DELTA_EXCRTN;

   9098  1 000474   000661 710000 1                  TRA     DELTA_EXCRTN

      459     9099        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:100  
      460     9100                                           /****************************************/
      461     9101                                                /*              M$RETRY               */
      462     9102                                           /****************************************/
      463     9103    2       CASE(%C$RETRY#);

      464     9104    2         ECP.ECCS=%SC_RETRY#;

   9104  1 000475   000004 221003                    LDX1    4,DU
         1 000476   200021 441100                    SXL1    ECP,,AUTO

      465     9105    2         CALL DO_RETRY ALTRET(ERR_EXIT);

   9105  1 000477   003502 701000 1                  TSX1    DO_RETRY
         1 000500   002535 702000 1                  TSX2    ERR_EXIT

      466     9106    2         ALT$->B$EXCFR.ALTEMPTY = -1;

   9106  1 000501   777777 220003                    LDX0    -1,DU
         1 000502   200006 470500                    LDP0    ALT$,,AUTO
         1 000503   000000 740100                    STX0    0,,PR0

      467     9107    2         GOTO DELTA_EXCRTN;

   9107  1 000504   000661 710000 1                  TRA     DELTA_EXCRTN

      468     9108        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:101  
      469     9109
      470     9110                                           /****************************************/
      471     9111                                                /*              M$SENV                */
      472     9112                                           /****************************************/
      473     9113    2       CASE(%C$SENV#);

      474     9114    2         FRMSZ = 68;

   9114  1 000505   000104 236007                    LDQ     68,DL
         1 000506   200013 756100                    STQ     FRMSZ,,AUTO

      475     9115    2         FROM$ = ALT$;

   9115  1 000507   200006 236100                    LDQ     ALT$,,AUTO
         1 000510   200012 756100                    STQ     FROM$,,AUTO

      476     9116    2         TO$ = ADDR(NIL);                  /* GET TOP STK FRAME                  */

   9116  1 000511   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000512   200011 756100                    STQ     TO$,,AUTO

      477     9117    2         CALL UEP$TCBTCB ALTRET(SETFULL);

   9117  1 000513   002711 701000 1                  TSX1    UEP$TCBTCB
         1 000514   000527 702000 1                  TSX2    SETFULL

      478     9118    2         IF ALT$->B$EXCFR.ECC=%ECC_TCBFULL#

   9118  1 000515   200006 470500                    LDP0    ALT$,,AUTO
         1 000516   000000 720100                    LXL0    0,,PR0
         1 000517   000142 100003                    CMPX0   98,DU
         1 000520   000524 601000 1                  TNZ     s:9120

      479     9119    2         THEN TO$->B$EXCFR.ECC=%ECC_XCON#;

   9119  1 000521   000003 221003                    LDX1    3,DU
         1 000522   200011 471500                    LDP1    TO$,,AUTO
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:102  
         1 000523   100000 441100                    SXL1    0,,PR1

      480     9120    2         ALT$->B$EXCFR.ALTEMPTY = -1;

   9120  1 000524   777777 220003                    LDX0    -1,DU
         1 000525   000000 740100                    STX0    0,,PR0

      481     9121    2         RETURN;

   9121  1 000526   000000 702200 xent               TSX2  ! X66_ARET

      482     9122    2   SETFULL: B$JIT.ERR = ETCBFULL;

   9122  1 000527   000027 236000 0     SETFULL      LDQ     ETCBFULL
         1 000530   000000 470400 xsym               LDP0    B$JIT$
         1 000531   000012 756100                    STQ     10,,PR0

      483     9123        /*E*     ERROR:   UEP-E$TCBFULL-E
      484     9124                 MESSAGE: Can't M$SENV - Your TCB is full.
      485     9125                 MESSAGE1: Unfortunately, the environment you were trying to save
      486     9126                           has been destroyed by the M$SENV ALTRET environment.
      487     9127                 MESSAGE7: Can't M$SENV - Your TCB is full.
      488     9128        */
      489     9129    2         RETURN;

   9129  1 000532   000000 702200 xent               TSX2  ! X66_ARET

      490     9130        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:103  
      491     9131                                           /****************************************/
      492     9132                                                /*              M$TRTN                */
      493     9133                                           /****************************************/
      494     9134    2       CASE(%C$TRTN#);

      495     9135    2         ECP.ECCS=%SC_TRTN#;

   9135  1 000533   000001 221003                    LDX1    1,DU
         1 000534   200021 441100                    SXL1    ECP,,AUTO

      496     9136    2         IF STK$->B$SSX.ISR.WSR ~= B$SS.ISR.WSR

   9136  1 000535   200010 474500                    LDP4    STK$,,AUTO
         1 000536   400010 236100                    LDQ     8,,PR4
         1 000537   100010 676100                    ERQ     8,,PR1
         1 000540   000160 376007                    ANQ     112,DL
         1 000541   001015 601000 1                  TNZ     MERCS

      497     9137    2         THEN GOTO MERCS;
      498     9138    2         CALL CHECK_FPT ALTRET(ERR_EXIT);

   9138  1 000542   003047 701000 1                  TSX1    CHECK_FPT
         1 000543   002535 702000 1                  TSX2    ERR_EXIT

      499     9139    2         CALL UEP$TCBSSF;

   9139  1 000544   002767 701000 1                  TSX1    UEP$TCBSSF
         1 000545   000000 011000                    NOP     0

      500     9140    2         CALL MERGE_FPT ALTRET(NO_IC);

   9140  1 000546   003170 701000 1                  TSX1    MERGE_FPT
         1 000547   000552 702000 1                  TSX2    NO_IC

      501     9141    2         CALL SET_IRIC;

   9141  1 000550   003303 701000 1                  TSX1    SET_IRIC
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:104  
         1 000551   000000 011000                    NOP     0

   9136  1 000552                       NO_IC        null
      502     9142    2   NO_IC: ;
      503     9143    2         ECP.SVL = '000'O;

   9143  1 000552   000000 236003                    LDQ     0,DU
         1 000553   200021 552140                    STBQ    ECP,'40'O,AUTO

      504     9144    2         IF STK$->B$EXCFR.ECC = %ECC_XCON#

   9144  1 000554   200010 470500                    LDP0    STK$,,AUTO
         1 000555   000000 720100                    LXL0    0,,PR0
         1 000556   000003 100003                    CMPX0   3,DU
         1 000557   000647 601000 1                  TNZ     s:9174

      505     9145    3         THEN DO;

      506     9146    3              TEMPF = STK$->B$XCON.CECCB;

   9146  1 000560   000100 236100                    LDQ     64,,PR0
         1 000561   777000 376003                    ANQ     -512,DU
         1 000562   200016 756100                    STQ     TEMPF,,AUTO

      507     9147    3              IF (TEMPF & %SVL_GET#)

   9147  1 000563   200016 236100                    LDQ     TEMPF,,AUTO
         1 000564   777000 376003                    ANQ     -512,DU
         1 000565   001000 376003                    ANQ     512,DU
         1 000566   000602 600000 1                  TZE     s:9155

      508     9148    4              THEN DO;

      509     9149        /*   If TRTN from GET XCON and M$SAVE had ALTRET specified, bump IC  */
      510     9150    4                   IF STK$->B$SCON.SUBC.ALTBIT = '1'B

   9150  1 000567   000100 236100                    LDQ     64,,PR0
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:105  
         1 000570   000400 316003                    CANQ    256,DU
         1 000571   000576 600000 1                  TZE     s:9152

      511     9151    4                   THEN B$SS.IC = B$SS.IC+1;

   9151  1 000572   000000 471400 xsym               LDP1    B_MPT
         1 000573   100004 221100                    LDX1    4,,PR1
         1 000574   000001 622011                    EAX2    1,X1
         1 000575   100004 742100                    STX2    4,,PR1

      512     9152    4                   B_MPT.ECCB$->B$ECCB.XCONF.GET='0'B;

   9152  1 000576   000005 471400 xsym               LDP1    B_MPT+5
         1 000577   000010 236000 2                  LDQ     8
         1 000600   100004 356100                    ANSQ    4,,PR1

      513     9153    4                   GOTO NOT_SAVLDT;

   9153  1 000601   000640 710000 1                  TRA     NOT_SAVLDT

      514     9154    4                   END;
      515     9155    3              IF B$SS.ISR.WSR=%USERWSR

   9155  1 000602   000000 471400 xsym               LDP1    B_MPT
         1 000603   100010 236100                    LDQ     8,,PR1
         1 000604   000160 376007                    ANQ     112,DL
         1 000605   000160 116007                    CMPQ    112,DL
         1 000606   000640 601000 1                  TNZ     NOT_SAVLDT

      516     9156    4              THEN DO;

      517     9157    4                   IF (TEMPF & %SVL_ECCB#)

   9157  1 000607   200016 236100                    LDQ     TEMPF,,AUTO
         1 000610   777000 376003                    ANQ     -512,DU
         1 000611   016000 376003                    ANQ     7168,DU
         1 000612   000640 600000 1                  TZE     NOT_SAVLDT
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:106  

      518     9158    5                   THEN DO;

      519     9159    5                        IF (B_MPT.ECCBDESC$->B$$DESCR.FLGS & %DSXXX)

   9159  1 000613   000013 473400 xsym               LDP3    B_MPT+11
         1 000614   300000 236100                    LDQ     0,,PR3
         1 000615   000024 736000                    QLS     20
         1 000616   777000 376003                    ANQ     -512,DU
         1 000617   020000 376003                    ANQ     8192,DU
         1 000620   000624 600000 1                  TZE     s:9164

      520     9160    6                        THEN DO;

      521     9161    6                             ECP.SVL = %SVL_TRTN#;

   9161  1 000621   040000 236003                    LDQ     16384,DU
         1 000622   200021 552140                    STBQ    ECP,'40'O,AUTO

      522     9162    6                             GOTO DELTA_EXCRTN;

   9162  1 000623   000661 710000 1                  TRA     DELTA_EXCRTN

      523     9163    6                             END;
      524     9164    5                        B$JIT.SVLDTF=(B$JIT.SVLDTF | %SVL_TRTN#);

   9164  1 000624   000000 474400 xsym               LDP4    B$JIT$
         1 000625   400316 236100                    LDQ     206,,PR4
         1 000626   000033 736000                    QLS     27
         1 000627   040000 276003                    ORQ     16384,DU
         1 000630   000033 772000                    QRL     27
         1 000631   400316 552104                    STBQ    206,'04'O,PR4

      525     9165    5                        CALL UDB$CALCOMP;

   9165  1 000632   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000633   000000 701000 xent               TSX1    UDB$CALCOMP
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:107  
         1 000634   000000 011000                    NOP     0

      526     9166    5                        CALL JSE$ABORTX;

   9166  1 000635   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000636   000000 701000 xent               TSX1    JSE$ABORTX
         1 000637   000000 011000                    NOP     0

      527     9167                                                /* XCON IN PROG STILL SET             */
      528     9168    5                        END;               /*DO IF SAVE-LDTRC*/

      529     9169    4                   END;                    /*DO IF %USERWSR                      */

   9164  1 000640                       NOT_SAVLDT   null
      530     9170    3   NOT_SAVLDT: ;
      531     9171    3              IF CSTK$->B$XCON.ECCB.PROG='0'B

   9171  1 000640   200007 470500                    LDP0    CSTK$,,AUTO
         1 000641   000101 236100                    LDQ     65,,PR0
         1 000642   000400 316007                    CANQ    256,DL
         1 000643   000647 601000 1                  TNZ     s:9174

      532     9172    3              THEN B_MPT.ECCB$->B$ECCB.XCONF.PROG='0'B;

   9172  1 000644   000005 471400 xsym               LDP1    B_MPT+5
         1 000645   000002 236000 2                  LDQ     2
         1 000646   100004 356100                    ANSQ    4,,PR1

      533     9173    3              END;                         /* DO IF XCON                         */

      534     9174    2         B$SS.ALT='0'B;

   9174  1 000647   000000 470400 xsym               LDP0    B_MPT
         1 000650   000031 236000 xsym               LDQ     B_VECTNIL+25
         1 000651   000001 356100                    ANSQ    1,,PR0

      535     9175    2         B$JIT.ERR = STK$->B$EXCFR.ERR;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:108  

   9175  1 000652   200010 471500                    LDP1    STK$,,AUTO
         1 000653   100102 236100                    LDQ     66,,PR1
         1 000654   000000 473400 xsym               LDP3    B$JIT$
         1 000655   300012 756100                    STQ     10,,PR3

      536     9176    2         CALL CLEARONE;

   9176  1 000656   003005 701000 1                  TSX1    CLEARONE
         1 000657   000000 011000                    NOP     0

      537     9177    2         GOTO DELTA_EXCRTN;

   9177  1 000660   000661 710000 1                  TRA     DELTA_EXCRTN

   9175  1 000661                       DELTA_EXCRTN null
      538     9178
      539     9179        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:109  
      540     9180
      541     9181         /*I*  NAME:         DELTA_EXCRTN
      542     9182
      543     9183               PURPOSE:      To cause DELTA to be entered following a
      544     9184                             user Exceptional Condition return PMME:
      545     9185
      546     9186                                M$MERC - M$MERCS
      547     9187                                M$RETRY - M$RETRYS
      548     9188                                M$TRTN
      549     9189
      550     9190               CALL:         GOTO DELTA_EXCRTN;
      551     9191
      552     9192               DATA:         ECP.ECCS (in AUTO) is to contain the sub-code
      553     9193                             indicating the type of PMME.
      554     9194
      555     9195               DESCRIPTION:  If the user is not running under DELTA, or if
      556     9196                             the PMME was not for the user domain, the exit
      557     9197                             to the user is via UDB$AUTO.
      558     9198
      559     9199                             When the user is running under DELTA, the remainder
      560     9200                             of the parameters in the EXCRTN frame for DELTA
      561     9201                             are initialized and the exit to the user is
      562     9202                             via SSU$DELTAGO.
      563     9203
      564     9204         */
      565     9205
      566     9206    2   DELTA_EXCRTN: ;
      567     9207    2         CALL UDB$CALCOMP;

   9207  1 000661   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000662   000000 701000 xent               TSX1    UDB$CALCOMP
         1 000663   000000 011000                    NOP     0

      568     9208    2         ECC=%ECC_EXCRTN#;

   9208  1 000664   000140 235007                    LDA     96,DL
         1 000665   200025 755100                    STA     ECC,,AUTO
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:110  

      569     9209    2         IF (B_MPT.ECCBDESC$->B$$DESCR.FLGS & %DSXXX)

   9209  1 000666   000013 470400 xsym               LDP0    B_MPT+11
         1 000667   000000 236100                    LDQ     0,,PR0
         1 000670   000024 736000                    QLS     20
         1 000671   777000 376003                    ANQ     -512,DU
         1 000672   020000 376003                    ANQ     8192,DU
         1 000673   000716 600000 1                  TZE     s:9218

      570     9210    3         THEN DO;

      571     9211    3              ECP.TYP=0;

   9211  1 000674   000000 236003                    LDQ     0,DU
         1 000675   200021 552120                    STBQ    ECP,'20'O,AUTO

      572     9212    3              ECP.EVID=SS_RTN_IC-2;        /* Addr of MERC, RETRY, or TRTN PMME  */

   9212  1 000676   200026 235100                    LDA     SS_RTN_IC,,AUTO
         1 000677   000022 771000                    ARL     18
         1 000700   000002 135007                    SBLA    2,DL
         1 000701   200022 755100                    STA     ECP+1,,AUTO

      573     9213    3              ECP.ERR=B$JIT.ERR;

   9213  1 000702   000000 471400 xsym               LDP1    B$JIT$
         1 000703   100012 236100                    LDQ     10,,PR1
         1 000704   200023 756100                    STQ     ECP+2,,AUTO

      574     9214    3              ECP.P#=0;

   9214  1 000705   200024 450100                    STZ     ECP+3,,AUTO

      575     9215                                                /*                                    */
      576     9216    3              CALL SSU$DELTAGO (ECC,ECP);

PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:111  
   9216  1 000706   200021 633500                    EPPR3   ECP,,AUTO
         1 000707   200063 453500                    STP3    CHFRSZ+4,,AUTO
         1 000710   200025 634500                    EPPR4   ECC,,AUTO
         1 000711   200062 454500                    STP4    CHFRSZ+3,,AUTO
         1 000712   200062 630500                    EPPR0   CHFRSZ+3,,AUTO
         1 000713   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000714   000000 701000 xent               TSX1    SSU$DELTAGO
         1 000715   000000 011000                    NOP     0

      577     9217    3              END;

      578     9218    2         CALL UDB$AUTO;

   9218  1 000716   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000717   000000 701000 xent               TSX1    UDB$AUTO
         1 000720   000000 011000                    NOP     0
         1 000721   002534 710000 1                  TRA     s:9821

      579     9219        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:112  
      580     9220                                           /****************************************/
      581     9221                                                /*              M$CLRSTK              */
      582     9222                                           /****************************************/
      583     9223    2       CASE(%C$CLRSTK#);

      584     9224    2         IF B_MPT.PSDESC$->B$$DESCR.BOUND = 0

   9224  1 000722   000011 474400 xsym               LDP4    B_MPT+9
         1 000723   400000 236100                    LDQ     0,,PR4
         1 000724   000034 316000 xsym               CANQ    B_VECTNIL+28
         1 000725   000731 601000 1                  TNZ     s:9226

      585     9225    2         THEN I=1;

   9225  1 000726   000001 235007                    LDA     1,DL
         1 000727   200014 755100                    STA     I,,AUTO
         1 000730   000734 710000 1                  TRA     s:9227

      586     9226    2         ELSE I = B$PS0$->FPTFR#;

   9226  1 000731   000000 475400 xsym               LDP5    B$PS0$
         1 000732   500000 235100                    LDA     0,,PR5
         1 000733   200014 755100                    STA     I,,AUTO

      587     9227    3         DO WHILE (I>0);

   9227  1 000734   001012 600000 1                  TZE     CLRDONE

      588     9228    3              IF CSTK$->B$EXCFR.ECC = %ECC_XCON#

   9228  1 000735   200007 470500                    LDP0    CSTK$,,AUTO
         1 000736   000000 720100                    LXL0    0,,PR0
         1 000737   000003 100003                    CMPX0   3,DU
         1 000740   001004 601000 1                  TNZ     s:9244

      589     9229    4              THEN DO;

PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:113  
      590     9230    4                   TEMPF = CSTK$->B$XCON.CECCB;

   9230  1 000741   000100 236100                    LDQ     64,,PR0
         1 000742   777000 376003                    ANQ     -512,DU
         1 000743   200016 756100                    STQ     TEMPF,,AUTO

      591     9231
      592     9232    4                   IF (TEMPF & %SVL_GET#)

   9232  1 000744   200016 236100                    LDQ     TEMPF,,AUTO
         1 000745   777000 376003                    ANQ     -512,DU
         1 000746   001000 376003                    ANQ     512,DU
         1 000747   000753 600000 1                  TZE     s:9235

      593     9233    4                   THEN B_MPT.ECCB$->B$ECCB.XCONF.GET='0'B;

   9233  1 000750   000005 471400 xsym               LDP1    B_MPT+5
         1 000751   000010 236000 2                  LDQ     8
         1 000752   100004 356100                    ANSQ    4,,PR1

      594     9234
      595     9235    4                   IF (TEMPF & %SVL_ECCB#)

   9235  1 000753   200016 236100                    LDQ     TEMPF,,AUTO
         1 000754   777000 376003                    ANQ     -512,DU
         1 000755   016000 376003                    ANQ     7168,DU
         1 000756   000776 600000 1                  TZE     s:9239
         1 000757   000000 471400 xsym               LDP1    B_MPT
         1 000760   100010 236100                    LDQ     8,,PR1
         1 000761   000160 376007                    ANQ     112,DL
         1 000762   000160 116007                    CMPQ    112,DL
         1 000763   000776 601000 1                  TNZ     s:9239

      596     9236    4                     AND (B$SS.ISR.WSR = %USERWSR)
      597     9237    4                   THEN B$JIT.SVLDTF=(B$JIT.SVLDTF &~ TEMPF);

   9237  1 000764   200016 236100                    LDQ     TEMPF,,AUTO
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:114  
         1 000765   777000 376003                    ANQ     -512,DU
         1 000766   777000 676003                    ERQ     -512,DU
         1 000767   200062 756100                    STQ     CHFRSZ+3,,AUTO
         1 000770   000000 473400 xsym               LDP3    B$JIT$
         1 000771   300316 236100                    LDQ     206,,PR3
         1 000772   000033 736000                    QLS     27
         1 000773   200062 376100                    ANQ     CHFRSZ+3,,AUTO
         1 000774   000033 772000                    QRL     27
         1 000775   300316 552104                    STBQ    206,'04'O,PR3

      598     9238
      599     9239    4                   IF CSTK$->B$XCON.ECCB.PROG='0'B

   9239  1 000776   000101 236100                    LDQ     65,,PR0
         1 000777   000400 316007                    CANQ    256,DL
         1 001000   001004 601000 1                  TNZ     s:9244

      600     9240    4                   THEN B_MPT.ECCB$->B$ECCB.XCONF.PROG='0'B;

   9240  1 001001   000005 471400 xsym               LDP1    B_MPT+5
         1 001002   000002 236000 2                  LDQ     2
         1 001003   100004 356100                    ANSQ    4,,PR1

      601     9241                                 /* Removing the last XCON frame resets In Progress   */
      602     9242
      603     9243    4                   END;                    /*DO IF CLEARING AN XCON FRAME        */

      604     9244    3              CALL CLEARONE ALTRET(CLRDONE);

   9244  1 001004   003005 701000 1                  TSX1    CLEARONE
         1 001005   001012 702000 1                  TSX2    CLRDONE

      605     9245    3              I = I-1;

   9245  1 001006   200014 235100                    LDA     I,,AUTO
         1 001007   000001 135007                    SBLA    1,DL
         1 001010   200014 755100                    STA     I,,AUTO
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:115  

      606     9246    3              END;

   9246  1 001011   000735 601000 1                  TNZ     s:9228

      607     9247    2   CLRDONE: RETURN;

   9247  1 001012   000000 702200 xent  CLRDONE      TSX2  ! X66_ARET

      608     9248        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:116  
      609     9249                                           /****************************************/
      610     9250                                                /*              M$MERCS               */
      611     9251                                           /****************************************/
      612     9252    2       CASE(%C$MERCS#);

      613     9253    2         ECP.ECCS=%SC_MERCS#;

   9253  1 001013   000003 221003                    LDX1    3,DU
         1 001014   200021 441100                    SXL1    ECP,,AUTO

   9253  1 001015                       MERCS        null
      614     9254    2   MERCS: ;
      615     9255    2         IF CSTK$->B$EXCFR.ECC = %ECC_XCON#

   9255  1 001015   200007 474500                    LDP4    CSTK$,,AUTO
         1 001016   400000 722100                    LXL2    0,,PR4
         1 001017   000003 102003                    CMPX2   3,DU
         1 001020   001047 601000 1                  TNZ     s:9268

      616     9256    3         THEN DO;

      617     9257    3              CALL DO_MERC;

   9257  1 001021   003360 701000 1                  TSX1    DO_MERC
         1 001022   000000 011000                    NOP     0

      618     9258    3              B$JIT.RNST = CSTK$->B$XCON.RNST;

   9258  1 001023   000000 470400 xsym               LDP0    B$JIT$
         1 001024   200007 471500                    LDP1    CSTK$,,AUTO
         1 001025   100101 236100                    LDQ     65,,PR1
         1 001026   000314 552140                    STBQ    204,'40'O,PR0

      619     9259                                           /* Re-establish RNST for rundown check     */
      620     9260    3              IF (B_MPT.ECCB$->B$ECCB.XCONF.PROG)

   9260  1 001027   000005 473400 xsym               LDP3    B_MPT+5
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:117  
         1 001030   300004 236100                    LDQ     4,,PR3
         1 001031   000400 316003                    CANQ    256,DU
         1 001032   001035 600000 1                  TZE     s:9264

      621     9261                                      /* If the user hasn't reset the XCON address    */
      622     9262    3              THEN B_MPT.ECCB$->B$ECCB.FLAGS.XCONSET='0'B;

   9262  1 001033   000011 236000 2                  LDQ     9
         1 001034   300004 356100                    ANSQ    4,,PR3

      623     9263                            /* Then prevent re-entry to this exit control address     */
      624     9264    3              CALL UDB$CALCOMP;

   9264  1 001035   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 001036   000000 701000 xent               TSX1    UDB$CALCOMP
         1 001037   000000 011000                    NOP     0

      625     9265    3              B$JIT.JUNK = B$JIT.JUNK | %JJ_SCCSET#;

   9265  1 001040   000000 470400 xsym               LDP0    B$JIT$
         1 001041   000315 220100                    LDX0    205,,PR0
         1 001042   000040 260003                    ORX0    32,DU
         1 001043   000315 740100                    STX0    205,,PR0

      626     9266    3              CALL JSE$ABORTY;

   9266  1 001044   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 001045   000000 701000 xent               TSX1    JSE$ABORTY
         1 001046   000000 011000                    NOP     0

      627     9267    3              END;                         /* DO IF ECC=XCON*/

      628     9268    2         CALL CLEARONE;

   9268  1 001047   003005 701000 1                  TSX1    CLEARONE
         1 001050   000000 011000                    NOP     0

PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:118  
      629     9269    2         CALL DO_MERC ALTRET(ABORTM_GO);

   9269  1 001051   003360 701000 1                  TSX1    DO_MERC
         1 001052   002536 702000 1                  TSX2    ABORTM_GO

      630     9270    2         GOTO DELTA_EXCRTN;

   9270  1 001053   000661 710000 1                  TRA     DELTA_EXCRTN

      631     9271        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:119  
      632     9272                                           /****************************************/
      633     9273                                                /*              M$RETRYS              */
      634     9274                                           /****************************************/
      635     9275    2       CASE(%C$RETRYS#);

      636     9276    2         ECP.ECCS=%SC_RETRYS#;

   9276  1 001054   000005 221003                    LDX1    5,DU
         1 001055   200021 441100                    SXL1    ECP,,AUTO

      637     9277    2         IF (STK$->B$EXCFR.ECC=99) OR (STK$->B$EXCFR.ECC=%ECC_PMME#)

   9277  1 001056   200010 474500                    LDP4    STK$,,AUTO
         1 001057   400000 722100                    LXL2    0,,PR4
         1 001060   000143 102003                    CMPX2   99,DU
         1 001061   001064 600000 1                  TZE     s:9279
         1 001062   000004 102003                    CMPX2   4,DU
         1 001063   001071 601000 1                  TNZ     s:9283

      638     9278    3         THEN DO;

      639     9279    3              CALL DO_RETRY ALTRET(ERR_EXIT);

   9279  1 001064   003502 701000 1                  TSX1    DO_RETRY
         1 001065   002535 702000 1                  TSX2    ERR_EXIT

      640     9280    3              CALL CLEARONE;

   9280  1 001066   003005 701000 1                  TSX1    CLEARONE
         1 001067   000000 011000                    NOP     0

      641     9281    3              GOTO DELTA_EXCRTN;

   9281  1 001070   000661 710000 1                  TRA     DELTA_EXCRTN

      642     9282    3              END;
      643     9283    2         B$JIT.ERR=ENOTPMME;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:120  

   9283  1 001071   000024 236000 0                  LDQ     ENOTPMME
         1 001072   000000 475400 xsym               LDP5    B$JIT$
         1 001073   500012 756100                    STQ     10,,PR5

      644     9284    2         RETURN;

   9284  1 001074   000000 702200 xent               TSX2  ! X66_ARET

      645     9285        /*E*     ERROR:  UEP-E$NOTPMME-E
      646     9286           MESSAGE: Top TCB Stack frame does not contain a Service Request environment.
      647     9287        */
      648     9288        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:121  
      649     9289                                           /****************************************/
      650     9290                                                /*              M$RENV                */
      651     9291                                           /****************************************/
      652     9292    2       CASE(%C$RENV#);

      653     9293    2         IF CSTK$->B$EXCFR.ECC ~= 99

   9293  1 001075   200007 474500                    LDP4    CSTK$,,AUTO
         1 001076   400000 721100                    LXL1    0,,PR4
         1 001077   000143 101003                    CMPX1   99,DU
         1 001100   001105 600000 1                  TZE     s:9298

      654     9294    3         THEN DO;

      655     9295    3              B$JIT.ERR=ENOTPMME;

   9295  1 001101   000024 236000 0                  LDQ     ENOTPMME
         1 001102   000000 475400 xsym               LDP5    B$JIT$
         1 001103   500012 756100                    STQ     10,,PR5

      656     9296    3              RETURN;

   9296  1 001104   000000 702200 xent               TSX2  ! X66_ARET

      657     9297    3              END;
      658     9298    2         FRMSZ = 68;

   9298  1 001105   000104 236007                    LDQ     68,DL
         1 001106   200013 756100                    STQ     FRMSZ,,AUTO

      659     9299    2         TO$ = ALT$;

   9299  1 001107   200006 236100                    LDQ     ALT$,,AUTO
         1 001110   200011 756100                    STQ     TO$,,AUTO

      660     9300    2         FROM$ = CSTK$;

PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:122  
   9300  1 001111   200007 236100                    LDQ     CSTK$,,AUTO
         1 001112   200012 756100                    STQ     FROM$,,AUTO

      661     9301    2         CALL UEP$TCBTCB;

   9301  1 001113   002711 701000 1                  TSX1    UEP$TCBTCB
         1 001114   000000 011000                    NOP     0

      662     9302    2         CALL CLEARONE;

   9302  1 001115   003005 701000 1                  TSX1    CLEARONE
         1 001116   000000 011000                    NOP     0

      663     9303    2         ALT$->B$EXCFR.PREVSZ=0;

   9303  1 001117   000000 220003                    LDX0    0,DU
         1 001120   200006 470500                    LDP0    ALT$,,AUTO
         1 001121   000000 740100                    STX0    0,,PR0
         1 001122   002534 710000 1                  TRA     s:9821

      664     9304        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:123  
      665     9305                                           /****************************************/
      666     9306                                                /*              M$DRTN                */
      667     9307                                           /****************************************/
      668     9308         /*D* NAME: M$DRTN.
      669     9309         */
      670     9310    2       CASE(%C$DRTN#);

      671     9311
      672     9312
      673     9313    2         IF CSTK$->B$SSX.ISR.WSR = %DBWSR AND NOT B$PS2$ -> FPTV.QUIT

   9313  1 001123   200007 474500                    LDP4    CSTK$,,AUTO
         1 001124   400010 236100                    LDQ     8,,PR4
         1 001125   000160 376007                    ANQ     112,DL
         1 001126   000120 116007                    CMPQ    80,DL
         1 001127   001140 601000 1                  TNZ     s:9329
         1 001130   000000 475400 xsym               LDP5    B$PS2$
         1 001131   500001 236100                    LDQ     1,,PR5
         1 001132   100000 316003                    CANQ    32768,DU
         1 001133   001140 601000 1                  TNZ     s:9329

      674     9314    3         THEN DO;

      675     9315    3              B$JIT.ERR=EDRTN;

   9315  1 001134   000026 236000 0                  LDQ     EDRTN
         1 001135   000000 476400 xsym               LDP6    B$JIT$
         1 001136   600012 756100                    STQ     10,,PR6

      676     9316    3              RETURN;

   9316  1 001137   000000 702200 xent               TSX2  ! X66_ARET

      677     9317    3              END;
      678     9318        /*E*     ERROR:  UEP-E$DRTN-E
      679     9319                 MESSAGE: M$DRTN from Debugger when top TCB frame is the Debugger's.
      680     9320                 DESCRIPTION: This error is returned only to an interactive
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:124  
      681     9321                              Debugger.  The user should never see this message.
      682     9322        */
      683     9323
      684     9324        /*D* An M$DRTN request with SPCLD set is simply a request to
      685     9325             reset the Debugger's Special Access Descriptors and return
      686     9326             to the Debugger.
      687     9327        */
      688     9328
      689     9329    2         IF B$PS2$->FPTV.SPCLD

   9329  1 001140   000000 475400 xsym               LDP5    B$PS2$
         1 001141   500001 236100                    LDQ     1,,PR5
         1 001142   000200 316003                    CANQ    128,DU
         1 001143   001206 600000 1                  TZE     s:9344

      690     9330    3         THEN DO;

      691     9331    4              DO WHILE (B$SS.ISR.WSR ~= CSTK$->B$SSX.ISR.WSR);

   9331  1 001144   100010 236100                    LDQ     8,,PR1
         1 001145   400010 676100                    ERQ     8,,PR4
         1 001146   000160 376007                    ANQ     112,DL
         1 001147   001161 600000 1                  TZE     s:9334

      692     9332    4                   CALL JSS$BACKSS;

   9332  1 001150   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 001151   000000 701000 xent               TSX1    JSS$BACKSS
         1 001152   000000 011000                    NOP     0

      693     9333    4                   END;

   9333  1 001153   200007 470500                    LDP0    CSTK$,,AUTO
         1 001154   000000 471400 xsym               LDP1    B_MPT
         1 001155   100010 236100                    LDQ     8,,PR1
         1 001156   000010 676100                    ERQ     8,,PR0
         1 001157   000160 376007                    ANQ     112,DL
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:125  
         1 001160   001150 601000 1                  TNZ     s:9332

      694     9334    3              B$ULS.SPCL1=B_MPT.SSDESC$->B$$DESCR;

   9334  1 001161   000006 470400 xsym               LDP0    B_MPT+6
         1 001162   000001 473400 xsym               LDP3    B_MPT+1
         1 001163   000100 100500                    MLR     fill='000'O
         1 001164   000000 000010                    ADSC9   0,,PR0                   cn=0,n=8
         1 001165   300042 000010                    ADSC9   34,,PR3                  cn=0,n=8

      695     9335    3              B$ULS.SPCL1.TYP=1;

   9335  1 001166   300042 236100                    LDQ     34,,PR3
         1 001167   000012 376000 2                  ANQ     10
         1 001170   000001 276007                    ORQ     1,DL
         1 001171   300042 756100                    STQ     34,,PR3

      696     9336    3              B$ULS.SPCL2=B$SS.LSR;

   9336  1 001172   100014 237100                    LDAQ    12,,PR1
         1 001173   300044 757100                    STAQ    36,,PR3

      697     9337    3              B$ULS.SPCL3=B$SS.ASR;

   9337  1 001174   100012 237100                    LDAQ    10,,PR1
         1 001175   300046 757100                    STAQ    38,,PR3

      698     9338    3              B$ULS.SPCL4=B$SS.PSR;

   9338  1 001176   100016 237100                    LDAQ    14,,PR1
         1 001177   300050 757100                    STAQ    40,,PR3

      699     9339    3              B$ULS.SPCL5=B$SS.ISR;

   9339  1 001200   100010 237100                    LDAQ    8,,PR1
         1 001201   300054 757100                    STAQ    44,,PR3

PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:126  
      700     9340    3              CALL UDN$MAGIC;

   9340  1 001202   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 001203   000000 701000 xent               TSX1    UDN$MAGIC
         1 001204   000000 011000                    NOP     0

      701     9341    3              RETURN;

   9341  1 001205   000000 702200 xent               TSX2  ! X66_ARET

      702     9342    3              END;
      703     9343
      704     9344    2         CALL CHECK_FPT ALTRET(ERR_EXIT);

   9344  1 001206   003047 701000 1                  TSX1    CHECK_FPT
         1 001207   002535 702000 1                  TSX2    ERR_EXIT

      705     9345                                                /* CHECK_FPT will set E$BADPTR if bad */
      706     9346
      707     9347        /*D* An M$DRTN request with MRGSS set is a request to update the
      708     9348             user's Safe-Store frame and the copy of it in the Debugger's
      709     9349             TCB with the data specified via the REGS and DRS parameters.
      710     9350             Control then returns to the debugger.
      711     9351        */
      712     9352
      713     9353    2         AUTO_DRTNV=B$PS2$->FPTV;

   9353  1 001210   000000 470400 xsym               LDP0    B$PS2$
         1 001211   000100 100500                    MLR     fill='000'O
         1 001212   000000 000020                    ADSC9   0,,PR0                   cn=0,n=16
         1 001213   200050 000020                    ADSC9   AUTO_DRTNV,,AUTO         cn=0,n=16

      714     9354    2         IF AUTO_DRTNV.MRGSS

   9354  1 001214   200051 236100                    LDQ     AUTO_DRTNV+1,,AUTO
         1 001215   000400 316003                    CANQ    256,DU
         1 001216   001225 600000 1                  TZE     s:9379
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:127  

      715     9355    3         THEN DO;

      716     9356    3              CALL MERGE_DFPT;

   9356  1 001217   003126 701000 1                  TSX1    MERGE_DFPT
         1 001220   000000 011000                    NOP     0

      717     9357    3              CALL UDN$MAGIC;

   9357  1 001221   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 001222   000000 701000 xent               TSX1    UDN$MAGIC
         1 001223   000000 011000                    NOP     0

      718     9358    3              RETURN;

   9358  1 001224   000000 702200 xent               TSX2  ! X66_ARET

      719     9359    3              END;
      720     9360
      721     9361        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:128  
      722     9362        /*D* An M$DRTN request with WAKE_FD set is a request to get in sync
      723     9363             with the debugger on the FEP that is associated with the FPRG
      724     9364             specified in the DRTN.FPRG_DCB field.  A message is sent to the
      725     9365             the FEP to wakeup the FD debugger.  If the FPRG_FID option is also
      726     9366             specified, the fid for the current FPRG associated with the FPRG_DCB
      727     9367             is read from the host and returned in FPRG_FID.  Control then
      728     9368             returns to the host debugger.
      729     9369
      730     9370             If the ALIB_FD bit is set, the FD has never been associated
      731     9371             with the specified FPRG, so a message is written to the
      732     9372             FEP requesting association of the the debugger.  If the debugger
      733     9373             is not already known to the LCP-6 system, as indicated by a
      734     9374             response of GJ_DB_DATA, the KIF$SEND_FD routine is called to
      735     9375             ship the debugger up to the front end.  In any case, the front
      736     9376             end will eventually send us an ACK or NAK response which will
      737     9377             cause us to return control to the debugger.
      738     9378        */
      739     9379    2         IF (B$PS2$->FPTV.ALIB_FD) OR (B$PS2$->FPTV.WAKE_FD)

   9379  1 001225   000001 236100                    LDQ     1,,PR0
         1 001226   000040 316003                    CANQ    32,DU
         1 001227   001232 601000 1                  TNZ     s:9381
         1 001230   000020 316003                    CANQ    16,DU
         1 001231   001550 600000 1                  TZE     s:9499

      740     9380    3         THEN DO;

      741     9381    3              LCP6_MSG='0'B;

   9381  1 001232   000100 100400                    MLR     fill='000'O
         1 001233   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         1 001234   200030 000100                    ADSC9   LCP6_MSG,,AUTO           cn=0,n=64

      742     9382    3              LCP6_MSG.FCN = %GJ_WAKEDB#;

   9382  1 001235   021000 236003                    LDQ     8704,DU
         1 001236   200030 552140                    STBQ    LCP6_MSG,'40'O,AUTO
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:129  

      743     9383
      744     9384    3              IF (B$PS2$->FPTV.WAKE_FD)

   9384  1 001237   000001 236100                    LDQ     1,,PR0
         1 001240   000020 316003                    CANQ    16,DU
         1 001241   001250 600000 1                  TZE     NO_FID

      745     9385    4              THEN DO;

      746     9386    4                   CALL HFF$NILERASE(4) ALTRET(NO_FID);

   9386  1 001242   000013 630400 2                  EPPR0   11
         1 001243   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001244   000000 701000 xent               TSX1    HFF$NILERASE
         1 001245   001250 702000 1                  TSX2    NO_FID

      747     9387    4                   LCP6_MSG.FCN = %GJ_RTNFID#;

   9387  1 001246   023000 236003                    LDQ     9728,DU
         1 001247   200030 552140                    STBQ    LCP6_MSG,'40'O,AUTO

   9387  1 001250                       NO_FID       null
      748     9388    4   NO_FID:         ;
      749     9389    4                   END;

      750     9390
      751     9391    3              IF B$PS2$->FPTV.FPRG_DCB <= B$ROSEG.NUMDCBS

   9391  1 001250   000000 470400 xsym               LDP0    B$PS2$
         1 001251   000002 720100                    LXL0    2,,PR0
         1 001252   000000 471400 xsym               LDP1    B$ROSEG$
         1 001253   100002 100100                    CMPX0   2,,PR1
         1 001254   001256 600000 1                  TZE     s:9393
         1 001255   001305 603000 1                  TRC     DRTN_BADDCB

      752     9392    4              THEN DO;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:130  

      753     9393    4                   TO$ = DCBADDR(B$PS2$->FPTV.FPRG_DCB);

   9393  1 001256   000001 473400 2                  LDP3    1
         1 001257   300000 474500                    LDP4    0,,PR3
         1 001260   400000 236110                    LDQ     0,X0,PR4
         1 001261   200011 756100                    STQ     TO$,,AUTO

      754     9394    4                   IF TO$ ~= ADDR(NIL)

   9394  1 001262   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001263   001305 600000 1                  TZE     DRTN_BADDCB

      755     9395    5                   THEN DO;

      756     9396    5                        IF TO$->F$DCB.ORG=%DBGDCB# OR TO$->F$DCB.ORG=%DBGCG#

   9396  1 001264   200011 475500                    LDP5    TO$,,AUTO
         1 001265   500032 236100                    LDQ     26,,PR5
         1 001266   777000 376003                    ANQ     -512,DU
         1 001267   024000 116003                    CMPQ    10240,DU
         1 001270   001275 600000 1                  TZE     s:9398
         1 001271   025000 116003                    CMPQ    10752,DU
         1 001272   001275 600000 1                  TZE     s:9398
         1 001273   026000 116003                    CMPQ    11264,DU
         1 001274   001305 601000 1                  TNZ     DRTN_BADDCB

      757     9397    5                          OR TO$->F$DCB.ORG=%DBGSYSID#
      758     9398    5                        THEN TO$ = NK$LDCT$(TO$->F$DCB.LDCTX);

   9398  1 001275   500051 221100                    LDX1    41,,PR5
         1 001276   000000 476400 xsym               LDP6    N$DCT$$
         1 001277   600000 236111                    LDQ     0,X1,PR6
         1 001300   200011 756100                    STQ     TO$,,AUTO
         1 001301   001302 710000 1                  TRA     s:9400

      759     9399    5                        ELSE GOTO DRTN_BADDCB;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:131  
      760     9400    5                        IF TO$ = ADDR(NIL) THEN GOTO DRTN_BADDCB;

   9400  1 001302   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001303   001305 600000 1                  TZE     DRTN_BADDCB

      761     9401    5                        END;

   9401  1 001304   001311 710000 1                  TRA     s:9414

      762     9402    4                   ELSE GOTO DRTN_BADDCB;
      763     9403    4                   END/* do if dcb# <= numdcbs*/;
      764     9404
      765     9405    4              ELSE DO;

   9400  1 001305                       DRTN_BADDCB  null
      766     9406    4   DRTN_BADDCB:    ;
      767     9407    4                   B$JIT.ERR = EBADDCB;

   9407  1 001305   000034 236000 0                  LDQ     EBADDCB
         1 001306   000000 473400 xsym               LDP3    B$JIT$
         1 001307   300012 756100                    STQ     10,,PR3

      768     9408    4                   RETURN;

   9408  1 001310   000000 702200 xent               TSX2  ! X66_ARET

      769     9409    4                   END/* do if dcb# > numdcbs*/;
      770     9410        /*E*   ERROR: UEP-E$BADDCB#-E
      771     9411               MESSAGE: The FPRG DCB# in the M$DRTN FPT is bad.
      772     9412        */
      773     9413
      774     9414    3              IF B$PS2$->FPTV.WAKE_FD

   9414  1 001311   000001 236100                    LDQ     1,,PR0
         1 001312   000020 316003                    CANQ    16,DU
         1 001313   001335 600000 1                  TZE     s:9426

PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:132  
      775     9415    4              THEN DO;

      776     9416    4                   CALL KIF$WRITE_IMD(TO$->TIM,LCP6_MSG,LENGTHC(B$FCN_MSG))

   9416  1 001314   000014 236000 2                  LDQ     12
         1 001315   200064 756100                    STQ     CHFRSZ+5,,AUTO
         1 001316   200030 635500                    EPPR5   LCP6_MSG,,AUTO
         1 001317   200063 455500                    STP5    CHFRSZ+4,,AUTO
         1 001320   200011 236100                    LDQ     TO$,,AUTO
         1 001321   200062 756100                    STQ     CHFRSZ+3,,AUTO
         1 001322   200062 630500                    EPPR0   CHFRSZ+3,,AUTO
         1 001323   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001324   000000 701000 xent               TSX1    KIF$WRITE_IMD
         1 001325   001327 702000 1                  TSX2    s:9418
         1 001326   001330 710000 1                  TRA     s:9421

      777     9417    5                   WHENALTRETURN DO;

      778     9418    5                        RETURN /* JIT.ERR is set by KIF$WRITE_IMD*/;

   9418  1 001327   000000 702200 xent               TSX2  ! X66_ARET

      779     9419    5                        END;
      780     9420
      781     9421    4                   IF LCP6_MSG.FCN = %GJ_RTNFID#

   9421  1 001330   200030 236100                    LDQ     LCP6_MSG,,AUTO
         1 001331   777000 376003                    ANQ     -512,DU
         1 001332   023000 116003                    CMPQ    9728,DU
         1 001333   001407 600000 1                  TZE     READ_ACK

      782     9422    4                   THEN GOTO READ_ACK;
      783     9423    4                   ELSE RETURN;

   9423  1 001334   000000 702200 xent               TSX2  ! X66_ARET

      784     9424    4                   END;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:133  
      785     9425
      786     9426    3              LCP6_MSG.NAME = B$P$->B$P.NAME(S$CU$->B$U.DB);

   9426  1 001335   000000 475400 xsym               LDP5    S$CU$
         1 001336   500006 236100                    LDQ     6,,PR5
         1 001337   000011 772000                    QRL     9
         1 001340   000777 376007                    ANQ     511,DL
         1 001341   000021 402007                    MPY     17,DL
         1 001342   000003 736000                    QLS     3
         1 001343   000000 477400 xsym               LDP7    B$P$
         1 001344   000100 100506                    MLR     fill='000'O
         1 001345   700032 000040                    ADSC9   26,Q,PR7                 cn=0,n=32
         1 001346   200031 400040                    ADSC9   LCP6_MSG+1,,AUTO         cn=2,n=32

      787     9427    3              FROM$ = PINCRC(ADDR(LCP6_MSG.NAME),LCP6_MSG.NAME.L+1);

   9427  1 001347   200031 236100                    LDQ     LCP6_MSG+1,,AUTO
         1 001350   000011 772000                    QRL     9
         1 001351   000777 376007                    ANQ     511,DL
         1 001352   200062 452500                    STP2    CHFRSZ+3,,AUTO
         1 001353   000020 736000                    QLS     16
         1 001354   000015 036000 2                  ADLQ    13
         1 001355   200062 036100                    ADLQ    CHFRSZ+3,,AUTO
         1 001356   200012 756100                    STQ     FROM$,,AUTO

      788     9428    3              FROM$->B$2CHAR = '_F';

   9428  1 001357   200012 470500                    LDP0    FROM$,,AUTO
         1 001360   040100 100400                    MLR     fill='040'O
         1 001361   000041 000002 0                  ADSC9   EASLERR+1                cn=0,n=2
         1 001362   000000 000002                    ADSC9   0,,PR0                   cn=0,n=2

      789     9429
      790     9430    3              LCP6_MSG.NAME.L = LCP6_MSG.NAME.L+2;

   9430  1 001363   200031 236100                    LDQ     LCP6_MSG+1,,AUTO
         1 001364   002000 036007                    ADLQ    1024,DL
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:134  
         1 001365   200031 552110                    STBQ    LCP6_MSG+1,'10'O,AUTO

      791     9431    3              LCP6_MSG.FCN = %GJ_GETDB#;

   9431  1 001366   003000 236003                    LDQ     1536,DU
         1 001367   200030 552140                    STBQ    LCP6_MSG,'40'O,AUTO

      792     9432    3              LCP6_MSG.ERR='0'B;

   9432  1 001370   000100 100400                    MLR     fill='000'O
         1 001371   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         1 001372   200030 400004                    ADSC9   LCP6_MSG,,AUTO           cn=2,n=4

      793     9433
      794     9434    3              CALL KIF$WRITE(TO$->TIM,LCP6_MSG,LENGTHC(B$ALIB_MSG))

   9434  1 001373   000017 236000 2                  LDQ     15
         1 001374   200064 756100                    STQ     CHFRSZ+5,,AUTO
         1 001375   200030 635500                    EPPR5   LCP6_MSG,,AUTO
         1 001376   200063 455500                    STP5    CHFRSZ+4,,AUTO
         1 001377   200011 236100                    LDQ     TO$,,AUTO
         1 001400   200062 756100                    STQ     CHFRSZ+3,,AUTO
         1 001401   200062 630500                    EPPR0   CHFRSZ+3,,AUTO
         1 001402   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001403   000000 701000 xent               TSX1    KIF$WRITE
         1 001404   001406 702000 1                  TSX2    s:9436
         1 001405   001407 710000 1                  TRA     READ_ACK

      795     9435    4              WHENALTRETURN DO;

      796     9436    4                   RETURN /* JIT.ERR is set by KIF$WRITE*/;

   9436  1 001406   000000 702200 xent               TSX2  ! X66_ARET

   9432  1 001407                       READ_ACK     null
      797     9437    4                   END;
      798     9438
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:135  
      799     9439    3   READ_ACK:  ;
      800     9440    3              CALL KIF$READ(TO$->TIM,LCP6_MSG,LENGTHC(LCP6_MSG))

   9440  1 001407   000021 236000 2                  LDQ     17
         1 001410   200064 756100                    STQ     CHFRSZ+5,,AUTO
         1 001411   200030 630500                    EPPR0   LCP6_MSG,,AUTO
         1 001412   200063 450500                    STP0    CHFRSZ+4,,AUTO
         1 001413   200011 236100                    LDQ     TO$,,AUTO
         1 001414   200062 756100                    STQ     CHFRSZ+3,,AUTO
         1 001415   200062 630500                    EPPR0   CHFRSZ+3,,AUTO
         1 001416   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001417   000000 701000 xent               TSX1    KIF$READ
         1 001420   001422 702000 1                  TSX2    s:9442
         1 001421   001423 710000 1                  TRA     s:9445

      801     9441    4              WHENALTRETURN DO;

      802     9442    4                   RETURN;

   9442  1 001422   000000 702200 xent               TSX2  ! X66_ARET

      803     9443    4                   END;
      804     9444
      805     9445    4              DO CASE(LCP6_MSG.FCN);

   9445  1 001423   200030 236100                    LDQ     LCP6_MSG,,AUTO
         1 001424   000033 772000                    QRL     27
         1 001425   000014 136007                    SBLQ    12,DL
         1 001426   000022 116007                    CMPQ    18,DL
         1 001427   001431 602006 1                  TNC     s:9445+6,QL
         1 001430   001542 710000 1                  TRA     s:9469
         1 001431   001524 710000 1                  TRA     s:9462
         1 001432   001542 710000 1                  TRA     s:9469
         1 001433   001542 710000 1                  TRA     s:9469
         1 001434   001542 710000 1                  TRA     s:9469
         1 001435   001542 710000 1                  TRA     s:9469
         1 001436   001542 710000 1                  TRA     s:9469
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:136  
         1 001437   001542 710000 1                  TRA     s:9469
         1 001440   001542 710000 1                  TRA     s:9469
         1 001441   001542 710000 1                  TRA     s:9469
         1 001442   001542 710000 1                  TRA     s:9469
         1 001443   001542 710000 1                  TRA     s:9469
         1 001444   001542 710000 1                  TRA     s:9469
         1 001445   001542 710000 1                  TRA     s:9469
         1 001446   001542 710000 1                  TRA     s:9469
         1 001447   001542 710000 1                  TRA     s:9469
         1 001450   001542 710000 1                  TRA     s:9469
         1 001451   001453 710000 1                  TRA     s:9447
         1 001452   001510 710000 1                  TRA     s:9458

      806     9446    4               CASE(%GJ_ACK#);

      807     9447    4                 CALL HFF$NILERASE(4)

   9447  1 001453   000013 630400 2                  EPPR0   11
         1 001454   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001455   000000 701000 xent               TSX1    HFF$NILERASE
         1 001456   001507 702000 1                  TSX2    s:9455

      808     9448    5                 WHENRETURN DO;

      809     9449    5                      B$PS4$->VLR_FPRG_FID.NAME = LCP6_MSG.NAME;

   9449  1 001457   000000 470400 xsym               LDP0    B$PS4$
         1 001460   000100 100500                    MLR     fill='000'O
         1 001461   200031 400040                    ADSC9   LCP6_MSG+1,,AUTO         cn=2,n=32
         1 001462   000000 000040                    ADSC9   0,,PR0                   cn=0,n=32

      810     9450    5                      B$PS4$->VLR_FPRG_FID.ACCT = LCP6_MSG.ACCT;

   9450  1 001463   040100 100500                    MLR     fill='040'O
         1 001464   200041 400010                    ADSC9   LCP6_MSG+9,,AUTO         cn=2,n=8
         1 001465   000010 000010                    ADSC9   8,,PR0                   cn=0,n=8

PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:137  
      811     9451    5                      B$PS4$->VLR_FPRG_FID.PASS = LCP6_MSG.PASS;

   9451  1 001466   040100 100500                    MLR     fill='040'O
         1 001467   200043 400010                    ADSC9   LCP6_MSG+11,,AUTO        cn=2,n=8
         1 001470   000012 000010                    ADSC9   10,,PR0                  cn=0,n=8

      812     9452    5                      B$PS4$->VLR_FPRG_FID.PSN = LCP6_MSG.PSN;

   9452  1 001471   040100 100500                    MLR     fill='040'O
         1 001472   200045 400006                    ADSC9   LCP6_MSG+13,,AUTO        cn=2,n=6
         1 001473   000014 000006                    ADSC9   12,,PR0                  cn=0,n=6

      813     9453    5                      CALL KIA$8TO9(LCP6_MSG.MODTIME,B$PS4$->VLR_FPRG_FID.MODTIME,4);

   9453  1 001474   000013 236000 2                  LDQ     11
         1 001475   200064 756100                    STQ     CHFRSZ+5,,AUTO
         1 001476   000000 236000 xsym               LDQ     B$PS4$
         1 001477   000016 036003                    ADLQ    14,DU
         1 001500   200063 756100                    STQ     CHFRSZ+4,,AUTO
         1 001501   200047 631500                    EPPR1   LCP6_MSG+15,,AUTO
         1 001502   200062 451500                    STP1    CHFRSZ+3,,AUTO
         1 001503   200062 630500                    EPPR0   CHFRSZ+3,,AUTO
         1 001504   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001505   000000 701000 xent               TSX1    KIA$8TO9
         1 001506   000000 011000                    NOP     0

      814     9454    5                      END;

      815     9455    4                 RETURN;

   9455  1 001507   000000 702200 xent               TSX2  ! X66_ARET

      816     9456
      817     9457    4               CASE(%GJ_NAK#);

      818     9458    4                 CALL EMR$FEP2HOST(LCP6_MSG.ERR,B$JIT.ERR);

PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:138  
   9458  1 001510   000000 236000 xsym               LDQ     B$JIT$
         1 001511   000012 036003                    ADLQ    10,DU
         1 001512   200063 756100                    STQ     CHFRSZ+4,,AUTO
         1 001513   200064 452500                    STP2    CHFRSZ+5,,AUTO
         1 001514   200064 236100                    LDQ     CHFRSZ+5,,AUTO
         1 001515   000022 036000 2                  ADLQ    18
         1 001516   200062 756100                    STQ     CHFRSZ+3,,AUTO
         1 001517   200062 630500                    EPPR0   CHFRSZ+3,,AUTO
         1 001520   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001521   000000 701000 xent               TSX1    EMR$FEP2HOST
         1 001522   000000 011000                    NOP     0

      819     9459    4                 RETURN;

   9459  1 001523   000000 702200 xent               TSX2  ! X66_ARET

      820     9460
      821     9461    4               CASE(%GJ_DB_DATA#);

      822     9462    4                 CALL KIF$SEND(TO$->TIM,LCP6_MSG.NAME,%GJ_DB_DATA#)

   9462  1 001524   000024 236000 2                  LDQ     20
         1 001525   200064 756100                    STQ     CHFRSZ+5,,AUTO
         1 001526   200065 452500                    STP2    CHFRSZ+6,,AUTO
         1 001527   200065 236100                    LDQ     CHFRSZ+6,,AUTO
         1 001530   000025 036000 2                  ADLQ    21
         1 001531   200011 235100                    LDA     TO$,,AUTO
         1 001532   200062 757100                    STAQ    CHFRSZ+3,,AUTO
         1 001533   200062 630500                    EPPR0   CHFRSZ+3,,AUTO
         1 001534   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001535   000000 701000 xent               TSX1    KIF$SEND
         1 001536   001540 702000 1                  TSX2    s:9464
         1 001537   001541 710000 1                  TRA     s:9466

      823     9463    5                 WHENALTRETURN DO;

      824     9464    5                      RETURN /* JIT.ERR is set by KIF$SEND*/;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:139  

   9464  1 001540   000000 702200 xent               TSX2  ! X66_ARET

      825     9465    5                      END;
      826     9466    4                 GOTO READ_ACK;

   9466  1 001541   001407 710000 1                  TRA     READ_ACK

      827     9467
      828     9468    4               CASE(ELSE);

      829     9469    4                 B$JIT.ERR=ENOLIB;

   9469  1 001542   000033 236000 0                  LDQ     ENOLIB
         1 001543   000000 470400 xsym               LDP0    B$JIT$
         1 001544   000012 756100                    STQ     10,,PR0

      830     9470    4                 CALL SC_UE_LCP6_FCN;

   9470  1 001545   000000 713400 xsym               CLIMB   SC_UE_LCP6_FCN
         1 001546   000000 600000 xsid               climb   nvectors=         0

      831     9471
      832     9472        /*E* ERROR: UEP-E$NOLIB-E
      833     9473             MESSAGE: You are not allowed to associate a debugger with that FPRG.
      834     9474             DESCRIPTION: An unknown FCN code was in the message read as a
      835     9475                          response to the GJ_GETDB request sent to LCP-6.
      836     9476        */
      837     9477
      838     9478        /*S* SCREECH_CODE: UEP-S$BAD_LCP6_FCN
      839     9479             TYPE:  SNAP
      840     9480             MESSAGE: Unknown FCN code in response to GJ_GETDB request.
      841     9481        */
      842     9482    4                 END/* Do case(fcn) */;

      843     9483
      844     9484    3              RETURN;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:140  

   9484  1 001547   000000 702200 xent               TSX2  ! X66_ARET

      845     9485    3              END/* Do if ALIB_FD */;
      846     9486        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:141  
      847     9487        /*D* When DBRK is set in the M$DRTN FPT, the entries in the user's
      848     9488             Page Table that have the %SCDBRK Software Control bit set are
      849     9489             to have the write control bit reset.  JJ2_DBRK is set in B$JIT.JUNK2
      850     9490             to signal SSU$DELTAGO to enable write access upon the next entry
      851     9491             to the Debugger.
      852     9492              Code has been added to this routine to fix, with any luck, the
      853     9493              when breakpoints on the dp8000.  Because whenbreak points break
      854     9494              down when mlrs span a page, two pages will be write protected
      855     9495              for each page with a data breakpoint on it.  The page the date
      856     9496              is on and the page following it.
      857     9497        */
      858     9498
      859     9499    2         IF AUTO_DRTNV.DBRK

   9499  1 001550   200051 236100                    LDQ     AUTO_DRTNV+1,,AUTO
         1 001551   004000 316003                    CANQ    2048,DU
         1 001552   001730 600000 1                  TZE     s:9531

      860     9500    3         THEN DO;

      861     9501    3              J = B$JIT.DUL;

   9501  1 001553   000000 471400 xsym               LDP1    B$JIT$
         1 001554   100177 236100                    LDQ     127,,PR1
         1 001555   777777 376007                    ANQ     -1,DL
         1 001556   200015 756100                    STQ     J,,AUTO

      862     9502    4              DO I = B$JIT.DLL TO J;

   9502  1 001557   100177 236100                    LDQ     127,,PR1
         1 001560   000022 772000                    QRL     18
         1 001561   200014 756100                    STQ     I,,AUTO
         1 001562   001612 710000 1                  TRA     s:9508+3

      863     9503    4                   IF B$MAP(I) & MAP_DBRK

   9503  1 001563   000000 470400 xsym               LDP0    B$UPT$
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:142  
         1 001564   200014 720100                    LXL0    I,,AUTO
         1 001565   000000 236110                    LDQ     0,X0,PR0
         1 001566   000035 376000 0                  ANQ     MAP_DBRK
         1 001567   001574 600000 1                  TZE     s:9506

      864     9504    4                   THEN
      865     9505    4                        B$MAP(I) = B$MAP(I)  & ~ MAP_PGWRITE_MOD;

   9505  1 001570   000037 236000 0                  LDQ     MAP_PGWRITE_MOD
         1 001571   000027 676000 xsym               ERQ     B_VECTNIL+23
         1 001572   000000 376110                    ANQ     0,X0,PR0
         1 001573   000000 756110                    STQ     0,X0,PR0

      866     9506    4                   IF I ~= J AND B$MAP.RPN(I+1) ~= MM_FPMC.RPN THEN

   9506  1 001574   200014 236100                    LDQ     I,,AUTO
         1 001575   200015 116100                    CMPQ    J,,AUTO
         1 001576   001607 600000 1                  TZE     s:9508
         1 001577   000001 220106                    LDX0    1,QL,PR0
         1 001600   000000 100000 xsym               CMPX0   MM_FPMC
         1 001601   001607 600000 1                  TZE     s:9508

      867     9507    4                        B$MAP(I+1) = B$MAP(I+1) & ~ MAP_PGWRITE_MOD;

   9507  1 001602   000037 236000 0                  LDQ     MAP_PGWRITE_MOD
         1 001603   000027 676000 xsym               ERQ     B_VECTNIL+23
         1 001604   200014 720100                    LXL0    I,,AUTO
         1 001605   000001 376110                    ANQ     1,X0,PR0
         1 001606   000001 756110                    STQ     1,X0,PR0

      868     9508    4                   END;

   9508  1 001607   200014 235100                    LDA     I,,AUTO
         1 001610   000001 035007                    ADLA    1,DL
         1 001611   200014 755100                    STA     I,,AUTO
         1 001612   200015 236100                    LDQ     J,,AUTO
         1 001613   200014 116100                    CMPQ    I,,AUTO
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:143  
         1 001614   001563 603000 1                  TRC     s:9503

      869     9509
      870     9510    3              J = B$JIT.DDUL;

   9510  1 001615   000000 470400 xsym               LDP0    B$JIT$
         1 001616   000200 236100                    LDQ     128,,PR0
         1 001617   777777 376007                    ANQ     -1,DL
         1 001620   200015 756100                    STQ     J,,AUTO

      871     9511    4              DO I = B$JIT.DDLL TO J;

   9511  1 001621   000200 236100                    LDQ     128,,PR0
         1 001622   000022 772000                    QRL     18
         1 001623   200014 756100                    STQ     I,,AUTO
         1 001624   001654 710000 1                  TRA     s:9517+3

      872     9512    4                   IF B$MAP(I) & MAP_DBRK

   9512  1 001625   000000 470400 xsym               LDP0    B$UPT$
         1 001626   200014 720100                    LXL0    I,,AUTO
         1 001627   000000 236110                    LDQ     0,X0,PR0
         1 001630   000035 376000 0                  ANQ     MAP_DBRK
         1 001631   001636 600000 1                  TZE     s:9515

      873     9513    4                   THEN
      874     9514    4                        B$MAP(I) = B$MAP(I)  & ~ MAP_PGWRITE_MOD;

   9514  1 001632   000037 236000 0                  LDQ     MAP_PGWRITE_MOD
         1 001633   000027 676000 xsym               ERQ     B_VECTNIL+23
         1 001634   000000 376110                    ANQ     0,X0,PR0
         1 001635   000000 756110                    STQ     0,X0,PR0

      875     9515    4                   IF I ~= J AND B$MAP.RPN(I+1) ~= MM_FPMC.RPN THEN

   9515  1 001636   200014 236100                    LDQ     I,,AUTO
         1 001637   200015 116100                    CMPQ    J,,AUTO
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:144  
         1 001640   001651 600000 1                  TZE     s:9517
         1 001641   000001 220106                    LDX0    1,QL,PR0
         1 001642   000000 100000 xsym               CMPX0   MM_FPMC
         1 001643   001651 600000 1                  TZE     s:9517

      876     9516    4                        B$MAP(I+1) = B$MAP(I+1) & ~ MAP_PGWRITE_MOD;

   9516  1 001644   000037 236000 0                  LDQ     MAP_PGWRITE_MOD
         1 001645   000027 676000 xsym               ERQ     B_VECTNIL+23
         1 001646   200014 720100                    LXL0    I,,AUTO
         1 001647   000001 376110                    ANQ     1,X0,PR0
         1 001650   000001 756110                    STQ     1,X0,PR0

      877     9517    4                   END;

   9517  1 001651   200014 235100                    LDA     I,,AUTO
         1 001652   000001 035007                    ADLA    1,DL
         1 001653   200014 755100                    STA     I,,AUTO
         1 001654   200015 236100                    LDQ     J,,AUTO
         1 001655   200014 116100                    CMPQ    I,,AUTO
         1 001656   001625 603000 1                  TRC     s:9512

      878     9518
      879     9519    3              J = B$JIT.PTSIZ;

   9519  1 001657   000000 470400 xsym               LDP0    B$JIT$
         1 001660   000216 236100                    LDQ     142,,PR0
         1 001661   777777 376007                    ANQ     -1,DL
         1 001662   200015 756100                    STQ     J,,AUTO

      880     9520    4              DO I = %UDSEGLO TO J;

   9520  1 001663   001130 235007                    LDA     600,DL
         1 001664   200014 755100                    STA     I,,AUTO
         1 001665   001715 710000 1                  TRA     s:9526+3

      881     9521    4                   IF B$MAP(I) & MAP_DBRK
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:145  

   9521  1 001666   000000 470400 xsym               LDP0    B$UPT$
         1 001667   200014 720100                    LXL0    I,,AUTO
         1 001670   000000 236110                    LDQ     0,X0,PR0
         1 001671   000035 376000 0                  ANQ     MAP_DBRK
         1 001672   001677 600000 1                  TZE     s:9524

      882     9522    4                   THEN
      883     9523    4                        B$MAP(I) = B$MAP(I)  & ~ MAP_PGWRITE_MOD;

   9523  1 001673   000037 236000 0                  LDQ     MAP_PGWRITE_MOD
         1 001674   000027 676000 xsym               ERQ     B_VECTNIL+23
         1 001675   000000 376110                    ANQ     0,X0,PR0
         1 001676   000000 756110                    STQ     0,X0,PR0

      884     9524    4                   IF I ~= J AND B$MAP.RPN(I+1) ~= MM_FPMC.RPN THEN

   9524  1 001677   200014 236100                    LDQ     I,,AUTO
         1 001700   200015 116100                    CMPQ    J,,AUTO
         1 001701   001712 600000 1                  TZE     s:9526
         1 001702   000001 220106                    LDX0    1,QL,PR0
         1 001703   000000 100000 xsym               CMPX0   MM_FPMC
         1 001704   001712 600000 1                  TZE     s:9526

      885     9525    4                        B$MAP(I+1) = B$MAP(I+1) & ~ MAP_PGWRITE_MOD;

   9525  1 001705   000037 236000 0                  LDQ     MAP_PGWRITE_MOD
         1 001706   000027 676000 xsym               ERQ     B_VECTNIL+23
         1 001707   200014 720100                    LXL0    I,,AUTO
         1 001710   000001 376110                    ANQ     1,X0,PR0
         1 001711   000001 756110                    STQ     1,X0,PR0

      886     9526    4                   END;

   9526  1 001712   200014 235100                    LDA     I,,AUTO
         1 001713   000001 035007                    ADLA    1,DL
         1 001714   200014 755100                    STA     I,,AUTO
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:146  
         1 001715   200015 236100                    LDQ     J,,AUTO
         1 001716   200014 116100                    CMPQ    I,,AUTO
         1 001717   001666 603000 1                  TRC     s:9521

      887     9527    3              CALL HFC$ASSOCCLR (%USERWSQ,0,16384); /*MAX Dense PT*/

   9527  1 001720   000027 630400 2                  EPPR0   23
         1 001721   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001722   000000 701000 xent               TSX1    HFC$ASSOCCLR
         1 001723   000000 011000                    NOP     0

      888     9528    3              B$JIT.JUNK2 = (B$JIT.JUNK2 | %JJ2_DBRK#);

   9528  1 001724   000000 470400 xsym               LDP0    B$JIT$
         1 001725   000321 220100                    LDX0    209,,PR0
         1 001726   000001 260003                    ORX0    1,DU
         1 001727   000321 740100                    STX0    209,,PR0

      889     9529
      890     9530    3              END;                         /*DO IF DRTN.DBRK                     */

      891     9531    2         IF AUTO_DRTNV.SETSTEPCC = '1'B

   9531  1 001730   200051 236100                    LDQ     AUTO_DRTNV+1,,AUTO
         1 001731   000100 316003                    CANQ    64,DU
         1 001732   001742 600000 1                  TZE     s:9537

      892     9532    3         THEN DO;

      893     9533    3              B$JIT.STEPCC=AUTO_DRTNV.STEPCC;

   9533  1 001733   000000 470400 xsym               LDP0    B$JIT$
         1 001734   200052 236100                    LDQ     AUTO_DRTNV+2,,AUTO
         1 001735   000011 772000                    QRL     9
         1 001736   000316 552120                    STBQ    206,'20'O,PR0

      894     9534    3              B$JIT.JUNK = (B$JIT.JUNK | %JJ_SCCSET#);
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:147  

   9534  1 001737   000315 220100                    LDX0    205,,PR0
         1 001740   000040 260003                    ORX0    32,DU
         1 001741   000315 740100                    STX0    205,,PR0

      895     9535    3              END;

      896     9536                                                /* PICK UP DATA WE USE A LOT          */
      897     9537    2         OECC=CSTK$->B$EXCFR.ECC;

   9537  1 001742   200007 470500                    LDP0    CSTK$,,AUTO
         1 001743   000000 720100                    LXL0    0,,PR0
         1 001744   200017 740100                    STX0    OECC,,AUTO

      898     9538    2         NECC = OECC;

   9538  1 001745   200020 740100                    STX0    NECC,,AUTO

      899     9539    2         FRMSZ = B$TCB.CURRSZ;             /* SIZE OF FRAME IN DELTA'S TCB       */

   9539  1 001746   000004 471400 xsym               LDP1    B_MPT+4
         1 001747   100002 236100                    LDQ     2,,PR1
         1 001750   777777 376007                    ANQ     -1,DL
         1 001751   200013 756100                    STQ     FRMSZ,,AUTO

      900     9540
      901     9541
      902     9542    2         IF AUTO_DRTNV.SETECC = '1'B

   9542  1 001752   200051 236100                    LDQ     AUTO_DRTNV+1,,AUTO
         1 001753   200000 316003                    CANQ    65536,DU
         1 001754   001757 600000 1                  TZE     s:9544

      903     9543    2         THEN NECC=AUTO_DRTNV.ECC;

   9543  1 001755   200051 721100                    LXL1    AUTO_DRTNV+1,,AUTO
         1 001756   200020 741100                    STX1    NECC,,AUTO
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:148  

      904     9544    2         IF (NECC < %ECC_DELTA#) AND (NECC ~= %ECC_XCON#)

   9544  1 001757   200020 221100                    LDX1    NECC,,AUTO
         1 001760   000132 101003                    CMPX1   90,DU
         1 001761   002011 603000 1                  TRC     s:9569
         1 001762   000003 101003                    CMPX1   3,DU
         1 001763   002011 600000 1                  TZE     s:9569

      905     9545    3         THEN DO;

      906     9546    3              TO$=ADDR(B$ROSEG.ECCB(ECCBINDX(CSTK$->B$EXCFR.ISR.WSR)));

   9546  1 001764   000010 236100                    LDQ     8,,PR0
         1 001765   000004 772000                    QRL     4
         1 001766   000007 376007                    ANQ     7,DL
         1 001767   000006 236006 0                  LDQ     ECCBINDX,QL
         1 001770   000033 772000                    QRL     27
         1 001771   000003 402007                    MPY     3,DL
         1 001772   000023 736000                    QLS     19
         1 001773   000024 036003                    ADLQ    20,DU
         1 001774   000000 036000 xsym               ADLQ    B$ROSEG$
         1 001775   200011 756100                    STQ     TO$,,AUTO

      907     9547    3              IF TO$->B$ECCBI.FLAGS(NECC) = '0'B

   9547  1 001776   200011 473500                    LDP3    TO$,,AUTO
         1 001777   200020 235100                    LDA     NECC,,AUTO
         1 002000   000022 771000                    ARL     18
         1 002001   000000 066505                    CMPB    filb='0'B
         1 002002   300004 000001                    BDSC    4,A,PR3                  by=0,bit=0,n=1
         1 002003   000002 000022 xsym               BDSC    B_VECTNIL+2              by=0,bit=0,n=18
         1 002004   002011 601000 1                  TNZ     s:9569

      908     9548    4              THEN DO;

      909     9549    4                   B$JIT.ERR=ENOCONTROL;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:149  

   9549  1 002005   000030 236000 0                  LDQ     ENOCONTROL
         1 002006   000000 474400 xsym               LDP4    B$JIT$
         1 002007   400012 756100                    STQ     10,,PR4

      910     9550        /*E*     ERROR:  UEP-E$NOCONTROL-E
      911     9551                 MESSAGE: Control of that exceptional condition has not been established.
      912     9552                 DESCRIPTION: This error is reported to DELTA when
      913     9553                              the M$DRTN Service Request has specified
      914     9554                              that a user's Exceptional Condition processing
      915     9555                              routine is to be entered and the user has
      916     9556                              not asked for control over the specified condition.
      917     9557        */
      918     9558    4                   RETURN;

   9558  1 002010   000000 702200 xent               TSX2  ! X66_ARET

      919     9559    4                   END;
      920     9560    3              END;
      921     9561
      922     9562
      923     9563        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:150  
      924     9564        /*D* If the Debugger was entered because of an M$ALIB service request
      925     9565             the KPDELTA, DLIB, KLDELTA and ALTRTN options are inspected
      926     9566             to determine how to proceed.
      927     9567        */
      928     9568
      929     9569    2         IF OECC = %ECC_ALIB#

   9569  1 002011   000137 100003                    CMPX0   95,DU
         1 002012   002115 601000 1                  TNZ     s:9615

      930     9570    3         THEN DO;

      931     9571    3              IF AUTO_DRTNV.KPDELTA

   9571  1 002013   200051 430100                    FSZN    AUTO_DRTNV+1,,AUTO
         1 002014   002061 605000 1                  TPL     s:9588

      932     9572    4              THEN DO;

      933     9573    4                   IF CSTK$->B$SSX.ISR.WSR = %ASLWSR

   9573  1 002015   000010 236100                    LDQ     8,,PR0
         1 002016   000160 376007                    ANQ     112,DL
         1 002017   000140 116007                    CMPQ    96,DL
         1 002020   002024 601000 1                  TNZ     s:9578

      934     9574    5                   THEN DO;

      935     9575    5                        AUTO_DRTNV.KPDELTA='0'B;

   9575  1 002021   000004 236000 2                  LDQ     4
         1 002022   200051 356100                    ANSQ    AUTO_DRTNV+1,,AUTO

      936     9576    5                        END;

   9576  1 002023   002061 710000 1                  TRA     s:9588

PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:151  
      937     9577    5                   ELSE DO;

      938     9578    5                        IF ~(B$JIT.JUNK & %JJ_UDELTA#)

   9578  1 002024   000000 473400 xsym               LDP3    B$JIT$
         1 002025   300315 222100                    LDX2    205,,PR3
         1 002026   200000 362003                    ANX2    65536,DU
         1 002027   000000 636012                    EAQ     0,X2
         1 002030   777777 676003                    ERQ     -1,DU
         1 002031   002061 600000 1                  TZE     s:9588

      939     9579    6                        THEN DO;

      940     9580    6                             B$JIT.JUNK = (B$JIT.JUNK | %JJ_UDELTA#);

   9580  1 002032   300315 222100                    LDX2    205,,PR3
         1 002033   200000 262003                    ORX2    65536,DU
         1 002034   300315 742100                    STX2    205,,PR3

      941     9581    6                             B_MPT.LSDESC$->B$$DESCR=B$LS$->B$MLS.USERLS;

   9581  1 002035   000007 474400 xsym               LDP4    B_MPT+7
         1 002036   000000 475400 xsym               LDP5    B$LS$
         1 002037   500062 237100                    LDAQ    50,,PR5
         1 002040   400000 755100                    STA     0,,PR4
         1 002041   400001 756100                    STQ     1,,PR4

      942     9582    6                             CALL UDN$MAGICLS;

   9582  1 002042   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 002043   000000 701000 xent               TSX1    UDN$MAGICLS
         1 002044   000000 011000                    NOP     0

      943     9583    6                             B_MPT.LS$->B$ULNK.ECCB.FLGS=B_MPT.LS$->B$ULNK.ECCB.FLGS|%
              9583                                      DSXXX;

   9583  1 002045   000001 470400 xsym               LDP0    B_MPT+1
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:152  
         1 002046   000034 236100                    LDQ     28,,PR0
         1 002047   000024 736000                    QLS     20
         1 002050   777000 376003                    ANQ     -512,DU
         1 002051   020000 276003                    ORQ     8192,DU
         1 002052   000024 772000                    QRL     20
         1 002053   000034 676100                    ERQ     28,,PR0
         1 002054   177600 376007                    ANQ     65408,DL
         1 002055   000034 656100                    ERSQ    28,,PR0

      944     9584    6                             CALL UDN$MAGIC;

   9584  1 002056   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 002057   000000 701000 xent               TSX1    UDN$MAGIC
         1 002060   000000 011000                    NOP     0

      945     9585    6                             END;

      946     9586    5                        END;

      947     9587    4                   END;

      948     9588    3              IF AUTO_DRTNV.DLIB

   9588  1 002061   200051 236100                    LDQ     AUTO_DRTNV+1,,AUTO
         1 002062   010000 316003                    CANQ    4096,DU
         1 002063   002072 600000 1                  TZE     s:9593

      949     9589    3              THEN IF (B$JIT.JUNK & %JJ_UDELTA#)

   9589  1 002064   000000 470400 xsym               LDP0    B$JIT$
         1 002065   000315 220100                    LDX0    205,,PR0
         1 002066   200000 360003                    ANX0    65536,DU
         1 002067   002072 600000 1                  TZE     s:9593

      950     9590    3                   THEN AUTO_DRTNV.DLIB='0'B;

   9590  1 002070   000032 236000 2                  LDQ     26
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:153  
         1 002071   200051 356100                    ANSQ    AUTO_DRTNV+1,,AUTO

      951     9591
      952     9592                                                /*                                    */
      953     9593    3              IF AUTO_DRTNV.ALTRTN = '1'B

   9593  1 002072   200051 236100                    LDQ     AUTO_DRTNV+1,,AUTO
         1 002073   040000 316003                    CANQ    16384,DU
         1 002074   002115 600000 1                  TZE     s:9615

      954     9594    4              THEN DO;

      955     9595    4                   B$JIT.ERR=EDLTALT;

   9595  1 002075   000032 236000 0                  LDQ     EDLTALT
         1 002076   000000 470400 xsym               LDP0    B$JIT$
         1 002077   000012 756100                    STQ     10,,PR0

      956     9596    4                   CALL HFF$NILERASE(3) ALTRET(NO_ALIBERR);

   9596  1 002100   000033 630400 2                  EPPR0   27
         1 002101   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002102   000000 701000 xent               TSX1    HFF$NILERASE
         1 002103   002110 702000 1                  TSX2    NO_ALIBERR

      957     9597    4                   B$JIT.ERR = B$PS3$->VLP$ECCS_V.ERR;

   9597  1 002104   000000 470400 xsym               LDP0    B$PS3$
         1 002105   000002 236100                    LDQ     2,,PR0
         1 002106   000000 471400 xsym               LDP1    B$JIT$
         1 002107   100012 756100                    STQ     10,,PR1

   9597  1 002110                       NO_ALIBERR   null
      958     9598    4   NO_ALIBERR:     ;
      959     9599    4                   CALL RUND_DELTA2;

   9599  1 002110   003530 701000 1                  TSX1    RUND_DELTA2
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:154  
         1 002111   000000 011000                    NOP     0

      960     9600    4                   CALL UDB$PMMEXIT2;

   9600  1 002112   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 002113   000000 701000 xent               TSX1    UDB$PMMEXIT2
         1 002114   000000 011000                    NOP     0

      961     9601    4                   END;                    /*DO IF ALTRET*/

      962     9602
      963     9603        /*E*   ERROR:  JSP-E$DLTALT-E
      964     9604                 MESSAGE: Debugger signaled ALTRET from your M$ALIB request.
      965     9605                 MESSAGE1: Please refer to your Debugger reference manual.
      966     9606                 MESSAGE7: Debugger signaled ALTRET from your M$ALIB request.
      967     9607                 DESCRIPTION: The user should never see this message as
      968     9608                              DELTA always (?) specifies the error code
      969     9609                              to be returned to the user.
      970     9610        */
      971     9611
      972     9612    3              END;                         /*DO IF OECC=ALIB                     */

      973     9613        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:155  
      974     9614
      975     9615    2         IF AUTO_DRTNV.EVENT='1'B

   9615  1 002115   200051 236100                    LDQ     AUTO_DRTNV+1,,AUTO
         1 002116   020000 316003                    CANQ    8192,DU
         1 002117   002124 600000 1                  TZE     s:9625

      976     9616    2         THEN B$JIT.JUNK = (B$JIT.JUNK | %JJ_EVENT#);

   9616  1 002120   000000 470400 xsym               LDP0    B$JIT$
         1 002121   000315 220100                    LDX0    205,,PR0
         1 002122   400000 260003                    ORX0    -131072,DU
         1 002123   000315 740100                    STX0    205,,PR0

      977     9617
      978     9618        /*D* If QUIT is specified a call is made to JSA$QUIT to set the
      979     9619             XCONF, RNST, JUNK and ERR fields of the JIT and to reset
      980     9620             the %DSXXX bit in the user's ECCB Descriptor.  However, if
      981     9621             the QUIT is from an Alternate Shared Library, the QUIT
      982     9622             becomes an M$ERR (ASL).  In any case, the Debugger is
      983     9623             run down and the abort logic is entered.
      984     9624         */
      985     9625    2         IF AUTO_DRTNV.QUIT ='1'B

   9625  1 002124   100000 316003                    CANQ    32768,DU
         1 002125   002147 600000 1                  TZE     s:9650

      986     9626    3         THEN DO;

      987     9627    3              IF CSTK$->B$SSX.ISR.WSR = %ASLWSR

   9627  1 002126   200007 470500                    LDP0    CSTK$,,AUTO
         1 002127   000010 236100                    LDQ     8,,PR0
         1 002130   000160 376007                    ANQ     112,DL
         1 002131   000140 116007                    CMPQ    96,DL
         1 002132   002137 601000 1                  TNZ     s:9629

PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:156  
      988     9628    3              THEN B$JIT.ERR=EASLERR;

   9628  1 002133   000040 236000 0                  LDQ     EASLERR
         1 002134   000000 471400 xsym               LDP1    B$JIT$
         1 002135   100012 756100                    STQ     10,,PR1
         1 002136   002142 710000 1                  TRA     s:9639

      989     9629    3              ELSE CALL JSA$QUIT;

   9629  1 002137   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 002140   000000 701000 xent               TSX1    JSA$QUIT
         1 002141   000000 011000                    NOP     0

      990     9630        /*E*   ERROR: UEP-E$ASLERR-E
      991     9631               MESSAGE: Your Alternate Shared Library has errored the job.
      992     9632               DESCRIPTION: QUIT command to the Debugger following an
      993     9633                            M$ALIB service request from an Alternate
      994     9634                            Shared Library.  Exit Control for both the
      995     9635                            user and Alternate Shared Library will be
      996     9636                            honored and the Debugger will remain
      997     9637                            associated.
      998     9638        */
      999     9639    3              CALL RUND_DELTA;

   9639  1 002142   003520 701000 1                  TSX1    RUND_DELTA
         1 002143   000000 011000                    NOP     0

     1000     9640                                                /* JSA$QUIT has backed Safe-store     */
     1001     9641    3              CALL JSE$ABORTX;

   9641  1 002144   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 002145   000000 701000 xent               TSX1    JSE$ABORTX
         1 002146   000000 011000                    NOP     0

     1002     9642    3              END;

     1003     9643        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:157  
     1004     9644        /*D* The values supplied by the REGS, DRS, IC and IR options of
     1005     9645             the M$DRTN FPT are then moved to the Safe-Store frame.
     1006     9646             If returning to the user following an M$ALIB service
     1007     9647             request, with no change to the user's IC, the IC is
     1008     9648             bumped past the ALTRET address (if any).
     1009     9649        */
     1010     9650    2         CALL MERGE_DFPT;

   9650  1 002147   003126 701000 1                  TSX1    MERGE_DFPT
         1 002150   000000 011000                    NOP     0

     1011     9651    2         B_MPT.ECCBDESC$->B$$DESCR = B$ULS.ECCB;

   9651  1 002151   000013 470400 xsym               LDP0    B_MPT+11
         1 002152   000001 471400 xsym               LDP1    B_MPT+1
         1 002153   100034 237100                    LDAQ    28,,PR1
         1 002154   000000 755100                    STA     0,,PR0
         1 002155   000001 756100                    STQ     1,,PR0

     1012     9652                            /* Get a ECCB descriptor we will be interested in !!!     */
     1013     9653    2         B_MPT.ECCBDESC$->B$$DESCR.FLGS =

   9653  1 002156   000013 470400 xsym               LDP0    B_MPT+11
         1 002157   000000 236100                    LDQ     0,,PR0
         1 002160   000024 736000                    QLS     20
         1 002161   777000 376003                    ANQ     -512,DU
         1 002162   200000 276003                    ORQ     65536,DU
         1 002163   000024 772000                    QRL     20
         1 002164   000000 676100                    ERQ     0,,PR0
         1 002165   177600 376007                    ANQ     65408,DL
         1 002166   000000 656100                    ERSQ    0,,PR0

     1014     9654    2           (B_MPT.ECCBDESC$->B$$DESCR.FLGS  | %DSWRITE );
     1015     9655
     1016     9656    2         CALL SET_IRIC;

   9656  1 002167   003303 701000 1                  TSX1    SET_IRIC
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:158  
         1 002170   000000 011000                    NOP     0

     1017     9657
     1018     9658    2         IF OECC= %ECC_ALIB#

   9658  1 002171   200017 220100                    LDX0    OECC,,AUTO
         1 002172   000137 100003                    CMPX0   95,DU
         1 002173   002204 601000 1                  TNZ     s:9670

     1019     9659    3         THEN DO;

     1020     9660    3              IF (B$SS.IC = EXCFR_IC) AND (B$SS.ALT='1'B)

   9660  1 002174   000000 470400 xsym               LDP0    B_MPT
         1 002175   000004 221100                    LDX1    4,,PR0
         1 002176   200027 101100                    CMPX1   EXCFR_IC,,AUTO
         1 002177   002204 601000 1                  TNZ     s:9670
         1 002200   000001 234100                    SZN     1,,PR0
         1 002201   002204 605000 1                  TPL     s:9670

     1021     9661    3              THEN B$SS.IC = B$SS.IC+1;

   9661  1 002202   000001 622011                    EAX2    1,X1
         1 002203   000004 742100                    STX2    4,,PR0

     1022     9662    3              END;

     1023     9663        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:159  
     1024     9664
     1025     9665        /*D* When exiting to a user Exceptional Condition processing
     1026     9666             routine, the values specified by the ECCS option are
     1027     9667             moved to the copy of the user frame on the Debugger's
     1028     9668             TCB, so will they will be moved on the call to UEP$TCBTCB.
     1029     9669        */
     1030     9670    2         IF NECC <= %ECC_ERROR#

   9670  1 002204   200020 221100                    LDX1    NECC,,AUTO
         1 002205   000010 101003                    CMPX1   8,DU
         1 002206   002252 603000 1                  TRC     s:9704

     1031     9671    3         THEN DO;

     1032     9672    3              I=3;

   9672  1 002207   000003 235007                    LDA     3,DL
         1 002210   200014 755100                    STA     I,,AUTO

     1033     9673    3              CALL HFF$NILERASE(I) ALTRET(ECCS_OK);

   9673  1 002211   200014 630500                    EPPR0   I,,AUTO
         1 002212   200062 450500                    STP0    CHFRSZ+3,,AUTO
         1 002213   200062 630500                    EPPR0   CHFRSZ+3,,AUTO
         1 002214   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002215   000000 701000 xent               TSX1    HFF$NILERASE
         1 002216   002231 702000 1                  TSX2    ECCS_OK

     1034     9674
     1035     9675    3              CSTK$->B$EXCFR.U1=0;

   9675  1 002217   000000 220003                    LDX0    0,DU
         1 002220   200007 470500                    LDP0    CSTK$,,AUTO
         1 002221   000100 740100                    STX0    64,,PR0

     1036     9676    3              CSTK$->B$XCON.ECSC=B$PS3$->VLP$ECCS_V.ECCS.EVSC;

PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:160  
   9676  1 002222   000000 471400 xsym               LDP1    B$PS3$
         1 002223   100000 721100                    LXL1    0,,PR1
         1 002224   000100 441100                    SXL1    64,,PR0

     1037     9677    3              CSTK$->B$EXCFR.EVID=B$PS3$->VLP$ECCS_V.EVID;

   9677  1 002225   100001 235100                    LDA     1,,PR1
         1 002226   000101 755100                    STA     65,,PR0

     1038     9678    3              CSTK$->B$EXCFR.ERR=B$PS3$->VLP$ECCS_V.ERR;

   9678  1 002227   100002 236100                    LDQ     2,,PR1
         1 002230   000102 756100                    STQ     66,,PR0

   9678  1 002231                       ECCS_OK      null
     1039     9679    3   ECCS_OK:   ;
     1040     9680    3              CSTK$->B$EXCFR.ECC=NECC;

   9680  1 002231   200020 220100                    LDX0    NECC,,AUTO
         1 002232   200007 470500                    LDP0    CSTK$,,AUTO
         1 002233   000000 440100                    SXL0    0,,PR0

     1041     9681    3              IF OECC ~= NECC

   9681  1 002234   200017 221100                    LDX1    OECC,,AUTO
         1 002235   200020 101100                    CMPX1   NECC,,AUTO
         1 002236   002247 600000 1                  TZE     s:9689

     1042     9682    4              THEN DO;

     1043     9683    4                   CSTK$->B$EXCFR.P#=0;

   9683  1 002237   000103 450100                    STZ     67,,PR0

     1044     9684    4                   FRMSZ=68;

   9684  1 002240   000104 235007                    LDA     68,DL
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:161  
         1 002241   200013 755100                    STA     FRMSZ,,AUTO

     1045     9685    4                   IF OECC=%ECC_XCON#

   9685  1 002242   000003 101003                    CMPX1   3,DU
         1 002243   002247 601000 1                  TNZ     s:9689

     1046     9686    4                   THEN B$JIT.SVLDTF='000'O;

   9686  1 002244   000000 471400 xsym               LDP1    B$JIT$
         1 002245   000000 236003                    LDQ     0,DU
         1 002246   100316 552104                    STBQ    206,'04'O,PR1

     1047     9687                                                /* JUST IN CASE                       */
     1048     9688    4                   END;

     1049     9689    3              B$JIT.ERR = CSTK$->B$EXCFR.ERR;

   9689  1 002247   000102 236100                    LDQ     66,,PR0
         1 002250   000000 471400 xsym               LDP1    B$JIT$
         1 002251   100012 756100                    STQ     10,,PR1

     1050     9690    3              END;

     1051     9691                                                /*                                    */
     1052     9692        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:162  
     1053     9693
     1054     9694        /*D* If the value of the ECC parameter in the M$DRTN FPT (or
     1055     9695             the value of the ECC in the TCB frame, if SETECC is
     1056     9696             not specified) is >= ECC_DELTA#, then we are to return to
     1057     9697             the user at the address that is now in Safe-Store.
     1058     9698        */
     1059     9699
     1060     9700        /*D* If this 'GO' is aborting an entry to Exit Control processing
     1061     9701             then we must first remove the Exit Control flags that have been
     1062     9702             set in the user's ECCB and in JIT.SVLDTF.
     1063     9703        */
     1064     9704    2         IF NECC >= %ECC_DELTA#

   9704  1 002252   200020 220100                    LDX0    NECC,,AUTO
         1 002253   000132 100003                    CMPX0   90,DU
         1 002254   002373 602000 1                  TNC     s:9757

     1065     9705    3         THEN DO;

     1066     9706    3              IF OECC = %ECC_XCON#

   9706  1 002255   200017 221100                    LDX1    OECC,,AUTO
         1 002256   000003 101003                    CMPX1   3,DU
         1 002257   002307 601000 1                  TNZ     s:9719

     1067     9707    4              THEN DO;

     1068     9708    4                   B_MPT.ECCB$->B$ECCB.XCONF =

   9708  1 002260   200007 470500                    LDP0    CSTK$,,AUTO
         1 002261   000100 236100                    LDQ     64,,PR0
         1 002262   777000 376003                    ANQ     -512,DU
         1 002263   777000 676003                    ERQ     -512,DU
         1 002264   200062 756100                    STQ     CHFRSZ+3,,AUTO
         1 002265   000005 471400 xsym               LDP1    B_MPT+5
         1 002266   100004 236100                    LDQ     4,,PR1
         1 002267   000011 736000                    QLS     9
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:163  
         1 002270   777000 376003                    ANQ     -512,DU
         1 002271   200062 376100                    ANQ     CHFRSZ+3,,AUTO
         1 002272   000011 772000                    QRL     9
         1 002273   100004 552120                    STBQ    4,'20'O,PR1

     1069     9709    4                     (B_MPT.ECCB$->B$ECCB.XCONF &~ CSTK$->B$XCON.CECCB);
     1070     9710    4                   B$JIT.SVLDTF=(B$JIT.SVLDTF &~(CSTK$->B$XCON.CECCB & %SVL_ECCB#) );

   9710  1 002274   000100 236100                    LDQ     64,,PR0
         1 002275   777000 376003                    ANQ     -512,DU
         1 002276   016000 376003                    ANQ     7168,DU
         1 002277   777000 676003                    ERQ     -512,DU
         1 002300   200062 756100                    STQ     CHFRSZ+3,,AUTO
         1 002301   000000 471400 xsym               LDP1    B$JIT$
         1 002302   100316 236100                    LDQ     206,,PR1
         1 002303   000033 736000                    QLS     27
         1 002304   200062 376100                    ANQ     CHFRSZ+3,,AUTO
         1 002305   000033 772000                    QRL     27
         1 002306   100316 552104                    STBQ    206,'04'O,PR1

     1071     9711    4                   END;                    /*DO IF OECC=XCON#                    */

     1072     9712
     1073     9713        /*D* If this a 'GO' following an entry to the Debugger for an
     1074     9714             M$EXIT or M$TRTN from a user's Exit Control routine that
     1075     9715             was entered for SAVE or M$LDTRC, the Debugger is run down
     1076     9716             and the abort logic is entered where the actual SAVE or
     1077     9717             LDTRC will take place.  (See JSE$EXITS).
     1078     9718        */
     1079     9719    3              IF OECC = %ECC_EXCRTN#

   9719  1 002307   000140 101003                    CMPX1   96,DU
         1 002310   002357 601000 1                  TNZ     s:9744

     1080     9720    4              THEN DO;

     1081     9721    4                   B$SS.ISR = CSTK$->B$SSX.ISR;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:164  

   9721  1 002311   200007 470500                    LDP0    CSTK$,,AUTO
         1 002312   000010 237100                    LDAQ    8,,PR0
         1 002313   000000 471400 xsym               LDP1    B_MPT
         1 002314   100010 757100                    STAQ    8,,PR1

     1082     9722                                                /* In case the user shrunk his ISR    */
     1083     9723    4                   IF B$SS.IC = EXCFR_IC

   9723  1 002315   100004 222100                    LDX2    4,,PR1
         1 002316   200027 102100                    CMPX2   EXCFR_IC,,AUTO
         1 002317   002357 601000 1                  TNZ     s:9744

     1084     9724    5                   THEN DO;                /* If the user hasnt changed IC*/

     1085     9725    5                        FROM$=PINCRW(CSTK$,64);

   9725  1 002320   200007 236100                    LDQ     CSTK$,,AUTO
         1 002321   000100 036003                    ADLQ    64,DU
         1 002322   200012 756100                    STQ     FROM$,,AUTO

     1086     9726    5                        IF (FROM$->B$EXCRTN.SVL & %SVL_READY#)

   9726  1 002323   200012 473500                    LDP3    FROM$,,AUTO
         1 002324   300000 236100                    LDQ     0,,PR3
         1 002325   777000 376003                    ANQ     -512,DU
         1 002326   140000 376003                    ANQ     49152,DU
         1 002327   002346 600000 1                  TZE     s:9734

     1087     9727    6                        THEN DO;

     1088     9728    6                             B$JIT.SVLDTF=(B$JIT.SVLDTF | FROM$->B$EXCRTN.SVL);

   9728  1 002330   300000 236100                    LDQ     0,,PR3
         1 002331   777000 376003                    ANQ     -512,DU
         1 002332   200062 756100                    STQ     CHFRSZ+3,,AUTO
         1 002333   000000 474400 xsym               LDP4    B$JIT$
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:165  
         1 002334   400316 236100                    LDQ     206,,PR4
         1 002335   000033 736000                    QLS     27
         1 002336   200062 276100                    ORQ     CHFRSZ+3,,AUTO
         1 002337   000033 772000                    QRL     27
         1 002340   400316 552104                    STBQ    206,'04'O,PR4

   9728  1 002341                       FINAL_EXIT   null
     1089     9729    6   FINAL_EXIT:               ;
     1090     9730    6                             CALL RUND_DELTA;

   9730  1 002341   003520 701000 1                  TSX1    RUND_DELTA
         1 002342   000000 011000                    NOP     0

     1091     9731    6                             CALL JSE$ABORTX;

   9731  1 002343   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 002344   000000 701000 xent               TSX1    JSE$ABORTX
         1 002345   000000 011000                    NOP     0

     1092     9732    6                             END;          /*DO IF READY                         */

     1093     9733
     1094     9734    5                        IF (FROM$->B$EXCRTN.ECCS = %SC_XCONXIT#)

   9734  1 002346   200012 470500                    LDP0    FROM$,,AUTO
         1 002347   000000 720100                    LXL0    0,,PR0
         1 002350   000006 100003                    CMPX0   6,DU
         1 002351   002357 601000 1                  TNZ     s:9744

     1095     9735    6                        THEN DO;

     1096     9736    6                             B$JIT.JUNK=(B$JIT.JUNK  | %JJ_BYPASSD#);

   9736  1 002352   000000 471400 xsym               LDP1    B$JIT$
         1 002353   100315 221100                    LDX1    205,,PR1
         1 002354   000400 261003                    ORX1    256,DU
         1 002355   100315 741100                    STX1    205,,PR1
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:166  

     1097     9737    6                             GOTO FINAL_EXIT;

   9737  1 002356   002341 710000 1                  TRA     FINAL_EXIT

     1098     9738    6                             END;
     1099     9739
     1100     9740    5                        END;               /*DO IF SS.IC NOT MODIFIED            */
     1101     9741    4                   END;                    /* DO IF OECC = EXCRTN#               */
     1102     9742
     1103     9743
     1104     9744    3              CALL RUND_DELTA;

   9744  1 002357   003520 701000 1                  TSX1    RUND_DELTA
         1 002360   000000 011000                    NOP     0

     1105     9745
     1106     9746    3              IF NECC = %ECC_SAVLDT#  /* IF SPECIAL RETURN FROM DELTA FOR SAVE   */

   9746  1 002361   200020 220100                    LDX0    NECC,,AUTO
         1 002362   000136 100003                    CMPX0   94,DU
         1 002363   002370 601000 1                  TNZ     s:9749

     1107     9747    3              THEN CALL JSE$ABORTX;

   9747  1 002364   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 002365   000000 701000 xent               TSX1    JSE$ABORTX
         1 002366   000000 011000                    NOP     0
         1 002367   002373 710000 1                  TRA     s:9757

     1108     9748                                                /* ALLOWS USER TO SKIP SCON           */
     1109     9749    3              ELSE CALL UDB$AUTO;

   9749  1 002370   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 002371   000000 701000 xent               TSX1    UDB$AUTO
         1 002372   000000 011000                    NOP     0

PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:167  
     1110     9750    3              END;                         /*DO IF NECC>=ECC_DELTA#              */

     1111     9751                                                /*                                    */
     1112     9752        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:168  
     1113     9753           /* DELTA was entered via an Exceptional Condition reported
     1114     9754              on the user  */
     1115     9755           /* Leaving an XCON entry - or exiting to XCON processing
     1116     9756              requires a few special checks  */
     1117     9757    2         IF NECC = %ECC_XCON#

   9757  1 002373   200020 220100                    LDX0    NECC,,AUTO
         1 002374   000003 100003                    CMPX0   3,DU
         1 002375   002464 601000 1                  TNZ     XCON_GO

     1118     9758    3         THEN DO;

     1119     9759    3              IF OECC = %ECC_XCON#

   9759  1 002376   200017 221100                    LDX1    OECC,,AUTO
         1 002377   000003 101003                    CMPX1   3,DU
         1 002400   002434 601000 1                  TNZ     s:9785

     1120     9760    4              THEN DO;

     1121     9761    4                   IF (CSTK$->B$XCON.CECCB & (%SVL_ECCB# | %SVL_GET#) )

   9761  1 002401   200007 470500                    LDP0    CSTK$,,AUTO
         1 002402   000100 236100                    LDQ     64,,PR0
         1 002403   777000 376003                    ANQ     -512,DU
         1 002404   017000 376003                    ANQ     7680,DU
         1 002405   002430 600000 1                  TZE     s:9782

     1122     9762    5                   THEN DO;

     1123     9763                                                /* If M$LDTRC or SAVE-GET             */
     1124     9764    5                        IF CSTK$->B$XCON.CECCB.PROG ='1'B

   9764  1 002406   000100 234100                    SZN     64,,PR0
         1 002407   002422 605000 1                  TPL     s:9777

     1125     9765    6                        THEN DO;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:169  

     1126     9766    6                             IF (B_MPT.ECCB$->B$ECCB.FLAGS.XCONSET)

   9766  1 002410   000005 471400 xsym               LDP1    B_MPT+5
         1 002411   100004 236100                    LDQ     4,,PR1
         1 002412   040000 316003                    CANQ    16384,DU
         1 002413   002420 600000 1                  TZE     s:9772

     1127     9767    7                             THEN DO;

     1128     9768    7                                  TEMPF=CSTK$->B$XCON.CECCB;

   9768  1 002414   000100 236100                    LDQ     64,,PR0
         1 002415   777000 376003                    ANQ     -512,DU
         1 002416   200016 756100                    STQ     TEMPF,,AUTO

     1129     9769    7                                  GOTO XCON_GO;

   9769  1 002417   002464 710000 1                  TRA     XCON_GO

     1130     9770    7                                  END;     /*DO IF THE USER WANTS XCON           */
     1131     9771    7                             ELSE DO;

     1132     9772    7                                  CSTK$->B$EXCFR.ECC=%ECC_SAVLDT#;

   9772  1 002420   000136 222003                    LDX2    94,DU
         1 002421   000000 442100                    SXL2    0,,PR0

     1133     9773    7                                  END;     /*DO IF THE USER DOESNT WANT XCON     */

     1134     9774    6                             END;          /*DO IF XCON.PROG=0                   */

     1135     9775                                                /*                                    */
     1136     9776                                 /* READY TO DO IT NOW-SINCE XCON IN PROG OR NOT SET  */
     1137     9777    5                        B_MPT.ECCB$->B$ECCB.XCONF.SVLDT='1'B;

   9777  1 002422   000005 471400 xsym               LDP1    B_MPT+5
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:170  
         1 002423   000020 236003                    LDQ     16,DU
         1 002424   100004 256100                    ORSQ    4,,PR1

     1138     9778    5                        CALL DTCB_UTCB;

   9778  1 002425   002644 701000 1                  TSX1    DTCB_UTCB
         1 002426   000000 011000                    NOP     0

     1139     9779                                      /* CHANGE THIS IF GOTO DELTA ON TRNT FROM SVLDT */
     1140     9780    5                        GOTO DO_DRUND;

   9780  1 002427   002457 710000 1                  TRA     DO_DRUND

     1141     9781    5                        END;               /*DO IF SVL_ECCB#                     */
     1142     9782    4                   B$JIT.RNST = CSTK$->B$XCON.RNST;

   9782  1 002430   000000 471400 xsym               LDP1    B$JIT$
         1 002431   000101 236100                    LDQ     65,,PR0
         1 002432   100314 552140                    STBQ    204,'40'O,PR1

     1143     9783    4                   END;                    /*DO IF OECC = XCON                   */

   9783  1 002433   002453 710000 1                  TRA     s:9789

     1144     9784    4              ELSE DO;                     /* LET ASL KNOW WHATS HAPPENING       */

     1145     9785    4                   IF (OECC >%ECC_XCON#) AND (OECC < %ECC_DELTA#)

   9785  1 002434   000004 101003                    CMPX1   4,DU
         1 002435   002446 602000 1                  TNC     s:9787
         1 002436   000132 101003                    CMPX1   90,DU
         1 002437   002446 603000 1                  TRC     s:9787

     1146     9786    4                   THEN B$JIT.RNST = (B$JIT.RNST | %RS_ABRT#);

   9786  1 002440   000000 470400 xsym               LDP0    B$JIT$
         1 002441   000314 236100                    LDQ     204,,PR0
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:171  
         1 002442   777000 376003                    ANQ     -512,DU
         1 002443   010000 276003                    ORQ     4096,DU
         1 002444   000314 552140                    STBQ    204,'40'O,PR0
         1 002445   002453 710000 1                  TRA     s:9789

     1147     9787    4                   ELSE B$JIT.XCONF = (B$JIT.XCONF | %XC_QUIT#);

   9787  1 002446   000000 470400 xsym               LDP0    B$JIT$
         1 002447   000316 236100                    LDQ     206,,PR0
         1 002450   777000 376003                    ANQ     -512,DU
         1 002451   001000 276003                    ORQ     512,DU
         1 002452   000316 552140                    STBQ    206,'40'O,PR0

     1148     9788    4                   END;                    /*DO IF OECC ~= XCON                  */

     1149     9789    3              B$JIT.JUNK = (B$JIT.JUNK | %JJ_BYPASSD#);

   9789  1 002453   000000 470400 xsym               LDP0    B$JIT$
         1 002454   000315 222100                    LDX2    205,,PR0
         1 002455   000400 262003                    ORX2    256,DU
         1 002456   000315 742100                    STX2    205,,PR0

   9789  1 002457                       DO_DRUND     null
     1150     9790    3   DO_DRUND:  ;
     1151     9791    3              CALL RUND_DELTA;

   9791  1 002457   003520 701000 1                  TSX1    RUND_DELTA
         1 002460   000000 011000                    NOP     0

     1152     9792    3              CALL JSE$ABORTX;

   9792  1 002461   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 002462   000000 701000 xent               TSX1    JSE$ABORTX
         1 002463   000000 011000                    NOP     0

     1153     9793    3              END;                         /*DO IF NECC = XCON                   */

PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:172  
   9787  1 002464                       XCON_GO      null
     1154     9794        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:173  
     1155     9795
     1156     9796
     1157     9797          /* When the user has Exceptional Condition control move
     1158     9798             the frame from DELTA's TCB to the User's TCB and
     1159     9799             exit thru SSS$SEXIT (via UDB$AUTO)  */
     1160     9800    2   XCON_GO: ;
     1161     9801    2         CALL DTCB_UTCB;

   9801  1 002464   002644 701000 1                  TSX1    DTCB_UTCB
         1 002465   000000 011000                    NOP     0

     1162     9802    2         B$SS.IC = B_MPT.ECCB$->B$ECCBI.ECIC(NECC);

   9802  1 002466   200020 235100                    LDA     NECC,,AUTO
         1 002467   777777 375003                    ANA     -1,DU
         1 002470   000021 771000                    ARL     17
         1 002471   000005 470400 xsym               LDP0    B_MPT+5
         1 002472   000000 471400 xsym               LDP1    B_MPT
         1 002473   000100 100505                    MLR     fill='000'O
         1 002474   000000 000002                    ADSC9   0,A,PR0                  cn=0,n=2
         1 002475   100004 000002                    ADSC9   4,,PR1                   cn=0,n=2

     1163     9803    2         B$SS.IR.MIR = '0'B;

   9803  1 002476   000034 236000 2                  LDQ     28
         1 002477   100004 356100                    ANSQ    4,,PR1

     1164     9804    2         B$SS.CPUREQ = '0'B;

   9804  1 002500   000035 236000 2                  LDQ     29
         1 002501   100006 356100                    ANSQ    6,,PR1

     1165     9805    2         IF NECC = %ECC_XCON#

   9805  1 002502   200020 220100                    LDX0    NECC,,AUTO
         1 002503   000003 100003                    CMPX0   3,DU
         1 002504   002522 601000 1                  TNZ     s:9811
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:174  

     1166     9806    3         THEN DO;

     1167     9807    3              B_MPT.ECCB$->B$ECCB.XCONF = (B_MPT.ECCB$->B$ECCB.XCONF | TEMPF);

   9807  1 002505   200016 236100                    LDQ     TEMPF,,AUTO
         1 002506   777000 376003                    ANQ     -512,DU
         1 002507   200062 756100                    STQ     CHFRSZ+3,,AUTO
         1 002510   000005 470400 xsym               LDP0    B_MPT+5
         1 002511   000004 236100                    LDQ     4,,PR0
         1 002512   000011 736000                    QLS     9
         1 002513   777000 376003                    ANQ     -512,DU
         1 002514   200062 276100                    ORQ     CHFRSZ+3,,AUTO
         1 002515   000011 772000                    QRL     9
         1 002516   000004 552120                    STBQ    4,'20'O,PR0

     1168     9808    3              B_MPT.ECCB$->B$ECCB.XCONF.PROG='1'B;

   9808  1 002517   000005 470400 xsym               LDP0    B_MPT+5
         1 002520   000400 236003                    LDQ     256,DU
         1 002521   000004 256100                    ORSQ    4,,PR0

     1169     9809                                           /* In Progress for M$LDTRC or SAVE-GET     */
     1170     9810    3              END;

     1171     9811    2         CALL RUND_DELTA;

   9811  1 002522   003520 701000 1                  TSX1    RUND_DELTA
         1 002523   000000 011000                    NOP     0

     1172     9812    2         CALL UDB$AUTO;

   9812  1 002524   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 002525   000000 701000 xent               TSX1    UDB$AUTO
         1 002526   000000 011000                    NOP     0
         1 002527   002534 710000 1                  TRA     s:9821

PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:175  
     1173     9813                                                /*                                    */
     1174     9814                                                /*                                    */
     1175     9815        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:176  
     1176     9816    2       CASE(ELSE);

     1177     9817    2         B$JIT.ERR=EBADCODE;

   9817  1 002530   000031 236000 0                  LDQ     EBADCODE
         1 002531   000000 474400 xsym               LDP4    B$JIT$
         1 002532   400012 756100                    STQ     10,,PR4

     1178     9818    2         RETURN;

   9818  1 002533   000000 702200 xent               TSX2  ! X66_ARET

     1179     9819
     1180     9820    2         END;                              /* DO CASE(CODE)                      */

     1181     9821    1      RETURN;

   9821  1 002534   000000 702200 xent               TSX2  ! X66_ARET

     1182     9822                                                /*                                    */
     1183     9823                                                /*                                    */
     1184     9824    1   ERR_EXIT: RETURN;

   9824  1 002535   000000 702200 xent  ERR_EXIT     TSX2  ! X66_ARET

   9808  1 002536                       ABORTM_GO    null
     1185     9825
     1186     9826    1   ABORTM_GO: ;
     1187     9827    1      CALL UDB$CALCOMP;

   9827  1 002536   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 002537   000000 701000 xent               TSX1    UDB$CALCOMP
         1 002540   000000 011000                    NOP     0

     1188     9828    1      CALL JSE$ABORTM;

   9828  1 002541   000002 631400 xsym               EPPR1   B_VECTNIL+2
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:177  
         1 002542   000000 701000 xent               TSX1    JSE$ABORTM
         1 002543   000000 011000                    NOP     0
         1 002544   002547 710000 1                  TRA     s:9835

     1189     9829
     1190     9830        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:178  
     1191     9831                                                /*                                    */
     1192     9832    1   UEP$CLEARONE: ENTRY(CODE,USTK1$,USTK2$) ALTRET;

   9832  1 002545   000000 700200 xent  UEP$CLEARONE TSX0  ! X66_AUTO_3
         1 002546   000066 000003                    ZERO    54,3

     1193     9833                                                /*                                    */
     1194     9834                                                /*                                    */
     1195     9835    1      IF USTK1$=ADDR(NIL)

   9835  1 002547   200004 470500                    LDP0    @USTK1$,,AUTO
         1 002550   000000 236100                    LDQ     0,,PR0
         1 002551   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002552   002560 601000 1                  TNZ     s:9837

     1196     9836    1      THEN USTK1$=PINCRW(B_MPT.TCB$,B_MPT.TCB$->FTCB.CRFR);

   9836  1 002553   000004 471400 xsym               LDP1    B_MPT+4
         1 002554   100001 220100                    LDX0    1,,PR1
         1 002555   000000 636010                    EAQ     0,X0
         1 002556   000004 036000 xsym               ADLQ    B_MPT+4
         1 002557   000000 756100                    STQ     0,,PR0

     1197     9837    1      CSTK$=USTK1$;

   9837  1 002560   200007 756100                    STQ     CSTK$,,AUTO

     1198     9838    1      IF CODE ~= 0

   9838  1 002561   200003 471500                    LDP1    @CODE,,AUTO
         1 002562   100000 235100                    LDA     0,,PR1
         1 002563   002574 600000 1                  TZE     s:9844

     1199     9839    2      THEN DO;

     1200     9840    2           USTK1$=CSTK$;                   /* In case it was null coming in      */

PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:179  
   9840  1 002564   000000 756100                    STQ     0,,PR0

     1201     9841    2           IF CSTK$->B$SSX.ISR.WSR ~= CODE

   9841  1 002565   200007 473500                    LDP3    CSTK$,,AUTO
         1 002566   300010 236100                    LDQ     8,,PR3
         1 002567   000004 772000                    QRL     4
         1 002570   000007 376007                    ANQ     7,DL
         1 002571   100000 116100                    CMPQ    0,,PR1
         1 002572   002574 600000 1                  TZE     s:9844

     1202     9842    2           THEN RETURN;

   9842  1 002573   000000 702200 xent               TSX2  ! X66_ARET

     1203     9843    2           END;
     1204     9844    1      CALL CLEARONE ALTRET(CLR_ALT);

   9844  1 002574   003005 701000 1                  TSX1    CLEARONE
         1 002575   002602 702000 1                  TSX2    CLR_ALT

     1205     9845    1      USTK1$=CSTK$;

   9845  1 002576   200007 236100                    LDQ     CSTK$,,AUTO
         1 002577   200004 470500                    LDP0    @USTK1$,,AUTO
         1 002600   000000 756100                    STQ     0,,PR0

     1206     9846    1      RETURN;

   9846  1 002601   000000 702200 xent               TSX2  ! X66_ARET

     1207     9847    1   CLR_ALT: USTK1$=CSTK$;

   9847  1 002602   200007 236100       CLR_ALT      LDQ     CSTK$,,AUTO
         1 002603   200004 470500                    LDP0    @USTK1$,,AUTO
         1 002604   000000 756100                    STQ     0,,PR0

PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:180  
     1208     9848    1      ALTRETURN;

   9848  1 002605   000000 702200 xent               TSX2  ! X66_AALT

     1209     9849                                                /*                                    */
     1210     9850        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:181  
     1211     9851                                                /*                                    */
     1212     9852    1   UEP$MOVETCB: ENTRY(CODE,USTK1$,USTK2$) ALTRET;

   9852  1 002606   000000 700200 xent  UEP$MOVETCB  TSX0  ! X66_AUTO_3
         1 002607   000066 000003                    ZERO    54,3

     1213     9853           /*
     1214     9854              CODE is unused
     1215     9855              USTK2$ must point to word 0 of a TCB and be in auto or static
     1216     9856              If USTK1$=ADDR(NIL) then we will use the TCB Descriptor in the MAGIC segment
     1217     9857           */
     1218     9858                                                /*                                    */
     1219     9859                                                /*                                    */
     1220     9860    1      CSTK$ = PINCRW(B_MPT.TCB$,B_MPT.TCB$->FTCB.CRFR);

   9860  1 002610   000004 470400 xsym               LDP0    B_MPT+4
         1 002611   000001 220100                    LDX0    1,,PR0
         1 002612   000000 636010                    EAQ     0,X0
         1 002613   000004 036000 xsym               ADLQ    B_MPT+4
         1 002614   200007 756100                    STQ     CSTK$,,AUTO

     1221     9861    1      TO$=USTK1$;

   9861  1 002615   200004 471500                    LDP1    @USTK1$,,AUTO
         1 002616   100000 236100                    LDQ     0,,PR1
         1 002617   200011 756100                    STQ     TO$,,AUTO

     1222     9862    1      FROM$=USTK2$;

   9862  1 002620   200005 473500                    LDP3    @USTK2$,,AUTO
         1 002621   300000 236100                    LDQ     0,,PR3
         1 002622   200012 756100                    STQ     FROM$,,AUTO

     1223     9863    1      FRMSZ=FROM$->FTCB.CRSZ;

   9863  1 002623   200012 474500                    LDP4    FROM$,,AUTO
         1 002624   400002 236100                    LDQ     2,,PR4
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:182  
         1 002625   000022 736000                    QLS     18
         1 002626   000022 732000                    QRS     18
         1 002627   200013 756100                    STQ     FRMSZ,,AUTO

     1224     9864    1      FROM$=PINCRW(FROM$,FROM$->FTCB.CRFR);

   9864  1 002630   400001 221100                    LDX1    1,,PR4
         1 002631   000000 636011                    EAQ     0,X1
         1 002632   200012 036100                    ADLQ    FROM$,,AUTO
         1 002633   200012 756100                    STQ     FROM$,,AUTO

     1225     9865    1      USTK2$=FROM$;

   9865  1 002634   300000 756100                    STQ     0,,PR3

     1226     9866    1      CALL UEP$TCBTCB ALTRET(MVTCB_ALT);

   9866  1 002635   002711 701000 1                  TSX1    UEP$TCBTCB
         1 002636   002640 702000 1                  TSX2    MVTCB_ALT

     1227     9867    1      RETURN;

   9867  1 002637   000000 702200 xent               TSX2  ! X66_ARET

   9865  1 002640                       MVTCB_ALT    null
     1228     9868    1   MVTCB_ALT: ;
     1229     9869    1      B$JIT.ERR = EJTCBFULL;

   9869  1 002640   000017 236000 0                  LDQ     EJTCBFULL
         1 002641   000000 470400 xsym               LDP0    B$JIT$
         1 002642   000012 756100                    STQ     10,,PR0

     1230     9870        /*E*     ERROR: UEJ-E$TCBFULL-E
     1231     9871                 MESSAGE: Debugger TCB full.  Can't enter debugger for SAVE/GET user XCON.
     1232     9872        */
     1233     9873    1      ALTRETURN;

PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:183  
   9873  1 002643   000000 702200 xent               TSX2  ! X66_AALT

     1234     9874                                                /*                                    */
     1235     9875        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:184  
     1236     9876
     1237     9877        /*D*   NAME: DTCB_UTCB.
     1238     9878
     1239     9879               PURPOSE: To move the copy of the user's TCB frame on the
     1240     9880                        Debugger's TCB to the user's TCB.
     1241     9881
     1242     9882        */
     1243     9883
     1244     9884    1   DTCB_UTCB: PROC;

   9884  1 002644   200054 741300       DTCB_UTCB    STX1  ! AUTO_DRTNV+4,,AUTO

     1245     9885    3      DO INHIBIT;

     1246     9886    3           B$LS$->B$MLS.MISC2=B_MPT.TCBDESC$->B$$DESCR;

   9886  1 002645   000012 470600 xsym               LDP0  ! B_MPT+10
         1 002646   000000 471600 xsym               LDP1  ! B$LS$
         1 002647   000100 100700                    MLR   ! fill='000'O
         1 002650   000000 000010                    ADSC9   0,,PR0                   cn=0,n=8
         1 002651   100260 000010                    ADSC9   176,,PR1                 cn=0,n=8

     1247     9887    3           TO$ = ADDR(NIL);                /* MEANS GET FRAME IN TCB             */

   9887  1 002652   000001 236200 xsym               LDQ   ! B_VECTNIL+1
         1 002653   200011 756300                    STQ   ! TO$,,AUTO

     1248     9888    3           FROM$ = PINCRW(B$MISC2$,B$MISC2$->FTCB.CRFR);

   9888  1 002654   000000 473600 xsym               LDP3  ! B$MISC2$
         1 002655   300001 220300                    LDX0  ! 1,,PR3
         1 002656   000000 636210                    EAQ   ! 0,X0
         1 002657   000000 036200 xsym               ADLQ  ! B$MISC2$
         1 002660   200012 756300                    STQ   ! FROM$,,AUTO

     1249     9889    3           CALL UDN$MAGICLS;

PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:185  
   9889  1 002661   000002 631600 xsym               EPPR1 ! B_VECTNIL+2
         1 002662   000000 701200 xent               TSX1  ! UDN$MAGICLS
         1 002663   000000 011200                    NOP   ! 0

     1250     9890    3           CSTK$ = PINCRW(B_MPT.TCB$,B_MPT.TCB$->FTCB.CRFR);

   9890  1 002664   000004 470600 xsym               LDP0  ! B_MPT+4
         1 002665   000001 220300                    LDX0  ! 1,,PR0
         1 002666   000000 636210                    EAQ   ! 0,X0
         1 002667   000004 036200 xsym               ADLQ  ! B_MPT+4
         1 002670   200007 756300                    STQ   ! CSTK$,,AUTO

     1251     9891                                                /* Remember ECCB.XCONF new flags      */
     1252     9892    3           CALL UEP$TCBTCB ALTRET(FULL_TCB);

   9892  1 002671   002711 701200 1                  TSX1  ! UEP$TCBTCB
         1 002672   002675 702200 1                  TSX2  ! FULL_TCB

     1253     9893    3           END;                            /* INHIBIT                            */

     1254     9894    2      RETURN;

   9894  1 002673   200054 221300                    LDX1  ! AUTO_DRTNV+4,,AUTO
         1 002674   000001 702211                    TSX2  ! 1,X1

   9892  1 002675                       FULL_TCB     null
     1255     9895
     1256     9896    2   FULL_TCB: ;
     1257     9897    2      B$JIT.SVLDTF='000'O;

   9897  1 002675   000000 470400 xsym               LDP0    B$JIT$
         1 002676   000000 236003                    LDQ     0,DU
         1 002677   000316 552104                    STBQ    206,'04'O,PR0

     1258     9898    2      B$JIT.ERR = EDTCBFULL;

   9898  1 002700   000016 236000 0                  LDQ     EDTCBFULL
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:186  
         1 002701   000012 756100                    STQ     10,,PR0

     1259     9899        /*E*     ERROR: UED-E$TCBFULL-E
     1260     9900                 MESSAGE: Can't give you control, your TCB is full.
     1261     9901                 MESSAGE1: The user's TCB is full, so DELTA cannot pass control
     1262     9902                           to the user's exceptional condition handling routine.
     1263     9903                 MESSAGE7: Can't give you control, your TCB is full.
     1264     9904        */
     1265     9905        /*E*     ERROR:      -E$TCBFULL-E
     1266     9906                 MESSAGE: A300 YOUR TCB IS FULL OR NOT THERE
     1267     9907        */
     1268     9908        /* E$TCBFULL is reported under three different conditions
     1269     9909           in module UEP$PMME.  Because it is confusing to not have
     1270     9910           an explicit message for each of the three, a different
     1271     9911           MID was used for each.  Although not legal use of FCG/MID,
     1272     9912           it does give the user the info he needs.  Note that there
     1273     9913           currently are no modules with a UED or UEJ prefix.  If
     1274     9914           ever there should be, a different phony MID should be used
     1275     9915           in the error codes here.
     1276     9916        */
     1277     9917    2      CALL RUND_DELTA;

   9917  1 002702   003520 701000 1                  TSX1    RUND_DELTA
         1 002703   000000 011000                    NOP     0

     1278     9918    2      CALL JSE$ABORTM;

   9918  1 002704   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 002705   000000 701000 xent               TSX1    JSE$ABORTM
         1 002706   000000 011000                    NOP     0

     1279     9919    2   END;

   9919  1 002707   200054 221300                    LDX1  ! AUTO_DRTNV+4,,AUTO
         1 002710   000001 702211                    TSX2  ! 1,X1

     1280     9920        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:187  
     1281     9921                                           /****************************************/
     1282     9922                                                /*              UEP$TCBTCB            */
     1283     9923                                           /****************************************/
     1284     9924    1   UEP$TCBTCB: PROC ALTRET;

   9924  1 002711   200056 741300       UEP$TCBTCB   STX1  ! AUTO_DRTNV+6,,AUTO

     1285     9925    2   DCL CHFRSZ UBIN;
     1286     9926    2   DCL FRVAR CHAR(CHFRSZ) BASED;
     1287     9927    3      DO INHIBIT;

     1288     9928    4           IF TO$=ADDR(NIL) THEN DO;

   9928  1 002712   200011 236300                    LDQ   ! TO$,,AUTO
         1 002713   000001 116200 xsym               CMPQ  ! B_VECTNIL+1
         1 002714   002747 601200 1                  TNZ   ! s:9936

     1289     9929    4                IF B$TCB.TCBAVSZ < FRMSZ THEN ALTRETURN;

   9929  1 002715   000004 470600 xsym               LDP0  ! B_MPT+4
         1 002716   000002 236300                    LDQ   ! 2,,PR0
         1 002717   000022 772200                    QRL   ! 18
         1 002720   200013 116300                    CMPQ  ! FRMSZ,,AUTO
         1 002721   002723 603200 1                  TRC   ! s:9930

   9929  1 002722   000000 702211                    TSX2  ! 0,X1

     1290     9930    4                TO$=PINCRW(CSTK$,B_MPT.TCB$->FTCB.CRSZ);

   9930  1 002723   000002 720300                    LXL0  ! 2,,PR0
         1 002724   000000 636210                    EAQ   ! 0,X0
         1 002725   200007 036300                    ADLQ  ! CSTK$,,AUTO
         1 002726   200011 756300                    STQ   ! TO$,,AUTO

     1291     9931    4                B$TCB.STK$ = PINCRW(B$TCB.STK$,B_MPT.TCB$->FTCB.CRSZ);

   9931  1 002727   000001 471700                    LDP1  ! 1,,PR0
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:188  
         1 002730   100000 633710                    EPPR3 ! 0,X0,PR1
         1 002731   000001 453700                    STP3  ! 1,,PR0

     1292     9932    4                TO$->B$EXCFR.PREVSZ = B$TCB.CURRSZ;

   9932  1 002732   000004 470600 xsym               LDP0  ! B_MPT+4
         1 002733   000002 720300                    LXL0  ! 2,,PR0
         1 002734   200011 471700                    LDP1  ! TO$,,AUTO
         1 002735   100000 740300                    STX0  ! 0,,PR1

     1293     9933    4                B$TCB.CURRSZ = FRMSZ;

   9933  1 002736   200013 721300                    LXL1  ! FRMSZ,,AUTO
         1 002737   000004 470600 xsym               LDP0  ! B_MPT+4
         1 002740   000002 441300                    SXL1  ! 2,,PR0

     1294     9934    4                B$TCB.TCBAVSZ = B$TCB.TCBAVSZ-FRMSZ;

   9934  1 002741   000004 470600 xsym               LDP0  ! B_MPT+4
         1 002742   000002 236300                    LDQ   ! 2,,PR0
         1 002743   000022 772200                    QRL   ! 18
         1 002744   200013 136300                    SBLQ  ! FRMSZ,,AUTO
         1 002745   000000 620206                    EAX0  ! 0,QL
         1 002746   000002 740300                    STX0  ! 2,,PR0

     1295     9935    4                END;

     1296     9936    3           CHFRSZ = FRMSZ * 4 - 4;

   9936  1 002747   200013 235300                    LDA   ! FRMSZ,,AUTO
         1 002750   000002 735200                    ALS   ! 2
         1 002751   000004 135207                    SBLA  ! 4,DL
         1 002752   200057 755300                    STA   ! CHFRSZ,,AUTO

     1297     9937        /*       LEAVE WORD 0 ALONE */
     1298     9938    3           PINCRW ( TO$ , 1 ) -> FRVAR = PINCRW ( FROM$ , 1 ) -> FRVAR;

PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:189  
   9938  1 002753   200012 470700                    LDP0  ! FROM$,,AUTO
         1 002754   000000 620205                    EAX0  ! 0,AL
         1 002755   200011 471700                    LDP1  ! TO$,,AUTO
         1 002756   200057 721300                    LXL1  ! CHFRSZ,,AUTO
         1 002757   040140 100740                    MLR   ! fill='040'O
         1 002760   000001 000010                    ADSC9   1,,PR0                   cn=0,n=*X0
         1 002761   100001 000011                    ADSC9   1,,PR1                   cn=0,n=*X1

     1299     9939                                                /**/
     1300     9940    3           TO$->B$EXCFR.ECC = FROM$->B$EXCFR.ECC;

   9940  1 002762   000000 720300                    LXL0  ! 0,,PR0
         1 002763   100000 440300                    SXL0  ! 0,,PR1

     1301     9941    3           RETURN;

   9941  1 002764   200056 221300                    LDX1  ! AUTO_DRTNV+6,,AUTO
         1 002765   000001 702211                    TSX2  ! 1,X1

     1302     9942    3           END;                            /* INHIBIT                            */

     1303     9943    2   END;

   9943  1 002766   000001 702211                    TSX2  ! 1,X1

     1304     9944        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:190  
     1305     9945                                           /****************************************/
     1306     9946                                                /*              UEP$TCBSSF            */
     1307     9947                                           /****************************************/
     1308     9948    1   UEP$TCBSSF: PROC;

   9948  1 002767   200056 741300       UEP$TCBSSF   STX1  ! AUTO_DRTNV+6,,AUTO

     1309     9949    2      TO$ = PINCRW(B_MPT.SS$,1);

   9949  1 002770   000000 236000 xsym               LDQ     B_MPT
         1 002771   000001 036003                    ADLQ    1,DU
         1 002772   200011 756100                    STQ     TO$,,AUTO

     1310     9950    2      FROM$ = PINCRW(STK$,1);

   9950  1 002773   200010 236100                    LDQ     STK$,,AUTO
         1 002774   000001 036003                    ADLQ    1,DU
         1 002775   200012 756100                    STQ     FROM$,,AUTO

     1311     9951    2      TO$->FR63 = FROM$->FR63;

   9951  1 002776   200012 470500                    LDP0    FROM$,,AUTO
         1 002777   200011 471500                    LDP1    TO$,,AUTO
         1 003000   000100 100500                    MLR     fill='000'O
         1 003001   000000 000374                    ADSC9   0,,PR0                   cn=0,n=252
         1 003002   100000 000374                    ADSC9   0,,PR1                   cn=0,n=252

     1312     9952    2      RETURN;

   9952  1 003003   200056 221300                    LDX1  ! AUTO_DRTNV+6,,AUTO
         1 003004   000001 702211                    TSX2  ! 1,X1

     1313     9953    2   END;
     1314     9954        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:191  
     1315     9955                                           /****************************************/
     1316     9956                                                /*              CLEAR_ONE             */
     1317     9957                                           /****************************************/
     1318     9958    1   CLEARONE: PROC ALTRET;                  /*REMOVES TOP STACK FRAME             */

   9958  1 003005   200060 741300       CLEARONE     STX1  ! CHFRSZ+1,,AUTO

     1319     9959    2      IF B$TCB.CURRSZ=0 THEN ALTRETURN;

   9959  1 003006   000004 470400 xsym               LDP0    B_MPT+4
         1 003007   000002 720100                    LXL0    2,,PR0
         1 003010   003012 601000 1                  TNZ     s:9960

   9959  1 003011   000000 702211                    TSX2  ! 0,X1

     1320     9960    2      B$TCB.TCBAVSZ = B$TCB.TCBAVSZ + B$TCB.CURRSZ;

   9960  1 003012   000002 236100                    LDQ     2,,PR0
         1 003013   777777 376007                    ANQ     -1,DL
         1 003014   200062 756100                    STQ     CHFRSZ+3,,AUTO
         1 003015   000002 236100                    LDQ     2,,PR0
         1 003016   000022 772000                    QRL     18
         1 003017   200062 036100                    ADLQ    CHFRSZ+3,,AUTO
         1 003020   000000 620006                    EAX0    0,QL
         1 003021   000002 740100                    STX0    2,,PR0

     1321     9961    2      B$TCB.CURRSZ = CSTK$->B$EXCFR.PREVSZ;

   9961  1 003022   200007 470500                    LDP0    CSTK$,,AUTO
         1 003023   000000 220100                    LDX0    0,,PR0
         1 003024   000004 471400 xsym               LDP1    B_MPT+4
         1 003025   100002 440100                    SXL0    2,,PR1

     1322     9962    2      IF B$TCB.CURRSZ = 0 THEN RETURN;

   9962  1 003026   000004 471400 xsym               LDP1    B_MPT+4
         1 003027   100002 720100                    LXL0    2,,PR1
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:192  
         1 003030   003033 601000 1                  TNZ     s:9963

   9962  1 003031   200060 221300                    LDX1  ! CHFRSZ+1,,AUTO
         1 003032   000001 702211                    TSX2  ! 1,X1

     1323     9963    2      B$TCB.STK$ = PINCRW(B$TCB.STK$,-B$TCB.CURRSZ);

   9963  1 003033   100001 473500                    LDP3    1,,PR1
         1 003034   777777 620010                    EAX0    -1,X0
         1 003035   777777 660003                    ERX0    -1,DU
         1 003036   300000 634510                    EPPR4   0,X0,PR3
         1 003037   100001 454500                    STP4    1,,PR1

     1324     9964    2      CSTK$ = PINCRW(B_MPT.TCB$,B_MPT.TCB$->FTCB.CRFR);

   9964  1 003040   000004 471400 xsym               LDP1    B_MPT+4
         1 003041   100001 220100                    LDX0    1,,PR1
         1 003042   000000 636010                    EAQ     0,X0
         1 003043   000004 036000 xsym               ADLQ    B_MPT+4
         1 003044   200007 756100                    STQ     CSTK$,,AUTO

     1325     9965    2      RETURN;

   9965  1 003045   200060 221300                    LDX1  ! CHFRSZ+1,,AUTO
         1 003046   000001 702211                    TSX2  ! 1,X1

     1326     9966    2   END;
     1327     9967        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:193  
     1328     9968                                           /****************************************/
     1329     9969                                                /*              CHECK_FPT             */
     1330     9970                                           /****************************************/
     1331     9971    1   CHECK_FPT: PROC ALTRET;

   9971  1 003047   200056 741300       CHECK_FPT    STX1  ! AUTO_DRTNV+6,,AUTO

     1332     9972    2      IF B_MPT.PSDESC$->B$$DESCR.BOUND = 0 THEN RETURN;

   9972  1 003050   000011 470400 xsym               LDP0    B_MPT+9
         1 003051   000000 236100                    LDQ     0,,PR0
         1 003052   000034 316000 xsym               CANQ    B_VECTNIL+28
         1 003053   003055 601000 1                  TNZ     s:9973

   9972  1 003054   000001 702211                    TSX2  ! 1,X1

     1333     9973    2      I=1;

   9973  1 003055   000001 235007                    LDA     1,DL
         1 003056   200014 755100                    STA     I,,AUTO

     1334     9974    2      CALL HFF$NILERASE(I) ALTRET(NO_PRC);

   9974  1 003057   200014 631500                    EPPR1   I,,AUTO
         1 003060   200062 451500                    STP1    CHFRSZ+3,,AUTO
         1 003061   200062 630500                    EPPR0   CHFRSZ+3,,AUTO
         1 003062   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003063   000000 701000 xent               TSX1    HFF$NILERASE
         1 003064   003124 702000 1                  TSX2    NO_PRC

     1335     9975    3      DO I=0 TO 7;

   9975  1 003065   200014 450100                    STZ     I,,AUTO

     1336     9976    3           IF (B$PS1$->B$PTRS.SEGID(I) >  %MAXUSERSID) OR (B$PS1$->B$PTRS.SEGID(I) < %
              9976                    AS0SID) OR

PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:194  
   9976  1 003066   000000 470400 xsym               LDP0    B$PS1$
         1 003067   200014 720100                    LXL0    I,,AUTO
         1 003070   000000 236110                    LDQ     0,X0,PR0
         1 003071   007777 376007                    ANQ     4095,DL
         1 003072   006034 116007                    CMPQ    3100,DL
         1 003073   003075 600000 1                  TZE     s:9976+7
         1 003074   003112 603000 1                  TRC     s:9979
         1 003075   000000 236110                    LDQ     0,X0,PR0
         1 003076   007777 376007                    ANQ     4095,DL
         1 003077   004000 116007                    CMPQ    2048,DL
         1 003100   003112 602000 1                  TNC     s:9979
         1 003101   000000 236110                    LDQ     0,X0,PR0
         1 003102   007777 376007                    ANQ     4095,DL
         1 003103   004200 116007                    CMPQ    2176,DL
         1 003104   003117 602000 1                  TNC     s:9987
         1 003105   003117 600000 1                  TZE     s:9987
         1 003106   000000 236110                    LDQ     0,X0,PR0
         1 003107   007777 376007                    ANQ     4095,DL
         1 003110   006000 116007                    CMPQ    3072,DL
         1 003111   003117 603000 1                  TRC     s:9987

     1337     9977    3             (B$PS1$->B$PTRS.SEGID(I) > %AS64SID AND B$PS1$->B$PTRS.SEGID(I) < %ISSID)
     1338     9978    4           THEN DO;

     1339     9979    4                B$JIT.ERR=EBADPTR;

   9979  1 003112   000020 236000 0                  LDQ     EBADPTR
         1 003113   000000 471400 xsym               LDP1    B$JIT$
         1 003114   100012 756100                    STQ     10,,PR1

     1340     9980    4                ALTRETURN;

   9980  1 003115   200056 221300                    LDX1  ! AUTO_DRTNV+6,,AUTO
         1 003116   000000 702211                    TSX2  ! 0,X1

     1341     9981    4                END;
     1342     9982        /*E*     ERROR:  UEP-E$BADPTR-E
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:195  
     1343     9983          MESSAGE: Bad pointer specified on M$TRTN or M$RETRY.
     1344     9984          MESSAGE1: The SEGID of a pointer specified via the DRS option of M$TRTN or
     1345     9985                    M$RETRY must reference the Linkage Segment.
     1346     9986        */
     1347     9987    3           END;                            /* DO I=0 TO 7                        */

   9987  1 003117   200014 235100                    LDA     I,,AUTO
         1 003120   000001 035007                    ADLA    1,DL
         1 003121   200014 755100                    STA     I,,AUTO
         1 003122   000010 115007                    CMPA    8,DL
         1 003123   003066 602000 1                  TNC     s:9976

     1348     9988    2   NO_PRC: RETURN;

   9988  1 003124   200056 221300       NO_PRC       LDX1  ! AUTO_DRTNV+6,,AUTO
         1 003125   000001 702211                    TSX2  ! 1,X1

     1349     9989    2   END;
     1350     9990        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:196  
     1351     9991                                           /****************************************/
     1352     9992                                                /*              MERGE_DFPT            */
     1353     9993                                           /****************************************/
     1354     9994
     1355     9995    1   MERGE_DFPT: PROC;

   9995  1 003126   200054 741300       MERGE_DFPT   STX1  ! AUTO_DRTNV+4,,AUTO

     1356     9996
     1357     9997    3      DO WHILE (B$SS.ISR.WSR ~= CSTK$->B$SSX.ISR.WSR);

   9997  1 003127   200007 470500                    LDP0    CSTK$,,AUTO
         1 003130   000000 471400 xsym               LDP1    B_MPT
         1 003131   100010 236100                    LDQ     8,,PR1
         1 003132   000010 676100                    ERQ     8,,PR0
         1 003133   000160 376007                    ANQ     112,DL
         1 003134   003146 600000 1                  TZE     s:10000

     1358     9998    3           CALL JSS$BACKSS;

   9998  1 003135   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 003136   000000 701000 xent               TSX1    JSS$BACKSS
         1 003137   000000 011000                    NOP     0

     1359     9999    3           END;

   9999  1 003140   200007 470500                    LDP0    CSTK$,,AUTO
         1 003141   000000 471400 xsym               LDP1    B_MPT
         1 003142   100010 236100                    LDQ     8,,PR1
         1 003143   000010 676100                    ERQ     8,,PR0
         1 003144   000160 376007                    ANQ     112,DL
         1 003145   003135 601000 1                  TNZ     s:9998

     1360    10000    2      CALL UDN$MAGICRLS;

  10000  1 003146   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 003147   000000 701000 xent               TSX1    UDN$MAGICRLS
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:197  
         1 003150   000000 011000                    NOP     0

     1361    10001    2      CALL MERGE_FPT;

  10001  1 003151   003170 701000 1                  TSX1    MERGE_FPT
         1 003152   000000 011000                    NOP     0

     1362    10002    2      CSTK$->B$EXCFR.REGS=B$SS.REGS;

  10002  1 003153   000000 470400 xsym               LDP0    B_MPT
         1 003154   200007 471500                    LDP1    CSTK$,,AUTO
         1 003155   000100 100500                    MLR     fill='000'O
         1 003156   000050 000034                    ADSC9   40,,PR0                  cn=0,n=28
         1 003157   100050 000034                    ADSC9   40,,PR1                  cn=0,n=28

     1363    10003    2      CSTK$->B$EXCFR.PRS=B$SS.PR;

  10003  1 003160   000100 100500                    MLR     fill='000'O
         1 003161   000020 000040                    ADSC9   16,,PR0                  cn=0,n=32
         1 003162   100020 000040                    ADSC9   16,,PR1                  cn=0,n=32

     1364    10004    2      CSTK$->B$EXCFR.DRS=B$SS.DR;

  10004  1 003163   000100 100500                    MLR     fill='000'O
         1 003164   000030 000100                    ADSC9   24,,PR0                  cn=0,n=64
         1 003165   100030 000100                    ADSC9   24,,PR1                  cn=0,n=64

     1365    10005    2      RETURN;

  10005  1 003166   200054 221300                    LDX1  ! AUTO_DRTNV+4,,AUTO
         1 003167   000001 702211                    TSX2  ! 1,X1

     1366    10006    2   END;
     1367    10007        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:198  
     1368    10008                                           /****************************************/
     1369    10009                                                /*              MERGE_FPT             */
     1370    10010                                           /****************************************/
     1371    10011    1   MERGE_FPT: PROC ALTRET;

  10011  1 003170   200056 741300       MERGE_FPT    STX1  ! AUTO_DRTNV+6,,AUTO

     1372    10012    2      I=0;

  10012  1 003171   200014 450100                    STZ     I,,AUTO

     1373    10013    2      CALL HFF$NILERASE(I) ALTRET(NO_REGS);

  10013  1 003172   200014 630500                    EPPR0   I,,AUTO
         1 003173   200062 450500                    STP0    CHFRSZ+3,,AUTO
         1 003174   200062 630500                    EPPR0   CHFRSZ+3,,AUTO
         1 003175   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003176   000000 701000 xent               TSX1    HFF$NILERASE
         1 003177   003205 702000 1                  TSX2    NO_REGS

     1374    10014    2      B$SS.REGS = B$PS0$->FPTREGS;

  10014  1 003200   000000 470400 xsym               LDP0    B$PS0$
         1 003201   000000 471400 xsym               LDP1    B_MPT
         1 003202   000100 100500                    MLR     fill='000'O
         1 003203   000000 000034                    ADSC9   0,,PR0                   cn=0,n=28
         1 003204   100050 000034                    ADSC9   40,,PR1                  cn=0,n=28

  10014  1 003205                       NO_REGS      null
     1375    10015    2   NO_REGS: ;
     1376    10016    2      I=1;

  10016  1 003205   000001 235007                    LDA     1,DL
         1 003206   200014 755100                    STA     I,,AUTO

     1377    10017    2      CALL HFF$NILERASE(I) ALTRET(NO_DRS);

PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:199  
  10017  1 003207   200014 630500                    EPPR0   I,,AUTO
         1 003210   200062 450500                    STP0    CHFRSZ+3,,AUTO
         1 003211   200062 630500                    EPPR0   CHFRSZ+3,,AUTO
         1 003212   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003213   000000 701000 xent               TSX1    HFF$NILERASE
         1 003214   003222 702000 1                  TSX2    NO_DRS

     1378    10018    2      B$SS.PR = B$PS1$ -> PRS;

  10018  1 003215   000000 470400 xsym               LDP0    B$PS1$
         1 003216   000000 471400 xsym               LDP1    B_MPT
         1 003217   000100 100500                    MLR     fill='000'O
         1 003220   000000 000040                    ADSC9   0,,PR0                   cn=0,n=32
         1 003221   100020 000040                    ADSC9   16,,PR1                  cn=0,n=32

  10018  1 003222                       NO_DRS       null
     1379    10019    2   NO_DRS: ;                               /* REFRESH DRS WITH LSEG SID          */
     1380    10020    2      TO$=ADDR(B$SS.PR);

  10020  1 003222   000000 236000 xsym               LDQ     B_MPT
         1 003223   000020 036003                    ADLQ    16,DU
         1 003224   200011 756100                    STQ     TO$,,AUTO

     1381    10021    3      DO I=0 TO 7;

  10021  1 003225   200014 450100                    STZ     I,,AUTO

     1382    10022    3           IF (TO$->B$PTRS.S.SEG_TYPE(I) & '01'B) = '01'B

  10022  1 003226   200011 470500                    LDP0    TO$,,AUTO
         1 003227   200014 720100                    LXL0    I,,AUTO
         1 003230   000000 236110                    LDQ     0,X0,PR0
         1 003231   000030 736000                    QLS     24
         1 003232   600000 376003                    ANQ     -65536,DU
         1 003233   200000 376003                    ANQ     65536,DU
         1 003234   200000 116003                    CMPQ    65536,DU
         1 003235   003266 601000 1                  TNZ     s:10032
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:200  

     1383    10023    4           THEN DO;

     1384    10024    4                J=TO$->B$PTRS.S.DESCR#(I);

  10024  1 003236   000000 236110                    LDQ     0,X0,PR0
         1 003237   001777 376007                    ANQ     1023,DL
         1 003240   200015 756100                    STQ     J,,AUTO

     1385    10025        /* If it is a super descriptor then only move the first word */
     1386    10026    4                IF B$SS.DR.WORD1.TYP(I) = 4 OR B$SS.DR.WORD1.TYP(I) = 6

  10026  1 003241   200014 235100                    LDA     I,,AUTO
         1 003242   000001 735000                    ALS     1
         1 003243   000000 471400 xsym               LDP1    B_MPT
         1 003244   100030 236105                    LDQ     24,AL,PR1
         1 003245   000017 376007                    ANQ     15,DL
         1 003246   000004 116007                    CMPQ    4,DL
         1 003247   003252 600000 1                  TZE     s:10028
         1 003250   000006 116007                    CMPQ    6,DL
         1 003251   003260 601000 1                  TNZ     s:10030

     1387    10027    4                THEN
     1388    10028    4                     B$SS.DR.WORD1(I)=B_MPT.LS$->B$DESEG(J);

  10028  1 003252   200015 236100                    LDQ     J,,AUTO
         1 003253   000001 736000                    QLS     1
         1 003254   000001 473400 xsym               LDP3    B_MPT+1
         1 003255   300000 236106                    LDQ     0,QL,PR3
         1 003256   100030 756105                    STQ     24,AL,PR1
         1 003257   003266 710000 1                  TRA     s:10032

     1389    10029    4                ELSE
     1390    10030    4                     B$SS.DR(I)=B_MPT.LS$->B$DESEG(J);

  10030  1 003260   200015 236100                    LDQ     J,,AUTO
         1 003261   000001 736000                    QLS     1
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:201  
         1 003262   000001 473400 xsym               LDP3    B_MPT+1
         1 003263   000000 621005                    EAX1    0,AL
         1 003264   300000 237106                    LDAQ    0,QL,PR3
         1 003265   100030 757111                    STAQ    24,X1,PR1

     1391    10031    4                END;

     1392    10032    3           END;

  10032  1 003266   200014 235100                    LDA     I,,AUTO
         1 003267   000001 035007                    ADLA    1,DL
         1 003270   200014 755100                    STA     I,,AUTO
         1 003271   000010 115007                    CMPA    8,DL
         1 003272   003226 602000 1                  TNC     s:10022

     1393    10033    2      IF B_MPT.PSDESC$->B$$DESCR.BOUND = 0 THEN ALTRETURN;

  10033  1 003273   000011 471400 xsym               LDP1    B_MPT+9
         1 003274   100000 236100                    LDQ     0,,PR1
         1 003275   000034 316000 xsym               CANQ    B_VECTNIL+28
         1 003276   003301 601000 1                  TNZ     s:10034

  10033  1 003277   200056 221300                    LDX1  ! AUTO_DRTNV+6,,AUTO
         1 003300   000000 702211                    TSX2  ! 0,X1

     1394    10034    2      RETURN;

  10034  1 003301   200056 221300                    LDX1  ! AUTO_DRTNV+6,,AUTO
         1 003302   000001 702211                    TSX2  ! 1,X1

     1395    10035    2   END;
     1396    10036        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:202  
     1397    10037                                           /****************************************/
     1398    10038                                                /*   SET_IRIC                         */
     1399    10039                                           /****************************************/
     1400    10040    1   SET_IRIC: PROC;

  10040  1 003303   200054 741300       SET_IRIC     STX1  ! AUTO_DRTNV+4,,AUTO

     1401    10041    2      IF B$PS2$->FPTV.IC ~= 0

  10041  1 003304   000000 470400 xsym               LDP0    B$PS2$
         1 003305   000000 220100                    LDX0    0,,PR0
         1 003306   003311 600000 1                  TZE     s:10044

     1402    10042    2      THEN B$SS.IC=B$PS2$->FPTV.IC;

  10042  1 003307   000000 471400 xsym               LDP1    B_MPT
         1 003310   100004 740100                    STX0    4,,PR1

     1403    10043                                                /*                                    */
     1404    10044    2      IF (B$PS2$->FPTV.SETIR)

  10044  1 003311   000001 234100                    SZN     1,,PR0
         1 003312   003326 605000 1                  TPL     s:10051

     1405    10045    3      THEN DO;

     1406    10046    3           IF B$SS.IR.MIR = '1'B

  10046  1 003313   000000 471400 xsym               LDP1    B_MPT
         1 003314   100004 236100                    LDQ     4,,PR1
         1 003315   000040 316007                    CANQ    32,DL
         1 003316   003323 600000 1                  TZE     s:10048

     1407    10047    3           THEN B$SS.IR=(B$PS2$->FPTV.IR & '777770'O);

  10047  1 003317   000000 720100                    LXL0    0,,PR0
         1 003320   777770 360003                    ANX0    -8,DU
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:203  
         1 003321   100004 440100                    SXL0    4,,PR1
         1 003322   003326 710000 1                  TRA     s:10051

     1408    10048    3           ELSE B$SS.IR=(B$PS2$->FPTV.IR & '777730'O);

  10048  1 003323   000000 720100                    LXL0    0,,PR0
         1 003324   777730 360003                    ANX0    -40,DU
         1 003325   100004 440100                    SXL0    4,,PR1

     1409    10049    3           END;

     1410    10050                                                /*                                    */
     1411    10051    2      IF NOT (B$JIT.PRIV.ACTIVE & %PR_TND#)

  10051  1 003326   000000 471400 xsym               LDP1    B$JIT$
         1 003327   100013 236100                    LDQ     11,,PR1
         1 003330   000042 376000 0                  ANQ     EASLERR+2
         1 003331   003335 601000 1                  TNZ     s:10054

     1412    10052    2      THEN B$SS.IR.PM='0'B;

  10052  1 003332   000000 473400 xsym               LDP3    B_MPT
         1 003333   000036 236000 2                  LDQ     30
         1 003334   300004 356100                    ANSQ    4,,PR3

     1413    10053                                                /*                                    */
     1414    10054    2      IF NOT (B$JIT.PRIV.ACTIVE & %PR_MSYS#)

  10054  1 003335   100013 236100                    LDQ     11,,PR1
         1 003336   000012 376000 xsym               ANQ     B_VECTNIL+10
         1 003337   003343 601000 1                  TNZ     s:10057

     1415    10055    2      THEN B$SS.IR.MMODE='0'B;

  10055  1 003340   000000 473400 xsym               LDP3    B_MPT
         1 003341   000037 236000 2                  LDQ     31
         1 003342   300004 356100                    ANSQ    4,,PR3
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:204  

     1416    10056                                                /*                                    */
     1417    10057    2      IF B$SS.IC ~= EXCFR_IC

  10057  1 003343   000000 473400 xsym               LDP3    B_MPT
         1 003344   300004 220100                    LDX0    4,,PR3
         1 003345   200027 100100                    CMPX0   EXCFR_IC,,AUTO
         1 003346   003351 600000 1                  TZE     s:10060

     1418    10058    2      THEN B$SS.IR.MIR='0'B;

  10058  1 003347   000034 236000 2                  LDQ     28
         1 003350   300004 356100                    ANSQ    4,,PR3

     1419    10059                                                /*                                    */
     1420    10060    2      IF B$SS.IR.MIR = '0'B

  10060  1 003351   300004 236100                    LDQ     4,,PR3
         1 003352   000040 316007                    CANQ    32,DL
         1 003353   003356 601000 1                  TNZ     s:10063

     1421    10061    2      THEN B$SS.CPUREQ = '0'B;

  10061  1 003354   000035 236000 2                  LDQ     29
         1 003355   300006 356100                    ANSQ    6,,PR3

     1422    10062                                                /*                                    */
     1423    10063    2      RETURN;

  10063  1 003356   200054 221300                    LDX1  ! AUTO_DRTNV+4,,AUTO
         1 003357   000001 702211                    TSX2  ! 1,X1

     1424    10064    2   END;
     1425    10065        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:205  
     1426    10066                                           /****************************************/
     1427    10067                                                /*              DO_MERC               */
     1428    10068                                           /****************************************/
     1429    10069    1   DO_MERC: PROC ALTRET;

  10069  1 003360   200054 741300       DO_MERC      STX1  ! AUTO_DRTNV+4,,AUTO

     1430    10070    2      B$SS.ALT = '0'B;

  10070  1 003361   000000 470400 xsym               LDP0    B_MPT
         1 003362   000031 236000 xsym               LDQ     B_VECTNIL+25
         1 003363   000001 356100                    ANSQ    1,,PR0

     1431    10071    3      IF ECP.ECCS~=%SC_TRTN# THEN DO;

  10071  1 003364   200021 720100                    LXL0    ECP,,AUTO
         1 003365   000001 100003                    CMPX0   1,DU
         1 003366   003400 600000 1                  TZE     s:10075

     1432    10072    3           CALL HFF$NILERASE(0) ALTRET(NO_MERC_FPT);

  10072  1 003367   000003 630400 2                  EPPR0   3
         1 003370   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003371   000000 701000 xent               TSX1    HFF$NILERASE
         1 003372   003402 702000 1                  TSX2    NO_MERC_FPT

     1433    10073    3           STK$->B$EXCFR.ERR = B$PS0$->MPARAM.ERR;

  10073  1 003373   000000 470400 xsym               LDP0    B$PS0$
         1 003374   000000 236100                    LDQ     0,,PR0
         1 003375   200010 471500                    LDP1    STK$,,AUTO
         1 003376   100102 756100                    STQ     66,,PR1

     1434    10074    3           END;

  10074  1 003377   003402 710000 1                  TRA     NO_MERC_FPT

PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:206  
     1435    10075    2      ELSE STK$->B$EXCFR.ERR = '0'B;

  10075  1 003400   200010 471500                    LDP1    STK$,,AUTO
         1 003401   100102 450100                    STZ     66,,PR1

  10071  1 003402                       NO_MERC_FPT  null
     1436    10076    2   NO_MERC_FPT: ;
     1437    10077    2      IF (STK$->B$EXCFR.ERR.SEV=0) AND (STK$->B$EXCFR.ECC ~= %ECC_XCON#)

  10077  1 003402   200010 470500                    LDP0    STK$,,AUTO
         1 003403   000102 236100                    LDQ     66,,PR0
         1 003404   000007 316007                    CANQ    7,DL
         1 003405   003452 601000 1                  TNZ     s:10090
         1 003406   000000 720100                    LXL0    0,,PR0
         1 003407   000003 100003                    CMPX0   3,DU
         1 003410   003452 600000 1                  TZE     s:10090

     1438    10078    3      THEN DO;

     1439    10079    3           IF STK$->B$SSX.ISR.WSR ~= B$SS.ISR.WSR

  10079  1 003411   000000 471400 xsym               LDP1    B_MPT
         1 003412   000010 236100                    LDQ     8,,PR0
         1 003413   100010 676100                    ERQ     8,,PR1
         1 003414   000160 376007                    ANQ     112,DL
         1 003415   003427 600000 1                  TZE     s:10085

     1440    10080    4           THEN DO;

     1441    10081    4                CALL UDB$CALCOMP;

  10081  1 003416   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 003417   000000 701000 xent               TSX1    UDB$CALCOMP
         1 003420   000000 011000                    NOP     0

     1442    10082    4                CALL JSS$RUNDSPC;

PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:207  
  10082  1 003421   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 003422   000000 701000 xent               TSX1    JSS$RUNDSPC
         1 003423   000000 011000                    NOP     0

     1443    10083    4                CALL UDB$AUTO;

  10083  1 003424   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 003425   000000 701000 xent               TSX1    UDB$AUTO
         1 003426   000000 011000                    NOP     0

     1444    10084    4                END;

     1445    10085    3           CALL UEP$TCBSSF;

  10085  1 003427   002767 701000 1                  TSX1    UEP$TCBSSF
         1 003430   000000 011000                    NOP     0

     1446    10086    3           IF STK$->B$EXCFR.ECC = 99 THEN B$SS.IC = B$SS.IC+3;

  10086  1 003431   200010 470500                    LDP0    STK$,,AUTO
         1 003432   000000 720100                    LXL0    0,,PR0
         1 003433   000143 100003                    CMPX0   99,DU
         1 003434   003441 601000 1                  TNZ     s:10087

  10086  1 003435   000000 471400 xsym               LDP1    B_MPT
         1 003436   100004 221100                    LDX1    4,,PR1
         1 003437   000003 622011                    EAX2    3,X1
         1 003440   100004 742100                    STX2    4,,PR1

     1447    10087    3           IF STK$->B$EXCFR.ECC = %ECC_PMME# THEN B$SS.IC = B$SS.IC+2;

  10087  1 003441   000000 720100                    LXL0    0,,PR0
         1 003442   000004 100003                    CMPX0   4,DU
         1 003443   003450 601000 1                  TNZ     s:10088

  10087  1 003444   000000 471400 xsym               LDP1    B_MPT
         1 003445   100004 221100                    LDX1    4,,PR1
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:208  
         1 003446   000002 622011                    EAX2    2,X1
         1 003447   100004 742100                    STX2    4,,PR1

     1448    10088    3           RETURN;

  10088  1 003450   200054 221300                    LDX1  ! AUTO_DRTNV+4,,AUTO
         1 003451   000001 702211                    TSX2  ! 1,X1

     1449    10089    3           END;
     1450    10090    2      B$JIT.ERR = STK$->B$EXCFR.ERR;

  10090  1 003452   000000 471400 xsym               LDP1    B$JIT$
         1 003453   100012 756100                    STQ     10,,PR1

     1451    10091    2      IF (STK$->B$EXCFR.ECC = %ECC_ALT#) OR (STK$->B$EXCFR.ECC = %ECC_PMME#)

  10091  1 003454   000000 720100                    LXL0    0,,PR0
         1 003455   000143 100003                    CMPX0   99,DU
         1 003456   003461 600000 1                  TZE     s:10093
         1 003457   000004 100003                    CMPX0   4,DU
         1 003460   003476 601000 1                  TNZ     s:10099

     1452    10092    3      THEN DO;

     1453    10093    3           IF STK$->B$ALT.DCB# <= B$ROSEG.NUMDCBS

  10093  1 003461   000000 473400 xsym               LDP3    B$ROSEG$
         1 003462   300002 236100                    LDQ     2,,PR3
         1 003463   000022 772000                    QRL     18
         1 003464   000101 116100                    CMPQ    65,,PR0
         1 003465   003500 602000 1                  TNC     s:10100

     1454    10094    4           THEN DO;

     1455    10095    4                B$JIT.DCB$=DCBADDR(STK$->B$ALT.DCB#);

  10095  1 003466   000001 474400 2                  LDP4    1
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:209  
         1 003467   400000 475500                    LDP5    0,,PR4
         1 003470   000101 721100                    LXL1    65,,PR0
         1 003471   500000 236111                    LDQ     0,X1,PR5
         1 003472   100232 756100                    STQ     154,,PR1

     1456    10096    4                B$JIT.DCBNO = STK$->B$ALT.DCB#;

  10096  1 003473   000101 236100                    LDQ     65,,PR0
         1 003474   100022 552104                    STBQ    18,'04'O,PR1

     1457    10097    4                END;

     1458    10098    3           END;                            /*DO IF ECC_ALT OR ECC_PMME           */

  10098  1 003475   003500 710000 1                  TRA     s:10100

     1459    10099    2      ELSE B$JIT.DCBNO=0;

  10099  1 003476   000000 236003                    LDQ     0,DU
         1 003477   100022 552104                    STBQ    18,'04'O,PR1

     1460    10100    2      ALTRETURN;

  10100  1 003500   200054 221300                    LDX1  ! AUTO_DRTNV+4,,AUTO
         1 003501   000000 702211                    TSX2  ! 0,X1

     1461    10101    2   END;
     1462    10102        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:210  
     1463    10103                                           /****************************************/
     1464    10104                                                /*              DO_RETRY              */
     1465    10105                                           /****************************************/
     1466    10106    1   DO_RETRY: PROC ALTRET;

  10106  1 003502   200054 741300       DO_RETRY     STX1  ! AUTO_DRTNV+4,,AUTO

     1467    10107    2      CALL CHECK_FPT ALTRET(BAD_FPT);

  10107  1 003503   003047 701000 1                  TSX1    CHECK_FPT
         1 003504   003516 702000 1                  TSX2    BAD_FPT

     1468    10108    2      CALL UEP$TCBSSF;

  10108  1 003505   002767 701000 1                  TSX1    UEP$TCBSSF
         1 003506   000000 011000                    NOP     0

     1469    10109    2      CALL MERGE_FPT ALTRET(NEXT);

  10109  1 003507   003170 701000 1                  TSX1    MERGE_FPT
         1 003510   003511 702000 1                  TSX2    NEXT

  10107  1 003511                       NEXT         null
     1470    10110    2   NEXT: ;
     1471    10111    2      B$SS.ALT = '0'B;

  10111  1 003511   000000 470400 xsym               LDP0    B_MPT
         1 003512   000031 236000 xsym               LDQ     B_VECTNIL+25
         1 003513   000001 356100                    ANSQ    1,,PR0

     1472    10112    2      RETURN;

  10112  1 003514   200054 221300                    LDX1  ! AUTO_DRTNV+4,,AUTO
         1 003515   000001 702211                    TSX2  ! 1,X1

     1473    10113    2   BAD_FPT: ALTRETURN;

PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:211  
  10113  1 003516   200054 221300       BAD_FPT      LDX1  ! AUTO_DRTNV+4,,AUTO
         1 003517   000000 702211                    TSX2  ! 0,X1

     1474    10114    2   END;
     1475    10115        %EJECT;
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:212  
     1476    10116                                           /****************************************/
     1477    10117                                                /*              RUND_DELTA            */
     1478    10118                                           /****************************************/
     1479    10119    1   RUND_DELTA: PROC;

  10119  1 003520   200056 741300       RUND_DELTA   STX1  ! AUTO_DRTNV+6,,AUTO

     1480    10120    2      CALL UDN$MAGIC;                      /* REFRESH                            */

  10120  1 003521   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 003522   000000 701000 xent               TSX1    UDN$MAGIC
         1 003523   000000 011000                    NOP     0

     1481    10121    2      CALL UDB$CALCOMP;

  10121  1 003524   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 003525   000000 701000 xent               TSX1    UDB$CALCOMP
         1 003526   000000 011000                    NOP     0
         1 003527   003531 710000 1                  TRA     s:10123

     1482    10122    2   RUND_DELTA2: ENTRY;

  10122  1 003530   200056 741300       RUND_DELTA2  STX1  ! AUTO_DRTNV+6,,AUTO

     1483    10123    2      CSTK$=PINCRW(B_MPT.TCB$,B_MPT.TCB$->FTCB.CRFR);

  10123  1 003531   000004 470400 xsym               LDP0    B_MPT+4
         1 003532   000001 220100                    LDX0    1,,PR0
         1 003533   000000 636010                    EAQ     0,X0
         1 003534   000004 036000 xsym               ADLQ    B_MPT+4
         1 003535   200007 756100                    STQ     CSTK$,,AUTO

     1484    10124    2      CALL CLEARONE;                       /*FLUSH USER FRAME FROM DELTAS TCB*/

  10124  1 003536   003005 701000 1                  TSX1    CLEARONE
         1 003537   000000 011000                    NOP     0

PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:213  
     1485    10125    2      IF (AUTO_DRTNV.KLDELTA) OR (AUTO_DRTNV.DLIB)

  10125  1 003540   200051 236100                    LDQ     AUTO_DRTNV+1,,AUTO
         1 003541   002000 316003                    CANQ    1024,DU
         1 003542   003545 601000 1                  TNZ     s:10126
         1 003543   010000 316003                    CANQ    4096,DU
         1 003544   003552 600000 1                  TZE     s:10127

     1486    10126    2      THEN CALL JSA$RUNDSPC(%DBWSR,1);

  10126  1 003545   000040 630400 2                  EPPR0   32
         1 003546   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 003547   000000 701000 xent               TSX1    JSA$RUNDSPC
         1 003550   000000 011000                    NOP     0
         1 003551   003556 710000 1                  TRA     s:10128

     1487    10127    2      ELSE CALL JSA$RUNDSPC(%DBWSR,0);

  10127  1 003552   000042 630400 2                  EPPR0   34
         1 003553   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 003554   000000 701000 xent               TSX1    JSA$RUNDSPC
         1 003555   000000 011000                    NOP     0

     1488    10128    2      CALL JSS$RUNDSPC;                    /*WHICH WILL RECALL MAGIC             */

  10128  1 003556   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 003557   000000 701000 xent               TSX1    JSS$RUNDSPC
         1 003560   000000 011000                    NOP     0

     1489    10129
     1490    10130        /*   The Write Control bit on users procedure is reset */
     1491    10131
     1492    10132    2      IF (B$JIT.JUNK2 & %JJ2_PACCESS#)

  10132  1 003561   000000 470400 xsym               LDP0    B$JIT$
         1 003562   000321 220100                    LDX0    209,,PR0
         1 003563   000002 360003                    ANX0    2,DU
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:214  
         1 003564   003642 600000 1                  TZE     s:10152

     1493    10133    3      THEN DO;

     1494    10134    3           J = B$JIT.PUL;

  10134  1 003565   000176 236100                    LDQ     126,,PR0
         1 003566   777777 376007                    ANQ     -1,DL
         1 003567   200015 756100                    STQ     J,,AUTO

     1495    10135    4           DO I = B$JIT.PLL TO J;

  10135  1 003570   000176 236100                    LDQ     126,,PR0
         1 003571   000022 772000                    QRL     18
         1 003572   200014 756100                    STQ     I,,AUTO
         1 003573   003605 710000 1                  TRA     s:10137+3

     1496    10136    4                B$MAP(I) = B$MAP(I) & ~MAP_PGWRITE;

  10136  1 003574   000036 236000 0                  LDQ     MAP_PGWRITE
         1 003575   000027 676000 xsym               ERQ     B_VECTNIL+23
         1 003576   000000 470400 xsym               LDP0    B$UPT$
         1 003577   200014 720100                    LXL0    I,,AUTO
         1 003600   000000 376110                    ANQ     0,X0,PR0
         1 003601   000000 756110                    STQ     0,X0,PR0

     1497    10137    4                END;

  10137  1 003602   200014 235100                    LDA     I,,AUTO
         1 003603   000001 035007                    ADLA    1,DL
         1 003604   200014 755100                    STA     I,,AUTO
         1 003605   200015 236100                    LDQ     J,,AUTO
         1 003606   200014 116100                    CMPQ    I,,AUTO
         1 003607   003574 603000 1                  TRC     s:10136

     1498    10138
     1499    10139        /*   If B$JIT.PCL is non zero there is an unshared version of a
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:215  
     1500    10140             library associated with this program that must be protected.
     1501    10141              */
     1502    10142    3           IF B$JIT.PCL ~= 0

  10142  1 003610   000000 470400 xsym               LDP0    B$JIT$
         1 003611   000215 720100                    LXL0    141,,PR0
         1 003612   003636 600000 1                  TZE     s:10150

     1503    10143    4           THEN DO;

     1504    10144    4                J = B$JIT.LUL;

  10144  1 003613   000215 236100                    LDQ     141,,PR0
         1 003614   000022 772000                    QRL     18
         1 003615   200015 756100                    STQ     J,,AUTO

     1505    10145    5                DO I = B$JIT.LLL TO J;

  10145  1 003616   000214 236100                    LDQ     140,,PR0
         1 003617   777777 376007                    ANQ     -1,DL
         1 003620   200014 756100                    STQ     I,,AUTO
         1 003621   003633 710000 1                  TRA     s:10147+3

     1506    10146    5                     B$MAP(I) = B$MAP(I) & ~MAP_PGWRITE;

  10146  1 003622   000036 236000 0                  LDQ     MAP_PGWRITE
         1 003623   000027 676000 xsym               ERQ     B_VECTNIL+23
         1 003624   000000 470400 xsym               LDP0    B$UPT$
         1 003625   200014 720100                    LXL0    I,,AUTO
         1 003626   000000 376110                    ANQ     0,X0,PR0
         1 003627   000000 756110                    STQ     0,X0,PR0

     1507    10147    5                     END;

  10147  1 003630   200014 235100                    LDA     I,,AUTO
         1 003631   000001 035007                    ADLA    1,DL
         1 003632   200014 755100                    STA     I,,AUTO
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:216  
         1 003633   200015 236100                    LDQ     J,,AUTO
         1 003634   200014 116100                    CMPQ    I,,AUTO
         1 003635   003622 603000 1                  TRC     s:10146

     1508    10148    4                END;

     1509    10149
     1510    10150    3           B$JIT.JUNK2 = (B$JIT.JUNK2 \ %JJ2_PACCESS#);

  10150  1 003636   000000 470400 xsym               LDP0    B$JIT$
         1 003637   000321 220100                    LDX0    209,,PR0
         1 003640   000002 660003                    ERX0    2,DU
         1 003641   000321 740100                    STX0    209,,PR0

     1511    10151    3           END;

     1512    10152    2      CALL HFC$ASSOCCLR (%USERWSQ,0,16384); /*MAX Dense PT*/

  10152  1 003642   000027 630400 2                  EPPR0   23
         1 003643   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 003644   000000 701000 xent               TSX1    HFC$ASSOCCLR
         1 003645   000000 011000                    NOP     0

     1513    10153    2      IF OECC=%ECC_ALIB# THEN RETURN;

  10153  1 003646   200017 220100                    LDX0    OECC,,AUTO
         1 003647   000137 100003                    CMPX0   95,DU
         1 003650   003653 601000 1                  TNZ     s:10155

  10153  1 003651   200056 221300                    LDX1  ! AUTO_DRTNV+6,,AUTO
         1 003652   000001 702211                    TSX2  ! 1,X1

     1514    10154                                                /* RESET UTIMER CONTROL AFTER M$DRTN  */
     1515    10155    2      IF (NECC = %ECC_TIMER#) OR (OECC = %ECC_TIMER#)

  10155  1 003653   200020 221100                    LDX1    NECC,,AUTO
         1 003654   003657 600000 1                  TZE     s:10157
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:217  
         1 003655   000000 100003                    CMPX0   0,DU
         1 003656   003664 601000 1                  TNZ     s:10160

     1516    10156    3      THEN DO;

     1517    10157    3           B_MPT.ECCB$->B$ECCBI.FLAGS(%ECC_TIMER#) = '0'B;

  10157  1 003657   000005 470400 xsym               LDP0    B_MPT+5
         1 003660   000031 236000 xsym               LDQ     B_VECTNIL+25
         1 003661   000004 356100                    ANSQ    4,,PR0

     1518    10158    3           B$JIT.UTIMER=0;

  10158  1 003662   000000 470400 xsym               LDP0    B$JIT$
         1 003663   000301 450100                    STZ     193,,PR0

     1519    10159    3           END;

     1520    10160    2      RETURN;

  10160  1 003664   200056 221300                    LDX1  ! AUTO_DRTNV+6,,AUTO
         1 003665   000001 702211                    TSX2  ! 1,X1

TIME
 Sect OctLoc
   0     000   000000 001750   000003 641100   000344 703400                    .......@....

TMASK
 Sect OctLoc
   0     003   000377 777777   000000 177777   000000 001777                    ............

ECCBINDX
 Sect OctLoc
   0     006   000*** ******   000*** ******   000*** ******   000*** ******    ................
   0     012   003*** ******   002*** ******   001*** ******   000*** ******    ................

EDTCBFULL
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:218  
 Sect OctLoc
   0     016   250504 407634                                                    ....

EJTCBFULL
 Sect OctLoc
   0     017   250512 407634                                                    ....

EBADPTR
 Sect OctLoc
   0     020   250520 407564                                                    ....

ENOTCB
 Sect OctLoc
   0     021   250520 407524                                                    ....

ETCBEMPTY
 Sect OctLoc
   0     022   250520 407624                                                    ....

EALTEMPTY
 Sect OctLoc
   0     023   250520 407614                                                    ....

ENOTPMME
 Sect OctLoc
   0     024   250520 407604                                                    ....

EDOMAIN
 Sect OctLoc
   0     025   250520 406264                                                    ....

EDRTN
 Sect OctLoc
   0     026   250520 407544                                                    ....

ETCBFULL
 Sect OctLoc
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:219  
   0     027   250520 407634                                                    ....

ENOCONTROL
 Sect OctLoc
   0     030   250520 407554                                                    ....

EBADCODE
 Sect OctLoc
   0     031   250520 406204                                                    ....

EDLTALT
 Sect OctLoc
   0     032   250520 407534                                                    ....

ENOLIB
 Sect OctLoc
   0     033   250520 404164                                                    ...t

EBADDCB
 Sect OctLoc
   0     034   250520 406244                                                    ....

MAP_DBRK
 Sect OctLoc
   0     035   000000 400000                                                    ....

MAP_PGWRITE
 Sect OctLoc
   0     036   000000 000020                                                    ....

MAP_PGWRITE_MOD
 Sect OctLoc
   0     037   000000 000022                                                    ....

EASLERR
 Sect OctLoc
   0     040   250520 404044                                                    ...$
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:220  

(unnamed)
 Sect OctLoc
   0     041   137106 040040   000000 000100                                    _F  ...@

(unnamed)
 Sect OctLoc
   2     000   777777 777770   000000 006003   777377 777777   000002 006000    ................
   2     004   776777 777777   000000 006000   000377 777777   000003 006000    ................
   2     010   777776 777777   737777 777777   777777 777760   000006 006000    ................
   2     014   000010 006000   000031 600000   000000 000046   000016 006000    ...........&....
   2     020   000000 000100   000020 006000   000030 400000   000000 000014    ...@............
   2     024   000023 006000   000031 400000   000000 040000   000012 006000    .......... .....
   2     030   000002 006000   000026 006000   767777 777777   000005 006000    ................
   2     034   777777 777737   777777 377777   777777 777377   777777 777577    ................
   2     040   000007 006000   000003 006000   000007 006000   000002 006000    ................
     1521    10161    2   END;
     1522    10162    1   END UEP$PMME;
     1523    10163        %EOD;

PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:221  
--  Include file information  --

   UD_EQU_E.:E05TOU  is referenced.
   UD_SEV_C.:E05TOU  is referenced.
   UD_ERRORS_C.:E05TOU  is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   J_ERRSET_C.:E05TOU  is referenced.
   J_ERRORS_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   B_SEGIDS_C.:E05TOU  is referenced.
   UE_ERRORS_C.:E05TOU  is referenced.
   UE_CP6.:E05TOU  is referenced.
   UE$CP6V_C.:E05TOU  is referenced.
   GJ_MSG_M.:E05TOU  is referenced.
   B_ULSMAC_C.:E05TOU  is referenced.
   B_MLSMAC_C.:E05TOU  is referenced.
   B_MAGIC_C.:E05TOU  is referenced.
   B_MACROS_C.:E05TOU  is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
   B$ROSEG.:E05TOU  cannot be made into a system file and is referenced.
   B$P.:E05TOU  cannot be made into a system file and is referenced.
   MM_MACRO_M.:E05TOU  is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   MM$SYSGEN.:E05TOU  is referenced.
   M_INFO_C.:E05TOU  is referenced.
   MM_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   S_WSPTD_R.:E05TOU  cannot be made into a system file and is referenced.
   B$MAP.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  is referenced.
   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure UEP$PMME.
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:222  

 **** Variables and constants ****

  ****  Section 000 RoData UEP$PMME

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    23-0-0/b STRC        r     1 EALTEMPTY                 40-0-0/b STRC        r     1 EASLERR
    31-0-0/b STRC        r     1 EBADCODE                  34-0-0/b STRC        r     1 EBADDCB
    20-0-0/b STRC        r     1 EBADPTR
     6-0-0/w UBIN(9)     r     1 ECCBINDX(0:7)
    32-0-0/b STRC        r     1 EDLTALT                   25-0-0/b STRC        r     1 EDOMAIN
    26-0-0/b STRC        r     1 EDRTN                     16-0-0/b STRC        r     1 EDTCBFULL
    17-0-0/b STRC        r     1 EJTCBFULL                 30-0-0/b STRC        r     1 ENOCONTROL
    33-0-0/b STRC        r     1 ENOLIB                    21-0-0/b STRC        r     1 ENOTCB
    24-0-0/b STRC        r     1 ENOTPMME                  22-0-0/b STRC        r     1 ETCBEMPTY
    27-0-0/b STRC        r     1 ETCBFULL                  35-0-0/b STRC        r     1 MAP_DBRK
    36-0-0/b STRC        r     1 MAP_PGWRITE               37-0-0/b STRC        r     1 MAP_PGWRITE_MOD
     0-0-0/w UBIN        r     1 TIME(0:2)                  3-0-0/b BIT         r     1 TMASK(0:2)

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @CODE                      4-0-0/w PTR         r     1 @USTK1$
     5-0-0/w PTR         r     1 @USTK2$                    6-0-0/w PTR         r     1 ALT$
    50-0-0/d STRC(144)   r     1 AUTO_DRTNV                57-0-0/w UBIN        r     1 CHFRSZ
    *0-0-0/w UBIN        r     1 CODE                       7-0-0/w PTR         r     1 CSTK$
    25-0-0/w UBIN        r     1 ECC                       21-0-0/w STRC(144)   r     1 ECP
    27-0-0/w UBIN(18)    r     1 EXCFR_IC                  13-0-0/w UBIN        r     1 FRMSZ
    12-0-0/w PTR         r     1 FROM$                     14-0-0/w UBIN        r     1 I
    15-0-0/w UBIN        r     1 J                         30-0-0/w STRC(576)   r     1 LCP6_MSG
    20-0-0/w UBIN(18)    r     1 NECC                      17-0-0/w UBIN(18)    r     1 OECC
    26-0-0/w UBIN(18)    r     1 SS_RTN_IC                 10-0-0/w PTR         r     1 STK$
    16-0-0/b BIT (9)     r     1 TEMPF                     11-0-0/w PTR         r     1 TO$
    *0-0-0/w PTR         r     1 USTK1$                    *0-0-0/w PTR         r     1 USTK2$
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:223  

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$LS$
     0-0-0/w PTR         r     1 B$MISC2$                   0-0-0/w PTR         r     1 B$P$
     0-0-0/w PTR         r     1 B$PS0$                     0-0-0/w PTR         r     1 B$PS1$
     0-0-0/w PTR         r     1 B$PS2$                     0-0-0/w PTR         r     1 B$PS3$
     0-0-0/w PTR         r     1 B$PS4$                     0-0-0/w PTR         r     1 B$ROSEG$
     0-0-0/w PTR         r     1 B$UPT$                     0-0-0/d STRC(432)   r     1 B_MPT
     0-0-0/w PTR         r     1 MM_BYP$                    0-0-0/b STRC        r     1 MM_FPMC
     0-0-0/w PTR         r     1 N$DCT$$                    0-0-0/w PTR         r     1 S$CU$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(72)    r     1 B$$DESCR                   0-0-0/c CHAR(2)     r     1 B$2CHAR
     0-0-0/w STRC(342)   r     1 B$ALIB_MSG                 0-0-0/w STRC(2448)  r     1 B$ALT
     0-0-0/d BIT (72)    r     1 B$DESEG(0:20)              0-0-0/w STRC(180)   r     1 B$ECCB
     0-0-0/w STRC(180)   r     1 B$ECCBI                    0-0-0/w STRC(2448)  r     1 B$EXCFR
     0-0-0/w STRC(144)   r     1 B$EXCRTN                   0-0-0/w STRC(54)    r     1 B$FCN_MSG
     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/w STRC        r     1 B$MAP(0:1023)
     0-0-0/d STRC(10368) r     1 B$MLS                      0-0-0/d STRC(1224)  r     1 B$P(0:0)
     0-0-0/w STRC        r     1 B$PTRS(0:7)                0-0-0/d STRC(3024)  r     1 B$ROSEG
     0-0-0/w STRC(3204)  r     1 B$SCON                     0-0-0/d STRC(2304)  r     1 B$SS
     0-0-0/d STRC(360)   r     1 B$SSX                      0-0-0/w STRC(144)   r     1 B$TCB
     0-0-0/d STRC(576)   r     1 B$U                        0-0-0/d STRC(2592)  r     1 B$ULNK
     0-0-0/d STRC(2592)  r     1 B$ULS                      0-0-0/w STRC(2448)  r     1 B$XCON
     0-0-0/d ASTR(3528)  r     1 F$DCB                      0-0-0/d STRC(72)    r     1 FPT$EVENT_V
     0-0-0/d STRC(72)    r     1 FPT$STIMER_V               0-0-0/d STRC(72)    r     1 FPT$STRAP_V
     0-0-0/d STRC        r     1 FPT$TTIMER_V               0-0-0/d UBIN        r     1 FPTFR#
     0-0-0/w UBIN        r     1 FPTREGS(0:6)
     0-0-0/d STRC(144)   r     1 FPTV                       0-0-0/w UBIN        r     1 FR63(0:62)
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:224  
     0-0-0/c ACHR        r     1 FRVAR                      0-0-0/w STRC(108)   r     1 FTCB
     0-0-0/d STRC(72)    r     1 MPARAM
     0-0-0/w PTR         r     1 NK$LDCT$(0:0)
     0-0-0/w PTR         r     1 PRS(0:7)                   0-0-0/w STRC        r     1 PXCON
     0-0-0/w SBIN        r     1 TIM                        0-0-0/w STRC(144)   r     1 VLP$ECCS_V
     0-0-0/d STRC(540)   r     1 VLR_FPRG_FID


   Procedure UEP$PMME requires 1974 words for executable code.
   Procedure UEP$PMME requires 54 words of local(AUTO) storage.
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:225  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:226  
          MINI XREF LISTING

ABORTM_GO
      9808**LABEL    9097--CALLALT  9269--CALLALT
ALT$
      5051**DCL      8947<<ASSIGN   8967>>IF       8972>>ASSIGN   9096>>ASSIGN   9106>>ASSIGN   9115>>ASSIGN
      9118>>IF       9120>>ASSIGN   9299>>ASSIGN   9303>>ASSIGN
AUTO_DRTNV
      6731**DCL      9353<<ASSIGN
AUTO_DRTNV.ALTRTN
      6733**DCL      9593>>IF
AUTO_DRTNV.DBRK
      6733**DCL      9499>>IF
AUTO_DRTNV.DLIB
      6733**DCL      9588>>IF       9590<<ASSIGN  10125>>IF
AUTO_DRTNV.ECC
      6734**DCL      9543>>ASSIGN
AUTO_DRTNV.EVENT
      6733**DCL      9615>>IF
AUTO_DRTNV.IR
      6731**DCL      6731--REDEF
AUTO_DRTNV.KLDELTA
      6733**DCL     10125>>IF
AUTO_DRTNV.KPDELTA
      6734**DCL      9571>>IF       9575<<ASSIGN
AUTO_DRTNV.MRGSS
      6734**DCL      9354>>IF
AUTO_DRTNV.QUIT
      6733**DCL      9625>>IF
AUTO_DRTNV.SETECC
      6733**DCL      9542>>IF
AUTO_DRTNV.SETSTEPCC
      6734**DCL      9531>>IF
AUTO_DRTNV.STEPCC
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:227  
      6735**DCL      9533>>ASSIGN
B$$DESCR
      5350**DCL      9334>>ASSIGN   9581<<ASSIGN   9651<<ASSIGN   9886>>ASSIGN
B$$DESCR.BOUND
      5351**DCL      9224>>IF       9972>>IF      10033>>IF
B$$DESCR.FLGS
      5352**DCL      9159>>IF       9209>>IF       9653<<ASSIGN   9653>>ASSIGN
B$2CHAR
      5337**DCL      9428<<ASSIGN
B$ALIB_MSG
      5323**DCL      9434--CALL
B$ALT.CODE
      5456**DCL      5456--REDEF    5457--REDEF    5457--REDEF
B$ALT.DCB#
      5457**DCL      8989>>IF       8990--ASSIGN  10093>>IF      10095--ASSIGN  10096>>ASSIGN
B$ALT.ERR.ERR#
      5458**DCL      5458--REDEF
B$ALT.EVID
      5457**DCL      5457--REDEF    5457--REDEF
B$ALT.FPT.FCG
      5456**DCL      8987>>IF       8987>>IF
B$DESEG
      6784**DCL     10028>>ASSIGN  10030>>ASSIGN
B$DO.ECCINFO
      1545**DCL      1546--REDEF
B$ECCB.FLAGS.BRKSET
      5411**DCL      9050>>IF
B$ECCB.FLAGS.XCONSET
      5411**DCL      9262<<ASSIGN   9766>>IF
B$ECCB.FLAGS.YCSET
      5412**DCL      9033<<ASSIGN   9038<<ASSIGN
B$ECCB.XCONF
      5412**DCL      9708<<ASSIGN   9708>>ASSIGN   9807<<ASSIGN   9807>>ASSIGN
B$ECCB.XCONF.GET
      5413**DCL      9152<<ASSIGN   9233<<ASSIGN
B$ECCB.XCONF.PROG
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:228  
      5412**DCL      9002<<ASSIGN   9172<<ASSIGN   9240<<ASSIGN   9260>>IF       9808<<ASSIGN
B$ECCB.XCONF.SVLDT
      5413**DCL      9777<<ASSIGN
B$ECCBI.ECIC
      5418**DCL      9005>>ASSIGN   9030<<ASSIGN   9036<<ASSIGN   9802>>ASSIGN
B$ECCBI.FLAGS
      5418**DCL      9031<<ASSIGN   9035<<ASSIGN   9062>>IF       9547>>IF      10157<<ASSIGN
B$EXCFR.ALTEMPTY
      5424**DCL      9096<<ASSIGN   9106<<ASSIGN   9120<<ASSIGN
B$EXCFR.ASL
      5424**DCL      5424--REDEF
B$EXCFR.DRS
      5435**DCL     10004<<ASSIGN
B$EXCFR.ECC
      5424**DCL      8984>>IF       8984>>IF       9118>>IF       9119<<ASSIGN   9144>>IF       9228>>IF
      9255>>IF       9277>>IF       9277>>IF       9293>>IF       9537>>ASSIGN   9680<<ASSIGN   9772<<ASSIGN
      9940<<ASSIGN   9940>>ASSIGN  10077>>IF      10086>>IF      10087>>IF      10091>>IF      10091>>IF
B$EXCFR.ERR
      5438**DCL      9175>>ASSIGN   9678<<ASSIGN   9689>>ASSIGN  10073<<ASSIGN  10075<<ASSIGN  10090>>ASSIGN
B$EXCFR.ERR.ERR#
      5438**DCL      5438--REDEF
B$EXCFR.ERR.SEV
      5439**DCL     10077>>IF
B$EXCFR.EVID
      5437**DCL      5437--REDEF    5438--REDEF    9677<<ASSIGN
B$EXCFR.IC
      5425**DCL      8981>>ASSIGN
B$EXCFR.IR
      5425**DCL      5425--REDEF
B$EXCFR.ISR.WSR
      5430**DCL      9546>>ASSIGN
B$EXCFR.P#
      5439**DCL      9683<<ASSIGN
B$EXCFR.PREVSZ
      5424**DCL      5424--REDEF    8967>>IF       9303<<ASSIGN   9932<<ASSIGN   9961>>ASSIGN
B$EXCFR.PRS
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:229  
      5435**DCL     10003<<ASSIGN
B$EXCFR.REGS
      5435**DCL     10002<<ASSIGN
B$EXCFR.SUBC
      5436**DCL      5436--REDEF    5437--REDEF    5437--REDEF
B$EXCFR.U1
      5436**DCL      9675<<ASSIGN
B$EXCRTN.ECCS
      5442**DCL      9734>>IF
B$EXCRTN.SVL
      5442**DCL      9726>>IF       9728>>ASSIGN
B$FCN_MSG
      5285**DCL      9416--CALL
B$JIT.CPFLAGS1.SLEAZE
       430**DCL       430--REDEF
B$JIT.DCB$
       504**DCL      8990<<ASSIGN  10095<<ASSIGN
B$JIT.DCBNO
       417**DCL     10096<<ASSIGN  10099<<ASSIGN
B$JIT.DDLL
       494**DCL      9511>>DOINDEX
B$JIT.DDUL
       494**DCL      9510>>ASSIGN
B$JIT.DLL
       494**DCL      9502>>DOINDEX
B$JIT.DUL
       494**DCL      9501>>ASSIGN
B$JIT.ERR
       336**DCL      8918<<ASSIGN   8927<<ASSIGN   8954<<ASSIGN   8969<<ASSIGN   9122<<ASSIGN   9175<<ASSIGN
      9213>>ASSIGN   9283<<ASSIGN   9295<<ASSIGN   9315<<ASSIGN   9407<<ASSIGN   9458<>CALL     9469<<ASSIGN
      9549<<ASSIGN   9595<<ASSIGN   9597<<ASSIGN   9628<<ASSIGN   9689<<ASSIGN   9817<<ASSIGN   9869<<ASSIGN
      9898<<ASSIGN   9979<<ASSIGN  10090<<ASSIGN
B$JIT.ERR.MID
       337**DCL       337--REDEF
B$JIT.ERR.SEV
       337**DCL      8955<<ASSIGN
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:230  
B$JIT.IDELTAT
       510**DCL      9067>>IF       9068<<ASSIGN
B$JIT.JRESPEAK
       498**DCL       499--REDEF
B$JIT.JUNK
       536**DCL      9265<<ASSIGN   9265>>ASSIGN   9534<<ASSIGN   9534>>ASSIGN   9578>>IF       9580<<ASSIGN
      9580>>ASSIGN   9589>>IF       9616<<ASSIGN   9616>>ASSIGN   9736<<ASSIGN   9736>>ASSIGN   9789<<ASSIGN
      9789>>ASSIGN
B$JIT.JUNK2
       590**DCL      9528<<ASSIGN   9528>>ASSIGN  10132>>IF      10150<<ASSIGN  10150>>ASSIGN
B$JIT.LLL
       500**DCL     10145>>DOINDEX
B$JIT.LUL
       500**DCL     10144>>ASSIGN
B$JIT.ORIGINATOR_PORT.FROM_CR
       607**DCL       607--REDEF     608--REDEF
B$JIT.PCL
       500**DCL     10142>>IF
B$JIT.PLL
       494**DCL     10135>>DOINDEX
B$JIT.PNR
       511**DCL       511--REDEF
B$JIT.PRIV.ACTIVE
       337**DCL     10051>>IF      10054>>IF
B$JIT.PTSIZ
       500**DCL      9519>>ASSIGN
B$JIT.PUL
       494**DCL     10134>>ASSIGN
B$JIT.RNST
       515**DCL      9258<<ASSIGN   9782<<ASSIGN   9786<<ASSIGN   9786>>ASSIGN
B$JIT.STEPCC
       563**DCL      9533<<ASSIGN
B$JIT.STIME
       509**DCL      9064>>ASSIGN   9076>>IF       9078>>ASSIGN
B$JIT.SVLDTF
       577**DCL      9164<<ASSIGN   9164>>ASSIGN   9237<<ASSIGN   9237>>ASSIGN   9686<<ASSIGN   9710<<ASSIGN
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:231  
      9710>>ASSIGN   9728<<ASSIGN   9728>>ASSIGN   9897<<ASSIGN
B$JIT.TSLINE
       605**DCL       606--REDEF
B$JIT.UTIMER
       511**DCL      9064<<ASSIGN   9067>>IF       9068>>ASSIGN   9076>>IF       9078>>ASSIGN  10158<<ASSIGN
B$JIT.XCONF
       557**DCL      9787<<ASSIGN   9787>>ASSIGN
B$JIT.XTIME
       509**DCL      9064>>ASSIGN   9076>>IF       9078>>ASSIGN
B$JIT$
      5266**DCL       331--IMP-PTR  8918>>ASSIGN   8927>>ASSIGN   8954>>ASSIGN   8955>>ASSIGN   8969>>ASSIGN
      8990>>ASSIGN   9064>>ASSIGN   9064>>ASSIGN   9064>>ASSIGN   9067>>IF       9067>>IF       9068>>ASSIGN
      9068>>ASSIGN   9076>>IF       9076>>IF       9076>>IF       9078>>ASSIGN   9078>>ASSIGN   9078>>ASSIGN
      9122>>ASSIGN   9164>>ASSIGN   9164>>ASSIGN   9175>>ASSIGN   9213>>ASSIGN   9237>>ASSIGN   9237>>ASSIGN
      9258>>ASSIGN   9265>>ASSIGN   9265>>ASSIGN   9283>>ASSIGN   9295>>ASSIGN   9315>>ASSIGN   9407>>ASSIGN
      9458>>CALL     9469>>ASSIGN   9501>>ASSIGN   9502>>DOINDEX  9510>>ASSIGN   9511>>DOINDEX  9519>>ASSIGN
      9528>>ASSIGN   9528>>ASSIGN   9533>>ASSIGN   9534>>ASSIGN   9534>>ASSIGN   9549>>ASSIGN   9578>>IF
      9580>>ASSIGN   9580>>ASSIGN   9589>>IF       9595>>ASSIGN   9597>>ASSIGN   9616>>ASSIGN   9616>>ASSIGN
      9628>>ASSIGN   9686>>ASSIGN   9689>>ASSIGN   9710>>ASSIGN   9710>>ASSIGN   9728>>ASSIGN   9728>>ASSIGN
      9736>>ASSIGN   9736>>ASSIGN   9782>>ASSIGN   9786>>ASSIGN   9786>>ASSIGN   9787>>ASSIGN   9787>>ASSIGN
      9789>>ASSIGN   9789>>ASSIGN   9817>>ASSIGN   9869>>ASSIGN   9897>>ASSIGN   9898>>ASSIGN   9979>>ASSIGN
     10051>>IF      10054>>IF      10090>>ASSIGN  10095>>ASSIGN  10096>>ASSIGN  10099>>ASSIGN  10132>>IF
     10134>>ASSIGN  10135>>DOINDEX 10142>>IF      10144>>ASSIGN  10145>>DOINDEX 10150>>ASSIGN  10150>>ASSIGN
     10158>>ASSIGN
B$LS$
      5267**DCL      9581>>ASSIGN   9886>>ASSIGN
B$MAP
       653**DCL      9503>>IF       9505<<ASSIGN   9505>>ASSIGN   9507<<ASSIGN   9507>>ASSIGN   9512>>IF
      9514<<ASSIGN   9514>>ASSIGN   9516<<ASSIGN   9516>>ASSIGN   9521>>IF       9523<<ASSIGN   9523>>ASSIGN
      9525<<ASSIGN   9525>>ASSIGN  10136<<ASSIGN  10136>>ASSIGN  10146<<ASSIGN  10146>>ASSIGN
B$MAP.RPN
       654**DCL      9506>>IF       9515>>IF       9524>>IF
B$MAP.SCTRL
       655**DCL       656--REDEF
B$MISC2$
      5258**DCL      9888>>ASSIGN   9888>>ASSIGN
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:232  
B$MLS.MISC2
      6481**DCL      9886<<ASSIGN
B$MLS.USERLS
      6099**DCL      9581>>ASSIGN
B$P.NAME
      1279**DCL      9426>>ASSIGN
B$P$
      1309**DCL      9426>>ASSIGN
B$PS0$
      5260**DCL      9018>>IF       9029>>IF       9030>>ASSIGN   9032>>IF       9045<>CALL     9050>>IF
      9050>>IF       9057<>CALL     9064>>ASSIGN   9064>>ASSIGN   9064>>ASSIGN   9079>>ASSIGN   9084>>IF
      9226>>ASSIGN  10014>>ASSIGN  10073>>ASSIGN
B$PS1$
      5261**DCL      9005>>ASSIGN   9006>>ASSIGN   9079>>ASSIGN   9082>>ASSIGN   9976>>IF       9976>>IF
      9976>>IF       9976>>IF      10018>>ASSIGN
B$PS2$
      5262**DCL      9313>>IF       9329>>IF       9353>>ASSIGN   9379>>IF       9379>>IF       9384>>IF
      9391>>IF       9393>>ASSIGN   9414>>IF      10041>>IF      10042>>ASSIGN  10044>>IF      10047>>ASSIGN
     10048>>ASSIGN
B$PS3$
      5263**DCL      9597>>ASSIGN   9676>>ASSIGN   9677>>ASSIGN   9678>>ASSIGN
B$PS4$
      5264**DCL      9449>>ASSIGN   9450>>ASSIGN   9451>>ASSIGN   9452>>ASSIGN   9453>>CALL
B$PTRS.S.DESCR#
      6782**DCL     10024>>ASSIGN
B$PTRS.S.SEG_TYPE
      6781**DCL     10022>>IF
B$PTRS.SEGID
      6779**DCL      6780--REDEF    9976>>IF       9976>>IF       9976>>IF       9976>>IF
B$ROSEG.ECCB
      1348**DCL      9546--ASSIGN
B$ROSEG.NUMDCBS
      1344**DCL      8989>>IF       9391>>IF      10093>>IF
B$ROSEG$
      5259**DCL      8989>>IF       9391>>IF       9546>>ASSIGN  10093>>IF
B$SCON.ACCT$
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:233  
      5477**DCL      5477--REDEF
B$SCON.CMD_DSCR$
      5478**DCL      5478--REDEF    5478--REDEF
B$SCON.ECCS
      5473**DCL      5473--REDEF
B$SCON.FNAME.TXT
      5478**DCL      5478--REDEF
B$SCON.NAME$
      5477**DCL      5477--REDEF
B$SCON.PASS$
      5477**DCL      5477--REDEF
B$SCON.PSID$
      5477**DCL      5477--REDEF
B$SCON.SUBC.ALTBIT
      5473**DCL      9150>>IF
B$SS.ALT
      5360**DCL      9174<<ASSIGN   9660>>IF      10070<<ASSIGN  10111<<ASSIGN
B$SS.ASR
      5383**DCL      9337>>ASSIGN
B$SS.CPUREQ
      5374**DCL      9804<<ASSIGN  10061<<ASSIGN
B$SS.DR
      5387**DCL     10004>>ASSIGN  10030<<ASSIGN
B$SS.DR.WORD1
      5388**DCL     10028<<ASSIGN
B$SS.DR.WORD1.TYP
      5390**DCL     10026>>IF      10026>>IF
B$SS.IC
      5364**DCL      8944>>ASSIGN   9151<<ASSIGN   9151>>ASSIGN   9660>>IF       9661<<ASSIGN   9661>>ASSIGN
      9723>>IF       9802<<ASSIGN  10042<<ASSIGN  10057>>IF      10086<<ASSIGN  10086>>ASSIGN  10087<<ASSIGN
     10087>>ASSIGN
B$SS.IR
      5365**DCL     10047<<ASSIGN  10048<<ASSIGN
B$SS.IR.MIR
      5370**DCL      9803<<ASSIGN  10046>>IF      10058<<ASSIGN  10060>>IF
B$SS.IR.MMODE
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:234  
      5368**DCL     10055<<ASSIGN
B$SS.IR.PM
      5367**DCL     10052<<ASSIGN
B$SS.ISR
      5378**DCL      9339>>ASSIGN   9721<<ASSIGN
B$SS.ISR.WSR
      5380**DCL      8916>>IF       9014>>IF       9136>>IF       9155>>IF       9235>>IF       9331>>DOWHILE
      9997>>DOWHILE 10079>>IF
B$SS.LSR
      5384**DCL      9336>>ASSIGN
B$SS.PR
      5386**DCL     10003>>ASSIGN  10018<<ASSIGN  10020--ASSIGN
B$SS.PSR
      5385**DCL      9338>>ASSIGN
B$SS.REGS
      5392**DCL     10002>>ASSIGN  10014<<ASSIGN
B$SSX.ISR
      5400**DCL      9721>>ASSIGN
B$SSX.ISR.WSR
      5402**DCL      9136>>IF       9313>>IF       9331>>DOWHILE  9573>>IF       9627>>IF       9841>>IF
      9997>>DOWHILE 10079>>IF
B$TCB.CURRSZ
      5421**DCL      8952>>IF       9539>>ASSIGN   9932>>ASSIGN   9933<<ASSIGN   9959>>IF       9960>>ASSIGN
      9961<<ASSIGN   9962>>IF       9963>>ASSIGN
B$TCB.STK$
      5421**DCL      9931<<ASSIGN   9931>>ASSIGN   9963<<ASSIGN   9963>>ASSIGN
B$TCB.TCBAVSZ
      5421**DCL      9929>>IF       9934<<ASSIGN   9934>>ASSIGN   9960<<ASSIGN   9960>>ASSIGN
B$U.ASYNCH
      1482**DCL      9054<<ASSIGN   9054>>ASSIGN
B$U.DB
      1502**DCL      9426>>ASSIGN
B$U.FLG.EVNT
      1441**DCL      9020<<ASSIGN
B$U.MISC
      1524**DCL      1525--REDEF
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:235  
B$ULNK.ECCB.FLGS
      5806**DCL      9583<<ASSIGN   9583>>ASSIGN
B$ULS.ECCB
      5605**DCL      9651>>ASSIGN
B$ULS.SPCL1
      5623**DCL      9334<<ASSIGN
B$ULS.SPCL1.TYP
      5627**DCL      9335<<ASSIGN
B$ULS.SPCL2
      5629**DCL      9336<<ASSIGN
B$ULS.SPCL3
      5635**DCL      9337<<ASSIGN
B$ULS.SPCL4
      5641**DCL      9338<<ASSIGN
B$ULS.SPCL5
      5655**DCL      9339<<ASSIGN
B$ULS.TCB.BOUND
      5612**DCL      8925>>IF
B$UPT$
      5265**DCL      9503>>IF       9505>>ASSIGN   9505>>ASSIGN   9506>>IF       9507>>ASSIGN   9507>>ASSIGN
      9512>>IF       9514>>ASSIGN   9514>>ASSIGN   9515>>IF       9516>>ASSIGN   9516>>ASSIGN   9521>>IF
      9523>>ASSIGN   9523>>ASSIGN   9524>>IF       9525>>ASSIGN   9525>>ASSIGN  10136>>ASSIGN  10136>>ASSIGN
     10146>>ASSIGN  10146>>ASSIGN
B$USER.MISC
      1600**DCL      1601--REDEF
B$XCON.CECCB
      5445**DCL      9146>>ASSIGN   9230>>ASSIGN   9708>>ASSIGN   9710>>ASSIGN   9761>>IF       9768>>ASSIGN
B$XCON.CECCB.PROG
      5445**DCL      9764>>IF
B$XCON.ECCB.PROG
      5450**DCL      9171>>IF       9239>>IF
B$XCON.ECSC
      5446**DCL      9676<<ASSIGN
B$XCON.ERR.ERR#
      5451**DCL      5451--REDEF
B$XCON.LIMIT.MEM
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:236  
      5449**DCL      5449--REDEF
B$XCON.RNST
      5446**DCL      9258>>ASSIGN   9782>>ASSIGN
BAD_FPT IN PROCEDURE DO_RETRY
     10113**LABEL   10107--CALLALT
B_MPT.AS
      5200**DCL      5203--REDEF
B_MPT.ASDESC
      5232**DCL      5236--REDEF
B_MPT.ECCB
      5215**DCL      5218--REDEF
B_MPT.ECCB$
      5218**DCL      9002>>ASSIGN   9005>>ASSIGN   9030>>ASSIGN   9031>>ASSIGN   9033>>ASSIGN   9035>>ASSIGN
      9036>>ASSIGN   9038>>ASSIGN   9050>>IF       9062>>IF       9152>>ASSIGN   9172>>ASSIGN   9233>>ASSIGN
      9240>>ASSIGN   9260>>IF       9262>>ASSIGN   9708>>ASSIGN   9708>>ASSIGN   9766>>IF       9777>>ASSIGN
      9802>>ASSIGN   9807>>ASSIGN   9807>>ASSIGN   9808>>ASSIGN  10157>>ASSIGN
B_MPT.ECCBDESC
      5250**DCL      5254--REDEF
B_MPT.ECCBDESC$
      5254**DCL      9159>>IF       9209>>IF       9651>>ASSIGN   9653>>ASSIGN   9653>>ASSIGN
B_MPT.LS
      5195**DCL      5198--REDEF
B_MPT.LS$
      5198**DCL      8925>>IF       9334>>ASSIGN   9335>>ASSIGN   9336>>ASSIGN   9337>>ASSIGN   9338>>ASSIGN
      9339>>ASSIGN   9583>>ASSIGN   9583>>ASSIGN   9651>>ASSIGN  10028>>ASSIGN  10030>>ASSIGN
B_MPT.LSDESC
      5226**DCL      5230--REDEF
B_MPT.LSDESC$
      5230**DCL      9581>>ASSIGN
B_MPT.PS
      5205**DCL      5208--REDEF
B_MPT.PSDESC
      5238**DCL      5242--REDEF
B_MPT.PSDESC$
      5242**DCL      9224>>IF       9972>>IF      10033>>IF
B_MPT.SS
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:237  
      5190**DCL      5193--REDEF
B_MPT.SS$
      5193**DCL      8916>>IF       8944>>ASSIGN   9014>>IF       9136>>IF       9151>>ASSIGN   9151>>ASSIGN
      9155>>IF       9174>>ASSIGN   9235>>IF       9331>>DOWHILE  9336>>ASSIGN   9337>>ASSIGN   9338>>ASSIGN
      9339>>ASSIGN   9660>>IF       9660>>IF       9661>>ASSIGN   9661>>ASSIGN   9721>>ASSIGN   9723>>IF
      9802>>ASSIGN   9803>>ASSIGN   9804>>ASSIGN   9949>>ASSIGN   9997>>DOWHILE 10002>>ASSIGN  10003>>ASSIGN
     10004>>ASSIGN  10014>>ASSIGN  10018>>ASSIGN  10020>>ASSIGN  10026>>IF      10026>>IF      10028>>ASSIGN
     10030>>ASSIGN  10042>>ASSIGN  10046>>IF      10047>>ASSIGN  10048>>ASSIGN  10052>>ASSIGN  10055>>ASSIGN
     10057>>IF      10058>>ASSIGN  10060>>IF      10061>>ASSIGN  10070>>ASSIGN  10079>>IF      10086>>ASSIGN
     10086>>ASSIGN  10087>>ASSIGN  10087>>ASSIGN  10111>>ASSIGN
B_MPT.SSDESC
      5220**DCL      5224--REDEF
B_MPT.SSDESC$
      5224**DCL      9334>>ASSIGN
B_MPT.TCB
      5210**DCL      5213--REDEF
B_MPT.TCB$
      5213**DCL      8947>>ASSIGN   8947>>ASSIGN   8948>>ASSIGN   8948>>ASSIGN   8952>>IF       9539>>ASSIGN
      9836>>ASSIGN   9836>>ASSIGN   9860>>ASSIGN   9860>>ASSIGN   9890>>ASSIGN   9890>>ASSIGN   9929>>IF
      9930>>ASSIGN   9931>>ASSIGN   9931>>ASSIGN   9931>>ASSIGN   9932>>ASSIGN   9933>>ASSIGN   9934>>ASSIGN
      9934>>ASSIGN   9959>>IF       9960>>ASSIGN   9960>>ASSIGN   9960>>ASSIGN   9961>>ASSIGN   9962>>IF
      9963>>ASSIGN   9963>>ASSIGN   9963>>ASSIGN   9964>>ASSIGN   9964>>ASSIGN  10123>>ASSIGN  10123>>ASSIGN
B_MPT.TCBDESC
      5244**DCL      5248--REDEF
B_MPT.TCBDESC$
      5248**DCL      9886>>ASSIGN
CHECK_FPT
      9971**PROC     9138--CALL     9344--CALL    10107--CALL
CHFRSZ IN PROCEDURE UEP$TCBTCB
      9925**DCL      9926--IMP-SIZ  9936<<ASSIGN   9938>>ASSIGN   9938>>ASSIGN
CLEARONE
      9958**PROC     9176--CALL     9244--CALL     9268--CALL     9280--CALL     9302--CALL     9844--CALL
     10124--CALL
CLRDONE
      9247**LABEL    9244--CALLALT
CLR_ALT
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:238  
      9847**LABEL    9844--CALLALT
CODE
      5046**DCL         8--PROC     8916>>IF       8924>>IF       8949>>IF       8951>>IF       8955>>IF
      8997>>DOCASE   9005>>ASSIGN   9030>>ASSIGN   9031>>ASSIGN   9032>>IF       9035>>ASSIGN   9036>>ASSIGN
      9037>>IF       9062>>IF       9086<<ASSIGN   9832--ENTRY    9838>>IF       9841>>IF       9852--ENTRY
CSTK$
      5052**DCL      8948<<ASSIGN   8958>>ASSIGN   9171>>IF       9228>>IF       9230>>ASSIGN   9239>>IF
      9255>>IF       9258>>ASSIGN   9293>>IF       9300>>ASSIGN   9313>>IF       9331>>DOWHILE  9537>>ASSIGN
      9546>>ASSIGN   9573>>IF       9627>>IF       9675>>ASSIGN   9676>>ASSIGN   9677>>ASSIGN   9678>>ASSIGN
      9680>>ASSIGN   9683>>ASSIGN   9689>>ASSIGN   9708>>ASSIGN   9710>>ASSIGN   9721>>ASSIGN   9725>>ASSIGN
      9761>>IF       9764>>IF       9768>>ASSIGN   9772>>ASSIGN   9782>>ASSIGN   9837<<ASSIGN   9840>>ASSIGN
      9841>>IF       9845>>ASSIGN   9847>>ASSIGN   9860<<ASSIGN   9890<<ASSIGN   9930>>ASSIGN   9961>>ASSIGN
      9964<<ASSIGN   9997>>DOWHILE 10002>>ASSIGN  10003>>ASSIGN  10004>>ASSIGN  10123<<ASSIGN
DELTA_EXCRTN
      9175**LABEL    9098--GOTO     9107--GOTO     9162--GOTO     9177--GOTO     9270--GOTO     9281--GOTO
DO_DRUND
      9789**LABEL    9780--GOTO
DO_MERC
     10069**PROC     9097--CALL     9257--CALL     9269--CALL
DO_RETRY
     10106**PROC     9105--CALL     9279--CALL
DRTN_BADDCB
      9400**LABEL    9399--GOTO     9400--GOTO     9402--GOTO
DTCB_UTCB
      9884**PROC     9778--CALL     9801--CALL
EALTEMPTY
      8811**DCL      8969>>ASSIGN
EASLERR
      8904**DCL      9628>>ASSIGN
EBADCODE
      8859**DCL      9817>>ASSIGN
EBADDCB
      8883**DCL      9407>>ASSIGN
EBADPTR
      8787**DCL      9979>>ASSIGN
ECC
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:239  
      5070**DCL      9208<<ASSIGN   9216<>CALL
ECCBINDX
      5131**DCL      9546>>ASSIGN
ECCS_OK
      9678**LABEL    9673--CALLALT
ECP
      5068**DCL      9216<>CALL
ECP.ECCS
      5068**DCL      9095<<ASSIGN   9104<<ASSIGN   9135<<ASSIGN   9253<<ASSIGN   9276<<ASSIGN  10071>>IF
ECP.ERR
      5068**DCL      9213<<ASSIGN
ECP.EVID
      5068**DCL      9212<<ASSIGN
ECP.P#
      5068**DCL      9214<<ASSIGN
ECP.SVL
      5068**DCL      9143<<ASSIGN   9161<<ASSIGN
ECP.TYP
      5068**DCL      9211<<ASSIGN
EDLTALT
      8867**DCL      9595>>ASSIGN
EDOMAIN
      8827**DCL      8918>>ASSIGN
EDRTN
      8835**DCL      9315>>ASSIGN
EDTCBFULL
      8769**DCL      9898>>ASSIGN
EJTCBFULL
      8777**DCL      9869>>ASSIGN
EMR$FEP2HOST
      5154**DCL-ENT  9458--CALL
ENOCONTROL
      8851**DCL      9549>>ASSIGN
ENOLIB
      8875**DCL      9469>>ASSIGN
ENOTCB
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:240  
      8795**DCL      8927>>ASSIGN
ENOTPMME
      8819**DCL      9283>>ASSIGN   9295>>ASSIGN
ERR_EXIT
      9824**LABEL    9105--CALLALT  9138--CALLALT  9279--CALLALT  9344--CALLALT
ETCBEMPTY
      8803**DCL      8954>>ASSIGN
ETCBFULL
      8843**DCL      9122>>ASSIGN
EV1
      9020**LABEL    9017--CALLALT
EXCFR_IC
      5073**DCL      8981<<ASSIGN   9660>>IF       9723>>IF      10057>>IF
F$DCB.ACTPOS
      1636**DCL      1636--REDEF
F$DCB.ARS
      1611**DCL      1611--REDEF
F$DCB.ATTR
      1629**DCL      1630--REDEF
F$DCB.BORROW
      1644**DCL      1644--REDEF    1644--REDEF    1644--REDEF
F$DCB.DCBNAME.L
      1658**DCL      1658--IMP-SIZ
F$DCB.EOMCHAR
      1615**DCL      1615--REDEF
F$DCB.FLDID
      1639**DCL      1639--REDEF
F$DCB.FORM$
      1633**DCL      1633--REDEF
F$DCB.FSECT
      1649**DCL      1649--REDEF
F$DCB.FSN
      1626**DCL      1626--REDEF    1626--REDEF    1627--REDEF
F$DCB.HEADER$
      1632**DCL      1632--REDEF
F$DCB.IXTNSIZE
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:241  
      1630**DCL      1630--REDEF
F$DCB.LASTSTA$
      1620**DCL      1620--REDEF
F$DCB.LDCTX
      1633**DCL      9398>>ASSIGN
F$DCB.LVL
      1645**DCL      1645--REDEF
F$DCB.NAME.C
      1620**DCL      1620--REDEF
F$DCB.NOEOF
      1641**DCL      1641--REDEF
F$DCB.NRECS
      1631**DCL      1631--REDEF
F$DCB.NRECX
      1650**DCL      1650--REDEF
F$DCB.OHDR
      1642**DCL      1642--REDEF
F$DCB.ORG
      1625**DCL      1625--REDEF    9396>>IF       9396>>IF       9396>>IF
F$DCB.PRECNO
      1648**DCL      1648--REDEF
F$DCB.RCSZ
      1653**DCL      1653--REDEF
F$DCB.RES
      1621**DCL      1621--REDEF
F$DCB.SETX
      1633**DCL      1633--REDEF
F$DCB.TAB$
      1632**DCL      1633--REDEF
F$DCB.TDA
      1647**DCL      1647--REDEF
F$DCB.WSN
      1622**DCL      1622--REDEF
FINAL_EXIT
      9728**LABEL    9737--GOTO
FPT$EVENT_V.YC
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:242  
      6762**DCL      9032>>IF
FPT$STIMER_V.UNITS
      6756**DCL      9064>>ASSIGN
FPT$STIMER_V.UTYPE
      6756**DCL      9064>>ASSIGN   9064>>ASSIGN
FPT$STRAP_V.BRK
      6759**DCL      9050>>IF
FPT$STRAP_V.STRAP
      6759**DCL      9050>>IF
FPT$TTIMER_V.CANCEL
      6750**DCL      9084>>IF
FPT$TTIMER_V.UTYPE
      6750**DCL      9079>>ASSIGN
FPTFR#
      6764**DCL      9226>>ASSIGN
FPTREGS
      6773**DCL     10014>>ASSIGN
FPTV
      6724**DCL      9353>>ASSIGN
FPTV.ALIB_FD
      6727**DCL      9379>>IF
FPTV.FPRG_DCB
      6728**DCL      9391>>IF       9393--ASSIGN
FPTV.IC
      6724**DCL      9018>>IF       9029>>IF       9030>>ASSIGN  10041>>IF      10042>>ASSIGN
FPTV.IR
      6724**DCL      6724--REDEF   10047>>ASSIGN  10048>>ASSIGN
FPTV.QUIT
      6726**DCL      9313>>IF
FPTV.SETIR
      6726**DCL     10044>>IF
FPTV.SPCLD
      6727**DCL      9329>>IF
FPTV.WAKE_FD
      6727**DCL      9379>>IF       9384>>IF       9414>>IF
FR63
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:243  
      5406**DCL      9951<<ASSIGN   9951>>ASSIGN
FRMSZ
      5056**DCL      9114<<ASSIGN   9298<<ASSIGN   9539<<ASSIGN   9684<<ASSIGN   9863<<ASSIGN   9929>>IF
      9933>>ASSIGN   9934>>ASSIGN   9936>>ASSIGN
FROM$
      5055**DCL      9115<<ASSIGN   9300<<ASSIGN   9427<<ASSIGN   9428>>ASSIGN   9725<<ASSIGN   9726>>IF
      9728>>ASSIGN   9734>>IF       9862<<ASSIGN   9863>>ASSIGN   9864<<ASSIGN   9864>>ASSIGN   9864>>ASSIGN
      9865>>ASSIGN   9888<<ASSIGN   9938>>ASSIGN   9940>>ASSIGN   9950<<ASSIGN   9951>>ASSIGN
FRVAR IN PROCEDURE UEP$TCBTCB
      9926**DCL      9938<<ASSIGN   9938>>ASSIGN
FTCB.ALTFR
      5340**DCL      8947>>ASSIGN
FTCB.CRFR
      5342**DCL      8948>>ASSIGN   9836>>ASSIGN   9860>>ASSIGN   9864>>ASSIGN   9888>>ASSIGN   9890>>ASSIGN
      9964>>ASSIGN  10123>>ASSIGN
FTCB.CRSZ
      5345**DCL      9863>>ASSIGN   9930>>ASSIGN   9931>>ASSIGN
FULL_TCB IN PROCEDURE DTCB_UTCB
      9892**LABEL    9892--CALLALT
HFC$ASSOCCLR
      5150**DCL-ENT  9527--CALL    10152--CALL
HFE$M$STRAP
      5136**DCL-ENT  9057--CALL
HFE$M$TRAP
      5135**DCL-ENT  9045--CALL
HFF$NILERASE
      5137**DCL-ENT  9004--CALL     9017--CALL     9028--CALL     9075--CALL     9386--CALL     9447--CALL
      9596--CALL     9673--CALL     9974--CALL    10013--CALL    10017--CALL    10072--CALL
I
      5057**DCL      5058--REDEF    9003<<ASSIGN   9004<>CALL     9016<<ASSIGN   9019<<ASSIGN   9020>>ASSIGN
      9027<<ASSIGN   9028<>CALL     9078<<ASSIGN   9079>>ASSIGN   9225<<ASSIGN   9226<<ASSIGN   9227>>DOWHILE
      9245<<ASSIGN   9245>>ASSIGN   9502<<DOINDEX  9503>>IF       9505>>ASSIGN   9505>>ASSIGN   9506>>IF
      9506>>IF       9507>>ASSIGN   9507>>ASSIGN   9511<<DOINDEX  9512>>IF       9514>>ASSIGN   9514>>ASSIGN
      9515>>IF       9515>>IF       9516>>ASSIGN   9516>>ASSIGN   9520<<DOINDEX  9521>>IF       9523>>ASSIGN
      9523>>ASSIGN   9524>>IF       9524>>IF       9525>>ASSIGN   9525>>ASSIGN   9672<<ASSIGN   9673<>CALL
      9973<<ASSIGN   9974<>CALL     9975<<DOINDEX  9976>>IF       9976>>IF       9976>>IF       9976>>IF
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:244  
     10012<<ASSIGN  10013<>CALL    10016<<ASSIGN  10017<>CALL    10021<<DOINDEX 10022>>IF      10024>>ASSIGN
     10026>>IF      10026>>IF      10028>>ASSIGN  10030>>ASSIGN  10135<<DOINDEX 10136>>ASSIGN  10136>>ASSIGN
     10145<<DOINDEX 10146>>ASSIGN  10146>>ASSIGN
J
      5061**DCL      9501<<ASSIGN   9502>>DOINDEX  9506>>IF       9510<<ASSIGN   9511>>DOINDEX  9515>>IF
      9519<<ASSIGN   9520>>DOINDEX  9524>>IF      10024<<ASSIGN  10028>>ASSIGN  10030>>ASSIGN  10134<<ASSIGN
     10135>>DOINDEX 10144<<ASSIGN  10145>>DOINDEX
JSA$QUIT
      5144**DCL-ENT  9629--CALL
JSA$RUNDSPC
      5143**DCL-ENT 10126--CALL    10127--CALL
JSE$ABORTM
      5147**DCL-ENT  9828--CALL     9918--CALL
JSE$ABORTX
      5148**DCL-ENT  9166--CALL     9641--CALL     9731--CALL     9747--CALL     9792--CALL
JSE$ABORTY
      5149**DCL-ENT  9266--CALL
JSS$BACKSS
      5138**DCL-ENT  9332--CALL     9998--CALL
JSS$RUNDSPC
      5142**DCL-ENT 10082--CALL    10128--CALL
KIA$8TO9
      5157**DCL-ENT  9453--CALL
KIF$READ
      5155**DCL-ENT  9440--CALL
KIF$SEND
      5156**DCL-ENT  9462--CALL
KIF$WRITE
      5158**DCL-ENT  9434--CALL
KIF$WRITE_IMD
      5159**DCL-ENT  9416--CALL
LCP6_MSG
      5100**DCL      9381<<ASSIGN   9416<>CALL     9434<>CALL     9440<>CALL     9440--CALL
LCP6_MSG.ACCT
      5112**DCL      9450>>ASSIGN
LCP6_MSG.ERR
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:245  
      5107**DCL      9432<<ASSIGN   9458<>CALL
LCP6_MSG.FCN
      5100**DCL      9382<<ASSIGN   9387<<ASSIGN   9421>>IF       9431<<ASSIGN   9445>>DOCASE
LCP6_MSG.MODTIME
      5119**DCL      9453<>CALL
LCP6_MSG.NAME
      5112**DCL      9426<<ASSIGN   9427--ASSIGN   9449>>ASSIGN   9462<>CALL
LCP6_MSG.NAME.L
      5112**DCL      9427>>ASSIGN   9430<<ASSIGN   9430>>ASSIGN
LCP6_MSG.PASS
      5112**DCL      9451>>ASSIGN
LCP6_MSG.PSN
      5117**DCL      9452>>ASSIGN
MAP_DBRK
      8891**DCL      9503>>IF       9512>>IF       9521>>IF
MAP_PGWRITE
      8895**DCL     10136>>ASSIGN  10146>>ASSIGN
MAP_PGWRITE_MOD
      8899**DCL      9505>>ASSIGN   9507>>ASSIGN   9514>>ASSIGN   9516>>ASSIGN   9523>>ASSIGN   9525>>ASSIGN
MERCS
      9253**LABEL    9137--GOTO
MERGE_DFPT
      9995**PROC     9356--CALL     9650--CALL
MERGE_FPT
     10011**PROC     9140--CALL    10001--CALL    10109--CALL
MM$DESC.BOUND
      1198**DCL      1199--REDEF
MM$DESC.FLGS
      1199**DCL      1199--REDEF
MM$PPUT.USER#
      1187**DCL      1187--REDEF
MM_BYP$
      1118**DCL      1118--IMP-PTR
MM_FPMC.RPN
      1124**DCL      9506>>IF       9515>>IF       9524>>IF
MPARAM.ERR
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:246  
      6770**DCL     10073>>ASSIGN
MVTCB_ALT
      9865**LABEL    9866--CALLALT
N$DCT$$
      5257**DCL      5338--IMP-PTR  9398>>ASSIGN
NECC
      5065**DCL      9538<<ASSIGN   9543<<ASSIGN   9544>>IF       9544>>IF       9547>>IF       9670>>IF
      9680>>ASSIGN   9681>>IF       9704>>IF       9746>>IF       9757>>IF       9802>>ASSIGN   9805>>IF
     10155>>IF
NEXT IN PROCEDURE DO_RETRY
     10107**LABEL   10109--CALLALT
NK$LDCT$
      5338**DCL      9398>>ASSIGN
NOT_SAVLDT
      9164**LABEL    9153--GOTO
NO_ALIBERR
      9597**LABEL    9596--CALLALT
NO_DRS IN PROCEDURE MERGE_FPT
     10018**LABEL   10017--CALLALT
NO_FID
      9387**LABEL    9386--CALLALT
NO_IC
      9136**LABEL    9140--CALLALT
NO_MERC_FPT IN PROCEDURE DO_MERC
     10071**LABEL   10072--CALLALT
NO_PRC IN PROCEDURE CHECK_FPT
      9988**LABEL    9974--CALLALT
NO_REGS IN PROCEDURE MERGE_FPT
     10014**LABEL   10013--CALLALT
OECC
      5064**DCL      9537<<ASSIGN   9538>>ASSIGN   9569>>IF       9658>>IF       9681>>IF       9685>>IF
      9706>>IF       9719>>IF       9759>>IF       9785>>IF       9785>>IF      10153>>IF      10155>>IF
PRS
      6775**DCL     10018>>ASSIGN
PXCON.IC
      6766**DCL      9005<<ASSIGN
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:247  
PXCON.SID
      6767**DCL      9006<<ASSIGN
READ_ACK
      9432**LABEL    9422--GOTO     9466--GOTO
RESET
      9035**LABEL    9028--CALLALT  9029--GOTO     9087--GOTO
RUND_DELTA
     10119**PROC     9639--CALL     9730--CALL     9744--CALL     9791--CALL     9811--CALL     9917--CALL
RUND_DELTA2 IN PROCEDURE RUND_DELTA
     10122**ENTRY    9599--CALL
S$CU$
      6717**DCL      9020>>ASSIGN   9054>>ASSIGN   9054>>ASSIGN   9426>>ASSIGN
SC_UE_LCP6_FCN
      5160**DCL-ENT  9470--CALL
SETFULL
      9122**LABEL    9117--CALLALT
SETIC
      9022**LABEL    9004--CALLALT  9007--GOTO     9022--GOTO     9069--GOTO
SET_IRIC
     10040**PROC     9141--CALL     9656--CALL
SSU$DELTAGO
      5151**DCL-ENT  9216--CALL
SS_RTN_IC
      5072**DCL      8944<<ASSIGN   9212>>ASSIGN
STK$
      5053**DCL      8958<<ASSIGN   8972<<ASSIGN   8981>>ASSIGN   8984>>IF       8984>>IF       8987>>IF
      8987>>IF       8989>>IF       8990>>ASSIGN   9136>>IF       9144>>IF       9146>>ASSIGN   9150>>IF
      9175>>ASSIGN   9277>>IF       9277>>IF       9950>>ASSIGN  10073>>ASSIGN  10075>>ASSIGN  10077>>IF
     10077>>IF      10079>>IF      10086>>IF      10087>>IF      10090>>ASSIGN  10091>>IF      10091>>IF
     10093>>IF      10095>>ASSIGN  10096>>ASSIGN
TEMPF
      5062**DCL      9146<<ASSIGN   9147>>IF       9157>>IF       9230<<ASSIGN   9232>>IF       9235>>IF
      9237>>ASSIGN   9768<<ASSIGN   9807>>ASSIGN
TIM
      5348**DCL      9079<<ASSIGN   9082<<ASSIGN   9416<>CALL     9434<>CALL     9440<>CALL     9462<>CALL
TIME
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:248  
      5127**DCL      9064>>ASSIGN   9079>>ASSIGN
TMASK
      5128**DCL      9064>>ASSIGN
TO$
      5054**DCL      9116<<ASSIGN   9119>>ASSIGN   9299<<ASSIGN   9393<<ASSIGN   9394>>IF       9396>>IF
      9396>>IF       9396>>IF       9398<<ASSIGN   9398>>ASSIGN   9400>>IF       9416>>CALL     9434>>CALL
      9440>>CALL     9462>>CALL     9546<<ASSIGN   9547>>IF       9861<<ASSIGN   9887<<ASSIGN   9928>>IF
      9930<<ASSIGN   9932>>ASSIGN   9938>>ASSIGN   9940>>ASSIGN   9949<<ASSIGN   9951>>ASSIGN  10020<<ASSIGN
     10022>>IF      10024>>ASSIGN
TT1
      9079**LABEL    9075--CALLALT
UDB$AUTO
      5145**DCL-ENT  9218--CALL     9749--CALL     9812--CALL    10083--CALL
UDB$CALCOMP
      5152**DCL-ENT  9165--CALL     9207--CALL     9264--CALL     9827--CALL    10081--CALL    10121--CALL
UDB$PMMEXIT2
      5153**DCL-ENT  9600--CALL
UDN$MAGIC
      5139**DCL-ENT  8915--CALL     9340--CALL     9357--CALL     9584--CALL    10120--CALL
UDN$MAGICLS
      5140**DCL-ENT  9582--CALL     9889--CALL
UDN$MAGICRLS
      5141**DCL-ENT 10000--CALL
UEP$TCBSSF
      9948**PROC     9139--CALL    10085--CALL    10108--CALL
UEP$TCBTCB
      9924**PROC     9117--CALL     9301--CALL     9866--CALL     9892--CALL
USTK1$
      5047**DCL         8--PROC     9832--ENTRY    9835>>IF       9836<<ASSIGN   9837>>ASSIGN   9840<<ASSIGN
      9845<<ASSIGN   9847<<ASSIGN   9852--ENTRY    9861>>ASSIGN
USTK2$
      5048**DCL         8--PROC     9832--ENTRY    9852--ENTRY    9862>>ASSIGN   9865<<ASSIGN
VLP$ECCS_V.ECCS.EVSC
      6746**DCL      9676>>ASSIGN
VLP$ECCS_V.ERR
      6746**DCL      9597>>ASSIGN   9678>>ASSIGN
PL6.E3A0      #001=UEP$PMME File=UEP$PMME.:E05TSI                                WED 07/30/97 06:57 Page:249  
VLP$ECCS_V.EVID
      6746**DCL      9677>>ASSIGN
VLP$ECCS_V.SUBC
      6746**DCL      6746--REDEF
VLR_FPRG_FID.ACCT
      6742**DCL      9450<<ASSIGN
VLR_FPRG_FID.MODTIME
      6742**DCL      9453<>CALL
VLR_FPRG_FID.NAME
      6742**DCL      9449<<ASSIGN
VLR_FPRG_FID.PASS
      6742**DCL      9451<<ASSIGN
VLR_FPRG_FID.PSN
      6742**DCL      9452<<ASSIGN
XCON_GO
      9787**LABEL    9769--GOTO

PL6.E3A0      #002=UEP$SAVLDT File=UEP$PMME.:E05TSI                              WED 07/30/97 06:59 Page:250  
     1524        1        /*T***********************************************************/
     1525        2        /*T*                                                         */
     1526        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1527        4        /*T*                                                         */
     1528        5        /*T***********************************************************/
     1529        6        /*F*     NAME:    UEP$SAVLDT
     1530        7                 PURPOSE:  To inspect a TCB frame following M$EXIT or M$TRTN
     1531        8                           to determine if SAVE or LDTRC should now be honored.
     1532        9
     1533       10        */
     1534       11        UEP$SAVLDT: PROC ALTRET;
     1535       12
     1536       13        %INCLUDE B$ROSEG;
     1537       76        %INCLUDE B_MAGIC_C;
     1538      194        %INCLUDE B_MACROS_C;
     1539      305        %T01DESCR (NAME=B$$DESCR);
     1540      313        %INCLUDE B_ULSMAC_C;
     1541     1422        %INCLUDE J$JIT_C;
     1542     1935        %INCLUDE UE_CP6;
     1543     2626        %INCLUDE B$SS;
     1544     2805
     1545     2806                                                /* AUTO Storage                       */
     1546     2807        %B$SVLDT (FPTN=B@SVLDT,STCLASS= ,PARONLY=YES);
     1547     2848
     1548     2849    1   DCL STK$ PTR;
     1549     2850    1   DCL TECCB(0:3) BIT(9);
     1550     2851    1   DCL TEMPIC UBIN(18);
     1551     2852    1   DCL T$ PTR;
     1552     2853    1   DCL I SBIN;
     1553     2854    1   DCL BAD_SAVE_F SBIN;
     1554     2855
     1555     2856                                                /* External Procedures                */
     1556     2857    1   DCL JLL$LDTRC ENTRY(5) ALTRET;
     1557     2858    1   DCL JQS$SAVE ENTRY(4) ALTRET;
     1558     2859    1   DCL JSE$ABORTM ENTRY;
     1559     2860    1   DCL UDN$MAGIC ENTRY;
     1560     2861    1   DCL UEP$CLEARONE ENTRY(3) ALTRET;
PL6.E3A0      #002=UEP$SAVLDT File=UEP$PMME.:E05TSI                              WED 07/30/97 06:59 Page:251  
     1561     2862
     1562     2863                                                /* External Data                      */
     1563     2864        %B_MPT (FPTN=B_MPT,STCLASS=SYMREF);
     1564     2957    1   DCL B$JIT$ PTR SYMREF;
     1565     2958    1   DCL B$ROSEG$ PTR SYMREF;
     1566     2959
     1567     2960                                                /* BASED Structures                   */
     1568     2961        %B$SVLDT (FPTN=B$SVLDT,STCLASS=BASED,PARONLY=YES);
     1569     3002        %B$SVLDT (FPTN=B$SCON, STCLASS="BASED(STK$)", FULL=YES);
     1570     3043
     1571     3044    1   DCL 1 FTCB BASED ALIGNED,
     1572     3045    1         2 * PTR,
     1573     3046    1         2 CRFR SBIN HALF UNAL;
     1574     3047
     1575     3048        %B$ECCB;
     1576     3056        %B$TCB;
     1577     3059        %B$EXCFR (STCLASS="BASED(STK$)");
     1578     3077        %B$XCON (STCLASS="BASED(STK$)");
     1579     3087
     1580     3088                                                /* String Substitutions               */
     1581     3089        %SUB NAME$=B@SVLDT.P0$;
     1582     3090        %SUB ACCT$=B@SVLDT.P1$;
     1583     3091        %SUB PASS$=B@SVLDT.P2$;
     1584     3092        %SUB PSID$=B@SVLDT.P3$;
     1585     3093        %SUB CMD_DSCR$=B@SVLDT.P4$;
     1586     3094
     1587     3095        %SUB_EXC;
     1588     3142        %SUB_ECCDELTA;
     1589     3179        %SUB B$TCB=B_MPT.TCB$->B$TCB;
     1590     3180        %SUB B$SS=B_MPT.SS$->B$SS;
     1591     3181        %SUB B$JIT=B$JIT$->B$JIT;
     1592     3182        %SUB B$ROSEG=B$ROSEG$->B$ROSEG;
     1593     3183        %EJECT;
PL6.E3A0      #002=UEP$SAVLDT File=UEP$PMME.:E05TSI                              WED 07/30/97 06:59 Page:252  
     1594     3184    1      CALL UDN$MAGIC;
     1595     3185
     1596     3186        /*   Make sure that there is a frame on the TCB and that it is
     1597     3187             either XCON or SVLDT.  Also make sure its not a different
     1598     3188             flavor of xcon frame.
     1599     3189        */
     1600     3190    1      IF B_MPT.TCBDESC$->B$$DESCR.BOUND = 0 THEN ALTRETURN;
     1601     3191    1      IF B$TCB.CURRSZ = 0 THEN ALTRETURN;
     1602     3192
     1603     3193    1      STK$=PINCRW(B_MPT.TCB$,B_MPT.TCB$->FTCB.CRFR);
     1604     3194
     1605     3195    1      IF (B$EXCFR.ECC ~= %ECC_XCON#) AND (B$EXCFR.ECC ~= %ECC_SAVLDT#)
     1606     3196    1      THEN ALTRETURN;
     1607     3197
     1608     3198    1      IF NOT(B$XCON.CECCB & %SVL_ECCB#) THEN ALTRETURN;
     1609     3199
     1610     3200        /*    Move the parameters of LINK/LDTRC or SAVE to AUTO.
     1611     3201        */
     1612     3202    1      T$ = ADDR(B$SCON.P0$);
     1613     3203    1      B@SVLDT = T$->B$SVLDT;
     1614     3204
     1615     3205    1      IF NAME$ ~= ADDR(NIL)
     1616     3206    1      THEN NAME$ = ADDR(B@SVLDT.FNAME);
     1617     3207
     1618     3208    1      IF ACCT$ ~= ADDR(NIL)
     1619     3209    1      THEN ACCT$ = ADDR(B@SVLDT.ACCT);
     1620     3210
     1621     3211    1      IF PASS$ ~= ADDR(NIL)
     1622     3212    1      THEN PASS$ = ADDR(B@SVLDT.PASS);
     1623     3213
     1624     3214    1      IF PSID$ ~= ADDR(NIL)
     1625     3215    1      THEN PSID$ = ADDR(B@SVLDT.PSID);
     1626     3216
     1627     3217    1      IF CMD_DSCR$ ~= ADDR(NIL)
     1628     3218    1      THEN CMD_DSCR$ = ADDR(B@SVLDT.CMD_DSCR);
     1629     3219
     1630     3220
PL6.E3A0      #002=UEP$SAVLDT File=UEP$PMME.:E05TSI                              WED 07/30/97 06:59 Page:253  
     1631     3221
     1632     3222
     1633     3223        /*   If this is SAVE, reset the "xcon complete" bit
     1634     3224             in all the ECCBs and remember the current ECCB flags
     1635     3225             less the save flag so they may be restored later.
     1636     3226        */
     1637     3227    1      IF (B$JIT.SVLDTF & %SVL_SAVE#)
     1638     3228    2      THEN DO;
     1639     3229    3           DO I=0 TO 3;
     1640     3230    3                T$=ADDR(B$ROSEG.ECCB(I));
     1641     3231    3                T$->B$ECCB.XCONF.SVLDT='0'B;
     1642     3232    3                TECCB(I)=(T$->B$ECCB.XCONF &~%SVL_SAVE#);
     1643     3233    3                END;
     1644     3234
     1645     3235        /*   Make a SAVE xcon frame look like GET exit control frame.
     1646     3236        */
     1647     3237    2           IF B$EXCFR.ECC=%ECC_XCON#
     1648     3238    3           THEN DO;
     1649     3239
     1650     3240        /*    If xcon was in progress at the time of the SAVE, make the
     1651     3241              GET frame look like xcon already in progress.
     1652     3242        */
     1653     3243    3                IF (B$XCON.ECCB.PROG)
     1654     3244    4                THEN DO;
     1655     3245    4                     B$XCON.ECCB= B_MPT.ECCB$->B$ECCB.XCONF;
     1656     3246    4                     B$XCON.CECCB='001'O/*get*/;
     1657     3247    4                     END;
     1658     3248        /*   If xcon not in progress for the save, make the GET frame look
     1659     3249             like the imitial entry to exit control.
     1660     3250        */
     1661     3251    4                ELSE DO;
     1662     3252    4                     B$XCON.ECCB=(B_MPT.ECCB$->B$ECCB.XCONF &~'400'O)/*prog*/;
     1663     3253    4                     B$XCON.CECCB='401'O/*prog and get*/;
     1664     3254    4                     END;
     1665     3255
     1666     3256        /*   Mark the ECCB xcon flags "in progress for GET".
     1667     3257        */
PL6.E3A0      #002=UEP$SAVLDT File=UEP$PMME.:E05TSI                              WED 07/30/97 06:59 Page:254  
     1668     3258    3                B_MPT.ECCB$->B$ECCB.XCONF='401'O;
     1669     3259
     1670     3260        /*   Reset the IC is Safe Store to the user's xcon routine.
     1671     3261             Reset any M$TRTN ALTRET bit in the real Safe Store frame.
     1672     3262        */
     1673     3263    3                B$SS.IC=B_MPT.ECCB$->B$ECCB.XCON;
     1674     3264    3                B$SS.FPT.ALT='0'B;
     1675     3265    3                END /*do if XCON*/;
     1676     3266
     1677     3267        /*   Remember the address to return to (XCON if SCON set,
     1678     3268             current value from Safe Store IC if not).
     1679     3269        */
     1680     3270    2           TEMPIC = B$SS.IC;
     1681     3271
     1682     3272
     1683     3273        /*    If not delayed for user xcon, clear the SAVLDT frame off the TCB.
     1684     3274        */
     1685     3275    2           IF B$EXCFR.ECC=%ECC_SAVLDT#
     1686     3276    3           THEN DO;
     1687     3277    3                I=0;
     1688     3278    3                CALL UEP$CLEARONE(I,STK$);
     1689     3279    3                END;
     1690     3280
     1691     3281        /*   If SAVEing following user XCON, remember the M$EXIT or M$TRTN
     1692     3282             ALTRET specification in case something goes wrong.
     1693     3283        */
     1694     3284    2           ELSE B$SS.FPT.ALT=B$SCON.SUBC.ALTBIT;
     1695     3285
     1696     3286
     1697     3287        /*   Now, really do the SAVE.
     1698     3288        */
     1699     3289    2           BAD_SAVE_F = 0;;
     1700     3290    2           CALL JQS$SAVE(NAME$,ACCT$,PASS$,PSID$)
     1701     3291    3           WHENALTRETURN DO;
     1702     3292    3                BAD_SAVE_F = 1;
     1703     3293    3                END;
     1704     3294
PL6.E3A0      #002=UEP$SAVLDT File=UEP$PMME.:E05TSI                              WED 07/30/97 06:59 Page:255  
     1705     3295        /*   Restore the ECCB LIMIT and CL3 flags in case returning; ie. to M$TRTN.
     1706     3296        */
     1707     3297    3           DO I=0 TO 3;
     1708     3298    3                T$=ADDR(B$ROSEG.ECCB(I));
     1709     3299    3                T$->B$ECCB.XCONF=(T$->B$ECCB.XCONF | TECCB(I));
     1710     3300    3                END;
     1711     3301
     1712     3302        /*   If no errors on the SAVE, set the "simulated get" xcon bit in
     1713     3303             the ECCB and return to JSE$EXITS.
     1714     3304        */
     1715     3305    2           IF BAD_SAVE_F = 0
     1716     3306    3           THEN DO;
     1717     3307    3                IF (B$JIT.JUNK & %JJ_SCON#)
     1718     3308    3                THEN B$XCON.CECCB.SGET = '1'B;
     1719     3309    3                RETURN;
     1720     3310    3                END;
     1721     3311
     1722     3312        /*   If there were errors doing the SAVE, clear the SAVE xcon
     1723     3313             frame of the TCB and clear any SAVE or GET bits in the user's
     1724     3314             ECCB xcon flags.
     1725     3315        */
     1726     3316    3           ELSE DO;
     1727     3317    3                IF (B$JIT.JUNK & %JJ_SCON#)
     1728     3318    4                THEN DO;
     1729     3319    4                     TEMPIC=B$EXCFR.IC;
     1730     3320    4                     CALL UEP$CLEARONE(0,STK$);
     1731     3321    4                     END;
     1732     3322    3                B_MPT.ECCB$->B$ECCB.XCONF=TECCB(0);
     1733     3323    3                B$SS.IC=TEMPIC;
     1734     3324    3                RETURN;
     1735     3325    3                END;
     1736     3326    2           END /*do if SAVE*/;
     1737     3327
     1738     3328
     1739     3329
     1740     3330        /*   If this is M$LDTRC, call JLL$LDTRC to do it now.
     1741     3331             JLL will only return if an error occurs, in which case we
PL6.E3A0      #002=UEP$SAVLDT File=UEP$PMME.:E05TSI                              WED 07/30/97 06:59 Page:256  
     1742     3332             must abort the user.
     1743     3333        */
     1744     3334    2      ELSE DO;
     1745     3335    2           CALL JLL$LDTRC(NAME$,ACCT$,PASS$,PSID$,CMD_DSCR$) ALTRET(BAD_LNK);
     1746     3336    2   BAD_LNK: ;
     1747     3337    2           B$JIT.SVLDTF=(B$JIT.SVLDTF & %SVL_DIC#);
     1748     3338    2           CALL JSE$ABORTM;
     1749     3339    2           END;
     1750     3340    1   END UEP$SAVLDT;

PL6.E3A0      #002=UEP$SAVLDT File=UEP$PMME.:E05TSI                              WED 07/30/97 06:59 Page:257  
--  Include file information  --

   B$SS.:E05TOU  cannot be made into a system file and is referenced.
   UE_CP6.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   J$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
   B_ULSMAC_C.:E05TOU  is referenced.
   B_MACROS_C.:E05TOU  is referenced.
   B_MAGIC_C.:E05TOU  is referenced.
   B$ROSEG.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure UEP$SAVLDT.

   Procedure UEP$SAVLDT requires 236 words for executable code.
   Procedure UEP$SAVLDT requires 36 words of local(AUTO) storage.

    No errors detected in file UEP$PMME.:E05TSI    .

PL6.E3A0      #002=UEP$SAVLDT File=UEP$PMME.:E05TSI                              WED 07/30/97 06:59 Page:258  

 Object Unit name= UEP$SAVLDT                                 File name= UEP$PMME.:E05TOU
 UTS= JUL 30 '97 06:59:01.12 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none   236    354  UEP$SAVLDT
    1  RoData even  none     2      2  UEP$SAVLDT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes    yes     yes      Std        0  UEP$SAVLDT

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       0 UDN$MAGIC
 yes     yes           Std       3 UEP$CLEARONE
 yes     yes           Std       4 JQS$SAVE
 yes     yes           Std       5 JLL$LDTRC
         yes           Std       0 JSE$ABORTM
                       nStd      0 X66_AUTO_0
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AALT
                       nStd      0 X66_ARET
PL6.E3A0      #002=UEP$SAVLDT File=UEP$PMME.:E05TSI                              WED 07/30/97 06:59 Page:259  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     B_MPT                                 B$JIT$                                B$ROSEG$
     B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #002=UEP$SAVLDT File=UEP$PMME.:E05TSI                              WED 07/30/97 06:59 Page:260  


     1524        1        /*T***********************************************************/
     1525        2        /*T*                                                         */
     1526        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1527        4        /*T*                                                         */
     1528        5        /*T***********************************************************/
     1529        6        /*F*     NAME:    UEP$SAVLDT
     1530        7                 PURPOSE:  To inspect a TCB frame following M$EXIT or M$TRTN
     1531        8                           to determine if SAVE or LDTRC should now be honored.
     1532        9
     1533       10        */
     1534       11        UEP$SAVLDT: PROC ALTRET;

     11  0 000000   000000 700200 xent  UEP$SAVLDT   TSX0  ! X66_AUTO_0
         0 000001   000044 000000                    ZERO    36,0

     1535       12
     1536       13        %INCLUDE B$ROSEG;
     1537       76        %INCLUDE B_MAGIC_C;
     1538      194        %INCLUDE B_MACROS_C;
     1539      305        %T01DESCR (NAME=B$$DESCR);
     1540      313        %INCLUDE B_ULSMAC_C;
     1541     1422        %INCLUDE J$JIT_C;
     1542     1935        %INCLUDE UE_CP6;
     1543     2626        %INCLUDE B$SS;
     1544     2805
     1545     2806                                                /* AUTO Storage                       */
     1546     2807        %B$SVLDT (FPTN=B@SVLDT,STCLASS= ,PARONLY=YES);
     1547     2848
     1548     2849    1   DCL STK$ PTR;
     1549     2850    1   DCL TECCB(0:3) BIT(9);
     1550     2851    1   DCL TEMPIC UBIN(18);
     1551     2852    1   DCL T$ PTR;
     1552     2853    1   DCL I SBIN;
     1553     2854    1   DCL BAD_SAVE_F SBIN;
     1554     2855
     1555     2856                                                /* External Procedures                */
PL6.E3A0      #002=UEP$SAVLDT File=UEP$PMME.:E05TSI                              WED 07/30/97 06:59 Page:261  
     1556     2857    1   DCL JLL$LDTRC ENTRY(5) ALTRET;
     1557     2858    1   DCL JQS$SAVE ENTRY(4) ALTRET;
     1558     2859    1   DCL JSE$ABORTM ENTRY;
     1559     2860    1   DCL UDN$MAGIC ENTRY;
     1560     2861    1   DCL UEP$CLEARONE ENTRY(3) ALTRET;
     1561     2862
     1562     2863                                                /* External Data                      */
     1563     2864        %B_MPT (FPTN=B_MPT,STCLASS=SYMREF);
     1564     2957    1   DCL B$JIT$ PTR SYMREF;
     1565     2958    1   DCL B$ROSEG$ PTR SYMREF;
     1566     2959
     1567     2960                                                /* BASED Structures                   */
     1568     2961        %B$SVLDT (FPTN=B$SVLDT,STCLASS=BASED,PARONLY=YES);
     1569     3002        %B$SVLDT (FPTN=B$SCON, STCLASS="BASED(STK$)", FULL=YES);
     1570     3043
     1571     3044    1   DCL 1 FTCB BASED ALIGNED,
     1572     3045    1         2 * PTR,
     1573     3046    1         2 CRFR SBIN HALF UNAL;
     1574     3047
     1575     3048        %B$ECCB;
     1576     3056        %B$TCB;
     1577     3059        %B$EXCFR (STCLASS="BASED(STK$)");
     1578     3077        %B$XCON (STCLASS="BASED(STK$)");
     1579     3087
     1580     3088                                                /* String Substitutions               */
     1581     3089        %SUB NAME$=B@SVLDT.P0$;
     1582     3090        %SUB ACCT$=B@SVLDT.P1$;
     1583     3091        %SUB PASS$=B@SVLDT.P2$;
     1584     3092        %SUB PSID$=B@SVLDT.P3$;
     1585     3093        %SUB CMD_DSCR$=B@SVLDT.P4$;
     1586     3094
     1587     3095        %SUB_EXC;
     1588     3142        %SUB_ECCDELTA;
     1589     3179        %SUB B$TCB=B_MPT.TCB$->B$TCB;
     1590     3180        %SUB B$SS=B_MPT.SS$->B$SS;
     1591     3181        %SUB B$JIT=B$JIT$->B$JIT;
     1592     3182        %SUB B$ROSEG=B$ROSEG$->B$ROSEG;
PL6.E3A0      #002=UEP$SAVLDT File=UEP$PMME.:E05TSI                              WED 07/30/97 06:59 Page:262  
     1593     3183        %EJECT;
PL6.E3A0      #002=UEP$SAVLDT File=UEP$PMME.:E05TSI                              WED 07/30/97 06:59 Page:263  
     1594     3184    1      CALL UDN$MAGIC;

   3184  0 000002   000002 631400 xsym               EPPR1   B_VECTNIL+2
         0 000003   000000 701000 xent               TSX1    UDN$MAGIC
         0 000004   000000 011000                    NOP     0

     1595     3185
     1596     3186        /*   Make sure that there is a frame on the TCB and that it is
     1597     3187             either XCON or SVLDT.  Also make sure its not a different
     1598     3188             flavor of xcon frame.
     1599     3189        */
     1600     3190    1      IF B_MPT.TCBDESC$->B$$DESCR.BOUND = 0 THEN ALTRETURN;

   3190  0 000005   000012 470400 xsym               LDP0    B_MPT+10
         0 000006   000000 236100                    LDQ     0,,PR0
         0 000007   000034 316000 xsym               CANQ    B_VECTNIL+28
         0 000010   000012 601000 0                  TNZ     s:3191

   3190  0 000011   000000 702200 xent               TSX2  ! X66_AALT

     1601     3191    1      IF B$TCB.CURRSZ = 0 THEN ALTRETURN;

   3191  0 000012   000004 471400 xsym               LDP1    B_MPT+4
         0 000013   100002 720100                    LXL0    2,,PR1
         0 000014   000016 601000 0                  TNZ     s:3193

   3191  0 000015   000000 702200 xent               TSX2  ! X66_AALT

     1602     3192
     1603     3193    1      STK$=PINCRW(B_MPT.TCB$,B_MPT.TCB$->FTCB.CRFR);

   3193  0 000016   100001 221100                    LDX1    1,,PR1
         0 000017   000000 636011                    EAQ     0,X1
         0 000020   000004 036000 xsym               ADLQ    B_MPT+4
         0 000021   200030 756100                    STQ     STK$,,AUTO

     1604     3194
PL6.E3A0      #002=UEP$SAVLDT File=UEP$PMME.:E05TSI                              WED 07/30/97 06:59 Page:264  
     1605     3195    1      IF (B$EXCFR.ECC ~= %ECC_XCON#) AND (B$EXCFR.ECC ~= %ECC_SAVLDT#)

   3195  0 000022   200030 473500                    LDP3    STK$,,AUTO
         0 000023   300000 720100                    LXL0    0,,PR3
         0 000024   000003 100003                    CMPX0   3,DU
         0 000025   000031 600000 0                  TZE     s:3198
         0 000026   000136 100003                    CMPX0   94,DU
         0 000027   000031 600000 0                  TZE     s:3198

     1606     3196    1      THEN ALTRETURN;

   3196  0 000030   000000 702200 xent               TSX2  ! X66_AALT

     1607     3197
     1608     3198    1      IF NOT(B$XCON.CECCB & %SVL_ECCB#) THEN ALTRETURN;

   3198  0 000031   300100 236100                    LDQ     64,,PR3
         0 000032   777000 376003                    ANQ     -512,DU
         0 000033   016000 376003                    ANQ     7168,DU
         0 000034   000036 601000 0                  TNZ     s:3202

   3198  0 000035   000000 702200 xent               TSX2  ! X66_AALT

     1609     3199
     1610     3200        /*    Move the parameters of LINK/LDTRC or SAVE to AUTO.
     1611     3201        */
     1612     3202    1      T$ = ADDR(B$SCON.P0$);

   3202  0 000036   200030 236100                    LDQ     STK$,,AUTO
         0 000037   000104 036003                    ADLQ    68,DU
         0 000040   200033 756100                    STQ     T$,,AUTO

     1613     3203    1      B@SVLDT = T$->B$SVLDT;

   3203  0 000041   200033 474500                    LDP4    T$,,AUTO
         0 000042   000100 100500                    MLR     fill='000'O
         0 000043   400000 000124                    ADSC9   0,,PR4                   cn=0,n=84
PL6.E3A0      #002=UEP$SAVLDT File=UEP$PMME.:E05TSI                              WED 07/30/97 06:59 Page:265  
         0 000044   200003 000124                    ADSC9   B@SVLDT,,AUTO            cn=0,n=84

     1614     3204
     1615     3205    1      IF NAME$ ~= ADDR(NIL)

   3205  0 000045   200003 236100                    LDQ     B@SVLDT,,AUTO
         0 000046   000001 116000 xsym               CMPQ    B_VECTNIL+1
         0 000047   000052 600000 0                  TZE     s:3208

     1616     3206    1      THEN NAME$ = ADDR(B@SVLDT.FNAME);

   3206  0 000050   200010 635500                    EPPR5   B@SVLDT+5,,AUTO
         0 000051   200003 455500                    STP5    B@SVLDT,,AUTO

     1617     3207
     1618     3208    1      IF ACCT$ ~= ADDR(NIL)

   3208  0 000052   200004 236100                    LDQ     B@SVLDT+1,,AUTO
         0 000053   000001 116000 xsym               CMPQ    B_VECTNIL+1
         0 000054   000057 600000 0                  TZE     s:3211

     1619     3209    1      THEN ACCT$ = ADDR(B@SVLDT.ACCT);

   3209  0 000055   200020 635500                    EPPR5   B@SVLDT+13,,AUTO
         0 000056   200004 455500                    STP5    B@SVLDT+1,,AUTO

     1620     3210
     1621     3211    1      IF PASS$ ~= ADDR(NIL)

   3211  0 000057   200005 236100                    LDQ     B@SVLDT+2,,AUTO
         0 000060   000001 116000 xsym               CMPQ    B_VECTNIL+1
         0 000061   000064 600000 0                  TZE     s:3214

     1622     3212    1      THEN PASS$ = ADDR(B@SVLDT.PASS);

   3212  0 000062   200022 635500                    EPPR5   B@SVLDT+15,,AUTO
         0 000063   200005 455500                    STP5    B@SVLDT+2,,AUTO
PL6.E3A0      #002=UEP$SAVLDT File=UEP$PMME.:E05TSI                              WED 07/30/97 06:59 Page:266  

     1623     3213
     1624     3214    1      IF PSID$ ~= ADDR(NIL)

   3214  0 000064   200006 236100                    LDQ     B@SVLDT+3,,AUTO
         0 000065   000001 116000 xsym               CMPQ    B_VECTNIL+1
         0 000066   000071 600000 0                  TZE     s:3217

     1625     3215    1      THEN PSID$ = ADDR(B@SVLDT.PSID);

   3215  0 000067   200024 635500                    EPPR5   B@SVLDT+17,,AUTO
         0 000070   200006 455500                    STP5    B@SVLDT+3,,AUTO

     1626     3216
     1627     3217    1      IF CMD_DSCR$ ~= ADDR(NIL)

   3217  0 000071   200007 236100                    LDQ     B@SVLDT+4,,AUTO
         0 000072   000001 116000 xsym               CMPQ    B_VECTNIL+1
         0 000073   000076 600000 0                  TZE     s:3227

     1628     3218    1      THEN CMD_DSCR$ = ADDR(B@SVLDT.CMD_DSCR);

   3218  0 000074   200026 635500                    EPPR5   B@SVLDT+19,,AUTO
         0 000075   200007 455500                    STP5    B@SVLDT+4,,AUTO

     1629     3219
     1630     3220
     1631     3221
     1632     3222
     1633     3223        /*   If this is SAVE, reset the "xcon complete" bit
     1634     3224             in all the ECCBs and remember the current ECCB flags
     1635     3225             less the save flag so they may be restored later.
     1636     3226        */
     1637     3227    1      IF (B$JIT.SVLDTF & %SVL_SAVE#)

   3227  0 000076   000000 475400 xsym               LDP5    B$JIT$
         0 000077   500316 236100                    LDQ     206,,PR5
PL6.E3A0      #002=UEP$SAVLDT File=UEP$PMME.:E05TSI                              WED 07/30/97 06:59 Page:267  
         0 000100   000033 736000                    QLS     27
         0 000101   006000 376003                    ANQ     3072,DU
         0 000102   000324 600000 0                  TZE     s:3335

     1638     3228    2      THEN DO;

     1639     3229    3           DO I=0 TO 3;

   3229  0 000103   200034 450100                    STZ     I,,AUTO

     1640     3230    3                T$=ADDR(B$ROSEG.ECCB(I));

   3230  0 000104   200034 236100                    LDQ     I,,AUTO
         0 000105   000006 402003                    MPY     6,DU
         0 000106   000024 036003                    ADLQ    20,DU
         0 000107   000000 036000 xsym               ADLQ    B$ROSEG$
         0 000110   200033 756100                    STQ     T$,,AUTO

     1641     3231    3                T$->B$ECCB.XCONF.SVLDT='0'B;

   3231  0 000111   200033 470500                    LDP0    T$,,AUTO
         0 000112   000000 236000 1                  LDQ     0
         0 000113   000004 356100                    ANSQ    4,,PR0

     1642     3232    3                TECCB(I)=(T$->B$ECCB.XCONF &~%SVL_SAVE#);

   3232  0 000114   000004 236100                    LDQ     4,,PR0
         0 000115   000011 736000                    QLS     9
         0 000116   777000 376003                    ANQ     -512,DU
         0 000117   771000 376003                    ANQ     -3584,DU
         0 000120   200036 756100                    STQ     BAD_SAVE_F+1,,AUTO
         0 000121   200034 235100                    LDA     I,,AUTO
         0 000122   000105 100500                    MLR     fill='000'O
         0 000123   200036 000004                    ADSC9   BAD_SAVE_F+1,,AUTO       cn=0,n=4
         0 000124   200031 000001                    ADSC9   TECCB,A,AUTO             cn=0,n=1

     1643     3233    3                END;
PL6.E3A0      #002=UEP$SAVLDT File=UEP$PMME.:E05TSI                              WED 07/30/97 06:59 Page:268  

   3233  0 000125   200034 054100                    AOS     I,,AUTO
         0 000126   200034 235100                    LDA     I,,AUTO
         0 000127   000003 115007                    CMPA    3,DL
         0 000130   000104 604400 0                  TMOZ    s:3230

     1644     3234
     1645     3235        /*   Make a SAVE xcon frame look like GET exit control frame.
     1646     3236        */
     1647     3237    2           IF B$EXCFR.ECC=%ECC_XCON#

   3237  0 000131   200030 471500                    LDP1    STK$,,AUTO
         0 000132   100000 720100                    LXL0    0,,PR1
         0 000133   000003 100003                    CMPX0   3,DU
         0 000134   000170 601000 0                  TNZ     s:3270

     1648     3238    3           THEN DO;

     1649     3239
     1650     3240        /*    If xcon was in progress at the time of the SAVE, make the
     1651     3241              GET frame look like xcon already in progress.
     1652     3242        */
     1653     3243    3                IF (B$XCON.ECCB.PROG)

   3243  0 000135   100101 236100                    LDQ     65,,PR1
         0 000136   000400 316007                    CANQ    256,DL
         0 000137   000147 600000 0                  TZE     s:3252

     1654     3244    4                THEN DO;

     1655     3245    4                     B$XCON.ECCB= B_MPT.ECCB$->B$ECCB.XCONF;

   3245  0 000140   000005 473400 xsym               LDP3    B_MPT+5
         0 000141   300004 236100                    LDQ     4,,PR3
         0 000142   000022 772000                    QRL     18
         0 000143   100101 552104                    STBQ    65,'04'O,PR1

PL6.E3A0      #002=UEP$SAVLDT File=UEP$PMME.:E05TSI                              WED 07/30/97 06:59 Page:269  
     1656     3246    4                     B$XCON.CECCB='001'O/*get*/;

   3246  0 000144   001000 236003                    LDQ     512,DU
         0 000145   100100 552140                    STBQ    64,'40'O,PR1

     1657     3247    4                     END;

   3247  0 000146   000160 710000 0                  TRA     s:3258

     1658     3248        /*   If xcon not in progress for the save, make the GET frame look
     1659     3249             like the imitial entry to exit control.
     1660     3250        */
     1661     3251    4                ELSE DO;

     1662     3252    4                     B$XCON.ECCB=(B_MPT.ECCB$->B$ECCB.XCONF &~'400'O)/*prog*/;

   3252  0 000147   000005 473400 xsym               LDP3    B_MPT+5
         0 000150   300004 236100                    LDQ     4,,PR3
         0 000151   000011 736000                    QLS     9
         0 000152   777000 376003                    ANQ     -512,DU
         0 000153   377000 376003                    ANQ     130560,DU
         0 000154   000033 772000                    QRL     27
         0 000155   100101 552104                    STBQ    65,'04'O,PR1

     1663     3253    4                     B$XCON.CECCB='401'O/*prog and get*/;

   3253  0 000156   401000 236003                    LDQ     -130560,DU
         0 000157   100100 552140                    STBQ    64,'40'O,PR1

     1664     3254    4                     END;

     1665     3255
     1666     3256        /*   Mark the ECCB xcon flags "in progress for GET".
     1667     3257        */
     1668     3258    3                B_MPT.ECCB$->B$ECCB.XCONF='401'O;

   3258  0 000160   000401 236003                    LDQ     257,DU
PL6.E3A0      #002=UEP$SAVLDT File=UEP$PMME.:E05TSI                              WED 07/30/97 06:59 Page:270  
         0 000161   300004 552120                    STBQ    4,'20'O,PR3

     1669     3259
     1670     3260        /*   Reset the IC is Safe Store to the user's xcon routine.
     1671     3261             Reset any M$TRTN ALTRET bit in the real Safe Store frame.
     1672     3262        */
     1673     3263    3                B$SS.IC=B_MPT.ECCB$->B$ECCB.XCON;

   3263  0 000162   000005 471400 xsym               LDP1    B_MPT+5
         0 000163   100001 720100                    LXL0    1,,PR1
         0 000164   000000 473400 xsym               LDP3    B_MPT
         0 000165   300004 740100                    STX0    4,,PR3

     1674     3264    3                B$SS.FPT.ALT='0'B;

   3264  0 000166   000031 236000 xsym               LDQ     B_VECTNIL+25
         0 000167   300001 356100                    ANSQ    1,,PR3

     1675     3265    3                END /*do if XCON*/;

     1676     3266
     1677     3267        /*   Remember the address to return to (XCON if SCON set,
     1678     3268             current value from Safe Store IC if not).
     1679     3269        */
     1680     3270    2           TEMPIC = B$SS.IC;

   3270  0 000170   000000 471400 xsym               LDP1    B_MPT
         0 000171   100004 220100                    LDX0    4,,PR1
         0 000172   200032 740100                    STX0    TEMPIC,,AUTO

     1681     3271
     1682     3272
     1683     3273        /*    If not delayed for user xcon, clear the SAVLDT frame off the TCB.
     1684     3274        */
     1685     3275    2           IF B$EXCFR.ECC=%ECC_SAVLDT#

   3275  0 000173   200030 473500                    LDP3    STK$,,AUTO
PL6.E3A0      #002=UEP$SAVLDT File=UEP$PMME.:E05TSI                              WED 07/30/97 06:59 Page:271  
         0 000174   300000 721100                    LXL1    0,,PR3
         0 000175   000136 101003                    CMPX1   94,DU
         0 000176   000211 601000 0                  TNZ     s:3284

     1686     3276    3           THEN DO;

     1687     3277    3                I=0;

   3277  0 000177   200034 450100                    STZ     I,,AUTO

     1688     3278    3                CALL UEP$CLEARONE(I,STK$);

   3278  0 000200   200030 634500                    EPPR4   STK$,,AUTO
         0 000201   200037 454500                    STP4    BAD_SAVE_F+2,,AUTO
         0 000202   200034 635500                    EPPR5   I,,AUTO
         0 000203   200036 455500                    STP5    BAD_SAVE_F+1,,AUTO
         0 000204   200036 630500                    EPPR0   BAD_SAVE_F+1,,AUTO
         0 000205   000020 631400 xsym               EPPR1   B_VECTNIL+16
         0 000206   000000 701000 xent               TSX1    UEP$CLEARONE
         0 000207   000000 011000                    NOP     0

     1689     3279    3                END;

   3279  0 000210   000216 710000 0                  TRA     s:3289

     1690     3280
     1691     3281        /*   If SAVEing following user XCON, remember the M$EXIT or M$TRTN
     1692     3282             ALTRET specification in case something goes wrong.
     1693     3283        */
     1694     3284    2           ELSE B$SS.FPT.ALT=B$SCON.SUBC.ALTBIT;

   3284  0 000211   300100 236100                    LDQ     64,,PR3
         0 000212   000011 736000                    QLS     9
         0 000213   100001 676100                    ERQ     1,,PR1
         0 000214   400000 376003                    ANQ     -131072,DU
         0 000215   100001 656100                    ERSQ    1,,PR1

PL6.E3A0      #002=UEP$SAVLDT File=UEP$PMME.:E05TSI                              WED 07/30/97 06:59 Page:272  
     1695     3285
     1696     3286
     1697     3287        /*   Now, really do the SAVE.
     1698     3288        */
     1699     3289    2           BAD_SAVE_F = 0;;

   3289  0 000216   200035 450100                    STZ     BAD_SAVE_F,,AUTO

     1700     3290    2           CALL JQS$SAVE(NAME$,ACCT$,PASS$,PSID$)

   3290  0 000217   200006 630500                    EPPR0   B@SVLDT+3,,AUTO
         0 000220   200041 450500                    STP0    BAD_SAVE_F+4,,AUTO
         0 000221   200005 631500                    EPPR1   B@SVLDT+2,,AUTO
         0 000222   200040 451500                    STP1    BAD_SAVE_F+3,,AUTO
         0 000223   200004 633500                    EPPR3   B@SVLDT+1,,AUTO
         0 000224   200037 453500                    STP3    BAD_SAVE_F+2,,AUTO
         0 000225   200003 634500                    EPPR4   B@SVLDT,,AUTO
         0 000226   200036 454500                    STP4    BAD_SAVE_F+1,,AUTO
         0 000227   200036 630500                    EPPR0   BAD_SAVE_F+1,,AUTO
         0 000230   000022 631400 xsym               EPPR1   B_VECTNIL+18
         0 000231   000000 701000 xent               TSX1    JQS$SAVE
         0 000232   000234 702000 0                  TSX2    s:3292
         0 000233   000236 710000 0                  TRA     s:3297

     1701     3291    3           WHENALTRETURN DO;

     1702     3292    3                BAD_SAVE_F = 1;

   3292  0 000234   000001 235007                    LDA     1,DL
         0 000235   200035 755100                    STA     BAD_SAVE_F,,AUTO

     1703     3293    3                END;

     1704     3294
     1705     3295        /*   Restore the ECCB LIMIT and CL3 flags in case returning; ie. to M$TRTN.
     1706     3296        */
     1707     3297    3           DO I=0 TO 3;
PL6.E3A0      #002=UEP$SAVLDT File=UEP$PMME.:E05TSI                              WED 07/30/97 06:59 Page:273  

   3297  0 000236   200034 450100                    STZ     I,,AUTO

     1708     3298    3                T$=ADDR(B$ROSEG.ECCB(I));

   3298  0 000237   200034 236100                    LDQ     I,,AUTO
         0 000240   000006 402003                    MPY     6,DU
         0 000241   000024 036003                    ADLQ    20,DU
         0 000242   000000 036000 xsym               ADLQ    B$ROSEG$
         0 000243   200033 756100                    STQ     T$,,AUTO

     1709     3299    3                T$->B$ECCB.XCONF=(T$->B$ECCB.XCONF | TECCB(I));

   3299  0 000244   200034 235100                    LDA     I,,AUTO
         0 000245   000100 100505                    MLR     fill='000'O
         0 000246   200031 000001                    ADSC9   TECCB,A,AUTO             cn=0,n=1
         0 000247   200036 000004                    ADSC9   BAD_SAVE_F+1,,AUTO       cn=0,n=4
         0 000250   200033 470500                    LDP0    T$,,AUTO
         0 000251   000004 236100                    LDQ     4,,PR0
         0 000252   000011 736000                    QLS     9
         0 000253   777000 376003                    ANQ     -512,DU
         0 000254   200036 276100                    ORQ     BAD_SAVE_F+1,,AUTO
         0 000255   000011 772000                    QRL     9
         0 000256   000004 552120                    STBQ    4,'20'O,PR0

     1710     3300    3                END;

   3300  0 000257   200034 054100                    AOS     I,,AUTO
         0 000260   200034 235100                    LDA     I,,AUTO
         0 000261   000003 115007                    CMPA    3,DL
         0 000262   000237 604400 0                  TMOZ    s:3298

     1711     3301
     1712     3302        /*   If no errors on the SAVE, set the "simulated get" xcon bit in
     1713     3303             the ECCB and return to JSE$EXITS.
     1714     3304        */
     1715     3305    2           IF BAD_SAVE_F = 0
PL6.E3A0      #002=UEP$SAVLDT File=UEP$PMME.:E05TSI                              WED 07/30/97 06:59 Page:274  

   3305  0 000263   200035 236100                    LDQ     BAD_SAVE_F,,AUTO
         0 000264   000275 601000 0                  TNZ     s:3317

     1716     3306    3           THEN DO;

     1717     3307    3                IF (B$JIT.JUNK & %JJ_SCON#)

   3307  0 000265   000000 471400 xsym               LDP1    B$JIT$
         0 000266   100315 220100                    LDX0    205,,PR1
         0 000267   100000 360003                    ANX0    32768,DU
         0 000270   000274 600000 0                  TZE     s:3309

     1718     3308    3                THEN B$XCON.CECCB.SGET = '1'B;

   3308  0 000271   200030 473500                    LDP3    STK$,,AUTO
         0 000272   020000 236003                    LDQ     8192,DU
         0 000273   300100 256100                    ORSQ    64,,PR3

     1719     3309    3                RETURN;

   3309  0 000274   000000 702200 xent               TSX2  ! X66_ARET

     1720     3310    3                END;
     1721     3311
     1722     3312        /*   If there were errors doing the SAVE, clear the SAVE xcon
     1723     3313             frame of the TCB and clear any SAVE or GET bits in the user's
     1724     3314             ECCB xcon flags.
     1725     3315        */
     1726     3316    3           ELSE DO;

     1727     3317    3                IF (B$JIT.JUNK & %JJ_SCON#)

   3317  0 000275   000000 471400 xsym               LDP1    B$JIT$
         0 000276   100315 220100                    LDX0    205,,PR1
         0 000277   100000 360003                    ANX0    32768,DU
         0 000300   000314 600000 0                  TZE     s:3322
PL6.E3A0      #002=UEP$SAVLDT File=UEP$PMME.:E05TSI                              WED 07/30/97 06:59 Page:275  

     1728     3318    4                THEN DO;

     1729     3319    4                     TEMPIC=B$EXCFR.IC;

   3319  0 000301   200030 473500                    LDP3    STK$,,AUTO
         0 000302   300004 220100                    LDX0    4,,PR3
         0 000303   200032 740100                    STX0    TEMPIC,,AUTO

     1730     3320    4                     CALL UEP$CLEARONE(0,STK$);

   3320  0 000304   200030 634500                    EPPR4   STK$,,AUTO
         0 000305   200037 454500                    STP4    BAD_SAVE_F+2,,AUTO
         0 000306   000001 236000 1                  LDQ     1
         0 000307   200036 756100                    STQ     BAD_SAVE_F+1,,AUTO
         0 000310   200036 630500                    EPPR0   BAD_SAVE_F+1,,AUTO
         0 000311   000020 631400 xsym               EPPR1   B_VECTNIL+16
         0 000312   000000 701000 xent               TSX1    UEP$CLEARONE
         0 000313   000000 011000                    NOP     0

     1731     3321    4                     END;

     1732     3322    3                B_MPT.ECCB$->B$ECCB.XCONF=TECCB(0);

   3322  0 000314   000005 470400 xsym               LDP0    B_MPT+5
         0 000315   200031 236100                    LDQ     TECCB,,AUTO
         0 000316   000011 772000                    QRL     9
         0 000317   000004 552120                    STBQ    4,'20'O,PR0

     1733     3323    3                B$SS.IC=TEMPIC;

   3323  0 000320   200032 220100                    LDX0    TEMPIC,,AUTO
         0 000321   000000 470400 xsym               LDP0    B_MPT
         0 000322   000004 740100                    STX0    4,,PR0

     1734     3324    3                RETURN;

PL6.E3A0      #002=UEP$SAVLDT File=UEP$PMME.:E05TSI                              WED 07/30/97 06:59 Page:276  
   3324  0 000323   000000 702200 xent               TSX2  ! X66_ARET

     1735     3325    3                END;
     1736     3326    2           END /*do if SAVE*/;
     1737     3327
     1738     3328
     1739     3329
     1740     3330        /*   If this is M$LDTRC, call JLL$LDTRC to do it now.
     1741     3331             JLL will only return if an error occurs, in which case we
     1742     3332             must abort the user.
     1743     3333        */
     1744     3334    2      ELSE DO;

     1745     3335    2           CALL JLL$LDTRC(NAME$,ACCT$,PASS$,PSID$,CMD_DSCR$) ALTRET(BAD_LNK);

   3335  0 000324   200007 636500                    EPPR6   B@SVLDT+4,,AUTO
         0 000325   200042 456500                    STP6    BAD_SAVE_F+5,,AUTO
         0 000326   200006 637500                    EPPR7   B@SVLDT+3,,AUTO
         0 000327   200041 457500                    STP7    BAD_SAVE_F+4,,AUTO
         0 000330   200005 630500                    EPPR0   B@SVLDT+2,,AUTO
         0 000331   200040 450500                    STP0    BAD_SAVE_F+3,,AUTO
         0 000332   200004 630500                    EPPR0   B@SVLDT+1,,AUTO
         0 000333   200037 450500                    STP0    BAD_SAVE_F+2,,AUTO
         0 000334   200003 630500                    EPPR0   B@SVLDT,,AUTO
         0 000335   200036 450500                    STP0    BAD_SAVE_F+1,,AUTO
         0 000336   200036 630500                    EPPR0   BAD_SAVE_F+1,,AUTO
         0 000337   000023 631400 xsym               EPPR1   B_VECTNIL+19
         0 000340   000000 701000 xent               TSX1    JLL$LDTRC
         0 000341   000342 702000 0                  TSX2    BAD_LNK

   3335  0 000342                       BAD_LNK      null
     1746     3336    2   BAD_LNK: ;
     1747     3337    2           B$JIT.SVLDTF=(B$JIT.SVLDTF & %SVL_DIC#);

   3337  0 000342   000000 470400 xsym               LDP0    B$JIT$
         0 000343   000316 236100                    LDQ     206,,PR0
         0 000344   000033 736000                    QLS     27
PL6.E3A0      #002=UEP$SAVLDT File=UEP$PMME.:E05TSI                              WED 07/30/97 06:59 Page:277  
         0 000345   200000 376003                    ANQ     65536,DU
         0 000346   000033 772000                    QRL     27
         0 000347   000316 552104                    STBQ    206,'04'O,PR0

     1748     3338    2           CALL JSE$ABORTM;

   3338  0 000350   000002 631400 xsym               EPPR1   B_VECTNIL+2
         0 000351   000000 701000 xent               TSX1    JSE$ABORTM
         0 000352   000000 011000                    NOP     0

     1749     3339    2           END;

     1750     3340    1   END UEP$SAVLDT;

   3340  0 000353   000000 702200 xent               TSX2  ! X66_ARET

(unnamed)
 Sect OctLoc
   1     000   777757 777777   000002 006000                                    ........

PL6.E3A0      #002=UEP$SAVLDT File=UEP$PMME.:E05TSI                              WED 07/30/97 06:59 Page:278  
--  Include file information  --

   B$SS.:E05TOU  cannot be made into a system file and is referenced.
   UE_CP6.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   J$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
   B_ULSMAC_C.:E05TOU  is referenced.
   B_MACROS_C.:E05TOU  is referenced.
   B_MAGIC_C.:E05TOU  is referenced.
   B$ROSEG.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure UEP$SAVLDT.
PL6.E3A0      #002=UEP$SAVLDT File=UEP$PMME.:E05TSI                              WED 07/30/97 06:59 Page:279  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w STRC(756)   r     1 B@SVLDT                   35-0-0/w SBIN        r     1 BAD_SAVE_F
    34-0-0/w SBIN        r     1 I                         30-0-0/w PTR         r     1 STK$
    33-0-0/w PTR         r     1 T$                        31-0-0/b BIT (9)     r     1 TECCB(0:3)
    32-0-0/w UBIN(18)    r     1 TEMPIC

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$ROSEG$
     0-0-0/d STRC(432)   r     1 B_MPT

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(72)    r     1 B$$DESCR                   0-0-0/w STRC(180)   r     1 B$ECCB
     0-0-0/w STRC(2448)  r     1 B$EXCFR                    0-0-0/d STRC(8856)  r     1 B$JIT
     0-0-0/d STRC(3024)  r     1 B$ROSEG                    0-0-0/w STRC(3204)  r     1 B$SCON
     0-0-0/d STRC(2304)  r     1 B$SS                       0-0-0/w STRC(756)   r     1 B$SVLDT
     0-0-0/w STRC(144)   r     1 B$TCB                      0-0-0/w STRC(2448)  r     1 B$XCON
     0-0-0/w STRC(54)    r     1 FTCB


   Procedure UEP$SAVLDT requires 236 words for executable code.
   Procedure UEP$SAVLDT requires 36 words of local(AUTO) storage.
PL6.E3A0      #002=UEP$SAVLDT File=UEP$PMME.:E05TSI                              WED 07/30/97 06:59 Page:280  

    No errors detected in file UEP$PMME.:E05TSI    .
PL6.E3A0      #002=UEP$SAVLDT File=UEP$PMME.:E05TSI                              WED 07/30/97 06:59 Page:281  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=UEP$SAVLDT File=UEP$PMME.:E05TSI                              WED 07/30/97 06:59 Page:282  
          MINI XREF LISTING

B$$DESCR.BOUND
       307**DCL      3190>>IF
B$ECCB.XCON
      3049**DCL      3263>>ASSIGN
B$ECCB.XCONF
      3051**DCL      3232>>ASSIGN   3245>>ASSIGN   3252>>ASSIGN   3258<<ASSIGN   3299<<ASSIGN   3299>>ASSIGN
      3322<<ASSIGN
B$ECCB.XCONF.SVLDT
      3052**DCL      3231<<ASSIGN
B$EXCFR.ASL
      3060**DCL      3060--REDEF
B$EXCFR.ECC
      3060**DCL      3195>>IF       3195>>IF       3237>>IF       3275>>IF
B$EXCFR.ERR.ERR#
      3074**DCL      3074--REDEF
B$EXCFR.EVID
      3073**DCL      3073--REDEF    3074--REDEF
B$EXCFR.IC
      3061**DCL      3319>>ASSIGN
B$EXCFR.IR
      3061**DCL      3061--REDEF
B$EXCFR.PREVSZ
      3060**DCL      3060--REDEF
B$EXCFR.SUBC
      3072**DCL      3072--REDEF    3073--REDEF    3073--REDEF
B$JIT.ERR.MID
      1750**DCL      1750--REDEF
B$JIT.JUNK
      1866**DCL      3307>>IF       3317>>IF
B$JIT.SVLDTF
      1907**DCL      3227>>IF       3337<<ASSIGN   3337>>ASSIGN
B$JIT$
PL6.E3A0      #002=UEP$SAVLDT File=UEP$PMME.:E05TSI                              WED 07/30/97 06:59 Page:283  
      2957**DCL      1744--IMP-PTR  3227>>IF       3307>>IF       3317>>IF       3337>>ASSIGN   3337>>ASSIGN
B$ROSEG.ECCB
        30**DCL      3230--ASSIGN   3298--ASSIGN
B$ROSEG$
      2958**DCL      3230>>ASSIGN   3298>>ASSIGN
B$SCON.ACCT$
      3017**DCL      3017--REDEF
B$SCON.CMD_DSCR$
      3018**DCL      3018--REDEF    3018--REDEF
B$SCON.ECCS
      3013**DCL      3013--REDEF
B$SCON.FNAME.TXT
      3018**DCL      3018--REDEF
B$SCON.NAME$
      3017**DCL      3017--REDEF
B$SCON.P0$
      3017**DCL      3202--ASSIGN
B$SCON.PASS$
      3017**DCL      3017--REDEF
B$SCON.PSID$
      3017**DCL      3017--REDEF
B$SCON.SUBC.ALTBIT
      3013**DCL      3284>>ASSIGN
B$SS.FPT.ALT
      2638**DCL      3264<<ASSIGN   3284<<ASSIGN
B$SS.IC
      2645**DCL      3263<<ASSIGN   3270>>ASSIGN   3323<<ASSIGN
B$SS.RVA
      2678**DCL      2679--REDEF
B$SVLDT
      2966**DCL      3203>>ASSIGN
B$SVLDT.ACCT$
      2976**DCL      2976--REDEF
B$SVLDT.CMD_DSCR$
      2977**DCL      2977--REDEF    2977--REDEF
B$SVLDT.FNAME.TXT
PL6.E3A0      #002=UEP$SAVLDT File=UEP$PMME.:E05TSI                              WED 07/30/97 06:59 Page:284  
      2977**DCL      2977--REDEF
B$SVLDT.NAME$
      2976**DCL      2976--REDEF
B$SVLDT.PASS$
      2976**DCL      2976--REDEF
B$SVLDT.PSID$
      2976**DCL      2976--REDEF
B$TCB.CURRSZ
      3057**DCL      3191>>IF
B$XCON.CECCB
      3078**DCL      3198>>IF       3246<<ASSIGN   3253<<ASSIGN
B$XCON.CECCB.SGET
      3078**DCL      3308<<ASSIGN
B$XCON.ECCB
      3083**DCL      3245<<ASSIGN   3252<<ASSIGN
B$XCON.ECCB.PROG
      3083**DCL      3243>>IF
B$XCON.ERR.ERR#
      3084**DCL      3084--REDEF
B$XCON.LIMIT.MEM
      3082**DCL      3082--REDEF
B@SVLDT
      2812**DCL      3203<<ASSIGN
B@SVLDT.ACCT
      2824**DCL      3209--ASSIGN
B@SVLDT.ACCT$
      2822**DCL      2822--REDEF
B@SVLDT.CMD_DSCR
      2841**DCL      3218--ASSIGN
B@SVLDT.CMD_DSCR$
      2823**DCL      2823--REDEF    2823--REDEF
B@SVLDT.FNAME
      2823**DCL      3206--ASSIGN
B@SVLDT.FNAME.TXT
      2823**DCL      2823--REDEF
B@SVLDT.NAME$
PL6.E3A0      #002=UEP$SAVLDT File=UEP$PMME.:E05TSI                              WED 07/30/97 06:59 Page:285  
      2822**DCL      2822--REDEF
B@SVLDT.P0$
      2822**DCL      3205>>IF       3206<<ASSIGN   3290<>CALL     3335<>CALL
B@SVLDT.P1$
      2822**DCL      3208>>IF       3209<<ASSIGN   3290<>CALL     3335<>CALL
B@SVLDT.P2$
      2822**DCL      3211>>IF       3212<<ASSIGN   3290<>CALL     3335<>CALL
B@SVLDT.P3$
      2822**DCL      3214>>IF       3215<<ASSIGN   3290<>CALL     3335<>CALL
B@SVLDT.P4$
      2823**DCL      3217>>IF       3218<<ASSIGN   3335<>CALL
B@SVLDT.PASS
      2824**DCL      3212--ASSIGN
B@SVLDT.PASS$
      2822**DCL      2822--REDEF
B@SVLDT.PSID
      2824**DCL      3215--ASSIGN
B@SVLDT.PSID$
      2822**DCL      2822--REDEF
BAD_LNK
      3335**LABEL    3335--CALLALT
BAD_SAVE_F
      2854**DCL      3289<<ASSIGN   3292<<ASSIGN   3305>>IF
B_MPT.AS
      2900**DCL      2903--REDEF
B_MPT.ASDESC
      2932**DCL      2936--REDEF
B_MPT.ECCB
      2915**DCL      2918--REDEF
B_MPT.ECCB$
      2918**DCL      3245>>ASSIGN   3252>>ASSIGN   3258>>ASSIGN   3263>>ASSIGN   3322>>ASSIGN
B_MPT.ECCBDESC
      2950**DCL      2954--REDEF
B_MPT.LS
      2895**DCL      2898--REDEF
B_MPT.LSDESC
PL6.E3A0      #002=UEP$SAVLDT File=UEP$PMME.:E05TSI                              WED 07/30/97 06:59 Page:286  
      2926**DCL      2930--REDEF
B_MPT.PS
      2905**DCL      2908--REDEF
B_MPT.PSDESC
      2938**DCL      2942--REDEF
B_MPT.SS
      2890**DCL      2893--REDEF
B_MPT.SS$
      2893**DCL      3263>>ASSIGN   3264>>ASSIGN   3270>>ASSIGN   3284>>ASSIGN   3323>>ASSIGN
B_MPT.SSDESC
      2920**DCL      2924--REDEF
B_MPT.TCB
      2910**DCL      2913--REDEF
B_MPT.TCB$
      2913**DCL      3191>>IF       3193>>ASSIGN   3193>>ASSIGN
B_MPT.TCBDESC
      2944**DCL      2948--REDEF
B_MPT.TCBDESC$
      2948**DCL      3190>>IF
FTCB.CRFR
      3046**DCL      3193>>ASSIGN
I
      2853**DCL      3229<<DOINDEX  3230>>ASSIGN   3232>>ASSIGN   3277<<ASSIGN   3278<>CALL     3297<<DOINDEX
      3298>>ASSIGN   3299>>ASSIGN
JLL$LDTRC
      2857**DCL-ENT  3335--CALL
JQS$SAVE
      2858**DCL-ENT  3290--CALL
JSE$ABORTM
      2859**DCL-ENT  3338--CALL
STK$
      2849**DCL      3007--IMP-PTR  3060--IMP-PTR  3078--IMP-PTR  3193<<ASSIGN   3195>>IF       3195>>IF
      3198>>IF       3202>>ASSIGN   3237>>IF       3243>>IF       3245>>ASSIGN   3246>>ASSIGN   3252>>ASSIGN
      3253>>ASSIGN   3275>>IF       3278<>CALL     3284>>ASSIGN   3308>>ASSIGN   3319>>ASSIGN   3320<>CALL
T$
      2852**DCL      3202<<ASSIGN   3203>>ASSIGN   3230<<ASSIGN   3231>>ASSIGN   3232>>ASSIGN   3298<<ASSIGN
PL6.E3A0      #002=UEP$SAVLDT File=UEP$PMME.:E05TSI                              WED 07/30/97 06:59 Page:287  
      3299>>ASSIGN   3299>>ASSIGN
TECCB
      2850**DCL      3232<<ASSIGN   3299>>ASSIGN   3322>>ASSIGN
TEMPIC
      2851**DCL      3270<<ASSIGN   3319<<ASSIGN   3323>>ASSIGN
UDN$MAGIC
      2860**DCL-ENT  3184--CALL
UEP$CLEARONE
      2861**DCL-ENT  3278--CALL     3320--CALL
