VERSION A02

PL6.E3A0      #001=TCF$FTPD File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:09 Page:1    
        1        1        /*M* FTP SERVER ROUTINE FOR TCP */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* NTB,MCR=NO,PLM=3,CTI=6,IND=4,MCI=YES,SDI=6,DCI=4,ENU=0,ECU=0,CCC */
        8        8        TCF$FTPD: PROC MAIN ALTRET;
        9        9        %INCLUDE CP_6;
       10       90        %INCLUDE CP_6_SUBS;
       11      630        %INCLUDE TCP_HEP_M;
       12      685        %INCLUDE TCP_HEP_E;
       13      762        %INCLUDE TCT_TELNET_E;
       14      817        %INCLUDE XSL_SOCKET_M;
       15     1578        %INCLUDE B$JIT;
       16     1868    1   DCL B$JIT$ PTR SYMREF READONLY;
       17     1869            %XSL_SOCKINIT( FPTN=TCF_SOCKINIT, STCLASS="CONSTANT SYMDEF",
       18     1870                MAXSOCK=3, NWSOCKS=2, MAXRDS=3, MAXBUF=0, BUFSIZE=4096);
       19     1993
       20     1994        %TCP$SOCKET (NAME=CMD_FS, STCLASS="STATIC SYMDEF");
       21     2002        %TCP$SOCKET (NAME=CMD_LS, STCLASS="STATIC SYMDEF");
       22     2010        %TCP$CB (NAME=CB, STCLASS="STATIC SYMDEF");
       23     2013
       24     2014    1   DCL CMD_LCN SBIN(36) STATIC SYMDEF INIT(-1);
       25     2015    1   DCL FTP_TIMEOUT CONSTANT SYMDEF SBIN INIT(900);
       26     2016    1   DCL DATA_LCN UBIN(36) STATIC SYMDEF;
       27     2017    1   DCL CMD_BUFFER CHAR(4100) STATIC SYMDEF;
       28     2018    1   DCL M$LO DCB;
       29     2019    1   DCL M$DO DCB;
       30     2020    1   DCL LINK_UP BIT(1) STATIC SYMDEF  INIT('0'B);
       31     2021    1   DCL GET_CONNECTED ENTRY ALTRET;
       32     2022    1   DCL FTPCMD ENTRY ALTRET;
       33     2023    1   DCL FTPCMD_INIT ENTRY ALTRET;
       34     2024    1   DCL XSL$SOCKINIT ENTRY(1) ALTRET;
       35     2025
       36     2026        %FPT_WRITE (FPTN=WRITE_LO, STCLASS=STATIC SYMDEF,
       37     2027                DCB=M$LO, BUF=NOT_ONLINE);
PL6.E3A0      #001=TCF$FTPD File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:09 Page:2    
       38     2058    1   DCL NOT_ONLINE CHAR(0) CONSTANT INIT (
              2058            'FTPD: This is a CP-6 TCP/IP server, it can not be run manually.');
       39     2059
       40     2060    1   DCL RUNNING BIT(1) STATIC SYMDEF INIT('1'B);
       41     2061
       42     2062    2      IF B$JIT.MODE ~= %M_GHOST# THEN DO;
       43     2063    3          CALL M$WRITE( WRITE_LO) WHENALTRETURN DO; END;
       44     2064    2          CALL M$XXX;
       45     2065    2          END;
       46     2066    1      CALL XSL$SOCKINIT( TCF_SOCKINIT);
       47     2067    2      CALL FTPCMD_INIT WHENALTRETURN DO;
       48     2068    2          CALL M$XXX;
       49     2069    2          END;
       50     2070
       51     2071    1      CALL GET_CONNECTED;
       52     2072
       53     2073    2      DO WHILE (RUNNING);
       54     2074    2          CALL FTPCMD;
       55     2075    2          END;
       56     2076
       57     2077    1      RETURN;
       58     2078    1   END TCF$FTPD;
       59     2079        %EOD;

PL6.E3A0      #001=TCF$FTPD File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:09 Page:3    
--  Include file information  --

   B$JIT.:LIBRARY  cannot be made into a system file and is referenced.
   XSL_SOCKET_M.:TCA2TOU  is referenced.
   TCT_TELNET_E.:TCA2TOU  is referenced.
   TCP_HEP_E.:TCA2TOU  is referenced.
   TCP_HEP_M.:TCA2TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:LIBRARY  is referenced.
   CP_6.:LIBRARY  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure TCF$FTPD.

   Procedure TCF$FTPD requires 35 words for executable code.
   Procedure TCF$FTPD requires 4 words of local(AUTO) storage.

PL6.E3A0      #001=TCF$FTPD File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:09 Page:4    

 Object Unit name= TCF$FTPD                                   File name= TCF$FTPD.:TCA2TOU
 UTS= NOV 16 '97 14:09:45.36 SUN                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1  RoData even  UTS     23     27  TCF$FTPD
    2   Data  even  none  1051   2033  TCF$FTPD
    3   DCB   even  none     0      0  M$LO
    4   DCB   even  none     0      0  M$DO
    5   Proc  even  none    35     43  TCF$FTPD
    6  RoData even  none     1      1  TCF$FTPD

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     5      0   yes    yes     yes      Main       0  TCF$FTPD

  ****  Data defs  ****

 Sect OctLoc  Name                           Sect OctLoc  Name
    1      0  TCF_SOCKINIT                       2      0  CMD_FS
    2      2  CMD_LS                             2      4  CB
    2     11  CMD_LCN                            1      6  FTP_TIMEOUT
    2     12  DATA_LCN                           2     13  CMD_BUFFER
    2   2014  LINK_UP                            2   2016  WRITE_LO
    2   2032  RUNNING
PL6.E3A0      #001=TCF$FTPD File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:09 Page:5    

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       0 GET_CONNECTED
 yes     yes           Std       0 FTPCMD
 yes     yes           Std       1 XSL$SOCKINIT
 yes     yes           Std       0 FTPCMD_INIT
                       nStd      0 X66_MAUTO
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_MARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                             r    B$JIT$                                M$LO
     M$DO                                  B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     NULLSID                               ISSID
PL6.E3A0      #001=TCF$FTPD File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:09 Page:6    


        1        1        /*M* FTP SERVER ROUTINE FOR TCP */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* NTB,MCR=NO,PLM=3,CTI=6,IND=4,MCI=YES,SDI=6,DCI=4,ENU=0,ECU=0,CCC */
        8        8        TCF$FTPD: PROC MAIN ALTRET;

      8  5 000000   000000 700200 xent  TCF$FTPD     TSX0  ! X66_MAUTO
         5 000001   000004 000000                    ZERO    4,0

        9        9        %INCLUDE CP_6;
       10       90        %INCLUDE CP_6_SUBS;
       11      630        %INCLUDE TCP_HEP_M;
       12      685        %INCLUDE TCP_HEP_E;
       13      762        %INCLUDE TCT_TELNET_E;
       14      817        %INCLUDE XSL_SOCKET_M;
       15     1578        %INCLUDE B$JIT;
       16     1868    1   DCL B$JIT$ PTR SYMREF READONLY;
       17     1869            %XSL_SOCKINIT( FPTN=TCF_SOCKINIT, STCLASS="CONSTANT SYMDEF",
       18     1870                MAXSOCK=3, NWSOCKS=2, MAXRDS=3, MAXBUF=0, BUFSIZE=4096);
       19     1993
       20     1994        %TCP$SOCKET (NAME=CMD_FS, STCLASS="STATIC SYMDEF");
       21     2002        %TCP$SOCKET (NAME=CMD_LS, STCLASS="STATIC SYMDEF");
       22     2010        %TCP$CB (NAME=CB, STCLASS="STATIC SYMDEF");
       23     2013
       24     2014    1   DCL CMD_LCN SBIN(36) STATIC SYMDEF INIT(-1);
       25     2015    1   DCL FTP_TIMEOUT CONSTANT SYMDEF SBIN INIT(900);
       26     2016    1   DCL DATA_LCN UBIN(36) STATIC SYMDEF;
       27     2017    1   DCL CMD_BUFFER CHAR(4100) STATIC SYMDEF;
       28     2018    1   DCL M$LO DCB;
       29     2019    1   DCL M$DO DCB;
       30     2020    1   DCL LINK_UP BIT(1) STATIC SYMDEF  INIT('0'B);
       31     2021    1   DCL GET_CONNECTED ENTRY ALTRET;
       32     2022    1   DCL FTPCMD ENTRY ALTRET;
PL6.E3A0      #001=TCF$FTPD File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:09 Page:7    
       33     2023    1   DCL FTPCMD_INIT ENTRY ALTRET;
       34     2024    1   DCL XSL$SOCKINIT ENTRY(1) ALTRET;
       35     2025
       36     2026        %FPT_WRITE (FPTN=WRITE_LO, STCLASS=STATIC SYMDEF,
       37     2027                DCB=M$LO, BUF=NOT_ONLINE);
       38     2058    1   DCL NOT_ONLINE CHAR(0) CONSTANT INIT (
              2058            'FTPD: This is a CP-6 TCP/IP server, it can not be run manually.');
       39     2059
       40     2060    1   DCL RUNNING BIT(1) STATIC SYMDEF INIT('1'B);
       41     2061
       42     2062    2      IF B$JIT.MODE ~= %M_GHOST# THEN DO;

   2062  5 000002   000000 470400 xsym               LDP0    B$JIT$
         5 000003   000000 236100                    LDQ     0,,PR0
         5 000004   740000 376003                    ANQ     -16384,DU
         5 000005   100000 116003                    CMPQ    32768,DU
         5 000006   000016 600000 5                  TZE     s:2066

       43     2063    3          CALL M$WRITE( WRITE_LO) WHENALTRETURN DO; END;

   2063  5 000007   002016 630400 2                  EPPR0   WRITE_LO
         5 000010   440001 713400                    CLIMB   alt,write
         5 000011   401400 401760                    pmme    nvectors=4
         5 000012   000014 702000 5                  TSX2    s:2064
         5 000013   000014 710000 5                  TRA     s:2064

       44     2064    2          CALL M$XXX;

   2064  5 000014   000003 713400                    CLIMB   3
         5 000015   000000 401760                    pmme    nvectors=0

       45     2065    2          END;

       46     2066    1      CALL XSL$SOCKINIT( TCF_SOCKINIT);

   2066  5 000016   000000 630400 6                  EPPR0   0
         5 000017   000017 631400 xsym               EPPR1   B_VECTNIL+15
PL6.E3A0      #001=TCF$FTPD File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:09 Page:8    
         5 000020   000000 701000 xent               TSX1    XSL$SOCKINIT
         5 000021   000000 011000                    NOP     0

       47     2067    2      CALL FTPCMD_INIT WHENALTRETURN DO;

   2067  5 000022   000002 631400 xsym               EPPR1   B_VECTNIL+2
         5 000023   000000 701000 xent               TSX1    FTPCMD_INIT
         5 000024   000026 702000 5                  TSX2    s:2068
         5 000025   000030 710000 5                  TRA     s:2071

       48     2068    2          CALL M$XXX;

   2068  5 000026   000003 713400                    CLIMB   3
         5 000027   000000 401760                    pmme    nvectors=0

       49     2069    2          END;

       50     2070
       51     2071    1      CALL GET_CONNECTED;

   2071  5 000030   000002 631400 xsym               EPPR1   B_VECTNIL+2
         5 000031   000000 701000 xent               TSX1    GET_CONNECTED
         5 000032   000000 011000                    NOP     0

       52     2072
       53     2073    2      DO WHILE (RUNNING);

   2073  5 000033   002032 234000 2                  SZN     RUNNING
         5 000034   000042 605000 5                  TPL     s:2077

       54     2074    2          CALL FTPCMD;

   2074  5 000035   000002 631400 xsym               EPPR1   B_VECTNIL+2
         5 000036   000000 701000 xent               TSX1    FTPCMD
         5 000037   000000 011000                    NOP     0

       55     2075    2          END;
PL6.E3A0      #001=TCF$FTPD File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:09 Page:9    

   2075  5 000040   002032 234000 2                  SZN     RUNNING
         5 000041   000035 604000 5                  TMI     s:2074

       56     2076
       57     2077    1      RETURN;

   2077  5 000042   000000 702200 xent               TSX2  ! X66_MARET

TCF_SOCKINIT
 Sect OctLoc
   1     000   000000 000003   000000 000002   000000 010000   000000 006014    ................
   1     004   000000 000000   000003 000000                                    ........

(unnamed)
 Sect OctLoc
   1     006   000000 001604                                                    ....

NOT_ONLINE
 Sect OctLoc
   1     007   106124 120104   072040 124150   151163 040151   163040 141040    FTPD: This is a
   1     013   103120 055066   040124 103120   057111 120040   163145 162166    CP-6 TCP/IP serv
   1     017   145162 054040   151164 040143   141156 040156   157164 040142    er, it can not b
   1     023   145040 162165   156040 155141   156165 141154   154171 056***    e run manually..

(unnamed)
 Sect OctLoc
   2     000   ****** ******   ****** ******   ****** ******   ****** ******    ................
   2     010*  ****** ******   777777 777777   ****** ******   ****** ******    ................
   2    2014*  0***** ******   ****** ******                                    ........

WRITE_LO
 Sect OctLoc
   2    2016   000003 777640   002026 006000   000000 177640   000000 006014    ................
   2    2022   000017 577640   000007 006000   000000 177640   000000 006014    ................
   2    2026   000000 400400   000000 000000   000000 000000   000000 000000    ................

PL6.E3A0      #001=TCF$FTPD File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:09 Page:10   
RUNNING
 Sect OctLoc
   2    2032   4***** ******                                                    ....

(unnamed)
 Sect OctLoc
   6     000   000000 006000                                                    ....
       58     2078    1   END TCF$FTPD;
       59     2079        %EOD;

PL6.E3A0      #001=TCF$FTPD File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:09 Page:11   
--  Include file information  --

   B$JIT.:LIBRARY  cannot be made into a system file and is referenced.
   XSL_SOCKET_M.:TCA2TOU  is referenced.
   TCT_TELNET_E.:TCA2TOU  is referenced.
   TCP_HEP_E.:TCA2TOU  is referenced.
   TCP_HEP_M.:TCA2TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:LIBRARY  is referenced.
   CP_6.:LIBRARY  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure TCF$FTPD.
PL6.E3A0      #001=TCF$FTPD File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:09 Page:12   

 **** Variables and constants ****

  ****  Section 001 RoData TCF$FTPD

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     7-0-0/c CHAR(63)    r     1 NOT_ONLINE                 0-0-0/w STRC(216)   r     1 TCF_SOCKINIT

  ****  Section 002  Data  TCF$FTPD

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

  2032-0-0/b BIT         r     1 RUNNING                 2016-0-0/d STRC(432)   r     1 WRITE_LO

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0N  NULL        r     1 M$LO


   Procedure TCF$FTPD requires 35 words for executable code.
   Procedure TCF$FTPD requires 4 words of local(AUTO) storage.
PL6.E3A0      #001=TCF$FTPD File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:09 Page:13   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=TCF$FTPD File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:09 Page:14   
          MINI XREF LISTING

B$JIT.CPFLAGS1.SLEAZE
      1686**DCL      1686--REDEF
B$JIT.ERR.MID
      1593**DCL      1593--REDEF
B$JIT.JRESPEAK
      1754**DCL      1755--REDEF
B$JIT.MODE
      1587**DCL      2062>>IF
B$JIT.ORIGINATOR_PORT.FROM_CR
      1863**DCL      1863--REDEF    1864--REDEF
B$JIT.PNR
      1767**DCL      1767--REDEF
B$JIT.TSLINE
      1861**DCL      1862--REDEF
B$JIT$
      1868**DCL      1587--IMP-PTR  2062>>IF
FTPCMD
      2022**DCL-ENT  2074--CALL
FTPCMD_INIT
      2023**DCL-ENT  2067--CALL
GET_CONNECTED
      2021**DCL-ENT  2071--CALL
M$WRITE
        19**DCL-ENT  2063--CALL
M$XXX
        30**DCL-ENT  2064--CALL     2068--CALL
NOT_ONLINE
      2058**DCL      2045--DCLINIT  2046--DCLINIT
RUNNING
      2060**DCL      2073>>DOWHILE
TCF_SOCKINIT
      1887**DCL      2066<>CALL
PL6.E3A0      #001=TCF$FTPD File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:09 Page:15   
WRITE_LO
      2044**DCL      2063<>CALL
WRITE_LO.STATION_
      2046**DCL      2046--REDEF
WRITE_LO.V
      2047**DCL      2044--DCLINIT
WRITE_LO.V.DVBYTE.VFC#
      2053**DCL      2053--REDEF
XSL$SOCKINIT
      2024**DCL-ENT  2066--CALL
PL6.E3A0      #001=TCF$FTPD File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:09 Page:16   
              *** CROSS REFERENCE LISTING ***
    **     DENOTES     IDENTIFIER DEFINITION
    <<                 IDENTIFIER'S VALUE SET
    >>                 IDENTIFIER'S VALUE USED
    <>                 IDENTIFIER SET AND/OR USED
    --                 IDENTIFIER REFERENCED
PL6.E3A0      #001=TCF$FTPD File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:09 Page:17   
              MINI UREF LISTING

CB    2011**DCL
CMD_BUFFER    2017**DCL
CMD_FS    1996**DCL
CMD_LCN    2014**DCL
CMD_LS    2004**DCL
DATA_LCN    2016**DCL
FTP_TIMEOUT    2015**DCL
LINK_UP    2020**DCL
M$ACCT      35**DCL-ENT
M$ACTIVATE      38**DCL-ENT
M$ALIB      31**DCL-ENT
M$ASUSER      33**DCL-ENT
M$ATTACH      40**DCL-ENT
M$BADPP      58**DCL-ENT
M$CGCTL      39**DCL-ENT
M$CGINFO      39**DCL-ENT
M$CHECK      20**DCL-ENT
M$CHGUNIT      78**DCL-ENT
M$CLOSE      18**DCL-ENT
M$CLRSTK      76**DCL-ENT
M$CMDVAR      87**DCL-ENT
M$CONFIG      48**DCL-ENT
M$CORRES      23**DCL-ENT
M$CPEXIT      32**DCL-ENT
M$CVM      56**DCL-ENT
M$CVOL      21**DCL-ENT
M$DCLFLD      48**DCL-ENT
M$DEACTIVATE      38**DCL-ENT
M$DELREC      20**DCL-ENT
M$DEQ      85**DCL-ENT
M$DETACH      40**DCL-ENT
M$DEVICE      22**DCL-ENT
PL6.E3A0      #001=TCF$FTPD File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:09 Page:18   
M$DISPLAY      85**DCL-ENT
M$DISPRES      25**DCL-ENT
M$DLIB      31**DCL-ENT
M$DO    2019**DCL
M$DRIBBLE      48**DCL-ENT
M$DRTN      76**DCL-ENT
M$DSUSER      33**DCL-ENT
M$ENQ      84**DCL-ENT
M$EOM      43**DCL-ENT
M$ERASE      49**DCL-ENT
M$ERR      30**DCL-ENT
M$ERRMSG      81**DCL-ENT
M$EVENT      73**DCL-ENT
M$EXHUME      82**DCL-ENT
M$EXIT      30**DCL-ENT
M$EXTEND      22**DCL-ENT
M$FDP      54**DCL-ENT
M$FDS      53**DCL-ENT
M$FEBOOT      46**DCL-ENT
M$FECTL      47**DCL-ENT
M$FEDUMP      46**DCL-ENT
M$FID      81**DCL-ENT
M$FINDPROC      35**DCL-ENT
M$FSUSER      33**DCL-ENT
M$FVP      55**DCL-ENT
M$FWCG      39**DCL-ENT
M$GBPL      59**DCL-ENT
M$GDDL      55**DCL-ENT
M$GDP      54**DCL-ENT
M$GDS      53**DCL-ENT
M$GETDCB      24**DCL-ENT
M$GETMOUSE      64**DCL-ENT
M$GETPM      65**DCL-ENT
M$GJOB      83**DCL-ENT
M$GLINEATTR      43**DCL-ENT
M$GOODPP      58**DCL-ENT
PL6.E3A0      #001=TCF$FTPD File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:09 Page:19   
M$GPLATEN      51**DCL-ENT
M$GPROMPT      50**DCL-ENT
M$GTRMATTR      44**DCL-ENT
M$GTRMCTL      42**DCL-ENT
M$GTRMTAB      45**DCL-ENT
M$GVP      54**DCL-ENT
M$HELP      81**DCL-ENT
M$INT      73**DCL-ENT
M$INTRTN      34**DCL-ENT
M$IOQ      69**DCL-ENT
M$JOBSTATS      83**DCL-ENT
M$KEYIN      23**DCL-ENT
M$LDEV      18**DCL-ENT
M$LDTRC      31**DCL-ENT
M$LIMIT      24**DCL-ENT
M$LINES      23**DCL-ENT
M$LINK      30**DCL-ENT
M$LO    2018**DCL
M$MADMUCK      26**DCL-ENT
M$MAKUSER      57**DCL-ENT
M$MBS      25**DCL-ENT
M$MDFFLD      49**DCL-ENT
M$MERC      74**DCL-ENT
M$MERCS      75**DCL-ENT
M$MIRROR      69**DCL-ENT
M$MONINFO      86**DCL-ENT
M$MPL      59**DCL-ENT
M$NODEINFO      50**DCL-ENT
M$NXTUSR      84**DCL-ENT
M$OCMSG      82**DCL-ENT
M$OLAY      30**DCL-ENT
M$OPEN      18**DCL-ENT
M$PAS      59**DCL-ENT
M$PATHCON      82**DCL-ENT
M$PDS      53**DCL-ENT
M$PFIL      20**DCL-ENT
PL6.E3A0      #001=TCF$FTPD File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:09 Page:20   
M$PLATEN      44**DCL-ENT
M$PRECORD      22**DCL-ENT
M$PROCNAME      35**DCL-ENT
M$PROFILE      46**DCL-ENT
M$PROMPT      42**DCL-ENT
M$RACST      26**DCL-ENT
M$RDSYSLOG      67**DCL-ENT
M$READ      19**DCL-ENT
M$RELDCB      24**DCL-ENT
M$RELRES      25**DCL-ENT
M$RELSTARF      27**DCL-ENT
M$REM      27**DCL-ENT
M$RENV      74**DCL-ENT
M$REQUIRE      26**DCL-ENT
M$RETRY      75**DCL-ENT
M$RETRYS      75**DCL-ENT
M$REW      21**DCL-ENT
M$RLSFLD      49**DCL-ENT
M$RPRIV      77**DCL-ENT
M$RSPP      56**DCL-ENT
M$RSWITCH      78**DCL-ENT
M$RUE      84**DCL-ENT
M$SAD      57**DCL-ENT
M$SAVE      33**DCL-ENT
M$SCON      34**DCL-ENT
M$SCREECH      32**DCL-ENT
M$SENV      74**DCL-ENT
M$SETFMA      18**DCL-ENT
M$SETFP      47**DCL-ENT
M$SINPUT      45**DCL-ENT
M$SLCFLD      50**DCL-ENT
M$SMOUSE      64**DCL-ENT
M$SMPRT      56**DCL-ENT
M$SPRIV      77**DCL-ENT
M$SSC      57**DCL-ENT
M$SSWITCH      77**DCL-ENT
PL6.E3A0      #001=TCF$FTPD File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:09 Page:21   
M$STATE      86**DCL-ENT
M$STD      58**DCL-ENT
M$STIMER      72**DCL-ENT
M$STLPP      55**DCL-ENT
M$STRAP      72**DCL-ENT
M$STRMATTR      44**DCL-ENT
M$STRMCTL      42**DCL-ENT
M$STRMTAB      45**DCL-ENT
M$SYMBIO      83**DCL-ENT
M$SYSCON      69**DCL-ENT
M$SYSID      87**DCL-ENT
M$TDCLOSE      68**DCL-ENT
M$TDIO      68**DCL-ENT
M$TDOPEN      67**DCL-ENT
M$TDREQCPU      68**DCL-ENT
M$TEMPWROC      62**DCL-ENT
M$TIME      85**DCL-ENT
M$TRAP      72**DCL-ENT
M$TRMISC      47**DCL-ENT
M$TRMPRG      43**DCL-ENT
M$TRTN      76**DCL-ENT
M$TRUNC      19**DCL-ENT
M$TTIMER      72**DCL-ENT
M$UC      42**DCL
M$UMPL      59**DCL-ENT
M$UNFID      81**DCL-ENT
M$UNLATCH      38**DCL-ENT
M$UNSHARE      35**DCL-ENT
M$USRFIELD      78**DCL-ENT
M$VIRTUAL      53**DCL-ENT
M$WAIT      76**DCL-ENT
M$WEOF      21**DCL-ENT
M$WRSYSLOG      67**DCL-ENT
M$XCON      73**DCL-ENT
M$XCONRTN      34**DCL-ENT
M$XEQTIME      86**DCL-ENT
PL6.E3A0      #001=TCF$FTPD File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:09 Page:22   
M$XFLUSH      27**DCL-ENT
M$XMOUSE      64**DCL-ENT
M$YC      32**DCL-ENT
TCF$FTPD       8**PROC
TCP_ERR_CODE     666**DCL
TCP_MON_ERR     666**DCL

PL6.E3A0      #002=SEND_MSG File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:10 Page:23   
       60        1        /*T***********************************************************/
       61        2        /*T*                                                         */
       62        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
       63        4        /*T*                                                         */
       64        5        /*T***********************************************************/
       65        6
       66        7        SEND_MSG: PROC(MSG, TEXT) ALTRET;
       67        8
       68        9    1   DCL 1 MSG ALIGNED,2 L UBIN(9) UNAL,2 T CHAR(MSG.L);
       69       10    1   DCL TEXT VECTOR;
       70       11    1   DCL 1 TMSG ALIGNED BASED(T$),2 L UBIN(9) UNAL,2 T CHAR(TMSG.L);
       71       12    1   DCL T$ PTR;
       72       13
       73       14    1   DCL TCP$WRITE_D ENTRY (4) ALTRET;
       74       15    1   DCL TELNET_EOL ENTRY(1) ALTRET;
       75       16
       76       17    1   DCL CMD_LCN SBIN SYMREF;
       77       18
       78       19        %MACRO TEXTC (CODE=0,TEXT=' ');
       79       20        DCL 1 MSG_%CHARTEXT(TEXTCHAR(CODE)) CONSTANT SYMDEF,
       80       21                  2 L UBIN(9) UNAL INIT(LENGTHC(TEXT)),
       81       22                  2 T CHAR(0) INIT(TEXT);
       82       23        %MEND;
       83       24
       84       25        %TEXTC (CODE=421, TEXT='421 CP-6 FTP Disconnected - timed out.');
       85       30
       86       31    1      CALL TCP$WRITE_D (CMD_LCN, VECTOR(MSG.T));
       87       32    1      IF ADDR(TEXT) ~= ADDR(NIL) THEN
       88       33    1          CALL TCP$WRITE_D (CMD_LCN, TEXT);
       89       34    1      T$ = ADDR(MSG);
       90       35    1      IF SUBSTR(MSG.T,3,1) = '-' THEN
       91       36    2      DO UNTIL SUBSTR(MSG.T,0,3)=SUBSTR(TMSG.T,0,4);
       92       37    2          CALL TELNET_EOL (CMD_LCN);
       93       38    2          T$ = PINCRW(T$, SIZEW(TMSG));
       94       39    2          CALL TCP$WRITE_D (CMD_LCN, VECTOR(TMSG.T));
       95       40    2          END;
       96       41
PL6.E3A0      #002=SEND_MSG File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:10 Page:24   
       97       42    1      CALL TELNET_EOL (CMD_LCN);
       98       43
       99       44    1   END SEND_MSG;
      100       45
      101       46        %EOD;

PL6.E3A0      #002=SEND_MSG File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:10 Page:25   
--  Include file information  --

   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure SEND_MSG.

   Procedure SEND_MSG requires 83 words for executable code.
   Procedure SEND_MSG requires 10 words of local(AUTO) storage.

PL6.E3A0      #002=SEND_MSG File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:10 Page:26   

 Object Unit name= SEND_MSG                                   File name= TCF$FTPD.:TCA2TOU
 UTS= NOV 16 '97 14:10:31.40 SUN                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS     10     12  SEND_MSG
    1   Proc  even  none    83    123  SEND_MSG
    2  RoData even  none     1      1  SEND_MSG

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        2  SEND_MSG

  ****  Data defs  ****

 Sect OctLoc  Name                           Sect OctLoc  Name
    0      0  MSG_421

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       4 TCP$WRITE_D
 yes     yes           Std       1 TELNET_EOL
                       nStd      0 X66_AUTO_2
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
PL6.E3A0      #002=SEND_MSG File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:10 Page:27   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     CMD_LCN                               B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #002=SEND_MSG File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:10 Page:28   


       60        1        /*T***********************************************************/
       61        2        /*T*                                                         */
       62        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
       63        4        /*T*                                                         */
       64        5        /*T***********************************************************/
       65        6
       66        7        SEND_MSG: PROC(MSG, TEXT) ALTRET;

      7  1 000000   000000 700200 xent  SEND_MSG     TSX0  ! X66_AUTO_2
         1 000001   000012 000002                    ZERO    10,2

       67        8
       68        9    1   DCL 1 MSG ALIGNED,2 L UBIN(9) UNAL,2 T CHAR(MSG.L);
       69       10    1   DCL TEXT VECTOR;
       70       11    1   DCL 1 TMSG ALIGNED BASED(T$),2 L UBIN(9) UNAL,2 T CHAR(TMSG.L);
       71       12    1   DCL T$ PTR;
       72       13
       73       14    1   DCL TCP$WRITE_D ENTRY (4) ALTRET;
       74       15    1   DCL TELNET_EOL ENTRY(1) ALTRET;
       75       16
       76       17    1   DCL CMD_LCN SBIN SYMREF;
       77       18
       78       19        %MACRO TEXTC (CODE=0,TEXT=' ');
       79       20        DCL 1 MSG_%CHARTEXT(TEXTCHAR(CODE)) CONSTANT SYMDEF,
       80       21                  2 L UBIN(9) UNAL INIT(LENGTHC(TEXT)),
       81       22                  2 T CHAR(0) INIT(TEXT);
       82       23        %MEND;
       83       24
       84       25        %TEXTC (CODE=421, TEXT='421 CP-6 FTP Disconnected - timed out.');
       85       30
       86       31    1      CALL TCP$WRITE_D (CMD_LCN, VECTOR(MSG.T));

     31  1 000002   200003 470500                    LDP0    @MSG,,AUTO
         1 000003   000000 236100                    LDQ     0,,PR0
         1 000004   000033 772000                    QRL     27
         1 000005   000064 737000                    LLS     52
PL6.E3A0      #002=SEND_MSG File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:10 Page:29   
         1 000006   000140 135007                    SBLA    96,DL
         1 000007   200003 236100                    LDQ     @MSG,,AUTO
         1 000010   200000 036007                    ADLQ    65536,DL
         1 000011   200006 757100                    STAQ    T$+1,,AUTO
         1 000012   200006 631500                    EPPR1   T$+1,,AUTO
         1 000013   200011 451500                    STP1    T$+4,,AUTO
         1 000014   000000 236000 2                  LDQ     0
         1 000015   200010 756100                    STQ     T$+3,,AUTO
         1 000016   200010 630500                    EPPR0   T$+3,,AUTO
         1 000017   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000020   000000 701000 xent               TSX1    TCP$WRITE_D
         1 000021   000000 011000                    NOP     0

       87       32    1      IF ADDR(TEXT) ~= ADDR(NIL) THEN

     32  1 000022   200004 236100                    LDQ     @TEXT,,AUTO
         1 000023   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000024   000033 600000 1                  TZE     s:34

       88       33    1          CALL TCP$WRITE_D (CMD_LCN, TEXT);

     33  1 000025   000000 235000 2                  LDA     0
         1 000026   200006 757100                    STAQ    T$+1,,AUTO
         1 000027   200006 630500                    EPPR0   T$+1,,AUTO
         1 000030   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000031   000000 701000 xent               TSX1    TCP$WRITE_D
         1 000032   000000 011000                    NOP     0

       89       34    1      T$ = ADDR(MSG);

     34  1 000033   200003 236100                    LDQ     @MSG,,AUTO
         1 000034   200005 756100                    STQ     T$,,AUTO

       90       35    1      IF SUBSTR(MSG.T,3,1) = '-' THEN

     35  1 000035   200003 470500                    LDP0    @MSG,,AUTO
         1 000036   000000 236100                    LDQ     0,,PR0
PL6.E3A0      #002=SEND_MSG File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:10 Page:30   
         1 000037   000033 772000                    QRL     27
         1 000040   000001 236100                    LDQ     1,,PR0
         1 000041   777000 376003                    ANQ     -512,DU
         1 000042   055000 116003                    CMPQ    23040,DU
         1 000043   000116 601000 1                  TNZ     s:42

       91       36    2      DO UNTIL SUBSTR(MSG.T,0,3)=SUBSTR(TMSG.T,0,4);

       92       37    2          CALL TELNET_EOL (CMD_LCN);

     37  1 000044   000000 630400 2                  EPPR0   0
         1 000045   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000046   000000 701000 xent               TSX1    TELNET_EOL
         1 000047   000000 011000                    NOP     0

       93       38    2          T$ = PINCRW(T$, SIZEW(TMSG));

     38  1 000050   200005 470500                    LDP0    T$,,AUTO
         1 000051   000000 236100                    LDQ     0,,PR0
         1 000052   000033 772000                    QRL     27
         1 000053   000001 620006                    EAX0    1,QL
         1 000054   000000 636010                    EAQ     0,X0
         1 000055   000022 772000                    QRL     18
         1 000056   000011 402007                    MPY     9,DL
         1 000057   000043 036007                    ADLQ    35,DL
         1 000060   000044 506007                    DIV     36,DL
         1 000061   000022 736000                    QLS     18
         1 000062   200005 036100                    ADLQ    T$,,AUTO
         1 000063   200005 756100                    STQ     T$,,AUTO

       94       39    2          CALL TCP$WRITE_D (CMD_LCN, VECTOR(TMSG.T));

     39  1 000064   200005 470500                    LDP0    T$,,AUTO
         1 000065   000000 236100                    LDQ     0,,PR0
         1 000066   000033 772000                    QRL     27
         1 000067   000064 737000                    LLS     52
         1 000070   000140 135007                    SBLA    96,DL
PL6.E3A0      #002=SEND_MSG File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:10 Page:31   
         1 000071   200005 236100                    LDQ     T$,,AUTO
         1 000072   200000 036007                    ADLQ    65536,DL
         1 000073   200006 757100                    STAQ    T$+1,,AUTO
         1 000074   200006 631500                    EPPR1   T$+1,,AUTO
         1 000075   200011 451500                    STP1    T$+4,,AUTO
         1 000076   000000 236000 2                  LDQ     0
         1 000077   200010 756100                    STQ     T$+3,,AUTO
         1 000100   200010 630500                    EPPR0   T$+3,,AUTO
         1 000101   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000102   000000 701000 xent               TSX1    TCP$WRITE_D
         1 000103   000000 011000                    NOP     0

       95       40    2          END;

     40  1 000104   200003 470500                    LDP0    @MSG,,AUTO
         1 000105   000000 236100                    LDQ     0,,PR0
         1 000106   000033 772000                    QRL     27
         1 000107   200005 471500                    LDP1    T$,,AUTO
         1 000110   100000 236100                    LDQ     0,,PR1
         1 000111   000033 772000                    QRL     27
         1 000112   040100 106500                    CMPC    fill='040'O
         1 000113   000000 200003                    ADSC9   0,,PR0                   cn=1,n=3
         1 000114   100000 200004                    ADSC9   0,,PR1                   cn=1,n=4
         1 000115   000044 601000 1                  TNZ     s:37

       96       41
       97       42    1      CALL TELNET_EOL (CMD_LCN);

     42  1 000116   000000 630400 2                  EPPR0   0
         1 000117   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000120   000000 701000 xent               TSX1    TELNET_EOL
         1 000121   000000 011000                    NOP     0

       98       43
       99       44    1   END SEND_MSG;

     44  1 000122   000000 702200 xent               TSX2  ! X66_ARET
PL6.E3A0      #002=SEND_MSG File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:10 Page:32   

(unnamed)
 Sect OctLoc
   0     000   046064 062061   040103 120055   066040 106124   120040 104151    &421 CP-6 FTP Di
   0     004   163143 157156   156145 143164   145144 040055   040164 151155    sconnected - tim
   0     010   145144 040157   165164 056***                                    ed out..

(unnamed)
 Sect OctLoc
   2     000   000000 006000                                                    ....
      100       45
      101       46        %EOD;

PL6.E3A0      #002=SEND_MSG File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:10 Page:33   
--  Include file information  --

   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure SEND_MSG.
PL6.E3A0      #002=SEND_MSG File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:10 Page:34   

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @MSG                       4-0-0/w PTR         r     1 @TEXT
    *0-0-0/w ASTR(9)     r     1 MSG                        5-0-0/w PTR         r     1 T$
    *0-0-0/d VECT        r     1 TEXT

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w SBIN        r     1 CMD_LCN

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w ASTR(9)     r     1 TMSG


   Procedure SEND_MSG requires 83 words for executable code.
   Procedure SEND_MSG requires 10 words of local(AUTO) storage.
PL6.E3A0      #002=SEND_MSG File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:10 Page:35   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=SEND_MSG File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:10 Page:36   
          MINI XREF LISTING

CMD_LCN
        17**DCL        31<>CALL       33<>CALL       37<>CALL       39<>CALL       42<>CALL
MSG
         9**DCL         7--PROC       34--ASSIGN
MSG.L
         9**DCL         9--IMP-SIZ    31>>CALL       35>>IF         36>>DOUNTIL
MSG.T
         9**DCL        31--CALL       35>>IF         36>>DOUNTIL
T$
        12**DCL        11--IMP-PTR    34<<ASSIGN     36>>DOUNTIL    36>>DOUNTIL    38<<ASSIGN     38>>ASSIGN
        38>>ASSIGN     38>>ASSIGN     39>>CALL       39>>CALL
TCP$WRITE_D
        14**DCL-ENT    31--CALL       33--CALL       39--CALL
TELNET_EOL
        15**DCL-ENT    37--CALL       42--CALL
TEXT
        10**DCL         7--PROC       32--IF         33<>CALL
TMSG
        11**DCL        38--ASSIGN
TMSG.L
        11**DCL        11--IMP-SIZ    36>>DOUNTIL    38>>ASSIGN     39>>CALL
TMSG.T
        11**DCL        36>>DOUNTIL    39--CALL
PL6.E3A0      #002=SEND_MSG File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:10 Page:37   
              *** CROSS REFERENCE LISTING ***
    **     DENOTES     IDENTIFIER DEFINITION
    <<                 IDENTIFIER'S VALUE SET
    >>                 IDENTIFIER'S VALUE USED
    <>                 IDENTIFIER SET AND/OR USED
    --                 IDENTIFIER REFERENCED
PL6.E3A0      #002=SEND_MSG File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:10 Page:38   
              MINI UREF LISTING

MSG_421      26**DCL
SEND_MSG       7**PROC

PL6.E3A0      #003=GET_CONNECTED File=TCF$FTPD.:TCA2TSI                          SUN 11/16/97 14:10 Page:39   
      102        1        /*T***********************************************************/
      103        2        /*T*                                                         */
      104        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      105        4        /*T*                                                         */
      106        5        /*T***********************************************************/
      107        6        GET_CONNECTED: PROC ALTRET;
      108        7        %INCLUDE CP_6;
      109       88        %INCLUDE TCP_HEP_M;
      110      143        %INCLUDE TCP_HEP_E;
      111      220        %INCLUDE TCF_FTP_E;
      112      275        %INCLUDE XSL_SOCKET_E;
      113      533
      114      534    1   DCL REMOTE_ADMIN ENTRY(1);
      115      535    1   DCL SEND_MSG ENTRY(2) ALTRET;
      116      536    1   DCL 1 B_VERSION SYMREF,2 L UBIN BYTE UNAL,2 T CHAR(B_VERSION.L);
      117      537    1   DCL 1 SALUTATION STATIC SYMDEF,
      118      538    1             2 L UBIN BYTE CALIGNED,
      119      539    1             2 M1 CHAR(0) INIT('220 CP-6 FTP Server Version '),
      120      540    1             2 M2 CHAR(20);
      121      541    1   DCL TCP$OPEN ENTRY(6) ALTRET;
      122      542    1   DCL TCP$READ ENTRY(3) ALTRET;
      123      543    1   DCL XSL$QSETSOCKOPT ENTRY(6) ALTRET;
      124      544
      125      545    1   DCL CRUD SBIN;
      126      546    1   DCL CMD_LCN UBIN(36) SYMREF;
      127      547    1   DCL CMD_BUFFER CHAR(1600) SYMREF;
      128      548        %TCP$SOCKET (NAME=CMD_LS, STCLASS=SYMREF);
      129      556        %TCP$SOCKET (NAME=CMD_FS, STCLASS=SYMREF);
      130      564        %TCP$CB (NAME=CB, STCLASS=SYMREF);
      131      567
      132      568    1      CALL TCP$OPEN (CMD_LCN, CMD_LS, CMD_FS, %TCP_SERVER_CLONE, CMD_FS, CMD_LS)
      133      569    2      WHENALTRETURN DO;
      134      570    2   TCPERR: ;
      135      571    2          CALL M$XXX;
      136      572    2          END;
      137      573    1      CALL XSL$QSETSOCKOPT (CRUD, CMD_LCN,
      138      574    1            %XSL_SOL_SOCKET, %XSL_SO_NWREADS, 0, 4);
PL6.E3A0      #003=GET_CONNECTED File=TCF$FTPD.:TCA2TSI                          SUN 11/16/97 14:10 Page:40   
      139      575
      140      576
      141      577    1      CALL TCP$READ (CMD_LCN, VECTOR(CMD_BUFFER), CB) ALTRET (TCPERR);
      142      578
      143      579    1      IF (CB.ADMIN) THEN CALL REMOTE_ADMIN (ADDR(CMD_BUFFER));
      144      580    1      ELSE CALL M$ERR;
      145      581
      146      582    1      CALL CONCAT (SALUTATION.M2, B_VERSION.T, ' Ready.');
      147      583    1      SALUTATION.L = SIZEC(SALUTATION.M1)+ B_VERSION.L+ SIZEC(' Ready.');
      148      584    1      CALL SEND_MSG (SALUTATION);
      149      585
      150      586    1   END GET_CONNECTED;
      151      587
      152      588        %EOD;

PL6.E3A0      #003=GET_CONNECTED File=TCF$FTPD.:TCA2TSI                          SUN 11/16/97 14:10 Page:41   
--  Include file information  --

   XSL_SOCKET_E.:TCA2TOU  is referenced.
   TCF_FTP_E.:TCA2TOU  is referenced.
   TCP_HEP_E.:TCA2TOU  is referenced.
   TCP_HEP_M.:TCA2TOU  cannot be made into a system file and is referenced.
   CP_6.:LIBRARY  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure GET_CONNECTED.

   Procedure GET_CONNECTED requires 59 words for executable code.
   Procedure GET_CONNECTED requires 10 words of local(AUTO) storage.

PL6.E3A0      #003=GET_CONNECTED File=TCF$FTPD.:TCA2TSI                          SUN 11/16/97 14:10 Page:42   

 Object Unit name= GET_CONNECTED                              File name= TCF$FTPD.:TCA2TOU
 UTS= NOV 16 '97 14:10:45.16 SUN                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   Data  even  none    13     15  GET_CONNECTED
    2  RoData even  UTS      2      2  GET_CONNECTED
    3   Proc  even  none    59     73  GET_CONNECTED
    4  RoData even  none    17     21  GET_CONNECTED

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     3      0   yes    yes     yes      Std        0  GET_CONNECTED

  ****  Data defs  ****

 Sect OctLoc  Name                           Sect OctLoc  Name
    1      0  SALUTATION
PL6.E3A0      #003=GET_CONNECTED File=TCF$FTPD.:TCA2TSI                          SUN 11/16/97 14:10 Page:43   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       6 TCP$OPEN
 yes     yes           Std       3 TCP$READ
         yes           Std       1 REMOTE_ADMIN
 yes     yes           Std       6 XSL$QSETSOCKOPT
 yes     yes           Std       2 SEND_MSG
                       nStd      0 X66_AUTO_0
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  B_VERSION                             CMD_LCN
     CMD_BUFFER                            CMD_LS                                CMD_FS
     CB                                    B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #003=GET_CONNECTED File=TCF$FTPD.:TCA2TSI                          SUN 11/16/97 14:10 Page:44   


      102        1        /*T***********************************************************/
      103        2        /*T*                                                         */
      104        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      105        4        /*T*                                                         */
      106        5        /*T***********************************************************/
      107        6        GET_CONNECTED: PROC ALTRET;

      6  3 000000   000000 700200 xent  GET_CONNECT* TSX0  ! X66_AUTO_0
         3 000001   000012 000000                    ZERO    10,0

      108        7        %INCLUDE CP_6;
      109       88        %INCLUDE TCP_HEP_M;
      110      143        %INCLUDE TCP_HEP_E;
      111      220        %INCLUDE TCF_FTP_E;
      112      275        %INCLUDE XSL_SOCKET_E;
      113      533
      114      534    1   DCL REMOTE_ADMIN ENTRY(1);
      115      535    1   DCL SEND_MSG ENTRY(2) ALTRET;
      116      536    1   DCL 1 B_VERSION SYMREF,2 L UBIN BYTE UNAL,2 T CHAR(B_VERSION.L);
      117      537    1   DCL 1 SALUTATION STATIC SYMDEF,
      118      538    1             2 L UBIN BYTE CALIGNED,
      119      539    1             2 M1 CHAR(0) INIT('220 CP-6 FTP Server Version '),
      120      540    1             2 M2 CHAR(20);
      121      541    1   DCL TCP$OPEN ENTRY(6) ALTRET;
      122      542    1   DCL TCP$READ ENTRY(3) ALTRET;
      123      543    1   DCL XSL$QSETSOCKOPT ENTRY(6) ALTRET;
      124      544
      125      545    1   DCL CRUD SBIN;
      126      546    1   DCL CMD_LCN UBIN(36) SYMREF;
      127      547    1   DCL CMD_BUFFER CHAR(1600) SYMREF;
      128      548        %TCP$SOCKET (NAME=CMD_LS, STCLASS=SYMREF);
      129      556        %TCP$SOCKET (NAME=CMD_FS, STCLASS=SYMREF);
      130      564        %TCP$CB (NAME=CB, STCLASS=SYMREF);
      131      567
      132      568    1      CALL TCP$OPEN (CMD_LCN, CMD_LS, CMD_FS, %TCP_SERVER_CLONE, CMD_FS, CMD_LS)

PL6.E3A0      #003=GET_CONNECTED File=TCF$FTPD.:TCA2TSI                          SUN 11/16/97 14:10 Page:45   
    568  3 000002   000000 630400 4                  EPPR0   0
         3 000003   000024 631400 xsym               EPPR1   B_VECTNIL+20
         3 000004   000000 701000 xent               TSX1    TCP$OPEN
         3 000005   000007 702000 3                  TSX2    TCPERR
         3 000006   000011 710000 3                  TRA     s:573

      133      569    2      WHENALTRETURN DO;

    565  3 000007                       TCPERR       null
      134      570    2   TCPERR: ;
      135      571    2          CALL M$XXX;

    571  3 000007   000003 713400                    CLIMB   3
         3 000010   000000 401760                    pmme    nvectors=0

      136      572    2          END;

      137      573    1      CALL XSL$QSETSOCKOPT (CRUD, CMD_LCN,

    573  3 000011   000010 237000 4                  LDAQ    8
         3 000012   200010 757100                    STAQ    CRUD+5,,AUTO
         3 000013   000012 237000 4                  LDAQ    10
         3 000014   200006 757100                    STAQ    CRUD+3,,AUTO
         3 000015   000000 236000 4                  LDQ     0
         3 000016   200005 756100                    STQ     CRUD+2,,AUTO
         3 000017   200003 630500                    EPPR0   CRUD,,AUTO
         3 000020   200004 450500                    STP0    CRUD+1,,AUTO
         3 000021   200004 630500                    EPPR0   CRUD+1,,AUTO
         3 000022   000024 631400 xsym               EPPR1   B_VECTNIL+20
         3 000023   000000 701000 xent               TSX1    XSL$QSETSOCKOPT
         3 000024   000000 011000                    NOP     0

      138      574    1            %XSL_SOL_SOCKET, %XSL_SO_NWREADS, 0, 4);
      139      575
      140      576
      141      577    1      CALL TCP$READ (CMD_LCN, VECTOR(CMD_BUFFER), CB) ALTRET (TCPERR);

PL6.E3A0      #003=GET_CONNECTED File=TCF$FTPD.:TCA2TSI                          SUN 11/16/97 14:10 Page:46   
    577  3 000025   000016 630400 4                  EPPR0   14
         3 000026   000021 631400 xsym               EPPR1   B_VECTNIL+17
         3 000027   000000 701000 xent               TSX1    TCP$READ
         3 000030   000007 702000 3                  TSX2    TCPERR

      142      578
      143      579    1      IF (CB.ADMIN) THEN CALL REMOTE_ADMIN (ADDR(CMD_BUFFER));

    579  3 000031   000000 234000 xsym               SZN     CB
         3 000032   000044 605000 3                  TPL     s:580

    579  3 000033   000015 236000 4                  LDQ     13
         3 000034   200004 756100                    STQ     CRUD+1,,AUTO
         3 000035   200004 630500                    EPPR0   CRUD+1,,AUTO
         3 000036   200005 450500                    STP0    CRUD+2,,AUTO
         3 000037   200005 630500                    EPPR0   CRUD+2,,AUTO
         3 000040   000017 631400 xsym               EPPR1   B_VECTNIL+15
         3 000041   000000 701000 xent               TSX1    REMOTE_ADMIN
         3 000042   000000 011000                    NOP     0
         3 000043   000046 710000 3                  TRA     s:582

      144      580    1      ELSE CALL M$ERR;

    580  3 000044   000002 713400                    CLIMB   err
         3 000045   000000 401760                    pmme    nvectors=0

      145      581
      146      582    1      CALL CONCAT (SALUTATION.M2, B_VERSION.T, ' Ready.');

    582  3 000046   000000 236000 xsym               LDQ     B_VERSION
         3 000047   000033 772000                    QRL     27
         3 000050   000000 620006                    EAX0    0,QL
         3 000051   040000 100440                    MLR     fill='040'O
         3 000052   000000 200010 xsym               ADSC9   B_VERSION                cn=1,n=*X0
         3 000053   000007 200024 1                  ADSC9   SALUTATION+7             cn=1,n=20
         3 000054   000024 116007                    CMPQ    20,DL
         3 000055   000063 603000 3                  TRC     s:583
PL6.E3A0      #003=GET_CONNECTED File=TCF$FTPD.:TCA2TSI                          SUN 11/16/97 14:10 Page:47   
         3 000056   777753 621006                    EAX1    -21,QL
         3 000057   777777 661003                    ERX1    -1,DU
         3 000060   040046 100400                    MLR     fill='040'O
         3 000061   000000 000007 2                  ADSC9   0                        cn=0,n=7
         3 000062   000007 200011 1                  ADSC9   SALUTATION+7,Q           cn=1,n=*X1

      147      583    1      SALUTATION.L = SIZEC(SALUTATION.M1)+ B_VERSION.L+ SIZEC(' Ready.');

    583  3 000063   000043 036007                    ADLQ    35,DL
         3 000064   000033 736000                    QLS     27
         3 000065   000000 552040 1                  STBQ    SALUTATION,'40'O

      148      584    1      CALL SEND_MSG (SALUTATION);

    584  3 000066   000007 630400 4                  EPPR0   7
         3 000067   000017 631400 xsym               EPPR1   B_VECTNIL+15
         3 000070   000000 701000 xent               TSX1    SEND_MSG
         3 000071   000000 011000                    NOP     0

      149      585
      150      586    1   END GET_CONNECTED;

    586  3 000072   000000 702200 xent               TSX2  ! X66_ARET

SALUTATION
 Sect OctLoc
   1     000   ***062 062060   040103 120055   066040 106124   120040 123145    .220 CP-6 FTP Se
   1     004   162166 145162   040126 145162   163151 157156   040*** ******    rver Version ...
   1     014*  ****** ******                                                    ....

(unnamed)
 Sect OctLoc
   2     000   040122 145141   144171 056040                                     Ready.

(unnamed)
 Sect OctLoc
   4     000   000000 006000   000000 006000   000000 006000   000006 006000    ................
PL6.E3A0      #003=GET_CONNECTED File=TCF$FTPD.:TCA2TSI                          SUN 11/16/97 14:10 Page:48   
   4     004   000000 006000   000000 006000   000000 020002   000000 006000    ................
   4     010   000002 006000   000006 006000   000027 006000   000006 006000    ................
   4     014   000617 777640   000000 006000   000000 006000   000014 006000    ................
   4     020   000000 006000                                                    ....
      151      587
      152      588        %EOD;

PL6.E3A0      #003=GET_CONNECTED File=TCF$FTPD.:TCA2TSI                          SUN 11/16/97 14:10 Page:49   
--  Include file information  --

   XSL_SOCKET_E.:TCA2TOU  is referenced.
   TCF_FTP_E.:TCA2TOU  is referenced.
   TCP_HEP_E.:TCA2TOU  is referenced.
   TCP_HEP_M.:TCA2TOU  cannot be made into a system file and is referenced.
   CP_6.:LIBRARY  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure GET_CONNECTED.
PL6.E3A0      #003=GET_CONNECTED File=TCF$FTPD.:TCA2TSI                          SUN 11/16/97 14:10 Page:50   

 **** Variables and constants ****

  ****  Section 001  Data  GET_CONNECTED

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c STRC(441)   r     1 SALUTATION

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w SBIN        r     1 CRUD

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c ASTR(9)     r     1 B_VERSION                  0-0-0/w STRC(180)   r     1 CB
     0-0-0/c CHAR(1600)  r     1 CMD_BUFFER                 0-0-0/w STRC(72)    r     1 CMD_FS
     0-0-0/w UBIN        r     1 CMD_LCN                    0-0-0/w STRC(72)    r     1 CMD_LS


   Procedure GET_CONNECTED requires 59 words for executable code.
   Procedure GET_CONNECTED requires 10 words of local(AUTO) storage.
PL6.E3A0      #003=GET_CONNECTED File=TCF$FTPD.:TCA2TSI                          SUN 11/16/97 14:10 Page:51   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=GET_CONNECTED File=TCF$FTPD.:TCA2TSI                          SUN 11/16/97 14:10 Page:52   
          MINI XREF LISTING

B_VERSION.L
       536**DCL       536--IMP-SIZ   582>>CALLBLT   583>>ASSIGN
B_VERSION.T
       536**DCL       582>>CALLBLT
CB
       565**DCL       577<>CALL
CB.ADMIN
       565**DCL       579>>IF
CMD_BUFFER
       547**DCL       577--CALL      579--CALL
CMD_FS
       558**DCL       568<>CALL      568<>CALL
CMD_LCN
       546**DCL       568<>CALL      573<>CALL      577<>CALL
CMD_LS
       550**DCL       568<>CALL      568<>CALL
CRUD
       545**DCL       573<>CALL
M$ERR
        28**DCL-ENT   580--CALL
M$XXX
        28**DCL-ENT   571--CALL
REMOTE_ADMIN
       534**DCL-ENT   579--CALL
SALUTATION
       537**DCL       584<>CALL
SALUTATION.L
       538**DCL       583<<ASSIGN
SALUTATION.M1
       539**DCL       583--ASSIGN
SALUTATION.M2
       540**DCL       582<<CALLBLT
PL6.E3A0      #003=GET_CONNECTED File=TCF$FTPD.:TCA2TSI                          SUN 11/16/97 14:10 Page:53   
SEND_MSG
       535**DCL-ENT   584--CALL
TCP$OPEN
       541**DCL-ENT   568--CALL
TCP$READ
       542**DCL-ENT   577--CALL
TCPERR
       565**LABEL     577--CALLALT
XSL$QSETSOCKOPT
       543**DCL-ENT   573--CALL
PL6.E3A0      #003=GET_CONNECTED File=TCF$FTPD.:TCA2TSI                          SUN 11/16/97 14:10 Page:54   
              *** CROSS REFERENCE LISTING ***
    **     DENOTES     IDENTIFIER DEFINITION
    <<                 IDENTIFIER'S VALUE SET
    >>                 IDENTIFIER'S VALUE USED
    <>                 IDENTIFIER SET AND/OR USED
    --                 IDENTIFIER REFERENCED
PL6.E3A0      #003=GET_CONNECTED File=TCF$FTPD.:TCA2TSI                          SUN 11/16/97 14:10 Page:55   
              MINI UREF LISTING

GET_CONNECTED       6**PROC
M$ACCT      33**DCL-ENT
M$ACTIVATE      36**DCL-ENT
M$ALIB      29**DCL-ENT
M$ASUSER      31**DCL-ENT
M$ATTACH      38**DCL-ENT
M$BADPP      56**DCL-ENT
M$CGCTL      37**DCL-ENT
M$CGINFO      37**DCL-ENT
M$CHECK      18**DCL-ENT
M$CHGUNIT      76**DCL-ENT
M$CLOSE      16**DCL-ENT
M$CLRSTK      74**DCL-ENT
M$CMDVAR      85**DCL-ENT
M$CONFIG      46**DCL-ENT
M$CORRES      21**DCL-ENT
M$CPEXIT      30**DCL-ENT
M$CVM      54**DCL-ENT
M$CVOL      19**DCL-ENT
M$DCLFLD      46**DCL-ENT
M$DEACTIVATE      36**DCL-ENT
M$DELREC      18**DCL-ENT
M$DEQ      83**DCL-ENT
M$DETACH      38**DCL-ENT
M$DEVICE      20**DCL-ENT
M$DISPLAY      83**DCL-ENT
M$DISPRES      23**DCL-ENT
M$DLIB      29**DCL-ENT
M$DRIBBLE      46**DCL-ENT
M$DRTN      74**DCL-ENT
M$DSUSER      31**DCL-ENT
M$ENQ      82**DCL-ENT
PL6.E3A0      #003=GET_CONNECTED File=TCF$FTPD.:TCA2TSI                          SUN 11/16/97 14:10 Page:56   
M$EOM      41**DCL-ENT
M$ERASE      47**DCL-ENT
M$ERRMSG      79**DCL-ENT
M$EVENT      71**DCL-ENT
M$EXHUME      80**DCL-ENT
M$EXIT      28**DCL-ENT
M$EXTEND      20**DCL-ENT
M$FDP      52**DCL-ENT
M$FDS      51**DCL-ENT
M$FEBOOT      44**DCL-ENT
M$FECTL      45**DCL-ENT
M$FEDUMP      44**DCL-ENT
M$FID      79**DCL-ENT
M$FINDPROC      33**DCL-ENT
M$FSUSER      31**DCL-ENT
M$FVP      53**DCL-ENT
M$FWCG      37**DCL-ENT
M$GBPL      57**DCL-ENT
M$GDDL      53**DCL-ENT
M$GDP      52**DCL-ENT
M$GDS      51**DCL-ENT
M$GETDCB      22**DCL-ENT
M$GETMOUSE      62**DCL-ENT
M$GETPM      63**DCL-ENT
M$GJOB      81**DCL-ENT
M$GLINEATTR      41**DCL-ENT
M$GOODPP      56**DCL-ENT
M$GPLATEN      49**DCL-ENT
M$GPROMPT      48**DCL-ENT
M$GTRMATTR      42**DCL-ENT
M$GTRMCTL      40**DCL-ENT
M$GTRMTAB      43**DCL-ENT
M$GVP      52**DCL-ENT
M$HELP      79**DCL-ENT
M$INT      71**DCL-ENT
M$INTRTN      32**DCL-ENT
PL6.E3A0      #003=GET_CONNECTED File=TCF$FTPD.:TCA2TSI                          SUN 11/16/97 14:10 Page:57   
M$IOQ      67**DCL-ENT
M$JOBSTATS      81**DCL-ENT
M$KEYIN      21**DCL-ENT
M$LDEV      16**DCL-ENT
M$LDTRC      29**DCL-ENT
M$LIMIT      22**DCL-ENT
M$LINES      21**DCL-ENT
M$LINK      28**DCL-ENT
M$MADMUCK      24**DCL-ENT
M$MAKUSER      55**DCL-ENT
M$MBS      23**DCL-ENT
M$MDFFLD      47**DCL-ENT
M$MERC      72**DCL-ENT
M$MERCS      73**DCL-ENT
M$MIRROR      67**DCL-ENT
M$MONINFO      84**DCL-ENT
M$MPL      57**DCL-ENT
M$NODEINFO      48**DCL-ENT
M$NXTUSR      82**DCL-ENT
M$OCMSG      80**DCL-ENT
M$OLAY      28**DCL-ENT
M$OPEN      16**DCL-ENT
M$PAS      57**DCL-ENT
M$PATHCON      80**DCL-ENT
M$PDS      51**DCL-ENT
M$PFIL      18**DCL-ENT
M$PLATEN      42**DCL-ENT
M$PRECORD      20**DCL-ENT
M$PROCNAME      33**DCL-ENT
M$PROFILE      44**DCL-ENT
M$PROMPT      40**DCL-ENT
M$RACST      24**DCL-ENT
M$RDSYSLOG      65**DCL-ENT
M$READ      17**DCL-ENT
M$RELDCB      22**DCL-ENT
M$RELRES      23**DCL-ENT
PL6.E3A0      #003=GET_CONNECTED File=TCF$FTPD.:TCA2TSI                          SUN 11/16/97 14:10 Page:58   
M$RELSTARF      25**DCL-ENT
M$REM      25**DCL-ENT
M$RENV      72**DCL-ENT
M$REQUIRE      24**DCL-ENT
M$RETRY      73**DCL-ENT
M$RETRYS      73**DCL-ENT
M$REW      19**DCL-ENT
M$RLSFLD      47**DCL-ENT
M$RPRIV      75**DCL-ENT
M$RSPP      54**DCL-ENT
M$RSWITCH      76**DCL-ENT
M$RUE      82**DCL-ENT
M$SAD      55**DCL-ENT
M$SAVE      31**DCL-ENT
M$SCON      32**DCL-ENT
M$SCREECH      30**DCL-ENT
M$SENV      72**DCL-ENT
M$SETFMA      16**DCL-ENT
M$SETFP      45**DCL-ENT
M$SINPUT      43**DCL-ENT
M$SLCFLD      48**DCL-ENT
M$SMOUSE      62**DCL-ENT
M$SMPRT      54**DCL-ENT
M$SPRIV      75**DCL-ENT
M$SSC      55**DCL-ENT
M$SSWITCH      75**DCL-ENT
M$STATE      84**DCL-ENT
M$STD      56**DCL-ENT
M$STIMER      70**DCL-ENT
M$STLPP      53**DCL-ENT
M$STRAP      70**DCL-ENT
M$STRMATTR      42**DCL-ENT
M$STRMCTL      40**DCL-ENT
M$STRMTAB      43**DCL-ENT
M$SYMBIO      81**DCL-ENT
M$SYSCON      67**DCL-ENT
PL6.E3A0      #003=GET_CONNECTED File=TCF$FTPD.:TCA2TSI                          SUN 11/16/97 14:10 Page:59   
M$SYSID      85**DCL-ENT
M$TDCLOSE      66**DCL-ENT
M$TDIO      66**DCL-ENT
M$TDOPEN      65**DCL-ENT
M$TDREQCPU      66**DCL-ENT
M$TEMPWROC      60**DCL-ENT
M$TIME      83**DCL-ENT
M$TRAP      70**DCL-ENT
M$TRMISC      45**DCL-ENT
M$TRMPRG      41**DCL-ENT
M$TRTN      74**DCL-ENT
M$TRUNC      17**DCL-ENT
M$TTIMER      70**DCL-ENT
M$UC      40**DCL
M$UMPL      57**DCL-ENT
M$UNFID      79**DCL-ENT
M$UNLATCH      36**DCL-ENT
M$UNSHARE      33**DCL-ENT
M$USRFIELD      76**DCL-ENT
M$VIRTUAL      51**DCL-ENT
M$WAIT      74**DCL-ENT
M$WEOF      19**DCL-ENT
M$WRITE      17**DCL-ENT
M$WRSYSLOG      65**DCL-ENT
M$XCON      71**DCL-ENT
M$XCONRTN      32**DCL-ENT
M$XEQTIME      84**DCL-ENT
M$XFLUSH      25**DCL-ENT
M$XMOUSE      62**DCL-ENT
M$YC      30**DCL-ENT
TCP_ERR_CODE     124**DCL
TCP_MON_ERR     124**DCL

PL6.E3A0      #004=GET_COMMAND File=TCF$FTPD.:TCA2TSI                            SUN 11/16/97 14:11 Page:60   
      153        1        /*T***********************************************************/
      154        2        /*T*                                                         */
      155        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      156        4        /*T*                                                         */
      157        5        /*T***********************************************************/
      158        6
      159        7        GET_COMMAND: PROC (BUF_, ARS, ENT$) ALTRET;
      160        8
      161        9    1   DCL BUF_ VECTOR;
      162       10    1   DCL ARS SBIN;
      163       11    1   DCL ENT$ EPTR;
      164       12
      165       13    1   DCL GET_LINE ENTRY(4) ALTRET;
      166       14    1   DCL CMD_LCN SBIN SYMREF;
      167       15    1   DCL FTP_TIMEOUT SBIN SYMREF;
      168       16
      169       17    2      CALL GET_LINE (CMD_LCN, BUF_, ARS, FTP_TIMEOUT) WHENRETURN DO;
      170       18    2          ARS = ARS-2;
      171       19    2          RETURN;
      172       20    2          END;
      173       21    1      ALTRETURN;
      174       22
      175       23    1   END GET_COMMAND;
      176       24
      177       25        %EOD;

PL6.E3A0      #004=GET_COMMAND File=TCF$FTPD.:TCA2TSI                            SUN 11/16/97 14:11 Page:61   
--  Include file information  --

   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure GET_COMMAND.

   Procedure GET_COMMAND requires 17 words for executable code.
   Procedure GET_COMMAND requires 10 words of local(AUTO) storage.

PL6.E3A0      #004=GET_COMMAND File=TCF$FTPD.:TCA2TSI                            SUN 11/16/97 14:11 Page:62   

 Object Unit name= GET_COMMAND                                File name= TCF$FTPD.:TCA2TOU
 UTS= NOV 16 '97 14:11:13.56 SUN                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none    17     21  GET_COMMAND
    1  RoData even  none     2      2  GET_COMMAND

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes    yes     yes      Std        3  GET_COMMAND

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       4 GET_LINE
                       nStd      0 X66_AUTO_3
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     CMD_LCN                               FTP_TIMEOUT                           B_VECTNIL
PL6.E3A0      #004=GET_COMMAND File=TCF$FTPD.:TCA2TSI                            SUN 11/16/97 14:11 Page:63   

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #004=GET_COMMAND File=TCF$FTPD.:TCA2TSI                            SUN 11/16/97 14:11 Page:64   


      153        1        /*T***********************************************************/
      154        2        /*T*                                                         */
      155        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      156        4        /*T*                                                         */
      157        5        /*T***********************************************************/
      158        6
      159        7        GET_COMMAND: PROC (BUF_, ARS, ENT$) ALTRET;

      7  0 000000   000000 700200 xent  GET_COMMAND  TSX0  ! X66_AUTO_3
         0 000001   000012 000003                    ZERO    10,3

      160        8
      161        9    1   DCL BUF_ VECTOR;
      162       10    1   DCL ARS SBIN;
      163       11    1   DCL ENT$ EPTR;
      164       12
      165       13    1   DCL GET_LINE ENTRY(4) ALTRET;
      166       14    1   DCL CMD_LCN SBIN SYMREF;
      167       15    1   DCL FTP_TIMEOUT SBIN SYMREF;
      168       16
      169       17    2      CALL GET_LINE (CMD_LCN, BUF_, ARS, FTP_TIMEOUT) WHENRETURN DO;

     17  0 000002   000000 236000 1                  LDQ     0
         0 000003   200004 235100                    LDA     @ARS,,AUTO
         0 000004   200010 757100                    STAQ    @ENT$+3,,AUTO
         0 000005   200003 236100                    LDQ     @BUF_,,AUTO
         0 000006   000001 235000 1                  LDA     1
         0 000007   200006 757100                    STAQ    @ENT$+1,,AUTO
         0 000010   200006 630500                    EPPR0   @ENT$+1,,AUTO
         0 000011   000022 631400 xsym               EPPR1   B_VECTNIL+18
         0 000012   000000 701000 xent               TSX1    GET_LINE
         0 000013   000020 702000 0                  TSX2    s:21

      170       18    2          ARS = ARS-2;

     18  0 000014   200004 470500                    LDP0    @ARS,,AUTO
PL6.E3A0      #004=GET_COMMAND File=TCF$FTPD.:TCA2TSI                            SUN 11/16/97 14:11 Page:65   
         0 000015   000002 336007                    LCQ     2,DL
         0 000016   000000 056100                    ASQ     0,,PR0

      171       19    2          RETURN;

     19  0 000017   000000 702200 xent               TSX2  ! X66_ARET

      172       20    2          END;
      173       21    1      ALTRETURN;

     21  0 000020   000000 702200 xent               TSX2  ! X66_AALT

(unnamed)
 Sect OctLoc
   1     000   000000 006000   000000 006000                                    ........
      174       22
      175       23    1   END GET_COMMAND;
      176       24
      177       25        %EOD;

PL6.E3A0      #004=GET_COMMAND File=TCF$FTPD.:TCA2TSI                            SUN 11/16/97 14:11 Page:66   
--  Include file information  --

   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure GET_COMMAND.
PL6.E3A0      #004=GET_COMMAND File=TCF$FTPD.:TCA2TSI                            SUN 11/16/97 14:11 Page:67   

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @ARS                       3-0-0/w PTR         r     1 @BUF_
     5-0-0/w PTR         r     1 @ENT$                     *0-0-0/w SBIN        r     1 ARS
    *0-0-0/d VECT        r     1 BUF_                      *0-0-0/w EPTR        r     1 ENT$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w SBIN        r     1 CMD_LCN                    0-0-0/w SBIN        r     1 FTP_TIMEOUT


   Procedure GET_COMMAND requires 17 words for executable code.
   Procedure GET_COMMAND requires 10 words of local(AUTO) storage.
PL6.E3A0      #004=GET_COMMAND File=TCF$FTPD.:TCA2TSI                            SUN 11/16/97 14:11 Page:68   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #004=GET_COMMAND File=TCF$FTPD.:TCA2TSI                            SUN 11/16/97 14:11 Page:69   
          MINI XREF LISTING

ARS
        10**DCL         7--PROC       17<>CALL       18<<ASSIGN     18>>ASSIGN
BUF_
         9**DCL         7--PROC       17<>CALL
CMD_LCN
        14**DCL        17<>CALL
ENT$
        11**DCL         7--PROC
FTP_TIMEOUT
        15**DCL        17<>CALL
GET_LINE
        13**DCL-ENT    17--CALL
PL6.E3A0      #004=GET_COMMAND File=TCF$FTPD.:TCA2TSI                            SUN 11/16/97 14:11 Page:70   
              *** CROSS REFERENCE LISTING ***
    **     DENOTES     IDENTIFIER DEFINITION
    <<                 IDENTIFIER'S VALUE SET
    >>                 IDENTIFIER'S VALUE USED
    <>                 IDENTIFIER SET AND/OR USED
    --                 IDENTIFIER REFERENCED
PL6.E3A0      #004=GET_COMMAND File=TCF$FTPD.:TCA2TSI                            SUN 11/16/97 14:11 Page:71   
              MINI UREF LISTING

GET_COMMAND       7**PROC

PL6.E3A0      #005=GET_LINE File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:11 Page:72   
      178        1        /*T***********************************************************/
      179        2        /*T*                                                         */
      180        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      181        4        /*T*                                                         */
      182        5        /*T***********************************************************/
      183        6
      184        7        GET_LINE: PROC(LCN, BUF_, ARS,  TIMEOUT) ALTRET;
      185        8        %INCLUDE CP_6;
      186       89        %INCLUDE TCP_HEP_M;
      187      144        %INCLUDE TCP_HEP_E;
      188      221        %INCLUDE TCT_TELNET_E;
      189      276
      190      277    1   DCL LCN UBIN(36);
      191      278    1   DCL BUF_ VECTOR;
      192      279    1   DCL ARS UBIN(36);
      193      280    1   DCL TIMEOUT UBIN(36);
      194      281    1   DCL REMOTE_IAC BIT(1) STATIC INIT('0'B);
      195      282    1   DCL REMOTE_OPTION BIT(1) STATIC INIT('0'B);
      196      283    1   DCL TELNET_INBUF STATIC CHAR(1600);
      197      284        %TCP$CB (NAME=CB, STCLASS=STATIC);
      198      287    1   DCL SEND_MSG ENTRY(2) ALTRET;
      199      288    1   DCL MSG_421 SBIN SYMREF;
      200      289    1   DCL TCP$READ ENTRY(3) ALTRET;
      201      290    1   DCL TCP$READ_NW ENTRY(3) ALTRET;
      202      291    1   DCL IP$WAIT ENTRY(2);
      203      292    1   DCL REMOTE_ADMIN ENTRY(1);
      204      293    1   DCL BUFLCN SBIN STATIC INIT(-1);
      205      294    1   DCL BUFL SBIN STATIC INIT(0);
      206      295    1   DCL I SBIN STATIC INIT(0);
      207      296        %FPT_WRITE (FPTN=WRITE_LO, STCLASS=SYMREF);
      208      327    1   DCL TO_USER$ PTR;
      209      328    1   DCL USER_BUF CHAR(1600) BASED(TO_USER$);
      210      329    1   DCL CRFLAG BIT(1) STATIC INIT('0'B);
      211      330    1   DCL MYARS SBIN;
      212      331    1   DCL MAX_BYTES SBIN;
      213      332
      214      333    1      TO_USER$ = VBASE(BUF_);
PL6.E3A0      #005=GET_LINE File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:11 Page:73   
      215      334    1      MAX_BYTES = VBOUND(BUF_)+1;
      216      335
      217      336    2      IF LCN~=BUFLCN THEN DO;
      218      337    2          BUFLCN = LCN;
      219      338    2          BUFL = 0;
      220      339    2          CRFLAG = '0'B;
      221      340    2          REMOTE_IAC = '0'B;
      222      341    2          REMOTE_OPTION = '0'B;
      223      342    2          END;
      224      343
      225      344    1      MYARS = 0;
      226      345    2      IF CRFLAG THEN DO; /* Put a cr in this buffer, since we took it out before */
      227      346    2          SUBSTR(USER_BUF,0,1) = %CP6_CR;
      228      347    2          MYARS = 1;
      229      348    2          END;
      230      349
      231      350    2      DO WHILE '1'B;
      232      351    2          IF I>=BUFL
      233      352    3          THEN DO;
      234      353    4              IF ADDR(TIMEOUT)~= ADDR(NIL) AND TIMEOUT > 0 THEN DO;
      235      354    4                  CALL TCP$READ_NW (LCN, VECTOR(TELNET_INBUF), CB) ALTRET (RETALT);
      236      355    4                  CALL IP$WAIT (TIMEOUT);
      237      356    5                  IF NOT CB.READ_COMPLETE THEN DO;
      238      357    5                      CALL SEND_MSG (MSG_421);
      239      358    5                      ALTRETURN;
      240      359    5                      END;
      241      360    4                  END;
      242      361    3              ELSE CALL TCP$READ (LCN, VECTOR(TELNET_INBUF), CB) ALTRET (RETALT);
      243      362
      244      363    4              IF CB.ADMIN THEN DO;
      245      364        /*     Call REMOTE_ADMIN(ADDR(TELNET_INBUF)); */
      246      365    4                  IF MYARS=0 THEN
      247      366    4   RETALT:            ALTRETURN;
      248      367    4                  SUBSTR(TELNET_INBUF,0,2) = %CONCAT(CP6_CR,CP6_LF);
      249      368    4                  REMOTE_IAC = '0'B;
      250      369    4                  REMOTE_OPTION = '0'B;
      251      370    4                  CB.ARS = 2;
PL6.E3A0      #005=GET_LINE File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:11 Page:74   
      252      371    4                  END;
      253      372    3              I = 0;
      254      373    3              BUFL = CB.ARS;
      255      374    3              END;
      256      375
      257      376
      258      377           /* Get a buffer from tcp into TELNET_INBUF.  Filter out all
      259      378              commands and options.  Since the filtered buffer will be
      260      379              smaller, filter into the same buffer.  Remember the iac
      261      380              state */
      262      381
      263      382    2          IF REMOTE_IAC
      264      383    3          THEN DO;
      265      384    3              REMOTE_IAC = '0'B;
      266      385    4              DO SELECT (SUBSTR(TELNET_INBUF,I,1));
      267      386    4                  SELECT (%TELNET_IAC);
      268      387    4                  GOTO COPY_CHAR;
      269      388
      270      389    4                  SELECT (%TELNET_WILL, %TELNET_WONT,
      271      390    4                        %TELNET_DO, %TELNET_DONT);
      272      391    4                  REMOTE_OPTION = '1'B;
      273      392
      274      393    4                  SELECT (ELSE);
      275      394                                                /* Ignore all commands */
      276      395    4                  END;
      277      396    3              END;
      278      397
      279      398    2          ELSE IF REMOTE_OPTION
      280      399    3              THEN DO;
      281      400    3                  REMOTE_OPTION = '0'B;
      282      401                                                /* Ignore all options */
      283      402    3                  END;
      284      403
      285      404    3              ELSE DO;
      286      405
      287      406    3                  IF SUBSTR(TELNET_INBUF,I,1) = %TELNET_IAC
      288      407    3                  THEN REMOTE_IAC = '1'B;
PL6.E3A0      #005=GET_LINE File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:11 Page:75   
      289      408    4                  ELSE DO;
      290      409    5                      IF CRFLAG THEN DO;
      291      410    5                          IF SUBSTR(TELNET_INBUF,I,1) = %CP6_LF
      292      411    5                          THEN MAX_BYTES = 0; /* All done */
      293      412    5                          ELSE IF SUBSTR(TELNET_INBUF,I,1) = BINASC(0)
      294      413    5                              THEN GOTO SKIP_CHAR;
      295      414    5                          END;
      296      415    4                      IF SUBSTR(TELNET_INBUF,I,1) = %CP6_CR THEN CRFLAG='1'B;
      297      416    4                      ELSE CRFLAG='0'B;
      298      417    4   COPY_CHAR:         SUBSTR(USER_BUF,MYARS,1) = SUBSTR(TELNET_INBUF,I,1);
      299      418    4                      MYARS = MYARS + 1;
      300      419    4                      END;
      301      420    3                  END;
      302      421    2   SKIP_CHAR: ;
      303      422    2          I = I + 1;
      304      423    2          IF MYARS>=MAX_BYTES THEN EXIT;
      305      424    2          END;                             /* Do while '1'b */
      306      425    1      IF MAX_BYTES>0 THEN MYARS = MYARS+2; /* Indicate no termination */
      307      426    1      IF CRFLAG THEN MYARS = MYARS-1;      /* Wait for next call to send the cr */
      308      427    1      ARS = MYARS;
      309      428    1      RETURN;
      310      429    1   END GET_LINE;
      311      430
      312      431        %EOD;

PL6.E3A0      #005=GET_LINE File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:11 Page:76   
--  Include file information  --

   TCT_TELNET_E.:TCA2TOU  is referenced.
   TCP_HEP_E.:TCA2TOU  is referenced.
   TCP_HEP_M.:TCA2TOU  cannot be made into a system file and is referenced.
   CP_6.:LIBRARY  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure GET_LINE.

   Procedure GET_LINE requires 169 words for executable code.
   Procedure GET_LINE requires 14 words of local(AUTO) storage.

PL6.E3A0      #005=GET_LINE File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:11 Page:77   

 Object Unit name= GET_LINE                                   File name= TCF$FTPD.:TCA2TOU
 UTS= NOV 16 '97 14:11:23.40 SUN                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   Data  even  none   411    633  GET_LINE
    2  RoData even  UTS      1      1  GET_LINE
    3   Proc  even  none   169    251  GET_LINE
    4  RoData even  none    13     15  GET_LINE

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     3      0   yes    yes     yes      Std        4  GET_LINE

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       3 TCP$READ_NW
         yes           Std       2 IP$WAIT
 yes     yes           Std       3 TCP$READ
 yes     yes           Std       2 SEND_MSG
                       nStd      0 X66_AUTO_4
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AALT
                       nStd      0 X66_ARET
PL6.E3A0      #005=GET_LINE File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:11 Page:78   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  MSG_421                               B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #005=GET_LINE File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:11 Page:79   


      178        1        /*T***********************************************************/
      179        2        /*T*                                                         */
      180        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      181        4        /*T*                                                         */
      182        5        /*T***********************************************************/
      183        6
      184        7        GET_LINE: PROC(LCN, BUF_, ARS,  TIMEOUT) ALTRET;

      7  3 000000   000000 700200 xent  GET_LINE     TSX0  ! X66_AUTO_4
         3 000001   000016 000004                    ZERO    14,4

      185        8        %INCLUDE CP_6;
      186       89        %INCLUDE TCP_HEP_M;
      187      144        %INCLUDE TCP_HEP_E;
      188      221        %INCLUDE TCT_TELNET_E;
      189      276
      190      277    1   DCL LCN UBIN(36);
      191      278    1   DCL BUF_ VECTOR;
      192      279    1   DCL ARS UBIN(36);
      193      280    1   DCL TIMEOUT UBIN(36);
      194      281    1   DCL REMOTE_IAC BIT(1) STATIC INIT('0'B);
      195      282    1   DCL REMOTE_OPTION BIT(1) STATIC INIT('0'B);
      196      283    1   DCL TELNET_INBUF STATIC CHAR(1600);
      197      284        %TCP$CB (NAME=CB, STCLASS=STATIC);
      198      287    1   DCL SEND_MSG ENTRY(2) ALTRET;
      199      288    1   DCL MSG_421 SBIN SYMREF;
      200      289    1   DCL TCP$READ ENTRY(3) ALTRET;
      201      290    1   DCL TCP$READ_NW ENTRY(3) ALTRET;
      202      291    1   DCL IP$WAIT ENTRY(2);
      203      292    1   DCL REMOTE_ADMIN ENTRY(1);
      204      293    1   DCL BUFLCN SBIN STATIC INIT(-1);
      205      294    1   DCL BUFL SBIN STATIC INIT(0);
      206      295    1   DCL I SBIN STATIC INIT(0);
      207      296        %FPT_WRITE (FPTN=WRITE_LO, STCLASS=SYMREF);
      208      327    1   DCL TO_USER$ PTR;
      209      328    1   DCL USER_BUF CHAR(1600) BASED(TO_USER$);
PL6.E3A0      #005=GET_LINE File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:11 Page:80   
      210      329    1   DCL CRFLAG BIT(1) STATIC INIT('0'B);
      211      330    1   DCL MYARS SBIN;
      212      331    1   DCL MAX_BYTES SBIN;
      213      332
      214      333    1      TO_USER$ = VBASE(BUF_);

    333  3 000002   200004 470500                    LDP0    @BUF_,,AUTO
         3 000003   000001 236100                    LDQ     1,,PR0
         3 000004   200007 756100                    STQ     TO_USER$,,AUTO

      215      334    1      MAX_BYTES = VBOUND(BUF_)+1;

    334  3 000005   000000 236100                    LDQ     0,,PR0
         3 000006   000020 772000                    QRL     16
         3 000007   000001 036007                    ADLQ    1,DL
         3 000010   200011 756100                    STQ     MAX_BYTES,,AUTO

      216      335
      217      336    2      IF LCN~=BUFLCN THEN DO;

    336  3 000011   200003 471500                    LDP1    @LCN,,AUTO
         3 000012   100000 236100                    LDQ     0,,PR1
         3 000013   000016 604000 3                  TMI     s:337
         3 000014   000627 116000 1                  CMPQ    BUFLCN
         3 000015   000023 600000 3                  TZE     s:344

      218      337    2          BUFLCN = LCN;

    337  3 000016   000627 756000 1                  STQ     BUFLCN

      219      338    2          BUFL = 0;

    338  3 000017   000630 450000 1                  STZ     BUFL

      220      339    2          CRFLAG = '0'B;

    339  3 000020   000632 450000 1                  STZ     CRFLAG
PL6.E3A0      #005=GET_LINE File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:11 Page:81   

      221      340    2          REMOTE_IAC = '0'B;

    340  3 000021   000000 450000 1                  STZ     REMOTE_IAC

      222      341    2          REMOTE_OPTION = '0'B;

    341  3 000022   000001 450000 1                  STZ     REMOTE_OPTION

      223      342    2          END;

      224      343
      225      344    1      MYARS = 0;

    344  3 000023   200010 450100                    STZ     MYARS,,AUTO

      226      345    2      IF CRFLAG THEN DO; /* Put a cr in this buffer, since we took it out before */

    345  3 000024   000632 234000 1                  SZN     CRFLAG
         3 000025   000034 605000 3                  TPL     s:351

      227      346    2          SUBSTR(USER_BUF,0,1) = %CP6_CR;

    346  3 000026   200007 473500                    LDP3    TO_USER$,,AUTO
         3 000027   040100 100400                    MLR     fill='040'O
         3 000030   000000 000001 4                  ADSC9   0                        cn=0,n=1
         3 000031   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1

      228      347    2          MYARS = 1;

    347  3 000032   000001 235007                    LDA     1,DL
         3 000033   200010 755100                    STA     MYARS,,AUTO

      229      348    2          END;

      230      349
      231      350    2      DO WHILE '1'B;
PL6.E3A0      #005=GET_LINE File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:11 Page:82   

      232      351    2          IF I>=BUFL

    351  3 000034   000631 236000 1                  LDQ     I
         3 000035   000630 116000 1                  CMPQ    BUFL
         3 000036   000120 604000 3                  TMI     s:382

      233      352    3          THEN DO;

      234      353    4              IF ADDR(TIMEOUT)~= ADDR(NIL) AND TIMEOUT > 0 THEN DO;

    353  3 000037   200006 236100                    LDQ     @TIMEOUT,,AUTO
         3 000040   000001 116000 xsym               CMPQ    B_VECTNIL+1
         3 000041   000071 600000 3                  TZE     s:361
         3 000042   200006 470500                    LDP0    @TIMEOUT,,AUTO
         3 000043   000000 235100                    LDA     0,,PR0
         3 000044   000071 600000 3                  TZE     s:361

      235      354    4                  CALL TCP$READ_NW (LCN, VECTOR(TELNET_INBUF), CB) ALTRET (RETALT);

    354  3 000045   000001 236000 4                  LDQ     1
         3 000046   200014 756100                    STQ     MAX_BYTES+3,,AUTO
         3 000047   000004 236000 4                  LDQ     4
         3 000050   200003 235100                    LDA     @LCN,,AUTO
         3 000051   200012 757100                    STAQ    MAX_BYTES+1,,AUTO
         3 000052   200012 630500                    EPPR0   MAX_BYTES+1,,AUTO
         3 000053   000021 631400 xsym               EPPR1   B_VECTNIL+17
         3 000054   000000 701000 xent               TSX1    TCP$READ_NW
         3 000055   000106 702000 3                  TSX2    RETALT

      236      355    4                  CALL IP$WAIT (TIMEOUT);

    355  3 000056   200006 630500                    EPPR0   @TIMEOUT,,AUTO
         3 000057   000017 631400 xsym               EPPR1   B_VECTNIL+15
         3 000060   000000 701000 xent               TSX1    IP$WAIT
         3 000061   000000 011000                    NOP     0

PL6.E3A0      #005=GET_LINE File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:11 Page:83   
      237      356    5                  IF NOT CB.READ_COMPLETE THEN DO;

    356  3 000062   000625 234000 1                  SZN     CB+3
         3 000063   000102 604000 3                  TMI     s:363

      238      357    5                      CALL SEND_MSG (MSG_421);

    357  3 000064   000005 630400 4                  EPPR0   5
         3 000065   000017 631400 xsym               EPPR1   B_VECTNIL+15
         3 000066   000000 701000 xent               TSX1    SEND_MSG
         3 000067   000000 011000                    NOP     0

      239      358    5                      ALTRETURN;

    358  3 000070   000000 702200 xent               TSX2  ! X66_AALT

      240      359    5                      END;
      241      360    4                  END;
      242      361    3              ELSE CALL TCP$READ (LCN, VECTOR(TELNET_INBUF), CB) ALTRET (RETALT);

    361  3 000071   000001 236000 4                  LDQ     1
         3 000072   200014 756100                    STQ     MAX_BYTES+3,,AUTO
         3 000073   000004 236000 4                  LDQ     4
         3 000074   200003 235100                    LDA     @LCN,,AUTO
         3 000075   200012 757100                    STAQ    MAX_BYTES+1,,AUTO
         3 000076   200012 630500                    EPPR0   MAX_BYTES+1,,AUTO
         3 000077   000021 631400 xsym               EPPR1   B_VECTNIL+17
         3 000100   000000 701000 xent               TSX1    TCP$READ
         3 000101   000106 702000 3                  TSX2    RETALT

      243      362
      244      363    4              IF CB.ADMIN THEN DO;

    363  3 000102   000622 234000 1                  SZN     CB
         3 000103   000115 605000 3                  TPL     s:372

      245      364        /*     Call REMOTE_ADMIN(ADDR(TELNET_INBUF)); */
PL6.E3A0      #005=GET_LINE File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:11 Page:84   
      246      365    4                  IF MYARS=0 THEN

    365  3 000104   200010 235100                    LDA     MYARS,,AUTO
         3 000105   000107 601000 3                  TNZ     s:367

      247      366    4   RETALT:            ALTRETURN;

    366  3 000106   000000 702200 xent  RETALT       TSX2  ! X66_AALT

      248      367    4                  SUBSTR(TELNET_INBUF,0,2) = %CONCAT(CP6_CR,CP6_LF);

    367  3 000107   000000 220000 2                  LDX0    0
         3 000110   000002 740000 1                  STX0    TELNET_INBUF

      249      368    4                  REMOTE_IAC = '0'B;

    368  3 000111   000000 450000 1                  STZ     REMOTE_IAC

      250      369    4                  REMOTE_OPTION = '0'B;

    369  3 000112   000001 450000 1                  STZ     REMOTE_OPTION

      251      370    4                  CB.ARS = 2;

    370  3 000113   000002 236007                    LDQ     2,DL
         3 000114   000623 756000 1                  STQ     CB+1

      252      371    4                  END;

      253      372    3              I = 0;

    372  3 000115   000631 450000 1                  STZ     I

      254      373    3              BUFL = CB.ARS;

    373  3 000116   000623 235000 1                  LDA     CB+1
         3 000117   000630 755000 1                  STA     BUFL
PL6.E3A0      #005=GET_LINE File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:11 Page:85   

      255      374    3              END;

      256      375
      257      376
      258      377           /* Get a buffer from tcp into TELNET_INBUF.  Filter out all
      259      378              commands and options.  Since the filtered buffer will be
      260      379              smaller, filter into the same buffer.  Remember the iac
      261      380              state */
      262      381
      263      382    2          IF REMOTE_IAC

    382  3 000120   000000 234000 1                  SZN     REMOTE_IAC
         3 000121   000162 605000 3                  TPL     s:398

      264      383    3          THEN DO;

      265      384    3              REMOTE_IAC = '0'B;

    384  3 000122   000000 450000 1                  STZ     REMOTE_IAC

      266      385    4              DO SELECT (SUBSTR(TELNET_INBUF,I,1));

    385  3 000123   000631 235000 1                  LDA     I
         3 000124   040000 106405                    CMPC    fill='040'O
         3 000125   000002 000001 1                  ADSC9   TELNET_INBUF,A           cn=0,n=1
         3 000126   000006 000001 4                  ADSC9   6                        cn=0,n=1
         3 000127   000150 602000 3                  TNC     s:385+21
         3 000130   000156 600000 3                  TZE     s:391
         3 000131   040000 106405                    CMPC    fill='040'O
         3 000132   000002 000001 1                  ADSC9   TELNET_INBUF,A           cn=0,n=1
         3 000133   000007 000001 4                  ADSC9   7                        cn=0,n=1
         3 000134   000143 602000 3                  TNC     s:385+16
         3 000135   000156 600000 3                  TZE     s:391
         3 000136   040000 106405                    CMPC    fill='040'O
         3 000137   000002 000001 1                  ADSC9   TELNET_INBUF,A           cn=0,n=1
         3 000140   000010 000001 4                  ADSC9   8                        cn=0,n=1
PL6.E3A0      #005=GET_LINE File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:11 Page:86   
         3 000141   000161 601000 3                  TNZ     s:396
         3 000142   000155 710000 3                  TRA     s:387
         3 000143   040000 106405                    CMPC    fill='040'O
         3 000144   000002 000001 1                  ADSC9   TELNET_INBUF,A           cn=0,n=1
         3 000145   000011 000001 4                  ADSC9   9                        cn=0,n=1
         3 000146   000161 601000 3                  TNZ     s:396
         3 000147   000156 710000 3                  TRA     s:391
         3 000150   040000 106405                    CMPC    fill='040'O
         3 000151   000002 000001 1                  ADSC9   TELNET_INBUF,A           cn=0,n=1
         3 000152   000012 000001 4                  ADSC9   10                       cn=0,n=1
         3 000153   000161 601000 3                  TNZ     s:396
         3 000154   000156 710000 3                  TRA     s:391

      267      386    4                  SELECT (%TELNET_IAC);

      268      387    4                  GOTO COPY_CHAR;

    387  3 000155   000222 710000 3                  TRA     COPY_CHAR

      269      388
      270      389    4                  SELECT (%TELNET_WILL, %TELNET_WONT,

      271      390    4                        %TELNET_DO, %TELNET_DONT);
      272      391    4                  REMOTE_OPTION = '1'B;

    391  3 000156   400000 236003                    LDQ     -131072,DU
         3 000157   000001 756000 1                  STQ     REMOTE_OPTION
         3 000160   000230 710000 3                  TRA     SKIP_CHAR

      273      392
      274      393    4                  SELECT (ELSE);

      275      394                                                /* Ignore all commands */
      276      395    4                  END;

      277      396    3              END;

PL6.E3A0      #005=GET_LINE File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:11 Page:87   
    396  3 000161   000230 710000 3                  TRA     SKIP_CHAR

      278      397
      279      398    2          ELSE IF REMOTE_OPTION

    398  3 000162   000001 234000 1                  SZN     REMOTE_OPTION
         3 000163   000166 605000 3                  TPL     s:406

      280      399    3              THEN DO;

      281      400    3                  REMOTE_OPTION = '0'B;

    400  3 000164   000001 450000 1                  STZ     REMOTE_OPTION

      282      401                                                /* Ignore all options */
      283      402    3                  END;

    402  3 000165   000230 710000 3                  TRA     SKIP_CHAR

      284      403
      285      404    3              ELSE DO;

      286      405
      287      406    3                  IF SUBSTR(TELNET_INBUF,I,1) = %TELNET_IAC

    406  3 000166   000631 235000 1                  LDA     I
         3 000167   040000 106405                    CMPC    fill='040'O
         3 000170   000002 000001 1                  ADSC9   TELNET_INBUF,A           cn=0,n=1
         3 000171   000010 000001 4                  ADSC9   8                        cn=0,n=1
         3 000172   000176 601000 3                  TNZ     s:409

      288      407    3                  THEN REMOTE_IAC = '1'B;

    407  3 000173   400000 236003                    LDQ     -131072,DU
         3 000174   000000 756000 1                  STQ     REMOTE_IAC
         3 000175   000230 710000 3                  TRA     SKIP_CHAR

PL6.E3A0      #005=GET_LINE File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:11 Page:88   
      289      408    4                  ELSE DO;

      290      409    5                      IF CRFLAG THEN DO;

    409  3 000176   000632 234000 1                  SZN     CRFLAG
         3 000177   000212 605000 3                  TPL     s:415

      291      410    5                          IF SUBSTR(TELNET_INBUF,I,1) = %CP6_LF

    410  3 000200   040000 106405                    CMPC    fill='040'O
         3 000201   000002 000001 1                  ADSC9   TELNET_INBUF,A           cn=0,n=1
         3 000202   000013 000001 4                  ADSC9   11                       cn=0,n=1
         3 000203   000206 601000 3                  TNZ     s:412

      292      411    5                          THEN MAX_BYTES = 0; /* All done */

    411  3 000204   200011 450100                    STZ     MAX_BYTES,,AUTO
         3 000205   000212 710000 3                  TRA     s:415

      293      412    5                          ELSE IF SUBSTR(TELNET_INBUF,I,1) = BINASC(0)

    412  3 000206   040000 106405                    CMPC    fill='040'O
         3 000207   000002 000001 1                  ADSC9   TELNET_INBUF,A           cn=0,n=1
         3 000210   000014 000001 4                  ADSC9   12                       cn=0,n=1
         3 000211   000230 600000 3                  TZE     SKIP_CHAR

      294      413    5                              THEN GOTO SKIP_CHAR;
      295      414    5                          END;

      296      415    4                      IF SUBSTR(TELNET_INBUF,I,1) = %CP6_CR THEN CRFLAG='1'B;

    415  3 000212   040000 106405                    CMPC    fill='040'O
         3 000213   000002 000001 1                  ADSC9   TELNET_INBUF,A           cn=0,n=1
         3 000214   000000 000001 4                  ADSC9   0                        cn=0,n=1
         3 000215   000221 601000 3                  TNZ     s:416

    415  3 000216   400000 236003                    LDQ     -131072,DU
PL6.E3A0      #005=GET_LINE File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:11 Page:89   
         3 000217   000632 756000 1                  STQ     CRFLAG
         3 000220   000222 710000 3                  TRA     COPY_CHAR

      297      416    4                      ELSE CRFLAG='0'B;

    416  3 000221   000632 450000 1                  STZ     CRFLAG

      298      417    4   COPY_CHAR:         SUBSTR(USER_BUF,MYARS,1) = SUBSTR(TELNET_INBUF,I,1);

    417  3 000222   200007 470500       COPY_CHAR    LDP0    TO_USER$,,AUTO
         3 000223   200010 236100                    LDQ     MYARS,,AUTO
         3 000224   040106 100405                    MLR     fill='040'O
         3 000225   000002 000001 1                  ADSC9   TELNET_INBUF,A           cn=0,n=1
         3 000226   000000 000001                    ADSC9   0,Q,PR0                  cn=0,n=1

      299      418    4                      MYARS = MYARS + 1;

    418  3 000227   200010 054100                    AOS     MYARS,,AUTO

      300      419    4                      END;

      301      420    3                  END;

    417  3 000230                       SKIP_CHAR    null
      302      421    2   SKIP_CHAR: ;
      303      422    2          I = I + 1;

    422  3 000230   000631 054000 1                  AOS     I

      304      423    2          IF MYARS>=MAX_BYTES THEN EXIT;

    423  3 000231   200010 236100                    LDQ     MYARS,,AUTO
         3 000232   200011 116100                    CMPQ    MAX_BYTES,,AUTO
         3 000233   000235 605000 3                  TPL     s:425

      305      424    2          END;                             /* Do while '1'b */

PL6.E3A0      #005=GET_LINE File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:11 Page:90   
    424  3 000234   000034 710000 3                  TRA     s:351

      306      425    1      IF MAX_BYTES>0 THEN MYARS = MYARS+2; /* Indicate no termination */

    425  3 000235   200011 235100                    LDA     MAX_BYTES,,AUTO
         3 000236   000241 604400 3                  TMOZ    s:426

    425  3 000237   000002 236007                    LDQ     2,DL
         3 000240   200010 056100                    ASQ     MYARS,,AUTO

      307      426    1      IF CRFLAG THEN MYARS = MYARS-1;      /* Wait for next call to send the cr */

    426  3 000241   000632 234000 1                  SZN     CRFLAG
         3 000242   000245 605000 3                  TPL     s:427

    426  3 000243   000001 336007                    LCQ     1,DL
         3 000244   200010 056100                    ASQ     MYARS,,AUTO

      308      427    1      ARS = MYARS;

    427  3 000245   200010 236100                    LDQ     MYARS,,AUTO
         3 000246   200005 470500                    LDP0    @ARS,,AUTO
         3 000247   000000 756100                    STQ     0,,PR0

      309      428    1      RETURN;

    428  3 000250   000000 702200 xent               TSX2  ! X66_ARET

REMOTE_IAC
 Sect OctLoc
   1     000   0***** ******                                                    ....

REMOTE_OPTION
 Sect OctLoc
   1     001   0***** ******                                                    ....

TELNET_INBUF
PL6.E3A0      #005=GET_LINE File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:11 Page:91   
 Sect OctLoc
   1     002   ****** ******   ****** ******   ****** ******   ****** ******    ................

CB
 Sect OctLoc
   1     622   ****** ******   ****** ******   ****** ******   ****** ******    ................

BUFLCN
 Sect OctLoc
   1     627   777777 777777                                                    ....

BUFL
 Sect OctLoc
   1     630   000000 000000                                                    ....

I
 Sect OctLoc
   1     631   000000 000000                                                    ....

CRFLAG
 Sect OctLoc
   1     632   0***** ******                                                    ....

(unnamed)
 Sect OctLoc
   2     000   015012 040040                                                    ..

(unnamed)
 Sect OctLoc
   4     000   015040 040040   000622 006000   000617 777640   000002 006000    .   ............
   4     004   000002 006000   000000 006000   374040 040040   376040 040040    .........   .
   4     010   377040 040040   375040 040040   373040 040040   012040 040040    .   .   .   .
   4     014   000040 040040                                                    .
      310      429    1   END GET_LINE;
      311      430
      312      431        %EOD;

PL6.E3A0      #005=GET_LINE File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:11 Page:92   
--  Include file information  --

   TCT_TELNET_E.:TCA2TOU  is referenced.
   TCP_HEP_E.:TCA2TOU  is referenced.
   TCP_HEP_M.:TCA2TOU  cannot be made into a system file and is referenced.
   CP_6.:LIBRARY  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure GET_LINE.
PL6.E3A0      #005=GET_LINE File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:11 Page:93   

 **** Variables and constants ****

  ****  Section 001  Data  GET_LINE

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

   630-0-0/w SBIN        r     1 BUFL                     627-0-0/w SBIN        r     1 BUFLCN
   622-0-0/w STRC(180)   r     1 CB                       632-0-0/b BIT         r     1 CRFLAG
   631-0-0/w SBIN        r     1 I                          0-0-0/b BIT         r     1 REMOTE_IAC
     1-0-0/b BIT         r     1 REMOTE_OPTION              2-0-0/c CHAR(1600)  r     1 TELNET_INBUF

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     5-0-0/w PTR         r     1 @ARS                       4-0-0/w PTR         r     1 @BUF_
     3-0-0/w PTR         r     1 @LCN                       6-0-0/w PTR         r     1 @TIMEOUT
    *0-0-0/w UBIN        r     1 ARS                       *0-0-0/d VECT        r     1 BUF_
    *0-0-0/w UBIN        r     1 LCN                       11-0-0/w SBIN        r     1 MAX_BYTES
    10-0-0/w SBIN        r     1 MYARS                     *0-0-0/w UBIN        r     1 TIMEOUT
     7-0-0/w PTR         r     1 TO_USER$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w SBIN        r     1 MSG_421

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c CHAR(1600)  r     1 USER_BUF
PL6.E3A0      #005=GET_LINE File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:11 Page:94   


   Procedure GET_LINE requires 169 words for executable code.
   Procedure GET_LINE requires 14 words of local(AUTO) storage.
PL6.E3A0      #005=GET_LINE File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:11 Page:95   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #005=GET_LINE File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:11 Page:96   
          MINI XREF LISTING

ARS
       279**DCL         7--PROC      427<<ASSIGN
BUFL
       294**DCL       338<<ASSIGN    351>>IF        373<<ASSIGN
BUFLCN
       293**DCL       336>>IF        337<<ASSIGN
BUF_
       278**DCL         7--PROC      333>>ASSIGN    334>>ASSIGN
CB
       285**DCL       354<>CALL      361<>CALL
CB.ADMIN
       285**DCL       363>>IF
CB.ARS
       285**DCL       370<<ASSIGN    373>>ASSIGN
CB.READ_COMPLETE
       285**DCL       356>>IF
COPY_CHAR
       417**LABEL     387--GOTO
CRFLAG
       329**DCL       339<<ASSIGN    345>>IF        409>>IF        415<<ASSIGN    416<<ASSIGN    426>>IF
I
       295**DCL       351>>IF        372<<ASSIGN    385>>DOSELCT   406>>IF        410>>IF        412>>IF
       415>>IF        417>>ASSIGN    422<<ASSIGN    422>>ASSIGN
IP$WAIT
       291**DCL-ENT   355--CALL
LCN
       277**DCL         7--PROC      336>>IF        337>>ASSIGN    354<>CALL      361<>CALL
MAX_BYTES
       331**DCL       334<<ASSIGN    411<<ASSIGN    423>>IF        425>>IF
MSG_421
       288**DCL       357<>CALL
MYARS
PL6.E3A0      #005=GET_LINE File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:11 Page:97   
       330**DCL       344<<ASSIGN    347<<ASSIGN    365>>IF        417>>ASSIGN    418<<ASSIGN    418>>ASSIGN
       423>>IF        425<<ASSIGN    425>>ASSIGN    426<<ASSIGN    426>>ASSIGN    427>>ASSIGN
REMOTE_IAC
       281**DCL       340<<ASSIGN    368<<ASSIGN    382>>IF        384<<ASSIGN    407<<ASSIGN
REMOTE_OPTION
       282**DCL       341<<ASSIGN    369<<ASSIGN    391<<ASSIGN    398>>IF        400<<ASSIGN
RETALT
       366**LABEL     354--CALLALT   361--CALLALT
SEND_MSG
       287**DCL-ENT   357--CALL
SKIP_CHAR
       417**LABEL     413--GOTO
TCP$READ
       289**DCL-ENT   361--CALL
TCP$READ_NW
       290**DCL-ENT   354--CALL
TELNET_INBUF
       283**DCL       354--CALL      361--CALL      367<<ASSIGN    385>>DOSELCT   406>>IF        410>>IF
       412>>IF        415>>IF        417>>ASSIGN
TIMEOUT
       280**DCL         7--PROC      353--IF        353>>IF        355<>CALL
TO_USER$
       327**DCL       328--IMP-PTR   333<<ASSIGN    346>>ASSIGN    417>>ASSIGN
USER_BUF
       328**DCL       346<<ASSIGN    417<<ASSIGN
WRITE_LO.STATION_
       315**DCL       315--REDEF
WRITE_LO.V.DVBYTE.VFC#
       322**DCL       322--REDEF
PL6.E3A0      #005=GET_LINE File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:11 Page:98   
              *** CROSS REFERENCE LISTING ***
    **     DENOTES     IDENTIFIER DEFINITION
    <<                 IDENTIFIER'S VALUE SET
    >>                 IDENTIFIER'S VALUE USED
    <>                 IDENTIFIER SET AND/OR USED
    --                 IDENTIFIER REFERENCED
PL6.E3A0      #005=GET_LINE File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:11 Page:99   
              MINI UREF LISTING

GET_LINE       7**PROC
M$ACCT      34**DCL-ENT
M$ACTIVATE      37**DCL-ENT
M$ALIB      30**DCL-ENT
M$ASUSER      32**DCL-ENT
M$ATTACH      39**DCL-ENT
M$BADPP      57**DCL-ENT
M$CGCTL      38**DCL-ENT
M$CGINFO      38**DCL-ENT
M$CHECK      19**DCL-ENT
M$CHGUNIT      77**DCL-ENT
M$CLOSE      17**DCL-ENT
M$CLRSTK      75**DCL-ENT
M$CMDVAR      86**DCL-ENT
M$CONFIG      47**DCL-ENT
M$CORRES      22**DCL-ENT
M$CPEXIT      31**DCL-ENT
M$CVM      55**DCL-ENT
M$CVOL      20**DCL-ENT
M$DCLFLD      47**DCL-ENT
M$DEACTIVATE      37**DCL-ENT
M$DELREC      19**DCL-ENT
M$DEQ      84**DCL-ENT
M$DETACH      39**DCL-ENT
M$DEVICE      21**DCL-ENT
M$DISPLAY      84**DCL-ENT
M$DISPRES      24**DCL-ENT
M$DLIB      30**DCL-ENT
M$DRIBBLE      47**DCL-ENT
M$DRTN      75**DCL-ENT
M$DSUSER      32**DCL-ENT
M$ENQ      83**DCL-ENT
PL6.E3A0      #005=GET_LINE File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:11 Page:100  
M$EOM      42**DCL-ENT
M$ERASE      48**DCL-ENT
M$ERR      29**DCL-ENT
M$ERRMSG      80**DCL-ENT
M$EVENT      72**DCL-ENT
M$EXHUME      81**DCL-ENT
M$EXIT      29**DCL-ENT
M$EXTEND      21**DCL-ENT
M$FDP      53**DCL-ENT
M$FDS      52**DCL-ENT
M$FEBOOT      45**DCL-ENT
M$FECTL      46**DCL-ENT
M$FEDUMP      45**DCL-ENT
M$FID      80**DCL-ENT
M$FINDPROC      34**DCL-ENT
M$FSUSER      32**DCL-ENT
M$FVP      54**DCL-ENT
M$FWCG      38**DCL-ENT
M$GBPL      58**DCL-ENT
M$GDDL      54**DCL-ENT
M$GDP      53**DCL-ENT
M$GDS      52**DCL-ENT
M$GETDCB      23**DCL-ENT
M$GETMOUSE      63**DCL-ENT
M$GETPM      64**DCL-ENT
M$GJOB      82**DCL-ENT
M$GLINEATTR      42**DCL-ENT
M$GOODPP      57**DCL-ENT
M$GPLATEN      50**DCL-ENT
M$GPROMPT      49**DCL-ENT
M$GTRMATTR      43**DCL-ENT
M$GTRMCTL      41**DCL-ENT
M$GTRMTAB      44**DCL-ENT
M$GVP      53**DCL-ENT
M$HELP      80**DCL-ENT
M$INT      72**DCL-ENT
PL6.E3A0      #005=GET_LINE File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:11 Page:101  
M$INTRTN      33**DCL-ENT
M$IOQ      68**DCL-ENT
M$JOBSTATS      82**DCL-ENT
M$KEYIN      22**DCL-ENT
M$LDEV      17**DCL-ENT
M$LDTRC      30**DCL-ENT
M$LIMIT      23**DCL-ENT
M$LINES      22**DCL-ENT
M$LINK      29**DCL-ENT
M$MADMUCK      25**DCL-ENT
M$MAKUSER      56**DCL-ENT
M$MBS      24**DCL-ENT
M$MDFFLD      48**DCL-ENT
M$MERC      73**DCL-ENT
M$MERCS      74**DCL-ENT
M$MIRROR      68**DCL-ENT
M$MONINFO      85**DCL-ENT
M$MPL      58**DCL-ENT
M$NODEINFO      49**DCL-ENT
M$NXTUSR      83**DCL-ENT
M$OCMSG      81**DCL-ENT
M$OLAY      29**DCL-ENT
M$OPEN      17**DCL-ENT
M$PAS      58**DCL-ENT
M$PATHCON      81**DCL-ENT
M$PDS      52**DCL-ENT
M$PFIL      19**DCL-ENT
M$PLATEN      43**DCL-ENT
M$PRECORD      21**DCL-ENT
M$PROCNAME      34**DCL-ENT
M$PROFILE      45**DCL-ENT
M$PROMPT      41**DCL-ENT
M$RACST      25**DCL-ENT
M$RDSYSLOG      66**DCL-ENT
M$READ      18**DCL-ENT
M$RELDCB      23**DCL-ENT
PL6.E3A0      #005=GET_LINE File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:11 Page:102  
M$RELRES      24**DCL-ENT
M$RELSTARF      26**DCL-ENT
M$REM      26**DCL-ENT
M$RENV      73**DCL-ENT
M$REQUIRE      25**DCL-ENT
M$RETRY      74**DCL-ENT
M$RETRYS      74**DCL-ENT
M$REW      20**DCL-ENT
M$RLSFLD      48**DCL-ENT
M$RPRIV      76**DCL-ENT
M$RSPP      55**DCL-ENT
M$RSWITCH      77**DCL-ENT
M$RUE      83**DCL-ENT
M$SAD      56**DCL-ENT
M$SAVE      32**DCL-ENT
M$SCON      33**DCL-ENT
M$SCREECH      31**DCL-ENT
M$SENV      73**DCL-ENT
M$SETFMA      17**DCL-ENT
M$SETFP      46**DCL-ENT
M$SINPUT      44**DCL-ENT
M$SLCFLD      49**DCL-ENT
M$SMOUSE      63**DCL-ENT
M$SMPRT      55**DCL-ENT
M$SPRIV      76**DCL-ENT
M$SSC      56**DCL-ENT
M$SSWITCH      76**DCL-ENT
M$STATE      85**DCL-ENT
M$STD      57**DCL-ENT
M$STIMER      71**DCL-ENT
M$STLPP      54**DCL-ENT
M$STRAP      71**DCL-ENT
M$STRMATTR      43**DCL-ENT
M$STRMCTL      41**DCL-ENT
M$STRMTAB      44**DCL-ENT
M$SYMBIO      82**DCL-ENT
PL6.E3A0      #005=GET_LINE File=TCF$FTPD.:TCA2TSI                               SUN 11/16/97 14:11 Page:103  
M$SYSCON      68**DCL-ENT
M$SYSID      86**DCL-ENT
M$TDCLOSE      67**DCL-ENT
M$TDIO      67**DCL-ENT
M$TDOPEN      66**DCL-ENT
M$TDREQCPU      67**DCL-ENT
M$TEMPWROC      61**DCL-ENT
M$TIME      84**DCL-ENT
M$TRAP      71**DCL-ENT
M$TRMISC      46**DCL-ENT
M$TRMPRG      42**DCL-ENT
M$TRTN      75**DCL-ENT
M$TRUNC      18**DCL-ENT
M$TTIMER      71**DCL-ENT
M$UC      41**DCL
M$UMPL      58**DCL-ENT
M$UNFID      80**DCL-ENT
M$UNLATCH      37**DCL-ENT
M$UNSHARE      34**DCL-ENT
M$USRFIELD      77**DCL-ENT
M$VIRTUAL      52**DCL-ENT
M$WAIT      75**DCL-ENT
M$WEOF      20**DCL-ENT
M$WRITE      18**DCL-ENT
M$WRSYSLOG      66**DCL-ENT
M$XCON      72**DCL-ENT
M$XCONRTN      33**DCL-ENT
M$XEQTIME      85**DCL-ENT
M$XFLUSH      26**DCL-ENT
M$XMOUSE      63**DCL-ENT
M$XXX      29**DCL-ENT
M$YC      31**DCL-ENT
REMOTE_ADMIN     292**DCL-ENT
TCP_ERR_CODE     125**DCL
TCP_MON_ERR     125**DCL

PL6.E3A0      #006=REMOTE_ADMIN File=TCF$FTPD.:TCA2TSI                           SUN 11/16/97 14:12 Page:104  
      313        1        /*T***********************************************************/
      314        2        /*T*                                                         */
      315        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      316        4        /*T*                                                         */
      317        5        /*T***********************************************************/
      318        6        REMOTE_ADMIN: PROC(BUF$);
      319        7    1   DCL BUF$ PTR;
      320        8        %INCLUDE CP_6;
      321       89        %INCLUDE TCP_HEP_M;
      322      144        %INCLUDE TCP_HEP_E;
      323      221        %INCLUDE TCT_TELNET_E;
      324      276
      325      277        %TCP$ADMIN (STCLASS="BASED(BUF$)");
      326      298    1   DCL BLANK_LINE CHAR(1) CONSTANT INIT(' ');
      327      299        %VLP_NAME (FPTN=NAME, L=32, STCLASS=STATIC);
      328      326        %FPT_WRITE (FPTN=WRITE_LO, STCLASS=SYMREF);
      329      357    1   DCL MSG_RESET CHAR(0) CONSTANT INIT('Connection Reset');
      330      358    1   DCL MSG_EST CHAR(0) CONSTANT INIT('Connection Established');
      331      359    1   DCL MSG_CLOSED CHAR(0) CONSTANT INIT('Connection Closed');
      332      360    1   DCL MSG_CLOSING CHAR(0) CONSTANT INIT('Connection Closing');
      333      361    1   DCL MSG_CLOSED_REMOTE CHAR(0) CONSTANT INIT('Connection Closed by Remote Host');
      334      362    1   DCL MSG_LISTEN_RESPONSE CHAR(0) CONSTANT INIT('Listen Response');
      335      363    1   DCL LINK_UP BIT(1) SYMREF;
      336      364    1   DCL NET$ADDR2IP ENTRY(2);
      337      365
      338      366    1      WRITE_LO.BUF_ = VECTOR(BLANK_LINE);
      339      367    1      CALL M$WRITE (WRITE_LO);
      340      368    2      DO SELECT (TCP$ADMIN.CMD);
      341      369
      342      370    2          SELECT(%TCP_ADMINMSG_RESET);
      343      371    2          WRITE_LO.BUF_ = VECTOR(MSG_RESET);
      344      372    2          LINK_UP='0'B;
      345      373
      346      374    2          SELECT (%TCP_ADMINMSG_ESTABLISHED);
      347      375    2          WRITE_LO.BUF_ = VECTOR(MSG_EST);
      348      376
      349      377    2          SELECT (%TCP_ADMINMSG_CLOSING);
PL6.E3A0      #006=REMOTE_ADMIN File=TCF$FTPD.:TCA2TSI                           SUN 11/16/97 14:12 Page:105  
      350      378    2          WRITE_LO.BUF_ = VECTOR(MSG_CLOSING);
      351      379    2          LINK_UP='0'B;
      352      380
      353      381    2          SELECT (%TCP_ADMINMSG_CLOSE_WAIT);
      354      382    2          WRITE_LO.BUF_ = VECTOR(MSG_CLOSED_REMOTE);
      355      383    2          LINK_UP='0'B;
      356      384
      357      385    2          SELECT(%TCP_ADMINMSG_LISTEN_RESPONSE);
      358      386    2          WRITE_LO.BUF_ = VECTOR(MSG_LISTEN_RESPONSE);
      359      387    2          CALL M$WRITE (WRITE_LO);
      360      388    2          CALL NET$ADDR2IP(NAME,TCP$ADMIN.FS);
      361      389    2          WRITE_LO.BUF_ = VECTOR(NAME.NAME#);
      362      390    2          SELECT(%TCP_ADMINMSG_CLOSED);
      363      391    2          WRITE_LO.BUF_ = VECTOR(MSG_CLOSED);
      364      392    2          LINK_UP='0'B;
      365      393    2          SELECT (ELSE);
      366      394    2      CALL M$XXX;
      367      395
      368      396    2          END;
      369      397
      370      398
      371      399    1      CALL M$WRITE (WRITE_LO);
      372      400
      373      401    1   END REMOTE_ADMIN;
      374      402
      375      403        %EOD;

PL6.E3A0      #006=REMOTE_ADMIN File=TCF$FTPD.:TCA2TSI                           SUN 11/16/97 14:12 Page:106  
--  Include file information  --

   TCT_TELNET_E.:TCA2TOU  is referenced.
   TCP_HEP_E.:TCA2TOU  is referenced.
   TCP_HEP_M.:TCA2TOU  cannot be made into a system file and is referenced.
   CP_6.:LIBRARY  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure REMOTE_ADMIN.

   Procedure REMOTE_ADMIN requires 72 words for executable code.
   Procedure REMOTE_ADMIN requires 6 words of local(AUTO) storage.

PL6.E3A0      #006=REMOTE_ADMIN File=TCF$FTPD.:TCA2TSI                           SUN 11/16/97 14:12 Page:107  

 Object Unit name= REMOTE_ADMIN                               File name= TCF$FTPD.:TCA2TOU
 UTS= NOV 16 '97 14:12:03.68 SUN                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1  RoData even  UTS     33     41  REMOTE_ADMIN
    2   Data  even  none     8     10  REMOTE_ADMIN
    3   Proc  even  none    72    110  REMOTE_ADMIN
    4  RoData even  none    18     22  REMOTE_ADMIN

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     3      0   yes            yes      Std        1  REMOTE_ADMIN

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       2 NET$ADDR2IP
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
PL6.E3A0      #006=REMOTE_ADMIN File=TCF$FTPD.:TCA2TSI                           SUN 11/16/97 14:12 Page:108  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  WRITE_LO                              LINK_UP
     B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #006=REMOTE_ADMIN File=TCF$FTPD.:TCA2TSI                           SUN 11/16/97 14:12 Page:109  


      313        1        /*T***********************************************************/
      314        2        /*T*                                                         */
      315        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      316        4        /*T*                                                         */
      317        5        /*T***********************************************************/
      318        6        REMOTE_ADMIN: PROC(BUF$);

      6  3 000000   000000 700200 xent  REMOTE_ADMIN TSX0  ! X66_AUTO_1
         3 000001   000006 000001                    ZERO    6,1

      319        7    1   DCL BUF$ PTR;
      320        8        %INCLUDE CP_6;
      321       89        %INCLUDE TCP_HEP_M;
      322      144        %INCLUDE TCP_HEP_E;
      323      221        %INCLUDE TCT_TELNET_E;
      324      276
      325      277        %TCP$ADMIN (STCLASS="BASED(BUF$)");
      326      298    1   DCL BLANK_LINE CHAR(1) CONSTANT INIT(' ');
      327      299        %VLP_NAME (FPTN=NAME, L=32, STCLASS=STATIC);
      328      326        %FPT_WRITE (FPTN=WRITE_LO, STCLASS=SYMREF);
      329      357    1   DCL MSG_RESET CHAR(0) CONSTANT INIT('Connection Reset');
      330      358    1   DCL MSG_EST CHAR(0) CONSTANT INIT('Connection Established');
      331      359    1   DCL MSG_CLOSED CHAR(0) CONSTANT INIT('Connection Closed');
      332      360    1   DCL MSG_CLOSING CHAR(0) CONSTANT INIT('Connection Closing');
      333      361    1   DCL MSG_CLOSED_REMOTE CHAR(0) CONSTANT INIT('Connection Closed by Remote Host');
      334      362    1   DCL MSG_LISTEN_RESPONSE CHAR(0) CONSTANT INIT('Listen Response');
      335      363    1   DCL LINK_UP BIT(1) SYMREF;
      336      364    1   DCL NET$ADDR2IP ENTRY(2);
      337      365
      338      366    1      WRITE_LO.BUF_ = VECTOR(BLANK_LINE);

    366  3 000002   000000 237000 4                  LDAQ    0
         3 000003   000004 757000 xsym               STAQ    WRITE_LO+4

      339      367    1      CALL M$WRITE (WRITE_LO);

PL6.E3A0      #006=REMOTE_ADMIN File=TCF$FTPD.:TCA2TSI                           SUN 11/16/97 14:12 Page:110  
    367  3 000004   000000 630400 xsym               EPPR0   WRITE_LO
         3 000005   040001 713400                    CLIMB   write
         3 000006   401400 401760                    pmme    nvectors=4

      340      368    2      DO SELECT (TCP$ADMIN.CMD);

    368  3 000007   200003 470500                    LDP0    @BUF$,,AUTO
         3 000010   000000 471500                    LDP1    0,,PR0
         3 000011   100000 236100                    LDQ     0,,PR1
         3 000012   000003 116007                    CMPQ    3,DL
         3 000013   000026 602000 3                  TNC     s:368+15
         3 000014   000041 600000 3                  TZE     s:375
         3 000015   000006 116007                    CMPQ    6,DL
         3 000016   000023 602000 3                  TNC     s:368+12
         3 000017   000050 600000 3                  TZE     s:382
         3 000020   000007 116007                    CMPQ    7,DL
         3 000021   000102 601000 3                  TNZ     s:394
         3 000022   000076 710000 3                  TRA     s:391
         3 000023   000005 116007                    CMPQ    5,DL
         3 000024   000102 601000 3                  TNZ     s:394
         3 000025   000044 710000 3                  TRA     s:378
         3 000026   000002 116007                    CMPQ    2,DL
         3 000027   000032 602000 3                  TNC     s:368+19
         3 000030   000035 600000 3                  TZE     s:371
         3 000031   000102 710000 3                  TRA     s:394
         3 000032   000001 116007                    CMPQ    1,DL
         3 000033   000102 601000 3                  TNZ     s:394
         3 000034   000054 710000 3                  TRA     s:386

      341      369
      342      370    2          SELECT(%TCP_ADMINMSG_RESET);

      343      371    2          WRITE_LO.BUF_ = VECTOR(MSG_RESET);

    371  3 000035   000002 237000 4                  LDAQ    2
         3 000036   000004 757000 xsym               STAQ    WRITE_LO+4

PL6.E3A0      #006=REMOTE_ADMIN File=TCF$FTPD.:TCA2TSI                           SUN 11/16/97 14:12 Page:111  
      344      372    2          LINK_UP='0'B;

    372  3 000037   000000 450000 xsym               STZ     LINK_UP
         3 000040   000104 710000 3                  TRA     s:399

      345      373
      346      374    2          SELECT (%TCP_ADMINMSG_ESTABLISHED);

      347      375    2          WRITE_LO.BUF_ = VECTOR(MSG_EST);

    375  3 000041   000004 237000 4                  LDAQ    4
         3 000042   000004 757000 xsym               STAQ    WRITE_LO+4
         3 000043   000104 710000 3                  TRA     s:399

      348      376
      349      377    2          SELECT (%TCP_ADMINMSG_CLOSING);

      350      378    2          WRITE_LO.BUF_ = VECTOR(MSG_CLOSING);

    378  3 000044   000006 237000 4                  LDAQ    6
         3 000045   000004 757000 xsym               STAQ    WRITE_LO+4

      351      379    2          LINK_UP='0'B;

    379  3 000046   000000 450000 xsym               STZ     LINK_UP
         3 000047   000104 710000 3                  TRA     s:399

      352      380
      353      381    2          SELECT (%TCP_ADMINMSG_CLOSE_WAIT);

      354      382    2          WRITE_LO.BUF_ = VECTOR(MSG_CLOSED_REMOTE);

    382  3 000050   000010 237000 4                  LDAQ    8
         3 000051   000004 757000 xsym               STAQ    WRITE_LO+4

      355      383    2          LINK_UP='0'B;

PL6.E3A0      #006=REMOTE_ADMIN File=TCF$FTPD.:TCA2TSI                           SUN 11/16/97 14:12 Page:112  
    383  3 000052   000000 450000 xsym               STZ     LINK_UP
         3 000053   000104 710000 3                  TRA     s:399

      356      384
      357      385    2          SELECT(%TCP_ADMINMSG_LISTEN_RESPONSE);

      358      386    2          WRITE_LO.BUF_ = VECTOR(MSG_LISTEN_RESPONSE);

    386  3 000054   000012 237000 4                  LDAQ    10
         3 000055   000004 757000 xsym               STAQ    WRITE_LO+4

      359      387    2          CALL M$WRITE (WRITE_LO);

    387  3 000056   000000 630400 xsym               EPPR0   WRITE_LO
         3 000057   040001 713400                    CLIMB   write
         3 000060   401400 401760                    pmme    nvectors=4

      360      388    2          CALL NET$ADDR2IP(NAME,TCP$ADMIN.FS);

    388  3 000061   200003 470500                    LDP0    @BUF$,,AUTO
         3 000062   000000 471500                    LDP1    0,,PR0
         3 000063   100012 633500                    EPPR3   10,,PR1
         3 000064   200005 453500                    STP3    @BUF$+2,,AUTO
         3 000065   000014 236000 4                  LDQ     12
         3 000066   200004 756100                    STQ     @BUF$+1,,AUTO
         3 000067   200004 630500                    EPPR0   @BUF$+1,,AUTO
         3 000070   000020 631400 xsym               EPPR1   B_VECTNIL+16
         3 000071   000000 701000 xent               TSX1    NET$ADDR2IP
         3 000072   000000 011000                    NOP     0

      361      389    2          WRITE_LO.BUF_ = VECTOR(NAME.NAME#);

    389  3 000073   000016 237000 4                  LDAQ    14
         3 000074   000004 757000 xsym               STAQ    WRITE_LO+4
         3 000075   000104 710000 3                  TRA     s:399

      362      390    2          SELECT(%TCP_ADMINMSG_CLOSED);
PL6.E3A0      #006=REMOTE_ADMIN File=TCF$FTPD.:TCA2TSI                           SUN 11/16/97 14:12 Page:113  

      363      391    2          WRITE_LO.BUF_ = VECTOR(MSG_CLOSED);

    391  3 000076   000020 237000 4                  LDAQ    16
         3 000077   000004 757000 xsym               STAQ    WRITE_LO+4

      364      392    2          LINK_UP='0'B;

    392  3 000100   000000 450000 xsym               STZ     LINK_UP
         3 000101   000104 710000 3                  TRA     s:399

      365      393    2          SELECT (ELSE);

      366      394    2      CALL M$XXX;

    394  3 000102   000003 713400                    CLIMB   3
         3 000103   000000 401760                    pmme    nvectors=0

      367      395
      368      396    2          END;

      369      397
      370      398
      371      399    1      CALL M$WRITE (WRITE_LO);

    399  3 000104   000000 630400 xsym               EPPR0   WRITE_LO
         3 000105   040001 713400                    CLIMB   write
         3 000106   401400 401760                    pmme    nvectors=4

      372      400
      373      401    1   END REMOTE_ADMIN;

    401  3 000107   000000 702200 xent               TSX2  ! X66_ARET

BLANK_LINE
 Sect OctLoc
   1     000   040*** ******                                                     ...
PL6.E3A0      #006=REMOTE_ADMIN File=TCF$FTPD.:TCA2TSI                           SUN 11/16/97 14:12 Page:114  

MSG_RESET
 Sect OctLoc
   1     001   103157 156156   145143 164151   157156 040122   145163 145164    Connection Reset

MSG_EST
 Sect OctLoc
   1     005   103157 156156   145143 164151   157156 040105   163164 141142    Connection Estab
   1     011   154151 163150   145144 ******                                    lished..

MSG_CLOSED
 Sect OctLoc
   1     013   103157 156156   145143 164151   157156 040103   154157 163145    Connection Close
   1     017   144*** ******                                                    d...

MSG_CLOSING
 Sect OctLoc
   1     020   103157 156156   145143 164151   157156 040103   154157 163151    Connection Closi
   1     024   156147 ******                                                    ng..

MSG_CLOSED_REMOTE
 Sect OctLoc
   1     025   103157 156156   145143 164151   157156 040103   154157 163145    Connection Close
   1     031   144040 142171   040122 145155   157164 145040   110157 163164    d by Remote Host

MSG_LISTEN_RESPONSE
 Sect OctLoc
   1     035   114151 163164   145156 040122   145163 160157   156163 145***    Listen Response.

NAME
 Sect OctLoc
   2     000   040040 040040   040040 040040   040040 040040   040040 040040
   2     004   040040 040040   040040 040040   040040 040040   040040 040040

(unnamed)
 Sect OctLoc
   4     000   000000 177640   000000 006000   000003 777640   000001 006000    ................
PL6.E3A0      #006=REMOTE_ADMIN File=TCF$FTPD.:TCA2TSI                           SUN 11/16/97 14:12 Page:115  
   4     004   000005 377640   000005 006000   000004 377640   000020 006000    ................
   4     010   000007 777640   000025 006000   000003 577640   000035 006000    ................
   4     014   000000 006000   000000 000000   000007 577640   000000 206000    ................
   4     020   000004 177640   000013 006000                                    ........
      374      402
      375      403        %EOD;

PL6.E3A0      #006=REMOTE_ADMIN File=TCF$FTPD.:TCA2TSI                           SUN 11/16/97 14:12 Page:116  
--  Include file information  --

   TCT_TELNET_E.:TCA2TOU  is referenced.
   TCP_HEP_E.:TCA2TOU  is referenced.
   TCP_HEP_M.:TCA2TOU  cannot be made into a system file and is referenced.
   CP_6.:LIBRARY  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure REMOTE_ADMIN.
PL6.E3A0      #006=REMOTE_ADMIN File=TCF$FTPD.:TCA2TSI                           SUN 11/16/97 14:12 Page:117  

 **** Variables and constants ****

  ****  Section 001 RoData REMOTE_ADMIN

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c CHAR        r     1 BLANK_LINE                13-0-0/c CHAR(17)    r     1 MSG_CLOSED
    25-0-0/c CHAR(32)    r     1 MSG_CLOSED_REMOTE         20-0-0/c CHAR(18)    r     1 MSG_CLOSING
     5-0-0/c CHAR(22)    r     1 MSG_EST                   35-0-0/c CHAR(15)    r     1 MSG_LISTEN_RESPONSE
     1-0-0/c CHAR(16)    r     1 MSG_RESET

  ****  Section 002  Data  REMOTE_ADMIN

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c STRC(288)   r     1 NAME

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @BUF$                     *0-0-0/w PTR         r     1 BUF$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/b BIT         r     1 LINK_UP                    0-0-0/d STRC(432)   r     1 WRITE_LO

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name
PL6.E3A0      #006=REMOTE_ADMIN File=TCF$FTPD.:TCA2TSI                           SUN 11/16/97 14:12 Page:118  

     0-0-0/w STRC(432)   r     1 TCP$ADMIN


   Procedure REMOTE_ADMIN requires 72 words for executable code.
   Procedure REMOTE_ADMIN requires 6 words of local(AUTO) storage.
PL6.E3A0      #006=REMOTE_ADMIN File=TCF$FTPD.:TCA2TSI                           SUN 11/16/97 14:12 Page:119  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #006=REMOTE_ADMIN File=TCF$FTPD.:TCA2TSI                           SUN 11/16/97 14:12 Page:120  
          MINI XREF LISTING

BLANK_LINE
       298**DCL       366--ASSIGN
BUF$
         7**DCL         6--PROC      278--IMP-PTR   368>>DOSELCT   388>>CALL
LINK_UP
       363**DCL       372<<ASSIGN    379<<ASSIGN    383<<ASSIGN    392<<ASSIGN
M$WRITE
        18**DCL-ENT   367--CALL      387--CALL      399--CALL
M$XXX
        29**DCL-ENT   394--CALL
MSG_CLOSED
       359**DCL       391--ASSIGN
MSG_CLOSED_REMOTE
       361**DCL       382--ASSIGN
MSG_CLOSING
       360**DCL       378--ASSIGN
MSG_EST
       358**DCL       375--ASSIGN
MSG_LISTEN_RESPONSE
       362**DCL       386--ASSIGN
MSG_RESET
       357**DCL       371--ASSIGN
NAME
       324**DCL       388<>CALL
NAME.NAME#
       324**DCL       389--ASSIGN
NET$ADDR2IP
       364**DCL-ENT   388--CALL
TCP$ADMIN.CMD
       278**DCL       368>>DOSELCT
TCP$ADMIN.FS
       293**DCL       388<>CALL
PL6.E3A0      #006=REMOTE_ADMIN File=TCF$FTPD.:TCA2TSI                           SUN 11/16/97 14:12 Page:121  
TCP$ADMIN.GHST_LCN
       279**DCL       279--REDEF
TCP$ADMIN.USER_LCN
       278**DCL       279--REDEF
WRITE_LO
       343**DCL       367<>CALL      387<>CALL      399<>CALL
WRITE_LO.BUF_
       343**DCL       366<<ASSIGN    371<<ASSIGN    375<<ASSIGN    378<<ASSIGN    382<<ASSIGN    386<<ASSIGN
       389<<ASSIGN    391<<ASSIGN
WRITE_LO.STATION_
       345**DCL       345--REDEF
WRITE_LO.V.DVBYTE.VFC#
       352**DCL       352--REDEF
PL6.E3A0      #006=REMOTE_ADMIN File=TCF$FTPD.:TCA2TSI                           SUN 11/16/97 14:12 Page:122  
              *** CROSS REFERENCE LISTING ***
    **     DENOTES     IDENTIFIER DEFINITION
    <<                 IDENTIFIER'S VALUE SET
    >>                 IDENTIFIER'S VALUE USED
    <>                 IDENTIFIER SET AND/OR USED
    --                 IDENTIFIER REFERENCED
PL6.E3A0      #006=REMOTE_ADMIN File=TCF$FTPD.:TCA2TSI                           SUN 11/16/97 14:12 Page:123  
              MINI UREF LISTING

M$ACCT      34**DCL-ENT
M$ACTIVATE      37**DCL-ENT
M$ALIB      30**DCL-ENT
M$ASUSER      32**DCL-ENT
M$ATTACH      39**DCL-ENT
M$BADPP      57**DCL-ENT
M$CGCTL      38**DCL-ENT
M$CGINFO      38**DCL-ENT
M$CHECK      19**DCL-ENT
M$CHGUNIT      77**DCL-ENT
M$CLOSE      17**DCL-ENT
M$CLRSTK      75**DCL-ENT
M$CMDVAR      86**DCL-ENT
M$CONFIG      47**DCL-ENT
M$CORRES      22**DCL-ENT
M$CPEXIT      31**DCL-ENT
M$CVM      55**DCL-ENT
M$CVOL      20**DCL-ENT
M$DCLFLD      47**DCL-ENT
M$DEACTIVATE      37**DCL-ENT
M$DELREC      19**DCL-ENT
M$DEQ      84**DCL-ENT
M$DETACH      39**DCL-ENT
M$DEVICE      21**DCL-ENT
M$DISPLAY      84**DCL-ENT
M$DISPRES      24**DCL-ENT
M$DLIB      30**DCL-ENT
M$DRIBBLE      47**DCL-ENT
M$DRTN      75**DCL-ENT
M$DSUSER      32**DCL-ENT
M$ENQ      83**DCL-ENT
M$EOM      42**DCL-ENT
PL6.E3A0      #006=REMOTE_ADMIN File=TCF$FTPD.:TCA2TSI                           SUN 11/16/97 14:12 Page:124  
M$ERASE      48**DCL-ENT
M$ERR      29**DCL-ENT
M$ERRMSG      80**DCL-ENT
M$EVENT      72**DCL-ENT
M$EXHUME      81**DCL-ENT
M$EXIT      29**DCL-ENT
M$EXTEND      21**DCL-ENT
M$FDP      53**DCL-ENT
M$FDS      52**DCL-ENT
M$FEBOOT      45**DCL-ENT
M$FECTL      46**DCL-ENT
M$FEDUMP      45**DCL-ENT
M$FID      80**DCL-ENT
M$FINDPROC      34**DCL-ENT
M$FSUSER      32**DCL-ENT
M$FVP      54**DCL-ENT
M$FWCG      38**DCL-ENT
M$GBPL      58**DCL-ENT
M$GDDL      54**DCL-ENT
M$GDP      53**DCL-ENT
M$GDS      52**DCL-ENT
M$GETDCB      23**DCL-ENT
M$GETMOUSE      63**DCL-ENT
M$GETPM      64**DCL-ENT
M$GJOB      82**DCL-ENT
M$GLINEATTR      42**DCL-ENT
M$GOODPP      57**DCL-ENT
M$GPLATEN      50**DCL-ENT
M$GPROMPT      49**DCL-ENT
M$GTRMATTR      43**DCL-ENT
M$GTRMCTL      41**DCL-ENT
M$GTRMTAB      44**DCL-ENT
M$GVP      53**DCL-ENT
M$HELP      80**DCL-ENT
M$INT      72**DCL-ENT
M$INTRTN      33**DCL-ENT
PL6.E3A0      #006=REMOTE_ADMIN File=TCF$FTPD.:TCA2TSI                           SUN 11/16/97 14:12 Page:125  
M$IOQ      68**DCL-ENT
M$JOBSTATS      82**DCL-ENT
M$KEYIN      22**DCL-ENT
M$LDEV      17**DCL-ENT
M$LDTRC      30**DCL-ENT
M$LIMIT      23**DCL-ENT
M$LINES      22**DCL-ENT
M$LINK      29**DCL-ENT
M$MADMUCK      25**DCL-ENT
M$MAKUSER      56**DCL-ENT
M$MBS      24**DCL-ENT
M$MDFFLD      48**DCL-ENT
M$MERC      73**DCL-ENT
M$MERCS      74**DCL-ENT
M$MIRROR      68**DCL-ENT
M$MONINFO      85**DCL-ENT
M$MPL      58**DCL-ENT
M$NODEINFO      49**DCL-ENT
M$NXTUSR      83**DCL-ENT
M$OCMSG      81**DCL-ENT
M$OLAY      29**DCL-ENT
M$OPEN      17**DCL-ENT
M$PAS      58**DCL-ENT
M$PATHCON      81**DCL-ENT
M$PDS      52**DCL-ENT
M$PFIL      19**DCL-ENT
M$PLATEN      43**DCL-ENT
M$PRECORD      21**DCL-ENT
M$PROCNAME      34**DCL-ENT
M$PROFILE      45**DCL-ENT
M$PROMPT      41**DCL-ENT
M$RACST      25**DCL-ENT
M$RDSYSLOG      66**DCL-ENT
M$READ      18**DCL-ENT
M$RELDCB      23**DCL-ENT
M$RELRES      24**DCL-ENT
PL6.E3A0      #006=REMOTE_ADMIN File=TCF$FTPD.:TCA2TSI                           SUN 11/16/97 14:12 Page:126  
M$RELSTARF      26**DCL-ENT
M$REM      26**DCL-ENT
M$RENV      73**DCL-ENT
M$REQUIRE      25**DCL-ENT
M$RETRY      74**DCL-ENT
M$RETRYS      74**DCL-ENT
M$REW      20**DCL-ENT
M$RLSFLD      48**DCL-ENT
M$RPRIV      76**DCL-ENT
M$RSPP      55**DCL-ENT
M$RSWITCH      77**DCL-ENT
M$RUE      83**DCL-ENT
M$SAD      56**DCL-ENT
M$SAVE      32**DCL-ENT
M$SCON      33**DCL-ENT
M$SCREECH      31**DCL-ENT
M$SENV      73**DCL-ENT
M$SETFMA      17**DCL-ENT
M$SETFP      46**DCL-ENT
M$SINPUT      44**DCL-ENT
M$SLCFLD      49**DCL-ENT
M$SMOUSE      63**DCL-ENT
M$SMPRT      55**DCL-ENT
M$SPRIV      76**DCL-ENT
M$SSC      56**DCL-ENT
M$SSWITCH      76**DCL-ENT
M$STATE      85**DCL-ENT
M$STD      57**DCL-ENT
M$STIMER      71**DCL-ENT
M$STLPP      54**DCL-ENT
M$STRAP      71**DCL-ENT
M$STRMATTR      43**DCL-ENT
M$STRMCTL      41**DCL-ENT
M$STRMTAB      44**DCL-ENT
M$SYMBIO      82**DCL-ENT
M$SYSCON      68**DCL-ENT
PL6.E3A0      #006=REMOTE_ADMIN File=TCF$FTPD.:TCA2TSI                           SUN 11/16/97 14:12 Page:127  
M$SYSID      86**DCL-ENT
M$TDCLOSE      67**DCL-ENT
M$TDIO      67**DCL-ENT
M$TDOPEN      66**DCL-ENT
M$TDREQCPU      67**DCL-ENT
M$TEMPWROC      61**DCL-ENT
M$TIME      84**DCL-ENT
M$TRAP      71**DCL-ENT
M$TRMISC      46**DCL-ENT
M$TRMPRG      42**DCL-ENT
M$TRTN      75**DCL-ENT
M$TRUNC      18**DCL-ENT
M$TTIMER      71**DCL-ENT
M$UC      41**DCL
M$UMPL      58**DCL-ENT
M$UNFID      80**DCL-ENT
M$UNLATCH      37**DCL-ENT
M$UNSHARE      34**DCL-ENT
M$USRFIELD      77**DCL-ENT
M$VIRTUAL      52**DCL-ENT
M$WAIT      75**DCL-ENT
M$WEOF      20**DCL-ENT
M$WRSYSLOG      66**DCL-ENT
M$XCON      72**DCL-ENT
M$XCONRTN      33**DCL-ENT
M$XEQTIME      85**DCL-ENT
M$XFLUSH      26**DCL-ENT
M$XMOUSE      63**DCL-ENT
M$YC      31**DCL-ENT
REMOTE_ADMIN       6**PROC
TCP_ERR_CODE     125**DCL
TCP_MON_ERR     125**DCL

PL6.E3A0      #007=TCP$WRITE_D File=TCF$FTPD.:TCA2TSI                            SUN 11/16/97 14:12 Page:128  
      376        1        /*T***********************************************************/
      377        2        /*T*                                                         */
      378        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      379        4        /*T*                                                         */
      380        5        /*T***********************************************************/
      381        6        /* Diagnostic write, also write buffer to user */
      382        7        TCP$WRITE_D: PROC (LCN, BUF_, PUSH, URGENT) ALTRET;
      383        8
      384        9    1   DCL LCN UBIN(36);
      385       10    1   DCL BUF_ VECTOR;
      386       11    1   DCL PUSH BIT(1) UNAL;
      387       12    1   DCL URGENT BIT(1) UNAL;
      388       13
      389       14        %INCLUDE CP_6;
      390       95        %FPT_WRITE (FPTN=WRITE_LO, STCLASS=SYMREF);
      391      126    1   DCL DOBUF CHAR(140) STATIC INIT('  ->');
      392      127    1   DCL DONDX SBIN STATIC INIT(4);
      393      128    1   DCL 1 CRLF CONSTANT SYMDEF,
      394      129    1             2 * CHAR(1) INIT (BINASC(13)),
      395      130    1             2 * CHAR(1) INIT (BINASC(10));
      396      131    1   DCL CHARN CHAR(CHARNLEN) BASED;
      397      132    1   DCL CHARNLEN UBIN(36) STATIC;
      398      133
      399      134    1   DCL DEBUG BIT(36) STATIC SYMDEF INIT('1'O);
      400      135    1   DCL TCP$WRITE ENTRY(4) ALTRET;
      401      136
      402      137
      403      138    2      IF DEBUG THEN DO;
      404      139    2          CHARNLEN = VBOUND(BUF_)+1;
      405      140    2          SUBSTR (DOBUF, DONDX, CHARNLEN) = VBASE(BUF_)->CHARN;
      406      141    2          DONDX = DONDX+CHARNLEN;
      407      142    2          END;
      408      143
      409      144    2      CALL TCP$WRITE(LCN,BUF_,PUSH,URGENT) WHENALTRETURN DO;
      410      145    2          ALTRETURN;
      411      146    2          END;
      412      147    1      RETURN;
PL6.E3A0      #007=TCP$WRITE_D File=TCF$FTPD.:TCA2TSI                            SUN 11/16/97 14:12 Page:129  
      413      148
      414      149    1   TELNET_EOL: ENTRY (LCN) ALTRET;
      415      150
      416      151    2      IF DEBUG AND DONDX > 4 THEN DO;
      417      152    2          WRITE_LO.BUF_ = VECTOR(SUBSTR(DOBUF,0,DONDX));
      418      153    2          CALL M$WRITE (WRITE_LO);
      419      154    2          DONDX = 4;
      420      155    2          END;
      421      156    1      CALL TCP$WRITE (LCN, VECTOR(CRLF), '1'B/*Push*/ );
      422      157    1      RETURN;
      423      158    1   END TCP$WRITE_D;
      424      159

PL6.E3A0      #007=TCP$WRITE_D File=TCF$FTPD.:TCA2TSI                            SUN 11/16/97 14:12 Page:130  
--  Include file information  --

   CP_6.:LIBRARY  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure TCP$WRITE_D.

   Procedure TCP$WRITE_D requires 52 words for executable code.
   Procedure TCP$WRITE_D requires 12 words of local(AUTO) storage.

    No errors detected in file TCF$FTPD.:TCA2TSI    .

PL6.E3A0      #007=TCP$WRITE_D File=TCF$FTPD.:TCA2TSI                            SUN 11/16/97 14:12 Page:131  

 Object Unit name= TCP$WRITE_D                                File name= TCF$FTPD.:TCA2TOU
 UTS= NOV 16 '97 14:12:40.56 SUN                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   Data  even  none    38     46  TCP$WRITE_D
    2  RoData even  UTS      1      1  TCP$WRITE_D
    3   Proc  even  none    52     64  TCP$WRITE_D
    4  RoData even  none     6      6  TCP$WRITE_D

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     3      0   yes    yes     yes      Std        4  TCP$WRITE_D
     3     31          yes     yes      Std        1  TELNET_EOL

  ****  Data defs  ****

 Sect OctLoc  Name                           Sect OctLoc  Name
    2      0  CRLF                               1     45  DEBUG

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       4 TCP$WRITE
                       nStd      0 X66_AUTO_4
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AALT
                       nStd      0 X66_ARET
PL6.E3A0      #007=TCP$WRITE_D File=TCF$FTPD.:TCA2TSI                            SUN 11/16/97 14:12 Page:132  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  WRITE_LO                              B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #007=TCP$WRITE_D File=TCF$FTPD.:TCA2TSI                            SUN 11/16/97 14:12 Page:133  


      376        1        /*T***********************************************************/
      377        2        /*T*                                                         */
      378        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      379        4        /*T*                                                         */
      380        5        /*T***********************************************************/
      381        6        /* Diagnostic write, also write buffer to user */
      382        7        TCP$WRITE_D: PROC (LCN, BUF_, PUSH, URGENT) ALTRET;

      7  3 000000   000000 700200 xent  TCP$WRITE_D  TSX0  ! X66_AUTO_4
         3 000001   000014 000004                    ZERO    12,4

      383        8
      384        9    1   DCL LCN UBIN(36);
      385       10    1   DCL BUF_ VECTOR;
      386       11    1   DCL PUSH BIT(1) UNAL;
      387       12    1   DCL URGENT BIT(1) UNAL;
      388       13
      389       14        %INCLUDE CP_6;
      390       95        %FPT_WRITE (FPTN=WRITE_LO, STCLASS=SYMREF);
      391      126    1   DCL DOBUF CHAR(140) STATIC INIT('  ->');
      392      127    1   DCL DONDX SBIN STATIC INIT(4);
      393      128    1   DCL 1 CRLF CONSTANT SYMDEF,
      394      129    1             2 * CHAR(1) INIT (BINASC(13)),
      395      130    1             2 * CHAR(1) INIT (BINASC(10));
      396      131    1   DCL CHARN CHAR(CHARNLEN) BASED;
      397      132    1   DCL CHARNLEN UBIN(36) STATIC;
      398      133
      399      134    1   DCL DEBUG BIT(36) STATIC SYMDEF INIT('1'O);
      400      135    1   DCL TCP$WRITE ENTRY(4) ALTRET;
      401      136
      402      137
      403      138    2      IF DEBUG THEN DO;

    138  3 000002   000045 235000 1                  LDA     DEBUG
         3 000003   000022 600000 3                  TZE     s:144

PL6.E3A0      #007=TCP$WRITE_D File=TCF$FTPD.:TCA2TSI                            SUN 11/16/97 14:12 Page:134  
      404      139    2          CHARNLEN = VBOUND(BUF_)+1;

    139  3 000004   200004 470500                    LDP0    @BUF_,,AUTO
         3 000005   000000 236100                    LDQ     0,,PR0
         3 000006   000020 772000                    QRL     16
         3 000007   000001 036007                    ADLQ    1,DL
         3 000010   000044 756000 1                  STQ     CHARNLEN

      405      140    2          SUBSTR (DOBUF, DONDX, CHARNLEN) = VBASE(BUF_)->CHARN;

    140  3 000011   000001 471500                    LDP1    1,,PR0
         3 000012   000000 620006                    EAX0    0,QL
         3 000013   000044 721000 1                  LXL1    CHARNLEN
         3 000014   000043 236000 1                  LDQ     DONDX
         3 000015   040046 100540                    MLR     fill='040'O
         3 000016   100000 000010                    ADSC9   0,,PR1                   cn=0,n=*X0
         3 000017   000000 000011 1                  ADSC9   DOBUF,Q                  cn=0,n=*X1

      406      141    2          DONDX = DONDX+CHARNLEN;

    141  3 000020   000044 036000 1                  ADLQ    CHARNLEN
         3 000021   000043 756000 1                  STQ     DONDX

      407      142    2          END;

      408      143
      409      144    2      CALL TCP$WRITE(LCN,BUF_,PUSH,URGENT) WHENALTRETURN DO;

    144  3 000022   200003 630500                    EPPR0   @LCN,,AUTO
         3 000023   000022 631400 xsym               EPPR1   B_VECTNIL+18
         3 000024   000000 701000 xent               TSX1    TCP$WRITE
         3 000025   000027 702000 3                  TSX2    s:145
         3 000026   000030 710000 3                  TRA     s:147

      410      145    2          ALTRETURN;

    145  3 000027   000000 702200 xent               TSX2  ! X66_AALT
PL6.E3A0      #007=TCP$WRITE_D File=TCF$FTPD.:TCA2TSI                            SUN 11/16/97 14:12 Page:135  

      411      146    2          END;
      412      147    1      RETURN;

    147  3 000030   000000 702200 xent               TSX2  ! X66_ARET

      413      148
      414      149    1   TELNET_EOL: ENTRY (LCN) ALTRET;

    149  3 000031   000000 700200 xent  TELNET_EOL   TSX0  ! X66_AUTO_4
         3 000032   000014 000004                    ZERO    12,4

      415      150
      416      151    2      IF DEBUG AND DONDX > 4 THEN DO;

    151  3 000033   000045 235000 1                  LDA     DEBUG
         3 000034   000052 600000 3                  TZE     s:156
         3 000035   000043 236000 1                  LDQ     DONDX
         3 000036   000004 116007                    CMPQ    4,DL
         3 000037   000052 604400 3                  TMOZ    s:156

      417      152    2          WRITE_LO.BUF_ = VECTOR(SUBSTR(DOBUF,0,DONDX));

    152  3 000040   000043 235000 1                  LDA     DONDX
         3 000041   000020 735000                    ALS     16
         3 000042   000140 135007                    SBLA    96,DL
         3 000043   000000 236000 4                  LDQ     0
         3 000044   000004 757000 xsym               STAQ    WRITE_LO+4

      418      153    2          CALL M$WRITE (WRITE_LO);

    153  3 000045   000000 630400 xsym               EPPR0   WRITE_LO
         3 000046   040001 713400                    CLIMB   write
         3 000047   401400 401760                    pmme    nvectors=4

      419      154    2          DONDX = 4;

PL6.E3A0      #007=TCP$WRITE_D File=TCF$FTPD.:TCA2TSI                            SUN 11/16/97 14:12 Page:136  
    154  3 000050   000004 235007                    LDA     4,DL
         3 000051   000043 755000 1                  STA     DONDX

      420      155    2          END;

      421      156    1      CALL TCP$WRITE (LCN, VECTOR(CRLF), '1'B/*Push*/ );

    156  3 000052   000004 236000 4                  LDQ     4
         3 000053   200012 756100                    STQ     @URGENT+4,,AUTO
         3 000054   000005 236000 4                  LDQ     5
         3 000055   200003 235100                    LDA     @LCN,,AUTO
         3 000056   200010 757100                    STAQ    @URGENT+2,,AUTO
         3 000057   200010 630500                    EPPR0   @URGENT+2,,AUTO
         3 000060   000021 631400 xsym               EPPR1   B_VECTNIL+17
         3 000061   000000 701000 xent               TSX1    TCP$WRITE
         3 000062   000000 011000                    NOP     0

      422      157    1      RETURN;

    157  3 000063   000000 702200 xent               TSX2  ! X66_ARET

DOBUF
 Sect OctLoc
   1     000   040040 055076   040040 040040   040040 040040   040040 040040      ->
   1     004   040040 040040   040040 040040   040040 040040   040040 040040
   1     040*  040040 040040   040040 040040   040040 040040

DONDX
 Sect OctLoc
   1     043   000000 000004                                                    ....

DEBUG
 Sect OctLoc
   1     045   100000 000000                                                    @...

CRLF
 Sect OctLoc
PL6.E3A0      #007=TCP$WRITE_D File=TCF$FTPD.:TCA2TSI                            SUN 11/16/97 14:12 Page:137  
   2     000   015012 ******                                                    ....

(unnamed)
 Sect OctLoc
   4     000   000000 006000   000000 000000   000000 377640   000000 006000    ................
   4     004   000030 006000   000002 006000                                    ........
      423      158    1   END TCP$WRITE_D;
      424      159

PL6.E3A0      #007=TCP$WRITE_D File=TCF$FTPD.:TCA2TSI                            SUN 11/16/97 14:12 Page:138  
--  Include file information  --

   CP_6.:LIBRARY  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure TCP$WRITE_D.
PL6.E3A0      #007=TCP$WRITE_D File=TCF$FTPD.:TCA2TSI                            SUN 11/16/97 14:12 Page:139  

 **** Variables and constants ****

  ****  Section 001  Data  TCP$WRITE_D

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    44-0-0/w UBIN        r     1 CHARNLEN                  45-0-0/b BIT         r     1 DEBUG
     0-0-0/c CHAR(140)   r     1 DOBUF                     43-0-0/w SBIN        r     1 DONDX

  ****  Section 002 RoData TCP$WRITE_D

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c STRC(18)    r     1 CRLF

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @BUF_                      3-0-0/w PTR         r     1 @LCN
     5-0-0/w PTR         r     1 @PUSH                      6-0-0/w PTR         r     1 @URGENT
    *0-0-0/d VECT        r     1 BUF_                      *0-0-0/w UBIN        r     1 LCN
    *0-0-0/b BIT         r     1 PUSH                      *0-0-0/b BIT         r     1 URGENT

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(432)   r     1 WRITE_LO

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
PL6.E3A0      #007=TCP$WRITE_D File=TCF$FTPD.:TCA2TSI                            SUN 11/16/97 14:12 Page:140  
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c ACHR        r     1 CHARN


   Procedure TCP$WRITE_D requires 52 words for executable code.
   Procedure TCP$WRITE_D requires 12 words of local(AUTO) storage.

    No errors detected in file TCF$FTPD.:TCA2TSI    .
PL6.E3A0      #007=TCP$WRITE_D File=TCF$FTPD.:TCA2TSI                            SUN 11/16/97 14:12 Page:141  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #007=TCP$WRITE_D File=TCF$FTPD.:TCA2TSI                            SUN 11/16/97 14:12 Page:142  
          MINI XREF LISTING

BUF_
        10**DCL         7--PROC      139>>ASSIGN    140>>ASSIGN    144<>CALL
CHARN
       131**DCL       140>>ASSIGN
CHARNLEN
       132**DCL       131--IMP-SIZ   139<<ASSIGN    140>>ASSIGN    140>>ASSIGN    141>>ASSIGN
CRLF
       128**DCL       156--CALL
DEBUG
       134**DCL       138>>IF        151>>IF
DOBUF
       126**DCL       140<<ASSIGN    152--ASSIGN
DONDX
       127**DCL       140>>ASSIGN    141<<ASSIGN    141>>ASSIGN    151>>IF        152>>ASSIGN    154<<ASSIGN
LCN
         9**DCL         7--PROC      144<>CALL      149--ENTRY     156<>CALL
M$WRITE
        24**DCL-ENT   153--CALL
PUSH
        11**DCL         7--PROC      144<>CALL
TCP$WRITE
       135**DCL-ENT   144--CALL      156--CALL
URGENT
        12**DCL         7--PROC      144<>CALL
WRITE_LO
       112**DCL       153<>CALL
WRITE_LO.BUF_
       112**DCL       152<<ASSIGN
WRITE_LO.STATION_
       114**DCL       114--REDEF
WRITE_LO.V.DVBYTE.VFC#
       121**DCL       121--REDEF
PL6.E3A0      #007=TCP$WRITE_D File=TCF$FTPD.:TCA2TSI                            SUN 11/16/97 14:12 Page:143  
              *** CROSS REFERENCE LISTING ***
    **     DENOTES     IDENTIFIER DEFINITION
    <<                 IDENTIFIER'S VALUE SET
    >>                 IDENTIFIER'S VALUE USED
    <>                 IDENTIFIER SET AND/OR USED
    --                 IDENTIFIER REFERENCED
PL6.E3A0      #007=TCP$WRITE_D File=TCF$FTPD.:TCA2TSI                            SUN 11/16/97 14:12 Page:144  
              MINI UREF LISTING

M$ACCT      40**DCL-ENT
M$ACTIVATE      43**DCL-ENT
M$ALIB      36**DCL-ENT
M$ASUSER      38**DCL-ENT
M$ATTACH      45**DCL-ENT
M$BADPP      63**DCL-ENT
M$CGCTL      44**DCL-ENT
M$CGINFO      44**DCL-ENT
M$CHECK      25**DCL-ENT
M$CHGUNIT      83**DCL-ENT
M$CLOSE      23**DCL-ENT
M$CLRSTK      81**DCL-ENT
M$CMDVAR      92**DCL-ENT
M$CONFIG      53**DCL-ENT
M$CORRES      28**DCL-ENT
M$CPEXIT      37**DCL-ENT
M$CVM      61**DCL-ENT
M$CVOL      26**DCL-ENT
M$DCLFLD      53**DCL-ENT
M$DEACTIVATE      43**DCL-ENT
M$DELREC      25**DCL-ENT
M$DEQ      90**DCL-ENT
M$DETACH      45**DCL-ENT
M$DEVICE      27**DCL-ENT
M$DISPLAY      90**DCL-ENT
M$DISPRES      30**DCL-ENT
M$DLIB      36**DCL-ENT
M$DRIBBLE      53**DCL-ENT
M$DRTN      81**DCL-ENT
M$DSUSER      38**DCL-ENT
M$ENQ      89**DCL-ENT
M$EOM      48**DCL-ENT
PL6.E3A0      #007=TCP$WRITE_D File=TCF$FTPD.:TCA2TSI                            SUN 11/16/97 14:12 Page:145  
M$ERASE      54**DCL-ENT
M$ERR      35**DCL-ENT
M$ERRMSG      86**DCL-ENT
M$EVENT      78**DCL-ENT
M$EXHUME      87**DCL-ENT
M$EXIT      35**DCL-ENT
M$EXTEND      27**DCL-ENT
M$FDP      59**DCL-ENT
M$FDS      58**DCL-ENT
M$FEBOOT      51**DCL-ENT
M$FECTL      52**DCL-ENT
M$FEDUMP      51**DCL-ENT
M$FID      86**DCL-ENT
M$FINDPROC      40**DCL-ENT
M$FSUSER      38**DCL-ENT
M$FVP      60**DCL-ENT
M$FWCG      44**DCL-ENT
M$GBPL      64**DCL-ENT
M$GDDL      60**DCL-ENT
M$GDP      59**DCL-ENT
M$GDS      58**DCL-ENT
M$GETDCB      29**DCL-ENT
M$GETMOUSE      69**DCL-ENT
M$GETPM      70**DCL-ENT
M$GJOB      88**DCL-ENT
M$GLINEATTR      48**DCL-ENT
M$GOODPP      63**DCL-ENT
M$GPLATEN      56**DCL-ENT
M$GPROMPT      55**DCL-ENT
M$GTRMATTR      49**DCL-ENT
M$GTRMCTL      47**DCL-ENT
M$GTRMTAB      50**DCL-ENT
M$GVP      59**DCL-ENT
M$HELP      86**DCL-ENT
M$INT      78**DCL-ENT
M$INTRTN      39**DCL-ENT
PL6.E3A0      #007=TCP$WRITE_D File=TCF$FTPD.:TCA2TSI                            SUN 11/16/97 14:12 Page:146  
M$IOQ      74**DCL-ENT
M$JOBSTATS      88**DCL-ENT
M$KEYIN      28**DCL-ENT
M$LDEV      23**DCL-ENT
M$LDTRC      36**DCL-ENT
M$LIMIT      29**DCL-ENT
M$LINES      28**DCL-ENT
M$LINK      35**DCL-ENT
M$MADMUCK      31**DCL-ENT
M$MAKUSER      62**DCL-ENT
M$MBS      30**DCL-ENT
M$MDFFLD      54**DCL-ENT
M$MERC      79**DCL-ENT
M$MERCS      80**DCL-ENT
M$MIRROR      74**DCL-ENT
M$MONINFO      91**DCL-ENT
M$MPL      64**DCL-ENT
M$NODEINFO      55**DCL-ENT
M$NXTUSR      89**DCL-ENT
M$OCMSG      87**DCL-ENT
M$OLAY      35**DCL-ENT
M$OPEN      23**DCL-ENT
M$PAS      64**DCL-ENT
M$PATHCON      87**DCL-ENT
M$PDS      58**DCL-ENT
M$PFIL      25**DCL-ENT
M$PLATEN      49**DCL-ENT
M$PRECORD      27**DCL-ENT
M$PROCNAME      40**DCL-ENT
M$PROFILE      51**DCL-ENT
M$PROMPT      47**DCL-ENT
M$RACST      31**DCL-ENT
M$RDSYSLOG      72**DCL-ENT
M$READ      24**DCL-ENT
M$RELDCB      29**DCL-ENT
M$RELRES      30**DCL-ENT
PL6.E3A0      #007=TCP$WRITE_D File=TCF$FTPD.:TCA2TSI                            SUN 11/16/97 14:12 Page:147  
M$RELSTARF      32**DCL-ENT
M$REM      32**DCL-ENT
M$RENV      79**DCL-ENT
M$REQUIRE      31**DCL-ENT
M$RETRY      80**DCL-ENT
M$RETRYS      80**DCL-ENT
M$REW      26**DCL-ENT
M$RLSFLD      54**DCL-ENT
M$RPRIV      82**DCL-ENT
M$RSPP      61**DCL-ENT
M$RSWITCH      83**DCL-ENT
M$RUE      89**DCL-ENT
M$SAD      62**DCL-ENT
M$SAVE      38**DCL-ENT
M$SCON      39**DCL-ENT
M$SCREECH      37**DCL-ENT
M$SENV      79**DCL-ENT
M$SETFMA      23**DCL-ENT
M$SETFP      52**DCL-ENT
M$SINPUT      50**DCL-ENT
M$SLCFLD      55**DCL-ENT
M$SMOUSE      69**DCL-ENT
M$SMPRT      61**DCL-ENT
M$SPRIV      82**DCL-ENT
M$SSC      62**DCL-ENT
M$SSWITCH      82**DCL-ENT
M$STATE      91**DCL-ENT
M$STD      63**DCL-ENT
M$STIMER      77**DCL-ENT
M$STLPP      60**DCL-ENT
M$STRAP      77**DCL-ENT
M$STRMATTR      49**DCL-ENT
M$STRMCTL      47**DCL-ENT
M$STRMTAB      50**DCL-ENT
M$SYMBIO      88**DCL-ENT
M$SYSCON      74**DCL-ENT
PL6.E3A0      #007=TCP$WRITE_D File=TCF$FTPD.:TCA2TSI                            SUN 11/16/97 14:12 Page:148  
M$SYSID      92**DCL-ENT
M$TDCLOSE      73**DCL-ENT
M$TDIO      73**DCL-ENT
M$TDOPEN      72**DCL-ENT
M$TDREQCPU      73**DCL-ENT
M$TEMPWROC      67**DCL-ENT
M$TIME      90**DCL-ENT
M$TRAP      77**DCL-ENT
M$TRMISC      52**DCL-ENT
M$TRMPRG      48**DCL-ENT
M$TRTN      81**DCL-ENT
M$TRUNC      24**DCL-ENT
M$TTIMER      77**DCL-ENT
M$UC      47**DCL
M$UMPL      64**DCL-ENT
M$UNFID      86**DCL-ENT
M$UNLATCH      43**DCL-ENT
M$UNSHARE      40**DCL-ENT
M$USRFIELD      83**DCL-ENT
M$VIRTUAL      58**DCL-ENT
M$WAIT      81**DCL-ENT
M$WEOF      26**DCL-ENT
M$WRSYSLOG      72**DCL-ENT
M$XCON      78**DCL-ENT
M$XCONRTN      39**DCL-ENT
M$XEQTIME      91**DCL-ENT
M$XFLUSH      32**DCL-ENT
M$XMOUSE      69**DCL-ENT
M$XXX      35**DCL-ENT
M$YC      37**DCL-ENT
TCP$WRITE_D       7**PROC
TELNET_EOL     149**ENTRY
