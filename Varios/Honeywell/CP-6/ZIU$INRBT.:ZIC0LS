
PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:1    
        1        1        /*T***********************************************************/
        2        2        /*T*                                                         */
        3        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        4        4        /*T*                                                         */
        5        5        /*T***********************************************************/
        6        6        /*****************************************************************/
        7        7        /*M* ZIU$INRBT  IDS II INVENTORY PAGE RECONSTRUCT                */
        8        8        /*P*
        9        9        NAME:  ZIU$INRBT
       10       10        PURPOSE:  TO RECONSTRUCT AVAILABLE SPACE TABLE IN INVENTORY PAGES
       11       11                  OF AN IDS II DATABASE                                */
       12       12        /****************************************************************/
       13       13        ZIU$INRBT: PROC ALTRET;
       14       14        /**/
       15       15    1   DCL INV_BUF CHAR(4096) STATIC ALIGNED;
       16       16    1   DCL ZERO_DATA (0:4071) BIT(9) INIT('000'O*4072) STATIC;
       17       17    1   DCL TSTAMP BIT(72) STATIC ALIGNED;
       18       18    1   DCL IU UBIN(36) STATIC ALIGNED;
       19       19    1   DCL CHSM SBIN(36) STATIC ALIGNED;
       20       20    1   DCL INV_PG_NO UBIN(36) STATIC INIT(0) ALIGNED;
       21       21    1   DCL DATA_PG_NO UBIN(36) STATIC INIT(0) ALIGNED;
       22       22    1   DCL READ_FLAG UBIN(36) STATIC INIT(0);
       23       23    1   DCL FIRST_INV_PG UBIN(36) STATIC INIT(0);
       24       24    1   DCL FIRST_DATA_PG UBIN(36) STATIC INIT(0);
       25       25    1   DCL PCNT_INV SBIN(36) STATIC INIT(0);
       26       26    1   DCL KEYS_PR_PGE SBIN(36) STATIC INIT(0);
       27       27    1   DCL WORK1 UBIN(18) UNAL;
       28       28    1   DCL WORK2(0:1) REDEF WORK1 BIT(9) UNAL;
       29       29    1   DCL 1 BUFFER ALIGNED SYMREF,
       30       30    1         2 CAR_CON BIT(9) UNAL,
       31       31    1         2 TXT,
       32       32    1           3 MSG CHAR(35) UNAL,
       33       33    1           3 AREA_NM CHAR(96) UNAL;
       34       34    1   DCL IDX BIT(1);
       35       35        /**/
       36       36    1   DCL SYS_FUNC_OPEN ENTRY ALTRET;
       37       37    1   DCL SYS_FUNC_CLOS ENTRY ALTRET;
PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:2    
       38       38    1   DCL SYS_FUNC_READ ENTRY ALTRET;
       39       39    1   DCL SYS_FUNC_ERRMSG ENTRY ALTRET;
       40       40    1   DCL SYS_FUNC_WRIT ENTRY ALTRET;
       41       41    1   DCL CHKSUM ENTRY ALTRET;
       42       42        /**/
       43       43        %INCLUDE CP_6;
       44      124        %INCLUDE CP_6_SUBS;
       45      664        %INCLUDE ZI$DIR;
       46      821        %F$DCB;
       47      878        %DIR;
       48     1022        %INCLUDE ZI$PG_STRUCTS;
       49     1125        %DATA_PG;
       50     1144        %INVTY_PG;
       51     1160        %ATBLK_PG;
       52     1216        %INCLUDE ZI_GLOBAL_DBUTIL;
       53     1394        %MISC_DCLS;
       54     1447        %SYS_FUNC;
       55     1539        /*****************************************************************/
       56     1540        /*
       57     1541        Open data base
       58     1542        */
       59     1543    1   /**/ DCBSF = ZI$DIR.AREA_NM.DCB#;
       60     1544    1   /**/ TESTSF = %NO#;
       61     1545    1   /**/ ORGSF = %IDS#;
       62     1546    1   /**/ FULLSF = %YES#;
       63     1547    1   /**/ FUNSF = %UPDATE#;
       64     1548    1   /**/ SHARESF = %IN#;
       65     1549    1   /**/ ACSSF = %DIRECT#;
       66     1550    1   /**/ ASNSF = %FILE#;
       67     1551    1   /**/ FIDSF = ZI$DIR.AREA_NM.NAME.TEXT;
       68     1552    1       CALL SYS_FUNC_OPEN ALTRET(ALTEND_ZIU$INRBT);
       69     1553    1       IF DCBADDR(ZI$DIR.AREA_NM.DCB#)->F$DCB.ORG# = %INDEXED#
       70     1554    2       THEN DO;
       71     1555    2           IDX = '1'B;
       72     1556    2           GOTO END_ZIU$INRBT;
       73     1557    2           END;
       74     1558    1       IDX = '0'B;
PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:3    
       75     1559        /*
       76     1560        Read attribute page
       77     1561        */
       78     1562    1       I_O_KEY =0;
       79     1563    1       OUT_INDX = 0;
       80     1564    1   /**/ BUFSF = VECTOR(I_O_BUF);
       81     1565    1   /**/ BUFLNSF = 4096;
       82     1566    1   /**/ FULLSF = %YES#;
       83     1567    1   /**/ ENCRP_SEEDSF = ZI$DIR.ENCP_SEED;
       84     1568    1   /**/ KEYSF = %YES#;
       85     1569    1   /**/ KEYVSF.IDSKEY = I_O_KEY;
       86     1570    1       CALL SYS_FUNC_READ ALTRET(ALTEND_ZIU$INRBT);
       87     1571    1       ATBLK$ = ADDR(I_O_BUF(OUT_INDX));
       88     1572    1       IF ATBLK_PG.FIR_INV_PGNO = 0 THEN GOTO END_ZIU$INRBT;
       89     1573        /*
       90     1574        Calculate inventory unit
       91     1575        */
       92     1576    1       IU = ATBLK_PG.MISC_INFO.IUSZ;
       93     1577    1       PCNT_INV = ATBLK_PG.DB_INFO.PRCNT_INV;
       94     1578    1       KEYS_PR_PGE = ATBLK_PG.LINE_INFO.LPP; /* LINES PER PAGE */
       95     1579    1       FIRST_INV_PG=ATBLK_PG.FIR_INV_PGNO;
       96     1580    1       FIRST_DATA_PG=1;
       97     1581    1       INV_PG_NO=FIRST_INV_PG; /*Default values*/
       98     1582    1       DATA_PG_NO=FIRST_DATA_PG;
       99     1583    1       IB=0;
      100     1584    1       IE=ATBLK_PG.FIR_INV_PGNO-2;
      101     1585    1       IF ATBLK_PG.MISC_INFO.CHKSM = %YES# THEN
      102     1586    1           CHSM = 1;
      103     1587    1       ELSE
      104     1588    1           CHSM = 0;
      105     1589    1       INVPG$=ADDR(INV_BUF);
      106     1590        /*
      107     1591        Determine if range of data pages is to be inventoried
      108     1592        */
      109     1593    1       IF ICNT = -1 THEN
      110     1594    2       DO;
      111     1595    2           INIT_RG.FIRNG(0) = 1; /*beginning data page #*/
PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:4    
      112     1596    2           INIT_RG.SECRNG(0) = ATBLK_PG.FIR_INV_PGNO -1; /*ending data page #*/
      113     1597    2           ICNT=0;
      114     1598    2           END;
      115     1599    1       BUFFER.TXT.MSG = '...Rebuilding inventory for AREA:';
      116     1600    1       BUFFER.TXT.AREA_NM = ZI$DIR.AREA_NM.NAME.TEXT;
      117     1601    1       BUFFER.CAR_CON = '001000001'B;
      118     1602    1   /**/ DCBSF = DCBNUM(M$LO);
      119     1603    1   /**/ BUFSF = VECTOR(BUFFER);
      120     1604    1   /**/ BUFLNSF = 132;
      121     1605    1       CALL SYS_FUNC_WRIT;
      122     1606    2       DO I = 0 TO ICNT BY 1;
      123     1607    2           OUT_INDX=-1;
      124     1608    2           I_O_SIZE = 0;
      125     1609    2           RB =INIT_RG.FIRNG(I);
      126     1610    2           RE = INIT_RG.SECRNG(I);
      127     1611    2           IB=RB-1;
      128     1612    2           IE=RE-1;
      129     1613    2    /**/   DCBSF = ZI$DIR.AREA_NM.DCB#;
      130     1614    2    /**/   BUFSF = VECTOR(INV_BUF);
      131     1615    2    /**/   BUFLNSF = 4096;
      132     1616    2    /**/   FULLSF = %YES#;
      133     1617    2    /**/   ENCRP_SEEDSF = ZI$DIR.ENCP_SEED;
      134     1618    2    /**/   KEYSF = %YES#;
      135     1619    2    /**/   KEYVSF.IDSKEY = ATBLK_PG.FIR_INV_PGNO;
      136     1620    2           CALL SYS_FUNC_READ ALTRET(ALTEND_ZIU$INRBT);
              1620                    /*Read to get the 1st  inventory page in */
      137     1621    3           DO RB=RB TO RE BY 1; /*Do through the range of the data pages*/
      138     1622    3               IF BREAK_FLAG > 0 THEN
      139     1623    4               DO;
      140     1624    4                   DCBSF = ZI$DIR.AREA_NM.DCB#;
      141     1625    4                   CALL SYS_FUNC_CLOS;
      142     1626    4                   UNWIND TO RESTART;
      143     1627    4                   END;
      144     1628    3               IF IB> 4071 THEN /*If inventroy page is full then write it out*/
      145     1629    4               DO;
      146     1630    4                   IB = 0;
      147     1631    4                   IE = IE - 4072;
PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:5    
      148     1632    4                   IF CHSM = 1 THEN
      149     1633    5                   DO;
      150     1634    5                       DATA$ = INVPG$; /* Set pointer up for checksum */
      151     1635    5                       ICHKSUM = 0;
      152     1636    5                       CALL CHKSUM;
      153     1637    5                       INV_PG.CHKSUM_WD = ICHKSUM;
      154     1638    5                       DATA$ = ADDR(I_O_BUF(OUT_INDX));
      155     1639    5                       END;
      156     1640    4    /**/           DCBSF = ZI$DIR.AREA_NM.DCB#;
      157     1641    4    /**/           BUFSF = VECTOR(INV_BUF);
      158     1642    4    /**/           BUFLNSF = 4096;
      159     1643    4    /**/           VFCSF = %NO#;
      160     1644    4    /**/           FULLSF = %YES#;
      161     1645    4    /**/           NOTIMESF = %NO#;
      162     1646    4    /**/           KEYVSF.IDSKEY = INV_PG_NO;
      163     1647    4                   CALL SYS_FUNC_WRIT ALTRET(ALTEND_ZIU$INRBT);
      164     1648    4                   INV_PG_NO = INV_PG_NO + 1;
      165     1649    4    /**/           DCBSF = ZI$DIR.AREA_NM.DCB#;
      166     1650    4    /**/           BUFSF = VECTOR(INV_BUF);
      167     1651    4    /**/           BUFLNSF = 4096;
      168     1652    4    /**/           FULLSF = %YES#;
      169     1653    4    /**/           ENCRP_SEEDSF = ZI$DIR.ENCP_SEED;
      170     1654    4    /**/           KEYSF = %YES#;
      171     1655    4    /**/           KEYVSF.IDSKEY = INV_PG_NO;
      172     1656    4                   CALL SYS_FUNC_READ ALTRET(ALTEND_ZIU$INRBT);
              1656                            /*Read in the next inventory page*/
      173     1657    4                   END;
      174     1658    3               IF OUT_INDX = I_O_SIZE-1 THEN
      175     1659    4               DO;
      176     1660    4                   I_O_SIZE = RE-RB+1;
      177     1661    4                   IF I_O_SIZE > 32 THEN I_O_SIZE = 32;
      178     1662    4                   I_O_KEY = RB;
      179     1663    4    /**/           DCBSF = ZI$DIR.AREA_NM.DCB#;
      180     1664    4    /**/           BUFSF = VECTOR(I_O_BUF);
      181     1665    4    /**/           BUFLNSF = 4096 * I_O_SIZE;
      182     1666    4    /**/           FULLSF = %YES#;
      183     1667    4    /**/           ENCRP_SEEDSF = ZI$DIR.ENCP_SEED;
PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:6    
      184     1668    4    /**/           KEYSF = %YES#;
      185     1669    4    /**/           KEYVSF.IDSKEY = I_O_KEY;
      186     1670    4                   CALL SYS_FUNC_READ ALTRET(ALTEND_ZIU$INRBT);
      187     1671    4                   OUT_INDX=-1;
      188     1672    4                   END;
      189     1673    3               OUT_INDX=OUT_INDX+1;
      190     1674    3               DATA$=ADDR(I_O_BUF(OUT_INDX));
      191     1675    3               WORK1=(DATA_PG.PG_SZ.SEC+(IU-1))/IU;
      192     1676    3               IF WORK1>511 THEN
      193     1677    3                   INV_PG.INVENT_CT(IB)='777'O;
      194     1678    3               ELSE
      195     1679    3                   IF (100*(DATA_PG.PG_SZ.FIR-DATA_PG.PG_SZ.SEC))/DATA_PG.PG_SZ.FIR
      196     1680    3                      < PCNT_INV THEN
      197     1681    3                       INV_PG.INVENT_CT(IB)='777'O;
      198     1682    3                   ELSE
      199     1683    3                       INV_PG.INVENT_CT(IB)=WORK2(1);
      200     1684         /* In any case if all the keys are used - mark pg full */
      201     1685    3               IF DATA_PG.OFF_LN.FIR = 0 AND
      202     1686    3                  DATA_PG.OFF_LN.SEC>=KEYS_PR_PGE-1 AND
      203     1687    3                  DATA_PG.ACT_DATA_18(2035)>=0 THEN /* LINE 0 NOT AVAIL */
      204     1688    3                   INV_PG.INVENT_CT(IB) = '000'O;
      205     1689    3               IB=IB+1;
      206     1690    3               END;
      207     1691    2           IF CHSM = 1 THEN
      208     1692    3           DO;
      209     1693    3               DATA$ = INVPG$; /* Set pointer up for checksum */
      210     1694    3               ICHKSUM = 0;
      211     1695    3               CALL CHKSUM;
      212     1696    3               INV_PG.CHKSUM_WD = ICHKSUM;
      213     1697    3               DATA$ = ADDR(I_O_BUF(OUT_INDX));
      214     1698    3               END;
      215     1699    2       /**/DCBSF = ZI$DIR.AREA_NM.DCB#;
      216     1700    2    /**/   BUFSF = VECTOR(INV_BUF);
      217     1701    2    /**/   BUFLNSF = 4096;
      218     1702    2    /**/   VFCSF = %NO#;
      219     1703    2    /**/   NOTIMESF = %NO#;
      220     1704    2    /**/   KEYVSF.IDSKEY = INV_PG_NO;
PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:7    
      221     1705    2    /**/   FULLSF = %YES#;
      222     1706    2    /**/   WAITSF = %YES#;
      223     1707    2    /**/   ENCRP_SEEDSF = ZI$DIR.ENCP_SEED;
      224     1708    2           CALL SYS_FUNC_WRIT ALTRET(ALTEND_ZIU$INRBT);
      225     1709    2           END;
      226     1710    1   END_ZIU$INRBT:
      227     1711    1   /**/ DCBSF = ZI$DIR.AREA_NM.DCB#;
      228     1712    1       IF IDX THEN
      229     1713    2       DO;
      230     1714    2           BUFFER.TXT.MSG = '...Rebuild skipped for INDEX AREA:  ';
      231     1715    2           BUFFER.TXT.AREA_NM = ZI$DIR.AREA_NM.NAME.TEXT;
      232     1716    2           END;
      233     1717    2       ELSE DO;
      234     1718    2           BUFFER.TXT.MSG = '    Rebuild completed';
      235     1719    2           BUFFER.TXT.AREA_NM = '  ';
      236     1720    2           END;
      237     1721    1       CALL SYS_FUNC_CLOS;
      238     1722    1   /**/ DCBSF = DCBNUM(M$LO);
      239     1723    1   /**/ BUFSF = VECTOR(BUFFER);
      240     1724    1   /**/ BUFLNSF = 132;
      241     1725    1       CALL SYS_FUNC_WRIT;
      242     1726    1       RETURN;
      243     1727    1   ALTEND_ZIU$INRBT:
      244     1728    1   /**/ DCBSF = ZI$DIR.AREA_NM.DCB#;
      245     1729    1       CALL SYS_FUNC_CLOS;
      246     1730    1       RETURN;
      247     1731    1   END ZIU$INRBT;

PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:8    
--  Include file information  --

   ZI_GLOBAL_DBUTIL.:ZIC0TOU  is referenced.
   ZI$PG_STRUCTS.:ZIC0TOU  is referenced.
   ZI$DIR.:ZIC0TOU  is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure ZIU$INRBT.

   Procedure ZIU$INRBT requires 424 words for executable code.
   Procedure ZIU$INRBT requires 10 words of local(AUTO) storage.

    No errors detected in file ZIU$INRBT.:ZIC0TSI    .

PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:9    

 Object Unit name= ZIU$INRBT                                  File name= ZIU$INRBT.:ZIC0TOU
 UTS= SEP 05 '97 13:16:16.36 FRI                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Data  even  none  2053   4005  ZIU$INRBT
    1   DCB   even  none     0      0  M$UC
    2   DCB   even  none     0      0  M$LO
    3  RoData even  UTS     24     30  ZIU$INRBT
    4   Proc  even  none   424    650  ZIU$INRBT
    5  RoData even  none     8     10  ZIU$INRBT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     4      0   yes    yes     yes      Std        0  ZIU$INRBT

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       0 SYS_FUNC_OPEN
 yes     yes           Std       0 SYS_FUNC_READ
 yes     yes           Std       0 CHKSUM
 yes     yes           Std       0 SYS_FUNC_WRIT
 yes     yes           Std       0 SYS_FUNC_CLOS
                       nStd      0 X66_AUTO_0
                       nStd      0 X66_AUNWIND
                       nStd      0 X66_ARET
PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:10   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     BUFFER                                M$UC                                  ZI$DIR
     SCHEMA_ACTIVE                         RECORD_LIST                           SET_LIST
     RETAIN_LIST                           DUMP_FID                              ALTKY
     INIT_RG                               KEY_RNG                               ITEM_LIST
     DATA$                                 INVPG$                                ATBLK$
     REC$                                  RB                                    RE
     IE                                    IB                                    CNT
     ICNT                                  RCNT                                  SCNT
     FIRST_SET                             RETCNT                                DMPCNT
     KCNT                                  ACNT_IDX                              I
     J                                     K                                     X
     STEPCC                                I_O_BUF$                              OUT_INDX
     I_O_SIZE                              REC_DATA_LN                           M$LO
     B$TCB$                                B$ROS$                                B$JIT$
     KEYFID                                I_O_KEY                               RESTART
     BREAK_FLAG                            ICHKSUM                               ITMCNT
     GAP1                                  BLKLSF                                KEYLSF
     KEYXSF                                DCBSF                                 ORGSF
     KEYSF                                 KEYVSF                                ACSSF
     NOTIMESF                              FUNSF                                 ASNSF
     TESTSF                                XTENSIZESF                            DISPSF
     WAITSF                                VFCSF                                 FULLSF
     BKUPSF                                BUFLNSF                               BUFSF
     SOURCESF                              DESTSF                                DATESF
     TIMESF                                UTSSF                                 DAYSF
     TSTAMPSF                              ENCRP_SEEDSF                          ERRCODESF
     MSGCODE                               INCL_ERR                              ERR_INSERT
     FIDSF_RD                              ACNT                                  EXISTSF
     SHARESF                               DCBNMSF                               KEYRSF
     NO_KEYSF                              REASGNSF                              CARRY_ATTRIBUTESF
     SUBMESSF                              SPKY_OPNSF                            POSSF
     ERRFLGSF                              MERGESF                               FSA_FLAG
     RELGSF                                UNUSED                                HELPCODE
PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:11   
     COUNTSF                               INDEXSF                               GAP
     PSNSF                                 ACNTSF                                KEY_SHADWSF

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ROSID                                 ISSID
PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:12   


        1        1        /*T***********************************************************/
        2        2        /*T*                                                         */
        3        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        4        4        /*T*                                                         */
        5        5        /*T***********************************************************/
        6        6        /*****************************************************************/
        7        7        /*M* ZIU$INRBT  IDS II INVENTORY PAGE RECONSTRUCT                */
        8        8        /*P*
        9        9        NAME:  ZIU$INRBT
       10       10        PURPOSE:  TO RECONSTRUCT AVAILABLE SPACE TABLE IN INVENTORY PAGES
       11       11                  OF AN IDS II DATABASE                                */
       12       12        /****************************************************************/
       13       13        ZIU$INRBT: PROC ALTRET;

     13  4 000000   000000 700200 xent  ZIU$INRBT    TSX0  ! X66_AUTO_0
         4 000001   000012 000000                    ZERO    10,0

       14       14        /**/
       15       15    1   DCL INV_BUF CHAR(4096) STATIC ALIGNED;
       16       16    1   DCL ZERO_DATA (0:4071) BIT(9) INIT('000'O*4072) STATIC;
       17       17    1   DCL TSTAMP BIT(72) STATIC ALIGNED;
       18       18    1   DCL IU UBIN(36) STATIC ALIGNED;
       19       19    1   DCL CHSM SBIN(36) STATIC ALIGNED;
       20       20    1   DCL INV_PG_NO UBIN(36) STATIC INIT(0) ALIGNED;
       21       21    1   DCL DATA_PG_NO UBIN(36) STATIC INIT(0) ALIGNED;
       22       22    1   DCL READ_FLAG UBIN(36) STATIC INIT(0);
       23       23    1   DCL FIRST_INV_PG UBIN(36) STATIC INIT(0);
       24       24    1   DCL FIRST_DATA_PG UBIN(36) STATIC INIT(0);
       25       25    1   DCL PCNT_INV SBIN(36) STATIC INIT(0);
       26       26    1   DCL KEYS_PR_PGE SBIN(36) STATIC INIT(0);
       27       27    1   DCL WORK1 UBIN(18) UNAL;
       28       28    1   DCL WORK2(0:1) REDEF WORK1 BIT(9) UNAL;
       29       29    1   DCL 1 BUFFER ALIGNED SYMREF,
       30       30    1         2 CAR_CON BIT(9) UNAL,
       31       31    1         2 TXT,
       32       32    1           3 MSG CHAR(35) UNAL,
PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:13   
       33       33    1           3 AREA_NM CHAR(96) UNAL;
       34       34    1   DCL IDX BIT(1);
       35       35        /**/
       36       36    1   DCL SYS_FUNC_OPEN ENTRY ALTRET;
       37       37    1   DCL SYS_FUNC_CLOS ENTRY ALTRET;
       38       38    1   DCL SYS_FUNC_READ ENTRY ALTRET;
       39       39    1   DCL SYS_FUNC_ERRMSG ENTRY ALTRET;
       40       40    1   DCL SYS_FUNC_WRIT ENTRY ALTRET;
       41       41    1   DCL CHKSUM ENTRY ALTRET;
       42       42        /**/
       43       43        %INCLUDE CP_6;
       44      124        %INCLUDE CP_6_SUBS;
       45      664        %INCLUDE ZI$DIR;
       46      821        %F$DCB;
       47      878        %DIR;
       48     1022        %INCLUDE ZI$PG_STRUCTS;
       49     1125        %DATA_PG;
       50     1144        %INVTY_PG;
       51     1160        %ATBLK_PG;
       52     1216        %INCLUDE ZI_GLOBAL_DBUTIL;
       53     1394        %MISC_DCLS;
       54     1447        %SYS_FUNC;
       55     1539        /*****************************************************************/
       56     1540        /*
       57     1541        Open data base
       58     1542        */
       59     1543    1   /**/ DCBSF = ZI$DIR.AREA_NM.DCB#;

   1543  4 000002   000244 220000 xsym               LDX0    ZI$DIR+164
         4 000003   000000 740000 xsym               STX0    DCBSF

       60     1544    1   /**/ TESTSF = %NO#;

   1544  4 000004   000000 450000 xsym               STZ     TESTSF

       61     1545    1   /**/ ORGSF = %IDS#;

PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:14   
   1545  4 000005   000007 235007                    LDA     7,DL
         4 000006   000000 755000 xsym               STA     ORGSF

       62     1546    1   /**/ FULLSF = %YES#;

   1546  4 000007   400000 236003                    LDQ     -131072,DU
         4 000010   000000 756000 xsym               STQ     FULLSF

       63     1547    1   /**/ FUNSF = %UPDATE#;

   1547  4 000011   000001 235007                    LDA     1,DL
         4 000012   000000 755000 xsym               STA     FUNSF

       64     1548    1   /**/ SHARESF = %IN#;

   1548  4 000013   000000 756000 xsym               STQ     SHARESF

       65     1549    1   /**/ ACSSF = %DIRECT#;

   1549  4 000014   000002 235007                    LDA     2,DL
         4 000015   000000 755000 xsym               STA     ACSSF

       66     1550    1   /**/ ASNSF = %FILE#;

   1550  4 000016   000001 235007                    LDA     1,DL
         4 000017   000000 755000 xsym               STA     ASNSF

       67     1551    1   /**/ FIDSF = ZI$DIR.AREA_NM.NAME.TEXT;

   1551  4 000020   040000 100400                    MLR     fill='040'O
         4 000021   000234 200036 xsym               ADSC9   ZI$DIR+156               cn=1,n=30
         4 000022   000000 000036 xsym               ADSC9   FIDSF_RD                 cn=0,n=30

       68     1552    1       CALL SYS_FUNC_OPEN ALTRET(ALTEND_ZIU$INRBT);

   1552  4 000023   000000 631400 5                  EPPR1   0
         4 000024   000000 701000 xent               TSX1    SYS_FUNC_OPEN
PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:15   
         4 000025   000642 702000 4                  TSX2    ALTEND_ZIU$INRBT

       69     1553    1       IF DCBADDR(ZI$DIR.AREA_NM.DCB#)->F$DCB.ORG# = %INDEXED#

   1553  4 000026   000001 470400 5                  LDP0    1
         4 000027   000000 471500                    LDP1    0,,PR0
         4 000030   000244 220000 xsym               LDX0    ZI$DIR+164
         4 000031   100000 473510                    LDP3    0,X0,PR1
         4 000032   300032 236100                    LDQ     26,,PR3
         4 000033   777000 376003                    ANQ     -512,DU
         4 000034   006000 116003                    CMPQ    3072,DU
         4 000035   000041 601000 4                  TNZ     s:1558

       70     1554    2       THEN DO;

       71     1555    2           IDX = '1'B;

   1555  4 000036   400000 236003                    LDQ     -131072,DU
         4 000037   200004 756100                    STQ     IDX,,AUTO

       72     1556    2           GOTO END_ZIU$INRBT;

   1556  4 000040   000602 710000 4                  TRA     END_ZIU$INRBT

       73     1557    2           END;
       74     1558    1       IDX = '0'B;

   1558  4 000041   200004 450100                    STZ     IDX,,AUTO

       75     1559        /*
       76     1560        Read attribute page
       77     1561        */
       78     1562    1       I_O_KEY =0;

   1562  4 000042   000000 450000 xsym               STZ     I_O_KEY

       79     1563    1       OUT_INDX = 0;
PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:16   

   1563  4 000043   000000 450000 xsym               STZ     OUT_INDX

       80     1564    1   /**/ BUFSF = VECTOR(I_O_BUF);

   1564  4 000044   000002 235000 5                  LDA     2
         4 000045   000000 236000 xsym               LDQ     I_O_BUF$
         4 000046   000000 755000 xsym               STA     BUFSF
         4 000047   000001 756000 xsym               STQ     BUFSF+1

       81     1565    1   /**/ BUFLNSF = 4096;

   1565  4 000050   010000 235007                    LDA     4096,DL
         4 000051   000000 755000 xsym               STA     BUFLNSF

       82     1566    1   /**/ FULLSF = %YES#;

   1566  4 000052   400000 236003                    LDQ     -131072,DU
         4 000053   000000 756000 xsym               STQ     FULLSF

       83     1567    1   /**/ ENCRP_SEEDSF = ZI$DIR.ENCP_SEED;

   1567  4 000054   000027 236000 xsym               LDQ     ZI$DIR+23
         4 000055   000000 756000 xsym               STQ     ENCRP_SEEDSF

       84     1568    1   /**/ KEYSF = %YES#;

   1568  4 000056   400000 236003                    LDQ     -131072,DU
         4 000057   000000 756000 xsym               STQ     KEYSF

       85     1569    1   /**/ KEYVSF.IDSKEY = I_O_KEY;

   1569  4 000060   000000 100400                    MLR     fill='000'O
         4 000061   000000 000004 xsym               ADSC9   I_O_KEY                  cn=0,n=4
         4 000062   000000 200004 xsym               ADSC9   KEYVSF                   cn=1,n=4

       86     1570    1       CALL SYS_FUNC_READ ALTRET(ALTEND_ZIU$INRBT);
PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:17   

   1570  4 000063   000000 631400 5                  EPPR1   0
         4 000064   000000 701000 xent               TSX1    SYS_FUNC_READ
         4 000065   000642 702000 4                  TSX2    ALTEND_ZIU$INRBT

       87     1571    1       ATBLK$ = ADDR(I_O_BUF(OUT_INDX));

   1571  4 000066   000000 236000 xsym               LDQ     OUT_INDX
         4 000067   000034 736000                    QLS     28
         4 000070   000000 036000 xsym               ADLQ    I_O_BUF$
         4 000071   000000 756000 xsym               STQ     ATBLK$

       88     1572    1       IF ATBLK_PG.FIR_INV_PGNO = 0 THEN GOTO END_ZIU$INRBT;

   1572  4 000072   000000 470400 xsym               LDP0    ATBLK$
         4 000073   000014 235100                    LDA     12,,PR0
         4 000074   000602 600000 4                  TZE     END_ZIU$INRBT

       89     1573        /*
       90     1574        Calculate inventory unit
       91     1575        */
       92     1576    1       IU = ATBLK_PG.MISC_INFO.IUSZ;

   1576  4 000075   000030 236100                    LDQ     24,,PR0
         4 000076   777777 376007                    ANQ     -1,DL
         4 000077   003774 756000 0                  STQ     IU

       93     1577    1       PCNT_INV = ATBLK_PG.DB_INFO.PRCNT_INV;

   1577  4 000100   000010 236100                    LDQ     8,,PR0
         4 000101   000011 772000                    QRL     9
         4 000102   000777 376007                    ANQ     511,DL
         4 000103   004003 756000 0                  STQ     PCNT_INV

       94     1578    1       KEYS_PR_PGE = ATBLK_PG.LINE_INFO.LPP; /* LINES PER PAGE */

   1578  4 000104   000012 236100                    LDQ     10,,PR0
PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:18   
         4 000105   777777 376007                    ANQ     -1,DL
         4 000106   004004 756000 0                  STQ     KEYS_PR_PGE

       95     1579    1       FIRST_INV_PG=ATBLK_PG.FIR_INV_PGNO;

   1579  4 000107   004001 755000 0                  STA     FIRST_INV_PG

       96     1580    1       FIRST_DATA_PG=1;

   1580  4 000110   000001 235007                    LDA     1,DL
         4 000111   004002 755000 0                  STA     FIRST_DATA_PG

       97     1581    1       INV_PG_NO=FIRST_INV_PG; /*Default values*/

   1581  4 000112   004001 235000 0                  LDA     FIRST_INV_PG
         4 000113   003776 755000 0                  STA     INV_PG_NO

       98     1582    1       DATA_PG_NO=FIRST_DATA_PG;

   1582  4 000114   004002 235000 0                  LDA     FIRST_DATA_PG
         4 000115   003777 755000 0                  STA     DATA_PG_NO

       99     1583    1       IB=0;

   1583  4 000116   000000 450000 xsym               STZ     IB

      100     1584    1       IE=ATBLK_PG.FIR_INV_PGNO-2;

   1584  4 000117   000014 235100                    LDA     12,,PR0
         4 000120   000002 135007                    SBLA    2,DL
         4 000121   000000 755000 xsym               STA     IE

      101     1585    1       IF ATBLK_PG.MISC_INFO.CHKSM = %YES# THEN

   1585  4 000122   000030 236100                    LDQ     24,,PR0
         4 000123   200000 316003                    CANQ    65536,DU
         4 000124   000130 600000 4                  TZE     s:1588
PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:19   

      102     1586    1           CHSM = 1;

   1586  4 000125   000001 235007                    LDA     1,DL
         4 000126   003775 755000 0                  STA     CHSM
         4 000127   000131 710000 4                  TRA     s:1589

      103     1587    1       ELSE
      104     1588    1           CHSM = 0;

   1588  4 000130   003775 450000 0                  STZ     CHSM

      105     1589    1       INVPG$=ADDR(INV_BUF);

   1589  4 000131   000003 236000 5                  LDQ     3
         4 000132   000000 756000 xsym               STQ     INVPG$

      106     1590        /*
      107     1591        Determine if range of data pages is to be inventoried
      108     1592        */
      109     1593    1       IF ICNT = -1 THEN

   1593  4 000133   000000 235000 xsym               LDA     ICNT
         4 000134   000004 115000 5                  CMPA    4
         4 000135   000144 601000 4                  TNZ     s:1599

      110     1594    2       DO;

      111     1595    2           INIT_RG.FIRNG(0) = 1; /*beginning data page #*/

   1595  4 000136   000001 235007                    LDA     1,DL
         4 000137   000000 755000 xsym               STA     INIT_RG

      112     1596    2           INIT_RG.SECRNG(0) = ATBLK_PG.FIR_INV_PGNO -1; /*ending data page #*/

   1596  4 000140   000014 235100                    LDA     12,,PR0
         4 000141   000001 135007                    SBLA    1,DL
PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:20   
         4 000142   000001 755000 xsym               STA     INIT_RG+1

      113     1597    2           ICNT=0;

   1597  4 000143   000000 450000 xsym               STZ     ICNT

      114     1598    2           END;

      115     1599    1       BUFFER.TXT.MSG = '...Rebuilding inventory for AREA:';

   1599  4 000144   040000 100400                    MLR     fill='040'O
         4 000145   000000 000041 3                  ADSC9   0                        cn=0,n=33
         4 000146   000000 200043 xsym               ADSC9   BUFFER                   cn=1,n=35

      116     1600    1       BUFFER.TXT.AREA_NM = ZI$DIR.AREA_NM.NAME.TEXT;

   1600  4 000147   040000 100400                    MLR     fill='040'O
         4 000150   000234 200036 xsym               ADSC9   ZI$DIR+156               cn=1,n=30
         4 000151   000011 000140 xsym               ADSC9   BUFFER+9                 cn=0,n=96

      117     1601    1       BUFFER.CAR_CON = '001000001'B;

   1601  4 000152   101000 236003                    LDQ     33280,DU
         4 000153   000000 552040 xsym               STBQ    BUFFER,'40'O

      118     1602    1   /**/ DCBSF = DCBNUM(M$LO);

   1602  4 000154   000000 236007 xsym               LDQ     M$LO,DL
         4 000155   000000 620006                    EAX0    0,QL
         4 000156   000000 740000 xsym               STX0    DCBSF

      119     1603    1   /**/ BUFSF = VECTOR(BUFFER);

   1603  4 000157   000006 237000 5                  LDAQ    6
         4 000160   000000 755000 xsym               STA     BUFSF
         4 000161   000001 756000 xsym               STQ     BUFSF+1

PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:21   
      120     1604    1   /**/ BUFLNSF = 132;

   1604  4 000162   000204 235007                    LDA     132,DL
         4 000163   000000 755000 xsym               STA     BUFLNSF

      121     1605    1       CALL SYS_FUNC_WRIT;

   1605  4 000164   000000 631400 5                  EPPR1   0
         4 000165   000000 701000 xent               TSX1    SYS_FUNC_WRIT
         4 000166   000000 011000                    NOP     0

      122     1606    2       DO I = 0 TO ICNT BY 1;

   1606  4 000167   000000 450000 xsym               STZ     I
         4 000170   000577 710000 4                  TRA     s:1709+1

      123     1607    2           OUT_INDX=-1;

   1607  4 000171   000001 335007                    LCA     1,DL
         4 000172   000000 755000 xsym               STA     OUT_INDX

      124     1608    2           I_O_SIZE = 0;

   1608  4 000173   000000 450000 xsym               STZ     I_O_SIZE

      125     1609    2           RB =INIT_RG.FIRNG(I);

   1609  4 000174   000000 236000 xsym               LDQ     I
         4 000175   000001 736000                    QLS     1
         4 000176   000000 235006 xsym               LDA     INIT_RG,QL
         4 000177   000000 755000 xsym               STA     RB

      126     1610    2           RE = INIT_RG.SECRNG(I);

   1610  4 000200   000001 235006 xsym               LDA     INIT_RG+1,QL
         4 000201   000000 755000 xsym               STA     RE

PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:22   
      127     1611    2           IB=RB-1;

   1611  4 000202   000000 235000 xsym               LDA     RB
         4 000203   000001 135007                    SBLA    1,DL
         4 000204   000000 755000 xsym               STA     IB

      128     1612    2           IE=RE-1;

   1612  4 000205   000000 235000 xsym               LDA     RE
         4 000206   000001 135007                    SBLA    1,DL
         4 000207   000000 755000 xsym               STA     IE

      129     1613    2    /**/   DCBSF = ZI$DIR.AREA_NM.DCB#;

   1613  4 000210   000244 220000 xsym               LDX0    ZI$DIR+164
         4 000211   000000 740000 xsym               STX0    DCBSF

      130     1614    2    /**/   BUFSF = VECTOR(INV_BUF);

   1614  4 000212   000002 237000 5                  LDAQ    2
         4 000213   000000 755000 xsym               STA     BUFSF
         4 000214   000001 756000 xsym               STQ     BUFSF+1

      131     1615    2    /**/   BUFLNSF = 4096;

   1615  4 000215   010000 235007                    LDA     4096,DL
         4 000216   000000 755000 xsym               STA     BUFLNSF

      132     1616    2    /**/   FULLSF = %YES#;

   1616  4 000217   400000 236003                    LDQ     -131072,DU
         4 000220   000000 756000 xsym               STQ     FULLSF

      133     1617    2    /**/   ENCRP_SEEDSF = ZI$DIR.ENCP_SEED;

   1617  4 000221   000027 236000 xsym               LDQ     ZI$DIR+23
         4 000222   000000 756000 xsym               STQ     ENCRP_SEEDSF
PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:23   

      134     1618    2    /**/   KEYSF = %YES#;

   1618  4 000223   400000 236003                    LDQ     -131072,DU
         4 000224   000000 756000 xsym               STQ     KEYSF

      135     1619    2    /**/   KEYVSF.IDSKEY = ATBLK_PG.FIR_INV_PGNO;

   1619  4 000225   000000 470400 xsym               LDP0    ATBLK$
         4 000226   000000 100500                    MLR     fill='000'O
         4 000227   000014 000004                    ADSC9   12,,PR0                  cn=0,n=4
         4 000230   000000 200004 xsym               ADSC9   KEYVSF                   cn=1,n=4

      136     1620    2           CALL SYS_FUNC_READ ALTRET(ALTEND_ZIU$INRBT);
              1620                    /*Read to get the 1st  inventory page in */

   1620  4 000231   000000 631400 5                  EPPR1   0
         4 000232   000000 701000 xent               TSX1    SYS_FUNC_READ
         4 000233   000642 702000 4                  TSX2    ALTEND_ZIU$INRBT

      137     1621    3           DO RB=RB TO RE BY 1; /*Do through the range of the data pages*/

   1621  4 000234   000527 710000 4                  TRA     s:1690+3

      138     1622    3               IF BREAK_FLAG > 0 THEN

   1622  4 000235   000000 235000 xsym               LDA     BREAK_FLAG
         4 000236   000252 604400 4                  TMOZ    s:1628

      139     1623    4               DO;

      140     1624    4                   DCBSF = ZI$DIR.AREA_NM.DCB#;

   1624  4 000237   000244 220000 xsym               LDX0    ZI$DIR+164
         4 000240   000000 740000 xsym               STX0    DCBSF

      141     1625    4                   CALL SYS_FUNC_CLOS;
PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:24   

   1625  4 000241   000000 631400 5                  EPPR1   0
         4 000242   000000 701000 xent               TSX1    SYS_FUNC_CLOS
         4 000243   000000 011000                    NOP     0

      142     1626    4                   UNWIND TO RESTART;

   1626  4 000244   000100 100600                    MLR   ! fill='000'O
         4 000245   000000 000010 xsym               ADSC9   RESTART                  cn=0,n=8
         4 000246   200006 000010                    ADSC9   IDX+2,,AUTO              cn=0,n=8
         4 000247   200006 237300                    LDAQ  ! IDX+2,,AUTO
         4 000250   000000 700200 xent               TSX0  ! X66_AUNWIND
         4 000251   000000 000200                    ZERO    0,128

      143     1627    4                   END;
      144     1628    3               IF IB> 4071 THEN /*If inventroy page is full then write it out*/

   1628  4 000252   000000 236000 xsym               LDQ     IB
         4 000253   007750 116007                    CMPQ    4072,DL
         4 000254   000350 602000 4                  TNC     s:1658

      145     1629    4               DO;

      146     1630    4                   IB = 0;

   1630  4 000255   000000 450000 xsym               STZ     IB

      147     1631    4                   IE = IE - 4072;

   1631  4 000256   000000 236000 xsym               LDQ     IE
         4 000257   007750 136007                    SBLQ    4072,DL
         4 000260   000000 756000 xsym               STQ     IE

      148     1632    4                   IF CHSM = 1 THEN

   1632  4 000261   003775 235000 0                  LDA     CHSM
         4 000262   000001 115007                    CMPA    1,DL
PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:25   
         4 000263   000301 601000 4                  TNZ     s:1640

      149     1633    5                   DO;

      150     1634    5                       DATA$ = INVPG$; /* Set pointer up for checksum */

   1634  4 000264   000000 236000 xsym               LDQ     INVPG$
         4 000265   000000 756000 xsym               STQ     DATA$

      151     1635    5                       ICHKSUM = 0;

   1635  4 000266   000000 450000 xsym               STZ     ICHKSUM

      152     1636    5                       CALL CHKSUM;

   1636  4 000267   000000 631400 5                  EPPR1   0
         4 000270   000000 701000 xent               TSX1    CHKSUM
         4 000271   000000 011000                    NOP     0

      153     1637    5                       INV_PG.CHKSUM_WD = ICHKSUM;

   1637  4 000272   000000 470400 xsym               LDP0    INVPG$
         4 000273   000000 235000 xsym               LDA     ICHKSUM
         4 000274   000002 755100                    STA     2,,PR0

      154     1638    5                       DATA$ = ADDR(I_O_BUF(OUT_INDX));

   1638  4 000275   000000 236000 xsym               LDQ     OUT_INDX
         4 000276   000034 736000                    QLS     28
         4 000277   000000 036000 xsym               ADLQ    I_O_BUF$
         4 000300   000000 756000 xsym               STQ     DATA$

      155     1639    5                       END;

      156     1640    4    /**/           DCBSF = ZI$DIR.AREA_NM.DCB#;

   1640  4 000301   000244 220000 xsym               LDX0    ZI$DIR+164
PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:26   
         4 000302   000000 740000 xsym               STX0    DCBSF

      157     1641    4    /**/           BUFSF = VECTOR(INV_BUF);

   1641  4 000303   000002 237000 5                  LDAQ    2
         4 000304   000000 755000 xsym               STA     BUFSF
         4 000305   000001 756000 xsym               STQ     BUFSF+1

      158     1642    4    /**/           BUFLNSF = 4096;

   1642  4 000306   010000 235007                    LDA     4096,DL
         4 000307   000000 755000 xsym               STA     BUFLNSF

      159     1643    4    /**/           VFCSF = %NO#;

   1643  4 000310   000000 450000 xsym               STZ     VFCSF

      160     1644    4    /**/           FULLSF = %YES#;

   1644  4 000311   400000 236003                    LDQ     -131072,DU
         4 000312   000000 756000 xsym               STQ     FULLSF

      161     1645    4    /**/           NOTIMESF = %NO#;

   1645  4 000313   000000 450000 xsym               STZ     NOTIMESF

      162     1646    4    /**/           KEYVSF.IDSKEY = INV_PG_NO;

   1646  4 000314   000000 100400                    MLR     fill='000'O
         4 000315   003776 000004 0                  ADSC9   INV_PG_NO                cn=0,n=4
         4 000316   000000 200004 xsym               ADSC9   KEYVSF                   cn=1,n=4

      163     1647    4                   CALL SYS_FUNC_WRIT ALTRET(ALTEND_ZIU$INRBT);

   1647  4 000317   000000 631400 5                  EPPR1   0
         4 000320   000000 701000 xent               TSX1    SYS_FUNC_WRIT
         4 000321   000642 702000 4                  TSX2    ALTEND_ZIU$INRBT
PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:27   

      164     1648    4                   INV_PG_NO = INV_PG_NO + 1;

   1648  4 000322   003776 235000 0                  LDA     INV_PG_NO
         4 000323   000001 035007                    ADLA    1,DL
         4 000324   003776 755000 0                  STA     INV_PG_NO

      165     1649    4    /**/           DCBSF = ZI$DIR.AREA_NM.DCB#;

   1649  4 000325   000244 220000 xsym               LDX0    ZI$DIR+164
         4 000326   000000 740000 xsym               STX0    DCBSF

      166     1650    4    /**/           BUFSF = VECTOR(INV_BUF);

   1650  4 000327   000002 237000 5                  LDAQ    2
         4 000330   000000 755000 xsym               STA     BUFSF
         4 000331   000001 756000 xsym               STQ     BUFSF+1

      167     1651    4    /**/           BUFLNSF = 4096;

   1651  4 000332   010000 235007                    LDA     4096,DL
         4 000333   000000 755000 xsym               STA     BUFLNSF

      168     1652    4    /**/           FULLSF = %YES#;

   1652  4 000334   400000 236003                    LDQ     -131072,DU
         4 000335   000000 756000 xsym               STQ     FULLSF

      169     1653    4    /**/           ENCRP_SEEDSF = ZI$DIR.ENCP_SEED;

   1653  4 000336   000027 236000 xsym               LDQ     ZI$DIR+23
         4 000337   000000 756000 xsym               STQ     ENCRP_SEEDSF

      170     1654    4    /**/           KEYSF = %YES#;

   1654  4 000340   400000 236003                    LDQ     -131072,DU
         4 000341   000000 756000 xsym               STQ     KEYSF
PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:28   

      171     1655    4    /**/           KEYVSF.IDSKEY = INV_PG_NO;

   1655  4 000342   000000 100400                    MLR     fill='000'O
         4 000343   003776 000004 0                  ADSC9   INV_PG_NO                cn=0,n=4
         4 000344   000000 200004 xsym               ADSC9   KEYVSF                   cn=1,n=4

      172     1656    4                   CALL SYS_FUNC_READ ALTRET(ALTEND_ZIU$INRBT);
              1656                            /*Read in the next inventory page*/

   1656  4 000345   000000 631400 5                  EPPR1   0
         4 000346   000000 701000 xent               TSX1    SYS_FUNC_READ
         4 000347   000642 702000 4                  TSX2    ALTEND_ZIU$INRBT

      173     1657    4                   END;

      174     1658    3               IF OUT_INDX = I_O_SIZE-1 THEN

   1658  4 000350   000000 236000 xsym               LDQ     I_O_SIZE
         4 000351   000001 136007                    SBLQ    1,DL
         4 000352   000000 116000 xsym               CMPQ    OUT_INDX
         4 000353   000415 601000 4                  TNZ     s:1673

      175     1659    4               DO;

      176     1660    4                   I_O_SIZE = RE-RB+1;

   1660  4 000354   000000 236000 xsym               LDQ     RE
         4 000355   000000 136000 xsym               SBLQ    RB
         4 000356   000001 036007                    ADLQ    1,DL
         4 000357   000000 756000 xsym               STQ     I_O_SIZE

      177     1661    4                   IF I_O_SIZE > 32 THEN I_O_SIZE = 32;

   1661  4 000360   000040 116007                    CMPQ    32,DL
         4 000361   000364 604400 4                  TMOZ    s:1662

PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:29   
   1661  4 000362   000040 235007                    LDA     32,DL
         4 000363   000000 755000 xsym               STA     I_O_SIZE

      178     1662    4                   I_O_KEY = RB;

   1662  4 000364   000000 235000 xsym               LDA     RB
         4 000365   000000 755000 xsym               STA     I_O_KEY

      179     1663    4    /**/           DCBSF = ZI$DIR.AREA_NM.DCB#;

   1663  4 000366   000244 220000 xsym               LDX0    ZI$DIR+164
         4 000367   000000 740000 xsym               STX0    DCBSF

      180     1664    4    /**/           BUFSF = VECTOR(I_O_BUF);

   1664  4 000370   000002 235000 5                  LDA     2
         4 000371   000000 236000 xsym               LDQ     I_O_BUF$
         4 000372   000000 755000 xsym               STA     BUFSF
         4 000373   000001 756000 xsym               STQ     BUFSF+1

      181     1665    4    /**/           BUFLNSF = 4096 * I_O_SIZE;

   1665  4 000374   000000 235000 xsym               LDA     I_O_SIZE
         4 000375   000014 735000                    ALS     12
         4 000376   000000 755000 xsym               STA     BUFLNSF

      182     1666    4    /**/           FULLSF = %YES#;

   1666  4 000377   400000 236003                    LDQ     -131072,DU
         4 000400   000000 756000 xsym               STQ     FULLSF

      183     1667    4    /**/           ENCRP_SEEDSF = ZI$DIR.ENCP_SEED;

   1667  4 000401   000027 236000 xsym               LDQ     ZI$DIR+23
         4 000402   000000 756000 xsym               STQ     ENCRP_SEEDSF

      184     1668    4    /**/           KEYSF = %YES#;
PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:30   

   1668  4 000403   400000 236003                    LDQ     -131072,DU
         4 000404   000000 756000 xsym               STQ     KEYSF

      185     1669    4    /**/           KEYVSF.IDSKEY = I_O_KEY;

   1669  4 000405   000000 100400                    MLR     fill='000'O
         4 000406   000000 000004 xsym               ADSC9   I_O_KEY                  cn=0,n=4
         4 000407   000000 200004 xsym               ADSC9   KEYVSF                   cn=1,n=4

      186     1670    4                   CALL SYS_FUNC_READ ALTRET(ALTEND_ZIU$INRBT);

   1670  4 000410   000000 631400 5                  EPPR1   0
         4 000411   000000 701000 xent               TSX1    SYS_FUNC_READ
         4 000412   000642 702000 4                  TSX2    ALTEND_ZIU$INRBT

      187     1671    4                   OUT_INDX=-1;

   1671  4 000413   000001 335007                    LCA     1,DL
         4 000414   000000 755000 xsym               STA     OUT_INDX

      188     1672    4                   END;

      189     1673    3               OUT_INDX=OUT_INDX+1;

   1673  4 000415   000000 054000 xsym               AOS     OUT_INDX

      190     1674    3               DATA$=ADDR(I_O_BUF(OUT_INDX));

   1674  4 000416   000000 236000 xsym               LDQ     OUT_INDX
         4 000417   000034 736000                    QLS     28
         4 000420   000000 036000 xsym               ADLQ    I_O_BUF$
         4 000421   000000 756000 xsym               STQ     DATA$

      191     1675    3               WORK1=(DATA_PG.PG_SZ.SEC+(IU-1))/IU;

   1675  4 000422   000000 470400 xsym               LDP0    DATA$
PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:31   
         4 000423   000003 236100                    LDQ     3,,PR0
         4 000424   777777 376007                    ANQ     -1,DL
         4 000425   003774 036000 0                  ADLQ    IU
         4 000426   000001 136007                    SBLQ    1,DL
         4 000427   003774 235000 0                  LDA     IU
         4 000430   000433 605000 4                  TPL     s:1675+9
         4 000431   000000 236003                    LDQ     0,DU
         4 000432   000434 710000 4                  TRA     s:1675+10
         4 000433   003774 506000 0                  DIV     IU
         4 000434   000000 620006                    EAX0    0,QL
         4 000435   200003 740100                    STX0    WORK1,,AUTO

      192     1676    3               IF WORK1>511 THEN

   1676  4 000436   001000 100003                    CMPX0   512,DU
         4 000437   000446 602000 4                  TNC     s:1679

      193     1677    3                   INV_PG.INVENT_CT(IB)='777'O;

   1677  4 000440   000000 471400 xsym               LDP1    INVPG$
         4 000441   000000 235000 xsym               LDA     IB
         4 000442   000105 100400                    MLR     fill='000'O
         4 000443   000005 000001 5                  ADSC9   5                        cn=0,n=1
         4 000444   100006 000001                    ADSC9   6,A,PR1                  cn=0,n=1
         4 000445   000500 710000 4                  TRA     s:1685

      194     1678    3               ELSE
      195     1679    3                   IF (100*(DATA_PG.PG_SZ.FIR-DATA_PG.PG_SZ.SEC))/DATA_PG.PG_SZ.FIR

   1679  4 000446   000003 236100                    LDQ     3,,PR0
         4 000447   777777 376007                    ANQ     -1,DL
         4 000450   200006 756100                    STQ     IDX+2,,AUTO
         4 000451   000003 236100                    LDQ     3,,PR0
         4 000452   000022 772000                    QRL     18
         4 000453   200006 136100                    SBLQ    IDX+2,,AUTO
         4 000454   200007 756100                    STQ     IDX+3,,AUTO
         4 000455   000003 236100                    LDQ     3,,PR0
PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:32   
         4 000456   000022 772000                    QRL     18
         4 000457   200010 756100                    STQ     IDX+4,,AUTO
         4 000460   200007 236100                    LDQ     IDX+3,,AUTO
         4 000461   000144 402007                    MPY     100,DL
         4 000462   200010 506100                    DIV     IDX+4,,AUTO
         4 000463   004003 116000 0                  CMPQ    PCNT_INV
         4 000464   000473 605000 4                  TPL     s:1683

      196     1680    3                      < PCNT_INV THEN
      197     1681    3                       INV_PG.INVENT_CT(IB)='777'O;

   1681  4 000465   000000 471400 xsym               LDP1    INVPG$
         4 000466   000000 235000 xsym               LDA     IB
         4 000467   000105 100400                    MLR     fill='000'O
         4 000470   000005 000001 5                  ADSC9   5                        cn=0,n=1
         4 000471   100006 000001                    ADSC9   6,A,PR1                  cn=0,n=1
         4 000472   000500 710000 4                  TRA     s:1685

      198     1682    3                   ELSE
      199     1683    3                       INV_PG.INVENT_CT(IB)=WORK2(1);

   1683  4 000473   000000 471400 xsym               LDP1    INVPG$
         4 000474   000000 235000 xsym               LDA     IB
         4 000475   000105 100500                    MLR     fill='000'O
         4 000476   200003 200001                    ADSC9   WORK1,,AUTO              cn=1,n=1
         4 000477   100006 000001                    ADSC9   6,A,PR1                  cn=0,n=1

      200     1684         /* In any case if all the keys are used - mark pg full */
      201     1685    3               IF DATA_PG.OFF_LN.FIR = 0 AND

   1685  4 000500   000000 470400 xsym               LDP0    DATA$
         4 000501   000005 221100                    LDX1    5,,PR0
         4 000502   000521 601000 4                  TNZ     s:1689
         4 000503   004004 235000 0                  LDA     KEYS_PR_PGE
         4 000504   000001 135007                    SBLA    1,DL
         4 000505   200006 755100                    STA     IDX+2,,AUTO
         4 000506   000005 236100                    LDQ     5,,PR0
PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:33   
         4 000507   777777 376007                    ANQ     -1,DL
         4 000510   200006 116100                    CMPQ    IDX+2,,AUTO
         4 000511   000521 604000 4                  TMI     s:1689
         4 000512   001777 721100                    LXL1    1023,,PR0
         4 000513   000521 604000 4                  TMI     s:1689

      202     1686    3                  DATA_PG.OFF_LN.SEC>=KEYS_PR_PGE-1 AND
      203     1687    3                  DATA_PG.ACT_DATA_18(2035)>=0 THEN /* LINE 0 NOT AVAIL */
      204     1688    3                   INV_PG.INVENT_CT(IB) = '000'O;

   1688  4 000514   000000 471400 xsym               LDP1    INVPG$
         4 000515   000000 235000 xsym               LDA     IB
         4 000516   000105 100400                    MLR     fill='000'O
         4 000517   000000 000001 5                  ADSC9   0                        cn=0,n=1
         4 000520   100006 000001                    ADSC9   6,A,PR1                  cn=0,n=1

      205     1689    3               IB=IB+1;

   1689  4 000521   000000 235000 xsym               LDA     IB
         4 000522   000001 035007                    ADLA    1,DL
         4 000523   000000 755000 xsym               STA     IB

      206     1690    3               END;

   1690  4 000524   000000 236000 xsym               LDQ     RB
         4 000525   000001 036007                    ADLQ    1,DL
         4 000526   000000 756000 xsym               STQ     RB
         4 000527   000000 236000 xsym               LDQ     RE
         4 000530   000000 116000 xsym               CMPQ    RB
         4 000531   000235 603000 4                  TRC     s:1622

      207     1691    2           IF CHSM = 1 THEN

   1691  4 000532   003775 235000 0                  LDA     CHSM
         4 000533   000001 115007                    CMPA    1,DL
         4 000534   000552 601000 4                  TNZ     s:1699

PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:34   
      208     1692    3           DO;

      209     1693    3               DATA$ = INVPG$; /* Set pointer up for checksum */

   1693  4 000535   000000 236000 xsym               LDQ     INVPG$
         4 000536   000000 756000 xsym               STQ     DATA$

      210     1694    3               ICHKSUM = 0;

   1694  4 000537   000000 450000 xsym               STZ     ICHKSUM

      211     1695    3               CALL CHKSUM;

   1695  4 000540   000000 631400 5                  EPPR1   0
         4 000541   000000 701000 xent               TSX1    CHKSUM
         4 000542   000000 011000                    NOP     0

      212     1696    3               INV_PG.CHKSUM_WD = ICHKSUM;

   1696  4 000543   000000 470400 xsym               LDP0    INVPG$
         4 000544   000000 235000 xsym               LDA     ICHKSUM
         4 000545   000002 755100                    STA     2,,PR0

      213     1697    3               DATA$ = ADDR(I_O_BUF(OUT_INDX));

   1697  4 000546   000000 236000 xsym               LDQ     OUT_INDX
         4 000547   000034 736000                    QLS     28
         4 000550   000000 036000 xsym               ADLQ    I_O_BUF$
         4 000551   000000 756000 xsym               STQ     DATA$

      214     1698    3               END;

      215     1699    2       /**/DCBSF = ZI$DIR.AREA_NM.DCB#;

   1699  4 000552   000244 220000 xsym               LDX0    ZI$DIR+164
         4 000553   000000 740000 xsym               STX0    DCBSF

PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:35   
      216     1700    2    /**/   BUFSF = VECTOR(INV_BUF);

   1700  4 000554   000002 237000 5                  LDAQ    2
         4 000555   000000 755000 xsym               STA     BUFSF
         4 000556   000001 756000 xsym               STQ     BUFSF+1

      217     1701    2    /**/   BUFLNSF = 4096;

   1701  4 000557   010000 235007                    LDA     4096,DL
         4 000560   000000 755000 xsym               STA     BUFLNSF

      218     1702    2    /**/   VFCSF = %NO#;

   1702  4 000561   000000 450000 xsym               STZ     VFCSF

      219     1703    2    /**/   NOTIMESF = %NO#;

   1703  4 000562   000000 450000 xsym               STZ     NOTIMESF

      220     1704    2    /**/   KEYVSF.IDSKEY = INV_PG_NO;

   1704  4 000563   000000 100400                    MLR     fill='000'O
         4 000564   003776 000004 0                  ADSC9   INV_PG_NO                cn=0,n=4
         4 000565   000000 200004 xsym               ADSC9   KEYVSF                   cn=1,n=4

      221     1705    2    /**/   FULLSF = %YES#;

   1705  4 000566   400000 236003                    LDQ     -131072,DU
         4 000567   000000 756000 xsym               STQ     FULLSF

      222     1706    2    /**/   WAITSF = %YES#;

   1706  4 000570   000000 756000 xsym               STQ     WAITSF

      223     1707    2    /**/   ENCRP_SEEDSF = ZI$DIR.ENCP_SEED;

   1707  4 000571   000027 236000 xsym               LDQ     ZI$DIR+23
PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:36   
         4 000572   000000 756000 xsym               STQ     ENCRP_SEEDSF

      224     1708    2           CALL SYS_FUNC_WRIT ALTRET(ALTEND_ZIU$INRBT);

   1708  4 000573   000000 631400 5                  EPPR1   0
         4 000574   000000 701000 xent               TSX1    SYS_FUNC_WRIT
         4 000575   000642 702000 4                  TSX2    ALTEND_ZIU$INRBT

      225     1709    2           END;

   1709  4 000576   000000 054000 xsym               AOS     I
         4 000577   000000 236000 xsym               LDQ     I
         4 000600   000000 116000 xsym               CMPQ    ICNT
         4 000601   000171 604400 4                  TMOZ    s:1607

      226     1710    1   END_ZIU$INRBT:
      227     1711    1   /**/ DCBSF = ZI$DIR.AREA_NM.DCB#;

   1711  4 000602   000244 220000 xsym  END_ZIU$INR* LDX0    ZI$DIR+164
         4 000603   000000 740000 xsym               STX0    DCBSF

      228     1712    1       IF IDX THEN

   1712  4 000604   200004 234100                    SZN     IDX,,AUTO
         4 000605   000615 605000 4                  TPL     s:1718

      229     1713    2       DO;

      230     1714    2           BUFFER.TXT.MSG = '...Rebuild skipped for INDEX AREA:  ';

   1714  4 000606   040000 100400                    MLR     fill='040'O
         4 000607   000011 000043 3                  ADSC9   9                        cn=0,n=35
         4 000610   000000 200043 xsym               ADSC9   BUFFER                   cn=1,n=35

      231     1715    2           BUFFER.TXT.AREA_NM = ZI$DIR.AREA_NM.NAME.TEXT;

   1715  4 000611   040000 100400                    MLR     fill='040'O
PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:37   
         4 000612   000234 200036 xsym               ADSC9   ZI$DIR+156               cn=1,n=30
         4 000613   000011 000140 xsym               ADSC9   BUFFER+9                 cn=0,n=96

      232     1716    2           END;

   1716  4 000614   000623 710000 4                  TRA     s:1721

      233     1717    2       ELSE DO;

      234     1718    2           BUFFER.TXT.MSG = '    Rebuild completed';

   1718  4 000615   040000 100400                    MLR     fill='040'O
         4 000616   000022 000025 3                  ADSC9   18                       cn=0,n=21
         4 000617   000000 200043 xsym               ADSC9   BUFFER                   cn=1,n=35

      235     1719    2           BUFFER.TXT.AREA_NM = '  ';

   1719  4 000620   040000 100400                    MLR     fill='040'O
         4 000621   000022 000002 3                  ADSC9   18                       cn=0,n=2
         4 000622   000011 000140 xsym               ADSC9   BUFFER+9                 cn=0,n=96

      236     1720    2           END;

      237     1721    1       CALL SYS_FUNC_CLOS;

   1721  4 000623   000000 631400 5                  EPPR1   0
         4 000624   000000 701000 xent               TSX1    SYS_FUNC_CLOS
         4 000625   000000 011000                    NOP     0

      238     1722    1   /**/ DCBSF = DCBNUM(M$LO);

   1722  4 000626   000000 236007 xsym               LDQ     M$LO,DL
         4 000627   000000 620006                    EAX0    0,QL
         4 000630   000000 740000 xsym               STX0    DCBSF

      239     1723    1   /**/ BUFSF = VECTOR(BUFFER);

PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:38   
   1723  4 000631   000006 237000 5                  LDAQ    6
         4 000632   000000 755000 xsym               STA     BUFSF
         4 000633   000001 756000 xsym               STQ     BUFSF+1

      240     1724    1   /**/ BUFLNSF = 132;

   1724  4 000634   000204 235007                    LDA     132,DL
         4 000635   000000 755000 xsym               STA     BUFLNSF

      241     1725    1       CALL SYS_FUNC_WRIT;

   1725  4 000636   000000 631400 5                  EPPR1   0
         4 000637   000000 701000 xent               TSX1    SYS_FUNC_WRIT
         4 000640   000000 011000                    NOP     0

      242     1726    1       RETURN;

   1726  4 000641   000000 702200 xent               TSX2  ! X66_ARET

      243     1727    1   ALTEND_ZIU$INRBT:
      244     1728    1   /**/ DCBSF = ZI$DIR.AREA_NM.DCB#;

   1728  4 000642   000244 220000 xsym  ALTEND_ZIU$* LDX0    ZI$DIR+164
         4 000643   000000 740000 xsym               STX0    DCBSF

      245     1729    1       CALL SYS_FUNC_CLOS;

   1729  4 000644   000000 631400 5                  EPPR1   0
         4 000645   000000 701000 xent               TSX1    SYS_FUNC_CLOS
         4 000646   000000 011000                    NOP     0

      246     1730    1       RETURN;

   1730  4 000647   000000 702200 xent               TSX2  ! X66_ARET

INV_BUF
 Sect OctLoc
PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:39   
   0     000   ****** ******   ****** ******   ****** ******   ****** ******    ................

ZERO_DATA
 Sect OctLoc
   0    2000   000000 000000   000000 000000   000000 000000   000000 000000    ................
   0    3770*  000000 000000   000000 000000                                    ........

INV_PG_NO
 Sect OctLoc
   0    3776   000000 000000                                                    ....

DATA_PG_NO
 Sect OctLoc
   0    3777   000000 000000                                                    ....

READ_FLAG
 Sect OctLoc
   0    4000   000000 000000                                                    ....

FIRST_INV_PG
 Sect OctLoc
   0    4001   000000 000000                                                    ....

FIRST_DATA_PG
 Sect OctLoc
   0    4002   000000 000000                                                    ....

PCNT_INV
 Sect OctLoc
   0    4003   000000 000000                                                    ....

KEYS_PR_PGE
 Sect OctLoc
   0    4004   000000 000000                                                    ....

(unnamed)
 Sect OctLoc
PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:40   
   3     000   056056 056122   145142 165151   154144 151156   147040 151156    ...Rebuilding in
   3     004   166145 156164   157162 171040   146157 162040   101122 105101    ventory for AREA
   3     010   072040 040040   056056 056122   145142 165151   154144 040163    :   ...Rebuild s
   3     014   153151 160160   145144 040146   157162 040111   116104 105130    kipped for INDEX
   3     020   040101 122105   101072 040040   040040 040040   122145 142165     AREA:      Rebu
   3     024   151154 144040   143157 155160   154145 164145   144040 040040    ild completed

(unnamed)
 Sect OctLoc
   5     000   000000 000000   000000 006003   001777 777640   000000 006000    ................
   5     004   777777 777777   777000 000000   000040 777640   000000 006000    ......... ......
      247     1731    1   END ZIU$INRBT;

PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:41   
--  Include file information  --

   ZI_GLOBAL_DBUTIL.:ZIC0TOU  is referenced.
   ZI$PG_STRUCTS.:ZIC0TOU  is referenced.
   ZI$DIR.:ZIC0TOU  is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure ZIU$INRBT.

   Procedure ZIU$INRBT requires 424 words for executable code.
   Procedure ZIU$INRBT requires 10 words of local(AUTO) storage.

    No errors detected in file ZIU$INRBT.:ZIC0TSI    .
PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:42   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:43   
          MINI XREF LISTING

ACSSF
      1466**DCL      1549<<ASSIGN
ALTEND_ZIU$INRBT
      1728**LABEL    1552--CALLALT  1570--CALLALT  1620--CALLALT  1647--CALLALT  1656--CALLALT  1670--CALLALT
      1708--CALLALT
ASNSF
      1469**DCL      1550<<ASSIGN
ATBLK$
      1161**DCL      1162--IMP-PTR  1571<<ASSIGN   1572>>IF       1576>>ASSIGN   1577>>ASSIGN   1578>>ASSIGN
      1579>>ASSIGN   1584>>ASSIGN   1585>>IF       1596>>ASSIGN   1619>>ASSIGN
ATBLK_PG.AREA_NM
      1187**DCL      1188--REDEF
ATBLK_PG.DB_INFO.PRCNT_INV
      1173**DCL      1577>>ASSIGN
ATBLK_PG.FIR_INV_PGNO
      1184**DCL      1572>>IF       1579>>ASSIGN   1584>>ASSIGN   1596>>ASSIGN   1619>>ASSIGN
ATBLK_PG.LINE_INFO.LPP
      1182**DCL      1578>>ASSIGN
ATBLK_PG.MISC_INFO.CHKSM
      1192**DCL      1585>>IF
ATBLK_PG.MISC_INFO.IUSZ
      1194**DCL      1576>>ASSIGN
ATBLK_PG.STATUS
      1196**DCL      1204--REDEF
BREAK_FLAG
      1441**DCL      1622>>IF
BUFFER
        29**DCL      1603--ASSIGN   1723--ASSIGN
BUFFER.CAR_CON
        30**DCL      1601<<ASSIGN
BUFFER.TXT.AREA_NM
        33**DCL      1600<<ASSIGN   1715<<ASSIGN   1719<<ASSIGN
PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:44   
BUFFER.TXT.MSG
        32**DCL      1599<<ASSIGN   1714<<ASSIGN   1718<<ASSIGN
BUFLNSF
      1477**DCL      1565<<ASSIGN   1604<<ASSIGN   1615<<ASSIGN   1642<<ASSIGN   1651<<ASSIGN   1665<<ASSIGN
      1701<<ASSIGN   1724<<ASSIGN
BUFSF
      1478**DCL      1564<<ASSIGN   1603<<ASSIGN   1614<<ASSIGN   1641<<ASSIGN   1650<<ASSIGN   1664<<ASSIGN
      1700<<ASSIGN   1723<<ASSIGN
CHKSUM
        41**DCL-ENT  1636--CALL     1695--CALL
CHSM
        19**DCL      1586<<ASSIGN   1588<<ASSIGN   1632>>IF       1691>>IF
COUNTSF
      1528**DCL      1529--REDEF
DATA$
      1126**DCL      1127--IMP-PTR  1634<<ASSIGN   1638<<ASSIGN   1674<<ASSIGN   1675>>ASSIGN   1679>>IF
      1679>>IF       1679>>IF       1685>>IF       1685>>IF       1685>>IF       1693<<ASSIGN   1697<<ASSIGN
DATA_PG.ACT_DATA
      1139**DCL      1140--REDEF    1141--REDEF    1142--REDEF
DATA_PG.ACT_DATA_18
      1140**DCL      1685>>IF
DATA_PG.OFF_LN.FIR
      1137**DCL      1685>>IF
DATA_PG.OFF_LN.SEC
      1138**DCL      1685>>IF
DATA_PG.PG_SZ.FIR
      1133**DCL      1679>>IF       1679>>IF
DATA_PG.PG_SZ.SEC
      1134**DCL      1675>>ASSIGN   1679>>IF
DATA_PG_NO
        21**DCL      1582<<ASSIGN
DCBSF
      1457**DCL      1543<<ASSIGN   1602<<ASSIGN   1613<<ASSIGN   1624<<ASSIGN   1640<<ASSIGN   1649<<ASSIGN
      1663<<ASSIGN   1699<<ASSIGN   1711<<ASSIGN   1722<<ASSIGN   1728<<ASSIGN
ENCRP_SEEDSF
      1486**DCL      1487--REDEF    1567<<ASSIGN   1617<<ASSIGN   1653<<ASSIGN   1667<<ASSIGN   1707<<ASSIGN
PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:45   
END_ZIU$INRBT
      1711**LABEL    1556--GOTO     1572--GOTO
ERRCODESF
      1488**DCL      1493--REDEF
F$DCB.ACTPOS
       854**DCL       854--REDEF
F$DCB.ARS#
       828**DCL       828--REDEF
F$DCB.ATTR
       847**DCL       848--REDEF
F$DCB.BORROW
       862**DCL       862--REDEF     862--REDEF     862--REDEF
F$DCB.DCBNAME.L
       876**DCL       876--IMP-SIZ
F$DCB.EOMCHAR#
       832**DCL       832--REDEF
F$DCB.FLDID
       857**DCL       857--REDEF
F$DCB.FORM$
       851**DCL       851--REDEF
F$DCB.FSECT
       867**DCL       867--REDEF
F$DCB.FSN#
       844**DCL       844--REDEF     844--REDEF     845--REDEF
F$DCB.HEADER$
       850**DCL       850--REDEF
F$DCB.IXTNSIZE#
       848**DCL       848--REDEF
F$DCB.LASTSTA$
       837**DCL       837--REDEF
F$DCB.LVL
       863**DCL       863--REDEF
F$DCB.NAME#.C
       838**DCL       838--REDEF
F$DCB.NOEOF
       860**DCL       860--REDEF
PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:46   
F$DCB.NRECS#
       849**DCL       849--REDEF
F$DCB.NRECX
       868**DCL       868--REDEF
F$DCB.OHDR
       860**DCL       860--REDEF
F$DCB.ORG#
       843**DCL       843--REDEF    1553>>IF
F$DCB.PRECNO
       866**DCL       866--REDEF
F$DCB.RCSZ
       872**DCL       872--REDEF
F$DCB.RES#
       839**DCL       839--REDEF
F$DCB.SETX
       851**DCL       851--REDEF
F$DCB.TAB$
       851**DCL       851--REDEF
F$DCB.TDA
       865**DCL       866--REDEF
F$DCB.WSN#
       839**DCL       839--REDEF
FIDSF
      1505**DCL      1551<<ASSIGN
FIDSF_RD
      1504**DCL      1505--REDEF
FIRST_DATA_PG
        24**DCL      1580<<ASSIGN   1582>>ASSIGN
FIRST_INV_PG
        23**DCL      1579<<ASSIGN   1581>>ASSIGN
FULLSF
      1475**DCL      1546<<ASSIGN   1566<<ASSIGN   1616<<ASSIGN   1644<<ASSIGN   1652<<ASSIGN   1666<<ASSIGN
      1705<<ASSIGN
FUNSF
      1468**DCL      1547<<ASSIGN
HELPCODE
PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:47   
      1522**DCL      1527--REDEF
I
      1415**DCL      1606<<DOINDEX  1609>>ASSIGN   1610>>ASSIGN
IB
      1405**DCL      1583<<ASSIGN   1611<<ASSIGN   1628>>IF       1630<<ASSIGN   1677>>ASSIGN   1681>>ASSIGN
      1683>>ASSIGN   1688>>ASSIGN   1689<<ASSIGN   1689>>ASSIGN
ICHKSUM
      1442**DCL      1443--REDEF    1635<<ASSIGN   1637>>ASSIGN   1694<<ASSIGN   1696>>ASSIGN
ICNT
      1407**DCL      1593>>IF       1597<<ASSIGN   1606>>DOINDEX
IDX
        34**DCL      1555<<ASSIGN   1558<<ASSIGN   1712>>IF
IE
      1404**DCL      1584<<ASSIGN   1612<<ASSIGN   1631<<ASSIGN   1631>>ASSIGN
INIT_RG.FIRNG
      1012**DCL      1595<<ASSIGN   1609>>ASSIGN
INIT_RG.SECRNG
      1013**DCL      1596<<ASSIGN   1610>>ASSIGN
INVPG$
      1145**DCL      1146--IMP-PTR  1589<<ASSIGN   1634>>ASSIGN   1637>>ASSIGN   1677>>ASSIGN   1681>>ASSIGN
      1683>>ASSIGN   1688>>ASSIGN   1693>>ASSIGN   1696>>ASSIGN
INV_BUF
        15**DCL      1589--ASSIGN   1614--ASSIGN   1641--ASSIGN   1650--ASSIGN   1700--ASSIGN
INV_PG.CHKSUM_WD
      1150**DCL      1637<<ASSIGN   1696<<ASSIGN
INV_PG.INVENT_CT
      1158**DCL      1677<<ASSIGN   1681<<ASSIGN   1683<<ASSIGN   1688<<ASSIGN
INV_PG_NO
        20**DCL      1581<<ASSIGN   1646>>ASSIGN   1648<<ASSIGN   1648>>ASSIGN   1655>>ASSIGN   1704>>ASSIGN
IU
        18**DCL      1576<<ASSIGN   1675>>ASSIGN   1675>>ASSIGN
I_O_BUF
      1421**DCL      1564--ASSIGN   1571--ASSIGN   1638--ASSIGN   1664--ASSIGN   1674--ASSIGN   1697--ASSIGN
I_O_BUF$
      1420**DCL      1421--IMP-PTR  1564>>ASSIGN   1571>>ASSIGN   1638>>ASSIGN   1664>>ASSIGN   1674>>ASSIGN
      1697>>ASSIGN
PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:48   
I_O_KEY
      1439**DCL      1562<<ASSIGN   1569>>ASSIGN   1662<<ASSIGN   1669>>ASSIGN
I_O_SIZE
      1423**DCL      1608<<ASSIGN   1658>>IF       1660<<ASSIGN   1661>>IF       1661<<ASSIGN   1665>>ASSIGN
KEYSF
      1459**DCL      1568<<ASSIGN   1618<<ASSIGN   1654<<ASSIGN   1668<<ASSIGN
KEYS_PR_PGE
        26**DCL      1578<<ASSIGN   1685>>IF
KEYVSF
      1460**DCL      1465--REDEF
KEYVSF.IDSKEY
      1463**DCL      1569<<ASSIGN   1619<<ASSIGN   1646<<ASSIGN   1655<<ASSIGN   1669<<ASSIGN   1704<<ASSIGN
KEYVSF.WD_ONE
      1462**DCL      1463--REDEF
M$LO
      1430**DCL      1602>>ASSIGN   1722>>ASSIGN
MSGCODE
      1494**DCL      1495--REDEF
NOTIMESF
      1467**DCL      1645<<ASSIGN   1703<<ASSIGN
ORGSF
      1458**DCL      1545<<ASSIGN
OUT_INDX
      1422**DCL      1563<<ASSIGN   1571>>ASSIGN   1607<<ASSIGN   1638>>ASSIGN   1658>>IF       1671<<ASSIGN
      1673<<ASSIGN   1673>>ASSIGN   1674>>ASSIGN   1697>>ASSIGN
PCNT_INV
        25**DCL      1577<<ASSIGN   1679>>IF
RB
      1402**DCL      1609<<ASSIGN   1611>>ASSIGN   1621<<DOINDEX  1621>>DOINDEX  1660>>ASSIGN   1662>>ASSIGN
RE
      1403**DCL      1610<<ASSIGN   1612>>ASSIGN   1621>>DOINDEX  1660>>ASSIGN
REC$
      1401**DCL      1424--IMP-PTR
REC_DATA_LN
      1429**DCL      1428--IMP-SIZ
RESTART
PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:49   
      1440**DCL      1626>>UNWIND
SHARESF
      1508**DCL      1548<<ASSIGN
SYS_FUNC_CLOS
        37**DCL-ENT  1625--CALL     1721--CALL     1729--CALL
SYS_FUNC_OPEN
        36**DCL-ENT  1552--CALL
SYS_FUNC_READ
        38**DCL-ENT  1570--CALL     1620--CALL     1656--CALL     1670--CALL
SYS_FUNC_WRIT
        40**DCL-ENT  1605--CALL     1647--CALL     1708--CALL     1725--CALL
TESTSF
      1470**DCL      1544<<ASSIGN
VFCSF
      1474**DCL      1643<<ASSIGN   1702<<ASSIGN
WAITSF
      1473**DCL      1706<<ASSIGN
WORK1
        27**DCL        28--REDEF    1675<<ASSIGN   1676>>IF
WORK2
        28**DCL      1683>>ASSIGN
ZI$DIR.ALTKEY
       950**DCL       951--REDEF     952--REDEF
ZI$DIR.AREAFID
       916**DCL       917--REDEF
ZI$DIR.AREA_NM.DCB#
       983**DCL      1543>>ASSIGN   1553--IF       1613>>ASSIGN   1624>>ASSIGN   1640>>ASSIGN   1649>>ASSIGN
      1663>>ASSIGN   1699>>ASSIGN   1711>>ASSIGN   1728>>ASSIGN
ZI$DIR.AREA_NM.NAME.TEXT
       982**DCL      1551>>ASSIGN   1600>>ASSIGN   1715>>ASSIGN
ZI$DIR.DATE
       955**DCL       959--REDEF
ZI$DIR.DEST_SEED
       911**DCL       912--REDEF     913--REDEF
ZI$DIR.ENCP_SEED
       908**DCL       909--REDEF     910--REDEF    1567>>ASSIGN   1617>>ASSIGN   1653>>ASSIGN   1667>>ASSIGN
PL6.E3A0      #001=ZIU$INRBT File=ZIU$INRBT.:ZIC0TSI                             FRI 09/05/97 13:16 Page:50   
      1707>>ASSIGN
ZI$DIR.REPRT_ZERO
       942**DCL       943--REDEF
ZI$DIR.SCHFID
       914**DCL       915--REDEF
ZI$DIR.TIME
       960**DCL       965--REDEF
