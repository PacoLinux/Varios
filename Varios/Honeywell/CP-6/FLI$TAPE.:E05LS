VERSION E05

PL6.E3A0      #001=FLI$TAPE_IO_INIT File=FLI$TAPE.:E05TSI                        TUE 07/29/97 15:55 Page:1    
        1        1        /*M* FLI$TAPE - EFT I/O routines - tape I/O */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* THI=1,PLM=3 */
        8        8        FLI$TAPE_IO_INIT: PROC;
        9        9        /*F*  NAME: FLI$TAPE_IO_INIT
       10       10              PURPOSE: Sets up global tape open FPT with specified
       11       11                 arguments; gets necessary DCBs.
       12       12         */
       13       13
       14       14         /***
       15       15          *** INCLUDE
       16       16          ***/
       17       17
       18       18        %INCLUDE CP_6_SUBS;
       19      558        %INCLUDE CP_6;
       20     6117        %INCLUDE FLI_DATA_R;
       21     7531
       22     7532         /***
       23     7533          *** ENTRY
       24     7534          ***/
       25     7535
       26     7536    1   DCL FLI$ALLOC ENTRY(2);
       27     7537
       28     7538         /***
       29     7539          *** STATIC
       30     7540          ***/
       31     7541
       32     7542    1   DCL 1 DCBNAME STATIC,                   /* Name used for tape DCBs            */
       33     7543    1         2 * UBIN BYTE INIT(LENGTHC('M$TAPExx')) CALIGNED,
       34     7544    1         2 * CHAR(0) INIT('M$TAPE'),
       35     7545    1         2 NUM_ID CHAR(2);
       36     7546
       37     7547    1   DCL RETURNED_DCB# SBIN STATIC;          /* DCB# returned by M$GETDCB          */
PL6.E3A0      #001=FLI$TAPE_IO_INIT File=FLI$TAPE.:E05TSI                        TUE 07/29/97 15:55 Page:2    
       38     7548
       39     7549         /***
       40     7550          *** AUTO
       41     7551          ***/
       42     7552
       43     7553    1   DCL I SBIN AUTO;
       44     7554    1   DCL SNLISTINFO$ PTR AUTO;
       45     7555
       46     7556         /***
       47     7557          *** FPT
       48     7558          ***/
       49     7559
       50     7560        %FPT_GETDCB( FPTN=GET_TAPE_DCB,
       51     7561                     DCBNAME=DCBNAME,
       52     7562                     DCBNUM=RETURNED_DCB#,
       53     7563                     MERGE=NO );
       54     7578
       55     7579         /***
       56     7580          *** BASED
       57     7581          ***/
       58     7582
       59     7583        %SNLISTINFO( STCLASS="BASED(SNLISTINFO$)" );
       60     7586
       61     7587        %VLP_SN( FPTN=VLP_SN,
       62     7588                 STCLASS=BASED );
       63     7601
       64     7602        /****************************************/
       65     7603
       66     7604         /***
       67     7605          *** Set up serial number vector list.
       68     7606          ***/
       69     7607
       70     7608    1      CALL FLI$ALLOC( SIZEW(SNVECLIST(0))*NBR_SNLISTS, SNVECLIST$ );
       71     7609
       72     7610    1      SNLISTINFO$ = LAST_SNLISTINFO$;
       73     7611    1      I = NBR_SNLISTS;
       74     7612    2      DO WHILE( SNLISTINFO$ ~= ADDR(NIL) );
PL6.E3A0      #001=FLI$TAPE_IO_INIT File=FLI$TAPE.:E05TSI                        TUE 07/29/97 15:55 Page:3    
       75     7613    2         TVECTOR = VECTOR(SNLISTINFO.SNLIST$->VLP_SN);
       76     7614    2         TVECTOR.W1.VSIZE# = LENGTHC(VLP_SN.NUM#)
       77     7615    2           + SNLISTINFO.SNLIST$->VLP_SN.NUM# * LENGTHC(VLP_SN.SN#(0))
       78     7616    2           - 1;
       79     7617    2         I = I - 1;
       80     7618    2         SNVECLIST.SN_(I) = TVECTOR;
       81     7619    2         SNLISTINFO$ = SNLISTINFO.PREVINFO$;
       82     7620    2         END;
       83     7621
       84     7622         /***
       85     7623          *** Set up DCB number list.
       86     7624          ***/
       87     7625
       88     7626    1      CALL FLI$ALLOC( SIZEW(TAPE_DCBLIST(0))*NBR_SNLISTS, TAPE_DCBLIST$ );
       89     7627
       90     7628    2      DO I=0 TO NBR_SNLISTS - 1;
       91     7629    2         CALL BINCHAR( DCBNAME.NUM_ID, I );
       92     7630    2         CALL M$GETDCB( GET_TAPE_DCB );
       93     7631    2         TAPE_DCBLIST.DCB#(I) = RETURNED_DCB#;
       94     7632    2         TAPE_DCBLIST.DCB$(I) = DCBADDR(RETURNED_DCB#);
       95     7633    2         END;
       96     7634
       97     7635        /***
       98     7636         *** Save beginning volume number.
       99     7637         ***/
      100     7638
      101     7639    1      FIRST_TAPE_VOL = TAPE_OPEN.V.VOL#;
      102     7640
      103     7641    1      RETURN;
      104     7642
      105     7643    1   END FLI$TAPE_IO_INIT;
      106     7644        %EOD;

PL6.E3A0      #001=FLI$TAPE_IO_INIT File=FLI$TAPE.:E05TSI                        TUE 07/29/97 15:55 Page:4    
--  Include file information  --

   B_MICROPS_C.:E05TOU  is referenced.
   FLB_SUBS_C.:E05TOU  is referenced.
   FLI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
      No diagnostics issued in procedure FLI$TAPE_IO_INIT.

   Procedure FLI$TAPE_IO_INIT requires 82 words for executable code.
   Procedure FLI$TAPE_IO_INIT requires 10 words of local(AUTO) storage.

PL6.E3A0      #001=FLI$TAPE_IO_INIT File=FLI$TAPE.:E05TSI                        TUE 07/29/97 15:55 Page:5    

 Object Unit name= FLI$TAPE_IO_INIT                           File name= FLI$TAPE.:E05TOU
 UTS= JUL 29 '97 15:55:18.72 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   DCB   even  none     0      0  M$PRE_RET
    2   Data  even  none    18     22  FLI$TAPE_IO_INIT
    3   Proc  even  none    82    122  FLI$TAPE_IO_INIT
    4  RoData even  none     4      4  FLI$TAPE_IO_INIT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     3      0   yes            yes      Std        0  FLI$TAPE_IO_INIT

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       2 FLI$ALLOC
                       nStd      0 X66_AUTO_0
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
PL6.E3A0      #001=FLI$TAPE_IO_INIT File=FLI$TAPE.:E05TSI                        TUE 07/29/97 15:55 Page:6    

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  LAST_SNLISTINFO$                      NBR_SNLISTS
     TAPE_DCBLIST$                         TAPE_OPEN                             SNVECLIST$
     TVECTOR                               DPLIST$                               DPRESLIST$
     DISK_FILE_SPEC$                       SPECCHARS                             FIRST_TAPE_VOL
     EFTWORD                               M$PRE_RET                             RET_CMDS_NAME
     B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 ROSID
PL6.E3A0      #001=FLI$TAPE_IO_INIT File=FLI$TAPE.:E05TSI                        TUE 07/29/97 15:55 Page:7    


        1        1        /*M* FLI$TAPE - EFT I/O routines - tape I/O */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* THI=1,PLM=3 */
        8        8        FLI$TAPE_IO_INIT: PROC;

      8  3 000000   000000 700200 xent  FLI$TAPE_IO* TSX0  ! X66_AUTO_0
         3 000001   000012 000000                    ZERO    10,0

        9        9        /*F*  NAME: FLI$TAPE_IO_INIT
       10       10              PURPOSE: Sets up global tape open FPT with specified
       11       11                 arguments; gets necessary DCBs.
       12       12         */
       13       13
       14       14         /***
       15       15          *** INCLUDE
       16       16          ***/
       17       17
       18       18        %INCLUDE CP_6_SUBS;
       19      558        %INCLUDE CP_6;
       20     6117        %INCLUDE FLI_DATA_R;
       21     7531
       22     7532         /***
       23     7533          *** ENTRY
       24     7534          ***/
       25     7535
       26     7536    1   DCL FLI$ALLOC ENTRY(2);
       27     7537
       28     7538         /***
       29     7539          *** STATIC
       30     7540          ***/
       31     7541
       32     7542    1   DCL 1 DCBNAME STATIC,                   /* Name used for tape DCBs            */
PL6.E3A0      #001=FLI$TAPE_IO_INIT File=FLI$TAPE.:E05TSI                        TUE 07/29/97 15:55 Page:8    
       33     7543    1         2 * UBIN BYTE INIT(LENGTHC('M$TAPExx')) CALIGNED,
       34     7544    1         2 * CHAR(0) INIT('M$TAPE'),
       35     7545    1         2 NUM_ID CHAR(2);
       36     7546
       37     7547    1   DCL RETURNED_DCB# SBIN STATIC;          /* DCB# returned by M$GETDCB          */
       38     7548
       39     7549         /***
       40     7550          *** AUTO
       41     7551          ***/
       42     7552
       43     7553    1   DCL I SBIN AUTO;
       44     7554    1   DCL SNLISTINFO$ PTR AUTO;
       45     7555
       46     7556         /***
       47     7557          *** FPT
       48     7558          ***/
       49     7559
       50     7560        %FPT_GETDCB( FPTN=GET_TAPE_DCB,
       51     7561                     DCBNAME=DCBNAME,
       52     7562                     DCBNUM=RETURNED_DCB#,
       53     7563                     MERGE=NO );
       54     7578
       55     7579         /***
       56     7580          *** BASED
       57     7581          ***/
       58     7582
       59     7583        %SNLISTINFO( STCLASS="BASED(SNLISTINFO$)" );
       60     7586
       61     7587        %VLP_SN( FPTN=VLP_SN,
       62     7588                 STCLASS=BASED );
       63     7601
       64     7602        /****************************************/
       65     7603
       66     7604         /***
       67     7605          *** Set up serial number vector list.
       68     7606          ***/
       69     7607
PL6.E3A0      #001=FLI$TAPE_IO_INIT File=FLI$TAPE.:E05TSI                        TUE 07/29/97 15:55 Page:9    
       70     7608    1      CALL FLI$ALLOC( SIZEW(SNVECLIST(0))*NBR_SNLISTS, SNVECLIST$ );

   7608  3 000002   000000 235000 xsym               LDA     NBR_SNLISTS
         3 000003   000001 735000                    ALS     1
         3 000004   200006 755100                    STA     SNLISTINFO$+2,,AUTO
         3 000005   000000 236000 4                  LDQ     0
         3 000006   200011 756100                    STQ     SNLISTINFO$+5,,AUTO
         3 000007   200006 630500                    EPPR0   SNLISTINFO$+2,,AUTO
         3 000010   200010 450500                    STP0    SNLISTINFO$+4,,AUTO
         3 000011   200010 630500                    EPPR0   SNLISTINFO$+4,,AUTO
         3 000012   000020 631400 xsym               EPPR1   B_VECTNIL+16
         3 000013   000000 701000 xent               TSX1    FLI$ALLOC
         3 000014   000000 011000                    NOP     0

       71     7609
       72     7610    1      SNLISTINFO$ = LAST_SNLISTINFO$;

   7610  3 000015   000000 236000 xsym               LDQ     LAST_SNLISTINFO$
         3 000016   200004 756100                    STQ     SNLISTINFO$,,AUTO

       73     7611    1      I = NBR_SNLISTS;

   7611  3 000017   000000 235000 xsym               LDA     NBR_SNLISTS
         3 000020   200003 755100                    STA     I,,AUTO

       74     7612    2      DO WHILE( SNLISTINFO$ ~= ADDR(NIL) );

   7612  3 000021   000052 710000 3                  TRA     s:7620

       75     7613    2         TVECTOR = VECTOR(SNLISTINFO.SNLIST$->VLP_SN);

   7613  3 000022   200004 470500                    LDP0    SNLISTINFO$,,AUTO
         3 000023   000000 471500                    LDP1    0,,PR0
         3 000024   000001 235000 4                  LDA     1
         3 000025   200006 451500                    STP1    SNLISTINFO$+2,,AUTO
         3 000026   200006 236100                    LDQ     SNLISTINFO$+2,,AUTO
         3 000027   000000 757000 xsym               STAQ    TVECTOR
PL6.E3A0      #001=FLI$TAPE_IO_INIT File=FLI$TAPE.:E05TSI                        TUE 07/29/97 15:55 Page:10   

       76     7614    2         TVECTOR.W1.VSIZE# = LENGTHC(VLP_SN.NUM#)

   7614  3 000030   000000 471500                    LDP1    0,,PR0
         3 000031   100000 236100                    LDQ     0,,PR1
         3 000032   000006 402007                    MPY     6,DL
         3 000033   000003 036007                    ADLQ    3,DL
         3 000034   000020 736000                    QLS     16
         3 000035   000000 676000 xsym               ERQ     TVECTOR
         3 000036   000034 376000 xsym               ANQ     B_VECTNIL+28
         3 000037   000000 656000 xsym               ERSQ    TVECTOR

       77     7615    2           + SNLISTINFO.SNLIST$->VLP_SN.NUM# * LENGTHC(VLP_SN.SN#(0))
       78     7616    2           - 1;
       79     7617    2         I = I - 1;

   7617  3 000040   000001 336007                    LCQ     1,DL
         3 000041   200003 056100                    ASQ     I,,AUTO

       80     7618    2         SNVECLIST.SN_(I) = TVECTOR;

   7618  3 000042   200003 235100                    LDA     I,,AUTO
         3 000043   000001 735000                    ALS     1
         3 000044   000000 620005                    EAX0    0,AL
         3 000045   000000 237000 xsym               LDAQ    TVECTOR
         3 000046   000000 471400 xsym               LDP1    SNVECLIST$
         3 000047   100000 757110                    STAQ    0,X0,PR1

       81     7619    2         SNLISTINFO$ = SNLISTINFO.PREVINFO$;

   7619  3 000050   000001 236100                    LDQ     1,,PR0
         3 000051   200004 756100                    STQ     SNLISTINFO$,,AUTO

       82     7620    2         END;

   7620  3 000052   000001 116000 xsym               CMPQ    B_VECTNIL+1
         3 000053   000022 601000 3                  TNZ     s:7613
PL6.E3A0      #001=FLI$TAPE_IO_INIT File=FLI$TAPE.:E05TSI                        TUE 07/29/97 15:55 Page:11   

       83     7621
       84     7622         /***
       85     7623          *** Set up DCB number list.
       86     7624          ***/
       87     7625
       88     7626    1      CALL FLI$ALLOC( SIZEW(TAPE_DCBLIST(0))*NBR_SNLISTS, TAPE_DCBLIST$ );

   7626  3 000054   000000 235000 xsym               LDA     NBR_SNLISTS
         3 000055   000001 735000                    ALS     1
         3 000056   200006 755100                    STA     SNLISTINFO$+2,,AUTO
         3 000057   000002 236000 4                  LDQ     2
         3 000060   200011 756100                    STQ     SNLISTINFO$+5,,AUTO
         3 000061   200006 630500                    EPPR0   SNLISTINFO$+2,,AUTO
         3 000062   200010 450500                    STP0    SNLISTINFO$+4,,AUTO
         3 000063   200010 630500                    EPPR0   SNLISTINFO$+4,,AUTO
         3 000064   000020 631400 xsym               EPPR1   B_VECTNIL+16
         3 000065   000000 701000 xent               TSX1    FLI$ALLOC
         3 000066   000000 011000                    NOP     0

       89     7627
       90     7628    2      DO I=0 TO NBR_SNLISTS - 1;

   7628  3 000067   200003 450100                    STZ     I,,AUTO
         3 000070   000113 710000 3                  TRA     s:7633+1

       91     7629    2         CALL BINCHAR( DCBNAME.NUM_ID, I );

   7629  3 000071   000000 301500                    BTD
         3 000072   200003 000004                    NDSC9   I,,AUTO                  cn=0,s=lsgnf,sf=0,n=4
         3 000073   000007 630002 2                  NDSC9   DCBNAME+1                cn=3,s=nosgn,sf=0,n=2

       92     7630    2         CALL M$GETDCB( GET_TAPE_DCB );

   7630  3 000074   000012 630400 2                  EPPR0   GET_TAPE_DCB
         3 000075   060002 713400                    CLIMB   24578
         3 000076   401000 401760                    pmme    nvectors=3
PL6.E3A0      #001=FLI$TAPE_IO_INIT File=FLI$TAPE.:E05TSI                        TUE 07/29/97 15:55 Page:12   

       93     7631    2         TAPE_DCBLIST.DCB#(I) = RETURNED_DCB#;

   7631  3 000077   200003 235100                    LDA     I,,AUTO
         3 000100   000001 735000                    ALS     1
         3 000101   000000 470400 xsym               LDP0    TAPE_DCBLIST$
         3 000102   000011 236000 2                  LDQ     RETURNED_DCB#
         3 000103   000000 756105                    STQ     0,AL,PR0

       94     7632    2         TAPE_DCBLIST.DCB$(I) = DCBADDR(RETURNED_DCB#);

   7632  3 000104   000003 470400 4                  LDP0    3
         3 000105   000000 471500                    LDP1    0,,PR0
         3 000106   000011 720000 2                  LXL0    RETURNED_DCB#
         3 000107   100000 236110                    LDQ     0,X0,PR1
         3 000110   000000 473400 xsym               LDP3    TAPE_DCBLIST$
         3 000111   300001 756105                    STQ     1,AL,PR3

       95     7633    2         END;

   7633  3 000112   200003 054100                    AOS     I,,AUTO
         3 000113   200003 236100                    LDQ     I,,AUTO
         3 000114   000000 116000 xsym               CMPQ    NBR_SNLISTS
         3 000115   000071 604000 3                  TMI     s:7629

       96     7634
       97     7635        /***
       98     7636         *** Save beginning volume number.
       99     7637         ***/
      100     7638
      101     7639    1      FIRST_TAPE_VOL = TAPE_OPEN.V.VOL#;

   7639  3 000116   000061 236000 xsym               LDQ     TAPE_OPEN+49
         3 000117   000033 772000                    QRL     27
         3 000120   000000 756000 xsym               STQ     FIRST_TAPE_VOL

      102     7640
PL6.E3A0      #001=FLI$TAPE_IO_INIT File=FLI$TAPE.:E05TSI                        TUE 07/29/97 15:55 Page:13   
      103     7641    1      RETURN;

   7641  3 000121   000000 702200 xent               TSX2  ! X66_ARET
      104     7642
      105     7643    1   END FLI$TAPE_IO_INIT;
      106     7644        %EOD;

PL6.E3A0      #001=FLI$TAPE_IO_INIT File=FLI$TAPE.:E05TSI                        TUE 07/29/97 15:55 Page:14   
--  Include file information  --

   B_MICROPS_C.:E05TOU  is referenced.
   FLB_SUBS_C.:E05TOU  is referenced.
   FLI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
      No diagnostics issued in procedure FLI$TAPE_IO_INIT.
PL6.E3A0      #001=FLI$TAPE_IO_INIT File=FLI$TAPE.:E05TSI                        TUE 07/29/97 15:55 Page:15   

 **** Variables and constants ****

  ****  Section 002  Data  FLI$TAPE_IO_INIT

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     6-0-0/c STRC(81)    r     1 DCBNAME                   12-0-0/d STRC(288)   r     1 GET_TAPE_DCB
    11-0-0/w SBIN        r     1 RETURNED_DCB#

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w SBIN        r     1 I                          4-0-0/w PTR         r     1 SNLISTINFO$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 DISK_FILE_SPEC$            0-0-0/w PTR         r     1 DPLIST$
     0-0-0/w PTR         r     1 DPRESLIST$                 0-0-0/w SBIN        r     1 FIRST_TAPE_VOL
     0-0-0/w PTR         r     1 LAST_SNLISTINFO$           0-0-0/w SBIN        r     1 NBR_SNLISTS
     0-0-0/c ASTR(9)     r     1 RET_CMDS_NAME              0-0-0/w PTR         r     1 SNVECLIST$
     0-0-0/w PTR         r     1 TAPE_DCBLIST$              0-0-0/d STRC(2088)  r     1 TAPE_OPEN
     0-0-0/d STRC(72)    r     1 TVECTOR

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(72)    r     1 SNLISTINFO
     0-0-0/d STRC(72)    r     1 SNVECLIST(0:0)
     0-0-0/w STRC(72)    r     1 TAPE_DCBLIST(0:0)
PL6.E3A0      #001=FLI$TAPE_IO_INIT File=FLI$TAPE.:E05TSI                        TUE 07/29/97 15:55 Page:16   
     0-0-0/d STRC(90)    r     1 VLP_SN


   Procedure FLI$TAPE_IO_INIT requires 82 words for executable code.
   Procedure FLI$TAPE_IO_INIT requires 10 words of local(AUTO) storage.
PL6.E3A0      #001=FLI$TAPE_IO_INIT File=FLI$TAPE.:E05TSI                        TUE 07/29/97 15:55 Page:17   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=FLI$TAPE_IO_INIT File=FLI$TAPE.:E05TSI                        TUE 07/29/97 15:55 Page:18   
          MINI XREF LISTING

DCBNAME
      7542**DCL      7574--DCLINIT
DCBNAME.NUM_ID
      7545**DCL      7629<<CALLBLT
DISK_CLOSE.SN_
      6728**DCL      6728--REDEF
DISK_CLOSE.UTL_
      6729**DCL      6729--REDEF
DISK_CLOSE.V.EXPIRE#
      6743**DCL      6743--REDEF
DISK_CLOSE.V.TYPE#
      6741**DCL      6741--REDEF
DISK_CLOSE.V.XTNSIZE#
      6738**DCL      6738--REDEF    6740--REDEF
DISK_FILE_SPEC.SPEC
      7093**DCL      7095--REDEF
DISK_FILE_SPEC.SPEC.START
      7094**DCL      7094--REDEF
DISK_FILE_SPEC.SPEC.STOP
      7095**DCL      7095--REDEF
DISK_FILE_SPEC$
      7092**DCL      7093--IMP-PTR
DISK_OPEN.ACSVEH_
      6593**DCL      6594--REDEF
DISK_OPEN.ALTKEYS_
      6599**DCL      6600--REDEF    6600--REDEF
DISK_OPEN.HDR_
      6598**DCL      6599--REDEF
DISK_OPEN.TAB_
      6597**DCL      6598--REDEF
DISK_OPEN.UHL_
      6591**DCL      6592--REDEF    6592--REDEF
PL6.E3A0      #001=FLI$TAPE_IO_INIT File=FLI$TAPE.:E05TSI                        TUE 07/29/97 15:55 Page:19   
DISK_OPEN.V.FSN#
      6631**DCL      6631--REDEF    6631--REDEF
DISK_OPEN.WSN_
      6597**DCL      6597--REDEF
DISK_READ.STATION_
      6655**DCL      6656--REDEF
DISK_READ.V.DVBYTE.REREAD#
      6667**DCL      6667--REDEF
DISK_READ.V.INDX#
      6665**DCL      6665--REDEF
DISK_WRITE.STATION_
      6693**DCL      6693--REDEF
DISK_WRITE.V.DVBYTE.VFC#
      6700**DCL      6700--REDEF
DPLIST$
      7078**DCL      7090--IMP-PTR
DPRESLIST$
      7092**DCL      7092--IMP-PTR
EFTWORD
      7213**DCL      7213--REDEF
FIRST_TAPE_VOL
      7213**DCL      7639<<ASSIGN
FLI$ALLOC
      7536**DCL-ENT  7608--CALL     7626--CALL
FPT_EXIT.V.STEPCC#
      6518**DCL      6518--REDEF
GET_TAPE_DCB
      7574**DCL      7630<>CALL
GET_TAPE_DCB.V
      7575**DCL      7574--DCLINIT
I
      7553**DCL      7611<<ASSIGN   7617<<ASSIGN   7617>>ASSIGN   7618>>ASSIGN   7628<<DOINDEX  7629>>CALLBLT
      7631>>ASSIGN   7632>>ASSIGN
LAST_SNLISTINFO$
      6501**DCL      7610>>ASSIGN
M$GETDCB
PL6.E3A0      #001=FLI$TAPE_IO_INIT File=FLI$TAPE.:E05TSI                        TUE 07/29/97 15:55 Page:20   
      6051**DCL-ENT  7630--CALL
NBR_SNLISTS
      6505**DCL      7608>>CALL     7611>>ASSIGN   7626>>CALL     7628>>DOINDEX
PRE_RET_CLOSE.SN_
      7456**DCL      7456--REDEF
PRE_RET_CLOSE.UTL_
      7457**DCL      7457--REDEF
PRE_RET_CLOSE.V.EXPIRE#
      7471**DCL      7471--REDEF
PRE_RET_CLOSE.V.TYPE#
      7469**DCL      7469--REDEF
PRE_RET_CLOSE.V.XTNSIZE#
      7466**DCL      7466--REDEF    7468--REDEF
PRE_RET_OPEN.ACSVEH_
      7391**DCL      7392--REDEF
PRE_RET_OPEN.ALTKEYS_
      7397**DCL      7398--REDEF    7398--REDEF
PRE_RET_OPEN.HDR_
      7396**DCL      7397--REDEF
PRE_RET_OPEN.TAB_
      7395**DCL      7396--REDEF
PRE_RET_OPEN.UHL_
      7389**DCL      7390--REDEF    7390--REDEF
PRE_RET_OPEN.V.FSN#
      7429**DCL      7429--REDEF    7429--REDEF
PRE_RET_OPEN.WSN_
      7395**DCL      7395--REDEF
PRE_RET_READ.STATION_
      7246**DCL      7247--REDEF
PRE_RET_READ.V.DVBYTE.REREAD#
      7258**DCL      7258--REDEF
PRE_RET_READ.V.INDX#
      7256**DCL      7256--REDEF
PRE_RET_WRITE.STATION_
      7284**DCL      7284--REDEF
PRE_RET_WRITE.V.DVBYTE.VFC#
PL6.E3A0      #001=FLI$TAPE_IO_INIT File=FLI$TAPE.:E05TSI                        TUE 07/29/97 15:55 Page:21   
      7291**DCL      7291--REDEF
RETURNED_DCB#
      7547**DCL      7575--DCLINIT  7631>>ASSIGN   7632--ASSIGN
RET_CMDS_NAME.L#
      7500**DCL      7500--IMP-SIZ
SNLISTINFO.PREVINFO$
      7584**DCL      7619>>ASSIGN
SNLISTINFO.SNLIST$
      7584**DCL      7613>>ASSIGN   7614>>ASSIGN
SNLISTINFO$
      7554**DCL      7584--IMP-PTR  7610<<ASSIGN   7612>>DOWHILE  7613>>ASSIGN   7614>>ASSIGN   7619<<ASSIGN
      7619>>ASSIGN
SNVECLIST
      7032**DCL      7608--CALL
SNVECLIST.SN_
      7032**DCL      7618<<ASSIGN
SNVECLIST$
      7032**DCL      7032--IMP-PTR  7608<>CALL     7618>>ASSIGN
SPEC.START
      7096**DCL      7097--REDEF
SPEC.STOP
      7097**DCL      7098--REDEF
SPECCHARS
      7096**DCL      7096--REDEF
TAPE_CLOSE.SN_
      6949**DCL      6949--REDEF
TAPE_CLOSE.UTL_
      6950**DCL      6950--REDEF
TAPE_CLOSE.V.EXPIRE#
      6964**DCL      6964--REDEF
TAPE_CLOSE.V.TYPE#
      6962**DCL      6962--REDEF
TAPE_CLOSE.V.XTNSIZE#
      6959**DCL      6959--REDEF    6961--REDEF
TAPE_DCBLIST
      6505**DCL      7626--CALL
PL6.E3A0      #001=FLI$TAPE_IO_INIT File=FLI$TAPE.:E05TSI                        TUE 07/29/97 15:55 Page:22   
TAPE_DCBLIST.DCB#
      6505**DCL      7631<<ASSIGN
TAPE_DCBLIST.DCB$
      6505**DCL      7632<<ASSIGN
TAPE_DCBLIST$
      6505**DCL      6505--IMP-PTR  7626<>CALL     7631>>ASSIGN   7632>>ASSIGN
TAPE_OPEN.ACSVEH_
      6814**DCL      6815--REDEF
TAPE_OPEN.ALTKEYS_
      6820**DCL      6821--REDEF    6821--REDEF
TAPE_OPEN.HDR_
      6819**DCL      6820--REDEF
TAPE_OPEN.TAB_
      6818**DCL      6819--REDEF
TAPE_OPEN.UHL_
      6812**DCL      6813--REDEF    6813--REDEF
TAPE_OPEN.V.FSN#
      6852**DCL      6852--REDEF    6852--REDEF
TAPE_OPEN.V.VOL#
      6846**DCL      7639>>ASSIGN
TAPE_OPEN.WSN_
      6818**DCL      6818--REDEF
TAPE_READ.STATION_
      6876**DCL      6877--REDEF
TAPE_READ.V.DVBYTE.REREAD#
      6888**DCL      6888--REDEF
TAPE_READ.V.INDX#
      6886**DCL      6886--REDEF
TAPE_WRITE.STATION_
      6914**DCL      6914--REDEF
TAPE_WRITE.V.DVBYTE.VFC#
      6921**DCL      6921--REDEF
TVECTOR
      7044**DCL      7613<<ASSIGN   7618>>ASSIGN
TVECTOR.W1.VSIZE#
      7044**DCL      7614<<ASSIGN
PL6.E3A0      #001=FLI$TAPE_IO_INIT File=FLI$TAPE.:E05TSI                        TUE 07/29/97 15:55 Page:23   
TVECTOR.W2
      7045**DCL      7046--REDEF
VLP_SN
      7599**DCL      7613--ASSIGN
VLP_SN.NUM#
      7599**DCL      7614>>ASSIGN   7614--ASSIGN
VLP_SN.SN#
      7599**DCL      7614--ASSIGN

PL6.E3A0      #002=FLI$TAPE_OPEN File=FLI$TAPE.:E05TSI                           TUE 07/29/97 15:55 Page:24   
      107        1        /*T***********************************************************/
      108        2        /*T*                                                         */
      109        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      110        4        /*T*                                                         */
      111        5        /*T***********************************************************/
      112        6        FLI$TAPE_OPEN: PROC( NAME_, SN, FSN, USEFSN, NXTF, VOL, IFPARAM_, ERR, DCB# ) ALTRET
                 6            ;
      113        7        /*F*  NAME: FLI$TAPE_OPEN
      114        8              PURPOSE: Open current serial number lists for output.
      115        9         */
      116       10
      117       11    1   DCL NAME_ VECTOR DALIGNED;              /* Vector framing file name           */
      118       12    1   DCL 1 NAME REDEF NAME_,
      119       13    1         2 * BIT(36),
      120       14    1         2 PTR$ PTR;
      121       15    1   DCL SN CHAR(6) CALIGNED;                /* Returned current serial number     */
      122       16    1   DCL FSN SBIN ALIGNED;              /* Argument/returned file sequence number  */
      123       17    1   DCL USEFSN BIT(1) ALIGNED;              /* FSN to be used indicator           */
      124       18    1   DCL NXTF BIT(1) ALIGNED;                /* Specifies NXTF setting             */
      125       19    1   DCL VOL SBIN ALIGNED;                   /* Used if specified                  */
      126       20    1   DCL IFPARAM_ VECTOR DALIGNED;           /* IFPARAM                            */
      127       21    1   DCL ERR BIT(36) ALIGNED;                /* Returned ERR                       */
      128       22    1   DCL DCB# SBIN ALIGNED;                  /* Returned DCB#                      */
      129       23
      130       24         /***
      131       25          *** INCLUDE
      132       26          ***/
      133       27
      134       28        %INCLUDE B_ERRORS_C;
      135     1155        %INCLUDE CP_6_SUBS;
      136     1695        %INCLUDE CP_6;
      137     7254        %INCLUDE FLE_DATA_R;
      138    13205        %INCLUDE FLI_DATA_R;
      139    14619        %INCLUDE FLS_DATA_R;
      140    16419        %INCLUDE XUD_UTS_M;
      141    16501
      142    16502         /***
PL6.E3A0      #002=FLI$TAPE_OPEN File=FLI$TAPE.:E05TSI                           TUE 07/29/97 15:55 Page:25   
      143    16503          *** ENTRY
      144    16504          ***/
      145    16505
      146    16506    1   DCL FLI$RPT_ERR ENTRY(5);
      147    16507    1   DCL FLI$ROLL_SNLISTS ENTRY;
      148    16508        %XUD$UTS_ENTRIES;
      149    16540
      150    16541        /***
      151    16542         *** SYMREF
      152    16543         ***/
      153    16544
      154    16545    1   DCL BREAK_CONTINUED BIT(1) SYMREF;
      155    16546    1   DCL BREAK_DCB# SBIN SYMREF;
      156    16547
      157    16548         /***
      158    16549          *** AUTO
      159    16550          ***/
      160    16551
      161    16552    1   DCL I SBIN AUTO;
      162    16553    1   DCL TAPE_VOL_DCB$ PTR AUTO;
      163    16554    1   DCL RETRY_NEEDED BIT(1) AUTO;
      164    16555    1   DCL OPEN_START_UTS UBIN WORD AUTO;
      165    16556
      166    16557         /***
      167    16558          *** BASED
      168    16559          ***/
      169    16560
      170    16561        %F$DCB(BASED="BASED(TAPE_VOL_DCB$)");
      171    16618        %B$TCB;
      172    16621        %B$ALT;
      173    16629        %VLP_NAME( FPTN=VLP_NAME,
      174    16630                   STCLASS="BASED(NAME.PTR$)",
      175    16631                   LEN=31 );
      176    16658
      177    16659        /****************************************/
      178    16660
      179    16661         /***
PL6.E3A0      #002=FLI$TAPE_OPEN File=FLI$TAPE.:E05TSI                           TUE 07/29/97 15:55 Page:26   
      180    16662          *** If FSN is to be used, use it.  Otherwise use NAME_.
      181    16663          ***/
      182    16664
      183    16665    1      IF USEFSN
      184    16666    2       THEN DO;
      185    16667    2         TAPE_OPEN.NAME_ = VECTOR(ERASE);
      186    16668    2         TAPE_OPEN.V.FSN# = FSN;
      187    16669    2         END;
      188    16670    2       ELSE DO;
      189    16671    2         TAPE_OPEN.NAME_ = NAME_;
      190    16672    2         TAPE_OPEN.V.FSN# = 0;
      191    16673    2         END;
      192    16674
      193    16675    1      TAPE_OPEN.V.OPER.NXTF# = NXTF;
      194    16676
      195    16677        /*N* The following FPARAM/IFPARAM code will be unnecessary after C00N
      196    16678         *** since tape file management will permit FITless RESTRICT files.
      197    16679         *** The FIT only causes extra I/O anyway.
      198    16680         ***/
      199    16681
      200    16682        /*N*    IF TAPE_OPEN.V.FUN# = %IN# */
      201    16683        /*N*     THEN DO; */
      202    16684        /*N*       TAPE_OPEN.FPARAM_ = IFPARAM_; */
      203    16685    1      TAPE_OPEN.IFPARAM_ = VECTOR(NIL);
      204    16686        /*N*       END; */
      205    16687        /*N*     ELSE DO; */
      206    16688    1      TAPE_OPEN.FPARAM_ = VECTOR(NIL);
      207    16689        /*N*       TAPE_OPEN.IFPARAM_ = IFPARAM_; */
      208    16690        /*N*       END; */
      209    16691
      210    16692
      211    16693    1      ERR = '0'B;
      212    16694    1      EOVOL_DETECTED = '0'B;
      213    16695
      214    16696         /***
      215    16697          *** Open each DCB/snlist.
      216    16698          ***/
PL6.E3A0      #002=FLI$TAPE_OPEN File=FLI$TAPE.:E05TSI                           TUE 07/29/97 15:55 Page:27   
      217    16699
      218    16700    1      RETRY_NEEDED = '1'B;
      219    16701    1      CALL M$TIME( GET_NOW_UTS );
      220    16702    1      OPEN_START_UTS = NOW_UTS;
      221    16703
      222    16704    2      DO WHILE(RETRY_NEEDED);
      223    16705    2         RETRY_NEEDED = '0'B;
      224    16706    2         FSN = 0;
      225    16707    3         DO I=0 TO NBR_SNLISTS-1;
      226    16708    3            TAPE_OPEN.SN_ = SNVECLIST.SN_(I);
      227    16709    3            TAPE_OPEN.V.DCB# = TAPE_DCBLIST.DCB#(I);
      228    16710    3            BREAK_DCB# = TAPE_OPEN.V.DCB#;
      229    16711    3            TAPE_VOL_DCB$ = TAPE_DCBLIST.DCB$(I);
      230    16712    3            CALL FLI_OPEN ALTRET( CHK_ERR );
      231    16713    3            IF FSN = 0
      232    16714    4             THEN DO;
      233    16715    4               DEST_TAPE_VOL = F$DCB.VOL#;
      234    16716    4               FSN = F$DCB.FSN#;
      235    16717    4               END;
      236    16718    3             ELSE IF FSN ~= F$DCB.FSN#     /* Make sure all FSNs are the same    */
      237    16719    4                THEN DO;
      238    16720    4                  CALL FLI_CLOSE_EM;
      239    16721    4                  CALL FLI_MOUNT_TIME;
      240    16722    4                  ERR = E_NO_FSN_MATCH;
      241    16723    4                  DCB# = 0;
      242    16724    4                  ALTRETURN;
      243    16725    4                  END;
      244    16726    3            END;
      245    16727    2         TAPE_VOL_DCB$ = TAPE_DCBLIST.DCB$(0);
      246    16728    2         SN = F$DCB.PSN#;
      247    16729
      248    16730    2         IF TAPE_OPEN.V.FUN# = %IN# AND (USEFSN OR NXTF)
      249    16731    2          THEN VLP_NAME = F$DCB.NAME#;
      250    16732
      251    16733    3         DO WHILE('0'B);
      252    16734    3   CHK_ERR: ;
      253    16735    3            IF B$TCB$->B$TCB.ALT$->B$ALT.ERR.CODE ~= %E$BADFSN OR I > 0
PL6.E3A0      #002=FLI$TAPE_OPEN File=FLI$TAPE.:E05TSI                           TUE 07/29/97 15:55 Page:28   
      254    16736    4             THEN DO;       /* Only expect FSN error happening on master tape    */
      255    16737    4               DCB# = TAPE_DCBLIST.DCB#(I);
      256    16738    4               ERR = B$TCB$->B$TCB.ALT$->B$ALT.ERR;
      257    16739    4               CALL FLI_CLOSE_EM;
      258    16740    4               CALL FLI_MOUNT_TIME;
      259    16741    4               IF B$TCB$->B$TCB.ALT$->B$ALT.ERR.CODE ~= %E$EOSET
      260    16742    4                THEN IF FPT_EXIT.V.STEPCC# < %TAPE_ERROR
      261    16743    4                   THEN FPT_EXIT.V.STEPCC# = %TAPE_ERROR;
      262    16744    4               ALTRETURN;                  /* Other likely error is E$EOSET      */
      263    16745    4               END;
      264    16746    3            CALL FLI$ROLL_SNLISTS;
      265    16747    3            RETRY_NEEDED = '1'B;           /* Try to open tapes again            */
      266    16748    3            END;
      267    16749    2         END;
      268    16750    1      TAPE_OPEN.V.INITZ.SCRUB# = %NO#;
      269    16751    1      CALL FLI_MOUNT_TIME;
      270    16752    1      TAPE_OPEN.V.VOL# = 0;      /* Reset for normal sequential reel opening     */
      271    16753    1      RETURN;
      272    16754
      273    16755
      274    16756    1   FLI_MOUNT_TIME: PROC;
      275    16757
      276    16758         /***
      277    16759          *** Calculate the amount of time due to mounts.  Since we can't
      278    16760          *** readily tell if the tape was mounted already or not, we give
      279    16761          *** the operator a free second for each tape which is usually
      280    16762          *** more than necessary to complete open I/O.
      281    16763          ***/
      282    16764
      283    16765    2      CALL M$TIME( GET_NOW_UTS );
      284    16766    2      CALL XUD$UTS_DIFF(NOW_UTS,NOW_UTS,OPEN_START_UTS);
      285    16767    2      IF NOW_UTS > 128 * NBR_SNLISTS       /* 128 TICS (1.28 sec) * # tapes      */
      286    16768    2       THEN ACCUMULATED_MOUNT_TIME = ACCUMULATED_MOUNT_TIME + NOW_UTS - 128 *
             16768                NBR_SNLISTS;
      287    16769    2      RETURN;
      288    16770    2   END FLI_MOUNT_TIME;
      289    16771
PL6.E3A0      #002=FLI$TAPE_OPEN File=FLI$TAPE.:E05TSI                           TUE 07/29/97 15:55 Page:29   
      290    16772    1   FLI_OPEN: PROC ALTRET;
      291    16773
      292    16774    2      BREAK_CONTINUED = '1'B;
      293    16775    3      DO WHILE( BREAK_CONTINUED );
      294    16776    3         BREAK_CONTINUED = '0'B;
      295    16777    3         CALL M$OPEN( TAPE_OPEN )
      296    16778    4          WHENRETURN DO;
      297    16779    4            RETURN;
      298    16780    4            END;
      299    16781    4          WHENALTRETURN DO;
      300    16782    4            IF B$TCB$->B$TCB.ALT$->B$ALT.ERR.CODE ~= %E$MNTBRK
      301    16783    4             THEN ALTRETURN;
      302    16784    4            END;
      303    16785    3         END;
      304    16786    2      ALTRETURN;
      305    16787
      306    16788    2   END FLI_OPEN;
      307    16789
      308    16790    1   FLI_CLOSE_EM: PROC;
      309    16791
      310    16792    2      TAPE_CLOSE.UTL_ = VECTOR(NIL);
      311    16793    3      DO I=0 TO NBR_SNLISTS-1;
      312    16794    3         IF TAPE_DCBLIST.DCB$(I)->F$DCB.FCD#
      313    16795    4          THEN DO;
      314    16796    4            TAPE_CLOSE.V.DCB# = TAPE_DCBLIST.DCB#(I);
      315    16797    4            CALL M$CLOSE( TAPE_CLOSE )
      316    16798    5             WHENALTRETURN DO;
      317    16799    5               END;
      318    16800    4            END;
      319    16801    3         END;
      320    16802    2      RETURN;
      321    16803
      322    16804    2   END FLI_CLOSE_EM;
      323    16805    1   END FLI$TAPE_OPEN;
      324    16806        %EOD;

PL6.E3A0      #002=FLI$TAPE_OPEN File=FLI$TAPE.:E05TSI                           TUE 07/29/97 15:55 Page:30   
--  Include file information  --

   XUD_UTS_M.:E05TOU  is referenced.
   FLS_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   B_MICROPS_C.:E05TOU  is referenced.
   FLB_SUBS_C.:E05TOU  is referenced.
   FLI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FL_PERR_C.:E05TOU  is referenced.
   FLE_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   B_ERRORS_C.:E05TOU  is referenced.
      No diagnostics issued in procedure FLI$TAPE_OPEN.

   Procedure FLI$TAPE_OPEN requires 241 words for executable code.
   Procedure FLI$TAPE_OPEN requires 22 words of local(AUTO) storage.

PL6.E3A0      #002=FLI$TAPE_OPEN File=FLI$TAPE.:E05TSI                           TUE 07/29/97 15:55 Page:31   

 Object Unit name= FLI$TAPE_OPEN                              File name= FLI$TAPE.:E05TOU
 UTS= JUL 29 '97 15:55:39.28 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   DCB   even  none     0      0  M$PRE_RET
    2   Data  even  none    20     24  FLI$TAPE_OPEN
    3   DCB   even  none     0      0  M$TSN_USED
    4   DCB   even  none     0      0  M$STATUS
    5   DCB   even  none     0      0  M$REBUILD
    6   DCB   even  none     0      0  M$ARCHIVE
    7   DCB   even  none     0      0  M$NODATA_LIST
    8   Proc  even  none   241    361  FLI$TAPE_OPEN
    9  RoData even  none     8     10  FLI$TAPE_OPEN

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     8      0   yes    yes     yes      Std        9  FLI$TAPE_OPEN

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       0 FLI$ROLL_SNLISTS
 yes     yes           Std       3 XUD$UTS_DIFF
                       nStd      0 X66_AUTO_N
                       nStd      0 X66_AALT
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
PL6.E3A0      #002=FLI$TAPE_OPEN File=FLI$TAPE.:E05TSI                           TUE 07/29/97 15:55 Page:32   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                             r    E_NO_FSN_MATCH                        NBR_SNLISTS
     TAPE_DCBLIST$                         FPT_EXIT                              TAPE_OPEN
     TAPE_CLOSE                            SNVECLIST$                            B$TCB$
     EOVOL_DETECTED                        NOW_UTS                               GET_NOW_UTS
     ACCUMULATED_MOUNT_TIME                DPLIST$                               DPRESLIST$
     DISK_FILE_SPEC$                       SPECCHARS                             EFTWORD
     M$PRE_RET                             RET_CMDS_NAME                         M$TSN_USED
     M$STATUS                              M$REBUILD                             M$ARCHIVE
     M$NODATA_LIST                         BLK_TAG$                              BLK_TAG0$
     NBR_BYTES_TO_MOVE                     DISK_GRAN$                            BLOCK_GRAN$
r    EFT_CVOL_FILE                    r    EFT_RESTRICT_FILE                     DEST_TAPE_VOL
     TSN_USED_NAME                         BACKUP_NAME                      r    ARCHIVE_NAME
r    PRIME_FILE                       r    DUAL_FILE                             REBUILD_NAME
     REBUILD_DIR_KEY                       REBUILD_KEY                           NODATA_FILE_NAME
     NODATA_KEY                            BREAK_CONTINUED                       BREAK_DCB#
     B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID
PL6.E3A0      #002=FLI$TAPE_OPEN File=FLI$TAPE.:E05TSI                           TUE 07/29/97 15:55 Page:33   


      107        1        /*T***********************************************************/
      108        2        /*T*                                                         */
      109        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      110        4        /*T*                                                         */
      111        5        /*T***********************************************************/
      112        6       FLI$TAPE_OPEN: PROC( NAME_, SN, FSN, USEFSN, NXTF, VOL, IFPARAM_, ERR, DCB# ) ALTRET
                 6            ;

      6  8 000000   000000 700200 xent  FLI$TAPE_OP* TSX0  ! X66_AUTO_N
         8 000001   000026 000011                    ZERO    22,9

      113        7        /*F*  NAME: FLI$TAPE_OPEN
      114        8              PURPOSE: Open current serial number lists for output.
      115        9         */
      116       10
      117       11    1   DCL NAME_ VECTOR DALIGNED;              /* Vector framing file name           */
      118       12    1   DCL 1 NAME REDEF NAME_,
      119       13    1         2 * BIT(36),
      120       14    1         2 PTR$ PTR;
      121       15    1   DCL SN CHAR(6) CALIGNED;                /* Returned current serial number     */
      122       16    1   DCL FSN SBIN ALIGNED;              /* Argument/returned file sequence number  */
      123       17    1   DCL USEFSN BIT(1) ALIGNED;              /* FSN to be used indicator           */
      124       18    1   DCL NXTF BIT(1) ALIGNED;                /* Specifies NXTF setting             */
      125       19    1   DCL VOL SBIN ALIGNED;                   /* Used if specified                  */
      126       20    1   DCL IFPARAM_ VECTOR DALIGNED;           /* IFPARAM                            */
      127       21    1   DCL ERR BIT(36) ALIGNED;                /* Returned ERR                       */
      128       22    1   DCL DCB# SBIN ALIGNED;                  /* Returned DCB#                      */
      129       23
      130       24         /***
      131       25          *** INCLUDE
      132       26          ***/
      133       27
      134       28        %INCLUDE B_ERRORS_C;
      135     1155        %INCLUDE CP_6_SUBS;
      136     1695        %INCLUDE CP_6;
      137     7254        %INCLUDE FLE_DATA_R;
PL6.E3A0      #002=FLI$TAPE_OPEN File=FLI$TAPE.:E05TSI                           TUE 07/29/97 15:55 Page:34   
      138    13205        %INCLUDE FLI_DATA_R;
      139    14619        %INCLUDE FLS_DATA_R;
      140    16419        %INCLUDE XUD_UTS_M;
      141    16501
      142    16502         /***
      143    16503          *** ENTRY
      144    16504          ***/
      145    16505
      146    16506    1   DCL FLI$RPT_ERR ENTRY(5);
      147    16507    1   DCL FLI$ROLL_SNLISTS ENTRY;
      148    16508        %XUD$UTS_ENTRIES;
      149    16540
      150    16541        /***
      151    16542         *** SYMREF
      152    16543         ***/
      153    16544
      154    16545    1   DCL BREAK_CONTINUED BIT(1) SYMREF;
      155    16546    1   DCL BREAK_DCB# SBIN SYMREF;
      156    16547
      157    16548         /***
      158    16549          *** AUTO
      159    16550          ***/
      160    16551
      161    16552    1   DCL I SBIN AUTO;
      162    16553    1   DCL TAPE_VOL_DCB$ PTR AUTO;
      163    16554    1   DCL RETRY_NEEDED BIT(1) AUTO;
      164    16555    1   DCL OPEN_START_UTS UBIN WORD AUTO;
      165    16556
      166    16557         /***
      167    16558          *** BASED
      168    16559          ***/
      169    16560
      170    16561        %F$DCB(BASED="BASED(TAPE_VOL_DCB$)");
      171    16618        %B$TCB;
      172    16621        %B$ALT;
      173    16629        %VLP_NAME( FPTN=VLP_NAME,
      174    16630                   STCLASS="BASED(NAME.PTR$)",
PL6.E3A0      #002=FLI$TAPE_OPEN File=FLI$TAPE.:E05TSI                           TUE 07/29/97 15:55 Page:35   
      175    16631                   LEN=31 );
      176    16658
      177    16659        /****************************************/
      178    16660
      179    16661         /***
      180    16662          *** If FSN is to be used, use it.  Otherwise use NAME_.
      181    16663          ***/
      182    16664
      183    16665    1      IF USEFSN

  16665  8 000002   200006 470500                    LDP0    @USEFSN,,AUTO
         8 000003   000000 234100                    SZN     0,,PR0
         8 000004   000013 605000 8                  TPL     s:16671

      184    16666    2       THEN DO;

      185    16667    2         TAPE_OPEN.NAME_ = VECTOR(ERASE);

  16667  8 000005   000000 237000 9                  LDAQ    0
         8 000006   000006 757000 xsym               STAQ    TAPE_OPEN+6

      186    16668    2         TAPE_OPEN.V.FSN# = FSN;

  16668  8 000007   200005 471500                    LDP1    @FSN,,AUTO
         8 000010   100000 720100                    LXL0    0,,PR1
         8 000011   000066 740000 xsym               STX0    TAPE_OPEN+54

      187    16669    2         END;

  16669  8 000012   000020 710000 8                  TRA     s:16675

      188    16670    2       ELSE DO;

      189    16671    2         TAPE_OPEN.NAME_ = NAME_;

  16671  8 000013   200003 471500                    LDP1    @NAME_,,AUTO
         8 000014   100000 237100                    LDAQ    0,,PR1
PL6.E3A0      #002=FLI$TAPE_OPEN File=FLI$TAPE.:E05TSI                           TUE 07/29/97 15:55 Page:36   
         8 000015   000006 757000 xsym               STAQ    TAPE_OPEN+6

      190    16672    2         TAPE_OPEN.V.FSN# = 0;

  16672  8 000016   000000 220003                    LDX0    0,DU
         8 000017   000066 740000 xsym               STX0    TAPE_OPEN+54

      191    16673    2         END;

      192    16674
      193    16675    1      TAPE_OPEN.V.OPER.NXTF# = NXTF;

  16675  8 000020   200007 471500                    LDP1    @NXTF,,AUTO
         8 000021   100000 236100                    LDQ     0,,PR1
         8 000022   000030 772000                    QRL     24
         8 000023   000044 676000 xsym               ERQ     TAPE_OPEN+36
         8 000024   004000 376007                    ANQ     2048,DL
         8 000025   000044 656000 xsym               ERSQ    TAPE_OPEN+36

      194    16676
      195    16677        /*N* The following FPARAM/IFPARAM code will be unnecessary after C00N
      196    16678         *** since tape file management will permit FITless RESTRICT files.
      197    16679         *** The FIT only causes extra I/O anyway.
      198    16680         ***/
      199    16681
      200    16682        /*N*    IF TAPE_OPEN.V.FUN# = %IN# */
      201    16683        /*N*     THEN DO; */
      202    16684        /*N*       TAPE_OPEN.FPARAM_ = IFPARAM_; */
      203    16685    1      TAPE_OPEN.IFPARAM_ = VECTOR(NIL);

  16685  8 000026   000002 237000 9                  LDAQ    2
         8 000027   000026 757000 xsym               STAQ    TAPE_OPEN+22

      204    16686        /*N*       END; */
      205    16687        /*N*     ELSE DO; */
      206    16688    1      TAPE_OPEN.FPARAM_ = VECTOR(NIL);

PL6.E3A0      #002=FLI$TAPE_OPEN File=FLI$TAPE.:E05TSI                           TUE 07/29/97 15:55 Page:37   
  16688  8 000030   000002 237000 9                  LDAQ    2
         8 000031   000030 757000 xsym               STAQ    TAPE_OPEN+24

      207    16689        /*N*       TAPE_OPEN.IFPARAM_ = IFPARAM_; */
      208    16690        /*N*       END; */
      209    16691
      210    16692
      211    16693    1      ERR = '0'B;

  16693  8 000032   200012 473500                    LDP3    @ERR,,AUTO
         8 000033   300000 450100                    STZ     0,,PR3

      212    16694    1      EOVOL_DETECTED = '0'B;

  16694  8 000034   000000 450000 xsym               STZ     EOVOL_DETECTED

      213    16695
      214    16696         /***
      215    16697          *** Open each DCB/snlist.
      216    16698          ***/
      217    16699
      218    16700    1      RETRY_NEEDED = '1'B;

  16700  8 000035   400000 236003                    LDQ     -131072,DU
         8 000036   200016 756100                    STQ     RETRY_NEEDED,,AUTO

      219    16701    1      CALL M$TIME( GET_NOW_UTS );

  16701  8 000037   000000 630400 xsym               EPPR0   GET_NOW_UTS
         8 000040   020004 713400                    CLIMB   8196
         8 000041   402000 401760                    pmme    nvectors=5

      220    16702    1      OPEN_START_UTS = NOW_UTS;

  16702  8 000042   000000 235000 xsym               LDA     NOW_UTS
         8 000043   200017 755100                    STA     OPEN_START_UTS,,AUTO

PL6.E3A0      #002=FLI$TAPE_OPEN File=FLI$TAPE.:E05TSI                           TUE 07/29/97 15:55 Page:38   
      221    16703
      222    16704    2      DO WHILE(RETRY_NEEDED);

  16704  8 000044   200016 234100                    SZN     RETRY_NEEDED,,AUTO
         8 000045   000237 605000 8                  TPL     s:16750

      223    16705    2         RETRY_NEEDED = '0'B;

  16705  8 000046   200016 450100                    STZ     RETRY_NEEDED,,AUTO

      224    16706    2         FSN = 0;

  16706  8 000047   200005 470500                    LDP0    @FSN,,AUTO
         8 000050   000000 450100                    STZ     0,,PR0

      225    16707    3         DO I=0 TO NBR_SNLISTS-1;

  16707  8 000051   200014 450100                    STZ     I,,AUTO
         8 000052   000131 710000 8                  TRA     s:16726+1

      226    16708    3            TAPE_OPEN.SN_ = SNVECLIST.SN_(I);

  16708  8 000053   200014 235100                    LDA     I,,AUTO
         8 000054   000001 735000                    ALS     1
         8 000055   000000 470400 xsym               LDP0    SNVECLIST$
         8 000056   000000 237105                    LDAQ    0,AL,PR0
         8 000057   000002 757000 xsym               STAQ    TAPE_OPEN+2

      227    16709    3            TAPE_OPEN.V.DCB# = TAPE_DCBLIST.DCB#(I);

  16709  8 000060   200014 235100                    LDA     I,,AUTO
         8 000061   000001 735000                    ALS     1
         8 000062   000000 471400 xsym               LDP1    TAPE_DCBLIST$
         8 000063   100000 720105                    LXL0    0,AL,PR1
         8 000064   000044 740000 xsym               STX0    TAPE_OPEN+36

      228    16710    3            BREAK_DCB# = TAPE_OPEN.V.DCB#;
PL6.E3A0      #002=FLI$TAPE_OPEN File=FLI$TAPE.:E05TSI                           TUE 07/29/97 15:55 Page:39   

  16710  8 000065   000044 235000 xsym               LDA     TAPE_OPEN+36
         8 000066   000022 771000                    ARL     18
         8 000067   000000 755000 xsym               STA     BREAK_DCB#

      229    16711    3            TAPE_VOL_DCB$ = TAPE_DCBLIST.DCB$(I);

  16711  8 000070   200014 235100                    LDA     I,,AUTO
         8 000071   000001 735000                    ALS     1
         8 000072   100001 236105                    LDQ     1,AL,PR1
         8 000073   200015 756100                    STQ     TAPE_VOL_DCB$,,AUTO

      230    16712    3            CALL FLI_OPEN ALTRET( CHK_ERR );

  16712  8 000074   000300 701000 8                  TSX1    FLI_OPEN
         8 000075   000164 702000 8                  TSX2    CHK_ERR

      231    16713    3            IF FSN = 0

  16713  8 000076   200005 470500                    LDP0    @FSN,,AUTO
         8 000077   000000 235100                    LDA     0,,PR0
         8 000100   000111 601000 8                  TNZ     s:16718

      232    16714    4             THEN DO;

      233    16715    4               DEST_TAPE_VOL = F$DCB.VOL#;

  16715  8 000101   200015 471500                    LDP1    TAPE_VOL_DCB$,,AUTO
         8 000102   100043 236100                    LDQ     35,,PR1
         8 000103   000033 772000                    QRL     27
         8 000104   000000 756000 xsym               STQ     DEST_TAPE_VOL

      234    16716    4               FSN = F$DCB.FSN#;

  16716  8 000105   100034 236100                    LDQ     28,,PR1
         8 000106   000022 772000                    QRL     18
         8 000107   000000 756100                    STQ     0,,PR0
PL6.E3A0      #002=FLI$TAPE_OPEN File=FLI$TAPE.:E05TSI                           TUE 07/29/97 15:55 Page:40   

      235    16717    4               END;

  16717  8 000110   000130 710000 8                  TRA     s:16726

      236    16718    3             ELSE IF FSN ~= F$DCB.FSN#     /* Make sure all FSNs are the same    */

  16718  8 000111   200015 471500                    LDP1    TAPE_VOL_DCB$,,AUTO
         8 000112   100034 236100                    LDQ     28,,PR1
         8 000113   000022 772000                    QRL     18
         8 000114   000000 116100                    CMPQ    0,,PR0
         8 000115   000130 600000 8                  TZE     s:16726

      237    16719    4                THEN DO;

      238    16720    4                  CALL FLI_CLOSE_EM;

  16720  8 000116   000330 701000 8                  TSX1    FLI_CLOSE_EM
         8 000117   000000 011000                    NOP     0

      239    16721    4                  CALL FLI_MOUNT_TIME;

  16721  8 000120   000246 701000 8                  TSX1    FLI_MOUNT_TIME
         8 000121   000000 011000                    NOP     0

      240    16722    4                  ERR = E_NO_FSN_MATCH;

  16722  8 000122   000000 236000 xsym               LDQ     E_NO_FSN_MATCH
         8 000123   200012 470500                    LDP0    @ERR,,AUTO
         8 000124   000000 756100                    STQ     0,,PR0

      241    16723    4                  DCB# = 0;

  16723  8 000125   200013 471500                    LDP1    @DCB#,,AUTO
         8 000126   100000 450100                    STZ     0,,PR1

      242    16724    4                  ALTRETURN;
PL6.E3A0      #002=FLI$TAPE_OPEN File=FLI$TAPE.:E05TSI                           TUE 07/29/97 15:55 Page:41   

  16724  8 000127   000000 702200 xent               TSX2  ! X66_AALT

      243    16725    4                  END;
      244    16726    3            END;

  16726  8 000130   200014 054100                    AOS     I,,AUTO
         8 000131   200014 236100                    LDQ     I,,AUTO
         8 000132   000000 116000 xsym               CMPQ    NBR_SNLISTS
         8 000133   000053 604000 8                  TMI     s:16708

      245    16727    2         TAPE_VOL_DCB$ = TAPE_DCBLIST.DCB$(0);

  16727  8 000134   000000 471400 xsym               LDP1    TAPE_DCBLIST$
         8 000135   100001 236100                    LDQ     1,,PR1
         8 000136   200015 756100                    STQ     TAPE_VOL_DCB$,,AUTO

      246    16728    2         SN = F$DCB.PSN#;

  16728  8 000137   200015 473500                    LDP3    TAPE_VOL_DCB$,,AUTO
         8 000140   200004 474500                    LDP4    @SN,,AUTO
         8 000141   040100 100500                    MLR     fill='040'O
         8 000142   300024 000006                    ADSC9   20,,PR3                  cn=0,n=6
         8 000143   400000 000006                    ADSC9   0,,PR4                   cn=0,n=6

      247    16729
      248    16730    2         IF TAPE_OPEN.V.FUN# = %IN# AND (USEFSN OR NXTF)

  16730  8 000144   000045 236000 xsym               LDQ     TAPE_OPEN+37
         8 000145   777000 376007                    ANQ     -512,DL
         8 000146   002000 116007                    CMPQ    1024,DL
         8 000147   000163 601000 8                  TNZ     s:16733
         8 000150   200006 471500                    LDP1    @USEFSN,,AUTO
         8 000151   100000 234100                    SZN     0,,PR1
         8 000152   000156 604000 8                  TMI     s:16731
         8 000153   200007 475500                    LDP5    @NXTF,,AUTO
         8 000154   500000 234100                    SZN     0,,PR5
PL6.E3A0      #002=FLI$TAPE_OPEN File=FLI$TAPE.:E05TSI                           TUE 07/29/97 15:55 Page:42   
         8 000155   000163 605000 8                  TPL     s:16733

      249    16731    2          THEN VLP_NAME = F$DCB.NAME#;

  16731  8 000156   200003 475500                    LDP5    @NAME_,,AUTO
         8 000157   500001 476500                    LDP6    1,,PR5
         8 000160   000100 100500                    MLR     fill='000'O
         8 000161   300010 000040                    ADSC9   8,,PR3                   cn=0,n=32
         8 000162   600000 000040                    ADSC9   0,,PR6                   cn=0,n=32

      250    16732
      251    16733    3         DO WHILE('0'B);

  16733  8 000163   000235 710000 8                  TRA     s:16749

  16731  8 000164                       CHK_ERR      null
      252    16734    3   CHK_ERR: ;
      253    16735    3            IF B$TCB$->B$TCB.ALT$->B$ALT.ERR.CODE ~= %E$BADFSN OR I > 0

  16735  8 000164   000000 470400 xsym               LDP0    B$TCB$
         8 000165   000000 471500                    LDP1    0,,PR0
         8 000166   100102 236100                    LDQ     66,,PR1
         8 000167   377770 376007                    ANQ     131064,DL
         8 000170   013120 116007                    CMPQ    5712,DL
         8 000171   000174 601000 8                  TNZ     s:16737
         8 000172   200014 235100                    LDA     I,,AUTO
         8 000173   000230 604400 8                  TMOZ    s:16746

      254    16736    4             THEN DO;       /* Only expect FSN error happening on master tape    */

      255    16737    4               DCB# = TAPE_DCBLIST.DCB#(I);

  16737  8 000174   200014 235100                    LDA     I,,AUTO
         8 000175   000001 735000                    ALS     1
         8 000176   000000 473400 xsym               LDP3    TAPE_DCBLIST$
         8 000177   200013 474500                    LDP4    @DCB#,,AUTO
         8 000200   300000 235105                    LDA     0,AL,PR3
PL6.E3A0      #002=FLI$TAPE_OPEN File=FLI$TAPE.:E05TSI                           TUE 07/29/97 15:55 Page:43   
         8 000201   400000 755100                    STA     0,,PR4

      256    16738    4               ERR = B$TCB$->B$TCB.ALT$->B$ALT.ERR;

  16738  8 000202   000000 470400 xsym               LDP0    B$TCB$
         8 000203   000000 471500                    LDP1    0,,PR0
         8 000204   100102 236100                    LDQ     66,,PR1
         8 000205   200012 473500                    LDP3    @ERR,,AUTO
         8 000206   300000 756100                    STQ     0,,PR3

      257    16739    4               CALL FLI_CLOSE_EM;

  16739  8 000207   000330 701000 8                  TSX1    FLI_CLOSE_EM
         8 000210   000000 011000                    NOP     0

      258    16740    4               CALL FLI_MOUNT_TIME;

  16740  8 000211   000246 701000 8                  TSX1    FLI_MOUNT_TIME
         8 000212   000000 011000                    NOP     0

      259    16741    4               IF B$TCB$->B$TCB.ALT$->B$ALT.ERR.CODE ~= %E$EOSET

  16741  8 000213   000000 470400 xsym               LDP0    B$TCB$
         8 000214   000000 471500                    LDP1    0,,PR0
         8 000215   100102 236100                    LDQ     66,,PR1
         8 000216   377770 376007                    ANQ     131064,DL
         8 000217   013140 116007                    CMPQ    5728,DL
         8 000220   000227 600000 8                  TZE     s:16744

      260    16742    4                THEN IF FPT_EXIT.V.STEPCC# < %TAPE_ERROR

  16742  8 000221   000004 236000 xsym               LDQ     FPT_EXIT+4
         8 000222   777000 376003                    ANQ     -512,DU
         8 000223   004000 116003                    CMPQ    2048,DU
         8 000224   000227 603000 8                  TRC     s:16744

      261    16743    4                   THEN FPT_EXIT.V.STEPCC# = %TAPE_ERROR;
PL6.E3A0      #002=FLI$TAPE_OPEN File=FLI$TAPE.:E05TSI                           TUE 07/29/97 15:55 Page:44   

  16743  8 000225   004000 236003                    LDQ     2048,DU
         8 000226   000004 552040 xsym               STBQ    FPT_EXIT+4,'40'O

      262    16744    4               ALTRETURN;                  /* Other likely error is E$EOSET      */

  16744  8 000227   000000 702200 xent               TSX2  ! X66_AALT

      263    16745    4               END;
      264    16746    3            CALL FLI$ROLL_SNLISTS;

  16746  8 000230   000002 631400 xsym               EPPR1   B_VECTNIL+2
         8 000231   000000 701000 xent               TSX1    FLI$ROLL_SNLISTS
         8 000232   000000 011000                    NOP     0

      265    16747    3            RETRY_NEEDED = '1'B;           /* Try to open tapes again            */

  16747  8 000233   400000 236003                    LDQ     -131072,DU
         8 000234   200016 756100                    STQ     RETRY_NEEDED,,AUTO

      266    16748    3            END;

      267    16749    2         END;

  16749  8 000235   200016 234100                    SZN     RETRY_NEEDED,,AUTO
         8 000236   000046 604000 8                  TMI     s:16705

      268    16750    1      TAPE_OPEN.V.INITZ.SCRUB# = %NO#;

  16750  8 000237   000004 236000 9                  LDQ     4
         8 000240   000044 356000 xsym               ANSQ    TAPE_OPEN+36

      269    16751    1      CALL FLI_MOUNT_TIME;

  16751  8 000241   000246 701000 8                  TSX1    FLI_MOUNT_TIME
         8 000242   000000 011000                    NOP     0

PL6.E3A0      #002=FLI$TAPE_OPEN File=FLI$TAPE.:E05TSI                           TUE 07/29/97 15:55 Page:45   
      270    16752    1      TAPE_OPEN.V.VOL# = 0;      /* Reset for normal sequential reel opening     */

  16752  8 000243   000000 236003                    LDQ     0,DU
         8 000244   000061 552040 xsym               STBQ    TAPE_OPEN+49,'40'O

      271    16753    1      RETURN;

  16753  8 000245   000000 702200 xent               TSX2  ! X66_ARET

      272    16754
      273    16755
      274    16756    1   FLI_MOUNT_TIME: PROC;

  16756  8 000246   200020 741300       FLI_MOUNT_T* STX1  ! OPEN_START_UTS+1,,AUTO

      275    16757
      276    16758         /***
      277    16759          *** Calculate the amount of time due to mounts.  Since we can't
      278    16760          *** readily tell if the tape was mounted already or not, we give
      279    16761          *** the operator a free second for each tape which is usually
      280    16762          *** more than necessary to complete open I/O.
      281    16763          ***/
      282    16764
      283    16765    2      CALL M$TIME( GET_NOW_UTS );

  16765  8 000247   000000 630400 xsym               EPPR0   GET_NOW_UTS
         8 000250   020004 713400                    CLIMB   8196
         8 000251   402000 401760                    pmme    nvectors=5

      284    16766    2      CALL XUD$UTS_DIFF(NOW_UTS,NOW_UTS,OPEN_START_UTS);

  16766  8 000252   200017 630500                    EPPR0   OPEN_START_UTS,,AUTO
         8 000253   200024 450500                    STP0    OPEN_START_UTS+5,,AUTO
         8 000254   000006 237000 9                  LDAQ    6
         8 000255   200022 757100                    STAQ    OPEN_START_UTS+3,,AUTO
         8 000256   200022 630500                    EPPR0   OPEN_START_UTS+3,,AUTO
         8 000257   000021 631400 xsym               EPPR1   B_VECTNIL+17
PL6.E3A0      #002=FLI$TAPE_OPEN File=FLI$TAPE.:E05TSI                           TUE 07/29/97 15:55 Page:46   
         8 000260   000000 701000 xent               TSX1    XUD$UTS_DIFF
         8 000261   000000 011000                    NOP     0

      285    16767    2      IF NOW_UTS > 128 * NBR_SNLISTS       /* 128 TICS (1.28 sec) * # tapes      */

  16767  8 000262   000000 236000 xsym               LDQ     NBR_SNLISTS
         8 000263   000007 736000                    QLS     7
         8 000264   000267 604000 8                  TMI     s:16768
         8 000265   000000 116000 xsym               CMPQ    NOW_UTS
         8 000266   000276 603000 8                  TRC     s:16769

      286    16768    2       THEN ACCUMULATED_MOUNT_TIME = ACCUMULATED_MOUNT_TIME + NOW_UTS - 128 *
             16768                NBR_SNLISTS;

  16768  8 000267   000000 236000 xsym               LDQ     ACCUMULATED_MOUNT_TIME
         8 000270   000000 036000 xsym               ADLQ    NOW_UTS
         8 000271   200022 756100                    STQ     OPEN_START_UTS+3,,AUTO
         8 000272   000000 336000 xsym               LCQ     NBR_SNLISTS
         8 000273   000007 736000                    QLS     7
         8 000274   200022 036100                    ADLQ    OPEN_START_UTS+3,,AUTO
         8 000275   000000 756000 xsym               STQ     ACCUMULATED_MOUNT_TIME

      287    16769    2      RETURN;

  16769  8 000276   200020 221300                    LDX1  ! OPEN_START_UTS+1,,AUTO
         8 000277   000001 702211                    TSX2  ! 1,X1

      288    16770    2   END FLI_MOUNT_TIME;
      289    16771
      290    16772    1   FLI_OPEN: PROC ALTRET;

  16772  8 000300   200020 741300       FLI_OPEN     STX1  ! OPEN_START_UTS+1,,AUTO

      291    16773
      292    16774    2      BREAK_CONTINUED = '1'B;

  16774  8 000301   400000 236003                    LDQ     -131072,DU
PL6.E3A0      #002=FLI$TAPE_OPEN File=FLI$TAPE.:E05TSI                           TUE 07/29/97 15:55 Page:47   
         8 000302   000000 756000 xsym               STQ     BREAK_CONTINUED

      293    16775    3      DO WHILE( BREAK_CONTINUED );

  16775  8 000303   000000 234000 xsym               SZN     BREAK_CONTINUED
         8 000304   000326 605000 8                  TPL     s:16786

      294    16776    3         BREAK_CONTINUED = '0'B;

  16776  8 000305   000000 450000 xsym               STZ     BREAK_CONTINUED

      295    16777    3         CALL M$OPEN( TAPE_OPEN )

  16777  8 000306   000000 630400 xsym               EPPR0   TAPE_OPEN
         8 000307   450000 713400                    CLIMB   alt,open
         8 000310   410400 401760                    pmme    nvectors=18
         8 000311   000314 702000 8                  TSX2    s:16782

      296    16778    4          WHENRETURN DO;

      297    16779    4            RETURN;

  16779  8 000312   200020 221300                    LDX1  ! OPEN_START_UTS+1,,AUTO
         8 000313   000001 702211                    TSX2  ! 1,X1

      298    16780    4            END;
      299    16781    4          WHENALTRETURN DO;

      300    16782    4            IF B$TCB$->B$TCB.ALT$->B$ALT.ERR.CODE ~= %E$MNTBRK

  16782  8 000314   000000 470400 xsym               LDP0    B$TCB$
         8 000315   000000 471500                    LDP1    0,,PR0
         8 000316   100102 236100                    LDQ     66,,PR1
         8 000317   377770 376007                    ANQ     131064,DL
         8 000320   012200 116007                    CMPQ    5248,DL
         8 000321   000324 600000 8                  TZE     s:16785

PL6.E3A0      #002=FLI$TAPE_OPEN File=FLI$TAPE.:E05TSI                           TUE 07/29/97 15:55 Page:48   
      301    16783    4             THEN ALTRETURN;

  16783  8 000322   200020 221300                    LDX1  ! OPEN_START_UTS+1,,AUTO
         8 000323   000000 702211                    TSX2  ! 0,X1

      302    16784    4            END;
      303    16785    3         END;

  16785  8 000324   000000 234000 xsym               SZN     BREAK_CONTINUED
         8 000325   000305 604000 8                  TMI     s:16776

      304    16786    2      ALTRETURN;

  16786  8 000326   200020 221300                    LDX1  ! OPEN_START_UTS+1,,AUTO
         8 000327   000000 702211                    TSX2  ! 0,X1

      305    16787
      306    16788    2   END FLI_OPEN;
      307    16789
      308    16790    1   FLI_CLOSE_EM: PROC;

  16790  8 000330   200020 741300       FLI_CLOSE_EM STX1  ! OPEN_START_UTS+1,,AUTO

      309    16791
      310    16792    2      TAPE_CLOSE.UTL_ = VECTOR(NIL);

  16792  8 000331   000002 237000 9                  LDAQ    2
         8 000332   000004 757000 xsym               STAQ    TAPE_CLOSE+4

      311    16793    3      DO I=0 TO NBR_SNLISTS-1;

  16793  8 000333   200014 450100                    STZ     I,,AUTO
         8 000334   000354 710000 8                  TRA     s:16801+1

      312    16794    3         IF TAPE_DCBLIST.DCB$(I)->F$DCB.FCD#

  16794  8 000335   200014 235100                    LDA     I,,AUTO
PL6.E3A0      #002=FLI$TAPE_OPEN File=FLI$TAPE.:E05TSI                           TUE 07/29/97 15:55 Page:49   
         8 000336   000001 735000                    ALS     1
         8 000337   000000 470400 xsym               LDP0    TAPE_DCBLIST$
         8 000340   000001 471505                    LDP1    1,AL,PR0
         8 000341   100031 236100                    LDQ     25,,PR1
         8 000342   020000 316007                    CANQ    8192,DL
         8 000343   000353 600000 8                  TZE     s:16801

      313    16795    4          THEN DO;

      314    16796    4            TAPE_CLOSE.V.DCB# = TAPE_DCBLIST.DCB#(I);

  16796  8 000344   000000 720105                    LXL0    0,AL,PR0
         8 000345   000032 740000 xsym               STX0    TAPE_CLOSE+26

      315    16797    4            CALL M$CLOSE( TAPE_CLOSE )

  16797  8 000346   000000 630400 xsym               EPPR0   TAPE_CLOSE
         8 000347   450001 713400                    CLIMB   alt,close
         8 000350   406000 401760                    pmme    nvectors=13
         8 000351   000353 702000 8                  TSX2    s:16801
         8 000352   000353 710000 8                  TRA     s:16801

      316    16798    5             WHENALTRETURN DO;

      317    16799    5               END;

      318    16800    4            END;

      319    16801    3         END;

  16801  8 000353   200014 054100                    AOS     I,,AUTO
         8 000354   200014 236100                    LDQ     I,,AUTO
         8 000355   000000 116000 xsym               CMPQ    NBR_SNLISTS
         8 000356   000335 604000 8                  TMI     s:16794

      320    16802    2      RETURN;

PL6.E3A0      #002=FLI$TAPE_OPEN File=FLI$TAPE.:E05TSI                           TUE 07/29/97 15:55 Page:50   
  16802  8 000357   200020 221300                    LDX1  ! OPEN_START_UTS+1,,AUTO
         8 000360   000001 702211                    TSX2  ! 1,X1
      321    16803
      322    16804    2   END FLI_CLOSE_EM;
      323    16805    1   END FLI$TAPE_OPEN;
      324    16806        %EOD;

PL6.E3A0      #002=FLI$TAPE_OPEN File=FLI$TAPE.:E05TSI                           TUE 07/29/97 15:55 Page:51   
--  Include file information  --

   XUD_UTS_M.:E05TOU  is referenced.
   FLS_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   B_MICROPS_C.:E05TOU  is referenced.
   FLB_SUBS_C.:E05TOU  is referenced.
   FLI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FL_PERR_C.:E05TOU  is referenced.
   FLE_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   B_ERRORS_C.:E05TOU  is referenced.
      No diagnostics issued in procedure FLI$TAPE_OPEN.
PL6.E3A0      #002=FLI$TAPE_OPEN File=FLI$TAPE.:E05TSI                           TUE 07/29/97 15:55 Page:52   

 **** Variables and constants ****

  ****  Section 002  Data  FLI$TAPE_OPEN

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    12-0-0/d STRC(360)   r     1 DEL_NODATA_REC

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    13-0-0/w PTR         r     1 @DCB#                     12-0-0/w PTR         r     1 @ERR
     5-0-0/w PTR         r     1 @FSN                      11-0-0/w PTR         r     1 @IFPARAM_
     3-0-0/w PTR         r     1 @NAME_                     7-0-0/w PTR         r     1 @NXTF
     4-0-0/w PTR         r     1 @SN                        6-0-0/w PTR         r     1 @USEFSN
    10-0-0/w PTR         r     1 @VOL                      *0-0-0/w SBIN        r     1 DCB#
    *0-0-0/w BIT         r     1 ERR                       *0-0-0/w SBIN        r     1 FSN
    14-0-0/w SBIN        r     1 I                         *0-0-0/d VECT        r     1 IFPARAM_
    *0-0-0/d STRC(72)    r     1 NAME                      *0-0-0/d VECT        r     1 NAME_
    *0-0-0/w BIT         r     1 NXTF                      17-0-0/w UBIN        r     1 OPEN_START_UTS
    16-0-0/b BIT         r     1 RETRY_NEEDED              *0-0-0/c CHAR(6)     r     1 SN
    15-0-0/w PTR         r     1 TAPE_VOL_DCB$             *0-0-0/w BIT         r     1 USEFSN
    *0-0-0/w SBIN        r     1 VOL

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN        r     1 ACCUMULATED_MOUNT_TIME
     0-0-0/c ASTR(9)     r     1 ARCHIVE_NAME               0-0-0/w PTR         r     1 B$TCB$
     0-0-0/c ASTR(9)     r     1 BACKUP_NAME                0-0-0/w PTR         r     1 BLK_TAG$
     0-0-0/w PTR         r     1 BLK_TAG0$                  0-0-0/w PTR         r     1 BLOCK_GRAN$
     0-0-0/b BIT         r     1 BREAK_CONTINUED            0-0-0/w SBIN        r     1 BREAK_DCB#
PL6.E3A0      #002=FLI$TAPE_OPEN File=FLI$TAPE.:E05TSI                           TUE 07/29/97 15:55 Page:53   
     0-0-0/w SBIN        r     1 DEST_TAPE_VOL              0-0-0/w PTR         r     1 DISK_FILE_SPEC$
     0-0-0/w PTR         r     1 DISK_GRAN$                 0-0-0/w PTR         r     1 DPLIST$
     0-0-0/w PTR         r     1 DPRESLIST$                 0-0-0/c ASTR(9)     r     1 DUAL_FILE
     0-0-0/c ASTR(9)     r     1 EFT_CVOL_FILE              0-0-0/c ASTR(9)     r     1 EFT_RESTRICT_FILE
     0-0-0/b BIT         r     1 EOVOL_DETECTED             0-0-0/w STRC        r     1 E_NO_FSN_MATCH
     0-0-0/d STRC(216)   r     1 FPT_EXIT                   0-0-0/d STRC(432)   r     1 GET_NOW_UTS
     0-0-0/w SBIN        r     1 NBR_BYTES_TO_MOVE          0-0-0/w SBIN        r     1 NBR_SNLISTS
     0-0-0/c ASTR(9)     r     1 NODATA_FILE_NAME           0-0-0/c STRC(369)   r     1 NODATA_KEY
     0-0-0/w UBIN        r     1 NOW_UTS                    0-0-0/c ASTR(9)     r     1 PRIME_FILE
     0-0-0/c ASTR(9)     r     1 REBUILD_DIR_KEY            0-0-0/c ASTR(9)     r     1 REBUILD_KEY
     0-0-0/c ASTR(9)     r     1 REBUILD_NAME               0-0-0/c ASTR(9)     r     1 RET_CMDS_NAME
     0-0-0/w PTR         r     1 SNVECLIST$                 0-0-0/d STRC(1080)  r     1 TAPE_CLOSE
     0-0-0/w PTR         r     1 TAPE_DCBLIST$              0-0-0/d STRC(2088)  r     1 TAPE_OPEN
     0-0-0/c ASTR(9)     r     1 TSN_USED_NAME

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(2448)  r     1 B$ALT                      0-0-0/w STRC(144)   r     1 B$TCB
     0-0-0/d ASTR(3528)  r     1 F$DCB                      0-0-0N  NULL        r     1 M$NODATA_LIST
     0-0-0/d STRC(72)    r     1 SNVECLIST(0:0)
     0-0-0/w STRC(72)    r     1 TAPE_DCBLIST(0:0)
     0-0-0/c STRC(288)   r     1 VLP_NAME


   Procedure FLI$TAPE_OPEN requires 241 words for executable code.
   Procedure FLI$TAPE_OPEN requires 22 words of local(AUTO) storage.
PL6.E3A0      #002=FLI$TAPE_OPEN File=FLI$TAPE.:E05TSI                           TUE 07/29/97 15:55 Page:54   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=FLI$TAPE_OPEN File=FLI$TAPE.:E05TSI                           TUE 07/29/97 15:55 Page:55   
          MINI XREF LISTING

ACCUMULATED_MOUNT_TIME
     14165**DCL     16768<<ASSIGN  16768>>ASSIGN
ARCHIVE_NAME.L#
     15511**DCL     15511--IMP-SIZ
B$ALT.CODE
     16623**DCL     16623--REDEF   16624--REDEF   16624--REDEF
B$ALT.ERR
     16624**DCL     16738>>ASSIGN
B$ALT.ERR.CODE
     16625**DCL     16735>>IF      16741>>IF      16782>>IF
B$ALT.ERR.ERR#
     16625**DCL     16625--REDEF
B$ALT.EVID
     16624**DCL     16624--REDEF   16624--REDEF
B$TCB.ALT$
     16619**DCL     16735>>IF      16738>>ASSIGN  16741>>IF      16782>>IF
B$TCB$
     14136**DCL     16735>>IF      16738>>ASSIGN  16741>>IF      16782>>IF
BACKUP_NAME.L#
     15155**DCL     15155--IMP-SIZ
BLK_TAG.NAME
     14647**DCL     14647--REDEF
BLK_TAG$
     14644**DCL     14644--IMP-PTR
BLK_TAG0.NAME
     14653**DCL     14653--REDEF
BLK_TAG0$
     14650**DCL     14650--IMP-PTR
BLOCK_GRAN$
     14657**DCL     14658--IMP-PTR
BREAK_CONTINUED
     16545**DCL     16774<<ASSIGN  16775>>DOWHILE 16776<<ASSIGN
PL6.E3A0      #002=FLI$TAPE_OPEN File=FLI$TAPE.:E05TSI                           TUE 07/29/97 15:55 Page:56   
BREAK_DCB#
     16546**DCL     16710<<ASSIGN
CHK_ERR
     16731**LABEL   16712--CALLALT
CLOSE_NODATA_LIST.SN_
     16309**DCL     16309--REDEF
CLOSE_NODATA_LIST.UTL_
     16310**DCL     16310--REDEF
CLOSE_NODATA_LIST.V.EXPIRE#
     16324**DCL     16324--REDEF
CLOSE_NODATA_LIST.V.TYPE#
     16322**DCL     16322--REDEF
CLOSE_NODATA_LIST.V.XTNSIZE#
     16319**DCL     16319--REDEF   16321--REDEF
CLOSE_PRIME_DUAL.SN_
     15786**DCL     15786--REDEF
CLOSE_PRIME_DUAL.UTL_
     15787**DCL     15787--REDEF
CLOSE_PRIME_DUAL.V.EXPIRE#
     15801**DCL     15801--REDEF
CLOSE_PRIME_DUAL.V.TYPE#
     15799**DCL     15799--REDEF
CLOSE_PRIME_DUAL.V.XTNSIZE#
     15796**DCL     15796--REDEF   15798--REDEF
CLOSE_REBUILD.SN_
     16061**DCL     16061--REDEF
CLOSE_REBUILD.UTL_
     16062**DCL     16062--REDEF
CLOSE_REBUILD.V.EXPIRE#
     16076**DCL     16076--REDEF
CLOSE_REBUILD.V.TYPE#
     16074**DCL     16074--REDEF
CLOSE_REBUILD.V.XTNSIZE#
     16071**DCL     16071--REDEF   16073--REDEF
CLOSE_STATUS.SN_
     15276**DCL     15276--REDEF
PL6.E3A0      #002=FLI$TAPE_OPEN File=FLI$TAPE.:E05TSI                           TUE 07/29/97 15:55 Page:57   
CLOSE_STATUS.UTL_
     15277**DCL     15277--REDEF
CLOSE_STATUS.V.EXPIRE#
     15291**DCL     15291--REDEF
CLOSE_STATUS.V.TYPE#
     15289**DCL     15289--REDEF
CLOSE_STATUS.V.XTNSIZE#
     15286**DCL     15286--REDEF   15288--REDEF
CLOSE_TSN_USED.SN_
     14986**DCL     14986--REDEF
CLOSE_TSN_USED.UTL_
     14987**DCL     14987--REDEF
CLOSE_TSN_USED.V.EXPIRE#
     15001**DCL     15001--REDEF
CLOSE_TSN_USED.V.TYPE#
     14999**DCL     14999--REDEF
CLOSE_TSN_USED.V.XTNSIZE#
     14996**DCL     14996--REDEF   14998--REDEF
CON_CLOSE_ARCHIVE.SN_
     15318**DCL     15318--REDEF
CON_CLOSE_ARCHIVE.UTL_
     15319**DCL     15319--REDEF
CON_CLOSE_ARCHIVE.V.EXPIRE#
     15333**DCL     15333--REDEF
CON_CLOSE_ARCHIVE.V.TYPE#
     15331**DCL     15331--REDEF
CON_CLOSE_ARCHIVE.V.XTNSIZE#
     15328**DCL     15328--REDEF   15330--REDEF
CON_OPEN_ARCHIVE_FILE.ACSVEH_
     15405**DCL     15406--REDEF
CON_OPEN_ARCHIVE_FILE.ALTKEYS_
     15411**DCL     15412--REDEF   15412--REDEF
CON_OPEN_ARCHIVE_FILE.HDR_
     15410**DCL     15411--REDEF
CON_OPEN_ARCHIVE_FILE.TAB_
     15409**DCL     15410--REDEF
PL6.E3A0      #002=FLI$TAPE_OPEN File=FLI$TAPE.:E05TSI                           TUE 07/29/97 15:55 Page:58   
CON_OPEN_ARCHIVE_FILE.UHL_
     15403**DCL     15404--REDEF   15404--REDEF
CON_OPEN_ARCHIVE_FILE.V.FSN#
     15443**DCL     15443--REDEF   15443--REDEF
CON_OPEN_ARCHIVE_FILE.WSN_
     15409**DCL     15409--REDEF
CON_READ_ARCHIVE_FILE.STATION_
     15467**DCL     15468--REDEF
CON_READ_ARCHIVE_FILE.V.DVBYTE.REREAD#
     15479**DCL     15479--REDEF
CON_READ_ARCHIVE_FILE.V.INDX#
     15477**DCL     15477--REDEF
CVOL_UTL.ULBL#
     14746**DCL     14746--REDEF
DCB#
        22**DCL         6--PROC    16723<<ASSIGN  16737<<ASSIGN
DEL_NODATA_REC.V
     16412**DCL     16409--DCLINIT
DEST_TAPE_VOL
     14750**DCL     16715<<ASSIGN
DISK_CLOSE.SN_
     13816**DCL     13816--REDEF
DISK_CLOSE.UTL_
     13817**DCL     13817--REDEF
DISK_CLOSE.V.EXPIRE#
     13831**DCL     13831--REDEF
DISK_CLOSE.V.TYPE#
     13829**DCL     13829--REDEF
DISK_CLOSE.V.XTNSIZE#
     13826**DCL     13826--REDEF   13828--REDEF
DISK_FILE_SPEC.SPEC
     14181**DCL     14183--REDEF
DISK_FILE_SPEC.SPEC.START
     14182**DCL     14182--REDEF
DISK_FILE_SPEC.SPEC.STOP
     14183**DCL     14183--REDEF
PL6.E3A0      #002=FLI$TAPE_OPEN File=FLI$TAPE.:E05TSI                           TUE 07/29/97 15:55 Page:59   
DISK_FILE_SPEC$
     14180**DCL     14181--IMP-PTR
DISK_GRAN$
     14657**DCL     14657--IMP-PTR
DISK_OPEN.ACSVEH_
     13681**DCL     13682--REDEF
DISK_OPEN.ALTKEYS_
     13687**DCL     13688--REDEF   13688--REDEF
DISK_OPEN.HDR_
     13686**DCL     13687--REDEF
DISK_OPEN.TAB_
     13685**DCL     13686--REDEF
DISK_OPEN.UHL_
     13679**DCL     13680--REDEF   13680--REDEF
DISK_OPEN.V.FSN#
     13719**DCL     13719--REDEF   13719--REDEF
DISK_OPEN.WSN_
     13685**DCL     13685--REDEF
DISK_READ.STATION_
     13743**DCL     13744--REDEF
DISK_READ.V.DVBYTE.REREAD#
     13755**DCL     13755--REDEF
DISK_READ.V.INDX#
     13753**DCL     13753--REDEF
DISK_WRITE.STATION_
     13781**DCL     13781--REDEF
DISK_WRITE.V.DVBYTE.VFC#
     13788**DCL     13788--REDEF
DPLIST$
     14166**DCL     14178--IMP-PTR
DPRESLIST$
     14180**DCL     14180--IMP-PTR
DUAL_FILE.L#
     15582**DCL     15582--IMP-SIZ
EFTWORD
     14301**DCL     14301--REDEF
PL6.E3A0      #002=FLI$TAPE_OPEN File=FLI$TAPE.:E05TSI                           TUE 07/29/97 15:55 Page:60   
EFT_CVOL_FILE.L#
     14706**DCL     14706--IMP-SIZ
EFT_RESTRICT_FILE.L#
     14733**DCL     14733--IMP-SIZ
EOVOL_DETECTED
     14144**DCL     16694<<ASSIGN
ERR
        21**DCL         6--PROC    16693<<ASSIGN  16722<<ASSIGN  16738<<ASSIGN
E_NO_FSN_MATCH
      8941**DCL     16722>>ASSIGN
F$DCB.ACTPOS
     16594**DCL     16594--REDEF
F$DCB.ARS#
     16568**DCL     16568--REDEF
F$DCB.ATTR
     16587**DCL     16588--REDEF
F$DCB.BORROW
     16602**DCL     16602--REDEF   16602--REDEF   16602--REDEF
F$DCB.DCBNAME.L
     16616**DCL     16616--IMP-SIZ
F$DCB.EOMCHAR#
     16572**DCL     16572--REDEF
F$DCB.FCD#
     16581**DCL     16794>>IF
F$DCB.FLDID
     16597**DCL     16597--REDEF
F$DCB.FORM$
     16591**DCL     16591--REDEF
F$DCB.FSECT
     16607**DCL     16607--REDEF
F$DCB.FSN#
     16584**DCL     16584--REDEF   16584--REDEF   16585--REDEF   16716>>ASSIGN  16718>>IF
F$DCB.HEADER$
     16590**DCL     16590--REDEF
F$DCB.IXTNSIZE#
     16588**DCL     16588--REDEF
PL6.E3A0      #002=FLI$TAPE_OPEN File=FLI$TAPE.:E05TSI                           TUE 07/29/97 15:55 Page:61   
F$DCB.LASTSTA$
     16577**DCL     16577--REDEF
F$DCB.LVL
     16603**DCL     16603--REDEF
F$DCB.NAME#
     16578**DCL     16731>>ASSIGN
F$DCB.NAME#.C
     16578**DCL     16578--REDEF
F$DCB.NOEOF
     16600**DCL     16600--REDEF
F$DCB.NRECS#
     16589**DCL     16589--REDEF
F$DCB.NRECX
     16608**DCL     16608--REDEF
F$DCB.OHDR
     16600**DCL     16600--REDEF
F$DCB.ORG#
     16583**DCL     16583--REDEF
F$DCB.PRECNO
     16606**DCL     16606--REDEF
F$DCB.PSN#
     16578**DCL     16728>>ASSIGN
F$DCB.RCSZ
     16612**DCL     16612--REDEF
F$DCB.RES#
     16579**DCL     16579--REDEF
F$DCB.SETX
     16591**DCL     16591--REDEF
F$DCB.TAB$
     16591**DCL     16591--REDEF
F$DCB.TDA
     16605**DCL     16606--REDEF
F$DCB.VOL#
     16589**DCL     16715>>ASSIGN
F$DCB.WSN#
     16579**DCL     16579--REDEF
PL6.E3A0      #002=FLI$TAPE_OPEN File=FLI$TAPE.:E05TSI                           TUE 07/29/97 15:55 Page:62   
FIT_AREA.W2
     15017**DCL     15018--REDEF
FLI$ROLL_SNLISTS
     16507**DCL-ENT 16746--CALL
FLI_CLOSE_EM
     16790**PROC    16720--CALL    16739--CALL
FLI_MOUNT_TIME
     16756**PROC    16721--CALL    16740--CALL    16751--CALL
FLI_OPEN
     16772**PROC    16712--CALL
FPT_EXIT.V.STEPCC#
     13606**DCL     13606--REDEF   16742>>IF      16743<<ASSIGN
FSN
        16**DCL         6--PROC    16668>>ASSIGN  16706<<ASSIGN  16713>>IF      16716<<ASSIGN  16718>>IF
GET_NOW_UTS
     14157**DCL     16701<>CALL    16765<>CALL
I
     16552**DCL     16707<<DOINDEX 16708>>ASSIGN  16709>>ASSIGN  16711>>ASSIGN  16735>>IF      16737>>ASSIGN
     16793<<DOINDEX 16794>>IF      16796>>ASSIGN
IFPARAM_
        20**DCL         6--PROC
M$CLOSE
      7182**DCL-ENT 16797--CALL
M$OPEN
      7182**DCL-ENT 16777--CALL
M$TIME
      7249**DCL-ENT 16701--CALL    16765--CALL
NAME.PTR$
        14**DCL     16656--IMP-PTR 16731>>ASSIGN
NAME_
        11**DCL         6--PROC       12--REDEF   16671>>ASSIGN
NBR_BYTES_TO_MOVE
     14656**DCL     14657--IMP-SIZ 14658--IMP-SIZ
NBR_SNLISTS
     13593**DCL     16707>>DOINDEX 16767>>IF      16768>>ASSIGN  16793>>DOINDEX
NODATA_FILE_NAME.L#
PL6.E3A0      #002=FLI$TAPE_OPEN File=FLI$TAPE.:E05TSI                           TUE 07/29/97 15:55 Page:63   
     16271**DCL     16271--IMP-SIZ
NODATA_KEY
     16417**DCL     16409--DCLINIT 16410--DCLINIT
NOW_UTS
     14145**DCL     16702>>ASSIGN  16766<>CALL    16766<>CALL    16767>>IF      16768>>ASSIGN
NXTF
        18**DCL         6--PROC    16675>>ASSIGN  16730>>IF
OPEN_NODATA_LIST.ACSVEH_
     16204**DCL     16205--REDEF
OPEN_NODATA_LIST.ALTKEYS_
     16210**DCL     16211--REDEF   16211--REDEF
OPEN_NODATA_LIST.HDR_
     16209**DCL     16210--REDEF
OPEN_NODATA_LIST.TAB_
     16208**DCL     16209--REDEF
OPEN_NODATA_LIST.UHL_
     16202**DCL     16203--REDEF   16203--REDEF
OPEN_NODATA_LIST.V.FSN#
     16242**DCL     16242--REDEF   16242--REDEF
OPEN_NODATA_LIST.WSN_
     16208**DCL     16208--REDEF
OPEN_PRIME_DUAL.ACSVEH_
     15651**DCL     15652--REDEF
OPEN_PRIME_DUAL.ALTKEYS_
     15657**DCL     15658--REDEF   15658--REDEF
OPEN_PRIME_DUAL.HDR_
     15656**DCL     15657--REDEF
OPEN_PRIME_DUAL.TAB_
     15655**DCL     15656--REDEF
OPEN_PRIME_DUAL.UHL_
     15649**DCL     15650--REDEF   15650--REDEF
OPEN_PRIME_DUAL.V.FSN#
     15689**DCL     15689--REDEF   15689--REDEF
OPEN_PRIME_DUAL.WSN_
     15655**DCL     15655--REDEF
OPEN_REBUILD.ACSVEH_
PL6.E3A0      #002=FLI$TAPE_OPEN File=FLI$TAPE.:E05TSI                           TUE 07/29/97 15:55 Page:64   
     15886**DCL     15887--REDEF
OPEN_REBUILD.ALTKEYS_
     15892**DCL     15893--REDEF   15893--REDEF
OPEN_REBUILD.HDR_
     15891**DCL     15892--REDEF
OPEN_REBUILD.TAB_
     15890**DCL     15891--REDEF
OPEN_REBUILD.UHL_
     15884**DCL     15885--REDEF   15885--REDEF
OPEN_REBUILD.V.FSN#
     15924**DCL     15924--REDEF   15924--REDEF
OPEN_REBUILD.WSN_
     15890**DCL     15890--REDEF
OPEN_START_UTS
     16555**DCL     16702<<ASSIGN  16766<>CALL
OPEN_STATUS.ACSVEH_
     15088**DCL     15089--REDEF
OPEN_STATUS.ALTKEYS_
     15094**DCL     15095--REDEF   15095--REDEF
OPEN_STATUS.HDR_
     15093**DCL     15094--REDEF
OPEN_STATUS.TAB_
     15092**DCL     15093--REDEF
OPEN_STATUS.UHL_
     15086**DCL     15087--REDEF   15087--REDEF
OPEN_STATUS.V.FSN#
     15126**DCL     15126--REDEF   15126--REDEF
OPEN_STATUS.WSN_
     15092**DCL     15092--REDEF
OPEN_TSN_USED.ACSVEH_
     14824**DCL     14825--REDEF
OPEN_TSN_USED.ALTKEYS_
     14830**DCL     14831--REDEF   14831--REDEF
OPEN_TSN_USED.HDR_
     14829**DCL     14830--REDEF
OPEN_TSN_USED.TAB_
PL6.E3A0      #002=FLI$TAPE_OPEN File=FLI$TAPE.:E05TSI                           TUE 07/29/97 15:55 Page:65   
     14828**DCL     14829--REDEF
OPEN_TSN_USED.UHL_
     14822**DCL     14823--REDEF   14823--REDEF
OPEN_TSN_USED.V.FSN#
     14862**DCL     14862--REDEF   14862--REDEF
OPEN_TSN_USED.WSN_
     14828**DCL     14828--REDEF
PRE_RET_CLOSE.SN_
     14544**DCL     14544--REDEF
PRE_RET_CLOSE.UTL_
     14545**DCL     14545--REDEF
PRE_RET_CLOSE.V.EXPIRE#
     14559**DCL     14559--REDEF
PRE_RET_CLOSE.V.TYPE#
     14557**DCL     14557--REDEF
PRE_RET_CLOSE.V.XTNSIZE#
     14554**DCL     14554--REDEF   14556--REDEF
PRE_RET_OPEN.ACSVEH_
     14479**DCL     14480--REDEF
PRE_RET_OPEN.ALTKEYS_
     14485**DCL     14486--REDEF   14486--REDEF
PRE_RET_OPEN.HDR_
     14484**DCL     14485--REDEF
PRE_RET_OPEN.TAB_
     14483**DCL     14484--REDEF
PRE_RET_OPEN.UHL_
     14477**DCL     14478--REDEF   14478--REDEF
PRE_RET_OPEN.V.FSN#
     14517**DCL     14517--REDEF   14517--REDEF
PRE_RET_OPEN.WSN_
     14483**DCL     14483--REDEF
PRE_RET_READ.STATION_
     14334**DCL     14335--REDEF
PRE_RET_READ.V.DVBYTE.REREAD#
     14346**DCL     14346--REDEF
PRE_RET_READ.V.INDX#
PL6.E3A0      #002=FLI$TAPE_OPEN File=FLI$TAPE.:E05TSI                           TUE 07/29/97 15:55 Page:66   
     14344**DCL     14344--REDEF
PRE_RET_WRITE.STATION_
     14372**DCL     14372--REDEF
PRE_RET_WRITE.V.DVBYTE.VFC#
     14379**DCL     14379--REDEF
PRIME_FILE.L#
     15555**DCL     15555--IMP-SIZ
READ_NODATA_LIST.STATION_
     16348**DCL     16349--REDEF
READ_NODATA_LIST.V.DVBYTE.REREAD#
     16360**DCL     16360--REDEF
READ_NODATA_LIST.V.INDX#
     16358**DCL     16358--REDEF
READ_PRIME_DUAL.STATION_
     15713**DCL     15714--REDEF
READ_PRIME_DUAL.V.DVBYTE.REREAD#
     15725**DCL     15725--REDEF
READ_PRIME_DUAL.V.INDX#
     15723**DCL     15723--REDEF
READ_REBUILD.STATION_
     16019**DCL     16020--REDEF
READ_REBUILD.V.DVBYTE.REREAD#
     16031**DCL     16031--REDEF
READ_REBUILD.V.INDX#
     16029**DCL     16029--REDEF
READ_STATUS.STATION_
     15234**DCL     15235--REDEF
READ_STATUS.V.DVBYTE.REREAD#
     15246**DCL     15246--REDEF
READ_STATUS.V.INDX#
     15244**DCL     15244--REDEF
READ_TSN_USED.STATION_
     14944**DCL     14945--REDEF
READ_TSN_USED.V.DVBYTE.REREAD#
     14956**DCL     14956--REDEF
READ_TSN_USED.V.INDX#
PL6.E3A0      #002=FLI$TAPE_OPEN File=FLI$TAPE.:E05TSI                           TUE 07/29/97 15:55 Page:67   
     14954**DCL     14954--REDEF
REBUILD_DIR_KEY.L#
     16105**DCL     16105--IMP-SIZ
REBUILD_KEY.L#
     16132**DCL     16132--IMP-SIZ
REBUILD_NAME.L#
     15953**DCL     15953--IMP-SIZ
RETRY_NEEDED
     16554**DCL     16700<<ASSIGN  16704>>DOWHILE 16705<<ASSIGN  16747<<ASSIGN
RET_CMDS_NAME.L#
     14588**DCL     14588--IMP-SIZ
SN
        15**DCL         6--PROC    16728<<ASSIGN
SNVECLIST.SN_
     14120**DCL     16708>>ASSIGN
SNVECLIST$
     14120**DCL     14120--IMP-PTR 16708>>ASSIGN
SPEC.START
     14184**DCL     14185--REDEF
SPEC.STOP
     14185**DCL     14186--REDEF
SPECCHARS
     14184**DCL     14184--REDEF
TAPE_BLOCK_.W2
     14672**DCL     14673--REDEF
TAPE_CLOSE
     14037**DCL     16797<>CALL
TAPE_CLOSE.SN_
     14037**DCL     14037--REDEF
TAPE_CLOSE.UTL_
     14038**DCL     14038--REDEF   16792<<ASSIGN
TAPE_CLOSE.V.DCB#
     14043**DCL     16796<<ASSIGN
TAPE_CLOSE.V.EXPIRE#
     14052**DCL     14052--REDEF
TAPE_CLOSE.V.TYPE#
PL6.E3A0      #002=FLI$TAPE_OPEN File=FLI$TAPE.:E05TSI                           TUE 07/29/97 15:55 Page:68   
     14050**DCL     14050--REDEF
TAPE_CLOSE.V.XTNSIZE#
     14047**DCL     14047--REDEF   14049--REDEF
TAPE_DCBLIST.DCB#
     13593**DCL     16709>>ASSIGN  16737>>ASSIGN  16796>>ASSIGN
TAPE_DCBLIST.DCB$
     13593**DCL     16711>>ASSIGN  16727>>ASSIGN  16794>>IF
TAPE_DCBLIST$
     13593**DCL     13593--IMP-PTR 16709>>ASSIGN  16711>>ASSIGN  16727>>ASSIGN  16737>>ASSIGN  16794>>IF
     16796>>ASSIGN
TAPE_OPEN
     13900**DCL     16777<>CALL
TAPE_OPEN.ACSVEH_
     13902**DCL     13903--REDEF
TAPE_OPEN.ALTKEYS_
     13908**DCL     13909--REDEF   13909--REDEF
TAPE_OPEN.FPARAM_
     13905**DCL     16688<<ASSIGN
TAPE_OPEN.HDR_
     13907**DCL     13908--REDEF
TAPE_OPEN.IFPARAM_
     13905**DCL     16685<<ASSIGN
TAPE_OPEN.NAME_
     13901**DCL     16667<<ASSIGN  16671<<ASSIGN
TAPE_OPEN.SN_
     13900**DCL     16708<<ASSIGN
TAPE_OPEN.TAB_
     13906**DCL     13907--REDEF
TAPE_OPEN.UHL_
     13900**DCL     13901--REDEF   13901--REDEF
TAPE_OPEN.V.DCB#
     13909**DCL     16709<<ASSIGN  16710>>ASSIGN
TAPE_OPEN.V.FSN#
     13940**DCL     13940--REDEF   13940--REDEF   16668<<ASSIGN  16672<<ASSIGN
TAPE_OPEN.V.FUN#
     13919**DCL     16730>>IF
PL6.E3A0      #002=FLI$TAPE_OPEN File=FLI$TAPE.:E05TSI                           TUE 07/29/97 15:55 Page:69   
TAPE_OPEN.V.INITZ.SCRUB#
     13910**DCL     16750<<ASSIGN
TAPE_OPEN.V.OPER.NXTF#
     13912**DCL     16675<<ASSIGN
TAPE_OPEN.V.VOL#
     13934**DCL     16752<<ASSIGN
TAPE_OPEN.WSN_
     13906**DCL     13906--REDEF
TAPE_READ.STATION_
     13964**DCL     13965--REDEF
TAPE_READ.V.DVBYTE.REREAD#
     13976**DCL     13976--REDEF
TAPE_READ.V.INDX#
     13974**DCL     13974--REDEF
TAPE_VOL_DCB$
     16553**DCL     16562--IMP-PTR 16711<<ASSIGN  16715>>ASSIGN  16716>>ASSIGN  16718>>IF      16727<<ASSIGN
     16728>>ASSIGN  16731>>ASSIGN
TAPE_WRITE.STATION_
     14002**DCL     14002--REDEF
TAPE_WRITE.V.DVBYTE.VFC#
     14009**DCL     14009--REDEF
TSN_USED_NAME.L#
     14891**DCL     14891--IMP-SIZ
TVECTOR.W2
     14133**DCL     14134--REDEF
USEFSN
        17**DCL         6--PROC    16665>>IF      16730>>IF
VLP_NAME
     16656**DCL     16731<<ASSIGN
VOL
        19**DCL         6--PROC
WRITE_NODATA_LIST.STATION_
     16386**DCL     16386--REDEF
WRITE_NODATA_LIST.V.DVBYTE.VFC#
     16393**DCL     16393--REDEF
WRITE_PRIME_DUAL.STATION_
PL6.E3A0      #002=FLI$TAPE_OPEN File=FLI$TAPE.:E05TSI                           TUE 07/29/97 15:55 Page:70   
     15751**DCL     15751--REDEF
WRITE_PRIME_DUAL.V.DVBYTE.VFC#
     15758**DCL     15758--REDEF
WRITE_REBUILD.STATION_
     15987**DCL     15987--REDEF
WRITE_REBUILD.V.DVBYTE.VFC#
     15994**DCL     15994--REDEF
WRITE_STATUS.STATION_
     15202**DCL     15202--REDEF
WRITE_STATUS.V.DVBYTE.VFC#
     15209**DCL     15209--REDEF
WRITE_TSN_USED.STATION_
     14912**DCL     14912--REDEF
WRITE_TSN_USED.V.DVBYTE.VFC#
     14919**DCL     14919--REDEF
XUD$UTS_DIFF
     16509**DCL-ENT 16766--CALL

PL6.E3A0      #003=FLI$TAPE_CLOSE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:56 Page:71   
      325        1        /*T***********************************************************/
      326        2        /*T*                                                         */
      327        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      328        4        /*T*                                                         */
      329        5        /*T***********************************************************/
      330        6        FLI$TAPE_CLOSE: PROC( CVOL ) ALTRET;
      331        7        /*F*  NAME: FLI$TAPE_CLOSE
      332        8              PURPOSE: Close currently open tape volumes.
      333        9         */
      334       10
      335       11    1   DCL CVOL BIT(1) ALIGNED;                /* Specified if CVOL next             */
      336       12
      337       13         /***
      338       14          *** INCLUDE
      339       15          ***/
      340       16
      341       17        %INCLUDE CP_6_SUBS;
      342      557        %INCLUDE CP_6;
      343     6116        %INCLUDE FLI_DATA_R;
      344     7530
      345     7531         /***
      346     7532          *** ENTRY
      347     7533          ***/
      348     7534
      349     7535    1   DCL FLI$RPT_ERR ENTRY(5);
      350     7536
      351     7537         /***
      352     7538          *** AUTO
      353     7539          ***/
      354     7540
      355     7541    1   DCL I SBIN AUTO;
      356     7542    1   DCL GOT_ERROR BIT(1) AUTO;
      357     7543
      358     7544        /***
      359     7545         *** FPT
      360     7546         ***/
      361     7547
PL6.E3A0      #003=FLI$TAPE_CLOSE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:56 Page:72   
      362     7548        %VLP_ULBL( FPTN=CVOL_UTL,
      363     7549                     N=1,
      364     7550                   ULBL='UTL1CVOL',
      365     7551                   STCLASS=CONSTANT );
      366     7565        %F$DCB;
      367     7622
      368     7623        /****************************************/
      369     7624
      370     7625    1      IF ADDR(CVOL) = ADDR(NIL)
      371     7626    1       THEN TAPE_CLOSE.UTL_ = VECTOR(NIL);
      372     7627    1       ELSE TAPE_CLOSE.UTL_ = VECTOR(CVOL_UTL);
      373     7628
      374     7629         /***
      375     7630          *** Close each open DCB/snlist.
      376     7631          ***/
      377     7632
      378     7633    1      GOT_ERROR = '0'B;
      379     7634    2      DO I=0 TO NBR_SNLISTS-1;
      380     7635    2         TAPE_CLOSE.V.DCB# = TAPE_DCBLIST.DCB#(I);
      381     7636    2         IF TAPE_DCBLIST.DCB$(I)->F$DCB.FCD#
      382     7637    2          THEN CALL M$CLOSE( TAPE_CLOSE )
      383     7638    3             WHENALTRETURN DO;
      384     7639    3               CALL FLI$RPT_ERR;
      385     7640    3               IF FPT_EXIT.V.STEPCC# < %TAPE_ERROR
      386     7641    3                THEN FPT_EXIT.V.STEPCC# = %TAPE_ERROR;
      387     7642    3               GOT_ERROR = '1'B;
      388     7643    3               END;
      389     7644    2         END;
      390     7645    1      IF GOT_ERROR
      391     7646    1       THEN ALTRETURN;
      392     7647    1       ELSE RETURN;
      393     7648
      394     7649    1   END FLI$TAPE_CLOSE;
      395     7650        %EOD;

PL6.E3A0      #003=FLI$TAPE_CLOSE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:56 Page:73   
--  Include file information  --

   B_MICROPS_C.:E05TOU  is referenced.
   FLB_SUBS_C.:E05TOU  is referenced.
   FLI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
      No diagnostics issued in procedure FLI$TAPE_CLOSE.

   Procedure FLI$TAPE_CLOSE requires 46 words for executable code.
   Procedure FLI$TAPE_CLOSE requires 6 words of local(AUTO) storage.

PL6.E3A0      #003=FLI$TAPE_CLOSE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:56 Page:74   

 Object Unit name= FLI$TAPE_CLOSE                             File name= FLI$TAPE.:E05TOU
 UTS= JUL 29 '97 15:56:44.20 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   DCB   even  none     0      0  M$PRE_RET
    2   Data  even  none     6      6  FLI$TAPE_CLOSE
    3  RoData even  UTS     22     26  FLI$TAPE_CLOSE
    4   Proc  even  none    46     56  FLI$TAPE_CLOSE
    5  RoData even  none     4      4  FLI$TAPE_CLOSE

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     4      0   yes    yes     yes      Std        1  FLI$TAPE_CLOSE

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       5 FLI$RPT_ERR
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AALT
                       nStd      0 X66_ARET
PL6.E3A0      #003=FLI$TAPE_CLOSE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:56 Page:75   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  NBR_SNLISTS                           TAPE_DCBLIST$
     FPT_EXIT                              TAPE_CLOSE                            SNVECLIST$
     DPLIST$                               DPRESLIST$                            DISK_FILE_SPEC$
     SPECCHARS                             EFTWORD                               M$PRE_RET
     RET_CMDS_NAME                         B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     NULLSID                               ISSID
PL6.E3A0      #003=FLI$TAPE_CLOSE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:56 Page:76   


      325        1        /*T***********************************************************/
      326        2        /*T*                                                         */
      327        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      328        4        /*T*                                                         */
      329        5        /*T***********************************************************/
      330        6        FLI$TAPE_CLOSE: PROC( CVOL ) ALTRET;

      6  4 000000   000000 700200 xent  FLI$TAPE_CL* TSX0  ! X66_AUTO_1
         4 000001   000006 000001                    ZERO    6,1

      331        7        /*F*  NAME: FLI$TAPE_CLOSE
      332        8              PURPOSE: Close currently open tape volumes.
      333        9         */
      334       10
      335       11    1   DCL CVOL BIT(1) ALIGNED;                /* Specified if CVOL next             */
      336       12
      337       13         /***
      338       14          *** INCLUDE
      339       15          ***/
      340       16
      341       17        %INCLUDE CP_6_SUBS;
      342      557        %INCLUDE CP_6;
      343     6116        %INCLUDE FLI_DATA_R;
      344     7530
      345     7531         /***
      346     7532          *** ENTRY
      347     7533          ***/
      348     7534
      349     7535    1   DCL FLI$RPT_ERR ENTRY(5);
      350     7536
      351     7537         /***
      352     7538          *** AUTO
      353     7539          ***/
      354     7540
      355     7541    1   DCL I SBIN AUTO;
      356     7542    1   DCL GOT_ERROR BIT(1) AUTO;
PL6.E3A0      #003=FLI$TAPE_CLOSE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:56 Page:77   
      357     7543
      358     7544        /***
      359     7545         *** FPT
      360     7546         ***/
      361     7547
      362     7548        %VLP_ULBL( FPTN=CVOL_UTL,
      363     7549                     N=1,
      364     7550                   ULBL='UTL1CVOL',
      365     7551                   STCLASS=CONSTANT );
      366     7565        %F$DCB;
      367     7622
      368     7623        /****************************************/
      369     7624
      370     7625    1      IF ADDR(CVOL) = ADDR(NIL)

   7625  4 000002   200003 236100                    LDQ     @CVOL,,AUTO
         4 000003   000001 116000 xsym               CMPQ    B_VECTNIL+1
         4 000004   000010 601000 4                  TNZ     s:7627

      371     7626    1       THEN TAPE_CLOSE.UTL_ = VECTOR(NIL);

   7626  4 000005   000000 237000 5                  LDAQ    0
         4 000006   000004 757000 xsym               STAQ    TAPE_CLOSE+4
         4 000007   000012 710000 4                  TRA     s:7633

      372     7627    1       ELSE TAPE_CLOSE.UTL_ = VECTOR(CVOL_UTL);

   7627  4 000010   000002 237000 5                  LDAQ    2
         4 000011   000004 757000 xsym               STAQ    TAPE_CLOSE+4

      373     7628
      374     7629         /***
      375     7630          *** Close each open DCB/snlist.
      376     7631          ***/
      377     7632
      378     7633    1      GOT_ERROR = '0'B;

PL6.E3A0      #003=FLI$TAPE_CLOSE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:56 Page:78   
   7633  4 000012   200005 450100                    STZ     GOT_ERROR,,AUTO

      379     7634    2      DO I=0 TO NBR_SNLISTS-1;

   7634  4 000013   200004 450100                    STZ     I,,AUTO
         4 000014   000047 710000 4                  TRA     s:7644+1

      380     7635    2         TAPE_CLOSE.V.DCB# = TAPE_DCBLIST.DCB#(I);

   7635  4 000015   200004 235100                    LDA     I,,AUTO
         4 000016   000001 735000                    ALS     1
         4 000017   000000 470400 xsym               LDP0    TAPE_DCBLIST$
         4 000020   000000 720105                    LXL0    0,AL,PR0
         4 000021   000032 740000 xsym               STX0    TAPE_CLOSE+26

      381     7636    2         IF TAPE_DCBLIST.DCB$(I)->F$DCB.FCD#

   7636  4 000022   000001 471505                    LDP1    1,AL,PR0
         4 000023   100031 236100                    LDQ     25,,PR1
         4 000024   020000 316007                    CANQ    8192,DL
         4 000025   000046 600000 4                  TZE     s:7644

      382     7637    2          THEN CALL M$CLOSE( TAPE_CLOSE )

   7637  4 000026   000000 630400 xsym               EPPR0   TAPE_CLOSE
         4 000027   450001 713400                    CLIMB   alt,close
         4 000030   406000 401760                    pmme    nvectors=13
         4 000031   000033 702000 4                  TSX2    s:7639
         4 000032   000046 710000 4                  TRA     s:7644

      383     7638    3             WHENALTRETURN DO;

      384     7639    3               CALL FLI$RPT_ERR;

   7639  4 000033   000002 631400 xsym               EPPR1   B_VECTNIL+2
         4 000034   000000 701000 xent               TSX1    FLI$RPT_ERR
         4 000035   000000 011000                    NOP     0
PL6.E3A0      #003=FLI$TAPE_CLOSE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:56 Page:79   

      385     7640    3               IF FPT_EXIT.V.STEPCC# < %TAPE_ERROR

   7640  4 000036   000004 236000 xsym               LDQ     FPT_EXIT+4
         4 000037   777000 376003                    ANQ     -512,DU
         4 000040   004000 116003                    CMPQ    2048,DU
         4 000041   000044 603000 4                  TRC     s:7642

      386     7641    3                THEN FPT_EXIT.V.STEPCC# = %TAPE_ERROR;

   7641  4 000042   004000 236003                    LDQ     2048,DU
         4 000043   000004 552040 xsym               STBQ    FPT_EXIT+4,'40'O

      387     7642    3               GOT_ERROR = '1'B;

   7642  4 000044   400000 236003                    LDQ     -131072,DU
         4 000045   200005 756100                    STQ     GOT_ERROR,,AUTO

      388     7643    3               END;

      389     7644    2         END;

   7644  4 000046   200004 054100                    AOS     I,,AUTO
         4 000047   200004 236100                    LDQ     I,,AUTO
         4 000050   000000 116000 xsym               CMPQ    NBR_SNLISTS
         4 000051   000015 604000 4                  TMI     s:7635

      390     7645    1      IF GOT_ERROR

   7645  4 000052   200005 234100                    SZN     GOT_ERROR,,AUTO
         4 000053   000055 605000 4                  TPL     s:7647

      391     7646    1       THEN ALTRETURN;

   7646  4 000054   000000 702200 xent               TSX2  ! X66_AALT

      392     7647    1       ELSE RETURN;
PL6.E3A0      #003=FLI$TAPE_CLOSE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:56 Page:80   

   7647  4 000055   000000 702200 xent               TSX2  ! X66_ARET
      393     7648
      394     7649    1   END FLI$TAPE_CLOSE;
      395     7650        %EOD;

PL6.E3A0      #003=FLI$TAPE_CLOSE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:56 Page:81   
--  Include file information  --

   B_MICROPS_C.:E05TOU  is referenced.
   FLB_SUBS_C.:E05TOU  is referenced.
   FLI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
      No diagnostics issued in procedure FLI$TAPE_CLOSE.
PL6.E3A0      #003=FLI$TAPE_CLOSE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:56 Page:82   

 **** Variables and constants ****

  ****  Section 003 RoData FLI$TAPE_CLOSE

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(756)   r     1 CVOL_UTL

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @CVOL                     *0-0-0/w BIT         r     1 CVOL
     5-0-0/b BIT         r     1 GOT_ERROR                  4-0-0/w SBIN        r     1 I

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 DISK_FILE_SPEC$            0-0-0/w PTR         r     1 DPLIST$
     0-0-0/w PTR         r     1 DPRESLIST$                 0-0-0/d STRC(216)   r     1 FPT_EXIT
     0-0-0/w SBIN        r     1 NBR_SNLISTS                0-0-0/c ASTR(9)     r     1 RET_CMDS_NAME
     0-0-0/w PTR         r     1 SNVECLIST$                 0-0-0/d STRC(1080)  r     1 TAPE_CLOSE
     0-0-0/w PTR         r     1 TAPE_DCBLIST$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d ASTR(3528)  r     1 F$DCB
     0-0-0/w STRC(72)    r     1 TAPE_DCBLIST(0:0)

PL6.E3A0      #003=FLI$TAPE_CLOSE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:56 Page:83   

   Procedure FLI$TAPE_CLOSE requires 46 words for executable code.
   Procedure FLI$TAPE_CLOSE requires 6 words of local(AUTO) storage.
PL6.E3A0      #003=FLI$TAPE_CLOSE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:56 Page:84   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=FLI$TAPE_CLOSE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:56 Page:85   
          MINI XREF LISTING

CVOL
        11**DCL         6--PROC     7625--IF
CVOL_UTL
      7562**DCL      7627--ASSIGN
CVOL_UTL.ULBL#
      7562**DCL      7562--REDEF
DISK_CLOSE.SN_
      6727**DCL      6727--REDEF
DISK_CLOSE.UTL_
      6728**DCL      6728--REDEF
DISK_CLOSE.V.EXPIRE#
      6742**DCL      6742--REDEF
DISK_CLOSE.V.TYPE#
      6740**DCL      6740--REDEF
DISK_CLOSE.V.XTNSIZE#
      6737**DCL      6737--REDEF    6739--REDEF
DISK_FILE_SPEC.SPEC
      7092**DCL      7094--REDEF
DISK_FILE_SPEC.SPEC.START
      7093**DCL      7093--REDEF
DISK_FILE_SPEC.SPEC.STOP
      7094**DCL      7094--REDEF
DISK_FILE_SPEC$
      7091**DCL      7092--IMP-PTR
DISK_OPEN.ACSVEH_
      6592**DCL      6593--REDEF
DISK_OPEN.ALTKEYS_
      6598**DCL      6599--REDEF    6599--REDEF
DISK_OPEN.HDR_
      6597**DCL      6598--REDEF
DISK_OPEN.TAB_
      6596**DCL      6597--REDEF
PL6.E3A0      #003=FLI$TAPE_CLOSE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:56 Page:86   
DISK_OPEN.UHL_
      6590**DCL      6591--REDEF    6591--REDEF
DISK_OPEN.V.FSN#
      6630**DCL      6630--REDEF    6630--REDEF
DISK_OPEN.WSN_
      6596**DCL      6596--REDEF
DISK_READ.STATION_
      6654**DCL      6655--REDEF
DISK_READ.V.DVBYTE.REREAD#
      6666**DCL      6666--REDEF
DISK_READ.V.INDX#
      6664**DCL      6664--REDEF
DISK_WRITE.STATION_
      6692**DCL      6692--REDEF
DISK_WRITE.V.DVBYTE.VFC#
      6699**DCL      6699--REDEF
DPLIST$
      7077**DCL      7089--IMP-PTR
DPRESLIST$
      7091**DCL      7091--IMP-PTR
EFTWORD
      7212**DCL      7212--REDEF
F$DCB.ACTPOS
      7598**DCL      7598--REDEF
F$DCB.ARS#
      7572**DCL      7572--REDEF
F$DCB.ATTR
      7591**DCL      7592--REDEF
F$DCB.BORROW
      7606**DCL      7606--REDEF    7606--REDEF    7606--REDEF
F$DCB.DCBNAME.L
      7620**DCL      7620--IMP-SIZ
F$DCB.EOMCHAR#
      7576**DCL      7576--REDEF
F$DCB.FCD#
      7585**DCL      7636>>IF
PL6.E3A0      #003=FLI$TAPE_CLOSE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:56 Page:87   
F$DCB.FLDID
      7601**DCL      7601--REDEF
F$DCB.FORM$
      7595**DCL      7595--REDEF
F$DCB.FSECT
      7611**DCL      7611--REDEF
F$DCB.FSN#
      7588**DCL      7588--REDEF    7588--REDEF    7589--REDEF
F$DCB.HEADER$
      7594**DCL      7594--REDEF
F$DCB.IXTNSIZE#
      7592**DCL      7592--REDEF
F$DCB.LASTSTA$
      7581**DCL      7581--REDEF
F$DCB.LVL
      7607**DCL      7607--REDEF
F$DCB.NAME#.C
      7582**DCL      7582--REDEF
F$DCB.NOEOF
      7604**DCL      7604--REDEF
F$DCB.NRECS#
      7593**DCL      7593--REDEF
F$DCB.NRECX
      7612**DCL      7612--REDEF
F$DCB.OHDR
      7604**DCL      7604--REDEF
F$DCB.ORG#
      7587**DCL      7587--REDEF
F$DCB.PRECNO
      7610**DCL      7610--REDEF
F$DCB.RCSZ
      7616**DCL      7616--REDEF
F$DCB.RES#
      7583**DCL      7583--REDEF
F$DCB.SETX
      7595**DCL      7595--REDEF
PL6.E3A0      #003=FLI$TAPE_CLOSE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:56 Page:88   
F$DCB.TAB$
      7595**DCL      7595--REDEF
F$DCB.TDA
      7609**DCL      7610--REDEF
F$DCB.WSN#
      7583**DCL      7583--REDEF
FLI$RPT_ERR
      7535**DCL-ENT  7639--CALL
FPT_EXIT.V.STEPCC#
      6517**DCL      6517--REDEF    7640>>IF       7641<<ASSIGN
GOT_ERROR
      7542**DCL      7633<<ASSIGN   7642<<ASSIGN   7645>>IF
I
      7541**DCL      7634<<DOINDEX  7635>>ASSIGN   7636>>IF
M$CLOSE
      6044**DCL-ENT  7637--CALL
NBR_SNLISTS
      6504**DCL      7634>>DOINDEX
PRE_RET_CLOSE.SN_
      7455**DCL      7455--REDEF
PRE_RET_CLOSE.UTL_
      7456**DCL      7456--REDEF
PRE_RET_CLOSE.V.EXPIRE#
      7470**DCL      7470--REDEF
PRE_RET_CLOSE.V.TYPE#
      7468**DCL      7468--REDEF
PRE_RET_CLOSE.V.XTNSIZE#
      7465**DCL      7465--REDEF    7467--REDEF
PRE_RET_OPEN.ACSVEH_
      7390**DCL      7391--REDEF
PRE_RET_OPEN.ALTKEYS_
      7396**DCL      7397--REDEF    7397--REDEF
PRE_RET_OPEN.HDR_
      7395**DCL      7396--REDEF
PRE_RET_OPEN.TAB_
      7394**DCL      7395--REDEF
PL6.E3A0      #003=FLI$TAPE_CLOSE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:56 Page:89   
PRE_RET_OPEN.UHL_
      7388**DCL      7389--REDEF    7389--REDEF
PRE_RET_OPEN.V.FSN#
      7428**DCL      7428--REDEF    7428--REDEF
PRE_RET_OPEN.WSN_
      7394**DCL      7394--REDEF
PRE_RET_READ.STATION_
      7245**DCL      7246--REDEF
PRE_RET_READ.V.DVBYTE.REREAD#
      7257**DCL      7257--REDEF
PRE_RET_READ.V.INDX#
      7255**DCL      7255--REDEF
PRE_RET_WRITE.STATION_
      7283**DCL      7283--REDEF
PRE_RET_WRITE.V.DVBYTE.VFC#
      7290**DCL      7290--REDEF
RET_CMDS_NAME.L#
      7499**DCL      7499--IMP-SIZ
SNVECLIST$
      7031**DCL      7031--IMP-PTR
SPEC.START
      7095**DCL      7096--REDEF
SPEC.STOP
      7096**DCL      7097--REDEF
SPECCHARS
      7095**DCL      7095--REDEF
TAPE_CLOSE
      6948**DCL      7637<>CALL
TAPE_CLOSE.SN_
      6948**DCL      6948--REDEF
TAPE_CLOSE.UTL_
      6949**DCL      6949--REDEF    7626<<ASSIGN   7627<<ASSIGN
TAPE_CLOSE.V.DCB#
      6954**DCL      7635<<ASSIGN
TAPE_CLOSE.V.EXPIRE#
      6963**DCL      6963--REDEF
PL6.E3A0      #003=FLI$TAPE_CLOSE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:56 Page:90   
TAPE_CLOSE.V.TYPE#
      6961**DCL      6961--REDEF
TAPE_CLOSE.V.XTNSIZE#
      6958**DCL      6958--REDEF    6960--REDEF
TAPE_DCBLIST.DCB#
      6504**DCL      7635>>ASSIGN
TAPE_DCBLIST.DCB$
      6504**DCL      7636>>IF
TAPE_DCBLIST$
      6504**DCL      6504--IMP-PTR  7635>>ASSIGN   7636>>IF
TAPE_OPEN.ACSVEH_
      6813**DCL      6814--REDEF
TAPE_OPEN.ALTKEYS_
      6819**DCL      6820--REDEF    6820--REDEF
TAPE_OPEN.HDR_
      6818**DCL      6819--REDEF
TAPE_OPEN.TAB_
      6817**DCL      6818--REDEF
TAPE_OPEN.UHL_
      6811**DCL      6812--REDEF    6812--REDEF
TAPE_OPEN.V.FSN#
      6851**DCL      6851--REDEF    6851--REDEF
TAPE_OPEN.WSN_
      6817**DCL      6817--REDEF
TAPE_READ.STATION_
      6875**DCL      6876--REDEF
TAPE_READ.V.DVBYTE.REREAD#
      6887**DCL      6887--REDEF
TAPE_READ.V.INDX#
      6885**DCL      6885--REDEF
TAPE_WRITE.STATION_
      6913**DCL      6913--REDEF
TAPE_WRITE.V.DVBYTE.VFC#
      6920**DCL      6920--REDEF
TVECTOR.W2
      7044**DCL      7045--REDEF

PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:91   
      396        1        /*T***********************************************************/
      397        2        /*T*                                                         */
      398        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      399        4        /*T*                                                         */
      400        5        /*T***********************************************************/
      401        6        FLI$TAPE_WRITE: PROC( BUF_, ARS, EOVOLUME, COMMAND, NEW_TSN, NEW_FSN ) ALTRET;
      402        7        /*F*  NAME: FLI$TAPE_WRITE
      403        8              PURPOSE: Write current buffer on tape.
      404        9         */
      405       10
      406       11    1   DCL BUF_ BIT(72) DALIGNED;              /* Vector framing current buffer      */
      407       12    1   DCL ARS SBIN ALIGNED;                   /* Number of bytes to write           */
      408       13    1   DCL EOVOLUME BIT(1) ALIGNED;            /* Set if end-of-volume detected      */
      409       14    1   DCL COMMAND SBIN ALIGNED;               /* Command initiating this write      */
      410       15    1   DCL NEW_TSN CHAR(6) CALIGNED; /* New current TSN returned on IOERRCONT,I-O err */
      411       16    1   DCL NEW_FSN UBIN WORD ALIGNED; /* New current FSN returned on IOERRCONT,I-O err */
      412       17
      413       18         /***
      414       19          *** INCLUDE
      415       20          ***/
      416       21
      417       22        %INCLUDE CP_6;
      418     5581        %INCLUDE CP_6_SUBS;
      419     6121        %INCLUDE FLE_DATA_R;
      420    12072        %INCLUDE FLS_DATA_R;
      421    13872        %INCLUDE FLN_DATA_R;
      422    14609        %INCLUDE FM$FIT;
      423    14830        %INCLUDE FLI_DATA_R;
      424    16244        %INCLUDE B_ERRORS_C;
      425    17371        %INCLUDE FM$GRAN;
      426    17440
      427    17441         /***
      428    17442          *** ENTRY
      429    17443          ***/
      430    17444
      431    17445    1   DCL FLI$RPT_ERR ENTRY(5);
      432    17446    1   DCL FLI$CHANGE_VOLUMES ENTRY ALTRET;
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:92   
      433    17447
      434    17448         /***
      435    17449          *** AUTO
      436    17450          ***/
      437    17451
      438    17452    1   DCL SNLIST_NUM SBIN AUTO;
      439    17453    1   DCL CODE SBIN AUTO;
      440    17454    1   DCL BOVOLUME BIT(1) AUTO;               /* Changed volumes flag               */
      441    17455
      442    17456         /***
      443    17457          *** BASED
      444    17458          ***/
      445    17459
      446    17460        %F$DCB(BASED="BASED(DCB$)");
      447    17517        %B$TCB;
      448    17520        %B$ALT;
      449    17528
      450    17529        /****************************************/
      451    17530
      452    17531    1      TAPE_WRITE.BUF_ = BUF_;
      453    17532    1      TAPE_WRITE.BUF_.BOUND = ARS - 1;
      454    17533
      455    17534         /***
      456    17535          *** If end-of-volume detected on last write, change volumes now.
      457    17536          ***/
      458    17537
      459    17538    1      BOVOLUME = EOVOL_DETECTED;
      460    17539    1      IF BOVOLUME
      461    17540    2       THEN DO;
      462    17541    2         EOVOL_DETECTED = '0'B;
      463    17542    2         CALL FLI$CHANGE_VOLUMES ALTRET(JUST_ALTRET);
      464    17543    2         END;
      465    17544
      466    17545         /***
      467    17546          *** Write buffer on each current volume of each volume set.
      468    17547          ***/
      469    17548
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:93   
      470    17549    1   WRITE_LOOP:
      471    17550    2      DO SNLIST_NUM = 0 TO NBR_SNLISTS-1;
      472    17551    2         TAPE_WRITE.V.DCB# = TAPE_DCBLIST.DCB#(SNLIST_NUM);
      473    17552    2         CALL M$WRITE( TAPE_WRITE )
      474    17553    3          WHENALTRETURN DO;
      475    17554    3            CODE = B$TCB$->B$TCB.ALT$->B$ALT.ERR.CODE;
      476    17555    3            IF CODE ~= %E$EOVOL
      477    17556    4             THEN DO;                      /* Can't handle this                  */
      478    17557    4               CALL FLI$RPT_ERR;
      479    17558    4               IF TAPE_WRITE.V.IOERROK#    /* Continue after I/O error on tape?  */
      480    17559    4                 AND SUBSTR(DCBADDR(TAPE_WRITE.V.DCB#)->F$DCB.RES#,0,2) = 'LT'
      481    17560    5                THEN DO;
      482    17561    5                  CALL FLI_TAPE_WRITE_RETRY
      483    17562    5                    ALTRET (JUST_ALTRET);
             17562                             /* Can't rewrite buffer or operator X - abort */
      484    17563    5                  EXIT WRITE_LOOP; /* Buffer rewritten to all tapes - continue   */
      485    17564    5                  END;
      486    17565    4   JUST_ALTRET: ;
      487    17566    4               IF FPT_EXIT.V.STEPCC# < %TAPE_ERROR
      488    17567    4                THEN FPT_EXIT.V.STEPCC# = %TAPE_ERROR;
      489    17568    4               EOVOLUME = EOVOL_DETECTED;
      490    17569    4               ALTRETURN;
      491    17570    4               END;
      492    17571    3            EOVOL_DETECTED = '1'B;         /* Remember volume end                */
      493    17572    3            END;
      494    17573    2         END;
      495    17574
      496    17575    1      EOVOLUME = EOVOL_DETECTED;
      497    17576    1      RETURN;
      498    17577        %EJECT;
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:94   
      499    17578    1   FLI_TAPE_WRITE_RETRY: PROC ALTRET;
      500    17579        /*F*  NAME: FLI_TAPE_WRITE_RETRY
      501    17580              PURPOSE: Provides recovery from an irrecoverable tape I/O error by
      502    17581                 dismounting the bad volume and rewriting the buffer to the next volume
      503    17582                 specified in the control list or to a replacement volume.
      504    17583         */
      505    17584
      506    17585        /***
      507    17586         *** ENTRY
      508    17587         ***/
      509    17588
      510    17589    2   DCL FLI$ALLOC_BUF ENTRY(2);
      511    17590    2   DCL FLI$TAPE_CLOSE ENTRY(1) ALTRET;
      512    17591    2   DCL FLI$TAPE_OPEN ENTRY(9) ALTRET;
      513    17592    2   DCL XSF$LOCCODP ENTRY(2) ALTRET;
      514    17593
      515    17594        /***
      516    17595         *** FPT
      517    17596         ***/
      518    17597
      519    17598        %FPT_KEYIN( FPTN=OC_KEYIN,
      520    17599                    OCTYPE=ADMIN);
      521    17618
      522    17619
      523    17620         /***
      524    17621          *** AUTO
      525    17622          ***/
      526    17623
      527    17624    2   DCL DCB# SBIN AUTO;
      528    17625    2   DCL DCB$ PTR;
      529    17626    2   DCL I SBIN AUTO;
      530    17627    2   DCL PREV_BLK_ARS SBIN AUTO;             /* Previous block size                */
      531    17628    2   DCL FSN_SAVE UBIN AUTO;
      532    17629    2   DCL VOL_SAVE UBIN AUTO;
      533    17630    2   DCL BLK_TAGT$ PTR AUTO;
      534    17631    2   DCL 1 BLK_TAG BASED(BLK_TAGT$),
      535    17632           %BLOCK_TAG;
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:95   
      536    17637    2   DCL 1 PREV_BLK_ DALIGNED AUTO,          /* Previous block on tape             */
      537    17638    2         2 * BIT(36),
      538    17639    2         2 PTR$ PTR;
      539    17640    2   DCL 1 ERR ALIGNED AUTO,
      540    17641    2         2 * BIT(12) UNAL,
      541    17642    2         2 * BIT(6) UNAL,
      542    17643    2         2 * BIT(1) UNAL,
      543    17644    2         2 CODE UBIN(14) UNAL,
      544    17645    2         2 * UBIN(3) UNAL;
      545    17646
      546    17647        /***
      547    17648         *** STATIC
      548    17649         ***/
      549    17650
      550    17651    2   DCL 1 OPER_MESS1 STATIC,
      551    17652    2         2 * CHAR(0) INIT(' *** EFT or ARCOM is having difficulty writing to tape ***')
             17652                  ;
      552    17653    2   DCL 1 OPER_MESS2 STATIC,
      553    17654    2         2 * CHAR(0) INIT(' *** Enter C to write to another tape, X to abort ***');
      554    17655    2   DCL 1 OPER_MESS4 STATIC,
      555    17656    2         2 * CHAR(0) INIT(' *** Write errors at beginning of tape - mount new tape **')
             17656                  ;
      556    17657    2   DCL 1 OPER_MESS5 STATIC,
      557    17658    2         2 * CHAR(0) INIT(' *** Eh? ***');
      558    17659    2   DCL 1 OPER_MESS6 STATIC,
      559    17660    2         2 * CHAR(0) INIT(' *** Write errors at beginning of tape ***');
      560    17661    2   DCL 1 OPER_MESS7 STATIC,
      561    17662    2         2 * CHAR(0) INIT(' *** Must skip out to end of previous tape(s) ***');
      562    17663    2   DCL 1 OPER_MESS8 STATIC,
      563    17664    2         2 * CHAR(0) INIT(' *** Mount replacement tape when requested ***');
      564    17665    2   DCL ANSWER CHAR(8) STATIC INIT(' ');
      565    17666    2   DCL 1 TYC_ARS STATIC,
      566    17667    2         2 TYC UBIN WORD,
      567    17668    2         2 ARS UBIN WORD;
      568    17669
      569    17670        %FPT_OPEN( FPTN=TAPE_OPEN_LAST,
      570    17671                   STCLASS=STATIC,
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:96   
      571    17672                   ORG=RESTRICT,
      572    17673                   RES='LT',
      573    17674                   ACS=BLOCK,
      574    17675                   ASN=TAPE,
      575    17676                   IGNOREFSN=YES);
      576    17785
      577    17786        %FPT_PFIL ( FPTN=TAPE_PFIL,
      578    17787                    BOF=NO,
      579    17788                    STCLASS=STATIC);
      580    17803
      581    17804        %VLP_ERRCODE ( FPTN = ERRCODE );
      582    17849
      583    17850         /***
      584    17851          *** BASED
      585    17852          ***/
      586    17853
      587    17854        %F$DCB (BASED="BASED(DCB$)");
      588    17911
      589    17912        /***
      590    17913         *** SYMREF
      591    17914         ***/
      592    17915
      593    17916
      594    17917        /****************************************/
      595    17918
      596    17919    2      TAPE_OPEN_LAST.V.OPER.TEST# = '0'B;
      597    17920    2      TAPE_OPEN_LAST.V.FUN# = %IN#;
      598    17921    2      TAPE_OPEN_LAST.V.XTEND# = '0'B;
      599    17922    2      TAPE_OPEN_LAST.V.INITZ.SCRUB# = '0'B;
      600    17923    2      TAPE_OPEN_LAST.V.VOL# = 0;
      601    17924
      602    17925    2      OC_KEYIN.V.WAIT# = '0'B;
      603    17926    2      OC_KEYIN.REPLY_ = VECTOR(NIL);
      604    17927    2      OC_KEYIN.MESS_ = VECTOR(OPER_MESS1);
      605    17928    2      CALL M$KEYIN( OC_KEYIN ) ALTRET(REPALT);
      606    17929    2      OC_KEYIN.MESS_ = VECTOR(OPER_MESS2);
      607    17930    2   QUERY_OPER: ;
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:97   
      608    17931    2      OC_KEYIN.V.WAIT# = '1'B;
      609    17932    2      OC_KEYIN.REPLY_ = VECTOR(ANSWER);
      610    17933    2      OC_KEYIN.RESULTS_ = VECTOR(TYC_ARS);
      611    17934    2      CALL M$KEYIN( OC_KEYIN ) ALTRET(REPALT);
      612    17935
      613    17936    2      IF SUBSTR(ANSWER,0,1) = 'X' or SUBSTR(ANSWER,0,1) = 'x'
      614    17937    3       THEN DO;                            /* Abort the job                      */
      615    17938    3         CALL FLI$RPT_ERR( E_OPER_ABORT );
      616    17939    3         GOTO JUSTALT;
      617    17940    3         END;
      618    17941    2      IF SUBSTR(ANSWER,0,1) = 'C' OR SUBSTR(ANSWER,0,1) = 'c' /* Query op. again */
      619    17942    2       THEN;
      620    17943    3       ELSE DO;
      621    17944    3         OC_KEYIN.MESS_ = VECTOR(OPER_MESS5);
      622    17945    3         GOTO QUERY_OPER;
      623    17946    3         END;
      624    17947
      625    17948        /***
      626    17949         *** If data/blocks(s) already exist in EFT_RESTRICT_FILE, save previous tape block,
      627    17950         *** truncate the tape file, rewrite previous and current blocks to the next volume.
      628    17951         *** Previous block rewritten as good tape needed for writing labels. 1st recd of
      629    17952         *** block appears to be used by TFM.
      630    17953         ***/
      631    17954    2      DCB$ = TAPE_DCBLIST.DCB$(SNLIST_NUM);
      632    17955    2      TAPE_PRECORD.V.IOERROK# = '1'B;
      633    17956    2      IF NOT BOVOLUME                      /* At beginning of tape?              */
      634    17957    2        AND F$DCB.CRECNO > 1               /* Data exist in file?                */
      635    17958    3       THEN DO;
      636    17959        /***
      637    17960         *** Backspace all the tapes: 2 blocks for tapes before error, 1 block for rest.
      638    17961         ***/
      639    17962    3         TAPE_PRECORD.V.NOMARKS# = '1'B;
      640    17963    3         TAPE_PRECORD.V.N# = -2;           /* Backspace two records              */
      641    17964    4         DO I=0 TO NBR_SNLISTS -1;
      642    17965    4            TAPE_PRECORD.V.DCB# = TAPE_DCBLIST.DCB#(I);
      643    17966    4            IF I = SNLIST_NUM
      644    17967    4             THEN
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:98   
      645    17968    4               TAPE_PRECORD.V.N# = -1;
      646    17969    4            CALL M$PRECORD( TAPE_PRECORD ) ALTRET(REPALT);
      647    17970    4            END;
      648    17971
      649    17972    3         CALL FLI$ALLOC_BUF( PREV_BLK_, %MAX_GRANS_PER_TAPE_BUF );
             17972                  /* Read last block from tape */
      650    17973    3         TAPE_READ.V.DCB# = TAPE_DCBLIST.DCB#(SNLIST_NUM);
      651    17974    3         TAPE_READ.BUF_ = PREV_BLK_;
      652    17975    3         TAPE_READ.V.IOERROK# = '0'B;
      653    17976    3         CALL M$READ( TAPE_READ ) ALTRET(REPALT);
      654    17977    3         PREV_BLK_ARS = TAPE_DCBLIST.DCB$(SNLIST_NUM)->F$DCB.ARS#;
      655    17978    3         CALL M$PRECORD( TAPE_PRECORD ) ALTRET(REPALT); /* Backspace again       */
      656    17979    3         TAPE_PRECORD.V.NOMARKS# = '0'B;
      657    17980    3         TAPE_CLOSE.V.TRUNCATE# = '1'B; /* Close and truncate file - all tapes   */
      658    17981
      659    17982    3         BLK_TAGT$ = PINCRW( PREV_BLK_.PTR$, PREV_BLK_.PTR$->BLK_TAG.NBR * SIZEW(
             17982                  BLK_TAG) - SIZEW(BLK_TAG));
      660    17983    3         IF NOT BLK_TAG.BEG           /* 1st file in blk con. from prev. tape?   */
      661    17984    3          THEN CALL FLI$TAPE_CLOSE( '1'B /* CVOL */ ) ALTRET(JUSTALT);
      662    17985    3          ELSE CALL FLI$TAPE_CLOSE ALTRET(JUSTALT); /* Nope, so don't need UTLabel */
      663    17986    3         TAPE_CLOSE.V.TRUNCATE# = '0'B;
      664    17987        /***
      665    17988         *** PREV_BLK will get written to new tape with new FSN.
      666    17989         ***/
      667    17990    3         CALL FLI$TAPE_OPEN( VECTOR(EFT_CVOL_FILE), TAPE_SN, TAPE_FSN, '0'B, '1'B, ,
      668    17991    3           A_FIT_, ERR, DCB# ) ALTRET(REPERRALT);
      669    17992    3         CALL FLI$CHANGE_VOLUMES ALTRET(JUSTALT);
      670    17993    3         CALL FLI$TAPE_CLOSE ALTRET(JUSTALT); /* Close EFT_CVOL_FILE             */
      671    17994
      672    17995    3         CALL FLI$TAPE_OPEN( VECTOR(EFT_RESTRICT_FILE), TAPE_SN, TAPE_FSN, '0'B,
      673    17996    3           '1'B, , A_FIT_, ERR, DCB# ) ALTRET(REPERRALT);
      674    17997        /***
      675    17998         *** If file begins in this block, must update block and disk fits - CODE05 or
      676    17999         *** CODE06 with new tape info. (FSN and SN) so that file's fit is correct when
      677    18000         *** file is restored. CODE05 is updated only for BACKUP,SAVE and is a regular
      678    18001         *** file. Code06 is updated only if archiving or COMPACTing.
      679    18002         ***/
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:99   
      680    18003    3         CROSSED = ' ';
      681    18004    3         CALL FLI_UPDATE_FITS( PREV_BLK_ );
      682    18005    3         CALL FLI$TAPE_WRITE( PREV_BLK_, PREV_BLK_ARS, EOVOLUME, COMMAND, NEW_TSN,
             18005                  NEW_FSN ) ALTRET(JUSTALT);
      683    18006    3         CALL FLI_UPDATE_FITS( BUF_ );
      684    18007    3         CALL FLI$TAPE_WRITE ( BUF_, ARS, EOVOLUME, COMMAND, NEW_TSN, NEW_FSN ) ALTRET(
             18007                  JUSTALT);
      685    18008    3         NEW_TSN = TAPE_SN; /* FSN,SN for current file changed, return new values */
      686    18009    3         NEW_FSN = TAPE_FSN;
      687    18010    3         NBR_FILE_BLOCKS = %MAX_NBR_FILE_BLOCKS + 1; /* Force new block          */
      688    18011    3         RETURN;
      689    18012    3         END;
      690    18013
      691    18014    3       ELSE DO;
      692    18015        /***
      693    18016         *** Either at BOT or no data/blocks in this EFT_RESTRICT_FILE. Determine if tape
      694    18017         *** is positioned at BOT by comparing current FSN with 1st FSN on tape. If BOT,
      695    18018         *** dismount current volume, mount preceding volume (if one exists), skip out to
      696    18019         *** EFT_CVOL_FILE, rewrite new EFT_CVOL_FILE, and write current block written to ne
             18019        xt
      697    18020         *** volume. If not BOT, a CVOL is performed and current block written to next vol.
      698    18021         ***/
      699    18022    3         FSN_SAVE = F$DCB.FSN#;
      700    18023    3         VOL_SAVE = F$DCB.VOL#;
      701    18024    3         CALL FLI$TAPE_CLOSE ALTRET(JUSTALT);
      702    18025    3         TAPE_REWIND.V.PSN# = F$DCB.PSN#;
      703    18026    3         CALL M$REM( TAPE_REWIND ) ALTRET(REPALT);
      704    18027
      705    18028    3         TAPE_OPEN_LAST.V.FSN# = 1;        /* Get first FSN                      */
      706    18029    3         TAPE_OPEN_LAST.NAME_ = VECTOR(ERASE);
      707    18030    3         TAPE_OPEN_LAST.V.DCB# = TAPE_DCBLIST.DCB#(SNLIST_NUM);
      708    18031    3         CALL M$OPEN( TAPE_OPEN_LAST ) ALTRET(REPALT);
      709    18032    3         TAPE_CLOSE.V.DCB# = TAPE_DCBLIST.DCB#(SNLIST_NUM);
      710    18033    3         CALL M$CLOSE( TAPE_CLOSE ) ALTRET(REPALT);
      711    18034
      712    18035    3         IF FSN_SAVE ~= F$DCB.FSN#
      713    18036    4          THEN DO;
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:100  
      714    18037        /***
      715    18038         *** Not at BOT. An EFT_RESTRICT_FILE file exists prior to point of error.
      716    18039         *** Write current block to next volume.
      717    18040         ***/
      718    18041    4            TAPE_OPEN.V.XTEND# = '1'B;
      719    18042    4            CALL FLI$TAPE_OPEN( VECTOR(EFT_CVOL_FILE), TAPE_SN, TAPE_FSN, '0'B, '1'B, ,
      720    18043    4              A_FIT_, ERR, DCB# ) ALTRET(REPERRALT);
      721    18044    4            CALL FLI$CHANGE_VOLUMES ALTRET(JUSTALT);
      722    18045    4            CALL FLI$TAPE_CLOSE ALTRET(JUSTALT); /* Close EFT_CVOL_FILE          */
      723    18046    4            TAPE_OPEN.V.XTEND# = '0'B;
      724    18047
      725    18048    4            CALL FLI$TAPE_OPEN( VECTOR(EFT_RESTRICT_FILE), TAPE_SN, TAPE_FSN, '0'B,
      726    18049    4              '1'B, , A_FIT_, ERR, DCB# ) ALTRET(REPERRALT);
      727    18050    4            CALL FLI_UPDATE_FITS( BUF_ );
      728    18051    4            NEW_TSN = TAPE_SN; /* FSN,SN changed for current file, return new values */
      729    18052    4            NEW_FSN = TAPE_FSN;
      730    18053    4            CALL FLI$TAPE_WRITE( BUF_, ARS, EOVOLUME, COMMAND ) ALTRET(JUSTALT);
      731    18054    4            RETURN;
      732    18055    4            END;
      733    18056
      734    18057    4          ELSE DO;
      735    18058        /***
      736    18059         *** At BOT. Write current block to next volume after rewriting EFT_CVOL_FILE
      737    18060         *** on previous volume, if there is a previous volume. If no previous
      738    18061         *** volume write block to replacement volume.
      739    18062         ***/
      740    18063    4            IF FIRST_TAPE_VOL = VOL_SAVE
      741    18064    5             THEN DO;                      /* Error writing first volume         */
      742    18065    6               DO I=0 TO NBR_SNLISTS - 1;  /* Position all volumes to load point */
      743    18066    6                  TAPE_REWIND.V.PSN# = TAPE_DCBLIST.DCB$(I)->F$DCB.PSN#;
      744    18067    6                  CALL M$REM( TAPE_REWIND ) ALTRET(JUSTALT);
      745    18068    6                  END;
      746    18069
      747    18070    5               OC_KEYIN.V.WAIT# = '0'B;    /* Tell oper. to mount new tape       */
      748    18071    5               OC_KEYIN.REPLY_ = VECTOR(NIL);
      749    18072    5               OC_KEYIN.MESS_ = VECTOR(OPER_MESS4);
      750    18073    5               OC_KEYIN.RESULTS_ = VECTOR(NIL);
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:101  
      751    18074    5               CALL M$KEYIN( OC_KEYIN ) ALTRET(REPALT);
      752    18075
      753    18076    5               TAPE_REMOVE.V.PSN# = F$DCB.PSN#; /* Remove bad volume only        */
      754    18077    5               CALL M$REM( TAPE_REMOVE ) ALTRET(JUSTALT);
      755    18078
      756    18079    5               TAPE_OPEN.V.OPER.MNTONLY# = '1'B;
      757    18080    5               TAPE_OPEN.V.INITZ.SCRUB# = '1'B;
      758    18081    5               CALL FLI$TAPE_OPEN( VECTOR(EFT_RESTRICT_FILE), TAPE_SN, TAPE_FSN,
      759    18082    5                 '0'B, '0'B, , A_FIT_, ERR, DCB# ) ALTRET(REPERRALT);
      760    18083    5               CALL FLI$TAPE_WRITE( BUF_, ARS, EOVOLUME, COMMAND ) ALTRET(JUSTALT);
      761    18084    5               TAPE_OPEN.V.INITZ.SCRUB# = '0'B;
      762    18085    5               TAPE_OPEN.V.OPER.MNTONLY# = '0'B;
      763    18086    5               RETURN;
      764    18087    5               END;
      765    18088
      766    18089    5             ELSE DO;                 /* Error writing other than first volume   */
      767    18090    5               OC_KEYIN.REPLY_ = VECTOR(NIL);
      768    18091    5               OC_KEYIN.MESS_ = VECTOR(OPER_MESS6);
      769    18092    5               OC_KEYIN.RESULTS_ = VECTOR(NIL);
      770    18093    5               CALL M$KEYIN( OC_KEYIN ) ALTRET(REPALT);
      771    18094    6               DO I=0 TO NBR_SNLISTS - 1;  /* Remove all volumes                 */
      772    18095    6                  TAPE_REMOVE.V.PSN# = TAPE_DCBLIST.DCB$(I)->F$DCB.PSN#;
      773    18096    6                  CALL M$REM( TAPE_REMOVE ) ALTRET(REPALT);
      774    18097    6                  END;
      775    18098
      776    18099    5               OC_KEYIN.MESS_ = VECTOR(OPER_MESS7);
      777    18100    5               CALL M$KEYIN( OC_KEYIN ) ALTRET(REPALT);
      778    18101    5               OC_KEYIN.MESS_ = VECTOR(OPER_MESS8);
      779    18102    5               CALL M$KEYIN( OC_KEYIN ) ALTRET(REPALT);
      780    18103        /* Mount prev. vol., update EFT_CVOL_FILE */
      781    18104    6               DO I=0 TO NBR_SNLISTS -1;
      782    18105    6                  TAPE_OPEN_LAST.V.INITZ.SCRUB# = '1'B;
      783    18106    6                  TAPE_OPEN_LAST.V.DCB# = TAPE_DCBLIST.DCB#(I);
      784    18107    6                  TAPE_OPEN_LAST.NAME_ = VECTOR(EFT_CVOL_FILE);
      785    18108    6                  TAPE_OPEN_LAST.V.VOL# = VOL_SAVE - 1;
      786    18109    6                  TAPE_OPEN_LAST.SN_ = SNVECLIST.SN_(I);
      787    18110    6                  TAPE_OPEN_LAST.V.FUN# = %UPDATE#;
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:102  
      788    18111    6                  CALL M$OPEN( TAPE_OPEN_LAST ) ALTRET(REPALT);
      789    18112    6                  TAPE_OPEN_LAST.NAME_ = VECTOR(NIL);
      790    18113    6                  END;
      791    18114
      792    18115    5               CALL FLI$TAPE_WRITE(BUF_, ARS, EOVOLUME, COMMAND ) ALTRET(JUSTALT);
      793    18116    5               IF NOT EOVOLUME             /* Remove in case EOVOLUME not rec'd  */
      794    18117    5                THEN CALL FLI$CHANGE_VOLUMES ALTRET(JUSTALT);
      795    18118    5               CALL FLI$TAPE_WRITE(BUF_, ARS, EOVOLUME, COMMAND ) ALTRET(JUSTALT);
      796    18119    5               CALL FLI$TAPE_CLOSE ALTRET(JUSTALT); /* Close EFT_CVOL_FILE       */
      797    18120    5               NBR_FILE_BLOCKS = %MAX_NBR_FILE_BLOCKS + 1; /* Force new block    */
      798    18121    5               RETURN;
      799    18122    5               END;
      800    18123    4            END;
      801    18124
      802    18125    3         END;
      803    18126
      804    18127    2   REPERRALT: ;
      805    18128    2      CALL FLI$RPT_ERR( ERR, DCB# );
      806    18129    2      GOTO JUSTALT;
      807    18130
      808    18131    2   REPALT: ;
      809    18132    2      CALL FLI$RPT_ERR;
      810    18133
      811    18134    2   JUSTALT: ;
      812    18135    2      TAPE_CLOSE.V.TRUNCATE# = '0'B;
      813    18136    2      TAPE_CLOSE.V.POS# = 0;
      814    18137    2      TAPE_OPEN.V.OPER.MNTONLY# = '0'B;
      815    18138    2      TAPE_OPEN.V.INITZ.SCRUB# = '0'B;
      816    18139    2      CALL FLI$TAPE_CLOSE
      817    18140    3       WHENALTRETURN DO;
      818    18141    3         CALL FLI$RPT_ERR;
      819    18142    3         END;
      820    18143    2      ALTRETURN;
      821    18144
      822    18145        %EJECT;
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:103  
      823    18146    2   FLI_UPDATE_FITS: PROC( BLK_ );
      824    18147        /*F* NAME: FLI_MODIFY_FITS
      825    18148             PURPOSE: Update tape and disk fits for files contained within a block.
      826    18149        */
      827    18150
      828    18151    3   DCL 1 BLK_ DALIGNED,                    /* Vector framing block               */
      829    18152    3         2 * BIT(36),
      830    18153    3         2 PTR$ PTR;
      831    18154
      832    18155    3   DCL BLK_TAG0T$ PTR AUTO;
      833    18156    3   DCL 1 BLK_TAG0 BASED(BLK_TAG0T$),
      834    18157           %BLOCK_TAG;
      835    18162    3   DCL BLK_TAGT$ PTR AUTO;
      836    18163    3   DCL 1 BLK_TAG BASED(BLK_TAGT$),
      837    18164           %BLOCK_TAG;
      838    18169    3   DCL BLK_GRAN_BASE$ PTR AUTO;            /* Block's granule base               */
      839    18170    3   DCL IN_GRAN$ PTR AUTO;
      840    18171    3   DCL CODE$ PTR AUTO;
      841    18172    3   DCL M$DISK_IN$ PTR AUTO;
      842    18173    3   DCL 1 DISK_FIT_ DALIGNED AUTO,
      843    18174    3         2 BOUND UBIN(20) UNAL,
      844    18175    3         2 * BIT(16) UNAL,
      845    18176    3         2 PTR$ PTR;
      846    18177    3   DCL 1 MODIFIED_FIT_ DALIGNED AUTO,
      847    18178    3         2 BOUND UBIN(20) UNAL,
      848    18179    3         2 * BIT(16) UNAL,
      849    18180    3         2 PTR$ PTR;
      850    18181        %CODE05( BASED = "BASED(CODE$)" );
      851    18184        %CODE06( BASED = "BASED(CODE$)" );
      852    18188        %FM$GRAN;
      853    18192        %VLP_NAME( FPTN=ACCT_NAME,
      854    18193                   LEN=8,
      855    18194                   STCLASS=AUTO);
      856    18221        %VLP_NAME( FPTN=TAPE_NAME,
      857    18222                   LEN=6,
      858    18223                   STCLASS=AUTO);
      859    18250
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:104  
      860    18251        /****************************************/
      861    18252
      862    18253    3      M$DISK_IN$ = DCBADDR(DCBNUM(M$DISK_IN) );
      863    18254    3      BLK_TAG0T$ = PINCRW( BLK_.PTR$, BLK_.PTR$->BLK_TAG.NBR * SIZEW(BLK_TAG));
      864    18255    3      BLK_TAGT$ = PINCRW( BLK_TAG0T$, -SIZEW(BLK_TAG ));
      865    18256    3      BLK_GRAN_BASE$ = PINCRW(BLK_TAG0T$, SIZEW(BLK_TAG0) );
      866    18257    4      DO WHILE( BLK_TAGT$ >= BLK_.PTR$ );
      867    18258    5         DO CASE( BLK_TAG.TYPE );
      868    18259    5          CASE( %REG_FILE, %ACUP_FILE, %IDS_FAST_FILE );
      869    18260    5            IF BLK_TAG.BEG                 /* File begin in this block?          */
      870    18261    6             THEN DO;
      871    18262        /***
      872    18263         *** Update block fit
      873    18264         ***/
      874    18265    6               IN_GRAN$ = PINCRC( BLK_GRAN_BASE$, BLK_TAG.BEGX );
      875    18266    6               CODE$ = PINCRW( IN_GRAN$, SIZEW(FM$GRAN) );
      876    18267    6               IF (BLK_TAG.TYPE = %REG_FILE /* BACKUP or SAVE in progress?       */
      877    18268    6                 AND (COMMAND = %BACKUP OR COMMAND = %SAVE))
      878    18269    7                THEN DO;
      879    18270    7                  CALL XSF$LOCCODP( CODE$, 05 )
      880    18271    8                   WHENRETURN DO;
      881    18272    8                     CODE05.BACKUP.REEL = TAPE_SN;
      882    18273    8                     CODE05.BACKUP.EFT.FSN = TAPE_FSN;
      883    18274    8                     END;
      884    18275    7                  END;
      885    18276    7                ELSE DO;
      886    18277    7                  IF (COMMAND = %ARCHIVE_CMD) /* Archiving or COMPACTing?        */
      887    18278    7                    OR (COMMAND = %COMPACT)
      888    18279    7                    OR (COMMAND = %PURGE AND ARCHIVE$ ~=ADDR(NIL))
      889    18280    8                   THEN DO;
      890    18281    8                     CALL XSF$LOCCODP( CODE$, 06 )
      891    18282    9                      WHENRETURN DO;
      892    18283    9                        CODE06.STOW.REEL = TAPE_SN;
      893    18284    9                        CODE06.STOW.EFT.FSN = TAPE_FSN;
      894    18285    9                        CODE06.STOW.EFT.CROSS = '0'B;
      895    18286    9                        END;
      896    18287    8                     END;
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:105  
      897    18288    7                  END;
      898    18289        /***
      899    18290         *** Update disk fit
      900    18291         ***/
      901    18292    6               CALL FLI$ALLOC_BUF( DISK_FIT_, 1 );
      902    18293    6               OPEN_BLOCK_FILE.FPARAM_ = DISK_FIT_;
      903    18294    6               FROM_DISK_SN.SN#(0) = BLK_TAG0.WHERE.PSN;
      904    18295    6               FROM_DISK_ACCT.ACCT# = BLK_TAG0.WHERE.ACCT;
      905    18296    6               FROM_DISK_NAME = BLK_TAG.NAME;
      906    18297    6               CALL M$OPEN( OPEN_BLOCK_FILE )
      907    18298    7                WHENRETURN DO;
      908    18299    7                  MODIFIED_FIT_ = DISK_FIT_;
      909    18300    7                  CODE$ = PINCRW( MODIFIED_FIT_.PTR$, SIZEW(FM$GRAN) );
      910    18301    7                  IF (BLK_TAG.TYPE = %REG_FILE /* BACKUP or SAVE in progress?    */
      911    18302    7                    AND (COMMAND = %SAVE OR COMMAND = %BACKUP))
      912    18303    8                   THEN DO;
      913    18304    8                     CALL XSF$LOCCODP( CODE$, 05 )
      914    18305    9                      WHENRETURN DO;
      915    18306    9                        CODE05.BACKUP.REEL = TAPE_SN;
      916    18307    9                        CODE05.BACKUP.EFT.FSN = TAPE_FSN;
      917    18308    9                        CODE05.BACKUP.EFT.CROSS = '0'B;
      918    18309    9                        END;
      919    18310    8                     END;
      920    18311    8                   ELSE DO;
      921    18312    8                     IF (COMMAND = %ARCHIVE_CMD) /* Archiving or COMPACTing?     */
      922    18313    8                       OR (COMMAND = %COMPACT)
      923    18314    8                       OR (COMMAND = %PURGE AND ARCHIVE$ ~= ADDR(NIL))
      924    18315    9                      THEN DO;
      925    18316    9                        CALL XSF$LOCCODP( CODE$, 06 )
      926    18317   10                         WHENRETURN DO;
      927    18318   10                           CODE06.STOW.REEL = TAPE_SN;
      928    18319   10                           CODE06.STOW.EFT.FSN = TAPE_FSN;
      929    18320   10                           CODE06.STOW.EFT.CROSS = '0'B;
      930    18321   10                           END;
      931    18322    9                        END;
      932    18323    8                     END;
      933    18324    7                  MODIFIED_FIT_.PTR$ = PINCRW( MODIFIED_FIT_.PTR$, SIZEW(FM$GRAN));
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:106  
      934    18325    7                  MODIFIED_FIT_.BOUND = MODIFIED_FIT_.BOUND - SIZEC(FM$GRAN);
      935    18326    7                  CLOSE_BLOCK_FILE.IFPARAM_ = MODIFIED_FIT_;
      936    18327    7                  CLOSE_BLOCK_FILE.V.DESC = M$DISK_IN$->F$DCB.DESC;
      937    18328    7                  CLOSE_BLOCK_FILE.V.EFTOPER.UPDDESC# = %YES#;
      938    18329    7                  CALL M$CLOSE( CLOSE_BLOCK_FILE );
      939    18330    7                  CLOSE_BLOCK_FILE.IFPARAM_ = VECTOR(NIL);
      940    18331    7                  CLOSE_BLOCK_FILE.V.EFTOPER = '0'B;
      941    18332    7                  END;
      942    18333    7                WHENALTRETURN DO;
      943    18334    7                  CALL FLI$RPT_ERR;
      944    18335    7                  END;
      945    18336
      946    18337    6               TAPE_NAME.L# = LENGTHC(TAPE_NAME.NAME#);
      947    18338    6               TAPE_NAME.NAME# = TAPE_SN;
      948    18339    6               ACCT_NAME.L# = LENGTHC(ACCT_NAME.NAME#);
      949    18340    6               ACCT_NAME.NAME# = BLK_TAG0.WHERE.ACCT;
      950    18341    6               CALL FLI$RPT_ERR( E_FILE_REWRITTEN, ,VECTOR(BLK_TAG.NAME),VECTOR(
             18341                        ACCT_NAME),VECTOR(TAPE_NAME));
      951    18342    6               END;
      952    18343    6             ELSE DO;
      953    18344    6               END;
      954    18345
      955    18346    5          CASE( ELSE );
      956    18347
      957    18348    5          END;
      958    18349    4         BLK_TAGT$ = PINCRW( BLK_TAGT$, -SIZEW(BLK_TAG) );
      959    18350    4         END;
      960    18351    3      RETURN;
      961    18352
      962    18353    3   END FLI_UPDATE_FITS;
      963    18354    2   END FLI_TAPE_WRITE_RETRY;
      964    18355    1   END FLI$TAPE_WRITE;
      965    18356        %EOD;

PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:107  
--  Include file information  --

   FM$GRAN.:E05TOU  is referenced.
   B_ERRORS_C.:E05TOU  is referenced.
   B_MICROPS_C.:E05TOU  is referenced.
   FLB_SUBS_C.:E05TOU  is referenced.
   FLI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FM$FIT.:E05TOU  is referenced.
   FLN_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FLS_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FL_PERR_C.:E05TOU  is referenced.
   FLE_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FLI$TAPE_WRITE.

   Procedure FLI$TAPE_WRITE requires 947 words for executable code.
   Procedure FLI$TAPE_WRITE requires 64 words of local(AUTO) storage.

PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:108  

 Object Unit name= FLI$TAPE_WRITE                             File name= FLI$TAPE.:E05TOU
 UTS= JUL 29 '97 15:57:11.04 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   DCB   even  none     0      0  M$TSN_USED
    2   DCB   even  none     0      0  M$STATUS
    3   DCB   even  none     0      0  M$REBUILD
    4   DCB   even  none     0      0  M$ARCHIVE
    5   DCB   even  none     0      0  M$NODATA_LIST
    6   Data  even  none   273    421  FLI$TAPE_WRITE
    7   DCB   even  none     0      0  M$DISK_IN
    8   DCB   even  none     0      0  M$DISK00
    9   DCB   even  none     0      0  M$DISK01
   10   DCB   even  none     0      0  M$DISK02
   11   DCB   even  none     0      0  M$DISK03
   12   DCB   even  none     0      0  M$PRE_RET
   13  RoData even  UTS      1      1  FLI$TAPE_WRITE
   14   Proc  even  none   947   1663  FLI$TAPE_WRITE
   15  RoData even  none    50     62  FLI$TAPE_WRITE

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
    14      0   yes    yes     yes      Std        6  FLI$TAPE_WRITE
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:109  

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       0 FLI$CHANGE_VOLUMES
         yes           Std       5 FLI$RPT_ERR
 yes     yes           Std       9 FLI$TAPE_OPEN
         yes           Std       2 FLI$ALLOC_BUF
 yes     yes           Std       1 FLI$TAPE_CLOSE
 yes     yes           Std       2 XSF$LOCCODP
                       nStd      0 X66_AUTO_N
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AALT
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                             r    E_OPER_ABORT                     r    E_FILE_REWRITTEN
     M$TSN_USED                            M$STATUS                              M$REBUILD
     M$ARCHIVE                             M$NODATA_LIST                         DCB$
     BLK_TAG$                              BLK_TAG0$                             NBR_BYTES_TO_MOVE
     DISK_GRAN$                            BLOCK_GRAN$                      r    A_FIT_
     NBR_FILE_BLOCKS                       CROSSED                          r    EFT_CVOL_FILE
r    EFT_RESTRICT_FILE                     TAPE_SN                               TAPE_FSN
     TSN_USED_NAME                         BACKUP_NAME                      r    ARCHIVE_NAME
r    PRIME_FILE                       r    DUAL_FILE                             REBUILD_NAME
     REBUILD_DIR_KEY                       REBUILD_KEY                           NODATA_FILE_NAME
     NODATA_KEY                            M$DISK_IN                             ARCHIVE$
     M$DISK00                              M$DISK01                              M$DISK02
     M$DISK03                              FROM_DISK_NAME                        FROM_DISK_ACCT
     FROM_DISK_SN                          NBR_SNLISTS                           TAPE_DCBLIST$
     FPT_EXIT                              TAPE_OPEN                             TAPE_READ
     TAPE_WRITE                            TAPE_CLOSE                            TAPE_REWIND
     TAPE_REMOVE                           TAPE_PRECORD                          SNVECLIST$
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:110  
     B$TCB$                                EOVOL_DETECTED                        DPLIST$
     DPRESLIST$                            DISK_FILE_SPEC$                       SPECCHARS
     FIRST_TAPE_VOL                        EFTWORD                               M$PRE_RET
     RET_CMDS_NAME                         B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID                               ROSID
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:111  


      396        1        /*T***********************************************************/
      397        2        /*T*                                                         */
      398        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      399        4        /*T*                                                         */
      400        5        /*T***********************************************************/
      401        6        FLI$TAPE_WRITE: PROC( BUF_, ARS, EOVOLUME, COMMAND, NEW_TSN, NEW_FSN ) ALTRET;

      6 14 000000   000000 700200 xent  FLI$TAPE_WR* TSX0  ! X66_AUTO_N
        14 000001   000100 000006                    ZERO    64,6

      402        7        /*F*  NAME: FLI$TAPE_WRITE
      403        8              PURPOSE: Write current buffer on tape.
      404        9         */
      405       10
      406       11    1   DCL BUF_ BIT(72) DALIGNED;              /* Vector framing current buffer      */
      407       12    1   DCL ARS SBIN ALIGNED;                   /* Number of bytes to write           */
      408       13    1   DCL EOVOLUME BIT(1) ALIGNED;            /* Set if end-of-volume detected      */
      409       14    1   DCL COMMAND SBIN ALIGNED;               /* Command initiating this write      */
      410       15    1   DCL NEW_TSN CHAR(6) CALIGNED; /* New current TSN returned on IOERRCONT,I-O err */
      411       16    1   DCL NEW_FSN UBIN WORD ALIGNED; /* New current FSN returned on IOERRCONT,I-O err */
      412       17
      413       18         /***
      414       19          *** INCLUDE
      415       20          ***/
      416       21
      417       22        %INCLUDE CP_6;
      418     5581        %INCLUDE CP_6_SUBS;
      419     6121        %INCLUDE FLE_DATA_R;
      420    12072        %INCLUDE FLS_DATA_R;
      421    13872        %INCLUDE FLN_DATA_R;
      422    14609        %INCLUDE FM$FIT;
      423    14830        %INCLUDE FLI_DATA_R;
      424    16244        %INCLUDE B_ERRORS_C;
      425    17371        %INCLUDE FM$GRAN;
      426    17440
      427    17441         /***
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:112  
      428    17442          *** ENTRY
      429    17443          ***/
      430    17444
      431    17445    1   DCL FLI$RPT_ERR ENTRY(5);
      432    17446    1   DCL FLI$CHANGE_VOLUMES ENTRY ALTRET;
      433    17447
      434    17448         /***
      435    17449          *** AUTO
      436    17450          ***/
      437    17451
      438    17452    1   DCL SNLIST_NUM SBIN AUTO;
      439    17453    1   DCL CODE SBIN AUTO;
      440    17454    1   DCL BOVOLUME BIT(1) AUTO;               /* Changed volumes flag               */
      441    17455
      442    17456         /***
      443    17457          *** BASED
      444    17458          ***/
      445    17459
      446    17460        %F$DCB(BASED="BASED(DCB$)");
      447    17517        %B$TCB;
      448    17520        %B$ALT;
      449    17528
      450    17529        /****************************************/
      451    17530
      452    17531    1      TAPE_WRITE.BUF_ = BUF_;

  17531 14 000002   200003 470500                    LDP0    @BUF_,,AUTO
        14 000003   000000 237100                    LDAQ    0,,PR0
        14 000004   000004 757000 xsym               STAQ    TAPE_WRITE+4

      453    17532    1      TAPE_WRITE.BUF_.BOUND = ARS - 1;

  17532 14 000005   200004 471500                    LDP1    @ARS,,AUTO
        14 000006   100000 236100                    LDQ     0,,PR1
        14 000007   000001 136007                    SBLQ    1,DL
        14 000010   000020 736000                    QLS     16
        14 000011   000004 676000 xsym               ERQ     TAPE_WRITE+4
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:113  
        14 000012   000034 376000 xsym               ANQ     B_VECTNIL+28
        14 000013   000004 656000 xsym               ERSQ    TAPE_WRITE+4

      454    17533
      455    17534         /***
      456    17535          *** If end-of-volume detected on last write, change volumes now.
      457    17536          ***/
      458    17537
      459    17538    1      BOVOLUME = EOVOL_DETECTED;

  17538 14 000014   000000 236000 xsym               LDQ     EOVOL_DETECTED
        14 000015   400000 376003                    ANQ     -131072,DU
        14 000016   200013 756100                    STQ     BOVOLUME,,AUTO

      460    17539    1      IF BOVOLUME

  17539 14 000017   200013 234100                    SZN     BOVOLUME,,AUTO
        14 000020   000025 605000 14                 TPL     WRITE_LOOP

      461    17540    2       THEN DO;

      462    17541    2         EOVOL_DETECTED = '0'B;

  17541 14 000021   000000 450000 xsym               STZ     EOVOL_DETECTED

      463    17542    2         CALL FLI$CHANGE_VOLUMES ALTRET(JUST_ALTRET);

  17542 14 000022   000002 631400 xsym               EPPR1   B_VECTNIL+2
        14 000023   000000 701000 xent               TSX1    FLI$CHANGE_VOLUMES
        14 000024   000071 702000 14                 TSX2    JUST_ALTRET

      464    17543    2         END;

      465    17544
      466    17545         /***
      467    17546          *** Write buffer on each current volume of each volume set.
      468    17547          ***/
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:114  
      469    17548
      470    17549    1   WRITE_LOOP:
      471    17550    2      DO SNLIST_NUM = 0 TO NBR_SNLISTS-1;

  17550 14 000025   200011 450100       WRITE_LOOP   STZ     SNLIST_NUM,,AUTO
        14 000026   000107 710000 14                 TRA     s:17573+1

      472    17551    2         TAPE_WRITE.V.DCB# = TAPE_DCBLIST.DCB#(SNLIST_NUM);

  17551 14 000027   200011 235100                    LDA     SNLIST_NUM,,AUTO
        14 000030   000001 735000                    ALS     1
        14 000031   000000 470400 xsym               LDP0    TAPE_DCBLIST$
        14 000032   000000 720105                    LXL0    0,AL,PR0
        14 000033   000010 740000 xsym               STX0    TAPE_WRITE+8

      473    17552    2         CALL M$WRITE( TAPE_WRITE )

  17552 14 000034   000000 630400 xsym               EPPR0   TAPE_WRITE
        14 000035   440001 713400                    CLIMB   alt,write
        14 000036   401400 401760                    pmme    nvectors=4
        14 000037   000041 702000 14                 TSX2    s:17554
        14 000040   000106 710000 14                 TRA     s:17573

      474    17553    3          WHENALTRETURN DO;

      475    17554    3            CODE = B$TCB$->B$TCB.ALT$->B$ALT.ERR.CODE;

  17554 14 000041   000000 470400 xsym               LDP0    B$TCB$
        14 000042   000000 471500                    LDP1    0,,PR0
        14 000043   100102 236100                    LDQ     66,,PR1
        14 000044   000003 772000                    QRL     3
        14 000045   037777 376007                    ANQ     16383,DL
        14 000046   200012 756100                    STQ     CODE,,AUTO

      476    17555    3            IF CODE ~= %E$EOVOL

  17555 14 000047   001313 116007                    CMPQ    715,DL
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:115  
        14 000050   000104 600000 14                 TZE     s:17571

      477    17556    4             THEN DO;                      /* Can't handle this                  */

      478    17557    4               CALL FLI$RPT_ERR;

  17557 14 000051   000002 631400 xsym               EPPR1   B_VECTNIL+2
        14 000052   000000 701000 xent               TSX1    FLI$RPT_ERR
        14 000053   000000 011000                    NOP     0

      479    17558    4               IF TAPE_WRITE.V.IOERROK#    /* Continue after I/O error on tape?  */

  17558 14 000054   000010 236000 xsym               LDQ     TAPE_WRITE+8
        14 000055   000020 316007                    CANQ    16,DL
        14 000056   000071 600000 14                 TZE     JUST_ALTRET
        14 000057   000000 470400 15                 LDP0    0
        14 000060   000000 471500                    LDP1    0,,PR0
        14 000061   000010 220000 xsym               LDX0    TAPE_WRITE+8
        14 000062   100000 473510                    LDP3    0,X0,PR1
        14 000063   300026 221100                    LDX1    22,,PR3
        14 000064   000000 101000 13                 CMPX1   0
        14 000065   000071 601000 14                 TNZ     JUST_ALTRET

      480    17559    4                 AND SUBSTR(DCBADDR(TAPE_WRITE.V.DCB#)->F$DCB.RES#,0,2) = 'LT'
      481    17560    5                THEN DO;

      482    17561    5                  CALL FLI_TAPE_WRITE_RETRY

  17561 14 000066   000117 701000 14                 TSX1    FLI_TAPE_WRITE_RETRY
        14 000067   000071 702000 14                 TSX2    JUST_ALTRET

      483    17562    5                    ALTRET (JUST_ALTRET);
             17562                             /* Can't rewrite buffer or operator X - abort */
      484    17563    5                  EXIT WRITE_LOOP; /* Buffer rewritten to all tapes - continue   */

  17563 14 000070   000112 710000 14                 TRA     s:17575

PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:116  
  17558 14 000071                       JUST_ALTRET  null
      485    17564    5                  END;
      486    17565    4   JUST_ALTRET: ;
      487    17566    4               IF FPT_EXIT.V.STEPCC# < %TAPE_ERROR

  17566 14 000071   000004 236000 xsym               LDQ     FPT_EXIT+4
        14 000072   777000 376003                    ANQ     -512,DU
        14 000073   004000 116003                    CMPQ    2048,DU
        14 000074   000077 603000 14                 TRC     s:17568

      488    17567    4                THEN FPT_EXIT.V.STEPCC# = %TAPE_ERROR;

  17567 14 000075   004000 236003                    LDQ     2048,DU
        14 000076   000004 552040 xsym               STBQ    FPT_EXIT+4,'40'O

      489    17568    4               EOVOLUME = EOVOL_DETECTED;

  17568 14 000077   000000 236000 xsym               LDQ     EOVOL_DETECTED
        14 000100   400000 376003                    ANQ     -131072,DU
        14 000101   200005 470500                    LDP0    @EOVOLUME,,AUTO
        14 000102   000000 756100                    STQ     0,,PR0

      490    17569    4               ALTRETURN;

  17569 14 000103   000000 702200 xent               TSX2  ! X66_AALT

      491    17570    4               END;
      492    17571    3            EOVOL_DETECTED = '1'B;         /* Remember volume end                */

  17571 14 000104   400000 236003                    LDQ     -131072,DU
        14 000105   000000 756000 xsym               STQ     EOVOL_DETECTED

      493    17572    3            END;

      494    17573    2         END;

  17573 14 000106   200011 054100                    AOS     SNLIST_NUM,,AUTO
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:117  
        14 000107   200011 236100                    LDQ     SNLIST_NUM,,AUTO
        14 000110   000000 116000 xsym               CMPQ    NBR_SNLISTS
        14 000111   000027 604000 14                 TMI     s:17551

      495    17574
      496    17575    1      EOVOLUME = EOVOL_DETECTED;

  17575 14 000112   000000 236000 xsym               LDQ     EOVOL_DETECTED
        14 000113   400000 376003                    ANQ     -131072,DU
        14 000114   200005 470500                    LDP0    @EOVOLUME,,AUTO
        14 000115   000000 756100                    STQ     0,,PR0

      497    17576    1      RETURN;

  17576 14 000116   000000 702200 xent               TSX2  ! X66_ARET

      498    17577        %EJECT;
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:118  
      499    17578    1   FLI_TAPE_WRITE_RETRY: PROC ALTRET;

  17578 14 000117   200014 741300       FLI_TAPE_WR* STX1  ! BOVOLUME+1,,AUTO

      500    17579        /*F*  NAME: FLI_TAPE_WRITE_RETRY
      501    17580              PURPOSE: Provides recovery from an irrecoverable tape I/O error by
      502    17581                 dismounting the bad volume and rewriting the buffer to the next volume
      503    17582                 specified in the control list or to a replacement volume.
      504    17583         */
      505    17584
      506    17585        /***
      507    17586         *** ENTRY
      508    17587         ***/
      509    17588
      510    17589    2   DCL FLI$ALLOC_BUF ENTRY(2);
      511    17590    2   DCL FLI$TAPE_CLOSE ENTRY(1) ALTRET;
      512    17591    2   DCL FLI$TAPE_OPEN ENTRY(9) ALTRET;
      513    17592    2   DCL XSF$LOCCODP ENTRY(2) ALTRET;
      514    17593
      515    17594        /***
      516    17595         *** FPT
      517    17596         ***/
      518    17597
      519    17598        %FPT_KEYIN( FPTN=OC_KEYIN,
      520    17599                    OCTYPE=ADMIN);
      521    17618
      522    17619
      523    17620         /***
      524    17621          *** AUTO
      525    17622          ***/
      526    17623
      527    17624    2   DCL DCB# SBIN AUTO;
      528    17625    2   DCL DCB$ PTR;
      529    17626    2   DCL I SBIN AUTO;
      530    17627    2   DCL PREV_BLK_ARS SBIN AUTO;             /* Previous block size                */
      531    17628    2   DCL FSN_SAVE UBIN AUTO;
      532    17629    2   DCL VOL_SAVE UBIN AUTO;
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:119  
      533    17630    2   DCL BLK_TAGT$ PTR AUTO;
      534    17631    2   DCL 1 BLK_TAG BASED(BLK_TAGT$),
      535    17632           %BLOCK_TAG;
      536    17637    2   DCL 1 PREV_BLK_ DALIGNED AUTO,          /* Previous block on tape             */
      537    17638    2         2 * BIT(36),
      538    17639    2         2 PTR$ PTR;
      539    17640    2   DCL 1 ERR ALIGNED AUTO,
      540    17641    2         2 * BIT(12) UNAL,
      541    17642    2         2 * BIT(6) UNAL,
      542    17643    2         2 * BIT(1) UNAL,
      543    17644    2         2 CODE UBIN(14) UNAL,
      544    17645    2         2 * UBIN(3) UNAL;
      545    17646
      546    17647        /***
      547    17648         *** STATIC
      548    17649         ***/
      549    17650
      550    17651    2   DCL 1 OPER_MESS1 STATIC,
      551    17652    2        2 * CHAR(0) INIT(' *** EFT or ARCOM is having difficulty writing to tape ***')
             17652                  ;
      552    17653    2   DCL 1 OPER_MESS2 STATIC,
      553    17654    2         2 * CHAR(0) INIT(' *** Enter C to write to another tape, X to abort ***');
      554    17655    2   DCL 1 OPER_MESS4 STATIC,
      555    17656    2        2 * CHAR(0) INIT(' *** Write errors at beginning of tape - mount new tape **')
             17656                  ;
      556    17657    2   DCL 1 OPER_MESS5 STATIC,
      557    17658    2         2 * CHAR(0) INIT(' *** Eh? ***');
      558    17659    2   DCL 1 OPER_MESS6 STATIC,
      559    17660    2         2 * CHAR(0) INIT(' *** Write errors at beginning of tape ***');
      560    17661    2   DCL 1 OPER_MESS7 STATIC,
      561    17662    2         2 * CHAR(0) INIT(' *** Must skip out to end of previous tape(s) ***');
      562    17663    2   DCL 1 OPER_MESS8 STATIC,
      563    17664    2         2 * CHAR(0) INIT(' *** Mount replacement tape when requested ***');
      564    17665    2   DCL ANSWER CHAR(8) STATIC INIT(' ');
      565    17666    2   DCL 1 TYC_ARS STATIC,
      566    17667    2         2 TYC UBIN WORD,
      567    17668    2         2 ARS UBIN WORD;
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:120  
      568    17669
      569    17670        %FPT_OPEN( FPTN=TAPE_OPEN_LAST,
      570    17671                   STCLASS=STATIC,
      571    17672                   ORG=RESTRICT,
      572    17673                   RES='LT',
      573    17674                   ACS=BLOCK,
      574    17675                   ASN=TAPE,
      575    17676                   IGNOREFSN=YES);
      576    17785
      577    17786        %FPT_PFIL ( FPTN=TAPE_PFIL,
      578    17787                    BOF=NO,
      579    17788                    STCLASS=STATIC);
      580    17803
      581    17804        %VLP_ERRCODE ( FPTN = ERRCODE );
      582    17849
      583    17850         /***
      584    17851          *** BASED
      585    17852          ***/
      586    17853
      587    17854        %F$DCB (BASED="BASED(DCB$)");
      588    17911
      589    17912        /***
      590    17913         *** SYMREF
      591    17914         ***/
      592    17915
      593    17916
      594    17917        /****************************************/
      595    17918
      596    17919    2      TAPE_OPEN_LAST.V.OPER.TEST# = '0'B;

  17919 14 000120   000001 236000 15                 LDQ     1
        14 000121   000366 356000 6                  ANSQ    TAPE_OPEN_LAST+36

      597    17920    2      TAPE_OPEN_LAST.V.FUN# = %IN#;

  17920 14 000122   002000 236007                    LDQ     1024,DL
        14 000123   000367 552010 6                  STBQ    TAPE_OPEN_LAST+37,'10'O
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:121  

      598    17921    2      TAPE_OPEN_LAST.V.XTEND# = '0'B;

  17921 14 000124   000002 236000 15                 LDQ     2
        14 000125   000402 356000 6                  ANSQ    TAPE_OPEN_LAST+48

      599    17922    2      TAPE_OPEN_LAST.V.INITZ.SCRUB# = '0'B;

  17922 14 000126   000003 236000 15                 LDQ     3
        14 000127   000366 356000 6                  ANSQ    TAPE_OPEN_LAST+36

      600    17923    2      TAPE_OPEN_LAST.V.VOL# = 0;

  17923 14 000130   000000 236003                    LDQ     0,DU
        14 000131   000403 552040 6                  STBQ    TAPE_OPEN_LAST+49,'40'O

      601    17924
      602    17925    2      OC_KEYIN.V.WAIT# = '0'B;

  17925 14 000132   000031 236000 xsym               LDQ     B_VECTNIL+25
        14 000133   000167 356000 6                  ANSQ    OC_KEYIN+11

      603    17926    2      OC_KEYIN.REPLY_ = VECTOR(NIL);

  17926 14 000134   000004 237000 15                 LDAQ    4
        14 000135   000160 757000 6                  STAQ    OC_KEYIN+4

      604    17927    2      OC_KEYIN.MESS_ = VECTOR(OPER_MESS1);

  17927 14 000136   000006 237000 15                 LDAQ    6
        14 000137   000156 757000 6                  STAQ    OC_KEYIN+2

      605    17928    2      CALL M$KEYIN( OC_KEYIN ) ALTRET(REPALT);

  17928 14 000140   000154 630400 6                  EPPR0   OC_KEYIN
        14 000141   520000 713400                    CLIMB   alt,+40960
        14 000142   401400 401760                    pmme    nvectors=4
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:122  
        14 000143   001206 702000 14                 TSX2    REPALT

      606    17929    2      OC_KEYIN.MESS_ = VECTOR(OPER_MESS2);

  17929 14 000144   000010 237000 15                 LDAQ    8
        14 000145   000156 757000 6                  STAQ    OC_KEYIN+2

  17929 14 000146                       QUERY_OPER   null
      607    17930    2   QUERY_OPER: ;
      608    17931    2      OC_KEYIN.V.WAIT# = '1'B;

  17931 14 000146   400000 236003                    LDQ     -131072,DU
        14 000147   000167 256000 6                  ORSQ    OC_KEYIN+11

      609    17932    2      OC_KEYIN.REPLY_ = VECTOR(ANSWER);

  17932 14 000150   000012 237000 15                 LDAQ    10
        14 000151   000160 757000 6                  STAQ    OC_KEYIN+4

      610    17933    2      OC_KEYIN.RESULTS_ = VECTOR(TYC_ARS);

  17933 14 000152   000014 237000 15                 LDAQ    12
        14 000153   000162 757000 6                  STAQ    OC_KEYIN+6

      611    17934    2      CALL M$KEYIN( OC_KEYIN ) ALTRET(REPALT);

  17934 14 000154   000154 630400 6                  EPPR0   OC_KEYIN
        14 000155   520000 713400                    CLIMB   alt,+40960
        14 000156   401400 401760                    pmme    nvectors=4
        14 000157   001206 702000 14                 TSX2    REPALT

      612    17935
      613    17936    2      IF SUBSTR(ANSWER,0,1) = 'X' or SUBSTR(ANSWER,0,1) = 'x'

  17936 14 000160   000315 236000 6                  LDQ     ANSWER
        14 000161   777000 376003                    ANQ     -512,DU
        14 000162   130000 116003                    CMPQ    45056,DU
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:123  
        14 000163   000170 600000 14                 TZE     s:17938
        14 000164   000315 236000 6                  LDQ     ANSWER
        14 000165   777000 376003                    ANQ     -512,DU
        14 000166   170000 116003                    CMPQ    61440,DU
        14 000167   000175 601000 14                 TNZ     s:17941

      614    17937    3       THEN DO;                            /* Abort the job                      */

      615    17938    3         CALL FLI$RPT_ERR( E_OPER_ABORT );

  17938 14 000170   000016 630400 15                 EPPR0   14
        14 000171   000017 631400 xsym               EPPR1   B_VECTNIL+15
        14 000172   000000 701000 xent               TSX1    FLI$RPT_ERR
        14 000173   000000 011000                    NOP     0

      616    17939    3         GOTO JUSTALT;

  17939 14 000174   001211 710000 14                 TRA     JUSTALT

      617    17940    3         END;
      618    17941    2      IF SUBSTR(ANSWER,0,1) = 'C' OR SUBSTR(ANSWER,0,1) = 'c' /* Query op. again */

  17941 14 000175   000315 236000 6                  LDQ     ANSWER
        14 000176   777000 376003                    ANQ     -512,DU
        14 000177   103000 116003                    CMPQ    34304,DU
        14 000200   000210 600000 14                 TZE     s:17954
        14 000201   000315 236000 6                  LDQ     ANSWER
        14 000202   777000 376003                    ANQ     -512,DU
        14 000203   143000 116003                    CMPQ    50688,DU
        14 000204   000210 600000 14                 TZE     s:17954

      619    17942    2       THEN;
      620    17943    3       ELSE DO;

      621    17944    3         OC_KEYIN.MESS_ = VECTOR(OPER_MESS5);

  17944 14 000205   000020 237000 15                 LDAQ    16
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:124  
        14 000206   000156 757000 6                  STAQ    OC_KEYIN+2

      622    17945    3         GOTO QUERY_OPER;

  17945 14 000207   000146 710000 14                 TRA     QUERY_OPER

      623    17946    3         END;
      624    17947
      625    17948        /***
      626    17949        *** If data/blocks(s) already exist in EFT_RESTRICT_FILE, save previous tape block,
      627    17950        *** truncate the tape file, rewrite previous and current blocks to the next volume.
      628    17951         *** Previous block rewritten as good tape needed for writing labels. 1st recd of
      629    17952         *** block appears to be used by TFM.
      630    17953         ***/
      631    17954    2      DCB$ = TAPE_DCBLIST.DCB$(SNLIST_NUM);

  17954 14 000210   200011 235100                    LDA     SNLIST_NUM,,AUTO
        14 000211   000001 735000                    ALS     1
        14 000212   000000 470400 xsym               LDP0    TAPE_DCBLIST$
        14 000213   000001 236105                    LDQ     1,AL,PR0
        14 000214   200016 756100                    STQ     DCB$,,AUTO

      632    17955    2      TAPE_PRECORD.V.IOERROK# = '1'B;

  17955 14 000215   002000 236007                    LDQ     1024,DL
        14 000216   000006 256000 xsym               ORSQ    TAPE_PRECORD+6

      633    17956    2      IF NOT BOVOLUME                      /* At beginning of tape?              */

  17956 14 000217   200013 234100                    SZN     BOVOLUME,,AUTO
        14 000220   000511 604000 14                 TMI     s:18022
        14 000221   200016 471500                    LDP1    DCB$,,AUTO
        14 000222   100071 235100                    LDA     57,,PR1
        14 000223   000001 115007                    CMPA    1,DL
        14 000224   000511 604400 14                 TMOZ    s:18022

      634    17957    2        AND F$DCB.CRECNO > 1               /* Data exist in file?                */
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:125  
      635    17958    3       THEN DO;

      636    17959        /***
      637    17960         *** Backspace all the tapes: 2 blocks for tapes before error, 1 block for rest.
      638    17961         ***/
      639    17962    3         TAPE_PRECORD.V.NOMARKS# = '1'B;

  17962 14 000225   200000 236007                    LDQ     65536,DL
        14 000226   000010 256000 xsym               ORSQ    TAPE_PRECORD+8

      640    17963    3         TAPE_PRECORD.V.N# = -2;           /* Backspace two records              */

  17963 14 000227   000002 335007                    LCA     2,DL
        14 000230   000007 755000 xsym               STA     TAPE_PRECORD+7

      641    17964    4         DO I=0 TO NBR_SNLISTS -1;

  17964 14 000231   200017 450100                    STZ     I,,AUTO
        14 000232   000252 710000 14                 TRA     s:17970+1

      642    17965    4            TAPE_PRECORD.V.DCB# = TAPE_DCBLIST.DCB#(I);

  17965 14 000233   200017 235100                    LDA     I,,AUTO
        14 000234   000001 735000                    ALS     1
        14 000235   000000 470400 xsym               LDP0    TAPE_DCBLIST$
        14 000236   000000 720105                    LXL0    0,AL,PR0
        14 000237   000006 740000 xsym               STX0    TAPE_PRECORD+6

      643    17966    4            IF I = SNLIST_NUM

  17966 14 000240   200017 236100                    LDQ     I,,AUTO
        14 000241   200011 116100                    CMPQ    SNLIST_NUM,,AUTO
        14 000242   000245 601000 14                 TNZ     s:17969

      644    17967    4             THEN
      645    17968    4               TAPE_PRECORD.V.N# = -1;

PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:126  
  17968 14 000243   000001 335007                    LCA     1,DL
        14 000244   000007 755000 xsym               STA     TAPE_PRECORD+7

      646    17969    4            CALL M$PRECORD( TAPE_PRECORD ) ALTRET(REPALT);

  17969 14 000245   000000 630400 xsym               EPPR0   TAPE_PRECORD
        14 000246   440003 713400                    CLIMB   alt,+16387
        14 000247   401000 401760                    pmme    nvectors=3
        14 000250   001206 702000 14                 TSX2    REPALT

      647    17970    4            END;

  17970 14 000251   200017 054100                    AOS     I,,AUTO
        14 000252   200017 236100                    LDQ     I,,AUTO
        14 000253   000000 116000 xsym               CMPQ    NBR_SNLISTS
        14 000254   000233 604000 14                 TMI     s:17965

      648    17971
      649    17972    3         CALL FLI$ALLOC_BUF( PREV_BLK_, %MAX_GRANS_PER_TAPE_BUF );
             17972                  /* Read last block from tape */

  17972 14 000255   000023 236000 15                 LDQ     19
        14 000256   200053 756100                    STQ     TAPE_NAME+4,,AUTO
        14 000257   200024 630500                    EPPR0   PREV_BLK_,,AUTO
        14 000260   200052 450500                    STP0    TAPE_NAME+3,,AUTO
        14 000261   200052 630500                    EPPR0   TAPE_NAME+3,,AUTO
        14 000262   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 000263   000000 701000 xent               TSX1    FLI$ALLOC_BUF
        14 000264   000000 011000                    NOP     0

      650    17973    3         TAPE_READ.V.DCB# = TAPE_DCBLIST.DCB#(SNLIST_NUM);

  17973 14 000265   200011 235100                    LDA     SNLIST_NUM,,AUTO
        14 000266   000001 735000                    ALS     1
        14 000267   000000 470400 xsym               LDP0    TAPE_DCBLIST$
        14 000270   000000 720105                    LXL0    0,AL,PR0
        14 000271   000010 740000 xsym               STX0    TAPE_READ+8
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:127  

      651    17974    3         TAPE_READ.BUF_ = PREV_BLK_;

  17974 14 000272   200024 237100                    LDAQ    PREV_BLK_,,AUTO
        14 000273   000004 757000 xsym               STAQ    TAPE_READ+4

      652    17975    3         TAPE_READ.V.IOERROK# = '0'B;

  17975 14 000274   000024 236000 15                 LDQ     20
        14 000275   000010 356000 xsym               ANSQ    TAPE_READ+8

      653    17976    3         CALL M$READ( TAPE_READ ) ALTRET(REPALT);

  17976 14 000276   000000 630400 xsym               EPPR0   TAPE_READ
        14 000277   440000 713400                    CLIMB   alt,read
        14 000300   401400 401760                    pmme    nvectors=4
        14 000301   001206 702000 14                 TSX2    REPALT

      654    17977    3         PREV_BLK_ARS = TAPE_DCBLIST.DCB$(SNLIST_NUM)->F$DCB.ARS#;

  17977 14 000302   200011 235100                    LDA     SNLIST_NUM,,AUTO
        14 000303   000001 735000                    ALS     1
        14 000304   000000 470400 xsym               LDP0    TAPE_DCBLIST$
        14 000305   000001 471505                    LDP1    1,AL,PR0
        14 000306   100000 235100                    LDA     0,,PR1
        14 000307   200020 755100                    STA     PREV_BLK_ARS,,AUTO

      655    17978    3         CALL M$PRECORD( TAPE_PRECORD ) ALTRET(REPALT); /* Backspace again       */

  17978 14 000310   000000 630400 xsym               EPPR0   TAPE_PRECORD
        14 000311   440003 713400                    CLIMB   alt,+16387
        14 000312   401000 401760                    pmme    nvectors=3
        14 000313   001206 702000 14                 TSX2    REPALT

      656    17979    3         TAPE_PRECORD.V.NOMARKS# = '0'B;

  17979 14 000314   000025 236000 15                 LDQ     21
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:128  
        14 000315   000010 356000 xsym               ANSQ    TAPE_PRECORD+8

      657    17980    3         TAPE_CLOSE.V.TRUNCATE# = '1'B; /* Close and truncate file - all tapes   */

  17980 14 000316   001000 236007                    LDQ     512,DL
        14 000317   000032 256000 xsym               ORSQ    TAPE_CLOSE+26

      658    17981
      659    17982    3         BLK_TAGT$ = PINCRW( PREV_BLK_.PTR$, PREV_BLK_.PTR$->BLK_TAG.NBR * SIZEW(
             17982                  BLK_TAG) - SIZEW(BLK_TAG));

  17982 14 000320   200025 470500                    LDP0    PREV_BLK_+1,,AUTO
        14 000321   000000 236100                    LDQ     0,,PR0
        14 000322   000011 772000                    QRL     9
        14 000323   000777 376007                    ANQ     511,DL
        14 000324   000013 402003                    MPY     11,DU
        14 000325   000013 136003                    SBLQ    11,DU
        14 000326   200025 036100                    ADLQ    PREV_BLK_+1,,AUTO
        14 000327   200023 756100                    STQ     BLK_TAGT$,,AUTO

      660    17983    3         IF NOT BLK_TAG.BEG           /* 1st file in blk con. from prev. tape?   */

  17983 14 000330   200023 471500                    LDP1    BLK_TAGT$,,AUTO
        14 000331   100000 236100                    LDQ     0,,PR1
        14 000332   000400 316007                    CANQ    256,DL
        14 000333   000341 601000 14                 TNZ     s:17985

      661    17984    3          THEN CALL FLI$TAPE_CLOSE( '1'B /* CVOL */ ) ALTRET(JUSTALT);

  17984 14 000334   000026 630400 15                 EPPR0   22
        14 000335   000017 631400 xsym               EPPR1   B_VECTNIL+15
        14 000336   000000 701000 xent               TSX1    FLI$TAPE_CLOSE
        14 000337   001211 702000 14                 TSX2    JUSTALT
        14 000340   000344 710000 14                 TRA     s:17986

      662    17985    3          ELSE CALL FLI$TAPE_CLOSE ALTRET(JUSTALT); /* Nope, so don't need UTLabel */

PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:129  
  17985 14 000341   000002 631400 xsym               EPPR1   B_VECTNIL+2
        14 000342   000000 701000 xent               TSX1    FLI$TAPE_CLOSE
        14 000343   001211 702000 14                 TSX2    JUSTALT

      663    17986    3         TAPE_CLOSE.V.TRUNCATE# = '0'B;

  17986 14 000344   000027 236000 15                 LDQ     23
        14 000345   000032 356000 xsym               ANSQ    TAPE_CLOSE+26

      664    17987        /***
      665    17988         *** PREV_BLK will get written to new tape with new FSN.
      666    17989         ***/
      667    17990    3         CALL FLI$TAPE_OPEN( VECTOR(EFT_CVOL_FILE), TAPE_SN, TAPE_FSN, '0'B, '1'B, ,

  17990 14 000346   000000 236000 xsym               LDQ     EFT_CVOL_FILE
        14 000347   000033 772000                    QRL     27
        14 000350   000001 620006                    EAX0    1,QL
        14 000351   000000 635010                    EAA     0,X0
        14 000352   000002 771000                    ARL     2
        14 000353   000140 135007                    SBLA    96,DL
        14 000354   000030 236000 15                 LDQ     24
        14 000355   200052 757100                    STAQ    TAPE_NAME+3,,AUTO
        14 000356   200015 630500                    EPPR0   DCB#,,AUTO
        14 000357   200064 450500                    STP0    TAPE_NAME+13,,AUTO
        14 000360   200026 631500                    EPPR1   ERR,,AUTO
        14 000361   200063 451500                    STP1    TAPE_NAME+12,,AUTO
        14 000362   000032 236000 15                 LDQ     26
        14 000363   200062 756100                    STQ     TAPE_NAME+11,,AUTO
        14 000364   000001 236000 xsym               LDQ     B_VECTNIL+1
        14 000365   000026 235000 15                 LDA     22
        14 000366   200060 757100                    STAQ    TAPE_NAME+9,,AUTO
        14 000367   000034 237000 15                 LDAQ    28
        14 000370   200056 757100                    STAQ    TAPE_NAME+7,,AUTO
        14 000371   000036 236000 15                 LDQ     30
        14 000372   200055 756100                    STQ     TAPE_NAME+6,,AUTO
        14 000373   200052 633500                    EPPR3   TAPE_NAME+3,,AUTO
        14 000374   200054 453500                    STP3    TAPE_NAME+5,,AUTO
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:130  
        14 000375   200054 630500                    EPPR0   TAPE_NAME+5,,AUTO
        14 000376   000031 631400 15                 EPPR1   25
        14 000377   000000 701000 xent               TSX1    FLI$TAPE_OPEN
        14 000400   001175 702000 14                 TSX2    REPERRALT

      668    17991    3           A_FIT_, ERR, DCB# ) ALTRET(REPERRALT);
      669    17992    3         CALL FLI$CHANGE_VOLUMES ALTRET(JUSTALT);

  17992 14 000401   000002 631400 xsym               EPPR1   B_VECTNIL+2
        14 000402   000000 701000 xent               TSX1    FLI$CHANGE_VOLUMES
        14 000403   001211 702000 14                 TSX2    JUSTALT

      670    17993    3         CALL FLI$TAPE_CLOSE ALTRET(JUSTALT); /* Close EFT_CVOL_FILE             */

  17993 14 000404   000002 631400 xsym               EPPR1   B_VECTNIL+2
        14 000405   000000 701000 xent               TSX1    FLI$TAPE_CLOSE
        14 000406   001211 702000 14                 TSX2    JUSTALT

      671    17994
      672    17995    3         CALL FLI$TAPE_OPEN( VECTOR(EFT_RESTRICT_FILE), TAPE_SN, TAPE_FSN, '0'B,

  17995 14 000407   000000 236000 xsym               LDQ     EFT_RESTRICT_FILE
        14 000410   000033 772000                    QRL     27
        14 000411   000001 620006                    EAX0    1,QL
        14 000412   000000 635010                    EAA     0,X0
        14 000413   000002 771000                    ARL     2
        14 000414   000140 135007                    SBLA    96,DL
        14 000415   000037 236000 15                 LDQ     31
        14 000416   200052 757100                    STAQ    TAPE_NAME+3,,AUTO
        14 000417   200015 630500                    EPPR0   DCB#,,AUTO
        14 000420   200064 450500                    STP0    TAPE_NAME+13,,AUTO
        14 000421   200026 631500                    EPPR1   ERR,,AUTO
        14 000422   200063 451500                    STP1    TAPE_NAME+12,,AUTO
        14 000423   000032 236000 15                 LDQ     26
        14 000424   200062 756100                    STQ     TAPE_NAME+11,,AUTO
        14 000425   000001 236000 xsym               LDQ     B_VECTNIL+1
        14 000426   000026 235000 15                 LDA     22
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:131  
        14 000427   200060 757100                    STAQ    TAPE_NAME+9,,AUTO
        14 000430   000034 237000 15                 LDAQ    28
        14 000431   200056 757100                    STAQ    TAPE_NAME+7,,AUTO
        14 000432   000036 236000 15                 LDQ     30
        14 000433   200055 756100                    STQ     TAPE_NAME+6,,AUTO
        14 000434   200052 633500                    EPPR3   TAPE_NAME+3,,AUTO
        14 000435   200054 453500                    STP3    TAPE_NAME+5,,AUTO
        14 000436   200054 630500                    EPPR0   TAPE_NAME+5,,AUTO
        14 000437   000031 631400 15                 EPPR1   25
        14 000440   000000 701000 xent               TSX1    FLI$TAPE_OPEN
        14 000441   001175 702000 14                 TSX2    REPERRALT

      673    17996    3           '1'B, , A_FIT_, ERR, DCB# ) ALTRET(REPERRALT);
      674    17997        /***
      675    17998         *** If file begins in this block, must update block and disk fits - CODE05 or
      676    17999         *** CODE06 with new tape info. (FSN and SN) so that file's fit is correct when
      677    18000         *** file is restored. CODE05 is updated only for BACKUP,SAVE and is a regular
      678    18001         *** file. Code06 is updated only if archiving or COMPACTing.
      679    18002         ***/
      680    18003    3         CROSSED = ' ';

  18003 14 000442   040000 236003                    LDQ     16384,DU
        14 000443   000000 756000 xsym               STQ     CROSSED

      681    18004    3         CALL FLI_UPDATE_FITS( PREV_BLK_ );

  18004 14 000444   200024 630500                    EPPR0   PREV_BLK_,,AUTO
        14 000445   200031 450500                    STP0    ERR+3,,AUTO
        14 000446   001232 701000 14                 TSX1    FLI_UPDATE_FITS
        14 000447   000000 011000                    NOP     0

      682    18005    3         CALL FLI$TAPE_WRITE( PREV_BLK_, PREV_BLK_ARS, EOVOLUME, COMMAND, NEW_TSN,
             18005                  NEW_FSN ) ALTRET(JUSTALT);

  18005 14 000450   200010 236100                    LDQ     @NEW_FSN,,AUTO
        14 000451   200007 235100                    LDA     @NEW_TSN,,AUTO
        14 000452   200056 757100                    STAQ    TAPE_NAME+7,,AUTO
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:132  
        14 000453   200006 236100                    LDQ     @COMMAND,,AUTO
        14 000454   200005 235100                    LDA     @EOVOLUME,,AUTO
        14 000455   200054 757100                    STAQ    TAPE_NAME+5,,AUTO
        14 000456   200020 630500                    EPPR0   PREV_BLK_ARS,,AUTO
        14 000457   200053 450500                    STP0    TAPE_NAME+4,,AUTO
        14 000460   200024 631500                    EPPR1   PREV_BLK_,,AUTO
        14 000461   200052 451500                    STP1    TAPE_NAME+3,,AUTO
        14 000462   200052 630500                    EPPR0   TAPE_NAME+3,,AUTO
        14 000463   000024 631400 xsym               EPPR1   B_VECTNIL+20
        14 000464   000000 701000 14                 TSX1    s:6
        14 000465   001211 702000 14                 TSX2    JUSTALT

      683    18006    3         CALL FLI_UPDATE_FITS( BUF_ );

  18006 14 000466   200003 236100                    LDQ     @BUF_,,AUTO
        14 000467   200031 756100                    STQ     ERR+3,,AUTO
        14 000470   001232 701000 14                 TSX1    FLI_UPDATE_FITS
        14 000471   000000 011000                    NOP     0

      684    18007    3        CALL FLI$TAPE_WRITE ( BUF_, ARS, EOVOLUME, COMMAND, NEW_TSN, NEW_FSN ) ALTRET(
             18007                  JUSTALT);

  18007 14 000472   200003 630500                    EPPR0   @BUF_,,AUTO
        14 000473   000024 631400 xsym               EPPR1   B_VECTNIL+20
        14 000474   000000 701000 14                 TSX1    s:6
        14 000475   001211 702000 14                 TSX2    JUSTALT

      685    18008    3         NEW_TSN = TAPE_SN; /* FSN,SN for current file changed, return new values */

  18008 14 000476   200007 470500                    LDP0    @NEW_TSN,,AUTO
        14 000477   040100 100400                    MLR     fill='040'O
        14 000500   000000 000006 xsym               ADSC9   TAPE_SN                  cn=0,n=6
        14 000501   000000 000006                    ADSC9   0,,PR0                   cn=0,n=6

      686    18009    3         NEW_FSN = TAPE_FSN;

  18009 14 000502   000000 235000 xsym               LDA     TAPE_FSN
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:133  
        14 000503   200010 471500                    LDP1    @NEW_FSN,,AUTO
        14 000504   100000 755100                    STA     0,,PR1

      687    18010    3         NBR_FILE_BLOCKS = %MAX_NBR_FILE_BLOCKS + 1; /* Force new block          */

  18010 14 000505   000063 236007                    LDQ     51,DL
        14 000506   000000 756000 xsym               STQ     NBR_FILE_BLOCKS

      688    18011    3         RETURN;

  18011 14 000507   200014 221300                    LDX1  ! BOVOLUME+1,,AUTO
        14 000510   000001 702211                    TSX2  ! 1,X1

      689    18012    3         END;
      690    18013
      691    18014    3       ELSE DO;

      692    18015        /***
      693    18016         *** Either at BOT or no data/blocks in this EFT_RESTRICT_FILE. Determine if tape
      694    18017         *** is positioned at BOT by comparing current FSN with 1st FSN on tape. If BOT,
      695    18018         *** dismount current volume, mount preceding volume (if one exists), skip out to
      696    18019        *** EFT_CVOL_FILE, rewrite new EFT_CVOL_FILE, and write current block written to ne
             18019        xt
      697    18020         *** volume. If not BOT, a CVOL is performed and current block written to next vol.
      698    18021         ***/
      699    18022    3         FSN_SAVE = F$DCB.FSN#;

  18022 14 000511   200016 471500                    LDP1    DCB$,,AUTO
        14 000512   100034 236100                    LDQ     28,,PR1
        14 000513   000022 772000                    QRL     18
        14 000514   200021 756100                    STQ     FSN_SAVE,,AUTO

      700    18023    3         VOL_SAVE = F$DCB.VOL#;

  18023 14 000515   100043 236100                    LDQ     35,,PR1
        14 000516   000033 772000                    QRL     27
        14 000517   200022 756100                    STQ     VOL_SAVE,,AUTO
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:134  

      701    18024    3         CALL FLI$TAPE_CLOSE ALTRET(JUSTALT);

  18024 14 000520   000002 631400 xsym               EPPR1   B_VECTNIL+2
        14 000521   000000 701000 xent               TSX1    FLI$TAPE_CLOSE
        14 000522   001211 702000 14                 TSX2    JUSTALT

      702    18025    3         TAPE_REWIND.V.PSN# = F$DCB.PSN#;

  18025 14 000523   200016 470500                    LDP0    DCB$,,AUTO
        14 000524   040000 100500                    MLR     fill='040'O
        14 000525   000024 000006                    ADSC9   20,,PR0                  cn=0,n=6
        14 000526   000002 400006 xsym               ADSC9   TAPE_REWIND+2            cn=2,n=6

      703    18026    3         CALL M$REM( TAPE_REWIND ) ALTRET(REPALT);

  18026 14 000527   000000 630400 xsym               EPPR0   TAPE_REWIND
        14 000530   460006 713400                    CLIMB   alt,+24582
        14 000531   400000 401760                    pmme    nvectors=1
        14 000532   001206 702000 14                 TSX2    REPALT

      704    18027
      705    18028    3         TAPE_OPEN_LAST.V.FSN# = 1;        /* Get first FSN                      */

  18028 14 000533   000001 220003                    LDX0    1,DU
        14 000534   000410 740000 6                  STX0    TAPE_OPEN_LAST+54

      706    18029    3         TAPE_OPEN_LAST.NAME_ = VECTOR(ERASE);

  18029 14 000535   000040 237000 15                 LDAQ    32
        14 000536   000330 757000 6                  STAQ    TAPE_OPEN_LAST+6

      707    18030    3         TAPE_OPEN_LAST.V.DCB# = TAPE_DCBLIST.DCB#(SNLIST_NUM);

  18030 14 000537   200011 235100                    LDA     SNLIST_NUM,,AUTO
        14 000540   000001 735000                    ALS     1
        14 000541   000000 470400 xsym               LDP0    TAPE_DCBLIST$
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:135  
        14 000542   000000 721105                    LXL1    0,AL,PR0
        14 000543   000366 741000 6                  STX1    TAPE_OPEN_LAST+36

      708    18031    3         CALL M$OPEN( TAPE_OPEN_LAST ) ALTRET(REPALT);

  18031 14 000544   000322 630400 6                  EPPR0   TAPE_OPEN_LAST
        14 000545   450000 713400                    CLIMB   alt,open
        14 000546   410400 401760                    pmme    nvectors=18
        14 000547   001206 702000 14                 TSX2    REPALT

      709    18032    3         TAPE_CLOSE.V.DCB# = TAPE_DCBLIST.DCB#(SNLIST_NUM);

  18032 14 000550   200011 235100                    LDA     SNLIST_NUM,,AUTO
        14 000551   000001 735000                    ALS     1
        14 000552   000000 470400 xsym               LDP0    TAPE_DCBLIST$
        14 000553   000000 720105                    LXL0    0,AL,PR0
        14 000554   000032 740000 xsym               STX0    TAPE_CLOSE+26

      710    18033    3         CALL M$CLOSE( TAPE_CLOSE ) ALTRET(REPALT);

  18033 14 000555   000000 630400 xsym               EPPR0   TAPE_CLOSE
        14 000556   450001 713400                    CLIMB   alt,close
        14 000557   406000 401760                    pmme    nvectors=13
        14 000560   001206 702000 14                 TSX2    REPALT

      711    18034
      712    18035    3         IF FSN_SAVE ~= F$DCB.FSN#

  18035 14 000561   200016 470500                    LDP0    DCB$,,AUTO
        14 000562   000034 236100                    LDQ     28,,PR0
        14 000563   000022 772000                    QRL     18
        14 000564   200021 116100                    CMPQ    FSN_SAVE,,AUTO
        14 000565   000711 600000 14                 TZE     s:18063

      713    18036    4          THEN DO;

      714    18037        /***
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:136  
      715    18038         *** Not at BOT. An EFT_RESTRICT_FILE file exists prior to point of error.
      716    18039         *** Write current block to next volume.
      717    18040         ***/
      718    18041    4            TAPE_OPEN.V.XTEND# = '1'B;

  18041 14 000566   000060 236000 xsym               LDQ     TAPE_OPEN+48
        14 000567   000002 376000 15                 ANQ     2
        14 000570   020000 276003                    ORQ     8192,DU
        14 000571   000060 756000 xsym               STQ     TAPE_OPEN+48

      719    18042    4           CALL FLI$TAPE_OPEN( VECTOR(EFT_CVOL_FILE), TAPE_SN, TAPE_FSN, '0'B, '1'B, ,

  18042 14 000572   000000 236000 xsym               LDQ     EFT_CVOL_FILE
        14 000573   000033 772000                    QRL     27
        14 000574   000001 620006                    EAX0    1,QL
        14 000575   000000 635010                    EAA     0,X0
        14 000576   000002 771000                    ARL     2
        14 000577   000140 135007                    SBLA    96,DL
        14 000600   000030 236000 15                 LDQ     24
        14 000601   200052 757100                    STAQ    TAPE_NAME+3,,AUTO
        14 000602   200015 631500                    EPPR1   DCB#,,AUTO
        14 000603   200064 451500                    STP1    TAPE_NAME+13,,AUTO
        14 000604   200026 633500                    EPPR3   ERR,,AUTO
        14 000605   200063 453500                    STP3    TAPE_NAME+12,,AUTO
        14 000606   000032 236000 15                 LDQ     26
        14 000607   200062 756100                    STQ     TAPE_NAME+11,,AUTO
        14 000610   000001 236000 xsym               LDQ     B_VECTNIL+1
        14 000611   000026 235000 15                 LDA     22
        14 000612   200060 757100                    STAQ    TAPE_NAME+9,,AUTO
        14 000613   000034 237000 15                 LDAQ    28
        14 000614   200056 757100                    STAQ    TAPE_NAME+7,,AUTO
        14 000615   000036 236000 15                 LDQ     30
        14 000616   200055 756100                    STQ     TAPE_NAME+6,,AUTO
        14 000617   200052 634500                    EPPR4   TAPE_NAME+3,,AUTO
        14 000620   200054 454500                    STP4    TAPE_NAME+5,,AUTO
        14 000621   200054 630500                    EPPR0   TAPE_NAME+5,,AUTO
        14 000622   000031 631400 15                 EPPR1   25
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:137  
        14 000623   000000 701000 xent               TSX1    FLI$TAPE_OPEN
        14 000624   001175 702000 14                 TSX2    REPERRALT

      720    18043    4              A_FIT_, ERR, DCB# ) ALTRET(REPERRALT);
      721    18044    4            CALL FLI$CHANGE_VOLUMES ALTRET(JUSTALT);

  18044 14 000625   000002 631400 xsym               EPPR1   B_VECTNIL+2
        14 000626   000000 701000 xent               TSX1    FLI$CHANGE_VOLUMES
        14 000627   001211 702000 14                 TSX2    JUSTALT

      722    18045    4            CALL FLI$TAPE_CLOSE ALTRET(JUSTALT); /* Close EFT_CVOL_FILE          */

  18045 14 000630   000002 631400 xsym               EPPR1   B_VECTNIL+2
        14 000631   000000 701000 xent               TSX1    FLI$TAPE_CLOSE
        14 000632   001211 702000 14                 TSX2    JUSTALT

      723    18046    4            TAPE_OPEN.V.XTEND# = '0'B;

  18046 14 000633   000002 236000 15                 LDQ     2
        14 000634   000060 356000 xsym               ANSQ    TAPE_OPEN+48

      724    18047
      725    18048    4            CALL FLI$TAPE_OPEN( VECTOR(EFT_RESTRICT_FILE), TAPE_SN, TAPE_FSN, '0'B,

  18048 14 000635   000000 236000 xsym               LDQ     EFT_RESTRICT_FILE
        14 000636   000033 772000                    QRL     27
        14 000637   000001 620006                    EAX0    1,QL
        14 000640   000000 635010                    EAA     0,X0
        14 000641   000002 771000                    ARL     2
        14 000642   000140 135007                    SBLA    96,DL
        14 000643   000037 236000 15                 LDQ     31
        14 000644   200052 757100                    STAQ    TAPE_NAME+3,,AUTO
        14 000645   200015 630500                    EPPR0   DCB#,,AUTO
        14 000646   200064 450500                    STP0    TAPE_NAME+13,,AUTO
        14 000647   200026 631500                    EPPR1   ERR,,AUTO
        14 000650   200063 451500                    STP1    TAPE_NAME+12,,AUTO
        14 000651   000032 236000 15                 LDQ     26
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:138  
        14 000652   200062 756100                    STQ     TAPE_NAME+11,,AUTO
        14 000653   000001 236000 xsym               LDQ     B_VECTNIL+1
        14 000654   000026 235000 15                 LDA     22
        14 000655   200060 757100                    STAQ    TAPE_NAME+9,,AUTO
        14 000656   000034 237000 15                 LDAQ    28
        14 000657   200056 757100                    STAQ    TAPE_NAME+7,,AUTO
        14 000660   000036 236000 15                 LDQ     30
        14 000661   200055 756100                    STQ     TAPE_NAME+6,,AUTO
        14 000662   200052 633500                    EPPR3   TAPE_NAME+3,,AUTO
        14 000663   200054 453500                    STP3    TAPE_NAME+5,,AUTO
        14 000664   200054 630500                    EPPR0   TAPE_NAME+5,,AUTO
        14 000665   000031 631400 15                 EPPR1   25
        14 000666   000000 701000 xent               TSX1    FLI$TAPE_OPEN
        14 000667   001175 702000 14                 TSX2    REPERRALT

      726    18049    4              '1'B, , A_FIT_, ERR, DCB# ) ALTRET(REPERRALT);
      727    18050    4            CALL FLI_UPDATE_FITS( BUF_ );

  18050 14 000670   200003 236100                    LDQ     @BUF_,,AUTO
        14 000671   200031 756100                    STQ     ERR+3,,AUTO
        14 000672   001232 701000 14                 TSX1    FLI_UPDATE_FITS
        14 000673   000000 011000                    NOP     0

      728    18051    4           NEW_TSN = TAPE_SN; /* FSN,SN changed for current file, return new values */

  18051 14 000674   200007 470500                    LDP0    @NEW_TSN,,AUTO
        14 000675   040100 100400                    MLR     fill='040'O
        14 000676   000000 000006 xsym               ADSC9   TAPE_SN                  cn=0,n=6
        14 000677   000000 000006                    ADSC9   0,,PR0                   cn=0,n=6

      729    18052    4            NEW_FSN = TAPE_FSN;

  18052 14 000700   000000 235000 xsym               LDA     TAPE_FSN
        14 000701   200010 471500                    LDP1    @NEW_FSN,,AUTO
        14 000702   100000 755100                    STA     0,,PR1

      730    18053    4            CALL FLI$TAPE_WRITE( BUF_, ARS, EOVOLUME, COMMAND ) ALTRET(JUSTALT);
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:139  

  18053 14 000703   200003 630500                    EPPR0   @BUF_,,AUTO
        14 000704   000022 631400 xsym               EPPR1   B_VECTNIL+18
        14 000705   000000 701000 14                 TSX1    s:6
        14 000706   001211 702000 14                 TSX2    JUSTALT

      731    18054    4            RETURN;

  18054 14 000707   200014 221300                    LDX1  ! BOVOLUME+1,,AUTO
        14 000710   000001 702211                    TSX2  ! 1,X1

      732    18055    4            END;
      733    18056
      734    18057    4          ELSE DO;

      735    18058        /***
      736    18059         *** At BOT. Write current block to next volume after rewriting EFT_CVOL_FILE
      737    18060         *** on previous volume, if there is a previous volume. If no previous
      738    18061         *** volume write block to replacement volume.
      739    18062         ***/
      740    18063    4            IF FIRST_TAPE_VOL = VOL_SAVE

  18063 14 000711   000000 236000 xsym               LDQ     FIRST_TAPE_VOL
        14 000712   001033 604000 14                 TMI     s:18090
        14 000713   200022 116100                    CMPQ    VOL_SAVE,,AUTO
        14 000714   001033 601000 14                 TNZ     s:18090

      741    18064    5             THEN DO;                      /* Error writing first volume         */

      742    18065    6               DO I=0 TO NBR_SNLISTS - 1;  /* Position all volumes to load point */

  18065 14 000715   200017 450100                    STZ     I,,AUTO
        14 000716   000733 710000 14                 TRA     s:18068+1

      743    18066    6                  TAPE_REWIND.V.PSN# = TAPE_DCBLIST.DCB$(I)->F$DCB.PSN#;

  18066 14 000717   200017 235100                    LDA     I,,AUTO
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:140  
        14 000720   000001 735000                    ALS     1
        14 000721   000000 470400 xsym               LDP0    TAPE_DCBLIST$
        14 000722   000001 471505                    LDP1    1,AL,PR0
        14 000723   040000 100500                    MLR     fill='040'O
        14 000724   100024 000006                    ADSC9   20,,PR1                  cn=0,n=6
        14 000725   000002 400006 xsym               ADSC9   TAPE_REWIND+2            cn=2,n=6

      744    18067    6                  CALL M$REM( TAPE_REWIND ) ALTRET(JUSTALT);

  18067 14 000726   000000 630400 xsym               EPPR0   TAPE_REWIND
        14 000727   460006 713400                    CLIMB   alt,+24582
        14 000730   400000 401760                    pmme    nvectors=1
        14 000731   001211 702000 14                 TSX2    JUSTALT

      745    18068    6                  END;

  18068 14 000732   200017 054100                    AOS     I,,AUTO
        14 000733   200017 236100                    LDQ     I,,AUTO
        14 000734   000000 116000 xsym               CMPQ    NBR_SNLISTS
        14 000735   000717 604000 14                 TMI     s:18066

      746    18069
      747    18070    5               OC_KEYIN.V.WAIT# = '0'B;    /* Tell oper. to mount new tape       */

  18070 14 000736   000031 236000 xsym               LDQ     B_VECTNIL+25
        14 000737   000167 356000 6                  ANSQ    OC_KEYIN+11

      748    18071    5               OC_KEYIN.REPLY_ = VECTOR(NIL);

  18071 14 000740   000004 237000 15                 LDAQ    4
        14 000741   000160 757000 6                  STAQ    OC_KEYIN+4

      749    18072    5               OC_KEYIN.MESS_ = VECTOR(OPER_MESS4);

  18072 14 000742   000042 237000 15                 LDAQ    34
        14 000743   000156 757000 6                  STAQ    OC_KEYIN+2

PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:141  
      750    18073    5               OC_KEYIN.RESULTS_ = VECTOR(NIL);

  18073 14 000744   000004 237000 15                 LDAQ    4
        14 000745   000162 757000 6                  STAQ    OC_KEYIN+6

      751    18074    5               CALL M$KEYIN( OC_KEYIN ) ALTRET(REPALT);

  18074 14 000746   000154 630400 6                  EPPR0   OC_KEYIN
        14 000747   520000 713400                    CLIMB   alt,+40960
        14 000750   401400 401760                    pmme    nvectors=4
        14 000751   001206 702000 14                 TSX2    REPALT

      752    18075
      753    18076    5               TAPE_REMOVE.V.PSN# = F$DCB.PSN#; /* Remove bad volume only        */

  18076 14 000752   200016 470500                    LDP0    DCB$,,AUTO
        14 000753   040000 100500                    MLR     fill='040'O
        14 000754   000024 000006                    ADSC9   20,,PR0                  cn=0,n=6
        14 000755   000002 400006 xsym               ADSC9   TAPE_REMOVE+2            cn=2,n=6

      754    18077    5               CALL M$REM( TAPE_REMOVE ) ALTRET(JUSTALT);

  18077 14 000756   000000 630400 xsym               EPPR0   TAPE_REMOVE
        14 000757   460006 713400                    CLIMB   alt,+24582
        14 000760   400000 401760                    pmme    nvectors=1
        14 000761   001211 702000 14                 TSX2    JUSTALT

      755    18078
      756    18079    5               TAPE_OPEN.V.OPER.MNTONLY# = '1'B;

  18079 14 000762   001000 236007                    LDQ     512,DL
        14 000763   000044 256000 xsym               ORSQ    TAPE_OPEN+36

      757    18080    5               TAPE_OPEN.V.INITZ.SCRUB# = '1'B;

  18080 14 000764   400000 236007                    LDQ     -131072,DL
        14 000765   000044 256000 xsym               ORSQ    TAPE_OPEN+36
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:142  

      758    18081    5               CALL FLI$TAPE_OPEN( VECTOR(EFT_RESTRICT_FILE), TAPE_SN, TAPE_FSN,

  18081 14 000766   000000 236000 xsym               LDQ     EFT_RESTRICT_FILE
        14 000767   000033 772000                    QRL     27
        14 000770   000001 620006                    EAX0    1,QL
        14 000771   000000 635010                    EAA     0,X0
        14 000772   000002 771000                    ARL     2
        14 000773   000140 135007                    SBLA    96,DL
        14 000774   000037 236000 15                 LDQ     31
        14 000775   200052 757100                    STAQ    TAPE_NAME+3,,AUTO
        14 000776   200015 630500                    EPPR0   DCB#,,AUTO
        14 000777   200064 450500                    STP0    TAPE_NAME+13,,AUTO
        14 001000   200026 631500                    EPPR1   ERR,,AUTO
        14 001001   200063 451500                    STP1    TAPE_NAME+12,,AUTO
        14 001002   000032 236000 15                 LDQ     26
        14 001003   200062 756100                    STQ     TAPE_NAME+11,,AUTO
        14 001004   000001 236000 xsym               LDQ     B_VECTNIL+1
        14 001005   000035 235000 15                 LDA     29
        14 001006   200060 757100                    STAQ    TAPE_NAME+9,,AUTO
        14 001007   000034 237000 15                 LDAQ    28
        14 001010   200056 757100                    STAQ    TAPE_NAME+7,,AUTO
        14 001011   000036 236000 15                 LDQ     30
        14 001012   200055 756100                    STQ     TAPE_NAME+6,,AUTO
        14 001013   200052 633500                    EPPR3   TAPE_NAME+3,,AUTO
        14 001014   200054 453500                    STP3    TAPE_NAME+5,,AUTO
        14 001015   200054 630500                    EPPR0   TAPE_NAME+5,,AUTO
        14 001016   000031 631400 15                 EPPR1   25
        14 001017   000000 701000 xent               TSX1    FLI$TAPE_OPEN
        14 001020   001175 702000 14                 TSX2    REPERRALT

      759    18082    5                 '0'B, '0'B, , A_FIT_, ERR, DCB# ) ALTRET(REPERRALT);
      760    18083    5               CALL FLI$TAPE_WRITE( BUF_, ARS, EOVOLUME, COMMAND ) ALTRET(JUSTALT);

  18083 14 001021   200003 630500                    EPPR0   @BUF_,,AUTO
        14 001022   000022 631400 xsym               EPPR1   B_VECTNIL+18
        14 001023   000000 701000 14                 TSX1    s:6
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:143  
        14 001024   001211 702000 14                 TSX2    JUSTALT

      761    18084    5               TAPE_OPEN.V.INITZ.SCRUB# = '0'B;

  18084 14 001025   000003 236000 15                 LDQ     3
        14 001026   000044 356000 xsym               ANSQ    TAPE_OPEN+36

      762    18085    5               TAPE_OPEN.V.OPER.MNTONLY# = '0'B;

  18085 14 001027   000027 236000 15                 LDQ     23
        14 001030   000044 356000 xsym               ANSQ    TAPE_OPEN+36

      763    18086    5               RETURN;

  18086 14 001031   200014 221300                    LDX1  ! BOVOLUME+1,,AUTO
        14 001032   000001 702211                    TSX2  ! 1,X1

      764    18087    5               END;
      765    18088
      766    18089    5             ELSE DO;                 /* Error writing other than first volume   */

      767    18090    5               OC_KEYIN.REPLY_ = VECTOR(NIL);

  18090 14 001033   000004 237000 15                 LDAQ    4
        14 001034   000160 757000 6                  STAQ    OC_KEYIN+4

      768    18091    5               OC_KEYIN.MESS_ = VECTOR(OPER_MESS6);

  18091 14 001035   000044 237000 15                 LDAQ    36
        14 001036   000156 757000 6                  STAQ    OC_KEYIN+2

      769    18092    5               OC_KEYIN.RESULTS_ = VECTOR(NIL);

  18092 14 001037   000004 237000 15                 LDAQ    4
        14 001040   000162 757000 6                  STAQ    OC_KEYIN+6

      770    18093    5               CALL M$KEYIN( OC_KEYIN ) ALTRET(REPALT);
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:144  

  18093 14 001041   000154 630400 6                  EPPR0   OC_KEYIN
        14 001042   520000 713400                    CLIMB   alt,+40960
        14 001043   401400 401760                    pmme    nvectors=4
        14 001044   001206 702000 14                 TSX2    REPALT

      771    18094    6               DO I=0 TO NBR_SNLISTS - 1;  /* Remove all volumes                 */

  18094 14 001045   200017 450100                    STZ     I,,AUTO
        14 001046   001063 710000 14                 TRA     s:18097+1

      772    18095    6                  TAPE_REMOVE.V.PSN# = TAPE_DCBLIST.DCB$(I)->F$DCB.PSN#;

  18095 14 001047   200017 235100                    LDA     I,,AUTO
        14 001050   000001 735000                    ALS     1
        14 001051   000000 470400 xsym               LDP0    TAPE_DCBLIST$
        14 001052   000001 471505                    LDP1    1,AL,PR0
        14 001053   040000 100500                    MLR     fill='040'O
        14 001054   100024 000006                    ADSC9   20,,PR1                  cn=0,n=6
        14 001055   000002 400006 xsym               ADSC9   TAPE_REMOVE+2            cn=2,n=6

      773    18096    6                  CALL M$REM( TAPE_REMOVE ) ALTRET(REPALT);

  18096 14 001056   000000 630400 xsym               EPPR0   TAPE_REMOVE
        14 001057   460006 713400                    CLIMB   alt,+24582
        14 001060   400000 401760                    pmme    nvectors=1
        14 001061   001206 702000 14                 TSX2    REPALT

      774    18097    6                  END;

  18097 14 001062   200017 054100                    AOS     I,,AUTO
        14 001063   200017 236100                    LDQ     I,,AUTO
        14 001064   000000 116000 xsym               CMPQ    NBR_SNLISTS
        14 001065   001047 604000 14                 TMI     s:18095

      775    18098
      776    18099    5               OC_KEYIN.MESS_ = VECTOR(OPER_MESS7);
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:145  

  18099 14 001066   000046 237000 15                 LDAQ    38
        14 001067   000156 757000 6                  STAQ    OC_KEYIN+2

      777    18100    5               CALL M$KEYIN( OC_KEYIN ) ALTRET(REPALT);

  18100 14 001070   000154 630400 6                  EPPR0   OC_KEYIN
        14 001071   520000 713400                    CLIMB   alt,+40960
        14 001072   401400 401760                    pmme    nvectors=4
        14 001073   001206 702000 14                 TSX2    REPALT

      778    18101    5               OC_KEYIN.MESS_ = VECTOR(OPER_MESS8);

  18101 14 001074   000050 237000 15                 LDAQ    40
        14 001075   000156 757000 6                  STAQ    OC_KEYIN+2

      779    18102    5               CALL M$KEYIN( OC_KEYIN ) ALTRET(REPALT);

  18102 14 001076   000154 630400 6                  EPPR0   OC_KEYIN
        14 001077   520000 713400                    CLIMB   alt,+40960
        14 001100   401400 401760                    pmme    nvectors=4
        14 001101   001206 702000 14                 TSX2    REPALT

      780    18103        /* Mount prev. vol., update EFT_CVOL_FILE */
      781    18104    6               DO I=0 TO NBR_SNLISTS -1;

  18104 14 001102   200017 450100                    STZ     I,,AUTO
        14 001103   001145 710000 14                 TRA     s:18113+1

      782    18105    6                  TAPE_OPEN_LAST.V.INITZ.SCRUB# = '1'B;

  18105 14 001104   400000 236007                    LDQ     -131072,DL
        14 001105   000366 256000 6                  ORSQ    TAPE_OPEN_LAST+36

      783    18106    6                  TAPE_OPEN_LAST.V.DCB# = TAPE_DCBLIST.DCB#(I);

  18106 14 001106   200017 235100                    LDA     I,,AUTO
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:146  
        14 001107   000001 735000                    ALS     1
        14 001110   000000 470400 xsym               LDP0    TAPE_DCBLIST$
        14 001111   000000 720105                    LXL0    0,AL,PR0
        14 001112   000366 740000 6                  STX0    TAPE_OPEN_LAST+36

      784    18107    6                  TAPE_OPEN_LAST.NAME_ = VECTOR(EFT_CVOL_FILE);

  18107 14 001113   000000 236000 xsym               LDQ     EFT_CVOL_FILE
        14 001114   000033 772000                    QRL     27
        14 001115   000001 621006                    EAX1    1,QL
        14 001116   000000 635011                    EAA     0,X1
        14 001117   000002 771000                    ARL     2
        14 001120   000140 135007                    SBLA    96,DL
        14 001121   000030 236000 15                 LDQ     24
        14 001122   000330 757000 6                  STAQ    TAPE_OPEN_LAST+6

      785    18108    6                  TAPE_OPEN_LAST.V.VOL# = VOL_SAVE - 1;

  18108 14 001123   200022 236100                    LDQ     VOL_SAVE,,AUTO
        14 001124   000001 136007                    SBLQ    1,DL
        14 001125   000033 736000                    QLS     27
        14 001126   000403 552040 6                  STBQ    TAPE_OPEN_LAST+49,'40'O

      786    18109    6                  TAPE_OPEN_LAST.SN_ = SNVECLIST.SN_(I);

  18109 14 001127   200017 236100                    LDQ     I,,AUTO
        14 001130   000001 736000                    QLS     1
        14 001131   000000 471400 xsym               LDP1    SNVECLIST$
        14 001132   100000 237106                    LDAQ    0,QL,PR1
        14 001133   000324 757000 6                  STAQ    TAPE_OPEN_LAST+2

      787    18110    6                  TAPE_OPEN_LAST.V.FUN# = %UPDATE#;

  18110 14 001134   001000 236007                    LDQ     512,DL
        14 001135   000367 552010 6                  STBQ    TAPE_OPEN_LAST+37,'10'O

      788    18111    6                  CALL M$OPEN( TAPE_OPEN_LAST ) ALTRET(REPALT);
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:147  

  18111 14 001136   000322 630400 6                  EPPR0   TAPE_OPEN_LAST
        14 001137   450000 713400                    CLIMB   alt,open
        14 001140   410400 401760                    pmme    nvectors=18
        14 001141   001206 702000 14                 TSX2    REPALT

      789    18112    6                  TAPE_OPEN_LAST.NAME_ = VECTOR(NIL);

  18112 14 001142   000004 237000 15                 LDAQ    4
        14 001143   000330 757000 6                  STAQ    TAPE_OPEN_LAST+6

      790    18113    6                  END;

  18113 14 001144   200017 054100                    AOS     I,,AUTO
        14 001145   200017 236100                    LDQ     I,,AUTO
        14 001146   000000 116000 xsym               CMPQ    NBR_SNLISTS
        14 001147   001104 604000 14                 TMI     s:18105

      791    18114
      792    18115    5               CALL FLI$TAPE_WRITE(BUF_, ARS, EOVOLUME, COMMAND ) ALTRET(JUSTALT);

  18115 14 001150   200003 630500                    EPPR0   @BUF_,,AUTO
        14 001151   000022 631400 xsym               EPPR1   B_VECTNIL+18
        14 001152   000000 701000 14                 TSX1    s:6
        14 001153   001211 702000 14                 TSX2    JUSTALT

      793    18116    5               IF NOT EOVOLUME             /* Remove in case EOVOLUME not rec'd  */

  18116 14 001154   200005 470500                    LDP0    @EOVOLUME,,AUTO
        14 001155   000000 234100                    SZN     0,,PR0
        14 001156   001162 604000 14                 TMI     s:18118

      794    18117    5                THEN CALL FLI$CHANGE_VOLUMES ALTRET(JUSTALT);

  18117 14 001157   000002 631400 xsym               EPPR1   B_VECTNIL+2
        14 001160   000000 701000 xent               TSX1    FLI$CHANGE_VOLUMES
        14 001161   001211 702000 14                 TSX2    JUSTALT
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:148  

      795    18118    5               CALL FLI$TAPE_WRITE(BUF_, ARS, EOVOLUME, COMMAND ) ALTRET(JUSTALT);

  18118 14 001162   200003 630500                    EPPR0   @BUF_,,AUTO
        14 001163   000022 631400 xsym               EPPR1   B_VECTNIL+18
        14 001164   000000 701000 14                 TSX1    s:6
        14 001165   001211 702000 14                 TSX2    JUSTALT

      796    18119    5               CALL FLI$TAPE_CLOSE ALTRET(JUSTALT); /* Close EFT_CVOL_FILE       */

  18119 14 001166   000002 631400 xsym               EPPR1   B_VECTNIL+2
        14 001167   000000 701000 xent               TSX1    FLI$TAPE_CLOSE
        14 001170   001211 702000 14                 TSX2    JUSTALT

      797    18120    5               NBR_FILE_BLOCKS = %MAX_NBR_FILE_BLOCKS + 1; /* Force new block    */

  18120 14 001171   000063 235007                    LDA     51,DL
        14 001172   000000 755000 xsym               STA     NBR_FILE_BLOCKS

      798    18121    5               RETURN;

  18121 14 001173   200014 221300                    LDX1  ! BOVOLUME+1,,AUTO
        14 001174   000001 702211                    TSX2  ! 1,X1

      799    18122    5               END;
      800    18123    4            END;
      801    18124
      802    18125    3         END;
      803    18126
      804    18127    2   REPERRALT: ;

  18127 14 001175                       REPERRALT    null
      805    18128    2      CALL FLI$RPT_ERR( ERR, DCB# );

  18128 14 001175   200015 630500                    EPPR0   DCB#,,AUTO
        14 001176   200053 450500                    STP0    TAPE_NAME+4,,AUTO
        14 001177   200026 631500                    EPPR1   ERR,,AUTO
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:149  
        14 001200   200052 451500                    STP1    TAPE_NAME+3,,AUTO
        14 001201   200052 630500                    EPPR0   TAPE_NAME+3,,AUTO
        14 001202   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 001203   000000 701000 xent               TSX1    FLI$RPT_ERR
        14 001204   000000 011000                    NOP     0

      806    18129    2      GOTO JUSTALT;

  18129 14 001205   001211 710000 14                 TRA     JUSTALT

  18127 14 001206                       REPALT       null
      807    18130
      808    18131    2   REPALT: ;
      809    18132    2      CALL FLI$RPT_ERR;

  18132 14 001206   000002 631400 xsym               EPPR1   B_VECTNIL+2
        14 001207   000000 701000 xent               TSX1    FLI$RPT_ERR
        14 001210   000000 011000                    NOP     0

  18127 14 001211                       JUSTALT      null
      810    18133
      811    18134    2   JUSTALT: ;
      812    18135    2      TAPE_CLOSE.V.TRUNCATE# = '0'B;

  18135 14 001211   000027 236000 15                 LDQ     23
        14 001212   000032 356000 xsym               ANSQ    TAPE_CLOSE+26

      813    18136    2      TAPE_CLOSE.V.POS# = 0;

  18136 14 001213   000000 236003                    LDQ     0,DU
        14 001214   000034 552040 xsym               STBQ    TAPE_CLOSE+28,'40'O

      814    18137    2      TAPE_OPEN.V.OPER.MNTONLY# = '0'B;

  18137 14 001215   000027 236000 15                 LDQ     23
        14 001216   000044 356000 xsym               ANSQ    TAPE_OPEN+36

PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:150  
      815    18138    2      TAPE_OPEN.V.INITZ.SCRUB# = '0'B;

  18138 14 001217   000003 236000 15                 LDQ     3
        14 001220   000044 356000 xsym               ANSQ    TAPE_OPEN+36

      816    18139    2      CALL FLI$TAPE_CLOSE

  18139 14 001221   000002 631400 xsym               EPPR1   B_VECTNIL+2
        14 001222   000000 701000 xent               TSX1    FLI$TAPE_CLOSE
        14 001223   001225 702000 14                 TSX2    s:18141
        14 001224   001230 710000 14                 TRA     s:18143

      817    18140    3       WHENALTRETURN DO;

      818    18141    3         CALL FLI$RPT_ERR;

  18141 14 001225   000002 631400 xsym               EPPR1   B_VECTNIL+2
        14 001226   000000 701000 xent               TSX1    FLI$RPT_ERR
        14 001227   000000 011000                    NOP     0

      819    18142    3         END;

      820    18143    2      ALTRETURN;

  18143 14 001230   200014 221300                    LDX1  ! BOVOLUME+1,,AUTO
        14 001231   000000 702211                    TSX2  ! 0,X1

      821    18144
      822    18145        %EJECT;
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:151  
      823    18146    2   FLI_UPDATE_FITS: PROC( BLK_ );

  18146 14 001232   200030 741300       FLI_UPDATE_* STX1  ! ERR+2,,AUTO

      824    18147        /*F* NAME: FLI_MODIFY_FITS
      825    18148             PURPOSE: Update tape and disk fits for files contained within a block.
      826    18149        */
      827    18150
      828    18151    3   DCL 1 BLK_ DALIGNED,                    /* Vector framing block               */
      829    18152    3         2 * BIT(36),
      830    18153    3         2 PTR$ PTR;
      831    18154
      832    18155    3   DCL BLK_TAG0T$ PTR AUTO;
      833    18156    3   DCL 1 BLK_TAG0 BASED(BLK_TAG0T$),
      834    18157           %BLOCK_TAG;
      835    18162    3   DCL BLK_TAGT$ PTR AUTO;
      836    18163    3   DCL 1 BLK_TAG BASED(BLK_TAGT$),
      837    18164           %BLOCK_TAG;
      838    18169    3   DCL BLK_GRAN_BASE$ PTR AUTO;            /* Block's granule base               */
      839    18170    3   DCL IN_GRAN$ PTR AUTO;
      840    18171    3   DCL CODE$ PTR AUTO;
      841    18172    3   DCL M$DISK_IN$ PTR AUTO;
      842    18173    3   DCL 1 DISK_FIT_ DALIGNED AUTO,
      843    18174    3         2 BOUND UBIN(20) UNAL,
      844    18175    3         2 * BIT(16) UNAL,
      845    18176    3         2 PTR$ PTR;
      846    18177    3   DCL 1 MODIFIED_FIT_ DALIGNED AUTO,
      847    18178    3         2 BOUND UBIN(20) UNAL,
      848    18179    3         2 * BIT(16) UNAL,
      849    18180    3         2 PTR$ PTR;
      850    18181        %CODE05( BASED = "BASED(CODE$)" );
      851    18184        %CODE06( BASED = "BASED(CODE$)" );
      852    18188        %FM$GRAN;
      853    18192        %VLP_NAME( FPTN=ACCT_NAME,
      854    18193                   LEN=8,
      855    18194                   STCLASS=AUTO);
      856    18221        %VLP_NAME( FPTN=TAPE_NAME,
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:152  
      857    18222                   LEN=6,
      858    18223                   STCLASS=AUTO);
      859    18250
      860    18251        /****************************************/
      861    18252
      862    18253    3      M$DISK_IN$ = DCBADDR(DCBNUM(M$DISK_IN) );

  18253 14 001233   000000 236007 xsym               LDQ     M$DISK_IN,DL
        14 001234   000000 470400 15                 LDP0    0
        14 001235   000000 471500                    LDP1    0,,PR0
        14 001236   100000 236106                    LDQ     0,QL,PR1
        14 001237   200037 756100                    STQ     M$DISK_IN$,,AUTO

      863    18254    3      BLK_TAG0T$ = PINCRW( BLK_.PTR$, BLK_.PTR$->BLK_TAG.NBR * SIZEW(BLK_TAG));

  18254 14 001240   200031 473500                    LDP3    @BLK_,,AUTO
        14 001241   300001 474500                    LDP4    1,,PR3
        14 001242   400000 236100                    LDQ     0,,PR4
        14 001243   000011 772000                    QRL     9
        14 001244   000777 376007                    ANQ     511,DL
        14 001245   000013 402007                    MPY     11,DL
        14 001246   400000 635506                    EPPR5   0,QL,PR4
        14 001247   200032 455500                    STP5    BLK_TAG0T$,,AUTO

      864    18255    3      BLK_TAGT$ = PINCRW( BLK_TAG0T$, -SIZEW(BLK_TAG ));

  18255 14 001250   200032 236100                    LDQ     BLK_TAG0T$,,AUTO
        14 001251   777765 036003                    ADLQ    -11,DU
        14 001252   200033 756100                    STQ     BLK_TAGT$,,AUTO

      865    18256    3      BLK_GRAN_BASE$ = PINCRW(BLK_TAG0T$, SIZEW(BLK_TAG0) );

  18256 14 001253   200032 236100                    LDQ     BLK_TAG0T$,,AUTO
        14 001254   000013 036003                    ADLQ    11,DU
        14 001255   200034 756100                    STQ     BLK_GRAN_BASE$,,AUTO

      866    18257    4      DO WHILE( BLK_TAGT$ >= BLK_.PTR$ );
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:153  

  18257 14 001256   200033 236100                    LDQ     BLK_TAGT$,,AUTO
        14 001257   300001 116100                    CMPQ    1,,PR3
        14 001260   001661 602000 14                 TNC     s:18351

      867    18258    5         DO CASE( BLK_TAG.TYPE );

  18258 14 001261   200033 470500                    LDP0    BLK_TAGT$,,AUTO
        14 001262   000000 720100                    LXL0    0,,PR0
        14 001263   000077 360003                    ANX0    63,DU
        14 001264   000012 100003                    CMPX0   10,DU
        14 001265   001267 602010 14                 TNC     s:18258+6,X0
        14 001266   001653 710000 14                 TRA     s:18349
        14 001267   001301 710000 14                 TRA     s:18260
        14 001270   001653 710000 14                 TRA     s:18349
        14 001271   001653 710000 14                 TRA     s:18349
        14 001272   001301 710000 14                 TRA     s:18260
        14 001273   001653 710000 14                 TRA     s:18349
        14 001274   001653 710000 14                 TRA     s:18349
        14 001275   001653 710000 14                 TRA     s:18349
        14 001276   001653 710000 14                 TRA     s:18349
        14 001277   001653 710000 14                 TRA     s:18349
        14 001300   001301 710000 14                 TRA     s:18260

      868    18259    5          CASE( %REG_FILE, %ACUP_FILE, %IDS_FAST_FILE );

      869    18260    5            IF BLK_TAG.BEG                 /* File begin in this block?          */

  18260 14 001301   000000 236100                    LDQ     0,,PR0
        14 001302   000400 316007                    CANQ    256,DL
        14 001303   001652 600000 14                 TZE     s:18344

      870    18261    6             THEN DO;

      871    18262        /***
      872    18263         *** Update block fit
      873    18264         ***/
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:154  
      874    18265    6               IN_GRAN$ = PINCRC( BLK_GRAN_BASE$, BLK_TAG.BEGX );

  18265 14 001304   000000 236100                    LDQ     0,,PR0
        14 001305   000022 772000                    QRL     18
        14 001306   000020 736000                    QLS     16
        14 001307   200034 036100                    ADLQ    BLK_GRAN_BASE$,,AUTO
        14 001310   200035 756100                    STQ     IN_GRAN$,,AUTO

      875    18266    6               CODE$ = PINCRW( IN_GRAN$, SIZEW(FM$GRAN) );

  18266 14 001311   000005 036003                    ADLQ    5,DU
        14 001312   200036 756100                    STQ     CODE$,,AUTO

      876    18267    6               IF (BLK_TAG.TYPE = %REG_FILE /* BACKUP or SAVE in progress?       */

  18267 14 001313   000000 236100                    LDQ     0,,PR0
        14 001314   000077 316007                    CANQ    63,DL
        14 001315   001346 601000 14                 TNZ     s:18277
        14 001316   200006 471500                    LDP1    @COMMAND,,AUTO
        14 001317   100000 235100                    LDA     0,,PR1
        14 001320   000010 115007                    CMPA    8,DL
        14 001321   001324 600000 14                 TZE     s:18270
        14 001322   000006 115007                    CMPA    6,DL
        14 001323   001346 601000 14                 TNZ     s:18277

      877    18268    6                 AND (COMMAND = %BACKUP OR COMMAND = %SAVE))
      878    18269    7                THEN DO;

      879    18270    7                  CALL XSF$LOCCODP( CODE$, 05 )

  18270 14 001324   000052 236000 15                 LDQ     42
        14 001325   200053 756100                    STQ     TAPE_NAME+4,,AUTO
        14 001326   200036 633500                    EPPR3   CODE$,,AUTO
        14 001327   200052 453500                    STP3    TAPE_NAME+3,,AUTO
        14 001330   200052 630500                    EPPR0   TAPE_NAME+3,,AUTO
        14 001331   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 001332   000000 701000 xent               TSX1    XSF$LOCCODP
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:155  
        14 001333   001345 702000 14                 TSX2    s:18275

      880    18271    8                   WHENRETURN DO;

      881    18272    8                     CODE05.BACKUP.REEL = TAPE_SN;

  18272 14 001334   200036 470500                    LDP0    CODE$,,AUTO
        14 001335   040100 100400                    MLR     fill='040'O
        14 001336   000000 000006 xsym               ADSC9   TAPE_SN                  cn=0,n=6
        14 001337   000001 000006                    ADSC9   1,,PR0                   cn=0,n=6

      882    18273    8                     CODE05.BACKUP.EFT.FSN = TAPE_FSN;

  18273 14 001340   200036 470500                    LDP0    CODE$,,AUTO
        14 001341   000000 236000 xsym               LDQ     TAPE_FSN
        14 001342   000002 676100                    ERQ     2,,PR0
        14 001343   037777 376007                    ANQ     16383,DL
        14 001344   000002 656100                    ERSQ    2,,PR0

      883    18274    8                     END;

      884    18275    7                  END;

  18275 14 001345   001405 710000 14                 TRA     s:18292

      885    18276    7                ELSE DO;

      886    18277    7                  IF (COMMAND = %ARCHIVE_CMD) /* Archiving or COMPACTing?        */

  18277 14 001346   200006 471500                    LDP1    @COMMAND,,AUTO
        14 001347   100000 235100                    LDA     0,,PR1
        14 001350   000027 115007                    CMPA    23,DL
        14 001351   001361 600000 14                 TZE     s:18281
        14 001352   000003 115007                    CMPA    3,DL
        14 001353   001361 600000 14                 TZE     s:18281
        14 001354   000030 115007                    CMPA    24,DL
        14 001355   001405 601000 14                 TNZ     s:18292
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:156  
        14 001356   000000 236000 xsym               LDQ     ARCHIVE$
        14 001357   000001 116000 xsym               CMPQ    B_VECTNIL+1
        14 001360   001405 600000 14                 TZE     s:18292

      887    18278    7                    OR (COMMAND = %COMPACT)
      888    18279    7                    OR (COMMAND = %PURGE AND ARCHIVE$ ~=ADDR(NIL))
      889    18280    8                   THEN DO;

      890    18281    8                     CALL XSF$LOCCODP( CODE$, 06 )

  18281 14 001361   000053 236000 15                 LDQ     43
        14 001362   200053 756100                    STQ     TAPE_NAME+4,,AUTO
        14 001363   200036 633500                    EPPR3   CODE$,,AUTO
        14 001364   200052 453500                    STP3    TAPE_NAME+3,,AUTO
        14 001365   200052 630500                    EPPR0   TAPE_NAME+3,,AUTO
        14 001366   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 001367   000000 701000 xent               TSX1    XSF$LOCCODP
        14 001370   001405 702000 14                 TSX2    s:18292

      891    18282    9                      WHENRETURN DO;

      892    18283    9                        CODE06.STOW.REEL = TAPE_SN;

  18283 14 001371   200036 470500                    LDP0    CODE$,,AUTO
        14 001372   040100 100400                    MLR     fill='040'O
        14 001373   000000 000006 xsym               ADSC9   TAPE_SN                  cn=0,n=6
        14 001374   000001 000006                    ADSC9   1,,PR0                   cn=0,n=6

      893    18284    9                        CODE06.STOW.EFT.FSN = TAPE_FSN;

  18284 14 001375   200036 470500                    LDP0    CODE$,,AUTO
        14 001376   000000 236000 xsym               LDQ     TAPE_FSN
        14 001377   000002 676100                    ERQ     2,,PR0
        14 001400   037777 376007                    ANQ     16383,DL
        14 001401   000002 656100                    ERSQ    2,,PR0

      894    18285    9                        CODE06.STOW.EFT.CROSS = '0'B;
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:157  

  18285 14 001402   200036 470500                    LDP0    CODE$,,AUTO
        14 001403   000003 236000 15                 LDQ     3
        14 001404   000002 356100                    ANSQ    2,,PR0

      895    18286    9                        END;

      896    18287    8                     END;

      897    18288    7                  END;

      898    18289        /***
      899    18290         *** Update disk fit
      900    18291         ***/
      901    18292    6               CALL FLI$ALLOC_BUF( DISK_FIT_, 1 );

  18292 14 001405   000054 236000 15                 LDQ     44
        14 001406   200053 756100                    STQ     TAPE_NAME+4,,AUTO
        14 001407   200040 630500                    EPPR0   DISK_FIT_,,AUTO
        14 001410   200052 450500                    STP0    TAPE_NAME+3,,AUTO
        14 001411   200052 630500                    EPPR0   TAPE_NAME+3,,AUTO
        14 001412   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 001413   000000 701000 xent               TSX1    FLI$ALLOC_BUF
        14 001414   000000 011000                    NOP     0

      902    18293    6               OPEN_BLOCK_FILE.FPARAM_ = DISK_FIT_;

  18293 14 001415   200040 237100                    LDAQ    DISK_FIT_,,AUTO
        14 001416   000046 757000 6                  STAQ    OPEN_BLOCK_FILE+24

      903    18294    6               FROM_DISK_SN.SN#(0) = BLK_TAG0.WHERE.PSN;

  18294 14 001417   200032 470500                    LDP0    BLK_TAG0T$,,AUTO
        14 001420   040000 100500                    MLR     fill='040'O
        14 001421   000003 000006                    ADSC9   3,,PR0                   cn=0,n=6
        14 001422   000001 000006 xsym               ADSC9   FROM_DISK_SN+1           cn=0,n=6

PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:158  
      904    18295    6               FROM_DISK_ACCT.ACCT# = BLK_TAG0.WHERE.ACCT;

  18295 14 001423   040000 100500                    MLR     fill='040'O
        14 001424   000004 400010                    ADSC9   4,,PR0                   cn=2,n=8
        14 001425   000000 000010 xsym               ADSC9   FROM_DISK_ACCT           cn=0,n=8

      905    18296    6               FROM_DISK_NAME = BLK_TAG.NAME;

  18296 14 001426   200033 471500                    LDP1    BLK_TAGT$,,AUTO
        14 001427   000000 100500                    MLR     fill='000'O
        14 001430   100003 000040                    ADSC9   3,,PR1                   cn=0,n=32
        14 001431   000000 000040 xsym               ADSC9   FROM_DISK_NAME           cn=0,n=32

      906    18297    6               CALL M$OPEN( OPEN_BLOCK_FILE )

  18297 14 001432   000016 630400 6                  EPPR0   OPEN_BLOCK_FILE
        14 001433   450000 713400                    CLIMB   alt,open
        14 001434   410400 401760                    pmme    nvectors=18
        14 001435   001572 702000 14                 TSX2    s:18334

      907    18298    7                WHENRETURN DO;

      908    18299    7                  MODIFIED_FIT_ = DISK_FIT_;

  18299 14 001436   200040 237100                    LDAQ    DISK_FIT_,,AUTO
        14 001437   200042 757100                    STAQ    MODIFIED_FIT_,,AUTO

      909    18300    7                  CODE$ = PINCRW( MODIFIED_FIT_.PTR$, SIZEW(FM$GRAN) );

  18300 14 001440   200043 236100                    LDQ     MODIFIED_FIT_+1,,AUTO
        14 001441   000005 036003                    ADLQ    5,DU
        14 001442   200036 756100                    STQ     CODE$,,AUTO

      910    18301    7                  IF (BLK_TAG.TYPE = %REG_FILE /* BACKUP or SAVE in progress?    */

  18301 14 001443   200033 470500                    LDP0    BLK_TAGT$,,AUTO
        14 001444   000000 236100                    LDQ     0,,PR0
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:159  
        14 001445   000077 316007                    CANQ    63,DL
        14 001446   001502 601000 14                 TNZ     s:18312
        14 001447   200006 471500                    LDP1    @COMMAND,,AUTO
        14 001450   100000 235100                    LDA     0,,PR1
        14 001451   000006 115007                    CMPA    6,DL
        14 001452   001455 600000 14                 TZE     s:18304
        14 001453   000010 115007                    CMPA    8,DL
        14 001454   001502 601000 14                 TNZ     s:18312

      911    18302    7                    AND (COMMAND = %SAVE OR COMMAND = %BACKUP))
      912    18303    8                   THEN DO;

      913    18304    8                     CALL XSF$LOCCODP( CODE$, 05 )

  18304 14 001455   000052 236000 15                 LDQ     42
        14 001456   200053 756100                    STQ     TAPE_NAME+4,,AUTO
        14 001457   200036 633500                    EPPR3   CODE$,,AUTO
        14 001460   200052 453500                    STP3    TAPE_NAME+3,,AUTO
        14 001461   200052 630500                    EPPR0   TAPE_NAME+3,,AUTO
        14 001462   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 001463   000000 701000 xent               TSX1    XSF$LOCCODP
        14 001464   001501 702000 14                 TSX2    s:18310

      914    18305    9                      WHENRETURN DO;

      915    18306    9                        CODE05.BACKUP.REEL = TAPE_SN;

  18306 14 001465   200036 470500                    LDP0    CODE$,,AUTO
        14 001466   040100 100400                    MLR     fill='040'O
        14 001467   000000 000006 xsym               ADSC9   TAPE_SN                  cn=0,n=6
        14 001470   000001 000006                    ADSC9   1,,PR0                   cn=0,n=6

      916    18307    9                        CODE05.BACKUP.EFT.FSN = TAPE_FSN;

  18307 14 001471   200036 470500                    LDP0    CODE$,,AUTO
        14 001472   000000 236000 xsym               LDQ     TAPE_FSN
        14 001473   000002 676100                    ERQ     2,,PR0
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:160  
        14 001474   037777 376007                    ANQ     16383,DL
        14 001475   000002 656100                    ERSQ    2,,PR0

      917    18308    9                        CODE05.BACKUP.EFT.CROSS = '0'B;

  18308 14 001476   200036 470500                    LDP0    CODE$,,AUTO
        14 001477   000003 236000 15                 LDQ     3
        14 001500   000002 356100                    ANSQ    2,,PR0

      918    18309    9                        END;

      919    18310    8                     END;

  18310 14 001501   001541 710000 14                 TRA     s:18324

      920    18311    8                   ELSE DO;

      921    18312    8                     IF (COMMAND = %ARCHIVE_CMD) /* Archiving or COMPACTing?     */

  18312 14 001502   200006 471500                    LDP1    @COMMAND,,AUTO
        14 001503   100000 235100                    LDA     0,,PR1
        14 001504   000027 115007                    CMPA    23,DL
        14 001505   001515 600000 14                 TZE     s:18316
        14 001506   000003 115007                    CMPA    3,DL
        14 001507   001515 600000 14                 TZE     s:18316
        14 001510   000030 115007                    CMPA    24,DL
        14 001511   001541 601000 14                 TNZ     s:18324
        14 001512   000000 236000 xsym               LDQ     ARCHIVE$
        14 001513   000001 116000 xsym               CMPQ    B_VECTNIL+1
        14 001514   001541 600000 14                 TZE     s:18324

      922    18313    8                       OR (COMMAND = %COMPACT)
      923    18314    8                       OR (COMMAND = %PURGE AND ARCHIVE$ ~= ADDR(NIL))
      924    18315    9                      THEN DO;

      925    18316    9                        CALL XSF$LOCCODP( CODE$, 06 )

PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:161  
  18316 14 001515   000053 236000 15                 LDQ     43
        14 001516   200053 756100                    STQ     TAPE_NAME+4,,AUTO
        14 001517   200036 633500                    EPPR3   CODE$,,AUTO
        14 001520   200052 453500                    STP3    TAPE_NAME+3,,AUTO
        14 001521   200052 630500                    EPPR0   TAPE_NAME+3,,AUTO
        14 001522   000020 631400 xsym               EPPR1   B_VECTNIL+16
        14 001523   000000 701000 xent               TSX1    XSF$LOCCODP
        14 001524   001541 702000 14                 TSX2    s:18324

      926    18317   10                         WHENRETURN DO;

      927    18318   10                           CODE06.STOW.REEL = TAPE_SN;

  18318 14 001525   200036 470500                    LDP0    CODE$,,AUTO
        14 001526   040100 100400                    MLR     fill='040'O
        14 001527   000000 000006 xsym               ADSC9   TAPE_SN                  cn=0,n=6
        14 001530   000001 000006                    ADSC9   1,,PR0                   cn=0,n=6

      928    18319   10                           CODE06.STOW.EFT.FSN = TAPE_FSN;

  18319 14 001531   200036 470500                    LDP0    CODE$,,AUTO
        14 001532   000000 236000 xsym               LDQ     TAPE_FSN
        14 001533   000002 676100                    ERQ     2,,PR0
        14 001534   037777 376007                    ANQ     16383,DL
        14 001535   000002 656100                    ERSQ    2,,PR0

      929    18320   10                           CODE06.STOW.EFT.CROSS = '0'B;

  18320 14 001536   200036 470500                    LDP0    CODE$,,AUTO
        14 001537   000003 236000 15                 LDQ     3
        14 001540   000002 356100                    ANSQ    2,,PR0

      930    18321   10                           END;

      931    18322    9                        END;

      932    18323    8                     END;
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:162  

      933    18324    7                  MODIFIED_FIT_.PTR$ = PINCRW( MODIFIED_FIT_.PTR$, SIZEW(FM$GRAN));

  18324 14 001541   200043 236100                    LDQ     MODIFIED_FIT_+1,,AUTO
        14 001542   000005 036003                    ADLQ    5,DU
        14 001543   200043 756100                    STQ     MODIFIED_FIT_+1,,AUTO

      934    18325    7                  MODIFIED_FIT_.BOUND = MODIFIED_FIT_.BOUND - SIZEC(FM$GRAN);

  18325 14 001544   200042 236100                    LDQ     MODIFIED_FIT_,,AUTO
        14 001545   000020 772000                    QRL     16
        14 001546   000024 136007                    SBLQ    20,DL
        14 001547   000020 736000                    QLS     16
        14 001550   200042 676100                    ERQ     MODIFIED_FIT_,,AUTO
        14 001551   000034 376000 xsym               ANQ     B_VECTNIL+28
        14 001552   200042 656100                    ERSQ    MODIFIED_FIT_,,AUTO

      935    18326    7                  CLOSE_BLOCK_FILE.IFPARAM_ = MODIFIED_FIT_;

  18326 14 001553   200042 237100                    LDAQ    MODIFIED_FIT_,,AUTO
        14 001554   000136 757000 6                  STAQ    CLOSE_BLOCK_FILE+22

      936    18327    7                  CLOSE_BLOCK_FILE.V.DESC = M$DISK_IN$->F$DCB.DESC;

  18327 14 001555   200037 470500                    LDP0    M$DISK_IN$,,AUTO
        14 001556   000005 720100                    LXL0    5,,PR0
        14 001557   000143 740000 6                  STX0    CLOSE_BLOCK_FILE+27

      937    18328    7                  CLOSE_BLOCK_FILE.V.EFTOPER.UPDDESC# = %YES#;

  18328 14 001560   004000 236007                    LDQ     2048,DL
        14 001561   000142 256000 6                  ORSQ    CLOSE_BLOCK_FILE+26

      938    18329    7                  CALL M$CLOSE( CLOSE_BLOCK_FILE );

  18329 14 001562   000110 630400 6                  EPPR0   CLOSE_BLOCK_FILE
        14 001563   050001 713400                    CLIMB   close
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:163  
        14 001564   406000 401760                    pmme    nvectors=13

      939    18330    7                  CLOSE_BLOCK_FILE.IFPARAM_ = VECTOR(NIL);

  18330 14 001565   000004 237000 15                 LDAQ    4
        14 001566   000136 757000 6                  STAQ    CLOSE_BLOCK_FILE+22

      940    18331    7                  CLOSE_BLOCK_FILE.V.EFTOPER = '0'B;

  18331 14 001567   000055 236000 15                 LDQ     45
        14 001570   000142 356000 6                  ANSQ    CLOSE_BLOCK_FILE+26

      941    18332    7                  END;

  18332 14 001571   001575 710000 14                 TRA     s:18337

      942    18333    7                WHENALTRETURN DO;

      943    18334    7                  CALL FLI$RPT_ERR;

  18334 14 001572   000002 631400 xsym               EPPR1   B_VECTNIL+2
        14 001573   000000 701000 xent               TSX1    FLI$RPT_ERR
        14 001574   000000 011000                    NOP     0

      944    18335    7                  END;

      945    18336
      946    18337    6               TAPE_NAME.L# = LENGTHC(TAPE_NAME.NAME#);

  18337 14 001575   006000 236003                    LDQ     3072,DU
        14 001576   200047 552140                    STBQ    TAPE_NAME,'40'O,AUTO

      947    18338    6               TAPE_NAME.NAME# = TAPE_SN;

  18338 14 001577   040100 100400                    MLR     fill='040'O
        14 001600   000000 000006 xsym               ADSC9   TAPE_SN                  cn=0,n=6
        14 001601   200047 200006                    ADSC9   TAPE_NAME,,AUTO          cn=1,n=6
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:164  

      948    18339    6               ACCT_NAME.L# = LENGTHC(ACCT_NAME.NAME#);

  18339 14 001602   010000 236003                    LDQ     4096,DU
        14 001603   200044 552140                    STBQ    ACCT_NAME,'40'O,AUTO

      949    18340    6               ACCT_NAME.NAME# = BLK_TAG0.WHERE.ACCT;

  18340 14 001604   200032 470500                    LDP0    BLK_TAG0T$,,AUTO
        14 001605   040100 100500                    MLR     fill='040'O
        14 001606   000004 400010                    ADSC9   4,,PR0                   cn=2,n=8
        14 001607   200044 200010                    ADSC9   ACCT_NAME,,AUTO          cn=1,n=8

      950    18341    6               CALL FLI$RPT_ERR( E_FILE_REWRITTEN, ,VECTOR(BLK_TAG.NAME),VECTOR(
             18341                        ACCT_NAME),VECTOR(TAPE_NAME));

  18341 14 001610   000056 235000 15                 LDA     46
        14 001611   200033 236100                    LDQ     BLK_TAGT$,,AUTO
        14 001612   000003 036003                    ADLQ    3,DU
        14 001613   200052 757100                    STAQ    TAPE_NAME+3,,AUTO
        14 001614   000057 235000 15                 LDA     47
        14 001615   200054 452500                    STP2    TAPE_NAME+5,,AUTO
        14 001616   200054 236100                    LDQ     TAPE_NAME+5,,AUTO
        14 001617   000044 036003                    ADLQ    36,DU
        14 001620   200056 757100                    STAQ    TAPE_NAME+7,,AUTO
        14 001621   000060 235000 15                 LDA     48
        14 001622   200060 452500                    STP2    TAPE_NAME+9,,AUTO
        14 001623   200060 236100                    LDQ     TAPE_NAME+9,,AUTO
        14 001624   000047 036003                    ADLQ    39,DU
        14 001625   200064 757100                    STAQ    TAPE_NAME+13,,AUTO
        14 001626   200052 237100                    LDAQ    TAPE_NAME+3,,AUTO
        14 001627   200062 757100                    STAQ    TAPE_NAME+11,,AUTO
        14 001630   200056 237100                    LDAQ    TAPE_NAME+7,,AUTO
        14 001631   200066 757100                    STAQ    TAPE_NAME+15,,AUTO
        14 001632   200064 237100                    LDAQ    TAPE_NAME+13,,AUTO
        14 001633   200070 757100                    STAQ    TAPE_NAME+17,,AUTO
        14 001634   200070 631500                    EPPR1   TAPE_NAME+17,,AUTO
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:165  
        14 001635   200076 451500                    STP1    TAPE_NAME+23,,AUTO
        14 001636   200066 633500                    EPPR3   TAPE_NAME+15,,AUTO
        14 001637   200075 453500                    STP3    TAPE_NAME+22,,AUTO
        14 001640   200062 634500                    EPPR4   TAPE_NAME+11,,AUTO
        14 001641   200074 454500                    STP4    TAPE_NAME+21,,AUTO
        14 001642   000001 236000 xsym               LDQ     B_VECTNIL+1
        14 001643   000061 235000 15                 LDA     49
        14 001644   200072 757100                    STAQ    TAPE_NAME+19,,AUTO
        14 001645   200072 630500                    EPPR0   TAPE_NAME+19,,AUTO
        14 001646   000023 631400 xsym               EPPR1   B_VECTNIL+19
        14 001647   000000 701000 xent               TSX1    FLI$RPT_ERR
        14 001650   000000 011000                    NOP     0

      951    18342    6               END;

  18342 14 001651   001653 710000 14                 TRA     s:18349

      952    18343    6             ELSE DO;

      953    18344    6               END;

  18344 14 001652   001653 710000 14                 TRA     s:18349

      954    18345
      955    18346    5          CASE( ELSE );

      956    18347
      957    18348    5          END;

      958    18349    4         BLK_TAGT$ = PINCRW( BLK_TAGT$, -SIZEW(BLK_TAG) );

  18349 14 001653   200033 236100                    LDQ     BLK_TAGT$,,AUTO
        14 001654   777765 036003                    ADLQ    -11,DU
        14 001655   200033 756100                    STQ     BLK_TAGT$,,AUTO

      959    18350    4         END;

PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:166  
  18350 14 001656   200031 470500                    LDP0    @BLK_,,AUTO
        14 001657   000001 116100                    CMPQ    1,,PR0
        14 001660   001261 603000 14                 TRC     s:18258

      960    18351    3      RETURN;

  18351 14 001661   200030 221300                    LDX1  ! ERR+2,,AUTO
        14 001662   000001 702211                    TSX2  ! 1,X1
      961    18352
      962    18353    3   END FLI_UPDATE_FITS;
      963    18354    2   END FLI_TAPE_WRITE_RETRY;
      964    18355    1   END FLI$TAPE_WRITE;
      965    18356        %EOD;

PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:167  
--  Include file information  --

   FM$GRAN.:E05TOU  is referenced.
   B_ERRORS_C.:E05TOU  is referenced.
   B_MICROPS_C.:E05TOU  is referenced.
   FLB_SUBS_C.:E05TOU  is referenced.
   FLI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FM$FIT.:E05TOU  is referenced.
   FLN_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FLS_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FL_PERR_C.:E05TOU  is referenced.
   FLE_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FLI$TAPE_WRITE.
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:168  

 **** Variables and constants ****

  ****  Section 006  Data  FLI$TAPE_WRITE

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

   315-0-0/c CHAR(8)     r     1 ANSWER                   110-0-0/d STRC(1080)  r     1 CLOSE_BLOCK_FILE
     4-0-0/d STRC(360)   r     1 DEL_NODATA_REC           154-0-0/d STRC(504)   r     1 OC_KEYIN
    16-0-0/d STRC(2088)  r     1 OPEN_BLOCK_FILE          172-0-0/c STRC(522)   r     1 OPER_MESS1
   211-0-0/c STRC(477)   r     1 OPER_MESS2               227-0-0/c STRC(522)   r     1 OPER_MESS4
   246-0-0/c STRC(108)   r     1 OPER_MESS5               251-0-0/c STRC(378)   r     1 OPER_MESS6
   264-0-0/c STRC(441)   r     1 OPER_MESS7               301-0-0/c STRC(414)   r     1 OPER_MESS8
   322-0-0/d STRC(2088)  r     1 TAPE_OPEN_LAST           414-0-0/d STRC(144)   r     1 TAPE_PFIL
   317-0-0/w STRC(72)    r     1 TYC_ARS

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @ARS                      31-0-0/w PTR         r     1 @BLK_
     3-0-0/w PTR         r     1 @BUF_                      6-0-0/w PTR         r     1 @COMMAND
     5-0-0/w PTR         r     1 @EOVOLUME                 10-0-0/w PTR         r     1 @NEW_FSN
     7-0-0/w PTR         r     1 @NEW_TSN                  44-0-0/c STRC(81)    r     1 ACCT_NAME
    *0-0-0/w SBIN        r     1 ARS                       *0-0-0/d STRC(72)    r     1 BLK_
    34-0-0/w PTR         r     1 BLK_GRAN_BASE$            32-0-0/w PTR         r     1 BLK_TAG0T$
    23-0-0/w PTR         r     1 BLK_TAGT$                 33-0-0/w PTR         r     1 BLK_TAGT$
    13-0-0/b BIT         r     1 BOVOLUME                  *0-0-0/d BIT (72)    r     1 BUF_
    12-0-0/w SBIN        r     1 CODE                      36-0-0/w PTR         r     1 CODE$
    *0-0-0/w SBIN        r     1 COMMAND                   15-0-0/w SBIN        r     1 DCB#
    16-0-0/w PTR         r     1 DCB$                      40-0-0/d STRC(72)    r     1 DISK_FIT_
    *0-0-0/w BIT         r     1 EOVOLUME                  26-0-0/w STRC        r     1 ERR
    21-0-0/w UBIN        r     1 FSN_SAVE                  17-0-0/w SBIN        r     1 I
    35-0-0/w PTR         r     1 IN_GRAN$                  37-0-0/w PTR         r     1 M$DISK_IN$
    42-0-0/d STRC(72)    r     1 MODIFIED_FIT_             *0-0-0/w UBIN        r     1 NEW_FSN
    *0-0-0/c CHAR(6)     r     1 NEW_TSN                   24-0-0/d STRC(72)    r     1 PREV_BLK_
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:169  
    20-0-0/w SBIN        r     1 PREV_BLK_ARS              11-0-0/w SBIN        r     1 SNLIST_NUM
    47-0-0/c STRC(63)    r     1 TAPE_NAME                 22-0-0/w UBIN        r     1 VOL_SAVE

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 ARCHIVE$                   0-0-0/c ASTR(9)     r     1 ARCHIVE_NAME
     0-0-0/d VECT        r     1 A_FIT_                     0-0-0/w PTR         r     1 B$TCB$
     0-0-0/c ASTR(9)     r     1 BACKUP_NAME                0-0-0/w PTR         r     1 BLK_TAG$
     0-0-0/w PTR         r     1 BLK_TAG0$                  0-0-0/w PTR         r     1 BLOCK_GRAN$
     0-0-0/c CHAR        r     1 CROSSED                    0-0-0/w PTR         r     1 DCB$
     0-0-0/w PTR         r     1 DISK_FILE_SPEC$            0-0-0/w PTR         r     1 DISK_GRAN$
     0-0-0/w PTR         r     1 DPLIST$                    0-0-0/w PTR         r     1 DPRESLIST$
     0-0-0/c ASTR(9)     r     1 DUAL_FILE                  0-0-0/c ASTR(9)     r     1 EFT_CVOL_FILE
     0-0-0/c ASTR(9)     r     1 EFT_RESTRICT_FILE          0-0-0/b BIT         r     1 EOVOL_DETECTED
     0-0-0/w STRC        r     1 E_FILE_REWRITTEN           0-0-0/w STRC        r     1 E_OPER_ABORT
     0-0-0/w SBIN        r     1 FIRST_TAPE_VOL             0-0-0/d STRC(216)   r     1 FPT_EXIT
     0-0-0/c STRC(72)    r     1 FROM_DISK_ACCT             0-0-0/c STRC(288)   r     1 FROM_DISK_NAME
     0-0-0/d STRC(90)    r     1 FROM_DISK_SN               0-0-0/w SBIN        r     1 NBR_BYTES_TO_MOVE
     0-0-0/w SBIN        r     1 NBR_FILE_BLOCKS            0-0-0/w SBIN        r     1 NBR_SNLISTS
     0-0-0/c ASTR(9)     r     1 NODATA_FILE_NAME           0-0-0/c STRC(369)   r     1 NODATA_KEY
     0-0-0/c ASTR(9)     r     1 PRIME_FILE                 0-0-0/c ASTR(9)     r     1 REBUILD_DIR_KEY
     0-0-0/c ASTR(9)     r     1 REBUILD_KEY                0-0-0/c ASTR(9)     r     1 REBUILD_NAME
     0-0-0/c ASTR(9)     r     1 RET_CMDS_NAME              0-0-0/w PTR         r     1 SNVECLIST$
     0-0-0/d STRC(1080)  r     1 TAPE_CLOSE                 0-0-0/w PTR         r     1 TAPE_DCBLIST$
     0-0-0/w SBIN        r     1 TAPE_FSN                   0-0-0/d STRC(2088)  r     1 TAPE_OPEN
     0-0-0/d STRC(360)   r     1 TAPE_PRECORD               0-0-0/d STRC(504)   r     1 TAPE_READ
     0-0-0/d STRC(144)   r     1 TAPE_REMOVE                0-0-0/d STRC(144)   r     1 TAPE_REWIND
     0-0-0/c CHAR(6)     r     1 TAPE_SN                    0-0-0/d STRC(432)   r     1 TAPE_WRITE
     0-0-0/c ASTR(9)     r     1 TSN_USED_NAME

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:170  

     0-0-0/w STRC(2448)  r     1 B$ALT                      0-0-0/w STRC(144)   r     1 B$TCB
     0-0-0/w STRC(396)   r     1 BLK_TAG                    0-0-0/w STRC(396)   r     1 BLK_TAG
     0-0-0/w STRC(396)   r     1 BLK_TAG0                   0-0-0/w STRC(108)   r     1 CODE05
     0-0-0/w STRC(108)   r     1 CODE06                     0-0-0/d ASTR(3528)  r     1 F$DCB
     0-0-0/d ASTR(3528)  r     1 F$DCB                      0-0-0/w STRC(180)   r     1 FM$GRAN
     0-0-0N  NULL        r     1 M$DISK_IN                  0-0-0N  NULL        r     1 M$NODATA_LIST
     0-0-0/d STRC(72)    r     1 SNVECLIST(0:0)
     0-0-0/w STRC(72)    r     1 TAPE_DCBLIST(0:0)


   Procedure FLI$TAPE_WRITE requires 947 words for executable code.
   Procedure FLI$TAPE_WRITE requires 64 words of local(AUTO) storage.
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:171  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:172  
          MINI XREF LISTING

ACCT_NAME IN PROCEDURE FLI_UPDATE_FITS
     18219**DCL     18341--CALL
ACCT_NAME.L# IN PROCEDURE FLI_UPDATE_FITS
     18219**DCL     18339<<ASSIGN
ACCT_NAME.NAME# IN PROCEDURE FLI_UPDATE_FITS
     18219**DCL     18339--ASSIGN  18340<<ASSIGN
ANSWER IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17665**DCL     17932--ASSIGN  17936>>IF      17936>>IF      17941>>IF      17941>>IF
ARCHIVE$
     13882**DCL     18277>>IF      18312>>IF
ARCHIVE_NAME.L#
     12964**DCL     12964--IMP-SIZ
ARS
        12**DCL         6--PROC    17532>>ASSIGN  18007<>CALL    18053<>CALL    18083<>CALL    18115<>CALL
     18118<>CALL
A_FIT_
     12129**DCL     17990<>CALL    17995<>CALL    18042<>CALL    18048<>CALL    18081<>CALL
B$ALT.CODE
     17522**DCL     17522--REDEF   17523--REDEF   17523--REDEF
B$ALT.ERR.CODE
     17524**DCL     17554>>ASSIGN
B$ALT.ERR.ERR#
     17524**DCL     17524--REDEF
B$ALT.EVID
     17523**DCL     17523--REDEF   17523--REDEF
B$TCB.ALT$
     17518**DCL     17554>>ASSIGN
B$TCB$
     15761**DCL     17554>>ASSIGN
BACKUP_NAME.L#
     12608**DCL     12608--IMP-SIZ
BLK_ IN PROCEDURE FLI_UPDATE_FITS
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:173  
     18151**DCL     18146--PROC
BLK_.PTR$ IN PROCEDURE FLI_UPDATE_FITS
     18153**DCL     18254>>ASSIGN  18254>>ASSIGN  18257>>DOWHILE
BLK_GRAN_BASE$ IN PROCEDURE FLI_UPDATE_FITS
     18169**DCL     18256<<ASSIGN  18265>>ASSIGN
BLK_TAG.NAME
     12100**DCL     12100--REDEF
BLK_TAG IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17631**DCL     17982--ASSIGN  17982--ASSIGN
BLK_TAG.BEG IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17633**DCL     17983>>IF
BLK_TAG.NAME IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17634**DCL     17634--REDEF
BLK_TAG.NBR IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17633**DCL     17982>>ASSIGN
BLK_TAG IN PROCEDURE FLI_UPDATE_FITS
     18163**DCL     18254--ASSIGN  18255--ASSIGN  18349--ASSIGN
BLK_TAG.BEG IN PROCEDURE FLI_UPDATE_FITS
     18165**DCL     18260>>IF
BLK_TAG.BEGX IN PROCEDURE FLI_UPDATE_FITS
     18165**DCL     18265>>ASSIGN
BLK_TAG.NAME IN PROCEDURE FLI_UPDATE_FITS
     18166**DCL     18166--REDEF   18296>>ASSIGN  18341--CALL
BLK_TAG.NBR IN PROCEDURE FLI_UPDATE_FITS
     18165**DCL     18254>>ASSIGN
BLK_TAG.TYPE IN PROCEDURE FLI_UPDATE_FITS
     18165**DCL     18258>>DOCASE  18267>>IF      18301>>IF
BLK_TAG$
     12097**DCL     12097--IMP-PTR
BLK_TAG0.NAME
     12106**DCL     12106--REDEF
BLK_TAG0 IN PROCEDURE FLI_UPDATE_FITS
     18156**DCL     18256--ASSIGN
BLK_TAG0.NAME IN PROCEDURE FLI_UPDATE_FITS
     18159**DCL     18159--REDEF
BLK_TAG0.WHERE.ACCT IN PROCEDURE FLI_UPDATE_FITS
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:174  
     18159**DCL     18295>>ASSIGN  18340>>ASSIGN
BLK_TAG0.WHERE.PSN IN PROCEDURE FLI_UPDATE_FITS
     18159**DCL     18294>>ASSIGN
BLK_TAG0$
     12103**DCL     12103--IMP-PTR
BLK_TAG0T$ IN PROCEDURE FLI_UPDATE_FITS
     18155**DCL     18156--IMP-PTR 18254<<ASSIGN  18255>>ASSIGN  18256>>ASSIGN  18294>>ASSIGN  18295>>ASSIGN
     18340>>ASSIGN
BLK_TAGT$ IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17630**DCL     17631--IMP-PTR 17982<<ASSIGN  17983>>IF
BLK_TAGT$ IN PROCEDURE FLI_UPDATE_FITS
     18162**DCL     18163--IMP-PTR 18255<<ASSIGN  18257>>DOWHILE 18258>>DOCASE  18260>>IF      18265>>ASSIGN
     18267>>IF      18296>>ASSIGN  18301>>IF      18341>>CALL    18349<<ASSIGN  18349>>ASSIGN
BLOCK_GRAN$
     12110**DCL     12111--IMP-PTR
BOVOLUME
     17454**DCL     17538<<ASSIGN  17539>>IF      17956>>IF
BUF_
        11**DCL         6--PROC    17531>>ASSIGN  18006<>CALL    18007<>CALL    18050<>CALL    18053<>CALL
     18083<>CALL    18115<>CALL    18118<>CALL
CLOSE_BLOCK_FILE
     14551**DCL     18329<>CALL
CLOSE_BLOCK_FILE.IFPARAM_
     14556**DCL     18326<<ASSIGN  18330<<ASSIGN
CLOSE_BLOCK_FILE.SN_
     14551**DCL     14551--REDEF
CLOSE_BLOCK_FILE.UTL_
     14552**DCL     14552--REDEF
CLOSE_BLOCK_FILE.V
     14556**DCL     14551--DCLINIT
CLOSE_BLOCK_FILE.V.DESC
     14561**DCL     18327<<ASSIGN
CLOSE_BLOCK_FILE.V.EFTOPER
     14558**DCL     18331<<ASSIGN
CLOSE_BLOCK_FILE.V.EFTOPER.UPDDESC#
     14559**DCL     18328<<ASSIGN
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:175  
CLOSE_BLOCK_FILE.V.EXPIRE#
     14566**DCL     14566--REDEF
CLOSE_BLOCK_FILE.V.TYPE#
     14564**DCL     14564--REDEF
CLOSE_BLOCK_FILE.V.XTNSIZE#
     14561**DCL     14561--REDEF   14563--REDEF
CLOSE_NODATA_LIST.SN_
     13762**DCL     13762--REDEF
CLOSE_NODATA_LIST.UTL_
     13763**DCL     13763--REDEF
CLOSE_NODATA_LIST.V.EXPIRE#
     13777**DCL     13777--REDEF
CLOSE_NODATA_LIST.V.TYPE#
     13775**DCL     13775--REDEF
CLOSE_NODATA_LIST.V.XTNSIZE#
     13772**DCL     13772--REDEF   13774--REDEF
CLOSE_PRIME_DUAL.SN_
     13239**DCL     13239--REDEF
CLOSE_PRIME_DUAL.UTL_
     13240**DCL     13240--REDEF
CLOSE_PRIME_DUAL.V.EXPIRE#
     13254**DCL     13254--REDEF
CLOSE_PRIME_DUAL.V.TYPE#
     13252**DCL     13252--REDEF
CLOSE_PRIME_DUAL.V.XTNSIZE#
     13249**DCL     13249--REDEF   13251--REDEF
CLOSE_REBUILD.SN_
     13514**DCL     13514--REDEF
CLOSE_REBUILD.UTL_
     13515**DCL     13515--REDEF
CLOSE_REBUILD.V.EXPIRE#
     13529**DCL     13529--REDEF
CLOSE_REBUILD.V.TYPE#
     13527**DCL     13527--REDEF
CLOSE_REBUILD.V.XTNSIZE#
     13524**DCL     13524--REDEF   13526--REDEF
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:176  
CLOSE_STATUS.SN_
     12729**DCL     12729--REDEF
CLOSE_STATUS.UTL_
     12730**DCL     12730--REDEF
CLOSE_STATUS.V.EXPIRE#
     12744**DCL     12744--REDEF
CLOSE_STATUS.V.TYPE#
     12742**DCL     12742--REDEF
CLOSE_STATUS.V.XTNSIZE#
     12739**DCL     12739--REDEF   12741--REDEF
CLOSE_TSN_USED.SN_
     12439**DCL     12439--REDEF
CLOSE_TSN_USED.UTL_
     12440**DCL     12440--REDEF
CLOSE_TSN_USED.V.EXPIRE#
     12454**DCL     12454--REDEF
CLOSE_TSN_USED.V.TYPE#
     12452**DCL     12452--REDEF
CLOSE_TSN_USED.V.XTNSIZE#
     12449**DCL     12449--REDEF   12451--REDEF
CODE
     17453**DCL     17554<<ASSIGN  17555>>IF
CODE$ IN PROCEDURE FLI_UPDATE_FITS
     18171**DCL     18182--IMP-PTR 18185--IMP-PTR 18266<<ASSIGN  18270<>CALL    18272>>ASSIGN  18273>>ASSIGN
     18281<>CALL    18283>>ASSIGN  18284>>ASSIGN  18285>>ASSIGN  18300<<ASSIGN  18304<>CALL    18306>>ASSIGN
     18307>>ASSIGN  18308>>ASSIGN  18316<>CALL    18318>>ASSIGN  18319>>ASSIGN  18320>>ASSIGN
CODE05.BACKUP.EFT.CROSS IN PROCEDURE FLI_UPDATE_FITS
     18182**DCL     18308<<ASSIGN
CODE05.BACKUP.EFT.FSN IN PROCEDURE FLI_UPDATE_FITS
     18182**DCL     18273<<ASSIGN  18307<<ASSIGN
CODE05.BACKUP.REEL IN PROCEDURE FLI_UPDATE_FITS
     18182**DCL     18272<<ASSIGN  18306<<ASSIGN
CODE06.STOW.EFT IN PROCEDURE FLI_UPDATE_FITS
     18185**DCL     18186--REDEF
CODE06.STOW.EFT.CROSS IN PROCEDURE FLI_UPDATE_FITS
     18185**DCL     18285<<ASSIGN  18320<<ASSIGN
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:177  
CODE06.STOW.EFT.FSN IN PROCEDURE FLI_UPDATE_FITS
     18185**DCL     18284<<ASSIGN  18319<<ASSIGN
CODE06.STOW.REEL IN PROCEDURE FLI_UPDATE_FITS
     18185**DCL     18283<<ASSIGN  18318<<ASSIGN
COMMAND
        14**DCL         6--PROC    18005<>CALL    18007<>CALL    18053<>CALL    18083<>CALL    18115<>CALL
     18118<>CALL    18267>>IF      18267>>IF      18277>>IF      18277>>IF      18277>>IF      18301>>IF
     18301>>IF      18312>>IF      18312>>IF      18312>>IF
CON_CLOSE_ARCHIVE.SN_
     12771**DCL     12771--REDEF
CON_CLOSE_ARCHIVE.UTL_
     12772**DCL     12772--REDEF
CON_CLOSE_ARCHIVE.V.EXPIRE#
     12786**DCL     12786--REDEF
CON_CLOSE_ARCHIVE.V.TYPE#
     12784**DCL     12784--REDEF
CON_CLOSE_ARCHIVE.V.XTNSIZE#
     12781**DCL     12781--REDEF   12783--REDEF
CON_OPEN_ARCHIVE_FILE.ACSVEH_
     12858**DCL     12859--REDEF
CON_OPEN_ARCHIVE_FILE.ALTKEYS_
     12864**DCL     12865--REDEF   12865--REDEF
CON_OPEN_ARCHIVE_FILE.HDR_
     12863**DCL     12864--REDEF
CON_OPEN_ARCHIVE_FILE.TAB_
     12862**DCL     12863--REDEF
CON_OPEN_ARCHIVE_FILE.UHL_
     12856**DCL     12857--REDEF   12857--REDEF
CON_OPEN_ARCHIVE_FILE.V.FSN#
     12896**DCL     12896--REDEF   12896--REDEF
CON_OPEN_ARCHIVE_FILE.WSN_
     12862**DCL     12862--REDEF
CON_READ_ARCHIVE_FILE.STATION_
     12920**DCL     12921--REDEF
CON_READ_ARCHIVE_FILE.V.DVBYTE.REREAD#
     12932**DCL     12932--REDEF
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:178  
CON_READ_ARCHIVE_FILE.V.INDX#
     12930**DCL     12930--REDEF
CROSSED
     12132**DCL     18003<<ASSIGN
CVOL_UTL.ULBL#
     12199**DCL     12199--REDEF
DCB# IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17624**DCL     17990<>CALL    17995<>CALL    18042<>CALL    18048<>CALL    18081<>CALL    18128<>CALL
DCB$
     12096**DCL     17461--IMP-PTR
DCB$ IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17625**DCL     17855--IMP-PTR 17954<<ASSIGN  17956>>IF      18022>>ASSIGN  18023>>ASSIGN  18025>>ASSIGN
     18035>>IF      18076>>ASSIGN
DEL_NODATA_REC.V
     13865**DCL     13862--DCLINIT
DISK_CLOSE.SN_
     15441**DCL     15441--REDEF
DISK_CLOSE.UTL_
     15442**DCL     15442--REDEF
DISK_CLOSE.V.EXPIRE#
     15456**DCL     15456--REDEF
DISK_CLOSE.V.TYPE#
     15454**DCL     15454--REDEF
DISK_CLOSE.V.XTNSIZE#
     15451**DCL     15451--REDEF   15453--REDEF
DISK_CLOSE_NEXT.SN_
     14248**DCL     14248--REDEF
DISK_CLOSE_NEXT.UTL_
     14249**DCL     14249--REDEF
DISK_CLOSE_NEXT.V.EXPIRE#
     14263**DCL     14263--REDEF
DISK_CLOSE_NEXT.V.TYPE#
     14261**DCL     14261--REDEF
DISK_CLOSE_NEXT.V.XTNSIZE#
     14258**DCL     14258--REDEF   14260--REDEF
DISK_CLOSE_ORDINARY.SN_
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:179  
     14290**DCL     14290--REDEF
DISK_CLOSE_ORDINARY.UTL_
     14291**DCL     14291--REDEF
DISK_CLOSE_ORDINARY.V.EXPIRE#
     14305**DCL     14305--REDEF
DISK_CLOSE_ORDINARY.V.TYPE#
     14303**DCL     14303--REDEF
DISK_CLOSE_ORDINARY.V.XTNSIZE#
     14300**DCL     14300--REDEF   14302--REDEF
DISK_FILE_SPEC.SPEC
     15806**DCL     15808--REDEF
DISK_FILE_SPEC.SPEC.START
     15807**DCL     15807--REDEF
DISK_FILE_SPEC.SPEC.STOP
     15808**DCL     15808--REDEF
DISK_FILE_SPEC$
     15805**DCL     15806--IMP-PTR
DISK_FIT_ IN PROCEDURE FLI_UPDATE_FITS
     18173**DCL     18292<>CALL    18293>>ASSIGN  18299>>ASSIGN
DISK_GRAN$
     12110**DCL     12110--IMP-PTR
DISK_OPEN.ACSVEH_
     15306**DCL     15307--REDEF
DISK_OPEN.ALTKEYS_
     15312**DCL     15313--REDEF   15313--REDEF
DISK_OPEN.HDR_
     15311**DCL     15312--REDEF
DISK_OPEN.TAB_
     15310**DCL     15311--REDEF
DISK_OPEN.UHL_
     15304**DCL     15305--REDEF   15305--REDEF
DISK_OPEN.V.FSN#
     15344**DCL     15344--REDEF   15344--REDEF
DISK_OPEN.WSN_
     15310**DCL     15310--REDEF
DISK_OPEN_NEXT.ACSVEH_
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:180  
     14074**DCL     14075--REDEF
DISK_OPEN_NEXT.ALTKEYS_
     14080**DCL     14081--REDEF   14081--REDEF
DISK_OPEN_NEXT.HDR_
     14079**DCL     14080--REDEF
DISK_OPEN_NEXT.TAB_
     14078**DCL     14079--REDEF
DISK_OPEN_NEXT.UHL_
     14072**DCL     14073--REDEF   14073--REDEF
DISK_OPEN_NEXT.V.FSN#
     14112**DCL     14112--REDEF   14112--REDEF
DISK_OPEN_NEXT.WSN_
     14078**DCL     14078--REDEF
DISK_OPEN_ORDINARY.ACSVEH_
     14183**DCL     14184--REDEF
DISK_OPEN_ORDINARY.ALTKEYS_
     14189**DCL     14190--REDEF   14190--REDEF
DISK_OPEN_ORDINARY.HDR_
     14188**DCL     14189--REDEF
DISK_OPEN_ORDINARY.TAB_
     14187**DCL     14188--REDEF
DISK_OPEN_ORDINARY.UHL_
     14181**DCL     14182--REDEF   14182--REDEF
DISK_OPEN_ORDINARY.V.FSN#
     14221**DCL     14221--REDEF   14221--REDEF
DISK_OPEN_ORDINARY.WSN_
     14187**DCL     14187--REDEF
DISK_READ.STATION_
     15368**DCL     15369--REDEF
DISK_READ.V.DVBYTE.REREAD#
     15380**DCL     15380--REDEF
DISK_READ.V.INDX#
     15378**DCL     15378--REDEF
DISK_WRITE.STATION_
     15406**DCL     15406--REDEF
DISK_WRITE.V.DVBYTE.VFC#
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:181  
     15413**DCL     15413--REDEF
DPLIST$
     15791**DCL     15803--IMP-PTR
DPRESLIST$
     15805**DCL     15805--IMP-PTR
DUAL_FILE.L#
     13035**DCL     13035--IMP-SIZ
EFTWORD
     15926**DCL     15926--REDEF
EFT_CVOL_FILE
     12159**DCL     17990--CALL    18042--CALL    18107--ASSIGN
EFT_CVOL_FILE.L#
     12159**DCL     12159--IMP-SIZ 17990>>CALL    18042>>CALL    18107>>ASSIGN
EFT_RESTRICT_FILE
     12186**DCL     17995--CALL    18048--CALL    18081--CALL
EFT_RESTRICT_FILE.L#
     12186**DCL     12186--IMP-SIZ 17995>>CALL    18048>>CALL    18081>>CALL
EOVOLUME
        13**DCL         6--PROC    17568<<ASSIGN  17575<<ASSIGN  18005<>CALL    18007<>CALL    18053<>CALL
     18083<>CALL    18115<>CALL    18116>>IF      18118<>CALL
EOVOL_DETECTED
     15769**DCL     17538>>ASSIGN  17541<<ASSIGN  17568>>ASSIGN  17571<<ASSIGN  17575>>ASSIGN
ERR IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17640**DCL     17990<>CALL    17995<>CALL    18042<>CALL    18048<>CALL    18081<>CALL    18128<>CALL
E_FILE_REWRITTEN
     11904**DCL     18341<>CALL
E_OPER_ABORT
     11724**DCL     17938<>CALL
F$DCB.ACTPOS
     17493**DCL     17493--REDEF
F$DCB.ARS#
     17467**DCL     17467--REDEF
F$DCB.ATTR
     17486**DCL     17487--REDEF
F$DCB.BORROW
     17501**DCL     17501--REDEF   17501--REDEF   17501--REDEF
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:182  
F$DCB.DCBNAME.L
     17515**DCL     17515--IMP-SIZ
F$DCB.EOMCHAR#
     17471**DCL     17471--REDEF
F$DCB.FLDID
     17496**DCL     17496--REDEF
F$DCB.FORM$
     17490**DCL     17490--REDEF
F$DCB.FSECT
     17506**DCL     17506--REDEF
F$DCB.FSN#
     17483**DCL     17483--REDEF   17483--REDEF   17484--REDEF
F$DCB.HEADER$
     17489**DCL     17489--REDEF
F$DCB.IXTNSIZE#
     17487**DCL     17487--REDEF
F$DCB.LASTSTA$
     17476**DCL     17476--REDEF
F$DCB.LVL
     17502**DCL     17502--REDEF
F$DCB.NAME#.C
     17477**DCL     17477--REDEF
F$DCB.NOEOF
     17499**DCL     17499--REDEF
F$DCB.NRECS#
     17488**DCL     17488--REDEF
F$DCB.NRECX
     17507**DCL     17507--REDEF
F$DCB.OHDR
     17499**DCL     17499--REDEF
F$DCB.ORG#
     17482**DCL     17482--REDEF
F$DCB.PRECNO
     17505**DCL     17505--REDEF
F$DCB.RCSZ
     17511**DCL     17511--REDEF
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:183  
F$DCB.RES#
     17478**DCL     17478--REDEF   17558>>IF
F$DCB.SETX
     17490**DCL     17490--REDEF
F$DCB.TAB$
     17490**DCL     17490--REDEF
F$DCB.TDA
     17504**DCL     17505--REDEF
F$DCB.WSN#
     17478**DCL     17478--REDEF
F$DCB.ACTPOS IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17887**DCL     17887--REDEF
F$DCB.ARS# IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17861**DCL     17861--REDEF   17977>>ASSIGN
F$DCB.ATTR IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17880**DCL     17881--REDEF
F$DCB.BORROW IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17895**DCL     17895--REDEF   17895--REDEF   17895--REDEF
F$DCB.CRECNO IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17899**DCL     17956>>IF
F$DCB.DCBNAME.L IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17909**DCL     17909--IMP-SIZ
F$DCB.DESC IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17868**DCL     18327>>ASSIGN
F$DCB.EOMCHAR# IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17865**DCL     17865--REDEF
F$DCB.FLDID IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17890**DCL     17890--REDEF
F$DCB.FORM$ IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17884**DCL     17884--REDEF
F$DCB.FSECT IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17900**DCL     17900--REDEF
F$DCB.FSN# IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17877**DCL     17877--REDEF   17877--REDEF   17878--REDEF   18022>>ASSIGN  18035>>IF
F$DCB.HEADER$ IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17883**DCL     17883--REDEF
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:184  
F$DCB.IXTNSIZE# IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17881**DCL     17881--REDEF
F$DCB.LASTSTA$ IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17870**DCL     17870--REDEF
F$DCB.LVL IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17896**DCL     17896--REDEF
F$DCB.NAME#.C IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17871**DCL     17871--REDEF
F$DCB.NOEOF IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17893**DCL     17893--REDEF
F$DCB.NRECS# IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17882**DCL     17882--REDEF
F$DCB.NRECX IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17901**DCL     17901--REDEF
F$DCB.OHDR IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17893**DCL     17893--REDEF
F$DCB.ORG# IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17876**DCL     17876--REDEF
F$DCB.PRECNO IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17899**DCL     17899--REDEF
F$DCB.PSN# IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17871**DCL     18025>>ASSIGN  18066>>ASSIGN  18076>>ASSIGN  18095>>ASSIGN
F$DCB.RCSZ IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17905**DCL     17905--REDEF
F$DCB.RES# IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17872**DCL     17872--REDEF
F$DCB.SETX IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17884**DCL     17884--REDEF
F$DCB.TAB$ IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17884**DCL     17884--REDEF
F$DCB.TDA IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17898**DCL     17899--REDEF
F$DCB.VOL# IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17882**DCL     18023>>ASSIGN
F$DCB.WSN# IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17872**DCL     17872--REDEF
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:185  
FIRST_TAPE_VOL
     15926**DCL     18063>>IF
FIT_AREA.W2
     12470**DCL     12471--REDEF
FLI$ALLOC_BUF IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17589**DCL-ENT 17972--CALL    18292--CALL
FLI$CHANGE_VOLUMES
     17446**DCL-ENT 17542--CALL    17992--CALL    18044--CALL    18117--CALL
FLI$RPT_ERR
     17445**DCL-ENT 17557--CALL    17938--CALL    18128--CALL    18132--CALL    18141--CALL    18334--CALL
     18341--CALL
FLI$TAPE_CLOSE IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17590**DCL-ENT 17984--CALL    17985--CALL    17993--CALL    18024--CALL    18045--CALL    18119--CALL
     18139--CALL
FLI$TAPE_OPEN IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17591**DCL-ENT 17990--CALL    17995--CALL    18042--CALL    18048--CALL    18081--CALL
FLI$TAPE_WRITE
         6**PROC    18005--CALL    18007--CALL    18053--CALL    18083--CALL    18115--CALL    18118--CALL
FLI_TAPE_WRITE_RETRY
     17578**PROC    17561--CALL
FLI_UPDATE_FITS IN PROCEDURE FLI_TAPE_WRITE_RETRY
     18146**PROC    18004--CALL    18006--CALL    18050--CALL
FM$GRAN IN PROCEDURE FLI_UPDATE_FITS
     18189**DCL     18266--ASSIGN  18300--ASSIGN  18324--ASSIGN  18325--ASSIGN
FPT_EXIT.V.STEPCC#
     15231**DCL     15231--REDEF   17566>>IF      17567<<ASSIGN
FROM_DISK_ACCT
     13965**DCL     14489--DCLINIT
FROM_DISK_ACCT.ACCT#
     13965**DCL     18295<<ASSIGN
FROM_DISK_NAME
     13939**DCL     14485--DCLINIT 18296<<ASSIGN
FROM_DISK_SN
     13991**DCL     14484--DCLINIT
FROM_DISK_SN.SN#
     13991**DCL     18294<<ASSIGN
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:186  
FSN_SAVE IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17628**DCL     18022<<ASSIGN  18035>>IF
I IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17626**DCL     17964<<DOINDEX 17965>>ASSIGN  17966>>IF      18065<<DOINDEX 18066>>ASSIGN  18094<<DOINDEX
     18095>>ASSIGN  18104<<DOINDEX 18106>>ASSIGN  18109>>ASSIGN
IN_GRAN$ IN PROCEDURE FLI_UPDATE_FITS
     18170**DCL     18265<<ASSIGN  18266>>ASSIGN
JUSTALT IN PROCEDURE FLI_TAPE_WRITE_RETRY
     18127**LABEL   17939--GOTO    17984--CALLALT 17985--CALLALT 17992--CALLALT 17993--CALLALT 18005--CALLALT
     18007--CALLALT 18024--CALLALT 18044--CALLALT 18045--CALLALT 18053--CALLALT 18067--CALLALT 18077--CALLALT
     18083--CALLALT 18115--CALLALT 18117--CALLALT 18118--CALLALT 18119--CALLALT 18129--GOTO
JUST_ALTRET
     17558**LABEL   17542--CALLALT 17561--CALLALT
M$CLOSE
      5509**DCL-ENT 18033--CALL    18329--CALL
M$DISK_IN
     13880**DCL     18253--ASSIGN
M$DISK_IN$ IN PROCEDURE FLI_UPDATE_FITS
     18172**DCL     18253<<ASSIGN  18327>>ASSIGN
M$KEYIN
      5514**DCL-ENT 17928--CALL    17934--CALL    18074--CALL    18093--CALL    18100--CALL    18102--CALL
M$OPEN
      5509**DCL-ENT 18031--CALL    18111--CALL    18297--CALL
M$PRECORD
      5513**DCL-ENT 17969--CALL    17978--CALL
M$READ
      5510**DCL-ENT 17976--CALL
M$REM
      5518**DCL-ENT 18026--CALL    18067--CALL    18077--CALL    18096--CALL
M$WRITE
      5510**DCL-ENT 17552--CALL
MODIFIED_FIT_ IN PROCEDURE FLI_UPDATE_FITS
     18177**DCL     18299<<ASSIGN  18326>>ASSIGN
MODIFIED_FIT_.BOUND IN PROCEDURE FLI_UPDATE_FITS
     18178**DCL     18325<<ASSIGN  18325>>ASSIGN
MODIFIED_FIT_.PTR$ IN PROCEDURE FLI_UPDATE_FITS
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:187  
     18180**DCL     18300>>ASSIGN  18324<<ASSIGN  18324>>ASSIGN
NBR_BYTES_TO_MOVE
     12109**DCL     12110--IMP-SIZ 12111--IMP-SIZ
NBR_FILE_BLOCKS
     12132**DCL     18010<<ASSIGN  18120<<ASSIGN
NBR_SNLISTS
     15218**DCL     17550>>DOINDEX 17964>>DOINDEX 18065>>DOINDEX 18094>>DOINDEX 18104>>DOINDEX
NEW_FSN
        16**DCL         6--PROC    18005<>CALL    18007<>CALL    18009<<ASSIGN  18052<<ASSIGN
NEW_TSN
        15**DCL         6--PROC    18005<>CALL    18007<>CALL    18008<<ASSIGN  18051<<ASSIGN
NODATA_FILE_NAME.L#
     13724**DCL     13724--IMP-SIZ
NODATA_KEY
     13870**DCL     13862--DCLINIT 13863--DCLINIT
OC_KEYIN IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17610**DCL     17928<>CALL    17934<>CALL    18074<>CALL    18093<>CALL    18100<>CALL    18102<>CALL
OC_KEYIN.MESS_ IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17610**DCL     17927<<ASSIGN  17929<<ASSIGN  17944<<ASSIGN  18072<<ASSIGN  18091<<ASSIGN  18099<<ASSIGN
     18101<<ASSIGN
OC_KEYIN.REPLY_ IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17611**DCL     17926<<ASSIGN  17932<<ASSIGN  18071<<ASSIGN  18090<<ASSIGN
OC_KEYIN.RESULTS_ IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17612**DCL     17933<<ASSIGN  18073<<ASSIGN  18092<<ASSIGN
OC_KEYIN.V IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17613**DCL     17610--DCLINIT
OC_KEYIN.V.WAIT# IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17614**DCL     17925<<ASSIGN  17931<<ASSIGN  18070<<ASSIGN
OPEN_BLOCK_FILE
     14484**DCL     18297<>CALL
OPEN_BLOCK_FILE.ACSVEH_
     14486**DCL     14487--REDEF
OPEN_BLOCK_FILE.ALTKEYS_
     14492**DCL     14493--REDEF   14493--REDEF
OPEN_BLOCK_FILE.FPARAM_
     14489**DCL     18293<<ASSIGN
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:188  
OPEN_BLOCK_FILE.HDR_
     14491**DCL     14492--REDEF
OPEN_BLOCK_FILE.TAB_
     14490**DCL     14491--REDEF
OPEN_BLOCK_FILE.UHL_
     14484**DCL     14485--REDEF   14485--REDEF
OPEN_BLOCK_FILE.V
     14493**DCL     14484--DCLINIT
OPEN_BLOCK_FILE.V.FSN#
     14524**DCL     14524--REDEF   14524--REDEF
OPEN_BLOCK_FILE.WSN_
     14490**DCL     14490--REDEF
OPEN_NODATA_LIST.ACSVEH_
     13657**DCL     13658--REDEF
OPEN_NODATA_LIST.ALTKEYS_
     13663**DCL     13664--REDEF   13664--REDEF
OPEN_NODATA_LIST.HDR_
     13662**DCL     13663--REDEF
OPEN_NODATA_LIST.TAB_
     13661**DCL     13662--REDEF
OPEN_NODATA_LIST.UHL_
     13655**DCL     13656--REDEF   13656--REDEF
OPEN_NODATA_LIST.V.FSN#
     13695**DCL     13695--REDEF   13695--REDEF
OPEN_NODATA_LIST.WSN_
     13661**DCL     13661--REDEF
OPEN_PRIME_DUAL.ACSVEH_
     13104**DCL     13105--REDEF
OPEN_PRIME_DUAL.ALTKEYS_
     13110**DCL     13111--REDEF   13111--REDEF
OPEN_PRIME_DUAL.HDR_
     13109**DCL     13110--REDEF
OPEN_PRIME_DUAL.TAB_
     13108**DCL     13109--REDEF
OPEN_PRIME_DUAL.UHL_
     13102**DCL     13103--REDEF   13103--REDEF
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:189  
OPEN_PRIME_DUAL.V.FSN#
     13142**DCL     13142--REDEF   13142--REDEF
OPEN_PRIME_DUAL.WSN_
     13108**DCL     13108--REDEF
OPEN_REBUILD.ACSVEH_
     13339**DCL     13340--REDEF
OPEN_REBUILD.ALTKEYS_
     13345**DCL     13346--REDEF   13346--REDEF
OPEN_REBUILD.HDR_
     13344**DCL     13345--REDEF
OPEN_REBUILD.TAB_
     13343**DCL     13344--REDEF
OPEN_REBUILD.UHL_
     13337**DCL     13338--REDEF   13338--REDEF
OPEN_REBUILD.V.FSN#
     13377**DCL     13377--REDEF   13377--REDEF
OPEN_REBUILD.WSN_
     13343**DCL     13343--REDEF
OPEN_STATUS.ACSVEH_
     12541**DCL     12542--REDEF
OPEN_STATUS.ALTKEYS_
     12547**DCL     12548--REDEF   12548--REDEF
OPEN_STATUS.HDR_
     12546**DCL     12547--REDEF
OPEN_STATUS.TAB_
     12545**DCL     12546--REDEF
OPEN_STATUS.UHL_
     12539**DCL     12540--REDEF   12540--REDEF
OPEN_STATUS.V.FSN#
     12579**DCL     12579--REDEF   12579--REDEF
OPEN_STATUS.WSN_
     12545**DCL     12545--REDEF
OPEN_TSN_USED.ACSVEH_
     12277**DCL     12278--REDEF
OPEN_TSN_USED.ALTKEYS_
     12283**DCL     12284--REDEF   12284--REDEF
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:190  
OPEN_TSN_USED.HDR_
     12282**DCL     12283--REDEF
OPEN_TSN_USED.TAB_
     12281**DCL     12282--REDEF
OPEN_TSN_USED.UHL_
     12275**DCL     12276--REDEF   12276--REDEF
OPEN_TSN_USED.V.FSN#
     12315**DCL     12315--REDEF   12315--REDEF
OPEN_TSN_USED.WSN_
     12281**DCL     12281--REDEF
OPER_MESS1 IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17651**DCL     17927--ASSIGN
OPER_MESS2 IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17653**DCL     17929--ASSIGN
OPER_MESS4 IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17655**DCL     18072--ASSIGN
OPER_MESS5 IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17657**DCL     17944--ASSIGN
OPER_MESS6 IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17659**DCL     18091--ASSIGN
OPER_MESS7 IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17661**DCL     18099--ASSIGN
OPER_MESS8 IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17663**DCL     18101--ASSIGN
PREV_BLK_ IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17637**DCL     17972<>CALL    17974>>ASSIGN  18004<>CALL    18005<>CALL
PREV_BLK_.PTR$ IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17639**DCL     17982>>ASSIGN  17982>>ASSIGN
PREV_BLK_ARS IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17627**DCL     17977<<ASSIGN  18005<>CALL
PRE_RET_CLOSE.SN_
     16169**DCL     16169--REDEF
PRE_RET_CLOSE.UTL_
     16170**DCL     16170--REDEF
PRE_RET_CLOSE.V.EXPIRE#
     16184**DCL     16184--REDEF
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:191  
PRE_RET_CLOSE.V.TYPE#
     16182**DCL     16182--REDEF
PRE_RET_CLOSE.V.XTNSIZE#
     16179**DCL     16179--REDEF   16181--REDEF
PRE_RET_OPEN.ACSVEH_
     16104**DCL     16105--REDEF
PRE_RET_OPEN.ALTKEYS_
     16110**DCL     16111--REDEF   16111--REDEF
PRE_RET_OPEN.HDR_
     16109**DCL     16110--REDEF
PRE_RET_OPEN.TAB_
     16108**DCL     16109--REDEF
PRE_RET_OPEN.UHL_
     16102**DCL     16103--REDEF   16103--REDEF
PRE_RET_OPEN.V.FSN#
     16142**DCL     16142--REDEF   16142--REDEF
PRE_RET_OPEN.WSN_
     16108**DCL     16108--REDEF
PRE_RET_READ.STATION_
     15959**DCL     15960--REDEF
PRE_RET_READ.V.DVBYTE.REREAD#
     15971**DCL     15971--REDEF
PRE_RET_READ.V.INDX#
     15969**DCL     15969--REDEF
PRE_RET_WRITE.STATION_
     15997**DCL     15997--REDEF
PRE_RET_WRITE.V.DVBYTE.VFC#
     16004**DCL     16004--REDEF
PRIME_FILE.L#
     13008**DCL     13008--IMP-SIZ
QUERY_OPER IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17929**LABEL   17945--GOTO
READ_AD_OR_FD.ACSVEH_
     14376**DCL     14377--REDEF
READ_AD_OR_FD.ALTKEYS_
     14382**DCL     14383--REDEF   14383--REDEF
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:192  
READ_AD_OR_FD.HDR_
     14381**DCL     14382--REDEF
READ_AD_OR_FD.TAB_
     14380**DCL     14381--REDEF
READ_AD_OR_FD.UHL_
     14374**DCL     14375--REDEF   14375--REDEF
READ_AD_OR_FD.V.FSN#
     14414**DCL     14414--REDEF   14414--REDEF
READ_AD_OR_FD.WSN_
     14380**DCL     14380--REDEF
READ_NODATA_LIST.STATION_
     13801**DCL     13802--REDEF
READ_NODATA_LIST.V.DVBYTE.REREAD#
     13813**DCL     13813--REDEF
READ_NODATA_LIST.V.INDX#
     13811**DCL     13811--REDEF
READ_PRIME_DUAL.STATION_
     13166**DCL     13167--REDEF
READ_PRIME_DUAL.V.DVBYTE.REREAD#
     13178**DCL     13178--REDEF
READ_PRIME_DUAL.V.INDX#
     13176**DCL     13176--REDEF
READ_REBUILD.STATION_
     13472**DCL     13473--REDEF
READ_REBUILD.V.DVBYTE.REREAD#
     13484**DCL     13484--REDEF
READ_REBUILD.V.INDX#
     13482**DCL     13482--REDEF
READ_STATUS.STATION_
     12687**DCL     12688--REDEF
READ_STATUS.V.DVBYTE.REREAD#
     12699**DCL     12699--REDEF
READ_STATUS.V.INDX#
     12697**DCL     12697--REDEF
READ_TSN_USED.STATION_
     12397**DCL     12398--REDEF
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:193  
READ_TSN_USED.V.DVBYTE.REREAD#
     12409**DCL     12409--REDEF
READ_TSN_USED.V.INDX#
     12407**DCL     12407--REDEF
REBUILD_DIR_KEY.L#
     13558**DCL     13558--IMP-SIZ
REBUILD_KEY.L#
     13585**DCL     13585--IMP-SIZ
REBUILD_NAME.L#
     13406**DCL     13406--IMP-SIZ
REPALT IN PROCEDURE FLI_TAPE_WRITE_RETRY
     18127**LABEL   17928--CALLALT 17934--CALLALT 17969--CALLALT 17976--CALLALT 17978--CALLALT 18026--CALLALT
     18031--CALLALT 18033--CALLALT 18074--CALLALT 18093--CALLALT 18096--CALLALT 18100--CALLALT 18102--CALLALT
     18111--CALLALT
REPERRALT IN PROCEDURE FLI_TAPE_WRITE_RETRY
     18127**LABEL   17990--CALLALT 17995--CALLALT 18042--CALLALT 18048--CALLALT 18081--CALLALT
RET_CMDS_NAME.L#
     16213**DCL     16213--IMP-SIZ
SNLIST_NUM
     17452**DCL     17550<<DOINDEX 17551>>ASSIGN  17954>>ASSIGN  17966>>IF      17973>>ASSIGN  17977>>ASSIGN
     18030>>ASSIGN  18032>>ASSIGN
SNVECLIST.SN_
     15745**DCL     18109>>ASSIGN
SNVECLIST$
     15745**DCL     15745--IMP-PTR 18109>>ASSIGN
SPEC.START
     15809**DCL     15810--REDEF
SPEC.STOP
     15810**DCL     15811--REDEF
SPECCHARS
     15809**DCL     15809--REDEF
TAPE_BLOCK_.W2
     12125**DCL     12126--REDEF
TAPE_CLOSE
     15662**DCL     18033<>CALL
TAPE_CLOSE.SN_
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:194  
     15662**DCL     15662--REDEF
TAPE_CLOSE.UTL_
     15663**DCL     15663--REDEF
TAPE_CLOSE.V.DCB#
     15668**DCL     18032<<ASSIGN
TAPE_CLOSE.V.EXPIRE#
     15677**DCL     15677--REDEF
TAPE_CLOSE.V.POS#
     15675**DCL     18136<<ASSIGN
TAPE_CLOSE.V.TRUNCATE#
     15671**DCL     17980<<ASSIGN  17986<<ASSIGN  18135<<ASSIGN
TAPE_CLOSE.V.TYPE#
     15675**DCL     15675--REDEF
TAPE_CLOSE.V.XTNSIZE#
     15672**DCL     15672--REDEF   15674--REDEF
TAPE_DCBLIST.DCB#
     15218**DCL     17551>>ASSIGN  17965>>ASSIGN  17973>>ASSIGN  18030>>ASSIGN  18032>>ASSIGN  18106>>ASSIGN
TAPE_DCBLIST.DCB$
     15218**DCL     17954>>ASSIGN  17977>>ASSIGN  18066>>ASSIGN  18095>>ASSIGN
TAPE_DCBLIST$
     15218**DCL     15218--IMP-PTR 17551>>ASSIGN  17954>>ASSIGN  17965>>ASSIGN  17973>>ASSIGN  17977>>ASSIGN
     18030>>ASSIGN  18032>>ASSIGN  18066>>ASSIGN  18095>>ASSIGN  18106>>ASSIGN
TAPE_FSN
     12202**DCL     17990<>CALL    17995<>CALL    18009>>ASSIGN  18042<>CALL    18048<>CALL    18052>>ASSIGN
     18081<>CALL    18273>>ASSIGN  18284>>ASSIGN  18307>>ASSIGN  18319>>ASSIGN
TAPE_NAME IN PROCEDURE FLI_UPDATE_FITS
     18248**DCL     18341--CALL
TAPE_NAME.L# IN PROCEDURE FLI_UPDATE_FITS
     18248**DCL     18337<<ASSIGN
TAPE_NAME.NAME# IN PROCEDURE FLI_UPDATE_FITS
     18248**DCL     18337--ASSIGN  18338<<ASSIGN
TAPE_OPEN.ACSVEH_
     15527**DCL     15528--REDEF
TAPE_OPEN.ALTKEYS_
     15533**DCL     15534--REDEF   15534--REDEF
TAPE_OPEN.HDR_
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:195  
     15532**DCL     15533--REDEF
TAPE_OPEN.TAB_
     15531**DCL     15532--REDEF
TAPE_OPEN.UHL_
     15525**DCL     15526--REDEF   15526--REDEF
TAPE_OPEN.V.FSN#
     15565**DCL     15565--REDEF   15565--REDEF
TAPE_OPEN.V.INITZ.SCRUB#
     15535**DCL     18080<<ASSIGN  18084<<ASSIGN  18138<<ASSIGN
TAPE_OPEN.V.OPER.MNTONLY#
     15538**DCL     18079<<ASSIGN  18085<<ASSIGN  18137<<ASSIGN
TAPE_OPEN.V.XTEND#
     15555**DCL     18041<<ASSIGN  18046<<ASSIGN
TAPE_OPEN.WSN_
     15531**DCL     15531--REDEF
TAPE_OPEN_LAST IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17741**DCL     18031<>CALL    18111<>CALL
TAPE_OPEN_LAST.ACSVEH_ IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17743**DCL     17744--REDEF
TAPE_OPEN_LAST.ALTKEYS_ IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17749**DCL     17750--REDEF   17750--REDEF
TAPE_OPEN_LAST.HDR_ IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17748**DCL     17749--REDEF
TAPE_OPEN_LAST.NAME_ IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17742**DCL     18029<<ASSIGN  18107<<ASSIGN  18112<<ASSIGN
TAPE_OPEN_LAST.SN_ IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17741**DCL     18109<<ASSIGN
TAPE_OPEN_LAST.TAB_ IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17747**DCL     17748--REDEF
TAPE_OPEN_LAST.UHL_ IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17741**DCL     17742--REDEF   17742--REDEF
TAPE_OPEN_LAST.V IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17750**DCL     17741--DCLINIT
TAPE_OPEN_LAST.V.DCB# IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17750**DCL     18030<<ASSIGN  18106<<ASSIGN
TAPE_OPEN_LAST.V.FSN# IN PROCEDURE FLI_TAPE_WRITE_RETRY
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:196  
     17781**DCL     17781--REDEF   17781--REDEF   18028<<ASSIGN
TAPE_OPEN_LAST.V.FUN# IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17760**DCL     17920<<ASSIGN  18110<<ASSIGN
TAPE_OPEN_LAST.V.INITZ.SCRUB# IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17751**DCL     17922<<ASSIGN  18105<<ASSIGN
TAPE_OPEN_LAST.V.OPER.TEST# IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17752**DCL     17919<<ASSIGN
TAPE_OPEN_LAST.V.VOL# IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17775**DCL     17923<<ASSIGN  18108<<ASSIGN
TAPE_OPEN_LAST.V.XTEND# IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17771**DCL     17921<<ASSIGN
TAPE_OPEN_LAST.WSN_ IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17747**DCL     17747--REDEF
TAPE_PFIL.V IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17799**DCL     17799--DCLINIT
TAPE_PRECORD
     15735**DCL     17969<>CALL    17978<>CALL
TAPE_PRECORD.V.DCB#
     15737**DCL     17965<<ASSIGN
TAPE_PRECORD.V.IOERROK#
     15740**DCL     17955<<ASSIGN
TAPE_PRECORD.V.N#
     15741**DCL     17963<<ASSIGN  17968<<ASSIGN
TAPE_PRECORD.V.NOMARKS#
     15742**DCL     17962<<ASSIGN  17979<<ASSIGN
TAPE_READ
     15586**DCL     17976<>CALL
TAPE_READ.BUF_
     15588**DCL     17974<<ASSIGN
TAPE_READ.STATION_
     15589**DCL     15590--REDEF
TAPE_READ.V.DCB#
     15590**DCL     17973<<ASSIGN
TAPE_READ.V.DVBYTE.REREAD#
     15601**DCL     15601--REDEF
TAPE_READ.V.INDX#
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:197  
     15599**DCL     15599--REDEF
TAPE_READ.V.IOERROK#
     15593**DCL     17975<<ASSIGN
TAPE_REMOVE
     15706**DCL     18077<>CALL    18096<>CALL
TAPE_REMOVE.V.PSN#
     15707**DCL     18076<<ASSIGN  18095<<ASSIGN
TAPE_REWIND
     15692**DCL     18026<>CALL    18067<>CALL
TAPE_REWIND.V.PSN#
     15693**DCL     18025<<ASSIGN  18066<<ASSIGN
TAPE_SN
     12202**DCL     17990<>CALL    17995<>CALL    18008>>ASSIGN  18042<>CALL    18048<>CALL    18051>>ASSIGN
     18081<>CALL    18272>>ASSIGN  18283>>ASSIGN  18306>>ASSIGN  18318>>ASSIGN  18338>>ASSIGN
TAPE_WRITE
     15625**DCL     17552<>CALL
TAPE_WRITE.BUF_
     15625**DCL     17531<<ASSIGN
TAPE_WRITE.BUF_.BOUND
     15625**DCL     17532<<ASSIGN
TAPE_WRITE.STATION_
     15627**DCL     15627--REDEF
TAPE_WRITE.V.DCB#
     15628**DCL     17551<<ASSIGN  17558--IF
TAPE_WRITE.V.DVBYTE.VFC#
     15634**DCL     15634--REDEF
TAPE_WRITE.V.IOERROK#
     15632**DCL     17558>>IF
TSN_USED_NAME.L#
     12344**DCL     12344--IMP-SIZ
TVECTOR.W2
     15758**DCL     15759--REDEF
TYC_ARS IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17666**DCL     17933--ASSIGN
VOL_SAVE IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17629**DCL     18023<<ASSIGN  18063>>IF      18108>>ASSIGN
PL6.E3A0      #004=FLI$TAPE_WRITE File=FLI$TAPE.:E05TSI                          TUE 07/29/97 15:57 Page:198  
WRITE_LOOP
     17550**LABEL   17563--EXIT
WRITE_NODATA_LIST.STATION_
     13839**DCL     13839--REDEF
WRITE_NODATA_LIST.V.DVBYTE.VFC#
     13846**DCL     13846--REDEF
WRITE_PRIME_DUAL.STATION_
     13204**DCL     13204--REDEF
WRITE_PRIME_DUAL.V.DVBYTE.VFC#
     13211**DCL     13211--REDEF
WRITE_REBUILD.STATION_
     13440**DCL     13440--REDEF
WRITE_REBUILD.V.DVBYTE.VFC#
     13447**DCL     13447--REDEF
WRITE_STATUS.STATION_
     12655**DCL     12655--REDEF
WRITE_STATUS.V.DVBYTE.VFC#
     12662**DCL     12662--REDEF
WRITE_TSN_USED.STATION_
     12365**DCL     12365--REDEF
WRITE_TSN_USED.V.DVBYTE.VFC#
     12372**DCL     12372--REDEF
XSF$LOCCODP IN PROCEDURE FLI_TAPE_WRITE_RETRY
     17592**DCL-ENT 18270--CALL    18281--CALL    18304--CALL    18316--CALL

PL6.E3A0      #005=FLI$CHANGE_VOLUMES File=FLI$TAPE.:E05TSI                      TUE 07/29/97 15:58 Page:199  
      966        1        /*T***********************************************************/
      967        2        /*T*                                                         */
      968        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      969        4        /*T*                                                         */
      970        5        /*T***********************************************************/
      971        6        FLI$CHANGE_VOLUMES: PROC ALTRET;
      972        7        /*F*  NAME: FLI_CHANGE_VOLUMES
      973        8              PURPOSE: CVOL all volume sets.
      974        9         */
      975       10
      976       11        /***
      977       12         *** INCLUDE
      978       13         ***/
      979       14
      980       15        %INCLUDE CP_6;
      981     5574        %INCLUDE FLI_DATA_R;
      982     6988        %INCLUDE XUD_UTS_M;
      983     7070
      984     7071        /***
      985     7072         *** AUTO
      986     7073         ***/
      987     7074
      988     7075    1   DCL BEGIN_CVOL_UTS UBIN WORD AUTO;
      989     7076    1   DCL I SBIN AUTO;
      990     7077    1   DCL TEMP SBIN AUTO;
      991     7078
      992     7079        /***
      993     7080         *** ENTRY
      994     7081         ***/
      995     7082
      996     7083    1   DCL FLI$RPT_ERR ENTRY(5);
      997     7084        %XUD$UTS_ENTRIES;
      998     7116
      999     7117        /****************************************/
     1000     7118
     1001     7119    1      CALL M$TIME( GET_NOW_UTS );          /* Get current time                   */
     1002     7120    1      BEGIN_CVOL_UTS = NOW_UTS;
PL6.E3A0      #005=FLI$CHANGE_VOLUMES File=FLI$TAPE.:E05TSI                      TUE 07/29/97 15:58 Page:200  
     1003     7121
     1004     7122    2      DO I=0 TO NBR_SNLISTS-1;
     1005     7123    2         TAPE_CVOL.V.DCB# = TAPE_DCBLIST.DCB#(I);
     1006     7124    2         CALL M$CVOL( TAPE_CVOL )
     1007     7125    3          WHENALTRETURN DO;
     1008     7126    3            CALL FLI$RPT_ERR;
     1009     7127    3            ALTRETURN;
     1010     7128    3            END;
     1011     7129    2         END;
     1012     7130
     1013     7131
     1014     7132    1      CALL M$TIME( GET_NOW_UTS );
     1015     7133    1      CALL XUD$UTS_DIFF(TEMP,NOW_UTS,BEGIN_CVOL_UTS);
     1016     7134    1      ACCUMULATED_MOUNT_TIME = ACCUMULATED_MOUNT_TIME + TEMP;
     1017     7135    1      RETURN;
     1018     7136
     1019     7137    1   END FLI$CHANGE_VOLUMES;

PL6.E3A0      #005=FLI$CHANGE_VOLUMES File=FLI$TAPE.:E05TSI                      TUE 07/29/97 15:58 Page:201  
--  Include file information  --

   XUD_UTS_M.:E05TOU  is referenced.
   B_MICROPS_C.:E05TOU  is referenced.
   FLB_SUBS_C.:E05TOU  is referenced.
   FLI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FLI$CHANGE_VOLUMES.

   Procedure FLI$CHANGE_VOLUMES requires 44 words for executable code.
   Procedure FLI$CHANGE_VOLUMES requires 10 words of local(AUTO) storage.

    No errors detected in file FLI$TAPE.:E05TSI    .

PL6.E3A0      #005=FLI$CHANGE_VOLUMES File=FLI$TAPE.:E05TSI                      TUE 07/29/97 15:58 Page:202  

 Object Unit name= FLI$CHANGE_VOLUMES                         File name= FLI$TAPE.:E05TOU
 UTS= JUL 29 '97 15:58:34.84 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   DCB   even  none     0      0  M$PRE_RET
    2   Data  even  none     6      6  FLI$CHANGE_VOLUMES
    3   Proc  even  none    44     54  FLI$CHANGE_VOLUMES
    4  RoData even  none     1      1  FLI$CHANGE_VOLUMES

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     3      0   yes    yes     yes      Std        0  FLI$CHANGE_VOLUMES

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       5 FLI$RPT_ERR
 yes     yes           Std       3 XUD$UTS_DIFF
                       nStd      0 X66_AUTO_0
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AALT
                       nStd      0 X66_ARET
PL6.E3A0      #005=FLI$CHANGE_VOLUMES File=FLI$TAPE.:E05TSI                      TUE 07/29/97 15:58 Page:203  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  NBR_SNLISTS                           TAPE_DCBLIST$
     TAPE_CVOL                             SNVECLIST$                            NOW_UTS
     GET_NOW_UTS                           ACCUMULATED_MOUNT_TIME                DPLIST$
     DPRESLIST$                            DISK_FILE_SPEC$                       SPECCHARS
     EFTWORD                               M$PRE_RET                             RET_CMDS_NAME
     B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #005=FLI$CHANGE_VOLUMES File=FLI$TAPE.:E05TSI                      TUE 07/29/97 15:58 Page:204  


      966        1        /*T***********************************************************/
      967        2        /*T*                                                         */
      968        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      969        4        /*T*                                                         */
      970        5        /*T***********************************************************/
      971        6        FLI$CHANGE_VOLUMES: PROC ALTRET;

      6  3 000000   000000 700200 xent  FLI$CHANGE_* TSX0  ! X66_AUTO_0
         3 000001   000012 000000                    ZERO    10,0

      972        7        /*F*  NAME: FLI_CHANGE_VOLUMES
      973        8              PURPOSE: CVOL all volume sets.
      974        9         */
      975       10
      976       11        /***
      977       12         *** INCLUDE
      978       13         ***/
      979       14
      980       15        %INCLUDE CP_6;
      981     5574        %INCLUDE FLI_DATA_R;
      982     6988        %INCLUDE XUD_UTS_M;
      983     7070
      984     7071        /***
      985     7072         *** AUTO
      986     7073         ***/
      987     7074
      988     7075    1   DCL BEGIN_CVOL_UTS UBIN WORD AUTO;
      989     7076    1   DCL I SBIN AUTO;
      990     7077    1   DCL TEMP SBIN AUTO;
      991     7078
      992     7079        /***
      993     7080         *** ENTRY
      994     7081         ***/
      995     7082
      996     7083    1   DCL FLI$RPT_ERR ENTRY(5);
      997     7084        %XUD$UTS_ENTRIES;
PL6.E3A0      #005=FLI$CHANGE_VOLUMES File=FLI$TAPE.:E05TSI                      TUE 07/29/97 15:58 Page:205  
      998     7116
      999     7117        /****************************************/
     1000     7118
     1001     7119    1      CALL M$TIME( GET_NOW_UTS );          /* Get current time                   */

   7119  3 000002   000000 630400 xsym               EPPR0   GET_NOW_UTS
         3 000003   020004 713400                    CLIMB   8196
         3 000004   402000 401760                    pmme    nvectors=5

     1002     7120    1      BEGIN_CVOL_UTS = NOW_UTS;

   7120  3 000005   000000 235000 xsym               LDA     NOW_UTS
         3 000006   200003 755100                    STA     BEGIN_CVOL_UTS,,AUTO

     1003     7121
     1004     7122    2      DO I=0 TO NBR_SNLISTS-1;

   7122  3 000007   200004 450100                    STZ     I,,AUTO
         3 000010   000030 710000 3                  TRA     s:7129+1

     1005     7123    2         TAPE_CVOL.V.DCB# = TAPE_DCBLIST.DCB#(I);

   7123  3 000011   200004 235100                    LDA     I,,AUTO
         3 000012   000001 735000                    ALS     1
         3 000013   000000 470400 xsym               LDP0    TAPE_DCBLIST$
         3 000014   000000 720105                    LXL0    0,AL,PR0
         3 000015   000006 740000 xsym               STX0    TAPE_CVOL+6

     1006     7124    2         CALL M$CVOL( TAPE_CVOL )

   7124  3 000016   000000 630400 xsym               EPPR0   TAPE_CVOL
         3 000017   450004 713400                    CLIMB   alt,+20484
         3 000020   401000 401760                    pmme    nvectors=3
         3 000021   000023 702000 3                  TSX2    s:7126
         3 000022   000027 710000 3                  TRA     s:7129

     1007     7125    3          WHENALTRETURN DO;
PL6.E3A0      #005=FLI$CHANGE_VOLUMES File=FLI$TAPE.:E05TSI                      TUE 07/29/97 15:58 Page:206  

     1008     7126    3            CALL FLI$RPT_ERR;

   7126  3 000023   000002 631400 xsym               EPPR1   B_VECTNIL+2
         3 000024   000000 701000 xent               TSX1    FLI$RPT_ERR
         3 000025   000000 011000                    NOP     0

     1009     7127    3            ALTRETURN;

   7127  3 000026   000000 702200 xent               TSX2  ! X66_AALT

     1010     7128    3            END;
     1011     7129    2         END;

   7129  3 000027   200004 054100                    AOS     I,,AUTO
         3 000030   200004 236100                    LDQ     I,,AUTO
         3 000031   000000 116000 xsym               CMPQ    NBR_SNLISTS
         3 000032   000011 604000 3                  TMI     s:7123

     1012     7130
     1013     7131
     1014     7132    1      CALL M$TIME( GET_NOW_UTS );

   7132  3 000033   000000 630400 xsym               EPPR0   GET_NOW_UTS
         3 000034   020004 713400                    CLIMB   8196
         3 000035   402000 401760                    pmme    nvectors=5

     1015     7133    1      CALL XUD$UTS_DIFF(TEMP,NOW_UTS,BEGIN_CVOL_UTS);

   7133  3 000036   200003 630500                    EPPR0   BEGIN_CVOL_UTS,,AUTO
         3 000037   200010 450500                    STP0    TEMP+3,,AUTO
         3 000040   000000 236000 4                  LDQ     0
         3 000041   200007 756100                    STQ     TEMP+2,,AUTO
         3 000042   200005 631500                    EPPR1   TEMP,,AUTO
         3 000043   200006 451500                    STP1    TEMP+1,,AUTO
         3 000044   200006 630500                    EPPR0   TEMP+1,,AUTO
         3 000045   000021 631400 xsym               EPPR1   B_VECTNIL+17
PL6.E3A0      #005=FLI$CHANGE_VOLUMES File=FLI$TAPE.:E05TSI                      TUE 07/29/97 15:58 Page:207  
         3 000046   000000 701000 xent               TSX1    XUD$UTS_DIFF
         3 000047   000000 011000                    NOP     0

     1016     7134    1      ACCUMULATED_MOUNT_TIME = ACCUMULATED_MOUNT_TIME + TEMP;

   7134  3 000050   000000 236000 xsym               LDQ     ACCUMULATED_MOUNT_TIME
         3 000051   200005 036100                    ADLQ    TEMP,,AUTO
         3 000052   000000 756000 xsym               STQ     ACCUMULATED_MOUNT_TIME

     1017     7135    1      RETURN;

   7135  3 000053   000000 702200 xent               TSX2  ! X66_ARET
     1018     7136
     1019     7137    1   END FLI$CHANGE_VOLUMES;

PL6.E3A0      #005=FLI$CHANGE_VOLUMES File=FLI$TAPE.:E05TSI                      TUE 07/29/97 15:58 Page:208  
--  Include file information  --

   XUD_UTS_M.:E05TOU  is referenced.
   B_MICROPS_C.:E05TOU  is referenced.
   FLB_SUBS_C.:E05TOU  is referenced.
   FLI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FLI$CHANGE_VOLUMES.
PL6.E3A0      #005=FLI$CHANGE_VOLUMES File=FLI$TAPE.:E05TSI                      TUE 07/29/97 15:58 Page:209  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w UBIN        r     1 BEGIN_CVOL_UTS             4-0-0/w SBIN        r     1 I
     5-0-0/w SBIN        r     1 TEMP

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN        r     1 ACCUMULATED_MOUNT_TIME
     0-0-0/w PTR         r     1 DISK_FILE_SPEC$            0-0-0/w PTR         r     1 DPLIST$
     0-0-0/w PTR         r     1 DPRESLIST$                 0-0-0/d STRC(432)   r     1 GET_NOW_UTS
     0-0-0/w SBIN        r     1 NBR_SNLISTS                0-0-0/w UBIN        r     1 NOW_UTS
     0-0-0/c ASTR(9)     r     1 RET_CMDS_NAME              0-0-0/w PTR         r     1 SNVECLIST$
     0-0-0/d STRC(288)   r     1 TAPE_CVOL                  0-0-0/w PTR         r     1 TAPE_DCBLIST$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(72)    r     1 TAPE_DCBLIST(0:0)


   Procedure FLI$CHANGE_VOLUMES requires 44 words for executable code.
   Procedure FLI$CHANGE_VOLUMES requires 10 words of local(AUTO) storage.

    No errors detected in file FLI$TAPE.:E05TSI    .
PL6.E3A0      #005=FLI$CHANGE_VOLUMES File=FLI$TAPE.:E05TSI                      TUE 07/29/97 15:58 Page:210  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #005=FLI$CHANGE_VOLUMES File=FLI$TAPE.:E05TSI                      TUE 07/29/97 15:58 Page:211  
          MINI XREF LISTING

ACCUMULATED_MOUNT_TIME
      6534**DCL      7134<<ASSIGN   7134>>ASSIGN
BEGIN_CVOL_UTS
      7075**DCL      7120<<ASSIGN   7133<>CALL
DISK_CLOSE.SN_
      6185**DCL      6185--REDEF
DISK_CLOSE.UTL_
      6186**DCL      6186--REDEF
DISK_CLOSE.V.EXPIRE#
      6200**DCL      6200--REDEF
DISK_CLOSE.V.TYPE#
      6198**DCL      6198--REDEF
DISK_CLOSE.V.XTNSIZE#
      6195**DCL      6195--REDEF    6197--REDEF
DISK_FILE_SPEC.SPEC
      6550**DCL      6552--REDEF
DISK_FILE_SPEC.SPEC.START
      6551**DCL      6551--REDEF
DISK_FILE_SPEC.SPEC.STOP
      6552**DCL      6552--REDEF
DISK_FILE_SPEC$
      6549**DCL      6550--IMP-PTR
DISK_OPEN.ACSVEH_
      6050**DCL      6051--REDEF
DISK_OPEN.ALTKEYS_
      6056**DCL      6057--REDEF    6057--REDEF
DISK_OPEN.HDR_
      6055**DCL      6056--REDEF
DISK_OPEN.TAB_
      6054**DCL      6055--REDEF
DISK_OPEN.UHL_
      6048**DCL      6049--REDEF    6049--REDEF
PL6.E3A0      #005=FLI$CHANGE_VOLUMES File=FLI$TAPE.:E05TSI                      TUE 07/29/97 15:58 Page:212  
DISK_OPEN.V.FSN#
      6088**DCL      6088--REDEF    6088--REDEF
DISK_OPEN.WSN_
      6054**DCL      6054--REDEF
DISK_READ.STATION_
      6112**DCL      6113--REDEF
DISK_READ.V.DVBYTE.REREAD#
      6124**DCL      6124--REDEF
DISK_READ.V.INDX#
      6122**DCL      6122--REDEF
DISK_WRITE.STATION_
      6150**DCL      6150--REDEF
DISK_WRITE.V.DVBYTE.VFC#
      6157**DCL      6157--REDEF
DPLIST$
      6535**DCL      6547--IMP-PTR
DPRESLIST$
      6549**DCL      6549--IMP-PTR
EFTWORD
      6670**DCL      6670--REDEF
FLI$RPT_ERR
      7083**DCL-ENT  7126--CALL
FPT_EXIT.V.STEPCC#
      5975**DCL      5975--REDEF
GET_NOW_UTS
      6526**DCL      7119<>CALL     7132<>CALL
I
      7076**DCL      7122<<DOINDEX  7123>>ASSIGN
M$CVOL
      5505**DCL-ENT  7124--CALL
M$TIME
      5569**DCL-ENT  7119--CALL     7132--CALL
NBR_SNLISTS
      5962**DCL      7122>>DOINDEX
NOW_UTS
      6514**DCL      7120>>ASSIGN   7133<>CALL
PL6.E3A0      #005=FLI$CHANGE_VOLUMES File=FLI$TAPE.:E05TSI                      TUE 07/29/97 15:58 Page:213  
PRE_RET_CLOSE.SN_
      6913**DCL      6913--REDEF
PRE_RET_CLOSE.UTL_
      6914**DCL      6914--REDEF
PRE_RET_CLOSE.V.EXPIRE#
      6928**DCL      6928--REDEF
PRE_RET_CLOSE.V.TYPE#
      6926**DCL      6926--REDEF
PRE_RET_CLOSE.V.XTNSIZE#
      6923**DCL      6923--REDEF    6925--REDEF
PRE_RET_OPEN.ACSVEH_
      6848**DCL      6849--REDEF
PRE_RET_OPEN.ALTKEYS_
      6854**DCL      6855--REDEF    6855--REDEF
PRE_RET_OPEN.HDR_
      6853**DCL      6854--REDEF
PRE_RET_OPEN.TAB_
      6852**DCL      6853--REDEF
PRE_RET_OPEN.UHL_
      6846**DCL      6847--REDEF    6847--REDEF
PRE_RET_OPEN.V.FSN#
      6886**DCL      6886--REDEF    6886--REDEF
PRE_RET_OPEN.WSN_
      6852**DCL      6852--REDEF
PRE_RET_READ.STATION_
      6703**DCL      6704--REDEF
PRE_RET_READ.V.DVBYTE.REREAD#
      6715**DCL      6715--REDEF
PRE_RET_READ.V.INDX#
      6713**DCL      6713--REDEF
PRE_RET_WRITE.STATION_
      6741**DCL      6741--REDEF
PRE_RET_WRITE.V.DVBYTE.VFC#
      6748**DCL      6748--REDEF
RET_CMDS_NAME.L#
      6957**DCL      6957--IMP-SIZ
PL6.E3A0      #005=FLI$CHANGE_VOLUMES File=FLI$TAPE.:E05TSI                      TUE 07/29/97 15:58 Page:214  
SNVECLIST$
      6489**DCL      6489--IMP-PTR
SPEC.START
      6553**DCL      6554--REDEF
SPEC.STOP
      6554**DCL      6555--REDEF
SPECCHARS
      6553**DCL      6553--REDEF
TAPE_CLOSE.SN_
      6406**DCL      6406--REDEF
TAPE_CLOSE.UTL_
      6407**DCL      6407--REDEF
TAPE_CLOSE.V.EXPIRE#
      6421**DCL      6421--REDEF
TAPE_CLOSE.V.TYPE#
      6419**DCL      6419--REDEF
TAPE_CLOSE.V.XTNSIZE#
      6416**DCL      6416--REDEF    6418--REDEF
TAPE_CVOL
      6464**DCL      7124<>CALL
TAPE_CVOL.V.DCB#
      6465**DCL      7123<<ASSIGN
TAPE_DCBLIST.DCB#
      5962**DCL      7123>>ASSIGN
TAPE_DCBLIST$
      5962**DCL      5962--IMP-PTR  7123>>ASSIGN
TAPE_OPEN.ACSVEH_
      6271**DCL      6272--REDEF
TAPE_OPEN.ALTKEYS_
      6277**DCL      6278--REDEF    6278--REDEF
TAPE_OPEN.HDR_
      6276**DCL      6277--REDEF
TAPE_OPEN.TAB_
      6275**DCL      6276--REDEF
TAPE_OPEN.UHL_
      6269**DCL      6270--REDEF    6270--REDEF
PL6.E3A0      #005=FLI$CHANGE_VOLUMES File=FLI$TAPE.:E05TSI                      TUE 07/29/97 15:58 Page:215  
TAPE_OPEN.V.FSN#
      6309**DCL      6309--REDEF    6309--REDEF
TAPE_OPEN.WSN_
      6275**DCL      6275--REDEF
TAPE_READ.STATION_
      6333**DCL      6334--REDEF
TAPE_READ.V.DVBYTE.REREAD#
      6345**DCL      6345--REDEF
TAPE_READ.V.INDX#
      6343**DCL      6343--REDEF
TAPE_WRITE.STATION_
      6371**DCL      6371--REDEF
TAPE_WRITE.V.DVBYTE.VFC#
      6378**DCL      6378--REDEF
TEMP
      7077**DCL      7133<>CALL     7134>>ASSIGN
TVECTOR.W2
      6502**DCL      6503--REDEF
XUD$UTS_DIFF
      7085**DCL-ENT  7133--CALL
