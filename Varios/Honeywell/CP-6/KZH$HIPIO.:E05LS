VERSION E05

PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:1    
        1        1        /*M*     KZH$HIPIO - Line driver code for HIP and passthru       */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMC */
        8        8
        9        9        /*P*     NAME:     KZH$HIPIO
       10       10                 PURPOSE:  KZH$HIPIO performs physical I/O for HIP lines.
       11       11                           It is called from KZP$DRIVER when some event
       12       12                           occurs on the line which causes a state transition
       13       13                           to take place.  This module is the handler of the
       14       14                           state transitions.
       15       15        */
       16       16        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:2    
       17       17        /*F*     NAME:     KZH$HIPIO
       18       18                 PURPOSE:  KZH$HIPIO is the entry point which is responsible
       19       19                           for driving physical HIP lines.  The code here
       20       20                           was formerly found in KZP$DRIVER or module
       21       21                           KZP$PSRV.  Secondary purpose of this module is
       22       22                           to provide a place where HIP protocol specific
       23       23                           code may live outside the common line manager
       24       24                           and inside the HIP glom.
       25       25        */
       26       26        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:3    
       27       27        /*D*     NAME:     KZH$HIPIO
       28       28                 CALL:     Call is from PL6 only.  Format is
       29       29                           CALL KZH$HIPIO (CTX,FPT) ALTRET (ALTRET_LOC);
       30       30                           "FPT" and "CTX" are common structures found in
       31       31                           includes KZ_BSCFPT and KZ$LINCTX respectively.
       32       32                           Module altreturns when it desires the common
       33       33                           line manager to move a state based on an event
       34       34                           that it has specified, or if it requires line
       35       35                           disconnect.
       36       36                 INTERFACE:
       37       37                           Calls KZV$HIPDV for interface to lower level
       38       38                           device code.  Also calls GGB$GETSYSMND, GGC$TCKTIM,
       39       39                           GGC$SETCLK, KZC$GO, G$ERR_LOG and KZT_ORDERS.
       40       40                 INPUT:    Line context, general bisync fpt structure.
       41       41                 OUTPUT:   Bits on the line.
       42       42        */
       43       43        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:4    
       44       44        KZH$HIPIO: PROC      ( KZ@LINCTX, KZ@BSCFPT ) ALTRET;
       45       45
       46       46            %INCLUDE LCP_6;
       47     4325            %INCLUDE KH$CHN;
       48     4447            %INCLUDE KZ$HIPBRACKET;
       49     4509            %INCLUDE KZ$LINCTX;
       50     5129            %INCLUDE KZ$HIPCTR; /* GET POLLING STRUCTURE FOR HIP DEVICES */
       51     5215            %INCLUDE KZ$HIPDEV;
       52     5482            %INCLUDE KZ$OTPBFR;
       53     5583            %INCLUDE KZ_BSCFPT;
       54     5613            %INCLUDE KZ_CLM_E;
       55     5785            %INCLUDE KZ_HIPTAB_C;
       56     6027            %INCLUDE KZ_LIN_C;
       57     6083            %INCLUDE KZ_PERR_C;
       58     6165            %INCLUDE KZ_MLCP_C;
       59     6240            %INCLUDE KZ_HIPEVT_C;
       60     6261            %INCLUDE KZ_CLMEVT_C;
       61     6303            %INCLUDE KH_CLKFNC_E;
       62     6348            %INCLUDE KH$CLK;
       63     6718            %INCLUDE KH$IO;
       64     6965            %INCLUDE GH_IOFNC_E;
       65     7034        /*  %INCLUDE G_LCP6_E;*/
       66     7035        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:5    
       67     7036
       68     7037            %KH$CHN(STCLASS="BASED(KZ@LINCTX.CHN$)");
       69     7161            %KZ$HIPHEAD; /* FOUND IN KZ$HIPBRACKET */
       70     7190            %KZ$HIPTAIL; /* FOUND IN KZ$HIPBRACKET */
       71     7215
       72     7216            %KZ$LINCTX     ( NAME = KZ@LINCTX,
       73     7217                             STCLASS = "" );
       74     7648                 %KZ$HIPCTR(NAME=KZ@HIPCTR,STCLASS=BASED);
       75     7685                 %KZ$HIPDEV(NAME=KZ@HIPDEV,STCLASS=BASED);
       76     7866            %KZ_BSCFPT     ( NAME = KZ@BSCFPT,
       77     7867                             STCLASS = "" );
       78     7876            %KZ$HIPCTR(STCLASS=BASED);
       79     7913            %KZ$HIPDEV(STCLASS=BASED);
       80     8094            %KZ$POLLHIP; /* FOUND IN KZ$HIPCTR */
       81     8104            %KZ_BSCFPTEQUS;
       82     8110        %EQU KZ#BFRTYP_OTP=0;
       83     8111            %KZ$OTPBFR     ( NAME = KZ$OTPBFR,
       84     8112                             STCLASS = BASED );
       85     8177            %KZ$EVENT(FPTN=KZ_EVENT,STCLASS=CONSTANT);
       86     8259            %KZ$EVENT(STCLASS=" ");
       87     8341            %KH$CLK(FPTN=KH_CLK_SET,FNC=%KH#CLK_SETCLK,STCLASS=CONSTANT);
       88     8490            %KH$CLK(STCLASS=" ");
       89     8639
       90     8640    1   DCL KVB$GETSYS ENTRY(2) ALTRET;
       91     8641    1   DCL KHC$TIME2 ENTRY(1) ALTRET;
       92     8642    1   DCL KHC$CLOCK ENTRY(1) ALTRET;
       93     8643    1   DCL KZT_GO@ EPTR SYMREF;
       94     8644    1   DCL KHA$ERRLOG ENTRY (2) ALTRET;
       95     8645    1   DCL KHI$IO_INPLCTBYT ENTRY(2);
       96     8646    1   DCL KHI$IO_OTPLCTBYT ENTRY(2);
       97     8647    1   DCL KZH$DSC_LINE ENTRY(1) ALTRET;
       98     8648        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:6    
       99     8649
      100     8650            %EQU Y#ID=0;
      101     8651
      102     8652    1   DCL LINESPEED UBIN /* CHARACTER RATE OF LINE */;
      103     8653    1   DCL DEV_ADR_NO SBIN;
      104     8654    1   DCL OBFR$ PTR;
      105     8655    1   DCL ENDX UBIN;
      106     8656    1   DCL CTR(0:0) UBIN BYTE BASED CALIGNED;
      107     8657    1   DCL CHRS CHAR(10) BASED ;
      108     8658    1   DCL TEMP_UBIN_32 SBIN(32) ALIGNED;
      109     8659    1   DCL 1 TEMP_BIT_32 REDEF TEMP_UBIN_32,
      110     8660    1         2 WD1 UBIN WORD,
      111     8661    1         2 WD2 UBIN WORD;
      112     8662    1   DCL TEMP_BIT16 BIT(16) ALIGNED;
      113     8663    1   DCL I REDEF TEMP_BIT16 UBIN;
      114     8664    1   DCL TNOW UBIN(32);
      115     8665    1   DCL 1 TNOW_SPLIT REDEF TNOW,
      116     8666    1         2 WD1 UBIN,
      117     8667    1         2 WD2 UBIN;
      118     8668    1   DCL INACT_POLL_TICS UBIN(16);
      119     8669    1   DCL POLL_INTERVAL UBIN(16);
      120     8670        /*       VARIABLES SET BY THE INPUT PARSER: */
      121     8671    1   DCL ACKS(0:15) BIT(1) /* ACK SEEN ON THIS DEVICE */;
      122     8672    1   DCL NAKS(0:15) BIT(1) /* NAK SEEN ON THIS DEVICE */;
      123     8673    1   DCL BUSY(0:15) BIT(1) /* BSY SEEN ON THIS DEVICE */;
      124     8674    1   DCL PGOV(0:15) BIT(1) /* PGOV SEEN ON THIS DEVICE */;
      125     8675    1   DCL NAV(0:15) BIT(1) /* NA message */;
      126     8676
      127     8677        %KZ$INPDESC(STCLASS=" ");  /* FOUND IN KZ$HIPCTR */
      128     8682
      129     8683    1   DCL 1 INPUT,
      130     8684    1         2 FIRST SBIN,
      131     8685    1         2 ENDING_ETX SBIN,
      132     8686    1         2 PRESENT BIT(1);
      133     8687
      134     8688
      135     8689    1   DCL KVB$RLSSYS ENTRY(2) ALTRET;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:7    
      136     8690    1   DCL KZT_ORDERS@ EPTR SYMREF;
      137     8691    1   DCL KZH$HIPSTT ENTRY(2) ALTRET;
      138     8692    1   DCL KZH$HIPDV  ENTRY(3) ALTRET;
      139     8693
      140     8694        /*   BUILD TABLES FOR SYNC LINE MANAGER */
      141     8695
      142     8696        /*  %KZ_HIP_STBL;   */
      143     8697        /*  %KZ_HIP_MAP;    */
      144     8698        %KH$IO(FPTN=KH_OTPLCT,FNC=%GH#IO_OTPLCTBYT,STCLASS=STATIC);
      145     8812        %KH$IO(FPTN=KH_INPLCT,FNC=%GH#IO_INPLCTBYT,STCLASS=STATIC);
      146     8926
      147     8927        /*  CONSTANT DATA */
      148     8928
      149     8929    1   DCL PRINTER_CHECK_INTERVAL CONSTANT SYMDEF UBIN(16) INIT(64000);
              8929            /* interval between checking for printer timeouts */
      150     8930    1   DCL INACTIVE_POLL_RATIO UBIN CONSTANT INIT(3);
              8930            /* RATIO BETWEEN PROFILE INTERVAL AND INACTIVE CONTROLLER POLL TIME */
      151     8931
      152     8932    1   DCL PENQ_MSG CHAR(4) CONSTANT INIT(%CONCAT(BITASC('1B'X),'[8p'));
      153     8933
      154     8934    1   DCL DEVBYTES_B(0:7) BIT(8) CONSTANT INIT(
      155     8935    1                 'E0'X,'68'X,'00'X*6);
      156     8936    1   DCL DEVBYTES_C REDEF DEVBYTES_B CHAR(8);
      157     8937
      158     8938        /* STA BYTES THAT GO ALONG WITH DEV BYTES */
      159     8939    1   DCL STABYTES_B(0:7) BIT(8) CONSTANT INIT(
      160     8940    1        '80'X,'1A'X,'80'X*6);
      161     8941
      162     8942    1   DCL BAUDMAPS(0:15) UBIN CONSTANT INIT(50,75,110,134,150,200,300,600,1050,
      163     8943    1                                         1200,1800,2000,2400,4800,9600,19200);
      164     8944
      165     8945            %KZ$HIPTAIL(NAME=KZ@HIPTAIL,STCLASS=CONSTANT);
      166     8970            %KZ$HIPHEAD(NAME=KZ@HIPHEAD,STCLASS=CONSTANT);
      167     8999
      168     9000        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:8    
      169     9001        /* CAVEAT: Dont expect to follow this code
      170     9002                   without a listing of KZ_HIPTABIN_C
      171     9003                   beside you. All the states,events,
      172     9004                   and actions are necessary to have
      173     9005                   even a prayer of comprehending
      174     9006                   what's going on.
      175     9007        */
      176     9008    1           KZ$EVENT=KZ_EVENT;
      177     9009    1           KZ$EVENT.LINCTX$=ADDR(KZ@LINCTX);
      178     9010
      179     9011    2           DO CASE ( KZ@BSCFPT.ACT );
      180     9012        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:9    
      181     9013        /*       %KZ#HIPACT_GO
      182     9014                      This is the action taken when DSR is high,
      183     9015                      the profile from the auto logon string from
      184     9016                      FEPCON has been verified as OK, and the line
      185     9017                      profile is HIP
      186     9018        */
      187     9019    2            CASE(%KZ#HIPACT_GO);
      188     9020
      189     9021        /*       It is important to change the LRC polynomial to be
      190     9022                 the ASCII LRC. If this is not changed, the MLCP will
      191     9023                 continue to speak EBCDIC and all is lost
      192     9024             */
      193     9025    2              KH_OTPLCT.LCTBYT.ADR=BITBIN('02'X);
      194     9026    2              KH_OTPLCT.LCTBYT.DAT=BITBIN('C6'X);
      195     9027    2              CALL KHI$IO_OTPLCTBYT(KZ@LINCTX.CHN$->KH$CHN,KH_OTPLCT);
      196     9028    2              KH_OTPLCT.LCTBYT.ADR=BITBIN('22'X);
      197     9029    2              KH_OTPLCT.LCTBYT.DAT=BITBIN('C6'X);
      198     9030    2              CALL KHI$IO_OTPLCTBYT(KZ@LINCTX.CHN$->KH$CHN,KH_OTPLCT);
      199     9031    2              KZ@LINCTX.TIMR.SPCPOL=0;
      200     9032    2              KZ@LINCTX.TIMR.GENPOL=0;
      201     9033    2              KZ@LINCTX.TIMER.POL=0;
      202     9034
      203     9035        /*       Set up the timeout values */
      204     9036    2              LINESPEED=BAUDMAPS(KH$CHN.LINSPD)/8 /* SPEED IN BYTES PER SECOND */ ;
      205     9037        /*         KZ@LINCTX.TIMOUT.PRIMARY=     allows for one buffer load + 500 ms line tu
              9037        rnaround time
      206     9038                     (KZ@LINCTX.PRO.BLKBYTES+LENGTHC(KZ$HIPHEAD)+LENGTHC(KZ$HIPTAIL)
      207     9039                     +LINESPEED -1 +LINESPEED/2 )/LINESPEED;*/
      208     9040        /*         KZ@LINCTX.TIMOUT.SECONDARY=    allows for one buffr load in, 250 ms turna
              9040        round per possible controller
      209     9041                     (2*(KZ@LINCTX.PRO.BLKBYTES+LENGTHC(KZ$HIPHEAD)+LENGTHC(KZ$HIPTAIL))
      210     9042                     +LINESPEED -1+ LINESPEED*KZ@LINCTX.POLSIZ/4 )/LINESPEED;*/
      211     9043    2              KZ@LINCTX.TIMOUT.PRIMARY= 2;
      212     9044    2              KZ@LINCTX.TIMOUT.SECONDARY= 2;
      213     9045
      214     9046        /* Because I may have to live with 3270's, use my
      215     9047           stats buffer only if 3270's is absent */
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:10   
      216     9048
      217     9049        /*            **** ASSUME NO 3270'S EXIST ****
      218     9050                   IF ADDR(KZ@STT)=ADDR(NIL) THEN
      219     9051                   DO;
      220     9052                      KZ@HIPSTT$=ADDR(KZ@HIPSTT_STATIC);
      221     9053                      KZ_HIP_HDR.STTBFR$=ADDR(KZ@HIPSTT_KZO);
      222     9054                      END;
      223     9055                   ELSE
      224     9056                   DO;
      225     9057                      KZ@HIPSTT$=ADDR(KZ@STT);
      226     9058                      KZ_HIP_HDR.STTBFR$=ADDR(KZ@BSCSTT);
      227     9059                      END;
      228     9060        */
      229     9061
      230     9062        /* Unfortunately, the input buffer acquired for me is too small:
      231     9063             need to be able to handle a full screen's worth of info.
      232     9064
      233     9065            Release the current input buffer and get a buffer big enuf to
      234     9066            handle everything.
      235     9067        */
      236     9068
      237     9069    2              CALL KVB$RLSSYS(KZ@LINCTX.INPBFRSIZ,KZ@LINCTX.INPBFR$);
      238     9070    2              KZ@LINCTX.INPBFRSIZ=1024;
      239     9071    2              CALL KVB$GETSYS(KZ@LINCTX.INPBFRSIZ,KZ@LINCTX.INPBFR$)
      240     9072    2              WHENALTRETURN
      241     9073    3              DO;
      242     9074    3                 CALL ERRLOG (%E$NO_MEMORY);
      243     9075    3                 KZ@LINCTX.INPBFR$ = ADDR (NIL);
      244     9076    3                 KZ@LINCTX.INPBFRSIZ = 0;
      245     9077    3                 CALL KZH$DSC_LINE (KZ@LINCTX);
      246     9078    3                 RETURN;
      247     9079    3                 END;
      248     9080    2              KZ@LINCTX.OTPCNT=0;
      249     9081
      250     9082        /*      KZ@LINCTX.OTPCNT does not get set to zero by common line driver. Zap it now.
              9082             */
      251     9083    2              IF KZ@LINCTX.OTPHD$=ADDR(NIL) THEN
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:11   
      252     9084    2                 KZ@LINCTX.OTPCNT=0;
      253     9085
      254     9086
      255     9087
      256     9088        /*       Now begin at the normal restart point for polled vip:
      257     9089                 search for output to send.
      258     9090        */
      259     9091    2              KZ@BSCFPT.EVT= %KZ#HIPEVT_SEARCH;
      260     9092    2              KZ@BSCFPT.FNC= %KZ#FNC_MOV;
      261     9093    2              ALTRETURN;
      262     9094             %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:12   
      263     9095        /*       %KZ#HIPACT_URCERR,KZ#HIPACT_DSRDROP
      264     9096                      Currently there is no code in the MLCP that signals
      265     9097                      an unrecoverable error. This case included only for
      266     9098                      completeness.
      267     9099        */
      268     9100    2            CASE(%KZ#HIPACT_URCERR,%KZ#HIPACT_DSRDROP);
      269     9101
      270     9102        /* I keep the current output buffer linked onto the device.
      271     9103           Thus, there is no reason for common line manager to
      272     9104           release the current output buffer.
      273     9105
      274     9106           Set the current output buffer address to NIL
      275     9107        */
      276     9108
      277     9109
      278     9110    2              KZ@BSCFPT.FNC=%KZ#FNC_DSC /* Tell CLM to disconnect */;
      279     9111    2              ALTRETURN;
      280     9112        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:13   
      281     9113        /*       %KZ#HIPACT_SEARCH
      282     9114                      This is the action used to find device that
      283     9115                      has any output pending. If no output is pending,
      284     9116                      then merely go back to state 'MAIN', which will
      285     9117                      be kicked off MAIN by the clock when its time to
      286     9118                      poll.
      287     9119        */
      288     9120    2            CASE(%KZ#HIPACT_SEARCH);
      289     9121
      290     9122    2              CALL SET_TNOW;
      291     9123
      292     9124    2              CALL CHECK_INTERVAL(PRINTER_CHECK_INTERVAL,KZ@LINCTX.TIMR.SPCPOL) ALTRET(
              9124                       CHECKING_PRINTERS);
      293     9125
      294     9126    3              DO WHILE('0'B);
      295     9127    3   CHECKING_PRINTERS:;
      296     9128    3                 CALL GOOSE_PRINTERS;
      297     9129    3                 END;
      298     9130
      299     9131    2              KZ@LINCTX.TIMOUT.USESEC='0'B; /* USE SHORT TIMEOUT VALUE */
      300     9132    2              KZ@LINCTX.RTRCNT=0;
      301     9133    2              KZ$EVENT.EVENT=%KZ#LINFCN_GETOTP;
      302     9134    2              CALL KZ@LINCTX.DEVMGR@(KZ$EVENT)
      303     9135    2                ALTRET(SEARCH_FINDS_NOBODY);
      304     9136    2              KZ@BSCFPT.FNC=%KZ#FNC_MOV;
      305     9137    2              KZ@BSCFPT.EVT=%KZ#HIPEVT_SEND;
      306     9138    2              ALTRETURN;
      307     9139    2   SEARCH_FINDS_NOBODY:;
      308     9140    2   TIME_TO_POLL_ALL:;
      309     9141
      310     9142
      311     9143    2              KZ@BSCFPT.FNC=%KZ#FNC_MOV;
      312     9144    2              KZ@BSCFPT.EVT=%KZ#HIPEVT_POLALL;
      313     9145    2              KZ@LINCTX.RTRCNT=0;
      314     9146    2              KZ$EVENT.EVENT=%KZ#LINFCN_SPCPOLALL;
      315     9147    2              CALL KZ@LINCTX.DEVMGR@(KZ$EVENT)
      316     9148    2                ALTRET(NO_ACTIVE_CONTROLLERS);
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:14   
      317     9149    2              ALTRETURN;
      318     9150    2   NO_ACTIVE_CONTROLLERS:;
      319     9151    2              KZ@LINCTX.POLLTBL$->KZ$POLLHIP.CONTINUE_POLL='0'B;
      320     9152    2              ALTRETURN;
      321     9153        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:15   
      322     9154        /*       %KZ#HIPACT_POLALL
      323     9155                      It has been determined to poll everybody again.
      324     9156        */
      325     9157    2            CASE(%KZ#HIPACT_POLALL);
      326     9158    2              KZ@LINCTX.TIMOUT.USESEC='0'B; /* USE LONG TIMEOUT INTERVAL */
      327     9159    2              CALL CONTINUE_POLLING ALTRET(POLL_ALL_FINISHED);
      328     9160    2              RETURN;
      329     9161
      330     9162    2   POLL_ALL_FINISHED:;
      331     9163        /* And not a creature was stirring, not even a mouse */
      332     9164    2              KZ@BSCFPT.EVT= %KZ#HIPEVT_POLDUN;
      333     9165    2              KZ@BSCFPT.FNC= %KZ#FNC_MOV;
      334     9166    2              ALTRETURN;
      335     9167        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:16   
      336     9168        /*       %KZ#HIPACT_SEND
      337     9169                      Finally send a message.
      338     9170        */
      339     9171    2            CASE(%KZ#HIPACT_SEND);
      340     9172    2              OBFR$ = PINCRW(KZ@LINCTX.OTPBFR$,
      341     9173    2                SIZEW(KZ$OTPBFR));
      342     9174    2              KZ@LINCTX.OTPDATSIZ = KZ@LINCTX.OTPBFR$ ->
      343     9175    2                KZ$OTPBFR.DATA_SIZ+LENGTHC(KZ$HIPTAIL);
      344     9176    2              KZ@LINCTX.OTPBFR$=OBFR$;
      345     9177
      346     9178        /* Space has been left for link protocol header & trailer.
      347     9179            fill them in NOW with the detail */
      348     9180    2              OBFR$->KZ$HIPHEAD=KZ@HIPHEAD;
      349     9181    2              OBFR$->KZ$HIPHEAD.ADR_U=
      350     9182    2                KZ@LINCTX.OTPCTR$->KZ@HIPCTR.ADR+64;
      351     9183    3              DO SELECT(KZ@LINCTX.OTPCTR$->KZ@HIPCTR.TYP);
      352     9184    3                 SELECT(7700)/* SEPARATELY ADDRESSED PRINTER DEVICE */;
      353     9185    3                 DEV_ADR_NO=KZ@LINCTX.OTPDEV$->KZ@HIPDEV.ADR;
      354     9186    3                 SELECT(7814,7804)/* PRINTER ADDRESSED VIA ESCAPE SEQ */;
      355     9187    3                 DEV_ADR_NO=0;
      356     9188    3                 END;
      357     9189    2              OBFR$->KZ$HIPHEAD.DEV_B=
      358     9190    2                DEVBYTES_B(DEV_ADR_NO);
      359     9191    2              OBFR$->KZ$HIPHEAD.STA_B=
      360     9192    2                STABYTES_B(DEV_ADR_NO);
      361     9193    2              ENDX=KZ@LINCTX.OTPDATSIZ-LENGTHC(KZ@HIPTAIL);
      362     9194    2              CALL INSERT(OBFR$->CHRS,ENDX,LENGTHC(KZ@HIPTAIL),
      363     9195    2                SUBSTR(ADDR(KZ@HIPTAIL)->CHRS,0,LENGTHC(KZ@HIPTAIL)));
      364     9196    2              CALL INSERT(OBFR$->CHRS,ENDX+POFFC(ADDR(KZ@HIPTAIL.ADR_U),ADDR(KZ@HIPTAIL
              9196                       )),1,
      365     9197    2                BINASC(KZ@LINCTX.OTPCTR$->KZ@HIPCTR.ADR+32));
      366     9198
      367     9199    2              CALL SET_TNOW;
      368     9200    2              KZ@LINCTX.OTPDEV$->KZ$HIPDEV.XMT_TIME=TNOW;
      369     9201    2              KZ@LINCTX.RTRCNT=0;
      370     9202
      371     9203    2              CALL KZT_ORDERS@( %KZ#SEND_BLOCK, KZ@LINCTX );
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:17   
      372     9204        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:18   
      373     9205        /*       %KZ#HIPACT_SENDTO
      374     9206                      Implicit read of a reply timed out. Device
      375     9207                      (or controller) may not be powered up, or he
      376     9208                      never got the select or poll message
      377     9209
      378     9210                 Give the controller another chance at answering the message,
      379     9211                 by requeueing the selected device at the tail of output queue.
      380     9212                 If the controller does not answer the second time, hang him up.
      381     9213        */
      382     9214    2            CASE(%KZ#HIPACT_SENDTO);
      383     9215    2              KZ$EVENT.EVENT=%KZ#LINFCN_REQOTP;
      384     9216    2              CALL KZ@LINCTX.DEVMGR@(KZ$EVENT);
      385     9217    2              IF KZ@LINCTX.OTPCTR$->KZ$HIPCTR.TIMED_OUT_ONCE THEN
      386     9218    3              DO;
      387     9219    3                 KZ$EVENT.EVENT=%KZ#LINFCN_POLTIMOUT;
      388     9220    3                 CALL KZ@LINCTX.DEVMGR@(KZ$EVENT);
      389     9221    3                 END;
      390     9222    2              ELSE
      391     9223    3              DO;
      392     9224    3                 KZ@LINCTX.OTPCTR$->KZ$HIPCTR.TIMED_OUT_ONCE='1'B;
      393     9225    3                 END;
      394     9226    2              KZ@BSCFPT.FNC=%KZ#FNC_MOV;
      395     9227    2              KZ@BSCFPT.EVT=%KZ#HIPEVT_SEARCH;
      396     9228    2              ALTRETURN;
      397     9229        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:19   
      398     9230        /*       %KZ#HIPACT_SNDRSP
      399     9231                      A reply has been heard from a device. I hope
      400     9232                      its the same device to whom I just sent a message
      401     9233        */
      402     9234    2            CASE(%KZ#HIPACT_SNDRSP);
      403     9235    2              CALL PARSE_INPUT ;
      404     9236
      405     9237        /*  Sometimes a terminal will refuse to answer a msg with anything
      406     9238            other than EOT. The following special case code will recognize the
      407     9239            condition at treat it as if a NAK was rcv'd
      408     9240        */
      409     9241
      410     9242    2              IF KZ@LINCTX.RTRCNT~=0 THEN
      411     9243    2                 CALL ERRLOG(%E$HIPIO_OK);
      412     9244    2              KZ@LINCTX.CURCTR$->KZ$HIPCTR.TIMED_OUT_ONCE='0'B;
      413     9245    2              KZ@LINCTX.RTRCNT=0;
      414     9246    2              IF KZ@LINCTX.OTPDEV$~=ADDR(NIL) THEN
      415     9247    3              DO CASE(KZ@LINCTX.OTPDEV$->KZ$HIPDEV.ADR);
      416     9248    3               CASE(0);
      417     9249    3                 KZ@LINCTX.OTPDEV$->KZ$HIPDEV.KBDLCK='0'B;
      418     9250    3                 IF NOT (ACKS(0) OR NAKS(0) OR PGOV(0) OR INPUT.PRESENT) THEN
      419     9251    3                    NAKS(0)='1'B;
      420     9252    3               CASE(1);
      421     9253    3               END;
      422     9254    2              CALL SHIP_POSSIBLE_INPUT;
      423     9255    2              CALL PROCESS_IMMED_STATUS ;
      424     9256    2              CALL PROCESS_DELAYED_STATUS;
      425     9257    2              KZ@BSCFPT.FNC=%KZ#FNC_MOV;
      426     9258    2              KZ@BSCFPT.EVT=%KZ#HIPEVT_SEARCH;
      427     9259        /*  See if POLL interval has expired. If it has, then
      428     9260            start a general poll cycle.
      429     9261
      430     9262
      431     9263            Placing the test here means that at least ONE
      432     9264            block of output will be transmitted per poll
      433     9265            cycle, no matter how short that poll cycle is. */
      434     9266
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:20   
      435     9267    2              CALL SET_TNOW;
      436     9268    2              KZ@LINCTX.TIMOUT.USESEC='0'B; /* USE SHORT TIMEOUT VALUE */
      437     9269    2              POLL_INTERVAL=KZ@LINCTX.PRO.INTERVAL
      438     9270    2                  /* get to 1/120 second units */;
      439     9271    2              IF POLL_INTERVAL=0 THEN POLL_INTERVAL=120;
      440     9272    2              ELSE IF POLL_INTERVAL>1200 THEN POLL_INTERVAL=1200;
      441     9273    2              CALL CHECK_INTERVAL(POLL_INTERVAL,KZ@LINCTX.TIMR.GENPOL) ALTRET(
              9273                       TIME_TO_POLL_ALL);
      442     9274    2              ALTRETURN;
      443     9275        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:21   
      444     9276        /*       %KZ#HIPACT_SNDRCV
      445     9277                      A parity/checksum/structure error has just happened on
      446     9278                      the read of a replay after a send.
      447     9279
      448     9280                      Try to parse the input record, and take proper actions
      449     9281                      on any status messages that happen to be recognized.
      450     9282
      451     9283                      If it looks like input is present, then send a NAK off
      452     9284                      to the tube in order to get the input retransmitted.
      453     9285        */
      454     9286    2            CASE(%KZ#HIPACT_SNDRCV);
      455     9287    2              CALL PARSE_INPUT ;
      456     9288    2              IF KZ@LINCTX.OTPDEV$~=ADDR(NIL) THEN
      457     9289    3              DO CASE(KZ@LINCTX.OTPDEV$->KZ$HIPDEV.ADR);
      458     9290    3               CASE(0);
      459     9291    3                 KZ@LINCTX.OTPDEV$->KZ$HIPDEV.KBDLCK='0'B;
      460     9292    3                 IF NOT (BUSY(0) OR ACKS(0) OR NAKS(0) OR PGOV(0) OR INPUT.PRESENT)
              9292                          THEN
      461     9293    3                    NAKS(0)='1'B;
      462     9294    3               CASE(1);
      463     9295    3               END;
      464     9296    2              CALL PROCESS_IMMED_STATUS ;
      465     9297    2              CALL PROCESS_DELAYED_STATUS;
      466     9298    2              IF INPUT.PRESENT THEN
      467     9299    3              DO;
      468     9300    3                 CALL SEND_NAK ALTRET(SEND_NAK_COUNT_EXCEEDED);
      469     9301    3                 RETURN;
      470     9302    3   SEND_NAK_COUNT_EXCEEDED:;
      471     9303    3                 END;
      472     9304    2              KZ@BSCFPT.FNC=%KZ#FNC_MOV;
      473     9305    2              KZ@BSCFPT.EVT=%KZ#HIPEVT_SEARCH;
      474     9306    2              ALTRETURN;
      475     9307        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:22   
      476     9308        /*       %KZ#HIPACT_IPOLL
      477     9309                      A general poll has just been completed. Now
      478     9310                      one must do one good deed for this interval,
      479     9311                      and think abount polling the next controller
      480     9312                      on the inactive list.
      481     9313        */
      482     9314    2            CASE(%KZ#HIPACT_IPOLL);
      483     9315
      484     9316        /* See if enough time has elapsed since the last poll operation */
      485     9317    2              INACT_POLL_TICS=KZ@LINCTX.PRO.INTERVAL*KZ@LINCTX.PRO.BLKRECS*%(120/12)
              9317                       /* inactive poll time in 1/120 sec units */;
      486     9318    2              IF INACT_POLL_TICS=0 THEN INACT_POLL_TICS=120;
      487     9319    2              ELSE IF INACT_POLL_TICS>1800 THEN INACT_POLL_TICS=1800;
      488     9320    2              CALL SET_TNOW;
      489     9321    2              CALL CHECK_INTERVAL(INACT_POLL_TICS,KZ@LINCTX.TIMER.POL)
      490     9322    2                ALTRET(INACT_POLL_EXPIRED);
      491     9323
      492     9324        /* INACTIVE POLL INTERVAL NOT UP YET, IF NO OUTPUT POLL ANYWAY */
      493     9325    2              KZ$EVENT.EVENT=%KZ#LINFCN_GETOTP;
      494     9326    2              CALL KZ@LINCTX.DEVMGR@(KZ$EVENT)
      495     9327    2                ALTRET(NO_INACT_OUTPUT_PENDING);
      496     9328    2              KZ@BSCFPT.FNC=%KZ#FNC_MOV;
      497     9329    2              KZ@BSCFPT.EVT=%KZ#HIPEVT_SEND;
      498     9330    2              ALTRETURN;
      499     9331    2   NO_INACT_OUTPUT_PENDING:;
      500     9332
      501     9333        /* POLL INTERVAL NOT UP YET, BUT NO OUTPUT PENDING. USE
      502     9334           THE IDLE TIME TO POLL NEXT   ACTIVE CONTROLLER */
      503     9335    2              KZ@LINCTX.TIMER.POL=TNOW;
      504     9336
      505     9337    2   INACT_POLL_EXPIRED:;
      506     9338
      507     9339    2              KZ$EVENT.EVENT=%KZ#LINFCN_INACT_CTR;
      508     9340    2              CALL KZ@LINCTX.DEVMGR@(KZ$EVENT)
      509     9341    2                ALTRET(NO_INACTIVE_CONTROLLERS_EXIST);
      510     9342    2              KZ@LINCTX.OTPDATSIZ = 1;
      511     9343    2              KZ@LINCTX.OTPBFR$ = ADDR(KZ@LINCTX.POLADR.CTR);
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:23   
      512     9344    2              KZ@LINCTX.TIMOUT.USESEC='0'B;/* SHORT TIMEOUT, ENUF FOR SCREEN */
      513     9345    2              CALL KZT_ORDERS@(%KZ#SEND_GEPOLL,KZ@LINCTX);
      514     9346    2              RETURN;
      515     9347    2   NO_INACTIVE_CONTROLLERS_EXIST:;
      516     9348        /* Now the POLL all has been completed, and there are
      517     9349           no inactive controllers to poll. Check once more
      518     9350           for output pending. If no output exists, then
      519     9351           suspend the line for the poll interval.
      520     9352        */
      521     9353    2              KZ$EVENT.EVENT=%KZ#LINFCN_GETOTP;
      522     9354    2              CALL KZ@LINCTX.DEVMGR@(KZ$EVENT)
      523     9355    2                ALTRET(LINE_IS_TRULY_IDLE);
      524     9356    2              KZ@BSCFPT.FNC=%KZ#FNC_MOV;
      525     9357    2              KZ@BSCFPT.EVT=%KZ#HIPEVT_SEND;
      526     9358    2              ALTRETURN;
      527     9359    2   LINE_IS_TRULY_IDLE:;
      528     9360    2              KH$CLK=KH_CLK_SET;
      529     9361    2              KH$CLK.PRD=KZ@LINCTX.PRO.INTERVAL/12 /* get to 1 second units */;
      530     9362    2              IF KH$CLK.PRD=0 THEN KH$CLK.PRD=1;
      531     9363    2              ELSE IF KH$CLK.PRD>10 THEN KH$CLK.PRD=10;
      532     9364    2              I=TNOW-KZ@LINCTX.TIMR.GENPOL;
      533     9365    2              I=I/120;
      534     9366    2              IF KH$CLK.PRD<=I THEN
      535     9367    2                 KH$CLK.PRD=1;
      536     9368    2              ELSE
      537     9369    2                 KH$CLK.PRD=KH$CLK.PRD-I;
      538     9370    2              KH$CLK.PRDUNT=%KH#C_SEC;
      539     9371    2              KH$CLK.UID$=ADDR(KZ@LINCTX);
      540     9372    2              KH$CLK.SBR$=KZT_GO@;
      541     9373    2              CALL KHC$CLOCK(KH$CLK) ALTRET (OUCH);
      542     9374    2              KZ@LINCTX.CTB.PRM$=KH$CLK.CTBCTX$;
      543     9375    2              KZ@LINCTX.PRMCTBTYP=%KZ#CTBTYP_DELAY;
      544     9376    2              RETURN;
      545     9377    2   OUCH:      CALL M$XXX;
      546     9378        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:24   
      547     9379        /*       %KZ#HIPACT_STOP
      548     9380                      The clock has just finished ticking. Set the address
      549     9381                      of the clock param in the line context to be NIL,
      550     9382                      then search for output
      551     9383
      552     9384                      I should have picked a better name for the action, but
      553     9385                      B03 has closed, and this is one of the few I didn't
      554     9386                      have use before this code was added.
      555     9387        */
      556     9388
      557     9389    2            CASE(%KZ#HIPACT_STOP);
      558     9390    2              KZ@LINCTX.CTB.PRM$=ADDR(NIL);
      559     9391    2              KZ@LINCTX.PRMCTBTYP= 0 /* ANYTHING, JUST SO IT'S NOT MINE */;
      560     9392    2              KZ@BSCFPT.FNC=%KZ#FNC_MOV;
      561     9393    2              KZ@BSCFPT.EVT=%KZ#HIPEVT_SEARCH;
      562     9394    2              ALTRETURN;
      563     9395        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:25   
      564     9396        /*       %KZ#HIPACT_POLLTO
      565     9397                      The guy just polled on the general polled list
      566     9398                      did not answer. Give him a another chance to answer
      567     9399                      a poll (on the next polling cycle), then assume
      568     9400                      the terminal has been turned off. */
      569     9401    2            CASE(%KZ#HIPACT_POLLTO);
      570     9402
      571     9403    2              CALL ISOLATE_GPOLL_STOPPER ALTRET(DISCONNECT_NOW);
      572     9404
      573     9405        /*    Report to device manager that controller did not answer
      574     9406        */
      575     9407    2              IF KZ@LINCTX.CURCTR$->KZ$HIPCTR.TIMED_OUT_ONCE THEN
      576     9408    3              DO;
      577     9409    3                 KZ$EVENT.EVENT=%KZ#LINFCN_POLTIMOUT;
      578     9410    3                 CALL KZ@LINCTX.DEVMGR@(KZ$EVENT)
      579     9411    3                   ALTRET(TIMED_OUT_GUY_IS_LAST);
      580     9412    3                 END;
      581     9413    2              ELSE
      582     9414    2                 KZ@LINCTX.CURCTR$->KZ$HIPCTR.TIMED_OUT_ONCE='1'B;
      583     9415
      584     9416        /*    Continue the poll of all controllers
      585     9417        */
      586     9418    2              CALL CONTINUE_POLLING
      587     9419    2                ALTRET(TIMED_OUT_GUY_IS_LAST);
      588     9420    2              RETURN;
      589     9421    2   TIMED_OUT_GUY_IS_LAST:;
      590     9422    2              KZ@BSCFPT.EVT= %KZ#HIPEVT_POLDUN;
      591     9423    2              KZ@BSCFPT.FNC= %KZ#FNC_MOV;
      592     9424    2              ALTRETURN;
      593     9425        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:26   
      594     9426        /*       %KZ#HIPACT_POLANS
      595     9427                      One particular device answered with a non-null
      596     9428                      message on a general poll.
      597     9429        */
      598     9430    2            CASE(%KZ#HIPACT_POLANS);
      599     9431    2              CALL ISOLATE_GPOLL_STOPPER ALTRET(DISCONNECT_NOW);
      600     9432
      601     9433
      602     9434        /* THE CURRENT CONTROLLER DID *NOT* TIME OUT, RESET 'TIMED_OUT_ONCE' BIT */
      603     9435
      604     9436    2              KZ@LINCTX.CURCTR$->KZ$HIPCTR.TIMED_OUT_ONCE='0'B;
      605     9437        /*       It may be that only an 'EOT' was received as a reply.
      606     9438                 This signifies that the polling list was exhausted. */
      607     9439
      608     9440    3              IF KZ@BSCFPT.SIZ<=1 THEN DO;
      609     9441    3                 CALL CONTINUE_POLLING ALTRET (LAST_CONTROLLER_HAD_DATA);
      610     9442    3                 RETURN;
      611     9443    3                 END;
      612     9444    2              IF KZ@LINCTX.RTRCNT~=0 THEN
      613     9445    2                 CALL ERRLOG(%E$HIPIO_OK);
      614     9446    2              KZ@LINCTX.RTRCNT=0;
      615     9447    2              CALL PARSE_INPUT;
      616     9448    2              CALL PROCESS_DELAYED_STATUS;
      617     9449    2              CALL SHIP_POSSIBLE_INPUT;
      618     9450    2              CALL CONTINUE_POLLING
      619     9451    2                ALTRET(LAST_CONTROLLER_HAD_DATA);
      620     9452    2              RETURN;
      621     9453    2   LAST_CONTROLLER_HAD_DATA:;
      622     9454    2              KZ@BSCFPT.EVT= %KZ#HIPEVT_POLDUN;
      623     9455    2              KZ@BSCFPT.FNC= %KZ#FNC_MOV;
      624     9456    2              ALTRETURN;
      625     9457        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:27   
      626     9458        /*       %KZ#HIPACT_GPRCV
      627     9459                      Recoverable error on a device while
      628     9460                      doing a general poll.
      629     9461                      Tere are only two kinds of messages that may be garbled:
      630     9462                      printer ACK and keyboard input.
      631     9463
      632     9464                      Examine block for possiblities of either message, and
      633     9465                      if keyboard input looks like it might be there, send
      634     9466                      a NAK to get the keyboard input back in a later block.
      635     9467        */
      636     9468    2            CASE(%KZ#HIPACT_GPRCV);
      637     9469    2              CALL ISOLATE_GPOLL_STOPPER ALTRET(DISCONNECT_NOW);
      638     9470    2              KZ@LINCTX.CURCTR$->KZ$HIPCTR.TIMED_OUT_ONCE='0'B;
      639     9471    2              CALL PARSE_INPUT;
      640     9472    2              CALL PROCESS_DELAYED_STATUS;
      641     9473    2              IF INPUT.PRESENT THEN
      642     9474    2                 CALL SEND_NAK ALTRET(POLL_NAK_COUNT_EXCEEDED);
      643     9475    2              ELSE
      644     9476    2                 CALL CONTINUE_POLLING ALTRET(LAST_CONTROLLER_HAD_DATA);
      645     9477    2              RETURN;
      646     9478    2   POLL_NAK_COUNT_EXCEEDED:;
      647     9479    2              CALL CONTINUE_POLLING ALTRET(LAST_CONTROLLER_HAD_DATA);
      648     9480    2              RETURN;
      649     9481        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:28   
      650     9482        /*       %KZ#HIPACT_NUTERM
      651     9483                      A controller just answered a poll while
      652     9484                      he was on the inactive list.
      653     9485        */
      654     9486    2            CASE(%KZ#HIPACT_NUTERM);
      655     9487    2              KZ$EVENT.EVENT=%KZ#LINFCN_NEWCTR;
      656     9488    2              CALL KZ@LINCTX.DEVMGR@(KZ$EVENT);
      657     9489    2              KZ@BSCFPT.FNC=%KZ#FNC_MOV;
      658     9490    2              KZ@BSCFPT.EVT=%KZ#HIPEVT_SEARCH;
      659     9491    2              ALTRETURN;
      660     9492        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:29   
      661     9493        /*       %KZ#HIPACT_IPRCV
      662     9494                      Recoverable error while doing an inactive
      663     9495                      poll. Just forget that any response has been heard.
      664     9496                      Eventually I will get around to trying this guy again,
      665     9497                      and he will finally get logged on.
      666     9498        */
      667     9499    2            CASE(%KZ#HIPACT_IPRCV);
      668     9500    2              KZ@BSCFPT.FNC=%KZ#FNC_MOV;
      669     9501    2              KZ@BSCFPT.EVT=%KZ#HIPEVT_SEARCH;
      670     9502    2              ALTRETURN;
      671     9503    2            END /* GIANT DO CASE */;
      672     9504    1           RETURN;
      673     9505
      674     9506    1   DISCONNECT_NOW:;
      675     9507    1           KZ@BSCFPT.FNC=%KZ#FNC_DSC;
      676     9508    1           ALTRETURN;
      677     9509        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:30   
      678     9510    1   PARSE_INPUT:PROC ALTRET;
      679     9511
      680     9512        /* I expect at most 3 records per HIP block:
      681     9513        1) terminal ACK (it heard my screenfull ok)
      682     9514           terminal NAK (it did not like what I sent)
      683     9515        2) printer  ACK (printer wants to be fed more data)
      684     9516             or
      685     9517           printer  BSY  (retransmission of data on printer timeout ONLY,
      686     9518                          signifies the printer is still manual.)
      687     9519             or
      688     9520           printer NAK (it did not like the checksum)
      689     9521        3) terminal NUL (keyboard input transmission)
      690     9522
      691     9523           The only real work this routine does is to parse the input,
      692     9524           setting flags which reflect the input message.
      693     9525
      694     9526         *FLASH*      this routine has been expanded to try and parse
      695     9527                      blocks with known errors. The MLCP will filter
      696     9528                      out the gross malformations of structure, but
      697     9529                      incompatable/erroneous/contradictory information
      698     9530                      will remain.
      699     9531
      700     9532                 This routine will do the best it can.
      701     9533        */
      702     9534
      703     9535    2   DCL INDX SBIN /* INDEX INTO BUFFER */;
      704     9536    2   DCL LENX SBIN /* SIZE OF BUFFER */;
      705     9537
      706     9538    2   DCL IBFR$ PTR;
      707     9539
      708     9540    2   DCL IBFR CHAR(LENX) BASED(IBFR$);
      709     9541
      710     9542    2   DCL I SBIN;
      711     9543    2   DCL ADR CHAR(1);
      712     9544    2   DCL ADR_INDX SBIN;
      713     9545    2   DCL STA CHAR(1);
      714     9546    2   DCL STA_INDX SBIN;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:31   
      715     9547
      716     9548    2   DCL STABYTES_C CHAR(6) CONSTANT INIT(
      717     9549    2       %CONCAT(%BITASC('86'X),%BITASC('15'X),%BITASC('80'X),%BITASC('EF'X),%BITASC(
              9549                '6E'X),%BITASC('6D'X)));
      718     9550
      719     9551    2   DCL PDENQ CHAR(4) CONSTANT INIT(%CONCAT(BITASC('9B'X),BITASC('5B'X),BITASC('B9'X),
              9551            BITASC('70'X)));
      720     9552
      721     9553    2   DCL PENQ CHAR(4) CONSTANT INIT(%CONCAT(BITASC('9B'X),BITASC('5B'X),BITASC('38'X),
              9553            BITASC('70'X)));
      722     9554
      723     9555    2   DCL T$ PTR;
      724     9556
      725     9557    2   DCL 1 P7814,
      726     9558    2         2 PDENQ BIT(1),
      727     9559    2         2 INDX SBIN,
      728     9560    2         2 STATUS CHAR(8),
      729     9561    2         2 S(0:7) REDEF STATUS BIT(8);
      730     9562
      731     9563    2           LENX=KZ@BSCFPT.SIZ;
      732     9564
      733     9565    2           IBFR$=KZ@LINCTX.INPBFR$;
      734     9566    2           INDX=0;
      735     9567    2           ACKS='0'B;
      736     9568    2           NAKS='0'B;
      737     9569    2           BUSY='0'B;
      738     9570    2           PGOV='0'B;
      739     9571    2           NAV='0'B;
      740     9572    2           INPUT.PRESENT='0'B;
      741     9573
      742     9574    3   PARSING_INPUT: DO WHILE ((LENX-INDX)>=6);
      743     9575
      744     9576    3              ADR=SUBSTR(IBFR,INDX,1);
      745     9577    3              STA=SUBSTR(IBFR,INDX+1,1);
      746     9578
      747     9579    3              CALL INDEX(ADR_INDX,ADR,DEVBYTES_C) ALTRET(UNKNOWN_DEVICE);
      748     9580
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:32   
      749     9581    4              DO WHILE('0'B);
      750     9582    4   UNKNOWN_DEVICE: ADR_INDX=15;
      751     9583    4                 CALL ERRLOG(%E$UNKNADR,INDX);
      752     9584        /*E*          ERROR: KZH-E$UNKNADR
      753     9585                    MESSAGE: Unrecognized ADR byte in message fragment
      754     9586                DESCRIPTION: Unknown ADR byte in HIP fragment.
      755     9587                              V0 = CHANNEL NUMBER
      756     9588                              V1 = NUMBER OF RETRIES BEFORE GOOD COMPLETION
      757     9589                              V2 = INDEX INTO BUFFER
      758     9590                              DATA = INPUT BUFFER
      759     9591        */
      760     9592    4                 END;
      761     9593
      762     9594    3              CALL INDEX(STA_INDX,STA,STABYTES_C) ALTRET(UNKNOWN_STATUS);
      763     9595
      764     9596    4              DO WHILE ('0'B);
      765     9597    4   UNKNOWN_STATUS: STA_INDX=15;
      766     9598    4                 CALL ERRLOG(%E$UNKNSTA,INDX);
      767     9599        /*E*          ERROR: KZH-E$UNKNSTA
      768     9600                    MESSAGE: Unrecognized STA byte in message fragment
      769     9601                DESCRIPTION: Unknown STA byte in HIP fragment.
      770     9602                              V0 = CHANNEL NUMBER
      771     9603                              V1 = NUMBER OF RETRIES BEFORE GOOD COMPLETION
      772     9604                              V2 = INDEX INTO BUFFER
      773     9605                              DATA = INPUT BUFFER
      774     9606        */
      775     9607    4                 END;
      776     9608
      777     9609    4              DO CASE(STA_INDX);
      778     9610
      779     9611    4               CASE(0 /* ACK */);
      780     9612    4                 ACKS(ADR_INDX)='1'B;
      781     9613    4                 INDX=INDX+7;
      782     9614
      783     9615    4               CASE(1 /* NAK */);
      784     9616    4                 NAKS(ADR_INDX)='1'B;
      785     9617    4                 INDX=INDX+7;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:33   
      786     9618
      787     9619    4               CASE(2 /* NUL */);
      788     9620    4                 INPUT.FIRST=INDX+5;
      789     9621
      790     9622    4                 CALL INDEX(INPUT.ENDING_ETX,%BITASC('83'X),IBFR,INPUT.FIRST)
      791     9623    4                   ALTRET(CANT_FIND_ENDING_ETX);
      792     9624
      793     9625
      794     9626    4                 INDX=INPUT.ENDING_ETX+2;
      795     9627    4                 INPUT.PRESENT=( ADR_INDX=0 );
      796     9628
      797     9629        /* Scan the input stream for printer status from DENQ,
      798     9630           but only if this is a 7804/7814 device and only if
      799     9631           a printer in configed and output is active to the printer.
      800     9632        */
      801     9633    4                 IF (INPUT.ENDING_ETX-INPUT.FIRST)>=8 THEN
      802     9634    5   PRINTER_LOOK: DO SELECT(KZ@LINCTX.CURCTR$->KZ$HIPCTR.TYP);
      803     9635    5                    SELECT(7804,7814);
      804     9636    5                    T$=KZ@LINCTX.CURCTR$->KZ$HIPCTR.DEVHD$;
      805     9637    6                    DO WHILE(T$~=ADDR(NIL));
      806     9638    6                       IF T$->KZ@HIPDEV.PRINTER THEN
      807     9639    7                       DO; /* FOUND PRINTER */;
      808     9640    7                          CALL  INDEX(P7814.INDX,PDENQ,IBFR,INPUT.FIRST)
      809     9641    8                          WHENRETURN DO;
      810     9642    8                             P7814.PDENQ='1'B;
      811     9643    8                             GOTO DO_PENQ;
      812     9644    8                             END;
      813     9645    7                          CALL  INDEX(P7814.INDX, PENQ,IBFR,INPUT.FIRST)
      814     9646    8                          WHENRETURN DO;
      815     9647    8                             P7814.PDENQ='0'B;
      816     9648    8   DO_PENQ:                  P7814.STATUS=SUBSTR(IBFR,P7814.INDX,8);
      817     9649    8                             SUBSTR(IBFR,P7814.INDX,
      818     9650    8                               INPUT.ENDING_ETX-P7814.INDX-8)=
      819     9651    8                               SUBSTR(IBFR,P7814.INDX+8,INPUT.ENDING_ETX);
      820     9652    8                             INPUT.ENDING_ETX=INPUT.ENDING_ETX-8;
      821     9653    8                             IF INPUT.ENDING_ETX=INPUT.FIRST THEN
      822     9654    8                                INPUT.PRESENT='0'B;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:34   
      823     9655        /* printer status has been moved aside and the buffer has had
      824     9656           the printer status removed.
      825     9657
      826     9658           Look at the printer status, and set ACK/NAK/BSY flags to
      827     9659           simulate what happens when the 7700 controller is polled.
      828     9660        */
      829     9661    8                             END;
      830     9662    7                          IF T$->KZ$HIPDEV.OTPBSY THEN
      831     9663    7                             IF (P7814.S(4)&'01'X)~='00'X THEN
      832     9664    7                                BUSY(1)='1'B;
      833     9665    7                             ELSE
      834     9666    7                                ACKS(1)='1'B;
      835     9667    7                          EXIT PRINTER_LOOK;
      836     9668    7                          END;
      837     9669    6                       T$=T$->KZ$HIPDEV.LNK$;
      838     9670    6                       END;
      839     9671    5                    END PRINTER_LOOK;
      840     9672
      841     9673    4               CASE(3 /* BSY */);
      842     9674    4                 BUSY(ADR_INDX)='1'B;
      843     9675    4                 INDX=INDX+7;
      844     9676
      845     9677    4               CASE(4 /* PGOV */);
      846     9678    4                 PGOV(ADR_INDX)='1'B;
      847     9679    4                 INDX=INDX+7;
      848     9680
      849     9681    4               CASE(5 /* NA */);
      850     9682    4                 NAV(ADR_INDX)='1'B;
      851     9683    4                 INDX=INDX+7;
      852     9684
      853     9685    4               CASE( 15 /* Unknown status byte */);
      854     9686
      855     9687        /*       Flakey input block. Just look for ending ETX and ignore fragment */
      856     9688    5                 DO I=INDX+5 TO LENX-1;
      857     9689    5                    IF BITASC('83'X)=SUBSTR(IBFR,I,1) THEN
      858     9690    5                       GOTO UNKNOWN_BLK_FINISHED;
      859     9691    5                    END;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:35   
      860     9692    4                 GOTO CANT_FIND_ENDING_ETX;
      861     9693    4   UNKNOWN_BLK_FINISHED:;
      862     9694    4                 INDX=I+2;
      863     9695
      864     9696
      865     9697    4               END;
      866     9698
      867     9699    3              IF SUBSTR(IBFR,INDX-2,1)~=%BITASC('83'X) THEN
      868     9700    3                 GOTO CANT_FIND_ENDING_ETX;
      869     9701
      870     9702    3              END PARSING_INPUT;
      871     9703
      872     9704    2           RETURN;
      873     9705    2   CANT_FIND_ENDING_ETX:;
      874     9706    2           CALL ERRLOG(%E$ETXGONE,INDX);
      875     9707        /*E*          ERROR: KZH-E$ETXGONE
      876     9708                    MESSAGE: Missing ETX on HIP message fragment.
      877     9709                DESCRIPTION: Cannot locate ETX/ETB in HIP fragment.
      878     9710                              V0 = CHANNEL NUMBER
      879     9711                              V1 = NUMBER OF RETRIES BEFORE GOOD COMPLETION
      880     9712                              V2 = INDEX INTO BUFFER
      881     9713                              DATA = INPUT BUFFER
      882     9714        */
      883     9715
      884     9716
      885     9717
      886     9718    2           ALTRETURN;
      887     9719
      888     9720    2   END PARSE_INPUT;
      889     9721        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:36   
      890     9722        /*  This proc is called to handle tube status responses.
      891     9723             CURCTR$ and CURDEV$ have been set up via GETOTP device manager call
      892     9724        */
      893     9725
      894     9726
      895     9727    1   PROCESS_IMMED_STATUS:PROC ALTRET;
      896     9728
      897     9729    2   DCL TYP SBIN;
      898     9730
      899     9731    2           TYP=KZ@LINCTX.CURCTR$->KZ$HIPCTR.TYP;
      900     9732
      901     9733    3           DO CASE(KZ@LINCTX.CURDEV$->KZ$HIPDEV.ADR);
      902     9734    3            CASE(0) /* TUBE */;
      903     9735
      904     9736    3              IF NAKS(0) OR ((TYP~=7700) AND BUSY(0)) THEN
              9736                       /* KLUDGE: 7804 treat BUSY like NAK */
      905     9737    4   TERMINAL_SEND_NAKED_OUTPUT: DO;
      906     9738
      907     9739    4                 KZ@LINCTX.OTPDEV$->KZ$HIPDEV.RTRCNT=
      908     9740    4                   KZ@LINCTX.OTPDEV$->KZ$HIPDEV.RTRCNT+1;
      909     9741    4                 KZ@LINCTX.OTPDEV$->KZ$HIPDEV.OTPBSY='0'B;
      910     9742    4                 IF(KZ@LINCTX.PRO.RETRYS>0) AND
      911     9743    4                   (KZ@LINCTX.PRO.RETRYS<KZ@LINCTX.OTPDEV$->KZ$HIPDEV.RTRCNT)THEN
      912     9744    5                 DO;
      913     9745    5                    KZ$EVENT.EVENT=%KZ#LINFCN_POLTIMOUT;
      914     9746    5                    CALL KZ@LINCTX.DEVMGR@(KZ$EVENT);
      915     9747    5                    END;
      916     9748    4                 ELSE
      917     9749    5                 DO;
      918     9750    5                    KZ$EVENT.EVENT=%KZ#LINFCN_REQOTP;
      919     9751    5                    CALL KZ@LINCTX.DEVMGR@(KZ$EVENT);
      920     9752    5                    END;
      921     9753
      922     9754    4                 END TERMINAL_SEND_NAKED_OUTPUT;
      923     9755
      924     9756    3              ELSE IF BUSY(0) THEN
      925     9757    4   TERMINAL_BUSY: DO;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:37   
      926     9758        /* THE TERMINAL SAYS HE IS BUSY. SET THE 'WACK' BIT TO WAIT FOR ACK.
      927     9759
      928     9760           AN 'ACK' FROM THE TERMINAL WILL CLEAR THE WAIT, SO WILL ANY INPUT.
      929     9761        */
      930     9762    4                    KZ@LINCTX.OTPDEV$->KZ$HIPDEV.HLT.WACK='1'B;
      931     9763    4                    KZ$EVENT.EVENT=%KZ#LINFCN_REQOTP;
      932     9764    4                    CALL KZ@LINCTX.DEVMGR@(KZ$EVENT);
      933     9765    4                    END TERMINAL_BUSY;
      934     9766    3                 ELSE IF ACKS(0) AND NOT KZ@LINCTX.OTPDEV$->KZ$HIPDEV.HLT.WACK THEN
      935     9767    4   TERMINAL_SEND_ACKED_OUTPUT:DO;
      936     9768
      937     9769    4                       KZ@LINCTX.OTPDEV$->KZ$HIPDEV.RTRCNT=0;
      938     9770    4                       KZ$EVENT.EVENT=%KZ#LINFCN_RELOTP;
      939     9771    4                       CALL KZ@LINCTX.DEVMGR@(KZ$EVENT);
      940     9772
      941     9773    4                       END TERMINAL_SEND_ACKED_OUTPUT;
      942     9774    3                    ELSE IF PGOV(0) OR PGOV(1) THEN
      943     9775    4   TUBE_SAID_OVERFLOW: DO;
      944     9776
      945     9777        /* I PROBABLY SHOULD ERRORLOG THIS, BUT FOR NOW HANDLE LIKE ACK */
      946     9778    4                          KZ$EVENT.EVENT=%KZ#LINFCN_RELOTP;
      947     9779    4                          CALL KZ@LINCTX.DEVMGR@(KZ$EVENT);
      948     9780
      949     9781    4                          END TUBE_SAID_OVERFLOW;
      950     9782    3                       ELSE IF INPUT.PRESENT THEN
      951     9783    4   TERMINAL_SEND_IGNORED_MSG:DO;
      952     9784
      953     9785        /* There was a transmit pending, so any message I sent was ignored.
      954     9786
      955     9787            The cursor position was probably lost.
      956     9788
      957     9789            requeue the output for later transmission.
      958     9790        */
      959     9791    5                             DO;
      960     9792    5                                KZ$EVENT.EVENT=%KZ#LINFCN_REQOTP;
      961     9793    5                                CALL KZ@LINCTX.DEVMGR@(KZ$EVENT);
      962     9794    5                                END;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:38   
      963     9795
      964     9796    4                             END TERMINAL_SEND_IGNORED_MSG;
      965     9797
      966     9798    3            CASE(1) /* PRINTER */;
      967     9799
      968     9800    3              IF NAKS(1) THEN
      969     9801    4   PRINTER_NAKED_BLOCK:DO;
      970     9802
      971     9803    4                 KZ@LINCTX.OTPDEV$->KZ$HIPDEV.RTRCNT=
      972     9804    4                   KZ@LINCTX.OTPDEV$->KZ$HIPDEV.RTRCNT+1;
      973     9805    4                 KZ@LINCTX.OTPDEV$->KZ$HIPDEV.OTPBSY='0'B;
      974     9806    4                 IF(KZ@LINCTX.PRO.RETRYS>0) AND
      975     9807    4                   (KZ@LINCTX.PRO.RETRYS<KZ@LINCTX.OTPDEV$->KZ$HIPDEV.RTRCNT)THEN
      976     9808    5                 DO;
      977     9809    5                    KZ$EVENT.EVENT=%KZ#LINFCN_POLTIMOUT;
      978     9810    5                    CALL KZ@LINCTX.DEVMGR@(KZ$EVENT);
      979     9811    5                    END;
      980     9812    4                 ELSE
      981     9813    5                 DO;
      982     9814    5                    KZ$EVENT.EVENT=%KZ#LINFCN_REQOTP;
      983     9815    5                    CALL KZ@LINCTX.DEVMGR@(KZ$EVENT);
      984     9816    5                    END;
      985     9817
      986     9818    4                 END PRINTER_NAKED_BLOCK;
      987     9819    3            END /* CASE ON SENDING DEVICE */;
      988     9820    2   END PROCESS_IMMED_STATUS;
      989     9821        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:39   
      990     9822        /*  This proc is called to handle any tube status messages..
      991     9823
      992     9824            These messages are DELAYED from the time the output block is
      993     9825            sent, and CURDEV$ does not refer to the device, but
      994     9826            CURCTR$ now points at the proper controller.
      995     9827        */
      996     9828
      997     9829    1   PROCESS_DELAYED_STATUS:PROC ALTRET;
      998     9830
      999     9831    2           IF ACKS(1) THEN
     1000     9832    3   PRINTER_FINALLY_FINISHED: DO;
     1001     9833
     1002     9834    3              CALL SETDEV(1,KZ@LINCTX.CURDEV$) ALTRET(NO_PRINTER_ON_DEVICE);
     1003     9835    3              KZ@LINCTX.CURDEV$->KZ$HIPDEV.RTRCNT=0;
     1004     9836    3              IF KZ@LINCTX.CURDEV$->KZ$HIPDEV.OTPBSY THEN
     1005     9837    4              DO;
     1006     9838    4                 KZ$EVENT.EVENT=%KZ#LINFCN_RELOTP;
     1007     9839    4                 CALL KZ@LINCTX.DEVMGR@(KZ$EVENT);
     1008     9840    4                 END;
     1009     9841
     1010     9842    3              END PRINTER_FINALLY_FINISHED;
     1011     9843    2           ELSE IF BUSY(1) THEN
     1012     9844    3   PRINTER_STILL_BUSY:DO;
     1013     9845
     1014     9846        /*  This is a retransmission of  some previous block, because
     1015     9847           I did not get an ACK message from the terminal in a timely fashion.
     1016     9848
     1017     9849            Assume the printer got the message ok, and do nothing.
     1018     9850
     1019     9851            Eventually the printer will send an ACK saying the current buffer has
     1020     9852           been printed.
     1021     9853        */
     1022     9854    3                 END PRINTER_STILL_BUSY;
     1023     9855
     1024     9856    2   NO_PRINTER_ON_DEVICE:;
     1025     9857    2   END PROCESS_DELAYED_STATUS;
     1026     9858
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:40   
     1027     9859        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:41   
     1028     9860    1   SETDEV: PROC(DEVNUM,DEV$) ALTRET;
     1029     9861        /* KZ@LINCTX.CURCTR$ points to the correct controller, but
     1030     9862           KZ@LINCTX.CURDEV$ does not point to the proper device.
     1031     9863
     1032     9864            MAKE DEV$ POINT TO THE PROPER DEVICE
     1033     9865        */
     1034     9866    2   DCL DEV$ PTR;
     1035     9867    2   DCL DEVNUM SBIN;
     1036     9868
     1037     9869    2           DEV$=KZ@LINCTX.CURCTR$->KZ$HIPCTR.DEVHD$;
     1038     9870    3           DO WHILE(DEV$~=ADDR(NIL));
     1039     9871    3              IF DEV$->KZ$HIPDEV.ADR=DEVNUM THEN
     1040     9872    4              DO;
     1041     9873    4                 RETURN;
     1042     9874    4                 END;
     1043     9875    3              DEV$=DEV$->KZ$HIPDEV.LNK$;
     1044     9876    3              END;
     1045     9877    2           ALTRETURN;
     1046     9878    2   END SETDEV;
     1047     9879        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:42   
     1048     9880    1   ERRLOG: PROC (ERROR, INDX);
     1049     9881
     1050     9882    2   DCL INDX UBIN;
     1051     9883    2   DCL ERROR UBIN;
     1052     9884        %FPT_WRSYSLOG (STCLASS=" ");
     1053     9979        %FPT_WRSYSLOG (FPTN=FPT@WRSYSLOG, STCLASS=CONSTANT,FCG='KZ',MID='H');
     1054    10074
     1055    10075    2           FPT_WRSYSLOG = FPT@WRSYSLOG;
     1056    10076    2           FPT_WRSYSLOG.V.TERMID = KZ@LINCTX.LINID;
     1057    10077    2           FPT_WRSYSLOG.V.ERRCODE.ERR# = ERROR;
     1058    10078
     1059    10079    3           DO CASE (ERROR);
     1060    10080    3            CASE(%E$HIPIO_OK);
     1061    10081                      /*E* ERROR:       KZH-E$HIPIO_OK-1
     1062    10082                           MESSAGE:     Corrected HIP I/O Error
     1063    10083                           DESCRIPTION: A NAK or ENQ occured on a BSC HIP line and a
     1064    10084                                        retry of the operation causing the error was
     1065    10085                                        successful.
     1066    10086                              V0 = Channel Number
     1067    10087                              V1 = Number of retries before good completion.
     1068    10088                              DATA = Vector of KZ$LINCTX.HIST           */
     1069    10089
     1070    10090    3              FPT_WRSYSLOG.V.ERRCODE.SEV=%G_WRSYSLOG_SEV_GOOD_HARD#;
     1071    10091    3              FPT_WRSYSLOG.V.VALUES(0)=KZ@LINCTX.CHAN;
     1072    10092    3              FPT_WRSYSLOG.V.VALUES(1)=KZ@LINCTX.RTRCNT;
     1073    10093    3              FPT_WRSYSLOG.V.VALUES(2)=0;
     1074    10094    3              FPT_WRSYSLOG.V.VALUES(3)=0;
     1075    10095    3              FPT_WRSYSLOG.BUF_=VECTOR(KZ@LINCTX.HIST);
     1076    10096
     1077    10097    3            CASE(%E$UNKNADR, %E$UNKNSTA, %E$ETXGONE);
     1078    10098    3              FPT_WRSYSLOG.V.VALUES(0)=KZ@LINCTX.CHAN;
     1079    10099    3              FPT_WRSYSLOG.V.VALUES(1)=KZ@LINCTX.RTRCNT;
     1080    10100    3              FPT_WRSYSLOG.V.VALUES(2)=INDX;
     1081    10101    3              FPT_WRSYSLOG.V.VALUES(3)=0;
     1082    10102    3              VBASE(FPT_WRSYSLOG.BUF_)=KZ@LINCTX.INPBFR$;
     1083    10103    3              VBOUND(FPT_WRSYSLOG.BUF_)=KZ@BSCFPT.SIZ;
     1084    10104
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:43   
     1085    10105    3            CASE(%E$NO_MEMORY);
     1086    10106    3              FPT_WRSYSLOG.V.ERRCODE.SEV=%G_WRSYSLOG_SEV_LINE_ABORT#;
     1087    10107    3              FPT_WRSYSLOG.V.VALUES(0)=KZ@LINCTX.CHAN;
     1088    10108    3              FPT_WRSYSLOG.V.VALUES(1)=0;
     1089    10109    3              FPT_WRSYSLOG.V.VALUES(2)=0;
     1090    10110    3              FPT_WRSYSLOG.V.VALUES(3)=1024;
     1091    10111
     1092    10112    3            END;
     1093    10113
     1094    10114    2           CALL KHA$ERRLOG(FPT_WRSYSLOG);
     1095    10115    2           RETURN;
     1096    10116    2   END ERRLOG;
     1097    10117
     1098    10118        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:44   
     1099    10119    1   ISOLATE_GPOLL_STOPPER:PROC ALTRET;
     1100    10120        /* Either someone anwswered a poll all with a non-null message,
     1101    10121           or a controller timed out. In either case, pluck out the
     1102    10122           controllers address from the MLCP's lct byte, and
     1103    10123           set the current controller in the line context. Also
     1104    10124           note the point where polling is to continue */
     1105    10125    2   DCL POLLX SBIN;
     1106    10126    2   DCL OLD_POLLX SBIN;
     1107    10127    2   DCL OLD_INDX SBIN;
     1108    10128    2   DCL BP$(0:1) PTR BASED;
     1109    10129    2   DCL POLL_ADR_LIST CHAR(POLSIZ) BASED(KZ@LINCTX.POLLST$);
     1110    10130    2   DCL POLSIZ UBIN BYTE;
     1111    10131    2   DCL POLLADDR CHAR(1);
     1112    10132    2   DCL INDX SBIN;
     1113    10133    2   DCL POLX SBIN;
     1114    10134    2   DCL CTR$ PTR;
     1115    10135        %KZ$POLLHIP(STCLASS="BASED(KZ@LINCTX.POLLTBL$)");
     1116    10145
     1117    10146    2           CALL SET_TNOW;
     1118    10147    2           KZ@LINCTX.TIMR.GENPOL=TNOW;
     1119    10148
     1120    10149    2           POLSIZ=KZ@LINCTX.POLSIZ /* MOVE TO UBIN BYTE VARIABLE */;
     1121    10150    2           KH_INPLCT.LCTBYT.ADR=60;
     1122    10151    2           CALL KHI$IO_INPLCTBYT(KZ@LINCTX.CHN$->KH$CHN,KH_INPLCT);
     1123    10152
     1124    10153    2           POLLADDR=BINASC(KH_INPLCT.LCTBYT.DAT);
     1125    10154    2           CALL INDEX(POLLX,POLLADDR,POLL_ADR_LIST)
     1126    10155    2             ALTRET(MLCP_GOOFED_ON_POLL_ADR_INDX);
     1127    10156
     1128    10157    2           KZ@LINCTX.POLX=POLLX;
     1129    10158
     1130    10159    2           IF KZ@LINCTX.ACTCTR=0 THEN
     1131    10160    2              GOTO MLCP_GOOFED_ON_POLL_ADR_INDX /* RUNTIME BUG */;
     1132    10161    2           CALL INDEX(INDX,POLLADDR,
     1133    10162    2             SUBSTR(KZ$POLLHIP.POLL_LIST_C,0,KZ@LINCTX.ACTCTR))
     1134    10163    2             ALTRET(MLCP_GOOFED_ON_POLL_ADR_INDX);
     1135    10164
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:45   
     1136    10165    2           OLD_INDX=KZ$POLLHIP.POLLX;
     1137    10166    2           KZ$POLLHIP.POLLX=KZ@LINCTX.POLX+1;
     1138    10167    2           KZ@LINCTX.POLADR.CTR=ASCBIN(POLLADDR);
     1139    10168    2           KZ$POLLHIP.INDX=INDX+1;
     1140    10169    2           KZ$POLLHIP.CONTINUE_POLL=
     1141    10170    2             KZ$POLLHIP.INDX<KZ@LINCTX.ACTCTR;
     1142    10171
     1143    10172        /* RESET ANY 'TIMED_OUT_ONCE' BITS ON CONTROLLERS THAT ANSWERED */
     1144    10173
     1145    10174    3           DO INDX=KZ@LINCTX.POLX-1 DOWNTO OLD_INDX;
     1146    10175    3              CTR$=KZ@LINCTX.CTRLST$->BP$(INDX);
     1147    10176    3              IF CTR$~=ADDR(NIL) THEN
     1148    10177    3                 CTR$->KZ$HIPCTR.TIMED_OUT_ONCE='0'B;
     1149    10178    3              END;
     1150    10179
     1151    10180        /* SET CURRENT CONTROLLER AS THE ONE THAT ANSWERED */
     1152    10181
     1153    10182    2           KZ@LINCTX.CURCTR$=KZ@LINCTX.CTRLST$->BP$(KZ@LINCTX.POLX);
     1154    10183    2           RETURN;
     1155    10184    2   MLCP_GOOFED_ON_POLL_ADR_INDX:;
     1156    10185    2           KZ$POLLHIP.CONTINUE_POLL='0'B;
     1157    10186    2   END ISOLATE_GPOLL_STOPPER;
     1158    10187        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:46   
     1159    10188
     1160    10189    1   CONTINUE_POLLING:PROC ALTRET;
     1161    10190
     1162    10191        /* An MLCP controlled poll all was interrupted.
     1163    10192           Issue call to KZT_ORDERS to finish polling if there
     1164    10193            are any controllers left to poll. ALTRET if all
     1165    10194            controllers have been polled. */
     1166    10195
     1167    10196        %KZ$POLLHIP(STCLASS="BASED(KZ@LINCTX.POLLTBL$)");
     1168    10206    2           IF NOT KZ@LINCTX.POLLTBL$->KZ$POLLHIP.CONTINUE_POLL THEN
     1169    10207    3           DO;
     1170    10208    3              KZ@LINCTX.OTPBFR$=ADDR(NIL);
     1171    10209    3              ALTRETURN;
     1172    10210    3              END;
     1173    10211
     1174    10212        /* Note: The buffer pointer OTPBFR$ cannot point at a
     1175    10213                 byte boundry, so the poll list may be backed
     1176    10214                 up 1 byte. This backing up means the controller
     1177    10215                 that answers a poll with a non-null message and
     1178    10216                 is on an even byte in KZ$POLLHIP will get polled
     1179    10217                 a second time as the general poll continues.
     1180    10218        */
     1181    10219    2           KZ@LINCTX.POLADR.CTR =
     1182    10220    2             KZ$POLLHIP.POLL_LIST(KZ$POLLHIP.INDX);
     1183    10221    2           KZ@LINCTX.OTPDATSIZ = 1;
     1184    10222    2           KZ@LINCTX.OTPBFR$=ADDR(KZ@LINCTX.POLADR.CTR);
     1185    10223    2           CALL KZT_ORDERS@(%KZ#SEND_GEPOLL,KZ@LINCTX);
     1186    10224    2           RETURN;
     1187    10225    2   END CONTINUE_POLLING;
     1188    10226        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:47   
     1189    10227    1   SEND_NAK:PROC ALTRET;
     1190    10228        /* A recoverable line error was detected
     1191    10229           Send a NAK to force retransmission if the retry count
     1192    10230           has not been exceeded.
     1193    10231
     1194    10232           Altret if the retry count has been exceeded.
     1195    10233        */
     1196    10234    2   DCL SELADR CHAR(1);
     1197    10235    2   DCL POLADR CHAR(1);
     1198    10236
     1199    10237        /* Unfortunately, the code for sending a NAK via an order to the
     1200    10238           MLCP does not work.
     1201    10239
     1202    10240           Therefore, a NAK message is built up in the input buffer.
     1203    10241        */
     1204    10242
     1205    10243    2   DCL NAKMSG CHAR(14) BASED( KZ@LINCTX.OTPBFR$);
     1206    10244
     1207    10245
     1208    10246    2           KZ@LINCTX.RTRCNT=KZ@LINCTX.RTRCNT+1;
     1209    10247
     1210    10248    2           IF KZ@LINCTX.PRO.RETRYS >0 AND
     1211    10249    2             KZ@LINCTX.RTRCNT > KZ@LINCTX.PRO.RETRYS THEN
     1212    10250    3           DO;
     1213    10251    3              CALL KZ@LINCTX.DEVMGR@(KZ@LINCTX,%KZ#LINFCN_POLTIMOUT);
     1214    10252    3              ALTRETURN;
     1215    10253    3              END;
     1216    10254
     1217    10255    2           SELADR=BINASC(KZ@LINCTX.CURCTR$->KZ$HIPCTR.ADR+64);
     1218    10256    2           POLADR=BINASC(KZ@LINCTX.CURCTR$->KZ$HIPCTR.ADR+32);
     1219    10257    2           KZ@LINCTX.OTPBFR$=KZ@LINCTX.INPBFR$;
     1220    10258    2           KZ@LINCTX.OTPDATSIZ=LENGTHC(NAKMSG);
     1221    10259    2           CALL CONCAT(NAKMSG,SELADR,
     1222    10260                  %CONCAT(BITASC('80'X),BITASC('02'X),BITASC('83'X),BITASC('E0'X),
     1223    10261    2             BITASC('15'X),'  ',BITASC('02'X),BITASC('83'X)),
     1224    10262    2             POLADR,
     1225    10263    2             %CONCAT(BITASC('80'X),BITASC('02'X),BITASC('83'X)));
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:48   
     1226    10264
     1227    10265    2           CALL KZT_ORDERS@(%KZ#SEND_BLOCK,KZ@LINCTX);
     1228    10266
     1229    10267    2   END SEND_NAK;
     1230    10268        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:49   
     1231    10269    1   SEND_MSG:PROC(MSG,MSGS,MSGL);
     1232    10270
     1233    10271    2   DCL MSG CHAR(MSGL);
     1234    10272    2   DCL MSGS SBIN;
     1235    10273    2   DCL MSGL SBIN;
     1236    10274
     1237    10275        /*  SUBSTR(MSG,MSGS,MSGL) defines a message that must be sent to the current control
             10275        ler.
     1238    10276           Build up the message in the input buffer and send it out, similar to SEND_NAK  */
     1239    10277
     1240    10278    2   DCL 1 OBUF BASED(KZ@LINCTX.OTPBFR$),
     1241    10279    2         2 HEAD,
     1242    10280    2           3 SELADR CHAR(1),
     1243    10281    2           3 F1 CHAR(8),
     1244    10282    2         2 MSG CHAR(100),
     1245    10283    2         2 TRAIL,
     1246    10284    2           3 F1 CHAR(1),
     1247    10285    2           3 POLADR CHAR(1),
     1248    10286    2           3 F2 CHAR(3);
     1249    10287
     1250    10288    2   DCL 1 LCLTRAIL,
     1251    10289    2         2 ALLOFIT CHAR(5),
     1252    10290    2         2 TRAIL REDEF ALLOFIT,
     1253    10291    2           3 F1 CHAR(1),
     1254    10292    2           3 POLADR CHAR(1),
     1255    10293    2           3 F2 CHAR(3);
     1256    10294
     1257    10295    2           LCLTRAIL.TRAIL.F1=%BINASC(3);
     1258    10296    2           LCLTRAIL.TRAIL.POLADR=BINASC(KZ@LINCTX.CURCTR$->KZ$HIPDEV.ADR+32);
     1259    10297    2           LCLTRAIL.TRAIL.F2=%CONCAT(BITASC('80'X),BITASC('02'X),BITASC('83'X));
     1260    10298    2           KZ@LINCTX.OTPBFR$=KZ@LINCTX.INPBFR$;
     1261    10299    2           OBUF.HEAD.SELADR=BINASC(KZ@LINCTX.CURCTR$->KZ$HIPCTR.ADR+64);
     1262    10300    2           KZ@LINCTX.OTPDATSIZ=LENGTHC(OBUF)+MSGL+-LENGTHC(OBUF.MSG);
     1263    10301    2           OBUF.HEAD.F1=
     1264    10302                  %CONCAT(BITASC('80'X),BITASC('02'X),BITASC('83'X),BITASC('E0'X),
     1265    10303    2             BITASC('80'X),'  ',BITASC('02'X));
     1266    10304    2           CALL INSERT(OBUF.MSG,0,MSGL,SUBSTR(MSG,MSGS,MSGL));
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:50   
     1267    10305    2           CALL INSERT(OBUF.MSG,MSGL,LENGTHC(LCLTRAIL.ALLOFIT),LCLTRAIL.ALLOFIT);
     1268    10306    2           CALL KZT_ORDERS@(%KZ#SEND_BLOCK,KZ@LINCTX);
     1269    10307    2   END SEND_MSG;
     1270    10308        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:51   
     1271    10309    1   SHIP_POSSIBLE_INPUT:PROC ALTRET;
     1272    10310
     1273    10311        /* POSSIBLE INPUT IS PRESENT IN THE 'INPUT' STRUCTURE.
     1274    10312
     1275    10313        The code at SNDRSP,POSANS,NUTERM has looked at stuff
     1276    10314         and determined that any input should not be ignored.
     1277    10315
     1278    10316        Call the device manager saying input is present.
     1279    10317
     1280    10318            Someone may have moved the 'com line' switch to the off position.
     1281    10319            if so, then halt current output. Resume with any input.
     1282    10320        */
     1283    10321
     1284    10322    2   DCL DEV$ PTR;
     1285    10323    2   DCL SAVCURDEV$ PTR;
     1286    10324
     1287    10325    2           IF INPUT.PRESENT OR ACKS(0) THEN
     1288    10326    3   SET_NEW_CURDEV: DO;
     1289    10327    3              CALL SETDEV(0,DEV$);
     1290    10328    3              SAVCURDEV$=KZ@LINCTX.CURDEV$;
     1291    10329    3              KZ@LINCTX.CURDEV$=DEV$;
     1292    10330
     1293    10331    3              IF ACKS(0) AND DEV$->KZ$HIPDEV.HLT.WACK THEN
     1294    10332    4              DO; /*  CLEAR HALT CONDITION. */
     1295    10333    4                 DEV$->KZ$HIPDEV.HLT.WACK='0'B;
     1296    10334    4                 KZ$EVENT.EVENT=%KZ#LINFCN_REQOTP;
     1297    10335    4                 CALL KZ@LINCTX.DEVMGR@(KZ$EVENT);
     1298    10336    4                 END;
     1299    10337
     1300    10338
     1301    10339    3              IF INPUT.PRESENT THEN
     1302    10340    4              DO;
     1303    10341    4                 KZ$INPDESC.BYTX=INPUT.FIRST;
     1304    10342    4                 KZ$INPDESC.DATBYTSIZ=INPUT.ENDING_ETX-INPUT.FIRST;
     1305    10343
     1306    10344        /*  CHANGE THE ENDING BYTE IN BUFFER TO 'CR', FOR AUTOMATIC ACTIVATION
     1307    10345            IF TRANSPARENT READ.  */
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:52   
     1308    10346    4                 CALL INSERT(KZ@LINCTX.INPBFR$->CHRS,INPUT.ENDING_ETX,1,%BINASC(13));
     1309    10347
     1310    10348    4                 KZ$EVENT.EVENT=%KZ#LINFCN_INP;
     1311    10349    4                 CALL KZ@LINCTX.DEVMGR@(KZ$EVENT,KZ$INPDESC);
     1312    10350
     1313    10351
     1314    10352        /* GET NEW BUFFER IF ITS GONE AWAY ! */
     1315    10353    4                 IF KZ@LINCTX.INPBFR$=ADDR(NIL) THEN
     1316    10354    5   ACQUIRE_NEW_INPBFR: DO;
     1317    10355    5                    KZ@LINCTX.INPBFRSIZ=1024;
     1318    10356    5                    CALL KVB$GETSYS(KZ@LINCTX.INPBFRSIZ, KZ@LINCTX.INPBFR$)
     1319    10357    5                    WHENALTRETURN
     1320    10358    6                    DO;
     1321    10359    6                       CALL ERRLOG(%E$NO_MEMORY);
     1322    10360    6                       KZ@LINCTX.INPBFR$ = ADDR(NIL);
     1323    10361    6                       KZ@LINCTX.INPBFRSIZ = 0;
     1324    10362    6                       CALL KZH$DSC_LINE (KZ@LINCTX );
     1325    10363    6                       RETURN;
     1326    10364    6                       END;
     1327    10365    5                    END ACQUIRE_NEW_INPBFR;
     1328    10366
     1329    10367    4                 END;
     1330    10368    3              KZ@LINCTX.CURDEV$=SAVCURDEV$;
     1331    10369    3              END SET_NEW_CURDEV;
     1332    10370
     1333    10371    2   END SHIP_POSSIBLE_INPUT;
     1334    10372        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:53   
     1335    10373        /* TIMER ROUTINES:
     1336    10374
     1337    10375            SET_TNOW justs sets TNOW to be the current time.
     1338    10376            CHECK_INTERVAL(deltat,timer_cell)
     1339    10377                 checks if timer_cell-tnow is greater than the interval.
     1340    10378                 if the interval has expired, then the timer cell is updated to TNOW
     1341    10379                 and CHECK_INTERVAL will altret;
     1342    10380        */
     1343    10381
     1344    10382    1   SET_TNOW:PROC;
     1345    10383
     1346    10384    2           CALL KHC$TIME2(TNOW);
     1347    10385    2           RETURN;
     1348    10386    2   END SET_TNOW;
     1349    10387
     1350    10388    1   CHECK_INTERVAL:PROC(INTERVAL,TIMER_CELL) ALTRET;
     1351    10389    2   DCL INTERVAL UBIN(16);
     1352    10390    2   DCL TIMER_CELL UBIN(32);
     1353    10391    2   DCL DELTAT SBIN(32);
     1354    10392    2           DELTAT=TNOW-TIMER_CELL;
     1355    10393    2           IF DELTAT >= 0 THEN
     1356    10394    2              IF DELTAT <= INTERVAL THEN
     1357    10395    2                 RETURN;
     1358    10396    2           TIMER_CELL=TNOW;
     1359    10397    2           ALTRETURN;
     1360    10398    2   END CHECK_INTERVAL;
     1361    10399        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:54   
     1362    10400
     1363    10401        /* GOOSE_PRINTERS:
     1364    10402
     1365    10403                 HIP attached printers may have their status messages
     1366    10404                 LOST due to line noise (status messages are NOT
     1367    10405                 retransmitted when a NAK is sent).
     1368    10406
     1369    10407                 Therefore, every 10 minutes or so, all printers on the
     1370    10408                 line are examined to see if their ACK has been delayed
     1371    10409                 by more than 10 minutes.
     1372    10410
     1373    10411                 If the ACK has been delayed that long, then the
     1374    10412                 last printer block is re-transmitted. If the delay
     1375    10413                 happens because the printer is out of paper, then a BSY
     1376    10414                 status msg will be sent back to me, which I will then ignore.
     1377    10415        */
     1378    10416
     1379    10417    1   GOOSE_PRINTERS:PROC;
     1380    10418
     1381    10419    2           KZ@LINCTX.CURCTR$=KZ@LINCTX.CTRHD$;
     1382    10420
     1383    10421    3           DO WHILE(KZ@LINCTX.CURCTR$~=ADDR(NIL));
     1384    10422
     1385    10423    3              CALL SETDEV(1,KZ@LINCTX.CURDEV$) ALTRET(NEXT_CTR);
     1386    10424
     1387    10425    3              IF KZ@LINCTX.CURDEV$->KZ$HIPDEV.OTPBSY THEN
     1388    10426    4              DO;
     1389    10427    4                 CALL CHECK_INTERVAL(PRINTER_CHECK_INTERVAL,KZ@LINCTX.CURDEV$->
             10427                          KZ$HIPDEV.XMT_TIME)
     1390    10428    4                   ALTRET(NEXT_CTR);
     1391    10429
     1392    10430        /* Printer has NOT answered in the proper amont of time. */
     1393    10431
     1394    10432    5                 DO SELECT(KZ@LINCTX.CURCTR$->KZ$HIPCTR.TYP);
     1395    10433    5                    SELECT(7700);
     1396    10434    5                    KZ$EVENT.EVENT=%KZ#LINFCN_REQOTP;
     1397    10435    5                    CALL KZ@LINCTX.DEVMGR@(KZ$EVENT);
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:55   
     1398    10436    5                    SELECT(7814,7804);
     1399    10437    5                    CALL SEND_MSG(PENQ_MSG,0,4);
     1400    10438    5                    END /* SELECT ON CONTROLLER TYPE */;
     1401    10439
     1402    10440    4                 END;
     1403    10441    3   NEXT_CTR:  KZ@LINCTX.CURCTR$=KZ@LINCTX.CURCTR$->KZ$HIPCTR.LNK$;
     1404    10442    3              END /* DO WHILE */;
     1405    10443    2   END GOOSE_PRINTERS;
     1406    10444        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:56   
     1407    10445    1   END KZH$HIPIO;
     1408    10446        %EOD;

PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:57   
--  Include file information  --

   GH_IOFNC_E.:E05TOU  is referenced.
   KH$IO.:E05TOU  is referenced.
   KH$CLK.:E05TOU  is referenced.
   KH_CLKFNC_E.:E05TOU  is referenced.
   KZ_CLMEVT_C.:E05TOU  is referenced.
   KZ_HIPEVT_C.:E05TOU  is referenced.
   KZ_MLCP_C.:E05TOU  is referenced.
   KZ_PERR_C.:E05TOU  is referenced.
   KZ_LIN_C.:E05TOU  is referenced.
   KZ_HIPTAB_C.:E05TOU  is referenced.
   KZ_CLM_E.:E05TOU  is referenced.
   KZ_BSCFPT.:E05TOU  is referenced.
   KZ$OTPBFR.:E05TOU  is referenced.
   KZ$HIPDEV.:E05TOU  is referenced.
   KZ$HIPCTR.:E05TOU  is referenced.
   KZ$LINCTX.:E05TOU  is referenced.
   KZ$HIPBRACKET.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure KZH$HIPIO.

   Procedure KZH$HIPIO requires 3039 words for executable code.
   Procedure KZH$HIPIO requires 112 words of local(AUTO) storage.

PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:58   

 Object Unit name= KZH$HIPIO                                  File name= KZH$HIPIO.:E05TOU
 UTS= JUL 30 '97 02:53:55.84 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0  RoData even  UTS    100     64  KZH$HIPIO
    1   Data  even  none     4      4  KZH$HIPIO
    2   Proc  even  none  3039    BDF  KZH$HIPIO
    3  RoData even  none     4      4  KZH$HIPIO

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     2      0   yes    yes     yes      Std        2  KZH$HIPIO

  ****  Data defs  ****

 Sect HexLoc  Name                           Sect HexLoc  Name
    0     19  PRINTER_CHECK_INTERVAL
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:59   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       2 KHI$IO_OTPLCTBYT
 yes     yes           Std       2 KVB$RLSSYS
 yes     yes           Std       2 KVB$GETSYS
 yes     yes           Std       1 KZH$DSC_LINE
 yes     yes           Std       1 KHC$CLOCK
 yes     yes           Std       2 KHA$ERRLOG
         yes           Std       2 KHI$IO_INPLCTBYT
 yes     yes           Std       1 KHC$TIME2
                       nStd      0 X6A_AUTO_2
                       nStd      0 X6A_ARET
                       nStd      0 X6A_AALT
                       nStd      0 X6C_SRCH
                       nStd      0 X6C_ALR

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KZT_GO@                               KZT_ORDERS@                      r    G$ROS$
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:60   


        1        1        /*M*     KZH$HIPIO - Line driver code for HIP and passthru       */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMC */
        8        8
        9        9        /*P*     NAME:     KZH$HIPIO
       10       10                 PURPOSE:  KZH$HIPIO performs physical I/O for HIP lines.
       11       11                           It is called from KZP$DRIVER when some event
       12       12                           occurs on the line which causes a state transition
       13       13                           to take place.  This module is the handler of the
       14       14                           state transitions.
       15       15        */
       16       16        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:61   
       17       17        /*F*     NAME:     KZH$HIPIO
       18       18                 PURPOSE:  KZH$HIPIO is the entry point which is responsible
       19       19                           for driving physical HIP lines.  The code here
       20       20                           was formerly found in KZP$DRIVER or module
       21       21                           KZP$PSRV.  Secondary purpose of this module is
       22       22                           to provide a place where HIP protocol specific
       23       23                           code may live outside the common line manager
       24       24                           and inside the HIP glom.
       25       25        */
       26       26        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:62   
       27       27        /*D*     NAME:     KZH$HIPIO
       28       28                 CALL:     Call is from PL6 only.  Format is
       29       29                           CALL KZH$HIPIO (CTX,FPT) ALTRET (ALTRET_LOC);
       30       30                           "FPT" and "CTX" are common structures found in
       31       31                           includes KZ_BSCFPT and KZ$LINCTX respectively.
       32       32                           Module altreturns when it desires the common
       33       33                           line manager to move a state based on an event
       34       34                           that it has specified, or if it requires line
       35       35                           disconnect.
       36       36                 INTERFACE:
       37       37                           Calls KZV$HIPDV for interface to lower level
       38       38                           device code.  Also calls GGB$GETSYSMND, GGC$TCKTIM,
       39       39                           GGC$SETCLK, KZC$GO, G$ERR_LOG and KZT_ORDERS.
       40       40                 INPUT:    Line context, general bisync fpt structure.
       41       41                 OUTPUT:   Bits on the line.
       42       42        */
       43       43        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:63   
       44       44        KZH$HIPIO: PROC      ( KZ@LINCTX, KZ@BSCFPT ) ALTRET;

     44   2 000000  D380 0000 0000  xent KZH$HIPIO       LNJ,B5   X6A_AUTO_2
          2 000003       0070 0002                       DC       112,2

       45       45
       46       46            %INCLUDE LCP_6;
       47     4325            %INCLUDE KH$CHN;
       48     4447            %INCLUDE KZ$HIPBRACKET;
       49     4509            %INCLUDE KZ$LINCTX;
       50     5129            %INCLUDE KZ$HIPCTR; /* GET POLLING STRUCTURE FOR HIP DEVICES */
       51     5215            %INCLUDE KZ$HIPDEV;
       52     5482            %INCLUDE KZ$OTPBFR;
       53     5583            %INCLUDE KZ_BSCFPT;
       54     5613            %INCLUDE KZ_CLM_E;
       55     5785            %INCLUDE KZ_HIPTAB_C;
       56     6027            %INCLUDE KZ_LIN_C;
       57     6083            %INCLUDE KZ_PERR_C;
       58     6165            %INCLUDE KZ_MLCP_C;
       59     6240            %INCLUDE KZ_HIPEVT_C;
       60     6261            %INCLUDE KZ_CLMEVT_C;
       61     6303            %INCLUDE KH_CLKFNC_E;
       62     6348            %INCLUDE KH$CLK;
       63     6718            %INCLUDE KH$IO;
       64     6965            %INCLUDE GH_IOFNC_E;
       65     7034        /*  %INCLUDE G_LCP6_E;*/
       66     7035        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:64   
       67     7036
       68     7037            %KH$CHN(STCLASS="BASED(KZ@LINCTX.CHN$)");
       69     7161            %KZ$HIPHEAD; /* FOUND IN KZ$HIPBRACKET */
       70     7190            %KZ$HIPTAIL; /* FOUND IN KZ$HIPBRACKET */
       71     7215
       72     7216            %KZ$LINCTX     ( NAME = KZ@LINCTX,
       73     7217                             STCLASS = "" );
       74     7648                 %KZ$HIPCTR(NAME=KZ@HIPCTR,STCLASS=BASED);
       75     7685                 %KZ$HIPDEV(NAME=KZ@HIPDEV,STCLASS=BASED);
       76     7866            %KZ_BSCFPT     ( NAME = KZ@BSCFPT,
       77     7867                             STCLASS = "" );
       78     7876            %KZ$HIPCTR(STCLASS=BASED);
       79     7913            %KZ$HIPDEV(STCLASS=BASED);
       80     8094            %KZ$POLLHIP; /* FOUND IN KZ$HIPCTR */
       81     8104            %KZ_BSCFPTEQUS;
       82     8110        %EQU KZ#BFRTYP_OTP=0;
       83     8111            %KZ$OTPBFR     ( NAME = KZ$OTPBFR,
       84     8112                             STCLASS = BASED );
       85     8177            %KZ$EVENT(FPTN=KZ_EVENT,STCLASS=CONSTANT);
       86     8259            %KZ$EVENT(STCLASS=" ");
       87     8341            %KH$CLK(FPTN=KH_CLK_SET,FNC=%KH#CLK_SETCLK,STCLASS=CONSTANT);
       88     8490            %KH$CLK(STCLASS=" ");
       89     8639
       90     8640    1   DCL KVB$GETSYS ENTRY(2) ALTRET;
       91     8641    1   DCL KHC$TIME2 ENTRY(1) ALTRET;
       92     8642    1   DCL KHC$CLOCK ENTRY(1) ALTRET;
       93     8643    1   DCL KZT_GO@ EPTR SYMREF;
       94     8644    1   DCL KHA$ERRLOG ENTRY (2) ALTRET;
       95     8645    1   DCL KHI$IO_INPLCTBYT ENTRY(2);
       96     8646    1   DCL KHI$IO_OTPLCTBYT ENTRY(2);
       97     8647    1   DCL KZH$DSC_LINE ENTRY(1) ALTRET;
       98     8648        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:65   
       99     8649
      100     8650            %EQU Y#ID=0;
      101     8651
      102     8652    1   DCL LINESPEED UBIN /* CHARACTER RATE OF LINE */;
      103     8653    1   DCL DEV_ADR_NO SBIN;
      104     8654    1   DCL OBFR$ PTR;
      105     8655    1   DCL ENDX UBIN;
      106     8656    1   DCL CTR(0:0) UBIN BYTE BASED CALIGNED;
      107     8657    1   DCL CHRS CHAR(10) BASED ;
      108     8658    1   DCL TEMP_UBIN_32 SBIN(32) ALIGNED;
      109     8659    1   DCL 1 TEMP_BIT_32 REDEF TEMP_UBIN_32,
      110     8660    1         2 WD1 UBIN WORD,
      111     8661    1         2 WD2 UBIN WORD;
      112     8662    1   DCL TEMP_BIT16 BIT(16) ALIGNED;
      113     8663    1   DCL I REDEF TEMP_BIT16 UBIN;
      114     8664    1   DCL TNOW UBIN(32);
      115     8665    1   DCL 1 TNOW_SPLIT REDEF TNOW,
      116     8666    1         2 WD1 UBIN,
      117     8667    1         2 WD2 UBIN;
      118     8668    1   DCL INACT_POLL_TICS UBIN(16);
      119     8669    1   DCL POLL_INTERVAL UBIN(16);
      120     8670        /*       VARIABLES SET BY THE INPUT PARSER: */
      121     8671    1   DCL ACKS(0:15) BIT(1) /* ACK SEEN ON THIS DEVICE */;
      122     8672    1   DCL NAKS(0:15) BIT(1) /* NAK SEEN ON THIS DEVICE */;
      123     8673    1   DCL BUSY(0:15) BIT(1) /* BSY SEEN ON THIS DEVICE */;
      124     8674    1   DCL PGOV(0:15) BIT(1) /* PGOV SEEN ON THIS DEVICE */;
      125     8675    1   DCL NAV(0:15) BIT(1) /* NA message */;
      126     8676
      127     8677        %KZ$INPDESC(STCLASS=" ");  /* FOUND IN KZ$HIPCTR */
      128     8682
      129     8683    1   DCL 1 INPUT,
      130     8684    1         2 FIRST SBIN,
      131     8685    1         2 ENDING_ETX SBIN,
      132     8686    1         2 PRESENT BIT(1);
      133     8687
      134     8688
      135     8689    1   DCL KVB$RLSSYS ENTRY(2) ALTRET;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:66   
      136     8690    1   DCL KZT_ORDERS@ EPTR SYMREF;
      137     8691    1   DCL KZH$HIPSTT ENTRY(2) ALTRET;
      138     8692    1   DCL KZH$HIPDV  ENTRY(3) ALTRET;
      139     8693
      140     8694        /*   BUILD TABLES FOR SYNC LINE MANAGER */
      141     8695
      142     8696        /*  %KZ_HIP_STBL;   */
      143     8697        /*  %KZ_HIP_MAP;    */
      144     8698        %KH$IO(FPTN=KH_OTPLCT,FNC=%GH#IO_OTPLCTBYT,STCLASS=STATIC);
      145     8812        %KH$IO(FPTN=KH_INPLCT,FNC=%GH#IO_INPLCTBYT,STCLASS=STATIC);
      146     8926
      147     8927        /*  CONSTANT DATA */
      148     8928
      149     8929    1   DCL PRINTER_CHECK_INTERVAL CONSTANT SYMDEF UBIN(16) INIT(64000);
              8929            /* interval between checking for printer timeouts */
      150     8930    1   DCL INACTIVE_POLL_RATIO UBIN CONSTANT INIT(3);
              8930            /* RATIO BETWEEN PROFILE INTERVAL AND INACTIVE CONTROLLER POLL TIME */
      151     8931
      152     8932    1   DCL PENQ_MSG CHAR(4) CONSTANT INIT(%CONCAT(BITASC('1B'X),'[8p'));
      153     8933
      154     8934    1   DCL DEVBYTES_B(0:7) BIT(8) CONSTANT INIT(
      155     8935    1                 'E0'X,'68'X,'00'X*6);
      156     8936    1   DCL DEVBYTES_C REDEF DEVBYTES_B CHAR(8);
      157     8937
      158     8938        /* STA BYTES THAT GO ALONG WITH DEV BYTES */
      159     8939    1   DCL STABYTES_B(0:7) BIT(8) CONSTANT INIT(
      160     8940    1        '80'X,'1A'X,'80'X*6);
      161     8941
      162     8942    1   DCL BAUDMAPS(0:15) UBIN CONSTANT INIT(50,75,110,134,150,200,300,600,1050,
      163     8943    1                                         1200,1800,2000,2400,4800,9600,19200);
      164     8944
      165     8945            %KZ$HIPTAIL(NAME=KZ@HIPTAIL,STCLASS=CONSTANT);
      166     8970            %KZ$HIPHEAD(NAME=KZ@HIPHEAD,STCLASS=CONSTANT);
      167     8999
      168     9000        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:67   
      169     9001        /* CAVEAT: Dont expect to follow this code
      170     9002                   without a listing of KZ_HIPTABIN_C
      171     9003                   beside you. All the states,events,
      172     9004                   and actions are necessary to have
      173     9005                   even a prayer of comprehending
      174     9006                   what's going on.
      175     9007        */
      176     9008    1           KZ$EVENT=KZ_EVENT;

   9008   2 000005  AB80 0000 0000  00                   LAB,B2   KZ_EVENT
          2 000008  2C00                                 LDV,R2   0
          2 000009  6C1C                                 LDV,R6   28
          2 00000A  BB87                                 LAB,B3   ,AUTO
          2 00000B  3C10                                 LDV,R3   16
          2 00000C  0008                                 MMM

      177     9009    1           KZ$EVENT.LINCTX$=ADDR(KZ@LINCTX);

   9009   2 00000D  ECC7 0004                            LDB,B6   @KZ@LINCTX,AUTO
          2 00000F  EFC7 000B                            STB,B6   KZ$EVENT+3,AUTO

      178     9010
      179     9011    2           DO CASE ( KZ@BSCFPT.ACT );

   9011   2 000011  DCC7 0006                            LDB,B5   @KZ@BSCFPT,AUTO
          2 000013  B805                                 LDR,R3   ,B5
          2 000014  3D12                                 CMV,R3   18
          2 000015  0281 04BC                            BGE      s:9504,PREL
          2 000017  A830 0000 001D  02                   LDR,R2   s:9011+12,R3
          2 00001A  83A0 0000 002F  02                   JMP      s:9025,R2
          2 00001D       0000                            DC       s:9025,PREL
          2 00001E       00BA                            DC       s:9122,PREL
          2 00001F       0118                            DC       s:9158,PREL
          2 000020       012C                            DC       s:9172,PREL
          2 000021       04A3                            DC       s:9504,PREL
          2 000022       0416                            DC       s:9431,PREL
          2 000023       020B                            DC       s:9235,PREL
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:68   
          2 000024       01D4                            DC       s:9215,PREL
          2 000025       03E5                            DC       s:9403,PREL
          2 000026       04A3                            DC       s:9504,PREL
          2 000027       03D4                            DC       s:9390,PREL
          2 000028       0480                            DC       s:9487,PREL
          2 000029       02DB                            DC       s:9317,PREL
          2 00002A       045B                            DC       s:9469,PREL
          2 00002B       049A                            DC       s:9500,PREL
          2 00002C       028D                            DC       s:9287,PREL
          2 00002D       00B4                            DC       s:9110,PREL
          2 00002E       00B4                            DC       s:9110,PREL

      180     9012        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:69   
      181     9013        /*       %KZ#HIPACT_GO
      182     9014                      This is the action taken when DSR is high,
      183     9015                      the profile from the auto logon string from
      184     9016                      FEPCON has been verified as OK, and the line
      185     9017                      profile is HIP
      186     9018        */
      187     9019    2            CASE(%KZ#HIPACT_GO);

      188     9020
      189     9021        /*       It is important to change the LRC polynomial to be
      190     9022                 the ASCII LRC. If this is not changed, the MLCP will
      191     9023                 continue to speak EBCDIC and all is lost
      192     9024             */
      193     9025    2              KH_OTPLCT.LCTBYT.ADR=BITBIN('02'X);

   9025   2 00002F  6C02                                 LDV,R6   2
          2 000030  EA80 0000 0001  01                   SRM,R6,'00FF'X    KH_OTPLCT+1
          2 000033       00FF

      194     9026    2              KH_OTPLCT.LCTBYT.DAT=BITBIN('C6'X);

   9026   2 000034  D870 00C6                            LDR,R5   198,IMO
          2 000036  D780 0000 0001  01                   STH,R5   KH_OTPLCT+1

      195     9027    2              CALL KHI$IO_OTPLCTBYT(KZ@LINCTX.CHN$->KH$CHN,KH_OTPLCT);

   9027   2 000039  CCC6 0002                            LDB,B4   2,B6
          2 00003B  AB80 0000 0000  01                   LAB,B2   KH_OTPLCT
          2 00003E  AFC7 006A                            STB,B2   FPT_WRSYSLOG+24,AUTO
          2 000040  CFC7 0068                            STB,B4   FPT_WRSYSLOG+22,AUTO
          2 000042  BBC7 0068                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 000044  CBF0 0200                            LAB,B4   512,IMO
          2 000046  E380 0000 0000  xent                 LNJ,B6   KHI$IO_OTPLCTBYT
          2 000049       0001                            DC       s:9028,PREL

      196     9028    2              KH_OTPLCT.LCTBYT.ADR=BITBIN('22'X);

PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:70   
   9028   2 00004A  6C22                                 LDV,R6   34
          2 00004B  EA80 0000 0001  01                   SRM,R6,'00FF'X    KH_OTPLCT+1
          2 00004E       00FF

      197     9029    2              KH_OTPLCT.LCTBYT.DAT=BITBIN('C6'X);

   9029   2 00004F  D870 00C6                            LDR,R5   198,IMO
          2 000051  D780 0000 0001  01                   STH,R5   KH_OTPLCT+1

      198     9030    2              CALL KHI$IO_OTPLCTBYT(KZ@LINCTX.CHN$->KH$CHN,KH_OTPLCT);

   9030   2 000054  ECC7 0004                            LDB,B6   @KZ@LINCTX,AUTO
          2 000056  DCC6 0002                            LDB,B5   2,B6
          2 000058  CB80 0000 0000  01                   LAB,B4   KH_OTPLCT
          2 00005B  CFC7 006A                            STB,B4   FPT_WRSYSLOG+24,AUTO
          2 00005D  DFC7 0068                            STB,B5   FPT_WRSYSLOG+22,AUTO
          2 00005F  BBC7 0068                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 000061  CBF0 0200                            LAB,B4   512,IMO
          2 000063  E380 0000 0000  xent                 LNJ,B6   KHI$IO_OTPLCTBYT
          2 000066       0001                            DC       s:9031,PREL

      199     9031    2              KZ@LINCTX.TIMR.SPCPOL=0;

   9031   2 000067  ECC7 0004                            LDB,B6   @KZ@LINCTX,AUTO
          2 000069  8746 0079                            CL       121,B6
          2 00006B  8746 007A                            CL       122,B6

      200     9032    2              KZ@LINCTX.TIMR.GENPOL=0;

   9032   2 00006D  8746 0077                            CL       119,B6
          2 00006F  8746 0078                            CL       120,B6

      201     9033    2              KZ@LINCTX.TIMER.POL=0;

   9033   2 000071  8746 0028                            CL       40,B6
          2 000073  8746 0029                            CL       41,B6

PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:71   
      202     9034
      203     9035        /*       Set up the timeout values */
      204     9036    2              LINESPEED=BAUDMAPS(KH$CHN.LINSPD)/8 /* SPEED IN BYTES PER SECOND */ ;

   9036   2 000075  DCC6 0002                            LDB,B5   2,B6
          2 000077  B845 0008                            LDR,R3   8,B5
          2 000079  B570 000F                            AND,R3   15,IMO
          2 00007B  E830 0000 0025  00                   LDR,R6   BAUDMAPS,R3
          2 00007E  6043                                 SOR,R6   3
          2 00007F  EF47 0021                            STR,R6   LINESPEED,AUTO

      205     9037        /*         KZ@LINCTX.TIMOUT.PRIMARY=    allows for one buffer load + 500 ms line tu
              9037        rnaround time
      206     9038                     (KZ@LINCTX.PRO.BLKBYTES+LENGTHC(KZ$HIPHEAD)+LENGTHC(KZ$HIPTAIL)
      207     9039                     +LINESPEED -1 +LINESPEED/2 )/LINESPEED;*/
      208     9040        /*         KZ@LINCTX.TIMOUT.SECONDARY=   allows for one buffr load in, 250 ms turna
              9040        round per possible controller
      209     9041                     (2*(KZ@LINCTX.PRO.BLKBYTES+LENGTHC(KZ$HIPHEAD)+LENGTHC(KZ$HIPTAIL))
      210     9042                     +LINESPEED -1+ LINESPEED*KZ@LINCTX.POLSIZ/4 )/LINESPEED;*/
      211     9043    2              KZ@LINCTX.TIMOUT.PRIMARY= 2;

   9043   2 000081  5C02                                 LDV,R5   2
          2 000082  DF46 0086                            STR,R5   134,B6

      212     9044    2              KZ@LINCTX.TIMOUT.SECONDARY= 2;

   9044   2 000084  DF46 0087                            STR,R5   135,B6

      213     9045
      214     9046        /* Because I may have to live with 3270's, use my
      215     9047           stats buffer only if 3270's is absent */
      216     9048
      217     9049        /*            **** ASSUME NO 3270'S EXIST ****
      218     9050                   IF ADDR(KZ@STT)=ADDR(NIL) THEN
      219     9051                   DO;
      220     9052                      KZ@HIPSTT$=ADDR(KZ@HIPSTT_STATIC);
      221     9053                      KZ_HIP_HDR.STTBFR$=ADDR(KZ@HIPSTT_KZO);
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:72   
      222     9054                      END;
      223     9055                   ELSE
      224     9056                   DO;
      225     9057                      KZ@HIPSTT$=ADDR(KZ@STT);
      226     9058                      KZ_HIP_HDR.STTBFR$=ADDR(KZ@BSCSTT);
      227     9059                      END;
      228     9060        */
      229     9061
      230     9062        /* Unfortunately, the input buffer acquired for me is too small:
      231     9063             need to be able to handle a full screen's worth of info.
      232     9064
      233     9065            Release the current input buffer and get a buffer big enuf to
      234     9066            handle everything.
      235     9067        */
      236     9068
      237     9069    2              CALL KVB$RLSSYS(KZ@LINCTX.INPBFRSIZ,KZ@LINCTX.INPBFR$);

   9069   2 000086  CBC6 0056                            LAB,B4   86,B6
          2 000088  CFC7 006A                            STB,B4   FPT_WRSYSLOG+24,AUTO
          2 00008A  DBC6 0058                            LAB,B5   88,B6
          2 00008C  DFC7 0068                            STB,B5   FPT_WRSYSLOG+22,AUTO
          2 00008E  BBC7 0068                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 000090  CBF0 0200                            LAB,B4   512,IMO
          2 000092  E380 0000 0000  xent                 LNJ,B6   KVB$RLSSYS
          2 000095       0001                            DC       s:9070,PREL

      238     9070    2              KZ@LINCTX.INPBFRSIZ=1024;

   9070   2 000096  ECC7 0004                            LDB,B6   @KZ@LINCTX,AUTO
          2 000098  E870 0400                            LDR,R6   1024,IMO
          2 00009A  EF46 0058                            STR,R6   88,B6

      239     9071    2              CALL KVB$GETSYS(KZ@LINCTX.INPBFRSIZ,KZ@LINCTX.INPBFR$)

   9071   2 00009C  DBC6 0056                            LAB,B5   86,B6
          2 00009E  DFC7 006A                            STB,B5   FPT_WRSYSLOG+24,AUTO
          2 0000A0  CBC6 0058                            LAB,B4   88,B6
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:73   
          2 0000A2  CFC7 0068                            STB,B4   FPT_WRSYSLOG+22,AUTO
          2 0000A4  BBC7 0068                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 0000A6  CBF0 0200                            LAB,B4   512,IMO
          2 0000A8  E380 0000 0000  xent                 LNJ,B6   KVB$GETSYS
          2 0000AB       0003                            DC       s:9074,PREL
          2 0000AC  0F81 0021                            B        s:9080,PREL

      240     9072    2              WHENALTRETURN
      241     9073    3              DO;

      242     9074    3                 CALL ERRLOG (%E$NO_MEMORY);

   9074   2 0000AE  EBF0 00D0                            LAB,B6   208,IMO
          2 0000B0  DB80 0000 0000                       LAB,B5   0
          2 0000B3  DFC7 0050                            STB,B5   @ERROR+2,AUTO
          2 0000B5  EFC7 004E                            STB,B6   P7814+9,AUTO
          2 0000B7  E3C0 078A                            LNJ,B6   s:0,PREL
          2 0000B9       0001                            DC       s:9075,PREL

      243     9075    3                 KZ@LINCTX.INPBFR$ = ADDR (NIL);

   9075   2 0000BA  EB80 0000 0000                       LAB,B6   0
          2 0000BD  DCC7 0004                            LDB,B5   @KZ@LINCTX,AUTO
          2 0000BF  EFC5 0056                            STB,B6   86,B5

      244     9076    3                 KZ@LINCTX.INPBFRSIZ = 0;

   9076   2 0000C1  8745 0058                            CL       88,B5

      245     9077    3                 CALL KZH$DSC_LINE (KZ@LINCTX);

   9077   2 0000C3  BBC7 0004                            LAB,B3   @KZ@LINCTX,AUTO
          2 0000C5  CBF0 0100                            LAB,B4   256,IMO
          2 0000C7  E380 0000 0000  xent                 LNJ,B6   KZH$DSC_LINE
          2 0000CA       0001                            DC       s:9078,PREL

      246     9078    3                 RETURN;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:74   

   9078   2 0000CB  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      247     9079    3                 END;
      248     9080    2              KZ@LINCTX.OTPCNT=0;

   9080   2 0000CE  ECC7 0004                            LDB,B6   @KZ@LINCTX,AUTO
          2 0000D0  8746 004D                            CL       77,B6

      249     9081
      250     9082        /*     KZ@LINCTX.OTPCNT does not get set to zero by common line driver. Zap it now.
              9082             */
      251     9083    2              IF KZ@LINCTX.OTPHD$=ADDR(NIL) THEN

   9083   2 0000D2  8DC6 0052                            CMN      82,B6
          2 0000D4  0981 0003                            BNE      s:9091,PREL

      252     9084    2                 KZ@LINCTX.OTPCNT=0;

   9084   2 0000D6  8746 004D                            CL       77,B6

      253     9085
      254     9086
      255     9087
      256     9088        /*       Now begin at the normal restart point for polled vip:
      257     9089                 search for output to send.
      258     9090        */
      259     9091    2              KZ@BSCFPT.EVT= %KZ#HIPEVT_SEARCH;

   9091   2 0000D8  DCC7 0006                            LDB,B5   @KZ@BSCFPT,AUTO
          2 0000DA  6C09                                 LDV,R6   9
          2 0000DB  EF45 0001                            STR,R6   1,B5

      260     9092    2              KZ@BSCFPT.FNC= %KZ#FNC_MOV;

   9092   2 0000DD  5C03                                 LDV,R5   3
          2 0000DE  DF45 0004                            STR,R5   4,B5
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:75   

      261     9093    2              ALTRETURN;

   9093   2 0000E0  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      262     9094             %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:76   
      263     9095        /*       %KZ#HIPACT_URCERR,KZ#HIPACT_DSRDROP
      264     9096                      Currently there is no code in the MLCP that signals
      265     9097                      an unrecoverable error. This case included only for
      266     9098                      completeness.
      267     9099        */
      268     9100    2            CASE(%KZ#HIPACT_URCERR,%KZ#HIPACT_DSRDROP);

      269     9101
      270     9102        /* I keep the current output buffer linked onto the device.
      271     9103           Thus, there is no reason for common line manager to
      272     9104           release the current output buffer.
      273     9105
      274     9106           Set the current output buffer address to NIL
      275     9107        */
      276     9108
      277     9109
      278     9110    2              KZ@BSCFPT.FNC=%KZ#FNC_DSC /* Tell CLM to disconnect */;

   9110   2 0000E3  6C02                                 LDV,R6   2
          2 0000E4  EF45 0004                            STR,R6   4,B5

      279     9111    2              ALTRETURN;

   9111   2 0000E6  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      280     9112        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:77   
      281     9113        /*       %KZ#HIPACT_SEARCH
      282     9114                      This is the action used to find device that
      283     9115                      has any output pending. If no output is pending,
      284     9116                      then merely go back to state 'MAIN', which will
      285     9117                      be kicked off MAIN by the clock when its time to
      286     9118                      poll.
      287     9119        */
      288     9120    2            CASE(%KZ#HIPACT_SEARCH);

      289     9121
      290     9122    2              CALL SET_TNOW;

   9122   2 0000E9  E3C0 0A4D                            LNJ,B6   s:0,PREL
          2 0000EB       0001                            DC       s:9124,PREL

      291     9123
      292     9124    2             CALL CHECK_INTERVAL(PRINTER_CHECK_INTERVAL,KZ@LINCTX.TIMR.SPCPOL) ALTRET(
              9124                       CHECKING_PRINTERS);

   9124   2 0000EC  ECC7 0004                            LDB,B6   @KZ@LINCTX,AUTO
          2 0000EE  DBC6 0079                            LAB,B5   121,B6
          2 0000F0  DFC7 003E                            STB,B5   POLSIZ+1,AUTO
          2 0000F2  CB80 0000 0019  00                   LAB,B4   PRINTER_CHECK_INTERVAL
          2 0000F5  CFC7 003C                            STB,B4   POLADR+1,AUTO
          2 0000F7  E3C0 0A51                            LNJ,B6   s:0,PREL
          2 0000F9       0003                            DC       s:9124,PREL

      293     9125
      294     9126    3              DO WHILE('0'B);

   9126   2 0000FA  0F81 0004                            B        s:9131,PREL

   9124   2                              CHECKING_PRINTE*null
      295     9127    3   CHECKING_PRINTERS:;
      296     9128    3                 CALL GOOSE_PRINTERS;

   9128   2 0000FC  E3C0 0A6D            CHECKING_PRINTE*LNJ,B6   s:0,PREL
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:78   
          2 0000FE       0001                            DC       s:9131,PREL

      297     9129    3                 END;

      298     9130
      299     9131    2              KZ@LINCTX.TIMOUT.USESEC='0'B; /* USE SHORT TIMEOUT VALUE */

   9131   2 0000FF  ECC7 0004                            LDB,B6   @KZ@LINCTX,AUTO
          2 000101  8846 0088                            LBF,'8000'X       136,B6
          2 000103       8000

      300     9132    2              KZ@LINCTX.RTRCNT=0;

   9132   2 000104  8746 0039                            CL       57,B6

      301     9133    2              KZ$EVENT.EVENT=%KZ#LINFCN_GETOTP;

   9133   2 000106  6C01                                 LDV,R6   1
          2 000107  EF47 0008                            STR,R6   KZ$EVENT,AUTO

      302     9134    2              CALL KZ@LINCTX.DEVMGR@(KZ$EVENT)

   9134   2 000109  DBC7 0008                            LAB,B5   KZ$EVENT,AUTO
          2 00010B  DFC7 0068                            STB,B5   FPT_WRSYSLOG+22,AUTO
          2 00010D  BBC7 0068                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 00010F  9CC6 006E                            LDB,B1   110,B6
          2 000111  CBF0 0100                            LAB,B4   256,IMO
          2 000113  E381                                 LNJ,B6   ,B1
          2 000114       000C                            DC       s:9137,PREL

      303     9135    2                ALTRET(SEARCH_FINDS_NOBODY);
      304     9136    2              KZ@BSCFPT.FNC=%KZ#FNC_MOV;

   9136   2 000115  ECC7 0006                            LDB,B6   @KZ@BSCFPT,AUTO
          2 000117  6C03                                 LDV,R6   3
          2 000118  EF46 0004                            STR,R6   4,B6

PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:79   
      305     9137    2              KZ@BSCFPT.EVT=%KZ#HIPEVT_SEND;

   9137   2 00011A  5C0B                                 LDV,R5   11
          2 00011B  DF46 0001                            STR,R5   1,B6

      306     9138    2              ALTRETURN;

   9138   2 00011D  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

   9137   2                              SEARCH_FINDS_NO*null
   9137   2                              TIME_TO_POLL_ALLnull
      307     9139    2   SEARCH_FINDS_NOBODY:;
      308     9140    2   TIME_TO_POLL_ALL:;
      309     9141
      310     9142
      311     9143    2              KZ@BSCFPT.FNC=%KZ#FNC_MOV;

   9143   2 000120  ECC7 0006            TIME_TO_POLL_ALLLDB,B6   @KZ@BSCFPT,AUTO
          2 000122  6C03                                 LDV,R6   3
          2 000123  EF46 0004                            STR,R6   4,B6

      312     9144    2              KZ@BSCFPT.EVT=%KZ#HIPEVT_POLALL;

   9144   2 000125  5C06                                 LDV,R5   6
          2 000126  DF46 0001                            STR,R5   1,B6

      313     9145    2              KZ@LINCTX.RTRCNT=0;

   9145   2 000128  DCC7 0004                            LDB,B5   @KZ@LINCTX,AUTO
          2 00012A  8745 0039                            CL       57,B5

      314     9146    2              KZ$EVENT.EVENT=%KZ#LINFCN_SPCPOLALL;

   9146   2 00012C  4C0C                                 LDV,R4   12
          2 00012D  CF47 0008                            STR,R4   KZ$EVENT,AUTO

      315     9147    2              CALL KZ@LINCTX.DEVMGR@(KZ$EVENT)
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:80   

   9147   2 00012F  CBC7 0008                            LAB,B4   KZ$EVENT,AUTO
          2 000131  CFC7 0068                            STB,B4   FPT_WRSYSLOG+22,AUTO
          2 000133  BBC7 0068                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 000135  9CC5 006E                            LDB,B1   110,B5
          2 000137  CBF0 0100                            LAB,B4   256,IMO
          2 000139  E381                                 LNJ,B6   ,B1
          2 00013A       0004                            DC       s:9147,PREL

      316     9148    2                ALTRET(NO_ACTIVE_CONTROLLERS);
      317     9149    2              ALTRETURN;

   9149   2 00013B  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

   9147   2                              NO_ACTIVE_CONTR*null
      318     9150    2   NO_ACTIVE_CONTROLLERS:;
      319     9151    2              KZ@LINCTX.POLLTBL$->KZ$POLLHIP.CONTINUE_POLL='0'B;

   9151   2 00013E  ECC7 0004            NO_ACTIVE_CONTR*LDB,B6   @KZ@LINCTX,AUTO
          2 000140  DCC6 0083                            LDB,B5   131,B6
          2 000142  8805                                 LBF,'0080'X       ,B5
          2 000143       0080

      320     9152    2              ALTRETURN;

   9152   2 000144  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      321     9153        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:81   
      322     9154        /*       %KZ#HIPACT_POLALL
      323     9155                      It has been determined to poll everybody again.
      324     9156        */
      325     9157    2            CASE(%KZ#HIPACT_POLALL);

      326     9158    2              KZ@LINCTX.TIMOUT.USESEC='0'B; /* USE LONG TIMEOUT INTERVAL */

   9158   2 000147  8846 0088                            LBF,'8000'X       136,B6
   9158   2 000149       8000

      327     9159    2              CALL CONTINUE_POLLING ALTRET(POLL_ALL_FINISHED);

   9159   2 00014A  E3C0 083A                            LNJ,B6   s:0,PREL
          2 00014C       0004                            DC       s:9158,PREL

      328     9160    2              RETURN;

   9160   2 00014D  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

   9158   2                              POLL_ALL_FINISH*null
      329     9161
      330     9162    2   POLL_ALL_FINISHED:;
      331     9163        /* And not a creature was stirring, not even a mouse */
      332     9164    2              KZ@BSCFPT.EVT= %KZ#HIPEVT_POLDUN;

   9164   2 000150  ECC7 0006            POLL_ALL_FINISH*LDB,B6   @KZ@BSCFPT,AUTO
          2 000152  6C07                                 LDV,R6   7
          2 000153  EF46 0001                            STR,R6   1,B6

      333     9165    2              KZ@BSCFPT.FNC= %KZ#FNC_MOV;

   9165   2 000155  5C03                                 LDV,R5   3
          2 000156  DF46 0004                            STR,R5   4,B6

      334     9166    2              ALTRETURN;

   9166   2 000158  C380 0000 0000  xent                 LNJ,B4   X6A_AALT
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:82   

      335     9167        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:83   
      336     9168        /*       %KZ#HIPACT_SEND
      337     9169                      Finally send a message.
      338     9170        */
      339     9171    2            CASE(%KZ#HIPACT_SEND);

      340     9172    2              OBFR$ = PINCRW(KZ@LINCTX.OTPBFR$,

   9172   2 00015B  CCC6 005A                            LDB,B4   90,B6
          2 00015D  ABC4 0008                            LAB,B2   8,B4
          2 00015F  AFC7 0023                            STB,B2   OBFR$,AUTO

      341     9173    2                SIZEW(KZ$OTPBFR));
      342     9174    2              KZ@LINCTX.OTPDATSIZ = KZ@LINCTX.OTPBFR$ ->

   9174   2 000161  E844 0003                            LDR,R6   3,B4
          2 000163  6E05                                 ADV,R6   5
          2 000164  EF46 005D                            STR,R6   93,B6

      343     9175    2                KZ$OTPBFR.DATA_SIZ+LENGTHC(KZ$HIPTAIL);
      344     9176    2              KZ@LINCTX.OTPBFR$=OBFR$;

   9176   2 000166  AFC6 005A                            STB,B2   90,B6

      345     9177
      346     9178        /* Space has been left for link protocol header & trailer.
      347     9179            fill them in NOW with the detail */
      348     9180    2              OBFR$->KZ$HIPHEAD=KZ@HIPHEAD;

   9180   2 000168  AB80 0000 0000  00                   LAB,B2   KZ_EVENT
          2 00016B  2C70                                 LDV,R2   112
          2 00016C  6C09                                 LDV,R6   9
          2 00016D  BCC7 0023                            LDB,B3   OBFR$,AUTO
          2 00016F  3C00                                 LDV,R3   0
          2 000170  0008                                 MMM

      349     9181    2              OBFR$->KZ$HIPHEAD.ADR_U=

PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:84   
   9181   2 000171  CCC6 005E                            LDB,B4   94,B6
          2 000173  E2C4 000A                            LLH,R6   10,B4
          2 000175  6E40                                 ADV,R6   64
          2 000176  BCC7 0023                            LDB,B3   OBFR$,AUTO
          2 000178  E783                                 STH,R6   ,B3

      350     9182    2                KZ@LINCTX.OTPCTR$->KZ@HIPCTR.ADR+64;
      351     9183    3              DO SELECT(KZ@LINCTX.OTPCTR$->KZ@HIPCTR.TYP);

   9183   2 000179  CCC6 005E                            LDB,B4   94,B6
          2 00017B  E844 0008                            LDR,R6   8,B4
          2 00017D  E970 1E7C                            CMR,R6   7804,IMO
          2 00017F  0201 0009                            BL       s:9183+16,PREL
          2 000181  0901 0015                            BE       s:9187,PREL
          2 000183  E970 1E86                            CMR,R6   7814,IMO
          2 000185  0981 0013                            BNE      s:9189,PREL
          2 000187  0F81 000F                            B        s:9187,PREL
          2 000189  E970 1E14                            CMR,R6   7700,IMO
          2 00018B  0981 000D                            BNE      s:9189,PREL
          2 00018D  0F81 0001                            B        s:9185,PREL

      352     9184    3                 SELECT(7700)/* SEPARATELY ADDRESSED PRINTER DEVICE */;

      353     9185    3                 DEV_ADR_NO=KZ@LINCTX.OTPDEV$->KZ@HIPDEV.ADR;

   9185   2 00018F  ACC6 0062                            LDB,B2   98,B6
          2 000191  D2C2 0015                            LLH,R5   21,B2
          2 000193  DF47 0022                            STR,R5   DEV_ADR_NO,AUTO
          2 000195  0F81 0003                            B        s:9189,PREL

      354     9186    3                 SELECT(7814,7804)/* PRINTER ADDRESSED VIA ESCAPE SEQ */;

      355     9187    3                 DEV_ADR_NO=0;

   9187   2 000197  8747 0022                            CL       DEV_ADR_NO,AUTO

      356     9188    3                 END;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:85   

      357     9189    2              OBFR$->KZ$HIPHEAD.DEV_B=

   9189   2 000199  B847 0022                            LDR,R3   DEV_ADR_NO,AUTO
          2 00019B  D2B0 0000 001D  00                   LLH,R5   DEVBYTES_B,R3
          2 00019E  5008                                 SOL,R5   8
          2 00019F  5048                                 SOR,R5   8
          2 0001A0  D7C3 0002                            STH,R5   2,B3

      358     9190    2                DEVBYTES_B(DEV_ADR_NO);
      359     9191    2              OBFR$->KZ$HIPHEAD.STA_B=

   9191   2 0001A2  E2B0 0000 0021  00                   LLH,R6   STABYTES_B,R3
          2 0001A5  6008                                 SOL,R6   8
          2 0001A6  6048                                 SOR,R6   8
          2 0001A7  EAC3 0002                            SRM,R6,'00FF'X    2,B3
          2 0001A9       00FF

      360     9192    2                STABYTES_B(DEV_ADR_NO);
      361     9193    2              ENDX=KZ@LINCTX.OTPDATSIZ-LENGTHC(KZ@HIPTAIL);

   9193   2 0001AA  E846 005D                            LDR,R6   93,B6
          2 0001AC  6EFB                                 ADV,R6   -5
          2 0001AD  EF47 0025                            STR,R6   ENDX,AUTO

      362     9194    2              CALL INSERT(OBFR$->CHRS,ENDX,LENGTHC(KZ@HIPTAIL),

   9194   2 0001AF  AB80 0000 0000  00                   LAB,B2   KZ_EVENT
          2 0001B2  2C6A                                 LDV,R2   106
          2 0001B3  6C05                                 LDV,R6   5
          2 0001B4  B847 0025                            LDR,R3   ENDX,AUTO
          2 0001B6  0008                                 MMM

      363     9195    2                SUBSTR(ADDR(KZ@HIPTAIL)->CHRS,0,LENGTHC(KZ@HIPTAIL)));
      364     9196    2             CALL INSERT(OBFR$->CHRS,ENDX+POFFC(ADDR(KZ@HIPTAIL.ADR_U),ADDR(KZ@HIPTAIL
              9196                       )),1,

PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:86   
   9196   2 0001B7  CB80 0000 0000  00                   LAB,B4   KZ_EVENT
          2 0001BA  CFC7 0068                            STB,B4   FPT_WRSYSLOG+22,AUTO
          2 0001BC  8CC7 0068                            LDI      FPT_WRSYSLOG+22,AUTO
          2 0001BE  8470 0000 0035                       AID      53,IMO
          2 0001C1  7031                                 DCL,R7   1
          2 0001C2  BB80 0000 0000  00                   LAB,B3   KZ_EVENT
          2 0001C5  BFC7 006A                            STB,B3   FPT_WRSYSLOG+24,AUTO
          2 0001C7  8D47 006C                            SDI      FPT_WRSYSLOG+26,AUTO
          2 0001C9  8CC7 006A                            LDI      FPT_WRSYSLOG+24,AUTO
          2 0001CB  7031                                 DCL,R7   1
          2 0001CC  8470 0000 006B                       AID      107,IMO
          2 0001CF  7071                                 DCR,R7   1
          2 0001D0  7031                                 DCL,R7   1
          2 0001D1  84C7 006C                            SID      FPT_WRSYSLOG+26,AUTO
          2 0001D3  8D47 006E                            SDI      FPT_WRSYSLOG+28,AUTO
          2 0001D5  F847 0025                            LDR,R7   ENDX,AUTO
          2 0001D7  6C00                                 LDV,R6   0
          2 0001D8  8447 006E                            AID      FPT_WRSYSLOG+28,AUTO
          2 0001DA  ACC6 005E                            LDB,B2   94,B6
          2 0001DC  D2C2 000A                            LLH,R5   10,B2
          2 0001DE  5E20                                 ADV,R5   32
          2 0001DF  5008                                 SOL,R5   8
          2 0001E0  5068                                 SAR,R5   8
          2 0001E1  9CC7 0023                            LDB,B1   OBFR$,AUTO
          2 0001E3  B857                                 LDR,R3   R7
          2 0001E4  D7B1                                 STH,R5   ,B1,R3

      365     9197    2                BINASC(KZ@LINCTX.OTPCTR$->KZ@HIPCTR.ADR+32));
      366     9198
      367     9199    2              CALL SET_TNOW;

   9199   2 0001E5  E3C0 0951                            LNJ,B6   s:0,PREL
          2 0001E7       0001                            DC       s:9200,PREL

      368     9200    2              KZ@LINCTX.OTPDEV$->KZ$HIPDEV.XMT_TIME=TNOW;

   9200   2 0001E8  ECC7 0004                            LDB,B6   @KZ@LINCTX,AUTO
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:87   
          2 0001EA  DCC6 0062                            LDB,B5   98,B6
          2 0001EC  8CC7 0029                            LDI      TNOW,AUTO
          2 0001EE  8D45 0020                            SDI      32,B5

      369     9201    2              KZ@LINCTX.RTRCNT=0;

   9201   2 0001F0  8746 0039                            CL       57,B6

      370     9202
      371     9203    2              CALL KZT_ORDERS@( %KZ#SEND_BLOCK, KZ@LINCTX );

   9203   2 0001F2  DBF0 0001                            LAB,B5   1,IMO
          2 0001F4  EFC7 006A                            STB,B6   FPT_WRSYSLOG+24,AUTO
          2 0001F6  DFC7 0068                            STB,B5   FPT_WRSYSLOG+22,AUTO
          2 0001F8  BBC7 0068                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 0001FA  9C80 0000 0000  xsym                 LDB,B1   KZT_ORDERS@
          2 0001FD  CBF0 0200                            LAB,B4   512,IMO
          2 0001FF  E381                                 LNJ,B6   ,B1
          2 000200       0001                            DC       s:9203+15,PREL
          2 000201  0F81 02D0                            B        s:9504,PREL

      372     9204        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:88   
      373     9205        /*       %KZ#HIPACT_SENDTO
      374     9206                      Implicit read of a reply timed out. Device
      375     9207                      (or controller) may not be powered up, or he
      376     9208                      never got the select or poll message
      377     9209
      378     9210                 Give the controller another chance at answering the message,
      379     9211                 by requeueing the selected device at the tail of output queue.
      380     9212                 If the controller does not answer the second time, hang him up.
      381     9213        */
      382     9214    2            CASE(%KZ#HIPACT_SENDTO);

      383     9215    2              KZ$EVENT.EVENT=%KZ#LINFCN_REQOTP;

   9215   2 000203  6C02                                 LDV,R6   2
          2 000204  EF47 0008                            STR,R6   KZ$EVENT,AUTO

      384     9216    2              CALL KZ@LINCTX.DEVMGR@(KZ$EVENT);

   9216   2 000206  CBC7 0008                            LAB,B4   KZ$EVENT,AUTO
          2 000208  CFC7 0068                            STB,B4   FPT_WRSYSLOG+22,AUTO
          2 00020A  BBC7 0068                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 00020C  9CC6 006E                            LDB,B1   110,B6
          2 00020E  CBF0 0100                            LAB,B4   256,IMO
          2 000210  E381                                 LNJ,B6   ,B1
          2 000211       0001                            DC       s:9217,PREL

      385     9217    2              IF KZ@LINCTX.OTPCTR$->KZ$HIPCTR.TIMED_OUT_ONCE THEN

   9217   2 000212  ECC7 0004                            LDB,B6   @KZ@LINCTX,AUTO
          2 000214  DCC6 005E                            LDB,B5   94,B6
          2 000216  82C5 000A                            LB,'0080'X        10,B5
          2 000218       0080
          2 000219  0581 0012                            BBF      s:9224,PREL

      386     9218    3              DO;

      387     9219    3                 KZ$EVENT.EVENT=%KZ#LINFCN_POLTIMOUT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:89   

   9219   2 00021B  6C05                                 LDV,R6   5
          2 00021C  EF47 0008                            STR,R6   KZ$EVENT,AUTO

      388     9220    3                 CALL KZ@LINCTX.DEVMGR@(KZ$EVENT);

   9220   2 00021E  CBC7 0008                            LAB,B4   KZ$EVENT,AUTO
          2 000220  CFC7 0068                            STB,B4   FPT_WRSYSLOG+22,AUTO
          2 000222  BBC7 0068                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 000224  9CC6 006E                            LDB,B1   110,B6
          2 000226  CBF0 0100                            LAB,B4   256,IMO
          2 000228  E381                                 LNJ,B6   ,B1
          2 000229       0001                            DC       s:9221,PREL

      389     9221    3                 END;

   9221   2 00022A  0F81 0004                            B        s:9226,PREL

      390     9222    2              ELSE
      391     9223    3              DO;

      392     9224    3                 KZ@LINCTX.OTPCTR$->KZ$HIPCTR.TIMED_OUT_ONCE='1'B;

   9224   2 00022C  8945 000A                            LBT,'0080'X       10,B5
   9224   2 00022E       0080

      393     9225    3                 END;

      394     9226    2              KZ@BSCFPT.FNC=%KZ#FNC_MOV;

   9226   2 00022F  ECC7 0006                            LDB,B6   @KZ@BSCFPT,AUTO
          2 000231  6C03                                 LDV,R6   3
          2 000232  EF46 0004                            STR,R6   4,B6

      395     9227    2              KZ@BSCFPT.EVT=%KZ#HIPEVT_SEARCH;

   9227   2 000234  5C09                                 LDV,R5   9
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:90   
          2 000235  DF46 0001                            STR,R5   1,B6

      396     9228    2              ALTRETURN;

   9228   2 000237  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      397     9229        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:91   
      398     9230        /*       %KZ#HIPACT_SNDRSP
      399     9231                      A reply has been heard from a device. I hope
      400     9232                      its the same device to whom I just sent a message
      401     9233        */
      402     9234    2            CASE(%KZ#HIPACT_SNDRSP);

      403     9235    2              CALL PARSE_INPUT ;

   9235   2 00023A  E3C0 02A2                            LNJ,B6   s:0,PREL
          2 00023C       0001                            DC       s:9242,PREL

      404     9236
      405     9237        /*  Sometimes a terminal will refuse to answer a msg with anything
      406     9238            other than EOT. The following special case code will recognize the
      407     9239            condition at treat it as if a NAK was rcv'd
      408     9240        */
      409     9241
      410     9242    2              IF KZ@LINCTX.RTRCNT~=0 THEN

   9242   2 00023D  ECC7 0004                            LDB,B6   @KZ@LINCTX,AUTO
          2 00023F  E846 0039                            LDR,R6   57,B6
          2 000241  6901 000D                            BEZ,R6   s:9244,PREL

      411     9243    2                 CALL ERRLOG(%E$HIPIO_OK);

   9243   2 000243  DBF0 00D5                            LAB,B5   213,IMO
          2 000245  CB80 0000 0000                       LAB,B4   0
          2 000248  CFC7 0050                            STB,B4   @ERROR+2,AUTO
          2 00024A  DFC7 004E                            STB,B5   P7814+9,AUTO
          2 00024C  E3C0 05F5                            LNJ,B6   s:0,PREL
          2 00024E       0001                            DC       s:9244,PREL

      412     9244    2              KZ@LINCTX.CURCTR$->KZ$HIPCTR.TIMED_OUT_ONCE='0'B;

   9244   2 00024F  ECC7 0004                            LDB,B6   @KZ@LINCTX,AUTO
          2 000251  DCC6 004E                            LDB,B5   78,B6
          2 000253  8845 000A                            LBF,'0080'X       10,B5
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:92   
          2 000255       0080

      413     9245    2              KZ@LINCTX.RTRCNT=0;

   9245   2 000256  8746 0039                            CL       57,B6

      414     9246    2              IF KZ@LINCTX.OTPDEV$~=ADDR(NIL) THEN

   9246   2 000258  8DC6 0062                            CMN      98,B6
          2 00025A  0901 0027                            BE       s:9254,PREL

      415     9247    3              DO CASE(KZ@LINCTX.OTPDEV$->KZ$HIPDEV.ADR);

   9247   2 00025C  DCC6 0062                            LDB,B5   98,B6
          2 00025E  B2C5 0015                            LLH,R3   21,B5
          2 000260  3D01                                 CMV,R3   1
          2 000261  0281 0020                            BGE      s:9254,PREL
          2 000263  A830 0000 0269  02                   LDR,R2   s:9247+13,R3
          2 000266  83A0 0000 026A  02                   JMP      s:9249,R2
          2 000269       0000                            DC       s:9249,PREL

      416     9248    3               CASE(0);

      417     9249    3                 KZ@LINCTX.OTPDEV$->KZ$HIPDEV.KBDLCK='0'B;

   9249   2 00026A  8845 001C                            LBF,'0080'X       28,B5
   9249   2 00026C       0080

      418     9250    3                 IF NOT (ACKS(0) OR NAKS(0) OR PGOV(0) OR INPUT.PRESENT) THEN

   9250   2 00026D  89C7 002D                            CMZ      ACKS,AUTO
          2 00026F  0801 0012                            BAL      s:9254,PREL
          2 000271  89C7 002E                            CMZ      NAKS,AUTO
          2 000273  0801 000E                            BAL      s:9254,PREL
          2 000275  89C7 0030                            CMZ      PGOV,AUTO
          2 000277  0801 000A                            BAL      s:9254,PREL
          2 000279  89C7 0036                            CMZ      INPUT+2,AUTO
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:93   
          2 00027B  0801 0006                            BAL      s:9254,PREL

      419     9251    3                    NAKS(0)='1'B;

   9251   2 00027D  8947 002E                            LBT,'8000'X       NAKS,AUTO
   9251   2 00027F       8000
          2 000280  0F81 0001                            B        s:9254,PREL

      420     9252    3               CASE(1);

      421     9253    3               END;

      422     9254    2              CALL SHIP_POSSIBLE_INPUT;

   9254   2 000282  E3C0 080B                            LNJ,B6   s:0,PREL
          2 000284       0001                            DC       s:9255,PREL

      423     9255    2              CALL PROCESS_IMMED_STATUS ;

   9255   2 000285  E3C0 0457                            LNJ,B6   s:0,PREL
          2 000287       0001                            DC       s:9256,PREL

      424     9256    2              CALL PROCESS_DELAYED_STATUS;

   9256   2 000288  E3C0 0559                            LNJ,B6   s:0,PREL
          2 00028A       0001                            DC       s:9257,PREL

      425     9257    2              KZ@BSCFPT.FNC=%KZ#FNC_MOV;

   9257   2 00028B  ECC7 0006                            LDB,B6   @KZ@BSCFPT,AUTO
          2 00028D  6C03                                 LDV,R6   3
          2 00028E  EF46 0004                            STR,R6   4,B6

      426     9258    2              KZ@BSCFPT.EVT=%KZ#HIPEVT_SEARCH;

   9258   2 000290  5C09                                 LDV,R5   9
          2 000291  DF46 0001                            STR,R5   1,B6
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:94   

      427     9259        /*  See if POLL interval has expired. If it has, then
      428     9260            start a general poll cycle.
      429     9261
      430     9262
      431     9263            Placing the test here means that at least ONE
      432     9264            block of output will be transmitted per poll
      433     9265            cycle, no matter how short that poll cycle is. */
      434     9266
      435     9267    2              CALL SET_TNOW;

   9267   2 000293  E3C0 08A3                            LNJ,B6   s:0,PREL
          2 000295       0001                            DC       s:9268,PREL

      436     9268    2              KZ@LINCTX.TIMOUT.USESEC='0'B; /* USE SHORT TIMEOUT VALUE */

   9268   2 000296  ECC7 0004                            LDB,B6   @KZ@LINCTX,AUTO
          2 000298  8846 0088                            LBF,'8000'X       136,B6
          2 00029A       8000

      437     9269    2              POLL_INTERVAL=KZ@LINCTX.PRO.INTERVAL

   9269   2 00029B  E846 003F                            LDR,R6   63,B6
          2 00029D  EF47 002C                            STR,R6   POLL_INTERVAL,AUTO

      438     9270    2                  /* get to 1/120 second units */;
      439     9271    2              IF POLL_INTERVAL=0 THEN POLL_INTERVAL=120;

   9271   2 00029F  6981 0006                            BNEZ,R6  s:9272,PREL

   9271   2 0002A1  6C78                                 LDV,R6   120
          2 0002A2  EF47 002C                            STR,R6   POLL_INTERVAL,AUTO
          2 0002A4  0F81 0009                            B        s:9273,PREL

      440     9272    2              ELSE IF POLL_INTERVAL>1200 THEN POLL_INTERVAL=1200;

   9272   2 0002A6  E970 04B0                            CMR,R6   1200,IMO
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:95   
          2 0002A8  0381 0005                            BLE      s:9273,PREL

   9272   2 0002AA  E870 04B0                            LDR,R6   1200,IMO
          2 0002AC  EF47 002C                            STR,R6   POLL_INTERVAL,AUTO

      441     9273    2              CALL CHECK_INTERVAL(POLL_INTERVAL,KZ@LINCTX.TIMR.GENPOL) ALTRET(
              9273                       TIME_TO_POLL_ALL);

   9273   2 0002AE  DBC6 0077                            LAB,B5   119,B6
          2 0002B0  DFC7 003E                            STB,B5   POLSIZ+1,AUTO
          2 0002B2  CBC7 002C                            LAB,B4   POLL_INTERVAL,AUTO
          2 0002B4  CFC7 003C                            STB,B4   POLADR+1,AUTO
          2 0002B6  E3C0 0892                            LNJ,B6   s:0,PREL
          2 0002B8       FE68                            DC       s:9137,PREL

      442     9274    2              ALTRETURN;

   9274   2 0002B9  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      443     9275        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:96   
      444     9276        /*       %KZ#HIPACT_SNDRCV
      445     9277                      A parity/checksum/structure error has just happened on
      446     9278                      the read of a replay after a send.
      447     9279
      448     9280                      Try to parse the input record, and take proper actions
      449     9281                      on any status messages that happen to be recognized.
      450     9282
      451     9283                      If it looks like input is present, then send a NAK off
      452     9284                      to the tube in order to get the input retransmitted.
      453     9285        */
      454     9286    2            CASE(%KZ#HIPACT_SNDRCV);

      455     9287    2              CALL PARSE_INPUT ;

   9287   2 0002BC  E3C0 0220                            LNJ,B6   s:0,PREL
          2 0002BE       0001                            DC       s:9288,PREL

      456     9288    2              IF KZ@LINCTX.OTPDEV$~=ADDR(NIL) THEN

   9288   2 0002BF  ECC7 0004                            LDB,B6   @KZ@LINCTX,AUTO
          2 0002C1  8DC6 0062                            CMN      98,B6
          2 0002C3  0901 002B                            BE       s:9296,PREL

      457     9289    3              DO CASE(KZ@LINCTX.OTPDEV$->KZ$HIPDEV.ADR);

   9289   2 0002C5  DCC6 0062                            LDB,B5   98,B6
          2 0002C7  B2C5 0015                            LLH,R3   21,B5
          2 0002C9  3D01                                 CMV,R3   1
          2 0002CA  0281 0024                            BGE      s:9296,PREL
          2 0002CC  A830 0000 02D2  02                   LDR,R2   s:9289+13,R3
          2 0002CF  83A0 0000 02D3  02                   JMP      s:9291,R2
          2 0002D2       0000                            DC       s:9291,PREL

      458     9290    3               CASE(0);

      459     9291    3                 KZ@LINCTX.OTPDEV$->KZ$HIPDEV.KBDLCK='0'B;

PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:97   
   9291   2 0002D3  8845 001C                            LBF,'0080'X       28,B5
   9291   2 0002D5       0080

      460     9292    3                 IF NOT (BUSY(0) OR ACKS(0) OR NAKS(0) OR PGOV(0) OR INPUT.PRESENT)
              9292                          THEN

   9292   2 0002D6  89C7 002F                            CMZ      BUSY,AUTO
          2 0002D8  0801 0016                            BAL      s:9296,PREL
          2 0002DA  89C7 002D                            CMZ      ACKS,AUTO
          2 0002DC  0801 0012                            BAL      s:9296,PREL
          2 0002DE  89C7 002E                            CMZ      NAKS,AUTO
          2 0002E0  0801 000E                            BAL      s:9296,PREL
          2 0002E2  89C7 0030                            CMZ      PGOV,AUTO
          2 0002E4  0801 000A                            BAL      s:9296,PREL
          2 0002E6  89C7 0036                            CMZ      INPUT+2,AUTO
          2 0002E8  0801 0006                            BAL      s:9296,PREL

      461     9293    3                    NAKS(0)='1'B;

   9293   2 0002EA  8947 002E                            LBT,'8000'X       NAKS,AUTO
   9293   2 0002EC       8000
          2 0002ED  0F81 0001                            B        s:9296,PREL

      462     9294    3               CASE(1);

      463     9295    3               END;

      464     9296    2              CALL PROCESS_IMMED_STATUS ;

   9296   2 0002EF  E3C0 03ED                            LNJ,B6   s:0,PREL
          2 0002F1       0001                            DC       s:9297,PREL

      465     9297    2              CALL PROCESS_DELAYED_STATUS;

   9297   2 0002F2  E3C0 04EF                            LNJ,B6   s:0,PREL
          2 0002F4       0001                            DC       s:9298,PREL

PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:98   
      466     9298    2              IF INPUT.PRESENT THEN

   9298   2 0002F5  89C7 0036                            CMZ      INPUT+2,AUTO
          2 0002F7  0881 0007                            BAGE     s:9300,PREL

      467     9299    3              DO;

      468     9300    3                 CALL SEND_NAK ALTRET(SEND_NAK_COUNT_EXCEEDED);

   9300   2 0002F9  E3C0 06BD                            LNJ,B6   s:0,PREL
          2 0002FB       0004                            DC       s:9300,PREL

      469     9301    3                 RETURN;

   9301   2 0002FC  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

   9300   2                              SEND_NAK_COUNT_*null
      470     9302    3   SEND_NAK_COUNT_EXCEEDED:;
      471     9303    3                 END;

      472     9304    2              KZ@BSCFPT.FNC=%KZ#FNC_MOV;

   9304   2 0002FF  ECC7 0006            SEND_NAK_COUNT_*LDB,B6   @KZ@BSCFPT,AUTO
          2 000301  6C03                                 LDV,R6   3
          2 000302  EF46 0004                            STR,R6   4,B6

      473     9305    2              KZ@BSCFPT.EVT=%KZ#HIPEVT_SEARCH;

   9305   2 000304  5C09                                 LDV,R5   9
          2 000305  DF46 0001                            STR,R5   1,B6

      474     9306    2              ALTRETURN;

   9306   2 000307  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      475     9307        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:99   
      476     9308        /*       %KZ#HIPACT_IPOLL
      477     9309                      A general poll has just been completed. Now
      478     9310                      one must do one good deed for this interval,
      479     9311                      and think abount polling the next controller
      480     9312                      on the inactive list.
      481     9313        */
      482     9314    2            CASE(%KZ#HIPACT_IPOLL);

      483     9315
      484     9316        /* See if enough time has elapsed since the last poll operation */
      485     9317    2              INACT_POLL_TICS=KZ@LINCTX.PRO.INTERVAL*KZ@LINCTX.PRO.BLKRECS*%(120/12)
              9317                       /* inactive poll time in 1/120 sec units */;

   9317   2 00030A  F846 003F                            LDR,R7   63,B6
          2 00030C  FB46 003B                            MUL,R7   59,B6
          2 00030E  E857                                 LDR,R6   R7
          2 00030F  6F0A                                 MLV,R6   10
          2 000310  EF47 002B                            STR,R6   INACT_POLL_TICS,AUTO

      486     9318    2              IF INACT_POLL_TICS=0 THEN INACT_POLL_TICS=120;

   9318   2 000312  6981 0006                            BNEZ,R6  s:9319,PREL

   9318   2 000314  6C78                                 LDV,R6   120
          2 000315  EF47 002B                            STR,R6   INACT_POLL_TICS,AUTO
          2 000317  0F81 0009                            B        s:9320,PREL

      487     9319    2              ELSE IF INACT_POLL_TICS>1800 THEN INACT_POLL_TICS=1800;

   9319   2 000319  E970 0708                            CMR,R6   1800,IMO
          2 00031B  0381 0005                            BLE      s:9320,PREL

   9319   2 00031D  E870 0708                            LDR,R6   1800,IMO
          2 00031F  EF47 002B                            STR,R6   INACT_POLL_TICS,AUTO

      488     9320    2              CALL SET_TNOW;

PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:100  
   9320   2 000321  E3C0 0815                            LNJ,B6   s:0,PREL
          2 000323       0001                            DC       s:9321,PREL

      489     9321    2              CALL CHECK_INTERVAL(INACT_POLL_TICS,KZ@LINCTX.TIMER.POL)

   9321   2 000324  ECC7 0004                            LDB,B6   @KZ@LINCTX,AUTO
          2 000326  DBC6 0028                            LAB,B5   40,B6
          2 000328  DFC7 003E                            STB,B5   POLSIZ+1,AUTO
          2 00032A  CBC7 002B                            LAB,B4   INACT_POLL_TICS,AUTO
          2 00032C  CFC7 003C                            STB,B4   POLADR+1,AUTO
          2 00032E  E3C0 081A                            LNJ,B6   s:0,PREL
          2 000330       0023                            DC       s:9335,PREL

      490     9322    2                ALTRET(INACT_POLL_EXPIRED);
      491     9323
      492     9324        /* INACTIVE POLL INTERVAL NOT UP YET, IF NO OUTPUT POLL ANYWAY */
      493     9325    2              KZ$EVENT.EVENT=%KZ#LINFCN_GETOTP;

   9325   2 000331  6C01                                 LDV,R6   1
          2 000332  EF47 0008                            STR,R6   KZ$EVENT,AUTO

      494     9326    2              CALL KZ@LINCTX.DEVMGR@(KZ$EVENT)

   9326   2 000334  EBC7 0008                            LAB,B6   KZ$EVENT,AUTO
          2 000336  EFC7 0068                            STB,B6   FPT_WRSYSLOG+22,AUTO
          2 000338  BBC7 0068                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 00033A  DCC7 0004                            LDB,B5   @KZ@LINCTX,AUTO
          2 00033C  9CC5 006E                            LDB,B1   110,B5
          2 00033E  CBF0 0100                            LAB,B4   256,IMO
          2 000340  E381                                 LNJ,B6   ,B1
          2 000341       000C                            DC       s:9329,PREL

      495     9327    2                ALTRET(NO_INACT_OUTPUT_PENDING);
      496     9328    2              KZ@BSCFPT.FNC=%KZ#FNC_MOV;

   9328   2 000342  ECC7 0006                            LDB,B6   @KZ@BSCFPT,AUTO
          2 000344  6C03                                 LDV,R6   3
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:101  
          2 000345  EF46 0004                            STR,R6   4,B6

      497     9329    2              KZ@BSCFPT.EVT=%KZ#HIPEVT_SEND;

   9329   2 000347  5C0B                                 LDV,R5   11
          2 000348  DF46 0001                            STR,R5   1,B6

      498     9330    2              ALTRETURN;

   9330   2 00034A  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

   9329   2                              NO_INACT_OUTPUT*null
      499     9331    2   NO_INACT_OUTPUT_PENDING:;
      500     9332
      501     9333        /* POLL INTERVAL NOT UP YET, BUT NO OUTPUT PENDING. USE
      502     9334           THE IDLE TIME TO POLL NEXT   ACTIVE CONTROLLER */
      503     9335    2              KZ@LINCTX.TIMER.POL=TNOW;

   9335   2 00034D  8CC7 0029            NO_INACT_OUTPUT*LDI      TNOW,AUTO
          2 00034F  ECC7 0004                            LDB,B6   @KZ@LINCTX,AUTO
          2 000351  8D46 0028                            SDI      40,B6

   9335   2                              INACT_POLL_EXPI*null
      504     9336
      505     9337    2   INACT_POLL_EXPIRED:;
      506     9338
      507     9339    2              KZ$EVENT.EVENT=%KZ#LINFCN_INACT_CTR;

   9339   2 000353  6C0D                 INACT_POLL_EXPI*LDV,R6   13
          2 000354  EF47 0008                            STR,R6   KZ$EVENT,AUTO

      508     9340    2              CALL KZ@LINCTX.DEVMGR@(KZ$EVENT)

   9340   2 000356  EBC7 0008                            LAB,B6   KZ$EVENT,AUTO
          2 000358  EFC7 0068                            STB,B6   FPT_WRSYSLOG+22,AUTO
          2 00035A  BBC7 0068                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 00035C  DCC7 0004                            LDB,B5   @KZ@LINCTX,AUTO
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:102  
          2 00035E  9CC5 006E                            LDB,B1   110,B5
          2 000360  CBF0 0100                            LAB,B4   256,IMO
          2 000362  E381                                 LNJ,B6   ,B1
          2 000363       001F                            DC       s:9344,PREL

      509     9341    2                ALTRET(NO_INACTIVE_CONTROLLERS_EXIST);
      510     9342    2              KZ@LINCTX.OTPDATSIZ = 1;

   9342   2 000364  ECC7 0004                            LDB,B6   @KZ@LINCTX,AUTO
          2 000366  6C01                                 LDV,R6   1
          2 000367  EF46 005D                            STR,R6   93,B6

      511     9343    2              KZ@LINCTX.OTPBFR$ = ADDR(KZ@LINCTX.POLADR.CTR);

   9343   2 000369  DBC6 0064                            LAB,B5   100,B6
          2 00036B  DFC6 005A                            STB,B5   90,B6

      512     9344    2              KZ@LINCTX.TIMOUT.USESEC='0'B;/* SHORT TIMEOUT, ENUF FOR SCREEN */

   9344   2 00036D  8846 0088                            LBF,'8000'X       136,B6
   9344   2 00036F       8000

      513     9345    2              CALL KZT_ORDERS@(%KZ#SEND_GEPOLL,KZ@LINCTX);

   9345   2 000370  CBF0 000E                            LAB,B4   14,IMO
          2 000372  EFC7 006A                            STB,B6   FPT_WRSYSLOG+24,AUTO
          2 000374  CFC7 0068                            STB,B4   FPT_WRSYSLOG+22,AUTO
          2 000376  BBC7 0068                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 000378  9C80 0000 0000  xsym                 LDB,B1   KZT_ORDERS@
          2 00037B  CBF0 0200                            LAB,B4   512,IMO
          2 00037D  E381                                 LNJ,B6   ,B1
          2 00037E       0001                            DC       s:9346,PREL

      514     9346    2              RETURN;

   9346   2 00037F  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:103  
   9344   2                              NO_INACTIVE_CON*null
      515     9347    2   NO_INACTIVE_CONTROLLERS_EXIST:;
      516     9348        /* Now the POLL all has been completed, and there are
      517     9349           no inactive controllers to poll. Check once more
      518     9350           for output pending. If no output exists, then
      519     9351           suspend the line for the poll interval.
      520     9352        */
      521     9353    2              KZ$EVENT.EVENT=%KZ#LINFCN_GETOTP;

   9353   2 000382  6C01                 NO_INACTIVE_CON*LDV,R6   1
          2 000383  EF47 0008                            STR,R6   KZ$EVENT,AUTO

      522     9354    2              CALL KZ@LINCTX.DEVMGR@(KZ$EVENT)

   9354   2 000385  EBC7 0008                            LAB,B6   KZ$EVENT,AUTO
          2 000387  EFC7 0068                            STB,B6   FPT_WRSYSLOG+22,AUTO
          2 000389  BBC7 0068                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 00038B  DCC7 0004                            LDB,B5   @KZ@LINCTX,AUTO
          2 00038D  9CC5 006E                            LDB,B1   110,B5
          2 00038F  CBF0 0100                            LAB,B4   256,IMO
          2 000391  E381                                 LNJ,B6   ,B1
          2 000392       000C                            DC       s:9357,PREL

      523     9355    2                ALTRET(LINE_IS_TRULY_IDLE);
      524     9356    2              KZ@BSCFPT.FNC=%KZ#FNC_MOV;

   9356   2 000393  ECC7 0006                            LDB,B6   @KZ@BSCFPT,AUTO
          2 000395  6C03                                 LDV,R6   3
          2 000396  EF46 0004                            STR,R6   4,B6

      525     9357    2              KZ@BSCFPT.EVT=%KZ#HIPEVT_SEND;

   9357   2 000398  5C0B                                 LDV,R5   11
          2 000399  DF46 0001                            STR,R5   1,B6

      526     9358    2              ALTRETURN;

PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:104  
   9358   2 00039B  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

   9357   2                              LINE_IS_TRULY_I*null
      527     9359    2   LINE_IS_TRULY_IDLE:;
      528     9360    2              KH$CLK=KH_CLK_SET;

   9360   2 00039E  AB80 0000 0000  00   LINE_IS_TRULY_I*LAB,B2   KZ_EVENT
          2 0003A1  2C1C                                 LDV,R2   28
          2 0003A2  6C16                                 LDV,R6   22
          2 0003A3  BB87                                 LAB,B3   ,AUTO
          2 0003A4  3C2C                                 LDV,R3   44
          2 0003A5  0008                                 MMM

      529     9361    2              KH$CLK.PRD=KZ@LINCTX.PRO.INTERVAL/12 /* get to 1 second units */;

   9361   2 0003A6  ECC7 0004                            LDB,B6   @KZ@LINCTX,AUTO
          2 0003A8  F846 003F                            LDR,R7   63,B6
          2 0003AA  6C00                                 LDV,R6   0
          2 0003AB  F370 000C                            DIV,R7   12,IMO
          2 0003AD  E857                                 LDR,R6   R7
          2 0003AE  EF47 0020                            STR,R6   KH$CLK+10,AUTO

      530     9362    2              IF KH$CLK.PRD=0 THEN KH$CLK.PRD=1;

   9362   2 0003B0  6981 0006                            BNEZ,R6  s:9363,PREL

   9362   2 0003B2  6C01                                 LDV,R6   1
          2 0003B3  EF47 0020                            STR,R6   KH$CLK+10,AUTO
          2 0003B5  0F81 0007                            B        s:9364,PREL

      531     9363    2              ELSE IF KH$CLK.PRD>10 THEN KH$CLK.PRD=10;

   9363   2 0003B7  6D0A                                 CMV,R6   10
          2 0003B8  0381 0004                            BLE      s:9364,PREL

   9363   2 0003BA  6C0A                                 LDV,R6   10
          2 0003BB  EF47 0020                            STR,R6   KH$CLK+10,AUTO
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:105  

      532     9364    2              I=TNOW-KZ@LINCTX.TIMR.GENPOL;

   9364   2 0003BD  8CC7 0029                            LDI      TNOW,AUTO
          2 0003BF  84C6 0077                            SID      119,B6
          2 0003C1  E857                                 LDR,R6   R7
          2 0003C2  EF47 0028                            STR,R6   TEMP_BIT16,AUTO

      533     9365    2              I=I/120;

   9365   2 0003C4  F856                                 LDR,R7   R6
          2 0003C5  6C00                                 LDV,R6   0
          2 0003C6  F370 0078                            DIV,R7   120,IMO
          2 0003C8  E857                                 LDR,R6   R7
          2 0003C9  EF47 0028                            STR,R6   TEMP_BIT16,AUTO

      534     9366    2              IF KH$CLK.PRD<=I THEN

   9366   2 0003CB  E947 0020                            CMR,R6   KH$CLK+10,AUTO
          2 0003CD  0201 0006                            BL       s:9369,PREL

      535     9367    2                 KH$CLK.PRD=1;

   9367   2 0003CF  5C01                                 LDV,R5   1
          2 0003D0  DF47 0020                            STR,R5   KH$CLK+10,AUTO
          2 0003D2  0F81 0006                            B        s:9370,PREL

      536     9368    2              ELSE
      537     9369    2                 KH$CLK.PRD=KH$CLK.PRD-I;

   9369   2 0003D4  E247 0020                            SUB,R6   KH$CLK+10,AUTO
          2 0003D6  8256                                 NEG      R6
          2 0003D7  EF47 0020                            STR,R6   KH$CLK+10,AUTO

      538     9370    2              KH$CLK.PRDUNT=%KH#C_SEC;

   9370   2 0003D9  6C01                                 LDV,R6   1
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:106  
          2 0003DA  EAC7 001C                            SRM,R6,'00FF'X    KH$CLK+6,AUTO
          2 0003DC       00FF

      539     9371    2              KH$CLK.UID$=ADDR(KZ@LINCTX);

   9371   2 0003DD  EFC7 0018                            STB,B6   KH$CLK+2,AUTO

      540     9372    2              KH$CLK.SBR$=KZT_GO@;

   9372   2 0003DF  DC80 0000 0000  xsym                 LDB,B5   KZT_GO@
          2 0003E2  DFC7 001E                            STB,B5   KH$CLK+8,AUTO

      541     9373    2              CALL KHC$CLOCK(KH$CLK) ALTRET (OUCH);

   9373   2 0003E4  CBC7 0016                            LAB,B4   KH$CLK,AUTO
          2 0003E6  CFC7 0068                            STB,B4   FPT_WRSYSLOG+22,AUTO
          2 0003E8  BBC7 0068                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 0003EA  CBF0 0100                            LAB,B4   256,IMO
          2 0003EC  E380 0000 0000  xent                 LNJ,B6   KHC$CLOCK
          2 0003EF       000E                            DC       s:9377,PREL

      542     9374    2              KZ@LINCTX.CTB.PRM$=KH$CLK.CTBCTX$;

   9374   2 0003F0  ECC7 0016                            LDB,B6   KH$CLK,AUTO
          2 0003F2  DCC7 0004                            LDB,B5   @KZ@LINCTX,AUTO
          2 0003F4  EFC5 0031                            STB,B6   49,B5

      543     9375    2              KZ@LINCTX.PRMCTBTYP=%KZ#CTBTYP_DELAY;

   9375   2 0003F6  6C03                                 LDV,R6   3
          2 0003F7  EAC5 000C                            SRM,R6,'00FF'X    12,B5
          2 0003F9       00FF

      544     9376    2              RETURN;

   9376   2 0003FA  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:107  
      545     9377    2   OUCH:      CALL M$XXX;

   9377   2 0003FD  B870 0082            OUCH            LDR,R3   130,IMO
          2 0003FF  0001                                 MCL
          2 000400       0000                            DC       s:9377+3,PREL
          2 000401  0F81 00D0                            B        s:9504,PREL

      546     9378        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:108  
      547     9379        /*       %KZ#HIPACT_STOP
      548     9380                      The clock has just finished ticking. Set the address
      549     9381                      of the clock param in the line context to be NIL,
      550     9382                      then search for output
      551     9383
      552     9384                      I should have picked a better name for the action, but
      553     9385                      B03 has closed, and this is one of the few I didn't
      554     9386                      have use before this code was added.
      555     9387        */
      556     9388
      557     9389    2            CASE(%KZ#HIPACT_STOP);

      558     9390    2              KZ@LINCTX.CTB.PRM$=ADDR(NIL);

   9390   2 000403  CB80 0000 0000                       LAB,B4   0
          2 000406  CFC6 0031                            STB,B4   49,B6

      559     9391    2              KZ@LINCTX.PRMCTBTYP= 0 /* ANYTHING, JUST SO IT'S NOT MINE */;

   9391   2 000408  8846 000C                            LBF,'00FF'X       12,B6
   9391   2 00040A       00FF

      560     9392    2              KZ@BSCFPT.FNC=%KZ#FNC_MOV;

   9392   2 00040B  6C03                                 LDV,R6   3
          2 00040C  EF45 0004                            STR,R6   4,B5

      561     9393    2              KZ@BSCFPT.EVT=%KZ#HIPEVT_SEARCH;

   9393   2 00040E  5C09                                 LDV,R5   9
          2 00040F  DF45 0001                            STR,R5   1,B5

      562     9394    2              ALTRETURN;

   9394   2 000411  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      563     9395        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:109  
      564     9396        /*       %KZ#HIPACT_POLLTO
      565     9397                      The guy just polled on the general polled list
      566     9398                      did not answer. Give him a another chance to answer
      567     9399                      a poll (on the next polling cycle), then assume
      568     9400                      the terminal has been turned off. */
      569     9401    2            CASE(%KZ#HIPACT_POLLTO);

      570     9402
      571     9403    2              CALL ISOLATE_GPOLL_STOPPER ALTRET(DISCONNECT_NOW);

   9403   2 000414  E3C0 04B5                            LNJ,B6   s:0,PREL
          2 000416       00BF                            DC       s:9489,PREL

      572     9404
      573     9405        /*    Report to device manager that controller did not answer
      574     9406        */
      575     9407    2              IF KZ@LINCTX.CURCTR$->KZ$HIPCTR.TIMED_OUT_ONCE THEN

   9407   2 000417  ECC7 0004                            LDB,B6   @KZ@LINCTX,AUTO
          2 000419  DCC6 004E                            LDB,B5   78,B6
          2 00041B  82C5 000A                            LB,'0080'X        10,B5
          2 00041D       0080
          2 00041E  0581 0012                            BBF      s:9414,PREL

      576     9408    3              DO;

      577     9409    3                 KZ$EVENT.EVENT=%KZ#LINFCN_POLTIMOUT;

   9409   2 000420  6C05                                 LDV,R6   5
          2 000421  EF47 0008                            STR,R6   KZ$EVENT,AUTO

      578     9410    3                 CALL KZ@LINCTX.DEVMGR@(KZ$EVENT)

   9410   2 000423  CBC7 0008                            LAB,B4   KZ$EVENT,AUTO
          2 000425  CFC7 0068                            STB,B4   FPT_WRSYSLOG+22,AUTO
          2 000427  BBC7 0068                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 000429  9CC6 006E                            LDB,B1   110,B6
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:110  
          2 00042B  CBF0 0100                            LAB,B4   256,IMO
          2 00042D  E381                                 LNJ,B6   ,B1
          2 00042E       000C                            DC       s:9421,PREL

      579     9411    3                   ALTRET(TIMED_OUT_GUY_IS_LAST);
      580     9412    3                 END;

   9412   2 00042F  0F81 0004                            B        s:9418,PREL

      581     9413    2              ELSE
      582     9414    2                 KZ@LINCTX.CURCTR$->KZ$HIPCTR.TIMED_OUT_ONCE='1'B;

   9414   2 000431  8945 000A                            LBT,'0080'X       10,B5
   9414   2 000433       0080

      583     9415
      584     9416        /*    Continue the poll of all controllers
      585     9417        */
      586     9418    2              CALL CONTINUE_POLLING

   9418   2 000434  E3C0 0550                            LNJ,B6   s:0,PREL
          2 000436       0004                            DC       s:9421,PREL

      587     9419    2                ALTRET(TIMED_OUT_GUY_IS_LAST);
      588     9420    2              RETURN;

   9420   2 000437  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      589     9421    2   TIMED_OUT_GUY_IS_LAST:;

   9421   2                              TIMED_OUT_GUY_I*null
      590     9422    2              KZ@BSCFPT.EVT= %KZ#HIPEVT_POLDUN;

   9422   2 00043A  ECC7 0006            TIMED_OUT_GUY_I*LDB,B6   @KZ@BSCFPT,AUTO
          2 00043C  6C07                                 LDV,R6   7
          2 00043D  EF46 0001                            STR,R6   1,B6

PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:111  
      591     9423    2              KZ@BSCFPT.FNC= %KZ#FNC_MOV;

   9423   2 00043F  5C03                                 LDV,R5   3
          2 000440  DF46 0004                            STR,R5   4,B6

      592     9424    2              ALTRETURN;

   9424   2 000442  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      593     9425        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:112  
      594     9426        /*       %KZ#HIPACT_POLANS
      595     9427                      One particular device answered with a non-null
      596     9428                      message on a general poll.
      597     9429        */
      598     9430    2            CASE(%KZ#HIPACT_POLANS);

      599     9431    2              CALL ISOLATE_GPOLL_STOPPER ALTRET(DISCONNECT_NOW);

   9431   2 000445  E3C0 0484                            LNJ,B6   s:0,PREL
          2 000447       008E                            DC       s:9489,PREL

      600     9432
      601     9433
      602     9434        /* THE CURRENT CONTROLLER DID *NOT* TIME OUT, RESET 'TIMED_OUT_ONCE' BIT */
      603     9435
      604     9436    2              KZ@LINCTX.CURCTR$->KZ$HIPCTR.TIMED_OUT_ONCE='0'B;

   9436   2 000448  ECC7 0004                            LDB,B6   @KZ@LINCTX,AUTO
          2 00044A  DCC6 004E                            LDB,B5   78,B6
          2 00044C  8845 000A                            LBF,'0080'X       10,B5
          2 00044E       0080

      605     9437        /*       It may be that only an 'EOT' was received as a reply.
      606     9438                 This signifies that the polling list was exhausted. */
      607     9439
      608     9440    3              IF KZ@BSCFPT.SIZ<=1 THEN DO;

   9440   2 00044F  DCC7 0006                            LDB,B5   @KZ@BSCFPT,AUTO
          2 000451  E845 0003                            LDR,R6   3,B5
          2 000453  6D01                                 CMV,R6   1
          2 000454  0301 0007                            BG       s:9444,PREL

      609     9441    3                 CALL CONTINUE_POLLING ALTRET (LAST_CONTROLLER_HAD_DATA);

   9441   2 000456  E3C0 052E                            LNJ,B6   s:0,PREL
          2 000458       0027                            DC       s:9446,PREL

PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:113  
      610     9442    3                 RETURN;

   9442   2 000459  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      611     9443    3                 END;
      612     9444    2              IF KZ@LINCTX.RTRCNT~=0 THEN

   9444   2 00045C  D846 0039                            LDR,R5   57,B6
          2 00045E  5901 000D                            BEZ,R5   s:9446,PREL

      613     9445    2                 CALL ERRLOG(%E$HIPIO_OK);

   9445   2 000460  CBF0 00D5                            LAB,B4   213,IMO
          2 000462  BB80 0000 0000                       LAB,B3   0
          2 000465  BFC7 0050                            STB,B3   @ERROR+2,AUTO
          2 000467  CFC7 004E                            STB,B4   P7814+9,AUTO
          2 000469  E3C0 03D8                            LNJ,B6   s:0,PREL
          2 00046B       0001                            DC       s:9446,PREL

      614     9446    2              KZ@LINCTX.RTRCNT=0;

   9446   2 00046C  ECC7 0004                            LDB,B6   @KZ@LINCTX,AUTO
          2 00046E  8746 0039                            CL       57,B6

      615     9447    2              CALL PARSE_INPUT;

   9447   2 000470  E3C0 006C                            LNJ,B6   s:0,PREL
          2 000472       0001                            DC       s:9448,PREL

      616     9448    2              CALL PROCESS_DELAYED_STATUS;

   9448   2 000473  E3C0 036E                            LNJ,B6   s:0,PREL
          2 000475       0001                            DC       s:9449,PREL

      617     9449    2              CALL SHIP_POSSIBLE_INPUT;

   9449   2 000476  E3C0 0617                            LNJ,B6   s:0,PREL
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:114  
          2 000478       0001                            DC       s:9450,PREL

      618     9450    2              CALL CONTINUE_POLLING

   9450   2 000479  E3C0 050B                            LNJ,B6   s:0,PREL
          2 00047B       0004                            DC       s:9446,PREL

      619     9451    2                ALTRET(LAST_CONTROLLER_HAD_DATA);
      620     9452    2              RETURN;

   9452   2 00047C  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

   9446   2                              LAST_CONTROLLER*null
      621     9453    2   LAST_CONTROLLER_HAD_DATA:;
      622     9454    2              KZ@BSCFPT.EVT= %KZ#HIPEVT_POLDUN;

   9454   2 00047F  ECC7 0006            LAST_CONTROLLER*LDB,B6   @KZ@BSCFPT,AUTO
          2 000481  6C07                                 LDV,R6   7
          2 000482  EF46 0001                            STR,R6   1,B6

      623     9455    2              KZ@BSCFPT.FNC= %KZ#FNC_MOV;

   9455   2 000484  5C03                                 LDV,R5   3
          2 000485  DF46 0004                            STR,R5   4,B6

      624     9456    2              ALTRETURN;

   9456   2 000487  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      625     9457        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:115  
      626     9458        /*       %KZ#HIPACT_GPRCV
      627     9459                      Recoverable error on a device while
      628     9460                      doing a general poll.
      629     9461                      Tere are only two kinds of messages that may be garbled:
      630     9462                      printer ACK and keyboard input.
      631     9463
      632     9464                      Examine block for possiblities of either message, and
      633     9465                      if keyboard input looks like it might be there, send
      634     9466                      a NAK to get the keyboard input back in a later block.
      635     9467        */
      636     9468    2            CASE(%KZ#HIPACT_GPRCV);

      637     9469    2              CALL ISOLATE_GPOLL_STOPPER ALTRET(DISCONNECT_NOW);

   9469   2 00048A  E3C0 043F                            LNJ,B6   s:0,PREL
          2 00048C       0049                            DC       s:9489,PREL

      638     9470    2              KZ@LINCTX.CURCTR$->KZ$HIPCTR.TIMED_OUT_ONCE='0'B;

   9470   2 00048D  ECC7 0004                            LDB,B6   @KZ@LINCTX,AUTO
          2 00048F  DCC6 004E                            LDB,B5   78,B6
          2 000491  8845 000A                            LBF,'0080'X       10,B5
          2 000493       0080

      639     9471    2              CALL PARSE_INPUT;

   9471   2 000494  E3C0 0048                            LNJ,B6   s:0,PREL
          2 000496       0001                            DC       s:9472,PREL

      640     9472    2              CALL PROCESS_DELAYED_STATUS;

   9472   2 000497  E3C0 034A                            LNJ,B6   s:0,PREL
          2 000499       0001                            DC       s:9473,PREL

      641     9473    2              IF INPUT.PRESENT THEN

   9473   2 00049A  89C7 0036                            CMZ      INPUT+2,AUTO
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:116  
          2 00049C  0881 0006                            BAGE     s:9476,PREL

      642     9474    2                 CALL SEND_NAK ALTRET(POLL_NAK_COUNT_EXCEEDED);

   9474   2 00049E  E3C0 0518                            LNJ,B6   s:0,PREL
          2 0004A0       0009                            DC       s:9473,PREL
          2 0004A1  0F81 0004                            B        s:9477,PREL

      643     9475    2              ELSE
      644     9476    2                 CALL CONTINUE_POLLING ALTRET(LAST_CONTROLLER_HAD_DATA);

   9476   2 0004A3  E3C0 04E1                            LNJ,B6   s:0,PREL
          2 0004A5       FFDA                            DC       s:9446,PREL

      645     9477    2              RETURN;

   9477   2 0004A6  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

   9473   2                              POLL_NAK_COUNT_*null
      646     9478    2   POLL_NAK_COUNT_EXCEEDED:;
      647     9479    2              CALL CONTINUE_POLLING ALTRET(LAST_CONTROLLER_HAD_DATA);

   9479   2 0004A9  E3C0 04DB            POLL_NAK_COUNT_*LNJ,B6   s:0,PREL
          2 0004AB       FFD4                            DC       s:9446,PREL

      648     9480    2              RETURN;

   9480   2 0004AC  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      649     9481        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:117  
      650     9482        /*       %KZ#HIPACT_NUTERM
      651     9483                      A controller just answered a poll while
      652     9484                      he was on the inactive list.
      653     9485        */
      654     9486    2            CASE(%KZ#HIPACT_NUTERM);

      655     9487    2              KZ$EVENT.EVENT=%KZ#LINFCN_NEWCTR;

   9487   2 0004AF  6C07                                 LDV,R6   7
          2 0004B0  EF47 0008                            STR,R6   KZ$EVENT,AUTO

      656     9488    2              CALL KZ@LINCTX.DEVMGR@(KZ$EVENT);

   9488   2 0004B2  CBC7 0008                            LAB,B4   KZ$EVENT,AUTO
          2 0004B4  CFC7 0068                            STB,B4   FPT_WRSYSLOG+22,AUTO
          2 0004B6  BBC7 0068                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 0004B8  9CC6 006E                            LDB,B1   110,B6
          2 0004BA  CBF0 0100                            LAB,B4   256,IMO
          2 0004BC  E381                                 LNJ,B6   ,B1
          2 0004BD       0001                            DC       s:9489,PREL

      657     9489    2              KZ@BSCFPT.FNC=%KZ#FNC_MOV;

   9489   2 0004BE  ECC7 0006                            LDB,B6   @KZ@BSCFPT,AUTO
          2 0004C0  6C03                                 LDV,R6   3
          2 0004C1  EF46 0004                            STR,R6   4,B6

      658     9490    2              KZ@BSCFPT.EVT=%KZ#HIPEVT_SEARCH;

   9490   2 0004C3  5C09                                 LDV,R5   9
          2 0004C4  DF46 0001                            STR,R5   1,B6

      659     9491    2              ALTRETURN;

   9491   2 0004C6  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      660     9492        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:118  
      661     9493        /*       %KZ#HIPACT_IPRCV
      662     9494                      Recoverable error while doing an inactive
      663     9495                      poll. Just forget that any response has been heard.
      664     9496                      Eventually I will get around to trying this guy again,
      665     9497                      and he will finally get logged on.
      666     9498        */
      667     9499    2            CASE(%KZ#HIPACT_IPRCV);

      668     9500    2              KZ@BSCFPT.FNC=%KZ#FNC_MOV;

   9500   2 0004C9  6C03                                 LDV,R6   3
          2 0004CA  EF45 0004                            STR,R6   4,B5

      669     9501    2              KZ@BSCFPT.EVT=%KZ#HIPEVT_SEARCH;

   9501   2 0004CC  5C09                                 LDV,R5   9
          2 0004CD  DF45 0001                            STR,R5   1,B5

      670     9502    2              ALTRETURN;

   9502   2 0004CF  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      671     9503    2            END /* GIANT DO CASE */;

      672     9504    1           RETURN;

   9504   2 0004D2  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

   9489   2                              DISCONNECT_NOW  null
      673     9505
      674     9506    1   DISCONNECT_NOW:;
      675     9507    1           KZ@BSCFPT.FNC=%KZ#FNC_DSC;

   9507   2 0004D5  ECC7 0006            DISCONNECT_NOW  LDB,B6   @KZ@BSCFPT,AUTO
          2 0004D7  6C02                                 LDV,R6   2
          2 0004D8  EF46 0004                            STR,R6   4,B6

PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:119  
      676     9508    1           ALTRETURN;

   9508   2 0004DA  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      677     9509        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:120  
      678     9510    1   PARSE_INPUT:PROC ALTRET;

   9510   2 0004DD  EFC7 0038            PARSE_INPUT     STB,B6   INPUT+4,AUTO

      679     9511
      680     9512        /* I expect at most 3 records per HIP block:
      681     9513        1) terminal ACK (it heard my screenfull ok)
      682     9514           terminal NAK (it did not like what I sent)
      683     9515        2) printer  ACK (printer wants to be fed more data)
      684     9516             or
      685     9517           printer  BSY  (retransmission of data on printer timeout ONLY,
      686     9518                          signifies the printer is still manual.)
      687     9519             or
      688     9520           printer NAK (it did not like the checksum)
      689     9521        3) terminal NUL (keyboard input transmission)
      690     9522
      691     9523           The only real work this routine does is to parse the input,
      692     9524           setting flags which reflect the input message.
      693     9525
      694     9526         *FLASH*      this routine has been expanded to try and parse
      695     9527                      blocks with known errors. The MLCP will filter
      696     9528                      out the gross malformations of structure, but
      697     9529                      incompatable/erroneous/contradictory information
      698     9530                      will remain.
      699     9531
      700     9532                 This routine will do the best it can.
      701     9533        */
      702     9534
      703     9535    2   DCL INDX SBIN /* INDEX INTO BUFFER */;
      704     9536    2   DCL LENX SBIN /* SIZE OF BUFFER */;
      705     9537
      706     9538    2   DCL IBFR$ PTR;
      707     9539
      708     9540    2   DCL IBFR CHAR(LENX) BASED(IBFR$);
      709     9541
      710     9542    2   DCL I SBIN;
      711     9543    2   DCL ADR CHAR(1);
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:121  
      712     9544    2   DCL ADR_INDX SBIN;
      713     9545    2   DCL STA CHAR(1);
      714     9546    2   DCL STA_INDX SBIN;
      715     9547
      716     9548    2   DCL STABYTES_C CHAR(6) CONSTANT INIT(
      717     9549    2       %CONCAT(%BITASC('86'X),%BITASC('15'X),%BITASC('80'X),%BITASC('EF'X),%BITASC(
              9549                '6E'X),%BITASC('6D'X)));
      718     9550
      719     9551    2   DCL PDENQ CHAR(4) CONSTANT INIT(%CONCAT(BITASC('9B'X),BITASC('5B'X),BITASC('B9'X),
              9551            BITASC('70'X)));
      720     9552
      721     9553    2   DCL PENQ CHAR(4) CONSTANT INIT(%CONCAT(BITASC('9B'X),BITASC('5B'X),BITASC('38'X),
              9553            BITASC('70'X)));
      722     9554
      723     9555    2   DCL T$ PTR;
      724     9556
      725     9557    2   DCL 1 P7814,
      726     9558    2         2 PDENQ BIT(1),
      727     9559    2         2 INDX SBIN,
      728     9560    2         2 STATUS CHAR(8),
      729     9561    2         2 S(0:7) REDEF STATUS BIT(8);
      730     9562
      731     9563    2           LENX=KZ@BSCFPT.SIZ;

   9563   2 0004DF  DCC7 0006                            LDB,B5   @KZ@BSCFPT,AUTO
          2 0004E1  E845 0003                            LDR,R6   3,B5
          2 0004E3  EF47 003B                            STR,R6   LENX,AUTO

      732     9564
      733     9565    2           IBFR$=KZ@LINCTX.INPBFR$;

   9565   2 0004E5  CCC7 0004                            LDB,B4   @KZ@LINCTX,AUTO
          2 0004E7  BCC4 0056                            LDB,B3   86,B4
          2 0004E9  BFC7 003C                            STB,B3   IBFR$,AUTO

      734     9566    2           INDX=0;

PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:122  
   9566   2 0004EB  8747 003A                            CL       INDX,AUTO

      735     9567    2           ACKS='0'B;

   9567   2 0004ED  8747 002D                            CL       ACKS,AUTO

      736     9568    2           NAKS='0'B;

   9568   2 0004EF  8747 002E                            CL       NAKS,AUTO

      737     9569    2           BUSY='0'B;

   9569   2 0004F1  8747 002F                            CL       BUSY,AUTO

      738     9570    2           PGOV='0'B;

   9570   2 0004F3  8747 0030                            CL       PGOV,AUTO

      739     9571    2           NAV='0'B;

   9571   2 0004F5  8747 0031                            CL       NAV,AUTO

      740     9572    2           INPUT.PRESENT='0'B;

   9572   2 0004F7  8747 0036                            CL       INPUT+2,AUTO

      741     9573
      742     9574    3   PARSING_INPUT: DO WHILE ((LENX-INDX)>=6);

   9574   2 0004F9  0F81 01C9            PARSING_INPUT   B        s:9702,PREL

      743     9575
      744     9576    3              ADR=SUBSTR(IBFR,INDX,1);

   9576   2 0004FB  ECC7 003C                            LDB,B6   IBFR$,AUTO
          2 0004FD  B847 003A                            LDR,R3   INDX,AUTO
          2 0004FF  E0B6                                 LDH,R6   ,B6,R3
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:123  
          2 000500  E7C7 003F                            STH,R6   ADR,AUTO

      745     9577    3              STA=SUBSTR(IBFR,INDX+1,1);

   9577   2 000502  3E01                                 ADV,R3   1
          2 000503  D0B6                                 LDH,R5   ,B6,R3
          2 000504  D7C7 0041                            STH,R5   STA,AUTO

      746     9578
      747     9579    3              CALL INDEX(ADR_INDX,ADR,DEVBYTES_C) ALTRET(UNKNOWN_DEVICE);

   9579   2 000506  DB80 0000 0000  00                   LAB,B5   KZ_EVENT
          2 000509  0028                                 SRH      ;
          2 00050A       4107 003F                                ALPHANUM(ADR,AUTO,,1),;
          2 00050C       4407 0068                                BINARY(FPT_WRSYSLOG+22,AUTO,,4),;
          2 00050E       4805 001D                                ALPHANUM(29,B5,,8)
          2 000510  5381 0006                            CBE      s:9579+17,PREL
          2 000512  4C08                                 LDV,R4   8
          2 000513  CF47 0040                            STR,R4   ADR_INDX,AUTO
          2 000515  0F81 0007                            B        s:9582,PREL
          2 000517  C847 0069                            LDR,R4   FPT_WRSYSLOG+23,AUTO
          2 000519  CF47 0040                            STR,R4   ADR_INDX,AUTO

      748     9580
      749     9581    4              DO WHILE('0'B);

   9581   2 00051B  0F81 000F                            B        s:9594,PREL

      750     9582    4   UNKNOWN_DEVICE: ADR_INDX=15;

   9582   2 00051D  6C0F                 UNKNOWN_DEVICE  LDV,R6   15
          2 00051E  EF47 0040                            STR,R6   ADR_INDX,AUTO

      751     9583    4                 CALL ERRLOG(%E$UNKNADR,INDX);

   9583   2 000520  EBF0 00D2                            LAB,B6   210,IMO
          2 000522  DBC7 003A                            LAB,B5   INDX,AUTO
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:124  
          2 000524  DFC7 0050                            STB,B5   @ERROR+2,AUTO
          2 000526  EFC7 004E                            STB,B6   P7814+9,AUTO
          2 000528  E3C0 0319                            LNJ,B6   s:0,PREL
          2 00052A       0001                            DC       s:9594,PREL

      752     9584        /*E*          ERROR: KZH-E$UNKNADR
      753     9585                    MESSAGE: Unrecognized ADR byte in message fragment
      754     9586                DESCRIPTION: Unknown ADR byte in HIP fragment.
      755     9587                              V0 = CHANNEL NUMBER
      756     9588                              V1 = NUMBER OF RETRIES BEFORE GOOD COMPLETION
      757     9589                              V2 = INDEX INTO BUFFER
      758     9590                              DATA = INPUT BUFFER
      759     9591        */
      760     9592    4                 END;

      761     9593
      762     9594    3              CALL INDEX(STA_INDX,STA,STABYTES_C) ALTRET(UNKNOWN_STATUS);

   9594   2 00052B  EB80 0000 0000  00                   LAB,B6   KZ_EVENT
          2 00052E  0028                                 SRH      ;
          2 00052F       4107 0041                                ALPHANUM(STA,AUTO,,1),;
          2 000531       4407 0068                                BINARY(FPT_WRSYSLOG+22,AUTO,,4),;
          2 000533       4606 003D                                ALPHANUM(61,B6,,6)
          2 000535  5381 0006                            CBE      s:9594+17,PREL
          2 000537  6C06                                 LDV,R6   6
          2 000538  EF47 0042                            STR,R6   STA_INDX,AUTO
          2 00053A  0F81 0007                            B        s:9597,PREL
          2 00053C  E847 0069                            LDR,R6   FPT_WRSYSLOG+23,AUTO
          2 00053E  EF47 0042                            STR,R6   STA_INDX,AUTO

      763     9595
      764     9596    4              DO WHILE ('0'B);

   9596   2 000540  0F81 000F                            B        s:9609,PREL

      765     9597    4   UNKNOWN_STATUS: STA_INDX=15;

PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:125  
   9597   2 000542  6C0F                 UNKNOWN_STATUS  LDV,R6   15
          2 000543  EF47 0042                            STR,R6   STA_INDX,AUTO

      766     9598    4                 CALL ERRLOG(%E$UNKNSTA,INDX);

   9598   2 000545  EBF0 00D3                            LAB,B6   211,IMO
          2 000547  DBC7 003A                            LAB,B5   INDX,AUTO
          2 000549  DFC7 0050                            STB,B5   @ERROR+2,AUTO
          2 00054B  EFC7 004E                            STB,B6   P7814+9,AUTO
          2 00054D  E3C0 02F4                            LNJ,B6   s:0,PREL
          2 00054F       0001                            DC       s:9609,PREL

      767     9599        /*E*          ERROR: KZH-E$UNKNSTA
      768     9600                    MESSAGE: Unrecognized STA byte in message fragment
      769     9601                DESCRIPTION: Unknown STA byte in HIP fragment.
      770     9602                              V0 = CHANNEL NUMBER
      771     9603                              V1 = NUMBER OF RETRIES BEFORE GOOD COMPLETION
      772     9604                              V2 = INDEX INTO BUFFER
      773     9605                              DATA = INPUT BUFFER
      774     9606        */
      775     9607    4                 END;

      776     9608
      777     9609    4              DO CASE(STA_INDX);

   9609   2 000550  B847 0042                            LDR,R3   STA_INDX,AUTO
          2 000552  3D10                                 CMV,R3   16
          2 000553  0281 0166                            BGE      s:9699,PREL
          2 000555  A830 0000 055B  02                   LDR,R2   s:9609+11,R3
          2 000558  83A0 0000 056B  02                   JMP      s:9612,R2
          2 00055B       0000                            DC       s:9612,PREL
          2 00055C       000C                            DC       s:9616,PREL
          2 00055D       0018                            DC       s:9620,PREL
          2 00055E       0110                            DC       s:9674,PREL
          2 00055F       011C                            DC       s:9678,PREL
          2 000560       0128                            DC       s:9682,PREL
          2 000561       014F                            DC       s:9699,PREL
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:126  
          2 000562       014F                            DC       s:9699,PREL
          2 000563       014F                            DC       s:9699,PREL
          2 000564       014F                            DC       s:9699,PREL
          2 000565       014F                            DC       s:9699,PREL
          2 000566       014F                            DC       s:9699,PREL
          2 000567       014F                            DC       s:9699,PREL
          2 000568       014F                            DC       s:9699,PREL
          2 000569       014F                            DC       s:9699,PREL
          2 00056A       0134                            DC       s:9688,PREL

      778     9610
      779     9611    4               CASE(0 /* ACK */);

      780     9612    4                 ACKS(ADR_INDX)='1'B;

   9612   2 00056B  EBC7 002D                            LAB,B6   ACKS,AUTO
          2 00056D  9847 0040                            LDR,R1   ADR_INDX,AUTO
          2 00056F  8916                                 LBT      ,B6,R1

      781     9613    4                 INDX=INDX+7;

   9613   2 000570  E847 003A                            LDR,R6   INDX,AUTO
          2 000572  6E07                                 ADV,R6   7
          2 000573  EF47 003A                            STR,R6   INDX,AUTO
          2 000575  0F81 0144                            B        s:9699,PREL

      782     9614
      783     9615    4               CASE(1 /* NAK */);

      784     9616    4                 NAKS(ADR_INDX)='1'B;

   9616   2 000577  EBC7 002E                            LAB,B6   NAKS,AUTO
          2 000579  9847 0040                            LDR,R1   ADR_INDX,AUTO
          2 00057B  8916                                 LBT      ,B6,R1

      785     9617    4                 INDX=INDX+7;

PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:127  
   9617   2 00057C  E847 003A                            LDR,R6   INDX,AUTO
          2 00057E  6E07                                 ADV,R6   7
          2 00057F  EF47 003A                            STR,R6   INDX,AUTO
          2 000581  0F81 0138                            B        s:9699,PREL

      786     9618
      787     9619    4               CASE(2 /* NUL */);

      788     9620    4                 INPUT.FIRST=INDX+5;

   9620   2 000583  E847 003A                            LDR,R6   INDX,AUTO
          2 000585  6E05                                 ADV,R6   5
          2 000586  EF47 0034                            STR,R6   INPUT,AUTO

      789     9621
      790     9622    4                 CALL INDEX(INPUT.ENDING_ETX,%BITASC('83'X),IBFR,INPUT.FIRST)

   9622   2 000588  D847 003B                            LDR,R5   LENX,AUTO
          2 00058A  E255                                 SUB,R6   R5
          2 00058B  DF47 0035                            STR,R5   INPUT+1,AUTO
          2 00058D  9800 0000 0000  03                   LDR,R1   0
          2 000590  EB90 0000 0000  02                   LAB,B6   s:44,R1
          2 000593  EF47 0068                            STR,R6   FPT_WRSYSLOG+22,AUTO
          2 000595  AB80 0000 0000  03                   LAB,B2   0
          2 000598  2C02                                 LDV,R2   2
          2 000599  6C01                                 LDV,R6   1
          2 00059A  BCC7 003C                            LDB,B3   IBFR$,AUTO
          2 00059C  B847 0034                            LDR,R3   INPUT,AUTO
          2 00059E  F847 0068                            LDR,R7   FPT_WRSYSLOG+22,AUTO
          2 0005A0  8257                                 NEG      R7
          2 0005A1  9BC7 0068                            LAB,B1   FPT_WRSYSLOG+22,AUTO
          2 0005A3  1C02                                 LDV,R1   2
          2 0005A4  5C0C                                 LDV,R5   12
          2 0005A5  D380 0000 0000  xent                 LNJ,B5   X6C_SRCH
          2 0005A8  EA47 0034                            ADD,R6   INPUT,AUTO
          2 0005AA  EF47 0035                            STR,R6   INPUT+1,AUTO

PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:128  
      791     9623    4                   ALTRET(CANT_FIND_ENDING_ETX);
      792     9624
      793     9625
      794     9626    4                 INDX=INPUT.ENDING_ETX+2;

   9626   2 0005AC  6E02                                 ADV,R6   2
          2 0005AD  EF47 003A                            STR,R6   INDX,AUTO

      795     9627    4                 INPUT.PRESENT=( ADR_INDX=0 );

   9627   2 0005AF  D870 8000                            LDR,R5   -32768,IMO
          2 0005B1  C847 0040                            LDR,R4   ADR_INDX,AUTO
          2 0005B3  4901 0002                            BEZ,R4   s:9627+7,PREL
          2 0005B5  5C00                                 LDV,R5   0
          2 0005B6  DF47 0036                            STR,R5   INPUT+2,AUTO

      796     9628
      797     9629        /* Scan the input stream for printer status from DENQ,
      798     9630           but only if this is a 7804/7814 device and only if
      799     9631           a printer in configed and output is active to the printer.
      800     9632        */
      801     9633    4                 IF (INPUT.ENDING_ETX-INPUT.FIRST)>=8 THEN

   9633   2 0005B8  D847 0035                            LDR,R5   INPUT+1,AUTO
          2 0005BA  D247 0034                            SUB,R5   INPUT,AUTO
          2 0005BC  5D08                                 CMV,R5   8
          2 0005BD  0801 00FC                            BAL      s:9699,PREL

      802     9634    5   PRINTER_LOOK: DO SELECT(KZ@LINCTX.CURCTR$->KZ$HIPCTR.TYP);

   9634   2 0005BF  ECC7 0004            PRINTER_LOOK    LDB,B6   @KZ@LINCTX,AUTO
          2 0005C1  DCC6 004E                            LDB,B5   78,B6
          2 0005C3  D845 0008                            LDR,R5   8,B5
          2 0005C5  D970 1E7C                            CMR,R5   7804,IMO
          2 0005C7  0201 00F2                            BL       s:9699,PREL
          2 0005C9  0901 0007                            BE       s:9636,PREL
          2 0005CB  D970 1E86                            CMR,R5   7814,IMO
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:129  
          2 0005CD  0981 00EC                            BNE      s:9699,PREL
          2 0005CF  0F81 0001                            B        s:9636,PREL

      803     9635    5                    SELECT(7804,7814);

      804     9636    5                    T$=KZ@LINCTX.CURCTR$->KZ$HIPCTR.DEVHD$;

   9636   2 0005D1  CCC5 0002                            LDB,B4   2,B5
          2 0005D3  CFC7 0043                            STB,B4   T$,AUTO

      805     9637    6                    DO WHILE(T$~=ADDR(NIL));

   9637   2 0005D5  0F81 009F                            B        s:9670,PREL

      806     9638    6                       IF T$->KZ@HIPDEV.PRINTER THEN

   9638   2 0005D7  ECC7 0043                            LDB,B6   T$,AUTO
          2 0005D9  82C6 0012                            LB,'0800'X        18,B6
          2 0005DB       0800
          2 0005DC  0581 0095                            BBF      s:9669,PREL

      807     9639    7                       DO; /* FOUND PRINTER */;

      808     9640    7                          CALL  INDEX(P7814.INDX,PDENQ,IBFR,INPUT.FIRST)

   9640   2 0005DE  E847 003B                            LDR,R6   LENX,AUTO
          2 0005E0  E247 0034                            SUB,R6   INPUT,AUTO
          2 0005E2  D847 003B                            LDR,R5   LENX,AUTO
          2 0005E4  DF47 0046                            STR,R5   P7814+1,AUTO
          2 0005E6  B800 0000 0002  03                   LDR,R3   +2
          2 0005E9  EBB0 0000 0000  02                   LAB,B6   s:44,R3
          2 0005EC  EF47 0068                            STR,R6   FPT_WRSYSLOG+22,AUTO
          2 0005EE  AB80 0000 0040  00                   LAB,B2   PDENQ
          2 0005F1  2C00                                 LDV,R2   0
          2 0005F2  6C04                                 LDV,R6   4
          2 0005F3  BCC7 003C                            LDB,B3   IBFR$,AUTO
          2 0005F5  B847 0034                            LDR,R3   INPUT,AUTO
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:130  
          2 0005F7  F847 0068                            LDR,R7   FPT_WRSYSLOG+22,AUTO
          2 0005F9  9BC7 0068                            LAB,B1   FPT_WRSYSLOG+22,AUTO
          2 0005FB  1C02                                 LDV,R1   2
          2 0005FC  5C0C                                 LDV,R5   12
          2 0005FD  D380 0000 0000  xent                 LNJ,B5   X6C_SRCH
          2 000600  EA47 0034                            ADD,R6   INPUT,AUTO
          2 000602  EF47 0046                            STR,R6   P7814+1,AUTO

      809     9641    8                          WHENRETURN DO;

      810     9642    8                             P7814.PDENQ='1'B;

   9642   2 000604  8947 0045                            LBT,'8000'X       P7814,AUTO
   9642   2 000606       8000

      811     9643    8                             GOTO DO_PENQ;

   9643   2 000607  0F81 0029                            B        s:9648,PREL

      812     9644    8                             END;
      813     9645    7                          CALL  INDEX(P7814.INDX, PENQ,IBFR,INPUT.FIRST)

   9645   2 000609  E847 003B                            LDR,R6   LENX,AUTO
          2 00060B  E247 0034                            SUB,R6   INPUT,AUTO
          2 00060D  D847 003B                            LDR,R5   LENX,AUTO
          2 00060F  DF47 0046                            STR,R5   P7814+1,AUTO
          2 000611  B800 0000 0003  03                   LDR,R3   +3
          2 000614  EBB0 0000 0000  02                   LAB,B6   s:44,R3
          2 000617  EF47 0068                            STR,R6   FPT_WRSYSLOG+22,AUTO
          2 000619  AB80 0000 0042  00                   LAB,B2   PENQ
          2 00061C  2C00                                 LDV,R2   0
          2 00061D  6C04                                 LDV,R6   4
          2 00061E  BCC7 003C                            LDB,B3   IBFR$,AUTO
          2 000620  B847 0034                            LDR,R3   INPUT,AUTO
          2 000622  F847 0068                            LDR,R7   FPT_WRSYSLOG+22,AUTO
          2 000624  9BC7 0068                            LAB,B1   FPT_WRSYSLOG+22,AUTO
          2 000626  1C02                                 LDV,R1   2
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:131  
          2 000627  5C0C                                 LDV,R5   12
          2 000628  D380 0000 0000  xent                 LNJ,B5   X6C_SRCH
          2 00062B  EA47 0034                            ADD,R6   INPUT,AUTO
          2 00062D  EF47 0046                            STR,R6   P7814+1,AUTO

      814     9646    8                          WHENRETURN DO;

      815     9647    8                             P7814.PDENQ='0'B;

   9647   2 00062F  8747 0045                            CL       P7814,AUTO

      816     9648    8   DO_PENQ:                  P7814.STATUS=SUBSTR(IBFR,P7814.INDX,8);

   9648   2 000631  ACC7 003C            DO_PENQ         LDB,B2   IBFR$,AUTO
          2 000633  A856                                 LDR,R2   R6
          2 000634  6C08                                 LDV,R6   8
          2 000635  BBC7 0047                            LAB,B3   P7814+2,AUTO
          2 000637  3C00                                 LDV,R3   0
          2 000638  0008                                 MMM

      817     9649    8                             SUBSTR(IBFR,P7814.INDX,

   9649   2 000639  E847 0035                            LDR,R6   INPUT+1,AUTO
          2 00063B  E247 0046                            SUB,R6   P7814+1,AUTO
          2 00063D  EF47 0068                            STR,R6   FPT_WRSYSLOG+22,AUTO
          2 00063F  ACC7 003C                            LDB,B2   IBFR$,AUTO
          2 000641  A847 0046                            LDR,R2   P7814+1,AUTO
          2 000643  2E08                                 ADV,R2   8
          2 000644  E847 0035                            LDR,R6   INPUT+1,AUTO
          2 000646  BB82                                 LAB,B3   ,B2
          2 000647  B847 0046                            LDR,R3   P7814+1,AUTO
          2 000649  F847 0068                            LDR,R7   FPT_WRSYSLOG+22,AUTO
          2 00064B  7EF8                                 ADV,R7   -8
          2 00064C  D380 0000 0000  xent                 LNJ,B5   X6C_ALR

      818     9650    8                               INPUT.ENDING_ETX-P7814.INDX-8)=
      819     9651    8                               SUBSTR(IBFR,P7814.INDX+8,INPUT.ENDING_ETX);
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:132  
      820     9652    8                             INPUT.ENDING_ETX=INPUT.ENDING_ETX-8;

   9652   2 00064F  E847 0035                            LDR,R6   INPUT+1,AUTO
          2 000651  6EF8                                 ADV,R6   -8
          2 000652  EF47 0035                            STR,R6   INPUT+1,AUTO

      821     9653    8                             IF INPUT.ENDING_ETX=INPUT.FIRST THEN

   9653   2 000654  E947 0034                            CMR,R6   INPUT,AUTO
          2 000656  0981 0003                            BNE      s:9662,PREL

      822     9654    8                                INPUT.PRESENT='0'B;

   9654   2 000658  8747 0036                            CL       INPUT+2,AUTO

      823     9655        /* printer status has been moved aside and the buffer has had
      824     9656           the printer status removed.
      825     9657
      826     9658           Look at the printer status, and set ACK/NAK/BSY flags to
      827     9659           simulate what happens when the 7700 controller is polled.
      828     9660        */
      829     9661    8                             END;

      830     9662    7                          IF T$->KZ$HIPDEV.OTPBSY THEN

   9662   2 00065A  ECC7 0043                            LDB,B6   T$,AUTO
          2 00065C  82C6 0012                            LB,'0400'X        18,B6
          2 00065E       0400
          2 00065F  0581 0010                            BBF      s:9667,PREL

      831     9663    7                             IF (P7814.S(4)&'01'X)~='00'X THEN

   9663   2 000661  E2C7 0049                            LLH,R6   P7814+4,AUTO
          2 000663  6008                                 SOL,R6   8
          2 000664  E570 0100                            AND,R6   256,IMO
          2 000666  6901 0006                            BEZ,R6   s:9666,PREL

PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:133  
      832     9664    7                                BUSY(1)='1'B;

   9664   2 000668  8947 002F                            LBT,'4000'X       BUSY,AUTO
   9664   2 00066A       4000
          2 00066B  0F81 0004                            B        s:9667,PREL

      833     9665    7                             ELSE
      834     9666    7                                ACKS(1)='1'B;

   9666   2 00066D  8947 002D                            LBT,'4000'X       ACKS,AUTO
   9666   2 00066F       4000

      835     9667    7                          EXIT PRINTER_LOOK;

   9667   2 000670  0F81 0008                            B        s:9671,PREL

      836     9668    7                          END;
      837     9669    6                       T$=T$->KZ$HIPDEV.LNK$;

   9669   2 000672  DC86                                 LDB,B5   ,B6
          2 000673  DFC7 0043                            STB,B5   T$,AUTO

      838     9670    6                       END;

   9670   2 000675  8DC7 0043                            CMN      T$,AUTO
          2 000677  0981 FF5F                            BNE      s:9638,PREL

      839     9671    5                    END PRINTER_LOOK;

   9671   2 000679  0F81 0040                            B        s:9699,PREL

      840     9672
      841     9673    4               CASE(3 /* BSY */);

      842     9674    4                 BUSY(ADR_INDX)='1'B;

   9674   2 00067B  EBC7 002F                            LAB,B6   BUSY,AUTO
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:134  
          2 00067D  9847 0040                            LDR,R1   ADR_INDX,AUTO
          2 00067F  8916                                 LBT      ,B6,R1

      843     9675    4                 INDX=INDX+7;

   9675   2 000680  E847 003A                            LDR,R6   INDX,AUTO
          2 000682  6E07                                 ADV,R6   7
          2 000683  EF47 003A                            STR,R6   INDX,AUTO
          2 000685  0F81 0034                            B        s:9699,PREL

      844     9676
      845     9677    4               CASE(4 /* PGOV */);

      846     9678    4                 PGOV(ADR_INDX)='1'B;

   9678   2 000687  EBC7 0030                            LAB,B6   PGOV,AUTO
          2 000689  9847 0040                            LDR,R1   ADR_INDX,AUTO
          2 00068B  8916                                 LBT      ,B6,R1

      847     9679    4                 INDX=INDX+7;

   9679   2 00068C  E847 003A                            LDR,R6   INDX,AUTO
          2 00068E  6E07                                 ADV,R6   7
          2 00068F  EF47 003A                            STR,R6   INDX,AUTO
          2 000691  0F81 0028                            B        s:9699,PREL

      848     9680
      849     9681    4               CASE(5 /* NA */);

      850     9682    4                 NAV(ADR_INDX)='1'B;

   9682   2 000693  EBC7 0031                            LAB,B6   NAV,AUTO
          2 000695  9847 0040                            LDR,R1   ADR_INDX,AUTO
          2 000697  8916                                 LBT      ,B6,R1

      851     9683    4                 INDX=INDX+7;

PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:135  
   9683   2 000698  E847 003A                            LDR,R6   INDX,AUTO
          2 00069A  6E07                                 ADV,R6   7
          2 00069B  EF47 003A                            STR,R6   INDX,AUTO
          2 00069D  0F81 001C                            B        s:9699,PREL

      852     9684
      853     9685    4               CASE( 15 /* Unknown status byte */);

      854     9686
      855     9687        /*       Flakey input block. Just look for ending ETX and ignore fragment */
      856     9688    5                 DO I=INDX+5 TO LENX-1;

   9688   2 00069F  E847 003A                            LDR,R6   INDX,AUTO
          2 0006A1  6E05                                 ADV,R6   5
          2 0006A2  EF47 003E                            STR,R6   I,AUTO
          2 0006A4  0F81 000B                            B        s:9691+2,PREL

      857     9689    5                    IF BITASC('83'X)=SUBSTR(IBFR,I,1) THEN

   9689   2 0006A6  ECC7 003C                            LDB,B6   IBFR$,AUTO
          2 0006A8  B847 003E                            LDR,R3   I,AUTO
          2 0006AA  E0B6                                 LDH,R6   ,B6,R3
          2 0006AB  6D83                                 CMV,R6   -125
          2 0006AC  0901 000A                            BE       s:9689,PREL

      858     9690    5                       GOTO UNKNOWN_BLK_FINISHED;
      859     9691    5                    END;

   9691   2 0006AE  8AC7 003E                            INC      I,AUTO
          2 0006B0  E847 003E                            LDR,R6   I,AUTO
          2 0006B2  E947 003B                            CMR,R6   LENX,AUTO
          2 0006B4  0872                                 BAL      s:9689,SPREL

      860     9692    4                 GOTO CANT_FIND_ENDING_ETX;

   9692   2 0006B5  0F81 0018                            B        s:9699,PREL

PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:136  
   9689   2                              UNKNOWN_BLK_FIN*null
      861     9693    4   UNKNOWN_BLK_FINISHED:;
      862     9694    4                 INDX=I+2;

   9694   2 0006B7  3E02                 UNKNOWN_BLK_FIN*ADV,R3   2
          2 0006B8  BF47 003A                            STR,R3   INDX,AUTO

      863     9695
      864     9696
      865     9697    4               END;

      866     9698
      867     9699    3              IF SUBSTR(IBFR,INDX-2,1)~=%BITASC('83'X) THEN

   9699   2 0006BA  ECC7 003C                            LDB,B6   IBFR$,AUTO
          2 0006BC  B847 003A                            LDR,R3   INDX,AUTO
          2 0006BE  3EFE                                 ADV,R3   -2
          2 0006BF  E0B6                                 LDH,R6   ,B6,R3
          2 0006C0  6D83                                 CMV,R6   -125
          2 0006C1  0981 000C                            BNE      s:9699,PREL

      868     9700    3                 GOTO CANT_FIND_ENDING_ETX;
      869     9701
      870     9702    3              END PARSING_INPUT;

   9702   2 0006C3  E847 003B                            LDR,R6   LENX,AUTO
          2 0006C5  E247 003A                            SUB,R6   INDX,AUTO
          2 0006C7  6D06                                 CMV,R6   6
          2 0006C8  0881 FE32                            BAGE     s:9576,PREL

      871     9703
      872     9704    2           RETURN;

   9704   2 0006CA  ECC7 0038                            LDB,B6   INPUT+4,AUTO
          2 0006CC  C3C6 0001                            LNJ,B4   1,B6

   9699   2                              CANT_FIND_ENDIN*null
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:137  
      873     9705    2   CANT_FIND_ENDING_ETX:;
      874     9706    2           CALL ERRLOG(%E$ETXGONE,INDX);

   9706   2 0006CE  EBF0 00D4            CANT_FIND_ENDIN*LAB,B6   212,IMO
          2 0006D0  DBC7 003A                            LAB,B5   INDX,AUTO
          2 0006D2  DFC7 0050                            STB,B5   @ERROR+2,AUTO
          2 0006D4  EFC7 004E                            STB,B6   P7814+9,AUTO
          2 0006D6  E3C0 016B                            LNJ,B6   s:0,PREL
          2 0006D8       0001                            DC       s:9718,PREL

      875     9707        /*E*          ERROR: KZH-E$ETXGONE
      876     9708                    MESSAGE: Missing ETX on HIP message fragment.
      877     9709                DESCRIPTION: Cannot locate ETX/ETB in HIP fragment.
      878     9710                              V0 = CHANNEL NUMBER
      879     9711                              V1 = NUMBER OF RETRIES BEFORE GOOD COMPLETION
      880     9712                              V2 = INDEX INTO BUFFER
      881     9713                              DATA = INPUT BUFFER
      882     9714        */
      883     9715
      884     9716
      885     9717
      886     9718    2           ALTRETURN;

   9718   2 0006D9  ECC7 0038                            LDB,B6   INPUT+4,AUTO
          2 0006DB  B806                                 LDR,R3   ,B6
          2 0006DC  C3B6                                 LNJ,B4   ,B6,R3

      887     9719
      888     9720    2   END PARSE_INPUT;
      889     9721        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:138  
      890     9722        /*  This proc is called to handle tube status responses.
      891     9723             CURCTR$ and CURDEV$ have been set up via GETOTP device manager call
      892     9724        */
      893     9725
      894     9726
      895     9727    1   PROCESS_IMMED_STATUS:PROC ALTRET;

   9727   2 0006DD  EFC7 0038            PROCESS_IMMED_S*STB,B6   INPUT+4,AUTO

      896     9728
      897     9729    2   DCL TYP SBIN;
      898     9730
      899     9731    2           TYP=KZ@LINCTX.CURCTR$->KZ$HIPCTR.TYP;

   9731   2 0006DF  DCC7 0004                            LDB,B5   @KZ@LINCTX,AUTO
          2 0006E1  CCC5 004E                            LDB,B4   78,B5
          2 0006E3  E844 0008                            LDR,R6   8,B4
          2 0006E5  EF47 003A                            STR,R6   TYP,AUTO

      900     9732
      901     9733    3           DO CASE(KZ@LINCTX.CURDEV$->KZ$HIPDEV.ADR);

   9733   2 0006E7  BCC5 0050                            LDB,B3   80,B5
          2 0006E9  B2C3 0015                            LLH,R3   21,B3
          2 0006EB  3D02                                 CMV,R3   2
          2 0006EC  0281 00F1                            BGE      s:9820,PREL
          2 0006EE  A830 0000 06F4  02                   LDR,R2   s:9733+13,R3
          2 0006F1  83A0 0000 06F6  02                   JMP      s:9736,R2
          2 0006F4       0000                            DC       s:9736,PREL
          2 0006F5       00AC                            DC       s:9800,PREL

      902     9734    3            CASE(0) /* TUBE */;

      903     9735
      904     9736    3              IF NAKS(0) OR ((TYP~=7700) AND BUSY(0)) THEN
              9736                       /* KLUDGE: 7804 treat BUSY like NAK */

PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:139  
   9736   2 0006F6  89C7 002E                            CMZ      NAKS,AUTO
          2 0006F8  0801 0009                            BAL      s:9737,PREL
          2 0006FA  E970 1E14                            CMR,R6   7700,IMO
          2 0006FC  0901 003E                            BE       s:9756,PREL
          2 0006FE  89C7 002F                            CMZ      BUSY,AUTO
          2 000700  0881 003A                            BAGE     s:9756,PREL

      905     9737    4   TERMINAL_SEND_NAKED_OUTPUT: DO;

   9737   2                              TERMINAL_SEND_N*null
      906     9738
      907     9739    4                 KZ@LINCTX.OTPDEV$->KZ$HIPDEV.RTRCNT=

   9739   2 000702  ACC5 0062            TERMINAL_SEND_N*LDB,B2   98,B5
          2 000704  D2C2 001F                            LLH,R5   31,B2
          2 000706  5E01                                 ADV,R5   1
          2 000707  D7C2 001F                            STH,R5   31,B2

      908     9740    4                   KZ@LINCTX.OTPDEV$->KZ$HIPDEV.RTRCNT+1;
      909     9741    4                 KZ@LINCTX.OTPDEV$->KZ$HIPDEV.OTPBSY='0'B;

   9741   2 000709  ECC5 0062                            LDB,B6   98,B5
          2 00070B  8846 0012                            LBF,'0400'X       18,B6
          2 00070D       0400

      910     9742    4                 IF(KZ@LINCTX.PRO.RETRYS>0) AND

   9742   2 00070E  D845 003D                            LDR,R5   61,B5
          2 000710  5901 0019                            BEZ,R5   s:9750,PREL
          2 000712  ECC5 0062                            LDB,B6   98,B5
          2 000714  C2C6 001F                            LLH,R4   31,B6
          2 000716  C955                                 CMR,R4   R5
          2 000717  0381 0012                            BLE      s:9750,PREL

      911     9743    4                   (KZ@LINCTX.PRO.RETRYS<KZ@LINCTX.OTPDEV$->KZ$HIPDEV.RTRCNT)THEN
      912     9744    5                 DO;

PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:140  
      913     9745    5                    KZ$EVENT.EVENT=%KZ#LINFCN_POLTIMOUT;

   9745   2 000719  3C05                                 LDV,R3   5
          2 00071A  BF47 0008                            STR,R3   KZ$EVENT,AUTO

      914     9746    5                    CALL KZ@LINCTX.DEVMGR@(KZ$EVENT);

   9746   2 00071C  CBC7 0008                            LAB,B4   KZ$EVENT,AUTO
          2 00071E  CFC7 0068                            STB,B4   FPT_WRSYSLOG+22,AUTO
          2 000720  BBC7 0068                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 000722  9CC5 006E                            LDB,B1   110,B5
          2 000724  CBF0 0100                            LAB,B4   256,IMO
          2 000726  E381                                 LNJ,B6   ,B1
          2 000727       0001                            DC       s:9747,PREL

      915     9747    5                    END;

   9747   2 000728  0F81 00B5                            B        s:9820,PREL

      916     9748    4                 ELSE
      917     9749    5                 DO;

      918     9750    5                    KZ$EVENT.EVENT=%KZ#LINFCN_REQOTP;

   9750   2 00072A  4C02                                 LDV,R4   2
          2 00072B  CF47 0008                            STR,R4   KZ$EVENT,AUTO

      919     9751    5                    CALL KZ@LINCTX.DEVMGR@(KZ$EVENT);

   9751   2 00072D  EBC7 0008                            LAB,B6   KZ$EVENT,AUTO
          2 00072F  EFC7 0068                            STB,B6   FPT_WRSYSLOG+22,AUTO
          2 000731  BBC7 0068                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 000733  9CC5 006E                            LDB,B1   110,B5
          2 000735  CBF0 0100                            LAB,B4   256,IMO
          2 000737  E381                                 LNJ,B6   ,B1
          2 000738       0001                            DC       s:9754,PREL

PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:141  
      920     9752    5                    END;

      921     9753
      922     9754    4                 END TERMINAL_SEND_NAKED_OUTPUT;

   9754   2 000739  0F81 00A4                            B        s:9820,PREL

      923     9755
      924     9756    3              ELSE IF BUSY(0) THEN

   9756   2 00073B  89C7 002F                            CMZ      BUSY,AUTO
          2 00073D  0881 0017                            BAGE     s:9766,PREL

      925     9757    4   TERMINAL_BUSY: DO;

   9757   2                              TERMINAL_BUSY   null
      926     9758        /* THE TERMINAL SAYS HE IS BUSY. SET THE 'WACK' BIT TO WAIT FOR ACK.
      927     9759
      928     9760           AN 'ACK' FROM THE TERMINAL WILL CLEAR THE WAIT, SO WILL ANY INPUT.
      929     9761        */
      930     9762    4                    KZ@LINCTX.OTPDEV$->KZ$HIPDEV.HLT.WACK='1'B;

   9762   2 00073F  ACC5 0062            TERMINAL_BUSY   LDB,B2   98,B5
          2 000741  8942 0012                            LBT,'0080'X       18,B2
          2 000743       0080

      931     9763    4                    KZ$EVENT.EVENT=%KZ#LINFCN_REQOTP;

   9763   2 000744  5C02                                 LDV,R5   2
          2 000745  DF47 0008                            STR,R5   KZ$EVENT,AUTO

      932     9764    4                    CALL KZ@LINCTX.DEVMGR@(KZ$EVENT);

   9764   2 000747  EBC7 0008                            LAB,B6   KZ$EVENT,AUTO
          2 000749  EFC7 0068                            STB,B6   FPT_WRSYSLOG+22,AUTO
          2 00074B  BBC7 0068                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 00074D  9CC5 006E                            LDB,B1   110,B5
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:142  
          2 00074F  CBF0 0100                            LAB,B4   256,IMO
          2 000751  E381                                 LNJ,B6   ,B1
          2 000752       0001                            DC       s:9765,PREL

      933     9765    4                    END TERMINAL_BUSY;

   9765   2 000753  0F81 008A                            B        s:9820,PREL

      934     9766    3                 ELSE IF ACKS(0) AND NOT KZ@LINCTX.OTPDEV$->KZ$HIPDEV.HLT.WACK THEN

   9766   2 000755  89C7 002D                            CMZ      ACKS,AUTO
          2 000757  0881 001B                            BAGE     s:9774,PREL
          2 000759  ACC5 0062                            LDB,B2   98,B5
          2 00075B  82C2 0012                            LB,'0080'X        18,B2
          2 00075D       0080
          2 00075E  0501 0014                            BBT      s:9774,PREL

      935     9767    4   TERMINAL_SEND_ACKED_OUTPUT:DO;

   9767   2                              TERMINAL_SEND_A*null
      936     9768
      937     9769    4                       KZ@LINCTX.OTPDEV$->KZ$HIPDEV.RTRCNT=0;

   9769   2 000760  87C2 001F            TERMINAL_SEND_A*CLH      31,B2

      938     9770    4                       KZ$EVENT.EVENT=%KZ#LINFCN_RELOTP;

   9770   2 000762  5C03                                 LDV,R5   3
          2 000763  DF47 0008                            STR,R5   KZ$EVENT,AUTO

      939     9771    4                       CALL KZ@LINCTX.DEVMGR@(KZ$EVENT);

   9771   2 000765  EBC7 0008                            LAB,B6   KZ$EVENT,AUTO
          2 000767  EFC7 0068                            STB,B6   FPT_WRSYSLOG+22,AUTO
          2 000769  BBC7 0068                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 00076B  9CC5 006E                            LDB,B1   110,B5
          2 00076D  CBF0 0100                            LAB,B4   256,IMO
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:143  
          2 00076F  E381                                 LNJ,B6   ,B1
          2 000770       0001                            DC       s:9773,PREL

      940     9772
      941     9773    4                       END TERMINAL_SEND_ACKED_OUTPUT;

   9773   2 000771  0F81 006C                            B        s:9820,PREL

      942     9774    3                    ELSE IF PGOV(0) OR PGOV(1) THEN

   9774   2 000773  89C7 0030                            CMZ      PGOV,AUTO
          2 000775  0801 0006                            BAL      s:9775,PREL
          2 000777  82C7 0030                            LB,'4000'X        PGOV,AUTO
          2 000779       4000
          2 00077A  0581 0012                            BBF      s:9782,PREL

      943     9775    4   TUBE_SAID_OVERFLOW: DO;

   9775   2                              TUBE_SAID_OVERF*null
      944     9776
      945     9777        /* I PROBABLY SHOULD ERRORLOG THIS, BUT FOR NOW HANDLE LIKE ACK */
      946     9778    4                          KZ$EVENT.EVENT=%KZ#LINFCN_RELOTP;

   9778   2 00077C  5C03                 TUBE_SAID_OVERF*LDV,R5   3
          2 00077D  DF47 0008                            STR,R5   KZ$EVENT,AUTO

      947     9779    4                          CALL KZ@LINCTX.DEVMGR@(KZ$EVENT);

   9779   2 00077F  ABC7 0008                            LAB,B2   KZ$EVENT,AUTO
          2 000781  AFC7 0068                            STB,B2   FPT_WRSYSLOG+22,AUTO
          2 000783  BBC7 0068                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 000785  9CC5 006E                            LDB,B1   110,B5
          2 000787  CBF0 0100                            LAB,B4   256,IMO
          2 000789  E381                                 LNJ,B6   ,B1
          2 00078A       0001                            DC       s:9781,PREL

      948     9780
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:144  
      949     9781    4                          END TUBE_SAID_OVERFLOW;

   9781   2 00078B  0F81 0052                            B        s:9820,PREL

      950     9782    3                       ELSE IF INPUT.PRESENT THEN

   9782   2 00078D  89C7 0036                            CMZ      INPUT+2,AUTO
          2 00078F  0881 004E                            BAGE     s:9820,PREL

      951     9783    4   TERMINAL_SEND_IGNORED_MSG:DO;

   9783   2                              TERMINAL_SEND_I*null
      952     9784
      953     9785        /* There was a transmit pending, so any message I sent was ignored.
      954     9786
      955     9787            The cursor position was probably lost.
      956     9788
      957     9789            requeue the output for later transmission.
      958     9790        */
      959     9791    5                             DO;

      960     9792    5                                KZ$EVENT.EVENT=%KZ#LINFCN_REQOTP;

   9792   2 000791  5C02                 TERMINAL_SEND_I*LDV,R5   2
          2 000792  DF47 0008                            STR,R5   KZ$EVENT,AUTO

      961     9793    5                                CALL KZ@LINCTX.DEVMGR@(KZ$EVENT);

   9793   2 000794  ABC7 0008                            LAB,B2   KZ$EVENT,AUTO
          2 000796  AFC7 0068                            STB,B2   FPT_WRSYSLOG+22,AUTO
          2 000798  BBC7 0068                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 00079A  9CC5 006E                            LDB,B1   110,B5
          2 00079C  CBF0 0100                            LAB,B4   256,IMO
          2 00079E  E381                                 LNJ,B6   ,B1
          2 00079F       0001                            DC       s:9796,PREL

      962     9794    5                                END;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:145  

      963     9795
      964     9796    4                             END TERMINAL_SEND_IGNORED_MSG;

   9796   2 0007A0  0F81 003D                            B        s:9820,PREL

      965     9797
      966     9798    3            CASE(1) /* PRINTER */;

      967     9799
      968     9800    3              IF NAKS(1) THEN

   9800   2 0007A2  82C7 002E                            LB,'4000'X        NAKS,AUTO
   9800   2 0007A4       4000
          2 0007A5  0581 0038                            BBF      s:9820,PREL

      969     9801    4   PRINTER_NAKED_BLOCK:DO;

   9801   2                              PRINTER_NAKED_B*null
      970     9802
      971     9803    4                 KZ@LINCTX.OTPDEV$->KZ$HIPDEV.RTRCNT=

   9803   2 0007A7  ACC5 0062            PRINTER_NAKED_B*LDB,B2   98,B5
          2 0007A9  D2C2 001F                            LLH,R5   31,B2
          2 0007AB  5E01                                 ADV,R5   1
          2 0007AC  D7C2 001F                            STH,R5   31,B2

      972     9804    4                   KZ@LINCTX.OTPDEV$->KZ$HIPDEV.RTRCNT+1;
      973     9805    4                 KZ@LINCTX.OTPDEV$->KZ$HIPDEV.OTPBSY='0'B;

   9805   2 0007AE  ECC5 0062                            LDB,B6   98,B5
          2 0007B0  8846 0012                            LBF,'0400'X       18,B6
          2 0007B2       0400

      974     9806    4                 IF(KZ@LINCTX.PRO.RETRYS>0) AND

   9806   2 0007B3  D845 003D                            LDR,R5   61,B5
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:146  
          2 0007B5  5901 0019                            BEZ,R5   s:9814,PREL
          2 0007B7  ECC5 0062                            LDB,B6   98,B5
          2 0007B9  C2C6 001F                            LLH,R4   31,B6
          2 0007BB  C955                                 CMR,R4   R5
          2 0007BC  0381 0012                            BLE      s:9814,PREL

      975     9807    4                   (KZ@LINCTX.PRO.RETRYS<KZ@LINCTX.OTPDEV$->KZ$HIPDEV.RTRCNT)THEN
      976     9808    5                 DO;

      977     9809    5                    KZ$EVENT.EVENT=%KZ#LINFCN_POLTIMOUT;

   9809   2 0007BE  3C05                                 LDV,R3   5
          2 0007BF  BF47 0008                            STR,R3   KZ$EVENT,AUTO

      978     9810    5                    CALL KZ@LINCTX.DEVMGR@(KZ$EVENT);

   9810   2 0007C1  CBC7 0008                            LAB,B4   KZ$EVENT,AUTO
          2 0007C3  CFC7 0068                            STB,B4   FPT_WRSYSLOG+22,AUTO
          2 0007C5  BBC7 0068                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 0007C7  9CC5 006E                            LDB,B1   110,B5
          2 0007C9  CBF0 0100                            LAB,B4   256,IMO
          2 0007CB  E381                                 LNJ,B6   ,B1
          2 0007CC       0001                            DC       s:9811,PREL

      979     9811    5                    END;

   9811   2 0007CD  0F81 0010                            B        s:9820,PREL

      980     9812    4                 ELSE
      981     9813    5                 DO;

      982     9814    5                    KZ$EVENT.EVENT=%KZ#LINFCN_REQOTP;

   9814   2 0007CF  4C02                                 LDV,R4   2
          2 0007D0  CF47 0008                            STR,R4   KZ$EVENT,AUTO

      983     9815    5                    CALL KZ@LINCTX.DEVMGR@(KZ$EVENT);
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:147  

   9815   2 0007D2  EBC7 0008                            LAB,B6   KZ$EVENT,AUTO
          2 0007D4  EFC7 0068                            STB,B6   FPT_WRSYSLOG+22,AUTO
          2 0007D6  BBC7 0068                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 0007D8  9CC5 006E                            LDB,B1   110,B5
          2 0007DA  CBF0 0100                            LAB,B4   256,IMO
          2 0007DC  E381                                 LNJ,B6   ,B1
          2 0007DD       0001                            DC       s:9820,PREL

      984     9816    5                    END;

      985     9817
      986     9818    4                 END PRINTER_NAKED_BLOCK;

      987     9819    3            END /* CASE ON SENDING DEVICE */;

      988     9820    2   END PROCESS_IMMED_STATUS;

   9820   2 0007DE  ECC7 0038                            LDB,B6   INPUT+4,AUTO
          2 0007E0  C3C6 0001                            LNJ,B4   1,B6

      989     9821        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:148  
      990     9822        /*  This proc is called to handle any tube status messages..
      991     9823
      992     9824            These messages are DELAYED from the time the output block is
      993     9825            sent, and CURDEV$ does not refer to the device, but
      994     9826            CURCTR$ now points at the proper controller.
      995     9827        */
      996     9828
      997     9829    1   PROCESS_DELAYED_STATUS:PROC ALTRET;

   9829   2 0007E2  EFC7 0038            PROCESS_DELAYED*STB,B6   INPUT+4,AUTO

      998     9830
      999     9831    2           IF ACKS(1) THEN

   9831   2 0007E4  82C7 002D                            LB,'4000'X        ACKS,AUTO
   9831   2 0007E6       4000
          2 0007E7  0581 002C                            BBF      s:9843,PREL

     1000     9832    3   PRINTER_FINALLY_FINISHED: DO;

   9832   2                              PRINTER_FINALLY*null
     1001     9833
     1002     9834    3              CALL SETDEV(1,KZ@LINCTX.CURDEV$) ALTRET(NO_PRINTER_ON_DEVICE);

   9834   2 0007E9  DBF0 0001            PRINTER_FINALLY*LAB,B5   1,IMO
          2 0007EB  CCC7 0004                            LDB,B4   @KZ@LINCTX,AUTO
          2 0007ED  BBC4 0050                            LAB,B3   80,B4
          2 0007EF  BFC7 0042                            STB,B3   STA_INDX,AUTO
          2 0007F1  DFC7 0040                            STB,B5   ADR_INDX,AUTO
          2 0007F3  E3C0 0029                            LNJ,B6   s:0,PREL
          2 0007F5       0024                            DC       s:9844,PREL

     1003     9835    3              KZ@LINCTX.CURDEV$->KZ$HIPDEV.RTRCNT=0;

   9835   2 0007F6  ECC7 0004                            LDB,B6   @KZ@LINCTX,AUTO
          2 0007F8  DCC6 0050                            LDB,B5   80,B6
          2 0007FA  87C5 001F                            CLH      31,B5
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:149  

     1004     9836    3              IF KZ@LINCTX.CURDEV$->KZ$HIPDEV.OTPBSY THEN

   9836   2 0007FC  DCC6 0050                            LDB,B5   80,B6
          2 0007FE  82C5 0012                            LB,'0400'X        18,B5
          2 000800       0400
          2 000801  0581 0017                            BBF      s:9844,PREL

     1005     9837    4              DO;

     1006     9838    4                 KZ$EVENT.EVENT=%KZ#LINFCN_RELOTP;

   9838   2 000803  6C03                                 LDV,R6   3
          2 000804  EF47 0008                            STR,R6   KZ$EVENT,AUTO

     1007     9839    4                 CALL KZ@LINCTX.DEVMGR@(KZ$EVENT);

   9839   2 000806  CBC7 0008                            LAB,B4   KZ$EVENT,AUTO
          2 000808  CFC7 0068                            STB,B4   FPT_WRSYSLOG+22,AUTO
          2 00080A  BBC7 0068                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 00080C  9CC6 006E                            LDB,B1   110,B6
          2 00080E  CBF0 0100                            LAB,B4   256,IMO
          2 000810  E381                                 LNJ,B6   ,B1
          2 000811       0001                            DC       s:9842,PREL

     1008     9840    4                 END;

     1009     9841
     1010     9842    3              END PRINTER_FINALLY_FINISHED;

   9842   2 000812  0F81 0006                            B        s:9844,PREL

     1011     9843    2           ELSE IF BUSY(1) THEN

   9843   2 000814  82C7 002F                            LB,'4000'X        BUSY,AUTO
   9843   2 000816       4000
          2 000817  0581 0001                            BBF      s:9844,PREL
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:150  

     1012     9844    3   PRINTER_STILL_BUSY:DO;

   9844   2                              PRINTER_STILL_B*null
     1013     9845
     1014     9846        /*  This is a retransmission of  some previous block, because
     1015     9847           I did not get an ACK message from the terminal in a timely fashion.
     1016     9848
     1017     9849            Assume the printer got the message ok, and do nothing.
     1018     9850
     1019     9851            Eventually the printer will send an ACK saying the current buffer has
     1020     9852           been printed.
     1021     9853        */
     1022     9854    3                 END PRINTER_STILL_BUSY;

   9839   2                              NO_PRINTER_ON_D*null
     1023     9855
     1024     9856    2   NO_PRINTER_ON_DEVICE:;
     1025     9857    2   END PROCESS_DELAYED_STATUS;

   9857   2 000819  ECC7 0038            NO_PRINTER_ON_D*LDB,B6   INPUT+4,AUTO
          2 00081B  C3C6 0001                            LNJ,B4   1,B6

     1026     9858
     1027     9859        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:151  
     1028     9860    1   SETDEV: PROC(DEVNUM,DEV$) ALTRET;

   9860   2 00081D  EFC7 003E            SETDEV          STB,B6   I,AUTO

     1029     9861        /* KZ@LINCTX.CURCTR$ points to the correct controller, but
     1030     9862           KZ@LINCTX.CURDEV$ does not point to the proper device.
     1031     9863
     1032     9864            MAKE DEV$ POINT TO THE PROPER DEVICE
     1033     9865        */
     1034     9866    2   DCL DEV$ PTR;
     1035     9867    2   DCL DEVNUM SBIN;
     1036     9868
     1037     9869    2           DEV$=KZ@LINCTX.CURCTR$->KZ$HIPCTR.DEVHD$;

   9869   2 00081F  DCC7 0004                            LDB,B5   @KZ@LINCTX,AUTO
          2 000821  CCC5 004E                            LDB,B4   78,B5
          2 000823  BCC4 0002                            LDB,B3   2,B4
          2 000825  ACC7 0042                            LDB,B2   @DEV$,AUTO
          2 000827  BF82                                 STB,B3   ,B2

     1038     9870    3           DO WHILE(DEV$~=ADDR(NIL));

   9870   2 000828  0F81 0011                            B        s:9876,PREL

     1039     9871    3              IF DEV$->KZ$HIPDEV.ADR=DEVNUM THEN

   9871   2 00082A  ECC7 0042                            LDB,B6   @DEV$,AUTO
          2 00082C  DC86                                 LDB,B5   ,B6
          2 00082D  CCC7 0040                            LDB,B4   @DEVNUM,AUTO
          2 00082F  E2C5 0015                            LLH,R6   21,B5
          2 000831  E904                                 CMR,R6   ,B4
          2 000832  0981 0005                            BNE      s:9875,PREL

     1040     9872    4              DO;

     1041     9873    4                 RETURN;

PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:152  
   9873   2 000834  ECC7 003E                            LDB,B6   I,AUTO
          2 000836  C3C6 0001                            LNJ,B4   1,B6

     1042     9874    4                 END;
     1043     9875    3              DEV$=DEV$->KZ$HIPDEV.LNK$;

   9875   2 000838  BC85                                 LDB,B3   ,B5
          2 000839  BF86                                 STB,B3   ,B6

     1044     9876    3              END;

   9876   2 00083A  ECC7 0042                            LDB,B6   @DEV$,AUTO
          2 00083C  8D86                                 CMN      ,B6
          2 00083D  09ED                                 BNE      s:9871,SPREL

     1045     9877    2           ALTRETURN;

   9877   2 00083E  ECC7 003E                            LDB,B6   I,AUTO
          2 000840  B806                                 LDR,R3   ,B6
          2 000841  C3B6                                 LNJ,B4   ,B6,R3

     1046     9878    2   END SETDEV;
     1047     9879        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:153  
     1048     9880    1   ERRLOG: PROC (ERROR, INDX);

   9880   2 000842  EFC7 004C            ERRLOG          STB,B6   P7814+7,AUTO

     1049     9881
     1050     9882    2   DCL INDX UBIN;
     1051     9883    2   DCL ERROR UBIN;
     1052     9884        %FPT_WRSYSLOG (STCLASS=" ");
     1053     9979        %FPT_WRSYSLOG (FPTN=FPT@WRSYSLOG, STCLASS=CONSTANT,FCG='KZ',MID='H');
     1054    10074
     1055    10075    2           FPT_WRSYSLOG = FPT@WRSYSLOG;

  10075   2 000844  AB80 0000 0044  00                   LAB,B2   FPT@WRSYSLOG
          2 000847  2C00                                 LDV,R2   0
          2 000848  6C2A                                 LDV,R6   42
          2 000849  BBC7 0052                            LAB,B3   FPT_WRSYSLOG,AUTO
          2 00084B  3C00                                 LDV,R3   0
          2 00084C  0008                                 MMM

     1056    10076    2           FPT_WRSYSLOG.V.TERMID = KZ@LINCTX.LINID;

  10076   2 00084D  ACC7 0004                            LDB,B2   @KZ@LINCTX,AUTO
          2 00084F  2C08                                 LDV,R2   8
          2 000850  6C10                                 LDV,R6   16
          2 000851  BBC7 005A                            LAB,B3   FPT_WRSYSLOG+8,AUTO
          2 000853  3C00                                 LDV,R3   0
          2 000854  0008                                 MMM

     1057    10077    2           FPT_WRSYSLOG.V.ERRCODE.ERR# = ERROR;

  10077   2 000855  ECC7 004E                            LDB,B6   @ERROR,AUTO
          2 000857  E806                                 LDR,R6   ,B6
          2 000858  6003                                 SOL,R6   3
          2 000859  EAC7 0059                            SRM,R6,'FFF8'X    FPT_WRSYSLOG+7,AUTO
          2 00085B       FFF8

     1058    10078
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:154  
     1059    10079    3           DO CASE (ERROR);

  10079   2 00085C  B806                                 LDR,R3   ,B6
          2 00085D  BA70 FF30                            ADD,R3   -208,IMO
          2 00085F  3D06                                 CMV,R3   6
          2 000860  0281 0059                            BGE      s:10114,PREL
          2 000862  A830 0000 0868  02                   LDR,R2   s:10079+12,R3
          2 000865  83A0 0000 086E  02                   JMP      s:10090,R2
          2 000868       003C                            DC       s:10106,PREL
          2 000869       004C                            DC       s:10114,PREL
          2 00086A       0021                            DC       s:10098,PREL
          2 00086B       0021                            DC       s:10098,PREL
          2 00086C       0021                            DC       s:10098,PREL
          2 00086D       0000                            DC       s:10090,PREL

     1060    10080    3            CASE(%E$HIPIO_OK);

     1061    10081                      /*E* ERROR:       KZH-E$HIPIO_OK-1
     1062    10082                           MESSAGE:     Corrected HIP I/O Error
     1063    10083                           DESCRIPTION: A NAK or ENQ occured on a BSC HIP line and a
     1064    10084                                        retry of the operation causing the error was
     1065    10085                                        successful.
     1066    10086                              V0 = Channel Number
     1067    10087                              V1 = Number of retries before good completion.
     1068    10088                              DATA = Vector of KZ$LINCTX.HIST           */
     1069    10089
     1070    10090    3              FPT_WRSYSLOG.V.ERRCODE.SEV=%G_WRSYSLOG_SEV_GOOD_HARD#;

  10090   2 00086E  6C01                                 LDV,R6   1
          2 00086F  EAC7 0059                            SRM,R6,'0007'X    FPT_WRSYSLOG+7,AUTO
          2 000871       0007

     1071    10091    3              FPT_WRSYSLOG.V.VALUES(0)=KZ@LINCTX.CHAN;

  10091   2 000872  D842 0033                            LDR,R5   51,B2
          2 000874  DF47 0062                            STR,R5   FPT_WRSYSLOG+16,AUTO

PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:155  
     1072    10092    3              FPT_WRSYSLOG.V.VALUES(1)=KZ@LINCTX.RTRCNT;

  10092   2 000876  C842 0039                            LDR,R4   57,B2
          2 000878  CF47 0063                            STR,R4   FPT_WRSYSLOG+17,AUTO

     1073    10093    3              FPT_WRSYSLOG.V.VALUES(2)=0;

  10093   2 00087A  8747 0064                            CL       FPT_WRSYSLOG+18,AUTO

     1074    10094    3              FPT_WRSYSLOG.V.VALUES(3)=0;

  10094   2 00087C  8747 0065                            CL       FPT_WRSYSLOG+19,AUTO

     1075    10095    3              FPT_WRSYSLOG.BUF_=VECTOR(KZ@LINCTX.HIST);

  10095   2 00087E  DBC2 0013                            LAB,B5   19,B2
          2 000880  DFC7 0069                            STB,B5   FPT_WRSYSLOG+23,AUTO
          2 000882  3C21                                 LDV,R3   33
          2 000883  BF47 0068                            STR,R3   FPT_WRSYSLOG+22,AUTO
          2 000885  ABC7 0068                            LAB,B2   FPT_WRSYSLOG+22,AUTO
          2 000887  2C00                                 LDV,R2   0
          2 000888  6C06                                 LDV,R6   6
          2 000889  BBC7 0055                            LAB,B3   FPT_WRSYSLOG+3,AUTO
          2 00088B  3C00                                 LDV,R3   0
          2 00088C  0008                                 MMM
          2 00088D  0F81 002C                            B        s:10114,PREL

     1076    10096
     1077    10097    3            CASE(%E$UNKNADR, %E$UNKNSTA, %E$ETXGONE);

     1078    10098    3              FPT_WRSYSLOG.V.VALUES(0)=KZ@LINCTX.CHAN;

  10098   2 00088F  E842 0033                            LDR,R6   51,B2
          2 000891  EF47 0062                            STR,R6   FPT_WRSYSLOG+16,AUTO

     1079    10099    3              FPT_WRSYSLOG.V.VALUES(1)=KZ@LINCTX.RTRCNT;

PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:156  
  10099   2 000893  D842 0039                            LDR,R5   57,B2
          2 000895  DF47 0063                            STR,R5   FPT_WRSYSLOG+17,AUTO

     1080    10100    3              FPT_WRSYSLOG.V.VALUES(2)=INDX;

  10100   2 000897  DCC7 0050                            LDB,B5   @INDX,AUTO
          2 000899  C805                                 LDR,R4   ,B5
          2 00089A  CF47 0064                            STR,R4   FPT_WRSYSLOG+18,AUTO

     1081    10101    3              FPT_WRSYSLOG.V.VALUES(3)=0;

  10101   2 00089C  8747 0065                            CL       FPT_WRSYSLOG+19,AUTO

     1082    10102    3              VBASE(FPT_WRSYSLOG.BUF_)=KZ@LINCTX.INPBFR$;

  10102   2 00089E  CCC2 0056                            LDB,B4   86,B2
          2 0008A0  CFC7 0056                            STB,B4   FPT_WRSYSLOG+4,AUTO

     1083    10103    3              VBOUND(FPT_WRSYSLOG.BUF_)=KZ@BSCFPT.SIZ;

  10103   2 0008A2  BCC7 0006                            LDB,B3   @KZ@BSCFPT,AUTO
          2 0008A4  B843 0003                            LDR,R3   3,B3
          2 0008A6  BF47 0055                            STR,R3   FPT_WRSYSLOG+3,AUTO
          2 0008A8  0F81 0011                            B        s:10114,PREL

     1084    10104
     1085    10105    3            CASE(%E$NO_MEMORY);

     1086    10106    3              FPT_WRSYSLOG.V.ERRCODE.SEV=%G_WRSYSLOG_SEV_LINE_ABORT#;

  10106   2 0008AA  6C06                                 LDV,R6   6
          2 0008AB  EAC7 0059                            SRM,R6,'0007'X    FPT_WRSYSLOG+7,AUTO
          2 0008AD       0007

     1087    10107    3              FPT_WRSYSLOG.V.VALUES(0)=KZ@LINCTX.CHAN;

  10107   2 0008AE  D842 0033                            LDR,R5   51,B2
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:157  
          2 0008B0  DF47 0062                            STR,R5   FPT_WRSYSLOG+16,AUTO

     1088    10108    3              FPT_WRSYSLOG.V.VALUES(1)=0;

  10108   2 0008B2  8747 0063                            CL       FPT_WRSYSLOG+17,AUTO

     1089    10109    3              FPT_WRSYSLOG.V.VALUES(2)=0;

  10109   2 0008B4  8747 0064                            CL       FPT_WRSYSLOG+18,AUTO

     1090    10110    3              FPT_WRSYSLOG.V.VALUES(3)=1024;

  10110   2 0008B6  C870 0400                            LDR,R4   1024,IMO
          2 0008B8  CF47 0065                            STR,R4   FPT_WRSYSLOG+19,AUTO

     1091    10111
     1092    10112    3            END;

     1093    10113
     1094    10114    2           CALL KHA$ERRLOG(FPT_WRSYSLOG);

  10114   2 0008BA  DBC7 0052                            LAB,B5   FPT_WRSYSLOG,AUTO
          2 0008BC  DFC7 0068                            STB,B5   FPT_WRSYSLOG+22,AUTO
          2 0008BE  BBC7 0068                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 0008C0  CBF0 0100                            LAB,B4   256,IMO
          2 0008C2  E380 0000 0000  xent                 LNJ,B6   KHA$ERRLOG
          2 0008C5       0001                            DC       s:10115,PREL

     1095    10115    2           RETURN;

  10115   2 0008C6  ECC7 004C                            LDB,B6   P7814+7,AUTO
          2 0008C8  C3C6 0001                            LNJ,B4   1,B6

     1096    10116    2   END ERRLOG;
     1097    10117
     1098    10118        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:158  
     1099    10119    1   ISOLATE_GPOLL_STOPPER:PROC ALTRET;

  10119   2 0008CA  EFC7 0038            ISOLATE_GPOLL_S*STB,B6   INPUT+4,AUTO

     1100    10120        /* Either someone anwswered a poll all with a non-null message,
     1101    10121           or a controller timed out. In either case, pluck out the
     1102    10122           controllers address from the MLCP's lct byte, and
     1103    10123           set the current controller in the line context. Also
     1104    10124           note the point where polling is to continue */
     1105    10125    2   DCL POLLX SBIN;
     1106    10126    2   DCL OLD_POLLX SBIN;
     1107    10127    2   DCL OLD_INDX SBIN;
     1108    10128    2   DCL BP$(0:1) PTR BASED;
     1109    10129    2   DCL POLL_ADR_LIST CHAR(POLSIZ) BASED(KZ@LINCTX.POLLST$);
     1110    10130    2   DCL POLSIZ UBIN BYTE;
     1111    10131    2   DCL POLLADDR CHAR(1);
     1112    10132    2   DCL INDX SBIN;
     1113    10133    2   DCL POLX SBIN;
     1114    10134    2   DCL CTR$ PTR;
     1115    10135        %KZ$POLLHIP(STCLASS="BASED(KZ@LINCTX.POLLTBL$)");
     1116    10145
     1117    10146    2           CALL SET_TNOW;

  10146   2 0008CC  E3C0 026A                            LNJ,B6   s:0,PREL
          2 0008CE       0001                            DC       s:10147,PREL

     1118    10147    2           KZ@LINCTX.TIMR.GENPOL=TNOW;

  10147   2 0008CF  8CC7 0029                            LDI      TNOW,AUTO
          2 0008D1  ECC7 0004                            LDB,B6   @KZ@LINCTX,AUTO
          2 0008D3  8D46 0077                            SDI      119,B6

     1119    10148
     1120    10149    2           POLSIZ=KZ@LINCTX.POLSIZ /* MOVE TO UBIN BYTE VARIABLE */;

  10149   2 0008D5  D846 0065                            LDR,R5   101,B6
          2 0008D7  D7C7 003D                            STH,R5   POLSIZ,AUTO
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:159  

     1121    10150    2           KH_INPLCT.LCTBYT.ADR=60;

  10150   2 0008D9  4C3C                                 LDV,R4   60
          2 0008DA  CA80 0000 0003  01                   SRM,R4,'00FF'X    KH_INPLCT+1
          2 0008DD       00FF

     1122    10151    2           CALL KHI$IO_INPLCTBYT(KZ@LINCTX.CHN$->KH$CHN,KH_INPLCT);

  10151   2 0008DE  DCC6 0002                            LDB,B5   2,B6
          2 0008E0  CB80 0000 0002  01                   LAB,B4   KH_INPLCT
          2 0008E3  CFC7 006A                            STB,B4   FPT_WRSYSLOG+24,AUTO
          2 0008E5  DFC7 0068                            STB,B5   FPT_WRSYSLOG+22,AUTO
          2 0008E7  BBC7 0068                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 0008E9  CBF0 0200                            LAB,B4   512,IMO
          2 0008EB  E380 0000 0000  xent                 LNJ,B6   KHI$IO_INPLCTBYT
          2 0008EE       0001                            DC       s:10153,PREL

     1123    10152
     1124    10153    2           POLLADDR=BINASC(KH_INPLCT.LCTBYT.DAT);

  10153   2 0008EF  E080 0000 0003  01                   LDH,R6   KH_INPLCT+1
          2 0008F2  E7C7 003E                            STH,R6   POLLADDR,AUTO

     1125    10154    2           CALL INDEX(POLLX,POLLADDR,POLL_ADR_LIST)

  10154   2 0008F4  ECC7 0004                            LDB,B6   @KZ@LINCTX,AUTO
          2 0008F6  DCC6 0066                            LDB,B5   102,B6
          2 0008F8  E2C7 003D                            LLH,R6   POLSIZ,AUTO
          2 0008FA  EA70 0100                            ADD,R6   256,IMO
          2 0008FC  0028                                 SRH      ;
          2 0008FD       4107 003E                                ALPHANUM(POLLADDR,AUTO,,1),;
          2 0008FF       4407 0068                                BINARY(FPT_WRSYSLOG+22,AUTO,,4),;
          2 000901       4005 0000                                ALPHANUM(0,B5,,R6)
          2 000903  5381 0007                            CBE      s:10154+23,PREL
          2 000905  D2C7 003D                            LLH,R5   POLSIZ,AUTO
          2 000907  DF47 003A                            STR,R5   POLLX,AUTO
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:160  
          2 000909  0F81 0071                            B        s:10182,PREL
          2 00090B  D847 0069                            LDR,R5   FPT_WRSYSLOG+23,AUTO
          2 00090D  DF47 003A                            STR,R5   POLLX,AUTO

     1126    10155    2             ALTRET(MLCP_GOOFED_ON_POLL_ADR_INDX);
     1127    10156
     1128    10157    2           KZ@LINCTX.POLX=POLLX;

  10157   2 00090F  DAC6 006C                            SRM,R5,'00FF'X    108,B6
  10157   2 000911       00FF

     1129    10158
     1130    10159    2           IF KZ@LINCTX.ACTCTR=0 THEN

  10159   2 000912  C2C6 006D                            LLH,R4   109,B6
          2 000914  4901 0066                            BEZ,R4   s:10182,PREL

     1131    10160    2              GOTO MLCP_GOOFED_ON_POLL_ADR_INDX /* RUNTIME BUG */;
     1132    10161    2           CALL INDEX(INDX,POLLADDR,

  10161   2 000916  DCC6 0083                            LDB,B5   131,B6
          2 000918  E854                                 LDR,R6   R4
          2 000919  EA70 0100                            ADD,R6   256,IMO
          2 00091B  0028                                 SRH      ;
          2 00091C       4107 003E                                ALPHANUM(POLLADDR,AUTO,,1),;
          2 00091E       4407 0068                                BINARY(FPT_WRSYSLOG+22,AUTO,,4),;
          2 000920       4005 0001                                ALPHANUM(1,B5,,R6)
          2 000922  5381 0005                            CBE      s:10161+18,PREL
          2 000924  CF47 003F                            STR,R4   INDX,AUTO
          2 000926  0F81 0054                            B        s:10182,PREL
          2 000928  B847 0069                            LDR,R3   FPT_WRSYSLOG+23,AUTO
          2 00092A  BF47 003F                            STR,R3   INDX,AUTO

     1133    10162    2             SUBSTR(KZ$POLLHIP.POLL_LIST_C,0,KZ@LINCTX.ACTCTR))
     1134    10163    2             ALTRET(MLCP_GOOFED_ON_POLL_ADR_INDX);
     1135    10164
     1136    10165    2           OLD_INDX=KZ$POLLHIP.POLLX;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:161  

  10165   2 00092C  A805                                 LDR,R2   ,B5
          2 00092D  A570 003F                            AND,R2   63,IMO
          2 00092F  AF47 003C                            STR,R2   OLD_INDX,AUTO

     1137    10166    2           KZ$POLLHIP.POLLX=KZ@LINCTX.POLX+1;

  10166   2 000931  9846 006C                            LDR,R1   108,B6
          2 000933  9570 00FF                            AND,R1   255,IMO
          2 000935  1E01                                 ADV,R1   1
          2 000936  9A85                                 SRM,R1,'003F'X    ,B5
          2 000937       003F

     1138    10167    2           KZ@LINCTX.POLADR.CTR=ASCBIN(POLLADDR);

  10167   2 000938  92C7 003E                            LLH,R1   POLLADDR,AUTO
          2 00093A  97C6 0064                            STH,R1   100,B6

     1139    10168    2           KZ$POLLHIP.INDX=INDX+1;

  10168   2 00093C  DCC6 0083                            LDB,B5   131,B6
          2 00093E  3E01                                 ADV,R3   1
          2 00093F  B785                                 STH,R3   ,B5

     1140    10169    2           KZ$POLLHIP.CONTINUE_POLL=

  10169   2 000940  DCC6 0083                            LDB,B5   131,B6
          2 000942  D870 8000                            LDR,R5   -32768,IMO
          2 000944  E285                                 LLH,R6   ,B5
          2 000945  C2C6 006D                            LLH,R4   109,B6
          2 000947  E954                                 CMR,R6   R4
          2 000948  0801 0002                            BAL      s:10169+11,PREL
          2 00094A  5C00                                 LDV,R5   0
          2 00094B  5048                                 SOR,R5   8
          2 00094C  DA85                                 SRM,R5,'0080'X    ,B5
          2 00094D       0080

PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:162  
     1141    10170    2             KZ$POLLHIP.INDX<KZ@LINCTX.ACTCTR;
     1142    10171
     1143    10172        /* RESET ANY 'TIMED_OUT_ONCE' BITS ON CONTROLLERS THAT ANSWERED */
     1144    10173
     1145    10174    3           DO INDX=KZ@LINCTX.POLX-1 DOWNTO OLD_INDX;

  10174   2 00094E  E846 006C                            LDR,R6   108,B6
          2 000950  E570 00FF                            AND,R6   255,IMO
          2 000952  6EFF                                 ADV,R6   -1
          2 000953  EF47 003F                            STR,R6   INDX,AUTO
          2 000955  0F81 0013                            B        s:10178+2,PREL

     1146    10175    3              CTR$=KZ@LINCTX.CTRLST$->BP$(INDX);

  10175   2 000957  ECC7 0004                            LDB,B6   @KZ@LINCTX,AUTO
          2 000959  DCC6 0068                            LDB,B5   104,B6
          2 00095B  B847 003F                            LDR,R3   INDX,AUTO
          2 00095D  CCB5                                 LDB,B4   ,B5,R3
          2 00095E  CFC7 0041                            STB,B4   CTR$,AUTO

     1147    10176    3              IF CTR$~=ADDR(NIL) THEN

  10176   2 000960  8DC7 0041                            CMN      CTR$,AUTO
          2 000962  0901 0004                            BE       s:10178,PREL

     1148    10177    3                 CTR$->KZ$HIPCTR.TIMED_OUT_ONCE='0'B;

  10177   2 000964  8844 000A                            LBF,'0080'X       10,B4
  10177   2 000966       0080

     1149    10178    3              END;

  10178   2 000967  88C7 003F                            DEC      INDX,AUTO
          2 000969  E847 003F                            LDR,R6   INDX,AUTO
          2 00096B  E947 003C                            CMR,R6   OLD_INDX,AUTO
          2 00096D  08EA                                 BAGE     s:10175,SPREL

PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:163  
     1150    10179
     1151    10180        /* SET CURRENT CONTROLLER AS THE ONE THAT ANSWERED */
     1152    10181
     1153    10182    2           KZ@LINCTX.CURCTR$=KZ@LINCTX.CTRLST$->BP$(KZ@LINCTX.POLX);

  10182   2 00096E  DCC6 0068                            LDB,B5   104,B6
          2 000970  B846 006C                            LDR,R3   108,B6
          2 000972  B570 00FF                            AND,R3   255,IMO
          2 000974  CCB5                                 LDB,B4   ,B5,R3
          2 000975  CFC6 004E                            STB,B4   78,B6

     1154    10183    2           RETURN;

  10183   2 000977  ECC7 0038                            LDB,B6   INPUT+4,AUTO
          2 000979  C3C6 0001                            LNJ,B4   1,B6

  10182   2                              MLCP_GOOFED_ON_*null
     1155    10184    2   MLCP_GOOFED_ON_POLL_ADR_INDX:;
     1156    10185    2           KZ$POLLHIP.CONTINUE_POLL='0'B;

  10185   2 00097B  ECC7 0004            MLCP_GOOFED_ON_*LDB,B6   @KZ@LINCTX,AUTO
          2 00097D  DCC6 0083                            LDB,B5   131,B6
          2 00097F  8805                                 LBF,'0080'X       ,B5
          2 000980       0080

     1157    10186    2   END ISOLATE_GPOLL_STOPPER;

  10186   2 000981  ECC7 0038                            LDB,B6   INPUT+4,AUTO
          2 000983  C3C6 0001                            LNJ,B4   1,B6

     1158    10187        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:164  
     1159    10188
     1160    10189    1   CONTINUE_POLLING:PROC ALTRET;

  10189   2 000985  EFC7 0038            CONTINUE_POLLINGSTB,B6   INPUT+4,AUTO

     1161    10190
     1162    10191        /* An MLCP controlled poll all was interrupted.
     1163    10192           Issue call to KZT_ORDERS to finish polling if there
     1164    10193            are any controllers left to poll. ALTRET if all
     1165    10194            controllers have been polled. */
     1166    10195
     1167    10196        %KZ$POLLHIP(STCLASS="BASED(KZ@LINCTX.POLLTBL$)");
     1168    10206    2           IF NOT KZ@LINCTX.POLLTBL$->KZ$POLLHIP.CONTINUE_POLL THEN

  10206   2 000987  DCC7 0004                            LDB,B5   @KZ@LINCTX,AUTO
          2 000989  CCC5 0083                            LDB,B4   131,B5
          2 00098B  8284                                 LB,'0080'X        ,B4
          2 00098C       0080
          2 00098D  0501 000A                            BBT      s:10219,PREL

     1169    10207    3           DO;

     1170    10208    3              KZ@LINCTX.OTPBFR$=ADDR(NIL);

  10208   2 00098F  BB80 0000 0000                       LAB,B3   0
          2 000992  BFC5 005A                            STB,B3   90,B5

     1171    10209    3              ALTRETURN;

  10209   2 000994  ECC7 0038                            LDB,B6   INPUT+4,AUTO
          2 000996  B806                                 LDR,R3   ,B6
          2 000997  C3B6                                 LNJ,B4   ,B6,R3

     1172    10210    3              END;
     1173    10211
     1174    10212        /* Note: The buffer pointer OTPBFR$ cannot point at a
     1175    10213                 byte boundry, so the poll list may be backed
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:165  
     1176    10214                 up 1 byte. This backing up means the controller
     1177    10215                 that answers a poll with a non-null message and
     1178    10216                 is on an even byte in KZ$POLLHIP will get polled
     1179    10217                 a second time as the general poll continues.
     1180    10218        */
     1181    10219    2           KZ@LINCTX.POLADR.CTR =

  10219   2 000998  B284                                 LLH,R3   ,B4
          2 000999  3E02                                 ADV,R3   2
          2 00099A  E2B4                                 LLH,R6   ,B4,R3
          2 00099B  E7C5 0064                            STH,R6   100,B5

     1182    10220    2             KZ$POLLHIP.POLL_LIST(KZ$POLLHIP.INDX);
     1183    10221    2           KZ@LINCTX.OTPDATSIZ = 1;

  10221   2 00099D  6C01                                 LDV,R6   1
          2 00099E  EF45 005D                            STR,R6   93,B5

     1184    10222    2           KZ@LINCTX.OTPBFR$=ADDR(KZ@LINCTX.POLADR.CTR);

  10222   2 0009A0  BBC5 0064                            LAB,B3   100,B5
          2 0009A2  BFC5 005A                            STB,B3   90,B5

     1185    10223    2           CALL KZT_ORDERS@(%KZ#SEND_GEPOLL,KZ@LINCTX);

  10223   2 0009A4  ABF0 000E                            LAB,B2   14,IMO
          2 0009A6  DFC7 006A                            STB,B5   FPT_WRSYSLOG+24,AUTO
          2 0009A8  AFC7 0068                            STB,B2   FPT_WRSYSLOG+22,AUTO
          2 0009AA  BBC7 0068                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 0009AC  9C80 0000 0000  xsym                 LDB,B1   KZT_ORDERS@
          2 0009AF  CBF0 0200                            LAB,B4   512,IMO
          2 0009B1  E381                                 LNJ,B6   ,B1
          2 0009B2       0001                            DC       s:10224,PREL

     1186    10224    2           RETURN;

  10224   2 0009B3  ECC7 0038                            LDB,B6   INPUT+4,AUTO
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:166  
          2 0009B5  C3C6 0001                            LNJ,B4   1,B6

     1187    10225    2   END CONTINUE_POLLING;
     1188    10226        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:167  
     1189    10227    1   SEND_NAK:PROC ALTRET;

  10227   2 0009B7  EFC7 0038            SEND_NAK        STB,B6   INPUT+4,AUTO

     1190    10228        /* A recoverable line error was detected
     1191    10229           Send a NAK to force retransmission if the retry count
     1192    10230           has not been exceeded.
     1193    10231
     1194    10232           Altret if the retry count has been exceeded.
     1195    10233        */
     1196    10234    2   DCL SELADR CHAR(1);
     1197    10235    2   DCL POLADR CHAR(1);
     1198    10236
     1199    10237        /* Unfortunately, the code for sending a NAK via an order to the
     1200    10238           MLCP does not work.
     1201    10239
     1202    10240           Therefore, a NAK message is built up in the input buffer.
     1203    10241        */
     1204    10242
     1205    10243    2   DCL NAKMSG CHAR(14) BASED( KZ@LINCTX.OTPBFR$);
     1206    10244
     1207    10245
     1208    10246    2           KZ@LINCTX.RTRCNT=KZ@LINCTX.RTRCNT+1;

  10246   2 0009B9  DCC7 0004                            LDB,B5   @KZ@LINCTX,AUTO
          2 0009BB  8AC5 0039                            INC      57,B5

     1209    10247
     1210    10248    2           IF KZ@LINCTX.PRO.RETRYS >0 AND

  10248   2 0009BD  E845 003D                            LDR,R6   61,B5
          2 0009BF  6901 0017                            BEZ,R6   s:10255,PREL
          2 0009C1  E945 0039                            CMR,R6   57,B5
          2 0009C3  0281 0013                            BGE      s:10255,PREL

     1211    10249    2             KZ@LINCTX.RTRCNT > KZ@LINCTX.PRO.RETRYS THEN
     1212    10250    3           DO;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:168  

     1213    10251    3              CALL KZ@LINCTX.DEVMGR@(KZ@LINCTX,%KZ#LINFCN_POLTIMOUT);

  10251   2 0009C5  EBF0 0005                            LAB,B6   5,IMO
          2 0009C7  EFC7 006A                            STB,B6   FPT_WRSYSLOG+24,AUTO
          2 0009C9  DFC7 0068                            STB,B5   FPT_WRSYSLOG+22,AUTO
          2 0009CB  BBC7 0068                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 0009CD  9CC5 006E                            LDB,B1   110,B5
          2 0009CF  CBF0 0200                            LAB,B4   512,IMO
          2 0009D1  E381                                 LNJ,B6   ,B1
          2 0009D2       0001                            DC       s:10252,PREL

     1214    10252    3              ALTRETURN;

  10252   2 0009D3  ECC7 0038                            LDB,B6   INPUT+4,AUTO
          2 0009D5  B806                                 LDR,R3   ,B6
          2 0009D6  C3B6                                 LNJ,B4   ,B6,R3

     1215    10253    3              END;
     1216    10254
     1217    10255    2           SELADR=BINASC(KZ@LINCTX.CURCTR$->KZ$HIPCTR.ADR+64);

  10255   2 0009D7  ECC5 004E                            LDB,B6   78,B5
          2 0009D9  D2C6 000A                            LLH,R5   10,B6
          2 0009DB  5E40                                 ADV,R5   64
          2 0009DC  5008                                 SOL,R5   8
          2 0009DD  5068                                 SAR,R5   8
          2 0009DE  D7C7 003A                            STH,R5   SELADR,AUTO

     1218    10256    2           POLADR=BINASC(KZ@LINCTX.CURCTR$->KZ$HIPCTR.ADR+32);

  10256   2 0009E0  C2C6 000A                            LLH,R4   10,B6
          2 0009E2  4E20                                 ADV,R4   32
          2 0009E3  4008                                 SOL,R4   8
          2 0009E4  4068                                 SAR,R4   8
          2 0009E5  C7C7 003B                            STH,R4   POLADR,AUTO

PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:169  
     1219    10257    2           KZ@LINCTX.OTPBFR$=KZ@LINCTX.INPBFR$;

  10257   2 0009E7  CCC5 0056                            LDB,B4   86,B5
          2 0009E9  CFC5 005A                            STB,B4   90,B5

     1220    10258    2           KZ@LINCTX.OTPDATSIZ=LENGTHC(NAKMSG);

  10258   2 0009EB  3C0E                                 LDV,R3   14
          2 0009EC  BF45 005D                            STR,R3   93,B5

     1221    10259    2           CALL CONCAT(NAKMSG,SELADR,

  10259   2 0009EE  D784                                 STH,R5   ,B4
          2 0009EF  AB80 0000 0059  00                   LAB,B2   FPT@WRSYSLOG+21
          2 0009F2  2C00                                 LDV,R2   0
          2 0009F3  6C09                                 LDV,R6   9
          2 0009F4  BB84                                 LAB,B3   ,B4
          2 0009F5  3C01                                 LDV,R3   1
          2 0009F6  0008                                 MMM
          2 0009F7  E0C7 003B                            LDH,R6   POLADR,AUTO
          2 0009F9  E7C4 0005                            STH,R6   5,B4
          2 0009FB  AB80 0000 005E  00                   LAB,B2   FPT@WRSYSLOG+26
          2 0009FE  2C00                                 LDV,R2   0
          2 0009FF  6C03                                 LDV,R6   3
          2 000A00  BB84                                 LAB,B3   ,B4
          2 000A01  3C0B                                 LDV,R3   11
          2 000A02  0008                                 MMM

     1222    10260                  %CONCAT(BITASC('80'X),BITASC('02'X),BITASC('83'X),BITASC('E0'X),
     1223    10261    2             BITASC('15'X),'  ',BITASC('02'X),BITASC('83'X)),
     1224    10262    2             POLADR,
     1225    10263    2             %CONCAT(BITASC('80'X),BITASC('02'X),BITASC('83'X)));
     1226    10264
     1227    10265    2           CALL KZT_ORDERS@(%KZ#SEND_BLOCK,KZ@LINCTX);

  10265   2 000A03  EBF0 0001                            LAB,B6   1,IMO
          2 000A05  DCC7 0004                            LDB,B5   @KZ@LINCTX,AUTO
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:170  
          2 000A07  DFC7 006A                            STB,B5   FPT_WRSYSLOG+24,AUTO
          2 000A09  EFC7 0068                            STB,B6   FPT_WRSYSLOG+22,AUTO
          2 000A0B  BBC7 0068                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 000A0D  9C80 0000 0000  xsym                 LDB,B1   KZT_ORDERS@
          2 000A10  CBF0 0200                            LAB,B4   512,IMO
          2 000A12  E381                                 LNJ,B6   ,B1
          2 000A13       0001                            DC       s:10267,PREL

     1228    10266
     1229    10267    2   END SEND_NAK;

  10267   2 000A14  ECC7 0038                            LDB,B6   INPUT+4,AUTO
          2 000A16  C3C6 0001                            LNJ,B4   1,B6

     1230    10268        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:171  
     1231    10269    1   SEND_MSG:PROC(MSG,MSGS,MSGL);

  10269   2 000A18  EFC7 003A            SEND_MSG        STB,B6   SELADR,AUTO

     1232    10270
     1233    10271    2   DCL MSG CHAR(MSGL);
     1234    10272    2   DCL MSGS SBIN;
     1235    10273    2   DCL MSGL SBIN;
     1236    10274
     1237    10275        /* SUBSTR(MSG,MSGS,MSGL) defines a message that must be sent to the current control
             10275        ler.
     1238    10276           Build up the message in the input buffer and send it out, similar to SEND_NAK */
     1239    10277
     1240    10278    2   DCL 1 OBUF BASED(KZ@LINCTX.OTPBFR$),
     1241    10279    2         2 HEAD,
     1242    10280    2           3 SELADR CHAR(1),
     1243    10281    2           3 F1 CHAR(8),
     1244    10282    2         2 MSG CHAR(100),
     1245    10283    2         2 TRAIL,
     1246    10284    2           3 F1 CHAR(1),
     1247    10285    2           3 POLADR CHAR(1),
     1248    10286    2           3 F2 CHAR(3);
     1249    10287
     1250    10288    2   DCL 1 LCLTRAIL,
     1251    10289    2         2 ALLOFIT CHAR(5),
     1252    10290    2         2 TRAIL REDEF ALLOFIT,
     1253    10291    2           3 F1 CHAR(1),
     1254    10292    2           3 POLADR CHAR(1),
     1255    10293    2           3 F2 CHAR(3);
     1256    10294
     1257    10295    2           LCLTRAIL.TRAIL.F1=%BINASC(3);

  10295   2 000A1A  6C03                                 LDV,R6   3
          2 000A1B  E7C7 0042                            STH,R6   LCLTRAIL,AUTO

     1258    10296    2           LCLTRAIL.TRAIL.POLADR=BINASC(KZ@LINCTX.CURCTR$->KZ$HIPDEV.ADR+32);

PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:172  
  10296   2 000A1D  DCC7 0004                            LDB,B5   @KZ@LINCTX,AUTO
          2 000A1F  CCC5 004E                            LDB,B4   78,B5
          2 000A21  D2C4 0015                            LLH,R5   21,B4
          2 000A23  5E20                                 ADV,R5   32
          2 000A24  5008                                 SOL,R5   8
          2 000A25  5068                                 SAR,R5   8
          2 000A26  DAC7 0042                            SRM,R5,'00FF'X    LCLTRAIL,AUTO
          2 000A28       00FF

     1259    10297    2           LCLTRAIL.TRAIL.F2=%CONCAT(BITASC('80'X),BITASC('02'X),BITASC('83'X));

  10297   2 000A29  AB80 0000 005E  00                   LAB,B2   FPT@WRSYSLOG+26
          2 000A2C  2C00                                 LDV,R2   0
          2 000A2D  BBC7 0043                            LAB,B3   T$,AUTO
          2 000A2F  3C00                                 LDV,R3   0
          2 000A30  0008                                 MMM

     1260    10298    2           KZ@LINCTX.OTPBFR$=KZ@LINCTX.INPBFR$;

  10298   2 000A31  ECC5 0056                            LDB,B6   86,B5
          2 000A33  EFC5 005A                            STB,B6   90,B5

     1261    10299    2           OBUF.HEAD.SELADR=BINASC(KZ@LINCTX.CURCTR$->KZ$HIPCTR.ADR+64);

  10299   2 000A35  CCC5 004E                            LDB,B4   78,B5
          2 000A37  E2C4 000A                            LLH,R6   10,B4
          2 000A39  6E40                                 ADV,R6   64
          2 000A3A  6008                                 SOL,R6   8
          2 000A3B  6068                                 SAR,R6   8
          2 000A3C  E786                                 STH,R6   ,B6

     1262    10300    2           KZ@LINCTX.OTPDATSIZ=LENGTHC(OBUF)+MSGL+-LENGTHC(OBUF.MSG);

  10300   2 000A3D  ECC7 0040                            LDB,B6   @MSGL,AUTO
          2 000A3F  E806                                 LDR,R6   ,B6
          2 000A40  6E0E                                 ADV,R6   14
          2 000A41  EF45 005D                            STR,R6   93,B5
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:173  

     1263    10301    2           OBUF.HEAD.F1=

  10301   2 000A43  CCC5 005A                            LDB,B4   90,B5
          2 000A45  AB80 0000 0060  00                   LAB,B2   FPT@WRSYSLOG+28
          2 000A48  2C00                                 LDV,R2   0
          2 000A49  6C08                                 LDV,R6   8
          2 000A4A  BB84                                 LAB,B3   ,B4
          2 000A4B  3C01                                 LDV,R3   1
          2 000A4C  0008                                 MMM

     1264    10302                  %CONCAT(BITASC('80'X),BITASC('02'X),BITASC('83'X),BITASC('E0'X),
     1265    10303    2             BITASC('80'X),'  ',BITASC('02'X));
     1266    10304    2           CALL INSERT(OBUF.MSG,0,MSGL,SUBSTR(MSG,MSGS,MSGL));

  10304   2 000A4D  ACC5 005A                            LDB,B2   90,B5
          2 000A4F  8CC7 003C                            LDI      @MSG,AUTO
          2 000A51  B856                                 LDR,R3   R6
          2 000A52  E570 7FFF                            AND,R6   32767,IMO
          2 000A54  8D47 0068                            SDI      FPT_WRSYSLOG+22,AUTO
          2 000A56  9CC7 0068                            LDB,B1   FPT_WRSYSLOG+22,AUTO
          2 000A58  304F                                 SOR,R3   15
          2 000A59  D806                                 LDR,R5   ,B6
          2 000A5A  ECC7 003E                            LDB,B6   @MSGS,AUTO
          2 000A5C  BA06                                 ADD,R3   ,B6
          2 000A5D  ECC7 0040                            LDB,B6   @MSGL,AUTO
          2 000A5F  D806                                 LDR,R5   ,B6
          2 000A60  AFC7 006A                            STB,B2   FPT_WRSYSLOG+24,AUTO
          2 000A62  AB81                                 LAB,B2   ,B1
          2 000A63  A853                                 LDR,R2   R3
          2 000A64  E855                                 LDR,R6   R5
          2 000A65  BCC7 006A                            LDB,B3   FPT_WRSYSLOG+24,AUTO
          2 000A67  3C09                                 LDV,R3   9
          2 000A68  0008                                 MMM

     1267    10305    2           CALL INSERT(OBUF.MSG,MSGL,LENGTHC(LCLTRAIL.ALLOFIT),LCLTRAIL.ALLOFIT);

PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:174  
  10305   2 000A69  ECC5 005A                            LDB,B6   90,B5
          2 000A6B  DCC7 0040                            LDB,B5   @MSGL,AUTO
          2 000A6D  E805                                 LDR,R6   ,B5
          2 000A6E  ABC7 0042                            LAB,B2   LCLTRAIL,AUTO
          2 000A70  2C00                                 LDV,R2   0
          2 000A71  EF47 0068                            STR,R6   FPT_WRSYSLOG+22,AUTO
          2 000A73  6C05                                 LDV,R6   5
          2 000A74  BB86                                 LAB,B3   ,B6
          2 000A75  B847 0068                            LDR,R3   FPT_WRSYSLOG+22,AUTO
          2 000A77  3E09                                 ADV,R3   9
          2 000A78  0008                                 MMM

     1268    10306    2           CALL KZT_ORDERS@(%KZ#SEND_BLOCK,KZ@LINCTX);

  10306   2 000A79  EBF0 0001                            LAB,B6   1,IMO
          2 000A7B  BCC7 0004                            LDB,B3   @KZ@LINCTX,AUTO
          2 000A7D  BFC7 006A                            STB,B3   FPT_WRSYSLOG+24,AUTO
          2 000A7F  EFC7 0068                            STB,B6   FPT_WRSYSLOG+22,AUTO
          2 000A81  BBC7 0068                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 000A83  9C80 0000 0000  xsym                 LDB,B1   KZT_ORDERS@
          2 000A86  CBF0 0200                            LAB,B4   512,IMO
          2 000A88  E381                                 LNJ,B6   ,B1
          2 000A89       0001                            DC       s:10307,PREL

     1269    10307    2   END SEND_MSG;

  10307   2 000A8A  ECC7 003A                            LDB,B6   SELADR,AUTO
          2 000A8C  C3C6 0001                            LNJ,B4   1,B6

     1270    10308        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:175  
     1271    10309    1   SHIP_POSSIBLE_INPUT:PROC ALTRET;

  10309   2 000A8E  EFC7 0038            SHIP_POSSIBLE_I*STB,B6   INPUT+4,AUTO

     1272    10310
     1273    10311        /* POSSIBLE INPUT IS PRESENT IN THE 'INPUT' STRUCTURE.
     1274    10312
     1275    10313        The code at SNDRSP,POSANS,NUTERM has looked at stuff
     1276    10314         and determined that any input should not be ignored.
     1277    10315
     1278    10316        Call the device manager saying input is present.
     1279    10317
     1280    10318            Someone may have moved the 'com line' switch to the off position.
     1281    10319            if so, then halt current output. Resume with any input.
     1282    10320        */
     1283    10321
     1284    10322    2   DCL DEV$ PTR;
     1285    10323    2   DCL SAVCURDEV$ PTR;
     1286    10324
     1287    10325    2           IF INPUT.PRESENT OR ACKS(0) THEN

  10325   2 000A90  89C7 0036                            CMZ      INPUT+2,AUTO
          2 000A92  0801 0005                            BAL      s:10326,PREL
          2 000A94  89C7 002D                            CMZ      ACKS,AUTO
          2 000A96  0881 009C                            BAGE     s:10371,PREL

     1288    10326    3   SET_NEW_CURDEV: DO;

  10326   2                              SET_NEW_CURDEV  null
     1289    10327    3              CALL SETDEV(0,DEV$);

  10327   2 000A98  DBF0 0000            SET_NEW_CURDEV  LAB,B5   0,IMO
          2 000A9A  CBC7 003A                            LAB,B4   DEV$,AUTO
          2 000A9C  CFC7 0042                            STB,B4   LCLTRAIL,AUTO
          2 000A9E  DFC7 0040                            STB,B5   @MSGL,AUTO
          2 000AA0  E3C0 FD7C                            LNJ,B6   s:0,PREL
          2 000AA2       0001                            DC       s:10328,PREL
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:176  

     1290    10328    3              SAVCURDEV$=KZ@LINCTX.CURDEV$;

  10328   2 000AA3  ECC7 0004                            LDB,B6   @KZ@LINCTX,AUTO
          2 000AA5  DCC6 0050                            LDB,B5   80,B6
          2 000AA7  DFC7 003C                            STB,B5   SAVCURDEV$,AUTO

     1291    10329    3              KZ@LINCTX.CURDEV$=DEV$;

  10329   2 000AA9  CCC7 003A                            LDB,B4   DEV$,AUTO
          2 000AAB  CFC6 0050                            STB,B4   80,B6

     1292    10330
     1293    10331    3              IF ACKS(0) AND DEV$->KZ$HIPDEV.HLT.WACK THEN

  10331   2 000AAD  89C7 002D                            CMZ      ACKS,AUTO
          2 000AAF  0881 0018                            BAGE     s:10339,PREL
          2 000AB1  82C4 0012                            LB,'0080'X        18,B4
          2 000AB3       0080
          2 000AB4  0581 0013                            BBF      s:10339,PREL

     1294    10332    4              DO; /*  CLEAR HALT CONDITION. */

     1295    10333    4                 DEV$->KZ$HIPDEV.HLT.WACK='0'B;

  10333   2 000AB6  8844 0012                            LBF,'0080'X       18,B4
  10333   2 000AB8       0080

     1296    10334    4                 KZ$EVENT.EVENT=%KZ#LINFCN_REQOTP;

  10334   2 000AB9  6C02                                 LDV,R6   2
          2 000ABA  EF47 0008                            STR,R6   KZ$EVENT,AUTO

     1297    10335    4                 CALL KZ@LINCTX.DEVMGR@(KZ$EVENT);

  10335   2 000ABC  CBC7 0008                            LAB,B4   KZ$EVENT,AUTO
          2 000ABE  CFC7 0068                            STB,B4   FPT_WRSYSLOG+22,AUTO
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:177  
          2 000AC0  BBC7 0068                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 000AC2  9CC6 006E                            LDB,B1   110,B6
          2 000AC4  CBF0 0100                            LAB,B4   256,IMO
          2 000AC6  E381                                 LNJ,B6   ,B1
          2 000AC7       0001                            DC       s:10339,PREL

     1298    10336    4                 END;

     1299    10337
     1300    10338
     1301    10339    3              IF INPUT.PRESENT THEN

  10339   2 000AC8  89C7 0036                            CMZ      INPUT+2,AUTO
          2 000ACA  0881 0062                            BAGE     s:10368,PREL

     1302    10340    4              DO;

     1303    10341    4                 KZ$INPDESC.BYTX=INPUT.FIRST;

  10341   2 000ACC  E847 0034                            LDR,R6   INPUT,AUTO
          2 000ACE  EF47 0032                            STR,R6   KZ$INPDESC,AUTO

     1304    10342    4                 KZ$INPDESC.DATBYTSIZ=INPUT.ENDING_ETX-INPUT.FIRST;

  10342   2 000AD0  E247 0035                            SUB,R6   INPUT+1,AUTO
          2 000AD2  8256                                 NEG      R6
          2 000AD3  EF47 0033                            STR,R6   KZ$INPDESC+1,AUTO

     1305    10343
     1306    10344        /*  CHANGE THE ENDING BYTE IN BUFFER TO 'CR', FOR AUTOMATIC ACTIVATION
     1307    10345            IF TRANSPARENT READ.  */
     1308    10346    4                 CALL INSERT(KZ@LINCTX.INPBFR$->CHRS,INPUT.ENDING_ETX,1,%BINASC(13));

  10346   2 000AD5  ECC7 0004                            LDB,B6   @KZ@LINCTX,AUTO
          2 000AD7  DCC6 0056                            LDB,B5   86,B6
          2 000AD9  5C0D                                 LDV,R5   13
          2 000ADA  B847 0035                            LDR,R3   INPUT+1,AUTO
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:178  
          2 000ADC  D7B5                                 STH,R5   ,B5,R3

     1309    10347
     1310    10348    4                 KZ$EVENT.EVENT=%KZ#LINFCN_INP;

  10348   2 000ADD  6C04                                 LDV,R6   4
          2 000ADE  EF47 0008                            STR,R6   KZ$EVENT,AUTO

     1311    10349    4                 CALL KZ@LINCTX.DEVMGR@(KZ$EVENT,KZ$INPDESC);

  10349   2 000AE0  DBC7 0032                            LAB,B5   KZ$INPDESC,AUTO
          2 000AE2  DFC7 006A                            STB,B5   FPT_WRSYSLOG+24,AUTO
          2 000AE4  CBC7 0008                            LAB,B4   KZ$EVENT,AUTO
          2 000AE6  CFC7 0068                            STB,B4   FPT_WRSYSLOG+22,AUTO
          2 000AE8  BBC7 0068                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 000AEA  9CC6 006E                            LDB,B1   110,B6
          2 000AEC  CBF0 0200                            LAB,B4   512,IMO
          2 000AEE  E381                                 LNJ,B6   ,B1
          2 000AEF       0001                            DC       s:10353,PREL

     1312    10350
     1313    10351
     1314    10352        /* GET NEW BUFFER IF ITS GONE AWAY ! */
     1315    10353    4                 IF KZ@LINCTX.INPBFR$=ADDR(NIL) THEN

  10353   2 000AF0  ECC7 0004                            LDB,B6   @KZ@LINCTX,AUTO
          2 000AF2  8DC6 0056                            CMN      86,B6
          2 000AF4  0981 0038                            BNE      s:10368,PREL

     1316    10354    5   ACQUIRE_NEW_INPBFR: DO;

  10354   2                              ACQUIRE_NEW_INP*null
     1317    10355    5                    KZ@LINCTX.INPBFRSIZ=1024;

  10355   2 000AF6  E870 0400            ACQUIRE_NEW_INP*LDR,R6   1024,IMO
          2 000AF8  EF46 0058                            STR,R6   88,B6

PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:179  
     1318    10356    5                    CALL KVB$GETSYS(KZ@LINCTX.INPBFRSIZ, KZ@LINCTX.INPBFR$)

  10356   2 000AFA  DBC6 0056                            LAB,B5   86,B6
          2 000AFC  DFC7 006A                            STB,B5   FPT_WRSYSLOG+24,AUTO
          2 000AFE  CBC6 0058                            LAB,B4   88,B6
          2 000B00  CFC7 0068                            STB,B4   FPT_WRSYSLOG+22,AUTO
          2 000B02  BBC7 0068                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 000B04  CBF0 0200                            LAB,B4   512,IMO
          2 000B06  E380 0000 0000  xent                 LNJ,B6   KVB$GETSYS
          2 000B09       0003                            DC       s:10359,PREL
          2 000B0A  0F81 0022                            B        s:10368,PREL

     1319    10357    5                    WHENALTRETURN
     1320    10358    6                    DO;

     1321    10359    6                       CALL ERRLOG(%E$NO_MEMORY);

  10359   2 000B0C  EBF0 00D0                            LAB,B6   208,IMO
          2 000B0E  DB80 0000 0000                       LAB,B5   0
          2 000B11  DFC7 0050                            STB,B5   @INDX,AUTO
          2 000B13  EFC7 004E                            STB,B6   @ERROR,AUTO
          2 000B15  E3C0 FD2C                            LNJ,B6   s:0,PREL
          2 000B17       0001                            DC       s:10360,PREL

     1322    10360    6                       KZ@LINCTX.INPBFR$ = ADDR(NIL);

  10360   2 000B18  EB80 0000 0000                       LAB,B6   0
          2 000B1B  DCC7 0004                            LDB,B5   @KZ@LINCTX,AUTO
          2 000B1D  EFC5 0056                            STB,B6   86,B5

     1323    10361    6                       KZ@LINCTX.INPBFRSIZ = 0;

  10361   2 000B1F  8745 0058                            CL       88,B5

     1324    10362    6                       CALL KZH$DSC_LINE (KZ@LINCTX );

  10362   2 000B21  BBC7 0004                            LAB,B3   @KZ@LINCTX,AUTO
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:180  
          2 000B23  CBF0 0100                            LAB,B4   256,IMO
          2 000B25  E380 0000 0000  xent                 LNJ,B6   KZH$DSC_LINE
          2 000B28       0001                            DC       s:10363,PREL

     1325    10363    6                       RETURN;

  10363   2 000B29  ECC7 0038                            LDB,B6   INPUT+4,AUTO
          2 000B2B  C3C6 0001                            LNJ,B4   1,B6

     1326    10364    6                       END;
     1327    10365    5                    END ACQUIRE_NEW_INPBFR;

     1328    10366
     1329    10367    4                 END;

     1330    10368    3              KZ@LINCTX.CURDEV$=SAVCURDEV$;

  10368   2 000B2D  ECC7 003C                            LDB,B6   SAVCURDEV$,AUTO
          2 000B2F  DCC7 0004                            LDB,B5   @KZ@LINCTX,AUTO
          2 000B31  EFC5 0050                            STB,B6   80,B5

     1331    10369    3              END SET_NEW_CURDEV;

     1332    10370
     1333    10371    2   END SHIP_POSSIBLE_INPUT;

  10371   2 000B33  ECC7 0038                            LDB,B6   INPUT+4,AUTO
          2 000B35  C3C6 0001                            LNJ,B4   1,B6

     1334    10372        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:181  
     1335    10373        /* TIMER ROUTINES:
     1336    10374
     1337    10375            SET_TNOW justs sets TNOW to be the current time.
     1338    10376            CHECK_INTERVAL(deltat,timer_cell)
     1339    10377                 checks if timer_cell-tnow is greater than the interval.
     1340    10378                 if the interval has expired, then the timer cell is updated to TNOW
     1341    10379                 and CHECK_INTERVAL will altret;
     1342    10380        */
     1343    10381
     1344    10382    1   SET_TNOW:PROC;

  10382   2 000B37  EFC7 0044            SET_TNOW        STB,B6   T$+1,AUTO

     1345    10383
     1346    10384    2           CALL KHC$TIME2(TNOW);

  10384   2 000B39  DBC7 0029                            LAB,B5   TNOW,AUTO
          2 000B3B  DFC7 0068                            STB,B5   FPT_WRSYSLOG+22,AUTO
          2 000B3D  BBC7 0068                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 000B3F  CBF0 0100                            LAB,B4   256,IMO
          2 000B41  E380 0000 0000  xent                 LNJ,B6   KHC$TIME2
          2 000B44       0001                            DC       s:10385,PREL

     1347    10385    2           RETURN;

  10385   2 000B45  ECC7 0044                            LDB,B6   T$+1,AUTO
          2 000B47  C3C6 0001                            LNJ,B4   1,B6

     1348    10386    2   END SET_TNOW;
     1349    10387
     1350    10388    1   CHECK_INTERVAL:PROC(INTERVAL,TIMER_CELL) ALTRET;

  10388   2 000B49  EFC7 003A            CHECK_INTERVAL  STB,B6   DEV$,AUTO

     1351    10389    2   DCL INTERVAL UBIN(16);
     1352    10390    2   DCL TIMER_CELL UBIN(32);
     1353    10391    2   DCL DELTAT SBIN(32);
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:182  
     1354    10392    2           DELTAT=TNOW-TIMER_CELL;

  10392   2 000B4B  DCC7 003E                            LDB,B5   @TIMER_CELL,AUTO
          2 000B4D  8CC7 0029                            LDI      TNOW,AUTO
          2 000B4F  8485                                 SID      ,B5
          2 000B50  8D47 0040                            SDI      DELTAT,AUTO

     1355    10393    2           IF DELTAT >= 0 THEN

  10393   2 000B52  84F0 0000 0000                       SID      0,IMO
          2 000B55  6801 000D                            BLZ,R6   s:10396,PREL

     1356    10394    2              IF DELTAT <= INTERVAL THEN

  10394   2 000B57  CCC7 003C                            LDB,B4   @INTERVAL,AUTO
          2 000B59  F804                                 LDR,R7   ,B4
          2 000B5A  6C00                                 LDV,R6   0
          2 000B5B  84C7 0040                            SID      DELTAT,AUTO
          2 000B5D  6801 0005                            BLZ,R6   s:10396,PREL

     1357    10395    2                 RETURN;

  10395   2 000B5F  ECC7 003A                            LDB,B6   DEV$,AUTO
          2 000B61  C3C6 0001                            LNJ,B4   1,B6

     1358    10396    2           TIMER_CELL=TNOW;

  10396   2 000B63  8CC7 0029                            LDI      TNOW,AUTO
          2 000B65  8D05                                 SDI      ,B5

     1359    10397    2           ALTRETURN;

  10397   2 000B66  ECC7 003A                            LDB,B6   DEV$,AUTO
          2 000B68  B806                                 LDR,R3   ,B6
          2 000B69  C3B6                                 LNJ,B4   ,B6,R3

     1360    10398    2   END CHECK_INTERVAL;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:183  
     1361    10399        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:184  
     1362    10400
     1363    10401        /* GOOSE_PRINTERS:
     1364    10402
     1365    10403                 HIP attached printers may have their status messages
     1366    10404                 LOST due to line noise (status messages are NOT
     1367    10405                 retransmitted when a NAK is sent).
     1368    10406
     1369    10407                 Therefore, every 10 minutes or so, all printers on the
     1370    10408                 line are examined to see if their ACK has been delayed
     1371    10409                 by more than 10 minutes.
     1372    10410
     1373    10411                 If the ACK has been delayed that long, then the
     1374    10412                 last printer block is re-transmitted. If the delay
     1375    10413                 happens because the printer is out of paper, then a BSY
     1376    10414                 status msg will be sent back to me, which I will then ignore.
     1377    10415        */
     1378    10416
     1379    10417    1   GOOSE_PRINTERS:PROC;

  10417   2 000B6A  EFC7 0038            GOOSE_PRINTERS  STB,B6   INPUT+4,AUTO

     1380    10418
     1381    10419    2           KZ@LINCTX.CURCTR$=KZ@LINCTX.CTRHD$;

  10419   2 000B6C  DCC7 0004                            LDB,B5   @KZ@LINCTX,AUTO
          2 000B6E  CC85                                 LDB,B4   ,B5
          2 000B6F  CFC5 004E                            STB,B4   78,B5

     1382    10420
     1383    10421    3           DO WHILE(KZ@LINCTX.CURCTR$~=ADDR(NIL));

  10421   2 000B71  0F81 0063                            B        s:10442,PREL

     1384    10422
     1385    10423    3              CALL SETDEV(1,KZ@LINCTX.CURDEV$) ALTRET(NEXT_CTR);

  10423   2 000B73  EBF0 0001                            LAB,B6   1,IMO
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:185  
          2 000B75  DCC7 0004                            LDB,B5   @KZ@LINCTX,AUTO
          2 000B77  CBC5 0050                            LAB,B4   80,B5
          2 000B79  CFC7 0042                            STB,B4   LCLTRAIL,AUTO
          2 000B7B  EFC7 0040                            STB,B6   DELTAT,AUTO
          2 000B7D  E3C0 FC9F                            LNJ,B6   s:0,PREL
          2 000B7F       004F                            DC       s:10440,PREL

     1386    10424
     1387    10425    3              IF KZ@LINCTX.CURDEV$->KZ$HIPDEV.OTPBSY THEN

  10425   2 000B80  ECC7 0004                            LDB,B6   @KZ@LINCTX,AUTO
          2 000B82  DCC6 0050                            LDB,B5   80,B6
          2 000B84  82C5 0012                            LB,'0400'X        18,B5
          2 000B86       0400
          2 000B87  0581 0046                            BBF      s:10440,PREL

     1388    10426    4              DO;

     1389    10427    4                 CALL CHECK_INTERVAL(PRINTER_CHECK_INTERVAL,KZ@LINCTX.CURDEV$->
             10427                          KZ$HIPDEV.XMT_TIME)

  10427   2 000B89  CBC5 0020                            LAB,B4   32,B5
          2 000B8B  CFC7 003E                            STB,B4   @TIMER_CELL,AUTO
          2 000B8D  BB80 0000 0019  00                   LAB,B3   PRINTER_CHECK_INTERVAL
          2 000B90  BFC7 003C                            STB,B3   @INTERVAL,AUTO
          2 000B92  E3C0 FFB6                            LNJ,B6   s:0,PREL
          2 000B94       003A                            DC       s:10440,PREL

     1390    10428    4                   ALTRET(NEXT_CTR);
     1391    10429
     1392    10430        /* Printer has NOT answered in the proper amont of time. */
     1393    10431
     1394    10432    5                 DO SELECT(KZ@LINCTX.CURCTR$->KZ$HIPCTR.TYP);

  10432   2 000B95  ECC7 0004                            LDB,B6   @KZ@LINCTX,AUTO
          2 000B97  DCC6 004E                            LDB,B5   78,B6
          2 000B99  E845 0008                            LDR,R6   8,B5
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:186  
          2 000B9B  E970 1E7C                            CMR,R6   7804,IMO
          2 000B9D  0201 0009                            BL       s:10432+18,PREL
          2 000B9F  0901 001E                            BE       s:10437,PREL
          2 000BA1  E970 1E86                            CMR,R6   7814,IMO
          2 000BA3  0981 002A                            BNE      s:10440,PREL
          2 000BA5  0F81 0018                            B        s:10437,PREL
          2 000BA7  E970 1E14                            CMR,R6   7700,IMO
          2 000BA9  0981 0024                            BNE      s:10440,PREL
          2 000BAB  0F81 0001                            B        s:10434,PREL

     1395    10433    5                    SELECT(7700);

     1396    10434    5                    KZ$EVENT.EVENT=%KZ#LINFCN_REQOTP;

  10434   2 000BAD  5C02                                 LDV,R5   2
          2 000BAE  DF47 0008                            STR,R5   KZ$EVENT,AUTO

     1397    10435    5                    CALL KZ@LINCTX.DEVMGR@(KZ$EVENT);

  10435   2 000BB0  CBC7 0008                            LAB,B4   KZ$EVENT,AUTO
          2 000BB2  CFC7 0068                            STB,B4   FPT_WRSYSLOG+22,AUTO
          2 000BB4  BBC7 0068                            LAB,B3   FPT_WRSYSLOG+22,AUTO
          2 000BB6  9CC6 006E                            LDB,B1   110,B6
          2 000BB8  CBF0 0100                            LAB,B4   256,IMO
          2 000BBA  E381                                 LNJ,B6   ,B1
          2 000BBB       0001                            DC       s:10435+12,PREL
          2 000BBC  0F81 0011                            B        s:10440,PREL

     1398    10436    5                    SELECT(7814,7804);

     1399    10437    5                    CALL SEND_MSG(PENQ_MSG,0,4);

  10437   2 000BBE  CBF0 0000                            LAB,B4   0,IMO
          2 000BC0  BBF0 0004                            LAB,B3   4,IMO
          2 000BC2  BFC7 0040                            STB,B3   DELTAT,AUTO
          2 000BC4  CFC7 003E                            STB,B4   @TIMER_CELL,AUTO
          2 000BC6  AB80 0000 001B  00                   LAB,B2   PENQ_MSG
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:187  
          2 000BC9  AFC7 003C                            STB,B2   @INTERVAL,AUTO
          2 000BCB  E3C0 FE4C                            LNJ,B6   s:0,PREL
          2 000BCD       0001                            DC       s:10440,PREL

     1400    10438    5                    END /* SELECT ON CONTROLLER TYPE */;

     1401    10439
     1402    10440    4                 END;

     1403    10441    3   NEXT_CTR:  KZ@LINCTX.CURCTR$=KZ@LINCTX.CURCTR$->KZ$HIPCTR.LNK$;

  10441   2 000BCE  ECC7 0004            NEXT_CTR        LDB,B6   @KZ@LINCTX,AUTO
          2 000BD0  DCC6 004E                            LDB,B5   78,B6
          2 000BD2  CC85                                 LDB,B4   ,B5
          2 000BD3  CFC6 004E                            STB,B4   78,B6

     1404    10442    3              END /* DO WHILE */;

  10442   2 000BD5  ECC7 0004                            LDB,B6   @KZ@LINCTX,AUTO
          2 000BD7  8DC6 004E                            CMN      78,B6
          2 000BD9  0981 FF99                            BNE      s:10423,PREL

     1405    10443    2   END GOOSE_PRINTERS;

  10443   2 000BDB  ECC7 0038                            LDB,B6   INPUT+4,AUTO
          2 000BDD  C3C6 0001                            LNJ,B4   1,B6
     1406    10444        %EJECT;
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:188  
     1407    10445    1   END KZH$HIPIO;
     1408    10446        %EOD;

PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:189  
--  Include file information  --

   GH_IOFNC_E.:E05TOU  is referenced.
   KH$IO.:E05TOU  is referenced.
   KH$CLK.:E05TOU  is referenced.
   KH_CLKFNC_E.:E05TOU  is referenced.
   KZ_CLMEVT_C.:E05TOU  is referenced.
   KZ_HIPEVT_C.:E05TOU  is referenced.
   KZ_MLCP_C.:E05TOU  is referenced.
   KZ_PERR_C.:E05TOU  is referenced.
   KZ_LIN_C.:E05TOU  is referenced.
   KZ_HIPTAB_C.:E05TOU  is referenced.
   KZ_CLM_E.:E05TOU  is referenced.
   KZ_BSCFPT.:E05TOU  is referenced.
   KZ$OTPBFR.:E05TOU  is referenced.
   KZ$HIPDEV.:E05TOU  is referenced.
   KZ$HIPCTR.:E05TOU  is referenced.
   KZ$LINCTX.:E05TOU  is referenced.
   KZ$HIPBRACKET.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure KZH$HIPIO.
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:190  

 **** Variables and constants ****

  ****  Section 000 RoData KZH$HIPIO

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

    25-0-0/w UBIN(16)    r     1 BAUDMAPS(0:15)
    1D-0-0/b BIT (8)     r     1 DEVBYTES_B(0:7)
    1D-0-0/c CHAR(8)     r     1 DEVBYTES_C                44-0-0/w STRC(336)   r     1 FPT@WRSYSLOG
     E-0-0/w STRC(176)   r     1 KH_CLK_SET                38-0-0/c STRC(72)    r     1 KZ@HIPHEAD
    35-0-0/c STRC(40)    r     1 KZ@HIPTAIL                 0-0-0/w STRC(224)   r     1 KZ_EVENT
    40-0-0/c CHAR(4)     r     1 PDENQ                     42-0-0/c CHAR(4)     r     1 PENQ
    1B-0-0/c CHAR(4)     r     1 PENQ_MSG
    19-0-0/w UBIN(16)    r     1 PRINTER_CHECK_INTERVAL
    21-0-0/b BIT (8)     r     1 STABYTES_B(0:7)
    3D-0-0/c CHAR(6)     r     1 STABYTES_C

  ****  Section 001  Data  KZH$HIPIO

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     2-0-0/w STRC(32)    r     1 KH_INPLCT                  0-0-0/w STRC(32)    r     1 KH_OTPLCT

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

    42-0-0/w PTR         r     1 @DEV$                     40-0-0/w PTR         r     1 @DEVNUM
    4E-0-0/w PTR         r     1 @ERROR                    50-0-0/w PTR         r     1 @INDX
    3C-0-0/w PTR         r     1 @INTERVAL                  6-0-0/w PTR         r     1 @KZ@BSCFPT
     4-0-0/w PTR         r     1 @KZ@LINCTX                3C-0-0/w PTR         r     1 @MSG
    40-0-0/w PTR         r     1 @MSGL                     3E-0-0/w PTR         r     1 @MSGS
    3E-0-0/w PTR         r     1 @TIMER_CELL               2D-0-0/b BIT         r     1 ACKS(0:15)
    3F-0-0/c CHAR        r     1 ADR                       40-0-0/w SBIN(16)    r     1 ADR_INDX
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:191  
    2F-0-0/b BIT         r     1 BUSY(0:15)                41-0-0/w PTR         r     1 CTR$
    40-0-0/w SBIN(32)    r     1 DELTAT                    *0-0-0/w PTR         r     1 DEV$
    3A-0-0/w PTR         r     1 DEV$                      *0-0-0/w SBIN(16)    r     1 DEVNUM
    22-0-0/w SBIN(16)    r     1 DEV_ADR_NO                25-0-0/w UBIN(16)    r     1 ENDX
    *0-0-0/w UBIN(16)    r     1 ERROR                     52-0-0/w STRC(336)   r     1 FPT_WRSYSLOG
    28-0-0/w UBIN(16)    r     1 I                         3E-0-0/w SBIN(16)    r     1 I
    3C-0-0/w PTR         r     1 IBFR$                     2B-0-0/w UBIN(16)    r     1 INACT_POLL_TICS
    3A-0-0/w SBIN(16)    r     1 INDX                      *0-0-0/w UBIN(16)    r     1 INDX
    3F-0-0/w SBIN(16)    r     1 INDX                      34-0-0/w STRC(33)    r     1 INPUT
    *0-0-0/w UBIN(16)    r     1 INTERVAL                  16-0-0/w STRC(176)   r     1 KH$CLK
     8-0-0/w STRC(224)   r     1 KZ$EVENT                  32-0-0/w STRC(32)    r     1 KZ$INPDESC
    *0-0-0/w STRC(80)    r     1 KZ@BSCFPT                 *0-0-0/w STRC(2192)  r     1 KZ@LINCTX
    42-0-0/c STRC(40)    r     1 LCLTRAIL                  3B-0-0/w SBIN(16)    r     1 LENX
    21-0-0/w UBIN(16)    r     1 LINESPEED                 *0-0-0/c ACHR        r     1 MSG
    *0-0-0/w SBIN(16)    r     1 MSGL                      *0-0-0/w SBIN(16)    r     1 MSGS
    2E-0-0/b BIT         r     1 NAKS(0:15)                31-0-0/b BIT         r     1 NAV(0:15)
    23-0-0/w PTR         r     1 OBFR$                     3C-0-0/w SBIN(16)    r     1 OLD_INDX
    45-0-0/w STRC(96)    r     1 P7814                     30-0-0/b BIT         r     1 PGOV(0:15)
    3B-0-0/c CHAR        r     1 POLADR                    3E-0-0/c CHAR        r     1 POLLADDR
    3A-0-0/w SBIN(16)    r     1 POLLX                     2C-0-0/w UBIN(16)    r     1 POLL_INTERVAL
    3D-0-0/w UBIN(8)     r     1 POLSIZ                    3C-0-0/w PTR         r     1 SAVCURDEV$
    3A-0-0/c CHAR        r     1 SELADR                    41-0-0/c CHAR        r     1 STA
    42-0-0/w SBIN(16)    r     1 STA_INDX                  43-0-0/w PTR         r     1 T$
    28-0-0/w BIT (16)    r     1 TEMP_BIT16                *0-0-0/w UBIN(32)    r     1 TIMER_CELL
    29-0-0/w UBIN(32)    r     1 TNOW                      3A-0-0/w SBIN(16)    r     1 TYP

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w EPTR        r     1 KZT_GO@                    0-0-0/w EPTR        r     1 KZT_ORDERS@

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:192  

     0-0-0/w PTR         r     1 BP$(0:1)                   0-0-0/c CHAR(10)    r     1 CHRS
     0-0-0/c ACHR        r     1 IBFR                       0-0-0/w STRC(512)   r     1 KH$CHN
     0-0-0/w STRC(176)   r     1 KZ$HIPCTR                  0-0-0/w STRC(560)   r     1 KZ$HIPDEV
     0-0-0/c STRC(72)    r     1 KZ$HIPHEAD                 0-0-0/c STRC(40)    r     1 KZ$HIPTAIL
     0-0-0/w STRC(128)   r     1 KZ$OTPBFR                  0-0-0/c STRC(272)   r     1 KZ$POLLHIP
     0-0-0/c STRC(272)   r     1 KZ$POLLHIP                 0-0-0/c STRC(272)   r     1 KZ$POLLHIP
     0-0-0/w STRC(176)   r     1 KZ@HIPCTR                  0-0-0/w STRC(560)   r     1 KZ@HIPDEV
     0-0-0/c CHAR(14)    r     1 NAKMSG                     0-0-0/c STRC(912)   r     1 OBUF
     0-0-0/c ACHR        r     1 POLL_ADR_LIST


   Procedure KZH$HIPIO requires 3039 words for executable code.
   Procedure KZH$HIPIO requires 112 words of local(AUTO) storage.
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:193  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:194  
          MINI XREF LISTING

ACKS
      8671**DCL      9250>>IF       9292>>IF       9567<<ASSIGN   9612<<ASSIGN   9666<<ASSIGN   9766>>IF
      9831>>IF      10325>>IF      10331>>IF
ADR IN PROCEDURE PARSE_INPUT
      9543**DCL      9576<<ASSIGN   9579>>CALLBLT
ADR_INDX IN PROCEDURE PARSE_INPUT
      9544**DCL      9579<<CALLBLT  9582<<ASSIGN   9612>>ASSIGN   9616>>ASSIGN   9627>>ASSIGN   9674>>ASSIGN
      9678>>ASSIGN   9682>>ASSIGN
BAUDMAPS
      8942**DCL      9036>>ASSIGN
BP$ IN PROCEDURE ISOLATE_GPOLL_STOPPER
     10128**DCL     10175>>ASSIGN  10182>>ASSIGN
BUSY
      8673**DCL      9292>>IF       9569<<ASSIGN   9664<<ASSIGN   9674<<ASSIGN   9736>>IF       9756>>IF
      9843>>IF
CANT_FIND_ENDING_ETX IN PROCEDURE PARSE_INPUT
      9699**LABEL    9622--CALLALT  9692--GOTO     9700--GOTO
CHECKING_PRINTERS
      9124**LABEL    9124--CALLALT
CHECK_INTERVAL
     10388**PROC     9124--CALL     9273--CALL     9321--CALL    10427--CALL
CHRS
      8657**DCL      9194<<CALLBLT  9194>>CALLBLT  9196<<CALLBLT 10346<<CALLBLT
CONTINUE_POLLING
     10189**PROC     9159--CALL     9418--CALL     9441--CALL     9450--CALL     9476--CALL     9479--CALL
CTR$ IN PROCEDURE ISOLATE_GPOLL_STOPPER
     10134**DCL     10175<<ASSIGN  10176>>IF      10177>>ASSIGN
DELTAT IN PROCEDURE CHECK_INTERVAL
     10391**DCL     10392<<ASSIGN  10393>>IF      10394>>IF
DEV$ IN PROCEDURE SETDEV
      9866**DCL      9860--PROC     9869<<ASSIGN   9870>>DOWHILE  9871>>IF       9875<<ASSIGN   9875>>ASSIGN
DEV$ IN PROCEDURE SHIP_POSSIBLE_INPUT
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:195  
     10322**DCL     10327<>CALL    10329>>ASSIGN  10331>>IF      10333>>ASSIGN
DEVBYTES_B
      8934**DCL      8936--REDEF    9189>>ASSIGN
DEVBYTES_C
      8936**DCL      9579>>CALLBLT
DEVNUM IN PROCEDURE SETDEV
      9867**DCL      9860--PROC     9871>>IF
DEV_ADR_NO
      8653**DCL      9185<<ASSIGN   9187<<ASSIGN   9189>>ASSIGN   9191>>ASSIGN
DISCONNECT_NOW
      9489**LABEL    9403--CALLALT  9431--CALLALT  9469--CALLALT
DO_PENQ IN PROCEDURE PARSE_INPUT
      9648**LABEL    9643--GOTO
ENDX
      8655**DCL      9193<<ASSIGN   9194>>CALLBLT  9196>>CALLBLT
ERRLOG
      9880**PROC     9074--CALL     9243--CALL     9445--CALL     9583--CALL     9598--CALL     9706--CALL
     10359--CALL
ERROR IN PROCEDURE ERRLOG
      9883**DCL      9880--PROC    10077>>ASSIGN  10079>>DOCASE
FPT@WRSYSLOG IN PROCEDURE ERRLOG
      9992**DCL     10075>>ASSIGN
FPT@WRSYSLOG.V IN PROCEDURE ERRLOG
      9996**DCL      9994--DCLINIT
FPT@WRSYSLOG.V.TERMID.TERM IN PROCEDURE ERRLOG
     10061**DCL     10070--REDEF
FPT_WRSYSLOG IN PROCEDURE ERRLOG
      9897**DCL     10075<<ASSIGN  10114<>CALL
FPT_WRSYSLOG.BUF_ IN PROCEDURE ERRLOG
      9899**DCL     10095<<ASSIGN  10102<<ASSIGN  10103<<ASSIGN
FPT_WRSYSLOG.V.ERRCODE.ERR# IN PROCEDURE ERRLOG
      9945**DCL     10077<<ASSIGN
FPT_WRSYSLOG.V.ERRCODE.SEV IN PROCEDURE ERRLOG
      9946**DCL     10090<<ASSIGN  10106<<ASSIGN
FPT_WRSYSLOG.V.TERMID IN PROCEDURE ERRLOG
      9964**DCL     10076<<ASSIGN
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:196  
FPT_WRSYSLOG.V.TERMID.TERM IN PROCEDURE ERRLOG
      9966**DCL      9975--REDEF
FPT_WRSYSLOG.V.VALUES IN PROCEDURE ERRLOG
      9977**DCL     10091<<ASSIGN  10092<<ASSIGN  10093<<ASSIGN  10094<<ASSIGN  10098<<ASSIGN  10099<<ASSIGN
     10100<<ASSIGN  10101<<ASSIGN  10107<<ASSIGN  10108<<ASSIGN  10109<<ASSIGN  10110<<ASSIGN
GOOSE_PRINTERS
     10417**PROC     9128--CALL
I
      8663**DCL      9364<<ASSIGN   9365<<ASSIGN   9365>>ASSIGN   9366>>IF       9369>>ASSIGN
I IN PROCEDURE PARSE_INPUT
      9542**DCL      9688<<DOINDEX  9689>>IF       9694>>ASSIGN
IBFR IN PROCEDURE PARSE_INPUT
      9540**DCL      9576>>ASSIGN   9577>>ASSIGN   9622>>CALLBLT  9640>>CALLBLT  9645>>CALLBLT  9648>>ASSIGN
      9649<<ASSIGN   9649>>ASSIGN   9689>>IF       9699>>IF
IBFR$ IN PROCEDURE PARSE_INPUT
      9538**DCL      9540--IMP-PTR  9565<<ASSIGN   9576>>ASSIGN   9577>>ASSIGN   9622>>CALLBLT  9640>>CALLBLT
      9645>>CALLBLT  9648>>ASSIGN   9649>>ASSIGN   9649>>ASSIGN   9689>>IF       9699>>IF
INACT_POLL_EXPIRED
      9335**LABEL    9321--CALLALT
INACT_POLL_TICS
      8668**DCL      9317<<ASSIGN   9318>>IF       9318<<ASSIGN   9319>>IF       9319<<ASSIGN   9321<>CALL
INDX IN PROCEDURE ERRLOG
      9882**DCL      9880--PROC    10100>>ASSIGN
INDX IN PROCEDURE ISOLATE_GPOLL_STOPPER
     10132**DCL     10161<<CALLBLT 10168>>ASSIGN  10174<<DOINDEX 10175>>ASSIGN
INDX IN PROCEDURE PARSE_INPUT
      9535**DCL      9566<<ASSIGN   9574>>DOWHILE  9576>>ASSIGN   9577>>ASSIGN   9583<>CALL     9598<>CALL
      9613<<ASSIGN   9613>>ASSIGN   9617<<ASSIGN   9617>>ASSIGN   9620>>ASSIGN   9626<<ASSIGN   9675<<ASSIGN
      9675>>ASSIGN   9679<<ASSIGN   9679>>ASSIGN   9683<<ASSIGN   9683>>ASSIGN   9688>>DOINDEX  9694<<ASSIGN
      9699>>IF       9706<>CALL
INPUT.ENDING_ETX
      8685**DCL      9622<<CALLBLT  9626>>ASSIGN   9633>>IF       9649>>ASSIGN   9649>>ASSIGN   9652<<ASSIGN
      9652>>ASSIGN   9653>>IF      10342>>ASSIGN  10346>>CALLBLT
INPUT.FIRST
      8684**DCL      9620<<ASSIGN   9622>>CALLBLT  9633>>IF       9640>>CALLBLT  9645>>CALLBLT  9653>>IF
     10341>>ASSIGN  10342>>ASSIGN
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:197  
INPUT.PRESENT
      8686**DCL      9250>>IF       9292>>IF       9298>>IF       9473>>IF       9572<<ASSIGN   9627<<ASSIGN
      9654<<ASSIGN   9782>>IF      10325>>IF      10339>>IF
INTERVAL IN PROCEDURE CHECK_INTERVAL
     10389**DCL     10388--PROC    10394>>IF
ISOLATE_GPOLL_STOPPER
     10119**PROC     9403--CALL     9431--CALL     9469--CALL
KH$CHN
      7052**DCL      9027<>CALL     9030<>CALL    10151<>CALL
KH$CHN.LINSPD
      7106**DCL      9036>>ASSIGN
KH$CHN.TERMID.TERM
      7148**DCL      7157--REDEF
KH$CLK
      8504**DCL      9360<<ASSIGN   9373<>CALL
KH$CLK.CTBCTX$
      8510**DCL      9374>>ASSIGN
KH$CLK.PRD
      8625**DCL      9361<<ASSIGN   9362>>IF       9362<<ASSIGN   9363>>IF       9363<<ASSIGN   9366>>IF
      9367<<ASSIGN   9369<<ASSIGN   9369>>ASSIGN
KH$CLK.PRDUNT
      8607**DCL      9370<<ASSIGN
KH$CLK.SBR$
      8621**DCL      9372<<ASSIGN
KH$CLK.UID
      8520**DCL      8521--REDEF    8522--REDEF
KH$CLK.UID$
      8521**DCL      9371<<ASSIGN
KHA$ERRLOG
      8644**DCL-ENT 10114--CALL
KHC$CLOCK
      8642**DCL-ENT  9373--CALL
KHC$TIME2
      8641**DCL-ENT 10384--CALL
KHI$IO_INPLCTBYT
      8645**DCL-ENT 10151--CALL
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:198  
KHI$IO_OTPLCTBYT
      8646**DCL-ENT  9027--CALL     9030--CALL
KH_CLK_SET
      8355**DCL      9360>>ASSIGN
KH_CLK_SET.UID
      8371**DCL      8372--REDEF    8373--REDEF
KH_INPLCT
      8824**DCL     10151<>CALL
KH_INPLCT.LCTBYT.ADR
      8840**DCL     10150<<ASSIGN
KH_INPLCT.LCTBYT.DAT
      8840**DCL     10153>>ASSIGN
KH_OTPLCT
      8710**DCL      9027<>CALL     9030<>CALL
KH_OTPLCT.LCTBYT.ADR
      8726**DCL      9025<<ASSIGN   9028<<ASSIGN
KH_OTPLCT.LCTBYT.DAT
      8726**DCL      9026<<ASSIGN   9029<<ASSIGN
KVB$GETSYS
      8640**DCL-ENT  9071--CALL    10356--CALL
KVB$RLSSYS
      8689**DCL-ENT  9069--CALL
KZ$EVENT
      8273**DCL      9008<<ASSIGN   9134<>CALL     9147<>CALL     9216<>CALL     9220<>CALL     9326<>CALL
      9340<>CALL     9354<>CALL     9410<>CALL     9488<>CALL     9746<>CALL     9751<>CALL     9764<>CALL
      9771<>CALL     9779<>CALL     9793<>CALL     9810<>CALL     9815<>CALL     9839<>CALL    10335<>CALL
     10349<>CALL    10435<>CALL
KZ$EVENT.EVENT
      8274**DCL      9133<<ASSIGN   9146<<ASSIGN   9215<<ASSIGN   9219<<ASSIGN   9325<<ASSIGN   9339<<ASSIGN
      9353<<ASSIGN   9409<<ASSIGN   9487<<ASSIGN   9745<<ASSIGN   9750<<ASSIGN   9763<<ASSIGN   9770<<ASSIGN
      9778<<ASSIGN   9792<<ASSIGN   9809<<ASSIGN   9814<<ASSIGN   9838<<ASSIGN  10334<<ASSIGN  10348<<ASSIGN
     10434<<ASSIGN
KZ$EVENT.LINCTX$
      8280**DCL      9009<<ASSIGN
KZ$HIPCTR.ADR
      7903**DCL     10255>>ASSIGN  10256>>ASSIGN  10299>>ASSIGN
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:199  
KZ$HIPCTR.DEVHD$
      7890**DCL      9636>>ASSIGN   9869>>ASSIGN
KZ$HIPCTR.LNK$
      7888**DCL     10441>>ASSIGN
KZ$HIPCTR.TIMED_OUT_ONCE
      7908**DCL      9217>>IF       9224<<ASSIGN   9244<<ASSIGN   9407>>IF       9414<<ASSIGN   9436<<ASSIGN
      9470<<ASSIGN  10177<<ASSIGN
KZ$HIPCTR.TYP
      7897**DCL      9634>>DOSELCT  9731>>ASSIGN  10432>>DOSELCT
KZ$HIPDEV.ADR
      8025**DCL      9247>>DOCASE   9289>>DOCASE   9733>>DOCASE   9871>>IF      10296>>ASSIGN
KZ$HIPDEV.HLT.WACK
      8003**DCL      9762<<ASSIGN   9766>>IF      10331>>IF      10333<<ASSIGN
KZ$HIPDEV.KBDLCK
      8074**DCL      9249<<ASSIGN   9291<<ASSIGN
KZ$HIPDEV.LNK$
      7925**DCL      9669>>ASSIGN   9875>>ASSIGN
KZ$HIPDEV.OTPBSY
      7984**DCL      9662>>IF       9741<<ASSIGN   9805<<ASSIGN   9836>>IF      10425>>IF
KZ$HIPDEV.RTRCNT
      8088**DCL      9739<<ASSIGN   9739>>ASSIGN   9742>>IF       9769<<ASSIGN   9803<<ASSIGN   9803>>ASSIGN
      9806>>IF       9835<<ASSIGN
KZ$HIPDEV.XMT_TIME
      8090**DCL      9200<<ASSIGN  10427<>CALL
KZ$HIPHEAD
      7174**DCL      9180<<ASSIGN
KZ$HIPHEAD.ADR_U
      7179**DCL      7180--REDEF    9181<<ASSIGN
KZ$HIPHEAD.DEV_B
      7184**DCL      9189<<ASSIGN
KZ$HIPHEAD.STA_B
      7185**DCL      9191<<ASSIGN
KZ$HIPTAIL
      7203**DCL      9174--ASSIGN
KZ$HIPTAIL.ADR_U
      7209**DCL      7210--REDEF
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:200  
KZ$INPDESC
      8678**DCL     10349<>CALL
KZ$INPDESC.BYTX
      8679**DCL     10341<<ASSIGN
KZ$INPDESC.DATBYTSIZ
      8680**DCL     10342<<ASSIGN
KZ$OTPBFR
      8123**DCL      9172--ASSIGN
KZ$OTPBFR.DATA_SIZ
      8164**DCL      9174>>ASSIGN
KZ$POLLHIP.CONTINUE_POLL
      8097**DCL      9151<<ASSIGN
KZ$POLLHIP.POLL_LIST
      8100**DCL      8101--REDEF    8102--REDEF
KZ$POLLHIP.CONTINUE_POLL IN PROCEDURE CONTINUE_POLLING
     10199**DCL     10206>>IF
KZ$POLLHIP.INDX IN PROCEDURE CONTINUE_POLLING
     10198**DCL     10219>>ASSIGN
KZ$POLLHIP.POLL_LIST IN PROCEDURE CONTINUE_POLLING
     10202**DCL     10203--REDEF   10204--REDEF   10219>>ASSIGN
KZ$POLLHIP.CONTINUE_POLL IN PROCEDURE ISOLATE_GPOLL_STOPPER
     10138**DCL     10169<<ASSIGN  10185<<ASSIGN
KZ$POLLHIP.INDX IN PROCEDURE ISOLATE_GPOLL_STOPPER
     10137**DCL     10168<<ASSIGN  10169>>ASSIGN
KZ$POLLHIP.POLLX IN PROCEDURE ISOLATE_GPOLL_STOPPER
     10140**DCL     10165>>ASSIGN  10166<<ASSIGN
KZ$POLLHIP.POLL_LIST IN PROCEDURE ISOLATE_GPOLL_STOPPER
     10141**DCL     10142--REDEF   10143--REDEF
KZ$POLLHIP.POLL_LIST_C IN PROCEDURE ISOLATE_GPOLL_STOPPER
     10143**DCL     10161>>CALLBLT
KZ@BSCFPT
      7868**DCL        44--PROC
KZ@BSCFPT.ACT
      7869**DCL      9011>>DOCASE
KZ@BSCFPT.EVT
      7870**DCL      9091<<ASSIGN   9137<<ASSIGN   9144<<ASSIGN   9164<<ASSIGN   9227<<ASSIGN   9258<<ASSIGN
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:201  
      9305<<ASSIGN   9329<<ASSIGN   9357<<ASSIGN   9393<<ASSIGN   9422<<ASSIGN   9454<<ASSIGN   9490<<ASSIGN
      9501<<ASSIGN
KZ@BSCFPT.FNC
      7874**DCL      9092<<ASSIGN   9110<<ASSIGN   9136<<ASSIGN   9143<<ASSIGN   9165<<ASSIGN   9226<<ASSIGN
      9257<<ASSIGN   9304<<ASSIGN   9328<<ASSIGN   9356<<ASSIGN   9392<<ASSIGN   9423<<ASSIGN   9455<<ASSIGN
      9489<<ASSIGN   9500<<ASSIGN   9507<<ASSIGN
KZ@BSCFPT.SIZ
      7873**DCL      9440>>IF       9563>>ASSIGN  10103>>ASSIGN
KZ@HIPCTR.ADR
      7675**DCL      9181>>ASSIGN   9196>>CALLBLT
KZ@HIPCTR.TYP
      7669**DCL      9183>>DOSELCT
KZ@HIPDEV.ADR
      7797**DCL      9185>>ASSIGN
KZ@HIPDEV.PRINTER
      7754**DCL      9638>>IF
KZ@HIPHEAD
      8983**DCL      9180>>ASSIGN
KZ@HIPHEAD.ADR_U
      8988**DCL      8989--REDEF
KZ@HIPTAIL
      8958**DCL      9193--ASSIGN   9194--CALLBLT  9194--CALLBLT  9194--CALLBLT  9196--CALLBLT
KZ@HIPTAIL.ADR_U
      8964**DCL      8965--REDEF    9196--CALLBLT
KZ@LINCTX
      7228**DCL        44--PROC     9009--ASSIGN   9077<>CALL     9203<>CALL     9345<>CALL     9371--ASSIGN
     10223<>CALL    10251<>CALL    10265<>CALL    10306<>CALL    10362<>CALL
KZ@LINCTX.ACTCTR
      7587**DCL     10159>>IF      10161>>CALLBLT 10169>>ASSIGN
KZ@LINCTX.CHAN
      7319**DCL     10091>>ASSIGN  10098>>ASSIGN  10107>>ASSIGN
KZ@LINCTX.CHN$
      7231**DCL      7052--IMP-PTR  9027>>CALL     9030>>CALL     9036>>ASSIGN  10151>>CALL
KZ@LINCTX.CTB.PRM$
      7317**DCL      9374<<ASSIGN   9390<<ASSIGN
KZ@LINCTX.CTRHD$
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:202  
      7229**DCL     10419>>ASSIGN
KZ@LINCTX.CTRLST$
      7572**DCL     10175>>ASSIGN  10182>>ASSIGN
KZ@LINCTX.CURCTR$
      7524**DCL      9244>>ASSIGN   9407>>IF       9414>>ASSIGN   9436>>ASSIGN   9470>>ASSIGN   9634>>DOSELCT
      9636>>ASSIGN   9731>>ASSIGN   9869>>ASSIGN  10182<<ASSIGN  10255>>ASSIGN  10256>>ASSIGN  10296>>ASSIGN
     10299>>ASSIGN  10419<<ASSIGN  10421>>DOWHILE 10432>>DOSELCT 10441<<ASSIGN  10441>>ASSIGN
KZ@LINCTX.CURDEV$
      7527**DCL      9733>>DOCASE   9834<>CALL     9835>>ASSIGN   9836>>IF      10328>>ASSIGN  10329<<ASSIGN
     10368<<ASSIGN  10423<>CALL    10425>>IF      10427>>CALL
KZ@LINCTX.DEVMGR@
      7591**DCL      9134>>CALL     9147>>CALL     9216>>CALL     9220>>CALL     9326>>CALL     9340>>CALL
      9354>>CALL     9410>>CALL     9488>>CALL     9746>>CALL     9751>>CALL     9764>>CALL     9771>>CALL
      9779>>CALL     9793>>CALL     9810>>CALL     9815>>CALL     9839>>CALL    10251>>CALL    10335>>CALL
     10349>>CALL    10435>>CALL
KZ@LINCTX.HIST
      7274**DCL     10095--ASSIGN
KZ@LINCTX.INPBFR$
      7534**DCL      9069<>CALL     9071<>CALL     9075<<ASSIGN   9565>>ASSIGN  10102>>ASSIGN  10257>>ASSIGN
     10298>>ASSIGN  10346>>CALLBLT 10353>>IF      10356<>CALL    10360<<ASSIGN
KZ@LINCTX.INPBFRSIZ
      7536**DCL      9069<>CALL     9070<<ASSIGN   9071<>CALL     9076<<ASSIGN  10355<<ASSIGN  10356<>CALL
     10361<<ASSIGN
KZ@LINCTX.LINID
      7249**DCL     10076>>ASSIGN
KZ@LINCTX.LINID.TERM
      7251**DCL      7260--REDEF
KZ@LINCTX.OTPBFR$
      7540**DCL      9172>>ASSIGN   9174>>ASSIGN   9176<<ASSIGN   9343<<ASSIGN  10208<<ASSIGN  10222<<ASSIGN
     10243--IMP-PTR 10257<<ASSIGN  10259>>CALLBLT 10278--IMP-PTR 10298<<ASSIGN  10299>>ASSIGN  10301>>ASSIGN
     10304>>CALLBLT 10305>>CALLBLT
KZ@LINCTX.OTPCNT
      7516**DCL      7519--REDEF    9080<<ASSIGN   9084<<ASSIGN
KZ@LINCTX.OTPCTR$
      7546**DCL      9181>>ASSIGN   9183>>DOSELCT  9196>>CALLBLT  9217>>IF       9224>>ASSIGN
KZ@LINCTX.OTPDATSIZ
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:203  
      7544**DCL      9174<<ASSIGN   9193>>ASSIGN   9342<<ASSIGN  10221<<ASSIGN  10258<<ASSIGN  10300<<ASSIGN
KZ@LINCTX.OTPDEV$
      7553**DCL      9185>>ASSIGN   9200>>ASSIGN   9246>>IF       9247>>DOCASE   9249>>ASSIGN   9288>>IF
      9289>>DOCASE   9291>>ASSIGN   9739>>ASSIGN   9739>>ASSIGN   9741>>ASSIGN   9742>>IF       9762>>ASSIGN
      9766>>IF       9769>>ASSIGN   9803>>ASSIGN   9803>>ASSIGN   9805>>ASSIGN   9806>>IF
KZ@LINCTX.OTPHD$
      7529**DCL      9083>>IF
KZ@LINCTX.POLADR.CTR
      7560**DCL      9343--ASSIGN  10167<<ASSIGN  10219<<ASSIGN  10222--ASSIGN
KZ@LINCTX.POLLST$
      7567**DCL     10129--IMP-PTR 10154>>CALLBLT
KZ@LINCTX.POLLTBL$
      7615**DCL      9151>>ASSIGN  10136--IMP-PTR 10161>>CALLBLT 10165>>ASSIGN  10166>>ASSIGN  10168>>ASSIGN
     10169>>ASSIGN  10169>>ASSIGN  10185>>ASSIGN  10197--IMP-PTR 10206>>IF      10219>>ASSIGN  10219>>ASSIGN
KZ@LINCTX.POLSIZ
      7562**DCL      7564--REDEF   10149>>ASSIGN
KZ@LINCTX.POLX
      7582**DCL     10157<<ASSIGN  10166>>ASSIGN  10174>>DOINDEX 10182>>ASSIGN
KZ@LINCTX.PRMCTBTYP
      7264**DCL      9375<<ASSIGN   9391<<ASSIGN
KZ@LINCTX.PRO.BLKRECS
      7415**DCL      9317>>ASSIGN
KZ@LINCTX.PRO.INTERVAL
      7430**DCL      9269>>ASSIGN   9317>>ASSIGN   9361>>ASSIGN
KZ@LINCTX.PRO.RETRYS
      7423**DCL      9742>>IF       9742>>IF       9806>>IF       9806>>IF      10248>>IF      10248>>IF
KZ@LINCTX.RTRCNT
      7404**DCL      9132<<ASSIGN   9145<<ASSIGN   9201<<ASSIGN   9242>>IF       9245<<ASSIGN   9444>>IF
      9446<<ASSIGN  10092>>ASSIGN  10099>>ASSIGN  10246<<ASSIGN  10246>>ASSIGN  10248>>IF
KZ@LINCTX.TIMER.POL
      7293**DCL      9033<<ASSIGN   9321<>CALL     9335<<ASSIGN
KZ@LINCTX.TIMOUT.PRIMARY
      7628**DCL      9043<<ASSIGN
KZ@LINCTX.TIMOUT.SECONDARY
      7632**DCL      9044<<ASSIGN
KZ@LINCTX.TIMOUT.USESEC
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:204  
      7640**DCL      9131<<ASSIGN   9158<<ASSIGN   9268<<ASSIGN   9344<<ASSIGN
KZ@LINCTX.TIMR.GENPOL
      7603**DCL      9032<<ASSIGN   9273<>CALL     9364>>ASSIGN  10147<<ASSIGN
KZ@LINCTX.TIMR.SPCPOL
      7605**DCL      9031<<ASSIGN   9124<>CALL
KZH$DSC_LINE
      8647**DCL-ENT  9077--CALL    10362--CALL
KZT_GO@
      8643**DCL      9372>>ASSIGN
KZT_ORDERS@
      8690**DCL      9203>>CALL     9345>>CALL    10223>>CALL    10265>>CALL    10306>>CALL
KZ_EVENT
      8191**DCL      9008>>ASSIGN
LAST_CONTROLLER_HAD_DATA
      9446**LABEL    9441--CALLALT  9450--CALLALT  9476--CALLALT  9479--CALLALT
LCLTRAIL.ALLOFIT IN PROCEDURE SEND_MSG
     10289**DCL     10290--REDEF   10305--CALLBLT 10305>>CALLBLT
LCLTRAIL.TRAIL.F1 IN PROCEDURE SEND_MSG
     10291**DCL     10295<<ASSIGN
LCLTRAIL.TRAIL.F2 IN PROCEDURE SEND_MSG
     10293**DCL     10297<<ASSIGN
LCLTRAIL.TRAIL.POLADR IN PROCEDURE SEND_MSG
     10292**DCL     10296<<ASSIGN
LENX IN PROCEDURE PARSE_INPUT
      9536**DCL      9540--IMP-SIZ  9563<<ASSIGN   9574>>DOWHILE  9576>>ASSIGN   9577>>ASSIGN   9622>>CALLBLT
      9640>>CALLBLT  9645>>CALLBLT  9648>>ASSIGN   9649>>ASSIGN   9649>>ASSIGN   9688>>DOINDEX  9689>>IF
      9699>>IF
LINESPEED
      8652**DCL      9036<<ASSIGN
LINE_IS_TRULY_IDLE
      9357**LABEL    9354--CALLALT
M$XXX
      4284**DCL-ENT  9377--CALL
MLCP_GOOFED_ON_POLL_ADR_INDX IN PROCEDURE ISOLATE_GPOLL_STOPPER
     10182**LABEL   10154--CALLALT 10160--GOTO    10161--CALLALT
MSG IN PROCEDURE SEND_MSG
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:205  
     10271**DCL     10269--PROC    10304>>CALLBLT
MSGL IN PROCEDURE SEND_MSG
     10273**DCL     10269--PROC    10271--IMP-SIZ 10300>>ASSIGN  10304>>CALLBLT 10304>>CALLBLT 10304>>CALLBLT
     10305>>CALLBLT
MSGS IN PROCEDURE SEND_MSG
     10272**DCL     10269--PROC    10304>>CALLBLT
NAKMSG IN PROCEDURE SEND_NAK
     10243**DCL     10258--ASSIGN  10259<<CALLBLT
NAKS
      8672**DCL      9250>>IF       9251<<ASSIGN   9292>>IF       9293<<ASSIGN   9568<<ASSIGN   9616<<ASSIGN
      9736>>IF       9800>>IF
NAV
      8675**DCL      9571<<ASSIGN   9682<<ASSIGN
NEXT_CTR IN PROCEDURE GOOSE_PRINTERS
     10441**LABEL   10423--CALLALT 10427--CALLALT
NO_ACTIVE_CONTROLLERS
      9147**LABEL    9147--CALLALT
NO_INACTIVE_CONTROLLERS_EXIST
      9344**LABEL    9340--CALLALT
NO_INACT_OUTPUT_PENDING
      9329**LABEL    9326--CALLALT
NO_PRINTER_ON_DEVICE IN PROCEDURE PROCESS_DELAYED_STATUS
      9839**LABEL    9834--CALLALT
OBFR$
      8654**DCL      9172<<ASSIGN   9176>>ASSIGN   9180>>ASSIGN   9181>>ASSIGN   9189>>ASSIGN   9191>>ASSIGN
      9194>>CALLBLT  9196>>CALLBLT
OBUF IN PROCEDURE SEND_MSG
     10278**DCL     10300--ASSIGN
OBUF.HEAD.F1 IN PROCEDURE SEND_MSG
     10281**DCL     10301<<ASSIGN
OBUF.HEAD.SELADR IN PROCEDURE SEND_MSG
     10280**DCL     10299<<ASSIGN
OBUF.MSG IN PROCEDURE SEND_MSG
     10282**DCL     10300--ASSIGN  10304<<CALLBLT 10305<<CALLBLT
OLD_INDX IN PROCEDURE ISOLATE_GPOLL_STOPPER
     10127**DCL     10165<<ASSIGN  10174>>DOINDEX
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:206  
OUCH
      9377**LABEL    9373--CALLALT
P7814.INDX IN PROCEDURE PARSE_INPUT
      9559**DCL      9640<<CALLBLT  9645<<CALLBLT  9648>>ASSIGN   9649>>ASSIGN   9649>>ASSIGN   9649>>ASSIGN
P7814.PDENQ IN PROCEDURE PARSE_INPUT
      9558**DCL      9642<<ASSIGN   9647<<ASSIGN
P7814.S IN PROCEDURE PARSE_INPUT
      9561**DCL      9663>>IF
P7814.STATUS IN PROCEDURE PARSE_INPUT
      9560**DCL      9561--REDEF    9648<<ASSIGN
PARSE_INPUT
      9510**PROC     9235--CALL     9287--CALL     9447--CALL     9471--CALL
PDENQ IN PROCEDURE PARSE_INPUT
      9551**DCL      9640>>CALLBLT
PENQ IN PROCEDURE PARSE_INPUT
      9553**DCL      9645>>CALLBLT
PENQ_MSG
      8932**DCL     10437<>CALL
PGOV
      8674**DCL      9250>>IF       9292>>IF       9570<<ASSIGN   9678<<ASSIGN   9774>>IF       9774>>IF
POLADR IN PROCEDURE SEND_NAK
     10235**DCL     10256<<ASSIGN  10259>>CALLBLT
POLLADDR IN PROCEDURE ISOLATE_GPOLL_STOPPER
     10131**DCL     10153<<ASSIGN  10154>>CALLBLT 10161>>CALLBLT 10167>>ASSIGN
POLLX IN PROCEDURE ISOLATE_GPOLL_STOPPER
     10125**DCL     10154<<CALLBLT 10157>>ASSIGN
POLL_ADR_LIST IN PROCEDURE ISOLATE_GPOLL_STOPPER
     10129**DCL     10154>>CALLBLT
POLL_ALL_FINISHED
      9158**LABEL    9159--CALLALT
POLL_INTERVAL
      8669**DCL      9269<<ASSIGN   9271>>IF       9271<<ASSIGN   9272>>IF       9272<<ASSIGN   9273<>CALL
POLL_NAK_COUNT_EXCEEDED
      9473**LABEL    9474--CALLALT
POLSIZ IN PROCEDURE ISOLATE_GPOLL_STOPPER
     10130**DCL     10129--IMP-SIZ 10149<<ASSIGN  10154>>CALLBLT
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:207  
PRINTER_CHECK_INTERVAL
      8929**DCL      9124<>CALL    10427<>CALL
PRINTER_LOOK IN PROCEDURE PARSE_INPUT
      9634**LABEL    9667--EXIT
PROCESS_DELAYED_STATUS
      9829**PROC     9256--CALL     9297--CALL     9448--CALL     9472--CALL
PROCESS_IMMED_STATUS
      9727**PROC     9255--CALL     9296--CALL
SAVCURDEV$ IN PROCEDURE SHIP_POSSIBLE_INPUT
     10323**DCL     10328<<ASSIGN  10368>>ASSIGN
SEARCH_FINDS_NOBODY
      9137**LABEL    9134--CALLALT
SELADR IN PROCEDURE SEND_NAK
     10234**DCL     10255<<ASSIGN  10259>>CALLBLT
SEND_MSG
     10269**PROC    10437--CALL
SEND_NAK
     10227**PROC     9300--CALL     9474--CALL
SEND_NAK_COUNT_EXCEEDED
      9300**LABEL    9300--CALLALT
SETDEV
      9860**PROC     9834--CALL    10327--CALL    10423--CALL
SET_TNOW
     10382**PROC     9122--CALL     9199--CALL     9267--CALL     9320--CALL    10146--CALL
SHIP_POSSIBLE_INPUT
     10309**PROC     9254--CALL     9449--CALL
STA IN PROCEDURE PARSE_INPUT
      9545**DCL      9577<<ASSIGN   9594>>CALLBLT
STABYTES_B
      8939**DCL      9191>>ASSIGN
STABYTES_C IN PROCEDURE PARSE_INPUT
      9548**DCL      9594>>CALLBLT
STA_INDX IN PROCEDURE PARSE_INPUT
      9546**DCL      9594<<CALLBLT  9597<<ASSIGN   9609>>DOCASE
T$ IN PROCEDURE PARSE_INPUT
      9555**DCL      9636<<ASSIGN   9637>>DOWHILE  9638>>IF       9662>>IF       9669<<ASSIGN   9669>>ASSIGN
PL6.E3A0      #001=KZH$HIPIO File=KZH$HIPIO.:E05TSI                              WED 07/30/97 02:53 Page:208  
TEMP_BIT16
      8662**DCL      8663--REDEF
TEMP_UBIN_32
      8658**DCL      8659--REDEF
TIMED_OUT_GUY_IS_LAST
      9421**LABEL    9410--CALLALT  9418--CALLALT
TIMER_CELL IN PROCEDURE CHECK_INTERVAL
     10390**DCL     10388--PROC    10392>>ASSIGN  10396<<ASSIGN
TIME_TO_POLL_ALL
      9137**LABEL    9273--CALLALT
TNOW
      8664**DCL      8665--REDEF    9200>>ASSIGN   9335>>ASSIGN   9364>>ASSIGN  10147>>ASSIGN  10384<>CALL
     10392>>ASSIGN  10396>>ASSIGN
TYP IN PROCEDURE PROCESS_IMMED_STATUS
      9729**DCL      9731<<ASSIGN   9736>>IF
UNKNOWN_BLK_FINISHED IN PROCEDURE PARSE_INPUT
      9689**LABEL    9690--GOTO
UNKNOWN_DEVICE IN PROCEDURE PARSE_INPUT
      9582**LABEL    9579--CALLALT
UNKNOWN_STATUS IN PROCEDURE PARSE_INPUT
      9597**LABEL    9594--CALLALT

PL6.E3A0      #002=KZH$HIPSTT File=KZH$HIPIO.:E05TSI                             WED 07/30/97 02:55 Page:209  
     1409        1        /*T***********************************************************/
     1410        2        /*T*                                                         */
     1411        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1412        4        /*T*                                                         */
     1413        5        /*T***********************************************************/
     1414        6        %EJECT;
PL6.E3A0      #002=KZH$HIPSTT File=KZH$HIPIO.:E05TSI                             WED 07/30/97 02:55 Page:210  
     1415        7        KZH$HIPSTT: PROC(KZ_VDHSTT_V, KZ_HIP_V);
     1416        8
     1417        9        %INCLUDE KZ$3270STT;
     1418       73        %INCLUDE KZ$BSCSTT;
     1419      179        %INCLUDE KZ_HIP_C;
     1420      286        %INCLUDE KH$STT;
     1421      316        %INCLUDE KV$GLB;
     1422      735        %INCLUDE KV_GLBCNS_E;
     1423     1076        %INCLUDE KL_MACRO_C;
     1424     4428        %INCLUDE KZ_HIPTAB_C;
     1425     4670        %INCLUDE KL_AFCN_C;
     1426     4771        %INCLUDE K_ID_E;
     1427     4821        %INCLUDE LCP_6;
     1428     9100
     1429     9101        %K#ENTID_E;
     1430     9120
     1431     9121    1   DCL KZ_VDHSTT_V VECTOR;
     1432     9122    1   DCL KZ_HIP_V VECTOR;
     1433     9123
     1434     9124        %KV$STT;
     1435     9518        %KZ_HIP_HDR(STCLASS=SYMREF);
     1436     9542        %KZ$3270STT;
     1437     9974
     1438     9975    1   DCL KZ_VDHSTT$ PTR SYMREF;
     1439     9976
     1440     9977    1           KZ_VDHSTT_V=VECTOR(KZ_VDHSTT$->KV$STT);
     1441     9978    1           KZ_HIP_V=VECTOR(KZ_HIP_HDR.STTBFR$->KZ$3270STT);
     1442     9979
     1443     9980    1   END;
     1444     9981        %EJECT;
PL6.E3A0      #002=KZH$HIPSTT File=KZH$HIPIO.:E05TSI                             WED 07/30/97 02:55 Page:211  

PL6.E3A0      #002=KZH$HIPSTT File=KZH$HIPIO.:E05TSI                             WED 07/30/97 02:55 Page:212  
--  Include file information  --

   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   K_ID_E.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KZ_HIPTAB_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   KV_GLBCNS_E.:E05TOU  is referenced.
   KV$GLB.:E05TOU  is referenced.
   KH$STT.:E05TOU  is referenced.
   KZ_HIP_C.:E05TOU  is referenced.
   KV$BPC.:E05TOU  is referenced.
   KZ$BSCSTT.:E05TOU  is referenced.
   KZ$3270STT.:E05TOU  is referenced.
      No diagnostics issued in procedure KZH$HIPSTT.

   Procedure KZH$HIPSTT requires 42 words for executable code.
   Procedure KZH$HIPSTT requires 11 words of local(AUTO) storage.

    No errors detected in file KZH$HIPIO.:E05TSI    .

PL6.E3A0      #002=KZH$HIPSTT File=KZH$HIPIO.:E05TSI                             WED 07/30/97 02:55 Page:213  

 Object Unit name= KZH$HIPSTT                                 File name= KZH$HIPIO.:E05TOU
 UTS= JUL 30 '97 02:55:43.76 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0   Proc  even  none    42     2A  KZH$HIPSTT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     0      0   yes            yes      Std        2  KZH$HIPSTT

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
                       nStd      0 X6A_AUTO_2
                       nStd      0 X6A_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KZ_HIP_HDR                            KZ_VDHSTT$                       r    G$ROS$
PL6.E3A0      #002=KZH$HIPSTT File=KZH$HIPIO.:E05TSI                             WED 07/30/97 02:55 Page:214  


     1409        1        /*T***********************************************************/
     1410        2        /*T*                                                         */
     1411        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1412        4        /*T*                                                         */
     1413        5        /*T***********************************************************/
     1414        6        %EJECT;
PL6.E3A0      #002=KZH$HIPSTT File=KZH$HIPIO.:E05TSI                             WED 07/30/97 02:55 Page:215  
     1415        7        KZH$HIPSTT: PROC(KZ_VDHSTT_V, KZ_HIP_V);

      7   0 000000  D380 0000 0000  xent KZH$HIPSTT      LNJ,B5   X6A_AUTO_2
          0 000003       000B 0002                       DC       11,2

     1416        8
     1417        9        %INCLUDE KZ$3270STT;
     1418       73        %INCLUDE KZ$BSCSTT;
     1419      179        %INCLUDE KZ_HIP_C;
     1420      286        %INCLUDE KH$STT;
     1421      316        %INCLUDE KV$GLB;
     1422      735        %INCLUDE KV_GLBCNS_E;
     1423     1076        %INCLUDE KL_MACRO_C;
     1424     4428        %INCLUDE KZ_HIPTAB_C;
     1425     4670        %INCLUDE KL_AFCN_C;
     1426     4771        %INCLUDE K_ID_E;
     1427     4821        %INCLUDE LCP_6;
     1428     9100
     1429     9101        %K#ENTID_E;
     1430     9120
     1431     9121    1   DCL KZ_VDHSTT_V VECTOR;
     1432     9122    1   DCL KZ_HIP_V VECTOR;
     1433     9123
     1434     9124        %KV$STT;
     1435     9518        %KZ_HIP_HDR(STCLASS=SYMREF);
     1436     9542        %KZ$3270STT;
     1437     9974
     1438     9975    1   DCL KZ_VDHSTT$ PTR SYMREF;
     1439     9976
     1440     9977    1           KZ_VDHSTT_V=VECTOR(KZ_VDHSTT$->KV$STT);

   9977   0 000005  EC80 0000 0000  xsym                 LDB,B6   KZ_VDHSTT$
          0 000008  EFC7 0009                            STB,B6   @KZ_HIP_V+3,AUTO
          0 00000A  E870 045F                            LDR,R6   1119,IMO
          0 00000C  EF47 0008                            STR,R6   @KZ_HIP_V+2,AUTO
          0 00000E  ABC7 0008                            LAB,B2   @KZ_HIP_V+2,AUTO
          0 000010  2C00                                 LDV,R2   0
PL6.E3A0      #002=KZH$HIPSTT File=KZH$HIPIO.:E05TSI                             WED 07/30/97 02:55 Page:216  
          0 000011  6C06                                 LDV,R6   6
          0 000012  BCC7 0004                            LDB,B3   @KZ_VDHSTT_V,AUTO
          0 000014  3C00                                 LDV,R3   0
          0 000015  0008                                 MMM

     1441     9978    1           KZ_HIP_V=VECTOR(KZ_HIP_HDR.STTBFR$->KZ$3270STT);

   9978   0 000016  EC80 0000 0006  xsym                 LDB,B6   KZ_HIP_HDR+6
          0 000019  EFC7 0009                            STB,B6   @KZ_HIP_V+3,AUTO
          0 00001B  E870 014B                            LDR,R6   331,IMO
          0 00001D  EF47 0008                            STR,R6   @KZ_HIP_V+2,AUTO
          0 00001F  ABC7 0008                            LAB,B2   @KZ_HIP_V+2,AUTO
          0 000021  2C00                                 LDV,R2   0
          0 000022  6C06                                 LDV,R6   6
          0 000023  BCC7 0006                            LDB,B3   @KZ_HIP_V,AUTO
          0 000025  3C00                                 LDV,R3   0
          0 000026  0008                                 MMM

     1442     9979
     1443     9980    1   END;

   9980   0 000027  C380 0000 0000  xent                 LNJ,B4   X6A_ARET
     1444     9981        %EJECT;
PL6.E3A0      #002=KZH$HIPSTT File=KZH$HIPIO.:E05TSI                             WED 07/30/97 02:55 Page:217  

PL6.E3A0      #002=KZH$HIPSTT File=KZH$HIPIO.:E05TSI                             WED 07/30/97 02:55 Page:218  
--  Include file information  --

   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   K_ID_E.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KZ_HIPTAB_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   KV_GLBCNS_E.:E05TOU  is referenced.
   KV$GLB.:E05TOU  is referenced.
   KH$STT.:E05TOU  is referenced.
   KZ_HIP_C.:E05TOU  is referenced.
   KV$BPC.:E05TOU  is referenced.
   KZ$BSCSTT.:E05TOU  is referenced.
   KZ$3270STT.:E05TOU  is referenced.
      No diagnostics issued in procedure KZH$HIPSTT.
PL6.E3A0      #002=KZH$HIPSTT File=KZH$HIPIO.:E05TSI                             WED 07/30/97 02:55 Page:219  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     6-0-0/w PTR         r     1 @KZ_HIP_V                  4-0-0/w PTR         r     1 @KZ_VDHSTT_V
    *0-0-0/w VECT        r     1 KZ_HIP_V                  *0-0-0/w VECT        r     1 KZ_VDHSTT_V

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(272)   r     1 KZ_HIP_HDR                 0-0-0/w PTR         r     1 KZ_VDHSTT$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(8960)  r     1 KV$STT                     0-0-0/w STRC(2656)  r     1 KZ$3270STT


   Procedure KZH$HIPSTT requires 42 words for executable code.
   Procedure KZH$HIPSTT requires 11 words of local(AUTO) storage.

    No errors detected in file KZH$HIPIO.:E05TSI    .
PL6.E3A0      #002=KZH$HIPSTT File=KZH$HIPIO.:E05TSI                             WED 07/30/97 02:55 Page:220  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=KZH$HIPSTT File=KZH$HIPIO.:E05TSI                             WED 07/30/97 02:55 Page:221  
          MINI XREF LISTING

KV$STT
      9151**DCL      9977--ASSIGN
KV$STT.REQSTATS.DSPMSK
      9397**DCL      9403--REDEF
KV$STT.REQSTATS.SLCMSK
      9438**DCL      9445--REDEF
KZ$3270STT
      9562**DCL      9978--ASSIGN
KZ$3270STT.REQSTATS.DSPMSK
      9833**DCL      9839--REDEF
KZ$3270STT.REQSTATS.SLCMSK
      9874**DCL      9881--REDEF
KZ_HIP_HDR.STTBFR$
      9534**DCL      9978>>ASSIGN
KZ_HIP_V
      9122**DCL         7--PROC     9978<<ASSIGN
KZ_VDHSTT$
      9975**DCL      9977>>ASSIGN
KZ_VDHSTT_V
      9121**DCL         7--PROC     9977<<ASSIGN
