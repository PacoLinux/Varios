VERSION E05

PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:1    
        1        1        /*M*  FMN$OPNF - FILE OPEN ROUTINE.       */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* NSO,MCL=0,MOC,MEC,CLM=12,EXM=12,CRT=6,DMR,PLM=3,IND=3,ENU=0,DCI=3,
        8        8        CSU=3,ECU=3,THI=0,DTI=0,CRM=86 */
        9        9                    /*P*  NAME:        FMN$OPNF
       10       10                    *     PURPOSE:     PRELIMINARY FILE DCB OPEN PROCESS.
       11       11                    */
       12       12                    /**/
       13       13                    /*D*  NAME:        FMN$OPNF
       14       14                    *     CALL:        CALL FMN$OPNF(PN$);
       15       15                    *
       16       16                    *     INPUT:       PN$ IS AN ARRAY OF POINTERS CORRESPONDING TO
       17       17                    *                  THE OPEN FPT VECTORS.
       18       18                    *
       19       19                    *                 B$JIT.DCB$ -> CURRENT DCB
       20       20                    *
       21       21                    *     OUTPUT:     OPEN DCB READY FOR FILE MANAGEMENT SERVICES.
       22       22                    *
       23       23                    *     DESCRIPTION:
       24       24                    *
       25       25                     This routine opens a DCB to a disk file for input, update, create
       26       26                     or journal functions.
       27       27                    */
       28       28                    /**/
       29       29        FMN$OPNF: PROC(PN$);
       30       30                    /**/
       31       31        %INCLUDE F$JIT_C;
       32      461        %MACRO F$DCB#(BASED=BASED);
       33      462        %INCLUDE F$DCB;
       34      511        %MEND;
       35      512        %F$DCB#(BASED="BASED(JDCB$)");
       36      562        %INCLUDE FM$MACROS;
       37      937        %INCLUDE FM_CACHE_C;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:2    
       38     1003        %INCLUDE FM_CACHE_R;
       39     1015        %INCLUDE FM_FIELD_C;
       40     1056        %INCLUDE F_FPTCODE_C;
       41     1092        %INCLUDE F$CP6V_C;
       42     1318        %INCLUDE F$CP6P_C;
       43     1329        %INCLUDE KI$CP6V_C;
       44     1768        %FPT$OPEN_V(BASED="BASED(PN$.V_)");
       45     1783        %FM$CFU(BASED="BASED(CFU$)");
       46     1789        %FM$CFUA(BASED="BASED(ACCT$)");
       47     1795        %FM$CFUEXT(BASED="BASED(ACCT$)");
       48     1799        %FM$CFUF(BASED="BASED(CFU$)");
       49     1802        %FM$CFUJ(BASED="BASED(CFU$)");
       50     1807        %FM$GRAN(BASED="BASED(BUF$)");
       51     1811        %FM$MADKEY(BASED="BASED(KEY$)");
       52     1814        %FM$ADKEY(BASED="BASED(KEY$)");
       53     1817        %FM$KEYENT(BASED="BASED(KEY$)");
       54     1820        %FM$FDSEG(BASED="BASED(SEG$)");
       55     1824        %FM$FDSTOW(BASED="BASED(SEG$)");
       56     1827        %FM$FIT(BASED="BASED(FIT$)");
       57     1830        %CODE01(BASED="BASED(KEY$)");
       58     1834        %CODE02(BASED="BASED(KEY$)");
       59     1838        %CODE03(BASED="BASED(KEY$)");
       60     1845        %CODE04(BASED="BASED(KEY$)");
       61     1853        %CODE06;
       62     1857        %FITALTKEYS(BASED="BASED(KEY$)");
       63     1863        %CODE15(BASED="BASED(KEY$)");
       64     1866        %CODE16(BASED="BASED(KEY$)");
       65     1874        %CODE18(BASED="BASED(KEY$)");
       66     1878        %CODE19(BASED="BASED(KEY$)");
       67     1881        %CODE20(BASED="BASED(KEY$)");
       68     1886        %CODE21(BASED="BASED(KEY$)");
       69     1889        %FM$SET(BASED="BASED(FM$SET$)");
       70     1894        %FMC$CACHE;
       71     1917        %FMG$IRKEYS(FPTN=IRKEYS, STCLASS="BASED(ALTKEY$)");
       72     1924        %FMG$KFIELD(FPTN=KFIELD, STCLASS="BASED(KFIELD$)");
       73     1927        %FM$FIELD_START(FPTN=FM$FIELD_START,STCLASS="BASED(START$)");
       74     1949        %VLP$RECFIELD_V(FPTN=RECFIELD, BASED="BASED(FIELD$)");
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:3    
       75     1986        %VLP$IRREC_V(FPTN=IRREC,BASED="BASED(IRREC$)");
       76     1989        %VLP$FPRG_V(FPTN=VLP$FPRG, BASED="BASED(KEY$)");
       77     2000    1   DCL 1 XTNTS BASED(KEY$), /* FOR MOVING EXTENTS TO THE CFUS AREA */
       78     2001    1         2 * UBIN,
       79     2002    1         2 XTNS,3 * CHAR(J);
       80     2003    1   DCL MOVEJ CHAR(J) BASED;
       81     2004    1   DCL 1 ZAP BASED,
       82     2005    1         2 * CHAR(J) CALIGNED;
       83     2006        %INCLUDE CP_6_SUBS;
       84     2546        %INCLUDE SS_SCHED_C;
       85     2779        %INCLUDE F_ERRORS_C;
       86     3019        %INCLUDE UD_ERRORS_C;
       87     3061        %INCLUDE F_FMTCODE_C;
       88     3095        %INCLUDE JG_GHOSTS_C;
       89     3185        %SUB FCG#='0615'O;
       90     3186        %SUB MID#='16'O;
       91     3187                    /**/
       92     3188                    /* PARAMETER DATA */
       93     3189                    /**/
       94     3190        %FPT$OPEN_P(FPTN=PN$,STCLASS=,PFMT=PTR);
       95     3196                    /**/
       96     3197                    /* AUTOMATIC DATA */
       97     3198                    /**/
       98     3199    1   DCL JDCB$ PTR; /* CURRENT DCB POINTER */
       99     3200    1   DCL PAD$ PTR; /* ACCT DIRECTORY POINTER */
      100     3201    1   DCL FDA SBIN; /* FIT DISK ADDRESS */
      101     3202    1   DCL 1 NXTAR REDEF FDA,
      102     3203    1         2 L UBIN(9)UNAL,
      103     3204    1         2 * CHAR(1),
      104     3205    1         2 C CHAR(1),
      105     3206    1         2 * BIT(9);
      106     3207    1   DCL CFU$ PTR; /* CURRENT CFU POINTER */
      107     3208    1   DCL ACCT$ PTR; /* CURRENT CFUA POINTER */
      108     3209    1   DCL ACCTX SBIN; /* INDEX TO ACCT 6-WORD BLOCK */
      109     3210    1   DCL KEY$ PTR; /* POINTER TO ACCT ENTRY, ETC. */
      110     3211    1   DCL SEG$ PTR; /* POINTER TO SEGMENT AREA OF KEY */
      111     3212    1   DCL BUF$ PTR; /* POINTER TO FD FIT, ETC. */
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:4    
      112     3213    1   DCL I SBIN; /* TEMPORARY INDEX */
      113     3214    1   DCL 1 IB REDEF I,
      114     3215    1         2 FFLG BIT(18),
      115     3216    1         2 * BIT(9),
      116     3217    1         2 FDCM UBIN(9)UNAL;
      117     3218    1   DCL IU REDEF I UBIN;
      118     3219    1   DCL J SBIN; /* TEMPORARY INDEX */
      119     3220    1   DCL FIT$ PTR; /* POINTER TO FIT */
      120     3221    1   DCL EFIT$ REDEF FIT$ EPTR;
      121     3222    1   DCL ERRCODE BIT(36);
      122     3223    1   DCL KFIELD$ PTR;
      123     3224    1   DCL FIELD$ PTR;
      124     3225    1   DCL ALTKEY$ PTR;
      125     3226    1   DCL START$ PTR;
      126     3227    1   DCL IRREC$ PTR;
      127     3228    1   DCL T$ PTR; /* Temp for use as an argument */
      128     3229                    /**/
      129     3230                    /* SYMREF DATA */
      130     3231                    /**/
      131     3232    1   DCL B$JIT$ PTR SYMREF READONLY; /* CURRENT JIT POINTER */
      132     3233    1   DCL B$ROSEG$ PTR SYMREF READONLY; /* Read-only segment pointer */
      133     3234    1   DCL S_CUN UBIN SYMREF; /* CURRENT USER NUMBER */
      134     3235    1   DCL ES_LOGFILEGRANT SBIN SYMREF;
      135     3236    1   DCL ES_LOGFILEDENY SBIN SYMREF;
      136     3237    1   DCL ES_PROTECTSECLOG UBIN SYMREF;
      137     3238        %INCLUDE PC_SUBS_C;
      138     3570        %INCLUDE EL_SUBS_C;
      139     3654        %INCLUDE ES_TABLES_M;
      140     4048        %INCLUDE ES_SUBS_E;
      141     4074        %ES$FILE_ACCESS(NAME=GRANT,STCLASS=CONSTANT,REASON=%ES_PRIV_USER#,GRANTED=YES);
      142     4088        %ES$FILE_ACCESS(NAME=DENY,STCLASS=CONSTANT,REASON=%ES_ACS_DENIED#,GRANTED=NO);
      143     4102    1   DCL FM$BUF$ (0:31) PTR SYMREF; /* FILE MANAGEMENT BUFFERS */
      144     4103    1   DCL F$CFU$ PTR SYMREF; /* TO THE CFU AREA */
      145     4104    1   DCL FM$SET$ PTR SYMREF; /* TO THE SET TABLES */
      146     4105    1   DCL FM_FRZERO SBIN SYMREF; /* START OF FILE */
      147     4106    1   DCL FM_SRZERO UBIN SYMREF;
      148     4107    1   DCL FM_STARCHARS CHAR(12) SYMREF;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:5    
      149     4108    1   DCL FM_SYSACCTX UBIN SYMREF;
      150     4109    1   DCL FM_SYSSETX UBIN SYMREF;
      151     4110    1   DCL 1 FM_OPNS STATIC SYMDEF,
      152     4111    1         2 TOT SBIN INIT(0), /* ATTEMPTS, NOT SCRATCH */
      153     4112    1         2 SLO SBIN INIT(0); /* # NEEDING DIR SRCH */
      154     4113    1   DCL B_TICSDAY UBIN SYMREF;
      155     4114                    /**/
      156     4115                    /* DEFINE EXTERNAL ROUTINES */
      157     4116                    /**/
      158     4117    1   DCL ELA$SYSLOG ENTRY(6) ALTRET;
      159     4118    1   DCL FAF$FRTOSR ENTRY(3)ALTRET; /* COUNT GRANULES IN THE EXTENT LIST */
      160     4119    1   DCL FAG$GEXT ENTRY ALTRET; /* GET INITIAL EXTENT FOR THE FILE */
      161     4120    1   DCL FAG$G1DIR ENTRY(1) ALTRET; /* GET GRANULE FOR AFIT */
      162     4121    1   DCL FMD$FLSHBUF ENTRY(1); /* FLUSH CURRENT BUFFER */
      163     4122    1   DCL FMD$RELBUF ENTRY(1); /* RELEASE BUFFER */
      164     4123    1   DCL FMD$WRTSV ENTRY(1); /* WRITE (WAIT) BUT DON'T RELEASE*/
      165     4124    1   DCL FMF$PEOF ENTRY(1); /* POSITION TO EOF */
      166     4125    1   DCL FMG$INIT ENTRY ALTRET; /*INIT KEYED DCB*/
      167     4126    1   DCL FMG$IRSETUP ENTRY(1) ALTRET; /* INIT IREL INFO */
      168     4127    1   DCL FMO$FIELD_START_SETUP ENTRY ALTRET; /* Init FM$FIELD_START */
      169     4128    1   DCL FMG$KEYEXP ENTRY ALTRET;
      170     4129    1   DCL FMH$INIT ENTRY; /*INIT CONSEC DCB*/
      171     4130    1   DCL FMH$JGETPG ENTRY(1) ALTRET; /* ALLOCATE THE JOURNAL BBUF */
      172     4131    1   DCL FMI$INIT ENTRY ALTRET; /* INIT RANDOM DCB */
      173     4132    1   DCL FMJ$INIT ENTRY; /*INIT RELATIVE DCB*/
      174     4133    1   DCL FMN$CHKFLACN ENTRY(1) ALTRET; /* VERIFY FILENAME AND ACCT */
      175     4134    1   DCL FMN$READFIT ENTRY(2)ALTRET; /* READ FIT */
      176     4135    1   DCL FMN$READFITF ENTRY(2)ALTRET;
      177     4136    1   DCL FMN$READFDFIT ENTRY ALTRET; /* READ AND SECCHK FD */
      178     4137    1   DCL FMN$SETX ENTRY(1) ALTRET; /* SET DCB.SETX FROM PASSED PSN */
      179     4138    1   DCL FMO$BLDFIT ENTRY(1) ALTRET; /* BUILD THE FIT GRANULE */
      180     4139    1   DCL FMO$LOCCODE ENTRY(2) ALTRET; /* Find FIT entry */
      181     4140    1   DCL FMO$SECCHK ENTRY(2); /* SECURITY CHECK */
      182     4141    1   DCL FMO$TRNINFO ENTRY(2) ALTRET; /* TRANSFER FPARAM DATA */
      183     4142    1   DCL FMO$UPKACCT ENTRY(2); /* UNPACK ACCT NO. INTO DCB */
      184     4143    1   DCL FMP$CLSERR ENTRY; /* CLOSE AFTER OPEN ERR */
      185     4144    1   DCL FMP$CLSREL ENTRY; /* CLOSE TO RELEASE */
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:6    
      186     4145    1   DCL FMP$RELCFUS ENTRY(1); /* RELEASE THE CFU BLOCKS */
      187     4146    1   DCL FMP$UPFDDESC ENTRY ALTRET;
      188     4147    1   DCL FMQ$SRCHAD ENTRY(2) ALTRET; /* SEARCH ACCOUNT DIRECTORY */
      189     4148    1   DCL FMQ$SRCHFD ENTRY(5) ALTRET; /* SEARCH FILE DIRECTORY */
      190     4149    1   DCL FMR$FN ENTRY(1); /* UNLINK NAME TO ZAP IT */
      191     4150    1   DCL FMR$G8 ENTRY(2) ALTRET; /* GET A CFU ENTRY */
      192     4151    1   DCL FMR$GA ENTRY(2) ALTRET; /* GET A SECONDARY CFU BLOCK */
      193     4152    1   DCL FMR$L8 ENTRY; /* LOCK CFU SEGMENT */
      194     4153    1   DCL FMR$U8 ENTRY; /* UNLOCK CFU SEGMENT */
      195     4154    1   DCL FMS$BLDCFUA ENTRY(4) ALTRET; /* BUILD 8-WORD ACCT BLOCK */
      196     4155    1   DCL FMS$SCANACCT ENTRY ALTRET; /* SEARCH ACCT BLOCKS FOR ENTRY */
      197     4156    1   DCL FMS$SCANNAME ENTRY ALTRET; /* SCAN FOR NAME IN NAME AREA */
      198     4157    1   DCL FMS$SCANNAMENW ENTRY ALTRET; /* SCAN FOR NAME IN NAME AREA NOWAIT */
      199     4158    1   DCL FSA$FSP ENTRY(2)ALTRET; /* Release read-only space */
      200     4159    1   DCL FSA$GSP ENTRY(2)ALTRET;/*GET CODE16 SPACE*/
      201     4160    1   DCL FSB$GETDDF ENTRY(1)ALTRET;/* GET TAB, HEADER, SEQ FOR UR FILES */
      202     4161    1   DCL FSF$FORM ENTRY ALTRET; /* FORM GETTER */
      203     4162    1   DCL HFF$DSIZ ENTRY(2); /* CHECK FPARAM BUFFER SIZE */
      204     4163    1   DCL HFF$TRAPALT ENTRY ALTRET;
      205     4164    1   DCL KCO$INIT ENTRY(4) ALTRET;
      206     4165    1   DCL KQC$TELLJ ENTRY(1) ALTRET;
      207     4166    1   DCL MMV$OPEN ENTRY ALTRET;
      208     4167    1   DCL SSS$SYSTIME ENTRY(1); /* GET CURRENT TIME FOR ACC/MOD */
      209     4168    1   DCL UQB$MENQS ENTRY(1)ALTRET;
      210     4169    1   DCL UQB$MENQX ENTRY(1)ALTRET;
      211     4170    1   DCL UQB$MDEQ ENTRY(1)ALTRET;
      212     4171                    /**/
      213     4172                    /* CONSTANT DATA */
      214     4173                    /**/
      215     4174    1   DCL 1 ORGS(0:15)CONSTANT ALIGNED,
      216     4175    1         2 COMP BIT(1)INIT('1'B*3,'0'B,'1'B,'0'B*0),
      217     4176    1         2 * BIT(2),
      218     4177    1         2 IORG UBIN(6)UNAL INIT(0,
      219     4178    1    %CONSEC#,%KEYED#,%RANDOM#,%UR#,%RELATIVE#,%KEYED#,
      220     4179    1    %RANDOM#,0,%UR#,0,%RANDOM#,0,%KEYED#,0*0),
      221     4180    1         2 MEDIA UBIN(9)UNAL INIT(0,
      222     4181    1   FMTCON#,FMTKEY#,FMTRAN#,FMTCON#,FMTREL#,0*0),
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:7    
      223     4182    1         2 ORG UBIN(9)UNAL INIT(
      224     4183    1    %CONSEC#,%CONSEC#,%KEYED#,%RANDOM#,%UR#,%RELATIVE#,%INDEXED#,%IDS#,
      225     4184    1    %CONSEC#,%SYMB#,%CONSEC#,%CG#,%CONSEC#,%IREL#,%CONSEC#*0);
      226     4185        %ERRCODE(NAME=FMN$E$UNIMP,COD#=%E$UNIMP);
      227     4189        %ERRCODE(NAME=FMN$E$NOFILE,COD#=%E$NOFILE);
      228     4193        %ERRCODE(NAME=FMN$E$FDEOF,COD#=%E$FDEOF);
      229     4197        %ERRCODE(NAME=FMN$E$FILEBUSY,COD#=%E$FILEBUSY);
      230     4201        %ERRCODE(NAME=FMN$E$CREATERR,COD#=%E$CREATERR);
      231     4205        %ERRCODE(NAME=FMN$E$NOCFUS,COD#=%E$NOCFUS);
      232     4209        %ERRCODE(NAME=FMN$E$ADEOF,COD#=%E$ADEOF);
      233     4213        %ERRCODE(NAME=FMN$E$NOACCESS,COD#=%E$NOACCESS);
      234     4217        %ERRCODE(NAME=FMN$E$JRNLERR,COD#=%E$JRNLERR);
      235     4221        %ERRCODE(NAME=FMN$E$SDSEXISTS,COD#=%E$SDSEXISTS);
      236     4225        %ERRCODE(NAME=FMN$E$NEWFILE,COD#=%E$NEWFILE);
      237     4229        %ERRCODE(NAME=FMN$E$NOKEY,COD#=%E$NOKEY);
      238     4233        %ERRCODE(NAME=FMN$E$NOTAUTH,COD#=%E$NOTAUTH);
      239     4237        %ERRCODE(NAME=FMNE$E$CGFILE,COD#=%E$CGFILE);
      240     4241        %ERRCODE(NAME=FMN$E$STOWEDFILE,COD#=%E$STOWEDFILE);
      241     4245        %ERRCODE(NAME=FMN$E$BADALT, COD#=%E$BADALT);
      242     4249        %ERRCODE(NAME=FMN$E$BADJRNL, COD#=%E$BADJRNL);
      243     4253        %ERRCODE(NAME=FMN$E$CREATONLY, COD#=%E$CREATONLY);
      244     4257        %ERRCODE(NAME=FMN$E$CODE,FCG#='0'O,MID#='0'O,SEV#=0,MON#='1'B,COD#=16383);
      245     4261        %ERRCODE(NAME=FMN$E$NOCODE,COD#=0);
      246     4265        %FM_FITCODE(NAME=STOWCODE0,CODE=1,NAW=5,NDW=2);
      247     4268        %FM_FITCODE(NAME=STOWCODE1,CODE=6,NAW=3,NDW=3,ITEMX=2);
      248     4271    1   DCL FM_DFLOPN_V UBIN SYMREF;
      249     4272    1   DCL ZERO REDEF FM_DFLOPN_V UBIN;
      250     4273    1   DCL TESTOPN BIT(36)INIT('00000002'O)CONSTANT;
      251     4274    1   DCL ACSGHST CONSTANT CHAR(8) INIT('JAYS');
      252     4275        %EJECT;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:8    
      253     4276    1      B$JIT.ERR='0'B; /* CLEAR ANY ERROR CODE */
      254     4277                    /*
      255     4278                    *  GET THE DCB ADDRESS
      256     4279                    */
      257     4280    1      JDCB$=B$JIT.DCB$;
      258     4281                    /*D*
      259     4282                     Open begins with function specific operations to determine the
      260     4283                     pack set for this file.  Filenames and Accounts are checked for
      261     4284                     valid characters.  Scratch files fall out here and go on to
      262     4285                    file creation (BNEWFILE). If the first character of the Filename is an
      263     4286                    asterisk, the file is tagged as a 'STAR' file, and proceeds on to
      264     4287                    the file lookup (FINDFIL1).
      265     4288                    */
      266     4289    1      CALL HFF$TRAPALT ALTRET(OPER);
      267     4290    1      CALL FMN$CHKFLACN(JDCB$);
      268     4291    1      IF F$DCB.ACS=%JRNL#
      269     4292    1        AND (F$DCB.FUN=%IN# OR F$DCB.ORG~=%CONSEC# OR F$DCB.DISP=%SCRATCH#
      270     4293    1        OR FPT$OPEN_V.DELETE OR FPT$OPEN_V.OPER)
      271     4294    1      THEN GOTO FMNE$JRNLERR;
      272     4295                    /*E*     ERROR: FMN-E$JRNLERR-E
      273     4296                    *        MESSAGE:Journal protocol incorrect% for %UF%.
      274     4297                    *        MESSAGE1:Journal% %UF% must be CONSEC, not IN, and not SCRATCH.
      275     4298                    *        Its first OPEN must be CREATE. A tape journal must not
      276     4299                    *        have the same name and account as an existing disk file.
      277     4300                    */
      278     4301    2      IF F$DCB.FUN=%CREATE# THEN DO;
      279     4302    2         IF FPT$OPEN_V.OPER.TEST THEN PN$.V_=ADDR(TESTOPN);
      280     4303    2         ELSE PN$.V_=ADDR(ZERO); /* ONLY TEST MATTERS */
      281     4304    3         IF F$DCB.DISP=%SCRATCH# THEN DO;
      282     4305    3            JDCB$->F$DCB.CTG='0'B;
      283     4306    3            CALL FMR$G8(CFU$,ACCTX) ALTRET(FMNE$NOCFUS);
      284     4307                    /*E*     ERROR:  FMN-E$NOCFUS-E
      285     4308                    *        MESSAGE:System table space unavailable% to open %DC%
      286     4309                    */
      287     4310    3            F$DCB.FCD='1'B;
      288     4311    3            F$DCB.CFU$=CFU$;
      289     4312    3            FM$CFU.FUN=%CREATE#;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:9    
      290     4313    3            GOTO SCRATCHOPN;
      291     4314    3            END;
      292     4315    2         END;
      293     4316                    /**/
      294     4317                    /* IN & UPDATE */
      295     4318                    /*D*
      296     4319                     If this is a NXTA request, the Account Directory is searched
      297     4320                     to obtain the actual account desired.  If NXTA is specified and
      298     4321                     NXTF is not specified, the account is placed in the DCB and the
      299     4322                    open process continues, unless the next account has been deleted,
      300     4323                    in which case the time of deletion is returned in DCB.EXPIRE and
      301     4324                    E$NOKEY is returned.
      302     4325                    */
      303     4326    1      IF B$JIT.ERR THEN IF F$DCB.STARX=0 OR NOT FPT$OPEN_V.OPER.NXTF
      304     4327    1         THEN GOTO OPER;
      305     4328    1         ELSE B$JIT.ERR='0'B; /* STAR SECCHK - CATCH IT AFTER NXTF */
      306     4329    1      IF NOT FPT$OPEN_V.OPER.NXTA OR F$DCB.STARF THEN GOTO MAINOPN;
      307     4330    1      IF NOT B$JIT.PRIV.ACTIVE&%SUBBIT(PR_FMSEC#|PR_FMREAD#,0,18) THEN GOTO
              4330               FMNE$NOTAUTH;
      308     4331    1      PAD$=ADDR(FM$SET(JDCB$->F$DCB.SETX));
      309     4332    1      CALL UQB$MENQS(PAD$)ALTRET(OPER);
      310     4333    1      IF FPT$OPEN_V.SRCHCOND.REV AND F$DCB.ACCT=' ' THEN F$DCB.ACCT=BINASC(511);
      311     4334    1   NXTAGAIN:;
      312     4335    1      CALL FMQ$SRCHAD(KEY$,PN$) ALTRET(FMNE$ADEOF);
      313     4336                    /*E*     ERROR:  FMN-E$ADEOF-E
      314     4337                    *        MESSAGE:End of% DP#%SN% account directory reached.
      315     4338                    */
      316     4339    1      CALL FMO$UPKACCT(JDCB$,KEY$);
      317     4340    1      IF PAD$=FM$SET$ THEN F$DCB.PSN=FM$MADKEY.PSN;
      318     4341    1      IF FM$ADKEY.D THEN IF B$JIT.PRIV.ACTIVE&%SUBBIT(PR_FMSEC#|PR_FMREAD#,0,18)
      319     4342    1         THEN F$DCB.EXPIRE=FM$ADKEY.FDSDA;
      320     4343    1         ELSE GOTO NXTAGAIN;
      321     4344    1      CALL  FMD$FLSHBUF(1);
      322     4345    1      CALL UQB$MDEQ(PAD$)ALTRET(OPER);
      323     4346    2      IF PAD$=FM$SET$ THEN DO;
      324     4347    2         IF NOT FPT$OPEN_V.OPER.NXTF AND F$DCB.NAME.L=0 THEN GOTO FMNE$NOFILE;
      325     4348    2         CALL FMN$SETX(F$DCB.PSN)ALTRET(OPER);
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:10   
      326     4349    2         END;
      327     4350        %EJECT;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:11   
      328     4351                    /*
      329     4352                    *  ALL OPENS EXCEPT SCRATCH ENTER HERE
      330     4353                    */
      331     4354    1   MAINOPN:
      332     4355                    /*
      333     4356                    *  GET AN 8-WORD CFU BLOCK
      334     4357                    */
      335     4358    1      CALL FMR$G8(CFU$,ACCTX) ALTRET(FMNE$NOCFUS);
      336     4359    1      F$DCB.FCD='1'B;
      337     4360    1      F$DCB.CFU$=CFU$;
      338     4361    1      FM$CFU.FUN=F$DCB.FUN+4; /* MAKE EVERYBODY WAIT UNTIL OPEN'S DONE */
      339     4362    2      IF JDCB$->F$DCB.STARF THEN DO;
      340     4363    2         F$DCB.FFLG=%FFLG_OWNER#;/* MAKE SURE WE CAN CREATE NEWFILE */
      341     4364    2         FM$CFU.STARX.F=1;
      342     4365    2         FM$CFU.STARX.SYSID=B$JIT.SYSID;
      343     4366    2         ACCT$=ADDR(NIL);
      344     4367    2         GOTO FINDFIL1;
      345     4368    2         END;
      346     4369                    /*D*
      347     4370                     Open looks up the account first in the account CFU segment.
      348     4371                     If it is found there, we may be able to skip the Account Directory
      349     4372                     search and go directly to find the file (FINDFIL).
      350     4373                    */
      351     4374    1   ACNSEARCH:
      352     4375    1      CALL FMS$SCANACCT ALTRET(FINDFIL);
      353     4376    1      IF B$JIT.ERR THEN GOTO OPER;
      354     4377    1      PAD$=ADDR(FM$SET(JDCB$->F$DCB.SETX));
      355     4378                    /*D*  If scanacct found a valid acct block, it altreted to findfil.
      356     4379                     Otherwise, it built a new one for a non-MAD reference, returned the
      357     4380                    address of a partially complete one, or left DCB.SETX zero and NOPed.
      358     4381                    In any such case, a MAD or PAD search is required. */
      359     4382    1      CALL UQB$MENQS(PAD$)ALTRET(OPER);
      360     4383    2      IF JDCB$->F$DCB.SETX=0 THEN DO;
      361     4384    2         F$DCB.PSN=B$JIT.HPSN; /* Use HPSN if not in MAD */
      362     4385    2         CALL FMQ$SRCHAD(KEY$,ADDR(NIL)) ALTRET(NOMAD);
      363     4386    2         F$DCB.PSN=FM$MADKEY.PSN;
      364     4387    2   NOMAD:;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:12   
      365     4388    2         CALL FMD$FLSHBUF(1);
      366     4389    2         CALL UQB$MDEQ(PAD$);
      367     4390    2         CALL FMN$SETX(F$DCB.PSN) ALTRET(OPERNPSN);
      368     4391    2         F$DCB.PSN=' ';
      369     4392    2         GOTO ACNSEARCH;
      370     4393    2         END;
      371     4394    1      ACCT$=PINCRW(F$CFU$,FM$CFU.ACCTX);
      372     4395    1      IF FM$CFUA.FLAGS.EXIST THEN GOTO FINDFILX;
      373     4396                    /*
      374     4397                    *  IT WASN'T FILLED IN WHILE WE WAITED, SO LET'S SEARCH ACCT
      375     4398                    *  DIRECTORY FOR THE ACCOUNT ENTRY.
      376     4399                    */
      377     4400    1      CALL FMQ$SRCHAD(KEY$,ADDR(NIL)) ALTRET(NEWACCT);
      378     4401                    /*
      379     4402                    *  FILL IN FM$CFUA FROM ACCOUNT DIRECTORY ENTRY
      380     4403                    */
      381     4404    2      IF FM$ADKEY.D THEN DO;
      382     4405    2         B$JIT.ERR=FMN$E$NOKEY;
      383     4406    2         GOTO NEWACCT;
      384     4407    2         END;
      385     4408    1      FM$CFUA.FDFITSDA=FM$ADKEY.FDSDA;
      386     4409    1      FM$CFUA.FDCSDA=FM$ADKEY.FDSDA;
      387     4410    1      GOTO FINDFILX;
      388     4411                    /*
      389     4412                    *  FILL IN FM$CFUA FOR A NEW ACCOUNT ENTRY
      390     4413                    */
      391     4414    1   NEWACCT:
      392     4415    1      IF B$JIT.ERR.CODE~=%E$NOKEY OR FPT$OPEN_V.OPER.NXTA THEN GOTO OPERAD;
      393     4416    1      CALL FMN$READFDFIT ALTRET(OPERAD);
      394     4417                    /*
      395     4418                    *  RELEASE ACCT DIRECTORY AND SEARCH FOR FILENAME
      396     4419                    */
      397     4420    1   FINDFILX:;
      398     4421    1      CALL FMD$FLSHBUF(1);
      399     4422    1      CALL UQB$MDEQ(PAD$)ALTRET(OPER);
      400     4423        %EJECT;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:13   
      401     4424                    /*D*
      402     4425                     (FINDFIL)
      403     4426                     Now that open has an account block that it is going to use, it
      404     4427                    does security checking based on the access control flags in the acct
      405     4428                    block entry.  If read or write accounts are associated with the file
      406     4429                    directory for this account,  that security check is done here.
      407     4430                    */
      408     4431    1   FINDFIL:
      409     4432    1      ACCT$=PINCRW(F$CFU$,FM$CFU.ACCTX);
      410     4433    1      CALL FMN$READFDFIT ALTRET(OPER);
      411     4434        %EJECT;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:14   
      412     4435                    /*D*
      413     4436                     (FINDFIL1)
      414     4437                     The user has access to the account specified and open has an
      415     4438                     acct block defining it.  At this point open is ready to look up the
      416     4439                     file that is to be opened.  'STAR' files reenter at this point.
      417     4440                    */
      418     4441    1   FINDFIL1:;
      419     4442    1      B$JIT.ERR='0'B;
      420     4443    1      F$DCB.TYC='0'B;
      421     4444    1      FM$CFU.SHARE=JDCB$->F$DCB.SHARE;
      422     4445    1      IF NOT FPT$OPEN_V.OPER.NXTF THEN GOTO NAMESEARCH;
      423     4446        %EJECT;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:15   
      424     4447                    /*D*
      425     4448                     If this is a 'NXTF' request, open searches the file directory
      426     4449                     for the file actually desired.  Search conditions and 'THISF'
      427     4450                     requests are processed here.  The filename is moved to the DCB, and
      428     4451                    if this is a 'TEST' open without 'FPARAMS', the open process returns
      429     4452                    to the user.  The DCB is not opened.
      430     4453                    */
      431     4454    2      IF NOT F$DCB.STARF THEN DO;
      432     4455    2         IF FM$CFUA.FLAGS.NEW THEN GOTO FMNE$FDEOFA;
      433     4456    2         CALL UQB$MENQS(ACCT$)ALTRET(OPER);
      434     4457    2         END;
      435     4458    1      ELSE NXTAR=F$DCB.NAME;
      436     4459    1      IF FPT$OPEN_V.SRCHCOND.REV AND F$DCB.NAME.L=0 THEN F$DCB.NAME='001777'O;
      437     4460    2      IF NOT F$DCB.STARF OR B$JIT.STAR.DA(0)~=0 THEN DO;
      438     4461    2         CALL FMQ$SRCHFD(ADDR(F$DCB.NAME),KEY$,SEG$,ACCT$,PN$)
      439     4462                    /*E*     ERROR: FMN-E$FDEOF-C
      440     4463                    *        MESSAGE:End of% %AC% file directory reached.
      441     4464                    */
      442     4465    2           ALTRET(FMNE$FDEOF);
      443     4466    2         JDCB$->F$DCB.NAME.L=FM$KEYENT.KLB;
      444     4467    2         JDCB$->F$DCB.NAME.C=FM$KEYENT.TXT;
      445     4468    2         END;
      446     4469    1      ELSE GOTO FMNE$FDEOFA;
      447     4470    2      IF F$DCB.STARF THEN DO; /* INSERT SPECIALS APPROPO */
      448     4471    2         CALL CHKNXT;
      449     4472    2   NXTF0:B$JIT.ERR='0'B;
      450     4473    2         CALL FMN$CHKFLACN(JDCB$) ALTRET(OPERFD);
      451     4474    2         END;
      452     4475    1      IF NOT FPT$OPEN_V.OPER.TEST
      453     4476    1      THEN CALL FMS$SCANNAMENW /* SEE IF WE SHOULD SWITCH CFUS */
      454     4477    2         WHENALTRETURN DO;
      455     4478    2            CALL FMD$FLSHBUF(1);
      456     4479    2            IF NOT F$DCB.STARF THEN CALL UQB$MDEQ(ACCT$)ALTRET(OPER);
      457     4480    2            IF CFU$=F$DCB.CFU$ THEN GOTO NAMESEARCH;
      458     4481    2            CFU$=ADDR(NIL); /* USE FASTPATH FITCHK */
      459     4482    2            GOTO FOUNDIT;
      460     4483    2            END;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:16   
      461     4484    1      GOTO SETCFU;
      462     4485        %EJECT;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:17   
      463     4486                    /*I*   NAME:       CHKLAST,CHKNXT
      464     4487                   *      PURPOSE:    To insert special starfile names in the NXTF sequence.
      465     4488                    *      DESCRIPTION:Does exactly that. Altreturns if it did anything to
      466     4489                    *                  F$DCB.NAME.
      467     4490                    */
      468     4491    1   CHKLAST: PROC ALTRET;
      469     4492    2      IF FPT$OPEN_V.SRCHCOND.REV THEN F$DCB.NAME.C=' ';
      470     4493    2      ELSE F$DCB.NAME.C='*_';
      471     4494    2   CHKNXT: ENTRY ALTRET;
      472     4495    2      I=F$DCB.STARX;
      473     4496    2      F$DCB.STARX=0;
      474     4497    2      IF NOT FPT$OPEN_V.OPER.THISF OR B$JIT.STAR.DA(I)=0 THEN I=0;
      475     4498    3      IF I=0 THEN DO J=1 TO SIZEW(B$JIT.STAR)-1;
      476     4499    3         IF B$JIT.STAR.DA(J)~=0
      477     4500    3         THEN IF (FPT$OPEN_V.SRCHCOND.REV AND
      478     4501    3              (SUBSTR(FM_STARCHARS,J,1)=NXTAR.C AND NXTAR.L>2
      479     4502    3              OR SUBSTR(FM_STARCHARS,J,1)<NXTAR.C)
      480     4503    3              AND SUBSTR(FM_STARCHARS,J,1)>SUBSTR(F$DCB.NAME.C,1))
      481     4504    3              OR (NOT FPT$OPEN_V.SRCHCOND.REV AND
      482     4505    3              SUBSTR(FM_STARCHARS,J,1)>NXTAR.C
      483     4506    3              AND SUBSTR(FM_STARCHARS,J,1)<=SUBSTR(F$DCB.NAME.C,1,1))
      484     4507    4            THEN DO;
      485     4508    4               I=J;
      486     4509    4               CALL INSERT(F$DCB.NAME.C,1,,SUBSTR(FM_STARCHARS,I,1));
      487     4510    4               END;
      488     4511    3         END;
      489     4512    2      IF I=0 THEN RETURN;
      490     4513    2      F$DCB.NAME.L=2;
      491     4514    2      CALL CONCAT(F$DCB.NAME.C,'*',SUBSTR(FM_STARCHARS,I,1));
      492     4515    2      SEG$=ADDR(B$JIT.STAR.DA(I));
      493     4516    2      ALTRETURN;
      494     4517    2   END CHKLAST;
      495     4518        %EJECT;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:18   
      496     4519                    /*D*
      497     4520                     If this is a 'TEST' open (not including 'NXTF') it is treated
      498     4521                    as if it were a non shared first open.  The NAMEX pointer is not set
      499     4522                    in the CFU block, because the CFU will be given away at the end of
      500     4523                    open and so we do not care if the CFU currently describes the file.
      501     4524                    This prevents a 'FILE BUSY' from being returned on a test open.
      502     4525                    */
      503     4526    1   NAMESEARCH:
      504     4527    1      FM_OPNS.TOT=FM_OPNS.TOT+1;
      505     4528    1      IF FPT$OPEN_V.OPER.TEST THEN GOTO FIRSTOPN;
      506     4529                    /*D*
      507     4530                     Open scans the CFU name area for the current filename.  It searches
      508     4531                     to see if it is already open or available without a file directory
      509     4532                     search.  The scan CFU area routine (FMS$SCANNAME) takes the
      510     4533                     alternate return if we are attached to either a shared CFU or we
      511     4534                     have the good information so open does not have to read the file
      512     4535                     directory.  If one of the opens is a create, the two CFU's have
      513     4536                     been linked together.  Thus if a CFU points to us, open still has
      514     4537                     to read the file directory to find the file being opened.  (The
      515     4538                     file defined in the CFU is the one being created, not the one we
      516     4539                     want to open for INPUT.)
      517     4540                     If the file is busy or it exists and the user has specified
      518     4541                    CREATE, ERROR those errors are possibly discovered here and returned
      519     4542                    to the user.
      520     4543                    */
      521     4544    1      CFU$=ADDR(NIL); /* USE FAST PATH FITCHK IF ALTRET FROM SCANCFUS */
      522     4545    1      CALL FMS$SCANNAME ALTRET(FOUNDIT);
      523     4546    2      IF B$JIT.ERR.CODE~=0 THEN DO;
      524     4547    2         IF F$DCB.CFU$->FM$CFU.FITSDA~=0 THEN GOTO FOUNDERR;
      525     4548    2         ELSE GOTO OPER;
      526     4549    2         END;
      527     4550    1      CFU$=F$DCB.CFU$;
      528     4551                    /*D*
      529     4552                     If no mention of this file was found in the CFU area, open must
      530     4553                     now look it up in the file directory of the specified account.  For
      531     4554                     'STAR' files open searches the star file directory (*T).  For
      532     4555                     permanent files open searches the actual account file directory.
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:19   
      533     4556                    */
      534     4557    1   FIRSTOPN:
      535     4558    2      IF JDCB$->F$DCB.STARF THEN DO;
      536     4559    2         IF B$JIT$->B$JIT.STAR.DA(JDCB$->F$DCB.STARX)=0
      537     4560    2         THEN GOTO BNEWFILE;
      538     4561    3         IF JDCB$->F$DCB.STARX~=0 THEN DO;
      539     4562    3            FM$CFU.FITSDA=B$JIT$->B$JIT.STAR.DA(JDCB$->F$DCB.STARX);
      540     4563    3            GOTO FOUNDIT;
      541     4564    3            END;
      542     4565    2         ACCT$=ADDR(NIL);
      543     4566    2         END;
      544     4567    1      ELSE IF FM$CFUA.FLAGS.NEW THEN GOTO BNEWFILE0;
      545     4568    1         ELSE CALL UQB$MENQS(ACCT$)ALTRET(OPER);
      546     4569    2      IF FM$CFUF.ACCNAM=0 THEN DO; /*GOT NEW CTG AFTER LINKING CFUS */
      547     4570    2         B$JIT.ERR=FMN$E$FILEBUSY;
      548     4571    2         GOTO BNEWFILEX;
      549     4572    2         END;
      550     4573    1      FM_OPNS.SLO=FM_OPNS.SLO+1;
      551     4574    1      CALL FMQ$SRCHFD(ADDR(F$DCB.NAME),KEY$,SEG$,ACCT$,PN$)
      552     4575    1        ALTRET(BNEWFILEX);
      553     4576        %EJECT;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:20   
      554     4577                    /*D*
      555     4578                     If the file is not found in the directory, open assumes that a
      556     4579               new file is being created (BNEWFILE). Otherwise open fills in the CFU from
      557     4580               the file directory entry.
      558     4581               */
      559     4582    1   SETCFU:;
      560     4583    1      FDA=FM$FDSEG.FITSDA;
      561     4584    2      IF FM$FDSEG.DESC.DELF THEN DO;
      562     4585    2         IF NOT F$DCB.FFLG&%(~FFLG_NOLIST#&(~FFLG_EXEC#))
      563     4586    3         THEN IF B$JIT.PRIV.ACTIVE.FMREAD THEN DO;
      564     4587    3               F$DCB.FFLG=%FFLG_READ#;
      565     4588    3               F$DCB.PRIVOPN='1'B; /* Just in case we ever log TEST opens */
      566     4589    3               END;
      567     4590    2         IF F$DCB.FFLG&%(~FFLG_NOLIST#&(~FFLG_EXEC#))
      568     4591    3         THEN IF FM$FDSEG.DESC.ARCHIVE THEN DO; /* INACTIVE STOWED HAS NO FIT */
      569     4592    3               CALL HFF$DSIZ(POFFW(ADDR(PN$.FPARAM_),ADDR(PN$.V_)),FDA);
      570     4593    3               IF FDA<SIZEC(CODE06)+8 THEN EXIT;
      571     4594                    /* BUILD FPARAM FOR IT */
      572     4595    3               PN$.FPARAM_->FM$FIT.CODES(0)=STOWCODE0;
      573     4596    3               PN$.FPARAM_->FM$FIT.CODES(1)=STOWCODE1;
      574     4597    3               ADDR(PN$.FPARAM_->FM$FIT.CODES(2))->CODE06=
      575     4598    3                 ADDR(FM$FDSTOW.CODE06)->CODE06;
      576     4599    3               END;
      577     4600    2            ELSE F$DCB.EXPIRE=FDA*512;
      578     4601    2         FDA=0;
      579     4602    2         END;
      580     4603    1      F$DCB.DESC=FM$FDSEG.DESC;
      581     4604    1      CALL FMD$FLSHBUF(1);
      582     4605    1      FM$CFU.FITSDA=FDA;
      583     4606    1      IF NOT F$DCB.STARF THEN CALL UQB$MDEQ(ACCT$)ALTRET(OPER);
      584     4607    1      IF FPT$OPEN_V.OPER.TEST AND PN$.FPARAM_=ADDR(NIL)
      585     4608    1        AND F$DCB.FUN=%IN#
      586     4609    1        AND NOT F$DCB.DESC.NOLIST
      587     4610    1        AND F$DCB.FFLG~=%FFLG_CREATE#
      588     4611    1        AND NOT F$DCB.FFLG.NOLIST THEN GOTO OPERX;
      589     4612                    /* NO NEED TO READ THE FIT IF ONLY NAME IS NEEDED */
      590     4613                    /* AND THE FILE IS NOT NOLIST TO ANYONE */
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:21   
      591     4614                    /* AND THE DIRECTORY IS ACCESSIBLE TO THIS USER */
      592     4615    2      IF FDA=0 THEN DO; /* DELETED OR INACTIVE STOWED (NO FIT) */
      593     4616    2         IF NOT F$DCB.FFLG&%(~FFLG_NOLIST#&(~FFLG_EXEC#)) THEN GOTO NODELFILE;
      594     4617    2         IF F$DCB.FUN=%CREATE# AND B$JIT.PRIV.ACTIVE.FMEFT
      595     4618    2           AND FPT$OPEN_V.OVERFDE THEN GOTO BNEWFILE0;
      596     4619    2         F$DCB.FFLG='0'B;
      597     4620    2         IF F$DCB.FUN~=%IN# THEN GOTO FMNE$STOWEDFILE;
      598     4621    2         IF FPT$OPEN_V.OPER.TEST THEN GOTO OPERX;
      599     4622    2         IF NOT B$JIT.PRIV.ACTIVE.FMEFT THEN GOTO FMNE$STOWEDFILE;
      600     4623                    /*E*     ERROR:  FMN-E$STOWEDFILE-E
      601     4624                    *        MESSAGE:File% %UF% is stowed inactive or deleted.
      602     4625                    *        MESSAGE1:EFT must be the opener of inactive or deleted files.
      603     4626                    *                 You tried to open% %DC% to one of them% (%UF)%.
      604     4627                    */
      605     4628    2         FM$CFU.FUN=%IN#;
      606     4629    2         GOTO OPER2;
      607     4630    2         END;
      608     4631    1   FOUNDIT:
      609     4632    1      IF F$DCB.FUN=%CREATE#
      610     4633    1      THEN IF F$DCB.EXIST=%ERROR# THEN B$JIT.ERR=FMN$E$CREATERR;
      611     4634                    /*E*     ERROR:  FMN-E$CREATERR-E
      612     4635                    *        MESSAGE:File% %FN% exists.
      613     4636              *        MESSAGE1:EXIST=ERROR specified to create file% %FN%, but it exists.
      614     4637              */
      615     4638    1         ELSE F$DCB.FEXT=B$JIT.FEXT(F$DCB.FEXTX);
      616     4639                    /*D*
      617     4640                     Open now reads the FIT of the file and performs all of the file
      618     4641                     access security checks.  If the user has access to the file, the
      619     4642                     open continues.  Otherwise a security violation error is returned
      620     4643                     to the user.  FPARAMS are returned here if requested.
      621     4644                    */
      622     4645    1   FOUNDERR:;
      623     4646    1      ERRCODE=B$JIT.ERR; /* SAVE ERROR IN CASE SECCHK DOESNT ALTRET */
      624     4647    1      B$JIT.ERR='0'B;
      625     4648    1      IF CFU$=F$DCB.CFU$ THEN EFIT$=ENTADDR(FMN$READFIT);
      626     4649    1      ELSE EFIT$=ENTADDR(FMN$READFITF); /* FAST PATH FITCHK */
      627     4650    1      CFU$=JDCB$->F$DCB.CFU$;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:22   
      628     4651    1      CALL ENQFIT ALTRET(OPER);
      629     4652    1      FDA=FM$CFU.FITSDA;
      630     4653    1      CALL EFIT$(BUF$,FDA)ALTRET(BADFIT);
      631     4654    1      IF NOT F$DCB.STARF THEN F$DCB.OWNER=FM$CFUA.ACCESS.OWNERF;
      632     4655    1      IB.FFLG=F$DCB.FFLG;
      633     4656    1      IB.FDCM=F$DCB.FDCM;
      634     4657    1      FIT$=PINCRW(BUF$,SIZEW(FM$GRAN));
      635     4658    1      CALL FMO$SECCHK(FPT$OPEN_V,FM$FIT);
      636     4659    1      IF NOT F$DCB.FFLG THEN
      637     4660    2         IF B$JIT.ERR.CODE=%E$NOFILE THEN DO;
      638     4661    2            F$DCB.FFLG=IB.FFLG;
      639     4662    2            F$DCB.FDCM=IB.FDCM;
      640     4663    2   NODELFILE:;
      641     4664    2            IF F$DCB.FUN=%CREATE# THEN B$JIT.ERR=FMN$E$CREATONLY;
      642     4665                    /*E*     ERROR: FMN-E$CREATONLY-E
      643     4666                             MESSAGE:Nolist file% %FN% exists.
      644     4667                             MESSAGE1:You cannot create the file% %UF%
      645     4668                                      because it exists, but is not listable by you.
      646     4669                    */
      647     4670    2            ELSE B$JIT.ERR=FMN$E$NOFILE;
      648     4671    3            IF FPT$OPEN_V.OPER.NXTF THEN DO;
      649     4672    3               CALL FMD$FLSHBUF(1);
      650     4673    3               I=FM$CFU.ACCTX;
      651     4674    3               CALL FMR$G8(CFU$,ACCTX)ALTRET(FMNE$NOCFUS);
      652     4675    3               FM$CFU.ACCTX=I;
      653     4676    3               FM$CFU.FUN=F$DCB.FUN+4;
      654     4677    3               CALL FMP$RELCFUS(F$DCB.CFU$);
      655     4678    3               F$DCB.CFU$=CFU$;
      656     4679    4               IF FPT$OPEN_V.SRCHCOND.REV THEN DO;
      657     4680    4                  I=F$DCB.NAME.L-1;
      658     4681    4                  CALL INSERT(F$DCB.NAME.C,I+1,30-I,BINASC(511));
      659     4682    4                  CALL INSERT(F$DCB.NAME.C,I,1,BINASC(ASCBIN(SUBSTR(F$DCB.NAME.C,I,1))-
              4682                           1));
      660     4683    4                  END;
      661     4684    3               F$DCB.NAME.L=F$DCB.NAME.L+1;/* DONT STOP HERE AGAIN (THISF)*/
      662     4685    3               GOTO FINDFIL1;
      663     4686    3               END;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:23   
      664     4687    2            ELSE GOTO BNEWFILE0;
      665     4688    2            END;
      666     4689    1         ELSE IF B$JIT.ERR.CODE=%E$QSTOW AND FPT$OPEN_V.OVERFDE AND NOT ERRCODE
      667     4690    2              AND B$JIT.PRIV.ACTIVE.FMEFT AND F$DCB.FUN=%CREATE# THEN DO;
      668     4691    2               F$DCB.FFLG=F$DCB.AUTHFFLG;
      669     4692    2               B$JIT.ERR='0'B;
      670     4693    2               GOTO BNEWFILE0;
      671     4694    2               END;
      672     4695    1            ELSE GOTO OPER;
      673     4696    1      IF SUBSTR(F$DCB.NAME.C,0,7)=':SECLOG' AND FM$CFU.ACCTX=FM_SYSACCTX
      674     4697    1        AND S_CUN > %JG_ELF#
      675     4698    2      THEN DO;
      676     4699    2         I=4; CALL LOC_CODE;
      677     4700    2         CALL SSS$SYSTIME(I);
      678     4701    2         IF IU<CODE04.CREATION.TIME+ES_PROTECTSECLOG OR ES_PROTECTSECLOG<B_TICSDAY
      679     4702    2         THEN IF F$DCB.FFLG.READ THEN F$DCB.FFLG=%FFLG_READ#;
      680     4703    2            ELSE GOTO FMNE$NOACCESS;
      681     4704    2         END;
      682     4705    2      IF ERRCODE THEN DO;
      683     4706    2         B$JIT.ERR=ERRCODE;
      684     4707    2         GOTO OPER;
      685     4708    2         END;
      686     4709    1      IF F$DCB.GHSTACS~=0 AND
      687     4710    1        NOT(FPT$OPEN_V.OPER.TEST AND F$DCB.GHSTACS=%JRNLOPN#) THEN
      688     4711    1         CALL GHSTACS ALTRET(OPER);
      689     4712    1      IF PN$.FPARAM_~=ADDR(NIL)
      690     4713    1      THEN CALL FMO$TRNINFO(PN$.FPARAM_,FIT$)  ALTRET(OPER);
      691     4714                    /*D*
      692     4715                     If this is a CREATE open and the file already exists, open
      693     4716                     processes the EXIST options at this point.  The EXIST options are
      694     4717                     handled in the following manner.
      695     4718                     EXIST=ERROR              Return an error to the user.
      696     4719                    *
      697     4720                     EXIST=NEWFILE            If this is a system 'OPLABEL' DCB
      698     4721                     or user defined equivalent, and the
      699     4722                     FEXT bit is set in the JIT, treat the
      700     4723                     option as if it were OLDFILE. Other-
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:24   
      701     4724                     wise go to create a new file (BNEWFILE).
      702     4725                    *
      703     4726                     EXIST=OLDFILE            The open is handled as an update
      704     4727                     open rather than a create open.  The
      705     4728                     DCB is opened to the existing file
      706     4729                     in an update manner, and the file is
      707     4730                     positioned to the end (EOF) before
      708     4731                     returning to the user.
      709     4732                    */
      710     4733    2      IF F$DCB.FUN=%CREATE# THEN DO;
      711     4734    2         IF F$DCB.EXIST=%NEWFILE#
      712     4735    3           AND NOT F$DCB.FEXT THEN DO;
      713     4736    3            IF F$DCB.ASN=%TAPE# THEN GOTO FMNE$JRNLERR;
      714     4737    3            I=3; CALL LOC_CODE;
      715     4738    3            JDCB$->F$DCB.BORROW=CODE03.UGRANS+CODE03.NGAVAL;
      716     4739    3            IF FM$CFU.FUN<7 AND S_CUN~=JG_JAYS# THEN EXIT;
      717     4740    3            FM$CFU.FUN=7; /* JAYS MAY BE CREATING OVER AHALF-OPEN CFU */
      718     4741    3            GOTO BNEWFILE;
      719     4742    3            END;
      720     4743                    /*
      721     4744                    *  IF OLDFILE IS SPECIFIED THEN OPEN FUNCTION IS SWITCHED TO
      722     4745                    *  UPDATE AND THIS FILE IS OPENED.
      723     4746                    */
      724     4747    2         JDCB$->F$DCB.FEXT='1'B;
      725     4748    2         END;
      726     4749                    /*D*
      727     4750                     Now open has the file it is going to open and the mode of the
      728     4751                     open.  All that remains to do is to move the FIT information to
      729     4752                     the DCB and (if necessary) to the CFU.  First open moves the FIT
      730     4753                     information to the DCB.  If this was a TEST open, then the process
      731     4754                     is complete and open returns to the user without opening the DCB.
      732     4755                     If the CFU has already been filled in, (i. e. this user is
      733     4756                     not the first opener of the file), the open process is complete.
      734     4757                     If this user is the first opener of the file, the CFU is filled in,
      735     4758                     the extent list is moved to the CFU area, and the open process is
      736     4759                     completed.
      737     4760                    */
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:25   
      738     4761    1      JDCB$->F$DCB.HASH=FM$GRAN.STAMP.HASH;
      739     4762                    /*
      740     4763                    *  NOW MOVE KEYED FILE INFORMATION IF IT EXISTS IN THE FIT
      741     4764                    */
      742     4765    1      I=2; CALL LOC_CODE ALTRET(NXTCODE);
      743     4766                    /**/
      744     4767    1      JDCB$->F$DCB.LSLIDE=CODE02.LSLIDE;
      745     4768    1      JDCB$->F$DCB.LRDL0=CODE02.LRDL0;
      746     4769    1      JDCB$->F$DCB.SPARE=CODE02.SPARE;
      747     4770    1      F$DCB.TDALVL=CODE02.TDALVL;
      748     4771    1      JDCB$->F$DCB.TDA=CODE02.TDA;
      749     4772    1      JDCB$->F$DCB.KEYX=CODE02.KEYX;
      750     4773    1      JDCB$->F$DCB.KEYL=CODE02.KEYL;
      751     4774                    /**/
      752     4775                    /*
      753     4776                    *  MOVE FORM AND DDEV TO DCB IF IT EXISTS IN THE FIT.
      754     4777                    */
      755     4778    1   NXTCODE:
      756     4779    2      IF F$DCB.ALTKEYX~=0 THEN DO;
      757     4780    2         SEG$=PINCRW(B$ROSEG$,F$DCB.ALTKEYX);
      758     4781    2         J=SEG$->FITALTKEYS.NUMWRDS;
      759     4782    2         CALL FSA$FSP(J,SEG$);
      760     4783    2         F$DCB.ALTKEYX=0;
      761     4784    2         END;
      762     4785    1      I=8; CALL LOC_CODE ALTRET(NXTCODE16);
      763     4786    1      J=FM$FIT.CODES.NDW(I);
      764     4787    1      IF J < 7 THEN GOTO NXTCODE16; /* Min word size for FITALTKEYS */
      765     4788    1      CALL FSA$GSP(J,SEG$) ALTRET(OPER);
      766     4789    1      J=J*4;
      767     4790    1      SEG$->MOVEJ=KEY$->MOVEJ;
      768     4791    2      IF FM$CFU.USECNT = 1 THEN DO;
      769     4792    2         FM$CFU.ALTBLD=SEG$->FITALTKEYS.ALTBLD;
      770     4793    2         F$DCB.UNIQUEBLD=SEG$->FITALTKEYS.UNIQUEBLD;
      771     4794    2         END;
      772     4795    1      F$DCB.ALTKEYX=POFFW(SEG$,B$ROSEG$);
      773     4796                    /**/
      774     4797    1   NXTCODE16: ;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:26   
      775     4798    1      I=16; CALL LOC_CODE ALTRET(NXTCODE17);
      776     4799    1      IF F$DCB.FORM$=ADDR(NIL) THEN CALL FSA$GSP(SIZEW(CODE16),F$DCB.FORM$)
      777     4800    1           ALTRET(OPER);
      778     4801    1      F$DCB.FORM$->CODE16=CODE16;
      779     4802    2      IF F$DCB.FUN~=%IN# THEN DO;
      780     4803    2         F$DCB.FEXT=%YES#;
      781     4804    2         I=11; CALL LOC_CODE ALTRET(NXTCODE17);
      782     4805    2         CALL FSB$GETDDF(KEY$)ALTRET(OPER);
      783     4806    2         END;
      784     4807    1   NXTCODE17: ;
      785     4808    2      IF F$DCB.FPRGX~=0 THEN DO;
      786     4809    2         CALL FSA$FSP (SIZEW(VLP$FPRG), PINCRW(B$ROSEG$,F$DCB.FPRGX));
      787     4810    2         F$DCB.FPRGX=0;
      788     4811    2         END;
      789     4812    1      I=17; CALL LOC_CODE ALTRET(NXTCODE18);
      790     4813    1      CALL FSA$GSP (SIZEW(VLP$FPRG), SEG$) ALTRET(OPER);
      791     4814    1      F$DCB.FPRGX=POFFW(SEG$, B$ROSEG$);
      792     4815    1      SEG$->VLP$FPRG=KEY$->VLP$FPRG;
      793     4816                    /* */
      794     4817                    /*     MOVE FIELD AND INDEXED RELATION DATA FROM FIT */
      795     4818                    /* */
      796     4819    1   NXTCODE18: ;
      797     4820    2      IF F$DCB.FIELDX~=0 THEN DO;
      798     4821    2         FIELD$=PINCRW(B$ROSEG$, F$DCB.FIELDX);
      799     4822    2         J=(RECFIELD.NFIELDS+1)/2 + 1;
      800     4823    2         CALL FSA$FSP(J, FIELD$);
      801     4824    2         F$DCB.FIELDX=0;
      802     4825    2         END;
      803     4826    2      IF F$DCB.STARTX~=0 THEN DO;
      804     4827    2         START$=PINCRW(B$ROSEG$,F$DCB.STARTX);
      805     4828    2         J=FM$FIELD_START.NWORDS;
      806     4829    2         CALL FSA$FSP(J, START$);
      807     4830    2         F$DCB.STARTX=0;
      808     4831    2         END;
      809     4832    1      I=18; CALL LOC_CODE ALTRET(NXTCODE19);
      810     4833    1      J=(CODE18.NFIELDS+1)/2 + 1;
      811     4834    1      CALL FSA$GSP(J, FIELD$) ALTRET(OPER);
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:27   
      812     4835    1      J=J*4;
      813     4836    1      FIELD$->MOVEJ=KEY$->MOVEJ;
      814     4837    1      F$DCB.FIELDX=POFFW(FIELD$, B$ROSEG$);
      815     4838
      816     4839    1      CALL FMO$FIELD_START_SETUP ALTRET(OPER);
      817     4840                    /* */
      818     4841    1   NXTCODE19: ;
      819     4842    2      IF F$DCB.KFIELDX~=0 THEN DO;
      820     4843    2         KFIELD$=PINCRW(B$ROSEG$, F$DCB.KFIELDX);
      821     4844    2         J=KFIELD.NWORDS;
      822     4845    2         CALL FSA$FSP(J, KFIELD$);
      823     4846    2         F$DCB.KFIELDX=0;
      824     4847    2         END;
      825     4848
      826     4849    1      I=19; CALL LOC_CODE ALTRET(NXTCODE21);
      827     4850    1      CALL FMG$IRSETUP(CODE19) ALTRET(OPER);
      828     4851                    /* */
      829     4852    1      I=20; CALL LOC_CODE ALTRET(NXTCODE21);
      830     4853    1      ALTKEY$=PINCRW(B$ROSEG$, F$DCB.ALTKEYX);
      831     4854
      832     4855    1      IRKEYS.ALTBLD=CODE20.ALTBLD;
      833     4856    1      IRKEYS.UNIQUEBLD=CODE20.UNIQUEBLD;
      834     4857
      835     4858    2      DO J=0 TO CODE20.NKEYS-1;
      836     4859    2         IRKEYS.K.TDALVL(J)=CODE20.K.TDALVL(J);
      837     4860    2         IRKEYS.K.TDA(J)=CODE20.K.TDA(J);
      838     4861    2         IRKEYS.K.FDA(J)=CODE20.K.FDA(J);
      839     4862    2         IRKEYS.K.LDA(J)=CODE20.K.LDA(J);
      840     4863    2         END;
      841     4864
      842     4865    2      IF FM$CFU.USECNT = 1 THEN DO;
      843     4866    2         FM$CFU.ALTBLD=CODE20.ALTBLD;
      844     4867    2         F$DCB.UNIQUEBLD=CODE20.UNIQUEBLD;
      845     4868    2         END;
      846     4869                    /**/
      847     4870    1   NXTCODE21:;
      848     4871    2      IF F$DCB.IRRECX~=0 THEN DO;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:28   
      849     4872    2         IRREC$=PINCRW(B$ROSEG$,F$DCB.IRRECX);
      850     4873    2         J=(IRREC.NFIELDS+3)/4 + 1;
      851     4874    2         CALL FSA$FSP(J, IRREC$);
      852     4875    2         F$DCB.IRRECX=0;
      853     4876    2         END;
      854     4877
      855     4878    1      I=21; CALL LOC_CODE ALTRET(NXTCODE1);
      856     4879    1      J=(CODE21.NFIELDS+3)/4 +1;
      857     4880    1      CALL FSA$GSP(J, IRREC$) ALTRET(OPER);
      858     4881    1      J=J*4;
      859     4882    1      IRREC$->MOVEJ=KEY$->MOVEJ;
      860     4883    1      F$DCB.IRRECX=POFFW(IRREC$, B$ROSEG$);
      861     4884                    /**/
      862     4885                    /*
      863     4886                    *  MOVE BASIC FILE INFORMATION FROM THE FIT
      864     4887                    */
      865     4888    1   NXTCODE1:
      866     4889    1      I=15; CALL LOC_CODE ALTRET(NXTCODE3);
      867     4890    1      F$DCB.IFMT=CODE15.CGORG;
      868     4891    1      F$DCB.QISS=CODE15.QISS;
      869     4892    1   NXTCODE3:;
      870     4893    1      I=3; CALL LOC_CODE;
      871     4894                    /**/
      872     4895    1      F$DCB.DESC=CODE03.DESC;
      873     4896    1      IF FM$CFU.SHARED AND F$DCB.DESC.BUPM THEN F$DCB.DESC.BUF='1'B;
      874     4897                    /* Non-initial opens for update need to have BUF on in the DCB,
      875     4898                       so that the eventual closer moves it to FIT if update happens */
      876     4899    1      F$DCB.ORG=CODE03.ORG;
      877     4900    1      F$DCB.IORG=ORGS.IORG(F$DCB.ORG);
      878     4901    1      F$DCB.IXTNSIZE=MOD(CODE03.UGRANS+CODE03.NGAVAL,67108864);
      879     4902    1      F$DCB.ARS=CODE03.RCSZ*4096+4096;
      880     4903    1      F$DCB.TYPE=CODE03.TYPE;
      881     4904    1      F$DCB.EXPIRE=CODE03.EXPIRE;
      882     4905    2      IF F$DCB.IORG~=%RANDOM# THEN DO;
      883     4906    2         JDCB$->F$DCB.XTNSIZE=CODE03.XTNSIZE;
      884     4907    2         JDCB$->F$DCB.COMP=CODE03.COMP;
      885     4908    2         JDCB$->F$DCB.NRECS=CODE03.NRECS;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:29   
      886     4909    2         JDCB$->F$DCB.RECL=CODE03.RECL;
      887     4910    2         END;
      888     4911    2      IF F$DCB.ACS=%JRNL# THEN DO;
      889     4912    2         IF NOT F$DCB.FFLG&%FFLG_WNEW# THEN GOTO FMNE$NOACCESS;
      890     4913    2         IF F$DCB.ORG~=%CONSEC# THEN GOTO FMNE$JRNLERR;
      891     4914    2         IF F$DCB.DESC.BAD
      892     4915    2           AND S_CUN>%JG_MING# AND NOT B$JIT.PRIV.ACTIVE.FMSEC
      893     4916    2         THEN GOTO FMNE$BADJRNL;
      894     4917                    /*E*   ERROR:  FMN-E$BADJRNL-E
      895     4918                           MESSAGE:Journal file% %UF% is broken, open not allowed
      896     4919                           MESSAGE1:Journal file% %UF% has been damaged by a
      897     4920                                    system error.  Opens are not allowed without FMSEC.
      898     4921                    */
      899     4922    2         END;
      900     4923    1      ELSE FM$CFU.B=BITBIN(F$DCB.DESC.BAD);
      901     4924                    /**/
      902     4925    1      IF FPT$OPEN_V.OPER.TEST
      903     4926    1      THEN GOTO OPERX; /* TEST OPEN IS DONE */
      904     4927                    /*
      905     4928                    *  SET THE DATES IN THE FIT
      906     4929                    */
      907     4930    1   JRNLXIT:;
      908     4931    1      CALL FMR$L8; /* BUT ONLY FOR THE FIRST OPEN */
      909     4932    2      IF F$DCB.SHARED THEN DO; /* CHECK THAT WE CAN STILL SHARE THE FILE */
      910     4933    2         F$DCB.SHARED='0'B;
      911     4934    2         IF F$DCB.FUN~=%IN# AND FM$CFU.SHARE~=%ALL# THEN GOTO FMNE$FILEBUSY;
      912     4935    2         IF F$DCB.SHARE~=%ALL#
      913     4936    2         THEN IF FM$CFU.FUN=%UPDATE# THEN GOTO FMNE$FILEBUSY;
      914     4937                    /* SOMEBODY JUMPED IN SHARING */
      915     4938    2            ELSE FM$CFU.SHARE=%IN#;/* KEEP 'EM OUT */
      916     4939    2         IF F$DCB.FUN~=%IN#
      917     4940    3         THEN IF F$DCB.FFLG&%FFLG_UPFLGS# THEN DO;
      918     4941    3               IF FM$CFU.XTX~=0
      919     4942    3               THEN IF PINCRW(F$CFU$,FM$CFU.XTX)->FM$CFUEXT.UPDCNT=4095
      920     4943    3                  THEN GOTO FMNE$NOCFUSA;
      921     4944    3                  ELSE PINCRW(F$CFU$,FM$CFU.XTX)->FM$CFUEXT.UPDCNT=
      922     4945    3                       PINCRW(F$CFU$,FM$CFU.XTX)->FM$CFUEXT.UPDCNT+1;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:30   
      923     4946    3               F$DCB.UPDCNT='1'B;
      924     4947    3               FM$CFU.FUN=%UPDATE#;
      925     4948    3               END;
      926     4949    2            ELSE IF FM$CFU.FUN=%IN# THEN FM$CFU.SHARE=%ALL#;
      927     4950    2         END;
      928     4951    2      IF F$DCB.ACS=%JRNL# THEN DO;
      929     4952    3         IF FM$CFUJ.USER~=0 THEN DO;
      930     4953    4            IF FM$CFUJ.TAPE THEN DO;
      931     4954    4               F$DCB.ASN=%TAPE#;
      932     4955    4               F$DCB.IASN=%TAPE#;
      933     4956    4               END;
      934     4957    4            ELSE DO;
      935     4958    4               F$DCB.ASN=%FILE#;
      936     4959    4               F$DCB.IASN=%FILE#;
      937     4960    4               END;
      938     4961    3            F$DCB.OWNER='0'B;
      939     4962    3            F$DCB.FEXT='0'B;
      940     4963    3            F$DCB.FFLG=%FFLG_WNEW#;
      941     4964    3            END;
      942     4965    3         ELSE DO;
      943     4966    3            F$DCB.OWNER='1'B;
      944     4967    3            F$DCB.FEXT='1'B;
      945     4968    3            F$DCB.FFLG=F$DCB.FFLG&(%FFLG_WNEW#|%FFLG_DELF#|%FFLG_REATTR#);
      946     4969    3            FM$CFUJ.DMAIN=F$DCB.WSR;
      947     4970    3            IF F$DCB.ASN=%TAPE# THEN FM$CFUJ.TAPE='1'B;
      948     4971    3            FM$CFUJ.DCB#=B$JIT.DCBNO;
      949     4972    3            FM$CFU.FUN=%JRNL#;
      950     4973    3            FM$CFUJ.USER=S_CUN;
      951     4974    3            END;
      952     4975    3         IF F$DCB.ASN = %TAPE# THEN DO;
      953     4976    3            CALL FMR$U8;
      954     4977    3            RETURN;
      955     4978    3            END;
      956     4979    2         END;
      957     4980    1      I=4; CALL LOC_CODE ALTRET(NOCODE04);
      958     4981    1      IF F$DCB.WSR<2 AND F$DCB.FUN=%IN# THEN F$DCB.EXPIRE=CODE04.MODIFY.TIME;
      959     4982    1   NOCODE04:;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:31   
      960     4983    2      IF FM$CFU.XTX=0 THEN DO;
      961     4984    2         IF NOT F$DCB.FFLG&%FFLG_UPFLGS# THEN FM$CFU.FUN=%IN#;
      962     4985    2         ELSE IF FM$CFU.FUN>4 THEN FM$CFU.FUN=%UPDATE#;
      963     4986                    /* IF THIS DCB CAN'T UPDATE, DONT TIE UP THE FILE */
      964     4987    2         IF FM$CFU.FUN~=%IN# OR FM$CFU.SHARE=%ALL# THEN FM$CFU.SHARED='1'B;
      965     4988    2         IF CODE04.SVMODIFY AND KEY$~=FIT$ THEN F$DCB.RA='1'B;
      966     4989    2         IF B$JIT.PRIV.ACTIVE.FMEFT AND FM$CFU.FUN=%IN# THEN GOTO FILLCFU;
      967     4990    2         END;
      968     4991    2      ELSE IF NOT FM$CFU.SHARED OR CODE04.SVMODIFY THEN DO;
      969     4992    2            IF F$DCB.IORG~=%RANDOM# THEN F$DCB.NRECS = FM$CFU.NRECS;
      970     4993    2            F$DCB.IXTNSIZE = FM$CFU.UGRANS+FM$CFU.NGAVAL;
      971     4994    2            GOTO SHREXIT;
      972     4995    2            END;
      973     4996    1      IF KEY$=FIT$ THEN GOTO FILLCFU;
      974     4997    1      CALL SSS$SYSTIME(I);
      975     4998    1      CODE04.ACCESS.TIME=I;
      976     4999    2      IF FM$CFU.SHARED THEN DO;
      977     5000    2         CODE04.SVMODIFY.TIME=CODE04.MODIFY.TIME;
      978     5001    2         CODE04.MODIFY.TIME=I;
      979     5002    2         END;
      980     5003    1      ELSE IF FM$CFUA.ACCESS.NOACUP THEN GOTO FILLCFU;
      981     5004    1      F$DCB.BFR.BUFUP(1)='1'B;
      982     5005    1   FILLCFU:
      983     5006    1      IF FM$CFU.XTX~=0 THEN GOTO NXTCOD1;
      984     5007                    /*
      985     5008                    *  MOVE FIT INFORMATION TO THE CFU
      986     5009                    *
      987     5010                    *  FILL IN THE EXTENT LIST FOR THIS FILE
      988     5011                    */
      989     5012    1      KEY$=PINCRW(FIT$,FM$FIT.CODES.ITEMX(1));
      990     5013    1      I=FM$FIT.CODES.NDW(1)-1;
      991     5014    2      IF FM$GRAN.LVL=6 THEN DO;
      992     5015    2         FM$CFU.AFIT=1;
      993     5016    2         JDCB$->F$DCB.BFR.DA(1)=FM$CFU.FITSDA;
      994     5017    2         END;
      995     5018    2      ELSE DO;
      996     5019    2         IF NOT FM$CFU.SHARED AND (I=1
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:32   
      997     5020    3           OR I=2 AND CODE01.XTNT.XTNSIZE(0)=0) THEN DO;
      998     5021    3            FM$CFU.XTX=1;
      999     5022    3            IF I=1 THEN F$DCB.IXTNSIZE=CODE01.XTNT.XTNSIZE(0);
     1000     5023    3            ELSE F$DCB.IXTNSIZE=CODE01.EXTNT.XTNSIZE(0);
     1001     5024    3            F$DCB.BFR.DA(1)=FM_FRZERO;
     1002     5025    3            GOTO NOXTX;
     1003     5026    3            END;
     1004     5027    2         END;
     1005     5028    1      CALL FMR$GA(ACCT$,ACCTX)ALTRET(FMNE$NOCFUSA);
     1006     5029    1      FM$CFU.XTX=ACCTX;
     1007     5030    2      IF FM$CFU.FUN~=%IN# THEN DO;
     1008     5031    2         FM$CFUEXT.UPDCNT=1;
     1009     5032    2         F$DCB.UPDCNT='1'B;
     1010     5033    2         END;
     1011     5034    2      DO WHILE (I>0);
     1012     5035    2         J=I*4;
     1013     5036    3         IF I<8 THEN DO;
     1014     5037    3            ADDR(FM$CFUEXT)->XTNTS.XTNS=XTNTS.XTNS;
     1015     5038    3            FM$CFUEXT.NUM=I;
     1016     5039    3            END;
     1017     5040    3         ELSE DO;
     1018     5041    3            FM$CFUEXT.XTNT=XTNTS.XTNS; /* MOVE WHAT WILL FIT */
     1019     5042    3            J=6;
     1020     5043    4            DO WHILE (J>=0 AND FM$CFUEXT.XTNT.XTNSIZE(J)=0);
     1021     5044    4               J=J-1;
     1022     5045    4               END;
     1023     5046    4            IF BINBIT(J,1) /* J IS ODD */ THEN DO;
     1024     5047    4               FM$CFUEXT.NUM=6;
     1025     5048    4               FM$CFUEXT.XTNT(6)='0'B;
     1026     5049    4               END;
     1027     5050    3            ELSE FM$CFUEXT.NUM=7;
     1028     5051    3            END;
     1029     5052    2         I=I-FM$CFUEXT.NUM;
     1030     5053    2         KEY$=PINCRW(KEY$,FM$CFUEXT.NUM);
     1031     5054    3         IF I>0 THEN DO;
     1032     5055    3            CFU$=ACCT$;
     1033     5056    3            CALL FMR$GA(ACCT$,ACCTX) ALTRET(FMNE$NOCFUSA);
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:33   
     1034     5057    3            CFU$->FM$CFUEXT.LINKX=ACCTX;
     1035     5058    3            END;
     1036     5059    2         END;
     1037     5060    1      CFU$=JDCB$->F$DCB.CFU$;
     1038     5061    1      ACCT$=PINCRW(F$CFU$,FM$CFU.ACCTX);
     1039     5062    1      IF FM$CFU.AFIT=0 THEN F$DCB.BFR.DA(1)=FM_FRZERO;
     1040     5063    1   NOXTX:;
     1041     5064                    /*
     1042     5065                    *  NOW MOVE KEYED FILE INFORMATION IF IT EXISTS IN THE FIT
     1043     5066                    */
     1044     5067    1      I=2; CALL LOC_CODE ALTRET(NXTCOD1);
     1045     5068                    /**/
     1046     5069    1      FM$CFU.SLIDE=CODE02.SLIDE;
     1047     5070    1      FM$CFU.GDA=CODE02.GDA;
     1048     5071                    /*
     1049     5072                    *  MOVE BASIC FILE INFORMATION FROM THE FIT
     1050     5073                    */
     1051     5074    1   NXTCOD1:
     1052     5075    1      I=3; CALL LOC_CODE;
     1053     5076                    /**/
     1054     5077    1      FM$CFU.UGRANS=0;/*MAKE SURE FRTOSR ALTRETS PROPERLY*/
     1055     5078    1      CALL FAF$FRTOSR(FM_SRZERO,I,J)ALTRET(CHKUGR);
     1056     5079                    /* CHECK THAT UGRANS+NGAVAL COVERS THE FILE */
     1057     5080    1      I=FM_SRZERO-FM_FRZERO-F$DCB.IXTNSIZE;
     1058     5081    1   CHKUGR: I=FM_SRZERO-FM_FRZERO-I;
     1059     5082    2      IF CODE03.UGRANS+CODE03.NGAVAL~=I THEN DO;
     1060     5083    2         CODE03.UGRANS=I;
     1061     5084    2         CODE03.NGAVAL=0;
     1062     5085    2         F$DCB.RA='1'B;
     1063     5086    2         F$DCB.BFR.BUFUP(1)='1'B;
     1064     5087    2         END;
     1065     5088    1      FM$CFU.UGRANS=CODE03.UGRANS;
     1066     5089    1      FM$CFU.NRECS=CODE03.NRECS;
     1067     5090    1      FM$CFU.NGAVAL=CODE03.NGAVAL;
     1068     5091    1      FM$CFU.RCSZ=CODE03.RCSZ;
     1069     5092    1      FM$CFU.LDA=CODE03.LDA;
     1070     5093    2      IF F$DCB.BFR.BUFUP(1) AND NOT F$DCB.STARF THEN DO;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:34   
     1071     5094    2         CALL FMR$U8;
     1072     5095    2         IF CODE03.DESC.BUPM AND NOT FM$CFUA.ACCESS.NOACUP
     1073     5096    2         THEN CODE03.DESC.BUF='1'B;
     1074     5097                    /*
     1075     5098                    Get BUF set for ACUP opens, but leave it to close for
     1076     5099                    other update opens that might not update the file.
     1077     5100                    */
     1078     5101    3         IF FM$CFU.SHARED THEN DO;
     1079     5102    3            CODE03.UGRANS=CODE03.UGRANS
     1080     5103    3              +CODE03.NGAVAL;
     1081     5104    3            CODE03.NGAVAL=0;
     1082     5105    3            CALL FMD$WRTSV(1);
     1083     5106    3            END;
     1084     5107    3         IF F$DCB.DESC.BUPM AND NOT F$DCB.DESC.BUF THEN DO;
     1085     5108    3            F$DCB.DESC.BUF='1'B;
     1086     5109    3            CALL FMP$UPFDDESC;
     1087     5110    3            END;
     1088     5111    2         END;
     1089     5112                    /**/
     1090     5113    1      ELSE SHREXIT: CALL FMR$U8;
     1091     5114                    /*D*
     1092     5115                     If this is an open with DELETE specified, the open now calls
     1093     5116                     the close routine which will release (SCRATCH) the file.  The DCB
     1094     5117                     is not opened in this case.
     1095     5118                    */
     1096     5119    2      IF FPT$OPEN_V.DELETE THEN DO;
     1097     5120    2         CALL FMP$CLSREL;
     1098     5121    2         RETURN;
     1099     5122    2         END;
     1100     5123    1      IF F$DCB.ACS=%BLOCK#
     1101     5124    1        OR F$DCB.ACS=%UBLOCK# AND NOT FM$CFU.SHARED AND NOT F$DCB.COMP
     1102     5125    1        AND (F$DCB.ORG=%CONSEC# OR F$DCB.ORG=%KEYED#
     1103     5126    1        OR F$DCB.ORG=%RELATIVE# OR F$DCB.ORG=%INDEXED# OR F$DCB.ORG=%IREL#)
     1104     5127    1      THEN F$DCB.IORG=%RANDOM#;
     1105     5128    1      ELSE IF F$DCB.ACS=%UBLOCK# THEN F$DCB.ACS=%SEQUEN#;
     1106     5129        %EJECT;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:35   
     1107     5130    1   WRAPUP:
     1108     5131                    /*D*
     1109     5132                     (WRAPUP)
     1110     5133                      This is the main exit for all opens.  The assign/merge
     1111     5134                      buffer is released.  If the file has an AFIT the buffer
     1112     5135                      is released.  The disk address for buffer 1 is changed
     1113     5136                      to file-relative.  The appropriate initialization
     1114     5137                      routine is called based on DCB.IORG.  If DCB.FEXT is set,
     1115     5138                      the file is positioned to the end.  Lastly, the DCB is set
     1116     5139                      opened and the normal return is made to the user.
     1117     5140                    */
     1118     5141    1      F$DCB.MEDIA=ORGS.MEDIA(F$DCB.IORG);
     1119     5142    1      F$DCB.IFMT=F$DCB.MEDIA;
     1120     5143    1      CALL FMD$RELBUF(0);
     1121     5144    1      IF FM$CFU.AFIT~=0
     1122     5145    1      THEN IF NOT F$DCB.FFLG&%(~(FFLG_READ#|FFLG_EXEC#))
     1123     5146    1         THEN CALL FMD$FLSHBUF(1); /* DONT KEEP FIT IF WE WONT USE IT */
     1124     5147    2         ELSE IF F$DCB.BFR.BUFX(4)=0 THEN DO;
     1125     5148    2               F$DCB.BFR(4)=F$DCB.BFR(1);
     1126     5149    2               F$DCB.BFR1(4)=F$DCB.BFR1(1);
     1127     5150    2               F$DCB.BFR1(1)='0'B;
     1128     5151    2               F$DCB.BFR(1)='0'B;
     1129     5152    2               IF F$DCB.BFR.BUFUP(4) THEN CALL FMD$WRTSV(4);
     1130     5153    2               END;
     1131     5154    1      F$DCB.BFR.DA(1)=FM_FRZERO;
     1132     5155    2      DO CASE(JDCB$->F$DCB.IORG);
     1133     5156    2      CASE(%KEYED#);
     1134     5157    2         CALL FMG$INIT ALTRET(OPER);
     1135     5158    2         FM$CFU.FUN=MOD(FM$CFU.FUN,4);/* FMU$BLD MAY HAVE RUN */
     1136     5159    2         IF FM$CFU.GDA=1 AND FM$CFU.SHARED
     1137     5160    2         THEN CALL FMG$KEYEXP ALTRET(OPER);
     1138     5161    3         IF F$DCB.LASTSTA$~=ADDR(NIL) THEN DO;
     1139     5162    3            CALL MMV$OPEN ALTRET(OPER);
     1140     5163    3            F$DCB.ACS=%DIRECT#;
     1141     5164    3            END;
     1142     5165    2      CASE(%CONSEC#,%UR#);
     1143     5166    2         FM$CFU.SHARE=%NONE#;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:36   
     1144     5167    2         IF F$DCB.ACS>%JRNL# AND (FM$CFU.FUN~=%CREATE# OR F$DCB.ORG~=%CONSEC#)
     1145     5168    2         THEN F$DCB.ACS=%SEQUEN#;
     1146     5169    2         IF F$DCB.IORG=%UR# THEN CALL FSF$FORM ALTRET(OPER);
     1147     5170    2         CALL FMH$INIT;
     1148     5171    2      CASE(%RANDOM#);
     1149     5172    2         IF F$DCB.ORG=%CG# AND F$DCB.ASN~=%FILE#
     1150     5173    2         THEN CALL KCO$INIT(PN$) ALTRET(OPER1);
     1151     5174    2         ELSE CALL FMI$INIT ALTRET(OPER1);
     1152     5175    2         IF FM$CFU.FUN=%CREATE# AND F$DCB.CTG
     1153     5176                    /* THE INIT DIDN'T FAIL, SO CATALOG IT NOW */
     1154     5177    2         THEN CALL FMP$UPFDDESC ALTRET(OPER);
     1155     5178    2      CASE(%RELATIVE#);
     1156     5179    2         CALL FMJ$INIT;
     1157     5180    2      CASE(ELSE);
     1158     5181    2         GOTO FMNE$UNIMP;
     1159     5182    2      END;
     1160     5183                    /*
     1161     5184                    *  POSITION TO THE END OF FILE IF FILE EXTENSION IS INDICATED.
     1162     5185                    *  SET THE DCB OPEN AND RETURN TO THE USER.
     1163     5186                    */
     1164     5187    2      IF JDCB$->F$DCB.FEXT THEN DO;
     1165     5188    2         CALL FMF$PEOF(FPTPFILEOF);
     1166     5189    2         IF B$JIT$->B$JIT.ERR.CODE~=0 THEN GOTO OPER;
     1167     5190    2         END;
     1168     5191    2      IF F$DCB.ACS=%JRNL# THEN DO;
     1169     5192    2         CALL FMH$JGETPG(1)ALTRET(OPER);
     1170     5193    2         F$DCB.ASN=%FILE#;
     1171     5194    2         END;
     1172     5195    1      F$DCB.SHARED=FM$CFU.FUN*FM$CFU.SHARE<3|FM$CFU.FUN=%JRNL#;
     1173     5196    2      IF F$DCB.ENQF THEN DO;
     1174     5197    2         CALL UQB$MDEQ(CFU$)ALTRET(OPER);
     1175     5198    2         F$DCB.ENQF='0'B;
     1176     5199    2         END;
     1177     5200    1      IF ES_LOGFILEGRANT=%PC_ES_YES# AND F$DCB.PRIVOPN AND S_CUN>%JG_MING#
     1178     5201    2        AND NOT B$JIT.PRIV.ACTIVE.FMBLK AND NOT F$DCB.LOGSEC THEN DO;
     1179     5202    2         CALL ELA$SYSLOG (EL_FILE_ACCESS, GRANT, SIZEW(GRANT),0,EL_SEC,I);
     1180     5203    2         END;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:37   
     1181     5204    1      RETURN;
     1182     5205        %EJECT;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:38   
     1183     5206    1   ENQFIT: PROC ALTRET;
     1184     5207    2      IF F$DCB.STARF OR FPT$OPEN_V.OPER.TEST OR
     1185     5208    2        F$DCB.ACS~=%JRNL# AND (F$DCB.SHARE=%NONE# OR
     1186     5209    2        F$DCB.SHARE=%IN# AND F$DCB.FUN=%IN#) THEN RETURN;
     1187     5210    2      CALL UQB$MENQX(CFU$)ALTRET(RETALT);
     1188     5211    2      F$DCB.ENQF='1'B;
     1189     5212    2      RETURN;
     1190     5213    2   RETALT: ALTRETURN;
     1191     5214        %EJECT;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:39   
     1192     5215    2   LOC_CODE: ENTRY ALTRET;
     1193     5216                    /* Returns FIT piece in KEY$, size in I. */
     1194     5217                    /* Caller must put piece number in I, have FIT pointer in FIT$ */
     1195     5218    2      T$=FIT$;
     1196     5219    2      CALL FMO$LOCCODE (T$,I);
     1197     5220    2      KEY$=T$;
     1198     5221    2      IF KEY$=FIT$ THEN ALTRETURN;
     1199     5222    2      RETURN;
     1200     5223        %EJECT;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:40   
     1201     5224    2   GHSTACS: ENTRY ALTRET;
     1202     5225    2      IF F$DCB.GHSTACS=%NONE# OR S_CUN=JG_JAYS#
     1203     5226    2        OR F$DCB.GHSTACS=%JRNLOPN# AND (F$DCB.SHARED
     1204     5227    2        OR F$DCB.ASN~=%COMGROUP# AND (F$DCB.ACS~=%JRNL# OR F$DCB.ORG~=%CONSEC#))
     1205     5228    2        OR F$DCB.ASN=%COMGROUP# AND F$DCB.JRNLBYPASS
     1206     5229    2        AND F$DCB.FFLG.AU AND F$DCB.AU
     1207     5230    2        OR B$JIT.PRIV.ACTIVE.FMEFT
     1208     5231    2      THEN RETURN;
     1209     5232    3      IF F$DCB.ENQF THEN DO;
     1210     5233    3         CALL FMD$FLSHBUF(1);
     1211     5234    3         CALL UQB$MDEQ(CFU$);
     1212     5235    3         END;
     1213     5236    2      IF F$DCB.GHSTACS=%JRNLOPN# AND FM$CFU.FUN>4 THEN
     1214     5237    2         IF F$DCB.ACS=%JRNL# THEN FM$CFU.FUN=%JRNL#;
     1215     5238    2         ELSE IF F$DCB.FUN=%CREATE# AND F$DCB.EXIST=%OLDFILE#
     1216     5239    2            THEN FM$CFU.FUN=%UPDATE#;
     1217     5240    2            ELSE FM$CFU.FUN=MOD(FM$CFU.FUN,4);
     1218     5241    2      CALL KQC$TELLJ(CFU$);
     1219     5242    3      IF F$DCB.ENQF THEN DO;
     1220     5243    3         CALL UQB$MENQX(CFU$);
     1221     5244    3         FDA=FM$CFU.FITSDA;
     1222     5245    3         CALL FMN$READFIT(BUF$,FDA) ALTRET(RETALT);
     1223     5246    3         FIT$=PINCRW(BUF$,SIZEW(FM$GRAN));
     1224     5247    3         END;
     1225     5248    2      IF B$JIT.ERR THEN ALTRETURN;
     1226     5249    2      RETURN;
     1227     5250    2   END ENQFIT;
     1228     5251        %EJECT;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:41   
     1229     5252    1   BNEWFILEX:;
     1230     5253    1      CALL FMD$FLSHBUF(1);
     1231     5254    1      IF NOT F$DCB.STARF THEN CALL UQB$MDEQ(ACCT$);
     1232     5255    1      IF B$JIT.ERR.CODE=%E$NOKEY THEN B$JIT.ERR='0'B;
     1233     5256    1      IF SUBSTR(F$DCB.NAME.C,0,7)=':SECLOG' AND FM$CFU.ACCTX=FM_SYSACCTX
     1234     5257    1        AND S_CUN>%JG_ELF# THEN F$DCB.FFLG='0'B;
     1235     5258    1   BNEWFILE0:;
     1236     5259    1      IF NOT F$DCB.FFLG&%FFLG_CREATE#
     1237     5260    1        AND F$DCB.FUN=%CREATE# THEN GOTO FMNE$NEWFILE;
     1238     5261                    /*E*     ERROR: FMN-E$NEWFILE-E
     1239     5262                    *        MESSAGE:You may not create a new file% for %UF%
     1240     5263                    *        MESSAGE1:DP#%SN.%AC does not permit you to create new files
     1241     5264                    */
     1242     5265    1      IF B$JIT.ERR THEN GOTO OPER;
     1243     5266    1   BNEWFILE:;
     1244     5267    1      B$JIT.ERR='0'B;
     1245     5268    1      F$DCB.TYC='0'B;
     1246     5269    1      F$DCB.DESC='0'B;
     1247     5270    1      IF ACCT$~=ADDR(NIL) THEN F$DCB.DESC.BUPM=FM$CFUA.ACCESS.BUPM;
     1248     5271    1      IF NOT F$DCB.BUPM&'01'B THEN F$DCB.DESC.BUPM=F$DCB.BUPM;
     1249     5272    1      F$DCB.DESC.BUF=F$DCB.DESC.BUPM;
     1250     5273                    /*
     1251     5274                    *  SCRATCH OPENS COME IN AT THIS POINT
     1252     5275                    */
     1253     5276    1   SCRATCHOPN:;
     1254     5277                    /*D*
     1255     5278                     (BNEWFILE)
     1256     5279                     When open discovers that it must build a new file, it verifies
     1257     5280                    that the open has specified 'CREATE'.  If not, a 'File does not exist'
     1258     5281                    error is returned to the user.  The organization for the file is
     1259     5282                    established, as are certain restricted attributes.
     1260     5283                    If this is a TEST open, we are all done now.
     1261     5284                    */
     1262     5285    1      IF F$DCB.FUN~=%CREATE# THEN GOTO FMNE$NOFILE;
     1263     5286                    /*E*     ERROR: FMN-E$NOFILE-E
     1264     5287                    *        MESSAGE: File% %FN% does not exist
     1265     5288                    *        MESSAGE1:File %FN does not exist in DP#%SN.%AC
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:42   
     1266     5289                    */
     1267     5290    1      F$DCB.ORG=ORGS.ORG(MOD(F$DCB.ORG,16));
     1268     5291    1      IF F$DCB.ORG=%CG# AND F$DCB.ASN~=%COMGROUP# THEN
     1269     5292    1         IF NOT B$JIT.PRIV.ACTIVE.FMDIAG THEN
     1270     5293    1            GOTO FMNE$CGFILE;
     1271     5294                    /*E* ERROR: FMN-E$CGFILE-2
     1272     5295                    *    MESSAGE: You are not allowed to create a file with ORG=CG#
     1273     5296                    */
     1274     5297    1      F$DCB.IORG=ORGS.IORG(F$DCB.ORG);
     1275     5298    1      IF NOT ORGS.COMP(F$DCB.ORG) THEN F$DCB.COMP=%NO#;
     1276     5299    1      IF FPT$OPEN_V.OPER.TEST THEN GOTO OPERX;
     1277     5300                    /*D*
     1278     5301                     If the file is not to be cataloged at open time, the CFU is
     1279     5302                     initialized as a 'create' CFU so that 'input' openers may still
     1280     5303                     access the old copy of the file if one exists.
     1281     5304                    */
     1282     5305    1      CALL FMR$L8;
     1283     5306    1      FM$CFU.SHARE=%NONE#;
     1284     5307    1      FM$CFU.SHARED='1'B;
     1285     5308    1      FM$CFU.FMOD='1'B;
     1286     5309    1      FDA=FM$CFU.FITSDA; /* REMEMBER WHETHER A FILE EXISTS */
     1287     5310    1      FM$CFU.FITSDA=0;
     1288     5311    1      CALL FMR$U8;
     1289     5312                    /*
     1290     5313                    *  COMPUTE GRANULE SIZE FOR RELATIVE FILES
     1291     5314                    */
     1292     5315    2      IF F$DCB.IORG=%RELATIVE# THEN DO;
     1293     5316    2         IF F$DCB.RECL=0 THEN F$DCB.RECL=4;
     1294     5317    2         J=(JDCB$->F$DCB.RECL+7)/4;
     1295     5318    2         J=((J*JDCB$->F$DCB.NRECS)+1021)/1022;
     1296     5319    2         IF J=0 THEN J=1;
     1297     5320    2         JDCB$->F$DCB.IXTNSIZE=J;
     1298     5321    2         END;
     1299     5322                    /*D*
     1300     5323                     Next we build the FIT for the new file and obtain the initial
     1301     5324                     extent for the file.  The extent is divided up into used (the FIT)
     1302     5325                     and available (remaining) granules.  The CFU is set up with the
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:43   
     1303     5326                     initial parameters.  The FIT is written out to its proper location.
     1304     5327                     If cataloging is specified at open time, open catalogs the newly
     1305     5328                    created file.  If an old file of this name was already in the catalog
     1306     5329                    and is not open, we release the extents of that file.  If it is open,
     1307     5330                    we turn it into a 'scratch' file so that it will disappear whenever
     1308     5331                    all the current users have closed it.  No other new users are allowed
     1309     5332                    access to it.  Open then proceeds to the main exit to mark the DCB
     1310     5333                    open and return to the user (WRAPUP).
     1311     5334                    */
     1312     5335    1      CALL FMO$BLDFIT(PN$) ALTRET(OPER);
     1313     5336    1      CALL FMR$G8(ACCT$,ACCTX) ALTRET(FMNE$NOCFUS);
     1314     5337    1      FM$CFU.XTX=ACCTX;
     1315     5338    1      FM$CFUEXT.UPDCNT=1;
     1316     5339    1      F$DCB.UPDCNT='1'B;
     1317     5340    1      JDCB$->F$DCB.BFR.DA(1)=FM_FRZERO;
     1318     5341    1      BUF$=FM$BUF$(F$DCB.BFR.BUFX(1));
     1319     5342    2      IF FM$GRAN.LVL=6 THEN DO;
     1320     5343    2         CALL FAG$G1DIR(I) ALTRET(OPER);
     1321     5344    2         FM$CFU.FITSDA=I;
     1322     5345    2         FM$CFU.AFIT=1;
     1323     5346    2         JDCB$->F$DCB.BFR.DA(1)=I;
     1324     5347    2         FM$GRAN.STAMP.GMOD=I;
     1325     5348    2         END;
     1326     5349                    /*
     1327     5350                    *  NOW GET THE INITIAL EXTENT FOR THIS FILE
     1328     5351                    */
     1329     5352    1      IF F$DCB.ACS=%BLOCK# THEN F$DCB.IORG=%RANDOM#;
     1330     5353    1      IF (F$DCB.IXTNSIZE~=1 OR F$DCB.ORG~=%RANDOM# OR F$DCB.ACS<=%JRNL#)
     1331     5354    1        AND F$DCB.ASN~=%TAPE# THEN CALL FAG$GEXT ALTRET(OPER);
     1332     5355    2      ELSE IF FDA~=0 THEN DO;
     1333     5356    2            IF F$DCB.ACS>=%DS2# AND F$DCB.ACS<=%DS8#
     1334     5357    2              AND F$DCB.EXIST=%NEWFILE# AND F$DCB.FUN=%CREATE# THEN
     1335     5358    2               B$JIT.ERR=FMN$E$SDSEXISTS;
     1336     5359                    /*E*     ERROR: FMN-E$SDSEXISTS
     1337     5360                    *        MESSAGE:Either Shared Data-segment or file% %FN% exists.
     1338     5361                    */
     1339     5362    2            ELSE B$JIT.ERR=FMN$E$CREATERR;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:44   
     1340     5363    2            GOTO OPER;
     1341     5364    2            END;
     1342     5365    2      IF FM$CFU.AFIT=0 THEN DO;
     1343     5366    2         FM$CFU.FITSDA=FM$CFUEXT.XTNT.XTNSDA(0);
     1344     5367    3         IF F$DCB.ACS~=%BLOCK# THEN DO;
     1345     5368                    /*
     1346     5369                    *  DIVIDE INITIAL EXTENT INTO UGRANS AND NGAVAL FOR NON-RANDOM
     1347     5370                    *  FILES.
     1348     5371                    */
     1349     5372    3            FM$CFU.UGRANS=1;
     1350     5373    3            FM$CFU.NGAVAL=FM$CFU.NGAVAL-1;
     1351     5374    3            END;
     1352     5375    2         END;
     1353     5376    1      FM$CFU.NRECS=0;
     1354     5377    1      IF F$DCB.IORG=%RELATIVE# THEN FM$CFU.NRECS=F$DCB.NRECS;
     1355     5378    1      FM$CFU.RCSZ=0;
     1356     5379    1      FM$CFU.LDA=FM_FRZERO;
     1357     5380    1      FM$CFU.GDA=0;
     1358     5381    1      IF F$DCB.DISP=%SCRATCH# THEN GOTO WRAPUP;
     1359     5382    1      IF F$DCB.FEXTX~=0 THEN B$JIT.FEXT(F$DCB.FEXTX)='1'B;
     1360     5383                    /*
     1361     5384                    *  NOW CHECK FOR CTG AT OPEN TIME
     1362     5385                    */
     1363     5386    2      IF NOT F$DCB.CTG AND F$DCB.ACS~=%JRNL# THEN DO;
     1364     5387    2         FM$CFU.FUN=%CREATE#;
     1365     5388    2         GOTO WRAPUP;
     1366     5389    2         END;
     1367     5390    1      CALL ENQFIT ALTRET(OPER);
     1368     5391    1      IF F$DCB.ACS~=%BLOCK# THEN FM$CFU.SHARE=F$DCB.SHARE;
     1369     5392    1      CALL FMD$WRTSV(1);
     1370     5393    1      IF FM$CFU.UGRANS=0 AND FM$CFU.NGAVAL=0 THEN FM$CFU.FUN=%UPDATE#;
     1371     5394                    /* NO FILE, SHARED DATA SEGMENT */
     1372     5395    1      ELSE IF F$DCB.ASN~=%CG# /* COMGROUP INIT MIGHT ALTRET, SO DEFER CTG */
     1373     5396    1         THEN CALL FMP$UPFDDESC ALTRET(OPER); /* FMQ$CTG, BUT KEEP BFR(1) */
     1374     5397    1      IF F$DCB.GHSTACS~=0 THEN CALL GHSTACS ALTRET(OPER);
     1375     5398    1      IF F$DCB.ACS~=%JRNL# THEN GOTO WRAPUP;
     1376     5399    1      FIT$=PINCRW(BUF$,SIZEW(FM$GRAN));
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:45   
     1377     5400    1      GOTO JRNLXIT;
     1378     5401        %EJECT;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:46   
     1379     5402                    /*
     1380     5403                    *  ALL ERRORS ARE PROCESSED HERE
     1381     5404                    *
     1382     5405                    *  RETURN ANY OUTSTANDING BUFFERS, GIVE BACK ANY CFU SPACE
     1383     5406                    *  ACQUIRED, AND REPORT THE ERROR TO THE USER.  BY THIS TIME
     1384     5407                    *  THE ERROR CODE HAS BEEN PLACED IN B$JIT.ERR.
     1385     5408                    */
     1386     5409    1   FMNE$UNIMP:;
     1387     5410    1      B$JIT$->B$JIT.ERR=FMN$E$UNIMP;
     1388     5411    1      GOTO OPER;
     1389     5412    1   FMNE$FDEOF:;
     1390     5413    1      IF B$JIT.ERR.CODE=%E$EOF
     1391     5414    2        OR B$JIT.ERR.CODE=%E$BOF THEN DO;
     1392     5415    2   FMNE$FDEOFA:
     1393     5416    2         IF F$DCB.STARF THEN CALL CHKLAST ALTRET(NXTF0);
     1394     5417    2         B$JIT.ERR=FMN$E$NOFILE; /* CHANGED TO FDEOF AT OPER */
     1395     5418    2         END;
     1396     5419    1   OPERFD:;
     1397     5420    1      CALL FMD$FLSHBUF(1);
     1398     5421    1      IF NOT F$DCB.STARF THEN CALL UQB$MDEQ(ACCT$);
     1399     5422    1      GOTO OPER;
     1400     5423    1   FMNE$FILEBUSY:;
     1401     5424                    /*E*     ERROR:  FMN-E$FILEBUSY-E
     1402     5425                    *        MESSAGE: File %FN is busy.
     1403     5426                    */
     1404     5427    1      CALL FMR$U8;
     1405     5428    1      B$JIT$->B$JIT.ERR=FMN$E$FILEBUSY;
     1406     5429    1      GOTO OPER;
     1407     5430    1   FMNE$NEWFILE:;
     1408     5431    1      B$JIT.ERR=FMN$E$NEWFILE;
     1409     5432    1      GOTO OPER;
     1410     5433    1   FMNE$NOCFUSA:
     1411     5434    1      CALL FMR$U8;
     1412     5435    1   FMNE$NOCFUS:;
     1413     5436    1      B$JIT$->B$JIT.ERR=FMN$E$NOCFUS;
     1414     5437    1      GOTO OPER;
     1415     5438    1   FMNE$NOFILE:;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:47   
     1416     5439    1      B$JIT$->B$JIT.ERR=FMN$E$NOFILE;
     1417     5440    1      GOTO OPER;
     1418     5441    1   FMNE$ADEOF:;
     1419     5442    1      IF B$JIT.ERR.CODE=%E$EOF
     1420     5443    2        OR B$JIT.ERR.CODE=%E$BOF THEN DO;
     1421     5444    2         B$JIT.ERR=FMN$E$ADEOF;
     1422     5445    2         F$DCB.ACCT=' ';
     1423     5446    2         END;
     1424     5447    1   OPERAD:;
     1425     5448    1      CALL FMD$FLSHBUF(1);
     1426     5449    1      CALL UQB$MDEQ(PAD$);
     1427     5450    1      GOTO OPER;
     1428     5451    1   OPERNPSN: F$DCB.PSN=' ';
     1429     5452    1      GOTO OPER;
     1430     5453    1   FMNE$BADJRNL: B$JIT.ERR=FMN$E$BADJRNL;
     1431     5454    1      GOTO OPER;
     1432     5455    1   FMNE$NOACCESS: B$JIT.ERR=FMN$E$NOACCESS;
     1433     5456    1      GOTO OPER;
     1434     5457    1   FMNE$STOWEDFILE: B$JIT.ERR=FMN$E$STOWEDFILE;
     1435     5458    1      GOTO OPER;
     1436     5459    1   FMNE$CGFILE: B$JIT.ERR=FMNE$E$CGFILE;
     1437     5460    1      GOTO OPER;
     1438     5461    1   FMNE$NOTAUTH: B$JIT.ERR=FMN$E$NOTAUTH;
     1439     5462    1      GOTO OPER;
     1440     5463    1   FMNE$JRNLERR:
     1441     5464    1      B$JIT.ERR=FMN$E$JRNLERR;
     1442     5465    1      GOTO OPER;
     1443     5466    1   OPERX:;
     1444     5467    1      IF F$DCB.BFR1.CX(1)>0
     1445     5468    1      THEN IF FMC$CACHETBL.USECNT(F$DCB.BFR1.CX(1))=1
     1446     5469    1         THEN CALL FMD$RELBUF(1);
     1447     5470    1      B$JIT$->B$JIT.ERR='0'B; /* NO ERRORS, BUT DCB IS CLOSED */
     1448     5471    1      GOTO OPER1;
     1449     5472                    /**/
     1450     5473    1   BADFIT:;
     1451     5474    1      IF B$JIT.ERR='0'B THEN GOTO FIRSTOPN; /* FASTPATH ERR, TRY SLOW ONE */
     1452     5475    1      IF ERRCODE THEN B$JIT.ERR=ERRCODE;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:48   
     1453     5476    1      ELSE IF NOT F$DCB.FEXT AND F$DCB.EXIST=%NEWFILE#
     1454     5477    1           AND F$DCB.FUN=%CREATE# THEN GOTO BNEWFILE; /*WRITE OVER*/
     1455     5478    2         ELSE IF FPT$OPEN_V.DELETE THEN DO;
     1456     5479    2               B$JIT.ERR='0'B;
     1457     5480    2               CALL FMP$CLSREL;
     1458     5481    2               RETURN;
     1459     5482    2               END;
     1460     5483    1   OPER:;
     1461     5484    1      IF B$JIT.ERR.FCG~='0615'O OR B$JIT.ERR.MID<'16'O
     1462     5485    1      THEN B$JIT.ERR=FMN$E$NOCODE|B$JIT.ERR&FMN$E$CODE;
     1463     5486    1      IF FPT$OPEN_V.OPER.NXTF AND B$JIT.ERR=FMN$E$NOFILE
     1464     5487    2      THEN DO;
     1465     5488    2         B$JIT.ERR=FMN$E$FDEOF;
     1466     5489    2         F$DCB.NAME.L=0;
     1467     5490    2         F$DCB.NAME.C=' ';
     1468     5491    2         END;
     1469     5492    1   OPER1:;
     1470     5493    1      IF JDCB$->F$DCB.CFU$=ADDR(NIL) THEN GOTO OPER2;
     1471     5494    1      CFU$=JDCB$->F$DCB.CFU$;
     1472     5495    1      IF FM$CFU.NAMEX=0 AND FM$CFU.XTX=0 THEN FM$CFU.FITSDA=0;
     1473     5496    1      IF FM$CFU.FUN>4 THEN FM$CFU.FUN=FM$CFU.FUN-4;
     1474     5497    1      I=BITBIN(B$JIT.ERR);
     1475     5498    1      CALL FMP$CLSERR;
     1476     5499    1      B$JIT.ERR=BINBIT(I,36);
     1477     5500    1      IF ES_LOGFILEDENY=%PC_ES_YES# AND S_CUN>%JG_MING# AND NOT F$DCB.LOGSEC
     1478     5501    2      THEN DO SELECT B$JIT.ERR.CODE;
     1479     5502    2         SELECT %E$NOACCESS,%E$NOTAUTH,%E$NEWFILE,%E$CLSREL,%E$CREATONLY;
     1480     5503    2         CALL ELA$SYSLOG (EL_FILE_ACCESS, DENY, SIZEW(DENY),0,EL_SEC,I);
     1481     5504    2         END;
     1482     5505    1   OPER2:;
     1483     5506    2      DO I=0 TO 4;
     1484     5507    2         CALL FMD$RELBUF(I);
     1485     5508    2         END;
     1486     5509    1      RETURN;
     1487     5510    1   END FMN$OPNF;
     1488     5511        %EOD;

PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:49   
--  Include file information  --

   ES_SUBS_E.:E05TOU  is referenced.
   ES_TABLES_M.:E05TOU  is referenced.
   EL_SUBS_C.:E05TOU  is referenced.
   PC_SUBS_C.:E05TOU  is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
   F_FMTCODE_C.:E05TOU  is referenced.
   UD_ERRORS_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   KI$CP6V_C.:E05TOU  is referenced.
   F$CP6P_C.:E05TOU  is referenced.
   F$CP6V_C.:E05TOU  is referenced.
   F_FPTCODE_C.:E05TOU  is referenced.
   FM_FIELD_C.:E05TOU  is referenced.
   FM_CACHE_R.:E05TOU  cannot be made into a system file and is referenced.
   FM_CACHE_C.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
   F$DCB.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FMN$OPNF.

   Procedure FMN$OPNF requires 3380 words for executable code.
   Procedure FMN$OPNF requires 32 words of local(AUTO) storage.

PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:50   

 Object Unit name= FMN$OPNF                                   File name= FMN$OPNF.:E05TOU
 UTS= JUL 29 '97 16:54:50.72 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS     46     56  FMN$OPNF
    1   Data  even  none     2      2  FMN$OPNF
    2   Proc  even  none  3380   6464  FMN$OPNF
    3  RoData even  none    38     46  FMN$OPNF

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     2      0   yes            yes      Std        1  FMN$OPNF

  ****  Data defs  ****

 Sect OctLoc  Name                           Sect OctLoc  Name
    1      0  FM_OPNS
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:51   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       0 HFF$TRAPALT
 yes     yes           Std       2 FMR$G8
 yes     yes           Std       1 UQB$MENQS
 yes     yes           Std       0 FMN$READFDFIT
 yes     yes           Std       0 FMS$SCANNAMENW
 yes     yes           Std       2 FMN$READFIT
 yes     yes           Std       2 FMR$GA
 yes     yes           Std       4 KCO$INIT
         yes           Std       1 FMD$RELBUF
 yes     yes           Std       0 FSF$FORM
 yes     yes           Std       1 FMH$JGETPG
         yes           Std       1 FMD$FLSHBUF
         yes           Std       2 FMO$SECCHK
         yes           Std       1 SSS$SYSTIME
 yes     yes           Std       0 FMG$INIT
 yes     yes           Std       1 FSB$GETDDF
         yes           Std       1 FMD$WRTSV
 yes     yes           Std       0 FMI$INIT
 yes     yes           Std       2 FMO$TRNINFO
 yes     yes           Std       0 FMS$SCANACCT
         yes           Std       2 HFF$DSIZ
         yes           Std       1 FMP$RELCFUS
 yes     yes           Std       2 FMQ$SRCHAD
 yes     yes           Std       2 FSA$GSP
         yes           Std       1 FMF$PEOF
 yes     yes           Std       0 FMG$KEYEXP
 yes     yes           Std       1 FMN$CHKFLACN
 yes     yes           Std       1 UQB$MDEQ
 yes     yes           Std       5 FMQ$SRCHFD
 yes     yes           Std       2 FSA$FSP
 yes     yes           Std       6 ELA$SYSLOG
         yes           Std       0 FMP$CLSREL
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:52   
 yes     yes           Std       1 FMG$IRSETUP
         yes           Std       0 FMJ$INIT
         yes           Std       2 FMO$UPKACCT
 yes     yes           Std       1 FMN$SETX
 yes     yes           Std       2 FMN$READFITF
 yes     yes           Std       3 FAF$FRTOSR
 yes     yes           Std       0 FMP$UPFDDESC
 yes     yes           Std       1 FMO$BLDFIT
 yes     yes           Std       0 FMO$FIELD_START_SETUP
         yes           Std       0 FMR$L8
 yes     yes           Std       0 FMS$SCANNAME
         yes           Std       0 FMR$U8
         yes           Std       0 FMH$INIT
         yes           Std       0 FMP$CLSERR
 yes     yes           Std       0 FAG$GEXT
 yes     yes           Std       0 MMV$OPEN
 yes     yes           Std       1 FAG$G1DIR
 yes     yes           Std       1 UQB$MENQX
 yes     yes           Std       2 FMO$LOCCODE
 yes     yes           Std       1 KQC$TELLJ
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     FMC_CACHE$                            FMC_CACHEPGCNT$                  r    B$JIT$
r    B$ROSEG$                              S_CUN                                 ES_LOGFILEGRANT
     ES_LOGFILEDENY                        ES_PROTECTSECLOG                      FM$BUF$
     F$CFU$                                FM$SET$                               FM_FRZERO
     FM_SRZERO                             FM_STARCHARS                          FM_SYSACCTX
     B_TICSDAY                             FM_DFLOPN_V                           B_VECTNIL
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:53   

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:54   


        1        1        /*M*  FMN$OPNF - FILE OPEN ROUTINE.       */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* NSO,MCL=0,MOC,MEC,CLM=12,EXM=12,CRT=6,DMR,PLM=3,IND=3,ENU=0,DCI=3,
        8        8        CSU=3,ECU=3,THI=0,DTI=0,CRM=86 */
        9        9                    /*P*  NAME:        FMN$OPNF
       10       10                    *     PURPOSE:     PRELIMINARY FILE DCB OPEN PROCESS.
       11       11                    */
       12       12                    /**/
       13       13                    /*D*  NAME:        FMN$OPNF
       14       14                    *     CALL:        CALL FMN$OPNF(PN$);
       15       15                    *
       16       16                    *     INPUT:       PN$ IS AN ARRAY OF POINTERS CORRESPONDING TO
       17       17                    *                  THE OPEN FPT VECTORS.
       18       18                    *
       19       19                    *                 B$JIT.DCB$ -> CURRENT DCB
       20       20                    *
       21       21                    *     OUTPUT:     OPEN DCB READY FOR FILE MANAGEMENT SERVICES.
       22       22                    *
       23       23                    *     DESCRIPTION:
       24       24                    *
       25       25                     This routine opens a DCB to a disk file for input, update, create
       26       26                     or journal functions.
       27       27                    */
       28       28                    /**/
       29       29        FMN$OPNF: PROC(PN$);

     29  2 000000   000000 700200 xent  FMN$OPNF     TSX0  ! X66_AUTO_1
         2 000001   000040 000001                    ZERO    32,1

       30       30                    /**/
       31       31        %INCLUDE F$JIT_C;
       32      461        %MACRO F$DCB#(BASED=BASED);
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:55   
       33      462        %INCLUDE F$DCB;
       34      511        %MEND;
       35      512        %F$DCB#(BASED="BASED(JDCB$)");
       36      562        %INCLUDE FM$MACROS;
       37      937        %INCLUDE FM_CACHE_C;
       38     1003        %INCLUDE FM_CACHE_R;
       39     1015        %INCLUDE FM_FIELD_C;
       40     1056        %INCLUDE F_FPTCODE_C;
       41     1092        %INCLUDE F$CP6V_C;
       42     1318        %INCLUDE F$CP6P_C;
       43     1329        %INCLUDE KI$CP6V_C;
       44     1768        %FPT$OPEN_V(BASED="BASED(PN$.V_)");
       45     1783        %FM$CFU(BASED="BASED(CFU$)");
       46     1789        %FM$CFUA(BASED="BASED(ACCT$)");
       47     1795        %FM$CFUEXT(BASED="BASED(ACCT$)");
       48     1799        %FM$CFUF(BASED="BASED(CFU$)");
       49     1802        %FM$CFUJ(BASED="BASED(CFU$)");
       50     1807        %FM$GRAN(BASED="BASED(BUF$)");
       51     1811        %FM$MADKEY(BASED="BASED(KEY$)");
       52     1814        %FM$ADKEY(BASED="BASED(KEY$)");
       53     1817        %FM$KEYENT(BASED="BASED(KEY$)");
       54     1820        %FM$FDSEG(BASED="BASED(SEG$)");
       55     1824        %FM$FDSTOW(BASED="BASED(SEG$)");
       56     1827        %FM$FIT(BASED="BASED(FIT$)");
       57     1830        %CODE01(BASED="BASED(KEY$)");
       58     1834        %CODE02(BASED="BASED(KEY$)");
       59     1838        %CODE03(BASED="BASED(KEY$)");
       60     1845        %CODE04(BASED="BASED(KEY$)");
       61     1853        %CODE06;
       62     1857        %FITALTKEYS(BASED="BASED(KEY$)");
       63     1863        %CODE15(BASED="BASED(KEY$)");
       64     1866        %CODE16(BASED="BASED(KEY$)");
       65     1874        %CODE18(BASED="BASED(KEY$)");
       66     1878        %CODE19(BASED="BASED(KEY$)");
       67     1881        %CODE20(BASED="BASED(KEY$)");
       68     1886        %CODE21(BASED="BASED(KEY$)");
       69     1889        %FM$SET(BASED="BASED(FM$SET$)");
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:56   
       70     1894        %FMC$CACHE;
       71     1917        %FMG$IRKEYS(FPTN=IRKEYS, STCLASS="BASED(ALTKEY$)");
       72     1924        %FMG$KFIELD(FPTN=KFIELD, STCLASS="BASED(KFIELD$)");
       73     1927        %FM$FIELD_START(FPTN=FM$FIELD_START,STCLASS="BASED(START$)");
       74     1949        %VLP$RECFIELD_V(FPTN=RECFIELD, BASED="BASED(FIELD$)");
       75     1986        %VLP$IRREC_V(FPTN=IRREC,BASED="BASED(IRREC$)");
       76     1989        %VLP$FPRG_V(FPTN=VLP$FPRG, BASED="BASED(KEY$)");
       77     2000    1   DCL 1 XTNTS BASED(KEY$), /* FOR MOVING EXTENTS TO THE CFUS AREA */
       78     2001    1         2 * UBIN,
       79     2002    1         2 XTNS,3 * CHAR(J);
       80     2003    1   DCL MOVEJ CHAR(J) BASED;
       81     2004    1   DCL 1 ZAP BASED,
       82     2005    1         2 * CHAR(J) CALIGNED;
       83     2006        %INCLUDE CP_6_SUBS;
       84     2546        %INCLUDE SS_SCHED_C;
       85     2779        %INCLUDE F_ERRORS_C;
       86     3019        %INCLUDE UD_ERRORS_C;
       87     3061        %INCLUDE F_FMTCODE_C;
       88     3095        %INCLUDE JG_GHOSTS_C;
       89     3185        %SUB FCG#='0615'O;
       90     3186        %SUB MID#='16'O;
       91     3187                    /**/
       92     3188                    /* PARAMETER DATA */
       93     3189                    /**/
       94     3190        %FPT$OPEN_P(FPTN=PN$,STCLASS=,PFMT=PTR);
       95     3196                    /**/
       96     3197                    /* AUTOMATIC DATA */
       97     3198                    /**/
       98     3199    1   DCL JDCB$ PTR; /* CURRENT DCB POINTER */
       99     3200    1   DCL PAD$ PTR; /* ACCT DIRECTORY POINTER */
      100     3201    1   DCL FDA SBIN; /* FIT DISK ADDRESS */
      101     3202    1   DCL 1 NXTAR REDEF FDA,
      102     3203    1         2 L UBIN(9)UNAL,
      103     3204    1         2 * CHAR(1),
      104     3205    1         2 C CHAR(1),
      105     3206    1         2 * BIT(9);
      106     3207    1   DCL CFU$ PTR; /* CURRENT CFU POINTER */
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:57   
      107     3208    1   DCL ACCT$ PTR; /* CURRENT CFUA POINTER */
      108     3209    1   DCL ACCTX SBIN; /* INDEX TO ACCT 6-WORD BLOCK */
      109     3210    1   DCL KEY$ PTR; /* POINTER TO ACCT ENTRY, ETC. */
      110     3211    1   DCL SEG$ PTR; /* POINTER TO SEGMENT AREA OF KEY */
      111     3212    1   DCL BUF$ PTR; /* POINTER TO FD FIT, ETC. */
      112     3213    1   DCL I SBIN; /* TEMPORARY INDEX */
      113     3214    1   DCL 1 IB REDEF I,
      114     3215    1         2 FFLG BIT(18),
      115     3216    1         2 * BIT(9),
      116     3217    1         2 FDCM UBIN(9)UNAL;
      117     3218    1   DCL IU REDEF I UBIN;
      118     3219    1   DCL J SBIN; /* TEMPORARY INDEX */
      119     3220    1   DCL FIT$ PTR; /* POINTER TO FIT */
      120     3221    1   DCL EFIT$ REDEF FIT$ EPTR;
      121     3222    1   DCL ERRCODE BIT(36);
      122     3223    1   DCL KFIELD$ PTR;
      123     3224    1   DCL FIELD$ PTR;
      124     3225    1   DCL ALTKEY$ PTR;
      125     3226    1   DCL START$ PTR;
      126     3227    1   DCL IRREC$ PTR;
      127     3228    1   DCL T$ PTR; /* Temp for use as an argument */
      128     3229                    /**/
      129     3230                    /* SYMREF DATA */
      130     3231                    /**/
      131     3232    1   DCL B$JIT$ PTR SYMREF READONLY; /* CURRENT JIT POINTER */
      132     3233    1   DCL B$ROSEG$ PTR SYMREF READONLY; /* Read-only segment pointer */
      133     3234    1   DCL S_CUN UBIN SYMREF; /* CURRENT USER NUMBER */
      134     3235    1   DCL ES_LOGFILEGRANT SBIN SYMREF;
      135     3236    1   DCL ES_LOGFILEDENY SBIN SYMREF;
      136     3237    1   DCL ES_PROTECTSECLOG UBIN SYMREF;
      137     3238        %INCLUDE PC_SUBS_C;
      138     3570        %INCLUDE EL_SUBS_C;
      139     3654        %INCLUDE ES_TABLES_M;
      140     4048        %INCLUDE ES_SUBS_E;
      141     4074        %ES$FILE_ACCESS(NAME=GRANT,STCLASS=CONSTANT,REASON=%ES_PRIV_USER#,GRANTED=YES);
      142     4088        %ES$FILE_ACCESS(NAME=DENY,STCLASS=CONSTANT,REASON=%ES_ACS_DENIED#,GRANTED=NO);
      143     4102    1   DCL FM$BUF$ (0:31) PTR SYMREF; /* FILE MANAGEMENT BUFFERS */
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:58   
      144     4103    1   DCL F$CFU$ PTR SYMREF; /* TO THE CFU AREA */
      145     4104    1   DCL FM$SET$ PTR SYMREF; /* TO THE SET TABLES */
      146     4105    1   DCL FM_FRZERO SBIN SYMREF; /* START OF FILE */
      147     4106    1   DCL FM_SRZERO UBIN SYMREF;
      148     4107    1   DCL FM_STARCHARS CHAR(12) SYMREF;
      149     4108    1   DCL FM_SYSACCTX UBIN SYMREF;
      150     4109    1   DCL FM_SYSSETX UBIN SYMREF;
      151     4110    1   DCL 1 FM_OPNS STATIC SYMDEF,
      152     4111    1         2 TOT SBIN INIT(0), /* ATTEMPTS, NOT SCRATCH */
      153     4112    1         2 SLO SBIN INIT(0); /* # NEEDING DIR SRCH */
      154     4113    1   DCL B_TICSDAY UBIN SYMREF;
      155     4114                    /**/
      156     4115                    /* DEFINE EXTERNAL ROUTINES */
      157     4116                    /**/
      158     4117    1   DCL ELA$SYSLOG ENTRY(6) ALTRET;
      159     4118    1   DCL FAF$FRTOSR ENTRY(3)ALTRET; /* COUNT GRANULES IN THE EXTENT LIST */
      160     4119    1   DCL FAG$GEXT ENTRY ALTRET; /* GET INITIAL EXTENT FOR THE FILE */
      161     4120    1   DCL FAG$G1DIR ENTRY(1) ALTRET; /* GET GRANULE FOR AFIT */
      162     4121    1   DCL FMD$FLSHBUF ENTRY(1); /* FLUSH CURRENT BUFFER */
      163     4122    1   DCL FMD$RELBUF ENTRY(1); /* RELEASE BUFFER */
      164     4123    1   DCL FMD$WRTSV ENTRY(1); /* WRITE (WAIT) BUT DON'T RELEASE*/
      165     4124    1   DCL FMF$PEOF ENTRY(1); /* POSITION TO EOF */
      166     4125    1   DCL FMG$INIT ENTRY ALTRET; /*INIT KEYED DCB*/
      167     4126    1   DCL FMG$IRSETUP ENTRY(1) ALTRET; /* INIT IREL INFO */
      168     4127    1   DCL FMO$FIELD_START_SETUP ENTRY ALTRET; /* Init FM$FIELD_START */
      169     4128    1   DCL FMG$KEYEXP ENTRY ALTRET;
      170     4129    1   DCL FMH$INIT ENTRY; /*INIT CONSEC DCB*/
      171     4130    1   DCL FMH$JGETPG ENTRY(1) ALTRET; /* ALLOCATE THE JOURNAL BBUF */
      172     4131    1   DCL FMI$INIT ENTRY ALTRET; /* INIT RANDOM DCB */
      173     4132    1   DCL FMJ$INIT ENTRY; /*INIT RELATIVE DCB*/
      174     4133    1   DCL FMN$CHKFLACN ENTRY(1) ALTRET; /* VERIFY FILENAME AND ACCT */
      175     4134    1   DCL FMN$READFIT ENTRY(2)ALTRET; /* READ FIT */
      176     4135    1   DCL FMN$READFITF ENTRY(2)ALTRET;
      177     4136    1   DCL FMN$READFDFIT ENTRY ALTRET; /* READ AND SECCHK FD */
      178     4137    1   DCL FMN$SETX ENTRY(1) ALTRET; /* SET DCB.SETX FROM PASSED PSN */
      179     4138    1   DCL FMO$BLDFIT ENTRY(1) ALTRET; /* BUILD THE FIT GRANULE */
      180     4139    1   DCL FMO$LOCCODE ENTRY(2) ALTRET; /* Find FIT entry */
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:59   
      181     4140    1   DCL FMO$SECCHK ENTRY(2); /* SECURITY CHECK */
      182     4141    1   DCL FMO$TRNINFO ENTRY(2) ALTRET; /* TRANSFER FPARAM DATA */
      183     4142    1   DCL FMO$UPKACCT ENTRY(2); /* UNPACK ACCT NO. INTO DCB */
      184     4143    1   DCL FMP$CLSERR ENTRY; /* CLOSE AFTER OPEN ERR */
      185     4144    1   DCL FMP$CLSREL ENTRY; /* CLOSE TO RELEASE */
      186     4145    1   DCL FMP$RELCFUS ENTRY(1); /* RELEASE THE CFU BLOCKS */
      187     4146    1   DCL FMP$UPFDDESC ENTRY ALTRET;
      188     4147    1   DCL FMQ$SRCHAD ENTRY(2) ALTRET; /* SEARCH ACCOUNT DIRECTORY */
      189     4148    1   DCL FMQ$SRCHFD ENTRY(5) ALTRET; /* SEARCH FILE DIRECTORY */
      190     4149    1   DCL FMR$FN ENTRY(1); /* UNLINK NAME TO ZAP IT */
      191     4150    1   DCL FMR$G8 ENTRY(2) ALTRET; /* GET A CFU ENTRY */
      192     4151    1   DCL FMR$GA ENTRY(2) ALTRET; /* GET A SECONDARY CFU BLOCK */
      193     4152    1   DCL FMR$L8 ENTRY; /* LOCK CFU SEGMENT */
      194     4153    1   DCL FMR$U8 ENTRY; /* UNLOCK CFU SEGMENT */
      195     4154    1   DCL FMS$BLDCFUA ENTRY(4) ALTRET; /* BUILD 8-WORD ACCT BLOCK */
      196     4155    1   DCL FMS$SCANACCT ENTRY ALTRET; /* SEARCH ACCT BLOCKS FOR ENTRY */
      197     4156    1   DCL FMS$SCANNAME ENTRY ALTRET; /* SCAN FOR NAME IN NAME AREA */
      198     4157    1   DCL FMS$SCANNAMENW ENTRY ALTRET; /* SCAN FOR NAME IN NAME AREA NOWAIT */
      199     4158    1   DCL FSA$FSP ENTRY(2)ALTRET; /* Release read-only space */
      200     4159    1   DCL FSA$GSP ENTRY(2)ALTRET;/*GET CODE16 SPACE*/
      201     4160    1   DCL FSB$GETDDF ENTRY(1)ALTRET;/* GET TAB, HEADER, SEQ FOR UR FILES */
      202     4161    1   DCL FSF$FORM ENTRY ALTRET; /* FORM GETTER */
      203     4162    1   DCL HFF$DSIZ ENTRY(2); /* CHECK FPARAM BUFFER SIZE */
      204     4163    1   DCL HFF$TRAPALT ENTRY ALTRET;
      205     4164    1   DCL KCO$INIT ENTRY(4) ALTRET;
      206     4165    1   DCL KQC$TELLJ ENTRY(1) ALTRET;
      207     4166    1   DCL MMV$OPEN ENTRY ALTRET;
      208     4167    1   DCL SSS$SYSTIME ENTRY(1); /* GET CURRENT TIME FOR ACC/MOD */
      209     4168    1   DCL UQB$MENQS ENTRY(1)ALTRET;
      210     4169    1   DCL UQB$MENQX ENTRY(1)ALTRET;
      211     4170    1   DCL UQB$MDEQ ENTRY(1)ALTRET;
      212     4171                    /**/
      213     4172                    /* CONSTANT DATA */
      214     4173                    /**/
      215     4174    1   DCL 1 ORGS(0:15)CONSTANT ALIGNED,
      216     4175    1         2 COMP BIT(1)INIT('1'B*3,'0'B,'1'B,'0'B*0),
      217     4176    1         2 * BIT(2),
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:60   
      218     4177    1         2 IORG UBIN(6)UNAL INIT(0,
      219     4178    1    %CONSEC#,%KEYED#,%RANDOM#,%UR#,%RELATIVE#,%KEYED#,
      220     4179    1    %RANDOM#,0,%UR#,0,%RANDOM#,0,%KEYED#,0*0),
      221     4180    1         2 MEDIA UBIN(9)UNAL INIT(0,
      222     4181    1   FMTCON#,FMTKEY#,FMTRAN#,FMTCON#,FMTREL#,0*0),
      223     4182    1         2 ORG UBIN(9)UNAL INIT(
      224     4183    1    %CONSEC#,%CONSEC#,%KEYED#,%RANDOM#,%UR#,%RELATIVE#,%INDEXED#,%IDS#,
      225     4184    1    %CONSEC#,%SYMB#,%CONSEC#,%CG#,%CONSEC#,%IREL#,%CONSEC#*0);
      226     4185        %ERRCODE(NAME=FMN$E$UNIMP,COD#=%E$UNIMP);
      227     4189        %ERRCODE(NAME=FMN$E$NOFILE,COD#=%E$NOFILE);
      228     4193        %ERRCODE(NAME=FMN$E$FDEOF,COD#=%E$FDEOF);
      229     4197        %ERRCODE(NAME=FMN$E$FILEBUSY,COD#=%E$FILEBUSY);
      230     4201        %ERRCODE(NAME=FMN$E$CREATERR,COD#=%E$CREATERR);
      231     4205        %ERRCODE(NAME=FMN$E$NOCFUS,COD#=%E$NOCFUS);
      232     4209        %ERRCODE(NAME=FMN$E$ADEOF,COD#=%E$ADEOF);
      233     4213        %ERRCODE(NAME=FMN$E$NOACCESS,COD#=%E$NOACCESS);
      234     4217        %ERRCODE(NAME=FMN$E$JRNLERR,COD#=%E$JRNLERR);
      235     4221        %ERRCODE(NAME=FMN$E$SDSEXISTS,COD#=%E$SDSEXISTS);
      236     4225        %ERRCODE(NAME=FMN$E$NEWFILE,COD#=%E$NEWFILE);
      237     4229        %ERRCODE(NAME=FMN$E$NOKEY,COD#=%E$NOKEY);
      238     4233        %ERRCODE(NAME=FMN$E$NOTAUTH,COD#=%E$NOTAUTH);
      239     4237        %ERRCODE(NAME=FMNE$E$CGFILE,COD#=%E$CGFILE);
      240     4241        %ERRCODE(NAME=FMN$E$STOWEDFILE,COD#=%E$STOWEDFILE);
      241     4245        %ERRCODE(NAME=FMN$E$BADALT, COD#=%E$BADALT);
      242     4249        %ERRCODE(NAME=FMN$E$BADJRNL, COD#=%E$BADJRNL);
      243     4253        %ERRCODE(NAME=FMN$E$CREATONLY, COD#=%E$CREATONLY);
      244     4257        %ERRCODE(NAME=FMN$E$CODE,FCG#='0'O,MID#='0'O,SEV#=0,MON#='1'B,COD#=16383);
      245     4261        %ERRCODE(NAME=FMN$E$NOCODE,COD#=0);
      246     4265        %FM_FITCODE(NAME=STOWCODE0,CODE=1,NAW=5,NDW=2);
      247     4268        %FM_FITCODE(NAME=STOWCODE1,CODE=6,NAW=3,NDW=3,ITEMX=2);
      248     4271    1   DCL FM_DFLOPN_V UBIN SYMREF;
      249     4272    1   DCL ZERO REDEF FM_DFLOPN_V UBIN;
      250     4273    1   DCL TESTOPN BIT(36)INIT('00000002'O)CONSTANT;
      251     4274    1   DCL ACSGHST CONSTANT CHAR(8) INIT('JAYS');
      252     4275        %EJECT;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:61   
      253     4276    1      B$JIT.ERR='0'B; /* CLEAR ANY ERROR CODE */

   4276  2 000002   000000 470400 xsym               LDP0    B$JIT$
         2 000003   000012 450100                    STZ     10,,PR0

      254     4277                    /*
      255     4278                    *  GET THE DCB ADDRESS
      256     4279                    */
      257     4280    1      JDCB$=B$JIT.DCB$;

   4280  2 000004   000232 236100                    LDQ     154,,PR0
         2 000005   200004 756100                    STQ     JDCB$,,AUTO

      258     4281                    /*D*
      259     4282                     Open begins with function specific operations to determine the
      260     4283                     pack set for this file.  Filenames and Accounts are checked for
      261     4284                     valid characters.  Scratch files fall out here and go on to
      262     4285                    file creation (BNEWFILE). If the first character of the Filename is an
      263     4286                    asterisk, the file is tagged as a 'STAR' file, and proceeds on to
      264     4287                    the file lookup (FINDFIL1).
      265     4288                    */
      266     4289    1      CALL HFF$TRAPALT ALTRET(OPER);

   4289  2 000006   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000007   000000 701000 xent               TSX1    HFF$TRAPALT
         2 000010   006276 702000 2                  TSX2    OPER

      267     4290    1      CALL FMN$CHKFLACN(JDCB$);

   4290  2 000011   200004 630500                    EPPR0   JDCB$,,AUTO
         2 000012   200032 450500                    STP0    T$+4,,AUTO
         2 000013   200032 630500                    EPPR0   T$+4,,AUTO
         2 000014   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000015   000000 701000 xent               TSX1    FMN$CHKFLACN
         2 000016   000000 011000                    NOP     0

      268     4291    1      IF F$DCB.ACS=%JRNL#
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:62   

   4291  2 000017   200004 470500                    LDP0    JDCB$,,AUTO
         2 000020   000036 236100                    LDQ     30,,PR0
         2 000021   000777 376007                    ANQ     511,DL
         2 000022   000004 116007                    CMPQ    4,DL
         2 000023   000047 601000 2                  TNZ     s:4301
         2 000024   000032 236100                    LDQ     26,,PR0
         2 000025   000777 376003                    ANQ     511,DU
         2 000026   000002 116003                    CMPQ    2,DU
         2 000027   006215 600000 2                  TZE     FMNE$JRNLERR
         2 000030   000032 236100                    LDQ     26,,PR0
         2 000031   777000 376003                    ANQ     -512,DU
         2 000032   001000 116003                    CMPQ    512,DU
         2 000033   006215 601000 2                  TNZ     FMNE$JRNLERR
         2 000034   000032 236100                    LDQ     26,,PR0
         2 000035   000777 376007                    ANQ     511,DL
         2 000036   000001 116007                    CMPQ    1,DL
         2 000037   006215 600000 2                  TZE     FMNE$JRNLERR
         2 000040   200003 471500                    LDP1    @PN$,,AUTO
         2 000041   100000 473500                    LDP3    0,,PR1
         2 000042   300000 236100                    LDQ     0,,PR3
         2 000043   040000 316007                    CANQ    16384,DL
         2 000044   006215 601000 2                  TNZ     FMNE$JRNLERR
         2 000045   037000 316007                    CANQ    15872,DL
         2 000046   006215 601000 2                  TNZ     FMNE$JRNLERR

      269     4292    1        AND (F$DCB.FUN=%IN# OR F$DCB.ORG~=%CONSEC# OR F$DCB.DISP=%SCRATCH#
      270     4293    1        OR FPT$OPEN_V.DELETE OR FPT$OPEN_V.OPER)
      271     4294    1      THEN GOTO FMNE$JRNLERR;
      272     4295                    /*E*     ERROR: FMN-E$JRNLERR-E
      273     4296                    *        MESSAGE:Journal protocol incorrect% for %UF%.
      274     4297                    *       MESSAGE1:Journal% %UF% must be CONSEC, not IN, and not SCRATCH.
      275     4298                    *        Its first OPEN must be CREATE. A tape journal must not
      276     4299                    *        have the same name and account as an existing disk file.
      277     4300                    */
      278     4301    2      IF F$DCB.FUN=%CREATE# THEN DO;

PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:63   
   4301  2 000047   000032 236100                    LDQ     26,,PR0
         2 000050   000777 376003                    ANQ     511,DU
         2 000051   000003 116003                    CMPQ    3,DU
         2 000052   000117 601000 2                  TNZ     s:4326

      279     4302    2         IF FPT$OPEN_V.OPER.TEST THEN PN$.V_=ADDR(TESTOPN);

   4302  2 000053   200003 471500                    LDP1    @PN$,,AUTO
         2 000054   100000 473500                    LDP3    0,,PR1
         2 000055   300000 236100                    LDQ     0,,PR3
         2 000056   020000 316007                    CANQ    8192,DL
         2 000057   000063 600000 2                  TZE     s:4303

   4302  2 000060   000000 236000 3                  LDQ     0
         2 000061   100000 756100                    STQ     0,,PR1
         2 000062   000065 710000 2                  TRA     s:4304

      280     4303    2         ELSE PN$.V_=ADDR(ZERO); /* ONLY TEST MATTERS */

   4303  2 000063   000001 236000 3                  LDQ     1
         2 000064   100000 756100                    STQ     0,,PR1

      281     4304    3         IF F$DCB.DISP=%SCRATCH# THEN DO;

   4304  2 000065   200004 470500                    LDP0    JDCB$,,AUTO
         2 000066   000032 236100                    LDQ     26,,PR0
         2 000067   000777 376007                    ANQ     511,DL
         2 000070   000001 116007                    CMPQ    1,DL
         2 000071   000117 601000 2                  TNZ     s:4326

      282     4305    3            JDCB$->F$DCB.CTG='0'B;

   4305  2 000072   000002 236000 3                  LDQ     2
         2 000073   000031 356100                    ANSQ    25,,PR0

      283     4306    3            CALL FMR$G8(CFU$,ACCTX) ALTRET(FMNE$NOCFUS);

PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:64   
   4306  2 000074   200011 633500                    EPPR3   ACCTX,,AUTO
         2 000075   200033 453500                    STP3    T$+5,,AUTO
         2 000076   200007 634500                    EPPR4   CFU$,,AUTO
         2 000077   200032 454500                    STP4    T$+4,,AUTO
         2 000100   200032 630500                    EPPR0   T$+4,,AUTO
         2 000101   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000102   000000 701000 xent               TSX1    FMR$G8
         2 000103   006127 702000 2                  TSX2    FMNE$NOCFUS

      284     4307                    /*E*     ERROR:  FMN-E$NOCFUS-E
      285     4308                    *        MESSAGE:System table space unavailable% to open %DC%
      286     4309                    */
      287     4310    3            F$DCB.FCD='1'B;

   4310  2 000104   200004 470500                    LDP0    JDCB$,,AUTO
         2 000105   020000 236007                    LDQ     8192,DL
         2 000106   000031 256100                    ORSQ    25,,PR0

      288     4311    3            F$DCB.CFU$=CFU$;

   4311  2 000107   200007 236100                    LDQ     CFU$,,AUTO
         2 000110   000066 756100                    STQ     54,,PR0

      289     4312    3            FM$CFU.FUN=%CREATE#;

   4312  2 000111   200007 471500                    LDP1    CFU$,,AUTO
         2 000112   100000 236100                    LDQ     0,,PR1
         2 000113   000003 376000 3                  ANQ     3
         2 000114   300000 276003                    ORQ     98304,DU
         2 000115   100000 756100                    STQ     0,,PR1

      290     4313    3            GOTO SCRATCHOPN;

   4313  2 000116   005364 710000 2                  TRA     SCRATCHOPN

      291     4314    3            END;
      292     4315    2         END;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:65   
      293     4316                    /**/
      294     4317                    /* IN & UPDATE */
      295     4318                    /*D*
      296     4319                     If this is a NXTA request, the Account Directory is searched
      297     4320                     to obtain the actual account desired.  If NXTA is specified and
      298     4321                     NXTF is not specified, the account is placed in the DCB and the
      299     4322                    open process continues, unless the next account has been deleted,
      300     4323                    in which case the time of deletion is returned in DCB.EXPIRE and
      301     4324                    E$NOKEY is returned.
      302     4325                    */
      303     4326    1      IF B$JIT.ERR THEN IF F$DCB.STARX=0 OR NOT FPT$OPEN_V.OPER.NXTF

   4326  2 000117   000000 471400 xsym               LDP1    B$JIT$
         2 000120   100012 235100                    LDA     10,,PR1
         2 000121   000133 600000 2                  TZE     s:4329

   4326  2 000122   000064 236100                    LDQ     52,,PR0
         2 000123   007000 316007                    CANQ    3584,DL
         2 000124   006276 600000 2                  TZE     OPER
         2 000125   200003 473500                    LDP3    @PN$,,AUTO
         2 000126   300000 474500                    LDP4    0,,PR3
         2 000127   400000 236100                    LDQ     0,,PR4
         2 000130   004000 316007                    CANQ    2048,DL
         2 000131   006276 600000 2                  TZE     OPER

      304     4327    1         THEN GOTO OPER;
      305     4328    1         ELSE B$JIT.ERR='0'B; /* STAR SECCHK - CATCH IT AFTER NXTF */

   4328  2 000132   100012 450100                    STZ     10,,PR1

      306     4329    1      IF NOT FPT$OPEN_V.OPER.NXTA OR F$DCB.STARF THEN GOTO MAINOPN;

   4329  2 000133   200003 473500                    LDP3    @PN$,,AUTO
         2 000134   300000 474500                    LDP4    0,,PR3
         2 000135   400000 236100                    LDQ     0,,PR4
         2 000136   010000 316007                    CANQ    4096,DL
         2 000137   000276 600000 2                  TZE     MAINOPN
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:66   
         2 000140   000064 236100                    LDQ     52,,PR0
         2 000141   200000 316003                    CANQ    65536,DU
         2 000142   000276 601000 2                  TNZ     MAINOPN

      307     4330    1      IF NOT B$JIT.PRIV.ACTIVE&%SUBBIT(PR_FMSEC#|PR_FMREAD#,0,18) THEN GOTO
              4330               FMNE$NOTAUTH;

   4330  2 000143   100013 236100                    LDQ     11,,PR1
         2 000144   120000 376003                    ANQ     40960,DU
         2 000145   006212 600000 2                  TZE     FMNE$NOTAUTH

      308     4331    1      PAD$=ADDR(FM$SET(JDCB$->F$DCB.SETX));

   4331  2 000146   000051 236100                    LDQ     41,,PR0
         2 000147   000003 736000                    QLS     3
         2 000150   000004 376000 3                  ANQ     4
         2 000151   000022 736000                    QLS     18
         2 000152   000000 036000 xsym               ADLQ    FM$SET$
         2 000153   200005 756100                    STQ     PAD$,,AUTO

      309     4332    1      CALL UQB$MENQS(PAD$)ALTRET(OPER);

   4332  2 000154   200005 634500                    EPPR4   PAD$,,AUTO
         2 000155   200032 454500                    STP4    T$+4,,AUTO
         2 000156   200032 630500                    EPPR0   T$+4,,AUTO
         2 000157   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000160   000000 701000 xent               TSX1    UQB$MENQS
         2 000161   006276 702000 2                  TSX2    OPER

      310     4333    1      IF FPT$OPEN_V.SRCHCOND.REV AND F$DCB.ACCT=' ' THEN F$DCB.ACCT=BINASC(511);

   4333  2 000162   200003 470500                    LDP0    @PN$,,AUTO
         2 000163   000000 471500                    LDP1    0,,PR0
         2 000164   100001 236100                    LDQ     1,,PR1
         2 000165   000001 316003                    CANQ    1,DU
         2 000166   000176 600000 2                  TZE     NXTAGAIN
         2 000167   200004 473500                    LDP3    JDCB$,,AUTO
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:67   
         2 000170   300020 237100                    LDAQ    16,,PR3
         2 000171   000006 117000 3                  CMPAQ   6
         2 000172   000176 601000 2                  TNZ     NXTAGAIN

   4333  2 000173   000005 235000 3                  LDA     5
         2 000174   000035 236000 xsym               LDQ     B_VECTNIL+29
         2 000175   300020 757100                    STAQ    16,,PR3

   4333  2 000176                       NXTAGAIN     null
      311     4334    1   NXTAGAIN:;
      312     4335    1      CALL FMQ$SRCHAD(KEY$,PN$) ALTRET(FMNE$ADEOF);

   4335  2 000176   200003 236100                    LDQ     @PN$,,AUTO
         2 000177   200033 756100                    STQ     T$+5,,AUTO
         2 000200   200012 630500                    EPPR0   KEY$,,AUTO
         2 000201   200032 450500                    STP0    T$+4,,AUTO
         2 000202   200032 630500                    EPPR0   T$+4,,AUTO
         2 000203   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000204   000000 701000 xent               TSX1    FMQ$SRCHAD
         2 000205   006137 702000 2                  TSX2    FMNE$ADEOF

      313     4336                    /*E*     ERROR:  FMN-E$ADEOF-E
      314     4337                    *        MESSAGE:End of% DP#%SN% account directory reached.
      315     4338                    */
      316     4339    1      CALL FMO$UPKACCT(JDCB$,KEY$);

   4339  2 000206   200012 630500                    EPPR0   KEY$,,AUTO
         2 000207   200033 450500                    STP0    T$+5,,AUTO
         2 000210   200004 631500                    EPPR1   JDCB$,,AUTO
         2 000211   200032 451500                    STP1    T$+4,,AUTO
         2 000212   200032 630500                    EPPR0   T$+4,,AUTO
         2 000213   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000214   000000 701000 xent               TSX1    FMO$UPKACCT
         2 000215   000000 011000                    NOP     0

      317     4340    1      IF PAD$=FM$SET$ THEN F$DCB.PSN=FM$MADKEY.PSN;

PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:68   
   4340  2 000216   200005 236100                    LDQ     PAD$,,AUTO
         2 000217   000000 116000 xsym               CMPQ    FM$SET$
         2 000220   000226 601000 2                  TNZ     s:4341

   4340  2 000221   200012 470500                    LDP0    KEY$,,AUTO
         2 000222   200004 471500                    LDP1    JDCB$,,AUTO
         2 000223   040100 100500                    MLR     fill='040'O
         2 000224   000002 400006                    ADSC9   2,,PR0                   cn=2,n=6
         2 000225   100024 000006                    ADSC9   20,,PR1                  cn=0,n=6

      318     4341    1      IF FM$ADKEY.D THEN IF B$JIT.PRIV.ACTIVE&%SUBBIT(PR_FMSEC#|PR_FMREAD#,0,18)

   4341  2 000226   200012 470500                    LDP0    KEY$,,AUTO
         2 000227   000000 234100                    SZN     0,,PR0
         2 000230   000241 605000 2                  TPL     s:4344

   4341  2 000231   000000 471400 xsym               LDP1    B$JIT$
         2 000232   100013 236100                    LDQ     11,,PR1
         2 000233   120000 376003                    ANQ     40960,DU
         2 000234   000176 600000 2                  TZE     NXTAGAIN

      319     4342    1         THEN F$DCB.EXPIRE=FM$ADKEY.FDSDA;

   4342  2 000235   000002 235100                    LDA     2,,PR0
         2 000236   200004 473500                    LDP3    JDCB$,,AUTO
         2 000237   300035 755100                    STA     29,,PR3
         2 000240   000241 710000 2                  TRA     s:4344

      320     4343    1         ELSE GOTO NXTAGAIN;
      321     4344    1      CALL  FMD$FLSHBUF(1);

   4344  2 000241   000010 630400 3                  EPPR0   8
         2 000242   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000243   000000 701000 xent               TSX1    FMD$FLSHBUF
         2 000244   000000 011000                    NOP     0

      322     4345    1      CALL UQB$MDEQ(PAD$)ALTRET(OPER);
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:69   

   4345  2 000245   200005 630500                    EPPR0   PAD$,,AUTO
         2 000246   200032 450500                    STP0    T$+4,,AUTO
         2 000247   200032 630500                    EPPR0   T$+4,,AUTO
         2 000250   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000251   000000 701000 xent               TSX1    UQB$MDEQ
         2 000252   006276 702000 2                  TSX2    OPER

      323     4346    2      IF PAD$=FM$SET$ THEN DO;

   4346  2 000253   200005 236100                    LDQ     PAD$,,AUTO
         2 000254   000000 116000 xsym               CMPQ    FM$SET$
         2 000255   000276 601000 2                  TNZ     MAINOPN

      324     4347    2         IF NOT FPT$OPEN_V.OPER.NXTF AND F$DCB.NAME.L=0 THEN GOTO FMNE$NOFILE;

   4347  2 000256   200003 470500                    LDP0    @PN$,,AUTO
         2 000257   000000 471500                    LDP1    0,,PR0
         2 000260   100000 236100                    LDQ     0,,PR1
         2 000261   004000 316007                    CANQ    2048,DL
         2 000262   000267 601000 2                  TNZ     s:4348
         2 000263   200004 473500                    LDP3    JDCB$,,AUTO
         2 000264   300010 236100                    LDQ     8,,PR3
         2 000265   777000 316003                    CANQ    -512,DU
         2 000266   006133 600000 2                  TZE     FMNE$NOFILE

      325     4348    2         CALL FMN$SETX(F$DCB.PSN)ALTRET(OPER);

   4348  2 000267   200004 236100                    LDQ     JDCB$,,AUTO
         2 000270   000024 036003                    ADLQ    20,DU
         2 000271   200032 756100                    STQ     T$+4,,AUTO
         2 000272   200032 630500                    EPPR0   T$+4,,AUTO
         2 000273   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000274   000000 701000 xent               TSX1    FMN$SETX
         2 000275   006276 702000 2                  TSX2    OPER

      326     4349    2         END;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:70   

      327     4350        %EJECT;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:71   
      328     4351                    /*
      329     4352                    *  ALL OPENS EXCEPT SCRATCH ENTER HERE
      330     4353                    */
      331     4354    1   MAINOPN:
      332     4355                    /*
      333     4356                    *  GET AN 8-WORD CFU BLOCK
      334     4357                    */
      335     4358    1      CALL FMR$G8(CFU$,ACCTX) ALTRET(FMNE$NOCFUS);

   4358  2 000276   200011 630500       MAINOPN      EPPR0   ACCTX,,AUTO
         2 000277   200033 450500                    STP0    T$+5,,AUTO
         2 000300   200007 631500                    EPPR1   CFU$,,AUTO
         2 000301   200032 451500                    STP1    T$+4,,AUTO
         2 000302   200032 630500                    EPPR0   T$+4,,AUTO
         2 000303   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000304   000000 701000 xent               TSX1    FMR$G8
         2 000305   006127 702000 2                  TSX2    FMNE$NOCFUS

      336     4359    1      F$DCB.FCD='1'B;

   4359  2 000306   200004 470500                    LDP0    JDCB$,,AUTO
         2 000307   020000 236007                    LDQ     8192,DL
         2 000310   000031 256100                    ORSQ    25,,PR0

      337     4360    1      F$DCB.CFU$=CFU$;

   4360  2 000311   200007 236100                    LDQ     CFU$,,AUTO
         2 000312   000066 756100                    STQ     54,,PR0

      338     4361    1      FM$CFU.FUN=F$DCB.FUN+4; /* MAKE EVERYBODY WAIT UNTIL OPEN'S DONE */

   4361  2 000313   200007 471500                    LDP1    CFU$,,AUTO
         2 000314   000032 236100                    LDQ     26,,PR0
         2 000315   000022 772000                    QRL     18
         2 000316   000777 376007                    ANQ     511,DL
         2 000317   000004 036007                    ADLQ    4,DL
         2 000320   000041 736000                    QLS     33
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:72   
         2 000321   100000 676100                    ERQ     0,,PR1
         2 000322   700000 376003                    ANQ     -32768,DU
         2 000323   100000 656100                    ERSQ    0,,PR1

      339     4362    2      IF JDCB$->F$DCB.STARF THEN DO;

   4362  2 000324   200004 470500                    LDP0    JDCB$,,AUTO
         2 000325   000064 236100                    LDQ     52,,PR0
         2 000326   200000 316003                    CANQ    65536,DU
         2 000327   000347 600000 2                  TZE     ACNSEARCH

      340     4363    2         F$DCB.FFLG=%FFLG_OWNER#;/* MAKE SURE WE CAN CREATE NEWFILE */

   4363  2 000330   765700 220003                    LDX0    -5184,DU
         2 000331   000004 740100                    STX0    4,,PR0

      341     4364    2         FM$CFU.STARX.F=1;

   4364  2 000332   200007 470500                    LDP0    CFU$,,AUTO
         2 000333   400000 236003                    LDQ     -131072,DU
         2 000334   000002 256100                    ORSQ    2,,PR0

      342     4365    2         FM$CFU.STARX.SYSID=B$JIT.SYSID;

   4365  2 000335   200007 470500                    LDP0    CFU$,,AUTO
         2 000336   000000 471400 xsym               LDP1    B$JIT$
         2 000337   100000 236100                    LDQ     0,,PR1
         2 000340   000022 736000                    QLS     18
         2 000341   000002 676100                    ERQ     2,,PR0
         2 000342   377777 376003                    ANQ     131071,DU
         2 000343   000002 656100                    ERSQ    2,,PR0

      343     4366    2         ACCT$=ADDR(NIL);

   4366  2 000344   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 000345   200010 756100                    STQ     ACCT$,,AUTO

PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:73   
      344     4367    2         GOTO FINDFIL1;

   4367  2 000346   000546 710000 2                  TRA     FINDFIL1

      345     4368    2         END;
      346     4369                    /*D*
      347     4370                     Open looks up the account first in the account CFU segment.
      348     4371                     If it is found there, we may be able to skip the Account Directory
      349     4372                     search and go directly to find the file (FINDFIL).
      350     4373                    */
      351     4374    1   ACNSEARCH:
      352     4375    1      CALL FMS$SCANACCT ALTRET(FINDFIL);

   4375  2 000347   000002 631400 xsym  ACNSEARCH    EPPR1   B_VECTNIL+2
         2 000350   000000 701000 xent               TSX1    FMS$SCANACCT
         2 000351   000536 702000 2                  TSX2    FINDFIL

      353     4376    1      IF B$JIT.ERR THEN GOTO OPER;

   4376  2 000352   000000 470400 xsym               LDP0    B$JIT$
         2 000353   000012 235100                    LDA     10,,PR0
         2 000354   006276 601000 2                  TNZ     OPER

      354     4377    1      PAD$=ADDR(FM$SET(JDCB$->F$DCB.SETX));

   4377  2 000355   200004 471500                    LDP1    JDCB$,,AUTO
         2 000356   100051 236100                    LDQ     41,,PR1
         2 000357   000003 736000                    QLS     3
         2 000360   000004 376000 3                  ANQ     4
         2 000361   000022 736000                    QLS     18
         2 000362   000000 036000 xsym               ADLQ    FM$SET$
         2 000363   200005 756100                    STQ     PAD$,,AUTO

      355     4378                    /*D*  If scanacct found a valid acct block, it altreted to findfil.
      356     4379                     Otherwise, it built a new one for a non-MAD reference, returned the
      357     4380                    address of a partially complete one, or left DCB.SETX zero and NOPed.
      358     4381                    In any such case, a MAD or PAD search is required. */
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:74   
      359     4382    1      CALL UQB$MENQS(PAD$)ALTRET(OPER);

   4382  2 000364   200005 633500                    EPPR3   PAD$,,AUTO
         2 000365   200032 453500                    STP3    T$+4,,AUTO
         2 000366   200032 630500                    EPPR0   T$+4,,AUTO
         2 000367   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000370   000000 701000 xent               TSX1    UQB$MENQS
         2 000371   006276 702000 2                  TSX2    OPER

      360     4383    2      IF JDCB$->F$DCB.SETX=0 THEN DO;

   4383  2 000372   200004 470500                    LDP0    JDCB$,,AUTO
         2 000373   000051 720100                    LXL0    41,,PR0
         2 000374   000446 601000 2                  TNZ     s:4394

      361     4384    2         F$DCB.PSN=B$JIT.HPSN; /* Use HPSN if not in MAD */

   4384  2 000375   000000 471400 xsym               LDP1    B$JIT$
         2 000376   040100 100500                    MLR     fill='040'O
         2 000377   100234 000006                    ADSC9   156,,PR1                 cn=0,n=6
         2 000400   000024 000006                    ADSC9   20,,PR0                  cn=0,n=6

      362     4385    2         CALL FMQ$SRCHAD(KEY$,ADDR(NIL)) ALTRET(NOMAD);

   4385  2 000401   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 000402   200032 756100                    STQ     T$+4,,AUTO
         2 000403   200032 633500                    EPPR3   T$+4,,AUTO
         2 000404   200035 453500                    STP3    T$+7,,AUTO
         2 000405   200012 634500                    EPPR4   KEY$,,AUTO
         2 000406   200034 454500                    STP4    T$+6,,AUTO
         2 000407   200034 630500                    EPPR0   T$+6,,AUTO
         2 000410   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000411   000000 701000 xent               TSX1    FMQ$SRCHAD
         2 000412   000420 702000 2                  TSX2    NOMAD

      363     4386    2         F$DCB.PSN=FM$MADKEY.PSN;

PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:75   
   4386  2 000413   200012 470500                    LDP0    KEY$,,AUTO
         2 000414   200004 471500                    LDP1    JDCB$,,AUTO
         2 000415   040100 100500                    MLR     fill='040'O
         2 000416   000002 400006                    ADSC9   2,,PR0                   cn=2,n=6
         2 000417   100024 000006                    ADSC9   20,,PR1                  cn=0,n=6

   4386  2 000420                       NOMAD        null
      364     4387    2   NOMAD:;
      365     4388    2         CALL FMD$FLSHBUF(1);

   4388  2 000420   000010 630400 3                  EPPR0   8
         2 000421   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000422   000000 701000 xent               TSX1    FMD$FLSHBUF
         2 000423   000000 011000                    NOP     0

      366     4389    2         CALL UQB$MDEQ(PAD$);

   4389  2 000424   200005 630500                    EPPR0   PAD$,,AUTO
         2 000425   200032 450500                    STP0    T$+4,,AUTO
         2 000426   200032 630500                    EPPR0   T$+4,,AUTO
         2 000427   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000430   000000 701000 xent               TSX1    UQB$MDEQ
         2 000431   000000 011000                    NOP     0

      367     4390    2         CALL FMN$SETX(F$DCB.PSN) ALTRET(OPERNPSN);

   4390  2 000432   200004 236100                    LDQ     JDCB$,,AUTO
         2 000433   000024 036003                    ADLQ    20,DU
         2 000434   200032 756100                    STQ     T$+4,,AUTO
         2 000435   200032 630500                    EPPR0   T$+4,,AUTO
         2 000436   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000437   000000 701000 xent               TSX1    FMN$SETX
         2 000440   006167 702000 2                  TSX2    OPERNPSN

      368     4391    2         F$DCB.PSN=' ';

   4391  2 000441   200004 470500                    LDP0    JDCB$,,AUTO
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:76   
         2 000442   040100 100400                    MLR     fill='040'O
         2 000443   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 000444   000024 000006                    ADSC9   20,,PR0                  cn=0,n=6

      369     4392    2         GOTO ACNSEARCH;

   4392  2 000445   000347 710000 2                  TRA     ACNSEARCH

      370     4393    2         END;
      371     4394    1      ACCT$=PINCRW(F$CFU$,FM$CFU.ACCTX);

   4394  2 000446   200007 471500                    LDP1    CFU$,,AUTO
         2 000447   100002 221100                    LDX1    2,,PR1
         2 000450   000000 636011                    EAQ     0,X1
         2 000451   000000 036000 xsym               ADLQ    F$CFU$
         2 000452   200010 756100                    STQ     ACCT$,,AUTO

      372     4395    1      IF FM$CFUA.FLAGS.EXIST THEN GOTO FINDFILX;

   4395  2 000453   200010 473500                    LDP3    ACCT$,,AUTO
         2 000454   300005 234100                    SZN     5,,PR3
         2 000455   000524 604000 2                  TMI     FINDFILX

      373     4396                    /*
      374     4397                    *  IT WASN'T FILLED IN WHILE WE WAITED, SO LET'S SEARCH ACCT
      375     4398                    *  DIRECTORY FOR THE ACCOUNT ENTRY.
      376     4399                    */
      377     4400    1      CALL FMQ$SRCHAD(KEY$,ADDR(NIL)) ALTRET(NEWACCT);

   4400  2 000456   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 000457   200032 756100                    STQ     T$+4,,AUTO
         2 000460   200032 634500                    EPPR4   T$+4,,AUTO
         2 000461   200035 454500                    STP4    T$+7,,AUTO
         2 000462   200012 635500                    EPPR5   KEY$,,AUTO
         2 000463   200034 455500                    STP5    T$+6,,AUTO
         2 000464   200034 630500                    EPPR0   T$+6,,AUTO
         2 000465   000020 631400 xsym               EPPR1   B_VECTNIL+16
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:77   
         2 000466   000000 701000 xent               TSX1    FMQ$SRCHAD
         2 000467   000507 702000 2                  TSX2    NEWACCT

      378     4401                    /*
      379     4402                    *  FILL IN FM$CFUA FROM ACCOUNT DIRECTORY ENTRY
      380     4403                    */
      381     4404    2      IF FM$ADKEY.D THEN DO;

   4404  2 000470   200012 470500                    LDP0    KEY$,,AUTO
         2 000471   000000 234100                    SZN     0,,PR0
         2 000472   000477 605000 2                  TPL     s:4408

      382     4405    2         B$JIT.ERR=FMN$E$NOKEY;

   4405  2 000473   000035 236000 0                  LDQ     FMN$E$NOKEY
         2 000474   000000 471400 xsym               LDP1    B$JIT$
         2 000475   100012 756100                    STQ     10,,PR1

      383     4406    2         GOTO NEWACCT;

   4406  2 000476   000507 710000 2                  TRA     NEWACCT

      384     4407    2         END;
      385     4408    1      FM$CFUA.FDFITSDA=FM$ADKEY.FDSDA;

   4408  2 000477   200010 471500                    LDP1    ACCT$,,AUTO
         2 000500   000002 235100                    LDA     2,,PR0
         2 000501   100004 755100                    STA     4,,PR1

      386     4409    1      FM$CFUA.FDCSDA=FM$ADKEY.FDSDA;

   4409  2 000502   200012 470500                    LDP0    KEY$,,AUTO
         2 000503   200010 471500                    LDP1    ACCT$,,AUTO
         2 000504   000002 235100                    LDA     2,,PR0
         2 000505   100003 755100                    STA     3,,PR1

      387     4410    1      GOTO FINDFILX;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:78   

   4410  2 000506   000524 710000 2                  TRA     FINDFILX

      388     4411                    /*
      389     4412                    *  FILL IN FM$CFUA FOR A NEW ACCOUNT ENTRY
      390     4413                    */
      391     4414    1   NEWACCT:
      392     4415    1      IF B$JIT.ERR.CODE~=%E$NOKEY OR FPT$OPEN_V.OPER.NXTA THEN GOTO OPERAD;

   4415  2 000507   000000 470400 xsym  NEWACCT      LDP0    B$JIT$
         2 000510   000012 236100                    LDQ     10,,PR0
         2 000511   377770 376007                    ANQ     131064,DL
         2 000512   001020 116007                    CMPQ    528,DL
         2 000513   006154 601000 2                  TNZ     OPERAD
         2 000514   200003 471500                    LDP1    @PN$,,AUTO
         2 000515   100000 473500                    LDP3    0,,PR1
         2 000516   300000 236100                    LDQ     0,,PR3
         2 000517   010000 316007                    CANQ    4096,DL
         2 000520   006154 601000 2                  TNZ     OPERAD

      393     4416    1      CALL FMN$READFDFIT ALTRET(OPERAD);

   4416  2 000521   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000522   000000 701000 xent               TSX1    FMN$READFDFIT
         2 000523   006154 702000 2                  TSX2    OPERAD

   4415  2 000524                       FINDFILX     null
      394     4417                    /*
      395     4418                    *  RELEASE ACCT DIRECTORY AND SEARCH FOR FILENAME
      396     4419                    */
      397     4420    1   FINDFILX:;
      398     4421    1      CALL FMD$FLSHBUF(1);

   4421  2 000524   000010 630400 3                  EPPR0   8
         2 000525   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000526   000000 701000 xent               TSX1    FMD$FLSHBUF
         2 000527   000000 011000                    NOP     0
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:79   

      399     4422    1      CALL UQB$MDEQ(PAD$)ALTRET(OPER);

   4422  2 000530   200005 630500                    EPPR0   PAD$,,AUTO
         2 000531   200032 450500                    STP0    T$+4,,AUTO
         2 000532   200032 630500                    EPPR0   T$+4,,AUTO
         2 000533   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000534   000000 701000 xent               TSX1    UQB$MDEQ
         2 000535   006276 702000 2                  TSX2    OPER

      400     4423        %EJECT;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:80   
      401     4424                    /*D*
      402     4425                     (FINDFIL)
      403     4426                     Now that open has an account block that it is going to use, it
      404     4427                    does security checking based on the access control flags in the acct
      405     4428                    block entry.  If read or write accounts are associated with the file
      406     4429                    directory for this account,  that security check is done here.
      407     4430                    */
      408     4431    1   FINDFIL:
      409     4432    1      ACCT$=PINCRW(F$CFU$,FM$CFU.ACCTX);

   4432  2 000536   200007 470500       FINDFIL      LDP0    CFU$,,AUTO
         2 000537   000002 220100                    LDX0    2,,PR0
         2 000540   000000 636010                    EAQ     0,X0
         2 000541   000000 036000 xsym               ADLQ    F$CFU$
         2 000542   200010 756100                    STQ     ACCT$,,AUTO

      410     4433    1      CALL FMN$READFDFIT ALTRET(OPER);

   4433  2 000543   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000544   000000 701000 xent               TSX1    FMN$READFDFIT
         2 000545   006276 702000 2                  TSX2    OPER

   4432  2 000546                       FINDFIL1     null
      411     4434        %EJECT;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:81   
      412     4435                    /*D*
      413     4436                     (FINDFIL1)
      414     4437                     The user has access to the account specified and open has an
      415     4438                     acct block defining it.  At this point open is ready to look up the
      416     4439                     file that is to be opened.  'STAR' files reenter at this point.
      417     4440                    */
      418     4441    1   FINDFIL1:;
      419     4442    1      B$JIT.ERR='0'B;

   4442  2 000546   000000 470400 xsym               LDP0    B$JIT$
         2 000547   000012 450100                    STZ     10,,PR0

      420     4443    1      F$DCB.TYC='0'B;

   4443  2 000550   200004 471500                    LDP1    JDCB$,,AUTO
         2 000551   100001 450100                    STZ     1,,PR1
         2 000552   100002 450100                    STZ     2,,PR1

      421     4444    1      FM$CFU.SHARE=JDCB$->F$DCB.SHARE;

   4444  2 000553   200004 471500                    LDP1    JDCB$,,AUTO
         2 000554   200007 473500                    LDP3    CFU$,,AUTO
         2 000555   100031 236100                    LDQ     25,,PR1
         2 000556   000030 736000                    QLS     24
         2 000557   300000 676100                    ERQ     0,,PR3
         2 000560   060000 376003                    ANQ     24576,DU
         2 000561   300000 656100                    ERSQ    0,,PR3

      422     4445    1      IF NOT FPT$OPEN_V.OPER.NXTF THEN GOTO NAMESEARCH;

   4445  2 000562   200003 471500                    LDP1    @PN$,,AUTO
         2 000563   100000 473500                    LDP3    0,,PR1
         2 000564   300000 236100                    LDQ     0,,PR3
         2 000565   004000 316007                    CANQ    2048,DL
         2 000566   001121 600000 2                  TZE     NAMESEARCH

      423     4446        %EJECT;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:82   
      424     4447                    /*D*
      425     4448                     If this is a 'NXTF' request, open searches the file directory
      426     4449                     for the file actually desired.  Search conditions and 'THISF'
      427     4450                     requests are processed here.  The filename is moved to the DCB, and
      428     4451                    if this is a 'TEST' open without 'FPARAMS', the open process returns
      429     4452                    to the user.  The DCB is not opened.
      430     4453                    */
      431     4454    2      IF NOT F$DCB.STARF THEN DO;

   4454  2 000567   200004 474500                    LDP4    JDCB$,,AUTO
         2 000570   400064 236100                    LDQ     52,,PR4
         2 000571   200000 316003                    CANQ    65536,DU
         2 000572   000606 601000 2                  TNZ     s:4458

      432     4455    2         IF FM$CFUA.FLAGS.NEW THEN GOTO FMNE$FDEOFA;

   4455  2 000573   200010 475500                    LDP5    ACCT$,,AUTO
         2 000574   500005 236100                    LDQ     5,,PR5
         2 000575   200000 316003                    CANQ    65536,DU
         2 000576   006061 601000 2                  TNZ     FMNE$FDEOFA

      433     4456    2         CALL UQB$MENQS(ACCT$)ALTRET(OPER);

   4456  2 000577   200010 636500                    EPPR6   ACCT$,,AUTO
         2 000600   200032 456500                    STP6    T$+4,,AUTO
         2 000601   200032 630500                    EPPR0   T$+4,,AUTO
         2 000602   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000603   000000 701000 xent               TSX1    UQB$MENQS
         2 000604   006276 702000 2                  TSX2    OPER

      434     4457    2         END;

   4457  2 000605   000610 710000 2                  TRA     s:4459

      435     4458    1      ELSE NXTAR=F$DCB.NAME;

   4458  2 000606   400010 236100                    LDQ     8,,PR4
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:83   
         2 000607   200006 756100                    STQ     FDA,,AUTO

      436     4459    1      IF FPT$OPEN_V.SRCHCOND.REV AND F$DCB.NAME.L=0 THEN F$DCB.NAME='001777'O;

   4459  2 000610   200003 470500                    LDP0    @PN$,,AUTO
         2 000611   000000 471500                    LDP1    0,,PR0
         2 000612   100001 236100                    LDQ     1,,PR1
         2 000613   000001 316003                    CANQ    1,DU
         2 000614   000624 600000 2                  TZE     s:4460
         2 000615   200004 473500                    LDP3    JDCB$,,AUTO
         2 000616   300010 236100                    LDQ     8,,PR3
         2 000617   777000 316003                    CANQ    -512,DU
         2 000620   000624 601000 2                  TNZ     s:4460

   4459  2 000621   000100 100400                    MLR     fill='000'O
         2 000622   000011 000002 3                  ADSC9   9                        cn=0,n=2
         2 000623   300010 000040                    ADSC9   8,,PR3                   cn=0,n=32

      437     4460    2      IF NOT F$DCB.STARF OR B$JIT.STAR.DA(0)~=0 THEN DO;

   4460  2 000624   200004 471500                    LDP1    JDCB$,,AUTO
         2 000625   100064 236100                    LDQ     52,,PR1
         2 000626   200000 316003                    CANQ    65536,DU
         2 000627   000633 600000 2                  TZE     s:4461
         2 000630   000000 473400 xsym               LDP3    B$JIT$
         2 000631   300222 235100                    LDA     146,,PR3
         2 000632   006061 600000 2                  TZE     FMNE$FDEOFA

      438     4461    2         CALL FMQ$SRCHFD(ADDR(F$DCB.NAME),KEY$,SEG$,ACCT$,PN$)

   4461  2 000633   200004 236100                    LDQ     JDCB$,,AUTO
         2 000634   000010 036003                    ADLQ    8,DU
         2 000635   200032 756100                    STQ     T$+4,,AUTO
         2 000636   200003 236100                    LDQ     @PN$,,AUTO
         2 000637   200037 756100                    STQ     T$+9,,AUTO
         2 000640   200010 633500                    EPPR3   ACCT$,,AUTO
         2 000641   200036 453500                    STP3    T$+8,,AUTO
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:84   
         2 000642   200013 634500                    EPPR4   SEG$,,AUTO
         2 000643   200035 454500                    STP4    T$+7,,AUTO
         2 000644   200012 635500                    EPPR5   KEY$,,AUTO
         2 000645   200034 455500                    STP5    T$+6,,AUTO
         2 000646   200032 636500                    EPPR6   T$+4,,AUTO
         2 000647   200033 456500                    STP6    T$+5,,AUTO
         2 000650   200033 630500                    EPPR0   T$+5,,AUTO
         2 000651   000023 631400 xsym               EPPR1   B_VECTNIL+19
         2 000652   000000 701000 xent               TSX1    FMQ$SRCHFD
         2 000653   006052 702000 2                  TSX2    FMNE$FDEOF

      439     4462                    /*E*     ERROR: FMN-E$FDEOF-C
      440     4463                    *        MESSAGE:End of% %AC% file directory reached.
      441     4464                    */
      442     4465    2           ALTRET(FMNE$FDEOF);
      443     4466    2         JDCB$->F$DCB.NAME.L=FM$KEYENT.KLB;

   4466  2 000654   200012 470500                    LDP0    KEY$,,AUTO
         2 000655   200004 471500                    LDP1    JDCB$,,AUTO
         2 000656   000000 236100                    LDQ     0,,PR0
         2 000657   377000 376003                    ANQ     130560,DU
         2 000660   100010 552140                    STBQ    8,'40'O,PR1

      444     4467    2         JDCB$->F$DCB.NAME.C=FM$KEYENT.TXT;

   4467  2 000661   200012 470500                    LDP0    KEY$,,AUTO
         2 000662   000000 236100                    LDQ     0,,PR0
         2 000663   000033 772000                    QRL     27
         2 000664   000377 376007                    ANQ     255,DL
         2 000665   000000 620006                    EAX0    0,QL
         2 000666   040100 100540                    MLR     fill='040'O
         2 000667   000000 200010                    ADSC9   0,,PR0                   cn=1,n=*X0
         2 000670   100010 200037                    ADSC9   8,,PR1                   cn=1,n=31

      445     4468    2         END;

   4468  2 000671   000672 710000 2                  TRA     s:4470
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:85   

      446     4469    1      ELSE GOTO FMNE$FDEOFA;
      447     4470    2      IF F$DCB.STARF THEN DO; /* INSERT SPECIALS APPROPO */

   4470  2 000672   100064 236100                    LDQ     52,,PR1
         2 000673   200000 316003                    CANQ    65536,DU
         2 000674   000707 600000 2                  TZE     s:4475

      448     4471    2         CALL CHKNXT;

   4471  2 000675   000766 701000 2                  TSX1    CHKNXT
         2 000676   000000 011000                    NOP     0

      449     4472    2   NXTF0:B$JIT.ERR='0'B;

   4472  2 000677   000000 470400 xsym  NXTF0        LDP0    B$JIT$
         2 000700   000012 450100                    STZ     10,,PR0

      450     4473    2         CALL FMN$CHKFLACN(JDCB$) ALTRET(OPERFD);

   4473  2 000701   200004 631500                    EPPR1   JDCB$,,AUTO
         2 000702   200032 451500                    STP1    T$+4,,AUTO
         2 000703   200032 630500                    EPPR0   T$+4,,AUTO
         2 000704   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000705   000000 701000 xent               TSX1    FMN$CHKFLACN
         2 000706   006072 702000 2                  TSX2    OPERFD

      451     4474    2         END;

      452     4475    1      IF NOT FPT$OPEN_V.OPER.TEST

   4475  2 000707   200003 470500                    LDP0    @PN$,,AUTO
         2 000710   000000 471500                    LDP1    0,,PR0
         2 000711   100000 236100                    LDQ     0,,PR1
         2 000712   020000 316007                    CANQ    8192,DL
         2 000713   000745 601000 2                  TNZ     s:4484

PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:86   
      453     4476    1      THEN CALL FMS$SCANNAMENW /* SEE IF WE SHOULD SWITCH CFUS */

   4476  2 000714   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000715   000000 701000 xent               TSX1    FMS$SCANNAMENW
         2 000716   000720 702000 2                  TSX2    s:4478
         2 000717   000745 710000 2                  TRA     s:4484

      454     4477    2         WHENALTRETURN DO;

      455     4478    2            CALL FMD$FLSHBUF(1);

   4478  2 000720   000010 630400 3                  EPPR0   8
         2 000721   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000722   000000 701000 xent               TSX1    FMD$FLSHBUF
         2 000723   000000 011000                    NOP     0

      456     4479    2            IF NOT F$DCB.STARF THEN CALL UQB$MDEQ(ACCT$)ALTRET(OPER);

   4479  2 000724   200004 470500                    LDP0    JDCB$,,AUTO
         2 000725   000064 236100                    LDQ     52,,PR0
         2 000726   200000 316003                    CANQ    65536,DU
         2 000727   000736 601000 2                  TNZ     s:4480

   4479  2 000730   200010 631500                    EPPR1   ACCT$,,AUTO
         2 000731   200032 451500                    STP1    T$+4,,AUTO
         2 000732   200032 630500                    EPPR0   T$+4,,AUTO
         2 000733   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000734   000000 701000 xent               TSX1    UQB$MDEQ
         2 000735   006276 702000 2                  TSX2    OPER

      457     4480    2            IF CFU$=F$DCB.CFU$ THEN GOTO NAMESEARCH;

   4480  2 000736   200004 470500                    LDP0    JDCB$,,AUTO
         2 000737   200007 236100                    LDQ     CFU$,,AUTO
         2 000740   000066 116100                    CMPQ    54,,PR0
         2 000741   001121 600000 2                  TZE     NAMESEARCH

PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:87   
      458     4481    2            CFU$=ADDR(NIL); /* USE FASTPATH FITCHK */

   4481  2 000742   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 000743   200007 756100                    STQ     CFU$,,AUTO

      459     4482    2            GOTO FOUNDIT;

   4482  2 000744   001463 710000 2                  TRA     FOUNDIT

      460     4483    2            END;
      461     4484    1      GOTO SETCFU;

   4484  2 000745   001243 710000 2                  TRA     SETCFU

      462     4485        %EJECT;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:88   
      463     4486                    /*I*   NAME:       CHKLAST,CHKNXT
      464     4487                   *      PURPOSE:   To insert special starfile names in the NXTF sequence.
      465     4488                    *      DESCRIPTION:Does exactly that. Altreturns if it did anything to
      466     4489                    *                  F$DCB.NAME.
      467     4490                    */
      468     4491    1   CHKLAST: PROC ALTRET;

   4491  2 000746   200030 741300       CHKLAST      STX1  ! T$+2,,AUTO

      469     4492    2      IF FPT$OPEN_V.SRCHCOND.REV THEN F$DCB.NAME.C=' ';

   4492  2 000747   200003 470500                    LDP0    @PN$,,AUTO
         2 000750   000000 471500                    LDP1    0,,PR0
         2 000751   100001 236100                    LDQ     1,,PR1
         2 000752   000001 316003                    CANQ    1,DU
         2 000753   000761 600000 2                  TZE     s:4493

   4492  2 000754   200004 473500                    LDP3    JDCB$,,AUTO
         2 000755   040100 100400                    MLR     fill='040'O
         2 000756   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 000757   300010 200037                    ADSC9   8,,PR3                   cn=1,n=31
         2 000760   000765 710000 2                  TRA     s:4493+4

      470     4493    2      ELSE F$DCB.NAME.C='*_';

   4493  2 000761   200004 473500                    LDP3    JDCB$,,AUTO
         2 000762   040100 100400                    MLR     fill='040'O
         2 000763   000053 000002 0                  ADSC9   TESTOPN+3                cn=0,n=2
         2 000764   300010 200037                    ADSC9   8,,PR3                   cn=1,n=31
         2 000765   000767 710000 2                  TRA     s:4495

      471     4494    2   CHKNXT: ENTRY ALTRET;

   4494  2 000766   200030 741300       CHKNXT       STX1  ! T$+2,,AUTO

      472     4495    2      I=F$DCB.STARX;

PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:89   
   4495  2 000767   200004 470500                    LDP0    JDCB$,,AUTO
         2 000770   000064 236100                    LDQ     52,,PR0
         2 000771   000011 772000                    QRL     9
         2 000772   000007 376007                    ANQ     7,DL
         2 000773   200015 756100                    STQ     I,,AUTO

      473     4496    2      F$DCB.STARX=0;

   4496  2 000774   000012 236000 3                  LDQ     10
         2 000775   000064 356100                    ANSQ    52,,PR0

      474     4497    2      IF NOT FPT$OPEN_V.OPER.THISF OR B$JIT.STAR.DA(I)=0 THEN I=0;

   4497  2 000776   200003 471500                    LDP1    @PN$,,AUTO
         2 000777   100000 473500                    LDP3    0,,PR1
         2 001000   300000 236100                    LDQ     0,,PR3
         2 001001   002000 316007                    CANQ    1024,DL
         2 001002   001007 600000 2                  TZE     s:4497+9
         2 001003   000000 474400 xsym               LDP4    B$JIT$
         2 001004   200015 720100                    LXL0    I,,AUTO
         2 001005   400222 235110                    LDA     146,X0,PR4
         2 001006   001010 601000 2                  TNZ     s:4498

   4497  2 001007   200015 450100                    STZ     I,,AUTO

      475     4498    3      IF I=0 THEN DO J=1 TO SIZEW(B$JIT.STAR)-1;

   4498  2 001010   200015 235100                    LDA     I,,AUTO
         2 001011   001075 601000 2                  TNZ     s:4512

   4498  2 001012   000001 236007                    LDQ     1,DL
         2 001013   200016 756100                    STQ     J,,AUTO
         2 001014   001072 710000 2                  TRA     s:4511+1

      476     4499    3         IF B$JIT.STAR.DA(J)~=0

   4499  2 001015   000000 470400 xsym               LDP0    B$JIT$
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:90   
         2 001016   200016 720100                    LXL0    J,,AUTO
         2 001017   000222 235110                    LDA     146,X0,PR0
         2 001020   001071 600000 2                  TZE     s:4511

      477     4500    3         THEN IF (FPT$OPEN_V.SRCHCOND.REV AND

   4500  2 001021   200003 471500                    LDP1    @PN$,,AUTO
         2 001022   100000 473500                    LDP3    0,,PR1
         2 001023   300001 236100                    LDQ     1,,PR3
         2 001024   000001 316003                    CANQ    1,DU
         2 001025   001050 600000 2                  TZE     s:4500+23
         2 001026   200016 235100                    LDA     J,,AUTO
         2 001027   040100 106405                    CMPC    fill='040'O
         2 001030   000000 000001 xsym               ADSC9   FM_STARCHARS,A           cn=0,n=1
         2 001031   200006 400001                    ADSC9   FDA,,AUTO                cn=2,n=1
         2 001032   001037 601000 2                  TNZ     s:4500+14
         2 001033   200006 236100                    LDQ     FDA,,AUTO
         2 001034   777000 376003                    ANQ     -512,DU
         2 001035   003000 116003                    CMPQ    1536,DU
         2 001036   001043 603000 2                  TRC     s:4500+18
         2 001037   040100 106405                    CMPC    fill='040'O
         2 001040   000000 000001 xsym               ADSC9   FM_STARCHARS,A           cn=0,n=1
         2 001041   200006 400001                    ADSC9   FDA,,AUTO                cn=2,n=1
         2 001042   001050 603000 2                  TRC     s:4500+23
         2 001043   200004 474500                    LDP4    JDCB$,,AUTO
         2 001044   040005 106500                    CMPC    fill='040'O
         2 001045   400010 400036                    ADSC9   8,,PR4                   cn=2,n=30
         2 001046   000000 000001 xsym               ADSC9   FM_STARCHARS,A           cn=0,n=1
         2 001047   001065 602000 2                  TNC     s:4508
         2 001050   300001 236100                    LDQ     1,,PR3
         2 001051   000001 316003                    CANQ    1,DU
         2 001052   001071 601000 2                  TNZ     s:4511
         2 001053   200016 235100                    LDA     J,,AUTO
         2 001054   040005 106500                    CMPC    fill='040'O
         2 001055   200006 400001                    ADSC9   FDA,,AUTO                cn=2,n=1
         2 001056   000000 000001 xsym               ADSC9   FM_STARCHARS,A           cn=0,n=1
         2 001057   001071 603000 2                  TRC     s:4511
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:91   
         2 001060   200004 474500                    LDP4    JDCB$,,AUTO
         2 001061   040005 106500                    CMPC    fill='040'O
         2 001062   400010 400001                    ADSC9   8,,PR4                   cn=2,n=1
         2 001063   000000 000001 xsym               ADSC9   FM_STARCHARS,A           cn=0,n=1
         2 001064   001071 602000 2                  TNC     s:4511

      478     4501    3              (SUBSTR(FM_STARCHARS,J,1)=NXTAR.C AND NXTAR.L>2
      479     4502    3              OR SUBSTR(FM_STARCHARS,J,1)<NXTAR.C)
      480     4503    3              AND SUBSTR(FM_STARCHARS,J,1)>SUBSTR(F$DCB.NAME.C,1))
      481     4504    3              OR (NOT FPT$OPEN_V.SRCHCOND.REV AND
      482     4505    3              SUBSTR(FM_STARCHARS,J,1)>NXTAR.C
      483     4506    3              AND SUBSTR(FM_STARCHARS,J,1)<=SUBSTR(F$DCB.NAME.C,1,1))
      484     4507    4            THEN DO;

      485     4508    4               I=J;

   4508  2 001065   200015 755100                    STA     I,,AUTO

      486     4509    4               CALL INSERT(F$DCB.NAME.C,1,,SUBSTR(FM_STARCHARS,I,1));

   4509  2 001066   040100 100405                    MLR     fill='040'O
         2 001067   000000 000001 xsym               ADSC9   FM_STARCHARS,A           cn=0,n=1
         2 001070   400010 400036                    ADSC9   8,,PR4                   cn=2,n=30

      487     4510    4               END;

      488     4511    3         END;

   4511  2 001071   200016 054100                    AOS     J,,AUTO
         2 001072   200016 235100                    LDA     J,,AUTO
         2 001073   000007 115007                    CMPA    7,DL
         2 001074   001015 604400 2                  TMOZ    s:4499

      489     4512    2      IF I=0 THEN RETURN;

   4512  2 001075   200015 235100                    LDA     I,,AUTO
         2 001076   001101 601000 2                  TNZ     s:4513
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:92   

   4512  2 001077   200030 221300                    LDX1  ! T$+2,,AUTO
         2 001100   000001 702211                    TSX2  ! 1,X1

      490     4513    2      F$DCB.NAME.L=2;

   4513  2 001101   200004 470500                    LDP0    JDCB$,,AUTO
         2 001102   002000 236003                    LDQ     1024,DU
         2 001103   000010 552140                    STBQ    8,'40'O,PR0

      491     4514    2      CALL CONCAT(F$DCB.NAME.C,'*',SUBSTR(FM_STARCHARS,I,1));

   4514  2 001104   000052 236003                    LDQ     42,DU
         2 001105   000010 552120                    STBQ    8,'20'O,PR0
         2 001106   200015 235100                    LDA     I,,AUTO
         2 001107   040100 100405                    MLR     fill='040'O
         2 001110   000000 000001 xsym               ADSC9   FM_STARCHARS,A           cn=0,n=1
         2 001111   000010 400036                    ADSC9   8,,PR0                   cn=2,n=30

      492     4515    2      SEG$=ADDR(B$JIT.STAR.DA(I));

   4515  2 001112   200015 236100                    LDQ     I,,AUTO
         2 001113   000022 736000                    QLS     18
         2 001114   000222 036003                    ADLQ    146,DU
         2 001115   000000 036000 xsym               ADLQ    B$JIT$
         2 001116   200013 756100                    STQ     SEG$,,AUTO

      493     4516    2      ALTRETURN;

   4516  2 001117   200030 221300                    LDX1  ! T$+2,,AUTO
         2 001120   000000 702211                    TSX2  ! 0,X1

      494     4517    2   END CHKLAST;
      495     4518        %EJECT;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:93   
      496     4519                    /*D*
      497     4520                     If this is a 'TEST' open (not including 'NXTF') it is treated
      498     4521                    as if it were a non shared first open.  The NAMEX pointer is not set
      499     4522                    in the CFU block, because the CFU will be given away at the end of
      500     4523                    open and so we do not care if the CFU currently describes the file.
      501     4524                    This prevents a 'FILE BUSY' from being returned on a test open.
      502     4525                    */
      503     4526    1   NAMESEARCH:
      504     4527    1      FM_OPNS.TOT=FM_OPNS.TOT+1;

   4527  2 001121   000000 054000 1     NAMESEARCH   AOS     FM_OPNS

      505     4528    1      IF FPT$OPEN_V.OPER.TEST THEN GOTO FIRSTOPN;

   4528  2 001122   200003 470500                    LDP0    @PN$,,AUTO
         2 001123   000000 471500                    LDP1    0,,PR0
         2 001124   100000 236100                    LDQ     0,,PR1
         2 001125   020000 316007                    CANQ    8192,DL
         2 001126   001151 601000 2                  TNZ     FIRSTOPN

      506     4529                    /*D*
      507     4530                     Open scans the CFU name area for the current filename.  It searches
      508     4531                     to see if it is already open or available without a file directory
      509     4532                     search.  The scan CFU area routine (FMS$SCANNAME) takes the
      510     4533                     alternate return if we are attached to either a shared CFU or we
      511     4534                     have the good information so open does not have to read the file
      512     4535                     directory.  If one of the opens is a create, the two CFU's have
      513     4536                     been linked together.  Thus if a CFU points to us, open still has
      514     4537                     to read the file directory to find the file being opened.  (The
      515     4538                     file defined in the CFU is the one being created, not the one we
      516     4539                     want to open for INPUT.)
      517     4540                     If the file is busy or it exists and the user has specified
      518     4541                    CREATE, ERROR those errors are possibly discovered here and returned
      519     4542                    to the user.
      520     4543                    */
      521     4544    1      CFU$=ADDR(NIL); /* USE FAST PATH FITCHK IF ALTRET FROM SCANCFUS */

PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:94   
   4544  2 001127   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 001130   200007 756100                    STQ     CFU$,,AUTO

      522     4545    1      CALL FMS$SCANNAME ALTRET(FOUNDIT);

   4545  2 001131   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 001132   000000 701000 xent               TSX1    FMS$SCANNAME
         2 001133   001463 702000 2                  TSX2    FOUNDIT

      523     4546    2      IF B$JIT.ERR.CODE~=0 THEN DO;

   4546  2 001134   000000 470400 xsym               LDP0    B$JIT$
         2 001135   000012 236100                    LDQ     10,,PR0
         2 001136   377770 316007                    CANQ    131064,DL
         2 001137   001146 600000 2                  TZE     s:4550

      524     4547    2         IF F$DCB.CFU$->FM$CFU.FITSDA~=0 THEN GOTO FOUNDERR;

   4547  2 001140   200004 471500                    LDP1    JDCB$,,AUTO
         2 001141   100066 473500                    LDP3    54,,PR1
         2 001142   300000 236100                    LDQ     0,,PR3
         2 001143   000032 316000 xsym               CANQ    B_VECTNIL+26
         2 001144   001507 601000 2                  TNZ     FOUNDERR

      525     4548    2         ELSE GOTO OPER;

   4548  2 001145   006276 710000 2                  TRA     OPER

      526     4549    2         END;
      527     4550    1      CFU$=F$DCB.CFU$;

   4550  2 001146   200004 471500                    LDP1    JDCB$,,AUTO
         2 001147   100066 236100                    LDQ     54,,PR1
         2 001150   200007 756100                    STQ     CFU$,,AUTO

      528     4551                    /*D*
      529     4552                     If no mention of this file was found in the CFU area, open must
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:95   
      530     4553                     now look it up in the file directory of the specified account.  For
      531     4554                     'STAR' files open searches the star file directory (*T).  For
      532     4555                     permanent files open searches the actual account file directory.
      533     4556                    */
      534     4557    1   FIRSTOPN:
      535     4558    2      IF JDCB$->F$DCB.STARF THEN DO;

   4558  2 001151   200004 470500       FIRSTOPN     LDP0    JDCB$,,AUTO
         2 001152   000064 236100                    LDQ     52,,PR0
         2 001153   200000 316003                    CANQ    65536,DU
         2 001154   001200 600000 2                  TZE     s:4567

      536     4559    2         IF B$JIT$->B$JIT.STAR.DA(JDCB$->F$DCB.STARX)=0

   4559  2 001155   000064 236100                    LDQ     52,,PR0
         2 001156   000011 772000                    QRL     9
         2 001157   000007 376007                    ANQ     7,DL
         2 001160   000000 471400 xsym               LDP1    B$JIT$
         2 001161   100222 235106                    LDA     146,QL,PR1
         2 001162   005325 600000 2                  TZE     BNEWFILE

      537     4560    2         THEN GOTO BNEWFILE;
      538     4561    3         IF JDCB$->F$DCB.STARX~=0 THEN DO;

   4561  2 001163   000064 236100                    LDQ     52,,PR0
         2 001164   007000 316007                    CANQ    3584,DL
         2 001165   001175 600000 2                  TZE     s:4565

      539     4562    3            FM$CFU.FITSDA=B$JIT$->B$JIT.STAR.DA(JDCB$->F$DCB.STARX);

   4562  2 001166   000064 236100                    LDQ     52,,PR0
         2 001167   000011 772000                    QRL     9
         2 001170   000007 376007                    ANQ     7,DL
         2 001171   200007 473500                    LDP3    CFU$,,AUTO
         2 001172   100222 236106                    LDQ     146,QL,PR1
         2 001173   300000 552134                    STBQ    0,'34'O,PR3

PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:96   
      540     4563    3            GOTO FOUNDIT;

   4563  2 001174   001463 710000 2                  TRA     FOUNDIT

      541     4564    3            END;
      542     4565    2         ACCT$=ADDR(NIL);

   4565  2 001175   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 001176   200010 756100                    STQ     ACCT$,,AUTO

      543     4566    2         END;

   4566  2 001177   001212 710000 2                  TRA     s:4569

      544     4567    1      ELSE IF FM$CFUA.FLAGS.NEW THEN GOTO BNEWFILE0;

   4567  2 001200   200010 471500                    LDP1    ACCT$,,AUTO
         2 001201   100005 236100                    LDQ     5,,PR1
         2 001202   200000 316003                    CANQ    65536,DU
         2 001203   005312 601000 2                  TNZ     BNEWFILE0

      545     4568    1         ELSE CALL UQB$MENQS(ACCT$)ALTRET(OPER);

   4568  2 001204   200010 633500                    EPPR3   ACCT$,,AUTO
         2 001205   200032 453500                    STP3    T$+4,,AUTO
         2 001206   200032 630500                    EPPR0   T$+4,,AUTO
         2 001207   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001210   000000 701000 xent               TSX1    UQB$MENQS
         2 001211   006276 702000 2                  TSX2    OPER

      546     4569    2      IF FM$CFUF.ACCNAM=0 THEN DO; /*GOT NEW CTG AFTER LINKING CFUS */

   4569  2 001212   200007 470500                    LDP0    CFU$,,AUTO
         2 001213   000002 235100                    LDA     2,,PR0
         2 001214   001221 601000 2                  TNZ     s:4573

      547     4570    2         B$JIT.ERR=FMN$E$FILEBUSY;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:97   

   4570  2 001215   000025 236000 0                  LDQ     FMN$E$FILEBUSY
         2 001216   000000 471400 xsym               LDP1    B$JIT$
         2 001217   100012 756100                    STQ     10,,PR1

      548     4571    2         GOTO BNEWFILEX;

   4571  2 001220   005247 710000 2                  TRA     BNEWFILEX

      549     4572    2         END;
      550     4573    1      FM_OPNS.SLO=FM_OPNS.SLO+1;

   4573  2 001221   000001 054000 1                  AOS     FM_OPNS+1

      551     4574    1      CALL FMQ$SRCHFD(ADDR(F$DCB.NAME),KEY$,SEG$,ACCT$,PN$)

   4574  2 001222   200004 236100                    LDQ     JDCB$,,AUTO
         2 001223   000010 036003                    ADLQ    8,DU
         2 001224   200032 756100                    STQ     T$+4,,AUTO
         2 001225   200003 236100                    LDQ     @PN$,,AUTO
         2 001226   200037 756100                    STQ     T$+9,,AUTO
         2 001227   200010 631500                    EPPR1   ACCT$,,AUTO
         2 001230   200036 451500                    STP1    T$+8,,AUTO
         2 001231   200013 633500                    EPPR3   SEG$,,AUTO
         2 001232   200035 453500                    STP3    T$+7,,AUTO
         2 001233   200012 634500                    EPPR4   KEY$,,AUTO
         2 001234   200034 454500                    STP4    T$+6,,AUTO
         2 001235   200032 635500                    EPPR5   T$+4,,AUTO
         2 001236   200033 455500                    STP5    T$+5,,AUTO
         2 001237   200033 630500                    EPPR0   T$+5,,AUTO
         2 001240   000023 631400 xsym               EPPR1   B_VECTNIL+19
         2 001241   000000 701000 xent               TSX1    FMQ$SRCHFD
         2 001242   005247 702000 2                  TSX2    BNEWFILEX

   4573  2 001243                       SETCFU       null
      552     4575    1        ALTRET(BNEWFILEX);
      553     4576        %EJECT;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:98   
      554     4577                    /*D*
      555     4578                     If the file is not found in the directory, open assumes that a
      556     4579               new file is being created (BNEWFILE). Otherwise open fills in the CFU from
      557     4580               the file directory entry.
      558     4581               */
      559     4582    1   SETCFU:;
      560     4583    1      FDA=FM$FDSEG.FITSDA;

   4583  2 001243   200013 470500                    LDP0    SEG$,,AUTO
         2 001244   000000 236100                    LDQ     0,,PR0
         2 001245   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 001246   200006 756100                    STQ     FDA,,AUTO

      561     4584    2      IF FM$FDSEG.DESC.DELF THEN DO;

   4584  2 001247   000000 234100                    SZN     0,,PR0
         2 001250   001341 605000 2                  TPL     s:4603

      562     4585    2         IF NOT F$DCB.FFLG&%(~FFLG_NOLIST#&(~FFLG_EXEC#))

   4585  2 001251   200004 471500                    LDP1    JDCB$,,AUTO
         2 001252   100004 220100                    LDX0    4,,PR1
         2 001253   765777 360003                    ANX0    -5121,DU
         2 001254   001266 601000 2                  TNZ     s:4590

      563     4586    3         THEN IF B$JIT.PRIV.ACTIVE.FMREAD THEN DO;

   4586  2 001255   000000 473400 xsym               LDP3    B$JIT$
         2 001256   300013 236100                    LDQ     11,,PR3
         2 001257   020000 316003                    CANQ    8192,DU
         2 001260   001266 600000 2                  TZE     s:4590

      564     4587    3               F$DCB.FFLG=%FFLG_READ#;

   4587  2 001261   400000 220003                    LDX0    -131072,DU
         2 001262   100004 740100                    STX0    4,,PR1

PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:99   
      565     4588    3               F$DCB.PRIVOPN='1'B; /* Just in case we ever log TEST opens */

   4588  2 001263   200004 470500                    LDP0    JDCB$,,AUTO
         2 001264   200000 236003                    LDQ     65536,DU
         2 001265   000102 256100                    ORSQ    66,,PR0

      566     4589    3               END;

      567     4590    2         IF F$DCB.FFLG&%(~FFLG_NOLIST#&(~FFLG_EXEC#))

   4590  2 001266   200004 470500                    LDP0    JDCB$,,AUTO
         2 001267   000004 220100                    LDX0    4,,PR0
         2 001270   765777 360003                    ANX0    -5121,DU
         2 001271   001340 600000 2                  TZE     s:4601

      568     4591    3         THEN IF FM$FDSEG.DESC.ARCHIVE THEN DO; /* INACTIVE STOWED HAS NO FIT */

   4591  2 001272   200013 471500                    LDP1    SEG$,,AUTO
         2 001273   100000 430100                    FSZN    0,,PR1
         2 001274   001335 605000 2                  TPL     s:4600

      569     4592    3               CALL HFF$DSIZ(POFFW(ADDR(PN$.FPARAM_),ADDR(PN$.V_)),FDA);

   4592  2 001275   200003 236100                    LDQ     @PN$,,AUTO
         2 001276   000022 772000                    QRL     18
         2 001277   200032 756100                    STQ     T$+4,,AUTO
         2 001300   200003 236100                    LDQ     @PN$,,AUTO
         2 001301   000014 036003                    ADLQ    12,DU
         2 001302   000022 772000                    QRL     18
         2 001303   200032 136100                    SBLQ    T$+4,,AUTO
         2 001304   200033 756100                    STQ     T$+5,,AUTO
         2 001305   200006 633500                    EPPR3   FDA,,AUTO
         2 001306   200035 453500                    STP3    T$+7,,AUTO
         2 001307   200033 634500                    EPPR4   T$+5,,AUTO
         2 001310   200034 454500                    STP4    T$+6,,AUTO
         2 001311   200034 630500                    EPPR0   T$+6,,AUTO
         2 001312   000020 631400 xsym               EPPR1   B_VECTNIL+16
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:100  
         2 001313   000000 701000 xent               TSX1    HFF$DSIZ
         2 001314   000000 011000                    NOP     0

      570     4593    3               IF FDA<SIZEC(CODE06)+8 THEN EXIT;

   4593  2 001315   200006 235100                    LDA     FDA,,AUTO
         2 001316   000024 115007                    CMPA    20,DL
         2 001317   001334 604000 2                  TMI     s:4599

      571     4594                    /* BUILD FPARAM FOR IT */
      572     4595    3               PN$.FPARAM_->FM$FIT.CODES(0)=STOWCODE0;

   4595  2 001320   200003 470500                    LDP0    @PN$,,AUTO
         2 001321   000014 471500                    LDP1    12,,PR0
         2 001322   000046 236000 0                  LDQ     STOWCODE0
         2 001323   100000 756100                    STQ     0,,PR1

      573     4596    3               PN$.FPARAM_->FM$FIT.CODES(1)=STOWCODE1;

   4596  2 001324   000014 471500                    LDP1    12,,PR0
         2 001325   000047 236000 0                  LDQ     STOWCODE1
         2 001326   100001 756100                    STQ     1,,PR1

      574     4597    3               ADDR(PN$.FPARAM_->FM$FIT.CODES(2))->CODE06=

   4597  2 001327   000014 471500                    LDP1    12,,PR0
         2 001330   200013 473500                    LDP3    SEG$,,AUTO
         2 001331   000100 100500                    MLR     fill='000'O
         2 001332   300001 000014                    ADSC9   1,,PR3                   cn=0,n=12
         2 001333   100002 000014                    ADSC9   2,,PR1                   cn=0,n=12

      575     4598    3                 ADDR(FM$FDSTOW.CODE06)->CODE06;
      576     4599    3               END;

   4599  2 001334   001340 710000 2                  TRA     s:4601

      577     4600    2            ELSE F$DCB.EXPIRE=FDA*512;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:101  

   4600  2 001335   200006 235100                    LDA     FDA,,AUTO
         2 001336   000011 735000                    ALS     9
         2 001337   000035 755100                    STA     29,,PR0

      578     4601    2         FDA=0;

   4601  2 001340   200006 450100                    STZ     FDA,,AUTO

      579     4602    2         END;

      580     4603    1      F$DCB.DESC=FM$FDSEG.DESC;

   4603  2 001341   200013 470500                    LDP0    SEG$,,AUTO
         2 001342   000100 100500                    MLR     fill='000'O
         2 001343   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
         2 001344   200032 000004                    ADSC9   T$+4,,AUTO               cn=0,n=4
         2 001345   200032 220100                    LDX0    T$+4,,AUTO
         2 001346   200004 471500                    LDP1    JDCB$,,AUTO
         2 001347   100005 440100                    SXL0    5,,PR1

      581     4604    1      CALL FMD$FLSHBUF(1);

   4604  2 001350   000010 630400 3                  EPPR0   8
         2 001351   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001352   000000 701000 xent               TSX1    FMD$FLSHBUF
         2 001353   000000 011000                    NOP     0

      582     4605    1      FM$CFU.FITSDA=FDA;

   4605  2 001354   200007 470500                    LDP0    CFU$,,AUTO
         2 001355   200006 236100                    LDQ     FDA,,AUTO
         2 001356   000000 552134                    STBQ    0,'34'O,PR0

      583     4606    1      IF NOT F$DCB.STARF THEN CALL UQB$MDEQ(ACCT$)ALTRET(OPER);

   4606  2 001357   200004 470500                    LDP0    JDCB$,,AUTO
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:102  
         2 001360   000064 236100                    LDQ     52,,PR0
         2 001361   200000 316003                    CANQ    65536,DU
         2 001362   001371 601000 2                  TNZ     s:4607

   4606  2 001363   200010 631500                    EPPR1   ACCT$,,AUTO
         2 001364   200032 451500                    STP1    T$+4,,AUTO
         2 001365   200032 630500                    EPPR0   T$+4,,AUTO
         2 001366   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001367   000000 701000 xent               TSX1    UQB$MDEQ
         2 001370   006276 702000 2                  TSX2    OPER

      584     4607    1      IF FPT$OPEN_V.OPER.TEST AND PN$.FPARAM_=ADDR(NIL)

   4607  2 001371   200003 470500                    LDP0    @PN$,,AUTO
         2 001372   000000 471500                    LDP1    0,,PR0
         2 001373   100000 236100                    LDQ     0,,PR1
         2 001374   020000 316007                    CANQ    8192,DL
         2 001375   001417 600000 2                  TZE     s:4615
         2 001376   000014 236100                    LDQ     12,,PR0
         2 001377   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 001400   001417 601000 2                  TNZ     s:4615
         2 001401   200004 473500                    LDP3    JDCB$,,AUTO
         2 001402   300032 236100                    LDQ     26,,PR3
         2 001403   000777 376003                    ANQ     511,DU
         2 001404   000002 116003                    CMPQ    2,DU
         2 001405   001417 601000 2                  TNZ     s:4615
         2 001406   300005 236100                    LDQ     5,,PR3
         2 001407   200000 316007                    CANQ    65536,DL
         2 001410   001417 601000 2                  TNZ     s:4615
         2 001411   300004 220100                    LDX0    4,,PR3
         2 001412   001000 100003                    CMPX0   512,DU
         2 001413   001417 600000 2                  TZE     s:4615
         2 001414   300004 236100                    LDQ     4,,PR3
         2 001415   010000 316003                    CANQ    4096,DU
         2 001416   006221 600000 2                  TZE     OPERX

      585     4608    1        AND F$DCB.FUN=%IN#
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:103  
      586     4609    1        AND NOT F$DCB.DESC.NOLIST
      587     4610    1        AND F$DCB.FFLG~=%FFLG_CREATE#
      588     4611    1        AND NOT F$DCB.FFLG.NOLIST THEN GOTO OPERX;
      589     4612                    /* NO NEED TO READ THE FIT IF ONLY NAME IS NEEDED */
      590     4613                    /* AND THE FILE IS NOT NOLIST TO ANYONE */
      591     4614                    /* AND THE DIRECTORY IS ACCESSIBLE TO THIS USER */
      592     4615    2      IF FDA=0 THEN DO; /* DELETED OR INACTIVE STOWED (NO FIT) */

   4615  2 001417   200006 235100                    LDA     FDA,,AUTO
         2 001420   001463 601000 2                  TNZ     FOUNDIT

      593     4616    2         IF NOT F$DCB.FFLG&%(~FFLG_NOLIST#&(~FFLG_EXEC#)) THEN GOTO NODELFILE;

   4616  2 001421   200004 473500                    LDP3    JDCB$,,AUTO
         2 001422   300004 220100                    LDX0    4,,PR3
         2 001423   765777 360003                    ANX0    -5121,DU
         2 001424   001613 600000 2                  TZE     NODELFILE

      594     4617    2         IF F$DCB.FUN=%CREATE# AND B$JIT.PRIV.ACTIVE.FMEFT

   4617  2 001425   300032 236100                    LDQ     26,,PR3
         2 001426   000777 376003                    ANQ     511,DU
         2 001427   000003 116003                    CMPQ    3,DU
         2 001430   001437 601000 2                  TNZ     s:4619
         2 001431   000000 474400 xsym               LDP4    B$JIT$
         2 001432   400013 234100                    SZN     11,,PR4
         2 001433   001437 605000 2                  TPL     s:4619
         2 001434   100014 236100                    LDQ     12,,PR1
         2 001435   100000 316007                    CANQ    32768,DL
         2 001436   005312 601000 2                  TNZ     BNEWFILE0

      595     4618    2           AND FPT$OPEN_V.OVERFDE THEN GOTO BNEWFILE0;
      596     4619    2         F$DCB.FFLG='0'B;

   4619  2 001437   000000 220003                    LDX0    0,DU
         2 001440   300004 740100                    STX0    4,,PR3

PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:104  
      597     4620    2         IF F$DCB.FUN~=%IN# THEN GOTO FMNE$STOWEDFILE;

   4620  2 001441   200004 471500                    LDP1    JDCB$,,AUTO
         2 001442   100032 236100                    LDQ     26,,PR1
         2 001443   000777 376003                    ANQ     511,DU
         2 001444   000002 116003                    CMPQ    2,DU
         2 001445   006203 601000 2                  TNZ     FMNE$STOWEDFILE

      598     4621    2         IF FPT$OPEN_V.OPER.TEST THEN GOTO OPERX;

   4621  2 001446   000000 473500                    LDP3    0,,PR0
         2 001447   300000 236100                    LDQ     0,,PR3
         2 001450   020000 316007                    CANQ    8192,DL
         2 001451   006221 601000 2                  TNZ     OPERX

      599     4622    2         IF NOT B$JIT.PRIV.ACTIVE.FMEFT THEN GOTO FMNE$STOWEDFILE;

   4622  2 001452   000000 474400 xsym               LDP4    B$JIT$
         2 001453   400013 234100                    SZN     11,,PR4
         2 001454   006203 605000 2                  TPL     FMNE$STOWEDFILE

      600     4623                    /*E*     ERROR:  FMN-E$STOWEDFILE-E
      601     4624                    *        MESSAGE:File% %UF% is stowed inactive or deleted.
      602     4625                    *        MESSAGE1:EFT must be the opener of inactive or deleted files.
      603     4626                    *                 You tried to open% %DC% to one of them% (%UF)%.
      604     4627                    */
      605     4628    2         FM$CFU.FUN=%IN#;

   4628  2 001455   200007 475500                    LDP5    CFU$,,AUTO
         2 001456   500000 236100                    LDQ     0,,PR5
         2 001457   000003 376000 3                  ANQ     3
         2 001460   200000 276003                    ORQ     65536,DU
         2 001461   500000 756100                    STQ     0,,PR5

      606     4629    2         GOTO OPER2;

   4629  2 001462   006450 710000 2                  TRA     OPER2
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:105  

      607     4630    2         END;
      608     4631    1   FOUNDIT:
      609     4632    1      IF F$DCB.FUN=%CREATE#

   4632  2 001463   200004 470500       FOUNDIT      LDP0    JDCB$,,AUTO
         2 001464   000032 236100                    LDQ     26,,PR0
         2 001465   000777 376003                    ANQ     511,DU
         2 001466   000003 116003                    CMPQ    3,DU
         2 001467   001507 601000 2                  TNZ     FOUNDERR

      610     4633    1      THEN IF F$DCB.EXIST=%ERROR# THEN B$JIT.ERR=FMN$E$CREATERR;

   4633  2 001470   000031 236100                    LDQ     25,,PR0
         2 001471   003000 376007                    ANQ     1536,DL
         2 001472   001000 116007                    CMPQ    512,DL
         2 001473   001500 601000 2                  TNZ     s:4638

   4633  2 001474   000026 236000 0                  LDQ     FMN$E$CREATERR
         2 001475   000000 471400 xsym               LDP1    B$JIT$
         2 001476   100012 756100                    STQ     10,,PR1
         2 001477   001507 710000 2                  TRA     FOUNDERR

      611     4634                    /*E*     ERROR:  FMN-E$CREATERR-E
      612     4635                    *        MESSAGE:File% %FN% exists.
      613     4636              *        MESSAGE1:EXIST=ERROR specified to create file% %FN%, but it exists.
      614     4637              */
      615     4638    1         ELSE F$DCB.FEXT=B$JIT.FEXT(F$DCB.FEXTX);

   4638  2 001500   000034 236100                    LDQ     28,,PR0
         2 001501   000011 772000                    QRL     9
         2 001502   000777 376007                    ANQ     511,DL
         2 001503   000000 471400 xsym               LDP1    B$JIT$
         2 001504   003100 060506                    CSL     bolr='003'O
         2 001505   100220 000001                    BDSC    144,Q,PR1                by=0,bit=0,n=1
         2 001506   000064 000001                    BDSC    52,,PR0                  by=0,bit=0,n=1

PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:106  
   4632  2 001507                       FOUNDERR     null
      616     4639                    /*D*
      617     4640                     Open now reads the FIT of the file and performs all of the file
      618     4641                     access security checks.  If the user has access to the file, the
      619     4642                     open continues.  Otherwise a security violation error is returned
      620     4643                     to the user.  FPARAMS are returned here if requested.
      621     4644                    */
      622     4645    1   FOUNDERR:;
      623     4646    1      ERRCODE=B$JIT.ERR; /* SAVE ERROR IN CASE SECCHK DOESNT ALTRET */

   4646  2 001507   000000 470400 xsym               LDP0    B$JIT$
         2 001510   000012 236100                    LDQ     10,,PR0
         2 001511   200020 756100                    STQ     ERRCODE,,AUTO

      624     4647    1      B$JIT.ERR='0'B;

   4647  2 001512   000012 450100                    STZ     10,,PR0

      625     4648    1      IF CFU$=F$DCB.CFU$ THEN EFIT$=ENTADDR(FMN$READFIT);

   4648  2 001513   200004 471500                    LDP1    JDCB$,,AUTO
         2 001514   200007 236100                    LDQ     CFU$,,AUTO
         2 001515   100066 116100                    CMPQ    54,,PR1
         2 001516   001522 601000 2                  TNZ     s:4649

   4648  2 001517   000000 636000 xent               EAQ     FMN$READFIT
         2 001520   200017 756100                    STQ     FIT$,,AUTO
         2 001521   001524 710000 2                  TRA     s:4650

      626     4649    1      ELSE EFIT$=ENTADDR(FMN$READFITF); /* FAST PATH FITCHK */

   4649  2 001522   000000 636000 xent               EAQ     FMN$READFITF
         2 001523   200017 756100                    STQ     FIT$,,AUTO

      627     4650    1      CFU$=JDCB$->F$DCB.CFU$;

   4650  2 001524   100066 236100                    LDQ     54,,PR1
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:107  
         2 001525   200007 756100                    STQ     CFU$,,AUTO

      628     4651    1      CALL ENQFIT ALTRET(OPER);

   4651  2 001526   004751 701000 2                  TSX1    ENQFIT
         2 001527   006276 702000 2                  TSX2    OPER

      629     4652    1      FDA=FM$CFU.FITSDA;

   4652  2 001530   200007 470500                    LDP0    CFU$,,AUTO
         2 001531   000000 236100                    LDQ     0,,PR0
         2 001532   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 001533   200006 756100                    STQ     FDA,,AUTO

      630     4653    1      CALL EFIT$(BUF$,FDA)ALTRET(BADFIT);

   4653  2 001534   200006 631500                    EPPR1   FDA,,AUTO
         2 001535   200033 451500                    STP1    T$+5,,AUTO
         2 001536   200014 633500                    EPPR3   BUF$,,AUTO
         2 001537   200032 453500                    STP3    T$+4,,AUTO
         2 001540   200032 630500                    EPPR0   T$+4,,AUTO
         2 001541   200017 220100                    LDX0    FIT$,,AUTO
         2 001542   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 001543   000000 701010                    TSX1    0,X0
         2 001544   006242 702000 2                  TSX2    BADFIT

      631     4654    1      IF NOT F$DCB.STARF THEN F$DCB.OWNER=FM$CFUA.ACCESS.OWNERF;

   4654  2 001545   200004 470500                    LDP0    JDCB$,,AUTO
         2 001546   000064 236100                    LDQ     52,,PR0
         2 001547   200000 316003                    CANQ    65536,DU
         2 001550   001557 601000 2                  TNZ     s:4655

   4654  2 001551   200010 471500                    LDP1    ACCT$,,AUTO
         2 001552   100005 236100                    LDQ     5,,PR1
         2 001553   000003 736000                    QLS     3
         2 001554   000064 676100                    ERQ     52,,PR0
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:108  
         2 001555   040000 376007                    ANQ     16384,DL
         2 001556   000064 656100                    ERSQ    52,,PR0

      632     4655    1      IB.FFLG=F$DCB.FFLG;

   4655  2 001557   000004 220100                    LDX0    4,,PR0
         2 001560   200015 740100                    STX0    I,,AUTO

      633     4656    1      IB.FDCM=F$DCB.FDCM;

   4656  2 001561   000073 236100                    LDQ     59,,PR0
         2 001562   200015 552104                    STBQ    I,'04'O,AUTO

      634     4657    1      FIT$=PINCRW(BUF$,SIZEW(FM$GRAN));

   4657  2 001563   200014 236100                    LDQ     BUF$,,AUTO
         2 001564   000005 036003                    ADLQ    5,DU
         2 001565   200017 756100                    STQ     FIT$,,AUTO

      635     4658    1      CALL FMO$SECCHK(FPT$OPEN_V,FM$FIT);

   4658  2 001566   200003 471500                    LDP1    @PN$,,AUTO
         2 001567   100000 473500                    LDP3    0,,PR1
         2 001570   200033 756100                    STQ     T$+5,,AUTO
         2 001571   200032 453500                    STP3    T$+4,,AUTO
         2 001572   200032 630500                    EPPR0   T$+4,,AUTO
         2 001573   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 001574   000000 701000 xent               TSX1    FMO$SECCHK
         2 001575   000000 011000                    NOP     0

      636     4659    1      IF NOT F$DCB.FFLG THEN

   4659  2 001576   200004 470500                    LDP0    JDCB$,,AUTO
         2 001577   000004 220100                    LDX0    4,,PR0
         2 001600   001766 601000 2                  TNZ     s:4696

      637     4660    2         IF B$JIT.ERR.CODE=%E$NOFILE THEN DO;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:109  

   4660  2 001601   000000 471400 xsym               LDP1    B$JIT$
         2 001602   100012 236100                    LDQ     10,,PR1
         2 001603   377770 376007                    ANQ     131064,DL
         2 001604   001610 116007                    CMPQ    904,DL
         2 001605   001743 601000 2                  TNZ     s:4689

      638     4661    2            F$DCB.FFLG=IB.FFLG;

   4661  2 001606   200015 221100                    LDX1    I,,AUTO
         2 001607   000004 741100                    STX1    4,,PR0

      639     4662    2            F$DCB.FDCM=IB.FDCM;

   4662  2 001610   200004 470500                    LDP0    JDCB$,,AUTO
         2 001611   200015 236100                    LDQ     I,,AUTO
         2 001612   000073 552104                    STBQ    59,'04'O,PR0

   4662  2 001613                       NODELFILE    null
      640     4663    2   NODELFILE:;
      641     4664    2            IF F$DCB.FUN=%CREATE# THEN B$JIT.ERR=FMN$E$CREATONLY;

   4664  2 001613   200004 470500                    LDP0    JDCB$,,AUTO
         2 001614   000032 236100                    LDQ     26,,PR0
         2 001615   000777 376003                    ANQ     511,DU
         2 001616   000003 116003                    CMPQ    3,DU
         2 001617   001624 601000 2                  TNZ     s:4670

   4664  2 001620   000043 236000 0                  LDQ     FMN$E$CREATONLY
         2 001621   000000 471400 xsym               LDP1    B$JIT$
         2 001622   100012 756100                    STQ     10,,PR1
         2 001623   001627 710000 2                  TRA     s:4671

      642     4665                    /*E*     ERROR: FMN-E$CREATONLY-E
      643     4666                             MESSAGE:Nolist file% %FN% exists.
      644     4667                             MESSAGE1:You cannot create the file% %UF%
      645     4668                                      because it exists, but is not listable by you.
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:110  
      646     4669                    */
      647     4670    2            ELSE B$JIT.ERR=FMN$E$NOFILE;

   4670  2 001624   000023 236000 0                  LDQ     FMN$E$NOFILE
         2 001625   000000 471400 xsym               LDP1    B$JIT$
         2 001626   100012 756100                    STQ     10,,PR1

      648     4671    3            IF FPT$OPEN_V.OPER.NXTF THEN DO;

   4671  2 001627   200003 473500                    LDP3    @PN$,,AUTO
         2 001630   300000 474500                    LDP4    0,,PR3
         2 001631   400000 236100                    LDQ     0,,PR4
         2 001632   004000 316007                    CANQ    2048,DL
         2 001633   005312 600000 2                  TZE     BNEWFILE0

      649     4672    3               CALL FMD$FLSHBUF(1);

   4672  2 001634   000010 630400 3                  EPPR0   8
         2 001635   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001636   000000 701000 xent               TSX1    FMD$FLSHBUF
         2 001637   000000 011000                    NOP     0

      650     4673    3               I=FM$CFU.ACCTX;

   4673  2 001640   200007 470500                    LDP0    CFU$,,AUTO
         2 001641   000002 236100                    LDQ     2,,PR0
         2 001642   000022 772000                    QRL     18
         2 001643   200015 756100                    STQ     I,,AUTO

      651     4674    3               CALL FMR$G8(CFU$,ACCTX)ALTRET(FMNE$NOCFUS);

   4674  2 001644   200011 631500                    EPPR1   ACCTX,,AUTO
         2 001645   200033 451500                    STP1    T$+5,,AUTO
         2 001646   200007 633500                    EPPR3   CFU$,,AUTO
         2 001647   200032 453500                    STP3    T$+4,,AUTO
         2 001650   200032 630500                    EPPR0   T$+4,,AUTO
         2 001651   000020 631400 xsym               EPPR1   B_VECTNIL+16
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:111  
         2 001652   000000 701000 xent               TSX1    FMR$G8
         2 001653   006127 702000 2                  TSX2    FMNE$NOCFUS

      652     4675    3               FM$CFU.ACCTX=I;

   4675  2 001654   200015 720100                    LXL0    I,,AUTO
         2 001655   200007 470500                    LDP0    CFU$,,AUTO
         2 001656   000002 740100                    STX0    2,,PR0

      653     4676    3               FM$CFU.FUN=F$DCB.FUN+4;

   4676  2 001657   200004 470500                    LDP0    JDCB$,,AUTO
         2 001660   200007 471500                    LDP1    CFU$,,AUTO
         2 001661   000032 236100                    LDQ     26,,PR0
         2 001662   000022 772000                    QRL     18
         2 001663   000777 376007                    ANQ     511,DL
         2 001664   000004 036007                    ADLQ    4,DL
         2 001665   000041 736000                    QLS     33
         2 001666   100000 676100                    ERQ     0,,PR1
         2 001667   700000 376003                    ANQ     -32768,DU
         2 001670   100000 656100                    ERSQ    0,,PR1

      654     4677    3               CALL FMP$RELCFUS(F$DCB.CFU$);

   4677  2 001671   200004 236100                    LDQ     JDCB$,,AUTO
         2 001672   000066 036003                    ADLQ    54,DU
         2 001673   200032 756100                    STQ     T$+4,,AUTO
         2 001674   200032 630500                    EPPR0   T$+4,,AUTO
         2 001675   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001676   000000 701000 xent               TSX1    FMP$RELCFUS
         2 001677   000000 011000                    NOP     0

      655     4678    3               F$DCB.CFU$=CFU$;

   4678  2 001700   200007 236100                    LDQ     CFU$,,AUTO
         2 001701   200004 470500                    LDP0    JDCB$,,AUTO
         2 001702   000066 756100                    STQ     54,,PR0
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:112  

      656     4679    4               IF FPT$OPEN_V.SRCHCOND.REV THEN DO;

   4679  2 001703   200003 471500                    LDP1    @PN$,,AUTO
         2 001704   100000 473500                    LDP3    0,,PR1
         2 001705   300001 236100                    LDQ     1,,PR3
         2 001706   000001 316003                    CANQ    1,DU
         2 001707   001736 600000 2                  TZE     s:4684

      657     4680    4                  I=F$DCB.NAME.L-1;

   4680  2 001710   000010 236100                    LDQ     8,,PR0
         2 001711   000033 772000                    QRL     27
         2 001712   000001 136007                    SBLQ    1,DL
         2 001713   200015 756100                    STQ     I,,AUTO

      658     4681    4                  CALL INSERT(F$DCB.NAME.C,I+1,30-I,BINASC(511));

   4681  2 001714   777741 620006                    EAX0    -31,QL
         2 001715   777777 660003                    ERX0    -1,DU
         2 001716   040146 100400                    MLR     fill='040'O
         2 001717   000005 000001 3                  ADSC9   5                        cn=0,n=1
         2 001720   000010 400010                    ADSC9   8,Q,PR0                  cn=2,n=*X0

      659     4682    4                 CALL INSERT(F$DCB.NAME.C,I,1,BINASC(ASCBIN(SUBSTR(F$DCB.NAME.C,I,1))-
              4682                           1));

   4682  2 001721   200004 470500                    LDP0    JDCB$,,AUTO
         2 001722   200015 235100                    LDA     I,,AUTO
         2 001723   000100 101505                    MRL     fill='000'O
         2 001724   000010 200001                    ADSC9   8,A,PR0                  cn=1,n=1
         2 001725   200032 000004                    ADSC9   T$+4,,AUTO               cn=0,n=4
         2 001726   200032 236100                    LDQ     T$+4,,AUTO
         2 001727   000001 136007                    SBLQ    1,DL
         2 001730   000033 736000                    QLS     27
         2 001731   000013 276000 3                  ORQ     11
         2 001732   200033 756100                    STQ     T$+5,,AUTO
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:113  
         2 001733   040105 100500                    MLR     fill='040'O
         2 001734   200033 000004                    ADSC9   T$+5,,AUTO               cn=0,n=4
         2 001735   000010 200001                    ADSC9   8,A,PR0                  cn=1,n=1

      660     4683    4                  END;

      661     4684    3               F$DCB.NAME.L=F$DCB.NAME.L+1;/* DONT STOP HERE AGAIN (THISF)*/

   4684  2 001736   200004 470500                    LDP0    JDCB$,,AUTO
         2 001737   000010 236100                    LDQ     8,,PR0
         2 001740   001000 036003                    ADLQ    512,DU
         2 001741   000010 552140                    STBQ    8,'40'O,PR0

      662     4685    3               GOTO FINDFIL1;

   4685  2 001742   000546 710000 2                  TRA     FINDFIL1

      663     4686    3               END;
      664     4687    2            ELSE GOTO BNEWFILE0;
      665     4688    2            END;
      666     4689    1         ELSE IF B$JIT.ERR.CODE=%E$QSTOW AND FPT$OPEN_V.OVERFDE AND NOT ERRCODE

   4689  2 001743   001630 116007                    CMPQ    920,DL
         2 001744   006276 601000 2                  TNZ     OPER
         2 001745   200003 473500                    LDP3    @PN$,,AUTO
         2 001746   300000 474500                    LDP4    0,,PR3
         2 001747   400014 236100                    LDQ     12,,PR4
         2 001750   100000 316007                    CANQ    32768,DL
         2 001751   006276 600000 2                  TZE     OPER
         2 001752   200020 235100                    LDA     ERRCODE,,AUTO
         2 001753   006276 601000 2                  TNZ     OPER
         2 001754   100013 234100                    SZN     11,,PR1
         2 001755   006276 605000 2                  TPL     OPER
         2 001756   000032 236100                    LDQ     26,,PR0
         2 001757   000777 376003                    ANQ     511,DU
         2 001760   000003 116003                    CMPQ    3,DU
         2 001761   006276 601000 2                  TNZ     OPER
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:114  

      667     4690    2              AND B$JIT.PRIV.ACTIVE.FMEFT AND F$DCB.FUN=%CREATE# THEN DO;

      668     4691    2               F$DCB.FFLG=F$DCB.AUTHFFLG;

   4691  2 001762   000057 721100                    LXL1    47,,PR0
         2 001763   000004 741100                    STX1    4,,PR0

      669     4692    2               B$JIT.ERR='0'B;

   4692  2 001764   100012 450100                    STZ     10,,PR1

      670     4693    2               GOTO BNEWFILE0;

   4693  2 001765   005312 710000 2                  TRA     BNEWFILE0

      671     4694    2               END;
      672     4695    1            ELSE GOTO OPER;
      673     4696    1      IF SUBSTR(F$DCB.NAME.C,0,7)=':SECLOG' AND FM$CFU.ACCTX=FM_SYSACCTX

   4696  2 001766   040000 106500                    CMPC    fill='040'O
         2 001767   000010 200007                    ADSC9   8,,PR0                   cn=1,n=7
         2 001770   000054 000007 0                  ADSC9   TESTOPN+4                cn=0,n=7
         2 001771   002033 601000 2                  TNZ     s:4705
         2 001772   200007 471500                    LDP1    CFU$,,AUTO
         2 001773   100002 236100                    LDQ     2,,PR1
         2 001774   000022 772000                    QRL     18
         2 001775   000000 116000 xsym               CMPQ    FM_SYSACCTX
         2 001776   002033 601000 2                  TNZ     s:4705
         2 001777   000000 235000 xsym               LDA     S_CUN
         2 002000   000007 115007                    CMPA    7,DL
         2 002001   002033 602000 2                  TNC     s:4705

      674     4697    1        AND S_CUN > %JG_ELF#
      675     4698    2      THEN DO;

      676     4699    2         I=4; CALL LOC_CODE;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:115  

   4699  2 002002   000004 235007                    LDA     4,DL
         2 002003   200015 755100                    STA     I,,AUTO

   4699  2 002004   005017 701000 2                  TSX1    LOC_CODE
         2 002005   000000 011000                    NOP     0

      677     4700    2         CALL SSS$SYSTIME(I);

   4700  2 002006   200015 630500                    EPPR0   I,,AUTO
         2 002007   200032 450500                    STP0    T$+4,,AUTO
         2 002010   200032 630500                    EPPR0   T$+4,,AUTO
         2 002011   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002012   000000 701000 xent               TSX1    SSS$SYSTIME
         2 002013   000000 011000                    NOP     0

      678     4701    2         IF IU<CODE04.CREATION.TIME+ES_PROTECTSECLOG OR ES_PROTECTSECLOG<B_TICSDAY

   4701  2 002014   200012 470500                    LDP0    KEY$,,AUTO
         2 002015   000002 236100                    LDQ     2,,PR0
         2 002016   000000 036000 xsym               ADLQ    ES_PROTECTSECLOG
         2 002017   200015 116100                    CMPQ    I,,AUTO
         2 002020   002022 600000 2                  TZE     s:4701+6
         2 002021   002025 603000 2                  TRC     s:4702
         2 002022   000000 236000 xsym               LDQ     ES_PROTECTSECLOG
         2 002023   000000 116000 xsym               CMPQ    B_TICSDAY
         2 002024   002033 603000 2                  TRC     s:4705

      679     4702    2         THEN IF F$DCB.FFLG.READ THEN F$DCB.FFLG=%FFLG_READ#;

   4702  2 002025   200004 471500                    LDP1    JDCB$,,AUTO
         2 002026   100004 234100                    SZN     4,,PR1
         2 002027   006177 605000 2                  TPL     FMNE$NOACCESS

   4702  2 002030   400000 220003                    LDX0    -131072,DU
         2 002031   100004 740100                    STX0    4,,PR1
         2 002032   002033 710000 2                  TRA     s:4705
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:116  

      680     4703    2            ELSE GOTO FMNE$NOACCESS;
      681     4704    2         END;
      682     4705    2      IF ERRCODE THEN DO;

   4705  2 002033   200020 235100                    LDA     ERRCODE,,AUTO
         2 002034   002041 600000 2                  TZE     s:4709

      683     4706    2         B$JIT.ERR=ERRCODE;

   4706  2 002035   200020 236100                    LDQ     ERRCODE,,AUTO
         2 002036   000000 470400 xsym               LDP0    B$JIT$
         2 002037   000012 756100                    STQ     10,,PR0

      684     4707    2         GOTO OPER;

   4707  2 002040   006276 710000 2                  TRA     OPER

      685     4708    2         END;
      686     4709    1      IF F$DCB.GHSTACS~=0 AND

   4709  2 002041   200004 470500                    LDP0    JDCB$,,AUTO
         2 002042   000052 236100                    LDQ     42,,PR0
         2 002043   000017 316003                    CANQ    15,DU
         2 002044   002060 600000 2                  TZE     s:4712
         2 002045   200003 471500                    LDP1    @PN$,,AUTO
         2 002046   100000 473500                    LDP3    0,,PR1
         2 002047   300000 236100                    LDQ     0,,PR3
         2 002050   020000 316007                    CANQ    8192,DL
         2 002051   002056 600000 2                  TZE     s:4711
         2 002052   000052 236100                    LDQ     42,,PR0
         2 002053   000017 376003                    ANQ     15,DU
         2 002054   000002 116003                    CMPQ    2,DU
         2 002055   002060 600000 2                  TZE     s:4712

      687     4710    1        NOT(FPT$OPEN_V.OPER.TEST AND F$DCB.GHSTACS=%JRNLOPN#) THEN
      688     4711    1         CALL GHSTACS ALTRET(OPER);
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:117  

   4711  2 002056   005042 701000 2                  TSX1    GHSTACS
         2 002057   006276 702000 2                  TSX2    OPER

      689     4712    1      IF PN$.FPARAM_~=ADDR(NIL)

   4712  2 002060   200003 470500                    LDP0    @PN$,,AUTO
         2 002061   000014 236100                    LDQ     12,,PR0
         2 002062   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 002063   002075 600000 2                  TZE     s:4733

      690     4713    1      THEN CALL FMO$TRNINFO(PN$.FPARAM_,FIT$)  ALTRET(OPER);

   4713  2 002064   200017 631500                    EPPR1   FIT$,,AUTO
         2 002065   200033 451500                    STP1    T$+5,,AUTO
         2 002066   200003 236100                    LDQ     @PN$,,AUTO
         2 002067   000014 036003                    ADLQ    12,DU
         2 002070   200032 756100                    STQ     T$+4,,AUTO
         2 002071   200032 630500                    EPPR0   T$+4,,AUTO
         2 002072   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 002073   000000 701000 xent               TSX1    FMO$TRNINFO
         2 002074   006276 702000 2                  TSX2    OPER

      691     4714                    /*D*
      692     4715                     If this is a CREATE open and the file already exists, open
      693     4716                     processes the EXIST options at this point.  The EXIST options are
      694     4717                     handled in the following manner.
      695     4718                     EXIST=ERROR              Return an error to the user.
      696     4719                    *
      697     4720                     EXIST=NEWFILE            If this is a system 'OPLABEL' DCB
      698     4721                     or user defined equivalent, and the
      699     4722                     FEXT bit is set in the JIT, treat the
      700     4723                     option as if it were OLDFILE. Other-
      701     4724                     wise go to create a new file (BNEWFILE).
      702     4725                    *
      703     4726                     EXIST=OLDFILE            The open is handled as an update
      704     4727                     open rather than a create open.  The
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:118  
      705     4728                     DCB is opened to the existing file
      706     4729                     in an update manner, and the file is
      707     4730                     positioned to the end (EOF) before
      708     4731                     returning to the user.
      709     4732                    */
      710     4733    2      IF F$DCB.FUN=%CREATE# THEN DO;

   4733  2 002075   200004 470500                    LDP0    JDCB$,,AUTO
         2 002076   000032 236100                    LDQ     26,,PR0
         2 002077   000777 376003                    ANQ     511,DU
         2 002100   000003 116003                    CMPQ    3,DU
         2 002101   002147 601000 2                  TNZ     s:4761

      711     4734    2         IF F$DCB.EXIST=%NEWFILE#

   4734  2 002102   000031 236100                    LDQ     25,,PR0
         2 002103   003000 376007                    ANQ     1536,DL
         2 002104   003000 116007                    CMPQ    1536,DL
         2 002105   002144 601000 2                  TNZ     s:4747
         2 002106   000064 234100                    SZN     52,,PR0
         2 002107   002144 604000 2                  TMI     s:4747

      712     4735    3           AND NOT F$DCB.FEXT THEN DO;

      713     4736    3            IF F$DCB.ASN=%TAPE# THEN GOTO FMNE$JRNLERR;

   4736  2 002110   000032 236100                    LDQ     26,,PR0
         2 002111   777000 376007                    ANQ     -512,DL
         2 002112   002000 116007                    CMPQ    1024,DL
         2 002113   006215 600000 2                  TZE     FMNE$JRNLERR

      714     4737    3            I=3; CALL LOC_CODE;

   4737  2 002114   000003 235007                    LDA     3,DL
         2 002115   200015 755100                    STA     I,,AUTO

   4737  2 002116   005017 701000 2                  TSX1    LOC_CODE
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:119  
         2 002117   000000 011000                    NOP     0

      715     4738    3            JDCB$->F$DCB.BORROW=CODE03.UGRANS+CODE03.NGAVAL;

   4738  2 002120   200012 470500                    LDP0    KEY$,,AUTO
         2 002121   000003 236100                    LDQ     3,,PR0
         2 002122   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 002123   200032 756100                    STQ     T$+4,,AUTO
         2 002124   000000 236100                    LDQ     0,,PR0
         2 002125   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 002126   200032 036100                    ADLQ    T$+4,,AUTO
         2 002127   200004 471500                    LDP1    JDCB$,,AUTO
         2 002130   100065 756100                    STQ     53,,PR1

      716     4739    3            IF FM$CFU.FUN<7 AND S_CUN~=JG_JAYS# THEN EXIT;

   4739  2 002131   200007 473500                    LDP3    CFU$,,AUTO
         2 002132   300000 236100                    LDQ     0,,PR3
         2 002133   700000 376003                    ANQ     -32768,DU
         2 002134   700000 116003                    CMPQ    -32768,DU
         2 002135   002141 603000 2                  TRC     s:4740
         2 002136   000000 235000 xsym               LDA     S_CUN
         2 002137   000015 115007                    CMPA    13,DL
         2 002140   002144 601000 2                  TNZ     s:4747

      717     4740    3            FM$CFU.FUN=7; /* JAYS MAY BE CREATING OVER AHALF-OPEN CFU */

   4740  2 002141   700000 236003                    LDQ     -32768,DU
         2 002142   300000 256100                    ORSQ    0,,PR3

      718     4741    3            GOTO BNEWFILE;

   4741  2 002143   005325 710000 2                  TRA     BNEWFILE

      719     4742    3            END;
      720     4743                    /*
      721     4744                    *  IF OLDFILE IS SPECIFIED THEN OPEN FUNCTION IS SWITCHED TO
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:120  
      722     4745                    *  UPDATE AND THIS FILE IS OPENED.
      723     4746                    */
      724     4747    2         JDCB$->F$DCB.FEXT='1'B;

   4747  2 002144   200004 470500                    LDP0    JDCB$,,AUTO
         2 002145   400000 236003                    LDQ     -131072,DU
         2 002146   000064 256100                    ORSQ    52,,PR0

      725     4748    2         END;

      726     4749                    /*D*
      727     4750                     Now open has the file it is going to open and the mode of the
      728     4751                     open.  All that remains to do is to move the FIT information to
      729     4752                     the DCB and (if necessary) to the CFU.  First open moves the FIT
      730     4753                     information to the DCB.  If this was a TEST open, then the process
      731     4754                     is complete and open returns to the user without opening the DCB.
      732     4755                     If the CFU has already been filled in, (i. e. this user is
      733     4756                     not the first opener of the file), the open process is complete.
      734     4757                     If this user is the first opener of the file, the CFU is filled in,
      735     4758                     the extent list is moved to the CFU area, and the open process is
      736     4759                     completed.
      737     4760                    */
      738     4761    1      JDCB$->F$DCB.HASH=FM$GRAN.STAMP.HASH;

   4761  2 002147   200014 471500                    LDP1    BUF$,,AUTO
         2 002150   100000 236100                    LDQ     0,,PR1
         2 002151   000073 552170                    STBQ    59,'70'O,PR0

      739     4762                    /*
      740     4763                    *  NOW MOVE KEYED FILE INFORMATION IF IT EXISTS IN THE FIT
      741     4764                    */
      742     4765    1      I=2; CALL LOC_CODE ALTRET(NXTCODE);

   4765  2 002152   000002 235007                    LDA     2,DL
         2 002153   200015 755100                    STA     I,,AUTO

   4765  2 002154   005017 701000 2                  TSX1    LOC_CODE
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:121  
         2 002155   002204 702000 2                  TSX2    NXTCODE

      743     4766                    /**/
      744     4767    1      JDCB$->F$DCB.LSLIDE=CODE02.LSLIDE;

   4767  2 002156   200012 470500                    LDP0    KEY$,,AUTO
         2 002157   200004 471500                    LDP1    JDCB$,,AUTO
         2 002160   000000 236100                    LDQ     0,,PR0
         2 002161   000022 772000                    QRL     18
         2 002162   100037 552110                    STBQ    31,'10'O,PR1

      745     4768    1      JDCB$->F$DCB.LRDL0=CODE02.LRDL0;

   4768  2 002163   000000 236100                    LDQ     0,,PR0
         2 002164   000022 772000                    QRL     18
         2 002165   100037 552104                    STBQ    31,'04'O,PR1

      746     4769    1      JDCB$->F$DCB.SPARE=CODE02.SPARE;

   4769  2 002166   000000 236100                    LDQ     0,,PR0
         2 002167   000022 736000                    QLS     18
         2 002170   100040 552140                    STBQ    32,'40'O,PR1

      747     4770    1      F$DCB.TDALVL=CODE02.TDALVL;

   4770  2 002171   000001 236100                    LDQ     1,,PR0
         2 002172   000006 736000                    QLS     6
         2 002173   100067 676100                    ERQ     55,,PR1
         2 002174   700000 376003                    ANQ     -32768,DU
         2 002175   100067 656100                    ERSQ    55,,PR1

      748     4771    1      JDCB$->F$DCB.TDA=CODE02.TDA;

   4771  2 002176   000001 236100                    LDQ     1,,PR0
         2 002177   100070 552134                    STBQ    56,'34'O,PR1

      749     4772    1      JDCB$->F$DCB.KEYX=CODE02.KEYX;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:122  

   4772  2 002200   000003 220100                    LDX0    3,,PR0
         2 002201   100036 740100                    STX0    30,,PR1

      750     4773    1      JDCB$->F$DCB.KEYL=CODE02.KEYL;

   4773  2 002202   000003 236100                    LDQ     3,,PR0
         2 002203   100036 552110                    STBQ    30,'10'O,PR1

      751     4774                    /**/
      752     4775                    /*
      753     4776                    *  MOVE FORM AND DDEV TO DCB IF IT EXISTS IN THE FIT.
      754     4777                    */
      755     4778    1   NXTCODE:
      756     4779    2      IF F$DCB.ALTKEYX~=0 THEN DO;

   4779  2 002204   200004 470500       NXTCODE      LDP0    JDCB$,,AUTO
         2 002205   000052 720100                    LXL0    42,,PR0
         2 002206   002231 600000 2                  TZE     s:4785

      757     4780    2         SEG$=PINCRW(B$ROSEG$,F$DCB.ALTKEYX);

   4780  2 002207   000000 636010                    EAQ     0,X0
         2 002210   000000 036000 xsym               ADLQ    B$ROSEG$
         2 002211   200013 756100                    STQ     SEG$,,AUTO

      758     4781    2         J=SEG$->FITALTKEYS.NUMWRDS;

   4781  2 002212   200013 471500                    LDP1    SEG$,,AUTO
         2 002213   100000 236100                    LDQ     0,,PR1
         2 002214   000033 772000                    QRL     27
         2 002215   200016 756100                    STQ     J,,AUTO

      759     4782    2         CALL FSA$FSP(J,SEG$);

   4782  2 002216   200013 633500                    EPPR3   SEG$,,AUTO
         2 002217   200033 453500                    STP3    T$+5,,AUTO
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:123  
         2 002220   200016 634500                    EPPR4   J,,AUTO
         2 002221   200032 454500                    STP4    T$+4,,AUTO
         2 002222   200032 630500                    EPPR0   T$+4,,AUTO
         2 002223   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 002224   000000 701000 xent               TSX1    FSA$FSP
         2 002225   000000 011000                    NOP     0

      760     4783    2         F$DCB.ALTKEYX=0;

   4783  2 002226   000000 220003                    LDX0    0,DU
         2 002227   200004 470500                    LDP0    JDCB$,,AUTO
         2 002230   000052 440100                    SXL0    42,,PR0

      761     4784    2         END;

      762     4785    1      I=8; CALL LOC_CODE ALTRET(NXTCODE16);

   4785  2 002231   000010 235007                    LDA     8,DL
         2 002232   200015 755100                    STA     I,,AUTO

   4785  2 002233   005017 701000 2                  TSX1    LOC_CODE
         2 002234   002321 702000 2                  TSX2    NXTCODE16

      763     4786    1      J=FM$FIT.CODES.NDW(I);

   4786  2 002235   200017 470500                    LDP0    FIT$,,AUTO
         2 002236   200015 720100                    LXL0    I,,AUTO
         2 002237   000000 236110                    LDQ     0,X0,PR0
         2 002240   000012 772000                    QRL     10
         2 002241   001777 376007                    ANQ     1023,DL
         2 002242   200016 756100                    STQ     J,,AUTO

      764     4787    1      IF J < 7 THEN GOTO NXTCODE16; /* Min word size for FITALTKEYS */

   4787  2 002243   000007 116007                    CMPQ    7,DL
         2 002244   002321 604000 2                  TMI     NXTCODE16

PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:124  
      765     4788    1      CALL FSA$GSP(J,SEG$) ALTRET(OPER);

   4788  2 002245   200013 631500                    EPPR1   SEG$,,AUTO
         2 002246   200033 451500                    STP1    T$+5,,AUTO
         2 002247   200016 633500                    EPPR3   J,,AUTO
         2 002250   200032 453500                    STP3    T$+4,,AUTO
         2 002251   200032 630500                    EPPR0   T$+4,,AUTO
         2 002252   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 002253   000000 701000 xent               TSX1    FSA$GSP
         2 002254   006276 702000 2                  TSX2    OPER

      766     4789    1      J=J*4;

   4789  2 002255   200016 235100                    LDA     J,,AUTO
         2 002256   000002 735000                    ALS     2
         2 002257   200016 755100                    STA     J,,AUTO

      767     4790    1      SEG$->MOVEJ=KEY$->MOVEJ;

   4790  2 002260   200012 470500                    LDP0    KEY$,,AUTO
         2 002261   000000 620005                    EAX0    0,AL
         2 002262   200013 471500                    LDP1    SEG$,,AUTO
         2 002263   200016 721100                    LXL1    J,,AUTO
         2 002264   040140 100540                    MLR     fill='040'O
         2 002265   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0
         2 002266   100000 000011                    ADSC9   0,,PR1                   cn=0,n=*X1

      768     4791    2      IF FM$CFU.USECNT = 1 THEN DO;

   4791  2 002267   200007 470500                    LDP0    CFU$,,AUTO
         2 002270   000003 720100                    LXL0    3,,PR0
         2 002271   000001 100003                    CMPX0   1,DU
         2 002272   002310 601000 2                  TNZ     s:4795

      769     4792    2         FM$CFU.ALTBLD=SEG$->FITALTKEYS.ALTBLD;

   4792  2 002273   200013 471500                    LDP1    SEG$,,AUTO
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:125  
         2 002274   100000 236100                    LDQ     0,,PR1
         2 002275   000006 772000                    QRL     6
         2 002276   000006 676100                    ERQ     6,,PR0
         2 002277   000004 376003                    ANQ     4,DU
         2 002300   000006 656100                    ERSQ    6,,PR0

      770     4793    2         F$DCB.UNIQUEBLD=SEG$->FITALTKEYS.UNIQUEBLD;

   4793  2 002301   200004 470500                    LDP0    JDCB$,,AUTO
         2 002302   200013 471500                    LDP1    SEG$,,AUTO
         2 002303   100000 236100                    LDQ     0,,PR1
         2 002304   000007 772000                    QRL     7
         2 002305   000103 676100                    ERQ     67,,PR0
         2 002306   002000 376007                    ANQ     1024,DL
         2 002307   000103 656100                    ERSQ    67,,PR0

      771     4794    2         END;

      772     4795    1      F$DCB.ALTKEYX=POFFW(SEG$,B$ROSEG$);

   4795  2 002310   000000 235000 xsym               LDA     B$ROSEG$
         2 002311   000022 771000                    ARL     18
         2 002312   200032 755100                    STA     T$+4,,AUTO
         2 002313   200013 236100                    LDQ     SEG$,,AUTO
         2 002314   000022 772000                    QRL     18
         2 002315   200032 136100                    SBLQ    T$+4,,AUTO
         2 002316   000000 620006                    EAX0    0,QL
         2 002317   200004 470500                    LDP0    JDCB$,,AUTO
         2 002320   000052 440100                    SXL0    42,,PR0

   4795  2 002321                       NXTCODE16    null
      773     4796                    /**/
      774     4797    1   NXTCODE16: ;
      775     4798    1      I=16; CALL LOC_CODE ALTRET(NXTCODE17);

   4798  2 002321   000020 235007                    LDA     16,DL
         2 002322   200015 755100                    STA     I,,AUTO
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:126  

   4798  2 002323   005017 701000 2                  TSX1    LOC_CODE
         2 002324   002370 702000 2                  TSX2    NXTCODE17

      776     4799    1      IF F$DCB.FORM$=ADDR(NIL) THEN CALL FSA$GSP(SIZEW(CODE16),F$DCB.FORM$)

   4799  2 002325   200004 470500                    LDP0    JDCB$,,AUTO
         2 002326   000050 236100                    LDQ     40,,PR0
         2 002327   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 002330   002341 601000 2                  TNZ     s:4801

   4799  2 002331   200004 236100                    LDQ     JDCB$,,AUTO
         2 002332   000050 036003                    ADLQ    40,DU
         2 002333   000015 235000 3                  LDA     13
         2 002334   200032 757100                    STAQ    T$+4,,AUTO
         2 002335   200032 630500                    EPPR0   T$+4,,AUTO
         2 002336   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 002337   000000 701000 xent               TSX1    FSA$GSP
         2 002340   006276 702000 2                  TSX2    OPER

      777     4800    1           ALTRET(OPER);
      778     4801    1      F$DCB.FORM$->CODE16=CODE16;

   4801  2 002341   200004 470500                    LDP0    JDCB$,,AUTO
         2 002342   000050 471500                    LDP1    40,,PR0
         2 002343   200012 473500                    LDP3    KEY$,,AUTO
         2 002344   000100 100500                    MLR     fill='000'O
         2 002345   300000 000234                    ADSC9   0,,PR3                   cn=0,n=156
         2 002346   100000 000234                    ADSC9   0,,PR1                   cn=0,n=156

      779     4802    2      IF F$DCB.FUN~=%IN# THEN DO;

   4802  2 002347   200004 470500                    LDP0    JDCB$,,AUTO
         2 002350   000032 236100                    LDQ     26,,PR0
         2 002351   000777 376003                    ANQ     511,DU
         2 002352   000002 116003                    CMPQ    2,DU
         2 002353   002370 600000 2                  TZE     NXTCODE17
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:127  

      780     4803    2         F$DCB.FEXT=%YES#;

   4803  2 002354   400000 236003                    LDQ     -131072,DU
         2 002355   000064 256100                    ORSQ    52,,PR0

      781     4804    2         I=11; CALL LOC_CODE ALTRET(NXTCODE17);

   4804  2 002356   000013 235007                    LDA     11,DL
         2 002357   200015 755100                    STA     I,,AUTO

   4804  2 002360   005017 701000 2                  TSX1    LOC_CODE
         2 002361   002370 702000 2                  TSX2    NXTCODE17

      782     4805    2         CALL FSB$GETDDF(KEY$)ALTRET(OPER);

   4805  2 002362   200012 630500                    EPPR0   KEY$,,AUTO
         2 002363   200032 450500                    STP0    T$+4,,AUTO
         2 002364   200032 630500                    EPPR0   T$+4,,AUTO
         2 002365   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002366   000000 701000 xent               TSX1    FSB$GETDDF
         2 002367   006276 702000 2                  TSX2    OPER

      783     4806    2         END;

   4802  2 002370                       NXTCODE17    null
      784     4807    1   NXTCODE17: ;
      785     4808    2      IF F$DCB.FPRGX~=0 THEN DO;

   4808  2 002370   200004 470500                    LDP0    JDCB$,,AUTO
         2 002371   000054 220100                    LDX0    44,,PR0
         2 002372   002411 600000 2                  TZE     s:4812

      786     4809    2         CALL FSA$FSP (SIZEW(VLP$FPRG), PINCRW(B$ROSEG$,F$DCB.FPRGX));

   4809  2 002373   000000 636010                    EAQ     0,X0
         2 002374   000000 036000 xsym               ADLQ    B$ROSEG$
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:128  
         2 002375   200032 756100                    STQ     T$+4,,AUTO
         2 002376   200032 631500                    EPPR1   T$+4,,AUTO
         2 002377   200035 451500                    STP1    T$+7,,AUTO
         2 002400   000017 236000 3                  LDQ     15
         2 002401   200034 756100                    STQ     T$+6,,AUTO
         2 002402   200034 630500                    EPPR0   T$+6,,AUTO
         2 002403   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 002404   000000 701000 xent               TSX1    FSA$FSP
         2 002405   000000 011000                    NOP     0

      787     4810    2         F$DCB.FPRGX=0;

   4810  2 002406   000000 220003                    LDX0    0,DU
         2 002407   200004 470500                    LDP0    JDCB$,,AUTO
         2 002410   000054 740100                    STX0    44,,PR0

      788     4811    2         END;

      789     4812    1      I=17; CALL LOC_CODE ALTRET(NXTCODE18);

   4812  2 002411   000021 235007                    LDA     17,DL
         2 002412   200015 755100                    STA     I,,AUTO

   4812  2 002413   005017 701000 2                  TSX1    LOC_CODE
         2 002414   002443 702000 2                  TSX2    NXTCODE18

      790     4813    1      CALL FSA$GSP (SIZEW(VLP$FPRG), SEG$) ALTRET(OPER);

   4813  2 002415   200013 630500                    EPPR0   SEG$,,AUTO
         2 002416   200033 450500                    STP0    T$+5,,AUTO
         2 002417   000017 236000 3                  LDQ     15
         2 002420   200032 756100                    STQ     T$+4,,AUTO
         2 002421   200032 630500                    EPPR0   T$+4,,AUTO
         2 002422   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 002423   000000 701000 xent               TSX1    FSA$GSP
         2 002424   006276 702000 2                  TSX2    OPER

PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:129  
      791     4814    1      F$DCB.FPRGX=POFFW(SEG$, B$ROSEG$);

   4814  2 002425   000000 235000 xsym               LDA     B$ROSEG$
         2 002426   000022 771000                    ARL     18
         2 002427   200032 755100                    STA     T$+4,,AUTO
         2 002430   200013 236100                    LDQ     SEG$,,AUTO
         2 002431   000022 772000                    QRL     18
         2 002432   200032 136100                    SBLQ    T$+4,,AUTO
         2 002433   000000 620006                    EAX0    0,QL
         2 002434   200004 470500                    LDP0    JDCB$,,AUTO
         2 002435   000054 740100                    STX0    44,,PR0

      792     4815    1      SEG$->VLP$FPRG=KEY$->VLP$FPRG;

   4815  2 002436   200012 471500                    LDP1    KEY$,,AUTO
         2 002437   200013 473500                    LDP3    SEG$,,AUTO
         2 002440   000100 100500                    MLR     fill='000'O
         2 002441   100000 000104                    ADSC9   0,,PR1                   cn=0,n=68
         2 002442   300000 000104                    ADSC9   0,,PR3                   cn=0,n=68

   4815  2 002443                       NXTCODE18    null
      793     4816                    /* */
      794     4817                    /*     MOVE FIELD AND INDEXED RELATION DATA FROM FIT */
      795     4818                    /* */
      796     4819    1   NXTCODE18: ;
      797     4820    2      IF F$DCB.FIELDX~=0 THEN DO;

   4820  2 002443   200004 470500                    LDP0    JDCB$,,AUTO
         2 002444   000054 720100                    LXL0    44,,PR0
         2 002445   002473 600000 2                  TZE     s:4826

      798     4821    2         FIELD$=PINCRW(B$ROSEG$, F$DCB.FIELDX);

   4821  2 002446   000000 636010                    EAQ     0,X0
         2 002447   000000 036000 xsym               ADLQ    B$ROSEG$
         2 002450   200022 756100                    STQ     FIELD$,,AUTO

PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:130  
      799     4822    2         J=(RECFIELD.NFIELDS+1)/2 + 1;

   4822  2 002451   200022 471500                    LDP1    FIELD$,,AUTO
         2 002452   100000 236100                    LDQ     0,,PR1
         2 002453   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 002454   000001 036007                    ADLQ    1,DL
         2 002455   000001 772000                    QRL     1
         2 002456   000001 036007                    ADLQ    1,DL
         2 002457   200016 756100                    STQ     J,,AUTO

      800     4823    2         CALL FSA$FSP(J, FIELD$);

   4823  2 002460   200022 633500                    EPPR3   FIELD$,,AUTO
         2 002461   200033 453500                    STP3    T$+5,,AUTO
         2 002462   200016 634500                    EPPR4   J,,AUTO
         2 002463   200032 454500                    STP4    T$+4,,AUTO
         2 002464   200032 630500                    EPPR0   T$+4,,AUTO
         2 002465   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 002466   000000 701000 xent               TSX1    FSA$FSP
         2 002467   000000 011000                    NOP     0

      801     4824    2         F$DCB.FIELDX=0;

   4824  2 002470   000000 220003                    LDX0    0,DU
         2 002471   200004 470500                    LDP0    JDCB$,,AUTO
         2 002472   000054 440100                    SXL0    44,,PR0

      802     4825    2         END;

      803     4826    2      IF F$DCB.STARTX~=0 THEN DO;

   4826  2 002473   000057 221100                    LDX1    47,,PR0
         2 002474   002516 600000 2                  TZE     s:4832

      804     4827    2         START$=PINCRW(B$ROSEG$,F$DCB.STARTX);

   4827  2 002475   000000 636011                    EAQ     0,X1
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:131  
         2 002476   000000 036000 xsym               ADLQ    B$ROSEG$
         2 002477   200024 756100                    STQ     START$,,AUTO

      805     4828    2         J=FM$FIELD_START.NWORDS;

   4828  2 002500   200024 471500                    LDP1    START$,,AUTO
         2 002501   100000 235100                    LDA     0,,PR1
         2 002502   200016 755100                    STA     J,,AUTO

      806     4829    2         CALL FSA$FSP(J, START$);

   4829  2 002503   200024 633500                    EPPR3   START$,,AUTO
         2 002504   200033 453500                    STP3    T$+5,,AUTO
         2 002505   200016 634500                    EPPR4   J,,AUTO
         2 002506   200032 454500                    STP4    T$+4,,AUTO
         2 002507   200032 630500                    EPPR0   T$+4,,AUTO
         2 002510   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 002511   000000 701000 xent               TSX1    FSA$FSP
         2 002512   000000 011000                    NOP     0

      807     4830    2         F$DCB.STARTX=0;

   4830  2 002513   000000 220003                    LDX0    0,DU
         2 002514   200004 470500                    LDP0    JDCB$,,AUTO
         2 002515   000057 740100                    STX0    47,,PR0

      808     4831    2         END;

      809     4832    1      I=18; CALL LOC_CODE ALTRET(NXTCODE19);

   4832  2 002516   000022 235007                    LDA     18,DL
         2 002517   200015 755100                    STA     I,,AUTO

   4832  2 002520   005017 701000 2                  TSX1    LOC_CODE
         2 002521   002567 702000 2                  TSX2    NXTCODE19

      810     4833    1      J=(CODE18.NFIELDS+1)/2 + 1;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:132  

   4833  2 002522   200012 470500                    LDP0    KEY$,,AUTO
         2 002523   000000 236100                    LDQ     0,,PR0
         2 002524   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 002525   000001 036007                    ADLQ    1,DL
         2 002526   000001 772000                    QRL     1
         2 002527   000001 036007                    ADLQ    1,DL
         2 002530   200016 756100                    STQ     J,,AUTO

      811     4834    1      CALL FSA$GSP(J, FIELD$) ALTRET(OPER);

   4834  2 002531   200022 631500                    EPPR1   FIELD$,,AUTO
         2 002532   200033 451500                    STP1    T$+5,,AUTO
         2 002533   200016 633500                    EPPR3   J,,AUTO
         2 002534   200032 453500                    STP3    T$+4,,AUTO
         2 002535   200032 630500                    EPPR0   T$+4,,AUTO
         2 002536   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 002537   000000 701000 xent               TSX1    FSA$GSP
         2 002540   006276 702000 2                  TSX2    OPER

      812     4835    1      J=J*4;

   4835  2 002541   200016 235100                    LDA     J,,AUTO
         2 002542   000002 735000                    ALS     2
         2 002543   200016 755100                    STA     J,,AUTO

      813     4836    1      FIELD$->MOVEJ=KEY$->MOVEJ;

   4836  2 002544   200012 470500                    LDP0    KEY$,,AUTO
         2 002545   000000 620005                    EAX0    0,AL
         2 002546   200022 471500                    LDP1    FIELD$,,AUTO
         2 002547   200016 721100                    LXL1    J,,AUTO
         2 002550   040140 100540                    MLR     fill='040'O
         2 002551   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0
         2 002552   100000 000011                    ADSC9   0,,PR1                   cn=0,n=*X1

      814     4837    1      F$DCB.FIELDX=POFFW(FIELD$, B$ROSEG$);
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:133  

   4837  2 002553   000000 235000 xsym               LDA     B$ROSEG$
         2 002554   000022 771000                    ARL     18
         2 002555   200032 755100                    STA     T$+4,,AUTO
         2 002556   200022 236100                    LDQ     FIELD$,,AUTO
         2 002557   000022 772000                    QRL     18
         2 002560   200032 136100                    SBLQ    T$+4,,AUTO
         2 002561   000000 620006                    EAX0    0,QL
         2 002562   200004 470500                    LDP0    JDCB$,,AUTO
         2 002563   000054 440100                    SXL0    44,,PR0

      815     4838
      816     4839    1      CALL FMO$FIELD_START_SETUP ALTRET(OPER);

   4839  2 002564   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 002565   000000 701000 xent               TSX1    FMO$FIELD_START_SETUP
         2 002566   006276 702000 2                  TSX2    OPER

   4837  2 002567                       NXTCODE19    null
      817     4840                    /* */
      818     4841    1   NXTCODE19: ;
      819     4842    2      IF F$DCB.KFIELDX~=0 THEN DO;

   4842  2 002567   200004 470500                    LDP0    JDCB$,,AUTO
         2 002570   000056 720100                    LXL0    46,,PR0
         2 002571   002613 600000 2                  TZE     s:4849

      820     4843    2         KFIELD$=PINCRW(B$ROSEG$, F$DCB.KFIELDX);

   4843  2 002572   000000 636010                    EAQ     0,X0
         2 002573   000000 036000 xsym               ADLQ    B$ROSEG$
         2 002574   200021 756100                    STQ     KFIELD$,,AUTO

      821     4844    2         J=KFIELD.NWORDS;

   4844  2 002575   200021 471500                    LDP1    KFIELD$,,AUTO
         2 002576   100000 235100                    LDA     0,,PR1
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:134  
         2 002577   200016 755100                    STA     J,,AUTO

      822     4845    2         CALL FSA$FSP(J, KFIELD$);

   4845  2 002600   200021 633500                    EPPR3   KFIELD$,,AUTO
         2 002601   200033 453500                    STP3    T$+5,,AUTO
         2 002602   200016 634500                    EPPR4   J,,AUTO
         2 002603   200032 454500                    STP4    T$+4,,AUTO
         2 002604   200032 630500                    EPPR0   T$+4,,AUTO
         2 002605   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 002606   000000 701000 xent               TSX1    FSA$FSP
         2 002607   000000 011000                    NOP     0

      823     4846    2         F$DCB.KFIELDX=0;

   4846  2 002610   000000 220003                    LDX0    0,DU
         2 002611   200004 470500                    LDP0    JDCB$,,AUTO
         2 002612   000056 440100                    SXL0    46,,PR0

      824     4847    2         END;

      825     4848
      826     4849    1      I=19; CALL LOC_CODE ALTRET(NXTCODE21);

   4849  2 002613   000023 235007                    LDA     19,DL
         2 002614   200015 755100                    STA     I,,AUTO

   4849  2 002615   005017 701000 2                  TSX1    LOC_CODE
         2 002616   002754 702000 2                  TSX2    NXTCODE21

      827     4850    1      CALL FMG$IRSETUP(CODE19) ALTRET(OPER);

   4850  2 002617   200012 630500                    EPPR0   KEY$,,AUTO
         2 002620   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002621   000000 701000 xent               TSX1    FMG$IRSETUP
         2 002622   006276 702000 2                  TSX2    OPER

PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:135  
      828     4851                    /* */
      829     4852    1      I=20; CALL LOC_CODE ALTRET(NXTCODE21);

   4852  2 002623   000024 235007                    LDA     20,DL
         2 002624   200015 755100                    STA     I,,AUTO

   4852  2 002625   005017 701000 2                  TSX1    LOC_CODE
         2 002626   002754 702000 2                  TSX2    NXTCODE21

      830     4853    1      ALTKEY$=PINCRW(B$ROSEG$, F$DCB.ALTKEYX);

   4853  2 002627   200004 470500                    LDP0    JDCB$,,AUTO
         2 002630   000052 720100                    LXL0    42,,PR0
         2 002631   000000 636010                    EAQ     0,X0
         2 002632   000000 036000 xsym               ADLQ    B$ROSEG$
         2 002633   200023 756100                    STQ     ALTKEY$,,AUTO

      831     4854
      832     4855    1      IRKEYS.ALTBLD=CODE20.ALTBLD;

   4855  2 002634   200023 471500                    LDP1    ALTKEY$,,AUTO
         2 002635   200012 473500                    LDP3    KEY$,,AUTO
         2 002636   300001 236100                    LDQ     1,,PR3
         2 002637   100002 676100                    ERQ     2,,PR1
         2 002640   400000 376003                    ANQ     -131072,DU
         2 002641   100002 656100                    ERSQ    2,,PR1

      833     4856    1      IRKEYS.UNIQUEBLD=CODE20.UNIQUEBLD;

   4856  2 002642   200012 470500                    LDP0    KEY$,,AUTO
         2 002643   000001 236100                    LDQ     1,,PR0
         2 002644   100002 676100                    ERQ     2,,PR1
         2 002645   200000 376003                    ANQ     65536,DU
         2 002646   100002 656100                    ERSQ    2,,PR1

      834     4857
      835     4858    2      DO J=0 TO CODE20.NKEYS-1;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:136  

   4858  2 002647   200016 450100                    STZ     J,,AUTO
         2 002650   002727 710000 2                  TRA     s:4863+1

      836     4859    2         IRKEYS.K.TDALVL(J)=CODE20.K.TDALVL(J);

   4859  2 002651   200016 236100                    LDQ     J,,AUTO
         2 002652   000007 402007                    MPY     7,DL
         2 002653   000000 620006                    EAX0    0,QL
         2 002654   200016 236100                    LDQ     J,,AUTO
         2 002655   000003 402007                    MPY     3,DL
         2 002656   200012 470500                    LDP0    KEY$,,AUTO
         2 002657   200023 471500                    LDP1    ALTKEY$,,AUTO
         2 002660   000002 236106                    LDQ     2,QL,PR0
         2 002661   100003 676110                    ERQ     3,X0,PR1
         2 002662   777000 376003                    ANQ     -512,DU
         2 002663   100003 656110                    ERSQ    3,X0,PR1

      837     4860    2         IRKEYS.K.TDA(J)=CODE20.K.TDA(J);

   4860  2 002664   200016 236100                    LDQ     J,,AUTO
         2 002665   000007 402007                    MPY     7,DL
         2 002666   000000 620006                    EAX0    0,QL
         2 002667   200016 236100                    LDQ     J,,AUTO
         2 002670   000003 402007                    MPY     3,DL
         2 002671   200012 470500                    LDP0    KEY$,,AUTO
         2 002672   000002 236106                    LDQ     2,QL,PR0
         2 002673   100003 676110                    ERQ     3,X0,PR1
         2 002674   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 002675   100003 656110                    ERSQ    3,X0,PR1

      838     4861    2         IRKEYS.K.FDA(J)=CODE20.K.FDA(J);

   4861  2 002676   200016 236100                    LDQ     J,,AUTO
         2 002677   000007 402007                    MPY     7,DL
         2 002700   000000 620006                    EAX0    0,QL
         2 002701   200016 236100                    LDQ     J,,AUTO
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:137  
         2 002702   000003 402007                    MPY     3,DL
         2 002703   200012 470500                    LDP0    KEY$,,AUTO
         2 002704   000003 236106                    LDQ     3,QL,PR0
         2 002705   000011 772000                    QRL     9
         2 002706   100007 676110                    ERQ     7,X0,PR1
         2 002707   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 002710   100007 656110                    ERSQ    7,X0,PR1

      839     4862    2         IRKEYS.K.LDA(J)=CODE20.K.LDA(J);

   4862  2 002711   200016 236100                    LDQ     J,,AUTO
         2 002712   000007 402007                    MPY     7,DL
         2 002713   000000 620006                    EAX0    0,QL
         2 002714   200016 236100                    LDQ     J,,AUTO
         2 002715   000003 402007                    MPY     3,DL
         2 002716   200012 470500                    LDP0    KEY$,,AUTO
         2 002717   000003 235106                    LDA     3,QL,PR0
         2 002720   000004 236106                    LDQ     4,QL,PR0
         2 002721   000022 773000                    LRL     18
         2 002722   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 002723   100011 676110                    ERQ     9,X0,PR1
         2 002724   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 002725   100011 656110                    ERSQ    9,X0,PR1

      840     4863    2         END;

   4863  2 002726   200016 054100                    AOS     J,,AUTO
         2 002727   200012 470500                    LDP0    KEY$,,AUTO
         2 002730   200016 236100                    LDQ     J,,AUTO
         2 002731   002651 604000 2                  TMI     s:4859
         2 002732   000000 116100                    CMPQ    0,,PR0
         2 002733   002651 602000 2                  TNC     s:4859

      841     4864
      842     4865    2      IF FM$CFU.USECNT = 1 THEN DO;

   4865  2 002734   200007 473500                    LDP3    CFU$,,AUTO
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:138  
         2 002735   300003 720100                    LXL0    3,,PR3
         2 002736   000001 100003                    CMPX0   1,DU
         2 002737   002754 601000 2                  TNZ     NXTCODE21

      843     4866    2         FM$CFU.ALTBLD=CODE20.ALTBLD;

   4866  2 002740   000001 236100                    LDQ     1,,PR0
         2 002741   000017 772000                    QRL     15
         2 002742   300006 676100                    ERQ     6,,PR3
         2 002743   000004 376003                    ANQ     4,DU
         2 002744   300006 656100                    ERSQ    6,,PR3

      844     4867    2         F$DCB.UNIQUEBLD=CODE20.UNIQUEBLD;

   4867  2 002745   200004 470500                    LDP0    JDCB$,,AUTO
         2 002746   200012 473500                    LDP3    KEY$,,AUTO
         2 002747   300001 236100                    LDQ     1,,PR3
         2 002750   000030 772000                    QRL     24
         2 002751   000103 676100                    ERQ     67,,PR0
         2 002752   002000 376007                    ANQ     1024,DL
         2 002753   000103 656100                    ERSQ    67,,PR0

      845     4868    2         END;

   4865  2 002754                       NXTCODE21    null
      846     4869                    /**/
      847     4870    1   NXTCODE21:;
      848     4871    2      IF F$DCB.IRRECX~=0 THEN DO;

   4871  2 002754   200004 470500                    LDP0    JDCB$,,AUTO
         2 002755   000061 220100                    LDX0    49,,PR0
         2 002756   003004 600000 2                  TZE     s:4878

      849     4872    2         IRREC$=PINCRW(B$ROSEG$,F$DCB.IRRECX);

   4872  2 002757   000000 636010                    EAQ     0,X0
         2 002760   000000 036000 xsym               ADLQ    B$ROSEG$
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:139  
         2 002761   200025 756100                    STQ     IRREC$,,AUTO

      850     4873    2         J=(IRREC.NFIELDS+3)/4 + 1;

   4873  2 002762   200025 471500                    LDP1    IRREC$,,AUTO
         2 002763   100000 236100                    LDQ     0,,PR1
         2 002764   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 002765   000003 036007                    ADLQ    3,DL
         2 002766   000002 772000                    QRL     2
         2 002767   000001 036007                    ADLQ    1,DL
         2 002770   200016 756100                    STQ     J,,AUTO

      851     4874    2         CALL FSA$FSP(J, IRREC$);

   4874  2 002771   200025 633500                    EPPR3   IRREC$,,AUTO
         2 002772   200033 453500                    STP3    T$+5,,AUTO
         2 002773   200016 634500                    EPPR4   J,,AUTO
         2 002774   200032 454500                    STP4    T$+4,,AUTO
         2 002775   200032 630500                    EPPR0   T$+4,,AUTO
         2 002776   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 002777   000000 701000 xent               TSX1    FSA$FSP
         2 003000   000000 011000                    NOP     0

      852     4875    2         F$DCB.IRRECX=0;

   4875  2 003001   000000 220003                    LDX0    0,DU
         2 003002   200004 470500                    LDP0    JDCB$,,AUTO
         2 003003   000061 740100                    STX0    49,,PR0

      853     4876    2         END;

      854     4877
      855     4878    1      I=21; CALL LOC_CODE ALTRET(NXTCODE1);

   4878  2 003004   000025 235007                    LDA     21,DL
         2 003005   200015 755100                    STA     I,,AUTO

PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:140  
   4878  2 003006   005017 701000 2                  TSX1    LOC_CODE
         2 003007   003052 702000 2                  TSX2    NXTCODE1

      856     4879    1      J=(CODE21.NFIELDS+3)/4 +1;

   4879  2 003010   200012 470500                    LDP0    KEY$,,AUTO
         2 003011   000000 236100                    LDQ     0,,PR0
         2 003012   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 003013   000003 036007                    ADLQ    3,DL
         2 003014   000002 772000                    QRL     2
         2 003015   000001 036007                    ADLQ    1,DL
         2 003016   200016 756100                    STQ     J,,AUTO

      857     4880    1      CALL FSA$GSP(J, IRREC$) ALTRET(OPER);

   4880  2 003017   200025 631500                    EPPR1   IRREC$,,AUTO
         2 003020   200033 451500                    STP1    T$+5,,AUTO
         2 003021   200016 633500                    EPPR3   J,,AUTO
         2 003022   200032 453500                    STP3    T$+4,,AUTO
         2 003023   200032 630500                    EPPR0   T$+4,,AUTO
         2 003024   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 003025   000000 701000 xent               TSX1    FSA$GSP
         2 003026   006276 702000 2                  TSX2    OPER

      858     4881    1      J=J*4;

   4881  2 003027   200016 235100                    LDA     J,,AUTO
         2 003030   000002 735000                    ALS     2
         2 003031   200016 755100                    STA     J,,AUTO

      859     4882    1      IRREC$->MOVEJ=KEY$->MOVEJ;

   4882  2 003032   200012 470500                    LDP0    KEY$,,AUTO
         2 003033   000000 620005                    EAX0    0,AL
         2 003034   200025 471500                    LDP1    IRREC$,,AUTO
         2 003035   200016 721100                    LXL1    J,,AUTO
         2 003036   040140 100540                    MLR     fill='040'O
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:141  
         2 003037   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0
         2 003040   100000 000011                    ADSC9   0,,PR1                   cn=0,n=*X1

      860     4883    1      F$DCB.IRRECX=POFFW(IRREC$, B$ROSEG$);

   4883  2 003041   000000 235000 xsym               LDA     B$ROSEG$
         2 003042   000022 771000                    ARL     18
         2 003043   200032 755100                    STA     T$+4,,AUTO
         2 003044   200025 236100                    LDQ     IRREC$,,AUTO
         2 003045   000022 772000                    QRL     18
         2 003046   200032 136100                    SBLQ    T$+4,,AUTO
         2 003047   000000 620006                    EAX0    0,QL
         2 003050   200004 470500                    LDP0    JDCB$,,AUTO
         2 003051   000061 740100                    STX0    49,,PR0

      861     4884                    /**/
      862     4885                    /*
      863     4886                    *  MOVE BASIC FILE INFORMATION FROM THE FIT
      864     4887                    */
      865     4888    1   NXTCODE1:
      866     4889    1      I=15; CALL LOC_CODE ALTRET(NXTCODE3);

   4889  2 003052   000017 235007       NXTCODE1     LDA     15,DL
         2 003053   200015 755100                    STA     I,,AUTO

   4889  2 003054   005017 701000 2                  TSX1    LOC_CODE
         2 003055   003067 702000 2                  TSX2    NXTCODE3

      867     4890    1      F$DCB.IFMT=CODE15.CGORG;

   4890  2 003056   200012 470500                    LDP0    KEY$,,AUTO
         2 003057   200004 471500                    LDP1    JDCB$,,AUTO
         2 003060   000000 236100                    LDQ     0,,PR0
         2 003061   100103 552140                    STBQ    67,'40'O,PR1

      868     4891    1      F$DCB.QISS=CODE15.QISS;

PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:142  
   4891  2 003062   000000 236100                    LDQ     0,,PR0
         2 003063   000007 736000                    QLS     7
         2 003064   100031 676100                    ERQ     25,,PR1
         2 003065   100000 376003                    ANQ     32768,DU
         2 003066   100031 656100                    ERSQ    25,,PR1

   4891  2 003067                       NXTCODE3     null
      869     4892    1   NXTCODE3:;
      870     4893    1      I=3; CALL LOC_CODE;

   4893  2 003067   000003 235007                    LDA     3,DL
         2 003070   200015 755100                    STA     I,,AUTO

   4893  2 003071   005017 701000 2                  TSX1    LOC_CODE
         2 003072   000000 011000                    NOP     0

      871     4894                    /**/
      872     4895    1      F$DCB.DESC=CODE03.DESC;

   4895  2 003073   200012 470500                    LDP0    KEY$,,AUTO
         2 003074   000001 220100                    LDX0    1,,PR0
         2 003075   200004 471500                    LDP1    JDCB$,,AUTO
         2 003076   100005 440100                    SXL0    5,,PR1

      873     4896    1      IF FM$CFU.SHARED AND F$DCB.DESC.BUPM THEN F$DCB.DESC.BUF='1'B;

   4896  2 003077   200007 470500                    LDP0    CFU$,,AUTO
         2 003100   000000 236100                    LDQ     0,,PR0
         2 003101   002000 316003                    CANQ    1024,DU
         2 003102   003110 600000 2                  TZE     s:4899
         2 003103   100005 236100                    LDQ     5,,PR1
         2 003104   000400 316007                    CANQ    256,DL
         2 003105   003110 600000 2                  TZE     s:4899

   4896  2 003106   100000 236007                    LDQ     32768,DL
         2 003107   100005 256100                    ORSQ    5,,PR1

PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:143  
      874     4897                    /* Non-initial opens for update need to have BUF on in the DCB,
      875     4898                       so that the eventual closer moves it to FIT if update happens */
      876     4899    1      F$DCB.ORG=CODE03.ORG;

   4899  2 003110   200012 470500                    LDP0    KEY$,,AUTO
         2 003111   000000 236100                    LDQ     0,,PR0
         2 003112   100032 552140                    STBQ    26,'40'O,PR1

      877     4900    1      F$DCB.IORG=ORGS.IORG(F$DCB.ORG);

   4900  2 003113   100032 236100                    LDQ     26,,PR1
         2 003114   000033 772000                    QRL     27
         2 003115   000002 236006 0                  LDQ     ORGS,QL
         2 003116   100070 676100                    ERQ     56,,PR1
         2 003117   077000 376003                    ANQ     32256,DU
         2 003120   100070 656100                    ERSQ    56,,PR1

      878     4901    1      F$DCB.IXTNSIZE=MOD(CODE03.UGRANS+CODE03.NGAVAL,67108864);

   4901  2 003121   000003 236100                    LDQ     3,,PR0
         2 003122   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 003123   200032 756100                    STQ     T$+4,,AUTO
         2 003124   000000 236100                    LDQ     0,,PR0
         2 003125   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 003126   200032 036100                    ADLQ    T$+4,,AUTO
         2 003127   000020 376000 3                  ANQ     16
         2 003130   100041 756100                    STQ     33,,PR1

      879     4902    1      F$DCB.ARS=CODE03.RCSZ*4096+4096;

   4902  2 003131   000003 236100                    LDQ     3,,PR0
         2 003132   000017 772000                    QRL     15
         2 003133   000021 376000 3                  ANQ     17
         2 003134   010000 036007                    ADLQ    4096,DL
         2 003135   100000 756100                    STQ     0,,PR1

      880     4903    1      F$DCB.TYPE=CODE03.TYPE;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:144  

   4903  2 003136   200012 470500                    LDP0    KEY$,,AUTO
         2 003137   000001 720100                    LXL0    1,,PR0
         2 003140   200004 471500                    LDP1    JDCB$,,AUTO
         2 003141   100025 440100                    SXL0    21,,PR1

      881     4904    1      F$DCB.EXPIRE=CODE03.EXPIRE;

   4904  2 003142   000007 236100                    LDQ     7,,PR0
         2 003143   000022 732000                    QRS     18
         2 003144   100035 756100                    STQ     29,,PR1

      882     4905    2      IF F$DCB.IORG~=%RANDOM# THEN DO;

   4905  2 003145   100070 236100                    LDQ     56,,PR1
         2 003146   077000 376003                    ANQ     32256,DU
         2 003147   003000 116003                    CMPQ    1536,DU
         2 003150   003164 600000 2                  TZE     s:4911

      883     4906    2         JDCB$->F$DCB.XTNSIZE=CODE03.XTNSIZE;

   4906  2 003151   000005 221100                    LDX1    5,,PR0
         2 003152   100037 741100                    STX1    31,,PR1

      884     4907    2         JDCB$->F$DCB.COMP=CODE03.COMP;

   4907  2 003153   000004 236100                    LDQ     4,,PR0
         2 003154   000035 772000                    QRL     29
         2 003155   100031 676100                    ERQ     25,,PR1
         2 003156   000100 376007                    ANQ     64,DL
         2 003157   100031 656100                    ERSQ    25,,PR1

      885     4908    2         JDCB$->F$DCB.NRECS=CODE03.NRECS;

   4908  2 003160   000002 235100                    LDA     2,,PR0
         2 003161   100042 755100                    STA     34,,PR1

PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:145  
      886     4909    2         JDCB$->F$DCB.RECL=CODE03.RECL;

   4909  2 003162   000005 722100                    LXL2    5,,PR0
         2 003163   100033 442100                    SXL2    27,,PR1

      887     4910    2         END;

      888     4911    2      IF F$DCB.ACS=%JRNL# THEN DO;

   4911  2 003164   100036 236100                    LDQ     30,,PR1
         2 003165   000777 376007                    ANQ     511,DL
         2 003166   000004 116007                    CMPQ    4,DL
         2 003167   003212 601000 2                  TNZ     s:4923

      889     4912    2         IF NOT F$DCB.FFLG&%FFLG_WNEW# THEN GOTO FMNE$NOACCESS;

   4912  2 003170   100004 221100                    LDX1    4,,PR1
         2 003171   100000 361003                    ANX1    32768,DU
         2 003172   006177 600000 2                  TZE     FMNE$NOACCESS

      890     4913    2         IF F$DCB.ORG~=%CONSEC# THEN GOTO FMNE$JRNLERR;

   4913  2 003173   100032 236100                    LDQ     26,,PR1
         2 003174   777000 376003                    ANQ     -512,DU
         2 003175   001000 116003                    CMPQ    512,DU
         2 003176   006215 601000 2                  TNZ     FMNE$JRNLERR

      891     4914    2         IF F$DCB.DESC.BAD

   4914  2 003177   100005 236100                    LDQ     5,,PR1
         2 003200   020000 316007                    CANQ    8192,DL
         2 003201   003211 600000 2                  TZE     s:4922
         2 003202   000000 235000 xsym               LDA     S_CUN
         2 003203   000020 115007                    CMPA    16,DL
         2 003204   003211 602000 2                  TNC     s:4922
         2 003205   000000 473400 xsym               LDP3    B$JIT$
         2 003206   300013 236100                    LDQ     11,,PR3
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:146  
         2 003207   100000 316003                    CANQ    32768,DU
         2 003210   006174 600000 2                  TZE     FMNE$BADJRNL

      892     4915    2           AND S_CUN>%JG_MING# AND NOT B$JIT.PRIV.ACTIVE.FMSEC
      893     4916    2         THEN GOTO FMNE$BADJRNL;
      894     4917                    /*E*   ERROR:  FMN-E$BADJRNL-E
      895     4918                           MESSAGE:Journal file% %UF% is broken, open not allowed
      896     4919                           MESSAGE1:Journal file% %UF% has been damaged by a
      897     4920                                    system error.  Opens are not allowed without FMSEC.
      898     4921                    */
      899     4922    2         END;

   4922  2 003211   003222 710000 2                  TRA     s:4925

      900     4923    1      ELSE FM$CFU.B=BITBIN(F$DCB.DESC.BAD);

   4923  2 003212   100005 236100                    LDQ     5,,PR1
         2 003213   000015 772000                    QRL     13
         2 003214   000001 376007                    ANQ     1,DL
         2 003215   200007 473500                    LDP3    CFU$,,AUTO
         2 003216   000023 736000                    QLS     19
         2 003217   300006 676100                    ERQ     6,,PR3
         2 003220   000002 376003                    ANQ     2,DU
         2 003221   300006 656100                    ERSQ    6,,PR3

      901     4924                    /**/
      902     4925    1      IF FPT$OPEN_V.OPER.TEST

   4925  2 003222   200003 470500                    LDP0    @PN$,,AUTO
         2 003223   000000 473500                    LDP3    0,,PR0
         2 003224   300000 236100                    LDQ     0,,PR3
         2 003225   020000 316007                    CANQ    8192,DL
         2 003226   006221 601000 2                  TNZ     OPERX

   4925  2 003227                       JRNLXIT      null
      903     4926    1      THEN GOTO OPERX; /* TEST OPEN IS DONE */
      904     4927                    /*
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:147  
      905     4928                    *  SET THE DATES IN THE FIT
      906     4929                    */
      907     4930    1   JRNLXIT:;
      908     4931    1      CALL FMR$L8; /* BUT ONLY FOR THE FIRST OPEN */

   4931  2 003227   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 003230   000000 701000 xent               TSX1    FMR$L8
         2 003231   000000 011000                    NOP     0

      909     4932    2      IF F$DCB.SHARED THEN DO; /* CHECK THAT WE CAN STILL SHARE THE FILE */

   4932  2 003232   200004 470500                    LDP0    JDCB$,,AUTO
         2 003233   000064 236100                    LDQ     52,,PR0
         2 003234   100000 316003                    CANQ    32768,DU
         2 003235   003340 600000 2                  TZE     s:4951

      910     4933    2         F$DCB.SHARED='0'B;

   4933  2 003236   000022 236000 3                  LDQ     18
         2 003237   000064 356100                    ANSQ    52,,PR0

      911     4934    2         IF F$DCB.FUN~=%IN# AND FM$CFU.SHARE~=%ALL# THEN GOTO FMNE$FILEBUSY;

   4934  2 003240   000032 236100                    LDQ     26,,PR0
         2 003241   000777 376003                    ANQ     511,DU
         2 003242   000002 116003                    CMPQ    2,DU
         2 003243   003251 600000 2                  TZE     s:4935
         2 003244   200007 471500                    LDP1    CFU$,,AUTO
         2 003245   100000 236100                    LDQ     0,,PR1
         2 003246   060000 376003                    ANQ     24576,DU
         2 003247   020000 116003                    CMPQ    8192,DU
         2 003250   006111 601000 2                  TNZ     FMNE$FILEBUSY

      912     4935    2         IF F$DCB.SHARE~=%ALL#

   4935  2 003251   000031 236100                    LDQ     25,,PR0
         2 003252   000600 376007                    ANQ     384,DL
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:148  
         2 003253   000200 116007                    CMPQ    128,DL
         2 003254   003266 600000 2                  TZE     s:4939

      913     4936    2         THEN IF FM$CFU.FUN=%UPDATE# THEN GOTO FMNE$FILEBUSY;

   4936  2 003255   200007 471500                    LDP1    CFU$,,AUTO
         2 003256   100000 236100                    LDQ     0,,PR1
         2 003257   700000 376003                    ANQ     -32768,DU
         2 003260   100000 116003                    CMPQ    32768,DU
         2 003261   006111 600000 2                  TZE     FMNE$FILEBUSY

      914     4937                    /* SOMEBODY JUMPED IN SHARING */
      915     4938    2            ELSE FM$CFU.SHARE=%IN#;/* KEEP 'EM OUT */

   4938  2 003262   100000 236100                    LDQ     0,,PR1
         2 003263   000023 376000 3                  ANQ     19
         2 003264   040000 276003                    ORQ     16384,DU
         2 003265   100000 756100                    STQ     0,,PR1

      916     4939    2         IF F$DCB.FUN~=%IN#

   4939  2 003266   200004 470500                    LDP0    JDCB$,,AUTO
         2 003267   000032 236100                    LDQ     26,,PR0
         2 003270   000777 376003                    ANQ     511,DU
         2 003271   000002 116003                    CMPQ    2,DU
         2 003272   003340 600000 2                  TZE     s:4951

      917     4940    3         THEN IF F$DCB.FFLG&%FFLG_UPFLGS# THEN DO;

   4940  2 003273   000004 220100                    LDX0    4,,PR0
         2 003274   344500 360003                    ANX0    117056,DU
         2 003275   003327 600000 2                  TZE     s:4949

      918     4941    3               IF FM$CFU.XTX~=0

   4941  2 003276   200007 471500                    LDP1    CFU$,,AUTO
         2 003277   100003 220100                    LDX0    3,,PR1
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:149  
         2 003300   003316 600000 2                  TZE     s:4946

      919     4942    3               THEN IF PINCRW(F$CFU$,FM$CFU.XTX)->FM$CFUEXT.UPDCNT=4095

   4942  2 003301   000000 473400 xsym               LDP3    F$CFU$
         2 003302   300000 236110                    LDQ     0,X0,PR3
         2 003303   007777 376003                    ANQ     4095,DU
         2 003304   007777 116003                    CMPQ    4095,DU
         2 003305   006124 600000 2                  TZE     FMNE$NOCFUSA

      920     4943    3                  THEN GOTO FMNE$NOCFUSA;
      921     4944    3                  ELSE PINCRW(F$CFU$,FM$CFU.XTX)->FM$CFUEXT.UPDCNT=

   4944  2 003306   300000 236110                    LDQ     0,X0,PR3
         2 003307   000022 772000                    QRL     18
         2 003310   007777 376007                    ANQ     4095,DL
         2 003311   000001 036007                    ADLQ    1,DL
         2 003312   000022 736000                    QLS     18
         2 003313   300000 676110                    ERQ     0,X0,PR3
         2 003314   007777 376003                    ANQ     4095,DU
         2 003315   300000 656110                    ERSQ    0,X0,PR3

      922     4945    3                       PINCRW(F$CFU$,FM$CFU.XTX)->FM$CFUEXT.UPDCNT+1;
      923     4946    3               F$DCB.UPDCNT='1'B;

   4946  2 003316   200004 470500                    LDP0    JDCB$,,AUTO
         2 003317   001000 236007                    LDQ     512,DL
         2 003320   000103 256100                    ORSQ    67,,PR0

      924     4947    3               FM$CFU.FUN=%UPDATE#;

   4947  2 003321   200007 471500                    LDP1    CFU$,,AUTO
         2 003322   100000 236100                    LDQ     0,,PR1
         2 003323   000003 376000 3                  ANQ     3
         2 003324   100000 276003                    ORQ     32768,DU
         2 003325   100000 756100                    STQ     0,,PR1

PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:150  
      925     4948    3               END;

   4948  2 003326   003340 710000 2                  TRA     s:4951

      926     4949    2            ELSE IF FM$CFU.FUN=%IN# THEN FM$CFU.SHARE=%ALL#;

   4949  2 003327   200007 471500                    LDP1    CFU$,,AUTO
         2 003330   100000 236100                    LDQ     0,,PR1
         2 003331   700000 376003                    ANQ     -32768,DU
         2 003332   200000 116003                    CMPQ    65536,DU
         2 003333   003340 601000 2                  TNZ     s:4951

   4949  2 003334   100000 236100                    LDQ     0,,PR1
         2 003335   000023 376000 3                  ANQ     19
         2 003336   020000 276003                    ORQ     8192,DU
         2 003337   100000 756100                    STQ     0,,PR1

      927     4950    2         END;

      928     4951    2      IF F$DCB.ACS=%JRNL# THEN DO;

   4951  2 003340   200004 470500                    LDP0    JDCB$,,AUTO
         2 003341   000036 236100                    LDQ     30,,PR0
         2 003342   000777 376007                    ANQ     511,DL
         2 003343   000004 116007                    CMPQ    4,DL
         2 003344   003447 601000 2                  TNZ     s:4980

      929     4952    3         IF FM$CFUJ.USER~=0 THEN DO;

   4952  2 003345   200007 471500                    LDP1    CFU$,,AUTO
         2 003346   100005 236100                    LDQ     5,,PR1
         2 003347   000777 316003                    CANQ    511,DU
         2 003350   003373 600000 2                  TZE     s:4966

      930     4953    4            IF FM$CFUJ.TAPE THEN DO;

   4953  2 003351   100000 316003                    CANQ    32768,DU
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:151  
         2 003352   003360 600000 2                  TZE     s:4958

      931     4954    4               F$DCB.ASN=%TAPE#;

   4954  2 003353   002000 236007                    LDQ     1024,DL
         2 003354   000032 552110                    STBQ    26,'10'O,PR0

      932     4955    4               F$DCB.IASN=%TAPE#;

   4955  2 003355   000002 236007                    LDQ     2,DL
         2 003356   000103 552104                    STBQ    67,'04'O,PR0

      933     4956    4               END;

   4956  2 003357   003364 710000 2                  TRA     s:4961

      934     4957    4            ELSE DO;

      935     4958    4               F$DCB.ASN=%FILE#;

   4958  2 003360   001000 236007                    LDQ     512,DL
         2 003361   000032 552110                    STBQ    26,'10'O,PR0

      936     4959    4               F$DCB.IASN=%FILE#;

   4959  2 003362   000001 236007                    LDQ     1,DL
         2 003363   000103 552104                    STBQ    67,'04'O,PR0

      937     4960    4               END;

      938     4961    3            F$DCB.OWNER='0'B;

   4961  2 003364   000024 236000 3                  LDQ     20
         2 003365   000064 356100                    ANSQ    52,,PR0

      939     4962    3            F$DCB.FEXT='0'B;

PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:152  
   4962  2 003366   000031 236000 xsym               LDQ     B_VECTNIL+25
         2 003367   000064 356100                    ANSQ    52,,PR0

      940     4963    3            F$DCB.FFLG=%FFLG_WNEW#;

   4963  2 003370   100000 220003                    LDX0    32768,DU
         2 003371   000004 740100                    STX0    4,,PR0

      941     4964    3            END;

   4964  2 003372   003436 710000 2                  TRA     s:4975

      942     4965    3         ELSE DO;

      943     4966    3            F$DCB.OWNER='1'B;

   4966  2 003373   040000 236007                    LDQ     16384,DL
         2 003374   000064 256100                    ORSQ    52,,PR0

      944     4967    3            F$DCB.FEXT='1'B;

   4967  2 003375   400000 236003                    LDQ     -131072,DU
         2 003376   000064 256100                    ORSQ    52,,PR0

      945     4968    3            F$DCB.FFLG=F$DCB.FFLG&(%FFLG_WNEW#|%FFLG_DELF#|%FFLG_REATTR#);

   4968  2 003377   000004 220100                    LDX0    4,,PR0
         2 003400   124000 360003                    ANX0    43008,DU
         2 003401   000004 740100                    STX0    4,,PR0

      946     4969    3            FM$CFUJ.DMAIN=F$DCB.WSR;

   4969  2 003402   200004 470500                    LDP0    JDCB$,,AUTO
         2 003403   200007 471500                    LDP1    CFU$,,AUTO
         2 003404   000040 236100                    LDQ     32,,PR0
         2 003405   000011 736000                    QLS     9
         2 003406   100005 676100                    ERQ     5,,PR1
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:153  
         2 003407   077000 376003                    ANQ     32256,DU
         2 003410   100005 656100                    ERSQ    5,,PR1

      947     4970    3            IF F$DCB.ASN=%TAPE# THEN FM$CFUJ.TAPE='1'B;

   4970  2 003411   000032 236100                    LDQ     26,,PR0
         2 003412   777000 376007                    ANQ     -512,DL
         2 003413   002000 116007                    CMPQ    1024,DL
         2 003414   003420 601000 2                  TNZ     s:4971

   4970  2 003415   200007 471500                    LDP1    CFU$,,AUTO
         2 003416   100000 236003                    LDQ     32768,DU
         2 003417   100005 256100                    ORSQ    5,,PR1

      948     4971    3            FM$CFUJ.DCB#=B$JIT.DCBNO;

   4971  2 003420   000000 471400 xsym               LDP1    B$JIT$
         2 003421   200007 473500                    LDP3    CFU$,,AUTO
         2 003422   100022 236100                    LDQ     18,,PR1
         2 003423   000033 736000                    QLS     27
         2 003424   300004 552140                    STBQ    4,'40'O,PR3

      949     4972    3            FM$CFU.FUN=%JRNL#;

   4972  2 003425   200007 470500                    LDP0    CFU$,,AUTO
         2 003426   000000 236100                    LDQ     0,,PR0
         2 003427   000003 376000 3                  ANQ     3
         2 003430   400000 276003                    ORQ     -131072,DU
         2 003431   000000 756100                    STQ     0,,PR0

      950     4973    3            FM$CFUJ.USER=S_CUN;

   4973  2 003432   200007 470500                    LDP0    CFU$,,AUTO
         2 003433   000000 236000 xsym               LDQ     S_CUN
         2 003434   000022 736000                    QLS     18
         2 003435   000005 552120                    STBQ    5,'20'O,PR0

PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:154  
      951     4974    3            END;

      952     4975    3         IF F$DCB.ASN = %TAPE# THEN DO;

   4975  2 003436   200004 470500                    LDP0    JDCB$,,AUTO
         2 003437   000032 236100                    LDQ     26,,PR0
         2 003440   777000 376007                    ANQ     -512,DL
         2 003441   002000 116007                    CMPQ    1024,DL
         2 003442   003447 601000 2                  TNZ     s:4980

      953     4976    3            CALL FMR$U8;

   4976  2 003443   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 003444   000000 701000 xent               TSX1    FMR$U8
         2 003445   000000 011000                    NOP     0

      954     4977    3            RETURN;

   4977  2 003446   000000 702200 xent               TSX2  ! X66_ARET

      955     4978    3            END;
      956     4979    2         END;
      957     4980    1      I=4; CALL LOC_CODE ALTRET(NOCODE04);

   4980  2 003447   000004 235007                    LDA     4,DL
         2 003450   200015 755100                    STA     I,,AUTO

   4980  2 003451   005017 701000 2                  TSX1    LOC_CODE
         2 003452   003467 702000 2                  TSX2    NOCODE04

      958     4981    1      IF F$DCB.WSR<2 AND F$DCB.FUN=%IN# THEN F$DCB.EXPIRE=CODE04.MODIFY.TIME;

   4981  2 003453   200004 470500                    LDP0    JDCB$,,AUTO
         2 003454   000040 236100                    LDQ     32,,PR0
         2 003455   000777 376003                    ANQ     511,DU
         2 003456   000002 116003                    CMPQ    2,DU
         2 003457   003467 603000 2                  TRC     NOCODE04
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:155  
         2 003460   000032 236100                    LDQ     26,,PR0
         2 003461   000777 376003                    ANQ     511,DU
         2 003462   000002 116003                    CMPQ    2,DU
         2 003463   003467 601000 2                  TNZ     NOCODE04

   4981  2 003464   200012 471500                    LDP1    KEY$,,AUTO
         2 003465   100001 235100                    LDA     1,,PR1
         2 003466   000035 755100                    STA     29,,PR0

   4981  2 003467                       NOCODE04     null
      959     4982    1   NOCODE04:;
      960     4983    2      IF FM$CFU.XTX=0 THEN DO;

   4983  2 003467   200007 470500                    LDP0    CFU$,,AUTO
         2 003470   000003 220100                    LDX0    3,,PR0
         2 003471   003550 601000 2                  TNZ     s:4991

      961     4984    2         IF NOT F$DCB.FFLG&%FFLG_UPFLGS# THEN FM$CFU.FUN=%IN#;

   4984  2 003472   200004 471500                    LDP1    JDCB$,,AUTO
         2 003473   100004 221100                    LDX1    4,,PR1
         2 003474   344500 361003                    ANX1    117056,DU
         2 003475   003503 601000 2                  TNZ     s:4985

   4984  2 003476   000000 236100                    LDQ     0,,PR0
         2 003477   000003 376000 3                  ANQ     3
         2 003500   200000 276003                    ORQ     65536,DU
         2 003501   000000 756100                    STQ     0,,PR0
         2 003502   003513 710000 2                  TRA     s:4987

      962     4985    2         ELSE IF FM$CFU.FUN>4 THEN FM$CFU.FUN=%UPDATE#;

   4985  2 003503   000000 236100                    LDQ     0,,PR0
         2 003504   700000 376003                    ANQ     -32768,DU
         2 003505   500000 116003                    CMPQ    -98304,DU
         2 003506   003513 602000 2                  TNC     s:4987

PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:156  
   4985  2 003507   000000 236100                    LDQ     0,,PR0
         2 003510   000003 376000 3                  ANQ     3
         2 003511   100000 276003                    ORQ     32768,DU
         2 003512   000000 756100                    STQ     0,,PR0

      963     4986                    /* IF THIS DCB CAN'T UPDATE, DONT TIE UP THE FILE */
      964     4987    2         IF FM$CFU.FUN~=%IN# OR FM$CFU.SHARE=%ALL# THEN FM$CFU.SHARED='1'B;

   4987  2 003513   200007 470500                    LDP0    CFU$,,AUTO
         2 003514   000000 236100                    LDQ     0,,PR0
         2 003515   700000 376003                    ANQ     -32768,DU
         2 003516   200000 116003                    CMPQ    65536,DU
         2 003517   003524 601000 2                  TNZ     s:4987+9
         2 003520   000000 236100                    LDQ     0,,PR0
         2 003521   060000 376003                    ANQ     24576,DU
         2 003522   020000 116003                    CMPQ    8192,DU
         2 003523   003526 601000 2                  TNZ     s:4988

   4987  2 003524   002000 236003                    LDQ     1024,DU
         2 003525   000000 256100                    ORSQ    0,,PR0

      965     4988    2         IF CODE04.SVMODIFY AND KEY$~=FIT$ THEN F$DCB.RA='1'B;

   4988  2 003526   200012 470500                    LDP0    KEY$,,AUTO
         2 003527   000010 235100                    LDA     8,,PR0
         2 003530   003537 600000 2                  TZE     s:4989
         2 003531   200012 236100                    LDQ     KEY$,,AUTO
         2 003532   200017 116100                    CMPQ    FIT$,,AUTO
         2 003533   003537 600000 2                  TZE     s:4989

   4988  2 003534   200004 471500                    LDP1    JDCB$,,AUTO
         2 003535   020000 236007                    LDQ     8192,DL
         2 003536   100064 256100                    ORSQ    52,,PR1

      966     4989    2         IF B$JIT.PRIV.ACTIVE.FMEFT AND FM$CFU.FUN=%IN# THEN GOTO FILLCFU;

   4989  2 003537   000000 471400 xsym               LDP1    B$JIT$
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:157  
         2 003540   100013 234100                    SZN     11,,PR1
         2 003541   003547 605000 2                  TPL     s:4990
         2 003542   200007 473500                    LDP3    CFU$,,AUTO
         2 003543   300000 236100                    LDQ     0,,PR3
         2 003544   700000 376003                    ANQ     -32768,DU
         2 003545   200000 116003                    CMPQ    65536,DU
         2 003546   003633 600000 2                  TZE     FILLCFU

      967     4990    2         END;

   4990  2 003547   003575 710000 2                  TRA     s:4996

      968     4991    2      ELSE IF NOT FM$CFU.SHARED OR CODE04.SVMODIFY THEN DO;

   4991  2 003550   000000 236100                    LDQ     0,,PR0
         2 003551   002000 316003                    CANQ    1024,DU
         2 003552   003556 600000 2                  TZE     s:4992
         2 003553   200012 471500                    LDP1    KEY$,,AUTO
         2 003554   100010 235100                    LDA     8,,PR1
         2 003555   003575 600000 2                  TZE     s:4996

      969     4992    2            IF F$DCB.IORG~=%RANDOM# THEN F$DCB.NRECS = FM$CFU.NRECS;

   4992  2 003556   200004 471500                    LDP1    JDCB$,,AUTO
         2 003557   100070 236100                    LDQ     56,,PR1
         2 003560   077000 376003                    ANQ     32256,DU
         2 003561   003000 116003                    CMPQ    1536,DU
         2 003562   003565 600000 2                  TZE     s:4993

   4992  2 003563   000001 235100                    LDA     1,,PR0
         2 003564   100042 755100                    STA     34,,PR1

      970     4993    2            F$DCB.IXTNSIZE = FM$CFU.UGRANS+FM$CFU.NGAVAL;

   4993  2 003565   000007 236100                    LDQ     7,,PR0
         2 003566   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 003567   200032 756100                    STQ     T$+4,,AUTO
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:158  
         2 003570   000004 236100                    LDQ     4,,PR0
         2 003571   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 003572   200032 036100                    ADLQ    T$+4,,AUTO
         2 003573   100041 756100                    STQ     33,,PR1

      971     4994    2            GOTO SHREXIT;

   4994  2 003574   004306 710000 2                  TRA     SHREXIT

      972     4995    2            END;
      973     4996    1      IF KEY$=FIT$ THEN GOTO FILLCFU;

   4996  2 003575   200012 236100                    LDQ     KEY$,,AUTO
         2 003576   200017 116100                    CMPQ    FIT$,,AUTO
         2 003577   003633 600000 2                  TZE     FILLCFU

      974     4997    1      CALL SSS$SYSTIME(I);

   4997  2 003600   200015 630500                    EPPR0   I,,AUTO
         2 003601   200032 450500                    STP0    T$+4,,AUTO
         2 003602   200032 630500                    EPPR0   T$+4,,AUTO
         2 003603   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003604   000000 701000 xent               TSX1    SSS$SYSTIME
         2 003605   000000 011000                    NOP     0

      975     4998    1      CODE04.ACCESS.TIME=I;

   4998  2 003606   200015 235100                    LDA     I,,AUTO
         2 003607   200012 470500                    LDP0    KEY$,,AUTO
         2 003610   000000 755100                    STA     0,,PR0

      976     4999    2      IF FM$CFU.SHARED THEN DO;

   4999  2 003611   200007 470500                    LDP0    CFU$,,AUTO
         2 003612   000000 236100                    LDQ     0,,PR0
         2 003613   002000 316003                    CANQ    1024,DU
         2 003614   003624 600000 2                  TZE     s:5003
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:159  

      977     5000    2         CODE04.SVMODIFY.TIME=CODE04.MODIFY.TIME;

   5000  2 003615   200012 471500                    LDP1    KEY$,,AUTO
         2 003616   100001 235100                    LDA     1,,PR1
         2 003617   100010 755100                    STA     8,,PR1

      978     5001    2         CODE04.MODIFY.TIME=I;

   5001  2 003620   200015 235100                    LDA     I,,AUTO
         2 003621   200012 471500                    LDP1    KEY$,,AUTO
         2 003622   100001 755100                    STA     1,,PR1

      979     5002    2         END;

   5002  2 003623   003630 710000 2                  TRA     s:5004

      980     5003    1      ELSE IF FM$CFUA.ACCESS.NOACUP THEN GOTO FILLCFU;

   5003  2 003624   200010 471500                    LDP1    ACCT$,,AUTO
         2 003625   100005 236100                    LDQ     5,,PR1
         2 003626   002000 316007                    CANQ    1024,DL
         2 003627   003633 601000 2                  TNZ     FILLCFU

      981     5004    1      F$DCB.BFR.BUFUP(1)='1'B;

   5004  2 003630   200004 470500                    LDP0    JDCB$,,AUTO
         2 003631   400000 236003                    LDQ     -131072,DU
         2 003632   000116 256100                    ORSQ    78,,PR0

      982     5005    1   FILLCFU:
      983     5006    1      IF FM$CFU.XTX~=0 THEN GOTO NXTCOD1;

   5006  2 003633   200007 470500       FILLCFU      LDP0    CFU$,,AUTO
         2 003634   000003 220100                    LDX0    3,,PR0
         2 003635   004121 601000 2                  TNZ     NXTCOD1

PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:160  
      984     5007                    /*
      985     5008                    *  MOVE FIT INFORMATION TO THE CFU
      986     5009                    *
      987     5010                    *  FILL IN THE EXTENT LIST FOR THIS FILE
      988     5011                    */
      989     5012    1      KEY$=PINCRW(FIT$,FM$FIT.CODES.ITEMX(1));

   5012  2 003636   200017 471500                    LDP1    FIT$,,AUTO
         2 003637   100001 721100                    LXL1    1,,PR1
         2 003640   001777 361003                    ANX1    1023,DU
         2 003641   000000 636011                    EAQ     0,X1
         2 003642   200017 036100                    ADLQ    FIT$,,AUTO
         2 003643   200012 756100                    STQ     KEY$,,AUTO

      990     5013    1      I=FM$FIT.CODES.NDW(1)-1;

   5013  2 003644   100001 236100                    LDQ     1,,PR1
         2 003645   000012 772000                    QRL     10
         2 003646   001777 376007                    ANQ     1023,DL
         2 003647   000001 136007                    SBLQ    1,DL
         2 003650   200015 756100                    STQ     I,,AUTO

      991     5014    2      IF FM$GRAN.LVL=6 THEN DO;

   5014  2 003651   200014 473500                    LDP3    BUF$,,AUTO
         2 003652   300001 236100                    LDQ     1,,PR3
         2 003653   340000 376007                    ANQ     114688,DL
         2 003654   300000 116007                    CMPQ    98304,DL
         2 003655   003665 601000 2                  TNZ     s:5019

      992     5015    2         FM$CFU.AFIT=1;

   5015  2 003656   001000 236003                    LDQ     512,DU
         2 003657   000000 256100                    ORSQ    0,,PR0

      993     5016    2         JDCB$->F$DCB.BFR.DA(1)=FM$CFU.FITSDA;

PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:161  
   5016  2 003660   200007 470500                    LDP0    CFU$,,AUTO
         2 003661   200004 471500                    LDP1    JDCB$,,AUTO
         2 003662   000000 236100                    LDQ     0,,PR0
         2 003663   100116 552134                    STBQ    78,'34'O,PR1

      994     5017    2         END;

   5017  2 003664   003723 710000 2                  TRA     s:5028

      995     5018    2      ELSE DO;

      996     5019    2         IF NOT FM$CFU.SHARED AND (I=1

   5019  2 003665   000000 236100                    LDQ     0,,PR0
         2 003666   002000 316003                    CANQ    1024,DU
         2 003667   003723 601000 2                  TNZ     s:5028
         2 003670   200015 235100                    LDA     I,,AUTO
         2 003671   000001 115007                    CMPA    1,DL
         2 003672   003701 600000 2                  TZE     s:5021
         2 003673   000002 115007                    CMPA    2,DL
         2 003674   003723 601000 2                  TNZ     s:5028
         2 003675   200012 474500                    LDP4    KEY$,,AUTO
         2 003676   400001 236100                    LDQ     1,,PR4
         2 003677   777000 316003                    CANQ    -512,DU
         2 003700   003723 601000 2                  TNZ     s:5028

      997     5020    3           OR I=2 AND CODE01.XTNT.XTNSIZE(0)=0) THEN DO;

      998     5021    3            FM$CFU.XTX=1;

   5021  2 003701   000001 220003                    LDX0    1,DU
         2 003702   000003 740100                    STX0    3,,PR0

      999     5022    3            IF I=1 THEN F$DCB.IXTNSIZE=CODE01.XTNT.XTNSIZE(0);

   5022  2 003703   200015 235100                    LDA     I,,AUTO
         2 003704   000001 115007                    CMPA    1,DL
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:162  
         2 003705   003714 601000 2                  TNZ     s:5023

   5022  2 003706   200012 470500                    LDP0    KEY$,,AUTO
         2 003707   000001 236100                    LDQ     1,,PR0
         2 003710   000033 772000                    QRL     27
         2 003711   200004 471500                    LDP1    JDCB$,,AUTO
         2 003712   100041 756100                    STQ     33,,PR1
         2 003713   003720 710000 2                  TRA     s:5024

     1000     5023    3            ELSE F$DCB.IXTNSIZE=CODE01.EXTNT.XTNSIZE(0);

   5023  2 003714   200012 470500                    LDP0    KEY$,,AUTO
         2 003715   200004 471500                    LDP1    JDCB$,,AUTO
         2 003716   000002 235100                    LDA     2,,PR0
         2 003717   100041 755100                    STA     33,,PR1

     1001     5024    3            F$DCB.BFR.DA(1)=FM_FRZERO;

   5024  2 003720   000000 236000 xsym               LDQ     FM_FRZERO
         2 003721   100116 552134                    STBQ    78,'34'O,PR1

     1002     5025    3            GOTO NOXTX;

   5025  2 003722   004104 710000 2                  TRA     NOXTX

     1003     5026    3            END;
     1004     5027    2         END;
     1005     5028    1      CALL FMR$GA(ACCT$,ACCTX)ALTRET(FMNE$NOCFUSA);

   5028  2 003723   200011 631500                    EPPR1   ACCTX,,AUTO
         2 003724   200033 451500                    STP1    T$+5,,AUTO
         2 003725   200010 633500                    EPPR3   ACCT$,,AUTO
         2 003726   200032 453500                    STP3    T$+4,,AUTO
         2 003727   200032 630500                    EPPR0   T$+4,,AUTO
         2 003730   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 003731   000000 701000 xent               TSX1    FMR$GA
         2 003732   006124 702000 2                  TSX2    FMNE$NOCFUSA
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:163  

     1006     5029    1      FM$CFU.XTX=ACCTX;

   5029  2 003733   200011 720100                    LXL0    ACCTX,,AUTO
         2 003734   200007 470500                    LDP0    CFU$,,AUTO
         2 003735   000003 740100                    STX0    3,,PR0

     1007     5030    2      IF FM$CFU.FUN~=%IN# THEN DO;

   5030  2 003736   200007 470500                    LDP0    CFU$,,AUTO
         2 003737   000000 236100                    LDQ     0,,PR0
         2 003740   700000 376003                    ANQ     -32768,DU
         2 003741   200000 116003                    CMPQ    65536,DU
         2 003742   003751 600000 2                  TZE     s:5034

     1008     5031    2         FM$CFUEXT.UPDCNT=1;

   5031  2 003743   200010 471500                    LDP1    ACCT$,,AUTO
         2 003744   000001 236003                    LDQ     1,DU
         2 003745   100000 752130                    STCQ    0,'30'O,PR1

     1009     5032    2         F$DCB.UPDCNT='1'B;

   5032  2 003746   200004 470500                    LDP0    JDCB$,,AUTO
         2 003747   001000 236007                    LDQ     512,DL
         2 003750   000103 256100                    ORSQ    67,,PR0

     1010     5033    2         END;

     1011     5034    2      DO WHILE (I>0);

   5034  2 003751   200015 235100                    LDA     I,,AUTO
         2 003752   004067 604400 2                  TMOZ    s:5060

     1012     5035    2         J=I*4;

   5035  2 003753   200015 235100                    LDA     I,,AUTO
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:164  
         2 003754   000002 735000                    ALS     2
         2 003755   200016 755100                    STA     J,,AUTO

     1013     5036    3         IF I<8 THEN DO;

   5036  2 003756   200015 236100                    LDQ     I,,AUTO
         2 003757   000010 116007                    CMPQ    8,DL
         2 003760   003775 605000 2                  TPL     s:5041

     1014     5037    3            ADDR(FM$CFUEXT)->XTNTS.XTNS=XTNTS.XTNS;

   5037  2 003761   200012 470500                    LDP0    KEY$,,AUTO
         2 003762   000000 620005                    EAX0    0,AL
         2 003763   200010 471500                    LDP1    ACCT$,,AUTO
         2 003764   200016 721100                    LXL1    J,,AUTO
         2 003765   000140 100540                    MLR     fill='000'O
         2 003766   000001 000010                    ADSC9   1,,PR0                   cn=0,n=*X0
         2 003767   100001 000011                    ADSC9   1,,PR1                   cn=0,n=*X1

     1015     5038    3            FM$CFUEXT.NUM=I;

   5038  2 003770   200010 470500                    LDP0    ACCT$,,AUTO
         2 003771   200015 236100                    LDQ     I,,AUTO
         2 003772   000036 736000                    QLS     30
         2 003773   000000 752140                    STCQ    0,'40'O,PR0

     1016     5039    3            END;

   5039  2 003774   004032 710000 2                  TRA     s:5052

     1017     5040    3         ELSE DO;

     1018     5041    3            FM$CFUEXT.XTNT=XTNTS.XTNS; /* MOVE WHAT WILL FIT */

   5041  2 003775   200012 470500                    LDP0    KEY$,,AUTO
         2 003776   000000 620005                    EAX0    0,AL
         2 003777   200010 471500                    LDP1    ACCT$,,AUTO
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:165  
         2 004000   000100 100540                    MLR     fill='000'O
         2 004001   000001 000010                    ADSC9   1,,PR0                   cn=0,n=*X0
         2 004002   100001 000034                    ADSC9   1,,PR1                   cn=0,n=28

     1019     5042    3            J=6;

   5042  2 004003   000006 235007                    LDA     6,DL
         2 004004   200016 755100                    STA     J,,AUTO

     1020     5043    4            DO WHILE (J>=0 AND FM$CFUEXT.XTNT.XTNSIZE(J)=0);

   5043  2 004005   004010 710000 2                  TRA     s:5045

     1021     5044    4               J=J-1;

   5044  2 004006   000001 336007                    LCQ     1,DL
         2 004007   200016 056100                    ASQ     J,,AUTO

     1022     5045    4               END;

   5045  2 004010   200016 235100                    LDA     J,,AUTO
         2 004011   004016 604000 2                  TMI     s:5046
         2 004012   200010 470500                    LDP0    ACCT$,,AUTO
         2 004013   000001 236105                    LDQ     1,AL,PR0
         2 004014   777000 316003                    CANQ    -512,DU
         2 004015   004006 600000 2                  TZE     s:5044

     1023     5046    4            IF BINBIT(J,1) /* J IS ODD */ THEN DO;

   5046  2 004016   200016 236100                    LDQ     J,,AUTO
         2 004017   000043 736000                    QLS     35
         2 004020   004027 600000 2                  TZE     s:5050

     1024     5047    4               FM$CFUEXT.NUM=6;

   5047  2 004021   200010 470500                    LDP0    ACCT$,,AUTO
         2 004022   060000 236003                    LDQ     24576,DU
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:166  
         2 004023   000000 752140                    STCQ    0,'40'O,PR0

     1025     5048    4               FM$CFUEXT.XTNT(6)='0'B;

   5048  2 004024   200010 470500                    LDP0    ACCT$,,AUTO
         2 004025   000007 450100                    STZ     7,,PR0

     1026     5049    4               END;

   5049  2 004026   004032 710000 2                  TRA     s:5052

     1027     5050    3            ELSE FM$CFUEXT.NUM=7;

   5050  2 004027   200010 470500                    LDP0    ACCT$,,AUTO
         2 004030   070000 236003                    LDQ     28672,DU
         2 004031   000000 752140                    STCQ    0,'40'O,PR0

     1028     5051    3            END;

     1029     5052    2         I=I-FM$CFUEXT.NUM;

   5052  2 004032   200010 470500                    LDP0    ACCT$,,AUTO
         2 004033   000000 236100                    LDQ     0,,PR0
         2 004034   000036 772000                    QRL     30
         2 004035   200032 756100                    STQ     T$+4,,AUTO
         2 004036   200015 236100                    LDQ     I,,AUTO
         2 004037   200032 136100                    SBLQ    T$+4,,AUTO
         2 004040   200015 756100                    STQ     I,,AUTO

     1030     5053    2         KEY$=PINCRW(KEY$,FM$CFUEXT.NUM);

   5053  2 004041   000000 236100                    LDQ     0,,PR0
         2 004042   000036 772000                    QRL     30
         2 004043   000022 736000                    QLS     18
         2 004044   200012 036100                    ADLQ    KEY$,,AUTO
         2 004045   200012 756100                    STQ     KEY$,,AUTO

PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:167  
     1031     5054    3         IF I>0 THEN DO;

   5054  2 004046   200015 235100                    LDA     I,,AUTO
         2 004047   004065 604400 2                  TMOZ    s:5059

     1032     5055    3            CFU$=ACCT$;

   5055  2 004050   200010 236100                    LDQ     ACCT$,,AUTO
         2 004051   200007 756100                    STQ     CFU$,,AUTO

     1033     5056    3            CALL FMR$GA(ACCT$,ACCTX) ALTRET(FMNE$NOCFUSA);

   5056  2 004052   200011 631500                    EPPR1   ACCTX,,AUTO
         2 004053   200033 451500                    STP1    T$+5,,AUTO
         2 004054   200010 633500                    EPPR3   ACCT$,,AUTO
         2 004055   200032 453500                    STP3    T$+4,,AUTO
         2 004056   200032 630500                    EPPR0   T$+4,,AUTO
         2 004057   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 004060   000000 701000 xent               TSX1    FMR$GA
         2 004061   006124 702000 2                  TSX2    FMNE$NOCFUSA

     1034     5057    3            CFU$->FM$CFUEXT.LINKX=ACCTX;

   5057  2 004062   200011 720100                    LXL0    ACCTX,,AUTO
         2 004063   200007 470500                    LDP0    CFU$,,AUTO
         2 004064   000000 440100                    SXL0    0,,PR0

     1035     5058    3            END;

     1036     5059    2         END;

   5059  2 004065   200015 235100                    LDA     I,,AUTO
         2 004066   003753 605400 2                  TPNZ    s:5035

     1037     5060    1      CFU$=JDCB$->F$DCB.CFU$;

   5060  2 004067   200004 470500                    LDP0    JDCB$,,AUTO
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:168  
         2 004070   000066 236100                    LDQ     54,,PR0
         2 004071   200007 756100                    STQ     CFU$,,AUTO

     1038     5061    1      ACCT$=PINCRW(F$CFU$,FM$CFU.ACCTX);

   5061  2 004072   200007 471500                    LDP1    CFU$,,AUTO
         2 004073   100002 220100                    LDX0    2,,PR1
         2 004074   000000 636010                    EAQ     0,X0
         2 004075   000000 036000 xsym               ADLQ    F$CFU$
         2 004076   200010 756100                    STQ     ACCT$,,AUTO

     1039     5062    1      IF FM$CFU.AFIT=0 THEN F$DCB.BFR.DA(1)=FM_FRZERO;

   5062  2 004077   100000 236100                    LDQ     0,,PR1
         2 004100   001000 316003                    CANQ    512,DU
         2 004101   004104 601000 2                  TNZ     NOXTX

   5062  2 004102   000000 236000 xsym               LDQ     FM_FRZERO
         2 004103   000116 552134                    STBQ    78,'34'O,PR0

   5062  2 004104                       NOXTX        null
     1040     5063    1   NOXTX:;
     1041     5064                    /*
     1042     5065                    *  NOW MOVE KEYED FILE INFORMATION IF IT EXISTS IN THE FIT
     1043     5066                    */
     1044     5067    1      I=2; CALL LOC_CODE ALTRET(NXTCOD1);

   5067  2 004104   000002 235007                    LDA     2,DL
         2 004105   200015 755100                    STA     I,,AUTO

   5067  2 004106   005017 701000 2                  TSX1    LOC_CODE
         2 004107   004121 702000 2                  TSX2    NXTCOD1

     1045     5068                    /**/
     1046     5069    1      FM$CFU.SLIDE=CODE02.SLIDE;

   5069  2 004110   200012 470500                    LDP0    KEY$,,AUTO
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:169  
         2 004111   200007 471500                    LDP1    CFU$,,AUTO
         2 004112   000000 236100                    LDQ     0,,PR0
         2 004113   000033 736000                    QLS     27
         2 004114   100005 552140                    STBQ    5,'40'O,PR1

     1047     5070    1      FM$CFU.GDA=CODE02.GDA;

   5070  2 004115   200012 470500                    LDP0    KEY$,,AUTO
         2 004116   200007 471500                    LDP1    CFU$,,AUTO
         2 004117   000002 236100                    LDQ     2,,PR0
         2 004120   100005 552134                    STBQ    5,'34'O,PR1

     1048     5071                    /*
     1049     5072                    *  MOVE BASIC FILE INFORMATION FROM THE FIT
     1050     5073                    */
     1051     5074    1   NXTCOD1:
     1052     5075    1      I=3; CALL LOC_CODE;

   5075  2 004121   000003 235007       NXTCOD1      LDA     3,DL
         2 004122   200015 755100                    STA     I,,AUTO

   5075  2 004123   005017 701000 2                  TSX1    LOC_CODE
         2 004124   000000 011000                    NOP     0

     1053     5076                    /**/
     1054     5077    1      FM$CFU.UGRANS=0;/*MAKE SURE FRTOSR ALTRETS PROPERLY*/

   5077  2 004125   200007 470500                    LDP0    CFU$,,AUTO
         2 004126   000000 236003                    LDQ     0,DU
         2 004127   000004 552134                    STBQ    4,'34'O,PR0

     1055     5078    1      CALL FAF$FRTOSR(FM_SRZERO,I,J)ALTRET(CHKUGR);

   5078  2 004130   200016 630500                    EPPR0   J,,AUTO
         2 004131   200034 450500                    STP0    T$+6,,AUTO
         2 004132   200015 631500                    EPPR1   I,,AUTO
         2 004133   200033 451500                    STP1    T$+5,,AUTO
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:170  
         2 004134   000025 236000 3                  LDQ     21
         2 004135   200032 756100                    STQ     T$+4,,AUTO
         2 004136   200032 630500                    EPPR0   T$+4,,AUTO
         2 004137   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 004140   000000 701000 xent               TSX1    FAF$FRTOSR
         2 004141   004147 702000 2                  TSX2    CHKUGR

     1056     5079                    /* CHECK THAT UGRANS+NGAVAL COVERS THE FILE */
     1057     5080    1      I=FM_SRZERO-FM_FRZERO-F$DCB.IXTNSIZE;

   5080  2 004142   000000 236000 xsym               LDQ     FM_SRZERO
         2 004143   000000 136000 xsym               SBLQ    FM_FRZERO
         2 004144   200004 470500                    LDP0    JDCB$,,AUTO
         2 004145   000041 136100                    SBLQ    33,,PR0
         2 004146   200015 756100                    STQ     I,,AUTO

     1058     5081    1   CHKUGR: I=FM_SRZERO-FM_FRZERO-I;

   5081  2 004147   000000 236000 xsym  CHKUGR       LDQ     FM_SRZERO
         2 004150   000000 136000 xsym               SBLQ    FM_FRZERO
         2 004151   200015 136100                    SBLQ    I,,AUTO
         2 004152   200015 756100                    STQ     I,,AUTO

     1059     5082    2      IF CODE03.UGRANS+CODE03.NGAVAL~=I THEN DO;

   5082  2 004153   200012 470500                    LDP0    KEY$,,AUTO
         2 004154   000003 236100                    LDQ     3,,PR0
         2 004155   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 004156   200032 756100                    STQ     T$+4,,AUTO
         2 004157   000000 236100                    LDQ     0,,PR0
         2 004160   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 004161   200032 036100                    ADLQ    T$+4,,AUTO
         2 004162   004165 604000 2                  TMI     s:5083
         2 004163   200015 116100                    CMPQ    I,,AUTO
         2 004164   004177 600000 2                  TZE     s:5088

     1060     5083    2         CODE03.UGRANS=I;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:171  

   5083  2 004165   200015 236100                    LDQ     I,,AUTO
         2 004166   000000 552134                    STBQ    0,'34'O,PR0

     1061     5084    2         CODE03.NGAVAL=0;

   5084  2 004167   200012 470500                    LDP0    KEY$,,AUTO
         2 004170   000000 236003                    LDQ     0,DU
         2 004171   000003 552134                    STBQ    3,'34'O,PR0

     1062     5085    2         F$DCB.RA='1'B;

   5085  2 004172   200004 470500                    LDP0    JDCB$,,AUTO
         2 004173   020000 236007                    LDQ     8192,DL
         2 004174   000064 256100                    ORSQ    52,,PR0

     1063     5086    2         F$DCB.BFR.BUFUP(1)='1'B;

   5086  2 004175   400000 236003                    LDQ     -131072,DU
         2 004176   000116 256100                    ORSQ    78,,PR0

     1064     5087    2         END;

     1065     5088    1      FM$CFU.UGRANS=CODE03.UGRANS;

   5088  2 004177   200012 470500                    LDP0    KEY$,,AUTO
         2 004200   200007 471500                    LDP1    CFU$,,AUTO
         2 004201   000000 236100                    LDQ     0,,PR0
         2 004202   100004 552134                    STBQ    4,'34'O,PR1

     1066     5089    1      FM$CFU.NRECS=CODE03.NRECS;

   5089  2 004203   200012 470500                    LDP0    KEY$,,AUTO
         2 004204   200007 471500                    LDP1    CFU$,,AUTO
         2 004205   000002 235100                    LDA     2,,PR0
         2 004206   100001 755100                    STA     1,,PR1

PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:172  
     1067     5090    1      FM$CFU.NGAVAL=CODE03.NGAVAL;

   5090  2 004207   200012 470500                    LDP0    KEY$,,AUTO
         2 004210   200007 471500                    LDP1    CFU$,,AUTO
         2 004211   000003 236100                    LDQ     3,,PR0
         2 004212   100007 552134                    STBQ    7,'34'O,PR1

     1068     5091    1      FM$CFU.RCSZ=CODE03.RCSZ;

   5091  2 004213   200012 470500                    LDP0    KEY$,,AUTO
         2 004214   200007 471500                    LDP1    CFU$,,AUTO
         2 004215   000003 236100                    LDQ     3,,PR0
         2 004216   100004 552140                    STBQ    4,'40'O,PR1

     1069     5092    1      FM$CFU.LDA=CODE03.LDA;

   5092  2 004217   200012 470500                    LDP0    KEY$,,AUTO
         2 004220   200007 471500                    LDP1    CFU$,,AUTO
         2 004221   000100 100500                    MLR     fill='000'O
         2 004222   000004 200003                    ADSC9   4,,PR0                   cn=1,n=3
         2 004223   100006 400003                    ADSC9   6,,PR1                   cn=2,n=3

     1070     5093    2      IF F$DCB.BFR.BUFUP(1) AND NOT F$DCB.STARF THEN DO;

   5093  2 004224   200004 470500                    LDP0    JDCB$,,AUTO
         2 004225   000116 234100                    SZN     78,,PR0
         2 004226   004306 605000 2                  TPL     SHREXIT
         2 004227   000064 236100                    LDQ     52,,PR0
         2 004230   200000 316003                    CANQ    65536,DU
         2 004231   004306 601000 2                  TNZ     SHREXIT

     1071     5094    2         CALL FMR$U8;

   5094  2 004232   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 004233   000000 701000 xent               TSX1    FMR$U8
         2 004234   000000 011000                    NOP     0

PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:173  
     1072     5095    2         IF CODE03.DESC.BUPM AND NOT FM$CFUA.ACCESS.NOACUP

   5095  2 004235   200012 470500                    LDP0    KEY$,,AUTO
         2 004236   000001 236100                    LDQ     1,,PR0
         2 004237   000400 316003                    CANQ    256,DU
         2 004240   004247 600000 2                  TZE     s:5101
         2 004241   200010 471500                    LDP1    ACCT$,,AUTO
         2 004242   100005 236100                    LDQ     5,,PR1
         2 004243   002000 316007                    CANQ    1024,DL
         2 004244   004247 601000 2                  TNZ     s:5101

     1073     5096    2         THEN CODE03.DESC.BUF='1'B;

   5096  2 004245   100000 236003                    LDQ     32768,DU
         2 004246   000001 256100                    ORSQ    1,,PR0

     1074     5097                    /*
     1075     5098                    Get BUF set for ACUP opens, but leave it to close for
     1076     5099                    other update opens that might not update the file.
     1077     5100                    */
     1078     5101    3         IF FM$CFU.SHARED THEN DO;

   5101  2 004247   200007 470500                    LDP0    CFU$,,AUTO
         2 004250   000000 236100                    LDQ     0,,PR0
         2 004251   002000 316003                    CANQ    1024,DU
         2 004252   004272 600000 2                  TZE     s:5107

     1079     5102    3            CODE03.UGRANS=CODE03.UGRANS

   5102  2 004253   200012 471500                    LDP1    KEY$,,AUTO
         2 004254   100003 236100                    LDQ     3,,PR1
         2 004255   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 004256   200032 756100                    STQ     T$+4,,AUTO
         2 004257   100000 236100                    LDQ     0,,PR1
         2 004260   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 004261   200032 036100                    ADLQ    T$+4,,AUTO
         2 004262   100000 552134                    STBQ    0,'34'O,PR1
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:174  

     1080     5103    3              +CODE03.NGAVAL;
     1081     5104    3            CODE03.NGAVAL=0;

   5104  2 004263   200012 470500                    LDP0    KEY$,,AUTO
         2 004264   000000 236003                    LDQ     0,DU
         2 004265   000003 552134                    STBQ    3,'34'O,PR0

     1082     5105    3            CALL FMD$WRTSV(1);

   5105  2 004266   000010 630400 3                  EPPR0   8
         2 004267   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 004270   000000 701000 xent               TSX1    FMD$WRTSV
         2 004271   000000 011000                    NOP     0

     1083     5106    3            END;

     1084     5107    3         IF F$DCB.DESC.BUPM AND NOT F$DCB.DESC.BUF THEN DO;

   5107  2 004272   200004 470500                    LDP0    JDCB$,,AUTO
         2 004273   000005 236100                    LDQ     5,,PR0
         2 004274   000400 316007                    CANQ    256,DL
         2 004275   004311 600000 2                  TZE     s:5119
         2 004276   100000 316007                    CANQ    32768,DL
         2 004277   004311 601000 2                  TNZ     s:5119

     1085     5108    3            F$DCB.DESC.BUF='1'B;

   5108  2 004300   100000 236007                    LDQ     32768,DL
         2 004301   000005 256100                    ORSQ    5,,PR0

     1086     5109    3            CALL FMP$UPFDDESC;

   5109  2 004302   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 004303   000000 701000 xent               TSX1    FMP$UPFDDESC
         2 004304   000000 011000                    NOP     0

PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:175  
     1087     5110    3            END;

     1088     5111    2         END;

   5111  2 004305   004311 710000 2                  TRA     s:5119

     1089     5112                    /**/
     1090     5113    1      ELSE SHREXIT: CALL FMR$U8;

   5113  2 004306   000002 631400 xsym  SHREXIT      EPPR1   B_VECTNIL+2
         2 004307   000000 701000 xent               TSX1    FMR$U8
         2 004310   000000 011000                    NOP     0

     1091     5114                    /*D*
     1092     5115                     If this is an open with DELETE specified, the open now calls
     1093     5116                     the close routine which will release (SCRATCH) the file.  The DCB
     1094     5117                     is not opened in this case.
     1095     5118                    */
     1096     5119    2      IF FPT$OPEN_V.DELETE THEN DO;

   5119  2 004311   200003 470500                    LDP0    @PN$,,AUTO
         2 004312   000000 471500                    LDP1    0,,PR0
         2 004313   100000 236100                    LDQ     0,,PR1
         2 004314   040000 316007                    CANQ    16384,DL
         2 004315   004322 600000 2                  TZE     s:5123

     1097     5120    2         CALL FMP$CLSREL;

   5120  2 004316   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 004317   000000 701000 xent               TSX1    FMP$CLSREL
         2 004320   000000 011000                    NOP     0

     1098     5121    2         RETURN;

   5121  2 004321   000000 702200 xent               TSX2  ! X66_ARET

     1099     5122    2         END;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:176  
     1100     5123    1      IF F$DCB.ACS=%BLOCK#

   5123  2 004322   200004 473500                    LDP3    JDCB$,,AUTO
         2 004323   300036 236100                    LDQ     30,,PR3
         2 004324   000777 376007                    ANQ     511,DL
         2 004325   000003 116007                    CMPQ    3,DL
         2 004326   004354 600000 2                  TZE     s:5127
         2 004327   000014 116007                    CMPQ    12,DL
         2 004330   004361 601000 2                  TNZ     s:5128
         2 004331   200007 474500                    LDP4    CFU$,,AUTO
         2 004332   400000 236100                    LDQ     0,,PR4
         2 004333   002000 316003                    CANQ    1024,DU
         2 004334   004361 601000 2                  TNZ     s:5128
         2 004335   300031 236100                    LDQ     25,,PR3
         2 004336   000100 316007                    CANQ    64,DL
         2 004337   004361 601000 2                  TNZ     s:5128
         2 004340   300032 236100                    LDQ     26,,PR3
         2 004341   777000 376003                    ANQ     -512,DU
         2 004342   001000 116003                    CMPQ    512,DU
         2 004343   004354 600000 2                  TZE     s:5127
         2 004344   002000 116003                    CMPQ    1024,DU
         2 004345   004354 600000 2                  TZE     s:5127
         2 004346   005000 116003                    CMPQ    2560,DU
         2 004347   004354 600000 2                  TZE     s:5127
         2 004350   006000 116003                    CMPQ    3072,DU
         2 004351   004354 600000 2                  TZE     s:5127
         2 004352   015000 116003                    CMPQ    6656,DU
         2 004353   004361 601000 2                  TNZ     s:5128

     1101     5124    1        OR F$DCB.ACS=%UBLOCK# AND NOT FM$CFU.SHARED AND NOT F$DCB.COMP
     1102     5125    1        AND (F$DCB.ORG=%CONSEC# OR F$DCB.ORG=%KEYED#
     1103     5126    1        OR F$DCB.ORG=%RELATIVE# OR F$DCB.ORG=%INDEXED# OR F$DCB.ORG=%IREL#)
     1104     5127    1      THEN F$DCB.IORG=%RANDOM#;

   5127  2 004354   300070 236100                    LDQ     56,,PR3
         2 004355   000026 376000 3                  ANQ     22
         2 004356   003000 276003                    ORQ     1536,DU
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:177  
         2 004357   300070 756100                    STQ     56,,PR3
         2 004360   004367 710000 2                  TRA     WRAPUP

     1105     5128    1      ELSE IF F$DCB.ACS=%UBLOCK# THEN F$DCB.ACS=%SEQUEN#;

   5128  2 004361   300036 236100                    LDQ     30,,PR3
         2 004362   000777 376007                    ANQ     511,DL
         2 004363   000014 116007                    CMPQ    12,DL
         2 004364   004367 601000 2                  TNZ     WRAPUP

   5128  2 004365   000001 236007                    LDQ     1,DL
         2 004366   300036 552104                    STBQ    30,'04'O,PR3

     1106     5129        %EJECT;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:178  
     1107     5130    1   WRAPUP:
     1108     5131                    /*D*
     1109     5132                     (WRAPUP)
     1110     5133                      This is the main exit for all opens.  The assign/merge
     1111     5134                      buffer is released.  If the file has an AFIT the buffer
     1112     5135                      is released.  The disk address for buffer 1 is changed
     1113     5136                      to file-relative.  The appropriate initialization
     1114     5137                      routine is called based on DCB.IORG.  If DCB.FEXT is set,
     1115     5138                      the file is positioned to the end.  Lastly, the DCB is set
     1116     5139                      opened and the normal return is made to the user.
     1117     5140                    */
     1118     5141    1      F$DCB.MEDIA=ORGS.MEDIA(F$DCB.IORG);

   5141  2 004367   200004 470500       WRAPUP       LDP0    JDCB$,,AUTO
         2 004370   000070 236100                    LDQ     56,,PR0
         2 004371   000033 772000                    QRL     27
         2 004372   000077 376007                    ANQ     63,DL
         2 004373   000002 236006 0                  LDQ     ORGS,QL
         2 004374   000103 552120                    STBQ    67,'20'O,PR0

     1119     5142    1      F$DCB.IFMT=F$DCB.MEDIA;

   5142  2 004375   000103 236100                    LDQ     67,,PR0
         2 004376   000011 736000                    QLS     9
         2 004377   000103 552140                    STBQ    67,'40'O,PR0

     1120     5143    1      CALL FMD$RELBUF(0);

   5143  2 004400   000027 630400 3                  EPPR0   23
         2 004401   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 004402   000000 701000 xent               TSX1    FMD$RELBUF
         2 004403   000000 011000                    NOP     0

     1121     5144    1      IF FM$CFU.AFIT~=0

   5144  2 004404   200007 470500                    LDP0    CFU$,,AUTO
         2 004405   000000 236100                    LDQ     0,,PR0
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:179  
         2 004406   001000 316003                    CANQ    512,DU
         2 004407   004440 600000 2                  TZE     s:5154

     1122     5145    1      THEN IF NOT F$DCB.FFLG&%(~(FFLG_READ#|FFLG_EXEC#))

   5145  2 004410   200004 471500                    LDP1    JDCB$,,AUTO
         2 004411   100004 220100                    LDX0    4,,PR1
         2 004412   375777 360003                    ANX0    130047,DU
         2 004413   004421 601000 2                  TNZ     s:5147

     1123     5146    1         THEN CALL FMD$FLSHBUF(1); /* DONT KEEP FIT IF WE WONT USE IT */

   5146  2 004414   000010 630400 3                  EPPR0   8
         2 004415   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 004416   000000 701000 xent               TSX1    FMD$FLSHBUF
         2 004417   000000 011000                    NOP     0
         2 004420   004440 710000 2                  TRA     s:5154

     1124     5147    2         ELSE IF F$DCB.BFR.BUFX(4)=0 THEN DO;

   5147  2 004421   100121 236100                    LDQ     81,,PR1
         2 004422   037000 316003                    CANQ    15872,DU
         2 004423   004440 601000 2                  TNZ     s:5154

     1125     5148    2               F$DCB.BFR(4)=F$DCB.BFR(1);

   5148  2 004424   100116 236100                    LDQ     78,,PR1
         2 004425   100121 756100                    STQ     81,,PR1

     1126     5149    2               F$DCB.BFR1(4)=F$DCB.BFR1(1);

   5149  2 004426   100123 236100                    LDQ     83,,PR1
         2 004427   100126 756100                    STQ     86,,PR1

     1127     5150    2               F$DCB.BFR1(1)='0'B;

   5150  2 004430   100123 450100                    STZ     83,,PR1
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:180  

     1128     5151    2               F$DCB.BFR(1)='0'B;

   5151  2 004431   100116 450100                    STZ     78,,PR1

     1129     5152    2               IF F$DCB.BFR.BUFUP(4) THEN CALL FMD$WRTSV(4);

   5152  2 004432   100121 234100                    SZN     81,,PR1
         2 004433   004440 605000 2                  TPL     s:5154

   5152  2 004434   000030 630400 3                  EPPR0   24
         2 004435   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 004436   000000 701000 xent               TSX1    FMD$WRTSV
         2 004437   000000 011000                    NOP     0

     1130     5153    2               END;

     1131     5154    1      F$DCB.BFR.DA(1)=FM_FRZERO;

   5154  2 004440   200004 470500                    LDP0    JDCB$,,AUTO
         2 004441   000000 236000 xsym               LDQ     FM_FRZERO
         2 004442   000116 552134                    STBQ    78,'34'O,PR0

     1132     5155    2      DO CASE(JDCB$->F$DCB.IORG);

   5155  2 004443   000070 236100                    LDQ     56,,PR0
         2 004444   000033 772000                    QRL     27
         2 004445   000077 376007                    ANQ     63,DL
         2 004446   000006 116007                    CMPQ    6,DL
         2 004447   004451 602006 2                  TNC     s:5155+6,QL
         2 004450   004617 710000 2                  TRA     s:5181
         2 004451   004617 710000 2                  TRA     s:5181
         2 004452   004520 710000 2                  TRA     s:5166
         2 004453   004457 710000 2                  TRA     s:5157
         2 004454   004556 710000 2                  TRA     s:5172
         2 004455   004520 710000 2                  TRA     s:5166
         2 004456   004613 710000 2                  TRA     s:5179
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:181  

     1133     5156    2      CASE(%KEYED#);

     1134     5157    2         CALL FMG$INIT ALTRET(OPER);

   5157  2 004457   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 004460   000000 701000 xent               TSX1    FMG$INIT
         2 004461   006276 702000 2                  TSX2    OPER

     1135     5158    2         FM$CFU.FUN=MOD(FM$CFU.FUN,4);/* FMU$BLD MAY HAVE RUN */

   5158  2 004462   200007 470500                    LDP0    CFU$,,AUTO
         2 004463   000000 236100                    LDQ     0,,PR0
         2 004464   000041 772000                    QRL     33
         2 004465   000003 376007                    ANQ     3,DL
         2 004466   000041 736000                    QLS     33
         2 004467   000000 676100                    ERQ     0,,PR0
         2 004470   700000 376003                    ANQ     -32768,DU
         2 004471   000000 656100                    ERSQ    0,,PR0

     1136     5159    2         IF FM$CFU.GDA=1 AND FM$CFU.SHARED

   5159  2 004472   200007 470500                    LDP0    CFU$,,AUTO
         2 004473   000005 236100                    LDQ     5,,PR0
         2 004474   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 004475   000001 116007                    CMPQ    1,DL
         2 004476   004505 601000 2                  TNZ     s:5161
         2 004477   000000 236100                    LDQ     0,,PR0
         2 004500   002000 316003                    CANQ    1024,DU
         2 004501   004505 600000 2                  TZE     s:5161

     1137     5160    2         THEN CALL FMG$KEYEXP ALTRET(OPER);

   5160  2 004502   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 004503   000000 701000 xent               TSX1    FMG$KEYEXP
         2 004504   006276 702000 2                  TSX2    OPER

PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:182  
     1138     5161    3         IF F$DCB.LASTSTA$~=ADDR(NIL) THEN DO;

   5161  2 004505   200004 470500                    LDP0    JDCB$,,AUTO
         2 004506   000007 236100                    LDQ     7,,PR0
         2 004507   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 004510   004620 600000 2                  TZE     s:5187

     1139     5162    3            CALL MMV$OPEN ALTRET(OPER);

   5162  2 004511   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 004512   000000 701000 xent               TSX1    MMV$OPEN
         2 004513   006276 702000 2                  TSX2    OPER

     1140     5163    3            F$DCB.ACS=%DIRECT#;

   5163  2 004514   200004 470500                    LDP0    JDCB$,,AUTO
         2 004515   000002 236007                    LDQ     2,DL
         2 004516   000036 552104                    STBQ    30,'04'O,PR0

     1141     5164    3            END;

   5164  2 004517   004620 710000 2                  TRA     s:5187

     1142     5165    2      CASE(%CONSEC#,%UR#);

     1143     5166    2         FM$CFU.SHARE=%NONE#;

   5166  2 004520   200007 471500                    LDP1    CFU$,,AUTO
         2 004521   060000 236003                    LDQ     24576,DU
         2 004522   100000 256100                    ORSQ    0,,PR1

     1144     5167    2         IF F$DCB.ACS>%JRNL# AND (FM$CFU.FUN~=%CREATE# OR F$DCB.ORG~=%CONSEC#)

   5167  2 004523   200004 470500                    LDP0    JDCB$,,AUTO
         2 004524   000036 236100                    LDQ     30,,PR0
         2 004525   000777 376007                    ANQ     511,DL
         2 004526   000005 116007                    CMPQ    5,DL
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:183  
         2 004527   004543 602000 2                  TNC     s:5169
         2 004530   200007 471500                    LDP1    CFU$,,AUTO
         2 004531   100000 236100                    LDQ     0,,PR1
         2 004532   700000 376003                    ANQ     -32768,DU
         2 004533   300000 116003                    CMPQ    98304,DU
         2 004534   004541 601000 2                  TNZ     s:5168
         2 004535   000032 236100                    LDQ     26,,PR0
         2 004536   777000 376003                    ANQ     -512,DU
         2 004537   001000 116003                    CMPQ    512,DU
         2 004540   004543 600000 2                  TZE     s:5169

     1145     5168    2         THEN F$DCB.ACS=%SEQUEN#;

   5168  2 004541   000001 236007                    LDQ     1,DL
         2 004542   000036 552104                    STBQ    30,'04'O,PR0

     1146     5169    2         IF F$DCB.IORG=%UR# THEN CALL FSF$FORM ALTRET(OPER);

   5169  2 004543   000070 236100                    LDQ     56,,PR0
         2 004544   077000 376003                    ANQ     32256,DU
         2 004545   004000 116003                    CMPQ    2048,DU
         2 004546   004552 601000 2                  TNZ     s:5170

   5169  2 004547   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 004550   000000 701000 xent               TSX1    FSF$FORM
         2 004551   006276 702000 2                  TSX2    OPER

     1147     5170    2         CALL FMH$INIT;

   5170  2 004552   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 004553   000000 701000 xent               TSX1    FMH$INIT
         2 004554   000000 011000                    NOP     0
         2 004555   004620 710000 2                  TRA     s:5187

     1148     5171    2      CASE(%RANDOM#);

     1149     5172    2         IF F$DCB.ORG=%CG# AND F$DCB.ASN~=%FILE#
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:184  

   5172  2 004556   000032 236100                    LDQ     26,,PR0
         2 004557   777000 376003                    ANQ     -512,DU
         2 004560   013000 116003                    CMPQ    5632,DU
         2 004561   004573 601000 2                  TNZ     s:5174
         2 004562   000032 236100                    LDQ     26,,PR0
         2 004563   777000 376007                    ANQ     -512,DL
         2 004564   001000 116007                    CMPQ    512,DL
         2 004565   004573 600000 2                  TZE     s:5174

     1150     5173    2         THEN CALL KCO$INIT(PN$) ALTRET(OPER1);

   5173  2 004566   200003 630500                    EPPR0   @PN$,,AUTO
         2 004567   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 004570   000000 701000 xent               TSX1    KCO$INIT
         2 004571   006333 702000 2                  TSX2    OPER1
         2 004572   004576 710000 2                  TRA     s:5175

     1151     5174    2         ELSE CALL FMI$INIT ALTRET(OPER1);

   5174  2 004573   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 004574   000000 701000 xent               TSX1    FMI$INIT
         2 004575   006333 702000 2                  TSX2    OPER1

     1152     5175    2         IF FM$CFU.FUN=%CREATE# AND F$DCB.CTG

   5175  2 004576   200007 470500                    LDP0    CFU$,,AUTO
         2 004577   000000 236100                    LDQ     0,,PR0
         2 004600   700000 376003                    ANQ     -32768,DU
         2 004601   300000 116003                    CMPQ    98304,DU
         2 004602   004620 601000 2                  TNZ     s:5187
         2 004603   200004 471500                    LDP1    JDCB$,,AUTO
         2 004604   100031 236100                    LDQ     25,,PR1
         2 004605   004000 316007                    CANQ    2048,DL
         2 004606   004620 600000 2                  TZE     s:5187

     1153     5176                    /* THE INIT DIDN'T FAIL, SO CATALOG IT NOW */
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:185  
     1154     5177    2         THEN CALL FMP$UPFDDESC ALTRET(OPER);

   5177  2 004607   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 004610   000000 701000 xent               TSX1    FMP$UPFDDESC
         2 004611   006276 702000 2                  TSX2    OPER
         2 004612   004620 710000 2                  TRA     s:5187

     1155     5178    2      CASE(%RELATIVE#);

     1156     5179    2         CALL FMJ$INIT;

   5179  2 004613   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 004614   000000 701000 xent               TSX1    FMJ$INIT
         2 004615   000000 011000                    NOP     0
         2 004616   004620 710000 2                  TRA     s:5187

     1157     5180    2      CASE(ELSE);

     1158     5181    2         GOTO FMNE$UNIMP;

   5181  2 004617   006046 710000 2                  TRA     FMNE$UNIMP

     1159     5182    2      END;

     1160     5183                    /*
     1161     5184                    *  POSITION TO THE END OF FILE IF FILE EXTENSION IS INDICATED.
     1162     5185                    *  SET THE DCB OPEN AND RETURN TO THE USER.
     1163     5186                    */
     1164     5187    2      IF JDCB$->F$DCB.FEXT THEN DO;

   5187  2 004620   200004 470500                    LDP0    JDCB$,,AUTO
         2 004621   000064 234100                    SZN     52,,PR0
         2 004622   004633 605000 2                  TPL     s:5191

     1165     5188    2         CALL FMF$PEOF(FPTPFILEOF);

   5188  2 004623   000031 630400 3                  EPPR0   25
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:186  
         2 004624   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 004625   000000 701000 xent               TSX1    FMF$PEOF
         2 004626   000000 011000                    NOP     0

     1166     5189    2         IF B$JIT$->B$JIT.ERR.CODE~=0 THEN GOTO OPER;

   5189  2 004627   000000 470400 xsym               LDP0    B$JIT$
         2 004630   000012 236100                    LDQ     10,,PR0
         2 004631   377770 316007                    CANQ    131064,DL
         2 004632   006276 601000 2                  TNZ     OPER

     1167     5190    2         END;

     1168     5191    2      IF F$DCB.ACS=%JRNL# THEN DO;

   5191  2 004633   200004 470500                    LDP0    JDCB$,,AUTO
         2 004634   000036 236100                    LDQ     30,,PR0
         2 004635   000777 376007                    ANQ     511,DL
         2 004636   000004 116007                    CMPQ    4,DL
         2 004637   004647 601000 2                  TNZ     s:5195

     1169     5192    2         CALL FMH$JGETPG(1)ALTRET(OPER);

   5192  2 004640   000010 630400 3                  EPPR0   8
         2 004641   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 004642   000000 701000 xent               TSX1    FMH$JGETPG
         2 004643   006276 702000 2                  TSX2    OPER

     1170     5193    2         F$DCB.ASN=%FILE#;

   5193  2 004644   200004 470500                    LDP0    JDCB$,,AUTO
         2 004645   001000 236007                    LDQ     512,DL
         2 004646   000032 552110                    STBQ    26,'10'O,PR0

     1171     5194    2         END;

     1172     5195    1      F$DCB.SHARED=FM$CFU.FUN*FM$CFU.SHARE<3|FM$CFU.FUN=%JRNL#;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:187  

   5195  2 004647   200007 471500                    LDP1    CFU$,,AUTO
         2 004650   100000 236100                    LDQ     0,,PR1
         2 004651   000037 772000                    QRL     31
         2 004652   000003 376007                    ANQ     3,DL
         2 004653   200032 756100                    STQ     T$+4,,AUTO
         2 004654   100000 236100                    LDQ     0,,PR1
         2 004655   000041 772000                    QRL     33
         2 004656   200032 402100                    MPY     T$+4,,AUTO
         2 004657   400000 220003                    LDX0    -131072,DU
         2 004660   000003 116007                    CMPQ    3,DL
         2 004661   004663 602000 2                  TNC     s:5195+12
         2 004662   000000 220003                    LDX0    0,DU
         2 004663   400000 221003                    LDX1    -131072,DU
         2 004664   100000 236100                    LDQ     0,,PR1
         2 004665   700000 376003                    ANQ     -32768,DU
         2 004666   400000 116003                    CMPQ    -131072,DU
         2 004667   004671 600000 2                  TZE     s:5195+18
         2 004670   000000 221003                    LDX1    0,DU
         2 004671   000000 636011                    EAQ     0,X1
         2 004672   200033 756100                    STQ     T$+5,,AUTO
         2 004673   000000 636010                    EAQ     0,X0
         2 004674   200033 276100                    ORQ     T$+5,,AUTO
         2 004675   000002 772000                    QRL     2
         2 004676   000064 676100                    ERQ     52,,PR0
         2 004677   100000 376003                    ANQ     32768,DU
         2 004700   000064 656100                    ERSQ    52,,PR0

     1173     5196    2      IF F$DCB.ENQF THEN DO;

   5196  2 004701   000064 236100                    LDQ     52,,PR0
         2 004702   000200 316007                    CANQ    128,DL
         2 004703   004715 600000 2                  TZE     s:5200

     1174     5197    2         CALL UQB$MDEQ(CFU$)ALTRET(OPER);

   5197  2 004704   200007 633500                    EPPR3   CFU$,,AUTO
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:188  
         2 004705   200032 453500                    STP3    T$+4,,AUTO
         2 004706   200032 630500                    EPPR0   T$+4,,AUTO
         2 004707   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 004710   000000 701000 xent               TSX1    UQB$MDEQ
         2 004711   006276 702000 2                  TSX2    OPER

     1175     5198    2         F$DCB.ENQF='0'B;

   5198  2 004712   200004 470500                    LDP0    JDCB$,,AUTO
         2 004713   000032 236000 3                  LDQ     26
         2 004714   000064 356100                    ANSQ    52,,PR0

     1176     5199    2         END;

     1177     5200    1      IF ES_LOGFILEGRANT=%PC_ES_YES# AND F$DCB.PRIVOPN AND S_CUN>%JG_MING#

   5200  2 004715   000000 235000 xsym               LDA     ES_LOGFILEGRANT
         2 004716   000001 115007                    CMPA    1,DL
         2 004717   004750 601000 2                  TNZ     s:5204
         2 004720   000102 236100                    LDQ     66,,PR0
         2 004721   200000 316003                    CANQ    65536,DU
         2 004722   004750 600000 2                  TZE     s:5204
         2 004723   000000 235000 xsym               LDA     S_CUN
         2 004724   000020 115007                    CMPA    16,DL
         2 004725   004750 602000 2                  TNC     s:5204
         2 004726   000000 471400 xsym               LDP1    B$JIT$
         2 004727   100013 236100                    LDQ     11,,PR1
         2 004730   200000 316003                    CANQ    65536,DU
         2 004731   004750 601000 2                  TNZ     s:5204
         2 004732   000102 234100                    SZN     66,,PR0
         2 004733   004750 604000 2                  TMI     s:5204

     1178     5201    2        AND NOT B$JIT.PRIV.ACTIVE.FMBLK AND NOT F$DCB.LOGSEC THEN DO;

     1179     5202    2         CALL ELA$SYSLOG (EL_FILE_ACCESS, GRANT, SIZEW(GRANT),0,EL_SEC,I);

   5202  2 004734   200015 633500                    EPPR3   I,,AUTO
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:189  
         2 004735   200037 453500                    STP3    T$+9,,AUTO
         2 004736   000034 236000 3                  LDQ     28
         2 004737   200036 756100                    STQ     T$+8,,AUTO
         2 004740   000036 237000 3                  LDAQ    30
         2 004741   200034 757100                    STAQ    T$+6,,AUTO
         2 004742   000040 237000 3                  LDAQ    32
         2 004743   200032 757100                    STAQ    T$+4,,AUTO
         2 004744   200032 630500                    EPPR0   T$+4,,AUTO
         2 004745   000024 631400 xsym               EPPR1   B_VECTNIL+20
         2 004746   000000 701000 xent               TSX1    ELA$SYSLOG
         2 004747   000000 011000                    NOP     0

     1180     5203    2         END;

     1181     5204    1      RETURN;

   5204  2 004750   000000 702200 xent               TSX2  ! X66_ARET

     1182     5205        %EJECT;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:190  
     1183     5206    1   ENQFIT: PROC ALTRET;

   5206  2 004751   200030 741300       ENQFIT       STX1  ! T$+2,,AUTO

     1184     5207    2      IF F$DCB.STARF OR FPT$OPEN_V.OPER.TEST OR

   5207  2 004752   200004 470500                    LDP0    JDCB$,,AUTO
         2 004753   000064 236100                    LDQ     52,,PR0
         2 004754   200000 316003                    CANQ    65536,DU
         2 004755   005001 601000 2                  TNZ     s:5209
         2 004756   200003 471500                    LDP1    @PN$,,AUTO
         2 004757   100000 473500                    LDP3    0,,PR1
         2 004760   300000 236100                    LDQ     0,,PR3
         2 004761   020000 316007                    CANQ    8192,DL
         2 004762   005001 601000 2                  TNZ     s:5209
         2 004763   000036 236100                    LDQ     30,,PR0
         2 004764   000777 376007                    ANQ     511,DL
         2 004765   000004 116007                    CMPQ    4,DL
         2 004766   005002 600000 2                  TZE     s:5210
         2 004767   000031 236100                    LDQ     25,,PR0
         2 004770   000600 376007                    ANQ     384,DL
         2 004771   000600 116007                    CMPQ    384,DL
         2 004772   005001 600000 2                  TZE     s:5209
         2 004773   000400 116007                    CMPQ    256,DL
         2 004774   005002 601000 2                  TNZ     s:5210
         2 004775   000032 236100                    LDQ     26,,PR0
         2 004776   000777 376003                    ANQ     511,DU
         2 004777   000002 116003                    CMPQ    2,DU
         2 005000   005002 601000 2                  TNZ     s:5210

     1185     5208    2        F$DCB.ACS~=%JRNL# AND (F$DCB.SHARE=%NONE# OR
     1186     5209    2        F$DCB.SHARE=%IN# AND F$DCB.FUN=%IN#) THEN RETURN;

   5209  2 005001   000001 702211                    TSX2  ! 1,X1

     1187     5210    2      CALL UQB$MENQX(CFU$)ALTRET(RETALT);

PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:191  
   5210  2 005002   200007 634500                    EPPR4   CFU$,,AUTO
         2 005003   200032 454500                    STP4    T$+4,,AUTO
         2 005004   200032 630500                    EPPR0   T$+4,,AUTO
         2 005005   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 005006   000000 701000 xent               TSX1    UQB$MENQX
         2 005007   005015 702000 2                  TSX2    RETALT

     1188     5211    2      F$DCB.ENQF='1'B;

   5211  2 005010   200004 470500                    LDP0    JDCB$,,AUTO
         2 005011   000200 236007                    LDQ     128,DL
         2 005012   000064 256100                    ORSQ    52,,PR0

     1189     5212    2      RETURN;

   5212  2 005013   200030 221300                    LDX1  ! T$+2,,AUTO
         2 005014   000001 702211                    TSX2  ! 1,X1

     1190     5213    2   RETALT: ALTRETURN;

   5213  2 005015   200030 221300       RETALT       LDX1  ! T$+2,,AUTO
         2 005016   000000 702211                    TSX2  ! 0,X1

     1191     5214        %EJECT;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:192  
     1192     5215    2   LOC_CODE: ENTRY ALTRET;

   5215  2 005017   200030 741300       LOC_CODE     STX1  ! T$+2,,AUTO

     1193     5216                    /* Returns FIT piece in KEY$, size in I. */
     1194     5217                    /* Caller must put piece number in I, have FIT pointer in FIT$ */
     1195     5218    2      T$=FIT$;

   5218  2 005020   200017 236100                    LDQ     FIT$,,AUTO
         2 005021   200026 756100                    STQ     T$,,AUTO

     1196     5219    2      CALL FMO$LOCCODE (T$,I);

   5219  2 005022   200015 630500                    EPPR0   I,,AUTO
         2 005023   200033 450500                    STP0    T$+5,,AUTO
         2 005024   200026 631500                    EPPR1   T$,,AUTO
         2 005025   200032 451500                    STP1    T$+4,,AUTO
         2 005026   200032 630500                    EPPR0   T$+4,,AUTO
         2 005027   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 005030   000000 701000 xent               TSX1    FMO$LOCCODE
         2 005031   000000 011000                    NOP     0

     1197     5220    2      KEY$=T$;

   5220  2 005032   200026 236100                    LDQ     T$,,AUTO
         2 005033   200012 756100                    STQ     KEY$,,AUTO

     1198     5221    2      IF KEY$=FIT$ THEN ALTRETURN;

   5221  2 005034   200017 116100                    CMPQ    FIT$,,AUTO
         2 005035   005040 601000 2                  TNZ     s:5222

   5221  2 005036   200030 221300                    LDX1  ! T$+2,,AUTO
         2 005037   000000 702211                    TSX2  ! 0,X1

     1199     5222    2      RETURN;

PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:193  
   5222  2 005040   200030 221300                    LDX1  ! T$+2,,AUTO
         2 005041   000001 702211                    TSX2  ! 1,X1

     1200     5223        %EJECT;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:194  
     1201     5224    2   GHSTACS: ENTRY ALTRET;

   5224  2 005042   200030 741300       GHSTACS      STX1  ! T$+2,,AUTO

     1202     5225    2      IF F$DCB.GHSTACS=%NONE# OR S_CUN=JG_JAYS#

   5225  2 005043   200004 470500                    LDP0    JDCB$,,AUTO
         2 005044   000052 236100                    LDQ     42,,PR0
         2 005045   000017 376003                    ANQ     15,DU
         2 005046   000003 116003                    CMPQ    3,DU
         2 005047   005114 600000 2                  TZE     s:5231
         2 005050   000000 235000 xsym               LDA     S_CUN
         2 005051   000015 115007                    CMPA    13,DL
         2 005052   005114 600000 2                  TZE     s:5231
         2 005053   000002 116003                    CMPQ    2,DU
         2 005054   005074 601000 2                  TNZ     s:5225+25
         2 005055   000064 236100                    LDQ     52,,PR0
         2 005056   100000 316003                    CANQ    32768,DU
         2 005057   005114 601000 2                  TNZ     s:5231
         2 005060   000032 236100                    LDQ     26,,PR0
         2 005061   777000 376007                    ANQ     -512,DL
         2 005062   004000 116007                    CMPQ    2048,DL
         2 005063   005074 600000 2                  TZE     s:5225+25
         2 005064   000036 236100                    LDQ     30,,PR0
         2 005065   000777 376007                    ANQ     511,DL
         2 005066   000004 116007                    CMPQ    4,DL
         2 005067   005114 601000 2                  TNZ     s:5231
         2 005070   000032 236100                    LDQ     26,,PR0
         2 005071   777000 376003                    ANQ     -512,DU
         2 005072   001000 116003                    CMPQ    512,DU
         2 005073   005114 601000 2                  TNZ     s:5231
         2 005074   000032 236100                    LDQ     26,,PR0
         2 005075   777000 376007                    ANQ     -512,DL
         2 005076   004000 116007                    CMPQ    2048,DL
         2 005077   005111 601000 2                  TNZ     s:5225+38
         2 005100   000052 236100                    LDQ     42,,PR0
         2 005101   000400 316003                    CANQ    256,DU
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:195  
         2 005102   005111 600000 2                  TZE     s:5225+38
         2 005103   000004 236100                    LDQ     4,,PR0
         2 005104   000400 316003                    CANQ    256,DU
         2 005105   005111 600000 2                  TZE     s:5225+38
         2 005106   000031 236100                    LDQ     25,,PR0
         2 005107   200000 316003                    CANQ    65536,DU
         2 005110   005114 601000 2                  TNZ     s:5231
         2 005111   000000 471400 xsym               LDP1    B$JIT$
         2 005112   100013 234100                    SZN     11,,PR1
         2 005113   005115 605000 2                  TPL     s:5232

     1203     5226    2        OR F$DCB.GHSTACS=%JRNLOPN# AND (F$DCB.SHARED
     1204     5227    2        OR F$DCB.ASN~=%COMGROUP# AND (F$DCB.ACS~=%JRNL# OR F$DCB.ORG~=%CONSEC#))
     1205     5228    2        OR F$DCB.ASN=%COMGROUP# AND F$DCB.JRNLBYPASS
     1206     5229    2        AND F$DCB.FFLG.AU AND F$DCB.AU
     1207     5230    2        OR B$JIT.PRIV.ACTIVE.FMEFT
     1208     5231    2      THEN RETURN;

   5231  2 005114   000001 702211                    TSX2  ! 1,X1

     1209     5232    3      IF F$DCB.ENQF THEN DO;

   5232  2 005115   000064 236100                    LDQ     52,,PR0
         2 005116   000200 316007                    CANQ    128,DL
         2 005117   005132 600000 2                  TZE     s:5236

     1210     5233    3         CALL FMD$FLSHBUF(1);

   5233  2 005120   000010 630400 3                  EPPR0   8
         2 005121   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 005122   000000 701000 xent               TSX1    FMD$FLSHBUF
         2 005123   000000 011000                    NOP     0

     1211     5234    3         CALL UQB$MDEQ(CFU$);

   5234  2 005124   200007 630500                    EPPR0   CFU$,,AUTO
         2 005125   200032 450500                    STP0    T$+4,,AUTO
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:196  
         2 005126   200032 630500                    EPPR0   T$+4,,AUTO
         2 005127   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 005130   000000 701000 xent               TSX1    UQB$MDEQ
         2 005131   000000 011000                    NOP     0

     1212     5235    3         END;

     1213     5236    2      IF F$DCB.GHSTACS=%JRNLOPN# AND FM$CFU.FUN>4 THEN

   5236  2 005132   200004 470500                    LDP0    JDCB$,,AUTO
         2 005133   000052 236100                    LDQ     42,,PR0
         2 005134   000017 376003                    ANQ     15,DU
         2 005135   000002 116003                    CMPQ    2,DU
         2 005136   005201 601000 2                  TNZ     s:5241
         2 005137   200007 471500                    LDP1    CFU$,,AUTO
         2 005140   100000 236100                    LDQ     0,,PR1
         2 005141   700000 376003                    ANQ     -32768,DU
         2 005142   500000 116003                    CMPQ    -98304,DU
         2 005143   005201 602000 2                  TNC     s:5241

     1214     5237    2         IF F$DCB.ACS=%JRNL# THEN FM$CFU.FUN=%JRNL#;

   5237  2 005144   000036 236100                    LDQ     30,,PR0
         2 005145   000777 376007                    ANQ     511,DL
         2 005146   000004 116007                    CMPQ    4,DL
         2 005147   005155 601000 2                  TNZ     s:5238

   5237  2 005150   100000 236100                    LDQ     0,,PR1
         2 005151   000003 376000 3                  ANQ     3
         2 005152   400000 276003                    ORQ     -131072,DU
         2 005153   100000 756100                    STQ     0,,PR1
         2 005154   005201 710000 2                  TRA     s:5241

     1215     5238    2         ELSE IF F$DCB.FUN=%CREATE# AND F$DCB.EXIST=%OLDFILE#

   5238  2 005155   000032 236100                    LDQ     26,,PR0
         2 005156   000777 376003                    ANQ     511,DU
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:197  
         2 005157   000003 116003                    CMPQ    3,DU
         2 005160   005172 601000 2                  TNZ     s:5240
         2 005161   000031 236100                    LDQ     25,,PR0
         2 005162   003000 376007                    ANQ     1536,DL
         2 005163   002000 116007                    CMPQ    1024,DL
         2 005164   005172 601000 2                  TNZ     s:5240

     1216     5239    2            THEN FM$CFU.FUN=%UPDATE#;

   5239  2 005165   100000 236100                    LDQ     0,,PR1
         2 005166   000003 376000 3                  ANQ     3
         2 005167   100000 276003                    ORQ     32768,DU
         2 005170   100000 756100                    STQ     0,,PR1
         2 005171   005201 710000 2                  TRA     s:5241

     1217     5240    2            ELSE FM$CFU.FUN=MOD(FM$CFU.FUN,4);

   5240  2 005172   100000 236100                    LDQ     0,,PR1
         2 005173   000041 772000                    QRL     33
         2 005174   000003 376007                    ANQ     3,DL
         2 005175   000041 736000                    QLS     33
         2 005176   100000 676100                    ERQ     0,,PR1
         2 005177   700000 376003                    ANQ     -32768,DU
         2 005200   100000 656100                    ERSQ    0,,PR1

     1218     5241    2      CALL KQC$TELLJ(CFU$);

   5241  2 005201   200007 630500                    EPPR0   CFU$,,AUTO
         2 005202   200032 450500                    STP0    T$+4,,AUTO
         2 005203   200032 630500                    EPPR0   T$+4,,AUTO
         2 005204   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 005205   000000 701000 xent               TSX1    KQC$TELLJ
         2 005206   000000 011000                    NOP     0

     1219     5242    3      IF F$DCB.ENQF THEN DO;

   5242  2 005207   200004 470500                    LDP0    JDCB$,,AUTO
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:198  
         2 005210   000064 236100                    LDQ     52,,PR0
         2 005211   000200 316007                    CANQ    128,DL
         2 005212   005240 600000 2                  TZE     s:5248

     1220     5243    3         CALL UQB$MENQX(CFU$);

   5243  2 005213   200007 631500                    EPPR1   CFU$,,AUTO
         2 005214   200032 451500                    STP1    T$+4,,AUTO
         2 005215   200032 630500                    EPPR0   T$+4,,AUTO
         2 005216   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 005217   000000 701000 xent               TSX1    UQB$MENQX
         2 005220   000000 011000                    NOP     0

     1221     5244    3         FDA=FM$CFU.FITSDA;

   5244  2 005221   200007 470500                    LDP0    CFU$,,AUTO
         2 005222   000000 236100                    LDQ     0,,PR0
         2 005223   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 005224   200006 756100                    STQ     FDA,,AUTO

     1222     5245    3         CALL FMN$READFIT(BUF$,FDA) ALTRET(RETALT);

   5245  2 005225   200006 631500                    EPPR1   FDA,,AUTO
         2 005226   200033 451500                    STP1    T$+5,,AUTO
         2 005227   200014 633500                    EPPR3   BUF$,,AUTO
         2 005230   200032 453500                    STP3    T$+4,,AUTO
         2 005231   200032 630500                    EPPR0   T$+4,,AUTO
         2 005232   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 005233   000000 701000 xent               TSX1    FMN$READFIT
         2 005234   005015 702000 2                  TSX2    RETALT

     1223     5246    3         FIT$=PINCRW(BUF$,SIZEW(FM$GRAN));

   5246  2 005235   200014 236100                    LDQ     BUF$,,AUTO
         2 005236   000005 036003                    ADLQ    5,DU
         2 005237   200017 756100                    STQ     FIT$,,AUTO

PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:199  
     1224     5247    3         END;

     1225     5248    2      IF B$JIT.ERR THEN ALTRETURN;

   5248  2 005240   000000 470400 xsym               LDP0    B$JIT$
         2 005241   000012 235100                    LDA     10,,PR0
         2 005242   005245 600000 2                  TZE     s:5249

   5248  2 005243   200030 221300                    LDX1  ! T$+2,,AUTO
         2 005244   000000 702211                    TSX2  ! 0,X1

     1226     5249    2      RETURN;

   5249  2 005245   200030 221300                    LDX1  ! T$+2,,AUTO
         2 005246   000001 702211                    TSX2  ! 1,X1

   5249  2 005247                       BNEWFILEX    null
     1227     5250    2   END ENQFIT;
     1228     5251        %EJECT;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:200  
     1229     5252    1   BNEWFILEX:;
     1230     5253    1      CALL FMD$FLSHBUF(1);

   5253  2 005247   000010 630400 3                  EPPR0   8
         2 005250   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 005251   000000 701000 xent               TSX1    FMD$FLSHBUF
         2 005252   000000 011000                    NOP     0

     1231     5254    1      IF NOT F$DCB.STARF THEN CALL UQB$MDEQ(ACCT$);

   5254  2 005253   200004 470500                    LDP0    JDCB$,,AUTO
         2 005254   000064 236100                    LDQ     52,,PR0
         2 005255   200000 316003                    CANQ    65536,DU
         2 005256   005265 601000 2                  TNZ     s:5255

   5254  2 005257   200010 631500                    EPPR1   ACCT$,,AUTO
         2 005260   200032 451500                    STP1    T$+4,,AUTO
         2 005261   200032 630500                    EPPR0   T$+4,,AUTO
         2 005262   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 005263   000000 701000 xent               TSX1    UQB$MDEQ
         2 005264   000000 011000                    NOP     0

     1232     5255    1      IF B$JIT.ERR.CODE=%E$NOKEY THEN B$JIT.ERR='0'B;

   5255  2 005265   000000 470400 xsym               LDP0    B$JIT$
         2 005266   000012 236100                    LDQ     10,,PR0
         2 005267   377770 376007                    ANQ     131064,DL
         2 005270   001020 116007                    CMPQ    528,DL
         2 005271   005273 601000 2                  TNZ     s:5256

   5255  2 005272   000012 450100                    STZ     10,,PR0

     1233     5256    1      IF SUBSTR(F$DCB.NAME.C,0,7)=':SECLOG' AND FM$CFU.ACCTX=FM_SYSACCTX

   5256  2 005273   200004 471500                    LDP1    JDCB$,,AUTO
         2 005274   040000 106500                    CMPC    fill='040'O
         2 005275   100010 200007                    ADSC9   8,,PR1                   cn=1,n=7
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:201  
         2 005276   000054 000007 0                  ADSC9   TESTOPN+4                cn=0,n=7
         2 005277   005312 601000 2                  TNZ     BNEWFILE0
         2 005300   200007 473500                    LDP3    CFU$,,AUTO
         2 005301   300002 236100                    LDQ     2,,PR3
         2 005302   000022 772000                    QRL     18
         2 005303   000000 116000 xsym               CMPQ    FM_SYSACCTX
         2 005304   005312 601000 2                  TNZ     BNEWFILE0
         2 005305   000000 235000 xsym               LDA     S_CUN
         2 005306   000007 115007                    CMPA    7,DL
         2 005307   005312 602000 2                  TNC     BNEWFILE0

     1234     5257    1        AND S_CUN>%JG_ELF# THEN F$DCB.FFLG='0'B;

   5257  2 005310   000000 220003                    LDX0    0,DU
         2 005311   100004 740100                    STX0    4,,PR1

   5256  2 005312                       BNEWFILE0    null
     1235     5258    1   BNEWFILE0:;
     1236     5259    1      IF NOT F$DCB.FFLG&%FFLG_CREATE#

   5259  2 005312   200004 470500                    LDP0    JDCB$,,AUTO
         2 005313   000004 220100                    LDX0    4,,PR0
         2 005314   001000 360003                    ANX0    512,DU
         2 005315   005322 601000 2                  TNZ     s:5265
         2 005316   000032 236100                    LDQ     26,,PR0
         2 005317   000777 376003                    ANQ     511,DU
         2 005320   000003 116003                    CMPQ    3,DU
         2 005321   006120 600000 2                  TZE     FMNE$NEWFILE

     1237     5260    1        AND F$DCB.FUN=%CREATE# THEN GOTO FMNE$NEWFILE;
     1238     5261                    /*E*     ERROR: FMN-E$NEWFILE-E
     1239     5262                    *        MESSAGE:You may not create a new file% for %UF%
     1240     5263                    *        MESSAGE1:DP#%SN.%AC does not permit you to create new files
     1241     5264                    */
     1242     5265    1      IF B$JIT.ERR THEN GOTO OPER;

   5265  2 005322   000000 471400 xsym               LDP1    B$JIT$
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:202  
         2 005323   100012 235100                    LDA     10,,PR1
         2 005324   006276 601000 2                  TNZ     OPER

   5265  2 005325                       BNEWFILE     null
     1243     5266    1   BNEWFILE:;
     1244     5267    1      B$JIT.ERR='0'B;

   5267  2 005325   000000 470400 xsym               LDP0    B$JIT$
         2 005326   000012 450100                    STZ     10,,PR0

     1245     5268    1      F$DCB.TYC='0'B;

   5268  2 005327   200004 471500                    LDP1    JDCB$,,AUTO
         2 005330   100001 450100                    STZ     1,,PR1
         2 005331   100002 450100                    STZ     2,,PR1

     1246     5269    1      F$DCB.DESC='0'B;

   5269  2 005332   000000 220003                    LDX0    0,DU
         2 005333   200004 471500                    LDP1    JDCB$,,AUTO
         2 005334   100005 440100                    SXL0    5,,PR1

     1247     5270    1      IF ACCT$~=ADDR(NIL) THEN F$DCB.DESC.BUPM=FM$CFUA.ACCESS.BUPM;

   5270  2 005335   200010 236100                    LDQ     ACCT$,,AUTO
         2 005336   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 005337   005346 600000 2                  TZE     s:5271

   5270  2 005340   200010 473500                    LDP3    ACCT$,,AUTO
         2 005341   300005 236100                    LDQ     5,,PR3
         2 005342   000005 772000                    QRL     5
         2 005343   100005 676100                    ERQ     5,,PR1
         2 005344   000400 376007                    ANQ     256,DL
         2 005345   100005 656100                    ERSQ    5,,PR1

     1248     5271    1      IF NOT F$DCB.BUPM&'01'B THEN F$DCB.DESC.BUPM=F$DCB.BUPM;

PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:203  
   5271  2 005346   100031 236100                    LDQ     25,,PR1
         2 005347   000042 736000                    QLS     34
         2 005350   200000 376003                    ANQ     65536,DU
         2 005351   005357 601000 2                  TNZ     s:5272

   5271  2 005352   100031 236100                    LDQ     25,,PR1
         2 005353   000007 736000                    QLS     7
         2 005354   100005 676100                    ERQ     5,,PR1
         2 005355   000400 376007                    ANQ     256,DL
         2 005356   100005 656100                    ERSQ    5,,PR1

     1249     5272    1      F$DCB.DESC.BUF=F$DCB.DESC.BUPM;

   5272  2 005357   100005 236100                    LDQ     5,,PR1
         2 005360   000007 736000                    QLS     7
         2 005361   100005 676100                    ERQ     5,,PR1
         2 005362   100000 376007                    ANQ     32768,DL
         2 005363   100005 656100                    ERSQ    5,,PR1

   5272  2 005364                       SCRATCHOPN   null
     1250     5273                    /*
     1251     5274                    *  SCRATCH OPENS COME IN AT THIS POINT
     1252     5275                    */
     1253     5276    1   SCRATCHOPN:;
     1254     5277                    /*D*
     1255     5278                     (BNEWFILE)
     1256     5279                     When open discovers that it must build a new file, it verifies
     1257     5280                    that the open has specified 'CREATE'.  If not, a 'File does not exist'
     1258     5281                    error is returned to the user.  The organization for the file is
     1259     5282                    established, as are certain restricted attributes.
     1260     5283                    If this is a TEST open, we are all done now.
     1261     5284                    */
     1262     5285    1      IF F$DCB.FUN~=%CREATE# THEN GOTO FMNE$NOFILE;

   5285  2 005364   200004 470500                    LDP0    JDCB$,,AUTO
         2 005365   000032 236100                    LDQ     26,,PR0
         2 005366   000777 376003                    ANQ     511,DU
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:204  
         2 005367   000003 116003                    CMPQ    3,DU
         2 005370   006133 601000 2                  TNZ     FMNE$NOFILE

     1263     5286                    /*E*     ERROR: FMN-E$NOFILE-E
     1264     5287                    *        MESSAGE: File% %FN% does not exist
     1265     5288                    *        MESSAGE1:File %FN does not exist in DP#%SN.%AC
     1266     5289                    */
     1267     5290    1      F$DCB.ORG=ORGS.ORG(MOD(F$DCB.ORG,16));

   5290  2 005371   000032 236100                    LDQ     26,,PR0
         2 005372   000033 772000                    QRL     27
         2 005373   000017 376007                    ANQ     15,DL
         2 005374   000002 236006 0                  LDQ     ORGS,QL
         2 005375   000022 736000                    QLS     18
         2 005376   000032 552140                    STBQ    26,'40'O,PR0

     1268     5291    1      IF F$DCB.ORG=%CG# AND F$DCB.ASN~=%COMGROUP# THEN

   5291  2 005377   000032 236100                    LDQ     26,,PR0
         2 005400   777000 376003                    ANQ     -512,DU
         2 005401   013000 116003                    CMPQ    5632,DU
         2 005402   005413 601000 2                  TNZ     s:5297
         2 005403   000032 236100                    LDQ     26,,PR0
         2 005404   777000 376007                    ANQ     -512,DL
         2 005405   004000 116007                    CMPQ    2048,DL
         2 005406   005413 600000 2                  TZE     s:5297

     1269     5292    1         IF NOT B$JIT.PRIV.ACTIVE.FMDIAG THEN

   5292  2 005407   000000 471400 xsym               LDP1    B$JIT$
         2 005410   100013 236100                    LDQ     11,,PR1
         2 005411   040000 316003                    CANQ    16384,DU
         2 005412   006207 600000 2                  TZE     FMNE$CGFILE

     1270     5293    1            GOTO FMNE$CGFILE;
     1271     5294                    /*E* ERROR: FMN-E$CGFILE-2
     1272     5295                    *    MESSAGE: You are not allowed to create a file with ORG=CG#
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:205  
     1273     5296                    */
     1274     5297    1      F$DCB.IORG=ORGS.IORG(F$DCB.ORG);

   5297  2 005413   000032 236100                    LDQ     26,,PR0
         2 005414   000033 772000                    QRL     27
         2 005415   000002 236006 0                  LDQ     ORGS,QL
         2 005416   000070 676100                    ERQ     56,,PR0
         2 005417   077000 376003                    ANQ     32256,DU
         2 005420   000070 656100                    ERSQ    56,,PR0

     1275     5298    1      IF NOT ORGS.COMP(F$DCB.ORG) THEN F$DCB.COMP=%NO#;

   5298  2 005421   000032 236100                    LDQ     26,,PR0
         2 005422   000033 772000                    QRL     27
         2 005423   000002 234006 0                  SZN     ORGS,QL
         2 005424   005427 604000 2                  TMI     s:5299

   5298  2 005425   000042 236000 3                  LDQ     34
         2 005426   000031 356100                    ANSQ    25,,PR0

     1276     5299    1      IF FPT$OPEN_V.OPER.TEST THEN GOTO OPERX;

   5299  2 005427   200003 471500                    LDP1    @PN$,,AUTO
         2 005430   100000 473500                    LDP3    0,,PR1
         2 005431   300000 236100                    LDQ     0,,PR3
         2 005432   020000 316007                    CANQ    8192,DL
         2 005433   006221 601000 2                  TNZ     OPERX

     1277     5300                    /*D*
     1278     5301                     If the file is not to be cataloged at open time, the CFU is
     1279     5302                     initialized as a 'create' CFU so that 'input' openers may still
     1280     5303                     access the old copy of the file if one exists.
     1281     5304                    */
     1282     5305    1      CALL FMR$L8;

   5305  2 005434   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 005435   000000 701000 xent               TSX1    FMR$L8
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:206  
         2 005436   000000 011000                    NOP     0

     1283     5306    1      FM$CFU.SHARE=%NONE#;

   5306  2 005437   200007 470500                    LDP0    CFU$,,AUTO
         2 005440   060000 236003                    LDQ     24576,DU
         2 005441   000000 256100                    ORSQ    0,,PR0

     1284     5307    1      FM$CFU.SHARED='1'B;

   5307  2 005442   200007 470500                    LDP0    CFU$,,AUTO
         2 005443   002000 236003                    LDQ     1024,DU
         2 005444   000000 256100                    ORSQ    0,,PR0

     1285     5308    1      FM$CFU.FMOD='1'B;

   5308  2 005445   200007 470500                    LDP0    CFU$,,AUTO
         2 005446   004000 236003                    LDQ     2048,DU
         2 005447   000000 256100                    ORSQ    0,,PR0

     1286     5309    1      FDA=FM$CFU.FITSDA; /* REMEMBER WHETHER A FILE EXISTS */

   5309  2 005450   200007 470500                    LDP0    CFU$,,AUTO
         2 005451   000000 236100                    LDQ     0,,PR0
         2 005452   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 005453   200006 756100                    STQ     FDA,,AUTO

     1287     5310    1      FM$CFU.FITSDA=0;

   5310  2 005454   000000 236003                    LDQ     0,DU
         2 005455   000000 552134                    STBQ    0,'34'O,PR0

     1288     5311    1      CALL FMR$U8;

   5311  2 005456   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 005457   000000 701000 xent               TSX1    FMR$U8
         2 005460   000000 011000                    NOP     0
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:207  

     1289     5312                    /*
     1290     5313                    *  COMPUTE GRANULE SIZE FOR RELATIVE FILES
     1291     5314                    */
     1292     5315    2      IF F$DCB.IORG=%RELATIVE# THEN DO;

   5315  2 005461   200004 470500                    LDP0    JDCB$,,AUTO
         2 005462   000070 236100                    LDQ     56,,PR0
         2 005463   077000 376003                    ANQ     32256,DU
         2 005464   005000 116003                    CMPQ    2560,DU
         2 005465   005511 601000 2                  TNZ     s:5335

     1293     5316    2         IF F$DCB.RECL=0 THEN F$DCB.RECL=4;

   5316  2 005466   000033 720100                    LXL0    27,,PR0
         2 005467   005472 601000 2                  TNZ     s:5317

   5316  2 005470   000004 221003                    LDX1    4,DU
         2 005471   000033 441100                    SXL1    27,,PR0

     1294     5317    2         J=(JDCB$->F$DCB.RECL+7)/4;

   5317  2 005472   000033 236100                    LDQ     27,,PR0
         2 005473   777777 376007                    ANQ     -1,DL
         2 005474   000007 036007                    ADLQ    7,DL
         2 005475   000002 772000                    QRL     2
         2 005476   200016 756100                    STQ     J,,AUTO

     1295     5318    2         J=((J*JDCB$->F$DCB.NRECS)+1021)/1022;

   5318  2 005477   000042 402100                    MPY     34,,PR0
         2 005500   001775 036007                    ADLQ    1021,DL
         2 005501   001776 506007                    DIV     1022,DL
         2 005502   200016 756100                    STQ     J,,AUTO

     1296     5319    2         IF J=0 THEN J=1;

PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:208  
   5319  2 005503   000000 116003                    CMPQ    0,DU
         2 005504   005507 601000 2                  TNZ     s:5320

   5319  2 005505   000001 235007                    LDA     1,DL
         2 005506   200016 755100                    STA     J,,AUTO

     1297     5320    2         JDCB$->F$DCB.IXTNSIZE=J;

   5320  2 005507   200016 235100                    LDA     J,,AUTO
         2 005510   000041 755100                    STA     33,,PR0

     1298     5321    2         END;

     1299     5322                    /*D*
     1300     5323                     Next we build the FIT for the new file and obtain the initial
     1301     5324                     extent for the file.  The extent is divided up into used (the FIT)
     1302     5325                     and available (remaining) granules.  The CFU is set up with the
     1303     5326                     initial parameters.  The FIT is written out to its proper location.
     1304     5327                     If cataloging is specified at open time, open catalogs the newly
     1305     5328                    created file.  If an old file of this name was already in the catalog
     1306     5329                    and is not open, we release the extents of that file.  If it is open,
     1307     5330                    we turn it into a 'scratch' file so that it will disappear whenever
     1308     5331                    all the current users have closed it.  No other new users are allowed
     1309     5332                    access to it.  Open then proceeds to the main exit to mark the DCB
     1310     5333                    open and return to the user (WRAPUP).
     1311     5334                    */
     1312     5335    1      CALL FMO$BLDFIT(PN$) ALTRET(OPER);

   5335  2 005511   200003 630500                    EPPR0   @PN$,,AUTO
         2 005512   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 005513   000000 701000 xent               TSX1    FMO$BLDFIT
         2 005514   006276 702000 2                  TSX2    OPER

     1313     5336    1      CALL FMR$G8(ACCT$,ACCTX) ALTRET(FMNE$NOCFUS);

   5336  2 005515   200011 630500                    EPPR0   ACCTX,,AUTO
         2 005516   200033 450500                    STP0    T$+5,,AUTO
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:209  
         2 005517   200010 631500                    EPPR1   ACCT$,,AUTO
         2 005520   200032 451500                    STP1    T$+4,,AUTO
         2 005521   200032 630500                    EPPR0   T$+4,,AUTO
         2 005522   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 005523   000000 701000 xent               TSX1    FMR$G8
         2 005524   006127 702000 2                  TSX2    FMNE$NOCFUS

     1314     5337    1      FM$CFU.XTX=ACCTX;

   5337  2 005525   200011 720100                    LXL0    ACCTX,,AUTO
         2 005526   200007 470500                    LDP0    CFU$,,AUTO
         2 005527   000003 740100                    STX0    3,,PR0

     1315     5338    1      FM$CFUEXT.UPDCNT=1;

   5338  2 005530   200010 470500                    LDP0    ACCT$,,AUTO
         2 005531   000001 236003                    LDQ     1,DU
         2 005532   000000 752130                    STCQ    0,'30'O,PR0

     1316     5339    1      F$DCB.UPDCNT='1'B;

   5339  2 005533   200004 470500                    LDP0    JDCB$,,AUTO
         2 005534   001000 236007                    LDQ     512,DL
         2 005535   000103 256100                    ORSQ    67,,PR0

     1317     5340    1      JDCB$->F$DCB.BFR.DA(1)=FM_FRZERO;

   5340  2 005536   000000 236000 xsym               LDQ     FM_FRZERO
         2 005537   000116 552134                    STBQ    78,'34'O,PR0

     1318     5341    1      BUF$=FM$BUF$(F$DCB.BFR.BUFX(1));

   5341  2 005540   000116 236100                    LDQ     78,,PR0
         2 005541   000033 772000                    QRL     27
         2 005542   000037 376007                    ANQ     31,DL
         2 005543   000000 236006 xsym               LDQ     FM$BUF$,QL
         2 005544   200014 756100                    STQ     BUF$,,AUTO
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:210  

     1319     5342    2      IF FM$GRAN.LVL=6 THEN DO;

   5342  2 005545   200014 471500                    LDP1    BUF$,,AUTO
         2 005546   100001 236100                    LDQ     1,,PR1
         2 005547   340000 376007                    ANQ     114688,DL
         2 005550   300000 116007                    CMPQ    98304,DL
         2 005551   005573 601000 2                  TNZ     s:5352

     1320     5343    2         CALL FAG$G1DIR(I) ALTRET(OPER);

   5343  2 005552   200015 633500                    EPPR3   I,,AUTO
         2 005553   200032 453500                    STP3    T$+4,,AUTO
         2 005554   200032 630500                    EPPR0   T$+4,,AUTO
         2 005555   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 005556   000000 701000 xent               TSX1    FAG$G1DIR
         2 005557   006276 702000 2                  TSX2    OPER

     1321     5344    2         FM$CFU.FITSDA=I;

   5344  2 005560   200007 470500                    LDP0    CFU$,,AUTO
         2 005561   200015 236100                    LDQ     I,,AUTO
         2 005562   000000 552134                    STBQ    0,'34'O,PR0

     1322     5345    2         FM$CFU.AFIT=1;

   5345  2 005563   200007 470500                    LDP0    CFU$,,AUTO
         2 005564   001000 236003                    LDQ     512,DU
         2 005565   000000 256100                    ORSQ    0,,PR0

     1323     5346    2         JDCB$->F$DCB.BFR.DA(1)=I;

   5346  2 005566   200004 470500                    LDP0    JDCB$,,AUTO
         2 005567   200015 236100                    LDQ     I,,AUTO
         2 005570   000116 552134                    STBQ    78,'34'O,PR0

     1324     5347    2         FM$GRAN.STAMP.GMOD=I;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:211  

   5347  2 005571   200014 471500                    LDP1    BUF$,,AUTO
         2 005572   100000 552104                    STBQ    0,'04'O,PR1

     1325     5348    2         END;

     1326     5349                    /*
     1327     5350                    *  NOW GET THE INITIAL EXTENT FOR THIS FILE
     1328     5351                    */
     1329     5352    1      IF F$DCB.ACS=%BLOCK# THEN F$DCB.IORG=%RANDOM#;

   5352  2 005573   200004 470500                    LDP0    JDCB$,,AUTO
         2 005574   000036 236100                    LDQ     30,,PR0
         2 005575   000777 376007                    ANQ     511,DL
         2 005576   000003 116007                    CMPQ    3,DL
         2 005577   005604 601000 2                  TNZ     s:5353

   5352  2 005600   000070 236100                    LDQ     56,,PR0
         2 005601   000026 376000 3                  ANQ     22
         2 005602   003000 276003                    ORQ     1536,DU
         2 005603   000070 756100                    STQ     56,,PR0

     1330     5353    1      IF (F$DCB.IXTNSIZE~=1 OR F$DCB.ORG~=%RANDOM# OR F$DCB.ACS<=%JRNL#)

   5353  2 005604   000041 235100                    LDA     33,,PR0
         2 005605   000001 115007                    CMPA    1,DL
         2 005606   005617 601000 2                  TNZ     s:5353+11
         2 005607   000032 236100                    LDQ     26,,PR0
         2 005610   777000 376003                    ANQ     -512,DU
         2 005611   003000 116003                    CMPQ    1536,DU
         2 005612   005617 601000 2                  TNZ     s:5353+11
         2 005613   000036 236100                    LDQ     30,,PR0
         2 005614   000777 376007                    ANQ     511,DL
         2 005615   000005 116007                    CMPQ    5,DL
         2 005616   005627 603000 2                  TRC     s:5355
         2 005617   000032 236100                    LDQ     26,,PR0
         2 005620   777000 376007                    ANQ     -512,DL
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:212  
         2 005621   002000 116007                    CMPQ    1024,DL
         2 005622   005627 600000 2                  TZE     s:5355

     1331     5354    1        AND F$DCB.ASN~=%TAPE# THEN CALL FAG$GEXT ALTRET(OPER);

   5354  2 005623   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 005624   000000 701000 xent               TSX1    FAG$GEXT
         2 005625   006276 702000 2                  TSX2    OPER
         2 005626   005657 710000 2                  TRA     s:5365

     1332     5355    2      ELSE IF FDA~=0 THEN DO;

   5355  2 005627   200006 236100                    LDQ     FDA,,AUTO
         2 005630   005657 600000 2                  TZE     s:5365

     1333     5356    2            IF F$DCB.ACS>=%DS2# AND F$DCB.ACS<=%DS8#

   5356  2 005631   000036 236100                    LDQ     30,,PR0
         2 005632   000777 376007                    ANQ     511,DL
         2 005633   000005 116007                    CMPQ    5,DL
         2 005634   005653 602000 2                  TNC     s:5362
         2 005635   000014 116007                    CMPQ    12,DL
         2 005636   005653 603000 2                  TRC     s:5362
         2 005637   000031 236100                    LDQ     25,,PR0
         2 005640   003000 376007                    ANQ     1536,DL
         2 005641   003000 116007                    CMPQ    1536,DL
         2 005642   005653 601000 2                  TNZ     s:5362
         2 005643   000032 236100                    LDQ     26,,PR0
         2 005644   000777 376003                    ANQ     511,DU
         2 005645   000003 116003                    CMPQ    3,DU
         2 005646   005653 601000 2                  TNZ     s:5362

     1334     5357    2              AND F$DCB.EXIST=%NEWFILE# AND F$DCB.FUN=%CREATE# THEN
     1335     5358    2               B$JIT.ERR=FMN$E$SDSEXISTS;

   5358  2 005647   000033 236000 0                  LDQ     FMN$E$SDSEXISTS
         2 005650   000000 471400 xsym               LDP1    B$JIT$
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:213  
         2 005651   100012 756100                    STQ     10,,PR1
         2 005652   005656 710000 2                  TRA     s:5363

     1336     5359                    /*E*     ERROR: FMN-E$SDSEXISTS
     1337     5360                    *        MESSAGE:Either Shared Data-segment or file% %FN% exists.
     1338     5361                    */
     1339     5362    2            ELSE B$JIT.ERR=FMN$E$CREATERR;

   5362  2 005653   000026 236000 0                  LDQ     FMN$E$CREATERR
         2 005654   000000 471400 xsym               LDP1    B$JIT$
         2 005655   100012 756100                    STQ     10,,PR1

     1340     5363    2            GOTO OPER;

   5363  2 005656   006276 710000 2                  TRA     OPER

     1341     5364    2            END;
     1342     5365    2      IF FM$CFU.AFIT=0 THEN DO;

   5365  2 005657   200007 470500                    LDP0    CFU$,,AUTO
         2 005660   000000 236100                    LDQ     0,,PR0
         2 005661   001000 316003                    CANQ    512,DU
         2 005662   005702 601000 2                  TNZ     s:5376

     1343     5366    2         FM$CFU.FITSDA=FM$CFUEXT.XTNT.XTNSDA(0);

   5366  2 005663   200010 471500                    LDP1    ACCT$,,AUTO
         2 005664   100001 236100                    LDQ     1,,PR1
         2 005665   000000 552134                    STBQ    0,'34'O,PR0

     1344     5367    3         IF F$DCB.ACS~=%BLOCK# THEN DO;

   5367  2 005666   200004 470500                    LDP0    JDCB$,,AUTO
         2 005667   000036 236100                    LDQ     30,,PR0
         2 005670   000777 376007                    ANQ     511,DL
         2 005671   000003 116007                    CMPQ    3,DL
         2 005672   005702 600000 2                  TZE     s:5376
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:214  

     1345     5368                    /*
     1346     5369                    *  DIVIDE INITIAL EXTENT INTO UGRANS AND NGAVAL FOR NON-RANDOM
     1347     5370                    *  FILES.
     1348     5371                    */
     1349     5372    3            FM$CFU.UGRANS=1;

   5372  2 005673   200007 471500                    LDP1    CFU$,,AUTO
         2 005674   000001 236007                    LDQ     1,DL
         2 005675   100004 552134                    STBQ    4,'34'O,PR1

     1350     5373    3            FM$CFU.NGAVAL=FM$CFU.NGAVAL-1;

   5373  2 005676   200007 470500                    LDP0    CFU$,,AUTO
         2 005677   000007 236100                    LDQ     7,,PR0
         2 005700   000032 036000 xsym               ADLQ    B_VECTNIL+26
         2 005701   000007 552134                    STBQ    7,'34'O,PR0

     1351     5374    3            END;

     1352     5375    2         END;

     1353     5376    1      FM$CFU.NRECS=0;

   5376  2 005702   200007 470500                    LDP0    CFU$,,AUTO
         2 005703   000001 450100                    STZ     1,,PR0

     1354     5377    1      IF F$DCB.IORG=%RELATIVE# THEN FM$CFU.NRECS=F$DCB.NRECS;

   5377  2 005704   200004 470500                    LDP0    JDCB$,,AUTO
         2 005705   000070 236100                    LDQ     56,,PR0
         2 005706   077000 376003                    ANQ     32256,DU
         2 005707   005000 116003                    CMPQ    2560,DU
         2 005710   005714 601000 2                  TNZ     s:5378

   5377  2 005711   200007 471500                    LDP1    CFU$,,AUTO
         2 005712   000042 235100                    LDA     34,,PR0
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:215  
         2 005713   100001 755100                    STA     1,,PR1

     1355     5378    1      FM$CFU.RCSZ=0;

   5378  2 005714   200007 470500                    LDP0    CFU$,,AUTO
         2 005715   000000 236003                    LDQ     0,DU
         2 005716   000004 552140                    STBQ    4,'40'O,PR0

     1356     5379    1      FM$CFU.LDA=FM_FRZERO;

   5379  2 005717   200007 470500                    LDP0    CFU$,,AUTO
         2 005720   000100 101400                    MRL     fill='000'O
         2 005721   000000 000004 xsym               ADSC9   FM_FRZERO                cn=0,n=4
         2 005722   000006 400003                    ADSC9   6,,PR0                   cn=2,n=3

     1357     5380    1      FM$CFU.GDA=0;

   5380  2 005723   200007 470500                    LDP0    CFU$,,AUTO
         2 005724   000005 552134                    STBQ    5,'34'O,PR0

     1358     5381    1      IF F$DCB.DISP=%SCRATCH# THEN GOTO WRAPUP;

   5381  2 005725   200004 470500                    LDP0    JDCB$,,AUTO
         2 005726   000032 236100                    LDQ     26,,PR0
         2 005727   000777 376007                    ANQ     511,DL
         2 005730   000001 116007                    CMPQ    1,DL
         2 005731   004367 600000 2                  TZE     WRAPUP

     1359     5382    1      IF F$DCB.FEXTX~=0 THEN B$JIT.FEXT(F$DCB.FEXTX)='1'B;

   5382  2 005732   000034 236100                    LDQ     28,,PR0
         2 005733   777000 316007                    CANQ    -512,DL
         2 005734   005744 600000 2                  TZE     s:5386

   5382  2 005735   000034 236100                    LDQ     28,,PR0
         2 005736   000011 772000                    QRL     9
         2 005737   000777 376007                    ANQ     511,DL
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:216  
         2 005740   000000 471400 xsym               LDP1    B$JIT$
         2 005741   003106 060400                    CSL     bolr='003'O
         2 005742   000030 000001 xsym               BDSC    B_VECTNIL+24             by=0,bit=0,n=1
         2 005743   100220 000001                    BDSC    144,Q,PR1                by=0,bit=0,n=1

     1360     5383                    /*
     1361     5384                    *  NOW CHECK FOR CTG AT OPEN TIME
     1362     5385                    */
     1363     5386    2      IF NOT F$DCB.CTG AND F$DCB.ACS~=%JRNL# THEN DO;

   5386  2 005744   200004 470500                    LDP0    JDCB$,,AUTO
         2 005745   000031 236100                    LDQ     25,,PR0
         2 005746   004000 316007                    CANQ    2048,DL
         2 005747   005762 601000 2                  TNZ     s:5390
         2 005750   000036 236100                    LDQ     30,,PR0
         2 005751   000777 376007                    ANQ     511,DL
         2 005752   000004 116007                    CMPQ    4,DL
         2 005753   005762 600000 2                  TZE     s:5390

     1364     5387    2         FM$CFU.FUN=%CREATE#;

   5387  2 005754   200007 471500                    LDP1    CFU$,,AUTO
         2 005755   100000 236100                    LDQ     0,,PR1
         2 005756   000003 376000 3                  ANQ     3
         2 005757   300000 276003                    ORQ     98304,DU
         2 005760   100000 756100                    STQ     0,,PR1

     1365     5388    2         GOTO WRAPUP;

   5388  2 005761   004367 710000 2                  TRA     WRAPUP

     1366     5389    2         END;
     1367     5390    1      CALL ENQFIT ALTRET(OPER);

   5390  2 005762   004751 701000 2                  TSX1    ENQFIT
         2 005763   006276 702000 2                  TSX2    OPER

PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:217  
     1368     5391    1      IF F$DCB.ACS~=%BLOCK# THEN FM$CFU.SHARE=F$DCB.SHARE;

   5391  2 005764   200004 470500                    LDP0    JDCB$,,AUTO
         2 005765   000036 236100                    LDQ     30,,PR0
         2 005766   000777 376007                    ANQ     511,DL
         2 005767   000003 116007                    CMPQ    3,DL
         2 005770   005777 600000 2                  TZE     s:5392

   5391  2 005771   200007 471500                    LDP1    CFU$,,AUTO
         2 005772   000031 236100                    LDQ     25,,PR0
         2 005773   000030 736000                    QLS     24
         2 005774   100000 676100                    ERQ     0,,PR1
         2 005775   060000 376003                    ANQ     24576,DU
         2 005776   100000 656100                    ERSQ    0,,PR1

     1369     5392    1      CALL FMD$WRTSV(1);

   5392  2 005777   000010 630400 3                  EPPR0   8
         2 006000   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 006001   000000 701000 xent               TSX1    FMD$WRTSV
         2 006002   000000 011000                    NOP     0

     1370     5393    1      IF FM$CFU.UGRANS=0 AND FM$CFU.NGAVAL=0 THEN FM$CFU.FUN=%UPDATE#;

   5393  2 006003   200007 470500                    LDP0    CFU$,,AUTO
         2 006004   000004 236100                    LDQ     4,,PR0
         2 006005   000032 316000 xsym               CANQ    B_VECTNIL+26
         2 006006   006017 601000 2                  TNZ     s:5395
         2 006007   000007 236100                    LDQ     7,,PR0
         2 006010   000032 316000 xsym               CANQ    B_VECTNIL+26
         2 006011   006017 601000 2                  TNZ     s:5395

   5393  2 006012   000000 236100                    LDQ     0,,PR0
         2 006013   000003 376000 3                  ANQ     3
         2 006014   100000 276003                    ORQ     32768,DU
         2 006015   000000 756100                    STQ     0,,PR0
         2 006016   006027 710000 2                  TRA     s:5397
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:218  

     1371     5394                    /* NO FILE, SHARED DATA SEGMENT */
     1372     5395    1      ELSE IF F$DCB.ASN~=%CG# /* COMGROUP INIT MIGHT ALTRET, SO DEFER CTG */

   5395  2 006017   200004 471500                    LDP1    JDCB$,,AUTO
         2 006020   100032 236100                    LDQ     26,,PR1
         2 006021   777000 376007                    ANQ     -512,DL
         2 006022   013000 116007                    CMPQ    5632,DL
         2 006023   006027 600000 2                  TZE     s:5397

     1373     5396    1         THEN CALL FMP$UPFDDESC ALTRET(OPER); /* FMQ$CTG, BUT KEEP BFR(1) */

   5396  2 006024   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 006025   000000 701000 xent               TSX1    FMP$UPFDDESC
         2 006026   006276 702000 2                  TSX2    OPER

     1374     5397    1      IF F$DCB.GHSTACS~=0 THEN CALL GHSTACS ALTRET(OPER);

   5397  2 006027   200004 470500                    LDP0    JDCB$,,AUTO
         2 006030   000052 236100                    LDQ     42,,PR0
         2 006031   000017 316003                    CANQ    15,DU
         2 006032   006035 600000 2                  TZE     s:5398

   5397  2 006033   005042 701000 2                  TSX1    GHSTACS
         2 006034   006276 702000 2                  TSX2    OPER

     1375     5398    1      IF F$DCB.ACS~=%JRNL# THEN GOTO WRAPUP;

   5398  2 006035   200004 470500                    LDP0    JDCB$,,AUTO
         2 006036   000036 236100                    LDQ     30,,PR0
         2 006037   000777 376007                    ANQ     511,DL
         2 006040   000004 116007                    CMPQ    4,DL
         2 006041   004367 601000 2                  TNZ     WRAPUP

     1376     5399    1      FIT$=PINCRW(BUF$,SIZEW(FM$GRAN));

   5399  2 006042   200014 236100                    LDQ     BUF$,,AUTO
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:219  
         2 006043   000005 036003                    ADLQ    5,DU
         2 006044   200017 756100                    STQ     FIT$,,AUTO

     1377     5400    1      GOTO JRNLXIT;

   5400  2 006045   003227 710000 2                  TRA     JRNLXIT

   5399  2 006046                       FMNE$UNIMP   null
     1378     5401        %EJECT;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:220  
     1379     5402                    /*
     1380     5403                    *  ALL ERRORS ARE PROCESSED HERE
     1381     5404                    *
     1382     5405                    *  RETURN ANY OUTSTANDING BUFFERS, GIVE BACK ANY CFU SPACE
     1383     5406                    *  ACQUIRED, AND REPORT THE ERROR TO THE USER.  BY THIS TIME
     1384     5407                    *  THE ERROR CODE HAS BEEN PLACED IN B$JIT.ERR.
     1385     5408                    */
     1386     5409    1   FMNE$UNIMP:;
     1387     5410    1      B$JIT$->B$JIT.ERR=FMN$E$UNIMP;

   5410  2 006046   000022 236000 0                  LDQ     FMN$E$UNIMP
         2 006047   000000 471400 xsym               LDP1    B$JIT$
         2 006050   100012 756100                    STQ     10,,PR1

     1388     5411    1      GOTO OPER;

   5411  2 006051   006276 710000 2                  TRA     OPER

   5410  2 006052                       FMNE$FDEOF   null
     1389     5412    1   FMNE$FDEOF:;
     1390     5413    1      IF B$JIT.ERR.CODE=%E$EOF

   5413  2 006052   000000 470400 xsym               LDP0    B$JIT$
         2 006053   000012 236100                    LDQ     10,,PR0
         2 006054   377770 376007                    ANQ     131064,DL
         2 006055   000060 116007                    CMPQ    48,DL
         2 006056   006061 600000 2                  TZE     FMNE$FDEOFA
         2 006057   000040 116007                    CMPQ    32,DL
         2 006060   006072 601000 2                  TNZ     OPERFD

     1391     5414    2        OR B$JIT.ERR.CODE=%E$BOF THEN DO;

     1392     5415    2   FMNE$FDEOFA:
     1393     5416    2         IF F$DCB.STARF THEN CALL CHKLAST ALTRET(NXTF0);

   5416  2 006061   200004 470500       FMNE$FDEOFA  LDP0    JDCB$,,AUTO
         2 006062   000064 236100                    LDQ     52,,PR0
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:221  
         2 006063   200000 316003                    CANQ    65536,DU
         2 006064   006067 600000 2                  TZE     s:5417

   5416  2 006065   000746 701000 2                  TSX1    CHKLAST
         2 006066   000677 702000 2                  TSX2    NXTF0

     1394     5417    2         B$JIT.ERR=FMN$E$NOFILE; /* CHANGED TO FDEOF AT OPER */

   5417  2 006067   000023 236000 0                  LDQ     FMN$E$NOFILE
         2 006070   000000 470400 xsym               LDP0    B$JIT$
         2 006071   000012 756100                    STQ     10,,PR0

     1395     5418    2         END;

   5413  2 006072                       OPERFD       null
     1396     5419    1   OPERFD:;
     1397     5420    1      CALL FMD$FLSHBUF(1);

   5420  2 006072   000010 630400 3                  EPPR0   8
         2 006073   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 006074   000000 701000 xent               TSX1    FMD$FLSHBUF
         2 006075   000000 011000                    NOP     0

     1398     5421    1      IF NOT F$DCB.STARF THEN CALL UQB$MDEQ(ACCT$);

   5421  2 006076   200004 470500                    LDP0    JDCB$,,AUTO
         2 006077   000064 236100                    LDQ     52,,PR0
         2 006100   200000 316003                    CANQ    65536,DU
         2 006101   006110 601000 2                  TNZ     s:5422

   5421  2 006102   200010 631500                    EPPR1   ACCT$,,AUTO
         2 006103   200032 451500                    STP1    T$+4,,AUTO
         2 006104   200032 630500                    EPPR0   T$+4,,AUTO
         2 006105   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 006106   000000 701000 xent               TSX1    UQB$MDEQ
         2 006107   000000 011000                    NOP     0

PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:222  
     1399     5422    1      GOTO OPER;

   5422  2 006110   006276 710000 2                  TRA     OPER

   5421  2 006111                       FMNE$FILEBU* null
     1400     5423    1   FMNE$FILEBUSY:;
     1401     5424                    /*E*     ERROR:  FMN-E$FILEBUSY-E
     1402     5425                    *        MESSAGE: File %FN is busy.
     1403     5426                    */
     1404     5427    1      CALL FMR$U8;

   5427  2 006111   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 006112   000000 701000 xent               TSX1    FMR$U8
         2 006113   000000 011000                    NOP     0

     1405     5428    1      B$JIT$->B$JIT.ERR=FMN$E$FILEBUSY;

   5428  2 006114   000025 236000 0                  LDQ     FMN$E$FILEBUSY
         2 006115   000000 470400 xsym               LDP0    B$JIT$
         2 006116   000012 756100                    STQ     10,,PR0

     1406     5429    1      GOTO OPER;

   5429  2 006117   006276 710000 2                  TRA     OPER

   5428  2 006120                       FMNE$NEWFILE null
     1407     5430    1   FMNE$NEWFILE:;
     1408     5431    1      B$JIT.ERR=FMN$E$NEWFILE;

   5431  2 006120   000034 236000 0                  LDQ     FMN$E$NEWFILE
         2 006121   000000 471400 xsym               LDP1    B$JIT$
         2 006122   100012 756100                    STQ     10,,PR1

     1409     5432    1      GOTO OPER;

   5432  2 006123   006276 710000 2                  TRA     OPER

PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:223  
     1410     5433    1   FMNE$NOCFUSA:
     1411     5434    1      CALL FMR$U8;

   5434  2 006124   000002 631400 xsym  FMNE$NOCFUSA EPPR1   B_VECTNIL+2
         2 006125   000000 701000 xent               TSX1    FMR$U8
         2 006126   000000 011000                    NOP     0

   5431  2 006127                       FMNE$NOCFUS  null
     1412     5435    1   FMNE$NOCFUS:;
     1413     5436    1      B$JIT$->B$JIT.ERR=FMN$E$NOCFUS;

   5436  2 006127   000027 236000 0                  LDQ     FMN$E$NOCFUS
         2 006130   000000 470400 xsym               LDP0    B$JIT$
         2 006131   000012 756100                    STQ     10,,PR0

     1414     5437    1      GOTO OPER;

   5437  2 006132   006276 710000 2                  TRA     OPER

   5436  2 006133                       FMNE$NOFILE  null
     1415     5438    1   FMNE$NOFILE:;
     1416     5439    1      B$JIT$->B$JIT.ERR=FMN$E$NOFILE;

   5439  2 006133   000023 236000 0                  LDQ     FMN$E$NOFILE
         2 006134   000000 470400 xsym               LDP0    B$JIT$
         2 006135   000012 756100                    STQ     10,,PR0

     1417     5440    1      GOTO OPER;

   5440  2 006136   006276 710000 2                  TRA     OPER

   5439  2 006137                       FMNE$ADEOF   null
     1418     5441    1   FMNE$ADEOF:;
     1419     5442    1      IF B$JIT.ERR.CODE=%E$EOF

   5442  2 006137   000000 470400 xsym               LDP0    B$JIT$
         2 006140   000012 236100                    LDQ     10,,PR0
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:224  
         2 006141   377770 376007                    ANQ     131064,DL
         2 006142   000060 116007                    CMPQ    48,DL
         2 006143   006146 600000 2                  TZE     s:5444
         2 006144   000040 116007                    CMPQ    32,DL
         2 006145   006154 601000 2                  TNZ     OPERAD

     1420     5443    2        OR B$JIT.ERR.CODE=%E$BOF THEN DO;

     1421     5444    2         B$JIT.ERR=FMN$E$ADEOF;

   5444  2 006146   000030 236000 0                  LDQ     FMN$E$ADEOF
         2 006147   000012 756100                    STQ     10,,PR0

     1422     5445    2         F$DCB.ACCT=' ';

   5445  2 006150   000035 235000 xsym               LDA     B_VECTNIL+29
         2 006151   000035 236000 xsym               LDQ     B_VECTNIL+29
         2 006152   200004 471500                    LDP1    JDCB$,,AUTO
         2 006153   100020 757100                    STAQ    16,,PR1

     1423     5446    2         END;

   5442  2 006154                       OPERAD       null
     1424     5447    1   OPERAD:;
     1425     5448    1      CALL FMD$FLSHBUF(1);

   5448  2 006154   000010 630400 3                  EPPR0   8
         2 006155   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 006156   000000 701000 xent               TSX1    FMD$FLSHBUF
         2 006157   000000 011000                    NOP     0

     1426     5449    1      CALL UQB$MDEQ(PAD$);

   5449  2 006160   200005 630500                    EPPR0   PAD$,,AUTO
         2 006161   200032 450500                    STP0    T$+4,,AUTO
         2 006162   200032 630500                    EPPR0   T$+4,,AUTO
         2 006163   000017 631400 xsym               EPPR1   B_VECTNIL+15
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:225  
         2 006164   000000 701000 xent               TSX1    UQB$MDEQ
         2 006165   000000 011000                    NOP     0

     1427     5450    1      GOTO OPER;

   5450  2 006166   006276 710000 2                  TRA     OPER

     1428     5451    1   OPERNPSN: F$DCB.PSN=' ';

   5451  2 006167   200004 470500       OPERNPSN     LDP0    JDCB$,,AUTO
         2 006170   040100 100400                    MLR     fill='040'O
         2 006171   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 006172   000024 000006                    ADSC9   20,,PR0                  cn=0,n=6

     1429     5452    1      GOTO OPER;

   5452  2 006173   006276 710000 2                  TRA     OPER

     1430     5453    1   FMNE$BADJRNL: B$JIT.ERR=FMN$E$BADJRNL;

   5453  2 006174   000042 236000 0     FMNE$BADJRNL LDQ     FMN$E$BADJRNL
         2 006175   300012 756100                    STQ     10,,PR3

     1431     5454    1      GOTO OPER;

   5454  2 006176   006276 710000 2                  TRA     OPER

     1432     5455    1   FMNE$NOACCESS: B$JIT.ERR=FMN$E$NOACCESS;

   5455  2 006177   000031 236000 0     FMNE$NOACCE* LDQ     FMN$E$NOACCESS
         2 006200   000000 473400 xsym               LDP3    B$JIT$
         2 006201   300012 756100                    STQ     10,,PR3

     1433     5456    1      GOTO OPER;

   5456  2 006202   006276 710000 2                  TRA     OPER

PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:226  
     1434     5457    1   FMNE$STOWEDFILE: B$JIT.ERR=FMN$E$STOWEDFILE;

   5457  2 006203   000040 236000 0     FMNE$STOWED* LDQ     FMN$E$STOWEDFILE
         2 006204   000000 473400 xsym               LDP3    B$JIT$
         2 006205   300012 756100                    STQ     10,,PR3

     1435     5458    1      GOTO OPER;

   5458  2 006206   006276 710000 2                  TRA     OPER

     1436     5459    1   FMNE$CGFILE: B$JIT.ERR=FMNE$E$CGFILE;

   5459  2 006207   000037 236000 0     FMNE$CGFILE  LDQ     FMNE$E$CGFILE
         2 006210   100012 756100                    STQ     10,,PR1

     1437     5460    1      GOTO OPER;

   5460  2 006211   006276 710000 2                  TRA     OPER

     1438     5461    1   FMNE$NOTAUTH: B$JIT.ERR=FMN$E$NOTAUTH;

   5461  2 006212   000036 236000 0     FMNE$NOTAUTH LDQ     FMN$E$NOTAUTH
         2 006213   100012 756100                    STQ     10,,PR1

     1439     5462    1      GOTO OPER;

   5462  2 006214   006276 710000 2                  TRA     OPER

     1440     5463    1   FMNE$JRNLERR:
     1441     5464    1      B$JIT.ERR=FMN$E$JRNLERR;

   5464  2 006215   000032 236000 0     FMNE$JRNLERR LDQ     FMN$E$JRNLERR
         2 006216   000000 470400 xsym               LDP0    B$JIT$
         2 006217   000012 756100                    STQ     10,,PR0

     1442     5465    1      GOTO OPER;

PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:227  
   5465  2 006220   006276 710000 2                  TRA     OPER

   5460  2 006221                       OPERX        null
     1443     5466    1   OPERX:;
     1444     5467    1      IF F$DCB.BFR1.CX(1)>0

   5467  2 006221   200004 470500                    LDP0    JDCB$,,AUTO
         2 006222   000123 720100                    LXL0    83,,PR0
         2 006223   006237 600000 2                  TZE     s:5470

     1445     5468    1      THEN IF FMC$CACHETBL.USECNT(F$DCB.BFR1.CX(1))=1

   5468  2 006224   000123 236100                    LDQ     83,,PR0
         2 006225   777777 376007                    ANQ     -1,DL
         2 006226   000006 402007                    MPY     6,DL
         2 006227   000000 471400 xsym               LDP1    FMC_CACHE$
         2 006230   100002 721106                    LXL1    2,QL,PR1
         2 006231   000001 101003                    CMPX1   1,DU
         2 006232   006237 601000 2                  TNZ     s:5470

     1446     5469    1         THEN CALL FMD$RELBUF(1);

   5469  2 006233   000010 630400 3                  EPPR0   8
         2 006234   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 006235   000000 701000 xent               TSX1    FMD$RELBUF
         2 006236   000000 011000                    NOP     0

     1447     5470    1      B$JIT$->B$JIT.ERR='0'B; /* NO ERRORS, BUT DCB IS CLOSED */

   5470  2 006237   000000 470400 xsym               LDP0    B$JIT$
         2 006240   000012 450100                    STZ     10,,PR0

     1448     5471    1      GOTO OPER1;

   5471  2 006241   006333 710000 2                  TRA     OPER1

   5470  2 006242                       BADFIT       null
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:228  
     1449     5472                    /**/
     1450     5473    1   BADFIT:;
     1451     5474    1      IF B$JIT.ERR='0'B THEN GOTO FIRSTOPN; /* FASTPATH ERR, TRY SLOW ONE */

   5474  2 006242   000000 470400 xsym               LDP0    B$JIT$
         2 006243   000012 235100                    LDA     10,,PR0
         2 006244   001151 600000 2                  TZE     FIRSTOPN

     1452     5475    1      IF ERRCODE THEN B$JIT.ERR=ERRCODE;

   5475  2 006245   200020 236100                    LDQ     ERRCODE,,AUTO
         2 006246   006251 600000 2                  TZE     s:5476

   5475  2 006247   000012 756100                    STQ     10,,PR0
         2 006250   006276 710000 2                  TRA     OPER

     1453     5476    1      ELSE IF NOT F$DCB.FEXT AND F$DCB.EXIST=%NEWFILE#

   5476  2 006251   200004 471500                    LDP1    JDCB$,,AUTO
         2 006252   100064 234100                    SZN     52,,PR1
         2 006253   006264 604000 2                  TMI     s:5478
         2 006254   100031 236100                    LDQ     25,,PR1
         2 006255   003000 376007                    ANQ     1536,DL
         2 006256   003000 116007                    CMPQ    1536,DL
         2 006257   006264 601000 2                  TNZ     s:5478
         2 006260   100032 236100                    LDQ     26,,PR1
         2 006261   000777 376003                    ANQ     511,DU
         2 006262   000003 116003                    CMPQ    3,DU
         2 006263   005325 600000 2                  TZE     BNEWFILE

     1454     5477    1           AND F$DCB.FUN=%CREATE# THEN GOTO BNEWFILE; /*WRITE OVER*/
     1455     5478    2         ELSE IF FPT$OPEN_V.DELETE THEN DO;

   5478  2 006264   200003 473500                    LDP3    @PN$,,AUTO
         2 006265   300000 474500                    LDP4    0,,PR3
         2 006266   400000 236100                    LDQ     0,,PR4
         2 006267   040000 316007                    CANQ    16384,DL
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:229  
         2 006270   006276 600000 2                  TZE     OPER

     1456     5479    2               B$JIT.ERR='0'B;

   5479  2 006271   000012 450100                    STZ     10,,PR0

     1457     5480    2               CALL FMP$CLSREL;

   5480  2 006272   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 006273   000000 701000 xent               TSX1    FMP$CLSREL
         2 006274   000000 011000                    NOP     0

     1458     5481    2               RETURN;

   5481  2 006275   000000 702200 xent               TSX2  ! X66_ARET

     1459     5482    2               END;
     1460     5483    1   OPER:;

   5483  2 006276                       OPER         null
     1461     5484    1      IF B$JIT.ERR.FCG~='0615'O OR B$JIT.ERR.MID<'16'O

   5484  2 006276   000000 470400 xsym               LDP0    B$JIT$
         2 006277   000012 236100                    LDQ     10,,PR0
         2 006300   777700 376003                    ANQ     -64,DU
         2 006301   061500 116003                    CMPQ    25408,DU
         2 006302   006307 601000 2                  TNZ     s:5485
         2 006303   000012 236100                    LDQ     10,,PR0
         2 006304   000077 376003                    ANQ     63,DU
         2 006305   000016 116003                    CMPQ    14,DU
         2 006306   006313 603000 2                  TRC     s:5486

     1462     5485    1      THEN B$JIT.ERR=FMN$E$NOCODE|B$JIT.ERR&FMN$E$CODE;

   5485  2 006307   000012 236100                    LDQ     10,,PR0
         2 006310   000044 376000 0                  ANQ     FMN$E$CODE
         2 006311   000045 276000 0                  ORQ     FMN$E$NOCODE
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:230  
         2 006312   000012 756100                    STQ     10,,PR0

     1463     5486    1      IF FPT$OPEN_V.OPER.NXTF AND B$JIT.ERR=FMN$E$NOFILE

   5486  2 006313   200003 471500                    LDP1    @PN$,,AUTO
         2 006314   100000 473500                    LDP3    0,,PR1
         2 006315   300000 236100                    LDQ     0,,PR3
         2 006316   004000 316007                    CANQ    2048,DL
         2 006317   006333 600000 2                  TZE     OPER1
         2 006320   000012 236100                    LDQ     10,,PR0
         2 006321   000023 116000 0                  CMPQ    FMN$E$NOFILE
         2 006322   006333 601000 2                  TNZ     OPER1

     1464     5487    2      THEN DO;

     1465     5488    2         B$JIT.ERR=FMN$E$FDEOF;

   5488  2 006323   000024 236000 0                  LDQ     FMN$E$FDEOF
         2 006324   000012 756100                    STQ     10,,PR0

     1466     5489    2         F$DCB.NAME.L=0;

   5489  2 006325   200004 473500                    LDP3    JDCB$,,AUTO
         2 006326   000000 236003                    LDQ     0,DU
         2 006327   300010 552140                    STBQ    8,'40'O,PR3

     1467     5490    2         F$DCB.NAME.C=' ';

   5490  2 006330   040100 100400                    MLR     fill='040'O
         2 006331   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 006332   300010 200037                    ADSC9   8,,PR3                   cn=1,n=31

     1468     5491    2         END;

   5486  2 006333                       OPER1        null
     1469     5492    1   OPER1:;
     1470     5493    1      IF JDCB$->F$DCB.CFU$=ADDR(NIL) THEN GOTO OPER2;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:231  

   5493  2 006333   200004 470500                    LDP0    JDCB$,,AUTO
         2 006334   000066 236100                    LDQ     54,,PR0
         2 006335   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 006336   006450 600000 2                  TZE     OPER2

     1471     5494    1      CFU$=JDCB$->F$DCB.CFU$;

   5494  2 006337   200007 756100                    STQ     CFU$,,AUTO

     1472     5495    1      IF FM$CFU.NAMEX=0 AND FM$CFU.XTX=0 THEN FM$CFU.FITSDA=0;

   5495  2 006340   200007 471500                    LDP1    CFU$,,AUTO
         2 006341   100002 720100                    LXL0    2,,PR1
         2 006342   006347 601000 2                  TNZ     s:5496
         2 006343   100003 221100                    LDX1    3,,PR1
         2 006344   006347 601000 2                  TNZ     s:5496

   5495  2 006345   000000 236003                    LDQ     0,DU
         2 006346   100000 552134                    STBQ    0,'34'O,PR1

     1473     5496    1      IF FM$CFU.FUN>4 THEN FM$CFU.FUN=FM$CFU.FUN-4;

   5496  2 006347   200007 470500                    LDP0    CFU$,,AUTO
         2 006350   000000 236100                    LDQ     0,,PR0
         2 006351   700000 376003                    ANQ     -32768,DU
         2 006352   500000 116003                    CMPQ    -98304,DU
         2 006353   006363 602000 2                  TNC     s:5497

   5496  2 006354   000000 236100                    LDQ     0,,PR0
         2 006355   000041 772000                    QRL     33
         2 006356   000004 136007                    SBLQ    4,DL
         2 006357   000041 736000                    QLS     33
         2 006360   000000 676100                    ERQ     0,,PR0
         2 006361   700000 376003                    ANQ     -32768,DU
         2 006362   000000 656100                    ERSQ    0,,PR0

PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:232  
     1474     5497    1      I=BITBIN(B$JIT.ERR);

   5497  2 006363   000000 470400 xsym               LDP0    B$JIT$
         2 006364   000012 235100                    LDA     10,,PR0
         2 006365   200015 755100                    STA     I,,AUTO

     1475     5498    1      CALL FMP$CLSERR;

   5498  2 006366   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 006367   000000 701000 xent               TSX1    FMP$CLSERR
         2 006370   000000 011000                    NOP     0

     1476     5499    1      B$JIT.ERR=BINBIT(I,36);

   5499  2 006371   200015 236100                    LDQ     I,,AUTO
         2 006372   000000 470400 xsym               LDP0    B$JIT$
         2 006373   000012 756100                    STQ     10,,PR0

     1477     5500    1      IF ES_LOGFILEDENY=%PC_ES_YES# AND S_CUN>%JG_MING# AND NOT F$DCB.LOGSEC

   5500  2 006374   000000 235000 xsym               LDA     ES_LOGFILEDENY
         2 006375   000001 115007                    CMPA    1,DL
         2 006376   006450 601000 2                  TNZ     OPER2
         2 006377   000000 235000 xsym               LDA     S_CUN
         2 006400   000020 115007                    CMPA    16,DL
         2 006401   006450 602000 2                  TNC     OPER2
         2 006402   200004 471500                    LDP1    JDCB$,,AUTO
         2 006403   100102 234100                    SZN     66,,PR1
         2 006404   006450 604000 2                  TMI     OPER2

     1478     5501    2      THEN DO SELECT B$JIT.ERR.CODE;

   5501  2 006405   000012 236100                    LDQ     10,,PR0
         2 006406   000003 772000                    QRL     3
         2 006407   037777 376007                    ANQ     16383,DL
         2 006410   000173 116007                    CMPQ    123,DL
         2 006411   006427 602000 2                  TNC     s:5501+18
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:233  
         2 006412   006434 600000 2                  TZE     s:5503
         2 006413   000260 116007                    CMPQ    176,DL
         2 006414   006422 602000 2                  TNC     s:5501+13
         2 006415   006434 600000 2                  TZE     s:5503
         2 006416   000003 736000                    QLS     3
         2 006417   006250 116007                    CMPQ    3240,DL
         2 006420   006450 601000 2                  TNZ     OPER2
         2 006421   006434 710000 2                  TRA     s:5503
         2 006422   000012 236100                    LDQ     10,,PR0
         2 006423   377770 376007                    ANQ     131064,DL
         2 006424   002330 116007                    CMPQ    1240,DL
         2 006425   006450 601000 2                  TNZ     OPER2
         2 006426   006434 710000 2                  TRA     s:5503
         2 006427   000012 236100                    LDQ     10,,PR0
         2 006430   377770 376007                    ANQ     131064,DL
         2 006431   001640 116007                    CMPQ    928,DL
         2 006432   006450 601000 2                  TNZ     OPER2
         2 006433   006434 710000 2                  TRA     s:5503

     1479     5502    2         SELECT %E$NOACCESS,%E$NOTAUTH,%E$NEWFILE,%E$CLSREL,%E$CREATONLY;

     1480     5503    2         CALL ELA$SYSLOG (EL_FILE_ACCESS, DENY, SIZEW(DENY),0,EL_SEC,I);

   5503  2 006434   200015 633500                    EPPR3   I,,AUTO
         2 006435   200037 453500                    STP3    T$+9,,AUTO
         2 006436   000034 236000 3                  LDQ     28
         2 006437   200036 756100                    STQ     T$+8,,AUTO
         2 006440   000036 237000 3                  LDAQ    30
         2 006441   200034 757100                    STAQ    T$+6,,AUTO
         2 006442   000044 237000 3                  LDAQ    36
         2 006443   200032 757100                    STAQ    T$+4,,AUTO
         2 006444   200032 630500                    EPPR0   T$+4,,AUTO
         2 006445   000024 631400 xsym               EPPR1   B_VECTNIL+20
         2 006446   000000 701000 xent               TSX1    ELA$SYSLOG
         2 006447   000000 011000                    NOP     0

     1481     5504    2         END;
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:234  

   5504  2 006450                       OPER2        null
     1482     5505    1   OPER2:;
     1483     5506    2      DO I=0 TO 4;

   5506  2 006450   200015 450100                    STZ     I,,AUTO

     1484     5507    2         CALL FMD$RELBUF(I);

   5507  2 006451   200015 630500                    EPPR0   I,,AUTO
         2 006452   200032 450500                    STP0    T$+4,,AUTO
         2 006453   200032 630500                    EPPR0   T$+4,,AUTO
         2 006454   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 006455   000000 701000 xent               TSX1    FMD$RELBUF
         2 006456   000000 011000                    NOP     0

     1485     5508    2         END;

   5508  2 006457   200015 054100                    AOS     I,,AUTO
         2 006460   200015 235100                    LDA     I,,AUTO
         2 006461   000004 115007                    CMPA    4,DL
         2 006462   006451 604400 2                  TMOZ    s:5507

     1486     5509    1      RETURN;

   5509  2 006463   000000 702200 xent               TSX2  ! X66_ARET

GRANT
 Sect OctLoc
   0     000   002400 000000                                                    ....

DENY
 Sect OctLoc
   0     001   001000 000000                                                    ....

ORGS
 Sect OctLoc
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:235  
   0     002   400000 001***   401001 001***   402002 002***   003003 003***    ................
   0     006   404001 004***   005004 005***   002000 006***   003000 007***    ................
   0     012   000000 001***   004000 011***   000000 001***   003000 013***    ................
   0     016   000000 001***   002000 015***   000000 001***   000000 001***    ................

FMN$E$UNIMP
 Sect OctLoc
   0     022   061516 003072                                                    1..:

FMN$E$NOFILE
 Sect OctLoc
   0     023   061516 001612                                                    1...

FMN$E$FDEOF
 Sect OctLoc
   0     024   061516 001542                                                    1...

FMN$E$FILEBUSY
 Sect OctLoc
   0     025   061516 001552                                                    1...

FMN$E$CREATERR
 Sect OctLoc
   0     026   061516 001562                                                    1...

FMN$E$NOCFUS
 Sect OctLoc
   0     027   061516 001572                                                    1...

FMN$E$ADEOF
 Sect OctLoc
   0     030   061516 001752                                                    1...

FMN$E$NOACCESS
 Sect OctLoc
   0     031   061516 001642                                                    1...

PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:236  
FMN$E$JRNLERR
 Sect OctLoc
   0     032   061516 001712                                                    1...

FMN$E$SDSEXISTS
 Sect OctLoc
   0     033   061516 002622                                                    1...

FMN$E$NEWFILE
 Sect OctLoc
   0     034   061516 001732                                                    1...

FMN$E$NOKEY
 Sect OctLoc
   0     035   061516 001022                                                    1...

FMN$E$NOTAUTH
 Sect OctLoc
   0     036   061516 006252                                                    1...

FMNE$E$CGFILE
 Sect OctLoc
   0     037   061516 001772                                                    1...

FMN$E$STOWEDFILE
 Sect OctLoc
   0     040   061516 002022                                                    1...

(unnamed)
 Sect OctLoc
   0     041   061516 002032                                                    1...

FMN$E$BADJRNL
 Sect OctLoc
   0     042   061516 002302                                                    1...

FMN$E$CREATONLY
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:237  
 Sect OctLoc
   0     043   061516 002602                                                    1...

FMN$E$CODE
 Sect OctLoc
   0     044   000000 777770                                                    ....

FMN$E$NOCODE
 Sect OctLoc
   0     045   061516 000002                                                    1...

STOWCODE0
 Sect OctLoc
   0     046   020024 004000                                                    ....

STOWCODE1
 Sect OctLoc
   0     047   140014 006002                                                    `...

TESTOPN
 Sect OctLoc
   0     050   000000 020000                                                    ....

(unnamed)
 Sect OctLoc
   0     051   112101 131123   040040 040040   052137 040040   072123 105103    JAYS    *_  :SEC
   0     055   114117 107040                                                    LOG

FM_OPNS
 Sect OctLoc
   1     000   000000 000000   000000 000000                                    ........

(unnamed)
 Sect OctLoc
   3     000   000050 006000   000000 006000   777777 773777   077777 777777    .(..........?...
   3     004   000007 777770   777040 040040   040040 040040   040040 040040    .....
   3     010   000003 006000   001777 000000   777777 770777   000040 040040    .............
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:238  
   3     014   000000 000047   000014 006000   000000 000022   000016 006000    ...'............
   3     020   000377 777777   000007 770000   677777 777777   717777 777777    ................
   3     024   777777 737777   000000 006000   700777 777777   000002 006000    ................
   3     030   000006 006000   000012 006000   777777 777577   000000 000765    ................
   3     034   000005 006000   000000 000000   000003 006000   000002 006000    ................
   3     040   000033 006000   000000 006000   777777 777677   000000 000000    ................
   3     044   000033 006000   000001 006000                                    ........
     1487     5510    1   END FMN$OPNF;
     1488     5511        %EOD;

PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:239  
--  Include file information  --

   ES_SUBS_E.:E05TOU  is referenced.
   ES_TABLES_M.:E05TOU  is referenced.
   EL_SUBS_C.:E05TOU  is referenced.
   PC_SUBS_C.:E05TOU  is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
   F_FMTCODE_C.:E05TOU  is referenced.
   UD_ERRORS_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   KI$CP6V_C.:E05TOU  is referenced.
   F$CP6P_C.:E05TOU  is referenced.
   F$CP6V_C.:E05TOU  is referenced.
   F_FPTCODE_C.:E05TOU  is referenced.
   FM_FIELD_C.:E05TOU  is referenced.
   FM_CACHE_R.:E05TOU  cannot be made into a system file and is referenced.
   FM_CACHE_C.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
   F$DCB.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FMN$OPNF.
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:240  

 **** Variables and constants ****

  ****  Section 000 RoData FMN$OPNF

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     1-0-0/w STRC        r     1 DENY                      30-0-0/b STRC        r     1 FMN$E$ADEOF
    42-0-0/b STRC        r     1 FMN$E$BADJRNL             44-0-0/b STRC        r     1 FMN$E$CODE
    26-0-0/b STRC        r     1 FMN$E$CREATERR            43-0-0/b STRC        r     1 FMN$E$CREATONLY
    24-0-0/b STRC        r     1 FMN$E$FDEOF               25-0-0/b STRC        r     1 FMN$E$FILEBUSY
    32-0-0/b STRC        r     1 FMN$E$JRNLERR             34-0-0/b STRC        r     1 FMN$E$NEWFILE
    31-0-0/b STRC        r     1 FMN$E$NOACCESS            27-0-0/b STRC        r     1 FMN$E$NOCFUS
    45-0-0/b STRC        r     1 FMN$E$NOCODE              23-0-0/b STRC        r     1 FMN$E$NOFILE
    35-0-0/b STRC        r     1 FMN$E$NOKEY               36-0-0/b STRC        r     1 FMN$E$NOTAUTH
    33-0-0/b STRC        r     1 FMN$E$SDSEXISTS           40-0-0/b STRC        r     1 FMN$E$STOWEDFILE
    22-0-0/b STRC        r     1 FMN$E$UNIMP               37-0-0/b STRC        r     1 FMNE$E$CGFILE
     0-0-0/w STRC        r     1 GRANT                      2-0-0/w STRC(27)    r     1 ORGS(0:15)
    46-0-0/b STRC        r     1 STOWCODE0                 47-0-0/b STRC        r     1 STOWCODE1
    50-0-0/b BIT         r     1 TESTOPN

  ****  Section 001  Data  FMN$OPNF

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(72)    r     1 FM_OPNS

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @PN$                      10-0-0/w PTR         r     1 ACCT$
    11-0-0/w SBIN        r     1 ACCTX                     23-0-0/w PTR         r     1 ALTKEY$
    14-0-0/w PTR         r     1 BUF$                       7-0-0/w PTR         r     1 CFU$
    17-0-0/w EPTR        r     1 EFIT$                     20-0-0/b BIT         r     1 ERRCODE
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:241  
     6-0-0/w SBIN        r     1 FDA                       22-0-0/w PTR         r     1 FIELD$
    17-0-0/w PTR         r     1 FIT$                      15-0-0/w SBIN        r     1 I
    15-0-0/w STRC        r     1 IB                        25-0-0/w PTR         r     1 IRREC$
    15-0-0/w UBIN        r     1 IU                        16-0-0/w SBIN        r     1 J
     4-0-0/w PTR         r     1 JDCB$                     12-0-0/w PTR         r     1 KEY$
    21-0-0/w PTR         r     1 KFIELD$                    6-0-0/w STRC        r     1 NXTAR
     5-0-0/w PTR         r     1 PAD$                      *0-0-0/w STRC(684)   r     1 PN$
    13-0-0/w PTR         r     1 SEG$                      24-0-0/w PTR         r     1 START$
    26-0-0/w PTR         r     1 T$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$ROSEG$
     0-0-0/w UBIN        r     1 B_TICSDAY                  0-0-0/w SBIN        r     1 ES_LOGFILEDENY
     0-0-0/w SBIN        r     1 ES_LOGFILEGRANT            0-0-0/w UBIN        r     1 ES_PROTECTSECLOG
     0-0-0/w PTR         r     1 F$CFU$                     0-0-0/w PTR         r     1 FM$BUF$(0:31)
     0-0-0/w PTR         r     1 FM$SET$                    0-0-0/w PTR         r     1 FMC_CACHE$
     0-0-0/w PTR         r     1 FMC_CACHEPGCNT$            0-0-0/w UBIN        r     1 FM_DFLOPN_V
     0-0-0/w SBIN        r     1 FM_FRZERO                  0-0-0/w UBIN        r     1 FM_SRZERO
     0-0-0/c CHAR(12)    r     1 FM_STARCHARS               0-0-0/w UBIN        r     1 FM_SYSACCTX
     0-0-0/w UBIN        r     1 S_CUN                      0-0-0/w UBIN        r     1 ZERO

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/w STRC(576)   r     1 CODE01
     0-0-0/w STRC(135)   r     1 CODE02                     0-0-0/w STRC(324)   r     1 CODE03
     0-0-0/w STRC(396)   r     1 CODE04                     0-0-0/w STRC(108)   r     1 CODE06
     0-0-0/w STRC(144)   r     1 CODE15                     0-0-0/w STRC(1404)  r     1 CODE16
     0-0-0/w STRC(54)    r     1 CODE18                     0-0-0/w STRC(54)    r     1 CODE19
     0-0-0/w STRC(180)   r     1 CODE20                     0-0-0/w STRC(45)    r     1 CODE21
     0-0-0/d ASTR(3528)  r     1 F$DCB                      0-0-0/w STRC(4572)  r     1 FITALTKEYS
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:242  
     0-0-0/w STRC(108)   r     1 FM$ADKEY                   0-0-0/w STRC(288)   r     1 FM$CFU
     0-0-0/w STRC(288)   r     1 FM$CFUA                    0-0-0/w STRC(288)   r     1 FM$CFUEXT
     0-0-0/w STRC(288)   r     1 FM$CFUF                    0-0-0/w STRC(288)   r     1 FM$CFUJ
     0-0-0/w STRC        r     1 FM$FDSEG                   0-0-0/w STRC(72)    r     1 FM$FDSTOW
     0-0-0/w STRC(72)    r     1 FM$FIELD_START             0-0-0/w STRC(1116)  r     1 FM$FIT
     0-0-0/w STRC(180)   r     1 FM$GRAN                    0-0-0/w ASTR(9)     r     1 FM$KEYENT
     0-0-0/w STRC(144)   r     1 FM$MADKEY                  0-0-0/w STRC(288)   r     1 FM$SET(0:0)
     0-0-0/w STRC(216)   r     1 FMC$CACHETBL(0:0)
     0-0-0/d STRC(756)   r     1 FPT$OPEN_V                 0-0-0/w STRC(360)   r     1 IRKEYS
     0-0-0/d STRC(45)    r     1 IRREC                      0-0-0/w STRC(81)    r     1 KFIELD
     0-0-0/c ACHR        r     1 MOVEJ                      0-0-0/d STRC(54)    r     1 RECFIELD
     0-0-0/d STRC(612)   r     1 VLP$FPRG                   0-0-0/w ASTR        r     1 XTNTS


   Procedure FMN$OPNF requires 3380 words for executable code.
   Procedure FMN$OPNF requires 32 words of local(AUTO) storage.
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:243  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:244  
          MINI XREF LISTING

ACCT$
      3208**DCL      1790--IMP-PTR  1796--IMP-PTR  4366<<ASSIGN   4394<<ASSIGN   4395>>IF       4408>>ASSIGN
      4409>>ASSIGN   4432<<ASSIGN   4455>>IF       4456<>CALL     4461<>CALL     4479<>CALL     4565<<ASSIGN
      4567>>IF       4568<>CALL     4574<>CALL     4606<>CALL     4654>>ASSIGN   5003>>IF       5028<>CALL
      5031>>ASSIGN   5037>>ASSIGN   5038>>ASSIGN   5041>>ASSIGN   5043>>DOWHILE  5047>>ASSIGN   5048>>ASSIGN
      5050>>ASSIGN   5052>>ASSIGN   5053>>ASSIGN   5055>>ASSIGN   5056<>CALL     5061<<ASSIGN   5095>>IF
      5254<>CALL     5270>>IF       5270>>ASSIGN   5336<>CALL     5338>>ASSIGN   5366>>ASSIGN   5421<>CALL
ACCTX
      3209**DCL      4306<>CALL     4358<>CALL     4674<>CALL     5028<>CALL     5029>>ASSIGN   5056<>CALL
      5057>>ASSIGN   5336<>CALL     5337>>ASSIGN
ACNSEARCH
      4375**LABEL    4392--GOTO
ALTKEY$
      3225**DCL      1918--IMP-PTR  4853<<ASSIGN   4855>>ASSIGN   4856>>ASSIGN   4859>>ASSIGN   4860>>ASSIGN
      4861>>ASSIGN   4862>>ASSIGN
B$JIT.DCB$
       448**DCL      4280>>ASSIGN
B$JIT.DCBNO
       439**DCL      4971>>ASSIGN
B$JIT.ERR
       358**DCL      4276<<ASSIGN   4326>>IF       4328<<ASSIGN   4376>>IF       4405<<ASSIGN   4442<<ASSIGN
      4472<<ASSIGN   4570<<ASSIGN   4633<<ASSIGN   4646>>ASSIGN   4647<<ASSIGN   4664<<ASSIGN   4670<<ASSIGN
      4692<<ASSIGN   4706<<ASSIGN   5248>>IF       5255<<ASSIGN   5265>>IF       5267<<ASSIGN   5358<<ASSIGN
      5362<<ASSIGN   5410<<ASSIGN   5417<<ASSIGN   5428<<ASSIGN   5431<<ASSIGN   5436<<ASSIGN   5439<<ASSIGN
      5444<<ASSIGN   5453<<ASSIGN   5455<<ASSIGN   5457<<ASSIGN   5459<<ASSIGN   5461<<ASSIGN   5464<<ASSIGN
      5470<<ASSIGN   5474>>IF       5475<<ASSIGN   5479<<ASSIGN   5485<<ASSIGN   5485>>ASSIGN   5486>>IF
      5488<<ASSIGN   5497>>ASSIGN   5499<<ASSIGN
B$JIT.ERR.CODE
       359**DCL      4415>>IF       4546>>IF       4660>>IF       4689>>IF       5189>>IF       5255>>IF
      5413>>IF       5413>>IF       5442>>IF       5442>>IF       5501>>DOSELCT
B$JIT.ERR.FCG
       358**DCL      5484>>IF
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:245  
B$JIT.ERR.MID
       359**DCL       359--REDEF    5484>>IF
B$JIT.FEXT
       448**DCL      4638>>ASSIGN   5382<<ASSIGN
B$JIT.HPSN
       448**DCL      4384>>ASSIGN
B$JIT.PRIV.ACTIVE
       359**DCL      4330>>IF       4341>>IF
B$JIT.PRIV.ACTIVE.FMBLK
       359**DCL      5200>>IF
B$JIT.PRIV.ACTIVE.FMDIAG
       360**DCL      5292>>IF
B$JIT.PRIV.ACTIVE.FMEFT
       359**DCL      4617>>IF       4622>>IF       4689>>IF       4989>>IF       5225>>IF
B$JIT.PRIV.ACTIVE.FMREAD
       360**DCL      4586>>IF
B$JIT.PRIV.ACTIVE.FMSEC
       360**DCL      4914>>IF
B$JIT.STAR
       448**DCL      4498--DOINDEX
B$JIT.STAR.DA
       448**DCL      4460>>IF       4497>>IF       4499>>IF       4515--ASSIGN   4559>>IF       4562>>ASSIGN
B$JIT.SYSID
       358**DCL      4365>>ASSIGN
B$JIT$
      3232**DCL       353--IMP-PTR  4276>>ASSIGN   4280>>ASSIGN   4326>>IF       4328>>ASSIGN   4330>>IF
      4341>>IF       4365>>ASSIGN   4376>>IF       4384>>ASSIGN   4405>>ASSIGN   4415>>IF       4442>>ASSIGN
      4460>>IF       4472>>ASSIGN   4497>>IF       4499>>IF       4515>>ASSIGN   4546>>IF       4559>>IF
      4562>>ASSIGN   4570>>ASSIGN   4586>>IF       4617>>IF       4622>>IF       4633>>ASSIGN   4638>>ASSIGN
      4646>>ASSIGN   4647>>ASSIGN   4660>>IF       4664>>ASSIGN   4670>>ASSIGN   4689>>IF       4689>>IF
      4692>>ASSIGN   4706>>ASSIGN   4914>>IF       4971>>ASSIGN   4989>>IF       5189>>IF       5200>>IF
      5225>>IF       5248>>IF       5255>>IF       5255>>ASSIGN   5265>>IF       5267>>ASSIGN   5292>>IF
      5358>>ASSIGN   5362>>ASSIGN   5382>>ASSIGN   5410>>ASSIGN   5413>>IF       5413>>IF       5417>>ASSIGN
      5428>>ASSIGN   5431>>ASSIGN   5436>>ASSIGN   5439>>ASSIGN   5442>>IF       5442>>IF       5444>>ASSIGN
      5453>>ASSIGN   5455>>ASSIGN   5457>>ASSIGN   5459>>ASSIGN   5461>>ASSIGN   5464>>ASSIGN   5470>>ASSIGN
      5474>>IF       5475>>ASSIGN   5479>>ASSIGN   5484>>IF       5484>>IF       5485>>ASSIGN   5485>>ASSIGN
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:246  
      5486>>IF       5488>>ASSIGN   5497>>ASSIGN   5499>>ASSIGN   5501>>DOSELCT
B$ROSEG$
      3233**DCL      4780>>ASSIGN   4795>>ASSIGN   4809>>CALL     4814>>ASSIGN   4821>>ASSIGN   4827>>ASSIGN
      4837>>ASSIGN   4843>>ASSIGN   4853>>ASSIGN   4872>>ASSIGN   4883>>ASSIGN
BADFIT
      5470**LABEL    4653--CALLALT
BNEWFILE
      5265**LABEL    4560--GOTO     4741--GOTO     5477--GOTO
BNEWFILE0
      5256**LABEL    4567--GOTO     4618--GOTO     4687--GOTO     4693--GOTO
BNEWFILEX
      5249**LABEL    4571--GOTO     4574--CALLALT
BUF$
      3212**DCL      1808--IMP-PTR  4653<>CALL     4657>>ASSIGN   4761>>ASSIGN   5014>>IF       5245<>CALL
      5246>>ASSIGN   5341<<ASSIGN   5342>>IF       5347>>ASSIGN   5399>>ASSIGN
B_TICSDAY
      4113**DCL      4701>>IF
CFU$
      3207**DCL      1784--IMP-PTR  1800--IMP-PTR  1803--IMP-PTR  4306<>CALL     4311>>ASSIGN   4312>>ASSIGN
      4358<>CALL     4360>>ASSIGN   4361>>ASSIGN   4364>>ASSIGN   4365>>ASSIGN   4394>>ASSIGN   4432>>ASSIGN
      4444>>ASSIGN   4480>>IF       4481<<ASSIGN   4544<<ASSIGN   4550<<ASSIGN   4562>>ASSIGN   4569>>IF
      4605>>ASSIGN   4628>>ASSIGN   4648>>IF       4650<<ASSIGN   4652>>ASSIGN   4673>>ASSIGN   4674<>CALL
      4675>>ASSIGN   4676>>ASSIGN   4678>>ASSIGN   4696>>IF       4739>>IF       4740>>ASSIGN   4791>>IF
      4792>>ASSIGN   4865>>IF       4866>>ASSIGN   4896>>IF       4923>>ASSIGN   4934>>IF       4936>>IF
      4938>>ASSIGN   4941>>IF       4942>>IF       4944>>ASSIGN   4944>>ASSIGN   4947>>ASSIGN   4949>>IF
      4949>>ASSIGN   4952>>IF       4953>>IF       4969>>ASSIGN   4970>>ASSIGN   4971>>ASSIGN   4972>>ASSIGN
      4973>>ASSIGN   4983>>IF       4984>>ASSIGN   4985>>IF       4985>>ASSIGN   4987>>IF       4987>>IF
      4987>>ASSIGN   4989>>IF       4991>>IF       4992>>ASSIGN   4993>>ASSIGN   4993>>ASSIGN   4999>>IF
      5006>>IF       5015>>ASSIGN   5016>>ASSIGN   5019>>IF       5021>>ASSIGN   5029>>ASSIGN   5030>>IF
      5055<<ASSIGN   5057>>ASSIGN   5060<<ASSIGN   5061>>ASSIGN   5062>>IF       5069>>ASSIGN   5070>>ASSIGN
      5077>>ASSIGN   5088>>ASSIGN   5089>>ASSIGN   5090>>ASSIGN   5091>>ASSIGN   5092>>ASSIGN   5101>>IF
      5123>>IF       5144>>IF       5158>>ASSIGN   5158>>ASSIGN   5159>>IF       5159>>IF       5166>>ASSIGN
      5167>>IF       5175>>IF       5195>>ASSIGN   5195>>ASSIGN   5195>>ASSIGN   5197<>CALL     5210<>CALL
      5234<>CALL     5236>>IF       5237>>ASSIGN   5239>>ASSIGN   5240>>ASSIGN   5240>>ASSIGN   5241<>CALL
      5243<>CALL     5244>>ASSIGN   5256>>IF       5306>>ASSIGN   5307>>ASSIGN   5308>>ASSIGN   5309>>ASSIGN
      5310>>ASSIGN   5337>>ASSIGN   5344>>ASSIGN   5345>>ASSIGN   5365>>IF       5366>>ASSIGN   5372>>ASSIGN
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:247  
      5373>>ASSIGN   5373>>ASSIGN   5376>>ASSIGN   5377>>ASSIGN   5378>>ASSIGN   5379>>ASSIGN   5380>>ASSIGN
      5387>>ASSIGN   5391>>ASSIGN   5393>>IF       5393>>IF       5393>>ASSIGN   5494<<ASSIGN   5495>>IF
      5495>>IF       5495>>ASSIGN   5496>>IF       5496>>ASSIGN   5496>>ASSIGN
CHKLAST
      4491**PROC     5416--CALL
CHKNXT IN PROCEDURE CHKLAST
      4494**ENTRY    4471--CALL
CHKUGR
      5081**LABEL    5078--CALLALT
CODE01.EXTNT.XTNSIZE
      1832**DCL      5023>>ASSIGN
CODE01.XTNT
      1831**DCL      1832--REDEF
CODE01.XTNT.XTNSIZE
      1831**DCL      5019>>IF       5022>>ASSIGN
CODE02.GDA
      1836**DCL      5070>>ASSIGN
CODE02.KEYL
      1836**DCL      4773>>ASSIGN
CODE02.KEYX
      1836**DCL      4772>>ASSIGN
CODE02.LRDL0
      1835**DCL      4768>>ASSIGN
CODE02.LSLIDE
      1835**DCL      4767>>ASSIGN
CODE02.SLIDE
      1835**DCL      5069>>ASSIGN
CODE02.SPARE
      1835**DCL      4769>>ASSIGN
CODE02.TDA
      1835**DCL      4771>>ASSIGN
CODE02.TDALVL
      1835**DCL      4770>>ASSIGN
CODE03.COMP
      1841**DCL      4907>>ASSIGN
CODE03.DESC
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:248  
      1839**DCL      4895>>ASSIGN
CODE03.DESC.BUF
      1839**DCL      5096<<ASSIGN
CODE03.DESC.BUPM
      1840**DCL      5095>>IF
CODE03.EXPIRE
      1842**DCL      4904>>ASSIGN
CODE03.LDA
      1842**DCL      5092>>ASSIGN
CODE03.NGAVAL
      1841**DCL      4738>>ASSIGN   4901>>ASSIGN   5082>>IF       5084<<ASSIGN   5090>>ASSIGN   5102>>ASSIGN
      5104<<ASSIGN
CODE03.NRECS
      1841**DCL      4908>>ASSIGN   5089>>ASSIGN
CODE03.ORG
      1839**DCL      4899>>ASSIGN
CODE03.RCSZ
      1841**DCL      4902>>ASSIGN   5091>>ASSIGN
CODE03.RECL
      1842**DCL      4909>>ASSIGN
CODE03.TYPE
      1841**DCL      4903>>ASSIGN
CODE03.UGRANS
      1839**DCL      4738>>ASSIGN   4901>>ASSIGN   5082>>IF       5083<<ASSIGN   5088>>ASSIGN   5102<<ASSIGN
      5102>>ASSIGN
CODE03.XTNSIZE
      1842**DCL      4906>>ASSIGN
CODE04.ACCESS.TIME
      1850**DCL      4998<<ASSIGN
CODE04.CREATION.TIME
      1850**DCL      4701>>IF
CODE04.MODIFY.TIME
      1850**DCL      4981>>ASSIGN   5000>>ASSIGN   5001<<ASSIGN
CODE04.SVMODIFY
      1851**DCL      4988>>IF       4991>>IF
CODE04.SVMODIFY.TIME
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:249  
      1851**DCL      5000<<ASSIGN
CODE06
      1854**DCL      4593--IF       4597<<ASSIGN   4597>>ASSIGN
CODE06.STOW.EFT
      1854**DCL      1855--REDEF
CODE15.CGORG
      1864**DCL      4890>>ASSIGN
CODE15.QISS
      1864**DCL      4891>>ASSIGN
CODE16
      1867**DCL      4799--CALL     4801<<ASSIGN   4801>>ASSIGN
CODE18.DECFIELD
      1875**DCL      1876--REDEF
CODE18.NFIELDS
      1875**DCL      4833>>ASSIGN
CODE19
      1879**DCL      4850<>CALL
CODE20.ALTBLD
      1882**DCL      4855>>ASSIGN   4866>>ASSIGN
CODE20.K.FDA
      1883**DCL      4861>>ASSIGN
CODE20.K.LDA
      1883**DCL      4862>>ASSIGN
CODE20.K.TDA
      1882**DCL      4860>>ASSIGN
CODE20.K.TDALVL
      1882**DCL      4859>>ASSIGN
CODE20.NKEYS
      1882**DCL      4858>>DOINDEX
CODE20.UNIQUEBLD
      1882**DCL      4856>>ASSIGN   4867>>ASSIGN
CODE21.NFIELDS
      1887**DCL      4879>>ASSIGN
DENY
      4099**DCL      5503<>CALL     5503--CALL
EFIT$
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:250  
      3221**DCL      4648<<ASSIGN   4649<<ASSIGN   4653>>CALL
ELA$SYSLOG
      4117**DCL-ENT  5202--CALL     5503--CALL
ENQFIT
      5206**PROC     4651--CALL     5390--CALL
ERRCODE
      3222**DCL      4646<<ASSIGN   4689>>IF       4705>>IF       4706>>ASSIGN   5475>>IF       5475>>ASSIGN
ES_LOGFILEDENY
      3236**DCL      5500>>IF
ES_LOGFILEGRANT
      3235**DCL      5200>>IF
ES_PROTECTSECLOG
      3237**DCL      4701>>IF       4701>>IF
F$CFU$
      4103**DCL      4394>>ASSIGN   4432>>ASSIGN   4942>>IF       4944>>ASSIGN   4944>>ASSIGN   5061>>ASSIGN
F$DCB.ACCT
       523**DCL      4333>>IF       4333<<ASSIGN   5445<<ASSIGN
F$DCB.ACS
       530**DCL      4291>>IF       4911>>IF       4951>>IF       5123>>IF       5123>>IF       5128>>IF
      5128<<ASSIGN   5163<<ASSIGN   5167>>IF       5168<<ASSIGN   5191>>IF       5207>>IF       5225>>IF
      5237>>IF       5352>>IF       5353>>IF       5356>>IF       5356>>IF       5367>>IF       5386>>IF
      5391>>IF       5398>>IF
F$DCB.ACTPOS
       538**DCL       538--REDEF
F$DCB.ALTKEYX
       536**DCL      4779>>IF       4780>>ASSIGN   4783<<ASSIGN   4795<<ASSIGN   4853>>ASSIGN
F$DCB.ARS
       513**DCL       513--REDEF    4902<<ASSIGN
F$DCB.ASN
       528**DCL      4736>>IF       4954<<ASSIGN   4958<<ASSIGN   4970>>IF       4975>>IF       5172>>IF
      5193<<ASSIGN   5225>>IF       5225>>IF       5291>>IF       5353>>IF       5395>>IF
F$DCB.ATTR
       531**DCL       532--REDEF
F$DCB.AU
       524**DCL      5225>>IF
F$DCB.AUTHFFLG
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:251  
       538**DCL      4691>>ASSIGN
F$DCB.BFR
       557**DCL      5148<<ASSIGN   5148>>ASSIGN   5151<<ASSIGN
F$DCB.BFR.BUFUP
       557**DCL      5004<<ASSIGN   5086<<ASSIGN   5093>>IF       5152>>IF
F$DCB.BFR.BUFX
       558**DCL      5147>>IF       5341>>ASSIGN
F$DCB.BFR.DA
       558**DCL      5016<<ASSIGN   5024<<ASSIGN   5062<<ASSIGN   5154<<ASSIGN   5340<<ASSIGN   5346<<ASSIGN
F$DCB.BFR1
       558**DCL      5149<<ASSIGN   5149>>ASSIGN   5150<<ASSIGN
F$DCB.BFR1.CX
       559**DCL      5467>>IF       5468>>IF
F$DCB.BORROW
       546**DCL       546--REDEF     546--REDEF     546--REDEF    4738<<ASSIGN
F$DCB.BUPM
       527**DCL      5271>>IF       5271>>ASSIGN
F$DCB.CFU$
       547**DCL      4311<<ASSIGN   4360<<ASSIGN   4480>>IF       4547>>IF       4550>>ASSIGN   4648>>IF
      4650>>ASSIGN   4677<>CALL     4678<<ASSIGN   5060>>ASSIGN   5493>>IF       5494>>ASSIGN
F$DCB.COMP
       526**DCL      4907<<ASSIGN   5123>>IF       5298<<ASSIGN
F$DCB.CTG
       526**DCL      4305<<ASSIGN   5175>>IF       5386>>IF
F$DCB.DCBNAME.L
       560**DCL       560--IMP-SIZ
F$DCB.DESC
       520**DCL      4603<<ASSIGN   4895<<ASSIGN   5269<<ASSIGN
F$DCB.DESC.BAD
       521**DCL      4914>>IF       4923>>ASSIGN
F$DCB.DESC.BUF
       520**DCL      4896<<ASSIGN   5107>>IF       5108<<ASSIGN   5272<<ASSIGN
F$DCB.DESC.BUPM
       521**DCL      4896>>IF       5107>>IF       5270<<ASSIGN   5271<<ASSIGN   5272>>ASSIGN
F$DCB.DESC.NOLIST
       520**DCL      4607>>IF
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:252  
F$DCB.DISP
       528**DCL      4291>>IF       4304>>IF       5381>>IF
F$DCB.ENQF
       545**DCL      5196>>IF       5198<<ASSIGN   5211<<ASSIGN   5232>>IF       5242>>IF
F$DCB.EOMCHAR
       517**DCL       517--REDEF
F$DCB.EXIST
       526**DCL      4633>>IF       4734>>IF       5238>>IF       5356>>IF       5476>>IF
F$DCB.EXPIRE
       529**DCL      4342<<ASSIGN   4600<<ASSIGN   4904<<ASSIGN   4981<<ASSIGN
F$DCB.FCD
       526**DCL      4310<<ASSIGN   4359<<ASSIGN
F$DCB.FDCM
       550**DCL      4656>>ASSIGN   4662<<ASSIGN
F$DCB.FEXT
       541**DCL      4638<<ASSIGN   4734>>IF       4747<<ASSIGN   4803<<ASSIGN   4962<<ASSIGN   4967<<ASSIGN
      5187>>IF       5476>>IF
F$DCB.FEXTX
       529**DCL      4638>>ASSIGN   5382>>IF       5382>>ASSIGN
F$DCB.FFLG
       517**DCL      4363<<ASSIGN   4585>>IF       4587<<ASSIGN   4590>>IF       4607>>IF       4616>>IF
      4619<<ASSIGN   4655>>ASSIGN   4659>>IF       4661<<ASSIGN   4691<<ASSIGN   4702<<ASSIGN   4912>>IF
      4940>>IF       4963<<ASSIGN   4968<<ASSIGN   4968>>ASSIGN   4984>>IF       5145>>IF       5257<<ASSIGN
      5259>>IF
F$DCB.FFLG.AU
       519**DCL      5225>>IF
F$DCB.FFLG.NOLIST
       518**DCL      4607>>IF
F$DCB.FFLG.READ
       518**DCL      4702>>IF
F$DCB.FIELDX
       537**DCL      4820>>IF       4821>>ASSIGN   4824<<ASSIGN   4837<<ASSIGN
F$DCB.FLDID
       541**DCL       541--REDEF
F$DCB.FORM$
       535**DCL       535--REDEF    4799>>IF       4799<>CALL     4801>>ASSIGN
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:253  
F$DCB.FPRGX
       537**DCL      4808>>IF       4809>>CALL     4810<<ASSIGN   4814<<ASSIGN
F$DCB.FSECT
       551**DCL       551--REDEF
F$DCB.FSN
       528**DCL       528--REDEF     528--REDEF     529--REDEF
F$DCB.FUN
       527**DCL      4291>>IF       4301>>IF       4361>>ASSIGN   4607>>IF       4617>>IF       4620>>IF
      4632>>IF       4664>>IF       4676>>ASSIGN   4689>>IF       4733>>IF       4802>>IF       4934>>IF
      4939>>IF       4981>>IF       5207>>IF       5238>>IF       5259>>IF       5285>>IF       5356>>IF
      5476>>IF
F$DCB.GHSTACS
       536**DCL      4709>>IF       4709>>IF       5225>>IF       5225>>IF       5236>>IF       5397>>IF
F$DCB.HASH
       550**DCL      4761<<ASSIGN
F$DCB.HEADER$
       534**DCL       534--REDEF
F$DCB.IASN
       554**DCL      4955<<ASSIGN   4959<<ASSIGN
F$DCB.IFMT
       553**DCL      4890<<ASSIGN   5142<<ASSIGN
F$DCB.IORG
       549**DCL      4900<<ASSIGN   4905>>IF       4992>>IF       5127<<ASSIGN   5141>>ASSIGN   5155>>DOCASE
      5169>>IF       5297<<ASSIGN   5315>>IF       5352<<ASSIGN   5377>>IF
F$DCB.IRRECX
       541**DCL      4871>>IF       4872>>ASSIGN   4875<<ASSIGN   4883<<ASSIGN
F$DCB.IXTNSIZE
       532**DCL       532--REDEF    4901<<ASSIGN   4993<<ASSIGN   5022<<ASSIGN   5023<<ASSIGN   5080>>ASSIGN
      5320<<ASSIGN   5353>>IF
F$DCB.JRNLBYPASS
       536**DCL      5225>>IF
F$DCB.KEYL
       530**DCL      4773<<ASSIGN
F$DCB.KEYX
       529**DCL      4772<<ASSIGN
F$DCB.KFIELDX
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:254  
       538**DCL      4842>>IF       4843>>ASSIGN   4846<<ASSIGN
F$DCB.LASTSTA$
       522**DCL       522--REDEF    5161>>IF
F$DCB.LOGSEC
       552**DCL      5200>>IF       5500>>IF
F$DCB.LRDL0
       530**DCL      4768<<ASSIGN
F$DCB.LSLIDE
       530**DCL      4767<<ASSIGN
F$DCB.LVL
       547**DCL       547--REDEF
F$DCB.MEDIA
       553**DCL      5141<<ASSIGN   5142>>ASSIGN
F$DCB.NAME
       522**DCL      4458>>ASSIGN   4459<<ASSIGN   4461--CALL     4574--CALL
F$DCB.NAME.C
       522**DCL       522--REDEF    4467<<ASSIGN   4492<<ASSIGN   4493<<ASSIGN   4500>>IF       4500>>IF
      4509<<CALLBLT  4514<<CALLBLT  4681<<CALLBLT  4682<<CALLBLT  4682>>CALLBLT  4696>>IF       5256>>IF
      5490<<ASSIGN
F$DCB.NAME.L
       522**DCL      4347>>IF       4459>>IF       4466<<ASSIGN   4513<<ASSIGN   4680>>ASSIGN   4684<<ASSIGN
      4684>>ASSIGN   5489<<ASSIGN
F$DCB.NOEOF
       543**DCL       543--REDEF
F$DCB.NRECS
       533**DCL       533--REDEF    4908<<ASSIGN   4992<<ASSIGN   5318>>ASSIGN   5377>>ASSIGN
F$DCB.NRECX
       552**DCL       552--REDEF
F$DCB.OHDR
       544**DCL       544--REDEF
F$DCB.ORG
       527**DCL       527--REDEF    4291>>IF       4899<<ASSIGN   4900>>ASSIGN   4913>>IF       5123>>IF
      5123>>IF       5123>>IF       5123>>IF       5123>>IF       5167>>IF       5172>>IF       5225>>IF
      5290<<ASSIGN   5290>>ASSIGN   5291>>IF       5297>>ASSIGN   5298>>IF       5353>>IF
F$DCB.OWNER
       544**DCL      4654<<ASSIGN   4961<<ASSIGN   4966<<ASSIGN
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:255  
F$DCB.PRECNO
       550**DCL       550--REDEF
F$DCB.PRIVOPN
       552**DCL      4588<<ASSIGN   5200>>IF
F$DCB.PSN
       523**DCL      4340<<ASSIGN   4348<>CALL     4384<<ASSIGN   4386<<ASSIGN   4390<>CALL     4391<<ASSIGN
      5451<<ASSIGN
F$DCB.QISS
       524**DCL      4891<<ASSIGN
F$DCB.RA
       544**DCL      4988<<ASSIGN   5085<<ASSIGN
F$DCB.RCSZ
       555**DCL       555--REDEF
F$DCB.RECL
       528**DCL      4909<<ASSIGN   5316>>IF       5316<<ASSIGN   5317>>ASSIGN
F$DCB.RES
       523**DCL       523--REDEF
F$DCB.SETX
       535**DCL       535--REDEF    4331>>ASSIGN   4377>>ASSIGN   4383>>IF
F$DCB.SHARE
       526**DCL      4444>>ASSIGN   4935>>IF       5207>>IF       5207>>IF       5391>>ASSIGN
F$DCB.SHARED
       542**DCL      4932>>IF       4933<<ASSIGN   5195<<ASSIGN   5225>>IF
F$DCB.SPARE
       530**DCL      4769<<ASSIGN
F$DCB.STARF
       542**DCL      4329>>IF       4362>>IF       4454>>IF       4460>>IF       4470>>IF       4479>>IF
      4558>>IF       4606>>IF       4654>>IF       5093>>IF       5207>>IF       5254>>IF       5416>>IF
      5421>>IF
F$DCB.STARTX
       538**DCL      4826>>IF       4827>>ASSIGN   4830<<ASSIGN
F$DCB.STARX
       544**DCL      4326>>IF       4495>>ASSIGN   4496<<ASSIGN   4559>>IF       4561>>IF       4562>>ASSIGN
F$DCB.TAB$
       534**DCL       535--REDEF
F$DCB.TDA
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:256  
       549**DCL       549--REDEF    4771<<ASSIGN
F$DCB.TDALVL
       547**DCL      4770<<ASSIGN
F$DCB.TYC
       513**DCL      4443<<ASSIGN   5268<<ASSIGN
F$DCB.TYPE
       523**DCL      4903<<ASSIGN
F$DCB.UNIQUEBLD
       554**DCL      4793<<ASSIGN   4867<<ASSIGN
F$DCB.UPDCNT
       554**DCL      4946<<ASSIGN   5032<<ASSIGN   5339<<ASSIGN
F$DCB.WSN
       524**DCL       524--REDEF
F$DCB.WSR
       530**DCL      4969>>ASSIGN   4981>>IF
F$DCB.XTNSIZE
       530**DCL      4906<<ASSIGN
FAF$FRTOSR
      4118**DCL-ENT  5078--CALL
FAG$G1DIR
      4120**DCL-ENT  5343--CALL
FAG$GEXT
      4119**DCL-ENT  5354--CALL
FDA
      3201**DCL      3202--REDEF    4583<<ASSIGN   4592<>CALL     4593>>IF       4600>>ASSIGN   4601<<ASSIGN
      4605>>ASSIGN   4615>>IF       4652<<ASSIGN   4653<>CALL     5244<<ASSIGN   5245<>CALL     5309<<ASSIGN
      5355>>IF
FIELD$
      3224**DCL      1955--IMP-PTR  4821<<ASSIGN   4822>>ASSIGN   4823<>CALL     4834<>CALL     4836>>ASSIGN
      4837>>ASSIGN
FILLCFU
      5006**LABEL    4989--GOTO     4996--GOTO     5003--GOTO
FINDFIL
      4432**LABEL    4375--CALLALT
FINDFIL1
      4432**LABEL    4367--GOTO     4685--GOTO
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:257  
FINDFILX
      4415**LABEL    4395--GOTO     4410--GOTO
FIRSTOPN
      4558**LABEL    4528--GOTO     5474--GOTO
FIT$
      3220**DCL      1828--IMP-PTR  3221--REDEF    4657<<ASSIGN   4658>>CALL     4713<>CALL     4786>>ASSIGN
      4988>>IF       4996>>IF       5012>>ASSIGN   5012>>ASSIGN   5013>>ASSIGN   5218>>ASSIGN   5221>>IF
      5246<<ASSIGN   5399<<ASSIGN
FITALTKEYS.ALTBLD
      1858**DCL      4792>>ASSIGN
FITALTKEYS.NUMWRDS
      1858**DCL      4781>>ASSIGN
FITALTKEYS.UNIQUEBLD
      1858**DCL      4793>>ASSIGN
FM$ADKEY.D
      1815**DCL      4341>>IF       4404>>IF
FM$ADKEY.FDSDA
      1815**DCL      4342>>ASSIGN   4408>>ASSIGN   4409>>ASSIGN
FM$BUF$
      4102**DCL      5341>>ASSIGN
FM$CFU.ACCTX
      1785**DCL      1785--REDEF    4394>>ASSIGN   4432>>ASSIGN   4673>>ASSIGN   4675<<ASSIGN   4696>>IF
      5061>>ASSIGN   5256>>IF
FM$CFU.AFIT
      1784**DCL      5015<<ASSIGN   5062>>IF       5144>>IF       5345<<ASSIGN   5365>>IF
FM$CFU.ALTBLD
      1787**DCL      4792<<ASSIGN   4866<<ASSIGN
FM$CFU.B
      1787**DCL      4923<<ASSIGN
FM$CFU.FITSDA
      1785**DCL      4547>>IF       4562<<ASSIGN   4605<<ASSIGN   4652>>ASSIGN   5016>>ASSIGN   5244>>ASSIGN
      5309>>ASSIGN   5310<<ASSIGN   5344<<ASSIGN   5366<<ASSIGN   5495<<ASSIGN
FM$CFU.FMOD
      1784**DCL      5308<<ASSIGN
FM$CFU.FUN
      1784**DCL      4312<<ASSIGN   4361<<ASSIGN   4628<<ASSIGN   4676<<ASSIGN   4739>>IF       4740<<ASSIGN
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:258  
      4936>>IF       4947<<ASSIGN   4949>>IF       4972<<ASSIGN   4984<<ASSIGN   4985>>IF       4985<<ASSIGN
      4987>>IF       4989>>IF       5030>>IF       5158<<ASSIGN   5158>>ASSIGN   5167>>IF       5175>>IF
      5195>>ASSIGN   5195>>ASSIGN   5236>>IF       5237<<ASSIGN   5239<<ASSIGN   5240<<ASSIGN   5240>>ASSIGN
      5387<<ASSIGN   5393<<ASSIGN   5496>>IF       5496<<ASSIGN   5496>>ASSIGN
FM$CFU.GDA
      1786**DCL      5070<<ASSIGN   5159>>IF       5380<<ASSIGN
FM$CFU.LDA
      1787**DCL      5092<<ASSIGN   5379<<ASSIGN
FM$CFU.NAMEX
      1785**DCL      5495>>IF
FM$CFU.NGAVAL
      1787**DCL      4993>>ASSIGN   5090<<ASSIGN   5373<<ASSIGN   5373>>ASSIGN   5393>>IF
FM$CFU.NRECS
      1785**DCL      4992>>ASSIGN   5089<<ASSIGN   5376<<ASSIGN   5377<<ASSIGN
FM$CFU.RCSZ
      1786**DCL      5091<<ASSIGN   5378<<ASSIGN
FM$CFU.SHARE
      1784**DCL      4444<<ASSIGN   4934>>IF       4938<<ASSIGN   4949<<ASSIGN   4987>>IF       5166<<ASSIGN
      5195>>ASSIGN   5306<<ASSIGN   5391<<ASSIGN
FM$CFU.SHARED
      1784**DCL      4896>>IF       4987<<ASSIGN   4991>>IF       4999>>IF       5019>>IF       5101>>IF
      5123>>IF       5159>>IF       5307<<ASSIGN
FM$CFU.SLIDE
      1786**DCL      5069<<ASSIGN
FM$CFU.STARX.F
      1785**DCL      4364<<ASSIGN
FM$CFU.STARX.SYSID
      1785**DCL      4365<<ASSIGN
FM$CFU.UGRANS
      1786**DCL      4993>>ASSIGN   5077<<ASSIGN   5088<<ASSIGN   5372<<ASSIGN   5393>>IF
FM$CFU.USECNT
      1786**DCL      4791>>IF       4865>>IF
FM$CFU.XTX
      1786**DCL      4941>>IF       4942>>IF       4944>>ASSIGN   4944>>ASSIGN   4983>>IF       5006>>IF
      5021<<ASSIGN   5029<<ASSIGN   5337<<ASSIGN   5495>>IF
FM$CFUA.ACCESS.BUPM
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:259  
      1792**DCL      5270>>ASSIGN
FM$CFUA.ACCESS.NOACUP
      1792**DCL      5003>>IF       5095>>IF
FM$CFUA.ACCESS.OWNERF
      1792**DCL      4654>>ASSIGN
FM$CFUA.FDCSDA
      1790**DCL      4409<<ASSIGN
FM$CFUA.FDFITSDA
      1790**DCL      4408<<ASSIGN
FM$CFUA.FLAGS.EXIST
      1790**DCL      4395>>IF
FM$CFUA.FLAGS.NEW
      1791**DCL      4455>>IF       4567>>IF
FM$CFUEXT
      1796**DCL      5037--ASSIGN
FM$CFUEXT.LINKX
      1796**DCL      5057<<ASSIGN
FM$CFUEXT.NUM
      1796**DCL      5038<<ASSIGN   5047<<ASSIGN   5050<<ASSIGN   5052>>ASSIGN   5053>>ASSIGN
FM$CFUEXT.UPDCNT
      1796**DCL      4942>>IF       4944<<ASSIGN   4944>>ASSIGN   5031<<ASSIGN   5338<<ASSIGN
FM$CFUEXT.XTNT
      1796**DCL      1797--REDEF    5041<<ASSIGN   5048<<ASSIGN
FM$CFUEXT.XTNT.XTNSDA
      1797**DCL      5366>>ASSIGN
FM$CFUEXT.XTNT.XTNSIZE
      1796**DCL      5043>>DOWHILE
FM$CFUF.ACCNAM
      1800**DCL      4569>>IF
FM$CFUJ.DCB#
      1803**DCL      4971<<ASSIGN
FM$CFUJ.DMAIN
      1804**DCL      4969<<ASSIGN
FM$CFUJ.TAPE
      1804**DCL      4953>>IF       4970<<ASSIGN
FM$CFUJ.USER
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:260  
      1804**DCL      4952>>IF       4973<<ASSIGN
FM$FDSEG.DESC
      1821**DCL      4603>>ASSIGN
FM$FDSEG.DESC.ARCHIVE
      1821**DCL      4591>>IF
FM$FDSEG.DESC.DELF
      1821**DCL      4584>>IF
FM$FDSEG.FITSDA
      1822**DCL      4583>>ASSIGN
FM$FDSTOW.CODE06
      1825**DCL      4597--ASSIGN
FM$FIELD_START.NWORDS
      1941**DCL      4828>>ASSIGN
FM$FIT
      1828**DCL      4658<>CALL
FM$FIT.CODES
      1828**DCL      4595<<ASSIGN   4596<<ASSIGN   4597--ASSIGN
FM$FIT.CODES.ITEMX
      1828**DCL      5012>>ASSIGN
FM$FIT.CODES.NDW
      1828**DCL      4786>>ASSIGN   5013>>ASSIGN
FM$GRAN
      1808**DCL      4657--ASSIGN   5246--ASSIGN   5399--ASSIGN
FM$GRAN.LVL
      1808**DCL      5014>>IF       5342>>IF
FM$GRAN.STAMP.GMOD
      1808**DCL      5347<<ASSIGN
FM$GRAN.STAMP.HASH
      1808**DCL      4761>>ASSIGN
FM$KEYENT.KLB
      1818**DCL      1818--IMP-SIZ  4466>>ASSIGN   4467>>ASSIGN
FM$KEYENT.TXT
      1818**DCL      4467>>ASSIGN
FM$MADKEY.PSN
      1812**DCL      4340>>ASSIGN   4386>>ASSIGN
FM$SET
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:261  
      1890**DCL      4331--ASSIGN   4377--ASSIGN
FM$SET.USERLIST
      1891**DCL      1891--REDEF
FM$SET$
      4104**DCL      1890--IMP-PTR  4331>>ASSIGN   4340>>IF       4346>>IF       4377>>ASSIGN
FMC$CACHETBL.USECNT
      1905**DCL      5468>>IF
FMC_CACHE$
      1011**DCL      1896--IMP-PTR  5468>>IF
FMC_CACHEPGCNT$
      1012**DCL      1012--IMP-PTR  1012--REDEF
FMD$FLSHBUF
      4121**DCL-ENT  4344--CALL     4388--CALL     4421--CALL     4478--CALL     4604--CALL     4672--CALL
      5146--CALL     5233--CALL     5253--CALL     5420--CALL     5448--CALL
FMD$RELBUF
      4122**DCL-ENT  5143--CALL     5469--CALL     5507--CALL
FMD$WRTSV
      4123**DCL-ENT  5105--CALL     5152--CALL     5392--CALL
FMF$PEOF
      4124**DCL-ENT  5188--CALL
FMG$INIT
      4125**DCL-ENT  5157--CALL
FMG$IRSETUP
      4126**DCL-ENT  4850--CALL
FMG$KEYEXP
      4128**DCL-ENT  5160--CALL
FMH$INIT
      4129**DCL-ENT  5170--CALL
FMH$JGETPG
      4130**DCL-ENT  5192--CALL
FMI$INIT
      4131**DCL-ENT  5174--CALL
FMJ$INIT
      4132**DCL-ENT  5179--CALL
FMN$CHKFLACN
      4133**DCL-ENT  4290--CALL     4473--CALL
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:262  
FMN$E$ADEOF
      4210**DCL      5444>>ASSIGN
FMN$E$BADJRNL
      4250**DCL      5453>>ASSIGN
FMN$E$CODE
      4258**DCL      5485>>ASSIGN
FMN$E$CREATERR
      4202**DCL      4633>>ASSIGN   5362>>ASSIGN
FMN$E$CREATONLY
      4254**DCL      4664>>ASSIGN
FMN$E$FDEOF
      4194**DCL      5488>>ASSIGN
FMN$E$FILEBUSY
      4198**DCL      4570>>ASSIGN   5428>>ASSIGN
FMN$E$JRNLERR
      4218**DCL      5464>>ASSIGN
FMN$E$NEWFILE
      4226**DCL      5431>>ASSIGN
FMN$E$NOACCESS
      4214**DCL      5455>>ASSIGN
FMN$E$NOCFUS
      4206**DCL      5436>>ASSIGN
FMN$E$NOCODE
      4262**DCL      5485>>ASSIGN
FMN$E$NOFILE
      4190**DCL      4670>>ASSIGN   5417>>ASSIGN   5439>>ASSIGN   5486>>IF
FMN$E$NOKEY
      4230**DCL      4405>>ASSIGN
FMN$E$NOTAUTH
      4234**DCL      5461>>ASSIGN
FMN$E$SDSEXISTS
      4222**DCL      5358>>ASSIGN
FMN$E$STOWEDFILE
      4242**DCL      5457>>ASSIGN
FMN$E$UNIMP
      4186**DCL      5410>>ASSIGN
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:263  
FMN$READFDFIT
      4136**DCL-ENT  4416--CALL     4433--CALL
FMN$READFIT
      4134**DCL-ENT  4648--ASSIGN   5245--CALL
FMN$READFITF
      4135**DCL-ENT  4649--ASSIGN
FMN$SETX
      4137**DCL-ENT  4348--CALL     4390--CALL
FMNE$ADEOF
      5439**LABEL    4335--CALLALT
FMNE$BADJRNL
      5453**LABEL    4916--GOTO
FMNE$CGFILE
      5459**LABEL    5293--GOTO
FMNE$E$CGFILE
      4238**DCL      5459>>ASSIGN
FMNE$FDEOF
      5410**LABEL    4461--CALLALT
FMNE$FDEOFA
      5416**LABEL    4455--GOTO     4469--GOTO
FMNE$FILEBUSY
      5421**LABEL    4934--GOTO     4936--GOTO
FMNE$JRNLERR
      5464**LABEL    4294--GOTO     4736--GOTO     4913--GOTO
FMNE$NEWFILE
      5428**LABEL    5260--GOTO
FMNE$NOACCESS
      5455**LABEL    4703--GOTO     4912--GOTO
FMNE$NOCFUS
      5431**LABEL    4306--CALLALT  4358--CALLALT  4674--CALLALT  5336--CALLALT
FMNE$NOCFUSA
      5434**LABEL    4943--GOTO     5028--CALLALT  5056--CALLALT
FMNE$NOFILE
      5436**LABEL    4347--GOTO     5285--GOTO
FMNE$NOTAUTH
      5461**LABEL    4330--GOTO
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:264  
FMNE$STOWEDFILE
      5457**LABEL    4620--GOTO     4622--GOTO
FMNE$UNIMP
      5399**LABEL    5181--GOTO
FMO$BLDFIT
      4138**DCL-ENT  5335--CALL
FMO$FIELD_START_SETUP
      4127**DCL-ENT  4839--CALL
FMO$LOCCODE
      4139**DCL-ENT  5219--CALL
FMO$SECCHK
      4140**DCL-ENT  4658--CALL
FMO$TRNINFO
      4141**DCL-ENT  4713--CALL
FMO$UPKACCT
      4142**DCL-ENT  4339--CALL
FMP$CLSERR
      4143**DCL-ENT  5498--CALL
FMP$CLSREL
      4144**DCL-ENT  5120--CALL     5480--CALL
FMP$RELCFUS
      4145**DCL-ENT  4677--CALL
FMP$UPFDDESC
      4146**DCL-ENT  5109--CALL     5177--CALL     5396--CALL
FMQ$SRCHAD
      4147**DCL-ENT  4335--CALL     4385--CALL     4400--CALL
FMQ$SRCHFD
      4148**DCL-ENT  4461--CALL     4574--CALL
FMR$G8
      4150**DCL-ENT  4306--CALL     4358--CALL     4674--CALL     5336--CALL
FMR$GA
      4151**DCL-ENT  5028--CALL     5056--CALL
FMR$L8
      4152**DCL-ENT  4931--CALL     5305--CALL
FMR$U8
      4153**DCL-ENT  4976--CALL     5094--CALL     5113--CALL     5311--CALL     5427--CALL     5434--CALL
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:265  
FMS$SCANACCT
      4155**DCL-ENT  4375--CALL
FMS$SCANNAME
      4156**DCL-ENT  4545--CALL
FMS$SCANNAMENW
      4157**DCL-ENT  4476--CALL
FM_DFLOPN_V
      4271**DCL      4272--REDEF
FM_FRZERO
      4105**DCL      5024>>ASSIGN   5062>>ASSIGN   5080>>ASSIGN   5081>>ASSIGN   5154>>ASSIGN   5340>>ASSIGN
      5379>>ASSIGN
FM_OPNS.SLO
      4112**DCL      4573<<ASSIGN   4573>>ASSIGN
FM_OPNS.TOT
      4111**DCL      4527<<ASSIGN   4527>>ASSIGN
FM_SRZERO
      4106**DCL      5078<>CALL     5080>>ASSIGN   5081>>ASSIGN
FM_STARCHARS
      4107**DCL      4500>>IF       4500>>IF       4500>>IF       4500>>IF       4500>>IF       4509>>CALLBLT
      4514>>CALLBLT
FM_SYSACCTX
      4108**DCL      4696>>IF       5256>>IF
FOUNDERR
      4632**LABEL    4547--GOTO
FOUNDIT
      4632**LABEL    4482--GOTO     4545--CALLALT  4563--GOTO
FPT$OPEN_V
      1769**DCL      4658<>CALL
FPT$OPEN_V.DELETE
      1769**DCL      4291>>IF       5119>>IF       5478>>IF
FPT$OPEN_V.FSN
      1779**DCL      1779--REDEF    1780--REDEF
FPT$OPEN_V.OPER
      1769**DCL      4291>>IF
FPT$OPEN_V.OPER.NXTA
      1770**DCL      4329>>IF       4415>>IF
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:266  
FPT$OPEN_V.OPER.NXTF
      1770**DCL      4326>>IF       4347>>IF       4445>>IF       4671>>IF       5486>>IF
FPT$OPEN_V.OPER.TEST
      1769**DCL      4302>>IF       4475>>IF       4528>>IF       4607>>IF       4621>>IF       4709>>IF
      4925>>IF       5207>>IF       5299>>IF
FPT$OPEN_V.OPER.THISF
      1770**DCL      4497>>IF
FPT$OPEN_V.OVERFDE
      1777**DCL      4617>>IF       4689>>IF
FPT$OPEN_V.SRCHCOND.REV
      1772**DCL      4333>>IF       4459>>IF       4492>>IF       4500>>IF       4500>>IF       4679>>IF
FSA$FSP
      4158**DCL-ENT  4782--CALL     4809--CALL     4823--CALL     4829--CALL     4845--CALL     4874--CALL
FSA$GSP
      4159**DCL-ENT  4788--CALL     4799--CALL     4813--CALL     4834--CALL     4880--CALL
FSB$GETDDF
      4160**DCL-ENT  4805--CALL
FSF$FORM
      4161**DCL-ENT  5169--CALL
GHSTACS IN PROCEDURE ENQFIT
      5224**ENTRY    4711--CALL     5397--CALL
GRANT
      4085**DCL      5202<>CALL     5202--CALL
HFF$DSIZ
      4162**DCL-ENT  4592--CALL
HFF$TRAPALT
      4163**DCL-ENT  4289--CALL
I
      3213**DCL      3214--REDEF    3218--REDEF    4495<<ASSIGN   4497>>IF       4497<<ASSIGN   4498>>IF
      4508<<ASSIGN   4509>>CALLBLT  4512>>IF       4514>>CALLBLT  4515>>ASSIGN   4673<<ASSIGN   4675>>ASSIGN
      4680<<ASSIGN   4681>>CALLBLT  4681>>CALLBLT  4682>>CALLBLT  4682>>CALLBLT  4699<<ASSIGN   4700<>CALL
      4737<<ASSIGN   4765<<ASSIGN   4785<<ASSIGN   4786>>ASSIGN   4798<<ASSIGN   4804<<ASSIGN   4812<<ASSIGN
      4832<<ASSIGN   4849<<ASSIGN   4852<<ASSIGN   4878<<ASSIGN   4889<<ASSIGN   4893<<ASSIGN   4980<<ASSIGN
      4997<>CALL     4998>>ASSIGN   5001>>ASSIGN   5013<<ASSIGN   5019>>IF       5019>>IF       5022>>IF
      5034>>DOWHILE  5035>>ASSIGN   5036>>IF       5038>>ASSIGN   5052<<ASSIGN   5052>>ASSIGN   5054>>IF
      5067<<ASSIGN   5075<<ASSIGN   5078<>CALL     5080<<ASSIGN   5081<<ASSIGN   5081>>ASSIGN   5082>>IF
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:267  
      5083>>ASSIGN   5202<>CALL     5219<>CALL     5343<>CALL     5344>>ASSIGN   5346>>ASSIGN   5347>>ASSIGN
      5497<<ASSIGN   5499>>ASSIGN   5503<>CALL     5506<<DOINDEX  5507<>CALL
IB.FDCM
      3217**DCL      4656<<ASSIGN   4662>>ASSIGN
IB.FFLG
      3215**DCL      4655<<ASSIGN   4661>>ASSIGN
IRKEYS.ALTBLD
      1918**DCL      4855<<ASSIGN
IRKEYS.K.FDA
      1921**DCL      4861<<ASSIGN
IRKEYS.K.LDA
      1922**DCL      4862<<ASSIGN
IRKEYS.K.TDA
      1919**DCL      4860<<ASSIGN
IRKEYS.K.TDALVL
      1919**DCL      4859<<ASSIGN
IRKEYS.UNIQUEBLD
      1918**DCL      4856<<ASSIGN
IRREC.NFIELDS
      1987**DCL      4873>>ASSIGN
IRREC$
      3227**DCL      1987--IMP-PTR  4872<<ASSIGN   4873>>ASSIGN   4874<>CALL     4880<>CALL     4882>>ASSIGN
      4883>>ASSIGN
IU
      3218**DCL      4701>>IF
J
      3219**DCL      2002--IMP-SIZ  2003--IMP-SIZ  2005--IMP-SIZ  4498<<DOINDEX  4499>>IF       4500>>IF
      4500>>IF       4500>>IF       4500>>IF       4500>>IF       4508>>ASSIGN   4781<<ASSIGN   4782<>CALL
      4786<<ASSIGN   4787>>IF       4788<>CALL     4789<<ASSIGN   4789>>ASSIGN   4790>>ASSIGN   4790>>ASSIGN
      4822<<ASSIGN   4823<>CALL     4828<<ASSIGN   4829<>CALL     4833<<ASSIGN   4834<>CALL     4835<<ASSIGN
      4835>>ASSIGN   4836>>ASSIGN   4836>>ASSIGN   4844<<ASSIGN   4845<>CALL     4858<<DOINDEX  4859>>ASSIGN
      4859>>ASSIGN   4860>>ASSIGN   4860>>ASSIGN   4861>>ASSIGN   4861>>ASSIGN   4862>>ASSIGN   4862>>ASSIGN
      4873<<ASSIGN   4874<>CALL     4879<<ASSIGN   4880<>CALL     4881<<ASSIGN   4881>>ASSIGN   4882>>ASSIGN
      4882>>ASSIGN   5035<<ASSIGN   5037>>ASSIGN   5037>>ASSIGN   5041>>ASSIGN   5042<<ASSIGN   5043>>DOWHILE
      5043>>DOWHILE  5044<<ASSIGN   5044>>ASSIGN   5046>>IF       5078<>CALL     5317<<ASSIGN   5318<<ASSIGN
      5318>>ASSIGN   5319>>IF       5319<<ASSIGN   5320>>ASSIGN
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:268  
JDCB$
      3199**DCL       513--IMP-PTR  4280<<ASSIGN   4290<>CALL     4291>>IF       4291>>IF       4291>>IF
      4291>>IF       4301>>IF       4304>>IF       4305>>ASSIGN   4310>>ASSIGN   4311>>ASSIGN   4326>>IF
      4329>>IF       4331>>ASSIGN   4333>>IF       4333>>ASSIGN   4339<>CALL     4340>>ASSIGN   4342>>ASSIGN
      4347>>IF       4348>>CALL     4359>>ASSIGN   4360>>ASSIGN   4361>>ASSIGN   4362>>IF       4363>>ASSIGN
      4377>>ASSIGN   4383>>IF       4384>>ASSIGN   4386>>ASSIGN   4390>>CALL     4391>>ASSIGN   4443>>ASSIGN
      4444>>ASSIGN   4454>>IF       4458>>ASSIGN   4459>>IF       4459>>ASSIGN   4460>>IF       4461>>CALL
      4466>>ASSIGN   4467>>ASSIGN   4470>>IF       4473<>CALL     4479>>IF       4480>>IF       4492>>ASSIGN
      4493>>ASSIGN   4495>>ASSIGN   4496>>ASSIGN   4500>>IF       4500>>IF       4509>>CALLBLT  4513>>ASSIGN
      4514>>CALLBLT  4547>>IF       4550>>ASSIGN   4558>>IF       4559>>IF       4561>>IF       4562>>ASSIGN
      4574>>CALL     4585>>IF       4587>>ASSIGN   4588>>ASSIGN   4590>>IF       4600>>ASSIGN   4603>>ASSIGN
      4606>>IF       4607>>IF       4607>>IF       4607>>IF       4607>>IF       4616>>IF       4617>>IF
      4619>>ASSIGN   4620>>IF       4632>>IF       4633>>IF       4638>>ASSIGN   4638>>ASSIGN   4648>>IF
      4650>>ASSIGN   4654>>IF       4654>>ASSIGN   4655>>ASSIGN   4656>>ASSIGN   4659>>IF       4661>>ASSIGN
      4662>>ASSIGN   4664>>IF       4676>>ASSIGN   4677>>CALL     4678>>ASSIGN   4680>>ASSIGN   4681>>CALLBLT
      4682>>CALLBLT  4682>>CALLBLT  4684>>ASSIGN   4684>>ASSIGN   4689>>IF       4691>>ASSIGN   4691>>ASSIGN
      4696>>IF       4702>>IF       4702>>ASSIGN   4709>>IF       4709>>IF       4733>>IF       4734>>IF
      4734>>IF       4736>>IF       4738>>ASSIGN   4747>>ASSIGN   4761>>ASSIGN   4767>>ASSIGN   4768>>ASSIGN
      4769>>ASSIGN   4770>>ASSIGN   4771>>ASSIGN   4772>>ASSIGN   4773>>ASSIGN   4779>>IF       4780>>ASSIGN
      4783>>ASSIGN   4793>>ASSIGN   4795>>ASSIGN   4799>>IF       4799>>CALL     4801>>ASSIGN   4802>>IF
      4803>>ASSIGN   4808>>IF       4809>>CALL     4810>>ASSIGN   4814>>ASSIGN   4820>>IF       4821>>ASSIGN
      4824>>ASSIGN   4826>>IF       4827>>ASSIGN   4830>>ASSIGN   4837>>ASSIGN   4842>>IF       4843>>ASSIGN
      4846>>ASSIGN   4853>>ASSIGN   4867>>ASSIGN   4871>>IF       4872>>ASSIGN   4875>>ASSIGN   4883>>ASSIGN
      4890>>ASSIGN   4891>>ASSIGN   4895>>ASSIGN   4896>>IF       4896>>ASSIGN   4899>>ASSIGN   4900>>ASSIGN
      4900>>ASSIGN   4901>>ASSIGN   4902>>ASSIGN   4903>>ASSIGN   4904>>ASSIGN   4905>>IF       4906>>ASSIGN
      4907>>ASSIGN   4908>>ASSIGN   4909>>ASSIGN   4911>>IF       4912>>IF       4913>>IF       4914>>IF
      4923>>ASSIGN   4932>>IF       4933>>ASSIGN   4934>>IF       4935>>IF       4939>>IF       4940>>IF
      4946>>ASSIGN   4951>>IF       4954>>ASSIGN   4955>>ASSIGN   4958>>ASSIGN   4959>>ASSIGN   4961>>ASSIGN
      4962>>ASSIGN   4963>>ASSIGN   4966>>ASSIGN   4967>>ASSIGN   4968>>ASSIGN   4968>>ASSIGN   4969>>ASSIGN
      4970>>IF       4975>>IF       4981>>IF       4981>>IF       4981>>ASSIGN   4984>>IF       4988>>ASSIGN
      4992>>IF       4992>>ASSIGN   4993>>ASSIGN   5004>>ASSIGN   5016>>ASSIGN   5022>>ASSIGN   5023>>ASSIGN
      5024>>ASSIGN   5032>>ASSIGN   5060>>ASSIGN   5062>>ASSIGN   5080>>ASSIGN   5085>>ASSIGN   5086>>ASSIGN
      5093>>IF       5093>>IF       5107>>IF       5107>>IF       5108>>ASSIGN   5123>>IF       5123>>IF
      5123>>IF       5123>>IF       5123>>IF       5123>>IF       5123>>IF       5123>>IF       5127>>ASSIGN
      5128>>IF       5128>>ASSIGN   5141>>ASSIGN   5141>>ASSIGN   5142>>ASSIGN   5142>>ASSIGN   5145>>IF
      5147>>IF       5148>>ASSIGN   5148>>ASSIGN   5149>>ASSIGN   5149>>ASSIGN   5150>>ASSIGN   5151>>ASSIGN
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:269  
      5152>>IF       5154>>ASSIGN   5155>>DOCASE   5161>>IF       5163>>ASSIGN   5167>>IF       5167>>IF
      5168>>ASSIGN   5169>>IF       5172>>IF       5172>>IF       5175>>IF       5187>>IF       5191>>IF
      5193>>ASSIGN   5195>>ASSIGN   5196>>IF       5198>>ASSIGN   5200>>IF       5200>>IF       5207>>IF
      5207>>IF       5207>>IF       5207>>IF       5207>>IF       5211>>ASSIGN   5225>>IF       5225>>IF
      5225>>IF       5225>>IF       5225>>IF       5225>>IF       5225>>IF       5225>>IF       5225>>IF
      5225>>IF       5232>>IF       5236>>IF       5237>>IF       5238>>IF       5238>>IF       5242>>IF
      5254>>IF       5256>>IF       5257>>ASSIGN   5259>>IF       5259>>IF       5268>>ASSIGN   5269>>ASSIGN
      5270>>ASSIGN   5271>>IF       5271>>ASSIGN   5271>>ASSIGN   5272>>ASSIGN   5272>>ASSIGN   5285>>IF
      5290>>ASSIGN   5290>>ASSIGN   5291>>IF       5291>>IF       5297>>ASSIGN   5297>>ASSIGN   5298>>IF
      5298>>ASSIGN   5315>>IF       5316>>IF       5316>>ASSIGN   5317>>ASSIGN   5318>>ASSIGN   5320>>ASSIGN
      5339>>ASSIGN   5340>>ASSIGN   5341>>ASSIGN   5346>>ASSIGN   5352>>IF       5352>>ASSIGN   5353>>IF
      5353>>IF       5353>>IF       5353>>IF       5356>>IF       5356>>IF       5356>>IF       5356>>IF
      5367>>IF       5377>>IF       5377>>ASSIGN   5381>>IF       5382>>IF       5382>>ASSIGN   5386>>IF
      5386>>IF       5391>>IF       5391>>ASSIGN   5395>>IF       5397>>IF       5398>>IF       5416>>IF
      5421>>IF       5445>>ASSIGN   5451>>ASSIGN   5467>>IF       5468>>IF       5476>>IF       5476>>IF
      5476>>IF       5489>>ASSIGN   5490>>ASSIGN   5493>>IF       5494>>ASSIGN   5500>>IF
JRNLXIT
      4925**LABEL    5400--GOTO
KCO$INIT
      4164**DCL-ENT  5173--CALL
KEY$
      3210**DCL      1812--IMP-PTR  1815--IMP-PTR  1818--IMP-PTR  1831--IMP-PTR  1835--IMP-PTR  1839--IMP-PTR
      1848--IMP-PTR  1858--IMP-PTR  1864--IMP-PTR  1867--IMP-PTR  1875--IMP-PTR  1879--IMP-PTR  1882--IMP-PTR
      1887--IMP-PTR  1992--IMP-PTR  2000--IMP-PTR  4335<>CALL     4339<>CALL     4340>>ASSIGN   4341>>IF
      4342>>ASSIGN   4385<>CALL     4386>>ASSIGN   4400<>CALL     4404>>IF       4408>>ASSIGN   4409>>ASSIGN
      4461<>CALL     4466>>ASSIGN   4467>>ASSIGN   4467>>ASSIGN   4574<>CALL     4701>>IF       4738>>ASSIGN
      4738>>ASSIGN   4767>>ASSIGN   4768>>ASSIGN   4769>>ASSIGN   4770>>ASSIGN   4771>>ASSIGN   4772>>ASSIGN
      4773>>ASSIGN   4790>>ASSIGN   4801>>ASSIGN   4805<>CALL     4815>>ASSIGN   4833>>ASSIGN   4836>>ASSIGN
      4850>>CALL     4855>>ASSIGN   4856>>ASSIGN   4858>>DOINDEX  4859>>ASSIGN   4860>>ASSIGN   4861>>ASSIGN
      4862>>ASSIGN   4866>>ASSIGN   4867>>ASSIGN   4879>>ASSIGN   4882>>ASSIGN   4890>>ASSIGN   4891>>ASSIGN
      4895>>ASSIGN   4899>>ASSIGN   4901>>ASSIGN   4901>>ASSIGN   4902>>ASSIGN   4903>>ASSIGN   4904>>ASSIGN
      4906>>ASSIGN   4907>>ASSIGN   4908>>ASSIGN   4909>>ASSIGN   4981>>ASSIGN   4988>>IF       4988>>IF
      4991>>IF       4996>>IF       4998>>ASSIGN   5000>>ASSIGN   5000>>ASSIGN   5001>>ASSIGN   5012<<ASSIGN
      5019>>IF       5022>>ASSIGN   5023>>ASSIGN   5037>>ASSIGN   5041>>ASSIGN   5053<<ASSIGN   5053>>ASSIGN
      5069>>ASSIGN   5070>>ASSIGN   5082>>IF       5082>>IF       5083>>ASSIGN   5084>>ASSIGN   5088>>ASSIGN
      5089>>ASSIGN   5090>>ASSIGN   5091>>ASSIGN   5092>>ASSIGN   5095>>IF       5096>>ASSIGN   5102>>ASSIGN
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:270  
      5102>>ASSIGN   5102>>ASSIGN   5104>>ASSIGN   5220<<ASSIGN   5221>>IF
KFIELD.NWORDS
      1925**DCL      4844>>ASSIGN
KFIELD$
      3223**DCL      1925--IMP-PTR  4843<<ASSIGN   4844>>ASSIGN   4845<>CALL
KQC$TELLJ
      4165**DCL-ENT  5241--CALL
LOC_CODE IN PROCEDURE ENQFIT
      5215**ENTRY    4699--CALL     4737--CALL     4765--CALL     4785--CALL     4798--CALL     4804--CALL
      4812--CALL     4832--CALL     4849--CALL     4852--CALL     4878--CALL     4889--CALL     4893--CALL
      4980--CALL     5067--CALL     5075--CALL
MAINOPN
      4358**LABEL    4329--GOTO
MMV$OPEN
      4166**DCL-ENT  5162--CALL
MOVEJ
      2003**DCL      4790<<ASSIGN   4790>>ASSIGN   4836<<ASSIGN   4836>>ASSIGN   4882<<ASSIGN   4882>>ASSIGN
NAMESEARCH
      4527**LABEL    4445--GOTO     4480--GOTO
NEWACCT
      4415**LABEL    4400--CALLALT  4406--GOTO
NOCODE04
      4981**LABEL    4980--CALLALT
NODELFILE
      4662**LABEL    4616--GOTO
NOMAD
      4386**LABEL    4385--CALLALT
NOXTX
      5062**LABEL    5025--GOTO
NXTAGAIN
      4333**LABEL    4343--GOTO
NXTAR
      3202**DCL      4458<<ASSIGN
NXTAR.C
      3205**DCL      4500>>IF       4500>>IF       4500>>IF
NXTAR.L
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:271  
      3203**DCL      4500>>IF
NXTCOD1
      5075**LABEL    5006--GOTO     5067--CALLALT
NXTCODE
      4779**LABEL    4765--CALLALT
NXTCODE1
      4889**LABEL    4878--CALLALT
NXTCODE16
      4795**LABEL    4785--CALLALT  4787--GOTO
NXTCODE17
      4802**LABEL    4798--CALLALT  4804--CALLALT
NXTCODE18
      4815**LABEL    4812--CALLALT
NXTCODE19
      4837**LABEL    4832--CALLALT
NXTCODE21
      4865**LABEL    4849--CALLALT  4852--CALLALT
NXTCODE3
      4891**LABEL    4889--CALLALT
NXTF0
      4472**LABEL    5416--CALLALT
OPER
      5483**LABEL    4289--CALLALT  4327--GOTO     4332--CALLALT  4345--CALLALT  4348--CALLALT  4376--GOTO
      4382--CALLALT  4422--CALLALT  4433--CALLALT  4456--CALLALT  4479--CALLALT  4548--GOTO     4568--CALLALT
      4606--CALLALT  4651--CALLALT  4695--GOTO     4707--GOTO     4711--CALLALT  4713--CALLALT  4788--CALLALT
      4799--CALLALT  4805--CALLALT  4813--CALLALT  4834--CALLALT  4839--CALLALT  4850--CALLALT  4880--CALLALT
      5157--CALLALT  5160--CALLALT  5162--CALLALT  5169--CALLALT  5177--CALLALT  5189--GOTO     5192--CALLALT
      5197--CALLALT  5265--GOTO     5335--CALLALT  5343--CALLALT  5354--CALLALT  5363--GOTO     5390--CALLALT
      5396--CALLALT  5397--CALLALT  5411--GOTO     5422--GOTO     5429--GOTO     5432--GOTO     5437--GOTO
      5440--GOTO     5450--GOTO     5452--GOTO     5454--GOTO     5456--GOTO     5458--GOTO     5460--GOTO
      5462--GOTO     5465--GOTO
OPER1
      5486**LABEL    5173--CALLALT  5174--CALLALT  5471--GOTO
OPER2
      5504**LABEL    4629--GOTO     5493--GOTO
OPERAD
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:272  
      5442**LABEL    4415--GOTO     4416--CALLALT
OPERFD
      5413**LABEL    4473--CALLALT
OPERNPSN
      5451**LABEL    4390--CALLALT
OPERX
      5460**LABEL    4611--GOTO     4621--GOTO     4926--GOTO     5299--GOTO
ORGS.COMP
      4175**DCL      5298>>IF
ORGS.IORG
      4177**DCL      4900>>ASSIGN   5297>>ASSIGN
ORGS.MEDIA
      4180**DCL      5141>>ASSIGN
ORGS.ORG
      4182**DCL      5290>>ASSIGN
PAD$
      3200**DCL      4331<<ASSIGN   4332<>CALL     4340>>IF       4345<>CALL     4346>>IF       4377<<ASSIGN
      4382<>CALL     4389<>CALL     4422<>CALL     5449<>CALL
PN$
      3191**DCL        29--PROC     4335<>CALL     4461<>CALL     4574<>CALL     5173<>CALL     5335<>CALL
PN$.ACSVEH_
      3192**DCL      3192--REDEF
PN$.ALTKEYS_
      3194**DCL      3194--REDEF    3194--REDEF
PN$.FPARAM_
      3193**DCL      4592--CALL     4595>>ASSIGN   4596>>ASSIGN   4597>>ASSIGN   4607>>IF       4712>>IF
      4713<>CALL
PN$.HDR_
      3193**DCL      3193--REDEF
PN$.TAB_
      3193**DCL      3193--REDEF
PN$.UHL_
      3191**DCL      3191--REDEF    3191--REDEF
PN$.V_
      3191**DCL      1769--IMP-PTR  4291>>IF       4291>>IF       4302>>IF       4302<<ASSIGN   4303<<ASSIGN
      4326>>IF       4329>>IF       4333>>IF       4347>>IF       4415>>IF       4445>>IF       4459>>IF
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:273  
      4475>>IF       4492>>IF       4497>>IF       4500>>IF       4500>>IF       4528>>IF       4592--CALL
      4607>>IF       4617>>IF       4621>>IF       4658>>CALL     4671>>IF       4679>>IF       4689>>IF
      4709>>IF       4925>>IF       5119>>IF       5207>>IF       5299>>IF       5478>>IF       5486>>IF
PN$.WSN_
      3193**DCL      3193--REDEF
RECFIELD.FIELD
      1962**DCL      1962--REDEF
RECFIELD.NFIELDS
      1955**DCL      4822>>ASSIGN
RETALT IN PROCEDURE ENQFIT
      5213**LABEL    5210--CALLALT  5245--CALLALT
SCRATCHOPN
      5272**LABEL    4313--GOTO
SEG$
      3211**DCL      1821--IMP-PTR  1825--IMP-PTR  4461<>CALL     4515<<ASSIGN   4574<>CALL     4583>>ASSIGN
      4584>>IF       4591>>IF       4597>>ASSIGN   4603>>ASSIGN   4780<<ASSIGN   4781>>ASSIGN   4782<>CALL
      4788<>CALL     4790>>ASSIGN   4792>>ASSIGN   4793>>ASSIGN   4795>>ASSIGN   4813<>CALL     4814>>ASSIGN
      4815>>ASSIGN
SETCFU
      4573**LABEL    4484--GOTO
SHREXIT
      5113**LABEL    4994--GOTO
SSS$SYSTIME
      4167**DCL-ENT  4700--CALL     4997--CALL
START$
      3226**DCL      1940--IMP-PTR  4827<<ASSIGN   4828>>ASSIGN   4829<>CALL
STOWCODE0
      4266**DCL      4595>>ASSIGN
STOWCODE1
      4269**DCL      4596>>ASSIGN
S_CUN
      3234**DCL      4696>>IF       4739>>IF       4914>>IF       4973>>ASSIGN   5200>>IF       5225>>IF
      5256>>IF       5500>>IF
T$
      3228**DCL      5218<<ASSIGN   5219<>CALL     5220>>ASSIGN
TESTOPN
PL6.E3A0      #001=FMN$OPNF File=FMN$OPNF.:E05TSI                                TUE 07/29/97 16:54 Page:274  
      4273**DCL      4302--ASSIGN
UQB$MDEQ
      4170**DCL-ENT  4345--CALL     4389--CALL     4422--CALL     4479--CALL     4606--CALL     5197--CALL
      5234--CALL     5254--CALL     5421--CALL     5449--CALL
UQB$MENQS
      4168**DCL-ENT  4332--CALL     4382--CALL     4456--CALL     4568--CALL
UQB$MENQX
      4169**DCL-ENT  5210--CALL     5243--CALL
VLP$FPRG
      1992**DCL      4809--CALL     4813--CALL     4815<<ASSIGN   4815>>ASSIGN
WRAPUP
      5141**LABEL    5381--GOTO     5388--GOTO     5398--GOTO
XTNTS.XTNS
      2002**DCL      5037<<ASSIGN   5037>>ASSIGN   5041>>ASSIGN
ZERO
      4272**DCL      4303--ASSIGN

PL6.E3A0      #002=FMN$GETFIT File=FMN$OPNF.:E05TSI                              TUE 07/29/97 16:56 Page:275  
     1489        1        /*T***********************************************************/
     1490        2        /*T*                                                         */
     1491        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1492        4        /*T*                                                         */
     1493        5        /*T***********************************************************/
     1494        6                    /*F*
     1495        7                    *     NAME:   FMN$GETFIT
     1496        8                    *
     1497        9                    *     PURPOSE:    TO READ THE FIT IF IT IS NOT ALREADY IN A
     1498       10                    *             BUFFER OR TO RETURN THE BUFFER ADDRESS AND
     1499       11                    *             BUFFER NUMBER IF IT IS ALREADY IN A DCB BUFFER.
     1500       12                    *             FMN$GETFIT SHOULD ALWAYS BE USED WHEN FILE REL
     1501       13                    *             DISK ADDRESSES HAVE BEEN ACCESSED.
     1502       14                    */
     1503       15        FMN$GETFIT: PROC(BUF$,BUFNO)ALTRET;
     1504       16                    /**/
     1505       17                    /*F*
     1506       18                    *     NAME:   FMN$READFIT
     1507       19                    *
     1508       20                    *     PURPOSE:   TO READ AND VERIFY THE FIT (OR AFIT) GRANULE.
     1509       21                    *
     1510       22                    *     DESCRIPTION:  THE FIT SET DISK ADDRESS INPUT AS FDA IS
     1511       23                    *             READ INTO BUFX(1) AND VERIFIED.
     1512       24                    *
     1513       25                    */
     1514       26                    /**/
     1515       27                    /* PARAMETER DATA */
     1516       28    1   DCL BUF$ PTR; /* POINTER TO FIT GRAN (RETURNED)*/
     1517       29    1   DCL BUFNO UBIN;
     1518       30    1   DCL FDA REDEF BUFNO SBIN;
     1519       31                    /**/
     1520       32                    /* AUTOMATIC DATA */
     1521       33                    /**/
     1522       34    1   DCL STAMP UBIN; /* PLACE TO BUILD COMPARE STAMP */
     1523       35    1   DCL LOC$ PTR; /* POINTER TO CODE03 */
     1524       36    1   DCL I SBIN; /* ERROR SUBCODE */
     1525       37    1   DCL IU REDEF I UBIN;
PL6.E3A0      #002=FMN$GETFIT File=FMN$OPNF.:E05TSI                              TUE 07/29/97 16:56 Page:276  
     1526       38    1   DCL JDCB$ PTR; /* POINTER TO THE DCB */
     1527       39    1   DCL FAST UBIN; /* FAST PATH FLAG (=1 IF SO) */
     1528       40                    /**/
     1529       41                    /* SYMREF DATA */
     1530       42                    /**/
     1531       43    1   DCL B$JIT$ PTR SYMREF; /* POINTER TO THE JIT */
     1532       44                    /**/
     1533       45                    /**/
     1534       46        %INCLUDE F$JIT_C;
     1535      476        %INCLUDE FM$MACROS;
     1536      851        %MACRO F$DCB(BASED=BASED);
     1537      852        %INCLUDE F$DCB;
     1538      901        %MEND;
     1539      902        %F$DCB(BASED="BASED(JDCB$)");
     1540      952        %FM$GRAN(BASED="BASED(BUF$)");
     1541      956        %FM$FIT(BASED="BASED(LOC$)");
     1542      959        %FM$CFU(BASED="BASED(LOC$)");
     1543      965        %CODE01;
     1544      969        %CODE03(BASED="BASED(LOC$)");
     1545      976        %INCLUDE F_ERRORS_C;
     1546     1216        %SUB FCG#='0615'O;
     1547     1217        %SUB MID#='16'O;
     1548     1218        %ERRCODE(NAME=FMN$E$BADFIT,COD#=%E$BADFIT);
     1549     1222    1   DCL FM$BUF$(0:31)PTR SYMREF;
     1550     1223    1   DCL FM_FRZERO UBIN SYMREF;
     1551     1224                    /**/
     1552     1225                    /* DEFINE EXTERNAL ROUTINES */
     1553     1226                    /**/
     1554     1227    1   DCL FMD$REDBUF ENTRY(6) ALTRET; /* READ THE FIT */
     1555     1228    1   DCL FMB$LOGERR ENTRY(11);
     1556     1229    1   DCL FMM$NSTAMP ENTRY(1); /* CHECK FILENAME */
     1557     1230    1   DCL FMO$LOCCODP ENTRY(2) ALTRET; /* CHECK FOR CODE03 */
     1558     1231                    /**/
     1559     1232    1      JDCB$=B$JIT.DCB$;
     1560     1233    1      LOC$=F$DCB.CFU$;
     1561     1234    1      STAMP=FM_FRZERO;
     1562     1235    1      IF FM$CFU.AFIT~=0 THEN STAMP=FM$CFU.FITSDA;
PL6.E3A0      #002=FMN$GETFIT File=FMN$OPNF.:E05TSI                              TUE 07/29/97 16:56 Page:277  
     1563     1236    2      DO I=0 TO 4;
     1564     1237    2         IF F$DCB.BFR.DA(I)~=0 AND (F$DCB.BFR.DA(I)=STAMP
     1565     1238    3           OR F$DCB.BFR.DA(I)=FM$CFU.FITSDA) THEN DO;
     1566     1239    3            BUF$=FM$BUF$(F$DCB.BFR.BUFX(IU));
     1567     1240    3            BUFNO=I;
     1568     1241    3            IF F$DCB.BFR.BUFX(IU)~=0 THEN GOTO CHKFIT;
     1569     1242    3            END;
     1570     1243    2         END;
     1571     1244    1      F$DCB.GTYP=FMGTFIT;
     1572     1245    1      STAMP=FM$CFU.FITSDA;
     1573     1246    1      FAST=0;
     1574     1247    1      CALL FMD$REDBUF(BUF$,BUFNO,STAMP,,-1) ALTRET(RETALT);
     1575     1248    1      IF FM$CFU.AFIT=0 THEN F$DCB.BFR.DA(BUFNO)=FM_FRZERO;
     1576     1249    1      GOTO CHKFIT;
     1577     1250                    /**/
     1578     1251    1   FMN$READFITF: ENTRY(BUF$,BUFNO/*FDA*/)ALTRET;
     1579     1252    1      FAST=1;
     1580     1253    1      GOTO READFIT;
     1581     1254    1   FMN$READFIT: ENTRY(BUF$,BUFNO/*FDA*/)ALTRET;
     1582     1255    1      FAST=0;
     1583     1256    1   READFIT:;
     1584     1257    1      JDCB$=B$JIT.DCB$;
     1585     1258    1      F$DCB.GTYP=FMGTFIT;
     1586     1259    1      CALL FMD$REDBUF(BUF$,1,FDA,0,-1,FAST)ALTRET(RETALT);
     1587     1260                    /*E*     ERROR:  FMN-E$BADFIT-A
     1588     1261                    *        MESSAGE:File% %FN% is irrecoverably lost.
     1589     1262                    *        MESSAGE1:File% %UF% has been mucked up by a system failure,
     1590     1263                    *        and is completely inaccessible. Use backup copy if needed.
     1591     1264                    */
     1592     1265                    /*
     1593     1266                    *  VERIFY THAT THIS IS FIT OR AFIT GRANULE
     1594     1267                    */
     1595     1268    1      STAMP=FDA;
     1596     1269    1   CHKFIT:;
     1597     1270    1      LOC$=PINCRW(BUF$,SIZEW(FM$GRAN)+1); /* Point to CODE01 FITword */
     1598     1271    1      IF FM$GRAN.LVL=0 THEN STAMP=0;
     1599     1272    1      IF FM$FIT.CODES.CODE(0)~=1 THEN GOTO BADFIT13;
PL6.E3A0      #002=FMN$GETFIT File=FMN$OPNF.:E05TSI                              TUE 07/29/97 16:56 Page:278  
     1600     1273    1      I=MOD(FM$FIT.CODES.NDW(0)-1,512);
     1601     1274    1      LOC$=PINCRW(LOC$,FM$FIT.CODES.ITEMX(0)-1);
     1602     1275    1      IF LOC$->CODE01.NXTNTS~=I THEN GOTO BADFIT14;
     1603     1276    1      ADDR(STAMP)->FM$GRAN.STAMP.HASH=LOC$->CODE01.HASH;
     1604     1277    1      LOC$=PALIGNW(ADDR(FM$GRAN.HDR));
     1605     1278    1      IF STAMP~=BITBIN(FM$GRAN.STAMP) THEN GOTO BADFIT15;
     1606     1279    1      IF NOT FM$GRAN.HDR THEN GOTO BADFIT16;
     1607     1280    1      LOC$=PINCRW(BUF$,SIZEW(FM$GRAN));
     1608     1281    1      CALL FMO$LOCCODP(LOC$,3)ALTRET(BADFIT18);
     1609     1282    1      CALL FMM$NSTAMP(STAMP);
     1610     1283    1      IF CODE03.NSTAMP=STAMP THEN RETURN;
     1611     1284    1      LOC$=ADDR(CODE03.NSTAMP);
     1612     1285    1      I=19;
     1613     1286    1      GOTO FMNE$BADFIT;
     1614     1287    1   BADFIT18:I=18;
     1615     1288    1      GOTO FMNE$BADFIT;
     1616     1289    1   BADFIT16:I=16;
     1617     1290    1      GOTO FMNE$BADFIT;
     1618     1291    1   BADFIT15:I=15;
     1619     1292    1      GOTO FMNE$BADFIT;
     1620     1293    1   BADFIT14:I=14;
     1621     1294    1      GOTO FMNE$BADFIT;
     1622     1295    1   BADFIT13:I=13;
     1623     1296                    /**/
     1624     1297    1   FMNE$BADFIT:
     1625     1298    1      B$JIT$->B$JIT.ERR=FMN$E$BADFIT;
     1626     1299    1      IF BUFNO<5 THEN JDCB$=F$DCB.CFU$;
     1627     1300    1      ELSE JDCB$=ADDR(BUFNO);
     1628     1301    1      CALL FMB$LOGERR(%E$FIT,I,8-2*FAST,JDCB$->FM$CFU,BUF$,0,
     1629     1302    1        SIZEW(FM$GRAN)+1,POFFW(LOC$,BUF$),STAMP);
     1630     1303    1      JDCB$=B$JIT.DCB$;
     1631     1304    1   RETALT:;
     1632     1305    1      IF FAST~=0 THEN B$JIT.ERR='0'B;
     1633     1306    1      IF BUFNO<5 THEN F$DCB.BFR.DA(BUFNO)=F$DCB.CFU$->FM$CFU.FITSDA;
     1634     1307    1      ELSE F$DCB.BFR.DA(1)=BUFNO;
     1635     1308    1      F$DCB.CSEED=I;/* RETURN SUBCODE FOR FIX */
     1636     1309    1      IF B$JIT.ERR.CODE=%E$FIT THEN B$JIT.ERR=FMN$E$BADFIT;
PL6.E3A0      #002=FMN$GETFIT File=FMN$OPNF.:E05TSI                              TUE 07/29/97 16:56 Page:279  
     1637     1310    1      ALTRETURN;
     1638     1311                    /**/
     1639     1312    1   END FMN$GETFIT;
     1640     1313        %EOD;

PL6.E3A0      #002=FMN$GETFIT File=FMN$OPNF.:E05TSI                              TUE 07/29/97 16:56 Page:280  
--  Include file information  --

   F_ERRORS_C.:E05TOU  is referenced.
   F$DCB.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FMN$GETFIT.

   Procedure FMN$GETFIT requires 282 words for executable code.
   Procedure FMN$GETFIT requires 22 words of local(AUTO) storage.

PL6.E3A0      #002=FMN$GETFIT File=FMN$OPNF.:E05TSI                              TUE 07/29/97 16:56 Page:281  

 Object Unit name= FMN$GETFIT                                 File name= FMN$OPNF.:E05TOU
 UTS= JUL 29 '97 16:56:30.12 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      1      1  FMN$GETFIT
    1   Proc  even  none   282    432  FMN$GETFIT
    2  RoData even  none    12     14  FMN$GETFIT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        2  FMN$GETFIT
     1    124          yes     yes      Std        2  FMN$READFITF
     1    131          yes     yes      Std        2  FMN$READFIT

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       6 FMD$REDBUF
 yes     yes           Std       2 FMO$LOCCODP
         yes           Std       1 FMM$NSTAMP
         yes           Std      11 FMB$LOGERR
                       nStd      0 X66_AUTO_2
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT
PL6.E3A0      #002=FMN$GETFIT File=FMN$OPNF.:E05TSI                              TUE 07/29/97 16:56 Page:282  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     B$JIT$                                FM$BUF$                               FM_FRZERO
     B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #002=FMN$GETFIT File=FMN$OPNF.:E05TSI                              TUE 07/29/97 16:56 Page:283  


     1489        1        /*T***********************************************************/
     1490        2        /*T*                                                         */
     1491        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1492        4        /*T*                                                         */
     1493        5        /*T***********************************************************/
     1494        6                    /*F*
     1495        7                    *     NAME:   FMN$GETFIT
     1496        8                    *
     1497        9                    *     PURPOSE:    TO READ THE FIT IF IT IS NOT ALREADY IN A
     1498       10                    *             BUFFER OR TO RETURN THE BUFFER ADDRESS AND
     1499       11                    *             BUFFER NUMBER IF IT IS ALREADY IN A DCB BUFFER.
     1500       12                    *             FMN$GETFIT SHOULD ALWAYS BE USED WHEN FILE REL
     1501       13                    *             DISK ADDRESSES HAVE BEEN ACCESSED.
     1502       14                    */
     1503       15        FMN$GETFIT: PROC(BUF$,BUFNO)ALTRET;

     15  1 000000   000000 700200 xent  FMN$GETFIT   TSX0  ! X66_AUTO_2
         1 000001   000026 000002                    ZERO    22,2

     1504       16                    /**/
     1505       17                    /*F*
     1506       18                    *     NAME:   FMN$READFIT
     1507       19                    *
     1508       20                    *     PURPOSE:   TO READ AND VERIFY THE FIT (OR AFIT) GRANULE.
     1509       21                    *
     1510       22                    *     DESCRIPTION:  THE FIT SET DISK ADDRESS INPUT AS FDA IS
     1511       23                    *             READ INTO BUFX(1) AND VERIFIED.
     1512       24                    *
     1513       25                    */
     1514       26                    /**/
     1515       27                    /* PARAMETER DATA */
     1516       28    1   DCL BUF$ PTR; /* POINTER TO FIT GRAN (RETURNED)*/
     1517       29    1   DCL BUFNO UBIN;
     1518       30    1   DCL FDA REDEF BUFNO SBIN;
     1519       31                    /**/
     1520       32                    /* AUTOMATIC DATA */
PL6.E3A0      #002=FMN$GETFIT File=FMN$OPNF.:E05TSI                              TUE 07/29/97 16:56 Page:284  
     1521       33                    /**/
     1522       34    1   DCL STAMP UBIN; /* PLACE TO BUILD COMPARE STAMP */
     1523       35    1   DCL LOC$ PTR; /* POINTER TO CODE03 */
     1524       36    1   DCL I SBIN; /* ERROR SUBCODE */
     1525       37    1   DCL IU REDEF I UBIN;
     1526       38    1   DCL JDCB$ PTR; /* POINTER TO THE DCB */
     1527       39    1   DCL FAST UBIN; /* FAST PATH FLAG (=1 IF SO) */
     1528       40                    /**/
     1529       41                    /* SYMREF DATA */
     1530       42                    /**/
     1531       43    1   DCL B$JIT$ PTR SYMREF; /* POINTER TO THE JIT */
     1532       44                    /**/
     1533       45                    /**/
     1534       46        %INCLUDE F$JIT_C;
     1535      476        %INCLUDE FM$MACROS;
     1536      851        %MACRO F$DCB(BASED=BASED);
     1537      852        %INCLUDE F$DCB;
     1538      901        %MEND;
     1539      902        %F$DCB(BASED="BASED(JDCB$)");
     1540      952        %FM$GRAN(BASED="BASED(BUF$)");
     1541      956        %FM$FIT(BASED="BASED(LOC$)");
     1542      959        %FM$CFU(BASED="BASED(LOC$)");
     1543      965        %CODE01;
     1544      969        %CODE03(BASED="BASED(LOC$)");
     1545      976        %INCLUDE F_ERRORS_C;
     1546     1216        %SUB FCG#='0615'O;
     1547     1217        %SUB MID#='16'O;
     1548     1218        %ERRCODE(NAME=FMN$E$BADFIT,COD#=%E$BADFIT);
     1549     1222    1   DCL FM$BUF$(0:31)PTR SYMREF;
     1550     1223    1   DCL FM_FRZERO UBIN SYMREF;
     1551     1224                    /**/
     1552     1225                    /* DEFINE EXTERNAL ROUTINES */
     1553     1226                    /**/
     1554     1227    1   DCL FMD$REDBUF ENTRY(6) ALTRET; /* READ THE FIT */
     1555     1228    1   DCL FMB$LOGERR ENTRY(11);
     1556     1229    1   DCL FMM$NSTAMP ENTRY(1); /* CHECK FILENAME */
     1557     1230    1   DCL FMO$LOCCODP ENTRY(2) ALTRET; /* CHECK FOR CODE03 */
PL6.E3A0      #002=FMN$GETFIT File=FMN$OPNF.:E05TSI                              TUE 07/29/97 16:56 Page:285  
     1558     1231                    /**/
     1559     1232    1      JDCB$=B$JIT.DCB$;

   1232  1 000002   000000 470400 xsym               LDP0    B$JIT$
         1 000003   000232 236100                    LDQ     154,,PR0
         1 000004   200010 756100                    STQ     JDCB$,,AUTO

     1560     1233    1      LOC$=F$DCB.CFU$;

   1233  1 000005   200010 471500                    LDP1    JDCB$,,AUTO
         1 000006   100066 236100                    LDQ     54,,PR1
         1 000007   200006 756100                    STQ     LOC$,,AUTO

     1561     1234    1      STAMP=FM_FRZERO;

   1234  1 000010   000000 235000 xsym               LDA     FM_FRZERO
         1 000011   200005 755100                    STA     STAMP,,AUTO

     1562     1235    1      IF FM$CFU.AFIT~=0 THEN STAMP=FM$CFU.FITSDA;

   1235  1 000012   200006 473500                    LDP3    LOC$,,AUTO
         1 000013   300000 236100                    LDQ     0,,PR3
         1 000014   001000 316003                    CANQ    512,DU
         1 000015   000021 600000 1                  TZE     s:1236

   1235  1 000016   300000 236100                    LDQ     0,,PR3
         1 000017   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 000020   200005 756100                    STQ     STAMP,,AUTO

     1563     1236    2      DO I=0 TO 4;

   1236  1 000021   200007 450100                    STZ     I,,AUTO

     1564     1237    2         IF F$DCB.BFR.DA(I)~=0 AND (F$DCB.BFR.DA(I)=STAMP

   1237  1 000022   200010 470500                    LDP0    JDCB$,,AUTO
         1 000023   200007 720100                    LXL0    I,,AUTO
PL6.E3A0      #002=FMN$GETFIT File=FMN$OPNF.:E05TSI                              TUE 07/29/97 16:56 Page:286  
         1 000024   000115 236110                    LDQ     77,X0,PR0
         1 000025   000032 316000 xsym               CANQ    B_VECTNIL+26
         1 000026   000056 600000 1                  TZE     s:1243
         1 000027   000115 236110                    LDQ     77,X0,PR0
         1 000030   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 000031   200005 116100                    CMPQ    STAMP,,AUTO
         1 000032   000040 600000 1                  TZE     s:1239
         1 000033   200006 471500                    LDP1    LOC$,,AUTO
         1 000034   000115 236110                    LDQ     77,X0,PR0
         1 000035   100000 676100                    ERQ     0,,PR1
         1 000036   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 000037   000056 601000 1                  TNZ     s:1243

     1565     1238    3           OR F$DCB.BFR.DA(I)=FM$CFU.FITSDA) THEN DO;

     1566     1239    3            BUF$=FM$BUF$(F$DCB.BFR.BUFX(IU));

   1239  1 000040   200007 721100                    LXL1    I,,AUTO
         1 000041   000115 236111                    LDQ     77,X1,PR0
         1 000042   000033 772000                    QRL     27
         1 000043   000037 376007                    ANQ     31,DL
         1 000044   000000 236006 xsym               LDQ     FM$BUF$,QL
         1 000045   200003 471500                    LDP1    @BUF$,,AUTO
         1 000046   100000 756100                    STQ     0,,PR1

     1567     1240    3            BUFNO=I;

   1240  1 000047   200007 235100                    LDA     I,,AUTO
         1 000050   200004 473500                    LDP3    @BUFNO,,AUTO
         1 000051   300000 755100                    STA     0,,PR3

     1568     1241    3            IF F$DCB.BFR.BUFX(IU)~=0 THEN GOTO CHKFIT;

   1241  1 000052   200007 720100                    LXL0    I,,AUTO
         1 000053   000115 236110                    LDQ     77,X0,PR0
         1 000054   037000 316003                    CANQ    15872,DU
         1 000055   000165 601000 1                  TNZ     CHKFIT
PL6.E3A0      #002=FMN$GETFIT File=FMN$OPNF.:E05TSI                              TUE 07/29/97 16:56 Page:287  

     1569     1242    3            END;

     1570     1243    2         END;

   1243  1 000056   200007 054100                    AOS     I,,AUTO
         1 000057   200007 235100                    LDA     I,,AUTO
         1 000060   000004 115007                    CMPA    4,DL
         1 000061   000022 604400 1                  TMOZ    s:1237

     1571     1244    1      F$DCB.GTYP=FMGTFIT;

   1244  1 000062   000064 236100                    LDQ     52,,PR0
         1 000063   000000 376000 2                  ANQ     0
         1 000064   024000 276003                    ORQ     10240,DU
         1 000065   000064 756100                    STQ     52,,PR0

     1572     1245    1      STAMP=FM$CFU.FITSDA;

   1245  1 000066   200006 471500                    LDP1    LOC$,,AUTO
         1 000067   100000 236100                    LDQ     0,,PR1
         1 000070   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 000071   200005 756100                    STQ     STAMP,,AUTO

     1573     1246    1      FAST=0;

   1246  1 000072   200011 450100                    STZ     FAST,,AUTO

     1574     1247    1      CALL FMD$REDBUF(BUF$,BUFNO,STAMP,,-1) ALTRET(RETALT);

   1247  1 000073   000001 236000 2                  LDQ     1
         1 000074   200016 756100                    STQ     FAST+5,,AUTO
         1 000075   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000076   200015 756100                    STQ     FAST+4,,AUTO
         1 000077   200005 633500                    EPPR3   STAMP,,AUTO
         1 000100   200014 453500                    STP3    FAST+3,,AUTO
         1 000101   200004 236100                    LDQ     @BUFNO,,AUTO
PL6.E3A0      #002=FMN$GETFIT File=FMN$OPNF.:E05TSI                              TUE 07/29/97 16:56 Page:288  
         1 000102   200003 235100                    LDA     @BUF$,,AUTO
         1 000103   200012 757100                    STAQ    FAST+1,,AUTO
         1 000104   200012 630500                    EPPR0   FAST+1,,AUTO
         1 000105   000023 631400 xsym               EPPR1   B_VECTNIL+19
         1 000106   000000 701000 xent               TSX1    FMD$REDBUF
         1 000107   000375 702000 1                  TSX2    RETALT

     1575     1248    1      IF FM$CFU.AFIT=0 THEN F$DCB.BFR.DA(BUFNO)=FM_FRZERO;

   1248  1 000110   200006 470500                    LDP0    LOC$,,AUTO
         1 000111   000000 236100                    LDQ     0,,PR0
         1 000112   001000 316003                    CANQ    512,DU
         1 000113   000123 601000 1                  TNZ     s:1249

   1248  1 000114   200004 471500                    LDP1    @BUFNO,,AUTO
         1 000115   100000 720100                    LXL0    0,,PR1
         1 000116   200010 473500                    LDP3    JDCB$,,AUTO
         1 000117   000000 236000 xsym               LDQ     FM_FRZERO
         1 000120   300115 676110                    ERQ     77,X0,PR3
         1 000121   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 000122   300115 656110                    ERSQ    77,X0,PR3

     1576     1249    1      GOTO CHKFIT;

   1249  1 000123   000165 710000 1                  TRA     CHKFIT

     1577     1250                    /**/
     1578     1251    1   FMN$READFITF: ENTRY(BUF$,BUFNO/*FDA*/)ALTRET;

   1251  1 000124   000000 700200 xent  FMN$READFITF TSX0  ! X66_AUTO_2
         1 000125   000026 000002                    ZERO    22,2

     1579     1252    1      FAST=1;

   1252  1 000126   000001 235007                    LDA     1,DL
         1 000127   200011 755100                    STA     FAST,,AUTO

PL6.E3A0      #002=FMN$GETFIT File=FMN$OPNF.:E05TSI                              TUE 07/29/97 16:56 Page:289  
     1580     1253    1      GOTO READFIT;

   1253  1 000130   000134 710000 1                  TRA     READFIT

     1581     1254    1   FMN$READFIT: ENTRY(BUF$,BUFNO/*FDA*/)ALTRET;

   1254  1 000131   000000 700200 xent  FMN$READFIT  TSX0  ! X66_AUTO_2
         1 000132   000026 000002                    ZERO    22,2

     1582     1255    1      FAST=0;

   1255  1 000133   200011 450100                    STZ     FAST,,AUTO

   1255  1 000134                       READFIT      null
     1583     1256    1   READFIT:;
     1584     1257    1      JDCB$=B$JIT.DCB$;

   1257  1 000134   000000 470400 xsym               LDP0    B$JIT$
         1 000135   000232 236100                    LDQ     154,,PR0
         1 000136   200010 756100                    STQ     JDCB$,,AUTO

     1585     1258    1      F$DCB.GTYP=FMGTFIT;

   1258  1 000137   200010 471500                    LDP1    JDCB$,,AUTO
         1 000140   100064 236100                    LDQ     52,,PR1
         1 000141   000000 376000 2                  ANQ     0
         1 000142   024000 276003                    ORQ     10240,DU
         1 000143   100064 756100                    STQ     52,,PR1

     1586     1259    1      CALL FMD$REDBUF(BUF$,1,FDA,0,-1,FAST)ALTRET(RETALT);

   1259  1 000144   200011 633500                    EPPR3   FAST,,AUTO
         1 000145   200017 453500                    STP3    FAST+6,,AUTO
         1 000146   000001 236000 2                  LDQ     1
         1 000147   200016 756100                    STQ     FAST+5,,AUTO
         1 000150   000002 236000 2                  LDQ     2
         1 000151   200004 235100                    LDA     @BUFNO,,AUTO
PL6.E3A0      #002=FMN$GETFIT File=FMN$OPNF.:E05TSI                              TUE 07/29/97 16:56 Page:290  
         1 000152   200014 757100                    STAQ    FAST+3,,AUTO
         1 000153   000003 236000 2                  LDQ     3
         1 000154   200003 235100                    LDA     @BUF$,,AUTO
         1 000155   200012 757100                    STAQ    FAST+1,,AUTO
         1 000156   200012 630500                    EPPR0   FAST+1,,AUTO
         1 000157   000024 631400 xsym               EPPR1   B_VECTNIL+20
         1 000160   000000 701000 xent               TSX1    FMD$REDBUF
         1 000161   000375 702000 1                  TSX2    RETALT

     1587     1260                    /*E*     ERROR:  FMN-E$BADFIT-A
     1588     1261                    *        MESSAGE:File% %FN% is irrecoverably lost.
     1589     1262                    *        MESSAGE1:File% %UF% has been mucked up by a system failure,
     1590     1263                    *        and is completely inaccessible. Use backup copy if needed.
     1591     1264                    */
     1592     1265                    /*
     1593     1266                    *  VERIFY THAT THIS IS FIT OR AFIT GRANULE
     1594     1267                    */
     1595     1268    1      STAMP=FDA;

   1268  1 000162   200004 470500                    LDP0    @BUFNO,,AUTO
         1 000163   000000 235100                    LDA     0,,PR0
         1 000164   200005 755100                    STA     STAMP,,AUTO

   1268  1 000165                       CHKFIT       null
     1596     1269    1   CHKFIT:;
     1597     1270    1      LOC$=PINCRW(BUF$,SIZEW(FM$GRAN)+1); /* Point to CODE01 FITword */

   1270  1 000165   200003 470500                    LDP0    @BUF$,,AUTO
         1 000166   000000 236100                    LDQ     0,,PR0
         1 000167   000006 036003                    ADLQ    6,DU
         1 000170   200006 756100                    STQ     LOC$,,AUTO

     1598     1271    1      IF FM$GRAN.LVL=0 THEN STAMP=0;

   1271  1 000171   000000 471500                    LDP1    0,,PR0
         1 000172   100001 236100                    LDQ     1,,PR1
         1 000173   340000 316007                    CANQ    114688,DL
PL6.E3A0      #002=FMN$GETFIT File=FMN$OPNF.:E05TSI                              TUE 07/29/97 16:56 Page:291  
         1 000174   000176 601000 1                  TNZ     s:1272

   1271  1 000175   200005 450100                    STZ     STAMP,,AUTO

     1599     1272    1      IF FM$FIT.CODES.CODE(0)~=1 THEN GOTO BADFIT13;

   1272  1 000176   200006 471500                    LDP1    LOC$,,AUTO
         1 000177   100000 236100                    LDQ     0,,PR1
         1 000200   760000 376003                    ANQ     -8192,DU
         1 000201   020000 116003                    CMPQ    8192,DU
         1 000202   000314 601000 1                  TNZ     BADFIT13

     1600     1273    1      I=MOD(FM$FIT.CODES.NDW(0)-1,512);

   1273  1 000203   100000 236100                    LDQ     0,,PR1
         1 000204   000012 772000                    QRL     10
         1 000205   001777 376007                    ANQ     1023,DL
         1 000206   000001 136007                    SBLQ    1,DL
         1 000207   001000 506007                    DIV     512,DL
         1 000210   200007 755100                    STA     I,,AUTO

     1601     1274    1      LOC$=PINCRW(LOC$,FM$FIT.CODES.ITEMX(0)-1);

   1274  1 000211   100000 720100                    LXL0    0,,PR1
         1 000212   001777 360003                    ANX0    1023,DU
         1 000213   777777 636010                    EAQ     -1,X0
         1 000214   200006 036100                    ADLQ    LOC$,,AUTO
         1 000215   200006 756100                    STQ     LOC$,,AUTO

     1602     1275    1      IF LOC$->CODE01.NXTNTS~=I THEN GOTO BADFIT14;

   1275  1 000216   200006 471500                    LDP1    LOC$,,AUTO
         1 000217   100000 236100                    LDQ     0,,PR1
         1 000220   000033 772000                    QRL     27
         1 000221   200007 116100                    CMPQ    I,,AUTO
         1 000222   000311 601000 1                  TNZ     BADFIT14

PL6.E3A0      #002=FMN$GETFIT File=FMN$OPNF.:E05TSI                              TUE 07/29/97 16:56 Page:292  
     1603     1276    1      ADDR(STAMP)->FM$GRAN.STAMP.HASH=LOC$->CODE01.HASH;

   1276  1 000223   100000 236100                    LDQ     0,,PR1
         1 000224   000011 736000                    QLS     9
         1 000225   200005 552170                    STBQ    STAMP,'70'O,AUTO

     1604     1277    1      LOC$=PALIGNW(ADDR(FM$GRAN.HDR));

   1277  1 000226   000000 473500                    LDP3    0,,PR0
         1 000227   200012 453500                    STP3    FAST+1,,AUTO
         1 000230   200012 236100                    LDQ     FAST+1,,AUTO
         1 000231   000004 036000 2                  ADLQ    4
         1 000232   770000 036007                    ADLQ    -4096,DL
         1 000233   000005 376000 2                  ANQ     5
         1 000234   200006 756100                    STQ     LOC$,,AUTO

     1605     1278    1      IF STAMP~=BITBIN(FM$GRAN.STAMP) THEN GOTO BADFIT15;

   1278  1 000235   000000 471500                    LDP1    0,,PR0
         1 000236   200005 236100                    LDQ     STAMP,,AUTO
         1 000237   100000 116100                    CMPQ    0,,PR1
         1 000240   000306 601000 1                  TNZ     BADFIT15

     1606     1279    1      IF NOT FM$GRAN.HDR THEN GOTO BADFIT16;

   1279  1 000241   100001 236100                    LDQ     1,,PR1
         1 000242   400000 316007                    CANQ    -131072,DL
         1 000243   000303 600000 1                  TZE     BADFIT16

     1607     1280    1      LOC$=PINCRW(BUF$,SIZEW(FM$GRAN));

   1280  1 000244   000000 236100                    LDQ     0,,PR0
         1 000245   000005 036003                    ADLQ    5,DU
         1 000246   200006 756100                    STQ     LOC$,,AUTO

     1608     1281    1      CALL FMO$LOCCODP(LOC$,3)ALTRET(BADFIT18);

PL6.E3A0      #002=FMN$GETFIT File=FMN$OPNF.:E05TSI                              TUE 07/29/97 16:56 Page:293  
   1281  1 000247   000006 236000 2                  LDQ     6
         1 000250   200013 756100                    STQ     FAST+2,,AUTO
         1 000251   200006 631500                    EPPR1   LOC$,,AUTO
         1 000252   200012 451500                    STP1    FAST+1,,AUTO
         1 000253   200012 630500                    EPPR0   FAST+1,,AUTO
         1 000254   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000255   000000 701000 xent               TSX1    FMO$LOCCODP
         1 000256   000300 702000 1                  TSX2    BADFIT18

     1609     1282    1      CALL FMM$NSTAMP(STAMP);

   1282  1 000257   200005 630500                    EPPR0   STAMP,,AUTO
         1 000260   200012 450500                    STP0    FAST+1,,AUTO
         1 000261   200012 630500                    EPPR0   FAST+1,,AUTO
         1 000262   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000263   000000 701000 xent               TSX1    FMM$NSTAMP
         1 000264   000000 011000                    NOP     0

     1610     1283    1      IF CODE03.NSTAMP=STAMP THEN RETURN;

   1283  1 000265   200006 470500                    LDP0    LOC$,,AUTO
         1 000266   000006 236100                    LDQ     6,,PR0
         1 000267   200005 116100                    CMPQ    STAMP,,AUTO
         1 000270   000272 601000 1                  TNZ     s:1284

   1283  1 000271   000000 702200 xent               TSX2  ! X66_ARET

     1611     1284    1      LOC$=ADDR(CODE03.NSTAMP);

   1284  1 000272   200006 236100                    LDQ     LOC$,,AUTO
         1 000273   000006 036003                    ADLQ    6,DU
         1 000274   200006 756100                    STQ     LOC$,,AUTO

     1612     1285    1      I=19;

   1285  1 000275   000023 235007                    LDA     19,DL
         1 000276   200007 755100                    STA     I,,AUTO
PL6.E3A0      #002=FMN$GETFIT File=FMN$OPNF.:E05TSI                              TUE 07/29/97 16:56 Page:294  

     1613     1286    1      GOTO FMNE$BADFIT;

   1286  1 000277   000316 710000 1                  TRA     FMNE$BADFIT

     1614     1287    1   BADFIT18:I=18;

   1287  1 000300   000022 235007       BADFIT18     LDA     18,DL
         1 000301   200007 755100                    STA     I,,AUTO

     1615     1288    1      GOTO FMNE$BADFIT;

   1288  1 000302   000316 710000 1                  TRA     FMNE$BADFIT

     1616     1289    1   BADFIT16:I=16;

   1289  1 000303   000020 235007       BADFIT16     LDA     16,DL
         1 000304   200007 755100                    STA     I,,AUTO

     1617     1290    1      GOTO FMNE$BADFIT;

   1290  1 000305   000316 710000 1                  TRA     FMNE$BADFIT

     1618     1291    1   BADFIT15:I=15;

   1291  1 000306   000017 235007       BADFIT15     LDA     15,DL
         1 000307   200007 755100                    STA     I,,AUTO

     1619     1292    1      GOTO FMNE$BADFIT;

   1292  1 000310   000316 710000 1                  TRA     FMNE$BADFIT

     1620     1293    1   BADFIT14:I=14;

   1293  1 000311   000016 235007       BADFIT14     LDA     14,DL
         1 000312   200007 755100                    STA     I,,AUTO

PL6.E3A0      #002=FMN$GETFIT File=FMN$OPNF.:E05TSI                              TUE 07/29/97 16:56 Page:295  
     1621     1294    1      GOTO FMNE$BADFIT;

   1294  1 000313   000316 710000 1                  TRA     FMNE$BADFIT

     1622     1295    1   BADFIT13:I=13;

   1295  1 000314   000015 235007       BADFIT13     LDA     13,DL
         1 000315   200007 755100                    STA     I,,AUTO

     1623     1296                    /**/
     1624     1297    1   FMNE$BADFIT:
     1625     1298    1      B$JIT$->B$JIT.ERR=FMN$E$BADFIT;

   1298  1 000316   000000 236000 0     FMNE$BADFIT  LDQ     FMN$E$BADFIT
         1 000317   000000 470400 xsym               LDP0    B$JIT$
         1 000320   000012 756100                    STQ     10,,PR0

     1626     1299    1      IF BUFNO<5 THEN JDCB$=F$DCB.CFU$;

   1299  1 000321   200004 471500                    LDP1    @BUFNO,,AUTO
         1 000322   100000 235100                    LDA     0,,PR1
         1 000323   000005 115007                    CMPA    5,DL
         1 000324   000331 603000 1                  TRC     s:1300

   1299  1 000325   200010 473500                    LDP3    JDCB$,,AUTO
         1 000326   300066 236100                    LDQ     54,,PR3
         1 000327   200010 756100                    STQ     JDCB$,,AUTO
         1 000330   000333 710000 1                  TRA     s:1301

     1627     1300    1      ELSE JDCB$=ADDR(BUFNO);

   1300  1 000331   200004 236100                    LDQ     @BUFNO,,AUTO
         1 000332   200010 756100                    STQ     JDCB$,,AUTO

     1628     1301    1      CALL FMB$LOGERR(%E$FIT,I,8-2*FAST,JDCB$->FM$CFU,BUF$,0,

   1301  1 000333   200003 473500                    LDP3    @BUF$,,AUTO
PL6.E3A0      #002=FMN$GETFIT File=FMN$OPNF.:E05TSI                              TUE 07/29/97 16:56 Page:296  
         1 000334   300000 236100                    LDQ     0,,PR3
         1 000335   000022 772000                    QRL     18
         1 000336   200012 756100                    STQ     FAST+1,,AUTO
         1 000337   200006 236100                    LDQ     LOC$,,AUTO
         1 000340   000022 772000                    QRL     18
         1 000341   200012 136100                    SBLQ    FAST+1,,AUTO
         1 000342   000004 235007                    LDA     4,DL
         1 000343   200011 135100                    SBLA    FAST,,AUTO
         1 000344   000001 735000                    ALS     1
         1 000345   200013 755100                    STA     FAST+2,,AUTO
         1 000346   200014 756100                    STQ     FAST+3,,AUTO
         1 000347   200005 634500                    EPPR4   STAMP,,AUTO
         1 000350   200025 454500                    STP4    FAST+12,,AUTO
         1 000351   200014 635500                    EPPR5   FAST+3,,AUTO
         1 000352   200024 455500                    STP5    FAST+11,,AUTO
         1 000353   000012 237000 2                  LDAQ    10
         1 000354   200022 757100                    STAQ    FAST+9,,AUTO
         1 000355   200003 236100                    LDQ     @BUF$,,AUTO
         1 000356   200010 235100                    LDA     JDCB$,,AUTO
         1 000357   200020 757100                    STAQ    FAST+7,,AUTO
         1 000360   200013 636500                    EPPR6   FAST+2,,AUTO
         1 000361   200017 456500                    STP6    FAST+6,,AUTO
         1 000362   200007 637500                    EPPR7   I,,AUTO
         1 000363   200016 457500                    STP7    FAST+5,,AUTO
         1 000364   000011 236000 2                  LDQ     9
         1 000365   200015 756100                    STQ     FAST+4,,AUTO
         1 000366   200015 630500                    EPPR0   FAST+4,,AUTO
         1 000367   000007 631400 2                  EPPR1   7
         1 000370   000000 701000 xent               TSX1    FMB$LOGERR
         1 000371   000000 011000                    NOP     0

     1629     1302    1        SIZEW(FM$GRAN)+1,POFFW(LOC$,BUF$),STAMP);
     1630     1303    1      JDCB$=B$JIT.DCB$;

   1303  1 000372   000000 470400 xsym               LDP0    B$JIT$
         1 000373   000232 236100                    LDQ     154,,PR0
         1 000374   200010 756100                    STQ     JDCB$,,AUTO
PL6.E3A0      #002=FMN$GETFIT File=FMN$OPNF.:E05TSI                              TUE 07/29/97 16:56 Page:297  

   1303  1 000375                       RETALT       null
     1631     1304    1   RETALT:;
     1632     1305    1      IF FAST~=0 THEN B$JIT.ERR='0'B;

   1305  1 000375   200011 235100                    LDA     FAST,,AUTO
         1 000376   000401 600000 1                  TZE     s:1306

   1305  1 000377   000000 470400 xsym               LDP0    B$JIT$
         1 000400   000012 450100                    STZ     10,,PR0

     1633     1306    1      IF BUFNO<5 THEN F$DCB.BFR.DA(BUFNO)=F$DCB.CFU$->FM$CFU.FITSDA;

   1306  1 000401   200004 470500                    LDP0    @BUFNO,,AUTO
         1 000402   000000 235100                    LDA     0,,PR0
         1 000403   000005 115007                    CMPA    5,DL
         1 000404   000415 603000 1                  TRC     s:1307

   1306  1 000405   000000 720100                    LXL0    0,,PR0
         1 000406   200010 471500                    LDP1    JDCB$,,AUTO
         1 000407   100066 473500                    LDP3    54,,PR1
         1 000410   300000 236100                    LDQ     0,,PR3
         1 000411   100115 676110                    ERQ     77,X0,PR1
         1 000412   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 000413   100115 656110                    ERSQ    77,X0,PR1
         1 000414   000420 710000 1                  TRA     s:1308

     1634     1307    1      ELSE F$DCB.BFR.DA(1)=BUFNO;

   1307  1 000415   200010 471500                    LDP1    JDCB$,,AUTO
         1 000416   000000 236100                    LDQ     0,,PR0
         1 000417   100116 552134                    STBQ    78,'34'O,PR1

     1635     1308    1      F$DCB.CSEED=I;/* RETURN SUBCODE FOR FIX */

   1308  1 000420   200007 235100                    LDA     I,,AUTO
         1 000421   100072 755100                    STA     58,,PR1
PL6.E3A0      #002=FMN$GETFIT File=FMN$OPNF.:E05TSI                              TUE 07/29/97 16:56 Page:298  

     1636     1309    1      IF B$JIT.ERR.CODE=%E$FIT THEN B$JIT.ERR=FMN$E$BADFIT;

   1309  1 000422   000000 473400 xsym               LDP3    B$JIT$
         1 000423   300012 236100                    LDQ     10,,PR3
         1 000424   377770 376007                    ANQ     131064,DL
         1 000425   000510 116007                    CMPQ    328,DL
         1 000426   000431 601000 1                  TNZ     s:1310

   1309  1 000427   000000 236000 0                  LDQ     FMN$E$BADFIT
         1 000430   300012 756100                    STQ     10,,PR3

     1637     1310    1      ALTRETURN;

   1310  1 000431   000000 702200 xent               TSX2  ! X66_AALT

FMN$E$BADFIT
 Sect OctLoc
   0     000   061516 002572                                                    1...

(unnamed)
 Sect OctLoc
   2     000   743777 777777   000027 006000   000002 006000   000003 006000    ................
   2     004   000001 400000   777777 007777   000005 006000   000011 000000    ................
   2     010   000000 000051   000010 006000   000002 006000   000010 006000    ...)............
     1638     1311                    /**/
     1639     1312    1   END FMN$GETFIT;
     1640     1313        %EOD;

PL6.E3A0      #002=FMN$GETFIT File=FMN$OPNF.:E05TSI                              TUE 07/29/97 16:56 Page:299  
--  Include file information  --

   F_ERRORS_C.:E05TOU  is referenced.
   F$DCB.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FMN$GETFIT.
PL6.E3A0      #002=FMN$GETFIT File=FMN$OPNF.:E05TSI                              TUE 07/29/97 16:56 Page:300  

 **** Variables and constants ****

  ****  Section 000 RoData FMN$GETFIT

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/b STRC        r     1 FMN$E$BADFIT

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @BUF$                      4-0-0/w PTR         r     1 @BUFNO
    *0-0-0/w PTR         r     1 BUF$                      *0-0-0/w UBIN        r     1 BUFNO
    11-0-0/w UBIN        r     1 FAST                      *0-0-0/w SBIN        r     1 FDA
     7-0-0/w SBIN        r     1 I                          7-0-0/w UBIN        r     1 IU
    10-0-0/w PTR         r     1 JDCB$                      6-0-0/w PTR         r     1 LOC$
     5-0-0/w UBIN        r     1 STAMP

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 FM$BUF$(0:31)
     0-0-0/w UBIN        r     1 FM_FRZERO

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/w STRC(576)   r     1 CODE01
     0-0-0/w STRC(324)   r     1 CODE03                     0-0-0/d ASTR(3528)  r     1 F$DCB
     0-0-0/w STRC(288)   r     1 FM$CFU                     0-0-0/w STRC(1116)  r     1 FM$FIT
PL6.E3A0      #002=FMN$GETFIT File=FMN$OPNF.:E05TSI                              TUE 07/29/97 16:56 Page:301  
     0-0-0/w STRC(180)   r     1 FM$GRAN


   Procedure FMN$GETFIT requires 282 words for executable code.
   Procedure FMN$GETFIT requires 22 words of local(AUTO) storage.
PL6.E3A0      #002=FMN$GETFIT File=FMN$OPNF.:E05TSI                              TUE 07/29/97 16:56 Page:302  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=FMN$GETFIT File=FMN$OPNF.:E05TSI                              TUE 07/29/97 16:56 Page:303  
          MINI XREF LISTING

B$JIT.DCB$
       463**DCL      1232>>ASSIGN   1257>>ASSIGN   1303>>ASSIGN
B$JIT.ERR
       373**DCL      1298<<ASSIGN   1305<<ASSIGN   1309<<ASSIGN
B$JIT.ERR.CODE
       374**DCL      1309>>IF
B$JIT.ERR.MID
       374**DCL       374--REDEF
B$JIT$
        43**DCL       368--IMP-PTR  1232>>ASSIGN   1257>>ASSIGN   1298>>ASSIGN   1303>>ASSIGN   1305>>ASSIGN
      1309>>IF       1309>>ASSIGN
BADFIT13
      1295**LABEL    1272--GOTO
BADFIT14
      1293**LABEL    1275--GOTO
BADFIT15
      1291**LABEL    1278--GOTO
BADFIT16
      1289**LABEL    1279--GOTO
BADFIT18
      1287**LABEL    1281--CALLALT
BUF$
        28**DCL        15--PROC      953--IMP-PTR  1239<<ASSIGN   1247<>CALL     1251--ENTRY    1254--ENTRY
      1259<>CALL     1270>>ASSIGN   1271>>IF       1277>>ASSIGN   1278>>IF       1279>>IF       1280>>ASSIGN
      1301<>CALL     1301>>CALL
BUFNO
        29**DCL        15--PROC       30--REDEF    1240<<ASSIGN   1247<>CALL     1248>>ASSIGN   1251--ENTRY
      1254--ENTRY    1299>>IF       1300--ASSIGN   1306>>IF       1306>>ASSIGN   1307>>ASSIGN
CHKFIT
      1268**LABEL    1241--GOTO     1249--GOTO
CODE01.HASH
       966**DCL      1276>>ASSIGN
PL6.E3A0      #002=FMN$GETFIT File=FMN$OPNF.:E05TSI                              TUE 07/29/97 16:56 Page:304  
CODE01.NXTNTS
       966**DCL      1275>>IF
CODE01.XTNT
       966**DCL       967--REDEF
CODE03.NSTAMP
       973**DCL      1283>>IF       1284--ASSIGN
F$DCB.ACTPOS
       928**DCL       928--REDEF
F$DCB.ARS
       903**DCL       903--REDEF
F$DCB.ATTR
       921**DCL       922--REDEF
F$DCB.BFR.BUFX
       948**DCL      1239>>ASSIGN   1241>>IF
F$DCB.BFR.DA
       948**DCL      1237>>IF       1237>>IF       1237>>IF       1248<<ASSIGN   1306<<ASSIGN   1307<<ASSIGN
F$DCB.BORROW
       936**DCL       936--REDEF     936--REDEF     936--REDEF
F$DCB.CFU$
       937**DCL      1233>>ASSIGN   1299>>ASSIGN   1306>>ASSIGN
F$DCB.CSEED
       940**DCL      1308<<ASSIGN
F$DCB.DCBNAME.L
       950**DCL       950--IMP-SIZ
F$DCB.EOMCHAR
       907**DCL       907--REDEF
F$DCB.FLDID
       931**DCL       931--REDEF
F$DCB.FORM$
       925**DCL       925--REDEF
F$DCB.FSECT
       941**DCL       941--REDEF
F$DCB.FSN
       918**DCL       918--REDEF     918--REDEF     919--REDEF
F$DCB.GTYP
       932**DCL      1244<<ASSIGN   1258<<ASSIGN
PL6.E3A0      #002=FMN$GETFIT File=FMN$OPNF.:E05TSI                              TUE 07/29/97 16:56 Page:305  
F$DCB.HEADER$
       924**DCL       924--REDEF
F$DCB.IXTNSIZE
       922**DCL       922--REDEF
F$DCB.LASTSTA$
       912**DCL       912--REDEF
F$DCB.LVL
       937**DCL       937--REDEF
F$DCB.NAME.C
       912**DCL       912--REDEF
F$DCB.NOEOF
       933**DCL       933--REDEF
F$DCB.NRECS
       923**DCL       923--REDEF
F$DCB.NRECX
       942**DCL       942--REDEF
F$DCB.OHDR
       934**DCL       934--REDEF
F$DCB.ORG
       917**DCL       917--REDEF
F$DCB.PRECNO
       940**DCL       940--REDEF
F$DCB.RCSZ
       945**DCL       945--REDEF
F$DCB.RES
       913**DCL       913--REDEF
F$DCB.SETX
       925**DCL       925--REDEF
F$DCB.TAB$
       924**DCL       925--REDEF
F$DCB.TDA
       939**DCL       939--REDEF
F$DCB.WSN
       914**DCL       914--REDEF
FAST
        39**DCL      1246<<ASSIGN   1252<<ASSIGN   1255<<ASSIGN   1259<>CALL     1301>>CALL     1305>>IF
PL6.E3A0      #002=FMN$GETFIT File=FMN$OPNF.:E05TSI                              TUE 07/29/97 16:56 Page:306  
FDA
        30**DCL      1259<>CALL     1268>>ASSIGN
FM$BUF$
      1222**DCL      1239>>ASSIGN
FM$CFU
       960**DCL      1301<>CALL
FM$CFU.ACCTX
       961**DCL       961--REDEF
FM$CFU.AFIT
       960**DCL      1235>>IF       1248>>IF
FM$CFU.FITSDA
       961**DCL      1235>>ASSIGN   1237>>IF       1245>>ASSIGN   1306>>ASSIGN
FM$FIT.CODES.CODE
       957**DCL      1272>>IF
FM$FIT.CODES.ITEMX
       957**DCL      1274>>ASSIGN
FM$FIT.CODES.NDW
       957**DCL      1273>>ASSIGN
FM$GRAN
       953**DCL      1270--ASSIGN   1280--ASSIGN   1301--CALL
FM$GRAN.HDR
       953**DCL      1277--ASSIGN   1279>>IF
FM$GRAN.LVL
       953**DCL      1271>>IF
FM$GRAN.STAMP
       953**DCL      1278>>IF
FM$GRAN.STAMP.HASH
       953**DCL      1276<<ASSIGN
FMB$LOGERR
      1228**DCL-ENT  1301--CALL
FMD$REDBUF
      1227**DCL-ENT  1247--CALL     1259--CALL
FMM$NSTAMP
      1229**DCL-ENT  1282--CALL
FMN$E$BADFIT
      1219**DCL      1298>>ASSIGN   1309>>ASSIGN
PL6.E3A0      #002=FMN$GETFIT File=FMN$OPNF.:E05TSI                              TUE 07/29/97 16:56 Page:307  
FMNE$BADFIT
      1298**LABEL    1286--GOTO     1288--GOTO     1290--GOTO     1292--GOTO     1294--GOTO
FMO$LOCCODP
      1230**DCL-ENT  1281--CALL
FM_FRZERO
      1223**DCL      1234>>ASSIGN   1248>>ASSIGN
I
        36**DCL        37--REDEF    1236<<DOINDEX  1237>>IF       1237>>IF       1237>>IF       1240>>ASSIGN
      1273<<ASSIGN   1275>>IF       1285<<ASSIGN   1287<<ASSIGN   1289<<ASSIGN   1291<<ASSIGN   1293<<ASSIGN
      1295<<ASSIGN   1301<>CALL     1308>>ASSIGN
IU
        37**DCL      1239>>ASSIGN   1241>>IF
JDCB$
        38**DCL       903--IMP-PTR  1232<<ASSIGN   1233>>ASSIGN   1237>>IF       1237>>IF       1237>>IF
      1239>>ASSIGN   1241>>IF       1244>>ASSIGN   1248>>ASSIGN   1257<<ASSIGN   1258>>ASSIGN   1299<<ASSIGN
      1299>>ASSIGN   1300<<ASSIGN   1301>>CALL     1303<<ASSIGN   1306>>ASSIGN   1306>>ASSIGN   1307>>ASSIGN
      1308>>ASSIGN
LOC$
        35**DCL       957--IMP-PTR   960--IMP-PTR   970--IMP-PTR  1233<<ASSIGN   1235>>IF       1235>>ASSIGN
      1237>>IF       1245>>ASSIGN   1248>>IF       1270<<ASSIGN   1272>>IF       1273>>ASSIGN   1274<<ASSIGN
      1274>>ASSIGN   1274>>ASSIGN   1275>>IF       1276>>ASSIGN   1277<<ASSIGN   1280<<ASSIGN   1281<>CALL
      1283>>IF       1284<<ASSIGN   1284>>ASSIGN   1301>>CALL
READFIT
      1255**LABEL    1253--GOTO
RETALT
      1303**LABEL    1247--CALLALT  1259--CALLALT
STAMP
        34**DCL      1234<<ASSIGN   1235<<ASSIGN   1237>>IF       1245<<ASSIGN   1247<>CALL     1268<<ASSIGN
      1271<<ASSIGN   1276--ASSIGN   1278>>IF       1282<>CALL     1283>>IF       1301<>CALL

PL6.E3A0      #003=FMN$CHKFLACN File=FMN$OPNF.:E05TSI                            TUE 07/29/97 16:56 Page:308  
     1641        1        /*T***********************************************************/
     1642        2        /*T*                                                         */
     1643        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1644        4        /*T*                                                         */
     1645        5        /*T***********************************************************/
     1646        6                    /*F*  NAME:   FMN$CHKFLACN
     1647        7                    *     PURPOSE: VERIFY THAT THE FILENAME GIVEN AS THE OPEN
     1648        8                    *              PARAMETER IS A LEGAL FILENAME, AND THAT THE ACCT IS
     1649        9                    *              7-BIT ASCII CHARACTERS.
     1650       10                    */
     1651       11        FMN$CHKFLACN: PROC(JDCB$) ALTRET;
     1652       12                    /**/
     1653       13        %MACRO F$DCB#(BASED=BASED);
     1654       14        %INCLUDE F$DCB;
     1655       63        %MEND;
     1656       64        %F$DCB#(BASED="BASED(JDCB$)");
     1657      114        %INCLUDE F$JIT_C;
     1658      544        %INCLUDE CP_6_SUBS;
     1659     1084        %INCLUDE F_ERRORS_C;
     1660     1324        %INCLUDE FM$MACROS;
     1661     1699        %SUB FCG#='0615'O;
     1662     1700        %SUB MID#='16'O;
     1663     1701                    /**/
     1664     1702                    /* ENTRY REFS */
     1665     1703                    /**/
     1666     1704    1   DCL FMN$SETX ENTRY(1) ALTRET; /* ST DCB.SETX FROM INPUT TEXT */
     1667     1705                    /**/
     1668     1706                    /* PARAMETER DATA */
     1669     1707                    /**/
     1670     1708    1   DCL JDCB$ PTR; /* POINTER TO CURRENT DCB */
     1671     1709    1   DCL B$JIT$ PTR SYMREF; /* POINTER TO JIT */
     1672     1710    1   DCL FM_SYSSETX UBIN SYMREF;
     1673     1711                    /**/
     1674     1712                    /* SPECIAL BASED ITEMS */
     1675     1713                    /**/
     1676     1714    1   DCL NAME BASED(P1$) CHAR(31);
     1677     1715    1   DCL ACCT BASED BIT(72) ALIGNED;
PL6.E3A0      #003=FMN$CHKFLACN File=FMN$OPNF.:E05TSI                            TUE 07/29/97 16:56 Page:309  
     1678     1716                    /* CONSTANTS */
     1679     1717    1   DCL NASCII7 CONSTANT BIT(72) INIT('600600600600600600600600'O);
     1680     1718    1   DCL 1 TFCHARS CONSTANT,
     1681     1719    1         2 T CHAR(0) INIT( /* ANSTAPE ONLY CHARS */
     1682     1720    1   '!"%&''()*+,./;<=>?'),
     1683     1721    1         2 TF CHAR(0) INIT( /* COMMON TO BOTH */
     1684     1722    1   ':ALSKDJFHGYTURIEOWPQBVNCMXZ1234567890-_'),
     1685     1723    1         2 F CHAR(0) INIT( /* FILE ONLY */
     1686     1724    1   '$alskdjfhgyturieowpqbvncmxz[\]^`{|}~');
     1687     1725    1   DCL VALIDCHARS REDEF TFCHARS CHAR(92);
     1688     1726    1   DCL FM_STARCHARS CONSTANT SYMDEF CHAR(8)INIT(' GLASNXI');
     1689     1727        %ERRCODE(NAME=FMN$E$INVSTAR,COD#=%E$INVSTAR);
     1690     1731        %ERRCODE(NAME=FMN$E$BADFNME,COD#=%E$BADFNME);
     1691     1735                    /**/
     1692     1736                    /* AUTOMATIC DATA */
     1693     1737                    /**/
     1694     1738    1   DCL I SBIN; /* INDEX HOLDER */
     1695     1739    1   DCL N SBIN; /* FILENAME SIZE */
     1696     1740    1   DCL P1$ PTR; /* INTERNAL POINTER */
     1697     1741        %EJECT;
PL6.E3A0      #003=FMN$CHKFLACN File=FMN$OPNF.:E05TSI                            TUE 07/29/97 16:56 Page:310  
     1698     1742                    /* PROCEDURE */
     1699     1743    1      N=JDCB$->F$DCB.NAME.L;
     1700     1744    1      JDCB$->F$DCB.STARX=0;
     1701     1745    1      IF N > 31 THEN GOTO FMNE$BADFNME;
     1702     1746                    /*E*     ERROR:  FMN-E$BADFNME-E
     1703     1747                    *        MESSAGE:Improper name or account%: %FN%
     1704     1748                    *        MESSAGE1: A permanent filename must consist of 1 to 31
     1705     1749                    characters: alpha-numeric or $-_:[\]^'{|}~. An account
     1706     1750                    name must consist of non-control, 7-bit ASCII characters.
     1707     1751                    A standard format ANS tape filename must be 1 to 17
     1708     1752                    characters: upper case, numeric, !"%&'()*+,./?;:<>=-.
     1709     1753                    */
     1710     1754    1      IF F$DCB.IASN~=%FILE# THEN GOTO NOTSTRSCR;
     1711     1755        %EJECT;
PL6.E3A0      #003=FMN$CHKFLACN File=FMN$OPNF.:E05TSI                            TUE 07/29/97 16:56 Page:311  
     1712     1756    2      IF F$DCB.FUN=%CREATE# AND F$DCB.DISP=%SCRATCH# THEN DO;
     1713     1757    2         F$DCB.SETX=FM_SYSSETX;
     1714     1758    2   RET:  RETURN;
     1715     1759    2         END;
     1716     1760    1      IF SUBSTR(F$DCB.NAME.C,0,1)~='*' THEN GOTO NOTSTRSCR;
     1717     1761    1      F$DCB.SETX=FM_SYSSETX;
     1718     1762    1      F$DCB.STARF='1'B;
     1719     1763    1      IF N~=2 THEN RETURN;
     1720     1764    1      CALL INDEX(I,SUBSTR(F$DCB.NAME.C,1,1),FM_STARCHARS) ALTRET(RET);
     1721     1765    1      IF I<SIZEW(B$JIT.STAR) THEN F$DCB.STARX=I;
     1722     1766    2      DO CASE(I); /* NOW DO THE ACCESS CONTROL */
     1723     1767    2      CASE(0,1,2); /* G, BLANK,  AND L: UP FOR GRABS */
     1724     1768    2         RETURN;
     1725     1769    2      CASE(3); /* A: INPUT TO ALL, ELSE CP ONLY */
     1726     1770    2   CPFILE: IF F$DCB.FUN=%IN# OR F$DCB.WSR=4 THEN RETURN;
     1727     1771    2      CASE(4); /* S: SAME AS A, BUT SHARE ALL */
     1728     1772    2         F$DCB.SHARE=%ALL#;
     1729     1773    2         GOTO CPFILE;
     1730     1774    2      CASE(7); /* I: ONLY FMSEC OR ASL */
     1731     1775    2         IF F$DCB.FUN=%IN# AND B$JIT.PRIV.ACTIVE.FMSEC
     1732     1776    2           OR F$DCB.WSR=6 THEN RETURN;
     1733     1777    2      END;     /* N, X, OR OTHERWISE: ONLY MONITOR */
     1734     1778    1      IF F$DCB.WSR=1 THEN RETURN;
     1735     1779                    /*E* ERROR: FMN-E$INVSTAR-E
     1736     1780                    *        MESSAGE: File %FN is not accessible from your domain
     1737     1781                  *        MESSAGE1:*N and *X are reserved for CP-6, *A and *S may be opened
     1738     1782                   *        only input except by a command processor, and *I is reserved for
     1739     1783                    *        alternate shared libraries.% %FN was the culprit this time.%
     1740     1784                    */
     1741     1785    1   FMNE$INVSTAR: B$JIT$->B$JIT.ERR=FMN$E$INVSTAR;
     1742     1786    1      ALTRETURN;
     1743     1787    1   NOTSTRSCR:;
     1744     1788    2      IF F$DCB.FUN=%CREATE# THEN DO;
     1745     1789    2         IF N=0 THEN GOTO FMNE$BADFNME;
     1746     1790    2         P1$=ADDR(JDCB$->F$DCB.NAME.C);
     1747     1791                    /*
     1748     1792                    *  FOR ALL CREATE OPENS VERIFY THAT THE CHARACTERS IN THE FILE NAME
PL6.E3A0      #003=FMN$CHKFLACN File=FMN$OPNF.:E05TSI                            TUE 07/29/97 16:56 Page:312  
     1749     1793                    *  CONSIST OF THE FOLLOWING:
     1750     1794                    *                       1)  UPPER CASE LETTERS
     1751     1795                    *                       2)  LOWER CASE LETTERS
     1752     1796                    *                       3)  NUMBERS
     1753     1797                    *                       4)  SPECIAL CHARACTERS : $ - _
     1754     1798                    */
     1755     1799    2         IF F$DCB.IASN=%FILE# OR F$DCB.ORG<%FIXED# OR F$DCB.ORG>%UNDEF#
     1756     1800    3         THEN DO WHILE(N>0);
     1757     1801    3            N=N-1;
     1758     1802    3            CALL INDEX(I,SUBSTR(NAME,N,1),SUBSTR(VALIDCHARS,SIZEC(TFCHARS.T),
     1759     1803    3              SIZEC(TFCHARS.TF)+SIZEC(TFCHARS.F))) ALTRET(FMNE$BADFNME);
     1760     1804    3            END;
     1761     1805                    /*
     1762     1806                    *  UNLESS ITS AN ANS TAPE FORMAT FILE, WHICH MUST BE:
     1763     1807                    *                        1)  UPPER CASE LETTERS
     1764     1808                    *                        2)  NUMBERS
     1765     1809                    *                        3   SPECIALS :-!"%&'()*+,./?;<>=
     1766     1810                    */
     1767     1811    3         ELSE DO WHILE(N>0);
     1768     1812    3            N=N-1;
     1769     1813    3            CALL INDEX(I,SUBSTR(NAME,N,1),SUBSTR(VALIDCHARS,0,
     1770     1814    3              SIZEC(TFCHARS.T)+SIZEC(TFCHARS.TF))) ALTRET(FMNE$BADFNME);
     1771     1815    3            END;
     1772     1816        %EJECT;
PL6.E3A0      #003=FMN$CHKFLACN File=FMN$OPNF.:E05TSI                            TUE 07/29/97 16:56 Page:313  
     1773     1817    2   CHKACCN:;
     1774     1818                    /*
     1775     1819                    *  NOW VERIFY ACCOUNT NUMBER
     1776     1820                    */
     1777     1821    2         IF ADDR(JDCB$->F$DCB.ACCT)->ACCT&NASCII7 THEN GOTO FMNE$BADFNME;
     1778     1822    2         CALL INDEX(I,' ',F$DCB.ACCT);
     1779     1823    2         IF I=0 OR SUBSTR(F$DCB.ACCT,I,8-I)~=' ' THEN GOTO FMNE$BADFNME;
     1780     1824    2         CALL INDEX(I,BINASC(0),F$DCB.ACCT,0,'037'O)ALTRET(CHKACCT1);
     1781     1825    2         GOTO FMNE$BADFNME; /* MUST NOT HAVE CONTROL CHARS OR IMBEDDED BLANKS*/
     1782     1826    2   CHKACCT1: CALL INDEX(I,BINASC(127),F$DCB.ACCT)ALTRET(SELECTPS);
     1783     1827    2         GOTO FMNE$BADFNME;/* NOT EVEN DEL */
     1784     1828    2         END;
     1785     1829    1   SELECTPS:;
     1786     1830    2      IF F$DCB.IASN=%TAPE# THEN DO;
     1787     1831    2         IF F$DCB.NAME.L>17 AND F$DCB.ORG>=%FIXED#
     1788     1832    2           AND F$DCB.ORG~=%RESTRICT#
     1789     1833    2         THEN GOTO FMNE$BADFNME;
     1790     1834    2         END;
     1791     1835    1      IF F$DCB.IASN~=%FILE# THEN RETURN;
     1792     1836    1      IF F$DCB.PSN~=' ' THEN CALL FMN$SETX(F$DCB.PSN)ALTRET(RETALT);
     1793     1837    1      ELSE F$DCB.SETX=0;
     1794     1838    1      RETURN;
     1795     1839    1   FMN$CHKACCN: ENTRY(JDCB$)ALTRET;
     1796     1840    1      GOTO CHKACCN;
     1797     1841                    /**/
     1798     1842    1   FMNE$BADFNME: B$JIT$->B$JIT.ERR=FMN$E$BADFNME;
     1799     1843    1   RETALT:
     1800     1844    1      ALTRETURN;
     1801     1845    1   END FMN$CHKFLACN;
     1802     1846        %EOD;

PL6.E3A0      #003=FMN$CHKFLACN File=FMN$OPNF.:E05TSI                            TUE 07/29/97 16:56 Page:314  
--  Include file information  --

   FM$MACROS.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
   F$DCB.:E05TOU  is referenced.
      No diagnostics issued in procedure FMN$CHKFLACN.

   Procedure FMN$CHKFLACN requires 226 words for executable code.
   Procedure FMN$CHKFLACN requires 10 words of local(AUTO) storage.

PL6.E3A0      #003=FMN$CHKFLACN File=FMN$OPNF.:E05TSI                            TUE 07/29/97 16:56 Page:315  

 Object Unit name= FMN$CHKFLACN                               File name= FMN$OPNF.:E05TOU
 UTS= JUL 29 '97 16:56:48.64 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS     29     35  FMN$CHKFLACN
    1   Proc  even  none   226    342  FMN$CHKFLACN
    2  RoData even  none     5      5  FMN$CHKFLACN

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        1  FMN$CHKFLACN
     1    333          yes     yes      Std        1  FMN$CHKACCN

  ****  Data defs  ****

 Sect OctLoc  Name                           Sect OctLoc  Name
    0     31  FM_STARCHARS

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 FMN$SETX
                       nStd      0 X66_AUTO_1
                       nStd      0 X66_ARET
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AALT
PL6.E3A0      #003=FMN$CHKFLACN File=FMN$OPNF.:E05TSI                            TUE 07/29/97 16:56 Page:316  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     B$JIT$                                FM_SYSSETX                            B_VECTNIL
PL6.E3A0      #003=FMN$CHKFLACN File=FMN$OPNF.:E05TSI                            TUE 07/29/97 16:56 Page:317  


     1641        1        /*T***********************************************************/
     1642        2        /*T*                                                         */
     1643        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1644        4        /*T*                                                         */
     1645        5        /*T***********************************************************/
     1646        6                    /*F*  NAME:   FMN$CHKFLACN
     1647        7                    *     PURPOSE: VERIFY THAT THE FILENAME GIVEN AS THE OPEN
     1648        8                    *              PARAMETER IS A LEGAL FILENAME, AND THAT THE ACCT IS
     1649        9                    *              7-BIT ASCII CHARACTERS.
     1650       10                    */
     1651       11        FMN$CHKFLACN: PROC(JDCB$) ALTRET;

     11  1 000000   000000 700200 xent  FMN$CHKFLACN TSX0  ! X66_AUTO_1
         1 000001   000012 000001                    ZERO    10,1

     1652       12                    /**/
     1653       13        %MACRO F$DCB#(BASED=BASED);
     1654       14        %INCLUDE F$DCB;
     1655       63        %MEND;
     1656       64        %F$DCB#(BASED="BASED(JDCB$)");
     1657      114        %INCLUDE F$JIT_C;
     1658      544        %INCLUDE CP_6_SUBS;
     1659     1084        %INCLUDE F_ERRORS_C;
     1660     1324        %INCLUDE FM$MACROS;
     1661     1699        %SUB FCG#='0615'O;
     1662     1700        %SUB MID#='16'O;
     1663     1701                    /**/
     1664     1702                    /* ENTRY REFS */
     1665     1703                    /**/
     1666     1704    1   DCL FMN$SETX ENTRY(1) ALTRET; /* ST DCB.SETX FROM INPUT TEXT */
     1667     1705                    /**/
     1668     1706                    /* PARAMETER DATA */
     1669     1707                    /**/
     1670     1708    1   DCL JDCB$ PTR; /* POINTER TO CURRENT DCB */
     1671     1709    1   DCL B$JIT$ PTR SYMREF; /* POINTER TO JIT */
     1672     1710    1   DCL FM_SYSSETX UBIN SYMREF;
PL6.E3A0      #003=FMN$CHKFLACN File=FMN$OPNF.:E05TSI                            TUE 07/29/97 16:56 Page:318  
     1673     1711                    /**/
     1674     1712                    /* SPECIAL BASED ITEMS */
     1675     1713                    /**/
     1676     1714    1   DCL NAME BASED(P1$) CHAR(31);
     1677     1715    1   DCL ACCT BASED BIT(72) ALIGNED;
     1678     1716                    /* CONSTANTS */
     1679     1717    1   DCL NASCII7 CONSTANT BIT(72) INIT('600600600600600600600600'O);
     1680     1718    1   DCL 1 TFCHARS CONSTANT,
     1681     1719    1         2 T CHAR(0) INIT( /* ANSTAPE ONLY CHARS */
     1682     1720    1   '!"%&''()*+,./;<=>?'),
     1683     1721    1         2 TF CHAR(0) INIT( /* COMMON TO BOTH */
     1684     1722    1   ':ALSKDJFHGYTURIEOWPQBVNCMXZ1234567890-_'),
     1685     1723    1         2 F CHAR(0) INIT( /* FILE ONLY */
     1686     1724    1   '$alskdjfhgyturieowpqbvncmxz[\]^`{|}~');
     1687     1725    1   DCL VALIDCHARS REDEF TFCHARS CHAR(92);
     1688     1726    1   DCL FM_STARCHARS CONSTANT SYMDEF CHAR(8)INIT(' GLASNXI');
     1689     1727        %ERRCODE(NAME=FMN$E$INVSTAR,COD#=%E$INVSTAR);
     1690     1731        %ERRCODE(NAME=FMN$E$BADFNME,COD#=%E$BADFNME);
     1691     1735                    /**/
     1692     1736                    /* AUTOMATIC DATA */
     1693     1737                    /**/
     1694     1738    1   DCL I SBIN; /* INDEX HOLDER */
     1695     1739    1   DCL N SBIN; /* FILENAME SIZE */
     1696     1740    1   DCL P1$ PTR; /* INTERNAL POINTER */
     1697     1741        %EJECT;
PL6.E3A0      #003=FMN$CHKFLACN File=FMN$OPNF.:E05TSI                            TUE 07/29/97 16:56 Page:319  
     1698     1742                    /* PROCEDURE */
     1699     1743    1      N=JDCB$->F$DCB.NAME.L;

   1743  1 000002   200003 470500                    LDP0    @JDCB$,,AUTO
         1 000003   000000 471500                    LDP1    0,,PR0
         1 000004   100010 236100                    LDQ     8,,PR1
         1 000005   000033 772000                    QRL     27
         1 000006   200005 756100                    STQ     N,,AUTO

     1700     1744    1      JDCB$->F$DCB.STARX=0;

   1744  1 000007   000000 236000 2                  LDQ     0
         1 000010   100064 356100                    ANSQ    52,,PR1

     1701     1745    1      IF N > 31 THEN GOTO FMNE$BADFNME;

   1745  1 000011   200005 235100                    LDA     N,,AUTO
         1 000012   000037 115007                    CMPA    31,DL
         1 000013   000336 605400 1                  TPNZ    FMNE$BADFNME

     1702     1746                    /*E*     ERROR:  FMN-E$BADFNME-E
     1703     1747                    *        MESSAGE:Improper name or account%: %FN%
     1704     1748                    *        MESSAGE1: A permanent filename must consist of 1 to 31
     1705     1749                    characters: alpha-numeric or $-_:[\]^'{|}~. An account
     1706     1750                    name must consist of non-control, 7-bit ASCII characters.
     1707     1751                    A standard format ANS tape filename must be 1 to 17
     1708     1752                    characters: upper case, numeric, !"%&'()*+,./?;:<>=-.
     1709     1753                    */
     1710     1754    1      IF F$DCB.IASN~=%FILE# THEN GOTO NOTSTRSCR;

   1754  1 000014   000000 471500                    LDP1    0,,PR0
         1 000015   100103 236100                    LDQ     67,,PR1
         1 000016   000777 376007                    ANQ     511,DL
         1 000017   000001 116007                    CMPQ    1,DL
         1 000020   000153 601000 1                  TNZ     NOTSTRSCR

     1711     1755        %EJECT;
PL6.E3A0      #003=FMN$CHKFLACN File=FMN$OPNF.:E05TSI                            TUE 07/29/97 16:56 Page:320  
     1712     1756    2      IF F$DCB.FUN=%CREATE# AND F$DCB.DISP=%SCRATCH# THEN DO;

   1756  1 000021   100032 236100                    LDQ     26,,PR1
         1 000022   000777 376003                    ANQ     511,DU
         1 000023   000003 116003                    CMPQ    3,DU
         1 000024   000034 601000 1                  TNZ     s:1760
         1 000025   100032 236100                    LDQ     26,,PR1
         1 000026   000777 376007                    ANQ     511,DL
         1 000027   000001 116007                    CMPQ    1,DL
         1 000030   000034 601000 1                  TNZ     s:1760

     1713     1757    2         F$DCB.SETX=FM_SYSSETX;

   1757  1 000031   000000 720000 xsym               LXL0    FM_SYSSETX
         1 000032   100051 440100                    SXL0    41,,PR1

     1714     1758    2   RET:  RETURN;

   1758  1 000033   000000 702200 xent  RET          TSX2  ! X66_ARET

     1715     1759    2         END;
     1716     1760    1      IF SUBSTR(F$DCB.NAME.C,0,1)~='*' THEN GOTO NOTSTRSCR;

   1760  1 000034   100010 236100                    LDQ     8,,PR1
         1 000035   000777 376003                    ANQ     511,DU
         1 000036   000052 116003                    CMPQ    42,DU
         1 000037   000153 601000 1                  TNZ     NOTSTRSCR

     1717     1761    1      F$DCB.SETX=FM_SYSSETX;

   1761  1 000040   000000 720000 xsym               LXL0    FM_SYSSETX
         1 000041   100051 440100                    SXL0    41,,PR1

     1718     1762    1      F$DCB.STARF='1'B;

   1762  1 000042   000000 471500                    LDP1    0,,PR0
         1 000043   200000 236003                    LDQ     65536,DU
PL6.E3A0      #003=FMN$CHKFLACN File=FMN$OPNF.:E05TSI                            TUE 07/29/97 16:56 Page:321  
         1 000044   100064 256100                    ORSQ    52,,PR1

     1719     1763    1      IF N~=2 THEN RETURN;

   1763  1 000045   000002 115007                    CMPA    2,DL
         1 000046   000050 600000 1                  TZE     s:1764

   1763  1 000047   000000 702200 xent               TSX2  ! X66_ARET

     1720     1764    1      CALL INDEX(I,SUBSTR(F$DCB.NAME.C,1,1),FM_STARCHARS) ALTRET(RET);

   1764  1 000050   000000 471500                    LDP1    0,,PR0
         1 000051   000100 124400                    SCM     mask='000'O
         1 000052   000031 000010 0                  ADSC9   FM_STARCHARS             cn=0,n=8
         1 000053   100010 400001                    ADSC9   8,,PR1                   cn=2,n=1
         1 000054   200004 000100                    ARG     I,,AUTO
         1 000055   000033 606400 1                  TTN     RET

     1721     1765    1      IF I<SIZEW(B$JIT.STAR) THEN F$DCB.STARX=I;

   1765  1 000056   200004 235100                    LDA     I,,AUTO
         1 000057   000010 115007                    CMPA    8,DL
         1 000060   000066 605000 1                  TPL     s:1766

   1765  1 000061   200004 236100                    LDQ     I,,AUTO
         1 000062   000011 736000                    QLS     9
         1 000063   100064 676100                    ERQ     52,,PR1
         1 000064   007000 376007                    ANQ     3584,DL
         1 000065   100064 656100                    ERSQ    52,,PR1

     1722     1766    2      DO CASE(I); /* NOW DO THE ACCESS CONTROL */

   1766  1 000066   000010 115007                    CMPA    8,DL
         1 000067   000071 602005 1                  TNC     s:1766+3,AL
         1 000070   000141 710000 1                  TRA     s:1778
         1 000071   000101 710000 1                  TRA     s:1768
         1 000072   000101 710000 1                  TRA     s:1768
PL6.E3A0      #003=FMN$CHKFLACN File=FMN$OPNF.:E05TSI                            TUE 07/29/97 16:56 Page:322  
         1 000073   000101 710000 1                  TRA     s:1768
         1 000074   000102 710000 1                  TRA     CPFILE
         1 000075   000115 710000 1                  TRA     s:1772
         1 000076   000141 710000 1                  TRA     s:1778
         1 000077   000141 710000 1                  TRA     s:1778
         1 000100   000123 710000 1                  TRA     s:1775

     1723     1767    2      CASE(0,1,2); /* G, BLANK,  AND L: UP FOR GRABS */

     1724     1768    2         RETURN;

   1768  1 000101   000000 702200 xent               TSX2  ! X66_ARET

     1725     1769    2      CASE(3); /* A: INPUT TO ALL, ELSE CP ONLY */

     1726     1770    2   CPFILE: IF F$DCB.FUN=%IN# OR F$DCB.WSR=4 THEN RETURN;

   1770  1 000102   200003 470500       CPFILE       LDP0    @JDCB$,,AUTO
         1 000103   000000 471500                    LDP1    0,,PR0
         1 000104   100032 236100                    LDQ     26,,PR1
         1 000105   000777 376003                    ANQ     511,DU
         1 000106   000002 116003                    CMPQ    2,DU
         1 000107   000114 600000 1                  TZE     s:1770
         1 000110   100040 236100                    LDQ     32,,PR1
         1 000111   000777 376003                    ANQ     511,DU
         1 000112   000004 116003                    CMPQ    4,DU
         1 000113   000141 601000 1                  TNZ     s:1778

   1770  1 000114   000000 702200 xent               TSX2  ! X66_ARET

     1727     1771    2      CASE(4); /* S: SAME AS A, BUT SHARE ALL */

     1728     1772    2         F$DCB.SHARE=%ALL#;

   1772  1 000115   000000 471500                    LDP1    0,,PR0
         1 000116   100031 236100                    LDQ     25,,PR1
         1 000117   000001 376000 2                  ANQ     1
PL6.E3A0      #003=FMN$CHKFLACN File=FMN$OPNF.:E05TSI                            TUE 07/29/97 16:56 Page:323  
         1 000120   000200 276007                    ORQ     128,DL
         1 000121   100031 756100                    STQ     25,,PR1

     1729     1773    2         GOTO CPFILE;

   1773  1 000122   000102 710000 1                  TRA     CPFILE

     1730     1774    2      CASE(7); /* I: ONLY FMSEC OR ASL */

     1731     1775    2         IF F$DCB.FUN=%IN# AND B$JIT.PRIV.ACTIVE.FMSEC

   1775  1 000123   000000 471500                    LDP1    0,,PR0
         1 000124   100032 236100                    LDQ     26,,PR1
         1 000125   000777 376003                    ANQ     511,DU
         1 000126   000002 116003                    CMPQ    2,DU
         1 000127   000134 601000 1                  TNZ     s:1775+9
         1 000130   000000 473400 xsym               LDP3    B$JIT$
         1 000131   300013 236100                    LDQ     11,,PR3
         1 000132   100000 316003                    CANQ    32768,DU
         1 000133   000140 601000 1                  TNZ     s:1776
         1 000134   100040 236100                    LDQ     32,,PR1
         1 000135   000777 376003                    ANQ     511,DU
         1 000136   000006 116003                    CMPQ    6,DU
         1 000137   000141 601000 1                  TNZ     s:1778

     1732     1776    2           OR F$DCB.WSR=6 THEN RETURN;

   1776  1 000140   000000 702200 xent               TSX2  ! X66_ARET

     1733     1777    2      END;     /* N, X, OR OTHERWISE: ONLY MONITOR */

     1734     1778    1      IF F$DCB.WSR=1 THEN RETURN;

   1778  1 000141   000000 471500                    LDP1    0,,PR0
         1 000142   100040 236100                    LDQ     32,,PR1
         1 000143   000777 376003                    ANQ     511,DU
         1 000144   000001 116003                    CMPQ    1,DU
PL6.E3A0      #003=FMN$CHKFLACN File=FMN$OPNF.:E05TSI                            TUE 07/29/97 16:56 Page:324  
         1 000145   000147 601000 1                  TNZ     FMNE$INVSTAR

   1778  1 000146   000000 702200 xent               TSX2  ! X66_ARET

     1735     1779                    /*E* ERROR: FMN-E$INVSTAR-E
     1736     1780                    *        MESSAGE: File %FN is not accessible from your domain
     1737     1781                  *       MESSAGE1:*N and *X are reserved for CP-6, *A and *S may be opened
     1738     1782                   *       only input except by a command processor, and *I is reserved for
     1739     1783                    *        alternate shared libraries.% %FN was the culprit this time.%
     1740     1784                    */
     1741     1785    1   FMNE$INVSTAR: B$JIT$->B$JIT.ERR=FMN$E$INVSTAR;

   1785  1 000147   000033 236000 0     FMNE$INVSTAR LDQ     FMN$E$INVSTAR
         1 000150   000000 473400 xsym               LDP3    B$JIT$
         1 000151   300012 756100                    STQ     10,,PR3

     1742     1786    1      ALTRETURN;

   1786  1 000152   000000 702200 xent               TSX2  ! X66_AALT

   1778  1 000153                       NOTSTRSCR    null
     1743     1787    1   NOTSTRSCR:;
     1744     1788    2      IF F$DCB.FUN=%CREATE# THEN DO;

   1788  1 000153   100032 236100                    LDQ     26,,PR1
         1 000154   000777 376003                    ANQ     511,DU
         1 000155   000003 116003                    CMPQ    3,DU
         1 000156   000270 601000 1                  TNZ     SELECTPS

     1745     1789    2         IF N=0 THEN GOTO FMNE$BADFNME;

   1789  1 000157   000000 115003                    CMPA    0,DU
         1 000160   000336 600000 1                  TZE     FMNE$BADFNME

     1746     1790    2         P1$=ADDR(JDCB$->F$DCB.NAME.C);

   1790  1 000161   200010 451500                    STP1    P1$+2,,AUTO
PL6.E3A0      #003=FMN$CHKFLACN File=FMN$OPNF.:E05TSI                            TUE 07/29/97 16:56 Page:325  
         1 000162   200010 236100                    LDQ     P1$+2,,AUTO
         1 000163   000002 036000 2                  ADLQ    2
         1 000164   200006 756100                    STQ     P1$,,AUTO

     1747     1791                    /*
     1748     1792                    *  FOR ALL CREATE OPENS VERIFY THAT THE CHARACTERS IN THE FILE NAME
     1749     1793                    *  CONSIST OF THE FOLLOWING:
     1750     1794                    *                       1)  UPPER CASE LETTERS
     1751     1795                    *                       2)  LOWER CASE LETTERS
     1752     1796                    *                       3)  NUMBERS
     1753     1797                    *                       4)  SPECIAL CHARACTERS : $ - _
     1754     1798                    */
     1755     1799    2         IF F$DCB.IASN=%FILE# OR F$DCB.ORG<%FIXED# OR F$DCB.ORG>%UNDEF#

   1799  1 000165   000000 471500                    LDP1    0,,PR0
         1 000166   100103 236100                    LDQ     67,,PR1
         1 000167   000777 376007                    ANQ     511,DL
         1 000170   000001 116007                    CMPQ    1,DL
         1 000171   000200 600000 1                  TZE     s:1800
         1 000172   100032 236100                    LDQ     26,,PR1
         1 000173   777000 376003                    ANQ     -512,DU
         1 000174   017000 116003                    CMPQ    7680,DU
         1 000175   000200 602000 1                  TNC     s:1800
         1 000176   022000 116003                    CMPQ    9216,DU
         1 000177   000215 602000 1                  TNC     s:1811

     1756     1800    3         THEN DO WHILE(N>0);

   1800  1 000200   000000 115003                    CMPA    0,DU
         1 000201   000231 604400 1                  TMOZ    CHKACCN

     1757     1801    3            N=N-1;

   1801  1 000202   000001 336007                    LCQ     1,DL
         1 000203   200005 056100                    ASQ     N,,AUTO

     1758     1802    3            CALL INDEX(I,SUBSTR(NAME,N,1),SUBSTR(VALIDCHARS,SIZEC(TFCHARS.T),
PL6.E3A0      #003=FMN$CHKFLACN File=FMN$OPNF.:E05TSI                            TUE 07/29/97 16:56 Page:326  

   1802  1 000204   200006 470500                    LDP0    P1$,,AUTO
         1 000205   200005 235100                    LDA     N,,AUTO
         1 000206   000105 124400                    SCM     mask='000'O
         1 000207   000006 200113 0                  ADSC9   TFCHARS+4                cn=1,n=75
         1 000210   000000 000001                    ADSC9   0,A,PR0                  cn=0,n=1
         1 000211   200004 000100                    ARG     I,,AUTO
         1 000212   000336 606400 1                  TTN     FMNE$BADFNME

     1759     1803    3              SIZEC(TFCHARS.TF)+SIZEC(TFCHARS.F))) ALTRET(FMNE$BADFNME);
     1760     1804    3            END;

   1804  1 000213   000202 605400 1                  TPNZ    s:1801
         1 000214   000231 710000 1                  TRA     CHKACCN

     1761     1805                    /*
     1762     1806                    *  UNLESS ITS AN ANS TAPE FORMAT FILE, WHICH MUST BE:
     1763     1807                    *                        1)  UPPER CASE LETTERS
     1764     1808                    *                        2)  NUMBERS
     1765     1809                    *                        3   SPECIALS :-!"%&'()*+,./?;<>=
     1766     1810                    */
     1767     1811    3         ELSE DO WHILE(N>0);

   1811  1 000215   000000 115003                    CMPA    0,DU
         1 000216   000231 604400 1                  TMOZ    CHKACCN

     1768     1812    3            N=N-1;

   1812  1 000217   000001 336007                    LCQ     1,DL
         1 000220   200005 056100                    ASQ     N,,AUTO

     1769     1813    3            CALL INDEX(I,SUBSTR(NAME,N,1),SUBSTR(VALIDCHARS,0,

   1813  1 000221   200006 470500                    LDP0    P1$,,AUTO
         1 000222   200005 235100                    LDA     N,,AUTO
         1 000223   000105 124400                    SCM     mask='000'O
         1 000224   000002 000070 0                  ADSC9   TFCHARS                  cn=0,n=56
PL6.E3A0      #003=FMN$CHKFLACN File=FMN$OPNF.:E05TSI                            TUE 07/29/97 16:56 Page:327  
         1 000225   000000 000001                    ADSC9   0,A,PR0                  cn=0,n=1
         1 000226   200004 000100                    ARG     I,,AUTO
         1 000227   000336 606400 1                  TTN     FMNE$BADFNME

     1770     1814    3              SIZEC(TFCHARS.T)+SIZEC(TFCHARS.TF))) ALTRET(FMNE$BADFNME);
     1771     1815    3            END;

   1815  1 000230   000217 605400 1                  TPNZ    s:1812

   1813  1 000231                       CHKACCN      null
     1772     1816        %EJECT;
PL6.E3A0      #003=FMN$CHKFLACN File=FMN$OPNF.:E05TSI                            TUE 07/29/97 16:56 Page:328  
     1773     1817    2   CHKACCN:;
     1774     1818                    /*
     1775     1819                    *  NOW VERIFY ACCOUNT NUMBER
     1776     1820                    */
     1777     1821    2         IF ADDR(JDCB$->F$DCB.ACCT)->ACCT&NASCII7 THEN GOTO FMNE$BADFNME;

   1821  1 000231   200003 470500                    LDP0    @JDCB$,,AUTO
         1 000232   000000 471500                    LDP1    0,,PR0
         1 000233   100020 237100                    LDAQ    16,,PR1
         1 000234   000000 377000 0                  ANAQ    NASCII7
         1 000235   000336 601000 1                  TNZ     FMNE$BADFNME

     1778     1822    2         CALL INDEX(I,' ',F$DCB.ACCT);

   1822  1 000236   000000 124500                    SCM     mask='000'O
         1 000237   100020 000010                    ADSC9   16,,PR1                  cn=0,n=8
         1 000240   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 000241   200004 000100                    ARG     I,,AUTO

     1779     1823    2         IF I=0 OR SUBSTR(F$DCB.ACCT,I,8-I)~=' ' THEN GOTO FMNE$BADFNME;

   1823  1 000242   200004 235100                    LDA     I,,AUTO
         1 000243   000336 600000 1                  TZE     FMNE$BADFNME
         1 000244   777767 620005                    EAX0    -9,AL
         1 000245   777777 660003                    ERX0    -1,DU
         1 000246   040000 106545                    CMPC    fill='040'O
         1 000247   100020 000010                    ADSC9   16,A,PR1                 cn=0,n=*X0
         1 000250   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 000251   000336 601000 1                  TNZ     FMNE$BADFNME

     1780     1824    2         CALL INDEX(I,BINASC(0),F$DCB.ACCT,0,'037'O)ALTRET(CHKACCT1);

   1824  1 000252   037000 124500                    SCM     mask='037'O
         1 000253   100020 000010                    ADSC9   16,,PR1                  cn=0,n=8
         1 000254   000003 000001 2                  ADSC9   3                        cn=0,n=1
         1 000255   200004 000100                    ARG     I,,AUTO
         1 000256   000260 606400 1                  TTN     CHKACCT1
PL6.E3A0      #003=FMN$CHKFLACN File=FMN$OPNF.:E05TSI                            TUE 07/29/97 16:56 Page:329  

     1781     1825    2         GOTO FMNE$BADFNME; /* MUST NOT HAVE CONTROL CHARS OR IMBEDDED BLANKS*/

   1825  1 000257   000336 710000 1                  TRA     FMNE$BADFNME

     1782     1826    2   CHKACCT1: CALL INDEX(I,BINASC(127),F$DCB.ACCT)ALTRET(SELECTPS);

   1826  1 000260   200003 470500       CHKACCT1     LDP0    @JDCB$,,AUTO
         1 000261   000000 471500                    LDP1    0,,PR0
         1 000262   000000 124500                    SCM     mask='000'O
         1 000263   100020 000010                    ADSC9   16,,PR1                  cn=0,n=8
         1 000264   000004 000001 2                  ADSC9   4                        cn=0,n=1
         1 000265   200004 000100                    ARG     I,,AUTO
         1 000266   000270 606400 1                  TTN     SELECTPS

     1783     1827    2         GOTO FMNE$BADFNME;/* NOT EVEN DEL */

   1827  1 000267   000336 710000 1                  TRA     FMNE$BADFNME

   1826  1 000270                       SELECTPS     null
     1784     1828    2         END;
     1785     1829    1   SELECTPS:;
     1786     1830    2      IF F$DCB.IASN=%TAPE# THEN DO;

   1830  1 000270   200003 470500                    LDP0    @JDCB$,,AUTO
         1 000271   000000 471500                    LDP1    0,,PR0
         1 000272   100103 236100                    LDQ     67,,PR1
         1 000273   000777 376007                    ANQ     511,DL
         1 000274   000002 116007                    CMPQ    2,DL
         1 000275   000310 601000 1                  TNZ     s:1835

     1787     1831    2         IF F$DCB.NAME.L>17 AND F$DCB.ORG>=%FIXED#

   1831  1 000276   100010 236100                    LDQ     8,,PR1
         1 000277   777000 376003                    ANQ     -512,DU
         1 000300   022000 116003                    CMPQ    9216,DU
         1 000301   000310 602000 1                  TNC     s:1835
PL6.E3A0      #003=FMN$CHKFLACN File=FMN$OPNF.:E05TSI                            TUE 07/29/97 16:56 Page:330  
         1 000302   100032 236100                    LDQ     26,,PR1
         1 000303   777000 376003                    ANQ     -512,DU
         1 000304   017000 116003                    CMPQ    7680,DU
         1 000305   000310 602000 1                  TNC     s:1835
         1 000306   022000 116003                    CMPQ    9216,DU
         1 000307   000336 601000 1                  TNZ     FMNE$BADFNME

     1788     1832    2           AND F$DCB.ORG~=%RESTRICT#
     1789     1833    2         THEN GOTO FMNE$BADFNME;
     1790     1834    2         END;

     1791     1835    1      IF F$DCB.IASN~=%FILE# THEN RETURN;

   1835  1 000310   100103 236100                    LDQ     67,,PR1
         1 000311   000777 376007                    ANQ     511,DL
         1 000312   000001 116007                    CMPQ    1,DL
         1 000313   000315 600000 1                  TZE     s:1836

   1835  1 000314   000000 702200 xent               TSX2  ! X66_ARET

     1792     1836    1      IF F$DCB.PSN~=' ' THEN CALL FMN$SETX(F$DCB.PSN)ALTRET(RETALT);

   1836  1 000315   040000 106500                    CMPC    fill='040'O
         1 000316   100024 000006                    ADSC9   20,,PR1                  cn=0,n=6
         1 000317   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 000320   000330 600000 1                  TZE     s:1837

   1836  1 000321   100024 633500                    EPPR3   20,,PR1
         1 000322   200010 453500                    STP3    P1$+2,,AUTO
         1 000323   200010 630500                    EPPR0   P1$+2,,AUTO
         1 000324   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000325   000000 701000 xent               TSX1    FMN$SETX
         1 000326   000341 702000 1                  TSX2    RETALT
         1 000327   000332 710000 1                  TRA     s:1838

     1793     1837    1      ELSE F$DCB.SETX=0;

PL6.E3A0      #003=FMN$CHKFLACN File=FMN$OPNF.:E05TSI                            TUE 07/29/97 16:56 Page:331  
   1837  1 000330   000000 220003                    LDX0    0,DU
         1 000331   100051 440100                    SXL0    41,,PR1

     1794     1838    1      RETURN;

   1838  1 000332   000000 702200 xent               TSX2  ! X66_ARET

     1795     1839    1   FMN$CHKACCN: ENTRY(JDCB$)ALTRET;

   1839  1 000333   000000 700200 xent  FMN$CHKACCN  TSX0  ! X66_AUTO_1
         1 000334   000012 000001                    ZERO    10,1

     1796     1840    1      GOTO CHKACCN;

   1840  1 000335   000231 710000 1                  TRA     CHKACCN

     1797     1841                    /**/
     1798     1842    1   FMNE$BADFNME: B$JIT$->B$JIT.ERR=FMN$E$BADFNME;

   1842  1 000336   000034 236000 0     FMNE$BADFNME LDQ     FMN$E$BADFNME
         1 000337   000000 470400 xsym               LDP0    B$JIT$
         1 000340   000012 756100                    STQ     10,,PR0

     1799     1843    1   RETALT:
     1800     1844    1      ALTRETURN;

   1844  1 000341   000000 702200 xent  RETALT       TSX2  ! X66_AALT

NASCII7
 Sect OctLoc
   0     000   600600 600600   600600 600600                                    ........

TFCHARS
 Sect OctLoc
   0     002   041042 045046   047050 051052   053054 056057   073074 075076    !"%&'()*+,./;<=>
   0     006   077072 101114   123113 104112   106110 107131   124125 122111    ?:ALSKDJFHGYTURI
   0     012   105117 127120   121102 126116   103115 130132   061062 063064    EOWPQBVNCMXZ1234
PL6.E3A0      #003=FMN$CHKFLACN File=FMN$OPNF.:E05TSI                            TUE 07/29/97 16:56 Page:332  
   0     016   065066 067070   071060 055137   044141 154163   153144 152146    567890-_$alskdjf
   0     022   150147 171164   165162 151145   157167 160161   142166 156143    hgyturieowpqbvnc
   0     026   155170 172133   134135 136140   173174 175176                    mxz[\]^`{|}~

FM_STARCHARS
 Sect OctLoc
   0     031   040107 114101   123116 130111                                     GLASNXI

FMN$E$INVSTAR
 Sect OctLoc
   0     033   061516 001602                                                    1...

FMN$E$BADFNME
 Sect OctLoc
   0     034   061516 001622                                                    1...

(unnamed)
 Sect OctLoc
   2     000   777777 770777   777777 777177   000010 200000   000040 040040    .............
   2     004   177040 040040                                                    .
     1801     1845    1   END FMN$CHKFLACN;
     1802     1846        %EOD;

PL6.E3A0      #003=FMN$CHKFLACN File=FMN$OPNF.:E05TSI                            TUE 07/29/97 16:56 Page:333  
--  Include file information  --

   FM$MACROS.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
   F$DCB.:E05TOU  is referenced.
      No diagnostics issued in procedure FMN$CHKFLACN.
PL6.E3A0      #003=FMN$CHKFLACN File=FMN$OPNF.:E05TSI                            TUE 07/29/97 16:56 Page:334  

 **** Variables and constants ****

  ****  Section 000 RoData FMN$CHKFLACN

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    34-0-0/b STRC        r     1 FMN$E$BADFNME             33-0-0/b STRC        r     1 FMN$E$INVSTAR
    31-0-0/c CHAR(8)     r     1 FM_STARCHARS               0-0-0/b BIT (72)    r     1 NASCII7
     2-0-0/c STRC(828)   r     1 TFCHARS                    2-0-0/c CHAR(92)    r     1 VALIDCHARS

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @JDCB$                     4-0-0/w SBIN        r     1 I
    *0-0-0/w PTR         r     1 JDCB$                      5-0-0/w SBIN        r     1 N
     6-0-0/w PTR         r     1 P1$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w UBIN        r     1 FM_SYSSETX

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w BIT (72)    r     1 ACCT                       0-0-0/d STRC(8856)  r     1 B$JIT
     0-0-0/d ASTR(3528)  r     1 F$DCB                      0-0-0/c CHAR(31)    r     1 NAME

PL6.E3A0      #003=FMN$CHKFLACN File=FMN$OPNF.:E05TSI                            TUE 07/29/97 16:56 Page:335  

   Procedure FMN$CHKFLACN requires 226 words for executable code.
   Procedure FMN$CHKFLACN requires 10 words of local(AUTO) storage.
PL6.E3A0      #003=FMN$CHKFLACN File=FMN$OPNF.:E05TSI                            TUE 07/29/97 16:56 Page:336  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=FMN$CHKFLACN File=FMN$OPNF.:E05TSI                            TUE 07/29/97 16:56 Page:337  
          MINI XREF LISTING

ACCT
      1715**DCL      1821>>IF
B$JIT.ERR
       441**DCL      1785<<ASSIGN   1842<<ASSIGN
B$JIT.ERR.MID
       442**DCL       442--REDEF
B$JIT.PRIV.ACTIVE.FMSEC
       443**DCL      1775>>IF
B$JIT.STAR
       531**DCL      1765--IF
B$JIT$
      1709**DCL       436--IMP-PTR  1775>>IF       1785>>ASSIGN   1842>>ASSIGN
CHKACCN
      1813**LABEL    1840--GOTO
CHKACCT1
      1826**LABEL    1824--CALLALT
CPFILE
      1770**LABEL    1773--GOTO
F$DCB.ACCT
        75**DCL      1821--IF       1822>>CALLBLT  1823>>IF       1824>>CALLBLT  1826>>CALLBLT
F$DCB.ACTPOS
        90**DCL        90--REDEF
F$DCB.ARS
        65**DCL        65--REDEF
F$DCB.ATTR
        83**DCL        84--REDEF
F$DCB.BORROW
        98**DCL        98--REDEF      98--REDEF      98--REDEF
F$DCB.DCBNAME.L
       112**DCL       112--IMP-SIZ
F$DCB.DISP
        80**DCL      1756>>IF
PL6.E3A0      #003=FMN$CHKFLACN File=FMN$OPNF.:E05TSI                            TUE 07/29/97 16:56 Page:338  
F$DCB.EOMCHAR
        69**DCL        69--REDEF
F$DCB.FLDID
        93**DCL        93--REDEF
F$DCB.FORM$
        87**DCL        87--REDEF
F$DCB.FSECT
       103**DCL       103--REDEF
F$DCB.FSN
        80**DCL        80--REDEF      80--REDEF      81--REDEF
F$DCB.FUN
        79**DCL      1756>>IF       1770>>IF       1775>>IF       1788>>IF
F$DCB.HEADER$
        86**DCL        86--REDEF
F$DCB.IASN
       106**DCL      1754>>IF       1799>>IF       1830>>IF       1835>>IF
F$DCB.IXTNSIZE
        84**DCL        84--REDEF
F$DCB.LASTSTA$
        74**DCL        74--REDEF
F$DCB.LVL
        99**DCL        99--REDEF
F$DCB.NAME.C
        74**DCL        74--REDEF    1760>>IF       1764>>CALLBLT  1790--ASSIGN
F$DCB.NAME.L
        74**DCL      1743>>ASSIGN   1831>>IF
F$DCB.NOEOF
        95**DCL        95--REDEF
F$DCB.NRECS
        85**DCL        85--REDEF
F$DCB.NRECX
       104**DCL       104--REDEF
F$DCB.OHDR
        96**DCL        96--REDEF
F$DCB.ORG
        79**DCL        79--REDEF    1799>>IF       1799>>IF       1831>>IF       1831>>IF
PL6.E3A0      #003=FMN$CHKFLACN File=FMN$OPNF.:E05TSI                            TUE 07/29/97 16:56 Page:339  
F$DCB.PRECNO
       102**DCL       102--REDEF
F$DCB.PSN
        75**DCL      1836>>IF       1836<>CALL
F$DCB.RCSZ
       107**DCL       107--REDEF
F$DCB.RES
        75**DCL        75--REDEF
F$DCB.SETX
        87**DCL        87--REDEF    1757<<ASSIGN   1761<<ASSIGN   1837<<ASSIGN
F$DCB.SHARE
        78**DCL      1772<<ASSIGN
F$DCB.STARF
        94**DCL      1762<<ASSIGN
F$DCB.STARX
        96**DCL      1744<<ASSIGN   1765<<ASSIGN
F$DCB.TAB$
        86**DCL        87--REDEF
F$DCB.TDA
       101**DCL       101--REDEF
F$DCB.WSN
        76**DCL        76--REDEF
F$DCB.WSR
        82**DCL      1770>>IF       1775>>IF       1778>>IF
FMN$E$BADFNME
      1732**DCL      1842>>ASSIGN
FMN$E$INVSTAR
      1728**DCL      1785>>ASSIGN
FMN$SETX
      1704**DCL-ENT  1836--CALL
FMNE$BADFNME
      1842**LABEL    1745--GOTO     1789--GOTO     1802--CALLALT  1813--CALLALT  1821--GOTO     1823--GOTO
      1825--GOTO     1827--GOTO     1833--GOTO
FM_STARCHARS
      1726**DCL      1764>>CALLBLT
FM_SYSSETX
PL6.E3A0      #003=FMN$CHKFLACN File=FMN$OPNF.:E05TSI                            TUE 07/29/97 16:56 Page:340  
      1710**DCL      1757>>ASSIGN   1761>>ASSIGN
I
      1738**DCL      1764<<CALLBLT  1765>>IF       1765>>ASSIGN   1766>>DOCASE   1802<<CALLBLT  1813<<CALLBLT
      1822<<CALLBLT  1823>>IF       1823>>IF       1823>>IF       1824<<CALLBLT  1826<<CALLBLT
JDCB$
      1708**DCL        11--PROC       65--IMP-PTR  1743>>ASSIGN   1744>>ASSIGN   1754>>IF       1756>>IF
      1756>>IF       1757>>ASSIGN   1760>>IF       1761>>ASSIGN   1762>>ASSIGN   1764>>CALLBLT  1765>>ASSIGN
      1770>>IF       1770>>IF       1772>>ASSIGN   1775>>IF       1775>>IF       1778>>IF       1788>>IF
      1790>>ASSIGN   1799>>IF       1799>>IF       1799>>IF       1821>>IF       1822>>CALLBLT  1823>>IF
      1824>>CALLBLT  1826>>CALLBLT  1830>>IF       1831>>IF       1831>>IF       1831>>IF       1835>>IF
      1836>>IF       1836>>CALL     1837>>ASSIGN   1839--ENTRY
N
      1739**DCL      1743<<ASSIGN   1745>>IF       1763>>IF       1789>>IF       1800>>DOWHILE  1801<<ASSIGN
      1801>>ASSIGN   1802>>CALLBLT  1811>>DOWHILE  1812<<ASSIGN   1812>>ASSIGN   1813>>CALLBLT
NAME
      1714**DCL      1802>>CALLBLT  1813>>CALLBLT
NASCII7
      1717**DCL      1821>>IF
NOTSTRSCR
      1778**LABEL    1754--GOTO     1760--GOTO
P1$
      1740**DCL      1714--IMP-PTR  1790<<ASSIGN   1802>>CALLBLT  1813>>CALLBLT
RET
      1758**LABEL    1764--CALLALT
RETALT
      1844**LABEL    1836--CALLALT
SELECTPS
      1826**LABEL    1826--CALLALT
TFCHARS
      1718**DCL      1725--REDEF
TFCHARS.F
      1723**DCL      1802--CALLBLT
TFCHARS.T
      1719**DCL      1802--CALLBLT  1813--CALLBLT
TFCHARS.TF
      1721**DCL      1802--CALLBLT  1813--CALLBLT
PL6.E3A0      #003=FMN$CHKFLACN File=FMN$OPNF.:E05TSI                            TUE 07/29/97 16:56 Page:341  
VALIDCHARS
      1725**DCL      1802>>CALLBLT  1813>>CALLBLT

PL6.E3A0      #004=FMN$READFDFIT File=FMN$OPNF.:E05TSI                           TUE 07/29/97 16:57 Page:342  
     1803        1        /*T***********************************************************/
     1804        2        /*T*                                                         */
     1805        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1806        4        /*T*                                                         */
     1807        5        /*T***********************************************************/
     1808        6                    /*F*
     1809        7                    *     NAME:   FMN$READFDFIT
     1810        8                    *
     1811        9                    *        PURPOSE: To read,verify, and process security information
     1812       10                    *        for FILE directory FIT.
     1813       11                    *        DESCRIPTION: Entered whenever a new CFU account blkock must be
     1814       12                   *        set up. If 'new', the PAD FIT is read instead and newfd checked.
     1815       13                    *        The access and granule info is moved to the new acct block.
     1816       14                    *        Also entered if the account has 09 vlp entries (indicated by
     1817       15                   *        'ACCESS' in CODE14 and acct block). This info is used perhaps to
     1818       16                    *        abort the open.
     1819       17                    */
     1820       18        FMN$READFDFIT: PROC ALTRET;
     1821       19                    /**/
     1822       20                    /* AUTOMATIC DATA */
     1823       21                    /**/
     1824       22    1   DCL JDCB$ PTR; /* DCB POINTER */
     1825       23    1   DCL ACCT$ PTR; /* ACCOUNT BLOCK POINTER */
     1826       24    1   DCL FIT$ PTR; /* FIT PINTER */
     1827       25    1   DCL BUF$ PTR; /* BUFFER POINTER */
     1828       26    1   DCL FDA SBIN; /* SET RELATIVE DISK ADDRESS */
     1829       27                    /**/
     1830       28                    /* EXTERNAL ROUTINES */
     1831       29    1   DCL FMD$REDBUF ENTRY(6) ALTRET; /* READ THE FIT */
     1832       30    1   DCL FMO$LOCCODP ENTRY(2) ALTRET; /* LOCATE FIT CODE */
     1833       31    1   DCL FMB$LOGERR ENTRY(11);
     1834       32    1   DCL FMD$FLSHBUF ENTRY(1);
     1835       33    1   DCL FMO$TRNINFO ENTRY(2)ALTRET;
     1836       34    1   DCL FMO$SECCHK ENTRY(2);
     1837       35    1   DCL FMR$L8 ENTRY;
     1838       36    1   DCL FMR$U8 ENTRY;
     1839       37    1   DCL UQB$MENQS ENTRY(1)ALTRET;
PL6.E3A0      #004=FMN$READFDFIT File=FMN$OPNF.:E05TSI                           TUE 07/29/97 16:57 Page:343  
     1840       38    1   DCL UQB$MENQX ENTRY(1)ALTRET;
     1841       39    1   DCL UQB$MDEQ ENTRY(1)ALTRET;
     1842       40                    /**/
     1843       41        %INCLUDE FM$MACROS;
     1844      416        %FM$CFUA(BASED="BASED(ACCT$)");
     1845      422        %FM$CFU(BASED="BASED(ACCT$)");
     1846      428        %CODE14(BASED="BASED(FIT$)");
     1847      438        %FM$GRAN;
     1848      442        %FM$SET(BASED="BASED(F$CFU$)");
     1849      447        %INCLUDE CP_6_SUBS;
     1850      987        %MACRO F$DCB#(BASED=BASED);
     1851      988        %INCLUDE F$DCB;
     1852     1037        %MEND;
     1853     1038        %F$DCB#(BASED="BASED(JDCB$)");
     1854     1088        %INCLUDE F_ERRORS_C;
     1855     1328        %INCLUDE AZ_SUBS_C;
     1856     1397        %INCLUDE F$JIT_C;
     1857     1827        %INCLUDE JG_GHOSTS_C;
     1858     1917        %INCLUDE PC_SUBS_C;
     1859     2249                    /**/
     1860     2250    1   DCL S_CUN SBIN SYMREF;
     1861     2251    1   DCL ES_LOGFILEGRANT SBIN SYMREF;
     1862     2252    1   DCL F$CFU$ SYMREF PTR; /* POINTER TO THE CFU SEGMENT */
     1863     2253    1   DCL B$JIT$ PTR SYMREF; /* POINTER TO THE JIT */
     1864     2254    1   DCL FM_PADSDA SBIN SYMREF;
     1865     2255    1   DCL FM$BUF$(0:0)PTR SYMREF;
     1866     2256        %SUB FCG#='0615'O;
     1867     2257        %SUB MID#='16'O;
     1868     2258        %ERRCODE(NAME=FMN$E$NEWFILE,COD#=%E$NEWFILE);
     1869     2262        %ERRCODE(NAME=FMN$E$FD,COD#=%E$FD);
     1870     2266        %ERRCODE(NAME=FMN$E$NONEWFD,COD#=%E$NONEWFD);
     1871     2270        %ERRCODE(NAME=FMN$E$NOFILE,COD#=%E$NOFILE);
     1872     2274        %ERRCODE(NAME=FMN$E$NOACCESS,COD#=%E$NOACCESS);
     1873     2278        %ERRCODE(NAME=FMN$E$NOKEY,COD#=%E$NOKEY);
     1874     2282                    /**/
     1875     2283    1      JDCB$=B$JIT.DCB$;
     1876     2284    1      IF F$DCB.FFLG THEN RETURN; /* WE'VE BEEN HERE BEFORE */
PL6.E3A0      #004=FMN$READFDFIT File=FMN$OPNF.:E05TSI                           TUE 07/29/97 16:57 Page:344  
     1877     2285    1      F$DCB.GTYP=FMGTFIT;
     1878     2286    1      ACCT$=PINCRW(F$CFU$,F$DCB.CFU$->FM$CFU.ACCTX);
     1879     2287    1      IF F$DCB.IASN=%FILE# AND F$DCB.NAME.L~=0
     1880     2288    1        AND FM$CFUA.FLAGS.EXIST THEN GOTO SECCHKFD;
     1881     2289    1   REREAD:;
     1882     2290    2      IF FM$CFUA.FDFITSDA=0 THEN DO;/* A NEW ACCOUNT */
     1883     2291    2         IF F$DCB.FUN~=%CREATE# THEN GOTO FMNE$NOFILE;
     1884     2292    2         FDA=FM_PADSDA;
     1885     2293    2         F$DCB.GTYP=FMGTPAD;
     1886     2294    2         END;
     1887     2295    2      ELSE DO;
     1888     2296    2         IF F$DCB.IASN=%FILE# THEN CALL UQB$MENQS(ACCT$)ALTRET(ENQERR);
     1889     2297    2         JDCB$->F$DCB.GTYP=FMGTFD;
     1890     2298    2         FDA=ACCT$->FM$CFUA.FDFITSDA;
     1891     2299    2         END;
     1892     2300    1      CALL FMD$REDBUF(BUF$,1,FDA,,0) ALTRET(RETALT);
     1893     2301    1      FIT$=PINCRW(BUF$,SIZEW(FM$GRAN));
     1894     2302    1      CALL FMO$LOCCODP(FIT$,14) ALTRET(FMNE$FD);
     1895     2303    2      IF NOT FM$CFUA.FLAGS THEN DO;
     1896     2304    2         FM$CFUA.GRANS=CODE14.MGRANS-CODE14.CGRANS;
     1897     2305    2         FM$CFUA.ACCESS=CODE14.ACCESS;
     1898     2306    2         FM$CFUA.DFLTALL=CODE14.DFLTALL;
     1899     2307    2         IF FM$CFUA.FDFITSDA=0 THEN FM$CFUA.FLAGS.NEW='1'B;
     1900     2308    2         ELSE FM$CFUA.FLAGS.EXIST='1'B;
     1901     2309    2         END;
     1902     2310    2      ELSE IF FM$CFUA.FLAGS.EXIST AND FM$CFUA.GMOD~=0 THEN DO;
     1903     2311    2            CODE14.CGRANS=CODE14.MGRANS-FM$CFUA.GRANS;/*GET IT RIGHT FOR FPARAM*/
     1904     2312    3            IF F$DCB.IASN=%FILE# THEN DO;/* DEVICE MAY DEADLOCK */
     1905     2313    3               CALL UQB$MENQX(ACCT$)ALTRET(SECCHKFD);/*EVEN IF THIS FAILS */
     1906     2314    3               CALL FMR$L8;
     1907     2315    3               FM$CFUA.GMOD=0;
     1908     2316    3               CODE14.CGRANS=CODE14.MGRANS-FM$CFUA.GRANS;
     1909     2317    3               F$DCB.BFR.BUFUP(1)='1'B;
     1910     2318    3               CALL FMR$U8;
     1911     2319    3               END;
     1912     2320    2            END;
     1913     2321    1      IF F$DCB.IASN=%FILE# AND FM$CFUA.FDFITSDA=0 THEN
PL6.E3A0      #004=FMN$READFDFIT File=FMN$OPNF.:E05TSI                           TUE 07/29/97 16:57 Page:345  
     1914     2322    1         IF NOT B$JIT.PRIV.ACTIVE.FMSEC AND
     1915     2323    1           (FM$SET.PSN(F$DCB.SETX)~=B$JIT.HPSN OR FM$CFUA.ACCT~=B$JIT.ACCN)
     1916     2324    1         THEN GOTO FMNE$NEWFILE;
     1917     2325    1         ELSE IF NOT CODE14.ACCESS.NEWFD THEN GOTO FMNE$NONEWFD;
     1918     2326                    /* NOW DO THE ACCOUNT ACCESS CONTROL */
     1919     2327    1   SECCHKFD:;
     1920     2328    1      B$JIT.ERR='0'B;
     1921     2329    1      IF B$JIT.PRIV.ACTIVE.FMSEC AND (ES_LOGFILEGRANT~=%PC_ES_YES#
     1922     2330    1        OR B$JIT.PRIV.ACTIVE.FMBLK OR S_CUN<%JG_MING#)
     1923     2331    1        OR B$JIT.ACCN=FM$CFUA.ACCT
     1924     2332    1        AND FM$CFUA.ACCESS.OWNERF
     1925     2333    1        OR F$DCB.IASN=%FMDIAG#
     1926     2334    1        OR F$DCB.WSR=1 THEN F$DCB.FFLG=%FFLG_OWNER#;
     1927     2335    2      ELSE DO;
     1928     2336    2         F$DCB.FFLG=FM$CFUA.DFLTALL;
     1929     2337    3         IF FM$CFUA.ACCESS.LIST OR B$JIT.PRIV.ACTIVE.FMSEC THEN DO;
     1930     2338    3            IF B$JIT.FACCN=F$DCB.ACCT AND B$JIT.FPSN=F$DCB.PSN AND B$JIT.FACNACS
     1931     2339    3              AND NOT B$JIT.PRIV.ACTIVE&%SUBBIT(PR_FMSEC#|PR_FMREAD#,0,18)
     1932     2340    4            THEN DO;
     1933     2341    4               F$DCB.FFLG=B$JIT.FACNACS;
     1934     2342    4               F$DCB.FDCM=B$JIT.FACNCM;
     1935     2343    4               END;
     1936     2344    4            ELSE DO;
     1937     2345    4               IF F$DCB.GTYP=FMGTFIT THEN GOTO REREAD; /* DIDNT READ IT YET */
     1938     2346    4               BUF$=FM$BUF$(F$DCB.BFR.BUFX(1));
     1939     2347    4               CALL FMO$SECCHK(,PINCRW(BUF$,SIZEW(FM$GRAN))->FM$GRAN);
     1940     2348    4               IF B$JIT.FACCN=F$DCB.ACCT AND B$JIT.FPSN=F$DCB.PSN
     1941     2349    4                 AND NOT B$JIT.PRIV.ACTIVE&%SUBBIT(PR_FMSEC#|PR_FMREAD#,0,18)
     1942     2350    5               THEN DO;
     1943     2351    5                  B$JIT.FACNACS=F$DCB.FFLG;
     1944     2352    5                  B$JIT.FACNCM=F$DCB.FDCM;
     1945     2353    5                  END;
     1946     2354    4               END;
     1947     2355    3            END;
     1948     2356    2         IF B$JIT.ACCN=FM$CFUA.ACCT THEN F$DCB.FFLG=F$DCB.FFLG|%FFLG_CREATE#;
     1949     2357    2         END;
     1950     2358    1      F$DCB.AUTHFFLG=F$DCB.FFLG;
PL6.E3A0      #004=FMN$READFDFIT File=FMN$OPNF.:E05TSI                           TUE 07/29/97 16:57 Page:346  
     1951     2359    1      F$DCB.WCDATA=FM$CFUA.ACCESS.WCDATA;
     1952     2360    1      F$DCB.WRCMP=FM$CFUA.ACCESS.WRCMP;
     1953     2361    1      F$DCB.BUPF=FM$CFUA.ACCESS.BUPF;
     1954     2362    1      IF NOT FM$CFUA.ACCESS.MERGEAC THEN F$DCB.FDCM=0;
     1955     2363    2      IF NOT F$DCB.FFLG AND B$JIT.PRIV.ACTIVE&%SUBBIT(PR_FMSEC#|PR_FMREAD#,0,18) THEN
              2363               DO;
     1956     2364                    /* IF NONE->READONLY, IGNORE FILE ACCESS MODIFICATIONS */
     1957     2365    2         IF NOT B$JIT.PRIV.ACTIVE.FMSEC THEN F$DCB.FDCM=511;
     1958     2366    2         F$DCB.FFLG.EXEC=%YES#;
     1959     2367    2         F$DCB.PRIVOPN='1'B;
     1960     2368    2         END;
     1961     2369    2      IF F$DCB.IASN~=%FILE# THEN DO;
     1962     2370    2         IF NOT F$DCB.FFLG THEN B$JIT.ERR=FMN$E$NOKEY;
     1963     2371    2         ELSE IF NOT F$DCB.FFLG.READ THEN B$JIT.ERR=FMN$E$NOACCESS;
     1964     2372    2         RETURN;
     1965     2373    2         END;
     1966     2374    1      IF F$DCB.FFLG THEN GOTO FLSHRET;
     1967     2375    1      IF F$DCB.FUN=%CREATE# THEN B$JIT.ERR=FMN$E$NEWFILE;
     1968     2376    1      ELSE B$JIT.ERR=FMN$E$NOFILE;
     1969     2377    1      GOTO RETALT;
     1970     2378    1   FMNE$NONEWFD: B$JIT.ERR=FMN$E$NONEWFD;
     1971     2379                    /*E*     ERROR: FMN-E$NONEWFD-E
     1972     2380                    *        MESSAGE: You may not create a new account% for %UF%
     1973     2381                    */
     1974     2382    1      ALTRETURN;
     1975     2383    1   FMNE$NEWFILE: B$JIT.ERR=FMN$E$NEWFILE;
     1976     2384    1      ALTRETURN;
     1977     2385    1   FMNE$NOFILE: B$JIT.ERR=FMN$E$NOFILE;
     1978     2386    1   ENQERR:;
     1979     2387    1      ALTRETURN;
     1980     2388    1   FLSHRET:;
     1981     2389    1      IF F$DCB.NAME.L=0 AND F$DCB.ACS~=%BLOCK#
     1982     2390    1        AND F$DCB.FFLG&%(FFLG_DELF#|FFLG_CREATE#)
     1983     2391    1      THEN CALL FMO$TRNINFO(12,PINCRW(BUF$,SIZEW(FM$GRAN)));
     1984     2392    1      B$JIT.ERR='0'B;
     1985     2393    1      CALL FMD$FLSHBUF(1);
     1986     2394    1      IF F$DCB.GTYP=FMGTFD
PL6.E3A0      #004=FMN$READFDFIT File=FMN$OPNF.:E05TSI                           TUE 07/29/97 16:57 Page:347  
     1987     2395    1      THEN CALL UQB$MDEQ(ACCT$)ALTRET(ENQERR);
     1988     2396    1      RETURN;
     1989     2397                    /**/
     1990     2398    1   FMNE$FD: B$JIT$->B$JIT.ERR=FMN$E$FD;
     1991     2399    1      CALL FMB$LOGERR(%E$FD,13,8,FDA,BUF$,SIZEW(FM$GRAN),
     1992     2400    1        SIZEW(FM$GRAN)+1,SIZEW(FM$GRAN)+2);
     1993     2401    1   RETALT:;
     1994     2402    1      CALL FMD$FLSHBUF(1);
     1995     2403    1      F$DCB.BFR.DA(1)=FDA;
     1996     2404    1      IF F$DCB.IASN=%FILE# AND F$DCB.GTYP=FMGTFD
     1997     2405    1      THEN CALL UQB$MDEQ(ACCT$)ALTRET(ENQERR);
     1998     2406    1      ALTRETURN;
     1999     2407    1   END FMN$READFDFIT;

PL6.E3A0      #004=FMN$READFDFIT File=FMN$OPNF.:E05TSI                           TUE 07/29/97 16:57 Page:348  
--  Include file information  --

   PC_SUBS_C.:E05TOU  is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
   AZ_SUBS_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   F$DCB.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
      No diagnostics issued in procedure FMN$READFDFIT.

   Procedure FMN$READFDFIT requires 432 words for executable code.
   Procedure FMN$READFDFIT requires 16 words of local(AUTO) storage.

    No errors detected in file FMN$OPNF.:E05TSI    .

PL6.E3A0      #004=FMN$READFDFIT File=FMN$OPNF.:E05TSI                           TUE 07/29/97 16:57 Page:349  

 Object Unit name= FMN$READFDFIT                              File name= FMN$OPNF.:E05TOU
 UTS= JUL 29 '97 16:57:06.72 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      6      6  FMN$READFDFIT
    1   Proc  even  none   432    660  FMN$READFDFIT
    2  RoData even  none    18     22  FMN$READFDFIT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        0  FMN$READFDFIT
PL6.E3A0      #004=FMN$READFDFIT File=FMN$OPNF.:E05TSI                           TUE 07/29/97 16:57 Page:350  

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 UQB$MENQS
 yes     yes           Std       6 FMD$REDBUF
 yes     yes           Std       2 FMO$LOCCODP
 yes     yes           Std       1 UQB$MENQX
         yes           Std       0 FMR$L8
         yes           Std       2 FMO$SECCHK
 yes     yes           Std       2 FMO$TRNINFO
         yes           Std       1 FMD$FLSHBUF
 yes     yes           Std       1 UQB$MDEQ
         yes           Std      11 FMB$LOGERR
         yes           Std       0 FMR$U8
                       nStd      0 X66_AUTO_0
                       nStd      0 X66_ARET
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AALT

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     S_CUN                                 ES_LOGFILEGRANT                       F$CFU$
     B$JIT$                                FM_PADSDA                             FM$BUF$
     B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #004=FMN$READFDFIT File=FMN$OPNF.:E05TSI                           TUE 07/29/97 16:57 Page:351  


     1803        1        /*T***********************************************************/
     1804        2        /*T*                                                         */
     1805        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1806        4        /*T*                                                         */
     1807        5        /*T***********************************************************/
     1808        6                    /*F*
     1809        7                    *     NAME:   FMN$READFDFIT
     1810        8                    *
     1811        9                    *        PURPOSE: To read,verify, and process security information
     1812       10                    *        for FILE directory FIT.
     1813       11                    *        DESCRIPTION: Entered whenever a new CFU account blkock must be
     1814       12                   *       set up. If 'new', the PAD FIT is read instead and newfd checked.
     1815       13                    *        The access and granule info is moved to the new acct block.
     1816       14                    *        Also entered if the account has 09 vlp entries (indicated by
     1817       15                   *       'ACCESS' in CODE14 and acct block). This info is used perhaps to
     1818       16                    *        abort the open.
     1819       17                    */
     1820       18        FMN$READFDFIT: PROC ALTRET;

     18  1 000000   000000 700200 xent  FMN$READFDF* TSX0  ! X66_AUTO_0
         1 000001   000020 000000                    ZERO    16,0

     1821       19                    /**/
     1822       20                    /* AUTOMATIC DATA */
     1823       21                    /**/
     1824       22    1   DCL JDCB$ PTR; /* DCB POINTER */
     1825       23    1   DCL ACCT$ PTR; /* ACCOUNT BLOCK POINTER */
     1826       24    1   DCL FIT$ PTR; /* FIT PINTER */
     1827       25    1   DCL BUF$ PTR; /* BUFFER POINTER */
     1828       26    1   DCL FDA SBIN; /* SET RELATIVE DISK ADDRESS */
     1829       27                    /**/
     1830       28                    /* EXTERNAL ROUTINES */
     1831       29    1   DCL FMD$REDBUF ENTRY(6) ALTRET; /* READ THE FIT */
     1832       30    1   DCL FMO$LOCCODP ENTRY(2) ALTRET; /* LOCATE FIT CODE */
     1833       31    1   DCL FMB$LOGERR ENTRY(11);
     1834       32    1   DCL FMD$FLSHBUF ENTRY(1);
PL6.E3A0      #004=FMN$READFDFIT File=FMN$OPNF.:E05TSI                           TUE 07/29/97 16:57 Page:352  
     1835       33    1   DCL FMO$TRNINFO ENTRY(2)ALTRET;
     1836       34    1   DCL FMO$SECCHK ENTRY(2);
     1837       35    1   DCL FMR$L8 ENTRY;
     1838       36    1   DCL FMR$U8 ENTRY;
     1839       37    1   DCL UQB$MENQS ENTRY(1)ALTRET;
     1840       38    1   DCL UQB$MENQX ENTRY(1)ALTRET;
     1841       39    1   DCL UQB$MDEQ ENTRY(1)ALTRET;
     1842       40                    /**/
     1843       41        %INCLUDE FM$MACROS;
     1844      416        %FM$CFUA(BASED="BASED(ACCT$)");
     1845      422        %FM$CFU(BASED="BASED(ACCT$)");
     1846      428        %CODE14(BASED="BASED(FIT$)");
     1847      438        %FM$GRAN;
     1848      442        %FM$SET(BASED="BASED(F$CFU$)");
     1849      447        %INCLUDE CP_6_SUBS;
     1850      987        %MACRO F$DCB#(BASED=BASED);
     1851      988        %INCLUDE F$DCB;
     1852     1037        %MEND;
     1853     1038        %F$DCB#(BASED="BASED(JDCB$)");
     1854     1088        %INCLUDE F_ERRORS_C;
     1855     1328        %INCLUDE AZ_SUBS_C;
     1856     1397        %INCLUDE F$JIT_C;
     1857     1827        %INCLUDE JG_GHOSTS_C;
     1858     1917        %INCLUDE PC_SUBS_C;
     1859     2249                    /**/
     1860     2250    1   DCL S_CUN SBIN SYMREF;
     1861     2251    1   DCL ES_LOGFILEGRANT SBIN SYMREF;
     1862     2252    1   DCL F$CFU$ SYMREF PTR; /* POINTER TO THE CFU SEGMENT */
     1863     2253    1   DCL B$JIT$ PTR SYMREF; /* POINTER TO THE JIT */
     1864     2254    1   DCL FM_PADSDA SBIN SYMREF;
     1865     2255    1   DCL FM$BUF$(0:0)PTR SYMREF;
     1866     2256        %SUB FCG#='0615'O;
     1867     2257        %SUB MID#='16'O;
     1868     2258        %ERRCODE(NAME=FMN$E$NEWFILE,COD#=%E$NEWFILE);
     1869     2262        %ERRCODE(NAME=FMN$E$FD,COD#=%E$FD);
     1870     2266        %ERRCODE(NAME=FMN$E$NONEWFD,COD#=%E$NONEWFD);
     1871     2270        %ERRCODE(NAME=FMN$E$NOFILE,COD#=%E$NOFILE);
PL6.E3A0      #004=FMN$READFDFIT File=FMN$OPNF.:E05TSI                           TUE 07/29/97 16:57 Page:353  
     1872     2274        %ERRCODE(NAME=FMN$E$NOACCESS,COD#=%E$NOACCESS);
     1873     2278        %ERRCODE(NAME=FMN$E$NOKEY,COD#=%E$NOKEY);
     1874     2282                    /**/
     1875     2283    1      JDCB$=B$JIT.DCB$;

   2283  1 000002   000000 470400 xsym               LDP0    B$JIT$
         1 000003   000232 236100                    LDQ     154,,PR0
         1 000004   200003 756100                    STQ     JDCB$,,AUTO

     1876     2284    1      IF F$DCB.FFLG THEN RETURN; /* WE'VE BEEN HERE BEFORE */

   2284  1 000005   200003 471500                    LDP1    JDCB$,,AUTO
         1 000006   100004 220100                    LDX0    4,,PR1
         1 000007   000011 600000 1                  TZE     s:2285

   2284  1 000010   000000 702200 xent               TSX2  ! X66_ARET

     1877     2285    1      F$DCB.GTYP=FMGTFIT;

   2285  1 000011   100064 236100                    LDQ     52,,PR1
         1 000012   000000 376000 2                  ANQ     0
         1 000013   024000 276003                    ORQ     10240,DU
         1 000014   100064 756100                    STQ     52,,PR1

     1878     2286    1      ACCT$=PINCRW(F$CFU$,F$DCB.CFU$->FM$CFU.ACCTX);

   2286  1 000015   100066 473500                    LDP3    54,,PR1
         1 000016   300002 221100                    LDX1    2,,PR3
         1 000017   000000 636011                    EAQ     0,X1
         1 000020   000000 036000 xsym               ADLQ    F$CFU$
         1 000021   200004 756100                    STQ     ACCT$,,AUTO

     1879     2287    1      IF F$DCB.IASN=%FILE# AND F$DCB.NAME.L~=0

   2287  1 000022   100103 236100                    LDQ     67,,PR1
         1 000023   000777 376007                    ANQ     511,DL
         1 000024   000001 116007                    CMPQ    1,DL
PL6.E3A0      #004=FMN$READFDFIT File=FMN$OPNF.:E05TSI                           TUE 07/29/97 16:57 Page:354  
         1 000025   000034 601000 1                  TNZ     REREAD
         1 000026   100010 236100                    LDQ     8,,PR1
         1 000027   777000 316003                    CANQ    -512,DU
         1 000030   000034 600000 1                  TZE     REREAD
         1 000031   200004 474500                    LDP4    ACCT$,,AUTO
         1 000032   400005 234100                    SZN     5,,PR4
         1 000033   000257 604000 1                  TMI     SECCHKFD

   2287  1 000034                       REREAD       null
     1880     2288    1        AND FM$CFUA.FLAGS.EXIST THEN GOTO SECCHKFD;
     1881     2289    1   REREAD:;
     1882     2290    2      IF FM$CFUA.FDFITSDA=0 THEN DO;/* A NEW ACCOUNT */

   2290  1 000034   200004 470500                    LDP0    ACCT$,,AUTO
         1 000035   000004 235100                    LDA     4,,PR0
         1 000036   000053 601000 1                  TNZ     s:2296

     1883     2291    2         IF F$DCB.FUN~=%CREATE# THEN GOTO FMNE$NOFILE;

   2291  1 000037   200003 471500                    LDP1    JDCB$,,AUTO
         1 000040   100032 236100                    LDQ     26,,PR1
         1 000041   000777 376003                    ANQ     511,DU
         1 000042   000003 116003                    CMPQ    3,DU
         1 000043   000535 601000 1                  TNZ     FMNE$NOFILE

     1884     2292    2         FDA=FM_PADSDA;

   2292  1 000044   000000 235000 xsym               LDA     FM_PADSDA
         1 000045   200007 755100                    STA     FDA,,AUTO

     1885     2293    2         F$DCB.GTYP=FMGTPAD;

   2293  1 000046   100064 236100                    LDQ     52,,PR1
         1 000047   000000 376000 2                  ANQ     0
         1 000050   014000 276003                    ORQ     6144,DU
         1 000051   100064 756100                    STQ     52,,PR1

PL6.E3A0      #004=FMN$READFDFIT File=FMN$OPNF.:E05TSI                           TUE 07/29/97 16:57 Page:355  
     1886     2294    2         END;

   2294  1 000052   000076 710000 1                  TRA     s:2300

     1887     2295    2      ELSE DO;

     1888     2296    2         IF F$DCB.IASN=%FILE# THEN CALL UQB$MENQS(ACCT$)ALTRET(ENQERR);

   2296  1 000053   200003 471500                    LDP1    JDCB$,,AUTO
         1 000054   100103 236100                    LDQ     67,,PR1
         1 000055   000777 376007                    ANQ     511,DL
         1 000056   000001 116007                    CMPQ    1,DL
         1 000057   000066 601000 1                  TNZ     s:2297

   2296  1 000060   200004 633500                    EPPR3   ACCT$,,AUTO
         1 000061   200010 453500                    STP3    FDA+1,,AUTO
         1 000062   200010 630500                    EPPR0   FDA+1,,AUTO
         1 000063   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000064   000000 701000 xent               TSX1    UQB$MENQS
         1 000065   000540 702000 1                  TSX2    ENQERR

     1889     2297    2         JDCB$->F$DCB.GTYP=FMGTFD;

   2297  1 000066   200003 470500                    LDP0    JDCB$,,AUTO
         1 000067   000064 236100                    LDQ     52,,PR0
         1 000070   000000 376000 2                  ANQ     0
         1 000071   020000 276003                    ORQ     8192,DU
         1 000072   000064 756100                    STQ     52,,PR0

     1890     2298    2         FDA=ACCT$->FM$CFUA.FDFITSDA;

   2298  1 000073   200004 471500                    LDP1    ACCT$,,AUTO
         1 000074   100004 235100                    LDA     4,,PR1
         1 000075   200007 755100                    STA     FDA,,AUTO

     1891     2299    2         END;

PL6.E3A0      #004=FMN$READFDFIT File=FMN$OPNF.:E05TSI                           TUE 07/29/97 16:57 Page:356  
     1892     2300    1      CALL FMD$REDBUF(BUF$,1,FDA,,0) ALTRET(RETALT);

   2300  1 000076   000001 236000 2                  LDQ     1
         1 000077   200014 756100                    STQ     FDA+5,,AUTO
         1 000100   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000101   200013 756100                    STQ     FDA+4,,AUTO
         1 000102   200007 630500                    EPPR0   FDA,,AUTO
         1 000103   200012 450500                    STP0    FDA+3,,AUTO
         1 000104   000002 236000 2                  LDQ     2
         1 000105   200011 756100                    STQ     FDA+2,,AUTO
         1 000106   200006 631500                    EPPR1   BUF$,,AUTO
         1 000107   200010 451500                    STP1    FDA+1,,AUTO
         1 000110   200010 630500                    EPPR0   FDA+1,,AUTO
         1 000111   000023 631400 xsym               EPPR1   B_VECTNIL+19
         1 000112   000000 701000 xent               TSX1    FMD$REDBUF
         1 000113   000632 702000 1                  TSX2    RETALT

     1893     2301    1      FIT$=PINCRW(BUF$,SIZEW(FM$GRAN));

   2301  1 000114   200006 236100                    LDQ     BUF$,,AUTO
         1 000115   000005 036003                    ADLQ    5,DU
         1 000116   200005 756100                    STQ     FIT$,,AUTO

     1894     2302    1      CALL FMO$LOCCODP(FIT$,14) ALTRET(FMNE$FD);

   2302  1 000117   000004 236000 2                  LDQ     4
         1 000120   200011 756100                    STQ     FDA+2,,AUTO
         1 000121   200005 630500                    EPPR0   FIT$,,AUTO
         1 000122   200010 450500                    STP0    FDA+1,,AUTO
         1 000123   200010 630500                    EPPR0   FDA+1,,AUTO
         1 000124   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000125   000000 701000 xent               TSX1    FMO$LOCCODP
         1 000126   000607 702000 1                  TSX2    FMNE$FD

     1895     2303    2      IF NOT FM$CFUA.FLAGS THEN DO;

   2303  1 000127   200004 470500                    LDP0    ACCT$,,AUTO
PL6.E3A0      #004=FMN$READFDFIT File=FMN$OPNF.:E05TSI                           TUE 07/29/97 16:57 Page:357  
         1 000130   000005 236100                    LDQ     5,,PR0
         1 000131   600000 316003                    CANQ    -65536,DU
         1 000132   000155 601000 1                  TNZ     s:2310

     1896     2304    2         FM$CFUA.GRANS=CODE14.MGRANS-CODE14.CGRANS;

   2304  1 000133   200005 471500                    LDP1    FIT$,,AUTO
         1 000134   100001 236100                    LDQ     1,,PR1
         1 000135   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 000136   100002 136100                    SBLQ    2,,PR1
         1 000137   000007 756100                    STQ     7,,PR0

     1897     2305    2         FM$CFUA.ACCESS=CODE14.ACCESS;

   2305  1 000140   100000 220100                    LDX0    0,,PR1
         1 000141   000005 440100                    SXL0    5,,PR0

     1898     2306    2         FM$CFUA.DFLTALL=CODE14.DFLTALL;

   2306  1 000142   200005 471500                    LDP1    FIT$,,AUTO
         1 000143   100000 721100                    LXL1    0,,PR1
         1 000144   000006 441100                    SXL1    6,,PR0

     1899     2307    2         IF FM$CFUA.FDFITSDA=0 THEN FM$CFUA.FLAGS.NEW='1'B;

   2307  1 000145   000004 235100                    LDA     4,,PR0
         1 000146   000152 601000 1                  TNZ     s:2308

   2307  1 000147   200000 236003                    LDQ     65536,DU
         1 000150   000005 256100                    ORSQ    5,,PR0
         1 000151   000222 710000 1                  TRA     s:2321

     1900     2308    2         ELSE FM$CFUA.FLAGS.EXIST='1'B;

   2308  1 000152   400000 236003                    LDQ     -131072,DU
         1 000153   000005 256100                    ORSQ    5,,PR0

PL6.E3A0      #004=FMN$READFDFIT File=FMN$OPNF.:E05TSI                           TUE 07/29/97 16:57 Page:358  
     1901     2309    2         END;

   2309  1 000154   000222 710000 1                  TRA     s:2321

     1902     2310    2      ELSE IF FM$CFUA.FLAGS.EXIST AND FM$CFUA.GMOD~=0 THEN DO;

   2310  1 000155   000005 234100                    SZN     5,,PR0
         1 000156   000222 605000 1                  TPL     s:2321
         1 000157   100000 316003                    CANQ    32768,DU
         1 000160   000222 600000 1                  TZE     s:2321

     1903     2311    2            CODE14.CGRANS=CODE14.MGRANS-FM$CFUA.GRANS;/*GET IT RIGHT FOR FPARAM*/

   2311  1 000161   200005 471500                    LDP1    FIT$,,AUTO
         1 000162   100001 236100                    LDQ     1,,PR1
         1 000163   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 000164   000007 136100                    SBLQ    7,,PR0
         1 000165   100002 756100                    STQ     2,,PR1

     1904     2312    3            IF F$DCB.IASN=%FILE# THEN DO;/* DEVICE MAY DEADLOCK */

   2312  1 000166   200003 470500                    LDP0    JDCB$,,AUTO
         1 000167   000103 236100                    LDQ     67,,PR0
         1 000170   000777 376007                    ANQ     511,DL
         1 000171   000001 116007                    CMPQ    1,DL
         1 000172   000222 601000 1                  TNZ     s:2321

     1905     2313    3               CALL UQB$MENQX(ACCT$)ALTRET(SECCHKFD);/*EVEN IF THIS FAILS */

   2313  1 000173   200004 631500                    EPPR1   ACCT$,,AUTO
         1 000174   200010 451500                    STP1    FDA+1,,AUTO
         1 000175   200010 630500                    EPPR0   FDA+1,,AUTO
         1 000176   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000177   000000 701000 xent               TSX1    UQB$MENQX
         1 000200   000257 702000 1                  TSX2    SECCHKFD

     1906     2314    3               CALL FMR$L8;
PL6.E3A0      #004=FMN$READFDFIT File=FMN$OPNF.:E05TSI                           TUE 07/29/97 16:57 Page:359  

   2314  1 000201   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000202   000000 701000 xent               TSX1    FMR$L8
         1 000203   000000 011000                    NOP     0

     1907     2315    3               FM$CFUA.GMOD=0;

   2315  1 000204   200004 470500                    LDP0    ACCT$,,AUTO
         1 000205   000005 236000 2                  LDQ     5
         1 000206   000005 356100                    ANSQ    5,,PR0

     1908     2316    3               CODE14.CGRANS=CODE14.MGRANS-FM$CFUA.GRANS;

   2316  1 000207   200005 471500                    LDP1    FIT$,,AUTO
         1 000210   100001 236100                    LDQ     1,,PR1
         1 000211   000032 376000 xsym               ANQ     B_VECTNIL+26
         1 000212   000007 136100                    SBLQ    7,,PR0
         1 000213   100002 756100                    STQ     2,,PR1

     1909     2317    3               F$DCB.BFR.BUFUP(1)='1'B;

   2317  1 000214   200003 470500                    LDP0    JDCB$,,AUTO
         1 000215   400000 236003                    LDQ     -131072,DU
         1 000216   000116 256100                    ORSQ    78,,PR0

     1910     2318    3               CALL FMR$U8;

   2318  1 000217   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000220   000000 701000 xent               TSX1    FMR$U8
         1 000221   000000 011000                    NOP     0

     1911     2319    3               END;

     1912     2320    2            END;

     1913     2321    1      IF F$DCB.IASN=%FILE# AND FM$CFUA.FDFITSDA=0 THEN

PL6.E3A0      #004=FMN$READFDFIT File=FMN$OPNF.:E05TSI                           TUE 07/29/97 16:57 Page:360  
   2321  1 000222   200003 470500                    LDP0    JDCB$,,AUTO
         1 000223   000103 236100                    LDQ     67,,PR0
         1 000224   000777 376007                    ANQ     511,DL
         1 000225   000001 116007                    CMPQ    1,DL
         1 000226   000257 601000 1                  TNZ     SECCHKFD
         1 000227   200004 471500                    LDP1    ACCT$,,AUTO
         1 000230   100004 235100                    LDA     4,,PR1
         1 000231   000257 601000 1                  TNZ     SECCHKFD

     1914     2322    1         IF NOT B$JIT.PRIV.ACTIVE.FMSEC AND

   2322  1 000232   000000 473400 xsym               LDP3    B$JIT$
         1 000233   300013 236100                    LDQ     11,,PR3
         1 000234   100000 316003                    CANQ    32768,DU
         1 000235   000253 601000 1                  TNZ     s:2325
         1 000236   000051 236100                    LDQ     41,,PR0
         1 000237   000003 736000                    QLS     3
         1 000240   000006 376000 2                  ANQ     6
         1 000241   000002 736000                    QLS     2
         1 000242   000000 474400 xsym               LDP4    F$CFU$
         1 000243   040100 106506                    CMPC    fill='040'O
         1 000244   400000 400006                    ADSC9   0,Q,PR4                  cn=2,n=6
         1 000245   300234 000006                    ADSC9   156,,PR3                 cn=0,n=6
         1 000246   000532 601000 1                  TNZ     FMNE$NEWFILE
         1 000247   040100 106500                    CMPC    fill='040'O
         1 000250   100001 000010                    ADSC9   1,,PR1                   cn=0,n=8
         1 000251   300001 000010                    ADSC9   1,,PR3                   cn=0,n=8
         1 000252   000532 601000 1                  TNZ     FMNE$NEWFILE

     1915     2323    1           (FM$SET.PSN(F$DCB.SETX)~=B$JIT.HPSN OR FM$CFUA.ACCT~=B$JIT.ACCN)
     1916     2324    1         THEN GOTO FMNE$NEWFILE;
     1917     2325    1         ELSE IF NOT CODE14.ACCESS.NEWFD THEN GOTO FMNE$NONEWFD;

   2325  1 000253   200005 474500                    LDP4    FIT$,,AUTO
         1 000254   400000 236100                    LDQ     0,,PR4
         1 000255   000001 316003                    CANQ    1,DU
         1 000256   000527 600000 1                  TZE     FMNE$NONEWFD
PL6.E3A0      #004=FMN$READFDFIT File=FMN$OPNF.:E05TSI                           TUE 07/29/97 16:57 Page:361  

   2325  1 000257                       SECCHKFD     null
     1918     2326                    /* NOW DO THE ACCOUNT ACCESS CONTROL */
     1919     2327    1   SECCHKFD:;
     1920     2328    1      B$JIT.ERR='0'B;

   2328  1 000257   000000 470400 xsym               LDP0    B$JIT$
         1 000260   000012 450100                    STZ     10,,PR0

     1921     2329    1      IF B$JIT.PRIV.ACTIVE.FMSEC AND (ES_LOGFILEGRANT~=%PC_ES_YES#

   2329  1 000261   000013 236100                    LDQ     11,,PR0
         1 000262   100000 316003                    CANQ    32768,DU
         1 000263   000274 600000 1                  TZE     s:2329+11
         1 000264   000000 235000 xsym               LDA     ES_LOGFILEGRANT
         1 000265   000001 115007                    CMPA    1,DL
         1 000266   000315 601000 1                  TNZ     s:2334
         1 000267   200000 316003                    CANQ    65536,DU
         1 000270   000315 601000 1                  TNZ     s:2334
         1 000271   000000 235000 xsym               LDA     S_CUN
         1 000272   000017 115007                    CMPA    15,DL
         1 000273   000315 604000 1                  TMI     s:2334
         1 000274   200004 471500                    LDP1    ACCT$,,AUTO
         1 000275   040100 106500                    CMPC    fill='040'O
         1 000276   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8
         1 000277   100001 000010                    ADSC9   1,,PR1                   cn=0,n=8
         1 000300   000304 601000 1                  TNZ     s:2329+19
         1 000301   100005 236100                    LDQ     5,,PR1
         1 000302   004000 316007                    CANQ    2048,DL
         1 000303   000315 601000 1                  TNZ     s:2334
         1 000304   200003 473500                    LDP3    JDCB$,,AUTO
         1 000305   300103 236100                    LDQ     67,,PR3
         1 000306   000777 376007                    ANQ     511,DL
         1 000307   000007 116007                    CMPQ    7,DL
         1 000310   000315 600000 1                  TZE     s:2334
         1 000311   300040 236100                    LDQ     32,,PR3
         1 000312   000777 376003                    ANQ     511,DU
PL6.E3A0      #004=FMN$READFDFIT File=FMN$OPNF.:E05TSI                           TUE 07/29/97 16:57 Page:362  
         1 000313   000001 116003                    CMPQ    1,DU
         1 000314   000321 601000 1                  TNZ     s:2336

     1922     2330    1        OR B$JIT.PRIV.ACTIVE.FMBLK OR S_CUN<%JG_MING#)
     1923     2331    1        OR B$JIT.ACCN=FM$CFUA.ACCT
     1924     2332    1        AND FM$CFUA.ACCESS.OWNERF
     1925     2333    1        OR F$DCB.IASN=%FMDIAG#
     1926     2334    1        OR F$DCB.WSR=1 THEN F$DCB.FFLG=%FFLG_OWNER#;

   2334  1 000315   765700 220003                    LDX0    -5184,DU
         1 000316   200003 471500                    LDP1    JDCB$,,AUTO
         1 000317   100004 740100                    STX0    4,,PR1
         1 000320   000426 710000 1                  TRA     s:2358

     1927     2335    2      ELSE DO;

     1928     2336    2         F$DCB.FFLG=FM$CFUA.DFLTALL;

   2336  1 000321   100006 720100                    LXL0    6,,PR1
         1 000322   300004 740100                    STX0    4,,PR3

     1929     2337    3         IF FM$CFUA.ACCESS.LIST OR B$JIT.PRIV.ACTIVE.FMSEC THEN DO;

   2337  1 000323   200004 471500                    LDP1    ACCT$,,AUTO
         1 000324   100005 236100                    LDQ     5,,PR1
         1 000325   200000 316007                    CANQ    65536,DL
         1 000326   000332 601000 1                  TNZ     s:2338
         1 000327   000013 236100                    LDQ     11,,PR0
         1 000330   100000 316003                    CANQ    32768,DU
         1 000331   000414 600000 1                  TZE     s:2356

     1930     2338    3            IF B$JIT.FACCN=F$DCB.ACCT AND B$JIT.FPSN=F$DCB.PSN AND B$JIT.FACNACS

   2338  1 000332   000006 237100                    LDAQ    6,,PR0
         1 000333   300020 117100                    CMPAQ   16,,PR3
         1 000334   000353 601000 1                  TNZ     s:2345
         1 000335   040100 106500                    CMPC    fill='040'O
PL6.E3A0      #004=FMN$READFDFIT File=FMN$OPNF.:E05TSI                           TUE 07/29/97 16:57 Page:363  
         1 000336   000021 000006                    ADSC9   17,,PR0                  cn=0,n=6
         1 000337   300024 000006                    ADSC9   20,,PR3                  cn=0,n=6
         1 000340   000353 601000 1                  TNZ     s:2345
         1 000341   000235 721100                    LXL1    157,,PR0
         1 000342   000353 600000 1                  TZE     s:2345
         1 000343   000013 236100                    LDQ     11,,PR0
         1 000344   120000 376003                    ANQ     40960,DU
         1 000345   000353 601000 1                  TNZ     s:2345

     1931     2339    3              AND NOT B$JIT.PRIV.ACTIVE&%SUBBIT(PR_FMSEC#|PR_FMREAD#,0,18)
     1932     2340    4            THEN DO;

     1933     2341    4               F$DCB.FFLG=B$JIT.FACNACS;

   2341  1 000346   300004 741100                    STX1    4,,PR3

     1934     2342    4               F$DCB.FDCM=B$JIT.FACNCM;

   2342  1 000347   000250 236100                    LDQ     168,,PR0
         1 000350   000033 772000                    QRL     27
         1 000351   300073 552104                    STBQ    59,'04'O,PR3

     1935     2343    4               END;

   2343  1 000352   000414 710000 1                  TRA     s:2356

     1936     2344    4            ELSE DO;

     1937     2345    4               IF F$DCB.GTYP=FMGTFIT THEN GOTO REREAD; /* DIDNT READ IT YET */

   2345  1 000353   300064 236100                    LDQ     52,,PR3
         1 000354   034000 376003                    ANQ     14336,DU
         1 000355   024000 116003                    CMPQ    10240,DU
         1 000356   000034 600000 1                  TZE     REREAD

     1938     2346    4               BUF$=FM$BUF$(F$DCB.BFR.BUFX(1));

PL6.E3A0      #004=FMN$READFDFIT File=FMN$OPNF.:E05TSI                           TUE 07/29/97 16:57 Page:364  
   2346  1 000357   300116 236100                    LDQ     78,,PR3
         1 000360   000033 772000                    QRL     27
         1 000361   000037 376007                    ANQ     31,DL
         1 000362   000000 236006 xsym               LDQ     FM$BUF$,QL
         1 000363   200006 756100                    STQ     BUF$,,AUTO

     1939     2347    4               CALL FMO$SECCHK(,PINCRW(BUF$,SIZEW(FM$GRAN))->FM$GRAN);

   2347  1 000364   000005 036003                    ADLQ    5,DU
         1 000365   000001 235000 xsym               LDA     B_VECTNIL+1
         1 000366   200010 757100                    STAQ    FDA+1,,AUTO
         1 000367   200010 630500                    EPPR0   FDA+1,,AUTO
         1 000370   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000371   000000 701000 xent               TSX1    FMO$SECCHK
         1 000372   000000 011000                    NOP     0

     1940     2348    4               IF B$JIT.FACCN=F$DCB.ACCT AND B$JIT.FPSN=F$DCB.PSN

   2348  1 000373   200003 470500                    LDP0    JDCB$,,AUTO
         1 000374   000000 471400 xsym               LDP1    B$JIT$
         1 000375   100006 237100                    LDAQ    6,,PR1
         1 000376   000020 117100                    CMPAQ   16,,PR0
         1 000377   000414 601000 1                  TNZ     s:2356
         1 000400   040100 106500                    CMPC    fill='040'O
         1 000401   100021 000006                    ADSC9   17,,PR1                  cn=0,n=6
         1 000402   000024 000006                    ADSC9   20,,PR0                  cn=0,n=6
         1 000403   000414 601000 1                  TNZ     s:2356
         1 000404   100013 236100                    LDQ     11,,PR1
         1 000405   120000 376003                    ANQ     40960,DU
         1 000406   000414 601000 1                  TNZ     s:2356

     1941     2349    4                 AND NOT B$JIT.PRIV.ACTIVE&%SUBBIT(PR_FMSEC#|PR_FMREAD#,0,18)
     1942     2350    5               THEN DO;

     1943     2351    5                  B$JIT.FACNACS=F$DCB.FFLG;

   2351  1 000407   000004 220100                    LDX0    4,,PR0
PL6.E3A0      #004=FMN$READFDFIT File=FMN$OPNF.:E05TSI                           TUE 07/29/97 16:57 Page:365  
         1 000410   100235 440100                    SXL0    157,,PR1

     1944     2352    5                  B$JIT.FACNCM=F$DCB.FDCM;

   2352  1 000411   000073 236100                    LDQ     59,,PR0
         1 000412   000033 736000                    QLS     27
         1 000413   100250 552140                    STBQ    168,'40'O,PR1

     1945     2353    5                  END;

     1946     2354    4               END;

     1947     2355    3            END;

     1948     2356    2         IF B$JIT.ACCN=FM$CFUA.ACCT THEN F$DCB.FFLG=F$DCB.FFLG|%FFLG_CREATE#;

   2356  1 000414   000000 470400 xsym               LDP0    B$JIT$
         1 000415   200004 471500                    LDP1    ACCT$,,AUTO
         1 000416   040100 106500                    CMPC    fill='040'O
         1 000417   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8
         1 000420   100001 000010                    ADSC9   1,,PR1                   cn=0,n=8
         1 000421   000426 601000 1                  TNZ     s:2358

   2356  1 000422   200003 473500                    LDP3    JDCB$,,AUTO
         1 000423   300004 220100                    LDX0    4,,PR3
         1 000424   001000 260003                    ORX0    512,DU
         1 000425   300004 740100                    STX0    4,,PR3

     1949     2357    2         END;

     1950     2358    1      F$DCB.AUTHFFLG=F$DCB.FFLG;

   2358  1 000426   200003 471500                    LDP1    JDCB$,,AUTO
         1 000427   100004 220100                    LDX0    4,,PR1
         1 000430   100057 440100                    SXL0    47,,PR1

     1951     2359    1      F$DCB.WCDATA=FM$CFUA.ACCESS.WCDATA;
PL6.E3A0      #004=FMN$READFDFIT File=FMN$OPNF.:E05TSI                           TUE 07/29/97 16:57 Page:366  

   2359  1 000431   200004 473500                    LDP3    ACCT$,,AUTO
         1 000432   300005 236100                    LDQ     5,,PR3
         1 000433   000013 736000                    QLS     11
         1 000434   100067 676100                    ERQ     55,,PR1
         1 000435   002000 376003                    ANQ     1024,DU
         1 000436   100067 656100                    ERSQ    55,,PR1

     1952     2360    1      F$DCB.WRCMP=FM$CFUA.ACCESS.WRCMP;

   2360  1 000437   300005 236100                    LDQ     5,,PR3
         1 000440   000016 736000                    QLS     14
         1 000441   100067 676100                    ERQ     55,,PR1
         1 000442   004000 376003                    ANQ     2048,DU
         1 000443   100067 656100                    ERSQ    55,,PR1

     1953     2361    1      F$DCB.BUPF=FM$CFUA.ACCESS.BUPF;

   2361  1 000444   300005 236100                    LDQ     5,,PR3
         1 000445   000015 736000                    QLS     13
         1 000446   100003 676100                    ERQ     3,,PR1
         1 000447   001000 376003                    ANQ     512,DU
         1 000450   100003 656100                    ERSQ    3,,PR1

     1954     2362    1      IF NOT FM$CFUA.ACCESS.MERGEAC THEN F$DCB.FDCM=0;

   2362  1 000451   200004 473500                    LDP3    ACCT$,,AUTO
         1 000452   300005 236100                    LDQ     5,,PR3
         1 000453   000400 316007                    CANQ    256,DL
         1 000454   000457 601000 1                  TNZ     s:2363

   2362  1 000455   000000 236003                    LDQ     0,DU
         1 000456   100073 552104                    STBQ    59,'04'O,PR1

     1955     2363    2      IF NOT F$DCB.FFLG AND B$JIT.PRIV.ACTIVE&%SUBBIT(PR_FMSEC#|PR_FMREAD#,0,18) THEN
              2363               DO;

PL6.E3A0      #004=FMN$READFDFIT File=FMN$OPNF.:E05TSI                           TUE 07/29/97 16:57 Page:367  
   2363  1 000457   000000 100003                    CMPX0   0,DU
         1 000460   000475 601000 1                  TNZ     s:2369
         1 000461   000013 236100                    LDQ     11,,PR0
         1 000462   120000 376003                    ANQ     40960,DU
         1 000463   000475 600000 1                  TZE     s:2369

     1956     2364                    /* IF NONE->READONLY, IGNORE FILE ACCESS MODIFICATIONS */
     1957     2365    2         IF NOT B$JIT.PRIV.ACTIVE.FMSEC THEN F$DCB.FDCM=511;

   2365  1 000464   000013 236100                    LDQ     11,,PR0
         1 000465   100000 316003                    CANQ    32768,DU
         1 000466   000471 601000 1                  TNZ     s:2366

   2365  1 000467   000777 236007                    LDQ     511,DL
         1 000470   100073 552104                    STBQ    59,'04'O,PR1

     1958     2366    2         F$DCB.FFLG.EXEC=%YES#;

   2366  1 000471   002000 236003                    LDQ     1024,DU
         1 000472   100004 256100                    ORSQ    4,,PR1

     1959     2367    2         F$DCB.PRIVOPN='1'B;

   2367  1 000473   200000 236003                    LDQ     65536,DU
         1 000474   100102 256100                    ORSQ    66,,PR1

     1960     2368    2         END;

     1961     2369    2      IF F$DCB.IASN~=%FILE# THEN DO;

   2369  1 000475   100103 236100                    LDQ     67,,PR1
         1 000476   000777 376007                    ANQ     511,DL
         1 000477   000001 116007                    CMPQ    1,DL
         1 000500   000513 600000 1                  TZE     s:2374

     1962     2370    2         IF NOT F$DCB.FFLG THEN B$JIT.ERR=FMN$E$NOKEY;

PL6.E3A0      #004=FMN$READFDFIT File=FMN$OPNF.:E05TSI                           TUE 07/29/97 16:57 Page:368  
   2370  1 000501   100004 221100                    LDX1    4,,PR1
         1 000502   000506 601000 1                  TNZ     s:2371

   2370  1 000503   000005 236000 0                  LDQ     FMN$E$NOKEY
         1 000504   000012 756100                    STQ     10,,PR0
         1 000505   000512 710000 1                  TRA     s:2372

     1963     2371    2         ELSE IF NOT F$DCB.FFLG.READ THEN B$JIT.ERR=FMN$E$NOACCESS;

   2371  1 000506   100004 234100                    SZN     4,,PR1
         1 000507   000512 604000 1                  TMI     s:2372

   2371  1 000510   000004 236000 0                  LDQ     FMN$E$NOACCESS
         1 000511   000012 756100                    STQ     10,,PR0

     1964     2372    2         RETURN;

   2372  1 000512   000000 702200 xent               TSX2  ! X66_ARET

     1965     2373    2         END;
     1966     2374    1      IF F$DCB.FFLG THEN GOTO FLSHRET;

   2374  1 000513   100004 221100                    LDX1    4,,PR1
         1 000514   000541 601000 1                  TNZ     FLSHRET

     1967     2375    1      IF F$DCB.FUN=%CREATE# THEN B$JIT.ERR=FMN$E$NEWFILE;

   2375  1 000515   100032 236100                    LDQ     26,,PR1
         1 000516   000777 376003                    ANQ     511,DU
         1 000517   000003 116003                    CMPQ    3,DU
         1 000520   000524 601000 1                  TNZ     s:2376

   2375  1 000521   000000 236000 0                  LDQ     FMN$E$NEWFILE
         1 000522   000012 756100                    STQ     10,,PR0
         1 000523   000526 710000 1                  TRA     s:2377

     1968     2376    1      ELSE B$JIT.ERR=FMN$E$NOFILE;
PL6.E3A0      #004=FMN$READFDFIT File=FMN$OPNF.:E05TSI                           TUE 07/29/97 16:57 Page:369  

   2376  1 000524   000003 236000 0                  LDQ     FMN$E$NOFILE
         1 000525   000012 756100                    STQ     10,,PR0

     1969     2377    1      GOTO RETALT;

   2377  1 000526   000632 710000 1                  TRA     RETALT

     1970     2378    1   FMNE$NONEWFD: B$JIT.ERR=FMN$E$NONEWFD;

   2378  1 000527   000002 236000 0     FMNE$NONEWFD LDQ     FMN$E$NONEWFD
         1 000530   300012 756100                    STQ     10,,PR3

     1971     2379                    /*E*     ERROR: FMN-E$NONEWFD-E
     1972     2380                    *        MESSAGE: You may not create a new account% for %UF%
     1973     2381                    */
     1974     2382    1      ALTRETURN;

   2382  1 000531   000000 702200 xent               TSX2  ! X66_AALT

     1975     2383    1   FMNE$NEWFILE: B$JIT.ERR=FMN$E$NEWFILE;

   2383  1 000532   000000 236000 0     FMNE$NEWFILE LDQ     FMN$E$NEWFILE
         1 000533   300012 756100                    STQ     10,,PR3

     1976     2384    1      ALTRETURN;

   2384  1 000534   000000 702200 xent               TSX2  ! X66_AALT

     1977     2385    1   FMNE$NOFILE: B$JIT.ERR=FMN$E$NOFILE;

   2385  1 000535   000003 236000 0     FMNE$NOFILE  LDQ     FMN$E$NOFILE
         1 000536   000000 473400 xsym               LDP3    B$JIT$
         1 000537   300012 756100                    STQ     10,,PR3

     1978     2386    1   ENQERR:;

PL6.E3A0      #004=FMN$READFDFIT File=FMN$OPNF.:E05TSI                           TUE 07/29/97 16:57 Page:370  
   2386  1 000540                       ENQERR       null
     1979     2387    1      ALTRETURN;

   2387  1 000540   000000 702200 xent               TSX2  ! X66_AALT

   2386  1 000541                       FLSHRET      null
     1980     2388    1   FLSHRET:;
     1981     2389    1      IF F$DCB.NAME.L=0 AND F$DCB.ACS~=%BLOCK#

   2389  1 000541   100010 236100                    LDQ     8,,PR1
         1 000542   777000 316003                    CANQ    -512,DU
         1 000543   000565 601000 1                  TNZ     s:2392
         1 000544   100036 236100                    LDQ     30,,PR1
         1 000545   000777 376007                    ANQ     511,DL
         1 000546   000003 116007                    CMPQ    3,DL
         1 000547   000565 600000 1                  TZE     s:2392
         1 000550   021000 361003                    ANX1    8704,DU
         1 000551   000565 600000 1                  TZE     s:2392

     1982     2390    1        AND F$DCB.FFLG&%(FFLG_DELF#|FFLG_CREATE#)
     1983     2391    1      THEN CALL FMO$TRNINFO(12,PINCRW(BUF$,SIZEW(FM$GRAN)));

   2391  1 000552   200006 236100                    LDQ     BUF$,,AUTO
         1 000553   000005 036003                    ADLQ    5,DU
         1 000554   200010 756100                    STQ     FDA+1,,AUTO
         1 000555   200010 633500                    EPPR3   FDA+1,,AUTO
         1 000556   200013 453500                    STP3    FDA+4,,AUTO
         1 000557   000010 236000 2                  LDQ     8
         1 000560   200012 756100                    STQ     FDA+3,,AUTO
         1 000561   200012 630500                    EPPR0   FDA+3,,AUTO
         1 000562   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000563   000000 701000 xent               TSX1    FMO$TRNINFO
         1 000564   000000 011000                    NOP     0

     1984     2392    1      B$JIT.ERR='0'B;

   2392  1 000565   000000 470400 xsym               LDP0    B$JIT$
PL6.E3A0      #004=FMN$READFDFIT File=FMN$OPNF.:E05TSI                           TUE 07/29/97 16:57 Page:371  
         1 000566   000012 450100                    STZ     10,,PR0

     1985     2393    1      CALL FMD$FLSHBUF(1);

   2393  1 000567   000002 630400 2                  EPPR0   2
         1 000570   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000571   000000 701000 xent               TSX1    FMD$FLSHBUF
         1 000572   000000 011000                    NOP     0

     1986     2394    1      IF F$DCB.GTYP=FMGTFD

   2394  1 000573   200003 470500                    LDP0    JDCB$,,AUTO
         1 000574   000064 236100                    LDQ     52,,PR0
         1 000575   034000 376003                    ANQ     14336,DU
         1 000576   020000 116003                    CMPQ    8192,DU
         1 000577   000606 601000 1                  TNZ     s:2396

     1987     2395    1      THEN CALL UQB$MDEQ(ACCT$)ALTRET(ENQERR);

   2395  1 000600   200004 631500                    EPPR1   ACCT$,,AUTO
         1 000601   200010 451500                    STP1    FDA+1,,AUTO
         1 000602   200010 630500                    EPPR0   FDA+1,,AUTO
         1 000603   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000604   000000 701000 xent               TSX1    UQB$MDEQ
         1 000605   000540 702000 1                  TSX2    ENQERR

     1988     2396    1      RETURN;

   2396  1 000606   000000 702200 xent               TSX2  ! X66_ARET

     1989     2397                    /**/
     1990     2398    1   FMNE$FD: B$JIT$->B$JIT.ERR=FMN$E$FD;

   2398  1 000607   000001 236000 0     FMNE$FD      LDQ     FMN$E$FD
         1 000610   000000 470400 xsym               LDP0    B$JIT$
         1 000611   000012 756100                    STQ     10,,PR0

PL6.E3A0      #004=FMN$READFDFIT File=FMN$OPNF.:E05TSI                           TUE 07/29/97 16:57 Page:372  
     1991     2399    1      CALL FMB$LOGERR(%E$FD,13,8,FDA,BUF$,SIZEW(FM$GRAN),

   2399  1 000612   000014 237000 2                  LDAQ    12
         1 000613   200016 757100                    STAQ    FDA+7,,AUTO
         1 000614   000013 236000 2                  LDQ     11
         1 000615   200015 756100                    STQ     FDA+6,,AUTO
         1 000616   200006 631500                    EPPR1   BUF$,,AUTO
         1 000617   200014 451500                    STP1    FDA+5,,AUTO
         1 000620   200007 633500                    EPPR3   FDA,,AUTO
         1 000621   200013 453500                    STP3    FDA+4,,AUTO
         1 000622   000016 236000 2                  LDQ     14
         1 000623   200012 756100                    STQ     FDA+3,,AUTO
         1 000624   000020 237000 2                  LDAQ    16
         1 000625   200010 757100                    STAQ    FDA+1,,AUTO
         1 000626   200010 630500                    EPPR0   FDA+1,,AUTO
         1 000627   000026 631400 xsym               EPPR1   B_VECTNIL+22
         1 000630   000000 701000 xent               TSX1    FMB$LOGERR
         1 000631   000000 011000                    NOP     0

     1992     2400    1        SIZEW(FM$GRAN)+1,SIZEW(FM$GRAN)+2);

   2400  1 000632                       RETALT       null
     1993     2401    1   RETALT:;
     1994     2402    1      CALL FMD$FLSHBUF(1);

   2402  1 000632   000002 630400 2                  EPPR0   2
         1 000633   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000634   000000 701000 xent               TSX1    FMD$FLSHBUF
         1 000635   000000 011000                    NOP     0

     1995     2403    1      F$DCB.BFR.DA(1)=FDA;

   2403  1 000636   200003 470500                    LDP0    JDCB$,,AUTO
         1 000637   200007 236100                    LDQ     FDA,,AUTO
         1 000640   000116 552134                    STBQ    78,'34'O,PR0

     1996     2404    1      IF F$DCB.IASN=%FILE# AND F$DCB.GTYP=FMGTFD
PL6.E3A0      #004=FMN$READFDFIT File=FMN$OPNF.:E05TSI                           TUE 07/29/97 16:57 Page:373  

   2404  1 000641   000103 236100                    LDQ     67,,PR0
         1 000642   000777 376007                    ANQ     511,DL
         1 000643   000001 116007                    CMPQ    1,DL
         1 000644   000657 601000 1                  TNZ     s:2406
         1 000645   000064 236100                    LDQ     52,,PR0
         1 000646   034000 376003                    ANQ     14336,DU
         1 000647   020000 116003                    CMPQ    8192,DU
         1 000650   000657 601000 1                  TNZ     s:2406

     1997     2405    1      THEN CALL UQB$MDEQ(ACCT$)ALTRET(ENQERR);

   2405  1 000651   200004 631500                    EPPR1   ACCT$,,AUTO
         1 000652   200010 451500                    STP1    FDA+1,,AUTO
         1 000653   200010 630500                    EPPR0   FDA+1,,AUTO
         1 000654   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000655   000000 701000 xent               TSX1    UQB$MDEQ
         1 000656   000540 702000 1                  TSX2    ENQERR

     1998     2406    1      ALTRETURN;

   2406  1 000657   000000 702200 xent               TSX2  ! X66_AALT

FMN$E$NEWFILE
 Sect OctLoc
   0     000   061516 001732                                                    1...

FMN$E$FD
 Sect OctLoc
   0     001   061516 000522                                                    1...

FMN$E$NONEWFD
 Sect OctLoc
   0     002   061516 001762                                                    1...

FMN$E$NOFILE
 Sect OctLoc
PL6.E3A0      #004=FMN$READFDFIT File=FMN$OPNF.:E05TSI                           TUE 07/29/97 16:57 Page:374  
   0     003   061516 001612                                                    1...

FMN$E$NOACCESS
 Sect OctLoc
   0     004   061516 001642                                                    1...

FMN$E$NOKEY
 Sect OctLoc
   0     005   061516 001022                                                    1...

(unnamed)
 Sect OctLoc
   2     000   743777 777777   000002 006000   000003 006000   000000 000016    ................
   2     004   000003 006000   677777 777777   000007 777770   000000 000014    ................
   2     010   000007 006000   000000 000052   000000 000015   000007 006000    .......*........
   2     014   000010 006000   000011 006000   000012 006000   000000 000000    ................
   2     020   000011 006000   000012 006000                                    ........
     1999     2407    1   END FMN$READFDFIT;

PL6.E3A0      #004=FMN$READFDFIT File=FMN$OPNF.:E05TSI                           TUE 07/29/97 16:57 Page:375  
--  Include file information  --

   PC_SUBS_C.:E05TOU  is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
   AZ_SUBS_C.:E05TOU  is referenced.
   F_ERRORS_C.:E05TOU  is referenced.
   F$DCB.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   FM$MACROS.:E05TOU  is referenced.
      No diagnostics issued in procedure FMN$READFDFIT.
PL6.E3A0      #004=FMN$READFDFIT File=FMN$OPNF.:E05TSI                           TUE 07/29/97 16:57 Page:376  

 **** Variables and constants ****

  ****  Section 000 RoData FMN$READFDFIT

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     1-0-0/b STRC        r     1 FMN$E$FD                   0-0-0/b STRC        r     1 FMN$E$NEWFILE
     4-0-0/b STRC        r     1 FMN$E$NOACCESS             3-0-0/b STRC        r     1 FMN$E$NOFILE
     5-0-0/b STRC        r     1 FMN$E$NOKEY                2-0-0/b STRC        r     1 FMN$E$NONEWFD

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 ACCT$                      6-0-0/w PTR         r     1 BUF$
     7-0-0/w SBIN        r     1 FDA                        5-0-0/w PTR         r     1 FIT$
     3-0-0/w PTR         r     1 JDCB$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w SBIN        r     1 ES_LOGFILEGRANT
     0-0-0/w PTR         r     1 F$CFU$
     0-0-0/w PTR         r     1 FM$BUF$(0:0)
     0-0-0/w SBIN        r     1 FM_PADSDA                  0-0-0/w SBIN        r     1 S_CUN

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/w STRC(288)   r     1 CODE14
     0-0-0/d ASTR(3528)  r     1 F$DCB                      0-0-0/w STRC(288)   r     1 FM$CFU
PL6.E3A0      #004=FMN$READFDFIT File=FMN$OPNF.:E05TSI                           TUE 07/29/97 16:57 Page:377  
     0-0-0/w STRC(288)   r     1 FM$CFUA                    0-0-0/w STRC(180)   r     1 FM$GRAN
     0-0-0/w STRC(288)   r     1 FM$SET(0:0)


   Procedure FMN$READFDFIT requires 432 words for executable code.
   Procedure FMN$READFDFIT requires 16 words of local(AUTO) storage.

    No errors detected in file FMN$OPNF.:E05TSI    .
PL6.E3A0      #004=FMN$READFDFIT File=FMN$OPNF.:E05TSI                           TUE 07/29/97 16:57 Page:378  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #004=FMN$READFDFIT File=FMN$OPNF.:E05TSI                           TUE 07/29/97 16:57 Page:379  
          MINI XREF LISTING

ACCT$
        23**DCL       417--IMP-PTR   423--IMP-PTR  2286<<ASSIGN   2287>>IF       2290>>IF       2296<>CALL
      2298>>ASSIGN   2303>>IF       2304>>ASSIGN   2305>>ASSIGN   2306>>ASSIGN   2307>>IF       2307>>ASSIGN
      2308>>ASSIGN   2310>>IF       2310>>IF       2311>>ASSIGN   2313<>CALL     2315>>ASSIGN   2316>>ASSIGN
      2321>>IF       2322>>IF       2329>>IF       2329>>IF       2336>>ASSIGN   2337>>IF       2356>>IF
      2359>>ASSIGN   2360>>ASSIGN   2361>>ASSIGN   2362>>IF       2395<>CALL     2405<>CALL
B$JIT.ACCN
      1724**DCL      2322>>IF       2329>>IF       2356>>IF
B$JIT.DCB$
      1814**DCL      2283>>ASSIGN
B$JIT.ERR
      1724**DCL      2328<<ASSIGN   2370<<ASSIGN   2371<<ASSIGN   2375<<ASSIGN   2376<<ASSIGN   2378<<ASSIGN
      2383<<ASSIGN   2385<<ASSIGN   2392<<ASSIGN   2398<<ASSIGN
B$JIT.ERR.MID
      1725**DCL      1725--REDEF
B$JIT.FACCN
      1724**DCL      2338>>IF       2348>>IF
B$JIT.FACNACS
      1814**DCL      2338>>IF       2341>>ASSIGN   2351<<ASSIGN
B$JIT.FACNCM
      1816**DCL      2342>>ASSIGN   2352<<ASSIGN
B$JIT.FPSN
      1805**DCL      2338>>IF       2348>>IF
B$JIT.HPSN
      1814**DCL      2322>>IF
B$JIT.PRIV.ACTIVE
      1725**DCL      2338>>IF       2348>>IF       2363>>IF
B$JIT.PRIV.ACTIVE.FMBLK
      1725**DCL      2329>>IF
B$JIT.PRIV.ACTIVE.FMSEC
      1726**DCL      2322>>IF       2329>>IF       2337>>IF       2365>>IF
B$JIT$
PL6.E3A0      #004=FMN$READFDFIT File=FMN$OPNF.:E05TSI                           TUE 07/29/97 16:57 Page:380  
      2253**DCL      1719--IMP-PTR  2283>>ASSIGN   2322>>IF       2322>>IF       2322>>IF       2328>>ASSIGN
      2329>>IF       2329>>IF       2329>>IF       2337>>IF       2338>>IF       2338>>IF       2338>>IF
      2338>>IF       2341>>ASSIGN   2342>>ASSIGN   2348>>IF       2348>>IF       2348>>IF       2351>>ASSIGN
      2352>>ASSIGN   2356>>IF       2363>>IF       2365>>IF       2370>>ASSIGN   2371>>ASSIGN   2375>>ASSIGN
      2376>>ASSIGN   2378>>ASSIGN   2383>>ASSIGN   2385>>ASSIGN   2392>>ASSIGN   2398>>ASSIGN
BUF$
        25**DCL      2300<>CALL     2301>>ASSIGN   2346<<ASSIGN   2347>>CALL     2391>>CALL     2399<>CALL
CODE14.ACCESS
       433**DCL      2305>>ASSIGN
CODE14.ACCESS.NEWFD
       434**DCL      2325>>IF
CODE14.CGRANS
       436**DCL      2304>>ASSIGN   2311<<ASSIGN   2316<<ASSIGN
CODE14.DFLTALL
       434**DCL      2306>>ASSIGN
CODE14.MGRANS
       436**DCL      2304>>ASSIGN   2311>>ASSIGN   2316>>ASSIGN
ENQERR
      2386**LABEL    2296--CALLALT  2395--CALLALT  2405--CALLALT
ES_LOGFILEGRANT
      2251**DCL      2329>>IF
F$CFU$
      2252**DCL       443--IMP-PTR  2286>>ASSIGN   2322>>IF
F$DCB.ACCT
      1049**DCL      2338>>IF       2348>>IF
F$DCB.ACS
      1056**DCL      2389>>IF
F$DCB.ACTPOS
      1064**DCL      1064--REDEF
F$DCB.ARS
      1039**DCL      1039--REDEF
F$DCB.ATTR
      1057**DCL      1058--REDEF
F$DCB.AUTHFFLG
      1064**DCL      2358<<ASSIGN
F$DCB.BFR.BUFUP
PL6.E3A0      #004=FMN$READFDFIT File=FMN$OPNF.:E05TSI                           TUE 07/29/97 16:57 Page:381  
      1083**DCL      2317<<ASSIGN
F$DCB.BFR.BUFX
      1084**DCL      2346>>ASSIGN
F$DCB.BFR.DA
      1084**DCL      2403<<ASSIGN
F$DCB.BORROW
      1072**DCL      1072--REDEF    1072--REDEF    1072--REDEF
F$DCB.BUPF
      1042**DCL      2361<<ASSIGN
F$DCB.CFU$
      1073**DCL      2286>>ASSIGN
F$DCB.DCBNAME.L
      1086**DCL      1086--IMP-SIZ
F$DCB.EOMCHAR
      1043**DCL      1043--REDEF
F$DCB.FDCM
      1076**DCL      2342<<ASSIGN   2352>>ASSIGN   2362<<ASSIGN   2365<<ASSIGN
F$DCB.FFLG
      1043**DCL      2284>>IF       2334<<ASSIGN   2336<<ASSIGN   2341<<ASSIGN   2351>>ASSIGN   2356<<ASSIGN
      2356>>ASSIGN   2358>>ASSIGN   2363>>IF       2370>>IF       2374>>IF       2389>>IF
F$DCB.FFLG.EXEC
      1044**DCL      2366<<ASSIGN
F$DCB.FFLG.READ
      1044**DCL      2371>>IF
F$DCB.FLDID
      1067**DCL      1067--REDEF
F$DCB.FORM$
      1061**DCL      1061--REDEF
F$DCB.FSECT
      1077**DCL      1077--REDEF
F$DCB.FSN
      1054**DCL      1054--REDEF    1054--REDEF    1055--REDEF
F$DCB.FUN
      1053**DCL      2291>>IF       2375>>IF
F$DCB.GTYP
      1068**DCL      2285<<ASSIGN   2293<<ASSIGN   2297<<ASSIGN   2345>>IF       2394>>IF       2404>>IF
PL6.E3A0      #004=FMN$READFDFIT File=FMN$OPNF.:E05TSI                           TUE 07/29/97 16:57 Page:382  
F$DCB.HEADER$
      1060**DCL      1060--REDEF
F$DCB.IASN
      1080**DCL      2287>>IF       2296>>IF       2312>>IF       2321>>IF       2329>>IF       2369>>IF
      2404>>IF
F$DCB.IXTNSIZE
      1058**DCL      1058--REDEF
F$DCB.LASTSTA$
      1048**DCL      1048--REDEF
F$DCB.LVL
      1073**DCL      1073--REDEF
F$DCB.NAME.C
      1048**DCL      1048--REDEF
F$DCB.NAME.L
      1048**DCL      2287>>IF       2389>>IF
F$DCB.NOEOF
      1069**DCL      1069--REDEF
F$DCB.NRECS
      1059**DCL      1059--REDEF
F$DCB.NRECX
      1078**DCL      1078--REDEF
F$DCB.OHDR
      1070**DCL      1070--REDEF
F$DCB.ORG
      1053**DCL      1053--REDEF
F$DCB.PRECNO
      1076**DCL      1076--REDEF
F$DCB.PRIVOPN
      1078**DCL      2367<<ASSIGN
F$DCB.PSN
      1049**DCL      2338>>IF       2348>>IF
F$DCB.RCSZ
      1081**DCL      1081--REDEF
F$DCB.RES
      1049**DCL      1049--REDEF
F$DCB.SETX
PL6.E3A0      #004=FMN$READFDFIT File=FMN$OPNF.:E05TSI                           TUE 07/29/97 16:57 Page:383  
      1061**DCL      1061--REDEF    2322>>IF
F$DCB.TAB$
      1060**DCL      1061--REDEF
F$DCB.TDA
      1075**DCL      1075--REDEF
F$DCB.WCDATA
      1073**DCL      2359<<ASSIGN
F$DCB.WRCMP
      1073**DCL      2360<<ASSIGN
F$DCB.WSN
      1050**DCL      1050--REDEF
F$DCB.WSR
      1056**DCL      2329>>IF
FDA
        26**DCL      2292<<ASSIGN   2298<<ASSIGN   2300<>CALL     2399<>CALL     2403>>ASSIGN
FIT$
        24**DCL       431--IMP-PTR  2301<<ASSIGN   2302<>CALL     2304>>ASSIGN   2304>>ASSIGN   2305>>ASSIGN
      2306>>ASSIGN   2311>>ASSIGN   2311>>ASSIGN   2316>>ASSIGN   2316>>ASSIGN   2325>>IF
FLSHRET
      2386**LABEL    2374--GOTO
FM$BUF$
      2255**DCL      2346>>ASSIGN
FM$CFU.ACCTX
       424**DCL       424--REDEF    2286>>ASSIGN
FM$CFUA.ACCESS
       418**DCL      2305<<ASSIGN
FM$CFUA.ACCESS.BUPF
       419**DCL      2361>>ASSIGN
FM$CFUA.ACCESS.LIST
       418**DCL      2337>>IF
FM$CFUA.ACCESS.MERGEAC
       419**DCL      2362>>IF
FM$CFUA.ACCESS.OWNERF
       419**DCL      2329>>IF
FM$CFUA.ACCESS.WCDATA
       418**DCL      2359>>ASSIGN
PL6.E3A0      #004=FMN$READFDFIT File=FMN$OPNF.:E05TSI                           TUE 07/29/97 16:57 Page:384  
FM$CFUA.ACCESS.WRCMP
       419**DCL      2360>>ASSIGN
FM$CFUA.ACCT
       417**DCL      2322>>IF       2329>>IF       2356>>IF
FM$CFUA.DFLTALL
       420**DCL      2306<<ASSIGN   2336>>ASSIGN
FM$CFUA.FDFITSDA
       417**DCL      2290>>IF       2298>>ASSIGN   2307>>IF       2321>>IF
FM$CFUA.FLAGS
       417**DCL      2303>>IF
FM$CFUA.FLAGS.EXIST
       417**DCL      2287>>IF       2308<<ASSIGN   2310>>IF
FM$CFUA.FLAGS.NEW
       418**DCL      2307<<ASSIGN
FM$CFUA.GMOD
       418**DCL      2310>>IF       2315<<ASSIGN
FM$CFUA.GRANS
       420**DCL      2304<<ASSIGN   2311>>ASSIGN   2316>>ASSIGN
FM$GRAN
       439**DCL      2301--ASSIGN   2347--CALL     2347<>CALL     2391--CALL     2399--CALL     2399--CALL
      2399--CALL
FM$SET.PSN
       443**DCL      2322>>IF
FM$SET.USERLIST
       444**DCL       444--REDEF
FMB$LOGERR
        31**DCL-ENT  2399--CALL
FMD$FLSHBUF
        32**DCL-ENT  2393--CALL     2402--CALL
FMD$REDBUF
        29**DCL-ENT  2300--CALL
FMN$E$FD
      2263**DCL      2398>>ASSIGN
FMN$E$NEWFILE
      2259**DCL      2375>>ASSIGN   2383>>ASSIGN
FMN$E$NOACCESS
PL6.E3A0      #004=FMN$READFDFIT File=FMN$OPNF.:E05TSI                           TUE 07/29/97 16:57 Page:385  
      2275**DCL      2371>>ASSIGN
FMN$E$NOFILE
      2271**DCL      2376>>ASSIGN   2385>>ASSIGN
FMN$E$NOKEY
      2279**DCL      2370>>ASSIGN
FMN$E$NONEWFD
      2267**DCL      2378>>ASSIGN
FMNE$FD
      2398**LABEL    2302--CALLALT
FMNE$NEWFILE
      2383**LABEL    2324--GOTO
FMNE$NOFILE
      2385**LABEL    2291--GOTO
FMNE$NONEWFD
      2378**LABEL    2325--GOTO
FMO$LOCCODP
        30**DCL-ENT  2302--CALL
FMO$SECCHK
        34**DCL-ENT  2347--CALL
FMO$TRNINFO
        33**DCL-ENT  2391--CALL
FMR$L8
        35**DCL-ENT  2314--CALL
FMR$U8
        36**DCL-ENT  2318--CALL
FM_PADSDA
      2254**DCL      2292>>ASSIGN
JDCB$
        22**DCL      1039--IMP-PTR  2283<<ASSIGN   2284>>IF       2285>>ASSIGN   2286>>ASSIGN   2287>>IF
      2287>>IF       2291>>IF       2293>>ASSIGN   2296>>IF       2297>>ASSIGN   2312>>IF       2317>>ASSIGN
      2321>>IF       2322>>IF       2329>>IF       2329>>IF       2334>>ASSIGN   2336>>ASSIGN   2338>>IF
      2338>>IF       2341>>ASSIGN   2342>>ASSIGN   2345>>IF       2346>>ASSIGN   2348>>IF       2348>>IF
      2351>>ASSIGN   2352>>ASSIGN   2356>>ASSIGN   2356>>ASSIGN   2358>>ASSIGN   2358>>ASSIGN   2359>>ASSIGN
      2360>>ASSIGN   2361>>ASSIGN   2362>>ASSIGN   2363>>IF       2365>>ASSIGN   2366>>ASSIGN   2367>>ASSIGN
      2369>>IF       2370>>IF       2371>>IF       2374>>IF       2375>>IF       2389>>IF       2389>>IF
      2389>>IF       2394>>IF       2403>>ASSIGN   2404>>IF       2404>>IF
PL6.E3A0      #004=FMN$READFDFIT File=FMN$OPNF.:E05TSI                           TUE 07/29/97 16:57 Page:386  
REREAD
      2287**LABEL    2345--GOTO
RETALT
      2400**LABEL    2300--CALLALT  2377--GOTO
SECCHKFD
      2325**LABEL    2288--GOTO     2313--CALLALT
S_CUN
      2250**DCL      2329>>IF
UQB$MDEQ
        39**DCL-ENT  2395--CALL     2405--CALL
UQB$MENQS
        37**DCL-ENT  2296--CALL
UQB$MENQX
        38**DCL-ENT  2313--CALL
