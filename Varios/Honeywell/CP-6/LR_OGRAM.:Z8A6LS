VERSION A06

PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:1    
        1        1        /*M* OGRAM =>  ORDER THE GRAMMAR AND DO SOME VALIDITY CHECKS. */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7
        8        8
        9        9
       10       10
       11       11        OGRAM:  PROC;
       12       12
       13       13        /*D*
       14       14               NAME: OGRAM
       15       15            PURPOSE:
       16       16
       17       17        *,*   REMAP ALL SYMBOLS SUCH THAT TERMINAL SYMBOLS HAVE LOWER
       18       18        *,*   NUMBERS THAN THE NON-TERMINALS.
       19       19        *,*   FIND THE GOAL SYMBOL OF THE GRAMMAR.
       20       20        *,*   MAKE SURE THAT ALL PRODUCTIONS IN THE GRAMMAR ARE ACTUALLY USED.
       21       21        *,*   FIX UP THE FIRST FAKE PRODUCTION TO INCLUDE THE GOAL OF
       22       22        *,*   THE GRAMMAR THAT HAS BEEN READ IN.
       23       23        */
       24       24        %INCLUDE LR_GRAM_EXT;
       25      563
       26      564    1   DCL DIAG ENTRY(6);
       27      565    1   DCL LIMCHK ENTRY(4);
       28      566    1   DCL OUT_STR ENTRY(2);
       29      567    1   DCL FLUSH ENTRY;
       30      568    1   DCL OUT_SYMBOL ENTRY(1);
       31      569    1   DCL OUT_SYMBOL_TOKEN ENTRY(1);
       32      570
       33      571    1   DCL NSYM_PTRS (0:NR_SYMS_MAX) PTR;
       34      572    1   DCL NSYM_MAP (0:NR_SYMS_MAX) SBIN;
       35      573    1   DCL NSYM_MAPI(0:NR_SYMS_MAX) SBIN;
       36      574    1   DCL NULL_LIST(0:NR_SYMS_MAX) REDEF NSYM_MAPI SBIN;
       37      575
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:2    
       38      576    1   DCL GRAMGOAL SBIN;
       39      577
       40      578    1   DCL I SBIN;
       41      579    1   DCL J SBIN;
       42      580
       43      581        /* STACK FOR FINDING ACCESSABLE SYMBOLS */
       44      582
       45      583    1   DCL 1 STKS(0:NR_SYMS_MAX),
       46      584    1         2 SYM_INDX SBIN,
       47      585    1         2 PROD_INDX SBIN,
       48      586    1         2 RIGHT_INDX SBIN;
       49      587
       50      588    1   DCL S$             PTR;
       51      589    1   DCL S              SBIN;
       52      590    1   DCL RF             SBIN;
       53      591    1   DCL RL             SBIN;
       54      592    1   DCL PF             SBIN;
       55      593    1   DCL PL             SBIN;
       56      594    1   DCL PUSHING        BOOLEAN;
       57      595    1   DCL NULL_BECAUSE_S SBIN;
       58      596    1   DCL P              SBIN;
       59      597    1   DCL ALLNULL        BOOLEAN;
       60      598    1   DCL SSS$           PTR;
       61      599    1   DCL R              SBIN;
       62      600    1   DCL DEPTH          SBIN;
       63      601
       64      602    1   DCL 1 NTEXT STATIC,
       65      603    1         2 NUM CHAR(4),
       66      604    1         2 * CHAR(0) INIT('%%');
       67      605
       68      606        %EJECT;
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:3    
       69      607    1   FIND_NEXTP:PROC(SYM_INDX,PROD_INDX,RIGHT_INDX) ALTRET;
       70      608
       71      609
       72      610        /* THIS ROUTINE IS CALLED ONLY BY THE TREE WALK FOR
       73      611           FINDING USELESS PRODUCTIONS AND TO CALCULATE WHICH SYMBOLS
       74      612           ARE NULLABLE. IN ORDER TO CALCULATE NULLABLE SYMBOLS CORRECTLY
       75      613           THE TREE MUST BE SEARCHED AS DEEPLY AS POSSIBLE BEFORE
       76      614           HANDLING ANY NON-TERMINALS FOLLOWING THE INITIAL INSPECTION POINT.
       77      615
       78      616           KEPT IN THE STACK ARE:  1) NON-TERMINAL SYMBOL
       79      617                                   2) RELATIVE PRODUCTION NUMBER YET TO EXAMINE
       80      618                                   3) RIGHT PART POSITION YET TO EXAMINE IN
       81      619                                      PRODUCTION MENTIONED IN 2).
       82      620
       83      621           THIS ROUTINE WILL RETURN IF ALL NON-T'S IN ALL PRODUCTIONS
       84      622           FOR THE NON-TERMINAL IN THE STACK HAVE BEEN EXAMINED ALREADY.
       85      623           IF NOT ALL NON-T'S HAVE BEEN EXAMINED, THE FIRST ONE NOT
       86      624           EXAMINED IS PUSHED INTO THE STACK AND AN ALTRETURN IS PERFORMED.
       87      625           THE ARGUMENTS TO THIS ROUTINE ARE THE ACTUAL STACKED VALUES AND
       88      626           UPON ALTRETURN, THE VALUES IN THE STACK HAVE BEEN ALTERED.
       89      627           THIS ALLOWS THE POP OF THE SYMBOL TO PICK UP RIGHT AFTER
       90      628           WHERE IT LEFT OFF AFTER EXAMINING ALL SONS IN THE TREE WALK. */
       91      629
       92      630    2   DCL SYM_INDX   SBIN;
       93      631    2   DCL PROD_INDX  SBIN;
       94      632    2   DCL RIGHT_INDX SBIN;
       95      633
       96      634    2   DCL S$         PTR;
       97      635    2   DCL SSS$       PTR;
       98      636    2   DCL PL         SBIN;
       99      637    2   DCL RF         SBIN;
      100      638    2   DCL R          SBIN;
      101      639
      102      640
      103      641    2           S$=SYM_PTRS(SYM_INDX);
      104      642    2           PL=S$->SYMBOL.PROD_CNT;
      105      643
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:4    
      106      644    3           DO WHILE(PROD_INDX<=PL);
      107      645
      108      646    3              R=PROD.RIGHT_START(PROD_INDX+S$->SYMBOL.PROD_INDX-1);
      109      647    3              RL=PROD.RIGHT_CNT(PROD_INDX+S$->SYMBOL.PROD_INDX-1);
      110      648
      111      649    4              DO WHILE(RIGHT_INDX<=RL);
      112      650
      113      651    4                 SSS$=SYM_PTRS(RIGHT_PARTS(R+RIGHT_INDX-1));
      114      652
      115      653    4                 IF (NOT SSS$->SYMBOL.ON_RIGHT) AND
      116      654    4                   (NOT SSS$->SYMBOL.SYM_TYPE=SYM_TYPE_TERM) THEN
      117      655    5                 DO;
      118      656    5                    SSS$->SYMBOL.ON_RIGHT=TRUE;
      119      657    5                    DEPTH=DEPTH+1;
      120      658    5                    STKS.SYM_INDX(DEPTH)=SSS$->SYMBOL.SYM_INDX;
      121      659    5                    STKS.PROD_INDX(DEPTH)=1;
      122      660    5                    STKS.RIGHT_INDX(DEPTH)=1;
      123      661    5                    RIGHT_INDX=RIGHT_INDX+1;
      124      662    5                    ALTRETURN;
      125      663    5                    END;
      126      664    4                 RIGHT_INDX=RIGHT_INDX+1;
      127      665    4                 END /* WHILE RIGHT_INDX */;
      128      666    3              PROD_INDX=PROD_INDX+1;
      129      667    3              RIGHT_INDX=1;
      130      668    3              END /* WHILE PROD_INDX */;
      131      669    2   END FIND_NEXTP;
      132      670
      133      671        %EJECT;
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:5    
      134      672    1           PROD_LEN_MAX_EVER=0;
      135      673    1           INSTR_LISTED=TRUE;
      136      674    1           LAST_ACT=0;
      137      675    1           LAST_NULL=0;
      138      676    1           GRAMGOAL=0;
      139      677
      140      678    1           IF ERR_SEV > 6 THEN
      141      679    1              CALL DIAG(15,' PROCESSING TERMINATED DUE TO ERRORS%%');
      142      680
      143      681        /* Find the goal symbol */
      144      682
      145      683    1           I=1;
      146      684    2           DO WHILE (GRAMGOAL=0 & I < NR_PROD );
      147      685    2              S = PROD.GOAL_SYM_INDX(I);
      148      686    2              IF SYM_PTRS(S)->SYMBOL.SYM_TYPE=SYM_TYPE_NT THEN
      149      687    3              DO;
      150      688    3                 IF NOT SYM_PTRS(S)->SYMBOL.ON_RIGHT THEN
      151      689    3                    IF GRAMGOAL=0 THEN
      152      690    3                       GRAMGOAL=S;
      153      691    3                    ELSE
      154      692    4                       DO;
      155      693                              %SELECT_LO;
      156      696                              %OUT_STR(S="'ERROR => Duplicate goal symbol: '");
      157      699    4                         CALL OUT_SYMBOL(SYM_PTRS(S));
      158      700    4                         CALL FLUSH;
      159      701    4                         CALL DIAG(6,'%%');
      160      702    4                       END;
      161      703    3                 GRAMGOAL = S;
      162      704    3                 END;
      163      705    2              I=I+1;
      164      706    2              END;
      165      707                 %SELECT_LO;
      166      710                %OUTLINE(S="' '");
      167      716    1           IF GRAMGOAL~=0 THEN
      168      717    2              DO;
      169      718    2              CALL OUT_SYMBOL(SYM_PTRS(GRAMGOAL));
      170      719                   %OUTLINE(S="' assumed to be the goal symbol.'");
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:6    
      171      725    2              END;
      172      726    1           ELSE
      173      727    1              CALL DIAG(15,'ERROR =>No goal symbol found %%');
      174      728
      175      729                /* Identify all semantic actions for which to create null productions */
      176      730
      177      731    2           DO I = 0 TO NR_PROD - 1;
      178      732
      179      733    3             DO R = PROD.RIGHT_START(I) TO PROD.RIGHT_START(I) + PROD.RIGHT_CNT(I) -2;
      180      734
      181      735    3               S = RIGHT_PARTS(R);
      182      736    3               IF SYM_PTRS(S) -> SYMBOL.SYM_TYPE = SYM_TYPE_ACT THEN
      183      737    3                 SYM_PTRS(S) -> SYMBOL.SEM_PROD_REQ = TRUE;
      184      738
      185      739    3             END;
      186      740
      187      741    2             PROD.TRAILING_SEM_ACT(I) = FALSE;
      188      742
      189      743    2             IF PROD.RIGHT_CNT(I) > 0 THEN
      190      744    2               IF SYM_PTRS(RIGHT_PARTS(PROD.RIGHT_START(I) + PROD.RIGHT_CNT(I) - 1))
      191      745    2                         -> SYMBOL.SYM_TYPE = SYM_TYPE_ACT THEN
      192      746    3                 DO;
      193      747    3                   PROD.TRAILING_SEM_ACT(I) = TRUE;
      194      748    3                   PROD.RIGHT_CNT(I) = PROD.RIGHT_CNT(I) - 1;
      195      749    3                 END;
      196      750    2           END;
      197      751
      198      752    2           DO I=1 TO NR_SYMS;
      199      753    2              SYM_PTRS(I)->SYMBOL.ON_RIGHT=FALSE;
      200      754    2              SYM_PTRS(I)->SYMBOL.NULLABLE=FALSE;
      201      755
      202      756    2              IF SYM_PTRS(I)->SYMBOL.SEM_PROD_REQ THEN
      203      757    3              DO;
      204      758
      205      759                       /* TURN THIS SYMBOL INTO A NON-TERMINAL  */
      206      760    3                 SYM_PTRS(I)->SYMBOL.ON_LEFT=TRUE;
      207      761    3                 SYM_PTRS(I)->SYMBOL.PROD_INDX=NR_PROD;
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:7    
      208      762    3                 SYM_PTRS(I)->SYMBOL.PROD_CNT=1;
      209      763    3                 CALL LIMCHK(15,NR_PROD+1, NR_PROD_MAX, 'Too many productions: %%');
      210      764    3                  PROD.GOAL_SYM_INDX(NR_PROD)=I;
      211      765    3                  PROD.RIGHT_CNT(NR_PROD)=0;
      212      766    3                  PROD.RIGHT_START(NR_PROD)=NR_ONRIGHT+1;
      213      767    3                  PROD.TRAILING_SEM_ACT(NR_PROD) = FALSE;
      214      768    3                 NR_PROD=NR_PROD+1;
      215      769
      216      770    3                 END;
      217      771    2              END;
      218      772        /* INSERT GRAMGOAL INTO FIRST PRODUCTION */
      219      773
      220      774    1           RIGHT_PARTS(2)=GRAMGOAL;
      221      775    1           SYM_PTRS(GRAMGOAL)->SYMBOL.ON_LEFT=TRUE;
      222      776
      223      777        /* AN INITIAL RE-ORDERING OF SYMBOLS HAS BEEN DETERMINED.
      224      778           THE ONLY SHUFFLING THAT HAS BEEN DONE IS TO PLACE THE
      225      779           TERMINALS BEFORE THE NON-TERMINALS. SOME PEOPLE MAY
      226      780           DESIRE PLACING THE SYMBOLS IN ALPHABETICAL ORDER,
      227      781           AND IT SHOULD BE DONE HERE. */
      228      782
      229      783
      230      784
      231      785        /* MAKE SURE ALL NT'S ARE ACCESSABLE FROM <SYSTEM_GS> */
      232      786
      233      787        /* AS A PART OF THIS PROCESS, SET A BIT SAYING WHICH NON-T'S
      234      788           MIGHT REDUCE TO THE EMPTY STRING. FOR EACH NULLABLE SYMBOL
      235      789           SET NULL_BECAUSE_S TO BE EITHER THE NON-TERMINAL ITSELF
      236      790           (BECAUSE THE EMPTY PRODUCTION IS PART OF THAT NON-T'S DEFINITION)
      237      791           OR SET NULL_BECAUSE_S TO BE THE NULL_BECAUSE_S OF THE
      238      792           FIRST NON_TERMINAL IN THE STRING OF NULLABLE NON-TERMINALS
      239      793           MAKING UP THE PRODUCTION THAT CAUSES THIS SYMBOL TO BE NULLABLE
      240      794
      241      795           EXAMPLE:
      242      796              <G> ::=  <A> <B>
      243      797              <A> ::= (EMPTY)
      244      798              <A> ::= A
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:8    
      245      799              <B> ::= (EMPTY)
      246      800              <B> ::= B
      247      801
      248      802          <G>, <A>, AND <B> ARE ALL SYMBOLS THAT HAVE NULLABLE SET TRUE.
      249      803          NULL_BECAUSE_S FOR EACH NON_TERMINAL THAT IS NULLABLE IS SET
      250      804          TO THE PRODUCTION THAT MAKES THAT NOT_TERMINAL POTENTIALLY NULLABLE */
      251      805
      252      806
      253      807    1           DEPTH=1;
      254      808    1           STKS.SYM_INDX(1)=1;             /* <SYSTEM_GS>  */
      255      809    1           STKS.PROD_INDX(1)=1;
      256      810    1           STKS.RIGHT_INDX(1)=1;
      257      811
      258      812    1           SYM_PTRS(STKS.SYM_INDX(1))->SYMBOL.ON_RIGHT=TRUE;
      259      813    2           DO WHILE (DEPTH>0);
      260      814    2              S=STKS.SYM_INDX(DEPTH);
      261      815    2              S$=SYM_PTRS(S);
      262      816    2              S$->SYMBOL.ON_RIGHT=TRUE;
      263      817
      264      818        /* FIND NEXT SYMBOL THAT HAS NOT BEEN EXAMINED */
      265      819
      266      820    2              CALL FIND_NEXTP(STKS.SYM_INDX(DEPTH),
      267      821    2                STKS.PROD_INDX(DEPTH),
      268      822    2                STKS.RIGHT_INDX(DEPTH))
      269      823    2                ALTRET(STILL_PUSHING);
      270      824
      271      825
      272      826
      273      827    2              PF=S$->SYMBOL.PROD_INDX;
      274      828    3              DO P=S$->SYMBOL.PROD_CNT+PF-1 DOWNTO PF;
      275      829    3                 ALLNULL=TRUE;
      276      830    3                 RF=PROD.RIGHT_START(P);
      277      831    3                 RL=PROD.RIGHT_CNT(P)-1+RF;
      278      832    4                 DO R=RF TO RL;
      279      833    4                    SSS$=SYM_PTRS(RIGHT_PARTS(R));
      280      834    4                    ALLNULL=ALLNULL & (SSS$->SYMBOL.NULLABLE);
      281      835    4                    END /* DO R */;
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:9    
      282      836
      283      837
      284      838    3                 IF ALLNULL THEN
      285      839    4                 DO; /* SYMBOL POINTED TO BY S$ IS NULLABLE */
      286      840    4                    IF RF>RL THEN
      287      841    4                       NULL_BECAUSE_S=S;
      288      842    4                    ELSE
      289      843    4                       NULL_BECAUSE_S=SSS$->SYMBOL.SYM_INDX;
      290      844
      291      845    4                    IF S$->SYMBOL.NULLABLE THEN
      292      846    5                      DO;
      293      847                            %SELECT_LO;
      294      850                            %OUT_STR(S="'ERROR => Symbol '");
      295      853    5                       CALL OUT_SYMBOL(S$);
      296      854                            %OUT_STR(S="' is nullable two ways:'");
      297      857                            %OUT_STR(S="'            from symbols '");
      298      860    5                       CALL OUT_SYMBOL(SYM_PTRS(NULL_BECAUSE_S));
      299      861                            %OUT_STR(S="' and '");
      300      864    5                       CALL OUT_SYMBOL(SYM_PTRS(S$->SYMBOL.NULL_BECAUSE_S));
      301      865    5                       CALL FLUSH;
      302      866    5                       CALL DIAG(6,'%%');
      303      867    5                      END;
      304      868    4                    ELSE
      305      869    5                    DO;
      306      870    5                       S$->SYMBOL.NULLABLE=TRUE;
      307      871    5                       S$->SYMBOL.NULL_BECAUSE_S=NULL_BECAUSE_S;
      308      872    5                       S$->SYMBOL.NULL_BECAUSE_P=P;
      309      873    5                       END;
      310      874
      311      875    4                    END /* S$ IS NULLABLE */;
      312      876
      313      877    3                 END /* DO P */;
      314      878
      315      879    2              DEPTH=DEPTH-1;
      316      880
      317      881    2   STILL_PUSHING:;
      318      882
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:10   
      319      883    2              END;
      320      884
      321      885        /* ON_RIGHT SHOULD BE SET FOR ALL SYMBOLS */
      322      886
      323      887    2           DO I=1 TO NR_SYMS;
      324      888    2              IF (SYM_PTRS(I)->SYMBOL.SYM_TYPE=SYM_TYPE_NT) AND
      325      889    2                NOT SYM_PTRS(I)->SYMBOL.ON_RIGHT THEN
      326      890    3                 DO;
      327      891                      %SELECT_LO;
      328      894                      %OUT_STR(S="'ERROR => Productions for '");
      329      897    3                 CALL OUT_SYMBOL(SYM_PTRS(I));
      330      898                      %OUTLINE(S="' are useless.'");
      331      904    3                 CALL DIAG(3,'%%');
      332      905    3                 END;
      333      906    2              END;
      334      907    1           CALL LIMCHK(0,PROD_LEN_MAX_EVER,MAX_PROD_LEN,
      335      908    1            'Production too long: %%');
      336      909
      337      910    1   MAKE_MAP:
      338      911    1             NR_TERM = LAST_ORDER_SPECIFIED;
               911                      /* BIAS TERMINALS BY START OF ALL TERMINALS THAT WERE ORDERED */
      339      912
      340      913    2             DO I = 1 TO NR_SYMS;
      341      914    3              DO CASE(SYM_PTRS(I)->SYMBOL.SYM_TYPE);
      342      915
      343      916    3               CASE(SYM_TYPE_TERM);
      344      917    3                 IF SYM_PTRS(I) -> SYMBOL.ORDER_SPECIFIED THEN
      345      918    3                     NSYM_MAP(SYM_PTRS(I)->SYMBOL.ORDER) = I;
      346      919    3                 ELSE
      347      920    4                   DO;
      348      921    4                     NR_TERM=NR_TERM+1;
      349      922    4                     NSYM_MAP(NR_TERM)=I;
      350      923    4                   END;
      351      924    3                 IF(SUBSTR(SYM_PTRS(I)->SYMBOL.TEXTCHR,0,1)='<')AND
      352      925    3                   (SUBSTR(SYM_PTRS(I)->SYMBOL.TEXTCHR,
      353      926    3                   SYM_PTRS(I)->SYMBOL.SYMLEN-1,1)='>') THEN
      354      927    4                     DO;
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:11   
      355      928                           %SELECT_LO;
      356      931    4                      CALL OUT_SYMBOL(SYM_PTRS(I));
      357      932                           %OUTLINE(S="' is assumed to be a terminal symbol.'");
      358      938    4                     END;
      359      939
      360      940    3               CASE(SYM_TYPE_NT);
      361      941    3                 IF SYM_PTRS(I) -> SYMBOL.ORDER_SPECIFIED THEN
      362      942    4                    DO;
      363      943                           %SELECT_LO;
      364      946                           %OUT_STR(S=
               946                     "'ERROR => An ordering was incorrectly requested for a non_terminal: '"
               946                               );
      365      949    4                      CALL OUT_SYMBOL(SYM_PTRS(I));
      366      950    4                      CALL FLUSH;
      367      951    4                      CALL DIAG(6,'%%');
      368      952    4                    END;
      369      953    3                 IF SYM_PTRS(I)->SYMBOL.ON_LEFT THEN
      370      954    4                 DO;
      371      955    4                    IF SYM_PTRS(I)->SYMBOL.NULLABLE THEN
      372      956    5                    DO;
      373      957    5                       NULL_LIST(NR_SYMS_MAX-LAST_NULL)=I;
      374      958    5                       LAST_NULL=LAST_NULL+1;
      375      959    5                       END;
      376      960    4                    ELSE
      377      961    5                    DO;
      378      962    5                       NSYM_MAP(NR_SYMS_MAX-NR_NT)=I;
      379      963    5                       NR_NT=NR_NT+1;
      380      964    5                       END;
      381      965    4                    END;
      382      966    3                 ELSE
      383      967    4                 DO;
      384      968    4                   IF SYM_PTRS(I) -> SYMBOL.ORDER_SPECIFIED THEN
      385      969    4                     NSYM_MAP(SYM_PTRS(I)->SYMBOL.ORDER) = I;
      386      970    4                   ELSE
      387      971    5                     DO;
      388      972    5                      NR_TERM=NR_TERM+1;
      389      973    5                      NSYM_MAP(NR_TERM)=I;
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:12   
      390      974    5                    END;
      391      975                         %SELECT_LO;
      392      978    4                    CALL OUT_SYMBOL(SYM_PTRS(I));
      393      979                         %OUTLINE(S="' is assumed to be a terminal.'");
      394      985    4                    END;
      395      986
      396      987    3               CASE(SYM_TYPE_ACT);    /* ACTION SYMBOL     */
      397      988    3                 IF SEMANTIC_ORDERING THEN
      398      989    3                   IF NOT SYM_PTRS(I) -> SYMBOL.ORDER_SPECIFIED THEN
      399      990    4                     DO;
      400      991                            %SELECT_LO;
      401      994
      402      995                            %OUT_STR(S=
               995                        "'ERROR => A semantic action symbol was left out of the ordering: '"
               995                                );
      403      998    4                       CALL OUT_SYMBOL (SYM_PTRS(I));
      404      999    4                       CALL FLUSH;
      405     1000    4                       CALL DIAG(6,'%%');
      406     1001    4                     END;
      407     1002    3                 LAST_ACT=LAST_ACT+1;
      408     1003    3                 NULL_LIST(LAST_ACT)=I;
      409     1004    3               END /* DO CASE */;
      410     1005    2              END /* MAKE_MAP */;
      411     1006
      412     1007        /* I have now 4 types of symbols:
      413     1008           1) terminals placed in NSYM_MAX(1..NR_TERM)
      414     1009           2) non terminals in NSYM_MAP(NR_SYMS_MAX..NR_SYMS_MAX-NR_NT+1)
      415     1010           3) action symbols in NULL_LIST(1..LAST_ACT)
      416     1011           4) nullable symbols in NULL_LIST(NR_SYMS_MAX..NR_SYMS_MAX-NR_NULL+1)
      417     1012
      418     1013           place these symbols into NSYM_MAP in consecutive order. */
      419     1014
      420     1015
      421     1016    2           DO I=1 TO NR_NT;
      422     1017    2              NSYM_MAP(NR_TERM+I)=NSYM_MAP(NR_SYMS_MAX+1-I);
      423     1018    2              END;
      424     1019
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:13   
      425     1020    1           NR_NT=NR_NT+NR_TERM;
      426     1021
      427     1022    2           DO I=1 TO LAST_ACT;
      428     1023    2              NSYM_MAP(NR_NT+I)=NULL_LIST(I);
      429     1024    2              END;
      430     1025
      431     1026    1           LAST_ACT=NR_NT+LAST_ACT;
      432     1027
      433     1028    2           DO I= 1 TO LAST_NULL;
      434     1029    2              NSYM_MAP(LAST_ACT+I)=NULL_LIST(NR_SYMS_MAX+1-I);
      435     1030    2              END;
      436     1031
      437     1032    1           LAST_NULL=LAST_ACT+LAST_NULL;
      438     1033
      439     1034    1           IF LAST_NULL~=NR_SYMS THEN
      440     1035    1              CALL DIAG(15,'ERROR =>Ordering error in OGRAM%%');
      441     1036
      442     1037
      443     1038        /* MAKE INVERSE MAPPING */
      444     1039
      445     1040    2           DO I=1 TO NR_SYMS;
      446     1041    2              NSYM_MAPI(NSYM_MAP(I))=I;
      447     1042    2              END;
      448     1043
      449     1044
      450     1045        /* NOW GO THRU ALL PRODUCTION TABLE ENTRIES & THE
      451     1046
      452     1047           RIGHT PART ARRAY RE-MAPPING ALL SYMBOLS */
      453     1048
      454     1049    2           DO I=0 TO NR_PROD-1;
      455     1050    2              PROD.GOAL_SYM_INDX(I)=
      456     1051    2                NSYM_MAPI(PROD.GOAL_SYM_INDX(I));
      457     1052    2              IF PROD.RIGHT_CNT(I)>PROD_LEN_MAX_EVER THEN
      458     1053    2                 PROD_LEN_MAX_EVER=PROD.RIGHT_CNT(I);
      459     1054    2              END;
      460     1055
      461     1056    2           DO I=1 TO NR_ONRIGHT;
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:14   
      462     1057    2              RIGHT_PARTS(I)=NSYM_MAPI(RIGHT_PARTS(I));
      463     1058    2              END;
      464     1059
      465     1060        /* NOW CALCULATE NEW SYMBOL POINTERS */
      466     1061
      467     1062    2           DO I=1 TO NR_SYMS;
      468     1063    2              NSYM_PTRS(I)=SYM_PTRS(NSYM_MAP(I));
      469     1064    2              END;
      470     1065
      471     1066    2           DO I=1 TO NR_SYMS;
      472     1067    2              SYM_PTRS(I)=NSYM_PTRS(I);
      473     1068    2              SYM_PTRS(I)->SYMBOL.SYM_INDX=
      474     1069    2                NSYM_MAPI(SYM_PTRS(I)->SYMBOL.SYM_INDX);
      475     1070    2              SYM_PTRS(I)->SYMBOL.ON_RIGHT=FALSE;
      476     1071    2              SYM_PTRS(I)->SYMBOL.NULLABLE=FALSE;
      477     1072    2              END;
      478     1073
      479     1074        /* DONE WITH SYMBOL MAPPING */
      480     1075
      481     1076    1           CALL LIMCHK(15,NR_ONRIGHT,NR_RIGHT_MAX,
      482     1077    1             'Production storage space exceeded:  %%');
      483     1078    1           CALL LIMCHK(0,NR_SYMS,NR_SYMS_MAX,
      484     1079    1            'The maximum number of symbols has been exceeded: %%');
      485     1080
      486     1081    1           CALL LIMCHK(0,NR_TERM,NR_TERM_MAX,
      487     1082    1            'The maximum number of terminal symbols has been exceeded: %%');
      488     1083
      489     1084    1           CALL LIMCHK(15,NR_PROD,NR_PROD_MAX,
      490     1085    1            'The maximum number of productions has been exceeded: %%');
      491     1086
      492     1087
      493     1088    1           IF ERR_SEV>6 THEN
      494     1089    1              CALL DIAG(15,'PROCESSING TERMINATED DUE TO ERRORS: %%');
      495     1090
      496     1091        /* SET ALL DEFAULT TERMINAL COSTS */
      497     1092
      498     1093    2              DO I = 1 TO NR_TERM;
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:15   
      499     1094
      500     1095    2                 IF NOT SYM_PTRS(I) -> SYMBOL.COSTS_SPECIFIED THEN
      501     1096    3                   DO;
      502     1097    3                     SYM_PTRS(I) -> SYMBOL.COST.INS = DEFAULT_INS_COST;
      503     1098    3                     SYM_PTRS(I) -> SYMBOL.COST.DEL = DEFAULT_DEL_COST;
      504     1099    3                   END;
      505     1100    2              END;
      506     1101
      507     1102    1              EOF_SYMBOL_PTR -> SYMBOL.COST.INS = INFINITE_COST;
      508     1103    1              EOF_SYMBOL_PTR -> SYMBOL.COST.DEL = INFINITE_COST;
      509     1104
      510     1105    1              IF ERROR_SYMBOL_PTR ~= ADDR(NIL) THEN
      511     1106    2                DO;
      512     1107    2                  ERROR_SYMBOL_PTR -> SYMBOL.COST.DEL = INFINITE_COST;
      513     1108    2                  ERROR_SYMBOL_PTR -> SYMBOL.COST.INS = INFINITE_COST;
      514     1109    2                END;
      515     1110
      516     1111
      517     1112        /* SET LENGTHS FOR VECTORS */
      518     1113
      519     1114    1           SET_LENGTHB=NR_TERM+1;
      520     1115    1           SET_LENGTHW=(SET_LENGTHB+35)/36;
      521     1116    1           SET_LENGTHB=SET_LENGTHW*36 /* TEMP */;
      522     1117    1   END OGRAM;

PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:16   
--  Include file information  --

   LR_IO_EXT.:Z8A6TOU  cannot be made into a system file and is referenced.
   LR_GRAM_EXT.:Z8A6TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure OGRAM.

   Procedure OGRAM requires 847 words for executable code.
   Procedure OGRAM requires 8442 words of local(AUTO) storage.

    No errors detected in file LR_OGRAM.:Z8A6TSI    .

PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:17   

 Object Unit name= OGRAM                                      File name= LR_OGRAM.:Z8A6TOU
 UTS= AUG 09 '97 09:36:57.48 SAT                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  LblCom even  none     1      1  OUT_DCBN
    1   DCB   even  none     0      0  M$OU
    2   DCB   even  none     0      0  M$SO
    3   DCB   even  none     0      0  M$LO
    4   DCB   even  none     0      0  M$SI
    5   DCB   even  none     0      0  M$UI
    6  LblCom even  none  1401   2571  SYM_PTRS
    7  LblCom even  none  4001   7641  RIGHT_PARTS
    8  LblCom even  none  3002   5672  PROD
    9  LblCom even  none     1      1  NR_PROD
   10  LblCom even  none     1      1  NR_SYMS
   11  LblCom even  none     1      1  NR_TERM
   12  LblCom even  none     1      1  LAST_ACT
   13  LblCom even  none     1      1  LAST_NULL
   14  LblCom even  none     1      1  NR_ONRIGHT
   15  LblCom even  none     1      1  NR_NT
   16  LblCom even  none     1      1  PROD_LEN_MAX_EVER
   17  LblCom even  none     1      1  LAST_ORDER_SPECIFIED
   18  LblCom even  none     1      1  SEMANTIC_ORDERING
   19  LblCom even  none     1      1  ERR_SEV
   20  LblCom even  none     1      1  SET_LENGTHB
   21  LblCom even  none     1      1  SET_LENGTHW
   22  LblCom even  none     1      1  EOF_SYMBOL_PTR
   23  LblCom even  none     1      1  ERROR_SYMBOL_PTR
   24  LblCom even  none     1      1  BOF_SYMBOL_PTR
   25  LblCom even  none     1      1  OPTIONS
   26  LblCom even  none    26     32  OPTIONS_TEXT
   27  LblCom even  none   128    200  INSTR
   28  LblCom even  none     1      1  INSTR_LISTED
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:18   
   29  LblCom even  none     1      1  INSTR_LEN
   30  LblCom even  none     1      1  INSTR_INDX
   31  LblCom even  none     1      1  EOF_FLAG
   32  LblCom even  none     3      3  KEY_REC
   33  LblCom even  none    28     34  LINE
   34  LblCom even  none     1      1  LINELEN
   35  LblCom even  none   205    315  TSTATS
   36   Data  even  none     2      2  OGRAM
   37  RoData even  UTS    197    305  OGRAM
   38   Proc  even  none   847   1517  OGRAM
   39  RoData even  none    90    132  OGRAM

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
    38      0   yes            yes      Std        0  OGRAM

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       6 DIAG
         yes           Std       1 OUT_SYMBOL
         yes           Std       2 OUT_STR
         yes           Std       0 FLUSH
         yes           Std       4 LIMCHK
                       nStd      0 X66_AUTO_0
                       nStd      0 X66_ARET
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:19   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$OU                                  M$SO                                  M$LO
     M$SI                                  M$UI

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     NULLSID                               ISSID
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:20   


        1        1        /*M* OGRAM =>  ORDER THE GRAMMAR AND DO SOME VALIDITY CHECKS. */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7
        8        8
        9        9
       10       10
       11       11        OGRAM:  PROC;

     11 38 000000   000000 700200 xent  OGRAM        TSX0  ! X66_AUTO_0
        38 000001   020372 000000                    ZERO    8442,0
        38 000002   000115 710000 38                 TRA     s:672

       12       12
       13       13        /*D*
       14       14               NAME: OGRAM
       15       15            PURPOSE:
       16       16
       17       17        *,*   REMAP ALL SYMBOLS SUCH THAT TERMINAL SYMBOLS HAVE LOWER
       18       18        *,*   NUMBERS THAN THE NON-TERMINALS.
       19       19        *,*   FIND THE GOAL SYMBOL OF THE GRAMMAR.
       20       20        *,*   MAKE SURE THAT ALL PRODUCTIONS IN THE GRAMMAR ARE ACTUALLY USED.
       21       21        *,*   FIX UP THE FIRST FAKE PRODUCTION TO INCLUDE THE GOAL OF
       22       22        *,*   THE GRAMMAR THAT HAS BEEN READ IN.
       23       23        */
       24       24        %INCLUDE LR_GRAM_EXT;
       25      563
       26      564    1   DCL DIAG ENTRY(6);
       27      565    1   DCL LIMCHK ENTRY(4);
       28      566    1   DCL OUT_STR ENTRY(2);
       29      567    1   DCL FLUSH ENTRY;
       30      568    1   DCL OUT_SYMBOL ENTRY(1);
       31      569    1   DCL OUT_SYMBOL_TOKEN ENTRY(1);
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:21   
       32      570
       33      571    1   DCL NSYM_PTRS (0:NR_SYMS_MAX) PTR;
       34      572    1   DCL NSYM_MAP (0:NR_SYMS_MAX) SBIN;
       35      573    1   DCL NSYM_MAPI(0:NR_SYMS_MAX) SBIN;
       36      574    1   DCL NULL_LIST(0:NR_SYMS_MAX) REDEF NSYM_MAPI SBIN;
       37      575
       38      576    1   DCL GRAMGOAL SBIN;
       39      577
       40      578    1   DCL I SBIN;
       41      579    1   DCL J SBIN;
       42      580
       43      581        /* STACK FOR FINDING ACCESSABLE SYMBOLS */
       44      582
       45      583    1   DCL 1 STKS(0:NR_SYMS_MAX),
       46      584    1         2 SYM_INDX SBIN,
       47      585    1         2 PROD_INDX SBIN,
       48      586    1         2 RIGHT_INDX SBIN;
       49      587
       50      588    1   DCL S$             PTR;
       51      589    1   DCL S              SBIN;
       52      590    1   DCL RF             SBIN;
       53      591    1   DCL RL             SBIN;
       54      592    1   DCL PF             SBIN;
       55      593    1   DCL PL             SBIN;
       56      594    1   DCL PUSHING        BOOLEAN;
       57      595    1   DCL NULL_BECAUSE_S SBIN;
       58      596    1   DCL P              SBIN;
       59      597    1   DCL ALLNULL        BOOLEAN;
       60      598    1   DCL SSS$           PTR;
       61      599    1   DCL R              SBIN;
       62      600    1   DCL DEPTH          SBIN;
       63      601
       64      602    1   DCL 1 NTEXT STATIC,
       65      603    1         2 NUM CHAR(4),
       66      604    1         2 * CHAR(0) INIT('%%');
       67      605
       68      606        %EJECT;
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:22   
       69      607    1   FIND_NEXTP:PROC(SYM_INDX,PROD_INDX,RIGHT_INDX) ALTRET;

    607 38 000003   220352 741300       FIND_NEXTP   STX1  ! DEPTH+2,,AUTO

       70      608
       71      609
       72      610        /* THIS ROUTINE IS CALLED ONLY BY THE TREE WALK FOR
       73      611           FINDING USELESS PRODUCTIONS AND TO CALCULATE WHICH SYMBOLS
       74      612           ARE NULLABLE. IN ORDER TO CALCULATE NULLABLE SYMBOLS CORRECTLY
       75      613           THE TREE MUST BE SEARCHED AS DEEPLY AS POSSIBLE BEFORE
       76      614           HANDLING ANY NON-TERMINALS FOLLOWING THE INITIAL INSPECTION POINT.
       77      615
       78      616           KEPT IN THE STACK ARE:  1) NON-TERMINAL SYMBOL
       79      617                                   2) RELATIVE PRODUCTION NUMBER YET TO EXAMINE
       80      618                                   3) RIGHT PART POSITION YET TO EXAMINE IN
       81      619                                      PRODUCTION MENTIONED IN 2).
       82      620
       83      621           THIS ROUTINE WILL RETURN IF ALL NON-T'S IN ALL PRODUCTIONS
       84      622           FOR THE NON-TERMINAL IN THE STACK HAVE BEEN EXAMINED ALREADY.
       85      623           IF NOT ALL NON-T'S HAVE BEEN EXAMINED, THE FIRST ONE NOT
       86      624           EXAMINED IS PUSHED INTO THE STACK AND AN ALTRETURN IS PERFORMED.
       87      625           THE ARGUMENTS TO THIS ROUTINE ARE THE ACTUAL STACKED VALUES AND
       88      626           UPON ALTRETURN, THE VALUES IN THE STACK HAVE BEEN ALTERED.
       89      627           THIS ALLOWS THE POP OF THE SYMBOL TO PICK UP RIGHT AFTER
       90      628           WHERE IT LEFT OFF AFTER EXAMINING ALL SONS IN THE TREE WALK. */
       91      629
       92      630    2   DCL SYM_INDX   SBIN;
       93      631    2   DCL PROD_INDX  SBIN;
       94      632    2   DCL RIGHT_INDX SBIN;
       95      633
       96      634    2   DCL S$         PTR;
       97      635    2   DCL SSS$       PTR;
       98      636    2   DCL PL         SBIN;
       99      637    2   DCL RF         SBIN;
      100      638    2   DCL R          SBIN;
      101      639
      102      640
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:23   
      103      641    2           S$=SYM_PTRS(SYM_INDX);

    641 38 000004   220353 470500                    LDP0    @SYM_INDX,,AUTO
        38 000005   000000 720100                    LXL0    0,,PR0
        38 000006   000000 236010 6                  LDQ     SYM_PTRS,X0
        38 000007   220356 756100                    STQ     S$,,AUTO

      104      642    2           PL=S$->SYMBOL.PROD_CNT;

    642 38 000010   220356 471500                    LDP1    S$,,AUTO
        38 000011   100007 235100                    LDA     7,,PR1
        38 000012   220360 755100                    STA     PL,,AUTO

      105      643
      106      644    3           DO WHILE(PROD_INDX<=PL);

    644 38 000013   220354 473500                    LDP3    @PROD_INDX,,AUTO
        38 000014   300000 236100                    LDQ     0,,PR3
        38 000015   220360 116100                    CMPQ    PL,,AUTO
        38 000016   000113 605400 38                 TPNZ    s:669

      107      645
      108      646    3              R=PROD.RIGHT_START(PROD_INDX+S$->SYMBOL.PROD_INDX-1);

    646 38 000017   220354 470500                    LDP0    @PROD_INDX,,AUTO
        38 000020   220356 471500                    LDP1    S$,,AUTO
        38 000021   000000 236100                    LDQ     0,,PR0
        38 000022   100006 036100                    ADLQ    6,,PR1
        38 000023   000001 736000                    QLS     1
        38 000024   777777 236006 8                  LDQ     PROD-1,QL
        38 000025   000022 736000                    QLS     18
        38 000026   000022 732000                    QRS     18
        38 000027   220362 756100                    STQ     R,,AUTO

      109      647    3              RL=PROD.RIGHT_CNT(PROD_INDX+S$->SYMBOL.PROD_INDX-1);

    647 38 000030   000000 236100                    LDQ     0,,PR0
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:24   
        38 000031   100006 036100                    ADLQ    6,,PR1
        38 000032   000001 736000                    QLS     1
        38 000033   777777 236006 8                  LDQ     PROD-1,QL
        38 000034   000022 732000                    QRS     18
        38 000035   220337 756100                    STQ     RL,,AUTO

      110      648
      111      649    4              DO WHILE(RIGHT_INDX<=RL);

    649 38 000036   220355 473500                    LDP3    @RIGHT_INDX,,AUTO
        38 000037   300000 116100                    CMPQ    0,,PR3
        38 000040   000103 604000 38                 TMI     s:666

      112      650
      113      651    4                 SSS$=SYM_PTRS(RIGHT_PARTS(R+RIGHT_INDX-1));

    651 38 000041   220355 470500                    LDP0    @RIGHT_INDX,,AUTO
        38 000042   220362 236100                    LDQ     R,,AUTO
        38 000043   000000 036100                    ADLQ    0,,PR0
        38 000044   000001 736000                    QLS     1
        38 000045   000100 100406                    MLR     fill='000'O
        38 000046   777777 400002 7                  ADSC9   RIGHT_PARTS-1,Q          cn=2,n=2
        38 000047   220364 000004                    ADSC9   R+2,,AUTO                cn=0,n=4
        38 000050   220364 236100                    LDQ     R+2,,AUTO
        38 000051   000022 732000                    QRS     18
        38 000052   000000 236006 6                  LDQ     SYM_PTRS,QL
        38 000053   220357 756100                    STQ     SSS$,,AUTO

      114      652
      115      653    4                 IF (NOT SSS$->SYMBOL.ON_RIGHT) AND

    653 38 000054   220357 471500                    LDP1    SSS$,,AUTO
        38 000055   100004 236100                    LDQ     4,,PR1
        38 000056   100000 316003                    CANQ    32768,DU
        38 000057   000077 601000 38                 TNZ     s:664
        38 000060   100002 235100                    LDA     2,,PR1
        38 000061   000077 600000 38                 TZE     s:664
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:25   

      116      654    4                   (NOT SSS$->SYMBOL.SYM_TYPE=SYM_TYPE_TERM) THEN
      117      655    5                 DO;

      118      656    5                    SSS$->SYMBOL.ON_RIGHT=TRUE;

    656 38 000062   100000 236003                    LDQ     32768,DU
        38 000063   100004 256100                    ORSQ    4,,PR1

      119      657    5                    DEPTH=DEPTH+1;

    657 38 000064   220350 054100                    AOS     DEPTH,,AUTO

      120      658    5                    STKS.SYM_INDX(DEPTH)=SSS$->SYMBOL.SYM_INDX;

    658 38 000065   220350 236100                    LDQ     DEPTH,,AUTO
        38 000066   000003 402007                    MPY     3,DL
        38 000067   100001 235100                    LDA     1,,PR1
        38 000070   210161 755106                    STA     STKS,QL,AUTO

      121      659    5                    STKS.PROD_INDX(DEPTH)=1;

    659 38 000071   000001 235007                    LDA     1,DL
        38 000072   210162 755106                    STA     STKS+1,QL,AUTO

      122      660    5                    STKS.RIGHT_INDX(DEPTH)=1;

    660 38 000073   210163 755106                    STA     STKS+2,QL,AUTO

      123      661    5                    RIGHT_INDX=RIGHT_INDX+1;

    661 38 000074   000000 054100                    AOS     0,,PR0

      124      662    5                    ALTRETURN;

    662 38 000075   220352 221300                    LDX1  ! DEPTH+2,,AUTO
        38 000076   000000 702211                    TSX2  ! 0,X1
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:26   

      125      663    5                    END;
      126      664    4                 RIGHT_INDX=RIGHT_INDX+1;

    664 38 000077   000000 054100                    AOS     0,,PR0

      127      665    4                 END /* WHILE RIGHT_INDX */;

    665 38 000100   000000 236100                    LDQ     0,,PR0
        38 000101   220337 116100                    CMPQ    RL,,AUTO
        38 000102   000041 604400 38                 TMOZ    s:651

      128      666    3              PROD_INDX=PROD_INDX+1;

    666 38 000103   220354 470500                    LDP0    @PROD_INDX,,AUTO
        38 000104   000000 054100                    AOS     0,,PR0

      129      667    3              RIGHT_INDX=1;

    667 38 000105   000001 235007                    LDA     1,DL
        38 000106   220355 471500                    LDP1    @RIGHT_INDX,,AUTO
        38 000107   100000 755100                    STA     0,,PR1

      130      668    3              END /* WHILE PROD_INDX */;

    668 38 000110   000000 236100                    LDQ     0,,PR0
        38 000111   220360 116100                    CMPQ    PL,,AUTO
        38 000112   000017 604400 38                 TMOZ    s:646

      131      669    2   END FIND_NEXTP;

    669 38 000113   220352 221300                    LDX1  ! DEPTH+2,,AUTO
        38 000114   000001 702211                    TSX2  ! 1,X1

      132      670
      133      671        %EJECT;
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:27   
      134      672    1           PROD_LEN_MAX_EVER=0;

    672 38 000115   000000 450000 16                 STZ     PROD_LEN_MAX_EVER

      135      673    1           INSTR_LISTED=TRUE;

    673 38 000116   400000 236003                    LDQ     -131072,DU
        38 000117   000000 756000 28                 STQ     INSTR_LISTED

      136      674    1           LAST_ACT=0;

    674 38 000120   000000 450000 12                 STZ     LAST_ACT

      137      675    1           LAST_NULL=0;

    675 38 000121   000000 450000 13                 STZ     LAST_NULL

      138      676    1           GRAMGOAL=0;

    676 38 000122   210156 450100                    STZ     GRAMGOAL,,AUTO

      139      677
      140      678    1           IF ERR_SEV > 6 THEN

    678 38 000123   000000 235000 19                 LDA     ERR_SEV
        38 000124   000006 115007                    CMPA    6,DL
        38 000125   000132 604400 38                 TMOZ    s:683

      141      679    1              CALL DIAG(15,' PROCESSING TERMINATED DUE TO ERRORS%%');

    679 38 000126   000002 630400 39                 EPPR0   2
        38 000127   000000 631400 39                 EPPR1   0
        38 000130   000000 701000 xent               TSX1    DIAG
        38 000131   000000 011000                    NOP     0

      142      680
      143      681        /* Find the goal symbol */
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:28   
      144      682
      145      683    1           I=1;

    683 38 000132   000001 235007                    LDA     1,DL
        38 000133   210157 755100                    STA     I,,AUTO

      146      684    2           DO WHILE (GRAMGOAL=0 & I < NR_PROD );

    684 38 000134   000207 710000 38                 TRA     s:706

      147      685    2              S = PROD.GOAL_SYM_INDX(I);

    685 38 000135   210157 235100                    LDA     I,,AUTO
        38 000136   000001 735000                    ALS     1
        38 000137   000000 236005 8                  LDQ     PROD,AL
        38 000140   000022 732000                    QRS     18
        38 000141   220335 756100                    STQ     S,,AUTO

      148      686    2              IF SYM_PTRS(S)->SYMBOL.SYM_TYPE=SYM_TYPE_NT THEN

    686 38 000142   000000 470406 6                  LDP0    SYM_PTRS,QL
        38 000143   000002 235100                    LDA     2,,PR0
        38 000144   000001 115007                    CMPA    1,DL
        38 000145   000206 601000 38                 TNZ     s:705

      149      687    3              DO;

      150      688    3                 IF NOT SYM_PTRS(S)->SYMBOL.ON_RIGHT THEN

    688 38 000146   220335 720100                    LXL0    S,,AUTO
        38 000147   000000 470410 6                  LDP0    SYM_PTRS,X0
        38 000150   000004 236100                    LDQ     4,,PR0
        38 000151   100000 316003                    CANQ    32768,DU
        38 000152   000204 601000 38                 TNZ     s:703

      151      689    3                    IF GRAMGOAL=0 THEN

PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:29   
    689 38 000153   210156 235100                    LDA     GRAMGOAL,,AUTO
        38 000154   000160 601000 38                 TNZ     s:694

      152      690    3                       GRAMGOAL=S;

    690 38 000155   220335 235100                    LDA     S,,AUTO
        38 000156   210156 755100                    STA     GRAMGOAL,,AUTO
        38 000157   000204 710000 38                 TRA     s:703

      153      691    3                    ELSE
      154      692    4                       DO;

      155      693                              %SELECT_LO;

    694 38 000160   000000 236007 xsym               LDQ     M$LO,DL
        38 000161   000000 756000 0                  STQ     OUT_DCBN

      156      696                              %OUT_STR(S="'ERROR => Duplicate goal symbol: '");

    697 38 000162   000005 630400 39                 EPPR0   5
        38 000163   000000 631400 39                 EPPR1   0
        38 000164   000000 701000 xent               TSX1    OUT_STR
        38 000165   000000 011000                    NOP     0

      157      699    4                         CALL OUT_SYMBOL(SYM_PTRS(S));

    699 38 000166   220335 720100                    LXL0    S,,AUTO
        38 000167   000000 630410 6                  EPPR0   SYM_PTRS,X0
        38 000170   220364 450500                    STP0    R+2,,AUTO
        38 000171   220364 630500                    EPPR0   R+2,,AUTO
        38 000172   000007 631400 39                 EPPR1   7
        38 000173   000000 701000 xent               TSX1    OUT_SYMBOL
        38 000174   000000 011000                    NOP     0

      158      700    4                         CALL FLUSH;

    700 38 000175   000010 631400 39                 EPPR1   8
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:30   
        38 000176   000000 701000 xent               TSX1    FLUSH
        38 000177   000000 011000                    NOP     0

      159      701    4                         CALL DIAG(6,'%%');

    701 38 000200   000012 630400 39                 EPPR0   10
        38 000201   000000 631400 39                 EPPR1   0
        38 000202   000000 701000 xent               TSX1    DIAG
        38 000203   000000 011000                    NOP     0

      160      702    4                       END;

      161      703    3                 GRAMGOAL = S;

    703 38 000204   220335 235100                    LDA     S,,AUTO
        38 000205   210156 755100                    STA     GRAMGOAL,,AUTO

      162      704    3                 END;

      163      705    2              I=I+1;

    705 38 000206   210157 054100                    AOS     I,,AUTO

      164      706    2              END;

    706 38 000207   400000 220003                    LDX0    -131072,DU
        38 000210   210156 235100                    LDA     GRAMGOAL,,AUTO
        38 000211   000213 600000 38                 TZE     s:706+4
        38 000212   000000 220003                    LDX0    0,DU
        38 000213   400000 221003                    LDX1    -131072,DU
        38 000214   210157 236100                    LDQ     I,,AUTO
        38 000215   000000 116000 9                  CMPQ    NR_PROD
        38 000216   000220 604000 38                 TMI     s:706+9
        38 000217   000000 221003                    LDX1    0,DU
        38 000220   000000 636011                    EAQ     0,X1
        38 000221   220364 756100                    STQ     R+2,,AUTO
        38 000222   000000 636010                    EAQ     0,X0
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:31   
        38 000223   220364 376100                    ANQ     R+2,,AUTO
        38 000224   000135 601000 38                 TNZ     s:685

      165      707                 %SELECT_LO;

    708 38 000225   000000 236007 xsym               LDQ     M$LO,DL
        38 000226   000000 756000 0                  STQ     OUT_DCBN

      166      710                %OUTLINE(S="' '");

    712 38 000227   000016 630400 39                 EPPR0   14
        38 000230   000000 631400 39                 EPPR1   0
        38 000231   000000 701000 xent               TSX1    OUT_STR
        38 000232   000000 011000                    NOP     0

    713 38 000233   000010 631400 39                 EPPR1   8
        38 000234   000000 701000 xent               TSX1    FLUSH
        38 000235   000000 011000                    NOP     0

      167      716    1           IF GRAMGOAL~=0 THEN

    716 38 000236   210156 235100                    LDA     GRAMGOAL,,AUTO
        38 000237   000256 600000 38                 TZE     s:727

      168      717    2              DO;

      169      718    2              CALL OUT_SYMBOL(SYM_PTRS(GRAMGOAL));

    718 38 000240   000000 630405 6                  EPPR0   SYM_PTRS,AL
        38 000241   220364 450500                    STP0    R+2,,AUTO
        38 000242   220364 630500                    EPPR0   R+2,,AUTO
        38 000243   000007 631400 39                 EPPR1   7
        38 000244   000000 701000 xent               TSX1    OUT_SYMBOL
        38 000245   000000 011000                    NOP     0

      170      719                   %OUTLINE(S="' assumed to be the goal symbol.'");

PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:32   
    721 38 000246   000021 630400 39                 EPPR0   17
        38 000247   000000 631400 39                 EPPR1   0
        38 000250   000000 701000 xent               TSX1    OUT_STR
        38 000251   000000 011000                    NOP     0

    722 38 000252   000010 631400 39                 EPPR1   8
        38 000253   000000 701000 xent               TSX1    FLUSH
        38 000254   000000 011000                    NOP     0

      171      725    2              END;

    725 38 000255   000262 710000 38                 TRA     s:731

      172      726    1           ELSE
      173      727    1              CALL DIAG(15,'ERROR =>No goal symbol found %%');

    727 38 000256   000023 630400 39                 EPPR0   19
        38 000257   000000 631400 39                 EPPR1   0
        38 000260   000000 701000 xent               TSX1    DIAG
        38 000261   000000 011000                    NOP     0

      174      728
      175      729                /* Identify all semantic actions for which to create null productions */
      176      730
      177      731    2           DO I = 0 TO NR_PROD - 1;

    731 38 000262   210157 450100                    STZ     I,,AUTO
        38 000263   000365 710000 38                 TRA     s:750+1

      178      732
      179      733    3             DO R = PROD.RIGHT_START(I) TO PROD.RIGHT_START(I) + PROD.RIGHT_CNT(I) -2;

    733 38 000264   210157 235100                    LDA     I,,AUTO
        38 000265   000001 735000                    ALS     1
        38 000266   000001 236005 8                  LDQ     PROD+1,AL
        38 000267   000022 736000                    QLS     18
        38 000270   000022 732000                    QRS     18
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:33   
        38 000271   220347 756100                    STQ     R,,AUTO
        38 000272   000314 710000 38                 TRA     s:739+1

      180      734
      181      735    3               S = RIGHT_PARTS(R);

    735 38 000273   220347 235100                    LDA     R,,AUTO
        38 000274   000001 735000                    ALS     1
        38 000275   000100 100405                    MLR     fill='000'O
        38 000276   000000 000002 7                  ADSC9   RIGHT_PARTS,A            cn=0,n=2
        38 000277   220364 000004                    ADSC9   R+2,,AUTO                cn=0,n=4
        38 000300   220364 236100                    LDQ     R+2,,AUTO
        38 000301   000022 732000                    QRS     18
        38 000302   220335 756100                    STQ     S,,AUTO

      182      736    3               IF SYM_PTRS(S) -> SYMBOL.SYM_TYPE = SYM_TYPE_ACT THEN

    736 38 000303   000000 470406 6                  LDP0    SYM_PTRS,QL
        38 000304   000002 235100                    LDA     2,,PR0
        38 000305   000002 115007                    CMPA    2,DL
        38 000306   000313 601000 38                 TNZ     s:739

      183      737    3                 SYM_PTRS(S) -> SYMBOL.SEM_PROD_REQ = TRUE;

    737 38 000307   220335 720100                    LXL0    S,,AUTO
        38 000310   000000 470410 6                  LDP0    SYM_PTRS,X0
        38 000311   010000 236003                    LDQ     4096,DU
        38 000312   000004 256100                    ORSQ    4,,PR0

      184      738
      185      739    3             END;

    739 38 000313   220347 054100                    AOS     R,,AUTO
        38 000314   210157 235100                    LDA     I,,AUTO
        38 000315   000001 735000                    ALS     1
        38 000316   000001 236005 8                  LDQ     PROD+1,AL
        38 000317   000022 732000                    QRS     18
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:34   
        38 000320   220364 756100                    STQ     R+2,,AUTO
        38 000321   000001 236005 8                  LDQ     PROD+1,AL
        38 000322   000022 736000                    QLS     18
        38 000323   000022 732000                    QRS     18
        38 000324   220364 036100                    ADLQ    R+2,,AUTO
        38 000325   000002 136007                    SBLQ    2,DL
        38 000326   220347 116100                    CMPQ    R,,AUTO
        38 000327   000273 605000 38                 TPL     s:735

      186      740
      187      741    2             PROD.TRAILING_SEM_ACT(I) = FALSE;

    741 38 000330   000025 236000 39                 LDQ     21
        38 000331   000000 356005 8                  ANSQ    PROD,AL

      188      742
      189      743    2             IF PROD.RIGHT_CNT(I) > 0 THEN

    743 38 000332   000001 220005 8                  LDX0    PROD+1,AL
        38 000333   000364 604400 38                 TMOZ    s:750

      190      744    2               IF SYM_PTRS(RIGHT_PARTS(PROD.RIGHT_START(I) + PROD.RIGHT_CNT(I) - 1))

    744 38 000334   000001 236005 8                  LDQ     PROD+1,AL
        38 000335   000022 732000                    QRS     18
        38 000336   220364 756100                    STQ     R+2,,AUTO
        38 000337   000001 236005 8                  LDQ     PROD+1,AL
        38 000340   000022 736000                    QLS     18
        38 000341   000022 732000                    QRS     18
        38 000342   220364 036100                    ADLQ    R+2,,AUTO
        38 000343   000001 736000                    QLS     1
        38 000344   000100 100406                    MLR     fill='000'O
        38 000345   777777 400002 7                  ADSC9   RIGHT_PARTS-1,Q          cn=2,n=2
        38 000346   220365 000004                    ADSC9   R+3,,AUTO                cn=0,n=4
        38 000347   220365 236100                    LDQ     R+3,,AUTO
        38 000350   000022 732000                    QRS     18
        38 000351   000000 470406 6                  LDP0    SYM_PTRS,QL
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:35   
        38 000352   000002 235100                    LDA     2,,PR0
        38 000353   000002 115007                    CMPA    2,DL
        38 000354   000364 601000 38                 TNZ     s:750

      191      745    2                         -> SYMBOL.SYM_TYPE = SYM_TYPE_ACT THEN
      192      746    3                 DO;

      193      747    3                   PROD.TRAILING_SEM_ACT(I) = TRUE;

    747 38 000355   210157 235100                    LDA     I,,AUTO
        38 000356   000001 735000                    ALS     1
        38 000357   400000 236007                    LDQ     -131072,DL
        38 000360   000000 256005 8                  ORSQ    PROD,AL

      194      748    3                   PROD.RIGHT_CNT(I) = PROD.RIGHT_CNT(I) - 1;

    748 38 000361   000001 220005 8                  LDX0    PROD+1,AL
        38 000362   777777 621010                    EAX1    -1,X0
        38 000363   000001 741005 8                  STX1    PROD+1,AL

      195      749    3                 END;

      196      750    2           END;

    750 38 000364   210157 054100                    AOS     I,,AUTO
        38 000365   210157 236100                    LDQ     I,,AUTO
        38 000366   000000 116000 9                  CMPQ    NR_PROD
        38 000367   000264 604000 38                 TMI     s:733

      197      751
      198      752    2           DO I=1 TO NR_SYMS;

    752 38 000370   000001 235007                    LDA     1,DL
        38 000371   210157 755100                    STA     I,,AUTO
        38 000372   000450 710000 38                 TRA     s:771+1

      199      753    2              SYM_PTRS(I)->SYMBOL.ON_RIGHT=FALSE;
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:36   

    753 38 000373   210157 720100                    LXL0    I,,AUTO
        38 000374   000000 470410 6                  LDP0    SYM_PTRS,X0
        38 000375   000026 236000 39                 LDQ     22
        38 000376   000004 356100                    ANSQ    4,,PR0

      200      754    2              SYM_PTRS(I)->SYMBOL.NULLABLE=FALSE;

    754 38 000377   000000 470410 6                  LDP0    SYM_PTRS,X0
        38 000400   000027 236000 39                 LDQ     23
        38 000401   000004 356100                    ANSQ    4,,PR0

      201      755
      202      756    2              IF SYM_PTRS(I)->SYMBOL.SEM_PROD_REQ THEN

    756 38 000402   000000 470410 6                  LDP0    SYM_PTRS,X0
        38 000403   000004 236100                    LDQ     4,,PR0
        38 000404   010000 316003                    CANQ    4096,DU
        38 000405   000447 600000 38                 TZE     s:771

      203      757    3              DO;

      204      758
      205      759                       /* TURN THIS SYMBOL INTO A NON-TERMINAL  */
      206      760    3                 SYM_PTRS(I)->SYMBOL.ON_LEFT=TRUE;

    760 38 000406   200000 236003                    LDQ     65536,DU
        38 000407   000004 256100                    ORSQ    4,,PR0

      207      761    3                 SYM_PTRS(I)->SYMBOL.PROD_INDX=NR_PROD;

    761 38 000410   000000 470410 6                  LDP0    SYM_PTRS,X0
        38 000411   000000 235000 9                  LDA     NR_PROD
        38 000412   000006 755100                    STA     6,,PR0

      208      762    3                 SYM_PTRS(I)->SYMBOL.PROD_CNT=1;

PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:37   
    762 38 000413   000000 470410 6                  LDP0    SYM_PTRS,X0
        38 000414   000001 235007                    LDA     1,DL
        38 000415   000007 755100                    STA     7,,PR0

      209      763    3                 CALL LIMCHK(15,NR_PROD+1, NR_PROD_MAX, 'Too many productions: %%');

    763 38 000416   000000 235000 9                  LDA     NR_PROD
        38 000417   000001 035007                    ADLA    1,DL
        38 000420   220364 755100                    STA     R+2,,AUTO
        38 000421   000032 237000 39                 LDAQ    26
        38 000422   220370 757100                    STAQ    R+6,,AUTO
        38 000423   220364 630500                    EPPR0   R+2,,AUTO
        38 000424   220367 450500                    STP0    R+5,,AUTO
        38 000425   000002 236000 39                 LDQ     2
        38 000426   220366 756100                    STQ     R+4,,AUTO
        38 000427   220366 630500                    EPPR0   R+4,,AUTO
        38 000430   000030 631400 39                 EPPR1   24
        38 000431   000000 701000 xent               TSX1    LIMCHK
        38 000432   000000 011000                    NOP     0

      210      764    3                  PROD.GOAL_SYM_INDX(NR_PROD)=I;

    764 38 000433   000000 235000 9                  LDA     NR_PROD
        38 000434   000001 735000                    ALS     1
        38 000435   210157 720100                    LXL0    I,,AUTO
        38 000436   000000 740005 8                  STX0    PROD,AL

      211      765    3                  PROD.RIGHT_CNT(NR_PROD)=0;

    765 38 000437   000000 221003                    LDX1    0,DU
        38 000440   000001 741005 8                  STX1    PROD+1,AL

      212      766    3                  PROD.RIGHT_START(NR_PROD)=NR_ONRIGHT+1;

    766 38 000441   000000 722000 14                 LXL2    NR_ONRIGHT
        38 000442   000001 623012                    EAX3    1,X2
        38 000443   000001 443005 8                  SXL3    PROD+1,AL
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:38   

      213      767    3                  PROD.TRAILING_SEM_ACT(NR_PROD) = FALSE;

    767 38 000444   000025 236000 39                 LDQ     21
        38 000445   000000 356005 8                  ANSQ    PROD,AL

      214      768    3                 NR_PROD=NR_PROD+1;

    768 38 000446   000000 054000 9                  AOS     NR_PROD

      215      769
      216      770    3                 END;

      217      771    2              END;

    771 38 000447   210157 054100                    AOS     I,,AUTO
        38 000450   210157 236100                    LDQ     I,,AUTO
        38 000451   000000 116000 10                 CMPQ    NR_SYMS
        38 000452   000373 604400 38                 TMOZ    s:753

      218      772        /* INSERT GRAMGOAL INTO FIRST PRODUCTION */
      219      773
      220      774    1           RIGHT_PARTS(2)=GRAMGOAL;

    774 38 000453   210156 720100                    LXL0    GRAMGOAL,,AUTO
        38 000454   000001 740000 7                  STX0    RIGHT_PARTS+1

      221      775    1           SYM_PTRS(GRAMGOAL)->SYMBOL.ON_LEFT=TRUE;

    775 38 000455   000000 470410 6                  LDP0    SYM_PTRS,X0
        38 000456   200000 236003                    LDQ     65536,DU
        38 000457   000004 256100                    ORSQ    4,,PR0

      222      776
      223      777        /* AN INITIAL RE-ORDERING OF SYMBOLS HAS BEEN DETERMINED.
      224      778           THE ONLY SHUFFLING THAT HAS BEEN DONE IS TO PLACE THE
      225      779           TERMINALS BEFORE THE NON-TERMINALS. SOME PEOPLE MAY
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:39   
      226      780           DESIRE PLACING THE SYMBOLS IN ALPHABETICAL ORDER,
      227      781           AND IT SHOULD BE DONE HERE. */
      228      782
      229      783
      230      784
      231      785        /* MAKE SURE ALL NT'S ARE ACCESSABLE FROM <SYSTEM_GS> */
      232      786
      233      787        /* AS A PART OF THIS PROCESS, SET A BIT SAYING WHICH NON-T'S
      234      788           MIGHT REDUCE TO THE EMPTY STRING. FOR EACH NULLABLE SYMBOL
      235      789           SET NULL_BECAUSE_S TO BE EITHER THE NON-TERMINAL ITSELF
      236      790           (BECAUSE THE EMPTY PRODUCTION IS PART OF THAT NON-T'S DEFINITION)
      237      791           OR SET NULL_BECAUSE_S TO BE THE NULL_BECAUSE_S OF THE
      238      792           FIRST NON_TERMINAL IN THE STRING OF NULLABLE NON-TERMINALS
      239      793           MAKING UP THE PRODUCTION THAT CAUSES THIS SYMBOL TO BE NULLABLE
      240      794
      241      795           EXAMPLE:
      242      796              <G> ::=  <A> <B>
      243      797              <A> ::= (EMPTY)
      244      798              <A> ::= A
      245      799              <B> ::= (EMPTY)
      246      800              <B> ::= B
      247      801
      248      802          <G>, <A>, AND <B> ARE ALL SYMBOLS THAT HAVE NULLABLE SET TRUE.
      249      803          NULL_BECAUSE_S FOR EACH NON_TERMINAL THAT IS NULLABLE IS SET
      250      804          TO THE PRODUCTION THAT MAKES THAT NOT_TERMINAL POTENTIALLY NULLABLE */
      251      805
      252      806
      253      807    1           DEPTH=1;

    807 38 000460   000001 235007                    LDA     1,DL
        38 000461   220350 755100                    STA     DEPTH,,AUTO

      254      808    1           STKS.SYM_INDX(1)=1;             /* <SYSTEM_GS>  */

    808 38 000462   210164 755100                    STA     STKS+3,,AUTO

      255      809    1           STKS.PROD_INDX(1)=1;
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:40   

    809 38 000463   210165 755100                    STA     STKS+4,,AUTO

      256      810    1           STKS.RIGHT_INDX(1)=1;

    810 38 000464   210166 755100                    STA     STKS+5,,AUTO

      257      811
      258      812    1           SYM_PTRS(STKS.SYM_INDX(1))->SYMBOL.ON_RIGHT=TRUE;

    812 38 000465   000000 470405 6                  LDP0    SYM_PTRS,AL
        38 000466   100000 236003                    LDQ     32768,DU
        38 000467   000004 256100                    ORSQ    4,,PR0

      259      813    2           DO WHILE (DEPTH>0);

    813 38 000470   220350 235100                    LDA     DEPTH,,AUTO
        38 000471   000710 604400 38                 TMOZ    s:887

      260      814    2              S=STKS.SYM_INDX(DEPTH);

    814 38 000472   220350 236100                    LDQ     DEPTH,,AUTO
        38 000473   000003 402007                    MPY     3,DL
        38 000474   210161 235106                    LDA     STKS,QL,AUTO
        38 000475   220335 755100                    STA     S,,AUTO

      261      815    2              S$=SYM_PTRS(S);

    815 38 000476   000000 236005 6                  LDQ     SYM_PTRS,AL
        38 000477   220334 756100                    STQ     S$,,AUTO

      262      816    2              S$->SYMBOL.ON_RIGHT=TRUE;

    816 38 000500   220334 470500                    LDP0    S$,,AUTO
        38 000501   100000 236003                    LDQ     32768,DU
        38 000502   000004 256100                    ORSQ    4,,PR0

PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:41   
      263      817
      264      818        /* FIND NEXT SYMBOL THAT HAS NOT BEEN EXAMINED */
      265      819
      266      820    2              CALL FIND_NEXTP(STKS.SYM_INDX(DEPTH),

    820 38 000503   220350 236100                    LDQ     DEPTH,,AUTO
        38 000504   000003 402007                    MPY     3,DL
        38 000505   210163 630506                    EPPR0   STKS+2,QL,AUTO
        38 000506   220355 450500                    STP0    @PROD_INDX+1,,AUTO
        38 000507   210162 631506                    EPPR1   STKS+1,QL,AUTO
        38 000510   220354 451500                    STP1    @SYM_INDX+1,,AUTO
        38 000511   210161 633506                    EPPR3   STKS,QL,AUTO
        38 000512   220353 453500                    STP3    DEPTH+3,,AUTO
        38 000513   000003 701000 38                 TSX1    FIND_NEXTP
        38 000514   000706 702000 38                 TSX2    STILL_PUSHING

      267      821    2                STKS.PROD_INDX(DEPTH),
      268      822    2                STKS.RIGHT_INDX(DEPTH))
      269      823    2                ALTRET(STILL_PUSHING);
      270      824
      271      825
      272      826
      273      827    2              PF=S$->SYMBOL.PROD_INDX;

    827 38 000515   220334 470500                    LDP0    S$,,AUTO
        38 000516   000006 235100                    LDA     6,,PR0
        38 000517   220340 755100                    STA     PF,,AUTO

      274      828    3              DO P=S$->SYMBOL.PROD_CNT+PF-1 DOWNTO PF;

    828 38 000520   000007 236100                    LDQ     7,,PR0
        38 000521   220340 036100                    ADLQ    PF,,AUTO
        38 000522   000001 136007                    SBLQ    1,DL
        38 000523   220344 756100                    STQ     P,,AUTO
        38 000524   000701 710000 38                 TRA     s:877+2

      275      829    3                 ALLNULL=TRUE;
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:42   

    829 38 000525   400000 236003                    LDQ     -131072,DU
        38 000526   220345 756100                    STQ     ALLNULL,,AUTO

      276      830    3                 RF=PROD.RIGHT_START(P);

    830 38 000527   220344 235100                    LDA     P,,AUTO
        38 000530   000001 735000                    ALS     1
        38 000531   000001 236005 8                  LDQ     PROD+1,AL
        38 000532   000022 736000                    QLS     18
        38 000533   000022 732000                    QRS     18
        38 000534   220336 756100                    STQ     RF,,AUTO

      277      831    3                 RL=PROD.RIGHT_CNT(P)-1+RF;

    831 38 000535   000001 236005 8                  LDQ     PROD+1,AL
        38 000536   000022 732000                    QRS     18
        38 000537   220336 036100                    ADLQ    RF,,AUTO
        38 000540   000001 136007                    SBLQ    1,DL
        38 000541   220337 756100                    STQ     RL,,AUTO

      278      832    4                 DO R=RF TO RL;

    832 38 000542   220336 235100                    LDA     RF,,AUTO
        38 000543   220347 755100                    STA     R,,AUTO
        38 000544   000567 710000 38                 TRA     s:835+1

      279      833    4                    SSS$=SYM_PTRS(RIGHT_PARTS(R));

    833 38 000545   220347 235100                    LDA     R,,AUTO
        38 000546   000001 735000                    ALS     1
        38 000547   000100 100405                    MLR     fill='000'O
        38 000550   000000 000002 7                  ADSC9   RIGHT_PARTS,A            cn=0,n=2
        38 000551   220364 000004                    ADSC9   R+2,,AUTO                cn=0,n=4
        38 000552   220364 236100                    LDQ     R+2,,AUTO
        38 000553   000022 732000                    QRS     18
        38 000554   000000 236006 6                  LDQ     SYM_PTRS,QL
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:43   
        38 000555   220346 756100                    STQ     SSS$,,AUTO

      280      834    4                    ALLNULL=ALLNULL & (SSS$->SYMBOL.NULLABLE);

    834 38 000556   220346 470500                    LDP0    SSS$,,AUTO
        38 000557   000004 236100                    LDQ     4,,PR0
        38 000560   400000 376003                    ANQ     -131072,DU
        38 000561   220364 756100                    STQ     R+2,,AUTO
        38 000562   220345 236100                    LDQ     ALLNULL,,AUTO
        38 000563   400000 376003                    ANQ     -131072,DU
        38 000564   220364 376100                    ANQ     R+2,,AUTO
        38 000565   220345 756100                    STQ     ALLNULL,,AUTO

      281      835    4                    END /* DO R */;

    835 38 000566   220347 054100                    AOS     R,,AUTO
        38 000567   220347 236100                    LDQ     R,,AUTO
        38 000570   220337 116100                    CMPQ    RL,,AUTO
        38 000571   000545 604400 38                 TMOZ    s:833

      282      836
      283      837
      284      838    3                 IF ALLNULL THEN

    838 38 000572   220345 234100                    SZN     ALLNULL,,AUTO
        38 000573   000677 605000 38                 TPL     s:877

      285      839    4                 DO; /* SYMBOL POINTED TO BY S$ IS NULLABLE */

      286      840    4                    IF RF>RL THEN

    840 38 000574   220336 236100                    LDQ     RF,,AUTO
        38 000575   220337 116100                    CMPQ    RL,,AUTO
        38 000576   000602 604400 38                 TMOZ    s:843

      287      841    4                       NULL_BECAUSE_S=S;

PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:44   
    841 38 000577   220335 235100                    LDA     S,,AUTO
        38 000600   220343 755100                    STA     NULL_BECAUSE_S,,AUTO
        38 000601   000605 710000 38                 TRA     s:845

      288      842    4                    ELSE
      289      843    4                       NULL_BECAUSE_S=SSS$->SYMBOL.SYM_INDX;

    843 38 000602   220346 470500                    LDP0    SSS$,,AUTO
        38 000603   000001 235100                    LDA     1,,PR0
        38 000604   220343 755100                    STA     NULL_BECAUSE_S,,AUTO

      290      844
      291      845    4                    IF S$->SYMBOL.NULLABLE THEN

    845 38 000605   220334 470500                    LDP0    S$,,AUTO
        38 000606   000004 234100                    SZN     4,,PR0
        38 000607   000667 605000 38                 TPL     s:870

      292      846    5                      DO;

      293      847                            %SELECT_LO;

    848 38 000610   000000 236007 xsym               LDQ     M$LO,DL
        38 000611   000000 756000 0                  STQ     OUT_DCBN

      294      850                            %OUT_STR(S="'ERROR => Symbol '");

    851 38 000612   000035 630400 39                 EPPR0   29
        38 000613   000000 631400 39                 EPPR1   0
        38 000614   000000 701000 xent               TSX1    OUT_STR
        38 000615   000000 011000                    NOP     0

      295      853    5                       CALL OUT_SYMBOL(S$);

    853 38 000616   220334 630500                    EPPR0   S$,,AUTO
        38 000617   220364 450500                    STP0    R+2,,AUTO
        38 000620   220364 630500                    EPPR0   R+2,,AUTO
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:45   
        38 000621   000007 631400 39                 EPPR1   7
        38 000622   000000 701000 xent               TSX1    OUT_SYMBOL
        38 000623   000000 011000                    NOP     0

      296      854                            %OUT_STR(S="' is nullable two ways:'");

    855 38 000624   000040 630400 39                 EPPR0   32
        38 000625   000000 631400 39                 EPPR1   0
        38 000626   000000 701000 xent               TSX1    OUT_STR
        38 000627   000000 011000                    NOP     0

      297      857                            %OUT_STR(S="'            from symbols '");

    858 38 000630   000043 630400 39                 EPPR0   35
        38 000631   000000 631400 39                 EPPR1   0
        38 000632   000000 701000 xent               TSX1    OUT_STR
        38 000633   000000 011000                    NOP     0

      298      860    5                       CALL OUT_SYMBOL(SYM_PTRS(NULL_BECAUSE_S));

    860 38 000634   220343 720100                    LXL0    NULL_BECAUSE_S,,AUTO
        38 000635   000000 630410 6                  EPPR0   SYM_PTRS,X0
        38 000636   220364 450500                    STP0    R+2,,AUTO
        38 000637   220364 630500                    EPPR0   R+2,,AUTO
        38 000640   000007 631400 39                 EPPR1   7
        38 000641   000000 701000 xent               TSX1    OUT_SYMBOL
        38 000642   000000 011000                    NOP     0

      299      861                            %OUT_STR(S="' and '");

    862 38 000643   000046 630400 39                 EPPR0   38
        38 000644   000000 631400 39                 EPPR1   0
        38 000645   000000 701000 xent               TSX1    OUT_STR
        38 000646   000000 011000                    NOP     0

      300      864    5                       CALL OUT_SYMBOL(SYM_PTRS(S$->SYMBOL.NULL_BECAUSE_S));

PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:46   
    864 38 000647   220334 470500                    LDP0    S$,,AUTO
        38 000650   000003 220100                    LDX0    3,,PR0
        38 000651   000000 631410 6                  EPPR1   SYM_PTRS,X0
        38 000652   220364 451500                    STP1    R+2,,AUTO
        38 000653   220364 630500                    EPPR0   R+2,,AUTO
        38 000654   000007 631400 39                 EPPR1   7
        38 000655   000000 701000 xent               TSX1    OUT_SYMBOL
        38 000656   000000 011000                    NOP     0

      301      865    5                       CALL FLUSH;

    865 38 000657   000010 631400 39                 EPPR1   8
        38 000660   000000 701000 xent               TSX1    FLUSH
        38 000661   000000 011000                    NOP     0

      302      866    5                       CALL DIAG(6,'%%');

    866 38 000662   000012 630400 39                 EPPR0   10
        38 000663   000000 631400 39                 EPPR1   0
        38 000664   000000 701000 xent               TSX1    DIAG
        38 000665   000000 011000                    NOP     0

      303      867    5                      END;

    867 38 000666   000677 710000 38                 TRA     s:877

      304      868    4                    ELSE
      305      869    5                    DO;

      306      870    5                       S$->SYMBOL.NULLABLE=TRUE;

    870 38 000667   400000 236003                    LDQ     -131072,DU
        38 000670   000004 256100                    ORSQ    4,,PR0

      307      871    5                       S$->SYMBOL.NULL_BECAUSE_S=NULL_BECAUSE_S;

    871 38 000671   000000 620005                    EAX0    0,AL
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:47   
        38 000672   220334 470500                    LDP0    S$,,AUTO
        38 000673   000003 740100                    STX0    3,,PR0

      308      872    5                       S$->SYMBOL.NULL_BECAUSE_P=P;

    872 38 000674   220344 720100                    LXL0    P,,AUTO
        38 000675   220334 470500                    LDP0    S$,,AUTO
        38 000676   000003 440100                    SXL0    3,,PR0

      309      873    5                       END;

      310      874
      311      875    4                    END /* S$ IS NULLABLE */;

      312      876
      313      877    3                 END /* DO P */;

    877 38 000677   000001 336007                    LCQ     1,DL
        38 000700   220344 056100                    ASQ     P,,AUTO
        38 000701   220344 236100                    LDQ     P,,AUTO
        38 000702   220340 116100                    CMPQ    PF,,AUTO
        38 000703   000525 605000 38                 TPL     s:829

      314      878
      315      879    2              DEPTH=DEPTH-1;

    879 38 000704   000001 336007                    LCQ     1,DL
        38 000705   220350 056100                    ASQ     DEPTH,,AUTO

    879 38 000706                       STILL_PUSHI* null
      316      880
      317      881    2   STILL_PUSHING:;
      318      882
      319      883    2              END;

    883 38 000706   220350 235100                    LDA     DEPTH,,AUTO
        38 000707   000472 605400 38                 TPNZ    s:814
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:48   

      320      884
      321      885        /* ON_RIGHT SHOULD BE SET FOR ALL SYMBOLS */
      322      886
      323      887    2           DO I=1 TO NR_SYMS;

    887 38 000710   000001 236007                    LDQ     1,DL
        38 000711   210157 756100                    STQ     I,,AUTO
        38 000712   000754 710000 38                 TRA     s:906+1

      324      888    2              IF (SYM_PTRS(I)->SYMBOL.SYM_TYPE=SYM_TYPE_NT) AND

    888 38 000713   210157 720100                    LXL0    I,,AUTO
        38 000714   000000 470410 6                  LDP0    SYM_PTRS,X0
        38 000715   000002 235100                    LDA     2,,PR0
        38 000716   000001 115007                    CMPA    1,DL
        38 000717   000753 601000 38                 TNZ     s:906
        38 000720   000004 236100                    LDQ     4,,PR0
        38 000721   100000 316003                    CANQ    32768,DU
        38 000722   000753 601000 38                 TNZ     s:906

      325      889    2                NOT SYM_PTRS(I)->SYMBOL.ON_RIGHT THEN
      326      890    3                 DO;

      327      891                      %SELECT_LO;

    892 38 000723   000000 236007 xsym               LDQ     M$LO,DL
        38 000724   000000 756000 0                  STQ     OUT_DCBN

      328      894                      %OUT_STR(S="'ERROR => Productions for '");

    895 38 000725   000050 630400 39                 EPPR0   40
        38 000726   000000 631400 39                 EPPR1   0
        38 000727   000000 701000 xent               TSX1    OUT_STR
        38 000730   000000 011000                    NOP     0

      329      897    3                 CALL OUT_SYMBOL(SYM_PTRS(I));
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:49   

    897 38 000731   210157 720100                    LXL0    I,,AUTO
        38 000732   000000 630410 6                  EPPR0   SYM_PTRS,X0
        38 000733   220364 450500                    STP0    R+2,,AUTO
        38 000734   220364 630500                    EPPR0   R+2,,AUTO
        38 000735   000007 631400 39                 EPPR1   7
        38 000736   000000 701000 xent               TSX1    OUT_SYMBOL
        38 000737   000000 011000                    NOP     0

      330      898                      %OUTLINE(S="' are useless.'");

    900 38 000740   000053 630400 39                 EPPR0   43
        38 000741   000000 631400 39                 EPPR1   0
        38 000742   000000 701000 xent               TSX1    OUT_STR
        38 000743   000000 011000                    NOP     0

    901 38 000744   000010 631400 39                 EPPR1   8
        38 000745   000000 701000 xent               TSX1    FLUSH
        38 000746   000000 011000                    NOP     0

      331      904    3                 CALL DIAG(3,'%%');

    904 38 000747   000056 630400 39                 EPPR0   46
        38 000750   000000 631400 39                 EPPR1   0
        38 000751   000000 701000 xent               TSX1    DIAG
        38 000752   000000 011000                    NOP     0

      332      905    3                 END;

      333      906    2              END;

    906 38 000753   210157 054100                    AOS     I,,AUTO
        38 000754   210157 236100                    LDQ     I,,AUTO
        38 000755   000000 116000 10                 CMPQ    NR_SYMS
        38 000756   000713 604400 38                 TMOZ    s:888

      334      907    1           CALL LIMCHK(0,PROD_LEN_MAX_EVER,MAX_PROD_LEN,
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:50   

    907 38 000757   000061 630400 39                 EPPR0   49
        38 000760   000030 631400 39                 EPPR1   24
        38 000761   000000 701000 xent               TSX1    LIMCHK
        38 000762   000000 011000                    NOP     0

      335      908    1            'Production too long: %%');
      336      909
      337      910    1   MAKE_MAP:
      338      911    1             NR_TERM = LAST_ORDER_SPECIFIED;
               911                      /* BIAS TERMINALS BY START OF ALL TERMINALS THAT WERE ORDERED */

    911 38 000763   000000 235000 17    MAKE_MAP     LDA     LAST_ORDER_SPECIFIED
        38 000764   000000 755000 11                 STA     NR_TERM

      339      912
      340      913    2             DO I = 1 TO NR_SYMS;

    913 38 000765   000001 236007                    LDQ     1,DL
        38 000766   210157 756100                    STQ     I,,AUTO
        38 000767   001215 710000 38                 TRA     s:1005+1

      341      914    3              DO CASE(SYM_PTRS(I)->SYMBOL.SYM_TYPE);

    914 38 000770   210157 720100                    LXL0    I,,AUTO
        38 000771   000000 470410 6                  LDP0    SYM_PTRS,X0
        38 000772   000002 235100                    LDA     2,,PR0
        38 000773   000003 115007                    CMPA    3,DL
        38 000774   000776 602005 38                 TNC     s:914+6,AL
        38 000775   001214 710000 38                 TRA     s:1005
        38 000776   001001 710000 38                 TRA     s:917
        38 000777   001047 710000 38                 TRA     s:941
        38 001000   001157 710000 38                 TRA     s:988

      342      915
      343      916    3               CASE(SYM_TYPE_TERM);

PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:51   
      344      917    3                 IF SYM_PTRS(I) -> SYMBOL.ORDER_SPECIFIED THEN

    917 38 001001   000004 236100                    LDQ     4,,PR0
        38 001002   040000 316003                    CANQ    16384,DU
        38 001003   001012 600000 38                 TZE     s:921

      345      918    3                     NSYM_MAP(SYM_PTRS(I)->SYMBOL.ORDER) = I;

    918 38 001004   000004 236100                    LDQ     4,,PR0
        38 001005   000022 736000                    QLS     18
        38 001006   000022 732000                    QRS     18
        38 001007   210157 235100                    LDA     I,,AUTO
        38 001010   202574 755106                    STA     NSYM_MAP,QL,AUTO
        38 001011   001016 710000 38                 TRA     s:924

      346      919    3                 ELSE
      347      920    4                   DO;

      348      921    4                     NR_TERM=NR_TERM+1;

    921 38 001012   000000 054000 11                 AOS     NR_TERM

      349      922    4                     NSYM_MAP(NR_TERM)=I;

    922 38 001013   000000 721000 11                 LXL1    NR_TERM
        38 001014   210157 235100                    LDA     I,,AUTO
        38 001015   202574 755111                    STA     NSYM_MAP,X1,AUTO

      350      923    4                   END;

      351      924    3                 IF(SUBSTR(SYM_PTRS(I)->SYMBOL.TEXTCHR,0,1)='<')AND

    924 38 001016   000011 236100                    LDQ     9,,PR0
        38 001017   777000 376003                    ANQ     -512,DU
        38 001020   074000 116003                    CMPQ    30720,DU
        38 001021   001214 601000 38                 TNZ     s:1005
        38 001022   000010 235100                    LDA     8,,PR0
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:52   
        38 001023   040000 106505                    CMPC    fill='040'O
        38 001024   000010 600001                    ADSC9   8,A,PR0                  cn=3,n=1
        38 001025   000065 000001 39                 ADSC9   53                       cn=0,n=1
        38 001026   001214 601000 38                 TNZ     s:1005

      352      925    3                   (SUBSTR(SYM_PTRS(I)->SYMBOL.TEXTCHR,
      353      926    3                   SYM_PTRS(I)->SYMBOL.SYMLEN-1,1)='>') THEN
      354      927    4                     DO;

      355      928                           %SELECT_LO;

    929 38 001027   000000 236007 xsym               LDQ     M$LO,DL
        38 001030   000000 756000 0                  STQ     OUT_DCBN

      356      931    4                      CALL OUT_SYMBOL(SYM_PTRS(I));

    931 38 001031   000000 631410 6                  EPPR1   SYM_PTRS,X0
        38 001032   220364 451500                    STP1    R+2,,AUTO
        38 001033   220364 630500                    EPPR0   R+2,,AUTO
        38 001034   000007 631400 39                 EPPR1   7
        38 001035   000000 701000 xent               TSX1    OUT_SYMBOL
        38 001036   000000 011000                    NOP     0

      357      932                           %OUTLINE(S="' is assumed to be a terminal symbol.'");

    934 38 001037   000067 630400 39                 EPPR0   55
        38 001040   000000 631400 39                 EPPR1   0
        38 001041   000000 701000 xent               TSX1    OUT_STR
        38 001042   000000 011000                    NOP     0

    935 38 001043   000010 631400 39                 EPPR1   8
        38 001044   000000 701000 xent               TSX1    FLUSH
        38 001045   000000 011000                    NOP     0

      358      938    4                     END;

    938 38 001046   001214 710000 38                 TRA     s:1005
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:53   

      359      939
      360      940    3               CASE(SYM_TYPE_NT);

      361      941    3                 IF SYM_PTRS(I) -> SYMBOL.ORDER_SPECIFIED THEN

    941 38 001047   000004 236100                    LDQ     4,,PR0
        38 001050   040000 316003                    CANQ    16384,DU
        38 001051   001076 600000 38                 TZE     s:953

      362      942    4                    DO;

      363      943                           %SELECT_LO;

    944 38 001052   000000 236007 xsym               LDQ     M$LO,DL
        38 001053   000000 756000 0                  STQ     OUT_DCBN

      364      946                           %OUT_STR(S=
               946                    "'ERROR => An ordering was incorrectly requested for a non_terminal: '"
               946                               );

    947 38 001054   000072 630400 39                 EPPR0   58
        38 001055   000000 631400 39                 EPPR1   0
        38 001056   000000 701000 xent               TSX1    OUT_STR
        38 001057   000000 011000                    NOP     0

      365      949    4                      CALL OUT_SYMBOL(SYM_PTRS(I));

    949 38 001060   210157 720100                    LXL0    I,,AUTO
        38 001061   000000 630410 6                  EPPR0   SYM_PTRS,X0
        38 001062   220364 450500                    STP0    R+2,,AUTO
        38 001063   220364 630500                    EPPR0   R+2,,AUTO
        38 001064   000007 631400 39                 EPPR1   7
        38 001065   000000 701000 xent               TSX1    OUT_SYMBOL
        38 001066   000000 011000                    NOP     0

      366      950    4                      CALL FLUSH;
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:54   

    950 38 001067   000010 631400 39                 EPPR1   8
        38 001070   000000 701000 xent               TSX1    FLUSH
        38 001071   000000 011000                    NOP     0

      367      951    4                      CALL DIAG(6,'%%');

    951 38 001072   000012 630400 39                 EPPR0   10
        38 001073   000000 631400 39                 EPPR1   0
        38 001074   000000 701000 xent               TSX1    DIAG
        38 001075   000000 011000                    NOP     0

      368      952    4                    END;

      369      953    3                 IF SYM_PTRS(I)->SYMBOL.ON_LEFT THEN

    953 38 001076   210157 720100                    LXL0    I,,AUTO
        38 001077   000000 470410 6                  LDP0    SYM_PTRS,X0
        38 001100   000004 236100                    LDQ     4,,PR0
        38 001101   200000 316003                    CANQ    65536,DU
        38 001102   001123 600000 38                 TZE     s:968

      370      954    4                 DO;

      371      955    4                    IF SYM_PTRS(I)->SYMBOL.NULLABLE THEN

    955 38 001103   000004 234100                    SZN     4,,PR0
        38 001104   001114 605000 38                 TPL     s:962

      372      956    5                    DO;

      373      957    5                       NULL_LIST(NR_SYMS_MAX-LAST_NULL)=I;

    957 38 001105   000000 721000 13                 LXL1    LAST_NULL
        38 001106   777777 621011                    EAX1    -1,X1
        38 001107   777777 661003                    ERX1    -1,DU
        38 001110   210157 235100                    LDA     I,,AUTO
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:55   
        38 001111   210155 755111                    STA     NSYM_MAPI+1400,X1,AUTO

      374      958    5                       LAST_NULL=LAST_NULL+1;

    958 38 001112   000000 054000 13                 AOS     LAST_NULL

      375      959    5                       END;

    959 38 001113   001214 710000 38                 TRA     s:1005

      376      960    4                    ELSE
      377      961    5                    DO;

      378      962    5                       NSYM_MAP(NR_SYMS_MAX-NR_NT)=I;

    962 38 001114   000000 721000 15                 LXL1    NR_NT
        38 001115   777777 621011                    EAX1    -1,X1
        38 001116   777777 661003                    ERX1    -1,DU
        38 001117   210157 235100                    LDA     I,,AUTO
        38 001120   205364 755111                    STA     NSYM_MAP+1400,X1,AUTO

      379      963    5                       NR_NT=NR_NT+1;

    963 38 001121   000000 054000 15                 AOS     NR_NT

      380      964    5                       END;

      381      965    4                    END;

    965 38 001122   001214 710000 38                 TRA     s:1005

      382      966    3                 ELSE
      383      967    4                 DO;

      384      968    4                   IF SYM_PTRS(I) -> SYMBOL.ORDER_SPECIFIED THEN

    968 38 001123   040000 316003                    CANQ    16384,DU
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:56   
        38 001124   001133 600000 38                 TZE     s:972

      385      969    4                     NSYM_MAP(SYM_PTRS(I)->SYMBOL.ORDER) = I;

    969 38 001125   000004 236100                    LDQ     4,,PR0
        38 001126   000022 736000                    QLS     18
        38 001127   000022 732000                    QRS     18
        38 001130   210157 235100                    LDA     I,,AUTO
        38 001131   202574 755106                    STA     NSYM_MAP,QL,AUTO
        38 001132   001137 710000 38                 TRA     s:976

      386      970    4                   ELSE
      387      971    5                     DO;

      388      972    5                      NR_TERM=NR_TERM+1;

    972 38 001133   000000 054000 11                 AOS     NR_TERM

      389      973    5                      NSYM_MAP(NR_TERM)=I;

    973 38 001134   000000 721000 11                 LXL1    NR_TERM
        38 001135   210157 235100                    LDA     I,,AUTO
        38 001136   202574 755111                    STA     NSYM_MAP,X1,AUTO

      390      974    5                    END;

      391      975                         %SELECT_LO;

    976 38 001137   000000 236007 xsym               LDQ     M$LO,DL
        38 001140   000000 756000 0                  STQ     OUT_DCBN

      392      978    4                    CALL OUT_SYMBOL(SYM_PTRS(I));

    978 38 001141   000000 631410 6                  EPPR1   SYM_PTRS,X0
        38 001142   220364 451500                    STP1    R+2,,AUTO
        38 001143   220364 630500                    EPPR0   R+2,,AUTO
        38 001144   000007 631400 39                 EPPR1   7
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:57   
        38 001145   000000 701000 xent               TSX1    OUT_SYMBOL
        38 001146   000000 011000                    NOP     0

      393      979                         %OUTLINE(S="' is assumed to be a terminal.'");

    981 38 001147   000075 630400 39                 EPPR0   61
        38 001150   000000 631400 39                 EPPR1   0
        38 001151   000000 701000 xent               TSX1    OUT_STR
        38 001152   000000 011000                    NOP     0

    982 38 001153   000010 631400 39                 EPPR1   8
        38 001154   000000 701000 xent               TSX1    FLUSH
        38 001155   000000 011000                    NOP     0

      394      985    4                    END;

    985 38 001156   001214 710000 38                 TRA     s:1005

      395      986
      396      987    3               CASE(SYM_TYPE_ACT);    /* ACTION SYMBOL     */

      397      988    3                 IF SEMANTIC_ORDERING THEN

    988 38 001157   000000 234000 18                 SZN     SEMANTIC_ORDERING
        38 001160   001210 605000 38                 TPL     s:1002

      398      989    3                   IF NOT SYM_PTRS(I) -> SYMBOL.ORDER_SPECIFIED THEN

    989 38 001161   000004 236100                    LDQ     4,,PR0
        38 001162   040000 316003                    CANQ    16384,DU
        38 001163   001210 601000 38                 TNZ     s:1002

      399      990    4                     DO;

      400      991                            %SELECT_LO;

    992 38 001164   000000 236007 xsym               LDQ     M$LO,DL
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:58   
        38 001165   000000 756000 0                  STQ     OUT_DCBN

      401      994
      402      995                            %OUT_STR(S=
               995                       "'ERROR => A semantic action symbol was left out of the ordering: '"
               995                                );

    996 38 001166   000100 630400 39                 EPPR0   64
        38 001167   000000 631400 39                 EPPR1   0
        38 001170   000000 701000 xent               TSX1    OUT_STR
        38 001171   000000 011000                    NOP     0

      403      998    4                       CALL OUT_SYMBOL (SYM_PTRS(I));

    998 38 001172   210157 720100                    LXL0    I,,AUTO
        38 001173   000000 630410 6                  EPPR0   SYM_PTRS,X0
        38 001174   220364 450500                    STP0    R+2,,AUTO
        38 001175   220364 630500                    EPPR0   R+2,,AUTO
        38 001176   000007 631400 39                 EPPR1   7
        38 001177   000000 701000 xent               TSX1    OUT_SYMBOL
        38 001200   000000 011000                    NOP     0

      404      999    4                       CALL FLUSH;

    999 38 001201   000010 631400 39                 EPPR1   8
        38 001202   000000 701000 xent               TSX1    FLUSH
        38 001203   000000 011000                    NOP     0

      405     1000    4                       CALL DIAG(6,'%%');

   1000 38 001204   000012 630400 39                 EPPR0   10
        38 001205   000000 631400 39                 EPPR1   0
        38 001206   000000 701000 xent               TSX1    DIAG
        38 001207   000000 011000                    NOP     0

      406     1001    4                     END;

PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:59   
      407     1002    3                 LAST_ACT=LAST_ACT+1;

   1002 38 001210   000000 054000 12                 AOS     LAST_ACT

      408     1003    3                 NULL_LIST(LAST_ACT)=I;

   1003 38 001211   000000 720000 12                 LXL0    LAST_ACT
        38 001212   210157 235100                    LDA     I,,AUTO
        38 001213   205365 755110                    STA     NSYM_MAPI,X0,AUTO

      409     1004    3               END /* DO CASE */;

      410     1005    2              END /* MAKE_MAP */;

   1005 38 001214   210157 054100                    AOS     I,,AUTO
        38 001215   210157 236100                    LDQ     I,,AUTO
        38 001216   000000 116000 10                 CMPQ    NR_SYMS
        38 001217   000770 604400 38                 TMOZ    s:914

      411     1006
      412     1007        /* I have now 4 types of symbols:
      413     1008           1) terminals placed in NSYM_MAX(1..NR_TERM)
      414     1009           2) non terminals in NSYM_MAP(NR_SYMS_MAX..NR_SYMS_MAX-NR_NT+1)
      415     1010           3) action symbols in NULL_LIST(1..LAST_ACT)
      416     1011           4) nullable symbols in NULL_LIST(NR_SYMS_MAX..NR_SYMS_MAX-NR_NULL+1)
      417     1012
      418     1013           place these symbols into NSYM_MAP in consecutive order. */
      419     1014
      420     1015
      421     1016    2           DO I=1 TO NR_NT;

   1016 38 001220   000001 235007                    LDA     1,DL
        38 001221   210157 755100                    STA     I,,AUTO
        38 001222   001233 710000 38                 TRA     s:1018+1

      422     1017    2              NSYM_MAP(NR_TERM+I)=NSYM_MAP(NR_SYMS_MAX+1-I);

PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:60   
   1017 38 001223   000000 236000 11                 LDQ     NR_TERM
        38 001224   210157 036100                    ADLQ    I,,AUTO
        38 001225   210157 720100                    LXL0    I,,AUTO
        38 001226   777777 620010                    EAX0    -1,X0
        38 001227   777777 660003                    ERX0    -1,DU
        38 001230   205365 235110                    LDA     NSYM_MAPI,X0,AUTO
        38 001231   202574 755106                    STA     NSYM_MAP,QL,AUTO

      423     1018    2              END;

   1018 38 001232   210157 054100                    AOS     I,,AUTO
        38 001233   210157 236100                    LDQ     I,,AUTO
        38 001234   000000 116000 15                 CMPQ    NR_NT
        38 001235   001223 604400 38                 TMOZ    s:1017

      424     1019
      425     1020    1           NR_NT=NR_NT+NR_TERM;

   1020 38 001236   000000 236000 15                 LDQ     NR_NT
        38 001237   000000 036000 11                 ADLQ    NR_TERM
        38 001240   000000 756000 15                 STQ     NR_NT

      426     1021
      427     1022    2           DO I=1 TO LAST_ACT;

   1022 38 001241   000001 235007                    LDA     1,DL
        38 001242   210157 755100                    STA     I,,AUTO
        38 001243   001252 710000 38                 TRA     s:1024+1

      428     1023    2              NSYM_MAP(NR_NT+I)=NULL_LIST(I);

   1023 38 001244   000000 236000 15                 LDQ     NR_NT
        38 001245   210157 036100                    ADLQ    I,,AUTO
        38 001246   210157 720100                    LXL0    I,,AUTO
        38 001247   205365 235110                    LDA     NSYM_MAPI,X0,AUTO
        38 001250   202574 755106                    STA     NSYM_MAP,QL,AUTO

PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:61   
      429     1024    2              END;

   1024 38 001251   210157 054100                    AOS     I,,AUTO
        38 001252   210157 236100                    LDQ     I,,AUTO
        38 001253   000000 116000 12                 CMPQ    LAST_ACT
        38 001254   001244 604400 38                 TMOZ    s:1023

      430     1025
      431     1026    1           LAST_ACT=NR_NT+LAST_ACT;

   1026 38 001255   000000 236000 15                 LDQ     NR_NT
        38 001256   000000 036000 12                 ADLQ    LAST_ACT
        38 001257   000000 756000 12                 STQ     LAST_ACT

      432     1027
      433     1028    2           DO I= 1 TO LAST_NULL;

   1028 38 001260   000001 235007                    LDA     1,DL
        38 001261   210157 755100                    STA     I,,AUTO
        38 001262   001273 710000 38                 TRA     s:1030+1

      434     1029    2              NSYM_MAP(LAST_ACT+I)=NULL_LIST(NR_SYMS_MAX+1-I);

   1029 38 001263   000000 236000 12                 LDQ     LAST_ACT
        38 001264   210157 036100                    ADLQ    I,,AUTO
        38 001265   210157 720100                    LXL0    I,,AUTO
        38 001266   777777 620010                    EAX0    -1,X0
        38 001267   777777 660003                    ERX0    -1,DU
        38 001270   210156 235110                    LDA     GRAMGOAL,X0,AUTO
        38 001271   202574 755106                    STA     NSYM_MAP,QL,AUTO

      435     1030    2              END;

   1030 38 001272   210157 054100                    AOS     I,,AUTO
        38 001273   210157 236100                    LDQ     I,,AUTO
        38 001274   000000 116000 13                 CMPQ    LAST_NULL
        38 001275   001263 604400 38                 TMOZ    s:1029
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:62   

      436     1031
      437     1032    1           LAST_NULL=LAST_ACT+LAST_NULL;

   1032 38 001276   000000 236000 12                 LDQ     LAST_ACT
        38 001277   000000 036000 13                 ADLQ    LAST_NULL
        38 001300   000000 756000 13                 STQ     LAST_NULL

      438     1033
      439     1034    1           IF LAST_NULL~=NR_SYMS THEN

   1034 38 001301   000000 116000 10                 CMPQ    NR_SYMS
        38 001302   001307 600000 38                 TZE     s:1040

      440     1035    1              CALL DIAG(15,'ERROR =>Ordering error in OGRAM%%');

   1035 38 001303   000102 630400 39                 EPPR0   66
        38 001304   000000 631400 39                 EPPR1   0
        38 001305   000000 701000 xent               TSX1    DIAG
        38 001306   000000 011000                    NOP     0

      441     1036
      442     1037
      443     1038        /* MAKE INVERSE MAPPING */
      444     1039
      445     1040    2           DO I=1 TO NR_SYMS;

   1040 38 001307   000001 235007                    LDA     1,DL
        38 001310   210157 755100                    STA     I,,AUTO
        38 001311   001317 710000 38                 TRA     s:1042+1

      446     1041    2              NSYM_MAPI(NSYM_MAP(I))=I;

   1041 38 001312   210157 720100                    LXL0    I,,AUTO
        38 001313   202574 235110                    LDA     NSYM_MAP,X0,AUTO
        38 001314   210157 236100                    LDQ     I,,AUTO
        38 001315   205365 756105                    STQ     NSYM_MAPI,AL,AUTO
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:63   

      447     1042    2              END;

   1042 38 001316   210157 054100                    AOS     I,,AUTO
        38 001317   210157 236100                    LDQ     I,,AUTO
        38 001320   000000 116000 10                 CMPQ    NR_SYMS
        38 001321   001312 604400 38                 TMOZ    s:1041

      448     1043
      449     1044
      450     1045        /* NOW GO THRU ALL PRODUCTION TABLE ENTRIES & THE
      451     1046
      452     1047           RIGHT PART ARRAY RE-MAPPING ALL SYMBOLS */
      453     1048
      454     1049    2           DO I=0 TO NR_PROD-1;

   1049 38 001322   210157 450100                    STZ     I,,AUTO
        38 001323   001340 710000 38                 TRA     s:1054+1

      455     1050    2              PROD.GOAL_SYM_INDX(I)=

   1050 38 001324   210157 235100                    LDA     I,,AUTO
        38 001325   000001 735000                    ALS     1
        38 001326   000000 236005 8                  LDQ     PROD,AL
        38 001327   000022 732000                    QRS     18
        38 001330   205365 720106                    LXL0    NSYM_MAPI,QL,AUTO
        38 001331   000000 740005 8                  STX0    PROD,AL

      456     1051    2                NSYM_MAPI(PROD.GOAL_SYM_INDX(I));
      457     1052    2              IF PROD.RIGHT_CNT(I)>PROD_LEN_MAX_EVER THEN

   1052 38 001332   000001 236005 8                  LDQ     PROD+1,AL
        38 001333   000022 732000                    QRS     18
        38 001334   000000 116000 16                 CMPQ    PROD_LEN_MAX_EVER
        38 001335   001337 604400 38                 TMOZ    s:1054

      458     1053    2                 PROD_LEN_MAX_EVER=PROD.RIGHT_CNT(I);
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:64   

   1053 38 001336   000000 756000 16                 STQ     PROD_LEN_MAX_EVER

      459     1054    2              END;

   1054 38 001337   210157 054100                    AOS     I,,AUTO
        38 001340   210157 236100                    LDQ     I,,AUTO
        38 001341   000000 116000 9                  CMPQ    NR_PROD
        38 001342   001324 604000 38                 TMI     s:1050

      460     1055
      461     1056    2           DO I=1 TO NR_ONRIGHT;

   1056 38 001343   000001 235007                    LDA     1,DL
        38 001344   210157 755100                    STA     I,,AUTO
        38 001345   001362 710000 38                 TRA     s:1058+1

      462     1057    2              RIGHT_PARTS(I)=NSYM_MAPI(RIGHT_PARTS(I));

   1057 38 001346   210157 235100                    LDA     I,,AUTO
        38 001347   000001 735000                    ALS     1
        38 001350   000100 100405                    MLR     fill='000'O
        38 001351   000000 000002 7                  ADSC9   RIGHT_PARTS,A            cn=0,n=2
        38 001352   220364 000004                    ADSC9   R+2,,AUTO                cn=0,n=4
        38 001353   220364 236100                    LDQ     R+2,,AUTO
        38 001354   000022 732000                    QRS     18
        38 001355   000002 736000                    QLS     2
        38 001356   000005 101506                    MRL     fill='000'O
        38 001357   205365 000004                    ADSC9   NSYM_MAPI,Q,AUTO         cn=0,n=4
        38 001360   000000 000002 7                  ADSC9   RIGHT_PARTS,A            cn=0,n=2

      463     1058    2              END;

   1058 38 001361   210157 054100                    AOS     I,,AUTO
        38 001362   210157 236100                    LDQ     I,,AUTO
        38 001363   000000 116000 14                 CMPQ    NR_ONRIGHT
        38 001364   001346 604400 38                 TMOZ    s:1057
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:65   

      464     1059
      465     1060        /* NOW CALCULATE NEW SYMBOL POINTERS */
      466     1061
      467     1062    2           DO I=1 TO NR_SYMS;

   1062 38 001365   000001 235007                    LDA     1,DL
        38 001366   210157 755100                    STA     I,,AUTO
        38 001367   001375 710000 38                 TRA     s:1064+1

      468     1063    2              NSYM_PTRS(I)=SYM_PTRS(NSYM_MAP(I));

   1063 38 001370   210157 720100                    LXL0    I,,AUTO
        38 001371   202574 721110                    LXL1    NSYM_MAP,X0,AUTO
        38 001372   000000 236011 6                  LDQ     SYM_PTRS,X1
        38 001373   200003 756110                    STQ     NSYM_PTRS,X0,AUTO

      469     1064    2              END;

   1064 38 001374   210157 054100                    AOS     I,,AUTO
        38 001375   210157 236100                    LDQ     I,,AUTO
        38 001376   000000 116000 10                 CMPQ    NR_SYMS
        38 001377   001370 604400 38                 TMOZ    s:1063

      470     1065
      471     1066    2           DO I=1 TO NR_SYMS;

   1066 38 001400   000001 235007                    LDA     1,DL
        38 001401   210157 755100                    STA     I,,AUTO
        38 001402   001421 710000 38                 TRA     s:1072+1

      472     1067    2              SYM_PTRS(I)=NSYM_PTRS(I);

   1067 38 001403   210157 720100                    LXL0    I,,AUTO
        38 001404   200003 236110                    LDQ     NSYM_PTRS,X0,AUTO
        38 001405   000000 756010 6                  STQ     SYM_PTRS,X0

PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:66   
      473     1068    2              SYM_PTRS(I)->SYMBOL.SYM_INDX=

   1068 38 001406   000000 470410 6                  LDP0    SYM_PTRS,X0
        38 001407   000001 235100                    LDA     1,,PR0
        38 001410   205365 235105                    LDA     NSYM_MAPI,AL,AUTO
        38 001411   000001 755100                    STA     1,,PR0

      474     1069    2                NSYM_MAPI(SYM_PTRS(I)->SYMBOL.SYM_INDX);
      475     1070    2              SYM_PTRS(I)->SYMBOL.ON_RIGHT=FALSE;

   1070 38 001412   000000 470410 6                  LDP0    SYM_PTRS,X0
        38 001413   000026 236000 39                 LDQ     22
        38 001414   000004 356100                    ANSQ    4,,PR0

      476     1071    2              SYM_PTRS(I)->SYMBOL.NULLABLE=FALSE;

   1071 38 001415   000000 470410 6                  LDP0    SYM_PTRS,X0
        38 001416   000027 236000 39                 LDQ     23
        38 001417   000004 356100                    ANSQ    4,,PR0

      477     1072    2              END;

   1072 38 001420   210157 054100                    AOS     I,,AUTO
        38 001421   210157 236100                    LDQ     I,,AUTO
        38 001422   000000 116000 10                 CMPQ    NR_SYMS
        38 001423   001403 604400 38                 TMOZ    s:1067

      478     1073
      479     1074        /* DONE WITH SYMBOL MAPPING */
      480     1075
      481     1076    1           CALL LIMCHK(15,NR_ONRIGHT,NR_RIGHT_MAX,

   1076 38 001424   000105 630400 39                 EPPR0   69
        38 001425   000030 631400 39                 EPPR1   24
        38 001426   000000 701000 xent               TSX1    LIMCHK
        38 001427   000000 011000                    NOP     0

PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:67   
      482     1077    1             'Production storage space exceeded:  %%');
      483     1078    1           CALL LIMCHK(0,NR_SYMS,NR_SYMS_MAX,

   1078 38 001430   000112 630400 39                 EPPR0   74
        38 001431   000030 631400 39                 EPPR1   24
        38 001432   000000 701000 xent               TSX1    LIMCHK
        38 001433   000000 011000                    NOP     0

      484     1079    1            'The maximum number of symbols has been exceeded: %%');
      485     1080
      486     1081    1           CALL LIMCHK(0,NR_TERM,NR_TERM_MAX,

   1081 38 001434   000117 630400 39                 EPPR0   79
        38 001435   000030 631400 39                 EPPR1   24
        38 001436   000000 701000 xent               TSX1    LIMCHK
        38 001437   000000 011000                    NOP     0

      487     1082    1            'The maximum number of terminal symbols has been exceeded: %%');
      488     1083
      489     1084    1           CALL LIMCHK(15,NR_PROD,NR_PROD_MAX,

   1084 38 001440   000123 630400 39                 EPPR0   83
        38 001441   000030 631400 39                 EPPR1   24
        38 001442   000000 701000 xent               TSX1    LIMCHK
        38 001443   000000 011000                    NOP     0

      490     1085    1            'The maximum number of productions has been exceeded: %%');
      491     1086
      492     1087
      493     1088    1           IF ERR_SEV>6 THEN

   1088 38 001444   000000 235000 19                 LDA     ERR_SEV
        38 001445   000006 115007                    CMPA    6,DL
        38 001446   001453 604400 38                 TMOZ    s:1093

      494     1089    1              CALL DIAG(15,'PROCESSING TERMINATED DUE TO ERRORS: %%');

PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:68   
   1089 38 001447   000127 630400 39                 EPPR0   87
        38 001450   000000 631400 39                 EPPR1   0
        38 001451   000000 701000 xent               TSX1    DIAG
        38 001452   000000 011000                    NOP     0

      495     1090
      496     1091        /* SET ALL DEFAULT TERMINAL COSTS */
      497     1092
      498     1093    2              DO I = 1 TO NR_TERM;

   1093 38 001453   000001 235007                    LDA     1,DL
        38 001454   210157 755100                    STA     I,,AUTO
        38 001455   001470 710000 38                 TRA     s:1100+1

      499     1094
      500     1095    2                 IF NOT SYM_PTRS(I) -> SYMBOL.COSTS_SPECIFIED THEN

   1095 38 001456   210157 720100                    LXL0    I,,AUTO
        38 001457   000000 470410 6                  LDP0    SYM_PTRS,X0
        38 001460   000004 236100                    LDQ     4,,PR0
        38 001461   020000 316003                    CANQ    8192,DU
        38 001462   001467 601000 38                 TNZ     s:1100

      501     1096    3                   DO;

      502     1097    3                     SYM_PTRS(I) -> SYMBOL.COST.INS = DEFAULT_INS_COST;

   1097 38 001463   000012 221003                    LDX1    10,DU
        38 001464   000005 741100                    STX1    5,,PR0

      503     1098    3                     SYM_PTRS(I) -> SYMBOL.COST.DEL = DEFAULT_DEL_COST;

   1098 38 001465   000000 470410 6                  LDP0    SYM_PTRS,X0
        38 001466   000005 441100                    SXL1    5,,PR0

      504     1099    3                   END;

PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:69   
      505     1100    2              END;

   1100 38 001467   210157 054100                    AOS     I,,AUTO
        38 001470   210157 236100                    LDQ     I,,AUTO
        38 001471   000000 116000 11                 CMPQ    NR_TERM
        38 001472   001456 604400 38                 TMOZ    s:1095

      506     1101
      507     1102    1              EOF_SYMBOL_PTR -> SYMBOL.COST.INS = INFINITE_COST;

   1102 38 001473   303237 220003                    LDX0    99999,DU
        38 001474   000000 470400 22                 LDP0    EOF_SYMBOL_PTR
        38 001475   000005 740100                    STX0    5,,PR0

      508     1103    1              EOF_SYMBOL_PTR -> SYMBOL.COST.DEL = INFINITE_COST;

   1103 38 001476   000005 440100                    SXL0    5,,PR0

      509     1104
      510     1105    1              IF ERROR_SYMBOL_PTR ~= ADDR(NIL) THEN

   1105 38 001477   000000 236000 23                 LDQ     ERROR_SYMBOL_PTR
        38 001500   000131 116000 39                 CMPQ    89
        38 001501   001505 600000 38                 TZE     s:1114

      511     1106    2                DO;

      512     1107    2                  ERROR_SYMBOL_PTR -> SYMBOL.COST.DEL = INFINITE_COST;

   1107 38 001502   000000 471400 23                 LDP1    ERROR_SYMBOL_PTR
        38 001503   100005 440100                    SXL0    5,,PR1

      513     1108    2                  ERROR_SYMBOL_PTR -> SYMBOL.COST.INS = INFINITE_COST;

   1108 38 001504   100005 740100                    STX0    5,,PR1

      514     1109    2                END;
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:70   

      515     1110
      516     1111
      517     1112        /* SET LENGTHS FOR VECTORS */
      518     1113
      519     1114    1           SET_LENGTHB=NR_TERM+1;

   1114 38 001505   000000 235000 11                 LDA     NR_TERM
        38 001506   000001 035007                    ADLA    1,DL
        38 001507   000000 755000 20                 STA     SET_LENGTHB

      520     1115    1           SET_LENGTHW=(SET_LENGTHB+35)/36;

   1115 38 001510   000000 236000 20                 LDQ     SET_LENGTHB
        38 001511   000043 036007                    ADLQ    35,DL
        38 001512   000044 506007                    DIV     36,DL
        38 001513   000000 756000 21                 STQ     SET_LENGTHW

      521     1116    1           SET_LENGTHB=SET_LENGTHW*36 /* TEMP */;

   1116 38 001514   000044 402007                    MPY     36,DL
        38 001515   000000 756000 20                 STQ     SET_LENGTHB

      522     1117    1   END OGRAM;

   1117 38 001516   000000 702200 xent               TSX2  ! X66_ARET

PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:71   
--  Include file information  --

   LR_IO_EXT.:Z8A6TOU  cannot be made into a system file and is referenced.
   LR_GRAM_EXT.:Z8A6TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure OGRAM.
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:72   

 **** Variables and constants ****

  ****  Section 000 LblCom OUT_DCBN

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w SBIN        r     1 OUT_DCBN

  ****  Section 006 LblCom SYM_PTRS

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 SYM_PTRS(0:1400)

  ****  Section 007 LblCom RIGHT_PARTS

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/h SBIN(18)    r     1 RIGHT_PARTS(0:8000)

  ****  Section 008 LblCom PROD

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/h STRC(72)    r     1 PROD(0:1500)

  ****  Section 009 LblCom NR_PROD

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w SBIN        r     1 NR_PROD

PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:73   
  ****  Section 010 LblCom NR_SYMS

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w SBIN        r     1 NR_SYMS

  ****  Section 011 LblCom NR_TERM

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w SBIN        r     1 NR_TERM

  ****  Section 012 LblCom LAST_ACT

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w SBIN        r     1 LAST_ACT

  ****  Section 013 LblCom LAST_NULL

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w SBIN        r     1 LAST_NULL

  ****  Section 014 LblCom NR_ONRIGHT

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w SBIN        r     1 NR_ONRIGHT

  ****  Section 015 LblCom NR_NT

PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:74   
  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w SBIN        r     1 NR_NT

  ****  Section 016 LblCom PROD_LEN_MAX_EVER

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w SBIN        r     1 PROD_LEN_MAX_EVER

  ****  Section 017 LblCom LAST_ORDER_SPECIFIED

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w SBIN        r     1 LAST_ORDER_SPECIFIED

  ****  Section 018 LblCom SEMANTIC_ORDERING

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/b BIT         r     1 SEMANTIC_ORDERING

  ****  Section 019 LblCom ERR_SEV

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w SBIN        r     1 ERR_SEV

  ****  Section 020 LblCom SET_LENGTHB

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:75   

     0-0-0/w SBIN        r     1 SET_LENGTHB

  ****  Section 021 LblCom SET_LENGTHW

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w SBIN        r     1 SET_LENGTHW

  ****  Section 022 LblCom EOF_SYMBOL_PTR

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 EOF_SYMBOL_PTR

  ****  Section 023 LblCom ERROR_SYMBOL_PTR

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 ERROR_SYMBOL_PTR

  ****  Section 024 LblCom BOF_SYMBOL_PTR

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR               1 BOF_SYMBOL_PTR

  ****  Section 025 LblCom OPTIONS

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/b BIT               1 OPTIONS(0:25)
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:76   

  ****  Section 026 LblCom OPTIONS_TEXT

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c CHAR(4)           1 OPTIONS_TEXT(0:25)

  ****  Section 027 LblCom INSTR

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c CHAR              1 INSTR(0:511)               0-0-0/c CHAR(512)         1 INSTRCHR

  ****  Section 028 LblCom INSTR_LISTED

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/b BIT         r     1 INSTR_LISTED

  ****  Section 029 LblCom INSTR_LEN

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w SBIN              1 INSTR_LEN

  ****  Section 030 LblCom INSTR_INDX

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w SBIN              1 INSTR_INDX

  ****  Section 031 LblCom EOF_FLAG
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:77   

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/b BIT               1 EOF_FLAG

  ****  Section 032 LblCom KEY_REC

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c CHAR(10)          1 KEY_REC

  ****  Section 033 LblCom LINE

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c CHAR(109)         1 LINE

  ****  Section 034 LblCom LINELEN

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w SBIN              1 LINELEN

  ****  Section 035 LblCom TSTATS

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(7380)        1 TSTATS

  ****  Section 036  Data  OGRAM

  ****  Scalars and arrays  ****
PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:78   
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c STRC(54)          1 NTEXT

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

 20354-0-0/w PTR         r     1 @PROD_INDX             20355-0-0/w PTR         r     1 @RIGHT_INDX
 20353-0-0/w PTR         r     1 @SYM_INDX              20345-0-0/b BIT         r     1 ALLNULL
 20350-0-0/w SBIN        r     1 DEPTH                  10156-0-0/w SBIN        r     1 GRAMGOAL
 10157-0-0/w SBIN        r     1 I                      10160-0-0/w SBIN              1 J
  2574-0-0/w SBIN        r     1 NSYM_MAP(0:1400)        5365-0-0/w SBIN        r     1 NSYM_MAPI(0:1400)
     3-0-0/w PTR         r     1 NSYM_PTRS(0:1400)      20343-0-0/w SBIN        r     1 NULL_BECAUSE_S
  5365-0-0/w SBIN        r     1 NULL_LIST(0:1400)      20344-0-0/w SBIN        r     1 P
 20340-0-0/w SBIN        r     1 PF                     20341-0-0/w SBIN              1 PL
 20360-0-0/w SBIN        r     1 PL                        *0-0-0/w SBIN        r     1 PROD_INDX
 20342-0-0/b BIT               1 PUSHING                20347-0-0/w SBIN        r     1 R
 20362-0-0/w SBIN        r     1 R                      20336-0-0/w SBIN        r     1 RF
 20361-0-0/w SBIN              1 RF                        *0-0-0/w SBIN        r     1 RIGHT_INDX
 20337-0-0/w SBIN        r     1 RL                     20335-0-0/w SBIN        r     1 S
 20334-0-0/w PTR         r     1 S$                     20356-0-0/w PTR         r     1 S$
 20346-0-0/w PTR         r     1 SSS$                   20357-0-0/w PTR         r     1 SSS$
 10161-0-0/w STRC(108)   r     1 STKS(0:1400)              *0-0-0/w SBIN        r     1 SYM_INDX

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0N  NULL        r     1 M$LO                       0-0-0N  NULL        r     1 M$OU
     0-0-0N  NULL        r     1 M$SI                       0-0-0N  NULL        r     1 M$SO
     0-0-0N  NULL        r     1 M$UI                       0-0-0/w STRC(351)   r     1 SYMBOL

PL6.E3A0      #001=OGRAM File=LR_OGRAM.:Z8A6TSI                                  SAT 08/09/97 09:36 Page:79   

   Procedure OGRAM requires 847 words for executable code.
   Procedure OGRAM requires 8442 words of local(AUTO) storage.

    No errors detected in file LR_OGRAM.:Z8A6TSI    .
