VERSION A02

PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:1    
        1        1        /*M* NTB, MCR=NO, PLM=3, CTI=6, IND=4, MCI=YES, SDI=6, DCI=4, ENU=0, ECU=0 , CCC */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        FTPCMD: PROC ALTRET;
        8        8        %INCLUDE CP_6;
        9       89        %INCLUDE CP_6_SUBS;
       10      629        %INCLUDE XU_MACRO_C;
       11     3735        %INCLUDE XUG_ENTRY;
       12     3766        %INCLUDE B$JIT;
       13     4056    1   DCL X$PRE_PROCESS ENTRY(1) ALTRET;
       14     4057    1   DCL X$WRITE ENTRY(22);
       15     4058        %INCLUDE XU_FORMAT_C;
       16     4220        %F_FDS (NAME=FDS);
       17     4333        %INCLUDE TCF_FTP_E;
       18     4388        %INCLUDE TCP_HEP_M;
       19     4443        %INCLUDE TCT_TELNET_E;
       20     4498        %B$TCB;
       21     4501        %B$ALT;
       22     4509        %INCLUDE B_ERRORS_C;
       23     5636        %EQU TIMEOUT = 60;
       24     5637
       25     5638    1   DCL GET_CONNECTED ENTRY(1) ALTRET;
       26     5639    1   DCL GET_USER ENTRY(1) ALTRET;
       27     5640    1   DCL TELNET_EOL ENTRY(1) ALTRET;
       28     5641    1   DCL TCP$WRITE_D ENTRY(4) ALTRET;
       29     5642    1   DCL TCP$RELEASE ENTRY(1) ALTRET;
       30     5643    1   DCL GET_LINE ENTRY(4) ALTRET;
       31     5644    1   DCL GET_RESPONSE ENTRY(3) ALTRET;
       32     5645    1   DCL GET_RESPONSENW ENTRY(3) ALTRET;
       33     5646    1   DCL TCP$WRITE ENTRY(4) ALTRET;
       34     5647    1   DCL TCP$CLOSE ENTRY(1) ALTRET;
       35     5648    1   DCL REMOTE_ADMIN ENTRY(1);
       36     5649    1   DCL TCP$OPEN ENTRY(6) ALTRET;
       37     5650    1   DCL TCP$READ ENTRY(3) ALTRET;
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:2    
       38     5651    1   DCL PARSE_SF ENTRY(1);
       39     5652    1   DCL X66_TRTN ENTRY(1);
       40     5653
       41     5654        %XUG_GETCMD (PROMPT=PROMPT,
       42     5655                     STCLASS=STATIC SYMDEF,
       43     5656                     SFROUTINE=PARSE_SF,
       44     5657                     NODES=FTP_NODES);
       45     5995    1   DCL PROMPT CHAR(0) CONSTANT INIT('FTP:');
       46     5996
       47     5997    1   DCL BREAK_MEM STATIC REMEMBER;
       48     5998        %FPT_INT (STCLASS=CONSTANT,
       49     5999                  UENTRY=XUG$BREAK);
       50     6013
       51     6014        %XUG_INIT (
       52     6015                ABORT=FTPBREAK,
       53     6016                ALWAYS_SET_PROMPT=YES,
       54     6017                INHIBIT_END=YES,
       55     6018                PREPROCESS=YES,
       56     6019                PREPROCESSOR=X$PRE_PROCESS,
       57     6020                PASS=BLANK,
       58     6021                GOODCMD=YES);
       59     6434
       60     6435        %PARSE$OUT (STCLASS="BASED(PARSE$)");
       61     6480        %PARSE$SYM (STCLASS=BASED);
       62     6518        %FPT_WRITE (FPTN=WRITE_DATA);
       63     6549        %F$DCB;
       64     6606    1   DCL B$TCB$ PTR SYMREF;
       65     6607    1   DCL B$JIT$ PTR SYMREF READONLY;
       66     6608    1   DCL PARSE$ PTR;
       67     6609        /*
       68     6610        %FPT_INT (uentry=intent);
       69     6611        dcl intent entry async;
       70     6612        */
       71     6613
       72     6614        %RCODE (STCLASS=STATIC SYMDEF);
       73     6617    1   DCL CODE UBIN(36);
       74     6618    1   DCL LOPT_OVER UBIN HALF CONSTANT INIT(%FTP_OPT_OVER);
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:3    
       75     6619    1   DCL CMD_LCN SBIN(36) SYMREF;
       76     6620    1   DCL DATA_LCN SBIN(36) SYMREF;
       77     6621    1   DCL RUNNING BIT(1) SYMREF;
       78     6622    1   DCL FTP_NODES UBIN(36) SYMREF;
       79     6623        %TCP$SOCKET (NAME=CMD_FS, STCLASS="SYMREF");
       80     6631    1   DCL CMD_BUFFER CHAR(4096) SYMREF;
       81     6632    1   DCL LINE_BUF REDEF CMD_BUFFER CHAR(4096);
       82     6633        %TCP$SOCKET (NAME=CMD_LS, STCLASS="SYMREF");
       83     6641        %TCP$CB (NAME=CB, STCLASS=STATIC);
       84     6644        %TCP$ADMIN (STCLASS=BASED);
       85     6665    1   DCL M$LO DCB;
       86     6666    1   DCL SPACE CHAR(1) CONSTANT INIT(' ');
       87     6667    1   DCL GLOBAL_ERR UBIN(36) STATIC SYMDEF;
       88     6668    1   DCL 1 TFID STATIC,
       89     6669    1             2 COUNT UBIN(9) CALIGNED,
       90     6670    1             2 TEXT CHAR(79);
       91     6671
       92     6672    1   DCL 1 TEXTC BASED,
       93     6673    1             2 COUNT UBIN(9) CALIGNED,
       94     6674    1             2 TEXT CHAR(TEXTC.COUNT);
       95     6675
       96     6676    1   DCL CHARN CHAR(CHARNLEN) BASED;
       97     6677    1   DCL CHARNLEN UBIN(36) STATIC;
       98     6678    1   DCL START_TIME UBIN(36) STATIC;
       99     6679    1   DCL BYTES UBIN(36) STATIC;
      100     6680    1   DCL TSTAMP UBIN(36) STATIC;
      101     6681        %FPT_TIME (SOURCE=CLOCK, TSTAMP=TSTAMP, DEST=TUN);
      102     6700        %FPT_WRITE (FPTN=WRITE_LO,
      103     6701                STCLASS=SYMREF);
      104     6732    1   DCL TMPC CHAR(1) STATIC;
      105     6733
      106     6734    1   DCL F$FILE DCB;
      107     6735    1   DCL F$FILE$ PTR STATIC;
      108     6736    1   DCL M$MFILE DCB;
      109     6737        %FPT_OPEN (
      110     6738                ACS=SEQUEN,
      111     6739                ACCT=VLP_ACCT,
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:4    
      112     6740                DCB=F$FILE,
      113     6741                SCRUB=YES,
      114     6742                REASSIGN=YES,
      115     6743                DISP=NAMED,
      116     6744                NAME=VLP_NAME,
      117     6745                PASS=VLP_PASS,
      118     6746                SN=VLP_SN,
      119     6747                WSN=VLP_WSN);
      120     6856        %VLP_ACCT;
      121     6869        %VLP_NAME;
      122     6896        %VLP_PASS;
      123     6909        %VLP_SN;
      124     6922        %VLP_WSN;
      125     6935
      126     6936        %FPT_FID (ACCT=VLP_ACCT,
      127     6937                ASN=FPT_OPEN.V.ASN#,
      128     6938                NAME=VLP_NAME,
      129     6939                PASS=VLP_PASS,
      130     6940                RES=FPT_OPEN.V.RES#,
      131     6941                SN=VLP_SN,
      132     6942                WSN=VLP_WSN);
      133     6965
      134     6966        %FPT_WRITE (DCB=F$FILE);
      135     6997        %FPT_READ (DCB=F$FILE, BUF=LINE_BUF, FULL=YES);
      136     7036        %FPT_CLOSE (DCB=F$FILE, DISP=SAVE, STCLASS=CONSTANT);
      137     7078        %FPT_CLOSE (DCB=F$FILE, FPTN=FPT_NSAVE, STCLASS=CONSTANT);
      138     7120
      139     7121    1   DCL FILE_TYPE UBIN(36) STATIC INIT(%FTP_OPT_ASCII);
      140     7122    1   DCL PASV SBIN STATIC INIT(0);
      141     7123    1   DCL BELL STATIC SYMDEF BIT(36) INIT('0'B);
      142     7124    1   DCL TOGOPTS(0:0) REDEF BELL BIT(36);
      143     7125    1   DCL DEBUG STATIC SYMDEF BIT(36) INIT('0'B);
      144     7126    1   DCL HASH STATIC SYMDEF BIT(36) INIT('0'B);
      145     7127    1   DCL DFLPASV STATIC SYMDEF SBIN INIT(0);
      146     7128    1   DCL SENDPORT STATIC SYMDEF BIT(36) INIT('777777777777'O);
      147     7129    1   DCL VERBOSE STATIC SYMDEF BIT(36) INIT('777777777777'O);
      148     7130    1   DCL MPROMPT STATIC SYMDEF BIT(36) INIT('0'B);
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:5    
      149     7131    1   DCL TOGTXT(0:6) CONSTANT CHAR(16) INIT(
      150     7132    1       'Bell mode .',
      151     7133    1       'Debug mode .',
      152     7134    1       'Hash marks (4k) ',
      153     7135    1       'PASV commands .',
      154     7136    1       'PORT commands .',
      155     7137    1       'Verbose mode .',
      156     7138    1       'Prompt mode .');
      157     7139        %TCP$SOCKET (NAME=DATA_FS, STCLASS=STATIC);
      158     7147        %TCP$SOCKET (NAME=DATA_LS, STCLASS=STATIC);
      159     7155
      160     7156    1   DCL MSG_UNIMP CHAR(0) CONSTANT INIT('Unimplemented command.');
      161     7157    1   DCL MSG_TYPE_ASCII CHAR(0) CONSTANT INIT('Type is ASCII.');
      162     7158    1   DCL MSG_TYPE_IMAGE CHAR(0) CONSTANT INIT('Type is IMAGE.');
      163     7159    1   DCL MSG_NOT_CONNECTED CHAR(0) CONSTANT INIT('Not connected.');
      164     7160    1   DCL MSG_USE_CLOSE CHAR(0) CONSTANT INIT('Already connected, use close first.');
      165     7161
      166     7162
      167     7163    1      TCP_MON_ERR = '0'B;
      168     7164    1      REMEMBER NO_CHANGE IN BREAK_MEM;
      169     7165    2      DO INHIBIT;
      170     7166    2          CALL XUG$CLRENABLE(XUG_GETCMD);
      171     7167    2          CALL XUG$DISABLE(XUG_GETCMD);
      172     7168    2          END;
      173     7169    1      GLOBAL_ERR = 0;
      174     7170    2      CALL XUG$GETCMD (XUG_GETCMD) WHENALTRETURN DO;
      175     7171    2          CALL M$XXX;
      176     7172    2          END;
      177     7173
      178     7174    1      XUG_GETCMD.TEXT_=VECTOR(NIL);
      179     7175    1      IF XUG_GETCMD.OUT$ = ADDR(NIL) THEN RETURN;
      180     7176
      181     7177    1      PARSE$ = XUG_GETCMD.OUT$->OUT$BLK.SUBLK$(0);
      182     7178    1      CODE =  OUT$BLK.CODE;
      183     7179    2      IF CODE = %FTP_CMD_EXIT THEN DO;
      184     7180    2          RUNNING = '0'B;
      185     7181    2          IF CMD_LCN < 0 THEN RETURN;
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:6    
      186     7182    2          CODE = %FTP_CMD_CLOSE;
      187     7183    2          END;
      188     7184    2      DO INHIBIT;
      189     7185    2          CALL XUG$CLRENABLE(XUG_GETCMD); /* Ignore breaks during input */
      190     7186    2          CALL XUG$DISABLE(XUG_GETCMD);
      191     7187    2          END;
      192     7188
      193     7189    1      IF CMD_LCN < 0 AND CODE ~= %FTP_CMD_CONNECT AND CODE ~= %FTP_CMD_TYPE
      194     7190    1        AND CODE ~= %FTP_CMD_TOGGLE AND CODE ~= %FTP_CMD_STATUS
      195     7191    2      THEN DO;
      196     7192    2          WRITE_LO.BUF_ = VECTOR(MSG_NOT_CONNECTED);
      197     7193    2          CALL M$WRITE(WRITE_LO);
      198     7194    2          RETURN;
      199     7195    2          END;
      200     7196
      201     7197    2      DO CASE (CODE);
      202     7198    2       CASE (%FTP_CMD_LIST);
      203     7199    2          CALL LIST_CMD('LIST');
      204     7200
      205     7201    2       CASE (%FTP_CMD_LS);
      206     7202    2          CALL LIST_CMD('NLST');
      207     7203
      208     7204    2       CASE (%FTP_CMD_RHELP);
      209     7205    2          IF OUT$BLK.NSUBLKS=0 THEN CALL SIMPLE_CMD('HELP');
      210     7206    2          ELSE CALL SIMPLE_CMD('HELP', OUT$BLK.SUBLK$(0)->OUT$SYM.COUNT);
      211     7207
      212     7208    2       CASE (%FTP_CMD_CONNECT);
      213     7209    3          IF CMD_LCN >= 0 THEN DO;
      214     7210    3              WRITE_LO.BUF_ = VECTOR(MSG_USE_CLOSE);
      215     7211    3              CALL M$WRITE (WRITE_LO);
      216     7212    3              RETURN;
      217     7213    3              END;
      218     7214    3          CALL GET_CONNECTED(OUT$BLK) WHENALTRETURN DO;
      219     7215    3              CALL REPORT_TCP;
      220     7216    3              CALL TCP$RELEASE(CMD_LCN);
      221     7217    3              CMD_LCN = -1;
      222     7218    3              RETURN;
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:7    
      223     7219    3              END;
      224     7220    2          IF FILE_TYPE~=%FTP_OPT_ASCII THEN CALL TYPE_CMD('I');
      225     7221
      226     7222    2       CASE (%FTP_CMD_USER);
      227     7223    2          CALL GET_USER(OUT$BLK);  /*N* ALTRET */
      228     7224
      229     7225    2       CASE (%FTP_CMD_CLOSE);
      230     7226    2          CALL SIMPLE_CMD ('QUIT');
      231     7227    2   DISCONNECTED: ;
      232     7228    2          RCODE = '0'B; /* Dont loop on a 421 error code */
      233     7229    2          CALL GET_CLOSE(CMD_LCN);
      234     7230    2          CMD_LCN = -1;
      235     7231    2          PASV = DFLPASV;
      236     7232
      237     7233    2       CASE (%FTP_CMD_RDIR);
      238     7234    2          IF OUT$BLK.NSUBLKS=0 THEN CALL SIMPLE_CMD('CDUP');
      239     7235    2          ELSE CALL SIMPLE_CMD('CWD ',OUT$BLK.SUBLK$(0)->OUT$SYM.COUNT);
      240     7236
      241     7237    2       CASE (%FTP_CMD_PWD);
      242     7238    2          CALL SIMPLE_CMD('PWD ');
      243     7239
      244     7240    2       CASE (%FTP_CMD_DELETE);
      245     7241    2          CALL SIMPLE_CMD('DELE',OUT$BLK.SUBLK$(0)->OUT$SYM.COUNT);
      246     7242
      247     7243    2       CASE (%FTP_CMD_QUOTE);
      248     7244    2          IF OUT$BLK.SUBLK$(0)->OUT$SYM.COUNT>0
      249     7245    3          THEN DO;
      250     7246    3              CALL TCP$WRITE_D (CMD_LCN, VECTOR(OUT$BLK.SUBLK$(0)->OUT$SYM.TEXT));
      251     7247    3              CALL TELNET_EOL (CMD_LCN);
      252     7248    3              END;
      253     7249    2          CALL GET_RESPONSE (CMD_LCN,RCODE,'1'B);
      254     7250
      255     7251    2       CASE (%FTP_CMD_RENAME);
      256     7252    2          CALL SIMPLE_CMD('RNFR',OUT$BLK.SUBLK$(0)->OUT$SYM.COUNT);
      257     7253    2          IF RCODE.A ~= '3' THEN EXIT;
      258     7254    2          CALL SIMPLE_CMD('RNTO',OUT$BLK.SUBLK$(OUT$BLK.NSUBLKS-1)->OUT$SYM.COUNT);
      259     7255
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:8    
      260     7256    2       CASE (%FTP_CMD_GET);
      261     7257    2          IF OUT$BLK.NSUBLKS =1    /* No local fid */
      262     7258    3          THEN DO;
      263     7259    3              CALL LINE_SUB(OUT$BLK.SUBLK$(0)->OUT$SYM.COUNT);
      264     7260    3              CALL GET_CMD(OUT$BLK.SUBLK$(0)->OUT$SYM.COUNT,
      265     7261    3                    LOPT_OVER, TFID);
      266     7262    3              END;
      267     7263    2          ELSE CALL GET_CMD(OUT$BLK.SUBLK$(0)->OUT$SYM.COUNT,
      268     7264    2                    OUT$BLK.SUBLK$(1)->OUT$BLK.CODE,
      269     7265    2                    OUT$BLK.SUBLK$(2)->OUT$SYM.COUNT);
      270     7266
      271     7267    2       CASE (%FTP_CMD_PUT);
      272     7268    2          IF OUT$BLK.NSUBLKS = 2   /* No remote fid */
      273     7269    3          THEN DO;
      274     7270    3              CALL LINE_SUB(OUT$BLK.SUBLK$(0)->OUT$SYM.COUNT);
      275     7271    3              CALL PUT_CMD(OUT$BLK.SUBLK$(0)->OUT$SYM.COUNT,
      276     7272    3                    OUT$BLK.SUBLK$(1)->OUT$BLK.CODE,
      277     7273    3                    TFID);
      278     7274    3              END;
      279     7275    2          ELSE CALL PUT_CMD(OUT$BLK.SUBLK$(0)->OUT$SYM.COUNT,
      280     7276    2                    OUT$BLK.SUBLK$(1)->OUT$BLK.CODE,
      281     7277    2                    OUT$BLK.SUBLK$(2)->OUT$SYM.COUNT);
      282     7278
      283     7279    2       CASE (%FTP_CMD_MGET, %FTP_CMD_MPUT, %FTP_CMD_MDEL);
      284     7280    2          CALL MFILE_CMD;
      285     7281
      286     7282    2       CASE (%FTP_CMD_STATUS);
      287     7283    3          DO CODE=0 TO SIZEW(TOGTXT)/SIZEW(TOGTXT(0))-1;
      288     7284    3              CALL DISP_TOGGLE;
      289     7285    3              END;
      290     7286    2          GOTO DISP_TYPE;
      291     7287
      292     7288    2       CASE (%FTP_CMD_TOGGLE);
      293     7289    2          CODE = OUT$BLK.SUBLK$(0)->OUT$BLK.CODE;
      294     7290    2          TOGOPTS( CODE) = ~TOGOPTS( CODE);
      295     7291    2          IF CODE = %FTP_OPT_PASV THEN PASV = BITBIN( TOGOPTS( CODE));
      296     7292    2          CALL DISP_TOGGLE;
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:9    
      297     7293
      298     7294    2       CASE (%FTP_CMD_TYPE);
      299     7295    2          IF OUT$BLK.NSUBLKS = 0   /* No options, display current */
      300     7296    3          THEN DO;
      301     7297    3   DISP_TYPE: ;
      302     7298    3              IF FILE_TYPE = %FTP_OPT_ASCII THEN
      303     7299    3                  WRITE_LO.BUF_ = VECTOR(MSG_TYPE_ASCII);
      304     7300    3              ELSE WRITE_LO.BUF_ = VECTOR(MSG_TYPE_IMAGE);
      305     7301    3              CALL M$WRITE (WRITE_LO);
      306     7302    3              RETURN;
      307     7303    3              END;
      308     7304    2          IF CMD_LCN>=0 /* Just change type if not connected */
      309     7305    2          THEN IF OUT$BLK.SUBLK$(0)->OUT$SYM.CODE = %FTP_OPT_ASCII
      310     7306    2          THEN CALL TYPE_CMD('A') ALTRET(NO_CHANGE);
      311     7307    2          ELSE CALL TYPE_CMD('I') ALTRET(NO_CHANGE);
      312     7308    2          FILE_TYPE = OUT$BLK.SUBLK$(0)->OUT$SYM.CODE;
      313     7309    2   NO_CHANGE: ;
      314     7310
      315     7311    2       CASE(ELSE);
      316     7312    2          WRITE_LO.BUF_ = VECTOR(MSG_UNIMP);
      317     7313    2          CALL M$WRITE (WRITE_LO);
      318     7314    2          END;                             /* Do case */
      319     7315
      320     7316        /*N* IF BATCH AND GLOBAL_ERR ~= 0 THEN ABORT */
      321     7317    1      IF RCODE = '064062061'O THEN /* 421 response means it's all over */
      322     7318    1          GOTO DISCONNECTED;
      323     7319
      324     7320
      325     7321    1      RETURN;
      326     7322        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:10   
      327     7323    1   FTPCMD_INIT: ENTRY ALTRET;
      328     7324    1      F$FILE$ = DCBADDR(DCBNUM(F$FILE));
      329     7325    2      CALL XUG$INIT (XUG_GETCMD, XUG_INIT) WHENALTRETURN DO;
      330     7326    2          CALL M$XXX;
      331     7327    2          END;
      332     7328    1      CALL M$INT(FPT_INT);
      333     7329    2      DO INHIBIT;
      334     7330    2          CALL XUG$CLRENABLE(XUG_GETCMD);
      335     7331    2          CALL XUG$DISABLE(XUG_GETCMD);
      336     7332    2          END;
      337     7333    1      SUBSTR(LINE_BUF,3000)=B$JIT.CCBUF; /* check for hostname on command line */
      338     7334    1      CALL INDEX(CODE,' ',LINE_BUF,3000);
      339     7335    2      IF SUBSTR(LINE_BUF,CODE)~=' ' THEN DO;
      340     7336    2          SUBSTR(LINE_BUF,3000,CODE-3000)='OPEN';
      341     7337    2          XUG_GETCMD.TEXT_=VECTOR(SUBSTR(LINE_BUF,3000,200));
      342     7338    2          END;
      343     7339    1      RETURN;
      344     7340
      345     7341    1   FTPBREAK: ENTRY ALTRET;
      346     7342    1      CALL XUG$DISABLE(XUG_GETCMD);
      347     7343    1      UNWIND TO BREAK_MEM;
      348     7344
      349     7345    1   SETBREAK: PROC ALTRET; /* Routine to overcome PL-6'S internal procs problem */
      350     7346    2   DCL P$ PTR;
      351     7347    2   DCL HW UBIN(18) BASED ALIGNED;
      352     7348    2      P$ = ADDR(BREAK_MEM);
      353     7349    2      ADDR(P$)->HW = PINCRW(ADDR(P$),-1)->HW; /* Point to ALTRET instruction */
      354     7350    2      PINCRW(ADDR(BREAK_MEM),1)->HW = P$->HW; /* Set unwind addr to altret addr */
      355     7351    2      CALL XUG$ENABLE(XUG_GETCMD);
      356     7352    2   END SETBREAK;
      357     7353
      358     7354        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:11   
      359     7355    1   TYPE_CMD: PROC (CMDO) ALTRET;
      360     7356    2   DCL CMDO CHAR(1);
      361     7357    2   DCL CMDT CHAR(0) CONSTANT INIT('TYPE ');
      362     7358
      363     7359    2      CALL TCP$WRITE_D (CMD_LCN, VECTOR(CMDT));
      364     7360    2      CALL TCP$WRITE_D (CMD_LCN, VECTOR(CMDO));
      365     7361    2      CALL TELNET_EOL(CMD_LCN);
      366     7362    3      CALL GET_RESPONSE(CMD_LCN,RCODE,VERBOSE) WHENALTRETURN DO;
      367     7363    3          GLOBAL_ERR = %FTP_PROCEDURE_ERR;              /*N* REPORT ERROR */
      368     7364    3          ALTRETURN;
      369     7365    3          END;
      370     7366    2      IF RCODE.A ~= '2'
      371     7367    3      THEN DO;
      372     7368    3          GLOBAL_ERR=1;
      373     7369    3          ALTRETURN;
      374     7370    3          END;
      375     7371    2      RETURN;
      376     7372    2   END TYPE_CMD;
      377     7373
      378     7374
      379     7375    1   DISP_TOGGLE: PROC;
      380     7376
      381     7377    2      SUBSTR( LINE_BUF,0,20) = TOGTXT( CODE);
      382     7378    2      IF (TOGOPTS( CODE) = '0'B) = (CODE = %FTP_OPT_PASV)
      383     7379    2      THEN SUBSTR( LINE_BUF,20,4) = 'on.';
      384     7380    2      ELSE SUBSTR( LINE_BUF,20,4) = 'off.';
      385     7381    2      CALL INDEX (BYTES, '.', SUBSTR( LINE_BUF,0,16));
      386     7382    2      SUBSTR( LINE_BUF,BYTES,4) = SUBSTR( LINE_BUF,20,4);
      387     7383    2      WRITE_LO.BUF_ = VECTOR( SUBSTR( LINE_BUF,0,20));
      388     7384    2      CALL M$WRITE( WRITE_LO);
      389     7385    2   END DISP_TOGGLE;
      390     7386        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:12   
      391     7387    1   MFILE_CMD: PROC;
      392     7388        %FPT_OPEN (DCB=M$MFILE, FPTN=OPNSCRATCH,
      393     7389                   STCLASS=CONSTANT, DISP=SCRATCH, ASN=FILE, SCRUB=YES, FUN=CREATE);
      394     7498        %FPT_OPEN (DCB=M$MFILE, FPTN=OPNSTAR,
      395     7499                   STCLASS=CONSTANT, NAME=STARFTP, ASN=FILE, SCRUB=YES);
      396     7608        %VLP_NAME (FPTN=STARFTP, NAME='*ftp', STCLASS=CONSTANT);
      397     7635        %FPT_CLOSE (DCB=M$MFILE, STCLASS=CONSTANT);
      398     7677    2   DCL 1 NAMBUF STATIC,
      399     7678    2      2 COUNT UBIN BYTE UNAL,
      400     7679    2      2 TEXT CHAR(255);
      401     7680        %FPT_READ (DCB=M$MFILE, STCLASS=CONSTANT, BUF=NAMBUF.TEXT);
      402     7719    2   DCL SAVERBOSE BIT(36);
      403     7720        %FPT_LINK (STCLASS=CONSTANT, NAME=VLP_PCL, ACCT=VLP_SYS, CMD=NAMBUF);
      404     7738        %VLP_NAME (FPTN=VLP_PCL, STCLASS=CONSTANT, NAME='PCL');
      405     7765        %VLP_ACCT (FPTN=VLP_SYS, STCLASS=CONSTANT, ACCT=':SYS');
      406     7778        %FPT_PROMPT (FPTN=TFIDPROMPT, PROMPT=TFID.TEXT);
      407     7806        %FPT_READ (FPTN=TFIDREAD, DCB=M$UC, BUF=TFID.TEXT);
      408     7845
      409     7846    2      SAVERBOSE=VERBOSE;
      410     7847    3      IF CODE=%FTP_CMD_MPUT THEN DO;
      411     7848    3          NAMBUF.COUNT=255;
      412     7849    3          NAMBUF.TEXT='L(C=0,FF)';
      413     7850    3          IF OUT$BLK.NSUBLKS>0
      414     7851    3          THEN SUBSTR(NAMBUF.TEXT,9)=OUT$BLK.SUBLK$(0)->OUT$SYM.TEXT;
      415     7852    3          SUBSTR(NAMBUF.TEXT,240)=' OVER *ftp(nsu)';
      416     7853    3          CALL M$LINK (FPT_LINK) ALTRET (RETRET);
      417     7854    4          CALL M$OPEN (OPNSTAR) WHENALTRETURN DO;
      418     7855    4   REPALT:    CALL REPORT_ALT;
      419     7856    4   RETRET:    VERBOSE=SAVERBOSE;
      420     7857    4              CALL M$CLOSE (FPT_CLOSE);
      421     7858    4              RETURN;
      422     7859    4              END;
      423     7860    3          END;
      424     7861    3      ELSE DO;
      425     7862    3          CALL M$OPEN (OPNSCRATCH) ALTRET (REPALT);
      426     7863    3          VERBOSE='0'B;
      427     7864    3          CALL LIST_CMD ('NLST') ALTRET (RETRET);
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:13   
      428     7865    3          VERBOSE=SAVERBOSE;
      429     7866    3          CALL M$REW (FPT_CLOSE);
      430     7867    3          END;
      431     7868
      432     7869    3      DO WHILE '1'B;
      433     7870    3   NXTNAM: ;
      434     7871    3          CALL SETBREAK ALTRET(RETRET);
      435     7872    3          CALL M$READ (FPT_READ) ALTRET (RETRET);
      436     7873    3          CALL XUG$DISABLE(XUG_GETCMD);
      437     7874    3          NAMBUF.COUNT=DCBADDR(DCBNUM(M$MFILE))->F$DCB.ARS#;
      438     7875    3          TFID.COUNT=0;
      439     7876    4          IF MPROMPT AND B$JIT.MODE=%M_INT# THEN DO;
      440     7877    4              TFID=NAMBUF;
      441     7878    4              SUBSTR(TFID.TEXT,TFID.COUNT)='? (n/q/newname)';
      442     7879    4              VBOUND(TFIDPROMPT.PROMPT_)=TFID.COUNT+14;
      443     7880    5              IF CODE=%FTP_CMD_MDEL THEN DO; /* no "newname" for mdel */
      444     7881    5                  SUBSTR(TFID.TEXT,TFID.COUNT)='? (n/q)';
      445     7882    5                  VBOUND(TFIDPROMPT.PROMPT_)=TFID.COUNT+6;
      446     7883    5                  END;
      447     7884    4              CALL M$PROMPT (TFIDPROMPT);
      448     7885    5              CALL M$READ (TFIDREAD) WHENALTRETURN DO; END;
      449     7886    4              TFID.COUNT=DCBADDR(DCBNUM(M$UC))->F$DCB.ARS#;
      450     7887    4              IF TFID.COUNT=0 THEN EXIT;
      451     7888    4              IF TFID.COUNT=1 THEN IF SUBSTR(TFID.TEXT,0,1)='q'
      452     7889    4                OR SUBSTR(TFID.TEXT,0,1)='Q' THEN GOTO RETRET;
      453     7890    4              ELSE IF SUBSTR(TFID.TEXT,0,1)='n'
      454     7891    4                OR SUBSTR(TFID.TEXT,0,1)='N' THEN GOTO NXTNAM;
      455     7892    4              ELSE TFID.COUNT=0;
      456     7893    4              END;
      457     7894    3          IF CODE=%FTP_CMD_MDEL THEN CALL SIMPLE_CMD ('DELE', NAMBUF);
      458     7895    3          ELSE IF CODE=%FTP_CMD_MPUT
      459     7896    3          THEN CALL PUT_CMD (NAMBUF, LOPT_OVER, TFID);
      460     7897    3          ELSE IF CODE~=%FTP_CMD_MGET THEN GOTO RETRET; /* Break hit */
      461     7898    4          ELSE DO;
      462     7899    5              IF SUBSTR(NAMBUF.TEXT,0,2)='./' THEN DO;
      463     7900    5                  NAMBUF.TEXT=SUBSTR(NAMBUF.TEXT,2);
      464     7901    5                  NAMBUF.COUNT=NAMBUF.COUNT-2;
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:14   
      465     7902    5                  END;
      466     7903    4              IF TFID.COUNT=0 THEN CALL LINE_SUB (NAMBUF);
      467     7904    4              CALL GET_CMD (NAMBUF, LOPT_OVER, TFID);
      468     7905    4              END;
      469     7906    3          END;
      470     7907    2   END MFILE_CMD;
      471     7908        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:15   
      472     7909    1   LIST_CMD: PROC (CMDT) ALTRET;
      473     7910    2   DCL CMDT CHAR(4);
      474     7911    2   DCL OK BIT(1) STATIC;
      475     7912    2   DCL ARS UBIN(36) STATIC;
      476     7913
      477     7914    2      GLOBAL_ERR = 0;
      478     7915    3      IF OUT$BLK.NSUBLKS=3 THEN DO;
      479     7916    3          CALL GET_CMD (,OUT$BLK.SUBLK$(1)->OUT$BLK.CODE,
      480     7917    4            OUT$BLK.SUBLK$(2)->OUT$SYM.COUNT) WHENALTRETURN DO; ALTRETURN; END;
      481     7918    3          WRITE_DATA.V.DCB# = DCBNUM(F$FILE);
      482     7919    3          END;
      483     7920    2      ELSE IF CODE=%FTP_CMD_MGET OR CODE=%FTP_CMD_MDEL
      484     7921    2      THEN WRITE_DATA.V.DCB# = DCBNUM(M$MFILE);
      485     7922    2      ELSE WRITE_DATA.V.DCB# = DCBNUM(M$LO);
      486     7923
      487     7924    2      IF FILE_TYPE ~= %FTP_OPT_ASCII THEN CALL TYPE_CMD('A');
      488     7925
      489     7926    2      CALL OPEN_DATA_PORT ALTRET(RETALT);
      490     7927
      491     7928    2      CALL TCP$WRITE_D (CMD_LCN, VECTOR(CMDT));
      492     7929    2      IF OUT$BLK.NSUBLKS~=0
      493     7930    3      THEN DO;
      494     7931    3          CALL TCP$WRITE_D (CMD_LCN, VECTOR(SPACE));
      495     7932    3          CALL TCP$WRITE_D
      496     7933    3           (CMD_LCN, VECTOR(OUT$BLK.SUBLK$(0)->OUT$SYM.TEXT));
      497     7934    3          END;
      498     7935    2      CALL TELNET_EOL(CMD_LCN);
      499     7936    2      CALL GET_RESPONSE(CMD_LCN,RCODE,VERBOSE) ALTRET(RETALT);
      500     7937
      501     7938    2      IF RCODE.A ~= '1'
      502     7939    3      THEN DO;
      503     7940    3          GLOBAL_ERR=1;
      504     7941    3          CALL TCP$RELEASE(DATA_LCN);
      505     7942    3          END;
      506     7943    3      ELSE DO;
      507     7944                                                /* Read list until it closes */
      508     7945                                                /* First, get open */
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:16   
      509     7946    4          CALL GET_OPEN(DATA_LCN,%TIMEOUT) WHENALTRETURN DO;
      510     7947    4              CALL TCP$RELEASE(DATA_LCN);
      511     7948    4              GOTO RETALT;
      512     7949    4              END;
      513     7950    3          OK='1'B;
      514     7951    4          DO WHILE OK;
      515     7952    4              CALL GET_LINE(DATA_LCN, VECTOR(LINE_BUF), ARS)
      516     7953    5              WHENRETURN DO;
      517     7954                                                /* Print it */
      518     7955    5                  CHARNLEN=ARS-2;          /* Don't include crlf*/
      519     7956    5                  IF CHARNLEN=0
      520     7957    6                  THEN DO;
      521     7958    6                      CHARNLEN=1;
      522     7959    6                      LINE_BUF = ' ';
      523     7960    6                      END;
      524     7961    5                  WRITE_DATA.BUF_ = VECTOR(ADDR(LINE_BUF)->CHARN);
      525     7962    5                  CALL M$WRITE (WRITE_DATA);
      526     7963    5                  END;
      527     7964    5              WHENALTRETURN DO;
      528     7965    5                  OK='0'B;
      529     7966    5                  END;
      530     7967    4              END;
      531     7968    3          CALL GET_CLOSE(DATA_LCN,%TIMEOUT);
      532     7969    4          CALL GET_RESPONSE(CMD_LCN,RCODE,VERBOSE) WHENRETURN DO;
      533     7970    4              IF RCODE.A ~= '2' THEN GLOBAL_ERR=1;
      534     7971    4              END;
      535     7972    4          WHENALTRETURN DO;
      536     7973    4   RETALT:    GLOBAL_ERR = %FTP_PROCEDURE_ERR;             /*N* REPORT ERROR */
      537     7974    4              END;
      538     7975    3          IF WRITE_DATA.V.DCB# = DCBNUM(F$FILE)
      539     7976    3          THEN IF GLOBAL_ERR = 0 THEN CALL M$CLOSE (FPT_CLOSE);
      540     7977    3          ELSE CALL M$CLOSE (FPT_NSAVE);
      541     7978    3          IF FILE_TYPE ~= %FTP_OPT_ASCII THEN CALL TYPE_CMD('I');
      542     7979    3          IF GLOBAL_ERR ~= 0 THEN ALTRETURN;
      543     7980
      544     7981    3          END;
      545     7982
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:17   
      546     7983    2      RETURN;
      547     7984    2   END LIST_CMD;
      548     7985        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:18   
      549     7986    1   SIMPLE_CMD: PROC (CMDT,TEXTC) ALTRET;
      550     7987    2   DCL CMDT CHAR(4) ALIGNED;
      551     7988    2   DCL 1 TEXTC ALIGNED,2 COUNT UBIN BYTE UNAL,2 TEXT CHAR(TEXTC.COUNT);
      552     7989    2   DCL V_PTR$ PTR;
      553     7990    2   DCL V_FLAG BASED(V_PTR$) ALIGNED BIT(1);
      554     7991
      555     7992    2      IF SUBSTR(CMDT,3,1) ~= ' ' THEN CALL TCP$WRITE_D (CMD_LCN, VECTOR(CMDT));
      556     7993    2      ELSE CALL TCP$WRITE_D (CMD_LCN, VECTOR(SUBSTR(CMDT,0,3)));
      557     7994    3      IF ADDR(TEXTC) ~= ADDR(NIL) THEN DO;
      558     7995    3          CALL TCP$WRITE_D (CMD_LCN, VECTOR(SPACE));
      559     7996    3          CALL TCP$WRITE_D (CMD_LCN, VECTOR(TEXTC.TEXT));
      560     7997    3          END;
      561     7998    2      CALL TELNET_EOL(CMD_LCN);
      562     7999    2      V_PTR$ = ADDR(VERBOSE);
      563     8000    2      IF CODE = %FTP_CMD_RHELP OR CODE = %FTP_CMD_PWD
      564     8001    2      THEN V_PTR$ = ADDR(RUNNING);
      565     8002    3      CALL GET_RESPONSE(CMD_LCN,RCODE,V_FLAG) WHENALTRETURN DO;
      566     8003    3          GLOBAL_ERR = %FTP_PROCEDURE_ERR;              /*N* REPORT ERROR */
      567     8004    3          ALTRETURN;
      568     8005    3          END;
      569     8006    2      IF RCODE.A ~= '2' THEN GLOBAL_ERR = %FTP_COMMAND_ERR;
      570     8007
      571     8008    2      RETURN;
      572     8009    2   END SIMPLE_CMD;
      573     8010        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:19   
      574     8011    1   GET_CMD: PROC (RFID,ONOVER,LFID) ALTRET;
      575     8012    2   DCL 1 RFID ALIGNED,2 COUNT UBIN BYTE UNAL,2 TEXT CHAR(RFID.COUNT);
      576     8013    2   DCL ONOVER UBIN HALF HALIGNED;
      577     8014    2   DCL 1 LFID ALIGNED,2 COUNT UBIN BYTE UNAL,2 TEXT CHAR(LFID.COUNT);
      578     8015    2   DCL CMDT CHAR(0) STATIC INIT('RETR ');
      579     8016    2   DCL OK BIT(1) STATIC;
      580     8017    2   DCL ARS UBIN(36) STATIC;
      581     8018    2   DCL CURSIZ SBIN;
      582     8019
      583     8020        /* First, validate local fid */
      584     8021
      585     8022    2      FPT_FID.TEXTFID_ = VECTOR(LFID.TEXT);
      586     8023    3      CALL M$FID(FPT_FID) WHENALTRETURN DO;
      587     8024    3   REPALT: ;
      588     8025    3          CALL REPORT_ALT;
      589     8026    3          GLOBAL_ERR = %FTP_COMMAND_ERR;
      590     8027    3          ALTRETURN;
      591     8028    3          END;
      592     8029
      593     8030    2      IF ONOVER = %FTP_OPT_ON
      594     8031    3      THEN DO;
      595     8032    3          FPT_OPEN.V.FUN# = %CREATE#;
      596     8033    3          FPT_OPEN.V.EXIST# = %ERROR#;
      597     8034    3          END;
      598     8035    2      ELSE IF ONOVER = %FTP_OPT_OVER
      599     8036    3          THEN DO;
      600     8037    3              FPT_OPEN.V.FUN# = %CREATE#;
      601     8038    3              FPT_OPEN.V.EXIST# = %NEWFILE#;
      602     8039    3              END;
      603     8040    2          ELSE IF ONOVER = %FTP_OPT_INTO
      604     8041    3              THEN DO;
      605     8042    3                  FPT_OPEN.V.FUN# = %CREATE#;
      606     8043    3                  FPT_OPEN.V.EXIST# = %OLDFILE#;
      607     8044    3                  END;
      608     8045    2              ELSE CALL M$XXX;             /* Internal error */
      609     8046
      610     8047    2      CALL M$OPEN (FPT_OPEN) ALTRET (REPALT);
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:20   
      611     8048
      612     8049    2      IF ADDR(RFID) = ADDR(NIL) THEN RETURN; /* Called from LIST_CMD */
      613     8050
      614     8051    2      ARS = F$FILE$->F$DCB.RECL#;
      615     8052    2      CHARNLEN = 0;
      616     8053    2      CURSIZ = 0;
      617     8054    2      FPT_WRITE.BUF_.BUF$ = ADDR(LINE_BUF);
      618     8055
      619     8056
      620     8057    3      CALL OPEN_DATA_PORT WHENALTRETURN DO;
      621     8058    3   REMLOCAL: ;
      622     8059    3          GLOBAL_ERR = %FTP_PROCEDURE_ERR;
      623     8060    3          CALL M$CLOSE (FPT_NSAVE);
      624     8061    3          ALTRETURN;
      625     8062    3          END;
      626     8063
      627     8064    2      CALL TCP$WRITE_D (CMD_LCN, VECTOR(CMDT));
      628     8065    2      CALL TCP$WRITE_D (CMD_LCN, VECTOR(RFID.TEXT));
      629     8066    2      CALL TELNET_EOL(CMD_LCN);
      630     8067    2      CALL GET_RESPONSE(CMD_LCN,RCODE,VERBOSE) ALTRET (REMLOCAL);
      631     8068    2      IF RCODE.A ~= '1'
      632     8069    3      THEN DO;
      633     8070    3   RELBOTH: ;
      634     8071    3          CALL TCP$RELEASE(DATA_LCN);
      635     8072    3          GOTO REMLOCAL;
      636     8073    3          END;
      637     8074                                                /* Read file until it closes */
      638     8075    2          BYTES=0;
      639     8076                                                /* First, get open */
      640     8077    2          CALL GET_OPEN(DATA_LCN,%TIMEOUT) ALTRET (RELBOTH);
      641     8078    2          CALL SETBREAK ALTRET(GET_BREAK);
      642     8079    2          CALL M$TIME (FPT_TIME);
      643     8080    2          START_TIME=TSTAMP;
      644     8081    2          OK='1'B;
      645     8082    3          DO WHILE OK;
      646     8083    3              IF HASH THEN CALL HASH_MARKS;
      647     8084    3              IF FILE_TYPE = %FTP_OPT_ASCII
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:21   
      648     8085    4              THEN DO;
      649     8086    4                  FPT_WRITE.BUF_.BUF$ = ADDR(LINE_BUF);
      650     8087    4                  CALL GET_LINE(DATA_LCN, VECTOR(LINE_BUF), ARS)
      651     8088    5                  WHENRETURN DO;
      652     8089    5                      BYTES = BYTES + ARS-1;
      653     8090                                                /* write it */
      654     8091    5                      CHARNLEN=ARS-2;      /* Don't include crlf*/
      655     8092    5                      FPT_WRITE.V.DVBYTE.CONT# = '0'B;
      656     8093    5                      IF CHARNLEN>=SIZEV(LINE_BUF) /* No terminator ... */
      657     8094    6                      THEN DO;                    /* Use DVBYTE.CONT.  */
      658     8095    6                          BYTES = BYTES-1; /* Don't count a CR that isn't there */
      659     8096    6                          FPT_WRITE.V.DVBYTE.CONT# = '1'B;
      660     8097    6                          END;
      661     8098    5                      ELSE IF CHARNLEN<=0
      662     8099    6                      THEN DO;
      663     8100    6                          CHARNLEN=1;
      664     8101    6                          FPT_WRITE.BUF_.BUF$ = ADDR(NIL);
      665     8102    6                          END;
      666     8103    5                      END;
      667     8104    5                  WHENALTRETURN DO;
      668     8105    5                      OK='0'B;
      669     8106    5                      END;
      670     8107    4                  END;
      671     8108    4              ELSE DO;                     /* Mode is image */
      672     8109    5                  IF CHARNLEN=0 OR CHARNLEN=CB.ARS THEN DO;
      673     8110    5                      FPT_WRITE.BUF_.BUF$ = ADDR(LINE_BUF);
      674     8111    6                  CALL TCP$READ (DATA_LCN,VECTOR(LINE_BUF),CB) WHENALTRETURN DO;
      675     8112    6                      CALL REPORT_TCP;
      676     8113    6                      END;
      677     8114    5                  IF CB.ADMIN
      678     8115    6                  THEN DO;
      679     8116    6                      OK = '0'B;
      680     8117    6                      END;
      681     8118    6                  ELSE DO;
      682     8119    6                      BYTES = BYTES+CB.ARS;
      683     8120    6                      CHARNLEN=CB.ARS;
      684     8121    6                      END;
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:22   
      685     8122    5                  END; ELSE DO;
      686     8123    5                      CB.ARS = CB.ARS-CHARNLEN;
      687     8124    5                      FPT_WRITE.BUF_.BUF$ = PINCRC(FPT_WRITE.BUF_.BUF$,CHARNLEN);
      688     8125    5                      CHARNLEN = CB.ARS;
      689     8126    5                      END;
      690     8127    5                  IF ARS>0 THEN DO; /* RECL was specified, make'em all the same */
      691     8128    5                      FPT_WRITE.V.DVBYTE.CONT# = '1'B;
      692     8129    6                      IF CHARNLEN>=ARS-CURSIZ THEN DO;
      693     8130    6                           CHARNLEN = ARS-CURSIZ;
      694     8131    6                           CURSIZ = -CHARNLEN;
      695     8132    6                           FPT_WRITE.V.DVBYTE.CONT# = '0'B;
      696     8133    6                           END;
      697     8134    5                      CURSIZ = CURSIZ+CHARNLEN;
      698     8135    5                      END;
      699     8136
      700     8137    4                  END;
      701     8138
      702     8139    3              IF (OK)
      703     8140    4              THEN DO;
      704     8141    4                  FPT_WRITE.BUF_.BOUND = CHARNLEN-1;
      705     8142    5                  CALL M$WRITE (FPT_WRITE) WHENALTRETURN DO;
      706     8143    5                      CALL REPORT_ALT;
      707     8144    5   GET_BREAK:         CALL TCP$RELEASE(DATA_LCN);
      708     8145    5                      CODE = %FTP_CMD_RHELP; /* Override VERBOSE */
      709     8146    5                      CALL SIMPLE_CMD ('ABOR');
      710     8147    5                      GOTO REMLOCAL;
      711     8148    5                      END;
      712     8149    4                  END;
      713     8150    3              END;
      714     8151    2          CALL M$TIME (FPT_TIME);
      715     8152    2          START_TIME = TSTAMP-START_TIME;
      716     8153    2          CALL GET_CLOSE(DATA_LCN,%TIMEOUT);
      717     8154    3          CALL GET_RESPONSE(CMD_LCN,RCODE,VERBOSE) WHENALTRETURN DO;
      718     8155    3             CALL REPORT_TCP;
      719     8156    3              GLOBAL_ERR = %FTP_PROCEDURE_ERR;         /*N* REPORT ERROR */
      720     8157    3              CALL M$CLOSE (FPT_CLOSE);
      721     8158    3              ALTRETURN;
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:23   
      722     8159    3              END;
      723     8160    2          IF RCODE.A ~= '2' THEN GOTO REMLOCAL;
      724     8161    2          CALL REPORT_TIME(BYTES,START_TIME);
      725     8162    2          CALL M$CLOSE (FPT_CLOSE);
      726     8163
      727     8164
      728     8165    2      RETURN;
      729     8166    2   END GET_CMD;
      730     8167        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:24   
      731     8168    1   PUT_CMD: PROC (LFID,OVERINTO,RFID) ALTRET;
      732     8169    2   DCL 1 RFID ALIGNED,2 COUNT UBIN BYTE UNAL,2 TEXT CHAR(RFID.COUNT);
      733     8170    2   DCL OVERINTO UBIN HALF HALIGNED;
      734     8171    2   DCL 1 LFID ALIGNED,2 COUNT UBIN BYTE UNAL,2 TEXT CHAR(LFID.COUNT);
      735     8172    2   DCL IPSYNC CHAR(0) CONSTANT
      736     8173    2       INIT(%CONCAT(TELNET_IAC,TELNET_IP,TELNET_IAC,TELNET_DM));
      737     8174    2   DCL ABOR CONSTANT CHAR(0) INIT('ABOR');
      738     8175    2   DCL CMDT CHAR(0) STATIC INIT('STOR ');
      739     8176    2   DCL APPT CHAR(0) STATIC INIT('APPE ');
      740     8177    2   DCL CRLF CHAR(2) SYMREF;
      741     8178    2   DCL OK BIT(1) STATIC;
      742     8179    2   DCL ARS UBIN(36) STATIC;
      743     8180
      744     8181        /* First, validate local fid */
      745     8182
      746     8183    2      FPT_FID.TEXTFID_ = VECTOR(LFID.TEXT);
      747     8184    3      CALL M$FID(FPT_FID) WHENALTRETURN DO;
      748     8185    3   REPALT: ;
      749     8186    3          CALL REPORT_ALT;
      750     8187    3          GLOBAL_ERR = %FTP_COMMAND_ERR;
      751     8188    3          ALTRETURN;
      752     8189    3          END;
      753     8190
      754     8191    2      FPT_OPEN.V.FUN# = %IN#;
      755     8192    2      CALL M$OPEN (FPT_OPEN) ALTRET (REPALT);
      756     8193    2      IF RFID.COUNT = 0 THEN CALL LINE_SUB(VLP_NAME); /* Dflt mput needs xlate */
      757     8194
      758     8195
      759     8196
      760     8197    3      CALL OPEN_DATA_PORT WHENALTRETURN DO;
      761     8198    3   CLOSE_ALT: ;
      762     8199    3          GLOBAL_ERR = %FTP_PROCEDURE_ERR;
      763     8200    3          CALL M$CLOSE (FPT_CLOSE);
      764     8201    3          ALTRETURN;
      765     8202    3          END;
      766     8203
      767     8204    2      IF OVERINTO = %FTP_OPT_INTO THEN
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:25   
      768     8205    2          CALL TCP$WRITE_D (CMD_LCN, VECTOR(APPT));
      769     8206    2      ELSE
      770     8207    2          CALL TCP$WRITE_D (CMD_LCN, VECTOR(CMDT));
      771     8208    2      CALL TCP$WRITE_D (CMD_LCN, VECTOR(RFID.TEXT));
      772     8209    2      CALL TELNET_EOL(CMD_LCN);
      773     8210    2      CALL GET_RESPONSE(CMD_LCN,RCODE,VERBOSE) ALTRET (CLOSE_ALT);
      774     8211    2      IF RCODE.A ~= '1'
      775     8212    3      THEN DO;
      776     8213    3   CLREL_ALT: ;
      777     8214    3          CALL TCP$RELEASE(DATA_LCN);
      778     8215    3          GOTO CLOSE_ALT;
      779     8216    3          END;
      780     8217    3      ELSE DO;
      781     8218                                                /* Write file until it closes */
      782     8219    3          BYTES=0;
      783     8220                                                /* First, get open */
      784     8221    3          CALL GET_OPEN(DATA_LCN,%TIMEOUT) ALTRET (CLREL_ALT);
      785     8222    3          CALL SETBREAK ALTRET(PUT_BREAK);
      786     8223    3          CALL M$TIME (FPT_TIME);
      787     8224    3          START_TIME=TSTAMP;
      788     8225    3          OK='1'B;
      789     8226    4          DO WHILE OK;
      790     8227    4              IF HASH THEN CALL HASH_MARKS;
      791     8228    4              CALL M$READ (FPT_READ)
      792     8229    5              WHENRETURN DO;
      793     8230    5                   OK='1'B;
      794     8231    5                   FPT_READ.V.DVBYTE.CONT#='0'B;
      795     8232    5                   END;
      796     8233    5              WHENALTRETURN DO;
      797     8234    5                   IF B$TCB$->B$TCB.ALT$->B$ALT.ERR.ERR# = %E$LD
      798     8235    6                   THEN DO;
      799     8236    6                           FPT_READ.V.DVBYTE.CONT#='1'B;
      800     8237    6                           END;
      801     8238    6                   ELSE DO;
      802     8239    6                       OK = '0'B;
      803     8240    6                       IF B$TCB$->B$TCB.ALT$->B$ALT.ERR.ERR# = %E$EOF THEN EXIT;
      804     8241    6                       CALL REPORT_ALT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:26   
      805     8242    6                       GOTO PUT_BREAK;
      806     8243    6                       END;
      807     8244    5              END;
      808     8245    4              IF OK
      809     8246    5              THEN DO;
      810     8247
      811     8248    5                  CHARNLEN=F$FILE$->F$DCB.ARS#;
      812     8249    5                  IF (CHARNLEN>0)
      813     8250    5                  THEN CALL TCP$WRITE(DATA_LCN,VECTOR(ADDR(LINE_BUF)->CHARN))
      814     8251    6                  WHENALTRETURN DO;
      815     8252    6   PUT_BREAK:          CALL TCP$WRITE(CMD_LCN,VECTOR(IPSYNC),,'1'B);
      816     8253    6                       CALL TCP$WRITE_D(CMD_LCN,VECTOR(ABOR));
      817     8254    6                       CALL TELNET_EOL(CMD_LCN);
      818     8255    6                       CALL TCP$RELEASE(DATA_LCN);
      819     8256    6                       CALL GET_RESPONSE(CMD_LCN,RCODE,'1'B);
      820     8257    6                       CALL GET_RESPONSENW(CMD_LCN,RCODE,'1'B);
      821     8258    6                       GOTO CLOSE_ALT;
      822     8259    6                       END;
      823     8260
      824     8261    5                  IF FILE_TYPE = %FTP_OPT_ASCII AND NOT FPT_READ.V.DVBYTE.CONT#
      825     8262    6                  THEN DO;
      826     8263    6                      BYTES = BYTES + CHARNLEN + 1;
      827     8264    6                      CALL TCP$WRITE(DATA_LCN,VECTOR(CRLF)); /* no push */
      828     8265    6                      END;
      829     8266    6                  ELSE DO;
      830     8267    6                      BYTES = BYTES + CHARNLEN;
      831     8268    6                      END;
      832     8269    5                  END;
      833     8270    4              END;
      834     8271    3          CALL GET_CLOSE(DATA_LCN,%TIMEOUT);
      835     8272    3          CALL M$TIME (FPT_TIME);
      836     8273    3          START_TIME = TSTAMP-START_TIME;
      837     8274    3          CALL GET_RESPONSE(CMD_LCN,RCODE,VERBOSE) ALTRET (CLOSE_ALT);
      838     8275    3          IF RCODE.A ~= '2' THEN GOTO CLOSE_ALT;
      839     8276    3          CALL REPORT_TIME(BYTES,START_TIME);
      840     8277    3          CALL M$CLOSE (FPT_CLOSE);
      841     8278
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:27   
      842     8279    3          END;
      843     8280
      844     8281    2      RETURN;
      845     8282    2   END PUT_CMD;
      846     8283
      847     8284        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:28   
      848     8285    1   GET_OPEN: PROC(LCN,TIMEOUT) ALTRET;
      849     8286    2   DCL LCN UBIN(36);
      850     8287    2   DCL TIMEOUT UBIN(36);
      851     8288
      852     8289        %TCP$CB (NAME=CB);
      853     8292        %TCP$ADMIN (STCLASS=BASED);
      854     8313    2   DCL IP_WAIT_UETIME UBIN(36) SYMREF;
      855     8314    2   DCL REMOTE_ADMIN ENTRY(1);
      856     8315    2   DCL REMAINING_TIME UBIN(36);
      857     8316    2   DCL TCP$RELEASE ENTRY(1) ALTRET;
      858     8317             /* Do a read, it must be a ADMINMSG_ESTABLISHED, otherwise altret */
      859     8318
      860     8319    3      CALL TCP$READ (LCN, VECTOR(CMD_BUFFER), CB) WHENALTRETURN DO;
      861     8320    3          CALL TCP$RELEASE(LCN);
      862     8321    3          GOTO RETALT;
      863     8322    3          END;
      864     8323
      865     8324    3      IF CB.ADMIN THEN DO;
      866     8325    3          IF ADDR(CMD_BUFFER)->TCP$ADMIN.CMD ~= %TCP_ADMINMSG_ESTABLISHED
      867     8326    4          THEN DO;
      868     8327    4              CALL REMOTE_ADMIN(ADDR(CMD_BUFFER));
      869     8328    4   RETALT:    GLOBAL_ERR = %FTP_PROCEDURE_ERR;              /*N* REPORT ERROR */
      870     8329    4              ALTRETURN;
      871     8330    4              END;
      872     8331    3          END;
      873     8332    2      RETURN;
      874     8333
      875     8334        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:29   
      876     8335        /* Close lcn, wait for close ack, release it */
      877     8336    2   GET_CLOSE: ENTRY(LCN, TIMEOUT) ALTRET;
      878     8337
      879     8338    2      CALL TCP$CLOSE (LCN)
      880     8339    3      WHENALTRETURN DO;
      881     8340    3          CALL TCP$RELEASE(LCN);
      882     8341    3          ALTRETURN;
      883     8342    3          END;
      884     8343
      885     8344    3      DO WHILE('1'B);
      886     8345    4          CALL TCP$READ (LCN, VECTOR(CMD_BUFFER), CB) WHENALTRETURN DO;
      887     8346    4              CALL M$XXX;
      888     8347    4              END;
      889     8348
      890     8349    4          IF CB.ADMIN THEN DO;
      891     8350    4              IF (ADDR(CMD_BUFFER)->TCP$ADMIN.CMD ~= %TCP_ADMINMSG_CLOSED) AND
      892     8351    4                    (ADDR(CMD_BUFFER)->TCP$ADMIN.CMD ~= %TCP_ADMINMSG_CLOSING) THEN
      893     8352    4                  CALL REMOTE_ADMIN(ADDR(CMD_BUFFER));
      894     8353
      895     8354    4              CALL TCP$RELEASE(LCN);
      896     8355    4              RETURN;
      897     8356    4              END;
      898     8357
      899     8358    3          END;
      900     8359    2   END GET_OPEN;
      901     8360
      902     8361        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:30   
      903     8362    1   OPEN_DATA_PORT: PROC ALTRET;
      904     8363        /* Try a PASV command.
      905     8364           If it works, set up DATA_FS from the response,
      906     8365           otherwise ...
      907     8366           Open a listen socket,
      908     8367           generate a port command,
      909     8368           get response.
      910     8369           Altret if response is not good. */
      911     8370
      912     8371
      913     8372    2   DCL FMT_OUT CHAR(64);
      914     8373    2   DCL FMT_OUTL SBIN(36);
      915     8374    2   DCL FMT_OUTB CHAR(FMT_OUTL) BASED;
      916     8375
      917     8376    2      DATA_FS = '0'b;
      918     8377    2      DATA_LS = '0'B;
      919     8378        /*n* handle optional output to file */
      920     8379
      921     8380    3      IF PASV >= 0 THEN DO;
      922     8381    3          CALL SIMPLE_CMD('PASV') ALTRET(NOTPASV); /* Try passive mode */
      923     8382    4          IF RCODE.A = '2' THEN DO;
      924     8383    4              FMT_OUTL = WRITE_LO.BUF_.BOUND+1;
      925     8384    4              CALL PARSE_PORT(DATA_FS, WRITE_LO.BUF_.BUF$->FMT_OUTB);
      926     8385    4              PASV = PASV + 1;
      927     8386    4              CALL TCP$OPEN (DATA_LCN, DATA_LS, DATA_FS, %TCP_ACTIVE)
      928     8387    4                ALTRET(RETALT);
      929     8388    4              RETURN;
      930     8389    4              END;
      931     8390    4          ELSE DO;
      932     8391    4   NOTPASV:   PASV = -1;
      933     8392    4              END;
      934     8393    3          END;
      935     8394
      936     8395                       /* Open a socket in listen mode, send address to other end */
      937     8396
      938     8397    2      DATA_LS.PORT = 0;
      939     8398    2      DATA_LS.ADDRESS = CMD_LS.ADDRESS;
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:31   
      940     8399    2      IF DATA_LS.ADDRESS/%BITBIN('01000000'X) = 127
      941     8400    2      THEN DATA_LS.ADDRESS = CMD_FS.ADDRESS;
      942     8401    2      IF NOT SENDPORT THEN DATA_LS.PORT = CMD_LS.PORT;
      943     8402    2      DATA_LCN = -1;
      944     8403    2      CALL TCP$OPEN (DATA_LCN, DATA_LS, DATA_FS, %TCP_PASSIVE,,DATA_LS)
      945     8404    3      WHENALTRETURN DO;
      946     8405    3   RETALT: ;
      947     8406    3          CALL REPORT_TCP;
      948     8407    3          IF DATA_LCN >= 0 THEN CALL TCP$RELEASE (DATA_LCN);
      949     8408    3          GLOBAL_ERR = %FTP_PROCEDURE_ERR;              /*N* REPORT ERROR */
      950     8409    3          ALTRETURN;
      951     8410    3          END;
      952     8411
      953     8412    2      IF NOT SENDPORT THEN RETURN;
      954     8413                                                /* Build port command */
      955     8414    2      CALL PORT(DATA_LS.ADDRESS, DATA_LS.PORT);
      956     8415    2      CALL TCP$WRITE_D (CMD_LCN, VECTOR(SUBSTR(FMT_OUT,1,FMT_OUTL-1)))
      957     8416    2        ALTRET (RETALT);
      958     8417    2      CALL TELNET_EOL (CMD_LCN);
      959     8418    2      CALL GET_RESPONSE (CMD_LCN, RCODE, VERBOSE)
      960     8419    2        ALTRET (RETALT);
      961     8420    2      IF RCODE.A ~= '2' THEN GLOBAL_ERR = %FTP_COMMAND_ERR;
      962     8421    2      RETURN;
      963     8422
      964     8423        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:32   
      965     8424    2   PARSE_PORT: PROC(SOCKET,TEXT);
      966     8425        %TCP$SOCKET (NAME=SOCKET, STCLASS=PARAM);
      967     8433    3   DCL TEXT(0:0) CHAR(1);
      968     8434    3   DCL I SBIN;
      969     8435    3   DCL J SBIN;
      970     8436    3   DCL K SBIN;
      971     8437
      972     8438    3      CALL INDEX(J,'(',ADDR(TEXT)->FMT_OUTB);
      973     8439    3      I=0;
      974     8440    3      K=0;
      975     8441    4      DO WHILE '1'B;
      976     8442    4          J = J + 1;
      977     8443    5          IF TEXT(J) < '0' OR TEXT(J) > '9' THEN DO;
      978     8444    5              I = I + 1;
      979     8445    5              SOCKET.PORT = SOCKET.PORT*256 + K;
      980     8446    5              IF I = 6 THEN RETURN;
      981     8447    6              IF MOD(I,2) = 0 THEN DO;
      982     8448    6                  SOCKET.ADDRESS = SOCKET.ADDRESS*65536 + SOCKET.PORT;
      983     8449    6                  END;
      984     8450    5              K = 0;
      985     8451    5              END;
      986     8452    4          ELSE K = K*10 + ASCBIN(TEXT(J)) - 48;
      987     8453    4          END;
      988     8454    3   END PARSE_PORT;
      989     8455
      990     8456        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:33   
      991     8457    2   PORT: PROC(ADDRESS,PORT);
      992     8458
      993     8459    3   DCL 1 ADDRESS UBIN(32) ALIGNED;
      994     8460
      995     8461    3   DCL 1 PORT UBIN(16) ALIGNED;
      996     8462
      997     8463
      998     8464    3   DCL 1 IPFMT CONSTANT CHAR(0) INIT('PORT %.8D,%.8D,%.8D,%.8D,%S%.8D,%.8D%1Q');
      999     8465
     1000     8466    3      FDS.BUF_ = VECTOR(FMT_OUT);
     1001     8467    3      CALL X$WRITE (FDS, VECTOR(IPFMT), VECTOR(ADDRESS),
     1002     8468    3            VECTOR(PORT));
     1003     8469    3      FMT_OUTL = FDS.BUFX;
     1004     8470
     1005     8471    3   END PORT;
     1006     8472    2   END OPEN_DATA_PORT;
     1007     8473        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:34   
     1008     8474    1   REPORT_ALT: PROC;
     1009     8475        %FPT_ERRMSG (BUF=LINE_BUF,                /* errmsg */
     1010     8476               OUTDCB1=M$DO,
     1011     8477               CODE=TCP_MON_ERR,
     1012     8478               INCLCODE=NO,
     1013     8479               SOURCE=ALTRET);
     1014     8506    2   DCL M$DO DCB;
     1015     8507
     1016     8508    2      FPT_ERRMSG.V.SOURCE# = 2;
     1017     8509    2      GOTO CMN;
     1018     8510
     1019     8511    2   REPORT_TCP: ENTRY;
     1020     8512    2      IF TCP_MON_ERR.ERR# = 0 THEN RETURN;
     1021     8513    2      IF TCP_MON_ERR.MON THEN FPT_ERRMSG.V.SOURCE# = 2;
     1022     8514    2      ELSE FPT_ERRMSG.V.SOURCE# = 0;
     1023     8515
     1024     8516    2   CMN: ;
     1025     8517    2      CALL M$ERRMSG (FPT_ERRMSG);
     1026     8518    2      RETURN;
     1027     8519    2   END REPORT_ALT;
     1028     8520
     1029     8521
     1030     8522    1   LINE_SUB: PROC(TEXTC);
     1031     8523    2   DCL 1 TEXTC ALIGNED,2 COUNT UBIN BYTE UNAL,2 TEXT CHAR(TEXTC.COUNT);
     1032     8524    2   DCL SUBTBL CONSTANT CHAR(0) INIT('
     1033     8525        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
     1034     8526          !"#.%&''()*+,-$/0123456789:;<=>?
     1035     8527        @ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_
     1036     8528        `abcdefghijklmnopqrstuvwxyz{|}~^
     1037     8529        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
     1038     8530          !"#.%&''()*+,-$/0123456789:;<=>?
     1039     8531        @ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_
     1040     8532    2   `abcdefghijklmnopqrstuvwxyz{|}~^');
     1041     8533
     1042     8534    2   DCL I UBIN(36);
     1043     8535
     1044     8536        /*N* ADD COMMAND TO CHANGE SUB CHARS */
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:35   
     1045     8537    2      TFID.COUNT = TEXTC.COUNT;
     1046     8538    2      CALL XLATE (TFID.TEXT, SUBTBL, TEXTC.TEXT);
     1047     8539    2      RETURN;
     1048     8540    2   END LINE_SUB;
     1049     8541
     1050     8542        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:36   
     1051     8543    1   HASH_MARKS: PROC;
     1052     8544    2   DCL LAST_HASH SBIN STATIC;
     1053     8545    2   DCL HASH_MSG CONSTANT CHAR(0) INIT('@#');
     1054     8546
     1055     8547    2      IF BYTES = 0 THEN LAST_HASH = 4096;
     1056     8548    3      DO WHILE LAST_HASH < BYTES;
     1057     8549    3          WRITE_LO.V.DVBYTE.VFC# = '1'B;
     1058     8550    3          WRITE_LO.BUF_ = VECTOR( HASH_MSG);
     1059     8551    3          CALL M$WRITE( WRITE_LO);
     1060     8552    3          WRITE_LO.V.DVBYTE.VFC# = '0'B;
     1061     8553    3          LAST_HASH = LAST_HASH + 4096;
     1062     8554    3          END;
     1063     8555    2      RETURN;
     1064     8556    2   END HASH_MARKS;
     1065     8557        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:37   
     1066     8558    1   REPORT_TIME: PROC(BYTES,TIME);
     1067     8559    2   DCL BYTES SBIN(36);
     1068     8560    2   DCL TIME SBIN(36);
     1069     8561    2   DCL FDSBUF CHAR(80);
     1070     8562    2   DCL FMT CHAR(0) CONSTANT
     1071     8563    2    INIT('%D bytes transferred in %N=%.#:10/KD.%1.#KD seconds
     1072     8564    2     (%N=%.#:10/KD%#:200/[.%1.#KD%] Kbytes/s)');
     1073     8565    2   DCL M$LO DCB;
     1074     8566    2   DCL 1 DAT,
     1075     8567    2      2 BYTES SBIN,
     1076     8568    2      2 SECS SBIN,
     1077     8569    2      2 BPS SBIN;
     1078     8570
     1079     8571    2      DAT.SECS=TIME;
     1080     8572    2      IF DAT.SECS<0 THEN DAT.SECS=DAT.SECS+86400000; /* Add a day if it wrapped */
     1081     8573    2      DAT.SECS=(DAT.SECS+50)/100; /* time in tenths */
     1082     8574    2      IF DAT.SECS=0 THEN DAT.SECS=DAT.SECS+1;
     1083     8575    2      DAT.BYTES=BYTES;
     1084     8576    2      DAT.BPS=(DAT.BYTES+9)/10/DAT.SECS;
     1085     8577    2      FDS.BUF_ = VECTOR( FDSBUF);
     1086     8578    2      CALL X$WRITE (FDS, VECTOR(FMT), VECTOR(DAT));
     1087     8579    3      IF BELL THEN DO;
     1088     8580    3          SUBSTR( FDSBUF,FDS.BUFX,1) = BINASC(7);
     1089     8581    3          FDS.BUFX = FDS.BUFX+1;
     1090     8582    3          END;
     1091     8583    2      WRITE_LO.BUF_ = VECTOR( SUBSTR( FDSBUF,1,FDS.BUFX-1));
     1092     8584    2      CALL M$WRITE( WRITE_LO);
     1093     8585
     1094     8586    2      RETURN;
     1095     8587    2   END REPORT_TIME;
     1096     8588
     1097     8589    1   END FTPCMD;

PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:38   
--  Include file information  --

   B_ERRORS_C.:LIBRARY  is referenced.
   TCT_TELNET_E.:TCA2TOU  is referenced.
   TCP_HEP_M.:TCA2TOU  cannot be made into a system file and is referenced.
   TCF_FTP_E.:TCA2TOU  is referenced.
   XU_FORMAT_C.:LIBRARY  is referenced.
   B$JIT.:LIBRARY  cannot be made into a system file and is referenced.
   XUG_ENTRY.:LIBRARY  cannot be made into a system file and is referenced.
   XU_MACRO_C.:LIBRARY  is referenced.
   CP_6_SUBS.:LIBRARY  is referenced.
   CP_6.:LIBRARY  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure FTPCMD.

   Procedure FTPCMD requires 1995 words for executable code.
   Procedure FTPCMD requires 54 words of local(AUTO) storage.

    No errors detected in file TCF$FTPCMD.:TCA2TSI    .

PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:39   

 Object Unit name= FTPCMD                                     File name= TCF$FTPCMD.:TCA2TOU
 UTS= NOV 16 '97 14:09:46.64 SUN                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   Data  even  none   441    671  FTPCMD
    2  RoData even  UTS    437    665  FTPCMD
    3   DCB   even  none     0      0  M$LO
    4   DCB   even  none     0      0  F$FILE
    5   DCB   even  none     0      0  M$MFILE
    6   DCB   even  none     0      0  M$DO
    7   DCB   even  none     0      0  M$LO
    8   Proc  even  none  1995   3713  FTPCMD
    9  RoData even  none   140    214  FTPCMD

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     8      0   yes    yes     yes      Std        0  FTPCMD
     8    625          yes     yes      Std        0  FTPCMD_INIT
     8    706          yes     yes      Std        0  FTPBREAK
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:40   

  ****  Data defs  ****

 Sect OctLoc  Name                           Sect OctLoc  Name
    1     36  XUG_GETCMD                         1    172  RCODE
    1    200  GLOBAL_ERR                         1    450  BELL
    1    451  DEBUG                              1    452  HASH
    1    453  DFLPASV                            1    454  SENDPORT
    1    455  VERBOSE                            1    456  MPROMPT

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 PARSE_SF
         yes          Async      0 XUG$BREAK
 yes     yes           Std       1 X$PRE_PROCESS
 yes     yes           Std       1 GET_CONNECTED
 yes     yes           Std       1 TELNET_EOL
 yes     yes           Std       1 GET_USER
 yes     yes           Std       2 XTX$ADAPT
         yes           Std       1 XUG$CLRENABLE
 yes     yes           Std       3 GET_RESPONSE
 yes     yes           Std       4 TCP$WRITE_D
 yes     yes           Std       1 XUG$GETCMD
 yes     yes           Std       1 TCP$RELEASE
         yes           Std       1 XUG$DISABLE
 yes     yes           Std       2 XUG$INIT
         yes           Std       1 XUG$ENABLE
 yes     yes           Std       4 GET_LINE
 yes     yes           Std       3 TCP$READ
 yes     yes           Std       4 TCP$WRITE
 yes     yes           Std       3 GET_RESPONSENW
 yes     yes           Std       1 TCP$RELEASE
         yes           Std       1 REMOTE_ADMIN
 yes     yes           Std       1 TCP$CLOSE
 yes     yes           Std       6 TCP$OPEN
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:41   
         yes           Std      22 X$WRITE
 yes     yes           Std       0 FTPBREAK
                       nStd      0 X66_AUTO_0
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
                       nStd      0 X66_AUNWIND

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  TCP_MON_ERR                           B$TCB$
r    B$JIT$                                CMD_LCN                               DATA_LCN
     RUNNING                               FTP_NODES                             CMD_FS
     CMD_BUFFER                            CMD_LS                                M$LO
     WRITE_LO                              F$FILE                                M$MFILE
     CRLF                                  M$DO                                  M$LO
     B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     NULLSID                               ISSID                                 ROSID
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:42   


        1        1        /*M* NTB, MCR=NO, PLM=3, CTI=6, IND=4, MCI=YES, SDI=6, DCI=4, ENU=0, ECU=0 , CCC */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        FTPCMD: PROC ALTRET;

      7  8 000000   000000 700200 xent  FTPCMD       TSX0  ! X66_AUTO_0
         8 000001   000066 000000                    ZERO    54,0

        8        8        %INCLUDE CP_6;
        9       89        %INCLUDE CP_6_SUBS;
       10      629        %INCLUDE XU_MACRO_C;
       11     3735        %INCLUDE XUG_ENTRY;
       12     3766        %INCLUDE B$JIT;
       13     4056    1   DCL X$PRE_PROCESS ENTRY(1) ALTRET;
       14     4057    1   DCL X$WRITE ENTRY(22);
       15     4058        %INCLUDE XU_FORMAT_C;
       16     4220        %F_FDS (NAME=FDS);
       17     4333        %INCLUDE TCF_FTP_E;
       18     4388        %INCLUDE TCP_HEP_M;
       19     4443        %INCLUDE TCT_TELNET_E;
       20     4498        %B$TCB;
       21     4501        %B$ALT;
       22     4509        %INCLUDE B_ERRORS_C;
       23     5636        %EQU TIMEOUT = 60;
       24     5637
       25     5638    1   DCL GET_CONNECTED ENTRY(1) ALTRET;
       26     5639    1   DCL GET_USER ENTRY(1) ALTRET;
       27     5640    1   DCL TELNET_EOL ENTRY(1) ALTRET;
       28     5641    1   DCL TCP$WRITE_D ENTRY(4) ALTRET;
       29     5642    1   DCL TCP$RELEASE ENTRY(1) ALTRET;
       30     5643    1   DCL GET_LINE ENTRY(4) ALTRET;
       31     5644    1   DCL GET_RESPONSE ENTRY(3) ALTRET;
       32     5645    1   DCL GET_RESPONSENW ENTRY(3) ALTRET;
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:43   
       33     5646    1   DCL TCP$WRITE ENTRY(4) ALTRET;
       34     5647    1   DCL TCP$CLOSE ENTRY(1) ALTRET;
       35     5648    1   DCL REMOTE_ADMIN ENTRY(1);
       36     5649    1   DCL TCP$OPEN ENTRY(6) ALTRET;
       37     5650    1   DCL TCP$READ ENTRY(3) ALTRET;
       38     5651    1   DCL PARSE_SF ENTRY(1);
       39     5652    1   DCL X66_TRTN ENTRY(1);
       40     5653
       41     5654        %XUG_GETCMD (PROMPT=PROMPT,
       42     5655                     STCLASS=STATIC SYMDEF,
       43     5656                     SFROUTINE=PARSE_SF,
       44     5657                     NODES=FTP_NODES);
       45     5995    1   DCL PROMPT CHAR(0) CONSTANT INIT('FTP:');
       46     5996
       47     5997    1   DCL BREAK_MEM STATIC REMEMBER;
       48     5998        %FPT_INT (STCLASS=CONSTANT,
       49     5999                  UENTRY=XUG$BREAK);
       50     6013
       51     6014        %XUG_INIT (
       52     6015                ABORT=FTPBREAK,
       53     6016                ALWAYS_SET_PROMPT=YES,
       54     6017                INHIBIT_END=YES,
       55     6018                PREPROCESS=YES,
       56     6019                PREPROCESSOR=X$PRE_PROCESS,
       57     6020                PASS=BLANK,
       58     6021                GOODCMD=YES);
       59     6434
       60     6435        %PARSE$OUT (STCLASS="BASED(PARSE$)");
       61     6480        %PARSE$SYM (STCLASS=BASED);
       62     6518        %FPT_WRITE (FPTN=WRITE_DATA);
       63     6549        %F$DCB;
       64     6606    1   DCL B$TCB$ PTR SYMREF;
       65     6607    1   DCL B$JIT$ PTR SYMREF READONLY;
       66     6608    1   DCL PARSE$ PTR;
       67     6609        /*
       68     6610        %FPT_INT (uentry=intent);
       69     6611        dcl intent entry async;
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:44   
       70     6612        */
       71     6613
       72     6614        %RCODE (STCLASS=STATIC SYMDEF);
       73     6617    1   DCL CODE UBIN(36);
       74     6618    1   DCL LOPT_OVER UBIN HALF CONSTANT INIT(%FTP_OPT_OVER);
       75     6619    1   DCL CMD_LCN SBIN(36) SYMREF;
       76     6620    1   DCL DATA_LCN SBIN(36) SYMREF;
       77     6621    1   DCL RUNNING BIT(1) SYMREF;
       78     6622    1   DCL FTP_NODES UBIN(36) SYMREF;
       79     6623        %TCP$SOCKET (NAME=CMD_FS, STCLASS="SYMREF");
       80     6631    1   DCL CMD_BUFFER CHAR(4096) SYMREF;
       81     6632    1   DCL LINE_BUF REDEF CMD_BUFFER CHAR(4096);
       82     6633        %TCP$SOCKET (NAME=CMD_LS, STCLASS="SYMREF");
       83     6641        %TCP$CB (NAME=CB, STCLASS=STATIC);
       84     6644        %TCP$ADMIN (STCLASS=BASED);
       85     6665    1   DCL M$LO DCB;
       86     6666    1   DCL SPACE CHAR(1) CONSTANT INIT(' ');
       87     6667    1   DCL GLOBAL_ERR UBIN(36) STATIC SYMDEF;
       88     6668    1   DCL 1 TFID STATIC,
       89     6669    1             2 COUNT UBIN(9) CALIGNED,
       90     6670    1             2 TEXT CHAR(79);
       91     6671
       92     6672    1   DCL 1 TEXTC BASED,
       93     6673    1             2 COUNT UBIN(9) CALIGNED,
       94     6674    1             2 TEXT CHAR(TEXTC.COUNT);
       95     6675
       96     6676    1   DCL CHARN CHAR(CHARNLEN) BASED;
       97     6677    1   DCL CHARNLEN UBIN(36) STATIC;
       98     6678    1   DCL START_TIME UBIN(36) STATIC;
       99     6679    1   DCL BYTES UBIN(36) STATIC;
      100     6680    1   DCL TSTAMP UBIN(36) STATIC;
      101     6681        %FPT_TIME (SOURCE=CLOCK, TSTAMP=TSTAMP, DEST=TUN);
      102     6700        %FPT_WRITE (FPTN=WRITE_LO,
      103     6701                STCLASS=SYMREF);
      104     6732    1   DCL TMPC CHAR(1) STATIC;
      105     6733
      106     6734    1   DCL F$FILE DCB;
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:45   
      107     6735    1   DCL F$FILE$ PTR STATIC;
      108     6736    1   DCL M$MFILE DCB;
      109     6737        %FPT_OPEN (
      110     6738                ACS=SEQUEN,
      111     6739                ACCT=VLP_ACCT,
      112     6740                DCB=F$FILE,
      113     6741                SCRUB=YES,
      114     6742                REASSIGN=YES,
      115     6743                DISP=NAMED,
      116     6744                NAME=VLP_NAME,
      117     6745                PASS=VLP_PASS,
      118     6746                SN=VLP_SN,
      119     6747                WSN=VLP_WSN);
      120     6856        %VLP_ACCT;
      121     6869        %VLP_NAME;
      122     6896        %VLP_PASS;
      123     6909        %VLP_SN;
      124     6922        %VLP_WSN;
      125     6935
      126     6936        %FPT_FID (ACCT=VLP_ACCT,
      127     6937                ASN=FPT_OPEN.V.ASN#,
      128     6938                NAME=VLP_NAME,
      129     6939                PASS=VLP_PASS,
      130     6940                RES=FPT_OPEN.V.RES#,
      131     6941                SN=VLP_SN,
      132     6942                WSN=VLP_WSN);
      133     6965
      134     6966        %FPT_WRITE (DCB=F$FILE);
      135     6997        %FPT_READ (DCB=F$FILE, BUF=LINE_BUF, FULL=YES);
      136     7036        %FPT_CLOSE (DCB=F$FILE, DISP=SAVE, STCLASS=CONSTANT);
      137     7078        %FPT_CLOSE (DCB=F$FILE, FPTN=FPT_NSAVE, STCLASS=CONSTANT);
      138     7120
      139     7121    1   DCL FILE_TYPE UBIN(36) STATIC INIT(%FTP_OPT_ASCII);
      140     7122    1   DCL PASV SBIN STATIC INIT(0);
      141     7123    1   DCL BELL STATIC SYMDEF BIT(36) INIT('0'B);
      142     7124    1   DCL TOGOPTS(0:0) REDEF BELL BIT(36);
      143     7125    1   DCL DEBUG STATIC SYMDEF BIT(36) INIT('0'B);
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:46   
      144     7126    1   DCL HASH STATIC SYMDEF BIT(36) INIT('0'B);
      145     7127    1   DCL DFLPASV STATIC SYMDEF SBIN INIT(0);
      146     7128    1   DCL SENDPORT STATIC SYMDEF BIT(36) INIT('777777777777'O);
      147     7129    1   DCL VERBOSE STATIC SYMDEF BIT(36) INIT('777777777777'O);
      148     7130    1   DCL MPROMPT STATIC SYMDEF BIT(36) INIT('0'B);
      149     7131    1   DCL TOGTXT(0:6) CONSTANT CHAR(16) INIT(
      150     7132    1       'Bell mode .',
      151     7133    1       'Debug mode .',
      152     7134    1       'Hash marks (4k) ',
      153     7135    1       'PASV commands .',
      154     7136    1       'PORT commands .',
      155     7137    1       'Verbose mode .',
      156     7138    1       'Prompt mode .');
      157     7139        %TCP$SOCKET (NAME=DATA_FS, STCLASS=STATIC);
      158     7147        %TCP$SOCKET (NAME=DATA_LS, STCLASS=STATIC);
      159     7155
      160     7156    1   DCL MSG_UNIMP CHAR(0) CONSTANT INIT('Unimplemented command.');
      161     7157    1   DCL MSG_TYPE_ASCII CHAR(0) CONSTANT INIT('Type is ASCII.');
      162     7158    1   DCL MSG_TYPE_IMAGE CHAR(0) CONSTANT INIT('Type is IMAGE.');
      163     7159    1   DCL MSG_NOT_CONNECTED CHAR(0) CONSTANT INIT('Not connected.');
      164     7160    1   DCL MSG_USE_CLOSE CHAR(0) CONSTANT INIT('Already connected, use close first.');
      165     7161
      166     7162
      167     7163    1      TCP_MON_ERR = '0'B;

   7163  8 000002   000000 450000 xsym               STZ     TCP_MON_ERR

      168     7164    1      REMEMBER NO_CHANGE IN BREAK_MEM;

   7164  8 000003   000612 635000 8                  EAA     NO_CHANGE
         8 000004   000110 452400 1                  STP2    BREAK_MEM
         8 000005   000111 755000 1                  STA     BREAK_MEM+1

      169     7165    2      DO INHIBIT;

      170     7166    2          CALL XUG$CLRENABLE(XUG_GETCMD);

PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:47   
   7166  8 000006   000000 630600 9                  EPPR0 ! 0
         8 000007   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
         8 000010   000000 701200 xent               TSX1  ! XUG$CLRENABLE
         8 000011   000000 011200                    NOP   ! 0

      171     7167    2          CALL XUG$DISABLE(XUG_GETCMD);

   7167  8 000012   000000 630600 9                  EPPR0 ! 0
         8 000013   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
         8 000014   000000 701200 xent               TSX1  ! XUG$DISABLE
         8 000015   000000 011200                    NOP   ! 0

      172     7168    2          END;

      173     7169    1      GLOBAL_ERR = 0;

   7169  8 000016   000200 450000 1                  STZ     GLOBAL_ERR

      174     7170    2      CALL XUG$GETCMD (XUG_GETCMD) WHENALTRETURN DO;

   7170  8 000017   000000 630400 9                  EPPR0   0
         8 000020   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 000021   000000 701000 xent               TSX1    XUG$GETCMD
         8 000022   000024 702000 8                  TSX2    s:7171
         8 000023   000026 710000 8                  TRA     s:7174

      175     7171    2          CALL M$XXX;

   7171  8 000024   000003 713400                    CLIMB   3
         8 000025   000000 401760                    pmme    nvectors=0

      176     7172    2          END;

      177     7173
      178     7174    1      XUG_GETCMD.TEXT_=VECTOR(NIL);

   7174  8 000026   000002 237000 9                  LDAQ    2
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:48   
         8 000027   000072 757000 1                  STAQ    XUG_GETCMD+28

      179     7175    1      IF XUG_GETCMD.OUT$ = ADDR(NIL) THEN RETURN;

   7175  8 000030   000037 236000 1                  LDQ     XUG_GETCMD+1
         8 000031   000001 116000 xsym               CMPQ    B_VECTNIL+1
         8 000032   000034 601000 8                  TNZ     s:7177

   7175  8 000033   000000 702200 xent               TSX2  ! X66_ARET

      180     7176
      181     7177    1      PARSE$ = XUG_GETCMD.OUT$->OUT$BLK.SUBLK$(0);

   7177  8 000034   000037 470400 1                  LDP0    XUG_GETCMD+1
         8 000035   000003 236100                    LDQ     3,,PR0
         8 000036   200003 756100                    STQ     PARSE$,,AUTO

      182     7178    1      CODE =  OUT$BLK.CODE;

   7178  8 000037   200003 471500                    LDP1    PARSE$,,AUTO
         8 000040   100000 236100                    LDQ     0,,PR1
         8 000041   777777 376007                    ANQ     -1,DL
         8 000042   200004 756100                    STQ     CODE,,AUTO

      183     7179    2      IF CODE = %FTP_CMD_EXIT THEN DO;

   7179  8 000043   000021 116007                    CMPQ    17,DL
         8 000044   000053 601000 8                  TNZ     s:7185

      184     7180    2          RUNNING = '0'B;

   7180  8 000045   000000 450000 xsym               STZ     RUNNING

      185     7181    2          IF CMD_LCN < 0 THEN RETURN;

   7181  8 000046   000000 235000 xsym               LDA     CMD_LCN
         8 000047   000051 605000 8                  TPL     s:7182
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:49   

   7181  8 000050   000000 702200 xent               TSX2  ! X66_ARET

      186     7182    2          CODE = %FTP_CMD_CLOSE;

   7182  8 000051   000014 235007                    LDA     12,DL
         8 000052   200004 755100                    STA     CODE,,AUTO

      187     7183    2          END;

      188     7184    2      DO INHIBIT;

      189     7185    2          CALL XUG$CLRENABLE(XUG_GETCMD); /* Ignore breaks during input */

   7185  8 000053   000000 630600 9                  EPPR0 ! 0
         8 000054   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
         8 000055   000000 701200 xent               TSX1  ! XUG$CLRENABLE
         8 000056   000000 011200                    NOP   ! 0

      190     7186    2          CALL XUG$DISABLE(XUG_GETCMD);

   7186  8 000057   000000 630600 9                  EPPR0 ! 0
         8 000060   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
         8 000061   000000 701200 xent               TSX1  ! XUG$DISABLE
         8 000062   000000 011200                    NOP   ! 0

      191     7187    2          END;

      192     7188
      193     7189    1      IF CMD_LCN < 0 AND CODE ~= %FTP_CMD_CONNECT AND CODE ~= %FTP_CMD_TYPE

   7189  8 000063   000000 235000 xsym               LDA     CMD_LCN
         8 000064   000104 605000 8                  TPL     s:7197
         8 000065   200004 236100                    LDQ     CODE,,AUTO
         8 000066   000020 116007                    CMPQ    16,DL
         8 000067   000104 600000 8                  TZE     s:7197
         8 000070   000003 116007                    CMPQ    3,DL
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:50   
         8 000071   000104 600000 8                  TZE     s:7197
         8 000072   000023 116007                    CMPQ    19,DL
         8 000073   000104 600000 8                  TZE     s:7197
         8 000074   000026 116007                    CMPQ    22,DL
         8 000075   000104 600000 8                  TZE     s:7197

      194     7190    1        AND CODE ~= %FTP_CMD_TOGGLE AND CODE ~= %FTP_CMD_STATUS
      195     7191    2      THEN DO;

      196     7192    2          WRITE_LO.BUF_ = VECTOR(MSG_NOT_CONNECTED);

   7192  8 000076   000004 237000 9                  LDAQ    4
         8 000077   000004 757000 xsym               STAQ    WRITE_LO+4

      197     7193    2          CALL M$WRITE(WRITE_LO);

   7193  8 000100   000000 630400 xsym               EPPR0   WRITE_LO
         8 000101   040001 713400                    CLIMB   write
         8 000102   401400 401760                    pmme    nvectors=4

      198     7194    2          RETURN;

   7194  8 000103   000000 702200 xent               TSX2  ! X66_ARET

      199     7195    2          END;
      200     7196
      201     7197    2      DO CASE (CODE);

   7197  8 000104   200004 236100                    LDQ     CODE,,AUTO
         8 000105   000027 116007                    CMPQ    23,DL
         8 000106   000110 602006 8                  TNC     s:7197+4,QL
         8 000107   000613 710000 8                  TRA     s:7312
         8 000110   000613 710000 8                  TRA     s:7312
         8 000111   000310 710000 8                  TRA     s:7241
         8 000112   000257 710000 8                  TRA     s:7234
         8 000113   000551 710000 8                  TRA     s:7295
         8 000114   000405 710000 8                  TRA     s:7257
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:51   
         8 000115   000512 710000 8                  TRA     s:7280
         8 000116   000144 710000 8                  TRA     s:7202
         8 000117   000137 710000 8                  TRA     s:7199
         8 000120   000613 710000 8                  TRA     s:7312
         8 000121   000445 710000 8                  TRA     s:7268
         8 000122   000512 710000 8                  TRA     s:7280
         8 000123   000151 710000 8                  TRA     s:7205
         8 000124   000235 710000 8                  TRA     s:7226
         8 000125   000357 710000 8                  TRA     s:7252
         8 000126   000613 710000 8                  TRA     s:7312
         8 000127   000230 710000 8                  TRA     s:7223
         8 000130   000173 710000 8                  TRA     s:7209
         8 000131   000613 710000 8                  TRA     s:7312
         8 000132   000301 710000 8                  TRA     s:7238
         8 000133   000530 710000 8                  TRA     s:7289
         8 000134   000321 710000 8                  TRA     s:7244
         8 000135   000512 710000 8                  TRA     s:7280
         8 000136   000515 710000 8                  TRA     s:7283

      202     7198    2       CASE (%FTP_CMD_LIST);

      203     7199    2          CALL LIST_CMD('LIST');

   7199  8 000137   000006 236000 9                  LDQ     6
         8 000140   200011 756100                    STQ     SAVERBOSE+2,,AUTO
         8 000141   001374 701000 8                  TSX1    LIST_CMD
         8 000142   000000 011000                    NOP     0
         8 000143   000620 710000 8                  TRA     s:7317

      204     7200
      205     7201    2       CASE (%FTP_CMD_LS);

      206     7202    2          CALL LIST_CMD('NLST');

   7202  8 000144   000007 236000 9                  LDQ     7
         8 000145   200011 756100                    STQ     SAVERBOSE+2,,AUTO
         8 000146   001374 701000 8                  TSX1    LIST_CMD
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:52   
         8 000147   000000 011000                    NOP     0
         8 000150   000620 710000 8                  TRA     s:7317

      207     7203
      208     7204    2       CASE (%FTP_CMD_RHELP);

      209     7205    2          IF OUT$BLK.NSUBLKS=0 THEN CALL SIMPLE_CMD('HELP');

   7205  8 000151   200003 470500                    LDP0    PARSE$,,AUTO
         8 000152   000001 220100                    LDX0    1,,PR0
         8 000153   000163 601000 8                  TNZ     s:7206

   7205  8 000154   000001 236000 xsym               LDQ     B_VECTNIL+1
         8 000155   200044 756100                    STQ     @ADDRESS+1,,AUTO
         8 000156   000010 236000 9                  LDQ     8
         8 000157   200043 756100                    STQ     FMT_OUTL+2,,AUTO
         8 000160   001670 701000 8                  TSX1    SIMPLE_CMD
         8 000161   000000 011000                    NOP     0
         8 000162   000620 710000 8                  TRA     s:7317

      210     7206    2          ELSE CALL SIMPLE_CMD('HELP', OUT$BLK.SUBLK$(0)->OUT$SYM.COUNT);

   7206  8 000163   000003 471500                    LDP1    3,,PR0
         8 000164   100004 633500                    EPPR3   4,,PR1
         8 000165   200044 453500                    STP3    @ADDRESS+1,,AUTO
         8 000166   000010 236000 9                  LDQ     8
         8 000167   200043 756100                    STQ     FMT_OUTL+2,,AUTO
         8 000170   001670 701000 8                  TSX1    SIMPLE_CMD
         8 000171   000000 011000                    NOP     0
         8 000172   000620 710000 8                  TRA     s:7317

      211     7207
      212     7208    2       CASE (%FTP_CMD_CONNECT);

      213     7209    3          IF CMD_LCN >= 0 THEN DO;

   7209  8 000173   000000 115003                    CMPA    0,DU
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:53   
         8 000174   000203 604000 8                  TMI     s:7214

      214     7210    3              WRITE_LO.BUF_ = VECTOR(MSG_USE_CLOSE);

   7210  8 000175   000012 237000 9                  LDAQ    10
         8 000176   000004 757000 xsym               STAQ    WRITE_LO+4

      215     7211    3              CALL M$WRITE (WRITE_LO);

   7211  8 000177   000000 630400 xsym               EPPR0   WRITE_LO
         8 000200   040001 713400                    CLIMB   write
         8 000201   401400 401760                    pmme    nvectors=4

      216     7212    3              RETURN;

   7212  8 000202   000000 702200 xent               TSX2  ! X66_ARET

      217     7213    3              END;
      218     7214    3          CALL GET_CONNECTED(OUT$BLK) WHENALTRETURN DO;

   7214  8 000203   200003 630500                    EPPR0   PARSE$,,AUTO
         8 000204   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 000205   000000 701000 xent               TSX1    GET_CONNECTED
         8 000206   000210 702000 8                  TSX2    s:7215
         8 000207   000221 710000 8                  TRA     s:7220

      219     7215    3              CALL REPORT_TCP;

   7215  8 000210   003526 701000 8                  TSX1    REPORT_TCP
         8 000211   000000 011000                    NOP     0

      220     7216    3              CALL TCP$RELEASE(CMD_LCN);

   7216  8 000212   000014 630400 9                  EPPR0   12
         8 000213   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 000214   000000 701000 xent               TSX1    TCP$RELEASE
         8 000215   000000 011000                    NOP     0
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:54   

      221     7217    3              CMD_LCN = -1;

   7217  8 000216   000001 335007                    LCA     1,DL
         8 000217   000000 755000 xsym               STA     CMD_LCN

      222     7218    3              RETURN;

   7218  8 000220   000000 702200 xent               TSX2  ! X66_ARET

      223     7219    3              END;
      224     7220    2          IF FILE_TYPE~=%FTP_OPT_ASCII THEN CALL TYPE_CMD('I');

   7220  8 000221   000446 235000 1                  LDA     FILE_TYPE
         8 000222   000620 600000 8                  TZE     s:7317

   7220  8 000223   000016 236000 9                  LDQ     14
         8 000224   200013 756100                    STQ     @OVERINTO+1,,AUTO
         8 000225   000735 701000 8                  TSX1    TYPE_CMD
         8 000226   000000 011000                    NOP     0
         8 000227   000620 710000 8                  TRA     s:7317

      225     7221
      226     7222    2       CASE (%FTP_CMD_USER);

      227     7223    2          CALL GET_USER(OUT$BLK);  /*N* ALTRET */

   7223  8 000230   200003 630500                    EPPR0   PARSE$,,AUTO
         8 000231   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 000232   000000 701000 xent               TSX1    GET_USER
         8 000233   000000 011000                    NOP     0
         8 000234   000620 710000 8                  TRA     s:7317

      228     7224
      229     7225    2       CASE (%FTP_CMD_CLOSE);

      230     7226    2          CALL SIMPLE_CMD ('QUIT');
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:55   

   7226  8 000235   000001 236000 xsym               LDQ     B_VECTNIL+1
         8 000236   200044 756100                    STQ     @ADDRESS+1,,AUTO
         8 000237   000017 236000 9                  LDQ     15
         8 000240   200043 756100                    STQ     FMT_OUTL+2,,AUTO
         8 000241   001670 701000 8                  TSX1    SIMPLE_CMD
         8 000242   000000 011000                    NOP     0

   7226  8 000243                       DISCONNECTED null
      231     7227    2   DISCONNECTED: ;
      232     7228    2          RCODE = '0'B; /* Dont loop on a 421 error code */

   7228  8 000243   000172 450000 1                  STZ     RCODE

      233     7229    2          CALL GET_CLOSE(CMD_LCN);

   7229  8 000244   000001 236000 xsym               LDQ     B_VECTNIL+1
         8 000245   200022 756100                    STQ     @BYTES+1,,AUTO
         8 000246   000014 236000 9                  LDQ     12
         8 000247   200021 756100                    STQ     CURSIZ+3,,AUTO
         8 000250   003115 701000 8                  TSX1    GET_CLOSE
         8 000251   000000 011000                    NOP     0

      234     7230    2          CMD_LCN = -1;

   7230  8 000252   000001 335007                    LCA     1,DL
         8 000253   000000 755000 xsym               STA     CMD_LCN

      235     7231    2          PASV = DFLPASV;

   7231  8 000254   000453 236000 1                  LDQ     DFLPASV
         8 000255   000447 756000 1                  STQ     PASV
         8 000256   000620 710000 8                  TRA     s:7317

      236     7232
      237     7233    2       CASE (%FTP_CMD_RDIR);

PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:56   
      238     7234    2          IF OUT$BLK.NSUBLKS=0 THEN CALL SIMPLE_CMD('CDUP');

   7234  8 000257   200003 470500                    LDP0    PARSE$,,AUTO
         8 000260   000001 220100                    LDX0    1,,PR0
         8 000261   000271 601000 8                  TNZ     s:7235

   7234  8 000262   000001 236000 xsym               LDQ     B_VECTNIL+1
         8 000263   200044 756100                    STQ     @ADDRESS+1,,AUTO
         8 000264   000020 236000 9                  LDQ     16
         8 000265   200043 756100                    STQ     FMT_OUTL+2,,AUTO
         8 000266   001670 701000 8                  TSX1    SIMPLE_CMD
         8 000267   000000 011000                    NOP     0
         8 000270   000620 710000 8                  TRA     s:7317

      239     7235    2          ELSE CALL SIMPLE_CMD('CWD ',OUT$BLK.SUBLK$(0)->OUT$SYM.COUNT);

   7235  8 000271   000003 471500                    LDP1    3,,PR0
         8 000272   100004 633500                    EPPR3   4,,PR1
         8 000273   200044 453500                    STP3    @ADDRESS+1,,AUTO
         8 000274   000021 236000 9                  LDQ     17
         8 000275   200043 756100                    STQ     FMT_OUTL+2,,AUTO
         8 000276   001670 701000 8                  TSX1    SIMPLE_CMD
         8 000277   000000 011000                    NOP     0
         8 000300   000620 710000 8                  TRA     s:7317

      240     7236
      241     7237    2       CASE (%FTP_CMD_PWD);

      242     7238    2          CALL SIMPLE_CMD('PWD ');

   7238  8 000301   000001 236000 xsym               LDQ     B_VECTNIL+1
         8 000302   200044 756100                    STQ     @ADDRESS+1,,AUTO
         8 000303   000022 236000 9                  LDQ     18
         8 000304   200043 756100                    STQ     FMT_OUTL+2,,AUTO
         8 000305   001670 701000 8                  TSX1    SIMPLE_CMD
         8 000306   000000 011000                    NOP     0
         8 000307   000620 710000 8                  TRA     s:7317
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:57   

      243     7239
      244     7240    2       CASE (%FTP_CMD_DELETE);

      245     7241    2          CALL SIMPLE_CMD('DELE',OUT$BLK.SUBLK$(0)->OUT$SYM.COUNT);

   7241  8 000310   200003 470500                    LDP0    PARSE$,,AUTO
         8 000311   000003 471500                    LDP1    3,,PR0
         8 000312   100004 633500                    EPPR3   4,,PR1
         8 000313   200044 453500                    STP3    @ADDRESS+1,,AUTO
         8 000314   000023 236000 9                  LDQ     19
         8 000315   200043 756100                    STQ     FMT_OUTL+2,,AUTO
         8 000316   001670 701000 8                  TSX1    SIMPLE_CMD
         8 000317   000000 011000                    NOP     0
         8 000320   000620 710000 8                  TRA     s:7317

      246     7242
      247     7243    2       CASE (%FTP_CMD_QUOTE);

      248     7244    2          IF OUT$BLK.SUBLK$(0)->OUT$SYM.COUNT>0

   7244  8 000321   200003 470500                    LDP0    PARSE$,,AUTO
         8 000322   000003 471500                    LDP1    3,,PR0
         8 000323   100004 236100                    LDQ     4,,PR1
         8 000324   777000 316003                    CANQ    -512,DU
         8 000325   000352 600000 8                  TZE     s:7249

      249     7245    3          THEN DO;

      250     7246    3              CALL TCP$WRITE_D (CMD_LCN, VECTOR(OUT$BLK.SUBLK$(0)->OUT$SYM.TEXT));

   7246  8 000326   100004 236100                    LDQ     4,,PR1
         8 000327   000033 772000                    QRL     27
         8 000330   000064 737000                    LLS     52
         8 000331   000140 135007                    SBLA    96,DL
         8 000332   200052 451500                    STP1    DAT+3,,AUTO
         8 000333   200052 236100                    LDQ     DAT+3,,AUTO
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:58   
         8 000334   000024 036000 9                  ADLQ    20
         8 000335   200054 757100                    STAQ    DAT+5,,AUTO
         8 000336   200054 633500                    EPPR3   DAT+5,,AUTO
         8 000337   200057 453500                    STP3    DAT+8,,AUTO
         8 000340   000014 236000 9                  LDQ     12
         8 000341   200056 756100                    STQ     DAT+7,,AUTO
         8 000342   200056 630500                    EPPR0   DAT+7,,AUTO
         8 000343   000020 631400 xsym               EPPR1   B_VECTNIL+16
         8 000344   000000 701000 xent               TSX1    TCP$WRITE_D
         8 000345   000000 011000                    NOP     0

      251     7247    3              CALL TELNET_EOL (CMD_LCN);

   7247  8 000346   000014 630400 9                  EPPR0   12
         8 000347   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 000350   000000 701000 xent               TSX1    TELNET_EOL
         8 000351   000000 011000                    NOP     0

      252     7248    3              END;

      253     7249    2          CALL GET_RESPONSE (CMD_LCN,RCODE,'1'B);

   7249  8 000352   000025 630400 9                  EPPR0   21
         8 000353   000021 631400 xsym               EPPR1   B_VECTNIL+17
         8 000354   000000 701000 xent               TSX1    GET_RESPONSE
         8 000355   000000 011000                    NOP     0
         8 000356   000620 710000 8                  TRA     s:7317

      254     7250
      255     7251    2       CASE (%FTP_CMD_RENAME);

      256     7252    2          CALL SIMPLE_CMD('RNFR',OUT$BLK.SUBLK$(0)->OUT$SYM.COUNT);

   7252  8 000357   200003 470500                    LDP0    PARSE$,,AUTO
         8 000360   000003 471500                    LDP1    3,,PR0
         8 000361   100004 633500                    EPPR3   4,,PR1
         8 000362   200044 453500                    STP3    @ADDRESS+1,,AUTO
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:59   
         8 000363   000030 236000 9                  LDQ     24
         8 000364   200043 756100                    STQ     FMT_OUTL+2,,AUTO
         8 000365   001670 701000 8                  TSX1    SIMPLE_CMD
         8 000366   000000 011000                    NOP     0

      257     7253    2          IF RCODE.A ~= '3' THEN EXIT;

   7253  8 000367   000172 236000 1                  LDQ     RCODE
         8 000370   777000 376003                    ANQ     -512,DU
         8 000371   063000 116003                    CMPQ    26112,DU
         8 000372   000620 601000 8                  TNZ     s:7317

      258     7254    2          CALL SIMPLE_CMD('RNTO',OUT$BLK.SUBLK$(OUT$BLK.NSUBLKS-1)->OUT$SYM.COUNT);

   7254  8 000373   200003 470500                    LDP0    PARSE$,,AUTO
         8 000374   000001 220100                    LDX0    1,,PR0
         8 000375   000002 471510                    LDP1    2,X0,PR0
         8 000376   100004 633500                    EPPR3   4,,PR1
         8 000377   200044 453500                    STP3    @ADDRESS+1,,AUTO
         8 000400   000031 236000 9                  LDQ     25
         8 000401   200043 756100                    STQ     FMT_OUTL+2,,AUTO
         8 000402   001670 701000 8                  TSX1    SIMPLE_CMD
         8 000403   000000 011000                    NOP     0
         8 000404   000620 710000 8                  TRA     s:7317

      259     7255
      260     7256    2       CASE (%FTP_CMD_GET);

      261     7257    2          IF OUT$BLK.NSUBLKS =1    /* No local fid */

   7257  8 000405   200003 470500                    LDP0    PARSE$,,AUTO
         8 000406   000001 220100                    LDX0    1,,PR0
         8 000407   000001 100003                    CMPX0   1,DU
         8 000410   000427 601000 8                  TNZ     s:7263

      262     7258    3          THEN DO;

PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:60   
      263     7259    3              CALL LINE_SUB(OUT$BLK.SUBLK$(0)->OUT$SYM.COUNT);

   7259  8 000411   000003 471500                    LDP1    3,,PR0
         8 000412   100004 633500                    EPPR3   4,,PR1
         8 000413   200015 453500                    STP3    @ONOVER+1,,AUTO
         8 000414   003551 701000 8                  TSX1    LINE_SUB
         8 000415   000000 011000                    NOP     0

      264     7260    3              CALL GET_CMD(OUT$BLK.SUBLK$(0)->OUT$SYM.COUNT,

   7260  8 000416   200003 470500                    LDP0    PARSE$,,AUTO
         8 000417   000003 471500                    LDP1    3,,PR0
         8 000420   000032 237000 9                  LDAQ    26
         8 000421   200014 757100                    STAQ    @RFID+1,,AUTO
         8 000422   100004 633500                    EPPR3   4,,PR1
         8 000423   200013 453500                    STP3    @OVERINTO+1,,AUTO
         8 000424   002015 701000 8                  TSX1    GET_CMD
         8 000425   000000 011000                    NOP     0

      265     7261    3                    LOPT_OVER, TFID);
      266     7262    3              END;

   7262  8 000426   000620 710000 8                  TRA     s:7317

      267     7263    2          ELSE CALL GET_CMD(OUT$BLK.SUBLK$(0)->OUT$SYM.COUNT,

   7263  8 000427   000003 471500                    LDP1    3,,PR0
         8 000430   000004 473500                    LDP3    4,,PR0
         8 000431   000005 474500                    LDP4    5,,PR0
         8 000432   400004 635500                    EPPR5   4,,PR4
         8 000433   200015 455500                    STP5    @ONOVER+1,,AUTO
         8 000434   200052 453500                    STP3    DAT+3,,AUTO
         8 000435   200052 236100                    LDQ     DAT+3,,AUTO
         8 000436   400000 036007                    ADLQ    -131072,DL
         8 000437   200014 756100                    STQ     @RFID+1,,AUTO
         8 000440   100004 634500                    EPPR4   4,,PR1
         8 000441   200013 454500                    STP4    @OVERINTO+1,,AUTO
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:61   
         8 000442   002015 701000 8                  TSX1    GET_CMD
         8 000443   000000 011000                    NOP     0
         8 000444   000620 710000 8                  TRA     s:7317

      268     7264    2                    OUT$BLK.SUBLK$(1)->OUT$BLK.CODE,
      269     7265    2                    OUT$BLK.SUBLK$(2)->OUT$SYM.COUNT);
      270     7266
      271     7267    2       CASE (%FTP_CMD_PUT);

      272     7268    2          IF OUT$BLK.NSUBLKS = 2   /* No remote fid */

   7268  8 000445   200003 470500                    LDP0    PARSE$,,AUTO
         8 000446   000001 220100                    LDX0    1,,PR0
         8 000447   000002 100003                    CMPX0   2,DU
         8 000450   000474 601000 8                  TNZ     s:7275

      273     7269    3          THEN DO;

      274     7270    3              CALL LINE_SUB(OUT$BLK.SUBLK$(0)->OUT$SYM.COUNT);

   7270  8 000451   000003 471500                    LDP1    3,,PR0
         8 000452   100004 633500                    EPPR3   4,,PR1
         8 000453   200015 453500                    STP3    @ONOVER+1,,AUTO
         8 000454   003551 701000 8                  TSX1    LINE_SUB
         8 000455   000000 011000                    NOP     0

      275     7271    3              CALL PUT_CMD(OUT$BLK.SUBLK$(0)->OUT$SYM.COUNT,

   7271  8 000456   200003 470500                    LDP0    PARSE$,,AUTO
         8 000457   000003 471500                    LDP1    3,,PR0
         8 000460   000004 473500                    LDP3    4,,PR0
         8 000461   000033 236000 9                  LDQ     27
         8 000462   200013 756100                    STQ     @OVERINTO+1,,AUTO
         8 000463   200052 453500                    STP3    DAT+3,,AUTO
         8 000464   200052 236100                    LDQ     DAT+3,,AUTO
         8 000465   400000 036007                    ADLQ    -131072,DL
         8 000466   200012 756100                    STQ     @LFID+1,,AUTO
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:62   
         8 000467   100004 634500                    EPPR4   4,,PR1
         8 000470   200011 454500                    STP4    SAVERBOSE+2,,AUTO
         8 000471   002475 701000 8                  TSX1    PUT_CMD
         8 000472   000000 011000                    NOP     0

      276     7272    3                    OUT$BLK.SUBLK$(1)->OUT$BLK.CODE,
      277     7273    3                    TFID);
      278     7274    3              END;

   7274  8 000473   000620 710000 8                  TRA     s:7317

      279     7275    2          ELSE CALL PUT_CMD(OUT$BLK.SUBLK$(0)->OUT$SYM.COUNT,

   7275  8 000474   000003 471500                    LDP1    3,,PR0
         8 000475   000004 473500                    LDP3    4,,PR0
         8 000476   000005 474500                    LDP4    5,,PR0
         8 000477   400004 635500                    EPPR5   4,,PR4
         8 000500   200013 455500                    STP5    @OVERINTO+1,,AUTO
         8 000501   200052 453500                    STP3    DAT+3,,AUTO
         8 000502   200052 236100                    LDQ     DAT+3,,AUTO
         8 000503   400000 036007                    ADLQ    -131072,DL
         8 000504   200012 756100                    STQ     @LFID+1,,AUTO
         8 000505   100004 634500                    EPPR4   4,,PR1
         8 000506   200011 454500                    STP4    SAVERBOSE+2,,AUTO
         8 000507   002475 701000 8                  TSX1    PUT_CMD
         8 000510   000000 011000                    NOP     0
         8 000511   000620 710000 8                  TRA     s:7317

      280     7276    2                    OUT$BLK.SUBLK$(1)->OUT$BLK.CODE,
      281     7277    2                    OUT$BLK.SUBLK$(2)->OUT$SYM.COUNT);
      282     7278
      283     7279    2       CASE (%FTP_CMD_MGET, %FTP_CMD_MPUT, %FTP_CMD_MDEL);

      284     7280    2          CALL MFILE_CMD;

   7280  8 000512   001062 701000 8                  TSX1    MFILE_CMD
         8 000513   000000 011000                    NOP     0
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:63   
         8 000514   000620 710000 8                  TRA     s:7317

      285     7281
      286     7282    2       CASE (%FTP_CMD_STATUS);

      287     7283    3          DO CODE=0 TO SIZEW(TOGTXT)/SIZEW(TOGTXT(0))-1;

   7283  8 000515   200004 450100                    STZ     CODE,,AUTO
         8 000516   000524 710000 8                  TRA     s:7285+3

      288     7284    3              CALL DISP_TOGGLE;

   7284  8 000517   001004 701000 8                  TSX1    DISP_TOGGLE
         8 000520   000000 011000                    NOP     0

      289     7285    3              END;

   7285  8 000521   200004 235100                    LDA     CODE,,AUTO
         8 000522   000001 035007                    ADLA    1,DL
         8 000523   200004 755100                    STA     CODE,,AUTO
         8 000524   200004 235100                    LDA     CODE,,AUTO
         8 000525   000007 115007                    CMPA    7,DL
         8 000526   000517 602000 8                  TNC     s:7284

      290     7286    2          GOTO DISP_TYPE;

   7286  8 000527   000554 710000 8                  TRA     DISP_TYPE

      291     7287
      292     7288    2       CASE (%FTP_CMD_TOGGLE);

      293     7289    2          CODE = OUT$BLK.SUBLK$(0)->OUT$BLK.CODE;

   7289  8 000530   200003 470500                    LDP0    PARSE$,,AUTO
         8 000531   000003 471500                    LDP1    3,,PR0
         8 000532   100000 236100                    LDQ     0,,PR1
         8 000533   777777 376007                    ANQ     -1,DL
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:64   
         8 000534   200004 756100                    STQ     CODE,,AUTO

      294     7290    2          TOGOPTS( CODE) = ~TOGOPTS( CODE);

   7290  8 000535   000450 236006 1                  LDQ     BELL,QL
         8 000536   000027 676000 xsym               ERQ     B_VECTNIL+23
         8 000537   200004 720100                    LXL0    CODE,,AUTO
         8 000540   000450 756010 1                  STQ     BELL,X0

      295     7291    2          IF CODE = %FTP_OPT_PASV THEN PASV = BITBIN( TOGOPTS( CODE));

   7291  8 000541   200004 235100                    LDA     CODE,,AUTO
         8 000542   000003 115007                    CMPA    3,DL
         8 000543   000546 601000 8                  TNZ     s:7292

   7291  8 000544   000450 235010 1                  LDA     BELL,X0
         8 000545   000447 755000 1                  STA     PASV

      296     7292    2          CALL DISP_TOGGLE;

   7292  8 000546   001004 701000 8                  TSX1    DISP_TOGGLE
         8 000547   000000 011000                    NOP     0
         8 000550   000620 710000 8                  TRA     s:7317

      297     7293
      298     7294    2       CASE (%FTP_CMD_TYPE);

      299     7295    2          IF OUT$BLK.NSUBLKS = 0   /* No options, display current */

   7295  8 000551   200003 470500                    LDP0    PARSE$,,AUTO
         8 000552   000001 220100                    LDX0    1,,PR0
         8 000553   000567 601000 8                  TNZ     s:7304

      300     7296    3          THEN DO;

   7291  8 000554                       DISP_TYPE    null
      301     7297    3   DISP_TYPE: ;
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:65   
      302     7298    3              IF FILE_TYPE = %FTP_OPT_ASCII THEN

   7298  8 000554   000446 235000 1                  LDA     FILE_TYPE
         8 000555   000561 601000 8                  TNZ     s:7300

      303     7299    3                  WRITE_LO.BUF_ = VECTOR(MSG_TYPE_ASCII);

   7299  8 000556   000034 237000 9                  LDAQ    28
         8 000557   000004 757000 xsym               STAQ    WRITE_LO+4
         8 000560   000563 710000 8                  TRA     s:7301

      304     7300    3              ELSE WRITE_LO.BUF_ = VECTOR(MSG_TYPE_IMAGE);

   7300  8 000561   000036 237000 9                  LDAQ    30
         8 000562   000004 757000 xsym               STAQ    WRITE_LO+4

      305     7301    3              CALL M$WRITE (WRITE_LO);

   7301  8 000563   000000 630400 xsym               EPPR0   WRITE_LO
         8 000564   040001 713400                    CLIMB   write
         8 000565   401400 401760                    pmme    nvectors=4

      306     7302    3              RETURN;

   7302  8 000566   000000 702200 xent               TSX2  ! X66_ARET

      307     7303    3              END;
      308     7304    2          IF CMD_LCN>=0 /* Just change type if not connected */

   7304  8 000567   000000 115003                    CMPA    0,DU
         8 000570   000605 604000 8                  TMI     s:7308

      309     7305    2          THEN IF OUT$BLK.SUBLK$(0)->OUT$SYM.CODE = %FTP_OPT_ASCII

   7305  8 000571   000003 471500                    LDP1    3,,PR0
         8 000572   100000 721100                    LXL1    0,,PR1
         8 000573   000601 601000 8                  TNZ     s:7307
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:66   

      310     7306    2          THEN CALL TYPE_CMD('A') ALTRET(NO_CHANGE);

   7306  8 000574   000041 236000 9                  LDQ     33
         8 000575   200013 756100                    STQ     @OVERINTO+1,,AUTO
         8 000576   000735 701000 8                  TSX1    TYPE_CMD
         8 000577   000612 702000 8                  TSX2    NO_CHANGE
         8 000600   000605 710000 8                  TRA     s:7308

      311     7307    2          ELSE CALL TYPE_CMD('I') ALTRET(NO_CHANGE);

   7307  8 000601   000016 236000 9                  LDQ     14
         8 000602   200013 756100                    STQ     @OVERINTO+1,,AUTO
         8 000603   000735 701000 8                  TSX1    TYPE_CMD
         8 000604   000612 702000 8                  TSX2    NO_CHANGE

      312     7308    2          FILE_TYPE = OUT$BLK.SUBLK$(0)->OUT$SYM.CODE;

   7308  8 000605   200003 470500                    LDP0    PARSE$,,AUTO
         8 000606   000003 471500                    LDP1    3,,PR0
         8 000607   100000 236100                    LDQ     0,,PR1
         8 000610   777777 376007                    ANQ     -1,DL
         8 000611   000446 756000 1                  STQ     FILE_TYPE

   7308  8 000612   000620 710000 8     NO_CHANGE    TRA     s:7317

      313     7309    2   NO_CHANGE: ;
      314     7310
      315     7311    2       CASE(ELSE);

      316     7312    2          WRITE_LO.BUF_ = VECTOR(MSG_UNIMP);

   7312  8 000613   000042 237000 9                  LDAQ    34
         8 000614   000004 757000 xsym               STAQ    WRITE_LO+4

      317     7313    2          CALL M$WRITE (WRITE_LO);

PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:67   
   7313  8 000615   000000 630400 xsym               EPPR0   WRITE_LO
         8 000616   040001 713400                    CLIMB   write
         8 000617   401400 401760                    pmme    nvectors=4

      318     7314    2          END;                             /* Do case */

      319     7315
      320     7316        /*N* IF BATCH AND GLOBAL_ERR ~= 0 THEN ABORT */
      321     7317    1      IF RCODE = '064062061'O THEN /* 421 response means it's all over */

   7317  8 000620   000172 236000 1                  LDQ     RCODE
         8 000621   000641 676000 2                  ERQ     FMT+33
         8 000622   000044 376000 9                  ANQ     36
         8 000623   000243 600000 8                  TZE     DISCONNECTED

      322     7318    1          GOTO DISCONNECTED;
      323     7319
      324     7320
      325     7321    1      RETURN;

   7321  8 000624   000000 702200 xent               TSX2  ! X66_ARET

      326     7322        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:68   
      327     7323    1   FTPCMD_INIT: ENTRY ALTRET;

   7323  8 000625   000000 700200 xent  FTPCMD_INIT  TSX0  ! X66_AUTO_0
         8 000626   000066 000000                    ZERO    54,0

      328     7324    1      F$FILE$ = DCBADDR(DCBNUM(F$FILE));

   7324  8 000627   000000 236007 xsym               LDQ     F$FILE,DL
         8 000630   000045 470400 9                  LDP0    37
         8 000631   000000 471500                    LDP1    0,,PR0
         8 000632   100000 236106                    LDQ     0,QL,PR1
         8 000633   000247 756000 1                  STQ     F$FILE$

      329     7325    2      CALL XUG$INIT (XUG_GETCMD, XUG_INIT) WHENALTRETURN DO;

   7325  8 000634   000000 630400 9                  EPPR0   0
         8 000635   000020 631400 xsym               EPPR1   B_VECTNIL+16
         8 000636   000000 701000 xent               TSX1    XUG$INIT
         8 000637   000641 702000 8                  TSX2    s:7326
         8 000640   000643 710000 8                  TRA     s:7328

      330     7326    2          CALL M$XXX;

   7326  8 000641   000003 713400                    CLIMB   3
         8 000642   000000 401760                    pmme    nvectors=0

      331     7327    2          END;

      332     7328    1      CALL M$INT(FPT_INT);

   7328  8 000643   000002 630400 2                  EPPR0   FPT_INT
         8 000644   010002 713400                    CLIMB   4098
         8 000645   400000 401760                    pmme    nvectors=1

      333     7329    2      DO INHIBIT;

      334     7330    2          CALL XUG$CLRENABLE(XUG_GETCMD);
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:69   

   7330  8 000646   000000 630600 9                  EPPR0 ! 0
         8 000647   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
         8 000650   000000 701200 xent               TSX1  ! XUG$CLRENABLE
         8 000651   000000 011200                    NOP   ! 0

      335     7331    2          CALL XUG$DISABLE(XUG_GETCMD);

   7331  8 000652   000000 630600 9                  EPPR0 ! 0
         8 000653   000017 631600 xsym               EPPR1 ! B_VECTNIL+15
         8 000654   000000 701200 xent               TSX1  ! XUG$DISABLE
         8 000655   000000 011200                    NOP   ! 0

      336     7332    2          END;

      337     7333    1      SUBSTR(LINE_BUF,3000)=B$JIT.CCBUF; /* check for hostname on command line */

   7333  8 000656   000000 470400 xsym               LDP0    B$JIT$
         8 000657   040000 100500                    MLR     fill='040'O
         8 000660   000033 000400                    ADSC9   27,,PR0                  cn=0,n=256
         8 000661   001356 002110 xsym               ADSC9   CMD_BUFFER+750           cn=0,n=1096

      338     7334    1      CALL INDEX(CODE,' ',LINE_BUF,3000);

   7334  8 000662   000000 124400                    SCM     mask='000'O
         8 000663   001356 002110 xsym               ADSC9   CMD_BUFFER+750           cn=0,n=1096
         8 000664   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         8 000665   200004 000100                    ARG     CODE,,AUTO
         8 000666   200004 235100                    LDA     CODE,,AUTO
         8 000667   005670 035007                    ADLA    3000,DL
         8 000670   200004 755100                    STA     CODE,,AUTO

      339     7335    2      IF SUBSTR(LINE_BUF,CODE)~=' ' THEN DO;

   7335  8 000671   767777 620005                    EAX0    -4097,AL
         8 000672   777777 660003                    ERX0    -1,DU
         8 000673   040000 106445                    CMPC    fill='040'O
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:70   
         8 000674   000000 000010 xsym               ADSC9   CMD_BUFFER,A             cn=0,n=*X0
         8 000675   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         8 000676   000705 600000 8                  TZE     s:7339

      340     7336    2          SUBSTR(LINE_BUF,3000,CODE-3000)='OPEN';

   7336  8 000677   772110 621005                    EAX1    -3000,AL
         8 000700   040040 100400                    MLR     fill='040'O
         8 000701   000642 000004 2                  ADSC9   FMT+34                   cn=0,n=4
         8 000702   001356 000011 xsym               ADSC9   CMD_BUFFER+750           cn=0,n=*X1

      341     7337    2          XUG_GETCMD.TEXT_=VECTOR(SUBSTR(LINE_BUF,3000,200));

   7337  8 000703   000046 237000 9                  LDAQ    38
         8 000704   000072 757000 1                  STAQ    XUG_GETCMD+28

      342     7338    2          END;

      343     7339    1      RETURN;

   7339  8 000705   000000 702200 xent               TSX2  ! X66_ARET

      344     7340
      345     7341    1   FTPBREAK: ENTRY ALTRET;

   7341  8 000706   000000 700200 xent  FTPBREAK     TSX0  ! X66_AUTO_0
         8 000707   000066 000000                    ZERO    54,0

      346     7342    1      CALL XUG$DISABLE(XUG_GETCMD);

   7342  8 000710   000000 630400 9                  EPPR0   0
         8 000711   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 000712   000000 701000 xent               TSX1    XUG$DISABLE
         8 000713   000000 011000                    NOP     0

      347     7343    1      UNWIND TO BREAK_MEM;

PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:71   
   7343  8 000714   000110 237200 1                  LDAQ  ! BREAK_MEM
         8 000715   000000 700200 xent               TSX0  ! X66_AUNWIND
         8 000716   000000 000200                    ZERO    0,128

      348     7344
      349     7345    1   SETBREAK: PROC ALTRET; /* Routine to overcome PL-6'S internal procs problem */

   7345  8 000717   200020 741300       SETBREAK     STX1  ! CURSIZ+2,,AUTO

      350     7346    2   DCL P$ PTR;
      351     7347    2   DCL HW UBIN(18) BASED ALIGNED;
      352     7348    2      P$ = ADDR(BREAK_MEM);

   7348  8 000720   000050 236000 9                  LDQ     40
         8 000721   200021 756100                    STQ     P$,,AUTO

      353     7349    2      ADDR(P$)->HW = PINCRW(ADDR(P$),-1)->HW; /* Point to ALTRET instruction */

   7349  8 000722   200020 220100                    LDX0    CURSIZ+2,,AUTO
         8 000723   200021 740100                    STX0    P$,,AUTO

      354     7350    2      PINCRW(ADDR(BREAK_MEM),1)->HW = P$->HW; /* Set unwind addr to altret addr */

   7350  8 000724   200021 470500                    LDP0    P$,,AUTO
         8 000725   000000 222100                    LDX2    0,,PR0
         8 000726   000111 742000 1                  STX2    BREAK_MEM+1

      355     7351    2      CALL XUG$ENABLE(XUG_GETCMD);

   7351  8 000727   000000 630400 9                  EPPR0   0
         8 000730   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 000731   000000 701000 xent               TSX1    XUG$ENABLE
         8 000732   000000 011000                    NOP     0

      356     7352    2   END SETBREAK;

   7352  8 000733   200020 221300                    LDX1  ! CURSIZ+2,,AUTO
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:72   
         8 000734   000001 702211                    TSX2  ! 1,X1

      357     7353
      358     7354        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:73   
      359     7355    1   TYPE_CMD: PROC (CMDO) ALTRET;

   7355  8 000735   200012 741300       TYPE_CMD     STX1  ! @LFID+1,,AUTO

      360     7356    2   DCL CMDO CHAR(1);
      361     7357    2   DCL CMDT CHAR(0) CONSTANT INIT('TYPE ');
      362     7358
      363     7359    2      CALL TCP$WRITE_D (CMD_LCN, VECTOR(CMDT));

   7359  8 000736   000054 630400 9                  EPPR0   44
         8 000737   000020 631400 xsym               EPPR1   B_VECTNIL+16
         8 000740   000000 701000 xent               TSX1    TCP$WRITE_D
         8 000741   000000 011000                    NOP     0

      364     7360    2      CALL TCP$WRITE_D (CMD_LCN, VECTOR(CMDO));

   7360  8 000742   177640 235007                    LDA     65440,DL
         8 000743   200013 236100                    LDQ     @CMDO,,AUTO
         8 000744   200052 757100                    STAQ    DAT+3,,AUTO
         8 000745   200052 630500                    EPPR0   DAT+3,,AUTO
         8 000746   200055 450500                    STP0    DAT+6,,AUTO
         8 000747   000014 236000 9                  LDQ     12
         8 000750   200054 756100                    STQ     DAT+5,,AUTO
         8 000751   200054 630500                    EPPR0   DAT+5,,AUTO
         8 000752   000020 631400 xsym               EPPR1   B_VECTNIL+16
         8 000753   000000 701000 xent               TSX1    TCP$WRITE_D
         8 000754   000000 011000                    NOP     0

      365     7361    2      CALL TELNET_EOL(CMD_LCN);

   7361  8 000755   000014 630400 9                  EPPR0   12
         8 000756   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 000757   000000 701000 xent               TSX1    TELNET_EOL
         8 000760   000000 011000                    NOP     0

      366     7362    3      CALL GET_RESPONSE(CMD_LCN,RCODE,VERBOSE) WHENALTRETURN DO;

PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:74   
   7362  8 000761   000056 630400 9                  EPPR0   46
         8 000762   000021 631400 xsym               EPPR1   B_VECTNIL+17
         8 000763   000000 701000 xent               TSX1    GET_RESPONSE
         8 000764   000766 702000 8                  TSX2    s:7363
         8 000765   000772 710000 8                  TRA     s:7366

      367     7363    3          GLOBAL_ERR = %FTP_PROCEDURE_ERR;              /*N* REPORT ERROR */

   7363  8 000766   000002 235007                    LDA     2,DL
         8 000767   000200 755000 1                  STA     GLOBAL_ERR

      368     7364    3          ALTRETURN;

   7364  8 000770   200012 221300                    LDX1  ! @LFID+1,,AUTO
         8 000771   000000 702211                    TSX2  ! 0,X1

      369     7365    3          END;
      370     7366    2      IF RCODE.A ~= '2'

   7366  8 000772   000172 236000 1                  LDQ     RCODE
         8 000773   777000 376003                    ANQ     -512,DU
         8 000774   062000 116003                    CMPQ    25600,DU
         8 000775   001002 600000 8                  TZE     s:7371

      371     7367    3      THEN DO;

      372     7368    3          GLOBAL_ERR=1;

   7368  8 000776   000001 235007                    LDA     1,DL
         8 000777   000200 755000 1                  STA     GLOBAL_ERR

      373     7369    3          ALTRETURN;

   7369  8 001000   200012 221300                    LDX1  ! @LFID+1,,AUTO
         8 001001   000000 702211                    TSX2  ! 0,X1

      374     7370    3          END;
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:75   
      375     7371    2      RETURN;

   7371  8 001002   200012 221300                    LDX1  ! @LFID+1,,AUTO
         8 001003   000001 702211                    TSX2  ! 1,X1

      376     7372    2   END TYPE_CMD;
      377     7373
      378     7374
      379     7375    1   DISP_TOGGLE: PROC;

   7375  8 001004   200006 741300       DISP_TOGGLE  STX1  ! CODE+2,,AUTO

      380     7376
      381     7377    2      SUBSTR( LINE_BUF,0,20) = TOGTXT( CODE);

   7377  8 001005   200004 235100                    LDA     CODE,,AUTO
         8 001006   000004 735000                    ALS     4
         8 001007   040000 100405                    MLR     fill='040'O
         8 001010   000104 000020 2                  ADSC9   TOGTXT,A                 cn=0,n=16
         8 001011   000000 000024 xsym               ADSC9   CMD_BUFFER               cn=0,n=20

      382     7378    2      IF (TOGOPTS( CODE) = '0'B) = (CODE = %FTP_OPT_PASV)

   7378  8 001012   400000 220003                    LDX0    -131072,DU
         8 001013   200004 722100                    LXL2    CODE,,AUTO
         8 001014   000450 235012 1                  LDA     BELL,X2
         8 001015   001017 600000 8                  TZE     s:7378+5
         8 001016   000000 220003                    LDX0    0,DU
         8 001017   400000 223003                    LDX3    -131072,DU
         8 001020   200004 236100                    LDQ     CODE,,AUTO
         8 001021   000003 116007                    CMPQ    3,DL
         8 001022   001024 600000 8                  TZE     s:7378+10
         8 001023   000000 223003                    LDX3    0,DU
         8 001024   000000 636010                    EAQ     0,X0
         8 001025   200052 756100                    STQ     DAT+3,,AUTO
         8 001026   000000 636013                    EAQ     0,X3
         8 001027   200053 756100                    STQ     DAT+4,,AUTO
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:76   
         8 001030   000100 106500                    CMPC    fill='000'O
         8 001031   200052 000004                    ADSC9   DAT+3,,AUTO              cn=0,n=4
         8 001032   200053 000004                    ADSC9   DAT+4,,AUTO              cn=0,n=4
         8 001033   001041 601000 8                  TNZ     s:7380

      383     7379    2      THEN SUBSTR( LINE_BUF,20,4) = 'on.';

   7379  8 001034   000643 236000 2                  LDQ     FMT+35
         8 001035   000044 376000 9                  ANQ     36
         8 001036   000040 276007                    ORQ     32,DL
         8 001037   000005 756000 xsym               STQ     CMD_BUFFER+5
         8 001040   001043 710000 8                  TRA     s:7381

      384     7380    2      ELSE SUBSTR( LINE_BUF,20,4) = 'off.';

   7380  8 001041   000644 236000 2                  LDQ     FMT+36
         8 001042   000005 756000 xsym               STQ     CMD_BUFFER+5

      385     7381    2      CALL INDEX (BYTES, '.', SUBSTR( LINE_BUF,0,16));

   7381  8 001043   000000 124400                    SCM     mask='000'O
         8 001044   000000 000020 xsym               ADSC9   CMD_BUFFER               cn=0,n=16
         8 001045   000061 000001 9                  ADSC9   49                       cn=0,n=1
         8 001046   000227 000000 1                  ARG     BYTES

      386     7382    2      SUBSTR( LINE_BUF,BYTES,4) = SUBSTR( LINE_BUF,20,4);

   7382  8 001047   000227 235000 1                  LDA     BYTES
         8 001050   040005 100400                    MLR     fill='040'O
         8 001051   000005 000004 xsym               ADSC9   CMD_BUFFER+5             cn=0,n=4
         8 001052   000000 000004 xsym               ADSC9   CMD_BUFFER,A             cn=0,n=4

      387     7383    2      WRITE_LO.BUF_ = VECTOR( SUBSTR( LINE_BUF,0,20));

   7383  8 001053   000062 237000 9                  LDAQ    50
         8 001054   000004 757000 xsym               STAQ    WRITE_LO+4

PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:77   
      388     7384    2      CALL M$WRITE( WRITE_LO);

   7384  8 001055   000000 630400 xsym               EPPR0   WRITE_LO
         8 001056   040001 713400                    CLIMB   write
         8 001057   401400 401760                    pmme    nvectors=4

      389     7385    2   END DISP_TOGGLE;

   7385  8 001060   200006 221300                    LDX1  ! CODE+2,,AUTO
         8 001061   000001 702211                    TSX2  ! 1,X1

      390     7386        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:78   
      391     7387    1   MFILE_CMD: PROC;

   7387  8 001062   200006 741300       MFILE_CMD    STX1  ! CODE+2,,AUTO

      392     7388        %FPT_OPEN (DCB=M$MFILE, FPTN=OPNSCRATCH,
      393     7389                   STCLASS=CONSTANT, DISP=SCRATCH, ASN=FILE, SCRUB=YES, FUN=CREATE);
      394     7498        %FPT_OPEN (DCB=M$MFILE, FPTN=OPNSTAR,
      395     7499                   STCLASS=CONSTANT, NAME=STARFTP, ASN=FILE, SCRUB=YES);
      396     7608        %VLP_NAME (FPTN=STARFTP, NAME='*ftp', STCLASS=CONSTANT);
      397     7635        %FPT_CLOSE (DCB=M$MFILE, STCLASS=CONSTANT);
      398     7677    2   DCL 1 NAMBUF STATIC,
      399     7678    2      2 COUNT UBIN BYTE UNAL,
      400     7679    2      2 TEXT CHAR(255);
      401     7680        %FPT_READ (DCB=M$MFILE, STCLASS=CONSTANT, BUF=NAMBUF.TEXT);
      402     7719    2   DCL SAVERBOSE BIT(36);
      403     7720        %FPT_LINK (STCLASS=CONSTANT, NAME=VLP_PCL, ACCT=VLP_SYS, CMD=NAMBUF);
      404     7738        %VLP_NAME (FPTN=VLP_PCL, STCLASS=CONSTANT, NAME='PCL');
      405     7765        %VLP_ACCT (FPTN=VLP_SYS, STCLASS=CONSTANT, ACCT=':SYS');
      406     7778        %FPT_PROMPT (FPTN=TFIDPROMPT, PROMPT=TFID.TEXT);
      407     7806        %FPT_READ (FPTN=TFIDREAD, DCB=M$UC, BUF=TFID.TEXT);
      408     7845
      409     7846    2      SAVERBOSE=VERBOSE;

   7846  8 001063   000455 236000 1                  LDQ     VERBOSE
         8 001064   200007 756100                    STQ     SAVERBOSE,,AUTO

      410     7847    3      IF CODE=%FTP_CMD_MPUT THEN DO;

   7847  8 001065   200004 235100                    LDA     CODE,,AUTO
         8 001066   000012 115007                    CMPA    10,DL
         8 001067   001135 601000 8                  TNZ     s:7862

      411     7848    3          NAMBUF.COUNT=255;

   7848  8 001070   377000 236003                    LDQ     130560,DU
         8 001071   000463 552040 1                  STBQ    NAMBUF,'40'O

PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:79   
      412     7849    3          NAMBUF.TEXT='L(C=0,FF)';

   7849  8 001072   040000 100400                    MLR     fill='040'O
         8 001073   000645 000011 2                  ADSC9   FMT+37                   cn=0,n=9
         8 001074   000463 200377 1                  ADSC9   NAMBUF                   cn=1,n=255

      413     7850    3          IF OUT$BLK.NSUBLKS>0

   7850  8 001075   200003 470500                    LDP0    PARSE$,,AUTO
         8 001076   000001 220100                    LDX0    1,,PR0
         8 001077   001107 600000 8                  TZE     s:7852

      414     7851    3          THEN SUBSTR(NAMBUF.TEXT,9)=OUT$BLK.SUBLK$(0)->OUT$SYM.TEXT;

   7851  8 001100   000003 471500                    LDP1    3,,PR0
         8 001101   100004 236100                    LDQ     4,,PR1
         8 001102   000033 772000                    QRL     27
         8 001103   000000 622006                    EAX2    0,QL
         8 001104   040000 100540                    MLR     fill='040'O
         8 001105   100004 200012                    ADSC9   4,,PR1                   cn=1,n=*X2
         8 001106   000465 400366 1                  ADSC9   NAMBUF+2                 cn=2,n=246

      415     7852    3          SUBSTR(NAMBUF.TEXT,240)=' OVER *ftp(nsu)';

   7852  8 001107   040000 100400                    MLR     fill='040'O
         8 001110   000650 000017 2                  ADSC9   FMT+40                   cn=0,n=15
         8 001111   000557 200017 1                  ADSC9   NAMBUF+60                cn=1,n=15

      416     7853    3          CALL M$LINK (FPT_LINK) ALTRET (RETRET);

   7853  8 001112   000440 630400 2                  EPPR0   FPT_LINK
         8 001113   400005 713400                    CLIMB   alt,+5
         8 001114   403000 401760                    pmme    nvectors=7
         8 001115   001125 702000 8                  TSX2    RETRET

      417     7854    4          CALL M$OPEN (OPNSTAR) WHENALTRETURN DO;

PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:80   
   7854  8 001116   000270 630400 2                  EPPR0   OPNSTAR
         8 001117   450000 713400                    CLIMB   alt,open
         8 001120   410400 401760                    pmme    nvectors=18
         8 001121   001123 702000 8                  TSX2    REPALT
         8 001122   001134 710000 8                  TRA     s:7860

      418     7855    4   REPALT:    CALL REPORT_ALT;

   7855  8 001123   003520 701000 8     REPALT       TSX1    REPORT_ALT
         8 001124   000000 011000                    NOP     0

      419     7856    4   RETRET:    VERBOSE=SAVERBOSE;

   7856  8 001125   200007 236100       RETRET       LDQ     SAVERBOSE,,AUTO
         8 001126   000455 756000 1                  STQ     VERBOSE

      420     7857    4              CALL M$CLOSE (FPT_CLOSE);

   7857  8 001127   000364 630400 2                  EPPR0   FPT_CLOSE
         8 001130   050001 713400                    CLIMB   close
         8 001131   406000 401760                    pmme    nvectors=13

      421     7858    4              RETURN;

   7858  8 001132   200006 221300                    LDX1  ! CODE+2,,AUTO
         8 001133   000001 702211                    TSX2  ! 1,X1

      422     7859    4              END;
      423     7860    3          END;

   7860  8 001134   001153 710000 8                  TRA     NXTNAM

      424     7861    3      ELSE DO;

      425     7862    3          CALL M$OPEN (OPNSCRATCH) ALTRET (REPALT);

   7862  8 001135   000176 630400 2                  EPPR0   OPNSCRATCH
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:81   
         8 001136   450000 713400                    CLIMB   alt,open
         8 001137   410400 401760                    pmme    nvectors=18
         8 001140   001123 702000 8                  TSX2    REPALT

      426     7863    3          VERBOSE='0'B;

   7863  8 001141   000455 450000 1                  STZ     VERBOSE

      427     7864    3          CALL LIST_CMD ('NLST') ALTRET (RETRET);

   7864  8 001142   000007 236000 9                  LDQ     7
         8 001143   200011 756100                    STQ     SAVERBOSE+2,,AUTO
         8 001144   001374 701000 8                  TSX1    LIST_CMD
         8 001145   001125 702000 8                  TSX2    RETRET

      428     7865    3          VERBOSE=SAVERBOSE;

   7865  8 001146   200007 236100                    LDQ     SAVERBOSE,,AUTO
         8 001147   000455 756000 1                  STQ     VERBOSE

      429     7866    3          CALL M$REW (FPT_CLOSE);

   7866  8 001150   000364 630400 2                  EPPR0   FPT_CLOSE
         8 001151   040006 713400                    CLIMB   16390
         8 001152   400000 401760                    pmme    nvectors=1

      430     7867    3          END;

      431     7868
      432     7869    3      DO WHILE '1'B;

   7862  8 001153                       NXTNAM       null
      433     7870    3   NXTNAM: ;
      434     7871    3          CALL SETBREAK ALTRET(RETRET);

   7871  8 001153   000717 701000 8                  TSX1    SETBREAK
         8 001154   001125 702000 8                  TSX2    RETRET
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:82   

      435     7872    3          CALL M$READ (FPT_READ) ALTRET (RETRET);

   7872  8 001155   000422 630400 2                  EPPR0   FPT_READ
         8 001156   440000 713400                    CLIMB   alt,read
         8 001157   401400 401760                    pmme    nvectors=4
         8 001160   001125 702000 8                  TSX2    RETRET

      436     7873    3          CALL XUG$DISABLE(XUG_GETCMD);

   7873  8 001161   000000 630400 9                  EPPR0   0
         8 001162   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 001163   000000 701000 xent               TSX1    XUG$DISABLE
         8 001164   000000 011000                    NOP     0

      437     7874    3          NAMBUF.COUNT=DCBADDR(DCBNUM(M$MFILE))->F$DCB.ARS#;

   7874  8 001165   000000 236007 xsym               LDQ     M$MFILE,DL
         8 001166   000045 470400 9                  LDP0    37
         8 001167   000000 471500                    LDP1    0,,PR0
         8 001170   100000 473506                    LDP3    0,QL,PR1
         8 001171   300000 236100                    LDQ     0,,PR3
         8 001172   000033 736000                    QLS     27
         8 001173   000463 552040 1                  STBQ    NAMBUF,'40'O

      438     7875    3          TFID.COUNT=0;

   7875  8 001174   000000 236003                    LDQ     0,DU
         8 001175   000201 552040 1                  STBQ    TFID,'40'O

      439     7876    4          IF MPROMPT AND B$JIT.MODE=%M_INT# THEN DO;

   7876  8 001176   000456 235000 1                  LDA     MPROMPT
         8 001177   001317 600000 8                  TZE     s:7894
         8 001200   000000 473400 xsym               LDP3    B$JIT$
         8 001201   300000 236100                    LDQ     0,,PR3
         8 001202   740000 376003                    ANQ     -16384,DU
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:83   
         8 001203   140000 116003                    CMPQ    49152,DU
         8 001204   001317 601000 8                  TNZ     s:7894

      440     7877    4              TFID=NAMBUF;

   7877  8 001205   000000 100400                    MLR     fill='000'O
         8 001206   000463 000120 1                  ADSC9   NAMBUF                   cn=0,n=80
         8 001207   000201 000120 1                  ADSC9   TFID                     cn=0,n=80

      441     7878    4              SUBSTR(TFID.TEXT,TFID.COUNT)='? (n/q/newname)';

   7878  8 001210   000201 236000 1                  LDQ     TFID
         8 001211   000033 772000                    QRL     27
         8 001212   777660 620006                    EAX0    -80,QL
         8 001213   777777 660003                    ERX0    -1,DU
         8 001214   040046 100400                    MLR     fill='040'O
         8 001215   000654 000017 2                  ADSC9   FMT+44                   cn=0,n=15
         8 001216   000201 200010 1                  ADSC9   TFID,Q                   cn=1,n=*X0

      442     7879    4              VBOUND(TFIDPROMPT.PROMPT_)=TFID.COUNT+14;

   7879  8 001217   000201 236000 1                  LDQ     TFID
         8 001220   000033 772000                    QRL     27
         8 001221   000016 036007                    ADLQ    14,DL
         8 001222   000020 736000                    QLS     16
         8 001223   000570 676000 1                  ERQ     TFIDPROMPT+4
         8 001224   000034 376000 xsym               ANQ     B_VECTNIL+28
         8 001225   000570 656000 1                  ERSQ    TFIDPROMPT+4

      443     7880    5              IF CODE=%FTP_CMD_MDEL THEN DO; /* no "newname" for mdel */

   7880  8 001226   200004 235100                    LDA     CODE,,AUTO
         8 001227   000025 115007                    CMPA    21,DL
         8 001230   001247 601000 8                  TNZ     s:7884

      444     7881    5                  SUBSTR(TFID.TEXT,TFID.COUNT)='? (n/q)';

PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:84   
   7881  8 001231   000201 236000 1                  LDQ     TFID
         8 001232   000033 772000                    QRL     27
         8 001233   777660 620006                    EAX0    -80,QL
         8 001234   777777 660003                    ERX0    -1,DU
         8 001235   040046 100400                    MLR     fill='040'O
         8 001236   000660 000007 2                  ADSC9   FMT+48                   cn=0,n=7
         8 001237   000201 200010 1                  ADSC9   TFID,Q                   cn=1,n=*X0

      445     7882    5                  VBOUND(TFIDPROMPT.PROMPT_)=TFID.COUNT+6;

   7882  8 001240   000201 236000 1                  LDQ     TFID
         8 001241   000033 772000                    QRL     27
         8 001242   000006 036007                    ADLQ    6,DL
         8 001243   000020 736000                    QLS     16
         8 001244   000570 676000 1                  ERQ     TFIDPROMPT+4
         8 001245   000034 376000 xsym               ANQ     B_VECTNIL+28
         8 001246   000570 656000 1                  ERSQ    TFIDPROMPT+4

      446     7883    5                  END;

      447     7884    4              CALL M$PROMPT (TFIDPROMPT);

   7884  8 001247   000564 630400 1                  EPPR0   TFIDPROMPT
         8 001250   160002 713400                    CLIMB   57346
         8 001251   401000 401760                    pmme    nvectors=3

      448     7885    5              CALL M$READ (TFIDREAD) WHENALTRETURN DO; END;

   7885  8 001252   000576 630400 1                  EPPR0   TFIDREAD
         8 001253   440000 713400                    CLIMB   alt,read
         8 001254   401400 401760                    pmme    nvectors=4
         8 001255   001257 702000 8                  TSX2    s:7886
         8 001256   001257 710000 8                  TRA     s:7886

      449     7886    4              TFID.COUNT=DCBADDR(DCBNUM(M$UC))->F$DCB.ARS#;

   7886  8 001257   000000 236007 xsym               LDQ     M$UC,DL
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:85   
         8 001260   000045 470400 9                  LDP0    37
         8 001261   000000 471500                    LDP1    0,,PR0
         8 001262   100000 473506                    LDP3    0,QL,PR1
         8 001263   300000 236100                    LDQ     0,,PR3
         8 001264   000033 736000                    QLS     27
         8 001265   000201 552040 1                  STBQ    TFID,'40'O

      450     7887    4              IF TFID.COUNT=0 THEN EXIT;

   7887  8 001266   000201 236000 1                  LDQ     TFID
         8 001267   777000 316003                    CANQ    -512,DU
         8 001270   001317 600000 8                  TZE     s:7894

      451     7888    4              IF TFID.COUNT=1 THEN IF SUBSTR(TFID.TEXT,0,1)='q'

   7888  8 001271   000201 236000 1                  LDQ     TFID
         8 001272   777000 376003                    ANQ     -512,DU
         8 001273   001000 116003                    CMPQ    512,DU
         8 001274   001317 601000 8                  TNZ     s:7894

   7888  8 001275   000201 236000 1                  LDQ     TFID
         8 001276   000777 376003                    ANQ     511,DU
         8 001277   000161 116003                    CMPQ    113,DU
         8 001300   001125 600000 8                  TZE     RETRET
         8 001301   000201 236000 1                  LDQ     TFID
         8 001302   000777 376003                    ANQ     511,DU
         8 001303   000121 116003                    CMPQ    81,DU
         8 001304   001125 600000 8                  TZE     RETRET

      452     7889    4                OR SUBSTR(TFID.TEXT,0,1)='Q' THEN GOTO RETRET;
      453     7890    4              ELSE IF SUBSTR(TFID.TEXT,0,1)='n'

   7890  8 001305   000201 236000 1                  LDQ     TFID
         8 001306   000777 376003                    ANQ     511,DU
         8 001307   000156 116003                    CMPQ    110,DU
         8 001310   001153 600000 8                  TZE     NXTNAM
         8 001311   000201 236000 1                  LDQ     TFID
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:86   
         8 001312   000777 376003                    ANQ     511,DU
         8 001313   000116 116003                    CMPQ    78,DU
         8 001314   001153 600000 8                  TZE     NXTNAM

      454     7891    4                OR SUBSTR(TFID.TEXT,0,1)='N' THEN GOTO NXTNAM;
      455     7892    4              ELSE TFID.COUNT=0;

   7892  8 001315   000000 236003                    LDQ     0,DU
         8 001316   000201 552040 1                  STBQ    TFID,'40'O

      456     7893    4              END;

      457     7894    3          IF CODE=%FTP_CMD_MDEL THEN CALL SIMPLE_CMD ('DELE', NAMBUF);

   7894  8 001317   200004 235100                    LDA     CODE,,AUTO
         8 001320   000025 115007                    CMPA    21,DL
         8 001321   001331 601000 8                  TNZ     s:7895

   7894  8 001322   000064 236000 9                  LDQ     52
         8 001323   200044 756100                    STQ     @ADDRESS+1,,AUTO
         8 001324   000023 236000 9                  LDQ     19
         8 001325   200043 756100                    STQ     FMT_OUTL+2,,AUTO
         8 001326   001670 701000 8                  TSX1    SIMPLE_CMD
         8 001327   000000 011000                    NOP     0
         8 001330   001153 710000 8                  TRA     NXTNAM

      458     7895    3          ELSE IF CODE=%FTP_CMD_MPUT

   7895  8 001331   000012 115007                    CMPA    10,DL
         8 001332   001342 601000 8                  TNZ     s:7897

      459     7896    3          THEN CALL PUT_CMD (NAMBUF, LOPT_OVER, TFID);

   7896  8 001333   000032 237000 9                  LDAQ    26
         8 001334   200012 757100                    STAQ    @LFID+1,,AUTO
         8 001335   000064 236000 9                  LDQ     52
         8 001336   200011 756100                    STQ     SAVERBOSE+2,,AUTO
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:87   
         8 001337   002475 701000 8                  TSX1    PUT_CMD
         8 001340   000000 011000                    NOP     0
         8 001341   001153 710000 8                  TRA     NXTNAM

      460     7897    3          ELSE IF CODE~=%FTP_CMD_MGET THEN GOTO RETRET; /* Break hit */

   7897  8 001342   000005 115007                    CMPA    5,DL
         8 001343   001125 601000 8                  TNZ     RETRET

      461     7898    4          ELSE DO;

      462     7899    5              IF SUBSTR(NAMBUF.TEXT,0,2)='./' THEN DO;

   7899  8 001344   040000 106400                    CMPC    fill='040'O
         8 001345   000463 200002 1                  ADSC9   NAMBUF                   cn=1,n=2
         8 001346   000662 000002 2                  ADSC9   FMT+50                   cn=0,n=2
         8 001347   001356 601000 8                  TNZ     s:7903

      463     7900    5                  NAMBUF.TEXT=SUBSTR(NAMBUF.TEXT,2);

   7900  8 001350   040000 100400                    MLR     fill='040'O
         8 001351   000463 600375 1                  ADSC9   NAMBUF                   cn=3,n=253
         8 001352   000463 200377 1                  ADSC9   NAMBUF                   cn=1,n=255

      464     7901    5                  NAMBUF.COUNT=NAMBUF.COUNT-2;

   7901  8 001353   000463 236000 1                  LDQ     NAMBUF
         8 001354   776000 036003                    ADLQ    -1024,DU
         8 001355   000463 552040 1                  STBQ    NAMBUF,'40'O

      465     7902    5                  END;

      466     7903    4              IF TFID.COUNT=0 THEN CALL LINE_SUB (NAMBUF);

   7903  8 001356   000201 236000 1                  LDQ     TFID
         8 001357   777000 316003                    CANQ    -512,DU
         8 001360   001365 601000 8                  TNZ     s:7904
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:88   

   7903  8 001361   000064 236000 9                  LDQ     52
         8 001362   200015 756100                    STQ     @ONOVER+1,,AUTO
         8 001363   003551 701000 8                  TSX1    LINE_SUB
         8 001364   000000 011000                    NOP     0

      467     7904    4              CALL GET_CMD (NAMBUF, LOPT_OVER, TFID);

   7904  8 001365   000032 237000 9                  LDAQ    26
         8 001366   200014 757100                    STAQ    @RFID+1,,AUTO
         8 001367   000064 236000 9                  LDQ     52
         8 001370   200013 756100                    STQ     @CMDO,,AUTO
         8 001371   002015 701000 8                  TSX1    GET_CMD
         8 001372   000000 011000                    NOP     0

      468     7905    4              END;

      469     7906    3          END;

   7906  8 001373   001153 710000 8                  TRA     NXTNAM

      470     7907    2   END MFILE_CMD;
      471     7908        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:89   
      472     7909    1   LIST_CMD: PROC (CMDT) ALTRET;

   7909  8 001374   200010 741300       LIST_CMD     STX1  ! SAVERBOSE+1,,AUTO

      473     7910    2   DCL CMDT CHAR(4);
      474     7911    2   DCL OK BIT(1) STATIC;
      475     7912    2   DCL ARS UBIN(36) STATIC;
      476     7913
      477     7914    2      GLOBAL_ERR = 0;

   7914  8 001375   000200 450000 1                  STZ     GLOBAL_ERR

      478     7915    3      IF OUT$BLK.NSUBLKS=3 THEN DO;

   7915  8 001376   200003 470500                    LDP0    PARSE$,,AUTO
         8 001377   000001 220100                    LDX0    1,,PR0
         8 001400   000003 100003                    CMPX0   3,DU
         8 001401   001425 601000 8                  TNZ     s:7920

      479     7916    3          CALL GET_CMD (,OUT$BLK.SUBLK$(1)->OUT$BLK.CODE,

   7916  8 001402   000004 471500                    LDP1    4,,PR0
         8 001403   000005 473500                    LDP3    5,,PR0
         8 001404   300004 634500                    EPPR4   4,,PR3
         8 001405   200015 454500                    STP4    @ONOVER+1,,AUTO
         8 001406   200052 451500                    STP1    DAT+3,,AUTO
         8 001407   200052 236100                    LDQ     DAT+3,,AUTO
         8 001410   400000 036007                    ADLQ    -131072,DL
         8 001411   200014 756100                    STQ     @RFID+1,,AUTO
         8 001412   000001 236000 xsym               LDQ     B_VECTNIL+1
         8 001413   200013 756100                    STQ     @CMDO,,AUTO
         8 001414   002015 701000 8                  TSX1    GET_CMD
         8 001415   001417 702000 8                  TSX2    s:7917
         8 001416   001421 710000 8                  TRA     s:7918

      480     7917    4            OUT$BLK.SUBLK$(2)->OUT$SYM.COUNT) WHENALTRETURN DO; ALTRETURN; END;

PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:90   
   7917  8 001417   200010 221300                    LDX1  ! SAVERBOSE+1,,AUTO
         8 001420   000000 702211                    TSX2  ! 0,X1

      481     7918    3          WRITE_DATA.V.DCB# = DCBNUM(F$FILE);

   7918  8 001421   000000 236007 xsym               LDQ     F$FILE,DL
         8 001422   000000 620006                    EAX0    0,QL
         8 001423   000166 740000 1                  STX0    WRITE_DATA+8

      482     7919    3          END;

   7919  8 001424   001441 710000 8                  TRA     s:7924

      483     7920    2      ELSE IF CODE=%FTP_CMD_MGET OR CODE=%FTP_CMD_MDEL

   7920  8 001425   200004 235100                    LDA     CODE,,AUTO
         8 001426   000005 115007                    CMPA    5,DL
         8 001427   001432 600000 8                  TZE     s:7921
         8 001430   000025 115007                    CMPA    21,DL
         8 001431   001436 601000 8                  TNZ     s:7922

      484     7921    2      THEN WRITE_DATA.V.DCB# = DCBNUM(M$MFILE);

   7921  8 001432   000000 236007 xsym               LDQ     M$MFILE,DL
         8 001433   000000 622006                    EAX2    0,QL
         8 001434   000166 742000 1                  STX2    WRITE_DATA+8
         8 001435   001441 710000 8                  TRA     s:7924

      485     7922    2      ELSE WRITE_DATA.V.DCB# = DCBNUM(M$LO);

   7922  8 001436   000000 236007 xsym               LDQ     M$LO,DL
         8 001437   000000 622006                    EAX2    0,QL
         8 001440   000166 742000 1                  STX2    WRITE_DATA+8

      486     7923
      487     7924    2      IF FILE_TYPE ~= %FTP_OPT_ASCII THEN CALL TYPE_CMD('A');

PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:91   
   7924  8 001441   000446 235000 1                  LDA     FILE_TYPE
         8 001442   001447 600000 8                  TZE     s:7926

   7924  8 001443   000041 236000 9                  LDQ     33
         8 001444   200013 756100                    STQ     @CMDO,,AUTO
         8 001445   000735 701000 8                  TSX1    TYPE_CMD
         8 001446   000000 011000                    NOP     0

      488     7925
      489     7926    2      CALL OPEN_DATA_PORT ALTRET(RETALT);

   7926  8 001447   003172 701000 8                  TSX1    OPEN_DATA_PORT
         8 001450   001633 702000 8                  TSX2    RETALT

      490     7927
      491     7928    2      CALL TCP$WRITE_D (CMD_LCN, VECTOR(CMDT));

   7928  8 001451   777640 235007                    LDA     -96,DL
         8 001452   200011 236100                    LDQ     @CMDT,,AUTO
         8 001453   200052 757100                    STAQ    DAT+3,,AUTO
         8 001454   200052 630500                    EPPR0   DAT+3,,AUTO
         8 001455   200055 450500                    STP0    DAT+6,,AUTO
         8 001456   000014 236000 9                  LDQ     12
         8 001457   200054 756100                    STQ     DAT+5,,AUTO
         8 001460   200054 630500                    EPPR0   DAT+5,,AUTO
         8 001461   000020 631400 xsym               EPPR1   B_VECTNIL+16
         8 001462   000000 701000 xent               TSX1    TCP$WRITE_D
         8 001463   000000 011000                    NOP     0

      492     7929    2      IF OUT$BLK.NSUBLKS~=0

   7929  8 001464   200003 470500                    LDP0    PARSE$,,AUTO
         8 001465   000001 220100                    LDX0    1,,PR0
         8 001466   001515 600000 8                  TZE     s:7935

      493     7930    3      THEN DO;

PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:92   
      494     7931    3          CALL TCP$WRITE_D (CMD_LCN, VECTOR(SPACE));

   7931  8 001467   000070 630400 9                  EPPR0   56
         8 001470   000020 631400 xsym               EPPR1   B_VECTNIL+16
         8 001471   000000 701000 xent               TSX1    TCP$WRITE_D
         8 001472   000000 011000                    NOP     0

      495     7932    3          CALL TCP$WRITE_D

   7932  8 001473   200003 470500                    LDP0    PARSE$,,AUTO
         8 001474   000003 471500                    LDP1    3,,PR0
         8 001475   100004 236100                    LDQ     4,,PR1
         8 001476   000033 772000                    QRL     27
         8 001477   000064 737000                    LLS     52
         8 001500   000140 135007                    SBLA    96,DL
         8 001501   200052 451500                    STP1    DAT+3,,AUTO
         8 001502   200052 236100                    LDQ     DAT+3,,AUTO
         8 001503   000024 036000 9                  ADLQ    20
         8 001504   200054 757100                    STAQ    DAT+5,,AUTO
         8 001505   200054 633500                    EPPR3   DAT+5,,AUTO
         8 001506   200057 453500                    STP3    DAT+8,,AUTO
         8 001507   000014 236000 9                  LDQ     12
         8 001510   200056 756100                    STQ     DAT+7,,AUTO
         8 001511   200056 630500                    EPPR0   DAT+7,,AUTO
         8 001512   000020 631400 xsym               EPPR1   B_VECTNIL+16
         8 001513   000000 701000 xent               TSX1    TCP$WRITE_D
         8 001514   000000 011000                    NOP     0

      496     7933    3           (CMD_LCN, VECTOR(OUT$BLK.SUBLK$(0)->OUT$SYM.TEXT));
      497     7934    3          END;

      498     7935    2      CALL TELNET_EOL(CMD_LCN);

   7935  8 001515   000014 630400 9                  EPPR0   12
         8 001516   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 001517   000000 701000 xent               TSX1    TELNET_EOL
         8 001520   000000 011000                    NOP     0
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:93   

      499     7936    2      CALL GET_RESPONSE(CMD_LCN,RCODE,VERBOSE) ALTRET(RETALT);

   7936  8 001521   000056 630400 9                  EPPR0   46
         8 001522   000021 631400 xsym               EPPR1   B_VECTNIL+17
         8 001523   000000 701000 xent               TSX1    GET_RESPONSE
         8 001524   001633 702000 8                  TSX2    RETALT

      500     7937
      501     7938    2      IF RCODE.A ~= '1'

   7938  8 001525   000172 236000 1                  LDQ     RCODE
         8 001526   777000 376003                    ANQ     -512,DU
         8 001527   061000 116003                    CMPQ    25088,DU
         8 001530   001540 600000 8                  TZE     s:7946

      502     7939    3      THEN DO;

      503     7940    3          GLOBAL_ERR=1;

   7940  8 001531   000001 235007                    LDA     1,DL
         8 001532   000200 755000 1                  STA     GLOBAL_ERR

      504     7941    3          CALL TCP$RELEASE(DATA_LCN);

   7941  8 001533   000072 630400 9                  EPPR0   58
         8 001534   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 001535   000000 701000 xent               TSX1    TCP$RELEASE
         8 001536   000000 011000                    NOP     0

      505     7942    3          END;

   7942  8 001537   001666 710000 8                  TRA     s:7983

      506     7943    3      ELSE DO;

      507     7944                                                /* Read list until it closes */
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:94   
      508     7945                                                /* First, get open */
      509     7946    4          CALL GET_OPEN(DATA_LCN,%TIMEOUT) WHENALTRETURN DO;

   7946  8 001540   000074 236000 9                  LDQ     60
         8 001541   200022 756100                    STQ     @BYTES+1,,AUTO
         8 001542   000072 236000 9                  LDQ     58
         8 001543   200021 756100                    STQ     P$,,AUTO
         8 001544   003052 701000 8                  TSX1    GET_OPEN
         8 001545   001547 702000 8                  TSX2    s:7947
         8 001546   001554 710000 8                  TRA     s:7950

      510     7947    4              CALL TCP$RELEASE(DATA_LCN);

   7947  8 001547   000072 630400 9                  EPPR0   58
         8 001550   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 001551   000000 701000 xent               TSX1    TCP$RELEASE
         8 001552   000000 011000                    NOP     0

      511     7948    4              GOTO RETALT;

   7948  8 001553   001633 710000 8                  TRA     RETALT

      512     7949    4              END;
      513     7950    3          OK='1'B;

   7950  8 001554   400000 236003                    LDQ     -131072,DU
         8 001555   000614 756000 1                  STQ     OK

      514     7951    4          DO WHILE OK;

   7951  8 001556   000614 234000 1                  SZN     OK
         8 001557   001612 605000 8                  TPL     s:7968

      515     7952    4              CALL GET_LINE(DATA_LCN, VECTOR(LINE_BUF), ARS)

   7952  8 001560   000100 630400 9                  EPPR0   64
         8 001561   000021 631400 xsym               EPPR1   B_VECTNIL+17
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:95   
         8 001562   000000 701000 xent               TSX1    GET_LINE
         8 001563   001607 702000 8                  TSX2    s:7965

      516     7953    5              WHENRETURN DO;

      517     7954                                                /* Print it */
      518     7955    5                  CHARNLEN=ARS-2;          /* Don't include crlf*/

   7955  8 001564   000615 235000 1                  LDA     ARS
         8 001565   000002 135007                    SBLA    2,DL
         8 001566   000225 755000 1                  STA     CHARNLEN

      519     7956    5                  IF CHARNLEN=0

   7956  8 001567   001576 601000 8                  TNZ     s:7961

      520     7957    6                  THEN DO;

      521     7958    6                      CHARNLEN=1;

   7958  8 001570   000001 236007                    LDQ     1,DL
         8 001571   000225 756000 1                  STQ     CHARNLEN

      522     7959    6                      LINE_BUF = ' ';

   7959  8 001572   010000 220003                    LDX0    4096,DU
         8 001573   040040 100400                    MLR     fill='040'O
         8 001574   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         8 001575   000000 000010 xsym               ADSC9   CMD_BUFFER               cn=0,n=*X0

      523     7960    6                      END;

      524     7961    5                  WRITE_DATA.BUF_ = VECTOR(ADDR(LINE_BUF)->CHARN);

   7961  8 001576   000225 236000 1                  LDQ     CHARNLEN
         8 001577   000064 737000                    LLS     52
         8 001600   000140 135007                    SBLA    96,DL
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:96   
         8 001601   000063 236000 9                  LDQ     51
         8 001602   000162 757000 1                  STAQ    WRITE_DATA+4

      525     7962    5                  CALL M$WRITE (WRITE_DATA);

   7962  8 001603   000156 630400 1                  EPPR0   WRITE_DATA
         8 001604   040001 713400                    CLIMB   write
         8 001605   401400 401760                    pmme    nvectors=4

      526     7963    5                  END;

   7963  8 001606   001610 710000 8                  TRA     s:7967

      527     7964    5              WHENALTRETURN DO;

      528     7965    5                  OK='0'B;

   7965  8 001607   000614 450000 1                  STZ     OK

      529     7966    5                  END;

      530     7967    4              END;

   7967  8 001610   000614 234000 1                  SZN     OK
         8 001611   001560 604000 8                  TMI     s:7952

      531     7968    3          CALL GET_CLOSE(DATA_LCN,%TIMEOUT);

   7968  8 001612   000074 236000 9                  LDQ     60
         8 001613   200022 756100                    STQ     @BYTES+1,,AUTO
         8 001614   000072 236000 9                  LDQ     58
         8 001615   200021 756100                    STQ     P$,,AUTO
         8 001616   003115 701000 8                  TSX1    GET_CLOSE
         8 001617   000000 011000                    NOP     0

      532     7969    4          CALL GET_RESPONSE(CMD_LCN,RCODE,VERBOSE) WHENRETURN DO;

PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:97   
   7969  8 001620   000056 630400 9                  EPPR0   46
         8 001621   000021 631400 xsym               EPPR1   B_VECTNIL+17
         8 001622   000000 701000 xent               TSX1    GET_RESPONSE
         8 001623   001633 702000 8                  TSX2    RETALT

      533     7970    4              IF RCODE.A ~= '2' THEN GLOBAL_ERR=1;

   7970  8 001624   000172 236000 1                  LDQ     RCODE
         8 001625   777000 376003                    ANQ     -512,DU
         8 001626   062000 116003                    CMPQ    25600,DU
         8 001627   001632 600000 8                  TZE     s:7971

   7970  8 001630   000001 235007                    LDA     1,DL
         8 001631   000200 755000 1                  STA     GLOBAL_ERR

      534     7971    4              END;

   7971  8 001632   001635 710000 8                  TRA     s:7975

      535     7972    4          WHENALTRETURN DO;

      536     7973    4   RETALT:    GLOBAL_ERR = %FTP_PROCEDURE_ERR;             /*N* REPORT ERROR */

   7973  8 001633   000002 235007       RETALT       LDA     2,DL
         8 001634   000200 755000 1                  STA     GLOBAL_ERR

      537     7974    4              END;

      538     7975    3          IF WRITE_DATA.V.DCB# = DCBNUM(F$FILE)

   7975  8 001635   000000 236007 xsym               LDQ     F$FILE,DL
         8 001636   200052 756100                    STQ     DAT+3,,AUTO
         8 001637   000166 236000 1                  LDQ     WRITE_DATA+8
         8 001640   000022 772000                    QRL     18
         8 001641   200052 116100                    CMPQ    DAT+3,,AUTO
         8 001642   001654 601000 8                  TNZ     s:7978

PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:98   
      539     7976    3          THEN IF GLOBAL_ERR = 0 THEN CALL M$CLOSE (FPT_CLOSE);

   7976  8 001643   000200 235000 1                  LDA     GLOBAL_ERR
         8 001644   001651 601000 8                  TNZ     s:7977

   7976  8 001645   000010 630400 2                  EPPR0   FPT_CLOSE
         8 001646   050001 713400                    CLIMB   close
         8 001647   406000 401760                    pmme    nvectors=13
         8 001650   001654 710000 8                  TRA     s:7978

      540     7977    3          ELSE CALL M$CLOSE (FPT_NSAVE);

   7977  8 001651   000046 630400 2                  EPPR0   FPT_NSAVE
         8 001652   050001 713400                    CLIMB   close
         8 001653   406000 401760                    pmme    nvectors=13

      541     7978    3          IF FILE_TYPE ~= %FTP_OPT_ASCII THEN CALL TYPE_CMD('I');

   7978  8 001654   000446 235000 1                  LDA     FILE_TYPE
         8 001655   001662 600000 8                  TZE     s:7979

   7978  8 001656   000016 236000 9                  LDQ     14
         8 001657   200013 756100                    STQ     @CMDO,,AUTO
         8 001660   000735 701000 8                  TSX1    TYPE_CMD
         8 001661   000000 011000                    NOP     0

      542     7979    3          IF GLOBAL_ERR ~= 0 THEN ALTRETURN;

   7979  8 001662   000200 235000 1                  LDA     GLOBAL_ERR
         8 001663   001666 600000 8                  TZE     s:7983

   7979  8 001664   200010 221300                    LDX1  ! SAVERBOSE+1,,AUTO
         8 001665   000000 702211                    TSX2  ! 0,X1

      543     7980
      544     7981    3          END;
      545     7982
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:99   
      546     7983    2      RETURN;

   7983  8 001666   200010 221300                    LDX1  ! SAVERBOSE+1,,AUTO
         8 001667   000001 702211                    TSX2  ! 1,X1

      547     7984    2   END LIST_CMD;
      548     7985        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:100  
      549     7986    1   SIMPLE_CMD: PROC (CMDT,TEXTC) ALTRET;

   7986  8 001670   200042 741300       SIMPLE_CMD   STX1  ! FMT_OUTL+1,,AUTO

      550     7987    2   DCL CMDT CHAR(4) ALIGNED;
      551     7988    2   DCL 1 TEXTC ALIGNED,2 COUNT UBIN BYTE UNAL,2 TEXT CHAR(TEXTC.COUNT);
      552     7989    2   DCL V_PTR$ PTR;
      553     7990    2   DCL V_FLAG BASED(V_PTR$) ALIGNED BIT(1);
      554     7991
      555     7992    2      IF SUBSTR(CMDT,3,1) ~= ' ' THEN CALL TCP$WRITE_D (CMD_LCN, VECTOR(CMDT));

   7992  8 001671   200043 470500                    LDP0    @CMDT,,AUTO
         8 001672   000000 236100                    LDQ     0,,PR0
         8 001673   000777 376007                    ANQ     511,DL
         8 001674   000040 116007                    CMPQ    32,DL
         8 001675   001712 600000 8                  TZE     s:7993

   7992  8 001676   777640 235007                    LDA     -96,DL
         8 001677   200043 236100                    LDQ     @CMDT,,AUTO
         8 001700   200052 757100                    STAQ    DAT+3,,AUTO
         8 001701   200052 631500                    EPPR1   DAT+3,,AUTO
         8 001702   200055 451500                    STP1    DAT+6,,AUTO
         8 001703   000014 236000 9                  LDQ     12
         8 001704   200054 756100                    STQ     DAT+5,,AUTO
         8 001705   200054 630500                    EPPR0   DAT+5,,AUTO
         8 001706   000020 631400 xsym               EPPR1   B_VECTNIL+16
         8 001707   000000 701000 xent               TSX1    TCP$WRITE_D
         8 001710   000000 011000                    NOP     0
         8 001711   001725 710000 8                  TRA     s:7994

      556     7993    2      ELSE CALL TCP$WRITE_D (CMD_LCN, VECTOR(SUBSTR(CMDT,0,3)));

   7993  8 001712   577640 235007                    LDA     -65632,DL
         8 001713   200043 236100                    LDQ     @CMDT,,AUTO
         8 001714   200052 757100                    STAQ    DAT+3,,AUTO
         8 001715   200052 631500                    EPPR1   DAT+3,,AUTO
         8 001716   200055 451500                    STP1    DAT+6,,AUTO
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:101  
         8 001717   000014 236000 9                  LDQ     12
         8 001720   200054 756100                    STQ     DAT+5,,AUTO
         8 001721   200054 630500                    EPPR0   DAT+5,,AUTO
         8 001722   000020 631400 xsym               EPPR1   B_VECTNIL+16
         8 001723   000000 701000 xent               TSX1    TCP$WRITE_D
         8 001724   000000 011000                    NOP     0

      557     7994    3      IF ADDR(TEXTC) ~= ADDR(NIL) THEN DO;

   7994  8 001725   200044 236100                    LDQ     @TEXTC,,AUTO
         8 001726   000001 116000 xsym               CMPQ    B_VECTNIL+1
         8 001727   001754 600000 8                  TZE     s:7998

      558     7995    3          CALL TCP$WRITE_D (CMD_LCN, VECTOR(SPACE));

   7995  8 001730   000070 630400 9                  EPPR0   56
         8 001731   000020 631400 xsym               EPPR1   B_VECTNIL+16
         8 001732   000000 701000 xent               TSX1    TCP$WRITE_D
         8 001733   000000 011000                    NOP     0

      559     7996    3          CALL TCP$WRITE_D (CMD_LCN, VECTOR(TEXTC.TEXT));

   7996  8 001734   200044 470500                    LDP0    @TEXTC,,AUTO
         8 001735   000000 236100                    LDQ     0,,PR0
         8 001736   000033 772000                    QRL     27
         8 001737   000064 737000                    LLS     52
         8 001740   000140 135007                    SBLA    96,DL
         8 001741   200044 236100                    LDQ     @TEXTC,,AUTO
         8 001742   200000 036007                    ADLQ    65536,DL
         8 001743   200052 757100                    STAQ    DAT+3,,AUTO
         8 001744   200052 631500                    EPPR1   DAT+3,,AUTO
         8 001745   200055 451500                    STP1    DAT+6,,AUTO
         8 001746   000014 236000 9                  LDQ     12
         8 001747   200054 756100                    STQ     DAT+5,,AUTO
         8 001750   200054 630500                    EPPR0   DAT+5,,AUTO
         8 001751   000020 631400 xsym               EPPR1   B_VECTNIL+16
         8 001752   000000 701000 xent               TSX1    TCP$WRITE_D
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:102  
         8 001753   000000 011000                    NOP     0

      560     7997    3          END;

      561     7998    2      CALL TELNET_EOL(CMD_LCN);

   7998  8 001754   000014 630400 9                  EPPR0   12
         8 001755   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 001756   000000 701000 xent               TSX1    TELNET_EOL
         8 001757   000000 011000                    NOP     0

      562     7999    2      V_PTR$ = ADDR(VERBOSE);

   7999  8 001760   000060 236000 9                  LDQ     48
         8 001761   200045 756100                    STQ     V_PTR$,,AUTO

      563     8000    2      IF CODE = %FTP_CMD_RHELP OR CODE = %FTP_CMD_PWD

   8000  8 001762   200004 235100                    LDA     CODE,,AUTO
         8 001763   000013 115007                    CMPA    11,DL
         8 001764   001767 600000 8                  TZE     s:8001
         8 001765   000022 115007                    CMPA    18,DL
         8 001766   001771 601000 8                  TNZ     s:8002

      564     8001    2      THEN V_PTR$ = ADDR(RUNNING);

   8001  8 001767   000103 236000 9                  LDQ     67
         8 001770   200045 756100                    STQ     V_PTR$,,AUTO

      565     8002    3      CALL GET_RESPONSE(CMD_LCN,RCODE,V_FLAG) WHENALTRETURN DO;

   8002  8 001771   200054 756100                    STQ     DAT+5,,AUTO
         8 001772   000056 237000 9                  LDAQ    46
         8 001773   200052 757100                    STAQ    DAT+3,,AUTO
         8 001774   200052 630500                    EPPR0   DAT+3,,AUTO
         8 001775   000021 631400 xsym               EPPR1   B_VECTNIL+17
         8 001776   000000 701000 xent               TSX1    GET_RESPONSE
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:103  
         8 001777   002001 702000 8                  TSX2    s:8003
         8 002000   002005 710000 8                  TRA     s:8006

      566     8003    3          GLOBAL_ERR = %FTP_PROCEDURE_ERR;              /*N* REPORT ERROR */

   8003  8 002001   000002 235007                    LDA     2,DL
         8 002002   000200 755000 1                  STA     GLOBAL_ERR

      567     8004    3          ALTRETURN;

   8004  8 002003   200042 221300                    LDX1  ! FMT_OUTL+1,,AUTO
         8 002004   000000 702211                    TSX2  ! 0,X1

      568     8005    3          END;
      569     8006    2      IF RCODE.A ~= '2' THEN GLOBAL_ERR = %FTP_COMMAND_ERR;

   8006  8 002005   000172 236000 1                  LDQ     RCODE
         8 002006   777000 376003                    ANQ     -512,DU
         8 002007   062000 116003                    CMPQ    25600,DU
         8 002010   002013 600000 8                  TZE     s:8008

   8006  8 002011   000001 235007                    LDA     1,DL
         8 002012   000200 755000 1                  STA     GLOBAL_ERR

      570     8007
      571     8008    2      RETURN;

   8008  8 002013   200042 221300                    LDX1  ! FMT_OUTL+1,,AUTO
         8 002014   000001 702211                    TSX2  ! 1,X1

      572     8009    2   END SIMPLE_CMD;
      573     8010        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:104  
      574     8011    1   GET_CMD: PROC (RFID,ONOVER,LFID) ALTRET;

   8011  8 002015   200012 741300       GET_CMD      STX1  ! @LFID+1,,AUTO

      575     8012    2   DCL 1 RFID ALIGNED,2 COUNT UBIN BYTE UNAL,2 TEXT CHAR(RFID.COUNT);
      576     8013    2   DCL ONOVER UBIN HALF HALIGNED;
      577     8014    2   DCL 1 LFID ALIGNED,2 COUNT UBIN BYTE UNAL,2 TEXT CHAR(LFID.COUNT);
      578     8015    2   DCL CMDT CHAR(0) STATIC INIT('RETR ');
      579     8016    2   DCL OK BIT(1) STATIC;
      580     8017    2   DCL ARS UBIN(36) STATIC;
      581     8018    2   DCL CURSIZ SBIN;
      582     8019
      583     8020        /* First, validate local fid */
      584     8021
      585     8022    2      FPT_FID.TEXTFID_ = VECTOR(LFID.TEXT);

   8022  8 002016   200015 470500                    LDP0    @LFID,,AUTO
         8 002017   000000 236100                    LDQ     0,,PR0
         8 002020   000033 772000                    QRL     27
         8 002021   000064 737000                    LLS     52
         8 002022   000140 135007                    SBLA    96,DL
         8 002023   200015 236100                    LDQ     @LFID,,AUTO
         8 002024   200000 036007                    ADLQ    65536,DL
         8 002025   000366 757000 1                  STAQ    FPT_FID+2

      586     8023    3      CALL M$FID(FPT_FID) WHENALTRETURN DO;

   8023  8 002026   000364 630400 1                  EPPR0   FPT_FID
         8 002027   420001 713400                    CLIMB   alt,+8193
         8 002030   404400 401760                    pmme    nvectors=10
         8 002031   002033 702000 8                  TSX2    REPALT
         8 002032   002041 710000 8                  TRA     s:8030

   8023  8 002033                       REPALT       null
      587     8024    3   REPALT: ;
      588     8025    3          CALL REPORT_ALT;

PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:105  
   8025  8 002033   003520 701000 8                  TSX1    REPORT_ALT
         8 002034   000000 011000                    NOP     0

      589     8026    3          GLOBAL_ERR = %FTP_COMMAND_ERR;

   8026  8 002035   000001 235007                    LDA     1,DL
         8 002036   000200 755000 1                  STA     GLOBAL_ERR

      590     8027    3          ALTRETURN;

   8027  8 002037   200012 221300                    LDX1  ! @LFID+1,,AUTO
         8 002040   000000 702211                    TSX2  ! 0,X1

      591     8028    3          END;
      592     8029
      593     8030    2      IF ONOVER = %FTP_OPT_ON

   8030  8 002041   200014 470500                    LDP0    @ONOVER,,AUTO
         8 002042   000100 101500                    MRL     fill='000'O
         8 002043   000000 000002                    ADSC9   0,,PR0                   cn=0,n=2
         8 002044   200052 000004                    ADSC9   DAT+3,,AUTO              cn=0,n=4
         8 002045   200052 236100                    LDQ     DAT+3,,AUTO
         8 002046   000001 116007                    CMPQ    1,DL
         8 002047   002057 601000 8                  TNZ     s:8035

      594     8031    3      THEN DO;

      595     8032    3          FPT_OPEN.V.FUN# = %CREATE#;

   8032  8 002050   003000 236007                    LDQ     1536,DL
         8 002051   000315 552010 1                  STBQ    FPT_OPEN+37,'10'O

      596     8033    3          FPT_OPEN.V.EXIST# = %ERROR#;

   8033  8 002052   000314 236000 1                  LDQ     FPT_OPEN+36
         8 002053   000104 376000 9                  ANQ     68
         8 002054   000200 276007                    ORQ     128,DL
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:106  
         8 002055   000314 756000 1                  STQ     FPT_OPEN+36

      597     8034    3          END;

   8034  8 002056   002111 710000 8                  TRA     s:8047

      598     8035    2      ELSE IF ONOVER = %FTP_OPT_OVER

   8035  8 002057   000100 101500                    MRL     fill='000'O
         8 002060   000000 000002                    ADSC9   0,,PR0                   cn=0,n=2
         8 002061   200052 000004                    ADSC9   DAT+3,,AUTO              cn=0,n=4
         8 002062   200052 236100                    LDQ     DAT+3,,AUTO
         8 002063   000000 116003                    CMPQ    0,DU
         8 002064   002072 601000 8                  TNZ     s:8040

      599     8036    3          THEN DO;

      600     8037    3              FPT_OPEN.V.FUN# = %CREATE#;

   8037  8 002065   003000 236007                    LDQ     1536,DL
         8 002066   000315 552010 1                  STBQ    FPT_OPEN+37,'10'O

      601     8038    3              FPT_OPEN.V.EXIST# = %NEWFILE#;

   8038  8 002067   000600 236007                    LDQ     384,DL
         8 002070   000314 256000 1                  ORSQ    FPT_OPEN+36

      602     8039    3              END;

   8039  8 002071   002111 710000 8                  TRA     s:8047

      603     8040    2          ELSE IF ONOVER = %FTP_OPT_INTO

   8040  8 002072   000100 101500                    MRL     fill='000'O
         8 002073   000000 000002                    ADSC9   0,,PR0                   cn=0,n=2
         8 002074   200052 000004                    ADSC9   DAT+3,,AUTO              cn=0,n=4
         8 002075   200052 236100                    LDQ     DAT+3,,AUTO
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:107  
         8 002076   000002 116007                    CMPQ    2,DL
         8 002077   002107 601000 8                  TNZ     s:8045

      604     8041    3              THEN DO;

      605     8042    3                  FPT_OPEN.V.FUN# = %CREATE#;

   8042  8 002100   003000 236007                    LDQ     1536,DL
         8 002101   000315 552010 1                  STBQ    FPT_OPEN+37,'10'O

      606     8043    3                  FPT_OPEN.V.EXIST# = %OLDFILE#;

   8043  8 002102   000314 236000 1                  LDQ     FPT_OPEN+36
         8 002103   000104 376000 9                  ANQ     68
         8 002104   000400 276007                    ORQ     256,DL
         8 002105   000314 756000 1                  STQ     FPT_OPEN+36

      607     8044    3                  END;

   8044  8 002106   002111 710000 8                  TRA     s:8047

      608     8045    2              ELSE CALL M$XXX;             /* Internal error */

   8045  8 002107   000003 713400                    CLIMB   3
         8 002110   000000 401760                    pmme    nvectors=0

      609     8046
      610     8047    2      CALL M$OPEN (FPT_OPEN) ALTRET (REPALT);

   8047  8 002111   000250 630400 1                  EPPR0   FPT_OPEN
         8 002112   450000 713400                    CLIMB   alt,open
         8 002113   410400 401760                    pmme    nvectors=18
         8 002114   002033 702000 8                  TSX2    REPALT

      611     8048
      612     8049    2      IF ADDR(RFID) = ADDR(NIL) THEN RETURN; /* Called from LIST_CMD */

PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:108  
   8049  8 002115   200013 236100                    LDQ     @RFID,,AUTO
         8 002116   000001 116000 xsym               CMPQ    B_VECTNIL+1
         8 002117   002122 601000 8                  TNZ     s:8051

   8049  8 002120   200012 221300                    LDX1  ! @LFID+1,,AUTO
         8 002121   000001 702211                    TSX2  ! 1,X1

      613     8050
      614     8051    2      ARS = F$FILE$->F$DCB.RECL#;

   8051  8 002122   000247 470400 1                  LDP0    F$FILE$
         8 002123   000033 236100                    LDQ     27,,PR0
         8 002124   777777 376007                    ANQ     -1,DL
         8 002125   000621 756000 1                  STQ     ARS

      615     8052    2      CHARNLEN = 0;

   8052  8 002126   000225 450000 1                  STZ     CHARNLEN

      616     8053    2      CURSIZ = 0;

   8053  8 002127   200016 450100                    STZ     CURSIZ,,AUTO

      617     8054    2      FPT_WRITE.BUF_.BUF$ = ADDR(LINE_BUF);

   8054  8 002130   000063 236000 9                  LDQ     51
         8 002131   000421 756000 1                  STQ     FPT_WRITE+5

      618     8055
      619     8056
      620     8057    3      CALL OPEN_DATA_PORT WHENALTRETURN DO;

   8057  8 002132   003172 701000 8                  TSX1    OPEN_DATA_PORT
         8 002133   002135 702000 8                  TSX2    REMLOCAL
         8 002134   002144 710000 8                  TRA     s:8064

   8057  8 002135                       REMLOCAL     null
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:109  
      621     8058    3   REMLOCAL: ;
      622     8059    3          GLOBAL_ERR = %FTP_PROCEDURE_ERR;

   8059  8 002135   000002 235007                    LDA     2,DL
         8 002136   000200 755000 1                  STA     GLOBAL_ERR

      623     8060    3          CALL M$CLOSE (FPT_NSAVE);

   8060  8 002137   000046 630400 2                  EPPR0   FPT_NSAVE
         8 002140   050001 713400                    CLIMB   close
         8 002141   406000 401760                    pmme    nvectors=13

      624     8061    3          ALTRETURN;

   8061  8 002142   200012 221300                    LDX1  ! @LFID+1,,AUTO
         8 002143   000000 702211                    TSX2  ! 0,X1

      625     8062    3          END;
      626     8063
      627     8064    2      CALL TCP$WRITE_D (CMD_LCN, VECTOR(CMDT));

   8064  8 002144   000110 630400 9                  EPPR0   72
         8 002145   000020 631400 xsym               EPPR1   B_VECTNIL+16
         8 002146   000000 701000 xent               TSX1    TCP$WRITE_D
         8 002147   000000 011000                    NOP     0

      628     8065    2      CALL TCP$WRITE_D (CMD_LCN, VECTOR(RFID.TEXT));

   8065  8 002150   200013 470500                    LDP0    @RFID,,AUTO
         8 002151   000000 236100                    LDQ     0,,PR0
         8 002152   000033 772000                    QRL     27
         8 002153   000064 737000                    LLS     52
         8 002154   000140 135007                    SBLA    96,DL
         8 002155   200013 236100                    LDQ     @RFID,,AUTO
         8 002156   200000 036007                    ADLQ    65536,DL
         8 002157   200052 757100                    STAQ    DAT+3,,AUTO
         8 002160   200052 631500                    EPPR1   DAT+3,,AUTO
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:110  
         8 002161   200055 451500                    STP1    DAT+6,,AUTO
         8 002162   000014 236000 9                  LDQ     12
         8 002163   200054 756100                    STQ     DAT+5,,AUTO
         8 002164   200054 630500                    EPPR0   DAT+5,,AUTO
         8 002165   000020 631400 xsym               EPPR1   B_VECTNIL+16
         8 002166   000000 701000 xent               TSX1    TCP$WRITE_D
         8 002167   000000 011000                    NOP     0

      629     8066    2      CALL TELNET_EOL(CMD_LCN);

   8066  8 002170   000014 630400 9                  EPPR0   12
         8 002171   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 002172   000000 701000 xent               TSX1    TELNET_EOL
         8 002173   000000 011000                    NOP     0

      630     8067    2      CALL GET_RESPONSE(CMD_LCN,RCODE,VERBOSE) ALTRET (REMLOCAL);

   8067  8 002174   000056 630400 9                  EPPR0   46
         8 002175   000021 631400 xsym               EPPR1   B_VECTNIL+17
         8 002176   000000 701000 xent               TSX1    GET_RESPONSE
         8 002177   002135 702000 8                  TSX2    REMLOCAL

      631     8068    2      IF RCODE.A ~= '1'

   8068  8 002200   000172 236000 1                  LDQ     RCODE
         8 002201   777000 376003                    ANQ     -512,DU
         8 002202   061000 116003                    CMPQ    25088,DU
         8 002203   002211 600000 8                  TZE     s:8075

      632     8069    3      THEN DO;

   8065  8 002204                       RELBOTH      null
      633     8070    3   RELBOTH: ;
      634     8071    3          CALL TCP$RELEASE(DATA_LCN);

   8071  8 002204   000072 630400 9                  EPPR0   58
         8 002205   000017 631400 xsym               EPPR1   B_VECTNIL+15
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:111  
         8 002206   000000 701000 xent               TSX1    TCP$RELEASE
         8 002207   000000 011000                    NOP     0

      635     8072    3          GOTO REMLOCAL;

   8072  8 002210   002135 710000 8                  TRA     REMLOCAL

      636     8073    3          END;
      637     8074                                                /* Read file until it closes */
      638     8075    2          BYTES=0;

   8075  8 002211   000227 450000 1                  STZ     BYTES

      639     8076                                                /* First, get open */
      640     8077    2          CALL GET_OPEN(DATA_LCN,%TIMEOUT) ALTRET (RELBOTH);

   8077  8 002212   000074 236000 9                  LDQ     60
         8 002213   200022 756100                    STQ     @BYTES+1,,AUTO
         8 002214   000072 236000 9                  LDQ     58
         8 002215   200021 756100                    STQ     P$,,AUTO
         8 002216   003052 701000 8                  TSX1    GET_OPEN
         8 002217   002204 702000 8                  TSX2    RELBOTH

      641     8078    2          CALL SETBREAK ALTRET(GET_BREAK);

   8078  8 002220   000717 701000 8                  TSX1    SETBREAK
         8 002221   002405 702000 8                  TSX2    GET_BREAK

      642     8079    2          CALL M$TIME (FPT_TIME);

   8079  8 002222   000232 630400 1                  EPPR0   FPT_TIME
         8 002223   020004 713400                    CLIMB   8196
         8 002224   402000 401760                    pmme    nvectors=5

      643     8080    2          START_TIME=TSTAMP;

   8080  8 002225   000230 235000 1                  LDA     TSTAMP
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:112  
         8 002226   000226 755000 1                  STA     START_TIME

      644     8081    2          OK='1'B;

   8081  8 002227   400000 236003                    LDQ     -131072,DU
         8 002230   000620 756000 1                  STQ     OK

      645     8082    3          DO WHILE OK;

   8082  8 002231   000620 234000 1                  SZN     OK
         8 002232   002424 605000 8                  TPL     s:8151

      646     8083    3              IF HASH THEN CALL HASH_MARKS;

   8083  8 002233   000452 235000 1                  LDA     HASH
         8 002234   002237 600000 8                  TZE     s:8084

   8083  8 002235   003565 701000 8                  TSX1    HASH_MARKS
         8 002236   000000 011000                    NOP     0

      647     8084    3              IF FILE_TYPE = %FTP_OPT_ASCII

   8084  8 002237   000446 235000 1                  LDA     FILE_TYPE
         8 002240   002301 601000 8                  TNZ     s:8109

      648     8085    4              THEN DO;

      649     8086    4                  FPT_WRITE.BUF_.BUF$ = ADDR(LINE_BUF);

   8086  8 002241   000063 236000 9                  LDQ     51
         8 002242   000421 756000 1                  STQ     FPT_WRITE+5

      650     8087    4                  CALL GET_LINE(DATA_LCN, VECTOR(LINE_BUF), ARS)

   8087  8 002243   000112 630400 9                  EPPR0   74
         8 002244   000021 631400 xsym               EPPR1   B_VECTNIL+17
         8 002245   000000 701000 xent               TSX1    GET_LINE
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:113  
         8 002246   002277 702000 8                  TSX2    s:8105

      651     8088    5                  WHENRETURN DO;

      652     8089    5                      BYTES = BYTES + ARS-1;

   8089  8 002247   000227 236000 1                  LDQ     BYTES
         8 002250   000621 036000 1                  ADLQ    ARS
         8 002251   000001 136007                    SBLQ    1,DL
         8 002252   000227 756000 1                  STQ     BYTES

      653     8090                                                /* write it */
      654     8091    5                      CHARNLEN=ARS-2;      /* Don't include crlf*/

   8091  8 002253   000621 235000 1                  LDA     ARS
         8 002254   000002 135007                    SBLA    2,DL
         8 002255   000225 755000 1                  STA     CHARNLEN

      655     8092    5                      FPT_WRITE.V.DVBYTE.CONT# = '0'B;

   8092  8 002256   000105 236000 9                  LDQ     69
         8 002257   000427 356000 1                  ANSQ    FPT_WRITE+11

      656     8093    5                      IF CHARNLEN>=SIZEV(LINE_BUF) /* No terminator ... */

   8093  8 002260   007777 115007                    CMPA    4095,DL
         8 002261   002270 602000 8                  TNC     s:8098

      657     8094    6                      THEN DO;                    /* Use DVBYTE.CONT.  */

      658     8095    6                          BYTES = BYTES-1; /* Don't count a CR that isn't there */

   8095  8 002262   000227 235000 1                  LDA     BYTES
         8 002263   000001 135007                    SBLA    1,DL
         8 002264   000227 755000 1                  STA     BYTES

      659     8096    6                          FPT_WRITE.V.DVBYTE.CONT# = '1'B;
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:114  

   8096  8 002265   001000 236003                    LDQ     512,DU
         8 002266   000427 256000 1                  ORSQ    FPT_WRITE+11

      660     8097    6                          END;

   8097  8 002267   002276 710000 8                  TRA     s:8103

      661     8098    5                      ELSE IF CHARNLEN<=0

   8098  8 002270   000000 115003                    CMPA    0,DU
         8 002271   002276 601000 8                  TNZ     s:8103

      662     8099    6                      THEN DO;

      663     8100    6                          CHARNLEN=1;

   8100  8 002272   000001 235007                    LDA     1,DL
         8 002273   000225 755000 1                  STA     CHARNLEN

      664     8101    6                          FPT_WRITE.BUF_.BUF$ = ADDR(NIL);

   8101  8 002274   000001 236000 xsym               LDQ     B_VECTNIL+1
         8 002275   000421 756000 1                  STQ     FPT_WRITE+5

      665     8102    6                          END;

      666     8103    5                      END;

   8103  8 002276   002300 710000 8                  TRA     s:8107

      667     8104    5                  WHENALTRETURN DO;

      668     8105    5                      OK='0'B;

   8105  8 002277   000620 450000 1                  STZ     OK

PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:115  
      669     8106    5                      END;

      670     8107    4                  END;

   8107  8 002300   002366 710000 8                  TRA     s:8139

      671     8108    4              ELSE DO;                     /* Mode is image */

      672     8109    5                  IF CHARNLEN=0 OR CHARNLEN=CB.ARS THEN DO;

   8109  8 002301   000225 236000 1                  LDQ     CHARNLEN
         8 002302   002305 600000 8                  TZE     s:8110
         8 002303   000174 116000 1                  CMPQ    CB+1
         8 002304   002330 601000 8                  TNZ     s:8123

      673     8110    5                      FPT_WRITE.BUF_.BUF$ = ADDR(LINE_BUF);

   8110  8 002305   000063 236000 9                  LDQ     51
         8 002306   000421 756000 1                  STQ     FPT_WRITE+5

      674     8111    6                  CALL TCP$READ (DATA_LCN,VECTOR(LINE_BUF),CB) WHENALTRETURN DO;

   8111  8 002307   000115 630400 9                  EPPR0   77
         8 002310   000021 631400 xsym               EPPR1   B_VECTNIL+17
         8 002311   000000 701000 xent               TSX1    TCP$READ
         8 002312   002314 702000 8                  TSX2    s:8112
         8 002313   002316 710000 8                  TRA     s:8114

      675     8112    6                      CALL REPORT_TCP;

   8112  8 002314   003526 701000 8                  TSX1    REPORT_TCP
         8 002315   000000 011000                    NOP     0

      676     8113    6                      END;

      677     8114    5                  IF CB.ADMIN

PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:116  
   8114  8 002316   000173 234000 1                  SZN     CB
         8 002317   002322 605000 8                  TPL     s:8119

      678     8115    6                  THEN DO;

      679     8116    6                      OK = '0'B;

   8116  8 002320   000620 450000 1                  STZ     OK

      680     8117    6                      END;

   8117  8 002321   002341 710000 8                  TRA     s:8127

      681     8118    6                  ELSE DO;

      682     8119    6                      BYTES = BYTES+CB.ARS;

   8119  8 002322   000227 236000 1                  LDQ     BYTES
         8 002323   000174 036000 1                  ADLQ    CB+1
         8 002324   000227 756000 1                  STQ     BYTES

      683     8120    6                      CHARNLEN=CB.ARS;

   8120  8 002325   000174 235000 1                  LDA     CB+1
         8 002326   000225 755000 1                  STA     CHARNLEN

      684     8121    6                      END;

      685     8122    5                  END; ELSE DO;

   8122  8 002327   002341 710000 8                  TRA     s:8127

      686     8123    5                      CB.ARS = CB.ARS-CHARNLEN;

   8123  8 002330   000174 236000 1                  LDQ     CB+1
         8 002331   000225 136000 1                  SBLQ    CHARNLEN
         8 002332   000174 756000 1                  STQ     CB+1
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:117  

      687     8124    5                      FPT_WRITE.BUF_.BUF$ = PINCRC(FPT_WRITE.BUF_.BUF$,CHARNLEN);

   8124  8 002333   000225 236000 1                  LDQ     CHARNLEN
         8 002334   000020 736000                    QLS     16
         8 002335   000421 036000 1                  ADLQ    FPT_WRITE+5
         8 002336   000421 756000 1                  STQ     FPT_WRITE+5

      688     8125    5                      CHARNLEN = CB.ARS;

   8125  8 002337   000174 235000 1                  LDA     CB+1
         8 002340   000225 755000 1                  STA     CHARNLEN

      689     8126    5                      END;

      690     8127    5                  IF ARS>0 THEN DO; /* RECL was specified, make'em all the same */

   8127  8 002341   000621 235000 1                  LDA     ARS
         8 002342   002366 600000 8                  TZE     s:8139

      691     8128    5                      FPT_WRITE.V.DVBYTE.CONT# = '1'B;

   8128  8 002343   001000 236003                    LDQ     512,DU
         8 002344   000427 256000 1                  ORSQ    FPT_WRITE+11

      692     8129    6                      IF CHARNLEN>=ARS-CURSIZ THEN DO;

   8129  8 002345   000621 236000 1                  LDQ     ARS
         8 002346   200016 136100                    SBLQ    CURSIZ,,AUTO
         8 002347   002353 604000 8                  TMI     s:8130
         8 002350   000225 116000 1                  CMPQ    CHARNLEN
         8 002351   002353 600000 8                  TZE     s:8130
         8 002352   002363 603000 8                  TRC     s:8134

      693     8130    6                           CHARNLEN = ARS-CURSIZ;

   8130  8 002353   000621 236000 1                  LDQ     ARS
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:118  
         8 002354   200016 136100                    SBLQ    CURSIZ,,AUTO
         8 002355   000225 756000 1                  STQ     CHARNLEN

      694     8131    6                           CURSIZ = -CHARNLEN;

   8131  8 002356   000000 235003                    LDA     0,DU
         8 002357   000225 135000 1                  SBLA    CHARNLEN
         8 002360   200016 755100                    STA     CURSIZ,,AUTO

      695     8132    6                           FPT_WRITE.V.DVBYTE.CONT# = '0'B;

   8132  8 002361   000105 236000 9                  LDQ     69
         8 002362   000427 356000 1                  ANSQ    FPT_WRITE+11

      696     8133    6                           END;

      697     8134    5                      CURSIZ = CURSIZ+CHARNLEN;

   8134  8 002363   200016 236100                    LDQ     CURSIZ,,AUTO
         8 002364   000225 036000 1                  ADLQ    CHARNLEN
         8 002365   200016 756100                    STQ     CURSIZ,,AUTO

      698     8135    5                      END;

      699     8136
      700     8137    4                  END;

      701     8138
      702     8139    3              IF (OK)

   8139  8 002366   000620 234000 1                  SZN     OK
         8 002367   002422 605000 8                  TPL     s:8150

      703     8140    4              THEN DO;

      704     8141    4                  FPT_WRITE.BUF_.BOUND = CHARNLEN-1;

PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:119  
   8141  8 002370   000225 236000 1                  LDQ     CHARNLEN
         8 002371   000001 136007                    SBLQ    1,DL
         8 002372   000020 736000                    QLS     16
         8 002373   000420 676000 1                  ERQ     FPT_WRITE+4
         8 002374   000034 376000 xsym               ANQ     B_VECTNIL+28
         8 002375   000420 656000 1                  ERSQ    FPT_WRITE+4

      705     8142    5                  CALL M$WRITE (FPT_WRITE) WHENALTRETURN DO;

   8142  8 002376   000414 630400 1                  EPPR0   FPT_WRITE
         8 002377   440001 713400                    CLIMB   alt,write
         8 002400   401400 401760                    pmme    nvectors=4
         8 002401   002403 702000 8                  TSX2    s:8143
         8 002402   002422 710000 8                  TRA     s:8150

      706     8143    5                      CALL REPORT_ALT;

   8143  8 002403   003520 701000 8                  TSX1    REPORT_ALT
         8 002404   000000 011000                    NOP     0

      707     8144    5   GET_BREAK:         CALL TCP$RELEASE(DATA_LCN);

   8144  8 002405   000072 630400 9     GET_BREAK    EPPR0   58
         8 002406   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 002407   000000 701000 xent               TSX1    TCP$RELEASE
         8 002410   000000 011000                    NOP     0

      708     8145    5                      CODE = %FTP_CMD_RHELP; /* Override VERBOSE */

   8145  8 002411   000013 235007                    LDA     11,DL
         8 002412   200004 755100                    STA     CODE,,AUTO

      709     8146    5                      CALL SIMPLE_CMD ('ABOR');

   8146  8 002413   000001 236000 xsym               LDQ     B_VECTNIL+1
         8 002414   200044 756100                    STQ     @TEXTC,,AUTO
         8 002415   000120 236000 9                  LDQ     80
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:120  
         8 002416   200043 756100                    STQ     @CMDT,,AUTO
         8 002417   001670 701000 8                  TSX1    SIMPLE_CMD
         8 002420   000000 011000                    NOP     0

      710     8147    5                      GOTO REMLOCAL;

   8147  8 002421   002135 710000 8                  TRA     REMLOCAL

      711     8148    5                      END;
      712     8149    4                  END;

      713     8150    3              END;

   8150  8 002422   000620 234000 1                  SZN     OK
         8 002423   002233 604000 8                  TMI     s:8083

      714     8151    2          CALL M$TIME (FPT_TIME);

   8151  8 002424   000232 630400 1                  EPPR0   FPT_TIME
         8 002425   020004 713400                    CLIMB   8196
         8 002426   402000 401760                    pmme    nvectors=5

      715     8152    2          START_TIME = TSTAMP-START_TIME;

   8152  8 002427   000230 236000 1                  LDQ     TSTAMP
         8 002430   000226 136000 1                  SBLQ    START_TIME
         8 002431   000226 756000 1                  STQ     START_TIME

      716     8153    2          CALL GET_CLOSE(DATA_LCN,%TIMEOUT);

   8153  8 002432   000074 236000 9                  LDQ     60
         8 002433   200022 756100                    STQ     @BYTES+1,,AUTO
         8 002434   000072 236000 9                  LDQ     58
         8 002435   200021 756100                    STQ     P$,,AUTO
         8 002436   003115 701000 8                  TSX1    GET_CLOSE
         8 002437   000000 011000                    NOP     0

PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:121  
      717     8154    3          CALL GET_RESPONSE(CMD_LCN,RCODE,VERBOSE) WHENALTRETURN DO;

   8154  8 002440   000056 630400 9                  EPPR0   46
         8 002441   000021 631400 xsym               EPPR1   B_VECTNIL+17
         8 002442   000000 701000 xent               TSX1    GET_RESPONSE
         8 002443   002445 702000 8                  TSX2    s:8155
         8 002444   002456 710000 8                  TRA     s:8160

      718     8155    3             CALL REPORT_TCP;

   8155  8 002445   003526 701000 8                  TSX1    REPORT_TCP
         8 002446   000000 011000                    NOP     0

      719     8156    3              GLOBAL_ERR = %FTP_PROCEDURE_ERR;         /*N* REPORT ERROR */

   8156  8 002447   000002 235007                    LDA     2,DL
         8 002450   000200 755000 1                  STA     GLOBAL_ERR

      720     8157    3              CALL M$CLOSE (FPT_CLOSE);

   8157  8 002451   000010 630400 2                  EPPR0   FPT_CLOSE
         8 002452   050001 713400                    CLIMB   close
         8 002453   406000 401760                    pmme    nvectors=13

      721     8158    3              ALTRETURN;

   8158  8 002454   200012 221300                    LDX1  ! @LFID+1,,AUTO
         8 002455   000000 702211                    TSX2  ! 0,X1

      722     8159    3              END;
      723     8160    2          IF RCODE.A ~= '2' THEN GOTO REMLOCAL;

   8160  8 002456   000172 236000 1                  LDQ     RCODE
         8 002457   777000 376003                    ANQ     -512,DU
         8 002460   062000 116003                    CMPQ    25600,DU
         8 002461   002135 601000 8                  TNZ     REMLOCAL

PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:122  
      724     8161    2          CALL REPORT_TIME(BYTES,START_TIME);

   8161  8 002462   000121 236000 9                  LDQ     81
         8 002463   200022 756100                    STQ     @BYTES+1,,AUTO
         8 002464   000122 236000 9                  LDQ     82
         8 002465   200021 756100                    STQ     P$,,AUTO
         8 002466   003617 701000 8                  TSX1    REPORT_TIME
         8 002467   000000 011000                    NOP     0

      725     8162    2          CALL M$CLOSE (FPT_CLOSE);

   8162  8 002470   000010 630400 2                  EPPR0   FPT_CLOSE
         8 002471   050001 713400                    CLIMB   close
         8 002472   406000 401760                    pmme    nvectors=13

      726     8163
      727     8164
      728     8165    2      RETURN;

   8165  8 002473   200012 221300                    LDX1  ! @LFID+1,,AUTO
         8 002474   000001 702211                    TSX2  ! 1,X1

      729     8166    2   END GET_CMD;
      730     8167        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:123  
      731     8168    1   PUT_CMD: PROC (LFID,OVERINTO,RFID) ALTRET;

   8168  8 002475   200010 741300       PUT_CMD      STX1  ! SAVERBOSE+1,,AUTO

      732     8169    2   DCL 1 RFID ALIGNED,2 COUNT UBIN BYTE UNAL,2 TEXT CHAR(RFID.COUNT);
      733     8170    2   DCL OVERINTO UBIN HALF HALIGNED;
      734     8171    2   DCL 1 LFID ALIGNED,2 COUNT UBIN BYTE UNAL,2 TEXT CHAR(LFID.COUNT);
      735     8172    2   DCL IPSYNC CHAR(0) CONSTANT
      736     8173    2       INIT(%CONCAT(TELNET_IAC,TELNET_IP,TELNET_IAC,TELNET_DM));
      737     8174    2   DCL ABOR CONSTANT CHAR(0) INIT('ABOR');
      738     8175    2   DCL CMDT CHAR(0) STATIC INIT('STOR ');
      739     8176    2   DCL APPT CHAR(0) STATIC INIT('APPE ');
      740     8177    2   DCL CRLF CHAR(2) SYMREF;
      741     8178    2   DCL OK BIT(1) STATIC;
      742     8179    2   DCL ARS UBIN(36) STATIC;
      743     8180
      744     8181        /* First, validate local fid */
      745     8182
      746     8183    2      FPT_FID.TEXTFID_ = VECTOR(LFID.TEXT);

   8183  8 002476   200011 470500                    LDP0    @LFID,,AUTO
         8 002477   000000 236100                    LDQ     0,,PR0
         8 002500   000033 772000                    QRL     27
         8 002501   000064 737000                    LLS     52
         8 002502   000140 135007                    SBLA    96,DL
         8 002503   200011 236100                    LDQ     @LFID,,AUTO
         8 002504   200000 036007                    ADLQ    65536,DL
         8 002505   000366 757000 1                  STAQ    FPT_FID+2

      747     8184    3      CALL M$FID(FPT_FID) WHENALTRETURN DO;

   8184  8 002506   000364 630400 1                  EPPR0   FPT_FID
         8 002507   420001 713400                    CLIMB   alt,+8193
         8 002510   404400 401760                    pmme    nvectors=10
         8 002511   002513 702000 8                  TSX2    REPALT
         8 002512   002521 710000 8                  TRA     s:8191

PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:124  
   8176  8 002513                       REPALT       null
      748     8185    3   REPALT: ;
      749     8186    3          CALL REPORT_ALT;

   8186  8 002513   003520 701000 8                  TSX1    REPORT_ALT
         8 002514   000000 011000                    NOP     0

      750     8187    3          GLOBAL_ERR = %FTP_COMMAND_ERR;

   8187  8 002515   000001 235007                    LDA     1,DL
         8 002516   000200 755000 1                  STA     GLOBAL_ERR

      751     8188    3          ALTRETURN;

   8188  8 002517   200010 221300                    LDX1  ! SAVERBOSE+1,,AUTO
         8 002520   000000 702211                    TSX2  ! 0,X1

      752     8189    3          END;
      753     8190
      754     8191    2      FPT_OPEN.V.FUN# = %IN#;

   8191  8 002521   002000 236007                    LDQ     1024,DL
         8 002522   000315 552010 1                  STBQ    FPT_OPEN+37,'10'O

      755     8192    2      CALL M$OPEN (FPT_OPEN) ALTRET (REPALT);

   8192  8 002523   000250 630400 1                  EPPR0   FPT_OPEN
         8 002524   450000 713400                    CLIMB   alt,open
         8 002525   410400 401760                    pmme    nvectors=18
         8 002526   002513 702000 8                  TSX2    REPALT

      756     8193    2      IF RFID.COUNT = 0 THEN CALL LINE_SUB(VLP_NAME); /* Dflt mput needs xlate */

   8193  8 002527   200013 470500                    LDP0    @RFID,,AUTO
         8 002530   000000 236100                    LDQ     0,,PR0
         8 002531   777000 316003                    CANQ    -512,DU
         8 002532   002537 601000 8                  TNZ     s:8197
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:125  

   8193  8 002533   000123 236000 9                  LDQ     83
         8 002534   200015 756100                    STQ     @LFID,,AUTO
         8 002535   003551 701000 8                  TSX1    LINE_SUB
         8 002536   000000 011000                    NOP     0

      757     8194
      758     8195
      759     8196
      760     8197    3      CALL OPEN_DATA_PORT WHENALTRETURN DO;

   8197  8 002537   003172 701000 8                  TSX1    OPEN_DATA_PORT
         8 002540   002542 702000 8                  TSX2    CLOSE_ALT
         8 002541   002551 710000 8                  TRA     s:8204

   8188  8 002542                       CLOSE_ALT    null
      761     8198    3   CLOSE_ALT: ;
      762     8199    3          GLOBAL_ERR = %FTP_PROCEDURE_ERR;

   8199  8 002542   000002 235007                    LDA     2,DL
         8 002543   000200 755000 1                  STA     GLOBAL_ERR

      763     8200    3          CALL M$CLOSE (FPT_CLOSE);

   8200  8 002544   000010 630400 2                  EPPR0   FPT_CLOSE
         8 002545   050001 713400                    CLIMB   close
         8 002546   406000 401760                    pmme    nvectors=13

      764     8201    3          ALTRETURN;

   8201  8 002547   200010 221300                    LDX1  ! SAVERBOSE+1,,AUTO
         8 002550   000000 702211                    TSX2  ! 0,X1

      765     8202    3          END;
      766     8203
      767     8204    2      IF OVERINTO = %FTP_OPT_INTO THEN

PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:126  
   8204  8 002551   200012 470500                    LDP0    @OVERINTO,,AUTO
         8 002552   000100 101500                    MRL     fill='000'O
         8 002553   000000 000002                    ADSC9   0,,PR0                   cn=0,n=2
         8 002554   200052 000004                    ADSC9   DAT+3,,AUTO              cn=0,n=4
         8 002555   200052 236100                    LDQ     DAT+3,,AUTO
         8 002556   000002 116007                    CMPQ    2,DL
         8 002557   002565 601000 8                  TNZ     s:8207

      768     8205    2          CALL TCP$WRITE_D (CMD_LCN, VECTOR(APPT));

   8205  8 002560   000126 630400 9                  EPPR0   86
         8 002561   000020 631400 xsym               EPPR1   B_VECTNIL+16
         8 002562   000000 701000 xent               TSX1    TCP$WRITE_D
         8 002563   000000 011000                    NOP     0
         8 002564   002571 710000 8                  TRA     s:8208

      769     8206    2      ELSE
      770     8207    2          CALL TCP$WRITE_D (CMD_LCN, VECTOR(CMDT));

   8207  8 002565   000132 630400 9                  EPPR0   90
         8 002566   000020 631400 xsym               EPPR1   B_VECTNIL+16
         8 002567   000000 701000 xent               TSX1    TCP$WRITE_D
         8 002570   000000 011000                    NOP     0

      771     8208    2      CALL TCP$WRITE_D (CMD_LCN, VECTOR(RFID.TEXT));

   8208  8 002571   200013 470500                    LDP0    @RFID,,AUTO
         8 002572   000000 236100                    LDQ     0,,PR0
         8 002573   000033 772000                    QRL     27
         8 002574   000064 737000                    LLS     52
         8 002575   000140 135007                    SBLA    96,DL
         8 002576   200013 236100                    LDQ     @RFID,,AUTO
         8 002577   200000 036007                    ADLQ    65536,DL
         8 002600   200052 757100                    STAQ    DAT+3,,AUTO
         8 002601   200052 631500                    EPPR1   DAT+3,,AUTO
         8 002602   200055 451500                    STP1    DAT+6,,AUTO
         8 002603   000014 236000 9                  LDQ     12
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:127  
         8 002604   200054 756100                    STQ     DAT+5,,AUTO
         8 002605   200054 630500                    EPPR0   DAT+5,,AUTO
         8 002606   000020 631400 xsym               EPPR1   B_VECTNIL+16
         8 002607   000000 701000 xent               TSX1    TCP$WRITE_D
         8 002610   000000 011000                    NOP     0

      772     8209    2      CALL TELNET_EOL(CMD_LCN);

   8209  8 002611   000014 630400 9                  EPPR0   12
         8 002612   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 002613   000000 701000 xent               TSX1    TELNET_EOL
         8 002614   000000 011000                    NOP     0

      773     8210    2      CALL GET_RESPONSE(CMD_LCN,RCODE,VERBOSE) ALTRET (CLOSE_ALT);

   8210  8 002615   000056 630400 9                  EPPR0   46
         8 002616   000021 631400 xsym               EPPR1   B_VECTNIL+17
         8 002617   000000 701000 xent               TSX1    GET_RESPONSE
         8 002620   002542 702000 8                  TSX2    CLOSE_ALT

      774     8211    2      IF RCODE.A ~= '1'

   8211  8 002621   000172 236000 1                  LDQ     RCODE
         8 002622   777000 376003                    ANQ     -512,DU
         8 002623   061000 116003                    CMPQ    25088,DU
         8 002624   002632 600000 8                  TZE     s:8219

      775     8212    3      THEN DO;

   8208  8 002625                       CLREL_ALT    null
      776     8213    3   CLREL_ALT: ;
      777     8214    3          CALL TCP$RELEASE(DATA_LCN);

   8214  8 002625   000072 630400 9                  EPPR0   58
         8 002626   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 002627   000000 701000 xent               TSX1    TCP$RELEASE
         8 002630   000000 011000                    NOP     0
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:128  

      778     8215    3          GOTO CLOSE_ALT;

   8215  8 002631   002542 710000 8                  TRA     CLOSE_ALT

      779     8216    3          END;
      780     8217    3      ELSE DO;

      781     8218                                                /* Write file until it closes */
      782     8219    3          BYTES=0;

   8219  8 002632   000227 450000 1                  STZ     BYTES

      783     8220                                                /* First, get open */
      784     8221    3          CALL GET_OPEN(DATA_LCN,%TIMEOUT) ALTRET (CLREL_ALT);

   8221  8 002633   000074 236000 9                  LDQ     60
         8 002634   200022 756100                    STQ     @BYTES+1,,AUTO
         8 002635   000072 236000 9                  LDQ     58
         8 002636   200021 756100                    STQ     P$,,AUTO
         8 002637   003052 701000 8                  TSX1    GET_OPEN
         8 002640   002625 702000 8                  TSX2    CLREL_ALT

      785     8222    3          CALL SETBREAK ALTRET(PUT_BREAK);

   8222  8 002641   000717 701000 8                  TSX1    SETBREAK
         8 002642   002733 702000 8                  TSX2    PUT_BREAK

      786     8223    3          CALL M$TIME (FPT_TIME);

   8223  8 002643   000232 630400 1                  EPPR0   FPT_TIME
         8 002644   020004 713400                    CLIMB   8196
         8 002645   402000 401760                    pmme    nvectors=5

      787     8224    3          START_TIME=TSTAMP;

   8224  8 002646   000230 235000 1                  LDA     TSTAMP
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:129  
         8 002647   000226 755000 1                  STA     START_TIME

      788     8225    3          OK='1'B;

   8225  8 002650   400000 236003                    LDQ     -131072,DU
         8 002651   000626 756000 1                  STQ     OK

      789     8226    4          DO WHILE OK;

   8226  8 002652   000626 234000 1                  SZN     OK
         8 002653   003013 605000 8                  TPL     s:8271

      790     8227    4              IF HASH THEN CALL HASH_MARKS;

   8227  8 002654   000452 235000 1                  LDA     HASH
         8 002655   002660 600000 8                  TZE     s:8228

   8227  8 002656   003565 701000 8                  TSX1    HASH_MARKS
         8 002657   000000 011000                    NOP     0

      791     8228    4              CALL M$READ (FPT_READ)

   8228  8 002660   000430 630400 1                  EPPR0   FPT_READ
         8 002661   440000 713400                    CLIMB   alt,read
         8 002662   401400 401760                    pmme    nvectors=4
         8 002663   002671 702000 8                  TSX2    s:8234

      792     8229    5              WHENRETURN DO;

      793     8230    5                   OK='1'B;

   8230  8 002664   400000 236003                    LDQ     -131072,DU
         8 002665   000626 756000 1                  STQ     OK

      794     8231    5                   FPT_READ.V.DVBYTE.CONT#='0'B;

   8231  8 002666   000105 236000 9                  LDQ     69
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:130  
         8 002667   000443 356000 1                  ANSQ    FPT_READ+11

      795     8232    5                   END;

   8232  8 002670   002710 710000 8                  TRA     s:8245

      796     8233    5              WHENALTRETURN DO;

      797     8234    5                   IF B$TCB$->B$TCB.ALT$->B$ALT.ERR.ERR# = %E$LD

   8234  8 002671   000000 470400 xsym               LDP0    B$TCB$
         8 002672   000000 471500                    LDP1    0,,PR0
         8 002673   100102 236100                    LDQ     66,,PR1
         8 002674   377770 376007                    ANQ     131064,DL
         8 002675   000070 116007                    CMPQ    56,DL
         8 002676   002702 601000 8                  TNZ     s:8239

      798     8235    6                   THEN DO;

      799     8236    6                           FPT_READ.V.DVBYTE.CONT#='1'B;

   8236  8 002677   001000 236003                    LDQ     512,DU
         8 002700   000443 256000 1                  ORSQ    FPT_READ+11

      800     8237    6                           END;

   8237  8 002701   002710 710000 8                  TRA     s:8245

      801     8238    6                   ELSE DO;

      802     8239    6                       OK = '0'B;

   8239  8 002702   000626 450000 1                  STZ     OK

      803     8240    6                       IF B$TCB$->B$TCB.ALT$->B$ALT.ERR.ERR# = %E$EOF THEN EXIT;

   8240  8 002703   000060 116007                    CMPQ    48,DL
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:131  
         8 002704   002710 600000 8                  TZE     s:8245

      804     8241    6                       CALL REPORT_ALT;

   8241  8 002705   003520 701000 8                  TSX1    REPORT_ALT
         8 002706   000000 011000                    NOP     0

      805     8242    6                       GOTO PUT_BREAK;

   8242  8 002707   002733 710000 8                  TRA     PUT_BREAK

      806     8243    6                       END;
      807     8244    5              END;

      808     8245    4              IF OK

   8245  8 002710   000626 234000 1                  SZN     OK
         8 002711   003011 605000 8                  TPL     s:8270

      809     8246    5              THEN DO;

      810     8247
      811     8248    5                  CHARNLEN=F$FILE$->F$DCB.ARS#;

   8248  8 002712   000247 470400 1                  LDP0    F$FILE$
         8 002713   000000 235100                    LDA     0,,PR0
         8 002714   000225 755000 1                  STA     CHARNLEN

      812     8249    5                  IF (CHARNLEN>0)

   8249  8 002715   002771 600000 8                  TZE     s:8261

      813     8250    5                  THEN CALL TCP$WRITE(DATA_LCN,VECTOR(ADDR(LINE_BUF)->CHARN))

   8250  8 002716   000020 735000                    ALS     16
         8 002717   000140 135007                    SBLA    96,DL
         8 002720   000063 236000 9                  LDQ     51
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:132  
         8 002721   200052 757100                    STAQ    DAT+3,,AUTO
         8 002722   200052 631500                    EPPR1   DAT+3,,AUTO
         8 002723   200055 451500                    STP1    DAT+6,,AUTO
         8 002724   000072 236000 9                  LDQ     58
         8 002725   200054 756100                    STQ     DAT+5,,AUTO
         8 002726   200054 630500                    EPPR0   DAT+5,,AUTO
         8 002727   000020 631400 xsym               EPPR1   B_VECTNIL+16
         8 002730   000000 701000 xent               TSX1    TCP$WRITE
         8 002731   002733 702000 8                  TSX2    PUT_BREAK
         8 002732   002771 710000 8                  TRA     s:8261

      814     8251    6                  WHENALTRETURN DO;

      815     8252    6   PUT_BREAK:          CALL TCP$WRITE(CMD_LCN,VECTOR(IPSYNC),,'1'B);

   8252  8 002733   000027 236000 9     PUT_BREAK    LDQ     23
         8 002734   000001 235000 xsym               LDA     B_VECTNIL+1
         8 002735   200054 757100                    STAQ    DAT+5,,AUTO
         8 002736   000136 237000 9                  LDAQ    94
         8 002737   200052 757100                    STAQ    DAT+3,,AUTO
         8 002740   200052 630500                    EPPR0   DAT+3,,AUTO
         8 002741   000022 631400 xsym               EPPR1   B_VECTNIL+18
         8 002742   000000 701000 xent               TSX1    TCP$WRITE
         8 002743   000000 011000                    NOP     0

      816     8253    6                       CALL TCP$WRITE_D(CMD_LCN,VECTOR(ABOR));

   8253  8 002744   000142 630400 9                  EPPR0   98
         8 002745   000020 631400 xsym               EPPR1   B_VECTNIL+16
         8 002746   000000 701000 xent               TSX1    TCP$WRITE_D
         8 002747   000000 011000                    NOP     0

      817     8254    6                       CALL TELNET_EOL(CMD_LCN);

   8254  8 002750   000014 630400 9                  EPPR0   12
         8 002751   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 002752   000000 701000 xent               TSX1    TELNET_EOL
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:133  
         8 002753   000000 011000                    NOP     0

      818     8255    6                       CALL TCP$RELEASE(DATA_LCN);

   8255  8 002754   000072 630400 9                  EPPR0   58
         8 002755   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 002756   000000 701000 xent               TSX1    TCP$RELEASE
         8 002757   000000 011000                    NOP     0

      819     8256    6                       CALL GET_RESPONSE(CMD_LCN,RCODE,'1'B);

   8256  8 002760   000025 630400 9                  EPPR0   21
         8 002761   000021 631400 xsym               EPPR1   B_VECTNIL+17
         8 002762   000000 701000 xent               TSX1    GET_RESPONSE
         8 002763   000000 011000                    NOP     0

      820     8257    6                       CALL GET_RESPONSENW(CMD_LCN,RCODE,'1'B);

   8257  8 002764   000025 630400 9                  EPPR0   21
         8 002765   000021 631400 xsym               EPPR1   B_VECTNIL+17
         8 002766   000000 701000 xent               TSX1    GET_RESPONSENW
         8 002767   000000 011000                    NOP     0

      821     8258    6                       GOTO CLOSE_ALT;

   8258  8 002770   002542 710000 8                  TRA     CLOSE_ALT

      822     8259    6                       END;
      823     8260
      824     8261    5                  IF FILE_TYPE = %FTP_OPT_ASCII AND NOT FPT_READ.V.DVBYTE.CONT#

   8261  8 002771   000446 235000 1                  LDA     FILE_TYPE
         8 002772   003006 601000 8                  TNZ     s:8267
         8 002773   000443 430000 1                  FSZN    FPT_READ+11
         8 002774   003006 604000 8                  TMI     s:8267

      825     8262    6                  THEN DO;
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:134  

      826     8263    6                      BYTES = BYTES + CHARNLEN + 1;

   8263  8 002775   000227 236000 1                  LDQ     BYTES
         8 002776   000225 036000 1                  ADLQ    CHARNLEN
         8 002777   000001 036007                    ADLQ    1,DL
         8 003000   000227 756000 1                  STQ     BYTES

      827     8264    6                      CALL TCP$WRITE(DATA_LCN,VECTOR(CRLF)); /* no push */

   8264  8 003001   000146 630400 9                  EPPR0   102
         8 003002   000020 631400 xsym               EPPR1   B_VECTNIL+16
         8 003003   000000 701000 xent               TSX1    TCP$WRITE
         8 003004   000000 011000                    NOP     0

      828     8265    6                      END;

   8265  8 003005   003011 710000 8                  TRA     s:8270

      829     8266    6                  ELSE DO;

      830     8267    6                      BYTES = BYTES + CHARNLEN;

   8267  8 003006   000227 236000 1                  LDQ     BYTES
         8 003007   000225 036000 1                  ADLQ    CHARNLEN
         8 003010   000227 756000 1                  STQ     BYTES

      831     8268    6                      END;

      832     8269    5                  END;

      833     8270    4              END;

   8270  8 003011   000626 234000 1                  SZN     OK
         8 003012   002654 604000 8                  TMI     s:8227

      834     8271    3          CALL GET_CLOSE(DATA_LCN,%TIMEOUT);
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:135  

   8271  8 003013   000074 236000 9                  LDQ     60
         8 003014   200022 756100                    STQ     @BYTES+1,,AUTO
         8 003015   000072 236000 9                  LDQ     58
         8 003016   200021 756100                    STQ     P$,,AUTO
         8 003017   003115 701000 8                  TSX1    GET_CLOSE
         8 003020   000000 011000                    NOP     0

      835     8272    3          CALL M$TIME (FPT_TIME);

   8272  8 003021   000232 630400 1                  EPPR0   FPT_TIME
         8 003022   020004 713400                    CLIMB   8196
         8 003023   402000 401760                    pmme    nvectors=5

      836     8273    3          START_TIME = TSTAMP-START_TIME;

   8273  8 003024   000230 236000 1                  LDQ     TSTAMP
         8 003025   000226 136000 1                  SBLQ    START_TIME
         8 003026   000226 756000 1                  STQ     START_TIME

      837     8274    3          CALL GET_RESPONSE(CMD_LCN,RCODE,VERBOSE) ALTRET (CLOSE_ALT);

   8274  8 003027   000056 630400 9                  EPPR0   46
         8 003030   000021 631400 xsym               EPPR1   B_VECTNIL+17
         8 003031   000000 701000 xent               TSX1    GET_RESPONSE
         8 003032   002542 702000 8                  TSX2    CLOSE_ALT

      838     8275    3          IF RCODE.A ~= '2' THEN GOTO CLOSE_ALT;

   8275  8 003033   000172 236000 1                  LDQ     RCODE
         8 003034   777000 376003                    ANQ     -512,DU
         8 003035   062000 116003                    CMPQ    25600,DU
         8 003036   002542 601000 8                  TNZ     CLOSE_ALT

      839     8276    3          CALL REPORT_TIME(BYTES,START_TIME);

   8276  8 003037   000121 236000 9                  LDQ     81
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:136  
         8 003040   200022 756100                    STQ     @BYTES+1,,AUTO
         8 003041   000122 236000 9                  LDQ     82
         8 003042   200021 756100                    STQ     P$,,AUTO
         8 003043   003617 701000 8                  TSX1    REPORT_TIME
         8 003044   000000 011000                    NOP     0

      840     8277    3          CALL M$CLOSE (FPT_CLOSE);

   8277  8 003045   000010 630400 2                  EPPR0   FPT_CLOSE
         8 003046   050001 713400                    CLIMB   close
         8 003047   406000 401760                    pmme    nvectors=13

      841     8278
      842     8279    3          END;

      843     8280
      844     8281    2      RETURN;

   8281  8 003050   200010 221300                    LDX1  ! SAVERBOSE+1,,AUTO
         8 003051   000001 702211                    TSX2  ! 1,X1

      845     8282    2   END PUT_CMD;
      846     8283
      847     8284        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:137  
      848     8285    1   GET_OPEN: PROC(LCN,TIMEOUT) ALTRET;

   8285  8 003052   200020 741300       GET_OPEN     STX1  ! CURSIZ+2,,AUTO

      849     8286    2   DCL LCN UBIN(36);
      850     8287    2   DCL TIMEOUT UBIN(36);
      851     8288
      852     8289        %TCP$CB (NAME=CB);
      853     8292        %TCP$ADMIN (STCLASS=BASED);
      854     8313    2   DCL IP_WAIT_UETIME UBIN(36) SYMREF;
      855     8314    2   DCL REMOTE_ADMIN ENTRY(1);
      856     8315    2   DCL REMAINING_TIME UBIN(36);
      857     8316    2   DCL TCP$RELEASE ENTRY(1) ALTRET;
      858     8317             /* Do a read, it must be a ADMINMSG_ESTABLISHED, otherwise altret */
      859     8318
      860     8319    3      CALL TCP$READ (LCN, VECTOR(CMD_BUFFER), CB) WHENALTRETURN DO;

   8319  8 003053   000150 236000 9                  LDQ     104
         8 003054   200054 756100                    STQ     DAT+5,,AUTO
         8 003055   000101 236000 9                  LDQ     65
         8 003056   200021 235100                    LDA     @LCN,,AUTO
         8 003057   200052 757100                    STAQ    DAT+3,,AUTO
         8 003060   200052 630500                    EPPR0   DAT+3,,AUTO
         8 003061   000021 631400 xsym               EPPR1   B_VECTNIL+17
         8 003062   000000 701000 xent               TSX1    TCP$READ
         8 003063   003065 702000 8                  TSX2    s:8320
         8 003064   003072 710000 8                  TRA     s:8324

      861     8320    3          CALL TCP$RELEASE(LCN);

   8320  8 003065   200021 630500                    EPPR0   @LCN,,AUTO
         8 003066   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 003067   000000 701000 xent               TSX1    TCP$RELEASE
         8 003070   000000 011000                    NOP     0

      862     8321    3          GOTO RETALT;

PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:138  
   8321  8 003071   003107 710000 8                  TRA     RETALT

      863     8322    3          END;
      864     8323
      865     8324    3      IF CB.ADMIN THEN DO;

   8324  8 003072   000630 234000 1                  SZN     CB
         8 003073   003113 605000 8                  TPL     s:8332

      866     8325    3          IF ADDR(CMD_BUFFER)->TCP$ADMIN.CMD ~= %TCP_ADMINMSG_ESTABLISHED

   8325  8 003074   000000 235000 xsym               LDA     CMD_BUFFER
         8 003075   000003 115007                    CMPA    3,DL
         8 003076   003113 600000 8                  TZE     s:8332

      867     8326    4          THEN DO;

      868     8327    4              CALL REMOTE_ADMIN(ADDR(CMD_BUFFER));

   8327  8 003077   000063 236000 9                  LDQ     51
         8 003100   200052 756100                    STQ     DAT+3,,AUTO
         8 003101   200052 630500                    EPPR0   DAT+3,,AUTO
         8 003102   200053 450500                    STP0    DAT+4,,AUTO
         8 003103   200053 630500                    EPPR0   DAT+4,,AUTO
         8 003104   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 003105   000000 701000 xent               TSX1    REMOTE_ADMIN
         8 003106   000000 011000                    NOP     0

      869     8328    4   RETALT:    GLOBAL_ERR = %FTP_PROCEDURE_ERR;              /*N* REPORT ERROR */

   8328  8 003107   000002 235007       RETALT       LDA     2,DL
         8 003110   000200 755000 1                  STA     GLOBAL_ERR

      870     8329    4              ALTRETURN;

   8329  8 003111   200020 221300                    LDX1  ! CURSIZ+2,,AUTO
         8 003112   000000 702211                    TSX2  ! 0,X1
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:139  

      871     8330    4              END;
      872     8331    3          END;
      873     8332    2      RETURN;

   8332  8 003113   200020 221300                    LDX1  ! CURSIZ+2,,AUTO
         8 003114   000001 702211                    TSX2  ! 1,X1

      874     8333
      875     8334        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:140  
      876     8335        /* Close lcn, wait for close ack, release it */
      877     8336    2   GET_CLOSE: ENTRY(LCN, TIMEOUT) ALTRET;

   8336  8 003115   200020 741300       GET_CLOSE    STX1  ! CURSIZ+2,,AUTO

      878     8337
      879     8338    2      CALL TCP$CLOSE (LCN)

   8338  8 003116   200021 630500                    EPPR0   @LCN,,AUTO
         8 003117   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 003120   000000 701000 xent               TSX1    TCP$CLOSE
         8 003121   003123 702000 8                  TSX2    s:8340
         8 003122   003131 710000 8                  TRA     s:8345

      880     8339    3      WHENALTRETURN DO;

      881     8340    3          CALL TCP$RELEASE(LCN);

   8340  8 003123   200021 630500                    EPPR0   @LCN,,AUTO
         8 003124   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 003125   000000 701000 xent               TSX1    TCP$RELEASE
         8 003126   000000 011000                    NOP     0

      882     8341    3          ALTRETURN;

   8341  8 003127   200020 221300                    LDX1  ! CURSIZ+2,,AUTO
         8 003130   000000 702211                    TSX2  ! 0,X1

      883     8342    3          END;
      884     8343
      885     8344    3      DO WHILE('1'B);

      886     8345    4          CALL TCP$READ (LCN, VECTOR(CMD_BUFFER), CB) WHENALTRETURN DO;

   8345  8 003131   000150 236000 9                  LDQ     104
         8 003132   200054 756100                    STQ     DAT+5,,AUTO
         8 003133   000101 236000 9                  LDQ     65
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:141  
         8 003134   200021 235100                    LDA     @LCN,,AUTO
         8 003135   200052 757100                    STAQ    DAT+3,,AUTO
         8 003136   200052 630500                    EPPR0   DAT+3,,AUTO
         8 003137   000021 631400 xsym               EPPR1   B_VECTNIL+17
         8 003140   000000 701000 xent               TSX1    TCP$READ
         8 003141   003143 702000 8                  TSX2    s:8346
         8 003142   003145 710000 8                  TRA     s:8349

      887     8346    4              CALL M$XXX;

   8346  8 003143   000003 713400                    CLIMB   3
         8 003144   000000 401760                    pmme    nvectors=0

      888     8347    4              END;

      889     8348
      890     8349    4          IF CB.ADMIN THEN DO;

   8349  8 003145   000630 234000 1                  SZN     CB
         8 003146   003131 605000 8                  TPL     s:8345

      891     8350    4              IF (ADDR(CMD_BUFFER)->TCP$ADMIN.CMD ~= %TCP_ADMINMSG_CLOSED) AND

   8350  8 003147   000000 235000 xsym               LDA     CMD_BUFFER
         8 003150   000007 115007                    CMPA    7,DL
         8 003151   003164 600000 8                  TZE     s:8354
         8 003152   000005 115007                    CMPA    5,DL
         8 003153   003164 600000 8                  TZE     s:8354

      892     8351    4                    (ADDR(CMD_BUFFER)->TCP$ADMIN.CMD ~= %TCP_ADMINMSG_CLOSING) THEN
      893     8352    4                  CALL REMOTE_ADMIN(ADDR(CMD_BUFFER));

   8352  8 003154   000063 236000 9                  LDQ     51
         8 003155   200052 756100                    STQ     DAT+3,,AUTO
         8 003156   200052 630500                    EPPR0   DAT+3,,AUTO
         8 003157   200053 450500                    STP0    DAT+4,,AUTO
         8 003160   200053 630500                    EPPR0   DAT+4,,AUTO
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:142  
         8 003161   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 003162   000000 701000 xent               TSX1    REMOTE_ADMIN
         8 003163   000000 011000                    NOP     0

      894     8353
      895     8354    4              CALL TCP$RELEASE(LCN);

   8354  8 003164   200021 630500                    EPPR0   @LCN,,AUTO
         8 003165   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 003166   000000 701000 xent               TSX1    TCP$RELEASE
         8 003167   000000 011000                    NOP     0

      896     8355    4              RETURN;

   8355  8 003170   200020 221300                    LDX1  ! CURSIZ+2,,AUTO
         8 003171   000001 702211                    TSX2  ! 1,X1

      897     8356    4              END;
      898     8357
      899     8358    3          END;

      900     8359    2   END GET_OPEN;
      901     8360
      902     8361        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:143  
      903     8362    1   OPEN_DATA_PORT: PROC ALTRET;

   8362  8 003172   200020 741300       OPEN_DATA_P* STX1  ! CURSIZ+2,,AUTO

      904     8363        /* Try a PASV command.
      905     8364           If it works, set up DATA_FS from the response,
      906     8365           otherwise ...
      907     8366           Open a listen socket,
      908     8367           generate a port command,
      909     8368           get response.
      910     8369           Altret if response is not good. */
      911     8370
      912     8371
      913     8372    2   DCL FMT_OUT CHAR(64);
      914     8373    2   DCL FMT_OUTL SBIN(36);
      915     8374    2   DCL FMT_OUTB CHAR(FMT_OUTL) BASED;
      916     8375
      917     8376    2      DATA_FS = '0'b;

   8376  8 003173   000457 450000 1                  STZ     DATA_FS
         8 003174   000460 450000 1                  STZ     DATA_FS+1

      918     8377    2      DATA_LS = '0'B;

   8377  8 003175   000461 450000 1                  STZ     DATA_LS
         8 003176   000462 450000 1                  STZ     DATA_LS+1

      919     8378        /*n* handle optional output to file */
      920     8379
      921     8380    3      IF PASV >= 0 THEN DO;

   8380  8 003177   000447 235000 1                  LDA     PASV
         8 003200   003236 604000 8                  TMI     s:8397

      922     8381    3          CALL SIMPLE_CMD('PASV') ALTRET(NOTPASV); /* Try passive mode */

   8381  8 003201   000001 236000 xsym               LDQ     B_VECTNIL+1
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:144  
         8 003202   200044 756100                    STQ     @TEXTC,,AUTO
         8 003203   000151 236000 9                  LDQ     105
         8 003204   200043 756100                    STQ     @CMDT,,AUTO
         8 003205   001670 701000 8                  TSX1    SIMPLE_CMD
         8 003206   003234 702000 8                  TSX2    NOTPASV

      923     8382    4          IF RCODE.A = '2' THEN DO;

   8382  8 003207   000172 236000 1                  LDQ     RCODE
         8 003210   777000 376003                    ANQ     -512,DU
         8 003211   062000 116003                    CMPQ    25600,DU
         8 003212   003234 601000 8                  TNZ     NOTPASV

      924     8383    4              FMT_OUTL = WRITE_LO.BUF_.BOUND+1;

   8383  8 003213   000004 236000 xsym               LDQ     WRITE_LO+4
         8 003214   000020 772000                    QRL     16
         8 003215   000001 036007                    ADLQ    1,DL
         8 003216   200041 756100                    STQ     FMT_OUTL,,AUTO

      925     8384    4              CALL PARSE_PORT(DATA_FS, WRITE_LO.BUF_.BUF$->FMT_OUTB);

   8384  8 003217   000005 236000 xsym               LDQ     WRITE_LO+5
         8 003220   200044 756100                    STQ     @TEXTC,,AUTO
         8 003221   000152 236000 9                  LDQ     106
         8 003222   200043 756100                    STQ     @CMDT,,AUTO
         8 003223   003365 701000 8                  TSX1    PARSE_PORT
         8 003224   000000 011000                    NOP     0

      926     8385    4              PASV = PASV + 1;

   8385  8 003225   000447 054000 1                  AOS     PASV

      927     8386    4              CALL TCP$OPEN (DATA_LCN, DATA_LS, DATA_FS, %TCP_ACTIVE)

   8386  8 003226   000153 630400 9                  EPPR0   107
         8 003227   000022 631400 xsym               EPPR1   B_VECTNIL+18
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:145  
         8 003230   000000 701000 xent               TSX1    TCP$OPEN
         8 003231   003300 702000 8                  TSX2    RETALT

      928     8387    4                ALTRET(RETALT);
      929     8388    4              RETURN;

   8388  8 003232   200020 221300                    LDX1  ! CURSIZ+2,,AUTO
         8 003233   000001 702211                    TSX2  ! 1,X1

      930     8389    4              END;
      931     8390    4          ELSE DO;

      932     8391    4   NOTPASV:   PASV = -1;

   8391  8 003234   000001 335007       NOTPASV      LCA     1,DL
         8 003235   000447 755000 1                  STA     PASV

      933     8392    4              END;

      934     8393    3          END;

      935     8394
      936     8395                       /* Open a socket in listen mode, send address to other end */
      937     8396
      938     8397    2      DATA_LS.PORT = 0;

   8397  8 003236   000462 450000 1                  STZ     DATA_LS+1

      939     8398    2      DATA_LS.ADDRESS = CMD_LS.ADDRESS;

   8398  8 003237   000000 236000 xsym               LDQ     CMD_LS
         8 003240   000004 772000                    QRL     4
         8 003241   000004 736000                    QLS     4
         8 003242   000461 756000 1                  STQ     DATA_LS

      940     8399    2      IF DATA_LS.ADDRESS/%BITBIN('01000000'X) = 127

PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:146  
   8399  8 003243   000461 236000 1                  LDQ     DATA_LS
         8 003244   000004 772000                    QRL     4
         8 003245   000030 772000                    QRL     24
         8 003246   000177 116007                    CMPQ    127,DL
         8 003247   003254 601000 8                  TNZ     s:8401

      941     8400    2      THEN DATA_LS.ADDRESS = CMD_FS.ADDRESS;

   8400  8 003250   000000 236000 xsym               LDQ     CMD_FS
         8 003251   000004 772000                    QRL     4
         8 003252   000004 736000                    QLS     4
         8 003253   000461 756000 1                  STQ     DATA_LS

      942     8401    2      IF NOT SENDPORT THEN DATA_LS.PORT = CMD_LS.PORT;

   8401  8 003254   000454 236000 1                  LDQ     SENDPORT
         8 003255   003262 601000 8                  TNZ     s:8402

   8401  8 003256   000001 236000 xsym               LDQ     CMD_LS+1
         8 003257   000024 772000                    QRL     20
         8 003260   000024 736000                    QLS     20
         8 003261   000462 756000 1                  STQ     DATA_LS+1

      943     8402    2      DATA_LCN = -1;

   8402  8 003262   000001 336007                    LCQ     1,DL
         8 003263   000000 756000 xsym               STQ     DATA_LCN

      944     8403    2      CALL TCP$OPEN (DATA_LCN, DATA_LS, DATA_FS, %TCP_PASSIVE,,DATA_LS)

   8403  8 003264   000154 236000 9                  LDQ     108
         8 003265   000001 235000 xsym               LDA     B_VECTNIL+1
         8 003266   200056 757100                    STAQ    DAT+7,,AUTO
         8 003267   000160 237000 9                  LDAQ    112
         8 003270   200054 757100                    STAQ    DAT+5,,AUTO
         8 003271   000162 237000 9                  LDAQ    114
         8 003272   200052 757100                    STAQ    DAT+3,,AUTO
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:147  
         8 003273   200052 630500                    EPPR0   DAT+3,,AUTO
         8 003274   000024 631400 xsym               EPPR1   B_VECTNIL+20
         8 003275   000000 701000 xent               TSX1    TCP$OPEN
         8 003276   003300 702000 8                  TSX2    RETALT
         8 003277   003314 710000 8                  TRA     s:8412

      945     8404    3      WHENALTRETURN DO;

   8400  8 003300                       RETALT       null
      946     8405    3   RETALT: ;
      947     8406    3          CALL REPORT_TCP;

   8406  8 003300   003526 701000 8                  TSX1    REPORT_TCP
         8 003301   000000 011000                    NOP     0

      948     8407    3          IF DATA_LCN >= 0 THEN CALL TCP$RELEASE (DATA_LCN);

   8407  8 003302   000000 235000 xsym               LDA     DATA_LCN
         8 003303   003310 604000 8                  TMI     s:8408

   8407  8 003304   000072 630400 9                  EPPR0   58
         8 003305   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 003306   000000 701000 xent               TSX1    TCP$RELEASE
         8 003307   000000 011000                    NOP     0

      949     8408    3          GLOBAL_ERR = %FTP_PROCEDURE_ERR;              /*N* REPORT ERROR */

   8408  8 003310   000002 235007                    LDA     2,DL
         8 003311   000200 755000 1                  STA     GLOBAL_ERR

      950     8409    3          ALTRETURN;

   8409  8 003312   200020 221300                    LDX1  ! CURSIZ+2,,AUTO
         8 003313   000000 702211                    TSX2  ! 0,X1

      951     8410    3          END;
      952     8411
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:148  
      953     8412    2      IF NOT SENDPORT THEN RETURN;

   8412  8 003314   000454 235000 1                  LDA     SENDPORT
         8 003315   003320 601000 8                  TNZ     s:8414

   8412  8 003316   200020 221300                    LDX1  ! CURSIZ+2,,AUTO
         8 003317   000001 702211                    TSX2  ! 1,X1

      954     8413                                                /* Build port command */
      955     8414    2      CALL PORT(DATA_LS.ADDRESS, DATA_LS.PORT);

   8414  8 003320   000164 236000 9                  LDQ     116
         8 003321   200044 756100                    STQ     @TEXTC,,AUTO
         8 003322   000154 236000 9                  LDQ     108
         8 003323   200043 756100                    STQ     @CMDT,,AUTO
         8 003324   003461 701000 8                  TSX1    PORT
         8 003325   000000 011000                    NOP     0

      956     8415    2      CALL TCP$WRITE_D (CMD_LCN, VECTOR(SUBSTR(FMT_OUT,1,FMT_OUTL-1)))

   8415  8 003326   200041 235100                    LDA     FMT_OUTL,,AUTO
         8 003327   000020 735000                    ALS     16
         8 003330   200140 135007                    SBLA    65632,DL
         8 003331   200052 452500                    STP2    DAT+3,,AUTO
         8 003332   200052 236100                    LDQ     DAT+3,,AUTO
         8 003333   000165 036000 9                  ADLQ    117
         8 003334   200054 757100                    STAQ    DAT+5,,AUTO
         8 003335   200054 630500                    EPPR0   DAT+5,,AUTO
         8 003336   200057 450500                    STP0    DAT+8,,AUTO
         8 003337   000014 236000 9                  LDQ     12
         8 003340   200056 756100                    STQ     DAT+7,,AUTO
         8 003341   200056 630500                    EPPR0   DAT+7,,AUTO
         8 003342   000020 631400 xsym               EPPR1   B_VECTNIL+16
         8 003343   000000 701000 xent               TSX1    TCP$WRITE_D
         8 003344   003300 702000 8                  TSX2    RETALT

      957     8416    2        ALTRET (RETALT);
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:149  
      958     8417    2      CALL TELNET_EOL (CMD_LCN);

   8417  8 003345   000014 630400 9                  EPPR0   12
         8 003346   000017 631400 xsym               EPPR1   B_VECTNIL+15
         8 003347   000000 701000 xent               TSX1    TELNET_EOL
         8 003350   000000 011000                    NOP     0

      959     8418    2      CALL GET_RESPONSE (CMD_LCN, RCODE, VERBOSE)

   8418  8 003351   000056 630400 9                  EPPR0   46
         8 003352   000021 631400 xsym               EPPR1   B_VECTNIL+17
         8 003353   000000 701000 xent               TSX1    GET_RESPONSE
         8 003354   003300 702000 8                  TSX2    RETALT

      960     8419    2        ALTRET (RETALT);
      961     8420    2      IF RCODE.A ~= '2' THEN GLOBAL_ERR = %FTP_COMMAND_ERR;

   8420  8 003355   000172 236000 1                  LDQ     RCODE
         8 003356   777000 376003                    ANQ     -512,DU
         8 003357   062000 116003                    CMPQ    25600,DU
         8 003360   003363 600000 8                  TZE     s:8421

   8420  8 003361   000001 235007                    LDA     1,DL
         8 003362   000200 755000 1                  STA     GLOBAL_ERR

      962     8421    2      RETURN;

   8421  8 003363   200020 221300                    LDX1  ! CURSIZ+2,,AUTO
         8 003364   000001 702211                    TSX2  ! 1,X1

      963     8422
      964     8423        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:150  
      965     8424    2   PARSE_PORT: PROC(SOCKET,TEXT);

   8424  8 003365   200042 741300       PARSE_PORT   STX1  ! FMT_OUTL+1,,AUTO

      966     8425        %TCP$SOCKET (NAME=SOCKET, STCLASS=PARAM);
      967     8433    3   DCL TEXT(0:0) CHAR(1);
      968     8434    3   DCL I SBIN;
      969     8435    3   DCL J SBIN;
      970     8436    3   DCL K SBIN;
      971     8437
      972     8438    3      CALL INDEX(J,'(',ADDR(TEXT)->FMT_OUTB);

   8438  8 003366   200044 470500                    LDP0    @TEXT,,AUTO
         8 003367   200041 720100                    LXL0    FMT_OUTL,,AUTO
         8 003370   000000 124540                    SCM     mask='000'O
         8 003371   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0
         8 003372   000166 000001 9                  ADSC9   118                      cn=0,n=1
         8 003373   200046 000100                    ARG     J,,AUTO

      973     8439    3      I=0;

   8439  8 003374   200045 450100                    STZ     I,,AUTO

      974     8440    3      K=0;

   8440  8 003375   200047 450100                    STZ     K,,AUTO

      975     8441    4      DO WHILE '1'B;

      976     8442    4          J = J + 1;

   8442  8 003376   200046 054100                    AOS     J,,AUTO

      977     8443    5          IF TEXT(J) < '0' OR TEXT(J) > '9' THEN DO;

   8443  8 003377   200044 470500                    LDP0    @TEXT,,AUTO
         8 003400   200046 235100                    LDA     J,,AUTO
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:151  
         8 003401   040000 106505                    CMPC    fill='040'O
         8 003402   000000 000001                    ADSC9   0,A,PR0                  cn=0,n=1
         8 003403   000167 000001 9                  ADSC9   119                      cn=0,n=1
         8 003404   003411 602000 8                  TNC     s:8444
         8 003405   040105 106400                    CMPC    fill='040'O
         8 003406   000170 000001 9                  ADSC9   120                      cn=0,n=1
         8 003407   000000 000001                    ADSC9   0,A,PR0                  cn=0,n=1
         8 003410   003446 603000 8                  TRC     s:8452

      978     8444    5              I = I + 1;

   8444  8 003411   200045 054100                    AOS     I,,AUTO

      979     8445    5              SOCKET.PORT = SOCKET.PORT*256 + K;

   8445  8 003412   200043 471500                    LDP1    @SOCKET,,AUTO
         8 003413   100001 236100                    LDQ     1,,PR1
         8 003414   000014 772000                    QRL     12
         8 003415   000171 376000 9                  ANQ     121
         8 003416   200047 036100                    ADLQ    K,,AUTO
         8 003417   000024 736000                    QLS     20
         8 003420   100001 756100                    STQ     1,,PR1

      980     8446    5              IF I = 6 THEN RETURN;

   8446  8 003421   200045 235100                    LDA     I,,AUTO
         8 003422   000006 115007                    CMPA    6,DL
         8 003423   003426 601000 8                  TNZ     s:8447

   8446  8 003424   200042 221300                    LDX1  ! FMT_OUTL+1,,AUTO
         8 003425   000001 702211                    TSX2  ! 1,X1

      981     8447    6              IF MOD(I,2) = 0 THEN DO;

   8447  8 003426   200045 236100                    LDQ     I,,AUTO
         8 003427   000002 506007                    DIV     2,DL
         8 003430   000044 733000                    LRS     36
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:152  
         8 003431   000000 116003                    CMPQ    0,DU
         8 003432   003444 601000 8                  TNZ     s:8450

      982     8448    6                  SOCKET.ADDRESS = SOCKET.ADDRESS*65536 + SOCKET.PORT;

   8448  8 003433   100001 236100                    LDQ     1,,PR1
         8 003434   000024 772000                    QRL     20
         8 003435   200052 756100                    STQ     DAT+3,,AUTO
         8 003436   100000 236100                    LDQ     0,,PR1
         8 003437   000014 736000                    QLS     12
         8 003440   000034 376000 xsym               ANQ     B_VECTNIL+28
         8 003441   200052 036100                    ADLQ    DAT+3,,AUTO
         8 003442   000004 736000                    QLS     4
         8 003443   100000 756100                    STQ     0,,PR1

      983     8449    6                  END;

      984     8450    5              K = 0;

   8450  8 003444   200047 450100                    STZ     K,,AUTO

      985     8451    5              END;

   8451  8 003445   003376 710000 8                  TRA     s:8442

      986     8452    4          ELSE K = K*10 + ASCBIN(TEXT(J)) - 48;

   8452  8 003446   000100 101505                    MRL     fill='000'O
         8 003447   000000 000001                    ADSC9   0,A,PR0                  cn=0,n=1
         8 003450   200052 000004                    ADSC9   DAT+3,,AUTO              cn=0,n=4
         8 003451   200052 236100                    LDQ     DAT+3,,AUTO
         8 003452   200053 756100                    STQ     DAT+4,,AUTO
         8 003453   200047 236100                    LDQ     K,,AUTO
         8 003454   000012 402007                    MPY     10,DL
         8 003455   200053 036100                    ADLQ    DAT+4,,AUTO
         8 003456   000060 136007                    SBLQ    48,DL
         8 003457   200047 756100                    STQ     K,,AUTO
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:153  

      987     8453    4          END;

   8453  8 003460   003376 710000 8                  TRA     s:8442

      988     8454    3   END PARSE_PORT;
      989     8455
      990     8456        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:154  
      991     8457    2   PORT: PROC(ADDRESS,PORT);

   8457  8 003461   200042 741300       PORT         STX1  ! FMT_OUTL+1,,AUTO

      992     8458
      993     8459    3   DCL 1 ADDRESS UBIN(32) ALIGNED;
      994     8460
      995     8461    3   DCL 1 PORT UBIN(16) ALIGNED;
      996     8462
      997     8463
      998     8464    3   DCL 1 IPFMT CONSTANT CHAR(0) INIT('PORT %.8D,%.8D,%.8D,%.8D,%S%.8D,%.8D%1Q');
      999     8465
     1000     8466    3      FDS.BUF_ = VECTOR(FMT_OUT);

   8466  8 003462   000172 235000 9                  LDA     122
         8 003463   200052 452500                    STP2    DAT+3,,AUTO
         8 003464   200052 236100                    LDQ     DAT+3,,AUTO
         8 003465   000021 036003                    ADLQ    17,DU
         8 003466   000005 755000 1                  STA     FDS+5
         8 003467   000006 756000 1                  STQ     FDS+6

     1001     8467    3      CALL X$WRITE (FDS, VECTOR(IPFMT), VECTOR(ADDRESS),

   8467  8 003470   777640 235007                    LDA     -96,DL
         8 003471   200043 236100                    LDQ     @ADDRESS,,AUTO
         8 003472   200052 757100                    STAQ    DAT+3,,AUTO
         8 003473   777640 235007                    LDA     -96,DL
         8 003474   200044 236100                    LDQ     @PORT,,AUTO
         8 003475   200056 757100                    STAQ    DAT+7,,AUTO
         8 003476   200052 237100                    LDAQ    DAT+3,,AUTO
         8 003477   200054 757100                    STAQ    DAT+5,,AUTO
         8 003500   200056 237100                    LDAQ    DAT+7,,AUTO
         8 003501   200060 757100                    STAQ    DAT+9,,AUTO
         8 003502   200060 630500                    EPPR0   DAT+9,,AUTO
         8 003503   200065 450500                    STP0    DAT+14,,AUTO
         8 003504   200054 631500                    EPPR1   DAT+5,,AUTO
         8 003505   200064 451500                    STP1    DAT+13,,AUTO
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:155  
         8 003506   000176 237000 9                  LDAQ    126
         8 003507   200062 757100                    STAQ    DAT+11,,AUTO
         8 003510   200062 630500                    EPPR0   DAT+11,,AUTO
         8 003511   000022 631400 xsym               EPPR1   B_VECTNIL+18
         8 003512   000000 701000 xent               TSX1    X$WRITE
         8 003513   000000 011000                    NOP     0

     1002     8468    3            VECTOR(PORT));
     1003     8469    3      FMT_OUTL = FDS.BUFX;

   8469  8 003514   000007 235000 1                  LDA     FDS+7
         8 003515   200041 755100                    STA     FMT_OUTL,,AUTO

     1004     8470
     1005     8471    3   END PORT;

   8471  8 003516   200042 221300                    LDX1  ! FMT_OUTL+1,,AUTO
         8 003517   000001 702211                    TSX2  ! 1,X1

     1006     8472    2   END OPEN_DATA_PORT;
     1007     8473        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:156  
     1008     8474    1   REPORT_ALT: PROC;

   8474  8 003520   200042 741300       REPORT_ALT   STX1  ! FMT_OUTL+1,,AUTO

     1009     8475        %FPT_ERRMSG (BUF=LINE_BUF,                /* errmsg */
     1010     8476               OUTDCB1=M$DO,
     1011     8477               CODE=TCP_MON_ERR,
     1012     8478               INCLCODE=NO,
     1013     8479               SOURCE=ALTRET);
     1014     8506    2   DCL M$DO DCB;
     1015     8507
     1016     8508    2      FPT_ERRMSG.V.SOURCE# = 2;

   8508  8 003521   000666 236000 1                  LDQ     FPT_ERRMSG+24
         8 003522   000173 376000 9                  ANQ     123
         8 003523   100000 276007                    ORQ     32768,DL
         8 003524   000666 756000 1                  STQ     FPT_ERRMSG+24

     1017     8509    2      GOTO CMN;

   8509  8 003525   003544 710000 8                  TRA     CMN

     1018     8510
     1019     8511    2   REPORT_TCP: ENTRY;

   8511  8 003526   200042 741300       REPORT_TCP   STX1  ! FMT_OUTL+1,,AUTO

     1020     8512    2      IF TCP_MON_ERR.ERR# = 0 THEN RETURN;

   8512  8 003527   000000 236000 xsym               LDQ     TCP_MON_ERR
         8 003530   377770 316007                    CANQ    131064,DL
         8 003531   003533 601000 8                  TNZ     s:8513

   8512  8 003532   000001 702211                    TSX2  ! 1,X1

     1021     8513    2      IF TCP_MON_ERR.MON THEN FPT_ERRMSG.V.SOURCE# = 2;

PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:157  
   8513  8 003533   400000 316007                    CANQ    -131072,DL
         8 003534   003542 600000 8                  TZE     s:8514

   8513  8 003535   000666 236000 1                  LDQ     FPT_ERRMSG+24
         8 003536   000173 376000 9                  ANQ     123
         8 003537   100000 276007                    ORQ     32768,DL
         8 003540   000666 756000 1                  STQ     FPT_ERRMSG+24
         8 003541   003544 710000 8                  TRA     CMN

     1022     8514    2      ELSE FPT_ERRMSG.V.SOURCE# = 0;

   8514  8 003542   000173 236000 9                  LDQ     123
         8 003543   000666 356000 1                  ANSQ    FPT_ERRMSG+24

   8513  8 003544                       CMN          null
     1023     8515
     1024     8516    2   CMN: ;
     1025     8517    2      CALL M$ERRMSG (FPT_ERRMSG);

   8517  8 003544   000636 630400 1                  EPPR0   FPT_ERRMSG
         8 003545   020000 713400                    CLIMB   8192
         8 003546   405000 401760                    pmme    nvectors=11

     1026     8518    2      RETURN;

   8518  8 003547   200042 221300                    LDX1  ! FMT_OUTL+1,,AUTO
         8 003550   000001 702211                    TSX2  ! 1,X1

     1027     8519    2   END REPORT_ALT;
     1028     8520
     1029     8521
     1030     8522    1   LINE_SUB: PROC(TEXTC);

   8522  8 003551   200014 741300       LINE_SUB     STX1  ! @ONOVER,,AUTO

     1031     8523    2   DCL 1 TEXTC ALIGNED,2 COUNT UBIN BYTE UNAL,2 TEXT CHAR(TEXTC.COUNT);
     1032     8524    2   DCL SUBTBL CONSTANT CHAR(0) INIT('
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:158  
     1033     8525        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
     1034     8526          !"#.%&''()*+,-$/0123456789:;<=>?
     1035     8527        @ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_
     1036     8528        `abcdefghijklmnopqrstuvwxyz{|}~^
     1037     8529        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
     1038     8530          !"#.%&''()*+,-$/0123456789:;<=>?
     1039     8531        @ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_
     1040     8532    2   `abcdefghijklmnopqrstuvwxyz{|}~^');
     1041     8533
     1042     8534    2   DCL I UBIN(36);
     1043     8535
     1044     8536        /*N* ADD COMMAND TO CHANGE SUB CHARS */
     1045     8537    2      TFID.COUNT = TEXTC.COUNT;

   8537  8 003552   200015 470500                    LDP0    @TEXTC,,AUTO
         8 003553   000000 236100                    LDQ     0,,PR0
         8 003554   000201 552040 1                  STBQ    TFID,'40'O

     1046     8538    2      CALL XLATE (TFID.TEXT, SUBTBL, TEXTC.TEXT);

   8538  8 003555   000000 236100                    LDQ     0,,PR0
         8 003556   000033 772000                    QRL     27
         8 003557   000000 620006                    EAX0    0,QL
         8 003560   040000 160540                    MVT     fill='040'O
         8 003561   000000 200010                    ADSC9   0,,PR0                   cn=1,n=*X0
         8 003562   000201 200117 1                  ADSC9   TFID                     cn=1,n=79
         8 003563   000477 000000 2                  ARG     SUBTBL

     1047     8539    2      RETURN;

   8539  8 003564   000001 702211                    TSX2  ! 1,X1

     1048     8540    2   END LINE_SUB;
     1049     8541
     1050     8542        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:159  
     1051     8543    1   HASH_MARKS: PROC;

   8543  8 003565   200020 741300       HASH_MARKS   STX1  ! CURSIZ+2,,AUTO

     1052     8544    2   DCL LAST_HASH SBIN STATIC;
     1053     8545    2   DCL HASH_MSG CONSTANT CHAR(0) INIT('@#');
     1054     8546
     1055     8547    2      IF BYTES = 0 THEN LAST_HASH = 4096;

   8547  8 003566   000227 235000 1                  LDA     BYTES
         8 003567   003572 601000 8                  TNZ     s:8548

   8547  8 003570   010000 236007                    LDQ     4096,DL
         8 003571   000670 756000 1                  STQ     LAST_HASH

     1056     8548    3      DO WHILE LAST_HASH < BYTES;

   8548  8 003572   000670 236000 1                  LDQ     LAST_HASH
         8 003573   003576 604000 8                  TMI     s:8549
         8 003574   000227 116000 1                  CMPQ    BYTES
         8 003575   003615 603000 8                  TRC     s:8555

     1057     8549    3          WRITE_LO.V.DVBYTE.VFC# = '1'B;

   8549  8 003576   100000 236003                    LDQ     32768,DU
         8 003577   000013 256000 xsym               ORSQ    WRITE_LO+11

     1058     8550    3          WRITE_LO.BUF_ = VECTOR( HASH_MSG);

   8550  8 003600   000200 237000 9                  LDAQ    128
         8 003601   000004 757000 xsym               STAQ    WRITE_LO+4

     1059     8551    3          CALL M$WRITE( WRITE_LO);

   8551  8 003602   000000 630400 xsym               EPPR0   WRITE_LO
         8 003603   040001 713400                    CLIMB   write
         8 003604   401400 401760                    pmme    nvectors=4
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:160  

     1060     8552    3          WRITE_LO.V.DVBYTE.VFC# = '0'B;

   8552  8 003605   000202 236000 9                  LDQ     130
         8 003606   000013 356000 xsym               ANSQ    WRITE_LO+11

     1061     8553    3          LAST_HASH = LAST_HASH + 4096;

   8553  8 003607   010000 236007                    LDQ     4096,DL
         8 003610   000670 056000 1                  ASQ     LAST_HASH

     1062     8554    3          END;

   8554  8 003611   000670 236000 1                  LDQ     LAST_HASH
         8 003612   003576 604000 8                  TMI     s:8549
         8 003613   000227 116000 1                  CMPQ    BYTES
         8 003614   003576 602000 8                  TNC     s:8549

     1063     8555    2      RETURN;

   8555  8 003615   200020 221300                    LDX1  ! CURSIZ+2,,AUTO
         8 003616   000001 702211                    TSX2  ! 1,X1

     1064     8556    2   END HASH_MARKS;
     1065     8557        %EJECT;
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:161  
     1066     8558    1   REPORT_TIME: PROC(BYTES,TIME);

   8558  8 003617   200020 741300       REPORT_TIME  STX1  ! CURSIZ+2,,AUTO

     1067     8559    2   DCL BYTES SBIN(36);
     1068     8560    2   DCL TIME SBIN(36);
     1069     8561    2   DCL FDSBUF CHAR(80);
     1070     8562    2   DCL FMT CHAR(0) CONSTANT
     1071     8563    2    INIT('%D bytes transferred in %N=%.#:10/KD.%1.#KD seconds
     1072     8564    2     (%N=%.#:10/KD%#:200/[.%1.#KD%] Kbytes/s)');
     1073     8565    2   DCL M$LO DCB;
     1074     8566    2   DCL 1 DAT,
     1075     8567    2      2 BYTES SBIN,
     1076     8568    2      2 SECS SBIN,
     1077     8569    2      2 BPS SBIN;
     1078     8570
     1079     8571    2      DAT.SECS=TIME;

   8571  8 003620   200022 470500                    LDP0    @TIME,,AUTO
         8 003621   000000 235100                    LDA     0,,PR0
         8 003622   200050 755100                    STA     DAT+1,,AUTO

     1080     8572    2      IF DAT.SECS<0 THEN DAT.SECS=DAT.SECS+86400000; /* Add a day if it wrapped */

   8572  8 003623   003626 605000 8                  TPL     s:8573

   8572  8 003624   000203 236000 9                  LDQ     131
         8 003625   200050 056100                    ASQ     DAT+1,,AUTO

     1081     8573    2      DAT.SECS=(DAT.SECS+50)/100; /* time in tenths */

   8573  8 003626   200050 236100                    LDQ     DAT+1,,AUTO
         8 003627   000062 036007                    ADLQ    50,DL
         8 003630   000144 506007                    DIV     100,DL
         8 003631   200050 756100                    STQ     DAT+1,,AUTO

     1082     8574    2      IF DAT.SECS=0 THEN DAT.SECS=DAT.SECS+1;
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:162  

   8574  8 003632   000000 116003                    CMPQ    0,DU
         8 003633   003635 601000 8                  TNZ     s:8575

   8574  8 003634   200050 054100                    AOS     DAT+1,,AUTO

     1083     8575    2      DAT.BYTES=BYTES;

   8575  8 003635   200021 471500                    LDP1    @BYTES,,AUTO
         8 003636   100000 235100                    LDA     0,,PR1
         8 003637   200047 755100                    STA     DAT,,AUTO

     1084     8576    2      DAT.BPS=(DAT.BYTES+9)/10/DAT.SECS;

   8576  8 003640   200047 236100                    LDQ     DAT,,AUTO
         8 003641   000011 036007                    ADLQ    9,DL
         8 003642   000012 506007                    DIV     10,DL
         8 003643   200050 506100                    DIV     DAT+1,,AUTO
         8 003644   200051 756100                    STQ     DAT+2,,AUTO

     1085     8577    2      FDS.BUF_ = VECTOR( FDSBUF);

   8577  8 003645   000204 235000 9                  LDA     132
         8 003646   200052 452500                    STP2    DAT+3,,AUTO
         8 003647   200052 236100                    LDQ     DAT+3,,AUTO
         8 003650   000023 036003                    ADLQ    19,DU
         8 003651   000005 755000 1                  STA     FDS+5
         8 003652   000006 756000 1                  STQ     FDS+6

     1086     8578    2      CALL X$WRITE (FDS, VECTOR(FMT), VECTOR(DAT));

   8578  8 003653   000205 235000 9                  LDA     133
         8 003654   200052 452500                    STP2    DAT+3,,AUTO
         8 003655   200052 236100                    LDQ     DAT+3,,AUTO
         8 003656   000047 036003                    ADLQ    39,DU
         8 003657   200054 757100                    STAQ    DAT+5,,AUTO
         8 003660   200054 633500                    EPPR3   DAT+5,,AUTO
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:163  
         8 003661   200060 453500                    STP3    DAT+9,,AUTO
         8 003662   000210 237000 9                  LDAQ    136
         8 003663   200056 757100                    STAQ    DAT+7,,AUTO
         8 003664   200056 630500                    EPPR0   DAT+7,,AUTO
         8 003665   000021 631400 xsym               EPPR1   B_VECTNIL+17
         8 003666   000000 701000 xent               TSX1    X$WRITE
         8 003667   000000 011000                    NOP     0

     1087     8579    3      IF BELL THEN DO;

   8579  8 003670   000450 235000 1                  LDA     BELL
         8 003671   003677 600000 8                  TZE     s:8583

     1088     8580    3          SUBSTR( FDSBUF,FDS.BUFX,1) = BINASC(7);

   8580  8 003672   000007 236000 1                  LDQ     FDS+7
         8 003673   040106 100400                    MLR     fill='040'O
         8 003674   000212 000001 9                  ADSC9   138                      cn=0,n=1
         8 003675   200023 000001                    ADSC9   FDSBUF,Q,AUTO            cn=0,n=1

     1089     8581    3          FDS.BUFX = FDS.BUFX+1;

   8581  8 003676   000007 054000 1                  AOS     FDS+7

     1090     8582    3          END;

     1091     8583    2      WRITE_LO.BUF_ = VECTOR( SUBSTR( FDSBUF,1,FDS.BUFX-1));

   8583  8 003677   000007 236000 1                  LDQ     FDS+7
         8 003700   000064 737000                    LLS     52
         8 003701   200140 135007                    SBLA    65632,DL
         8 003702   200052 452500                    STP2    DAT+3,,AUTO
         8 003703   200052 236100                    LDQ     DAT+3,,AUTO
         8 003704   000213 036000 9                  ADLQ    139
         8 003705   000004 757000 xsym               STAQ    WRITE_LO+4

     1092     8584    2      CALL M$WRITE( WRITE_LO);
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:164  

   8584  8 003706   000000 630400 xsym               EPPR0   WRITE_LO
         8 003707   040001 713400                    CLIMB   write
         8 003710   401400 401760                    pmme    nvectors=4

     1093     8585
     1094     8586    2      RETURN;

   8586  8 003711   200020 221300                    LDX1  ! CURSIZ+2,,AUTO
         8 003712   000001 702211                    TSX2  ! 1,X1

FDS
 Sect OctLoc
   1     000   000000 177640   000000 006014   000000 000000   000000 000000    ................
   1     004   000000 000000   000000 177640   000000 006014   000000 000001    ................
   1     010   000000 000000   000000 000000   000000 006014   000000 101500    ..............A.
   1     014   000000 000000   000000 000000   000000 000001   000000 000012    ................
   1     020   000000 000000   ****** ******   ****** ******   000000 000000    ................
   1     024   000000 000000   000000 000000   000000 000000   000000 006014    ................
   1     030   000000 006014   000000 006014   000000 006014   000000 000000    ................
   1     034   000000 000000   000000 000000                                    ........

XUG_GETCMD
 Sect OctLoc
   1     036   000000 006000   000000 006014   000000 006014   000000 006014    ................
   1     042   000000 006014   000000 006014   240000 000000   04000* ***000    ............ ...
   1     046   000000 000000   000000 000000   000000 000000   000000 000000    ................
   1     052   000000 000000   000000 000000   000000 000000   000000 177640    ................
   1     056   000000 006014   000000 177640   000000 006014   000000 177640    ................
   1     062   000000 006014   000000 777640   000000 006000   000000 177640    ................
   1     066   000000 006014   000000 000000   000000 000000   000000 000000    ................
   1     072   000000 177640   000000 006014   000000 006014   000000 000000    ................
   1     076   000000 006014   000000 006014   000000 006014   000000 006014    ................
   1     102   000000 006014   000000 006014   000000 000000   000000 000000    ................
   1     106   000000 000000   000000 000000                                    ........

XUG_INIT
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:165  
 Sect OctLoc
   1     112   000000 000000   000000 000000   000000 000000   000000 000000    ................
   1     122*  000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     126   000000 006014   000000 177640   000000 006014   000000 006014    ................
   1     132   000000 006014   000000 177640   000000 006014   000000 000454    ................
   1     136   000144 000144   000001 000000   674000 000000   000000 000000    .d.d............
   1     142   000000 000000   000000 000000   000000 000000   000000 006014    ................
   1     146   000000 006014   000000 006014   000000 006014   000000 006014    ................
   1     152   04000* ******   000000 000000   000000 000000   000000 000000     ...............

WRITE_DATA
 Sect OctLoc
   1     156   000003 777640   000166 006000   000000 177640   000000 006014    .....v..........
   1     162   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     166   000000 400400   000000 000000   000000 000000   000000 000000    ................

CB
 Sect OctLoc
   1     173   ****** ******   ****** ******   ****** ******   ****** ******    ................

TFID
 Sect OctLoc
   1     201   ****** ******   ****** ******   ****** ******   ****** ******    ................

FPT_TIME
 Sect OctLoc
   1     232   000001 777640   000244 006000   000000 177640   000000 006014    ................
   1     236   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     242   000000 777640   000230 006000   000005 000000   ****** ******    ................

FPT_OPEN
 Sect OctLoc
   1     250   000025 777640   000314 006000   000003 777640   000356 006000    ................
   1     254   000000 177640   000000 006014   000007 777640   000344 006000    ................
   1     260   000001 777640   000354 006000   000000 177640   000000 006014    ................
   1     264   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     274*  000001 777640   000342 006000   000000 177640   000000 006014    ................
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:166  
   1     300   000000 177640   000000 006014   000001 777640   000362 006000    ................
   1     304   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     314*  000000 600042   000000 000000   252525 000001   000040 252520    ..."......... ..
   1     320   000040 040040   000000 000002   000000 777777   000000 000000    .   ............
   1     324   000000 000000   000000 000000   000000 000000   000000 000000    ................
   1     330   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
   1     334   040040 040040   000000 000000   000000 000000   000000 000000        ............
   1     340   000000 000000   ****** ******                                    ........

VLP_ACCT
 Sect OctLoc
   1     342   040040 040040   040040 040040

VLP_NAME
 Sect OctLoc
   1     344   037040 040040   040040 040040   040040 040040   040040 040040    .
   1     350   040040 040040   040040 040040   040040 040040   040040 040040

VLP_PASS
 Sect OctLoc
   1     354   040040 040040   040040 040040

VLP_SN
 Sect OctLoc
   1     356   000000 000001   040040 040040   040040 ******                    ....      ..

VLP_WSN
 Sect OctLoc
   1     362   040040 040040   040040 040040

FPT_FID
 Sect OctLoc
   1     364   000003 777640   000410 006000   000000 177640   000000 006014    ................
   1     370   000007 777640   000344 006000   000001 777640   000342 006000    ................
   1     374   000001 777640   000354 006000   000003 777640   000356 006000    ................
   1     400   000001 777640   000362 006000   000000 177640   000315 606000    ................
   1     404   000000 777640   000320 006000   000000 177640   000000 006014    ................
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:167  
   1     410   777000 000000   000000 000000   000000 000000   ****** ******    ................

FPT_WRITE
 Sect OctLoc
   1     414   000003 777640   000424 006000   000000 177640   000000 006014    ................
   1     420   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     424   000000 400400   000000 000000   000000 000000   000000 000000    ................

FPT_READ
 Sect OctLoc
   1     430   000005 777640   000440 006000   000000 177640   000000 006014    ................
   1     434   001777 777640   000000 006000   000000 177640   000000 006014    ................
   1     440   000000 410000   000000 000000   000000 000000   000000 000000    ................
   1     444   000000 000000   000000 000000                                    ........

FILE_TYPE
 Sect OctLoc
   1     446   000000 000000                                                    ....

PASV
 Sect OctLoc
   1     447   000000 000000                                                    ....

BELL
 Sect OctLoc
   1     450   000000 000000                                                    ....

(unnamed)
 Sect OctLoc
   1     451   000000 000000                                                    ....

HASH
 Sect OctLoc
   1     452   000000 000000                                                    ....

DFLPASV
 Sect OctLoc
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:168  
   1     453   000000 000000                                                    ....

SENDPORT
 Sect OctLoc
   1     454   777777 777777                                                    ....

VERBOSE
 Sect OctLoc
   1     455   777777 777777                                                    ....

MPROMPT
 Sect OctLoc
   1     456   000000 000000                                                    ....

NAMBUF
 Sect OctLoc
   1     463   ****** ******   ****** ******   ****** ******   ****** ******    ................

TFIDPROMPT
 Sect OctLoc
   1     564   000003 777640   000572 006000   000000 177640   000000 006014    ................
   1     570   000023 577640   000201 206000   000000 000000   000000 000000    ................
   1     574   000000 000000   000000 000000                                    ........

TFIDREAD
 Sect OctLoc
   1     576   000005 777640   000606 006000   000000 177640   000000 006014    ................
   1     602   000023 577640   000201 206000   000000 177640   000000 006014    ................
   1     606   000000 400000   000000 000000   000000 000000   000000 000000    ................
   1     612   000000 000000   000000 000000                                    ........

CMDT
 Sect OctLoc
   1     616   122105 124122   040*** ******                                    RETR ...

CMDT
 Sect OctLoc
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:169  
   1     622   123124 117122   040*** ******                                    STOR ...

APPT
 Sect OctLoc
   1     624   101120 120105   040*** ******                                    APPE ...

CB
 Sect OctLoc
   1     630   ****** ******   ****** ******   ****** ******   ****** ******    ................

FPT_ERRMSG
 Sect OctLoc
   1     636   000003 777640   000664 006000   000000 777640   000000 006000    ................
   1     642   001777 777640   000000 006000   000000 177640   000000 006014    ................
   1     646   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     662*  000000 177640   000000 006014   000000 000000   000000 000000    ................
   1     666   371000 130001   040000 000000                                    ..X. ...

PROMPT
 Sect OctLoc
   2     000   106124 120072                                                    FTP:

FPT_INT
 Sect OctLoc
   2     002   000001 777640   000004 006000   000000 000000   000000 000000    ................

LOPT_OVER
 Sect OctLoc
   2     006   000000 ******                                                    ....

SPACE
 Sect OctLoc
   2     007   040*** ******                                                     ...

FPT_CLOSE
 Sect OctLoc
   2     010   000003 777640   000042 006000   000000 177640   000000 006014    ....."..........
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:170  
   2     014   000000 177640   000000 006014   000000 177640   000000 006014    ................
   2     040*  000000 177640   000000 006014   000000 000002   000000 000040    ...............
   2     044   000220 000000   000000 000000                                    ........

FPT_NSAVE
 Sect OctLoc
   2     046   000003 777640   000100 006000   000000 177640   000000 006014    .....@..........
   2     052   000000 177640   000000 006014   000000 177640   000000 006014    ................
   2     076*  000000 177640   000000 006014   000000 000000   000000 000040    ...............
   2     102   000220 000000   000000 000000                                    ........

TOGTXT
 Sect OctLoc
   2     104   102145 154154   040155 157144   145040 056040   040040 040040    Bell mode .
   2     110   104145 142165   147040 155157   144145 040056   040040 040040    Debug mode .
   2     114   110141 163150   040155 141162   153163 040050   064153 051040    Hash marks (4k)
   2     120   120101 123126   040143 157155   155141 156144   163040 056040    PASV commands .
   2     124   120117 122124   040143 157155   155141 156144   163040 056040    PORT commands .
   2     130   126145 162142   157163 145040   155157 144145   040056 040040    Verbose mode .
   2     134   120162 157155   160164 040155   157144 145040   056040 040040    Prompt mode .

MSG_UNIMP
 Sect OctLoc
   2     140   125156 151155   160154 145155   145156 164145   144040 143157    Unimplemented co
   2     144   155155 141156   144056 ******                                    mmand...

MSG_TYPE_ASCII
 Sect OctLoc
   2     146   124171 160145   040151 163040   101123 103111   111056 ******    Type is ASCII...

MSG_TYPE_IMAGE
 Sect OctLoc
   2     152   124171 160145   040151 163040   111115 101107   105056 ******    Type is IMAGE...

MSG_NOT_CONNECTED
 Sect OctLoc
   2     156   116157 164040   143157 156156   145143 164145   144056 ******    Not connected...
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:171  

MSG_USE_CLOSE
 Sect OctLoc
   2     162   101154 162145   141144 171040   143157 156156   145143 164145    Already connecte
   2     166   144054 040165   163145 040143   154157 163145   040146 151162    d, use close fir
   2     172   163164 056***                                                    st..

CMDT
 Sect OctLoc
   2     173   124131 120105   040*** ******                                    TYPE ...

OPNSCRATCH
 Sect OctLoc
   2     176   000025 777640   000242 006000   000000 177640   000000 006014    ................
   2     202   000000 177640   000000 006014   000000 177640   000000 006014    ................
   2     242*  000000 400042   000000 003001   252525 000000   000040 252520    ..."......... ..
   2     246   000040 040040   000000 000001   000000 777777   000000 000000    .   ............
   2     252   000000 000000   000000 000000   000000 000000   000000 000000    ................
   2     256   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
   2     262   040040 040040   000000 000000   000000 000000   000000 000000        ............
   2     266   000000 000000   ****** ******                                    ........

OPNSTAR
 Sect OctLoc
   2     270   000025 777640   000334 006000   000000 177640   000000 006014    ................
   2     274   000000 177640   000000 006014   000001 177640   000362 006000    ................
   2     300   000000 177640   000000 006014   000000 177640   000000 006014    ................
   2     334*  000000 400042   000000 000001   252525 000000   000040 252520    ..."......... ..
   2     340   000040 040040   000000 000000   000000 777777   000000 000000    .   ............
   2     344   000000 000000   000000 000000   000000 000000   000000 000000    ................
   2     350   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
   2     354   040040 040040   000000 000000   000000 000000   000000 000000        ............
   2     360   000000 000000   ****** ******                                    ........

STARFTP
 Sect OctLoc
   2     362   004052 146164   160*** ******                                    .*ftp...
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:172  

FPT_CLOSE
 Sect OctLoc
   2     364   000003 777640   000416 006000   000000 177640   000000 006014    ................
   2     370   000000 177640   000000 006014   000000 177640   000000 006014    ................
   2     414*  000000 177640   000000 006014   000000 000000   000000 000040    ...............
   2     420   000220 000000   000000 000000                                    ........

FPT_READ
 Sect OctLoc
   2     422   000005 777640   000432 006000   000000 177640   000000 006014    ................
   2     426   000077 577640   000463 206000   000000 177640   000000 006014    .?..............
   2     432   000000 400000   000000 000000   000000 000000   000000 000000    ................
   2     436   000000 000000   000000 000000                                    ........

FPT_LINK
 Sect OctLoc
   2     440   000000 777640   000460 006000   000001 777640   000461 006000    ................
   2     444   000000 177640   000000 006014   000000 177640   000000 006014    ................
   2     450   000077 777640   000463 006000   000000 177640   000000 006014    .?..............
   2     454   000001 777640   000456 006000   600000 000000   000000 000000    ................

VLP_PCL
 Sect OctLoc
   2     460   003120 103114                                                    .PCL

VLP_SYS
 Sect OctLoc
   2     461   072123 131123   040040 040040                                    :SYS

IPSYNC
 Sect OctLoc
   2     463   377364 377362                                                    ....

ABOR
 Sect OctLoc
   2     464   101102 117122                                                    ABOR
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:173  

IPFMT
 Sect OctLoc
   2     465   120117 122124   040045 056070   104054 045056   070104 054045    PORT %.8D,%.8D,%
   2     471   056070 104054   045056 070104   054045 123045   056070 104054    .8D,%.8D,%S%.8D,
   2     475   045056 070104   045061 121***                                    %.8D%1Q.

SUBTBL
 Sect OctLoc
   2     477   136136 136136   136136 136136   136136 136136   136136 136136    ^^^^^^^^^^^^^^^^
   2     507*  040041 042043   056045 046047   050051 052053   054055 044057     !"#.%&'()*+,-$/
   2     513   060061 062063   064065 066067   070071 072073   074075 076077    0123456789:;<=>?
   2     517   100101 102103   104105 106107   110111 112113   114115 116117    @ABCDEFGHIJKLMNO
   2     523   120121 122123   124125 126127   130131 132133   134135 136137    PQRSTUVWXYZ[\]^_
   2     527   140141 142143   144145 146147   150151 152153   154155 156157    `abcdefghijklmno
   2     533   160161 162163   164165 166167   170171 172173   174175 176136    pqrstuvwxyz{|}~^
   2     537   136136 136136   136136 136136   136136 136136   136136 136136    ^^^^^^^^^^^^^^^^
   2     547*  040041 042043   056045 046047   050051 052053   054055 044057     !"#.%&'()*+,-$/
   2     553   060061 062063   064065 066067   070071 072073   074075 076077    0123456789:;<=>?
   2     557   100101 102103   104105 106107   110111 112113   114115 116117    @ABCDEFGHIJKLMNO
   2     563   120121 122123   124125 126127   130131 132133   134135 136137    PQRSTUVWXYZ[\]^_
   2     567   140141 142143   144145 146147   150151 152153   154155 156157    `abcdefghijklmno
   2     573   160161 162163   164165 166167   170171 172173   174175 176136    pqrstuvwxyz{|}~^

HASH_MSG
 Sect OctLoc
   2     577   100043 ******                                                    @#..

FMT
 Sect OctLoc
   2     600   045104 040142   171164 145163   040164 162141   156163 146145    %D bytes transfe
   2     604   162162 145144   040151 156040   045116 075045   056043 072061    rred in %N=%.#:1
   2     610   060057 113104   056045 061056   043113 104040   163145 143157    0/KD.%1.#KD seco
   2     614   156144 163040   050045 116075   045056 043072   061060 057113    nds (%N=%.#:10/K
   2     620   104045 043072   062060 060057   133056 045061   056043 113104    D%#:200/[.%1.#KD
   2     624   045135 040113   142171 164145   163057 163051                    %] Kbytes/s)

PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:174  
(unnamed)
 Sect OctLoc
   2     627   114111 123124   116114 123124   110105 114120   121125 111124    LISTNLSTHELPQUIT
   2     633   103104 125120   103127 104040   120127 104040   104105 114105    CDUPCWD PWD DELE
   2     637   122116 106122   122116 124117   064062 061000   117120 105116    RNFRRNTO421.OPEN
   2     643   157156 056040   157146 146056   114050 103075   060054 106106    on. off.L(C=0,FF
   2     647   051040 040040   040117 126105   122040 052146   164160 050156    )    OVER *ftp(n
   2     653   163165 051040   077040 050156   057161 057156   145167 156141    su) ? (n/q/newna
   2     657   155145 051040   077040 050156   057161 051040   056057 040040    me) ? (n/q) ./
   2     663   101102 117122   120101 123126                                    ABORPASV

(unnamed)
 Sect OctLoc
   9     000   000036 006000   000112 006000   000000 177640   000000 006014    .....J..........
   9     004   000003 377640   000156 006000   000627 006000   000630 006000    .....n..........
   9     010   000631 006000   000000 000000   000010 577640   000162 006000    .............r..
   9     014   000000 006000   111040 040040   000015 006000   000632 006000    ....I   ........
   9     020   000633 006000   000634 006000   000635 006000   000636 006000    ................
   9     024   000004 200000   000000 006000   000172 006000   000030 006000    .........z......
   9     030   000637 006000   000640 006000   000006 006000   000201 006000    ................
   9     034   000003 377640   000146 006000   000003 377640   000152 006000    .....f.......j..
   9     040   101040 040040   000040 006000   000005 377640   000140 006000    A   . .......`..
   9     044   777777 777000   000000 006003   000061 777640   001356 006000    .........1......
   9     050   000110 006000   000000 000000   000001 177640   000173 006000    .H...........{..
   9     054   000000 006000   000052 006000   000000 006000   000172 006000    .....*.......z..
   9     060   000455 006000   056040 040040   000004 777640   000000 006000    .....   ........
   9     064   000463 006000   000000 000000   000000 177640   000007 006000    ................
   9     070   000000 006000   000066 006000   000000 006000   000000 000074    .....6.........<
   9     074   000073 006000   000000 000000   001777 777640   000000 006000    .;..............
   9     100   000000 006000   000076 006000   000615 006000   000000 006000    .....>..........
   9     104   777777 777177   776777 777777   000001 177640   000616 006000    ................
   9     110   000000 006000   000106 006000   000000 006000   000076 006000    .....F.......>..
   9     114   000621 006000   000000 006000   000076 006000   000173 006000    .........>...{..
   9     120   000663 006000   000226 006000   000227 006000   000344 006000    ................
   9     124   000001 177640   000624 006000   000000 006000   000124 006000    .............T..
   9     130   000001 177640   000622 006000   000000 006000   000130 006000    .............X..
   9     134   000000 777640   000463 006000   000000 006000   000134 006000    .............\..
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:175  
   9     140   000000 777640   000464 006000   000000 006000   000140 006000    .............`..
   9     144   000000 377640   000000 006000   000000 006000   000144 006000    .............d..
   9     150   000630 006000   000664 006000   000457 006000   000000 006000    ................
   9     154   000461 006000   000457 006000   000003 006000   000000 000000    ................
   9     160   000457 006000   000004 006000   000000 006000   000461 006000    ................
   9     164   000462 006000   000021 200000   050040 040040   060040 040040    ........(   0
   9     170   071040 040040   000077 777400   000017 777640   777777 437777    9   .?..........
   9     174   000011 577640   000465 006000   000000 006000   000174 006000    .............|..
   9     200   000000 377640   000577 006000   677777 777777   000511 456000    ................
   9     204   000023 777640   000002 777640   000026 777640   000600 006000    ................
   9     210   000000 006000   000206 006000   007040 040040   000023 200000    .........   ....
     1095     8587    2   END REPORT_TIME;
     1096     8588
     1097     8589    1   END FTPCMD;

PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:176  
--  Include file information  --

   B_ERRORS_C.:LIBRARY  is referenced.
   TCT_TELNET_E.:TCA2TOU  is referenced.
   TCP_HEP_M.:TCA2TOU  cannot be made into a system file and is referenced.
   TCF_FTP_E.:TCA2TOU  is referenced.
   XU_FORMAT_C.:LIBRARY  is referenced.
   B$JIT.:LIBRARY  cannot be made into a system file and is referenced.
   XUG_ENTRY.:LIBRARY  cannot be made into a system file and is referenced.
   XU_MACRO_C.:LIBRARY  is referenced.
   CP_6_SUBS.:LIBRARY  is referenced.
   CP_6.:LIBRARY  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure FTPCMD.
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:177  

 **** Variables and constants ****

  ****  Section 001  Data  FTPCMD

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

   624-0-0/c CHAR(5)     r     1 APPT                     615-0-0/w UBIN        r     1 ARS
   621-0-0/w UBIN        r     1 ARS                      450-0-0/b BIT         r     1 BELL
   110-0-0/d REMB        r     1 BREAK_MEM                227-0-0/w UBIN        r     1 BYTES
   173-0-0/w STRC(180)   r     1 CB                       630-0-0/w STRC(180)   r     1 CB
   225-0-0/w UBIN        r     1 CHARNLEN                 616-0-0/c CHAR(5)     r     1 CMDT
   622-0-0/c CHAR(5)     r     1 CMDT                     457-0-0/w STRC(72)    r     1 DATA_FS
   461-0-0/w STRC(72)    r     1 DATA_LS                  453-0-0/w SBIN        r     1 DFLPASV
   247-0-0/w PTR         r     1 F$FILE$                    0-0-0/w STRC(1080)  r     1 FDS
   446-0-0/w UBIN        r     1 FILE_TYPE                636-0-0/d STRC(936)   r     1 FPT_ERRMSG
   364-0-0/d STRC(864)   r     1 FPT_FID                  250-0-0/d STRC(2088)  r     1 FPT_OPEN
   430-0-0/d STRC(504)   r     1 FPT_READ                 232-0-0/d STRC(432)   r     1 FPT_TIME
   414-0-0/d STRC(432)   r     1 FPT_WRITE                200-0-0/w UBIN        r     1 GLOBAL_ERR
   452-0-0/b BIT         r     1 HASH                     670-0-0/w SBIN        r     1 LAST_HASH
   456-0-0/b BIT         r     1 MPROMPT                  463-0-0/c STRC(2304)  r     1 NAMBUF
   614-0-0/b BIT         r     1 OK                       620-0-0/b BIT         r     1 OK
   626-0-0/b BIT         r     1 OK                       447-0-0/w SBIN        r     1 PASV
   172-0-0/c STRC(27)    r     1 RCODE                    454-0-0/b BIT         r     1 SENDPORT
   226-0-0/w UBIN        r     1 START_TIME               201-0-0/c STRC(720)   r     1 TFID
   564-0-0/d STRC(360)   r     1 TFIDPROMPT               576-0-0/d STRC(504)   r     1 TFIDREAD
   450-0-0/b BIT         r     1 TOGOPTS(0:0)
   230-0-0/w UBIN        r     1 TSTAMP                   455-0-0/b BIT         r     1 VERBOSE
   342-0-0/c STRC(72)    r     1 VLP_ACCT                 344-0-0/c STRC(288)   r     1 VLP_NAME
   354-0-0/c STRC(72)    r     1 VLP_PASS                 356-0-0/d STRC(90)    r     1 VLP_SN
   362-0-0/c STRC(72)    r     1 VLP_WSN                  156-0-0/d STRC(432)   r     1 WRITE_DATA
    36-0-0/d STRC(1512)  r     1 XUG_GETCMD               112-0-0/d STRC(1296)  r     1 XUG_INIT

  ****  Section 002 RoData FTPCMD

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:178  

   464-0-0/c CHAR(4)     r     1 ABOR                     173-0-0/c CHAR(5)     r     1 CMDT
   600-0-0/c CHAR(92)    r     1 FMT                       10-0-0/d STRC(1080)  r     1 FPT_CLOSE
   364-0-0/d STRC(1080)  r     1 FPT_CLOSE                  2-0-0/d STRC(144)   r     1 FPT_INT
   440-0-0/d STRC(576)   r     1 FPT_LINK                  46-0-0/d STRC(1080)  r     1 FPT_NSAVE
   422-0-0/d STRC(504)   r     1 FPT_READ                 577-0-0/c CHAR(2)     r     1 HASH_MSG
   465-0-0/c CHAR(39)    r     1 IPFMT                    463-0-0/c CHAR(4)     r     1 IPSYNC
     6-0-0/w UBIN(18)    r     1 LOPT_OVER                156-0-0/c CHAR(14)    r     1 MSG_NOT_CONNECTED
   146-0-0/c CHAR(14)    r     1 MSG_TYPE_ASCII           152-0-0/c CHAR(14)    r     1 MSG_TYPE_IMAGE
   140-0-0/c CHAR(22)    r     1 MSG_UNIMP                162-0-0/c CHAR(35)    r     1 MSG_USE_CLOSE
   176-0-0/d STRC(2088)  r     1 OPNSCRATCH               270-0-0/d STRC(2088)  r     1 OPNSTAR
     0-0-0/c CHAR(4)     r     1 PROMPT                     7-0-0/c CHAR        r     1 SPACE
   362-0-0/c STRC(45)    r     1 STARFTP                  477-0-0/c CHAR(256)   r     1 SUBTBL
   104-0-0/c CHAR(16)    r     1 TOGTXT(0:6)              460-0-0/c STRC        r     1 VLP_PCL
   461-0-0/c STRC(72)    r     1 VLP_SYS

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    43-0-0/w PTR         r     1 @ADDRESS                  21-0-0/w PTR         r     1 @BYTES
    13-0-0/w PTR         r     1 @CMDO                     11-0-0/w PTR         r     1 @CMDT
    43-0-0/w PTR         r     1 @CMDT                     21-0-0/w PTR         r     1 @LCN
    15-0-0/w PTR         r     1 @LFID                     11-0-0/w PTR         r     1 @LFID
    14-0-0/w PTR         r     1 @ONOVER                   12-0-0/w PTR         r     1 @OVERINTO
    44-0-0/w PTR         r     1 @PORT                     13-0-0/w PTR         r     1 @RFID
    13-0-0/w PTR         r     1 @RFID                     43-0-0/w PTR         r     1 @SOCKET
    44-0-0/w PTR         r     1 @TEXT                     44-0-0/w PTR         r     1 @TEXTC
    15-0-0/w PTR         r     1 @TEXTC                    22-0-0/w PTR         r     1 @TIME
    22-0-0/w PTR         r     1 @TIMEOUT                  *0-0-0/w UBIN(32)    r     1 ADDRESS
    *0-0-0/w SBIN        r     1 BYTES                     *0-0-0/c CHAR        r     1 CMDO
    *0-0-0/c CHAR(4)     r     1 CMDT                      *0-0-0/w CHAR(4)     r     1 CMDT
     4-0-0/w UBIN        r     1 CODE                      16-0-0/w SBIN        r     1 CURSIZ
    47-0-0/w STRC(108)   r     1 DAT                       23-0-0/c CHAR(80)    r     1 FDSBUF
    21-0-0/c CHAR(64)    r     1 FMT_OUT                   41-0-0/w SBIN        r     1 FMT_OUTL
    45-0-0/w SBIN        r     1 I                         46-0-0/w SBIN        r     1 J
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:179  
    47-0-0/w SBIN        r     1 K                         *0-0-0/w UBIN        r     1 LCN
    *0-0-0/w ASTR(9)     r     1 LFID                      *0-0-0/w ASTR(9)     r     1 LFID
    *0-0-0/h UBIN(18)    r     1 ONOVER                    *0-0-0/h UBIN(18)    r     1 OVERINTO
    21-0-0/w PTR         r     1 P$                         3-0-0/w PTR         r     1 PARSE$
    *0-0-0/w UBIN(16)    r     1 PORT                      *0-0-0/w ASTR(9)     r     1 RFID
    *0-0-0/w ASTR(9)     r     1 RFID                       7-0-0/b BIT         r     1 SAVERBOSE
    *0-0-0/w STRC(72)    r     1 SOCKET                    *0-0-0/c CHAR        r     1 TEXT(0:0)
    *0-0-0/w ASTR(9)     r     1 TEXTC                     *0-0-0/w ASTR(9)     r     1 TEXTC
    *0-0-0/w SBIN        r     1 TIME                      *0-0-0/w UBIN        r     1 TIMEOUT
    45-0-0/w PTR         r     1 V_PTR$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$TCB$
     0-0-0/c CHAR(4096)  r     1 CMD_BUFFER                 0-0-0/w STRC(72)    r     1 CMD_FS
     0-0-0/w SBIN        r     1 CMD_LCN                    0-0-0/w STRC(72)    r     1 CMD_LS
     0-0-0/c CHAR(2)     r     1 CRLF                       0-0-0/w SBIN        r     1 DATA_LCN
     0-0-0/w UBIN        r     1 FTP_NODES                  0-0-0/c CHAR(4096)  r     1 LINE_BUF
     0-0-0/b BIT         r     1 RUNNING                    0-0-0/b STRC        r     1 TCP_MON_ERR
     0-0-0/d STRC(432)   r     1 WRITE_LO

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(2448)  r     1 B$ALT                      0-0-0/d STRC(8856)  r     1 B$JIT
     0-0-0/w STRC(144)   r     1 B$TCB                      0-0-0/c ACHR        r     1 CHARN
     0-0-0/d ASTR(3528)  r     1 F$DCB                      0-0-0N  NULL        r     1 F$FILE
     0-0-0/c ACHR        r     1 FMT_OUTB                   0-0-0/w UBIN(18)    r     1 HW
     0-0-0N  NULL        r     1 M$DO                       0-0-0N  NULL        r     1 M$LO
     0-0-0N  NULL        r     1 M$MFILE                    0-0-0N  NULL        r     1 M$UC
     0-0-0/w STRC(144)   r     1 OUT$BLK                    0-0-0/w ASTR(153)   r     1 OUT$SYM
     0-0-0/w STRC(432)   r     1 TCP$ADMIN                  0-0-0/c ASTR(9)     r     1 TEXTC
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:180  
     0-0-0/w BIT         r     1 V_FLAG


   Procedure FTPCMD requires 1995 words for executable code.
   Procedure FTPCMD requires 54 words of local(AUTO) storage.

    No errors detected in file TCF$FTPCMD.:TCA2TSI    .
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:181  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:182  
          MINI XREF LISTING

ABOR IN PROCEDURE PUT_CMD
      8174**DCL      8253--CALL
ADDRESS IN PROCEDURE PORT
      8459**DCL      8457--PROC     8467--CALL
APPT IN PROCEDURE PUT_CMD
      8176**DCL      8205--CALL
ARS IN PROCEDURE GET_CMD
      8017**DCL      8051<<ASSIGN   8087<>CALL     8089>>ASSIGN   8091>>ASSIGN   8127>>IF       8129>>IF
      8130>>ASSIGN
ARS IN PROCEDURE LIST_CMD
      7912**DCL      7952<>CALL     7955>>ASSIGN
B$ALT.CODE
      4503**DCL      4503--REDEF    4504--REDEF    4504--REDEF
B$ALT.ERR.ERR#
      4505**DCL      4505--REDEF    8234>>IF       8240>>IF
B$ALT.EVID
      4504**DCL      4504--REDEF    4504--REDEF
B$JIT.CCBUF
      3868**DCL      7333>>ASSIGN
B$JIT.CPFLAGS1.SLEAZE
      3874**DCL      3874--REDEF
B$JIT.ERR.MID
      3781**DCL      3781--REDEF
B$JIT.JRESPEAK
      3942**DCL      3943--REDEF
B$JIT.MODE
      3775**DCL      7876>>IF
B$JIT.ORIGINATOR_PORT.FROM_CR
      4051**DCL      4051--REDEF    4052--REDEF
B$JIT.PNR
      3955**DCL      3955--REDEF
B$JIT.TSLINE
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:183  
      4049**DCL      4050--REDEF
B$JIT$
      6607**DCL      3775--IMP-PTR  7333>>ASSIGN   7876>>IF
B$TCB.ALT$
      4499**DCL      8234>>IF       8240>>IF
B$TCB$
      6606**DCL      8234>>IF       8240>>IF
BELL
      7123**DCL      7124--REDEF    8579>>IF
BREAK_MEM
      5997**DCL      7164<<REMEMBR  7343>>UNWIND   7348--ASSIGN   7350--ASSIGN
BYTES
      6679**DCL      7381<<CALLBLT  7382>>ASSIGN   8075<<ASSIGN   8089<<ASSIGN   8089>>ASSIGN   8095<<ASSIGN
      8095>>ASSIGN   8119<<ASSIGN   8119>>ASSIGN   8161<>CALL     8219<<ASSIGN   8263<<ASSIGN   8263>>ASSIGN
      8267<<ASSIGN   8267>>ASSIGN   8276<>CALL     8547>>IF       8548>>DOWHILE
BYTES IN PROCEDURE REPORT_TIME
      8559**DCL      8558--PROC     8575>>ASSIGN
CB
      6642**DCL      8111<>CALL
CB.ADMIN
      6642**DCL      8114>>IF
CB.ARS
      6642**DCL      8109>>IF       8119>>ASSIGN   8120>>ASSIGN   8123<<ASSIGN   8123>>ASSIGN   8125>>ASSIGN
CB IN PROCEDURE GET_OPEN
      8290**DCL      8319<>CALL     8345<>CALL
CB.ADMIN IN PROCEDURE GET_OPEN
      8290**DCL      8324>>IF       8349>>IF
CHARN
      6676**DCL      7961--ASSIGN   8250--CALL
CHARNLEN
      6677**DCL      6676--IMP-SIZ  7955<<ASSIGN   7956>>IF       7958<<ASSIGN   7961>>ASSIGN   8052<<ASSIGN
      8091<<ASSIGN   8093>>IF       8098>>IF       8100<<ASSIGN   8109>>IF       8109>>IF       8120<<ASSIGN
      8123>>ASSIGN   8124>>ASSIGN   8125<<ASSIGN   8129>>IF       8130<<ASSIGN   8131>>ASSIGN   8134>>ASSIGN
      8141>>ASSIGN   8248<<ASSIGN   8249>>IF       8250>>CALL     8263>>ASSIGN   8267>>ASSIGN
CLOSE_ALT IN PROCEDURE PUT_CMD
      8188**LABEL    8210--CALLALT  8215--GOTO     8258--GOTO     8274--CALLALT  8275--GOTO
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:184  
CLREL_ALT IN PROCEDURE PUT_CMD
      8208**LABEL    8221--CALLALT
CMDO IN PROCEDURE TYPE_CMD
      7356**DCL      7355--PROC     7360--CALL
CMDT IN PROCEDURE GET_CMD
      8015**DCL      8064--CALL
CMDT IN PROCEDURE LIST_CMD
      7910**DCL      7909--PROC     7928--CALL
CMDT IN PROCEDURE PUT_CMD
      8175**DCL      8207--CALL
CMDT IN PROCEDURE SIMPLE_CMD
      7987**DCL      7986--PROC     7992>>IF       7992--CALL     7993--CALL
CMDT IN PROCEDURE TYPE_CMD
      7357**DCL      7359--CALL
CMD_BUFFER
      6631**DCL      6632--REDEF    8319--CALL     8325--IF       8327--CALL     8345--CALL     8350--IF
      8350--IF       8352--CALL
CMD_FS.ADDRESS
      6629**DCL      8400>>ASSIGN
CMD_LCN
      6619**DCL      7181>>IF       7189>>IF       7209>>IF       7216<>CALL     7217<<ASSIGN   7229<>CALL
      7230<<ASSIGN   7246<>CALL     7247<>CALL     7249<>CALL     7304>>IF       7359<>CALL     7360<>CALL
      7361<>CALL     7362<>CALL     7928<>CALL     7931<>CALL     7932<>CALL     7935<>CALL     7936<>CALL
      7969<>CALL     7992<>CALL     7993<>CALL     7995<>CALL     7996<>CALL     7998<>CALL     8002<>CALL
      8064<>CALL     8065<>CALL     8066<>CALL     8067<>CALL     8154<>CALL     8205<>CALL     8207<>CALL
      8208<>CALL     8209<>CALL     8210<>CALL     8252<>CALL     8253<>CALL     8254<>CALL     8256<>CALL
      8257<>CALL     8274<>CALL     8415<>CALL     8417<>CALL     8418<>CALL
CMD_LS.ADDRESS
      6639**DCL      8398>>ASSIGN
CMD_LS.PORT
      6639**DCL      8401>>ASSIGN
CMN IN PROCEDURE REPORT_ALT
      8513**LABEL    8509--GOTO
CODE
      6617**DCL      7178<<ASSIGN   7179>>IF       7182<<ASSIGN   7189>>IF       7189>>IF       7189>>IF
      7189>>IF       7197>>DOCASE   7283<<DOINDEX  7289<<ASSIGN   7290>>ASSIGN   7290>>ASSIGN   7291>>IF
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:185  
      7291>>ASSIGN   7334<<CALLBLT  7335>>IF       7336>>ASSIGN   7377>>ASSIGN   7378>>IF       7378>>IF
      7847>>IF       7880>>IF       7894>>IF       7895>>IF       7897>>IF       7920>>IF       7920>>IF
      8000>>IF       8000>>IF       8145<<ASSIGN
CRLF IN PROCEDURE PUT_CMD
      8177**DCL      8264--CALL
CURSIZ IN PROCEDURE GET_CMD
      8018**DCL      8053<<ASSIGN   8129>>IF       8130>>ASSIGN   8131<<ASSIGN   8134<<ASSIGN   8134>>ASSIGN
DAT IN PROCEDURE REPORT_TIME
      8566**DCL      8578--CALL
DAT.BPS IN PROCEDURE REPORT_TIME
      8569**DCL      8576<<ASSIGN
DAT.BYTES IN PROCEDURE REPORT_TIME
      8567**DCL      8575<<ASSIGN   8576>>ASSIGN
DAT.SECS IN PROCEDURE REPORT_TIME
      8568**DCL      8571<<ASSIGN   8572>>IF       8572<<ASSIGN   8572>>ASSIGN   8573<<ASSIGN   8573>>ASSIGN
      8574>>IF       8574<<ASSIGN   8574>>ASSIGN   8576>>ASSIGN
DATA_FS
      7141**DCL      8376<<ASSIGN   8384<>CALL     8386<>CALL     8403<>CALL
DATA_LCN
      6620**DCL      7941<>CALL     7946<>CALL     7947<>CALL     7952<>CALL     7968<>CALL     8071<>CALL
      8077<>CALL     8087<>CALL     8111<>CALL     8144<>CALL     8153<>CALL     8214<>CALL     8221<>CALL
      8250<>CALL     8255<>CALL     8264<>CALL     8271<>CALL     8386<>CALL     8402<<ASSIGN   8403<>CALL
      8407>>IF       8407<>CALL
DATA_LS
      7149**DCL      8377<<ASSIGN   8386<>CALL     8403<>CALL     8403<>CALL
DATA_LS.ADDRESS
      7153**DCL      8398<<ASSIGN   8399>>IF       8400<<ASSIGN   8414<>CALL
DATA_LS.PORT
      7153**DCL      8397<<ASSIGN   8401<<ASSIGN   8414<>CALL
DFLPASV
      7127**DCL      7231>>ASSIGN
DISCONNECTED
      7226**LABEL    7318--GOTO
DISP_TOGGLE
      7375**PROC     7284--CALL     7292--CALL
DISP_TYPE
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:186  
      7291**LABEL    7286--GOTO
F$DCB.ACTPOS
      6582**DCL      6582--REDEF
F$DCB.ARS#
      6556**DCL      6556--REDEF    7874>>ASSIGN   7886>>ASSIGN   8248>>ASSIGN
F$DCB.ATTR
      6575**DCL      6576--REDEF
F$DCB.BORROW
      6590**DCL      6590--REDEF    6590--REDEF    6590--REDEF
F$DCB.DCBNAME.L
      6604**DCL      6604--IMP-SIZ
F$DCB.EOMCHAR#
      6560**DCL      6560--REDEF
F$DCB.FLDID
      6585**DCL      6585--REDEF
F$DCB.FORM$
      6579**DCL      6579--REDEF
F$DCB.FSECT
      6595**DCL      6595--REDEF
F$DCB.FSN#
      6572**DCL      6572--REDEF    6572--REDEF    6573--REDEF
F$DCB.HEADER$
      6578**DCL      6578--REDEF
F$DCB.IXTNSIZE#
      6576**DCL      6576--REDEF
F$DCB.LASTSTA$
      6565**DCL      6565--REDEF
F$DCB.LVL
      6591**DCL      6591--REDEF
F$DCB.NAME#.C
      6566**DCL      6566--REDEF
F$DCB.NOEOF
      6588**DCL      6588--REDEF
F$DCB.NRECS#
      6577**DCL      6577--REDEF
F$DCB.NRECX
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:187  
      6596**DCL      6596--REDEF
F$DCB.OHDR
      6588**DCL      6588--REDEF
F$DCB.ORG#
      6571**DCL      6571--REDEF
F$DCB.PRECNO
      6594**DCL      6594--REDEF
F$DCB.RCSZ
      6600**DCL      6600--REDEF
F$DCB.RECL#
      6572**DCL      8051>>ASSIGN
F$DCB.RES#
      6567**DCL      6567--REDEF
F$DCB.SETX
      6579**DCL      6579--REDEF
F$DCB.TAB$
      6579**DCL      6579--REDEF
F$DCB.TDA
      6593**DCL      6594--REDEF
F$DCB.WSN#
      6567**DCL      6567--REDEF
F$FILE
      6734**DCL      7324--ASSIGN   7918>>ASSIGN   7975>>IF
F$FILE$
      6735**DCL      7324<<ASSIGN   8051>>ASSIGN   8248>>ASSIGN
FDS
      4234**DCL      8467<>CALL     8578<>CALL
FDS.BUFX
      4258**DCL      8469>>ASSIGN   8580>>ASSIGN   8581<<ASSIGN   8581>>ASSIGN   8583>>ASSIGN
FDS.BUF_
      4251**DCL      8466<<ASSIGN   8577<<ASSIGN
FDSBUF IN PROCEDURE REPORT_TIME
      8561**DCL      8577--ASSIGN   8580<<ASSIGN   8583--ASSIGN
FILE_TYPE
      7121**DCL      7220>>IF       7298>>IF       7308<<ASSIGN   7924>>IF       7978>>IF       8084>>IF
      8261>>IF
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:188  
FMT IN PROCEDURE REPORT_TIME
      8562**DCL      8578--CALL
FMT_OUT IN PROCEDURE OPEN_DATA_PORT
      8372**DCL      8415--CALL     8466--ASSIGN
FMT_OUTB IN PROCEDURE OPEN_DATA_PORT
      8374**DCL      8384<>CALL     8438>>CALLBLT
FMT_OUTL IN PROCEDURE OPEN_DATA_PORT
      8373**DCL      8374--IMP-SIZ  8383<<ASSIGN   8384>>CALL     8415>>CALL     8438>>CALLBLT  8469<<ASSIGN
FPT_CLOSE
      7059**DCL      7976<>CALL     8157<>CALL     8162<>CALL     8200<>CALL     8277<>CALL
FPT_CLOSE.SN_
      7059**DCL      7059--REDEF
FPT_CLOSE.UTL_
      7060**DCL      7060--REDEF
FPT_CLOSE.V
      7064**DCL      7059--DCLINIT
FPT_CLOSE.V.EXPIRE#
      7074**DCL      7074--REDEF
FPT_CLOSE.V.TYPE#
      7072**DCL      7072--REDEF
FPT_CLOSE.V.XTNSIZE#
      7069**DCL      7069--REDEF    7071--REDEF
FPT_CLOSE IN PROCEDURE MFILE_CMD
      7658**DCL      7857<>CALL     7866<>CALL
FPT_CLOSE.SN_ IN PROCEDURE MFILE_CMD
      7658**DCL      7658--REDEF
FPT_CLOSE.UTL_ IN PROCEDURE MFILE_CMD
      7659**DCL      7659--REDEF
FPT_CLOSE.V IN PROCEDURE MFILE_CMD
      7663**DCL      7658--DCLINIT
FPT_CLOSE.V.EXPIRE# IN PROCEDURE MFILE_CMD
      7673**DCL      7673--REDEF
FPT_CLOSE.V.TYPE# IN PROCEDURE MFILE_CMD
      7671**DCL      7671--REDEF
FPT_CLOSE.V.XTNSIZE# IN PROCEDURE MFILE_CMD
      7668**DCL      7668--REDEF    7670--REDEF
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:189  
FPT_ERRMSG IN PROCEDURE REPORT_ALT
      8490**DCL      8517<>CALL
FPT_ERRMSG.V IN PROCEDURE REPORT_ALT
      8494**DCL      8490--DCLINIT
FPT_ERRMSG.V.SOURCE# IN PROCEDURE REPORT_ALT
      8501**DCL      8508<<ASSIGN   8513<<ASSIGN   8514<<ASSIGN
FPT_FID
      6953**DCL      8023<>CALL     8184<>CALL
FPT_FID.TEXTFID_
      6953**DCL      8022<<ASSIGN   8183<<ASSIGN
FPT_FID.V
      6957**DCL      6953--DCLINIT
FPT_INT
      6010**DCL      7328<>CALL
FPT_INT.V
      6010**DCL      6010--DCLINIT
FPT_LINK IN PROCEDURE MFILE_CMD
      7733**DCL      7853<>CALL
FPT_LINK.V IN PROCEDURE MFILE_CMD
      7735**DCL      7735--DCLINIT
FPT_NSAVE
      7101**DCL      7977<>CALL     8060<>CALL
FPT_NSAVE.SN_
      7101**DCL      7101--REDEF
FPT_NSAVE.UTL_
      7102**DCL      7102--REDEF
FPT_NSAVE.V
      7106**DCL      7101--DCLINIT
FPT_NSAVE.V.EXPIRE#
      7116**DCL      7116--REDEF
FPT_NSAVE.V.TYPE#
      7114**DCL      7114--REDEF
FPT_NSAVE.V.XTNSIZE#
      7111**DCL      7111--REDEF    7113--REDEF
FPT_OPEN
      6812**DCL      8047<>CALL     8192<>CALL
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:190  
FPT_OPEN.ACSVEH_
      6814**DCL      6815--REDEF
FPT_OPEN.ALTKEYS_
      6820**DCL      6821--REDEF    6821--REDEF
FPT_OPEN.HDR_
      6819**DCL      6820--REDEF
FPT_OPEN.TAB_
      6818**DCL      6819--REDEF
FPT_OPEN.UHL_
      6812**DCL      6813--REDEF    6813--REDEF
FPT_OPEN.V
      6821**DCL      6812--DCLINIT
FPT_OPEN.V.ASN#
      6831**DCL      6956--DCLINIT
FPT_OPEN.V.EXIST#
      6825**DCL      8033<<ASSIGN   8038<<ASSIGN   8043<<ASSIGN
FPT_OPEN.V.FSN#
      6852**DCL      6852--REDEF    6852--REDEF
FPT_OPEN.V.FUN#
      6831**DCL      8032<<ASSIGN   8037<<ASSIGN   8042<<ASSIGN   8191<<ASSIGN
FPT_OPEN.V.RES#
      6836**DCL      6956--DCLINIT
FPT_OPEN.WSN_
      6818**DCL      6818--REDEF
FPT_READ
      7014**DCL      8228<>CALL
FPT_READ.STATION_
      7017**DCL      7018--REDEF
FPT_READ.V
      7018**DCL      7014--DCLINIT
FPT_READ.V.DVBYTE.CONT#
      7031**DCL      8231<<ASSIGN   8236<<ASSIGN   8261>>IF
FPT_READ.V.DVBYTE.REREAD#
      7029**DCL      7029--REDEF
FPT_READ.V.INDX#
      7027**DCL      7027--REDEF
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:191  
FPT_READ IN PROCEDURE MFILE_CMD
      7697**DCL      7872<>CALL
FPT_READ.STATION_ IN PROCEDURE MFILE_CMD
      7700**DCL      7701--REDEF
FPT_READ.V IN PROCEDURE MFILE_CMD
      7701**DCL      7697--DCLINIT
FPT_READ.V.DVBYTE.REREAD# IN PROCEDURE MFILE_CMD
      7712**DCL      7712--REDEF
FPT_READ.V.INDX# IN PROCEDURE MFILE_CMD
      7710**DCL      7710--REDEF
FPT_TIME
      6692**DCL      8079<>CALL     8151<>CALL     8223<>CALL     8272<>CALL
FPT_TIME.V
      6696**DCL      6692--DCLINIT
FPT_WRITE
      6983**DCL      8142<>CALL
FPT_WRITE.BUF_.BOUND
      6983**DCL      8141<<ASSIGN
FPT_WRITE.BUF_.BUF$
      6985**DCL      8054<<ASSIGN   8086<<ASSIGN   8101<<ASSIGN   8110<<ASSIGN   8124<<ASSIGN   8124>>ASSIGN
FPT_WRITE.STATION_
      6985**DCL      6985--REDEF
FPT_WRITE.V
      6986**DCL      6983--DCLINIT
FPT_WRITE.V.DVBYTE.CONT#
      6994**DCL      8092<<ASSIGN   8096<<ASSIGN   8128<<ASSIGN   8132<<ASSIGN
FPT_WRITE.V.DVBYTE.VFC#
      6992**DCL      6992--REDEF
FTPBREAK
      7341**ENTRY    6044--DCLINIT
FTP_NODES
      6622**DCL      5671--DCLINIT
GET_BREAK IN PROCEDURE GET_CMD
      8144**LABEL    8078--CALLALT
GET_CLOSE IN PROCEDURE GET_OPEN
      8336**ENTRY    7229--CALL     7968--CALL     8153--CALL     8271--CALL
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:192  
GET_CMD
      8011**PROC     7260--CALL     7263--CALL     7904--CALL     7916--CALL
GET_CONNECTED
      5638**DCL-ENT  7214--CALL
GET_LINE
      5643**DCL-ENT  7952--CALL     8087--CALL
GET_OPEN
      8285**PROC     7946--CALL     8077--CALL     8221--CALL
GET_RESPONSE
      5644**DCL-ENT  7249--CALL     7362--CALL     7936--CALL     7969--CALL     8002--CALL     8067--CALL
      8154--CALL     8210--CALL     8256--CALL     8274--CALL     8418--CALL
GET_RESPONSENW
      5645**DCL-ENT  8257--CALL
GET_USER
      5639**DCL-ENT  7223--CALL
GLOBAL_ERR
      6667**DCL      7169<<ASSIGN   7363<<ASSIGN   7368<<ASSIGN   7914<<ASSIGN   7940<<ASSIGN   7970<<ASSIGN
      7973<<ASSIGN   7976>>IF       7979>>IF       8003<<ASSIGN   8006<<ASSIGN   8026<<ASSIGN   8059<<ASSIGN
      8156<<ASSIGN   8187<<ASSIGN   8199<<ASSIGN   8328<<ASSIGN   8408<<ASSIGN   8420<<ASSIGN
HASH
      7126**DCL      8083>>IF       8227>>IF
HASH_MARKS
      8543**PROC     8083--CALL     8227--CALL
HASH_MSG IN PROCEDURE HASH_MARKS
      8545**DCL      8550--ASSIGN
HW IN PROCEDURE SETBREAK
      7347**DCL      7349<<ASSIGN   7349>>ASSIGN   7350<<ASSIGN   7350>>ASSIGN
I IN PROCEDURE PARSE_PORT
      8434**DCL      8439<<ASSIGN   8444<<ASSIGN   8444>>ASSIGN   8446>>IF       8447>>IF
IPFMT IN PROCEDURE PORT
      8464**DCL      8467--CALL
IPSYNC IN PROCEDURE PUT_CMD
      8172**DCL      8252--CALL
J IN PROCEDURE PARSE_PORT
      8435**DCL      8438<<CALLBLT  8442<<ASSIGN   8442>>ASSIGN   8443>>IF       8443>>IF       8452>>ASSIGN
K IN PROCEDURE PARSE_PORT
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:193  
      8436**DCL      8440<<ASSIGN   8445>>ASSIGN   8450<<ASSIGN   8452<<ASSIGN   8452>>ASSIGN
LAST_HASH IN PROCEDURE HASH_MARKS
      8544**DCL      8547<<ASSIGN   8548>>DOWHILE  8553<<ASSIGN   8553>>ASSIGN
LCN IN PROCEDURE GET_OPEN
      8286**DCL      8285--PROC     8319<>CALL     8320<>CALL     8336--ENTRY    8338<>CALL     8340<>CALL
      8345<>CALL     8354<>CALL
LFID IN PROCEDURE GET_CMD
      8014**DCL      8011--PROC
LFID.COUNT IN PROCEDURE GET_CMD
      8014**DCL      8014--IMP-SIZ  8022>>ASSIGN
LFID.TEXT IN PROCEDURE GET_CMD
      8014**DCL      8022--ASSIGN
LFID IN PROCEDURE PUT_CMD
      8171**DCL      8168--PROC
LFID.COUNT IN PROCEDURE PUT_CMD
      8171**DCL      8171--IMP-SIZ  8183>>ASSIGN
LFID.TEXT IN PROCEDURE PUT_CMD
      8171**DCL      8183--ASSIGN
LINE_BUF
      6632**DCL      7016--DCLINIT  7017--DCLINIT  7333<<ASSIGN   7334>>CALLBLT  7335>>IF       7336<<ASSIGN
      7337--ASSIGN   7377<<ASSIGN   7379<<ASSIGN   7380<<ASSIGN   7381>>CALLBLT  7382<<ASSIGN   7382>>ASSIGN
      7383--ASSIGN   7952--CALL     7959<<ASSIGN   7961--ASSIGN   8054--ASSIGN   8086--ASSIGN   8087--CALL
      8093--IF       8110--ASSIGN   8111--CALL     8250--CALL     8491--DCLINIT
LINE_SUB
      8522**PROC     7259--CALL     7270--CALL     7903--CALL     8193--CALL
LIST_CMD
      7909**PROC     7199--CALL     7202--CALL     7864--CALL
LOPT_OVER
      6618**DCL      7260<>CALL     7896<>CALL     7904<>CALL
M$CLOSE
        17**DCL-ENT  7857--CALL     7976--CALL     7977--CALL     8060--CALL     8157--CALL     8162--CALL
      8200--CALL     8277--CALL
M$ERRMSG
        80**DCL-ENT  8517--CALL
M$FID
        80**DCL-ENT  8023--CALL     8184--CALL
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:194  
M$INT
        72**DCL-ENT  7328--CALL
M$LINK
        29**DCL-ENT  7853--CALL
M$LO
      6665**DCL      7922>>ASSIGN
M$MFILE
      6736**DCL      7874--ASSIGN   7921>>ASSIGN
M$OPEN
        17**DCL-ENT  7854--CALL     7862--CALL     8047--CALL     8192--CALL
M$PROMPT
        41**DCL-ENT  7884--CALL
M$READ
        18**DCL-ENT  7872--CALL     7885--CALL     8228--CALL
M$REW
        20**DCL-ENT  7866--CALL
M$TIME
        84**DCL-ENT  8079--CALL     8151--CALL     8223--CALL     8272--CALL
M$UC
        41**DCL      7886--ASSIGN
M$WRITE
        18**DCL-ENT  7193--CALL     7211--CALL     7301--CALL     7313--CALL     7384--CALL     7962--CALL
      8142--CALL     8551--CALL     8584--CALL
M$XXX
        29**DCL-ENT  7171--CALL     7326--CALL     8045--CALL     8346--CALL
MFILE_CMD
      7387**PROC     7280--CALL
MPROMPT
      7130**DCL      7876>>IF
MSG_NOT_CONNECTED
      7159**DCL      7192--ASSIGN
MSG_TYPE_ASCII
      7157**DCL      7299--ASSIGN
MSG_TYPE_IMAGE
      7158**DCL      7300--ASSIGN
MSG_UNIMP
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:195  
      7156**DCL      7312--ASSIGN
MSG_USE_CLOSE
      7160**DCL      7210--ASSIGN
NAMBUF IN PROCEDURE MFILE_CMD
      7677**DCL      7734--DCLINIT  7877>>ASSIGN   7894<>CALL     7896<>CALL     7903<>CALL     7904<>CALL
NAMBUF.COUNT IN PROCEDURE MFILE_CMD
      7678**DCL      7848<<ASSIGN   7874<<ASSIGN   7901<<ASSIGN   7901>>ASSIGN
NAMBUF.TEXT IN PROCEDURE MFILE_CMD
      7679**DCL      7699--DCLINIT  7700--DCLINIT  7849<<ASSIGN   7851<<ASSIGN   7852<<ASSIGN   7899>>IF
      7900<<ASSIGN   7900>>ASSIGN
NOTPASV IN PROCEDURE OPEN_DATA_PORT
      8391**LABEL    8381--CALLALT
NO_CHANGE
      7308**LABEL    7164--REMEMBR  7306--CALLALT  7307--CALLALT
NXTNAM IN PROCEDURE MFILE_CMD
      7862**LABEL    7891--GOTO
OK IN PROCEDURE GET_CMD
      8016**DCL      8081<<ASSIGN   8082>>DOWHILE  8105<<ASSIGN   8116<<ASSIGN   8139>>IF
OK IN PROCEDURE LIST_CMD
      7911**DCL      7950<<ASSIGN   7951>>DOWHILE  7965<<ASSIGN
OK IN PROCEDURE PUT_CMD
      8178**DCL      8225<<ASSIGN   8226>>DOWHILE  8230<<ASSIGN   8239<<ASSIGN   8245>>IF
ONOVER IN PROCEDURE GET_CMD
      8013**DCL      8011--PROC     8030>>IF       8035>>IF       8040>>IF
OPEN_DATA_PORT
      8362**PROC     7926--CALL     8057--CALL     8197--CALL
OPNSCRATCH IN PROCEDURE MFILE_CMD
      7454**DCL      7862<>CALL
OPNSCRATCH.ACSVEH_ IN PROCEDURE MFILE_CMD
      7456**DCL      7457--REDEF
OPNSCRATCH.ALTKEYS_ IN PROCEDURE MFILE_CMD
      7462**DCL      7463--REDEF    7463--REDEF
OPNSCRATCH.HDR_ IN PROCEDURE MFILE_CMD
      7461**DCL      7462--REDEF
OPNSCRATCH.TAB_ IN PROCEDURE MFILE_CMD
      7460**DCL      7461--REDEF
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:196  
OPNSCRATCH.UHL_ IN PROCEDURE MFILE_CMD
      7454**DCL      7455--REDEF    7455--REDEF
OPNSCRATCH.V IN PROCEDURE MFILE_CMD
      7463**DCL      7454--DCLINIT
OPNSCRATCH.V.FSN# IN PROCEDURE MFILE_CMD
      7494**DCL      7494--REDEF    7494--REDEF
OPNSCRATCH.WSN_ IN PROCEDURE MFILE_CMD
      7460**DCL      7460--REDEF
OPNSTAR IN PROCEDURE MFILE_CMD
      7564**DCL      7854<>CALL
OPNSTAR.ACSVEH_ IN PROCEDURE MFILE_CMD
      7566**DCL      7567--REDEF
OPNSTAR.ALTKEYS_ IN PROCEDURE MFILE_CMD
      7572**DCL      7573--REDEF    7573--REDEF
OPNSTAR.HDR_ IN PROCEDURE MFILE_CMD
      7571**DCL      7572--REDEF
OPNSTAR.TAB_ IN PROCEDURE MFILE_CMD
      7570**DCL      7571--REDEF
OPNSTAR.UHL_ IN PROCEDURE MFILE_CMD
      7564**DCL      7565--REDEF    7565--REDEF
OPNSTAR.V IN PROCEDURE MFILE_CMD
      7573**DCL      7564--DCLINIT
OPNSTAR.V.FSN# IN PROCEDURE MFILE_CMD
      7604**DCL      7604--REDEF    7604--REDEF
OPNSTAR.WSN_ IN PROCEDURE MFILE_CMD
      7570**DCL      7570--REDEF
OUT$BLK
      6441**DCL      7214<>CALL     7223<>CALL
OUT$BLK.CODE
      6449**DCL      7178>>ASSIGN   7263<>CALL     7271<>CALL     7275<>CALL     7289>>ASSIGN   7916<>CALL
OUT$BLK.NSUBLKS
      6453**DCL      7205>>IF       7234>>IF       7254>>CALL     7257>>IF       7268>>IF       7295>>IF
      7850>>IF       7915>>IF       7929>>IF
OUT$BLK.SUBLK$
      6474**DCL      7177>>ASSIGN   7206>>CALL     7235>>CALL     7241>>CALL     7244>>IF       7246>>CALL
      7246>>CALL     7252>>CALL     7254>>CALL     7259>>CALL     7260>>CALL     7263>>CALL     7263>>CALL
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:197  
      7263>>CALL     7270>>CALL     7271>>CALL     7271>>CALL     7275>>CALL     7275>>CALL     7275>>CALL
      7289>>ASSIGN   7305>>IF       7308>>ASSIGN   7851>>ASSIGN   7851>>ASSIGN   7916>>CALL     7916>>CALL
      7932>>CALL     7932>>CALL
OUT$SYM.CODE
      6493**DCL      7305>>IF       7308>>ASSIGN
OUT$SYM.COUNT
      6510**DCL      6513--IMP-SIZ  7206<>CALL     7235<>CALL     7241<>CALL     7244>>IF       7246>>CALL
      7252<>CALL     7254<>CALL     7259<>CALL     7260<>CALL     7263<>CALL     7263<>CALL     7270<>CALL
      7271<>CALL     7275<>CALL     7275<>CALL     7851>>ASSIGN   7916<>CALL     7932>>CALL
OUT$SYM.TEXT
      6513**DCL      7246--CALL     7851>>ASSIGN   7932--CALL
OVERINTO IN PROCEDURE PUT_CMD
      8170**DCL      8168--PROC     8204>>IF
P$ IN PROCEDURE SETBREAK
      7346**DCL      7348<<ASSIGN   7349--ASSIGN   7349--ASSIGN   7350>>ASSIGN
PARSE$
      6608**DCL      6441--IMP-PTR  7177<<ASSIGN   7178>>ASSIGN   7205>>IF       7206>>CALL     7214>>CALL
      7223>>CALL     7234>>IF       7235>>CALL     7241>>CALL     7244>>IF       7246>>CALL     7246>>CALL
      7252>>CALL     7254>>CALL     7254>>CALL     7257>>IF       7259>>CALL     7260>>CALL     7263>>CALL
      7263>>CALL     7263>>CALL     7268>>IF       7270>>CALL     7271>>CALL     7271>>CALL     7275>>CALL
      7275>>CALL     7275>>CALL     7289>>ASSIGN   7295>>IF       7305>>IF       7308>>ASSIGN   7850>>IF
      7851>>ASSIGN   7851>>ASSIGN   7915>>IF       7916>>CALL     7916>>CALL     7929>>IF       7932>>CALL
      7932>>CALL
PARSE_PORT IN PROCEDURE OPEN_DATA_PORT
      8424**PROC     8384--CALL
PARSE_SF
      5651**DCL-ENT  5920--DCLINIT
PASV
      7122**DCL      7231<<ASSIGN   7291<<ASSIGN   8380>>IF       8385<<ASSIGN   8385>>ASSIGN   8391<<ASSIGN
PORT IN PROCEDURE OPEN_DATA_PORT
      8457**PROC     8414--CALL
PORT IN PROCEDURE PORT
      8461**DCL      8457--PROC     8467--CALL
PROMPT
      5995**DCL      5879--DCLINIT
PUT_BREAK IN PROCEDURE PUT_CMD
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:198  
      8252**LABEL    8222--CALLALT  8242--GOTO
PUT_CMD
      8168**PROC     7271--CALL     7275--CALL     7896--CALL
RCODE
      6615**DCL      7228<<ASSIGN   7249<>CALL     7317>>IF       7362<>CALL     7936<>CALL     7969<>CALL
      8002<>CALL     8067<>CALL     8154<>CALL     8210<>CALL     8256<>CALL     8257<>CALL     8274<>CALL
      8418<>CALL
RCODE.A
      6615**DCL      7253>>IF       7366>>IF       7938>>IF       7970>>IF       8006>>IF       8068>>IF
      8160>>IF       8211>>IF       8275>>IF       8382>>IF       8420>>IF
RELBOTH IN PROCEDURE GET_CMD
      8065**LABEL    8077--CALLALT
REMLOCAL IN PROCEDURE GET_CMD
      8057**LABEL    8067--CALLALT  8072--GOTO     8147--GOTO     8160--GOTO
REMOTE_ADMIN IN PROCEDURE GET_OPEN
      8314**DCL-ENT  8327--CALL     8352--CALL
REPALT IN PROCEDURE GET_CMD
      8023**LABEL    8047--CALLALT
REPALT IN PROCEDURE MFILE_CMD
      7855**LABEL    7862--CALLALT
REPALT IN PROCEDURE PUT_CMD
      8176**LABEL    8192--CALLALT
REPORT_ALT
      8474**PROC     7855--CALL     8025--CALL     8143--CALL     8186--CALL     8241--CALL
REPORT_TCP IN PROCEDURE REPORT_ALT
      8511**ENTRY    7215--CALL     8112--CALL     8155--CALL     8406--CALL
REPORT_TIME
      8558**PROC     8161--CALL     8276--CALL
RETALT IN PROCEDURE GET_OPEN
      8328**LABEL    8321--GOTO
RETALT IN PROCEDURE LIST_CMD
      7973**LABEL    7926--CALLALT  7936--CALLALT  7948--GOTO
RETALT IN PROCEDURE OPEN_DATA_PORT
      8400**LABEL    8386--CALLALT  8415--CALLALT  8418--CALLALT
RETRET IN PROCEDURE MFILE_CMD
      7856**LABEL    7853--CALLALT  7864--CALLALT  7871--CALLALT  7872--CALLALT  7889--GOTO     7897--GOTO
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:199  
RFID IN PROCEDURE GET_CMD
      8012**DCL      8011--PROC     8049--IF
RFID.COUNT IN PROCEDURE GET_CMD
      8012**DCL      8012--IMP-SIZ  8065>>CALL
RFID.TEXT IN PROCEDURE GET_CMD
      8012**DCL      8065--CALL
RFID IN PROCEDURE PUT_CMD
      8169**DCL      8168--PROC
RFID.COUNT IN PROCEDURE PUT_CMD
      8169**DCL      8169--IMP-SIZ  8193>>IF       8208>>CALL
RFID.TEXT IN PROCEDURE PUT_CMD
      8169**DCL      8208--CALL
RUNNING
      6621**DCL      7180<<ASSIGN   8001--ASSIGN
SAVERBOSE IN PROCEDURE MFILE_CMD
      7719**DCL      7846<<ASSIGN   7856>>ASSIGN   7865>>ASSIGN
SENDPORT
      7128**DCL      8401>>IF       8412>>IF
SETBREAK
      7345**PROC     7871--CALL     8078--CALL     8222--CALL
SIMPLE_CMD
      7986**PROC     7205--CALL     7206--CALL     7226--CALL     7234--CALL     7235--CALL     7238--CALL
      7241--CALL     7252--CALL     7254--CALL     7894--CALL     8146--CALL     8381--CALL
SOCKET IN PROCEDURE PARSE_PORT
      8427**DCL      8424--PROC
SOCKET.ADDRESS IN PROCEDURE PARSE_PORT
      8431**DCL      8448<<ASSIGN   8448>>ASSIGN
SOCKET.PORT IN PROCEDURE PARSE_PORT
      8431**DCL      8445<<ASSIGN   8445>>ASSIGN   8448>>ASSIGN
SPACE
      6666**DCL      7931--CALL     7995--CALL
STARFTP IN PROCEDURE MFILE_CMD
      7633**DCL      7565--DCLINIT
START_TIME
      6678**DCL      8080<<ASSIGN   8152<<ASSIGN   8152>>ASSIGN   8161<>CALL     8224<<ASSIGN   8273<<ASSIGN
      8273>>ASSIGN   8276<>CALL
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:200  
SUBTBL IN PROCEDURE LINE_SUB
      8524**DCL      8538>>CALLBLT
TCP$ADMIN.GHST_LCN
      6646**DCL      6646--REDEF
TCP$ADMIN.USER_LCN
      6645**DCL      6646--REDEF
TCP$ADMIN.CMD IN PROCEDURE GET_OPEN
      8293**DCL      8325>>IF       8350>>IF       8350>>IF
TCP$ADMIN.GHST_LCN IN PROCEDURE GET_OPEN
      8294**DCL      8294--REDEF
TCP$ADMIN.USER_LCN IN PROCEDURE GET_OPEN
      8293**DCL      8294--REDEF
TCP$CLOSE
      5647**DCL-ENT  8338--CALL
TCP$OPEN
      5649**DCL-ENT  8386--CALL     8403--CALL
TCP$READ
      5650**DCL-ENT  8111--CALL     8319--CALL     8345--CALL
TCP$RELEASE
      5642**DCL-ENT  7216--CALL     7941--CALL     7947--CALL     8071--CALL     8144--CALL     8214--CALL
      8255--CALL     8407--CALL
TCP$RELEASE IN PROCEDURE GET_OPEN
      8316**DCL-ENT  8320--CALL     8340--CALL     8354--CALL
TCP$WRITE
      5646**DCL-ENT  8250--CALL     8252--CALL     8264--CALL
TCP$WRITE_D
      5641**DCL-ENT  7246--CALL     7359--CALL     7360--CALL     7928--CALL     7931--CALL     7932--CALL
      7992--CALL     7993--CALL     7995--CALL     7996--CALL     8064--CALL     8065--CALL     8205--CALL
      8207--CALL     8208--CALL     8253--CALL     8415--CALL
TCP_MON_ERR
      4424**DCL      7163<<ASSIGN   8490--DCLINIT
TCP_MON_ERR.ERR#
      4425**DCL      8512>>IF
TCP_MON_ERR.MON
      4425**DCL      8513>>IF
TELNET_EOL
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:201  
      5640**DCL-ENT  7247--CALL     7361--CALL     7935--CALL     7998--CALL     8066--CALL     8209--CALL
      8254--CALL     8417--CALL
TEXT IN PROCEDURE PARSE_PORT
      8433**DCL      8424--PROC     8438--CALLBLT  8443>>IF       8443>>IF       8452>>ASSIGN
TEXTC.COUNT
      6673**DCL      6674--IMP-SIZ
TEXTC IN PROCEDURE LINE_SUB
      8523**DCL      8522--PROC
TEXTC.COUNT IN PROCEDURE LINE_SUB
      8523**DCL      8523--IMP-SIZ  8537>>ASSIGN   8538>>CALLBLT
TEXTC.TEXT IN PROCEDURE LINE_SUB
      8523**DCL      8538>>CALLBLT
TEXTC IN PROCEDURE SIMPLE_CMD
      7988**DCL      7986--PROC     7994--IF
TEXTC.COUNT IN PROCEDURE SIMPLE_CMD
      7988**DCL      7988--IMP-SIZ  7996>>CALL
TEXTC.TEXT IN PROCEDURE SIMPLE_CMD
      7988**DCL      7996--CALL
TFID
      6668**DCL      7260<>CALL     7271<>CALL     7877<<ASSIGN   7896<>CALL     7904<>CALL
TFID.COUNT
      6669**DCL      7875<<ASSIGN   7878>>ASSIGN   7879>>ASSIGN   7881>>ASSIGN   7882>>ASSIGN   7886<<ASSIGN
      7887>>IF       7888>>IF       7892<<ASSIGN   7903>>IF       8537<<ASSIGN
TFID.TEXT
      6670**DCL      7800--DCLINIT  7825--DCLINIT  7826--DCLINIT  7878<<ASSIGN   7881<<ASSIGN   7888>>IF
      7888>>IF       7890>>IF       7890>>IF       8538<<CALLBLT
TFIDPROMPT IN PROCEDURE MFILE_CMD
      7794**DCL      7884<>CALL
TFIDPROMPT.PROMPT_ IN PROCEDURE MFILE_CMD
      7800**DCL      7879<<ASSIGN   7882<<ASSIGN
TFIDPROMPT.V IN PROCEDURE MFILE_CMD
      7802**DCL      7796--DCLINIT
TFIDREAD IN PROCEDURE MFILE_CMD
      7823**DCL      7885<>CALL
TFIDREAD.STATION_ IN PROCEDURE MFILE_CMD
      7826**DCL      7827--REDEF
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:202  
TFIDREAD.V IN PROCEDURE MFILE_CMD
      7827**DCL      7823--DCLINIT
TFIDREAD.V.DVBYTE.REREAD# IN PROCEDURE MFILE_CMD
      7838**DCL      7838--REDEF
TFIDREAD.V.INDX# IN PROCEDURE MFILE_CMD
      7836**DCL      7836--REDEF
TIME IN PROCEDURE REPORT_TIME
      8560**DCL      8558--PROC     8571>>ASSIGN
TIMEOUT IN PROCEDURE GET_OPEN
      8287**DCL      8285--PROC     8336--ENTRY
TOGOPTS
      7124**DCL      7290<<ASSIGN   7290>>ASSIGN   7291>>ASSIGN   7378>>IF
TOGTXT
      7131**DCL      7283--DOINDEX  7283--DOINDEX  7377>>ASSIGN
TSTAMP
      6680**DCL      6696--DCLINIT  8080>>ASSIGN   8152>>ASSIGN   8224>>ASSIGN   8273>>ASSIGN
TYPE_CMD
      7355**PROC     7220--CALL     7306--CALL     7307--CALL     7924--CALL     7978--CALL
VERBOSE
      7129**DCL      7362<>CALL     7846>>ASSIGN   7856<<ASSIGN   7863<<ASSIGN   7865<<ASSIGN   7936<>CALL
      7969<>CALL     7999--ASSIGN   8067<>CALL     8154<>CALL     8210<>CALL     8274<>CALL     8418<>CALL
VLP_ACCT
      6867**DCL      6817--DCLINIT  6954--DCLINIT
VLP_NAME
      6894**DCL      6813--DCLINIT  6954--DCLINIT  8193<>CALL
VLP_PASS
      6907**DCL      6814--DCLINIT  6955--DCLINIT
VLP_PCL IN PROCEDURE MFILE_CMD
      7763**DCL      7733--DCLINIT
VLP_SN
      6920**DCL      6812--DCLINIT  6955--DCLINIT
VLP_SYS IN PROCEDURE MFILE_CMD
      7776**DCL      7733--DCLINIT
VLP_WSN
      6933**DCL      6818--DCLINIT  6955--DCLINIT
V_FLAG IN PROCEDURE SIMPLE_CMD
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:203  
      7990**DCL      8002<>CALL
V_PTR$ IN PROCEDURE SIMPLE_CMD
      7989**DCL      7990--IMP-PTR  7999<<ASSIGN   8001<<ASSIGN   8002>>CALL
WRITE_DATA
      6535**DCL      7962<>CALL
WRITE_DATA.BUF_
      6535**DCL      7961<<ASSIGN
WRITE_DATA.STATION_
      6537**DCL      6537--REDEF
WRITE_DATA.V
      6538**DCL      6535--DCLINIT
WRITE_DATA.V.DCB#
      6538**DCL      7918<<ASSIGN   7921<<ASSIGN   7922<<ASSIGN   7975>>IF
WRITE_DATA.V.DVBYTE.VFC#
      6544**DCL      6544--REDEF
WRITE_LO
      6718**DCL      7193<>CALL     7211<>CALL     7301<>CALL     7313<>CALL     7384<>CALL     8551<>CALL
      8584<>CALL
WRITE_LO.BUF_
      6718**DCL      7192<<ASSIGN   7210<<ASSIGN   7299<<ASSIGN   7300<<ASSIGN   7312<<ASSIGN   7383<<ASSIGN
      8550<<ASSIGN   8583<<ASSIGN
WRITE_LO.BUF_.BOUND
      6718**DCL      8383>>ASSIGN
WRITE_LO.BUF_.BUF$
      6720**DCL      8384>>CALL
WRITE_LO.STATION_
      6720**DCL      6720--REDEF
WRITE_LO.V.DVBYTE.VFC#
      6727**DCL      6727--REDEF    8549<<ASSIGN   8552<<ASSIGN
X$PRE_PROCESS
      4056**DCL-ENT  6139--DCLINIT
X$WRITE
      4057**DCL-ENT  8467--CALL     8578--CALL
XTX$ADAPT
      6038**DCL-ENT  6354--DCLINIT
XUG$BREAK
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:204  
      3752**DCL-ENT  6010--DCLINIT
XUG$CLRENABLE
      3755**DCL-ENT  7166--CALL     7185--CALL     7330--CALL
XUG$DISABLE
      3753**DCL-ENT  7167--CALL     7186--CALL     7331--CALL     7342--CALL     7873--CALL
XUG$ENABLE
      3754**DCL-ENT  7351--CALL
XUG$GETCMD
      3742**DCL-ENT  7170--CALL
XUG$INIT
      3746**DCL-ENT  7325--CALL
XUG_GETCMD
      5670**DCL      7166<>CALL     7167<>CALL     7170<>CALL     7185<>CALL     7186<>CALL     7325<>CALL
      7330<>CALL     7331<>CALL     7342<>CALL     7351<>CALL     7873<>CALL
XUG_GETCMD.OUT$
      5675**DCL      5681--REDEF    7175>>IF       7177>>ASSIGN
XUG_GETCMD.TEXT_
      5933**DCL      7174<<ASSIGN   7337<<ASSIGN
XUG_INIT
      6043**DCL      7325<>CALL
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:205  
              *** CROSS REFERENCE LISTING ***
    **     DENOTES     IDENTIFIER DEFINITION
    <<                 IDENTIFIER'S VALUE SET
    >>                 IDENTIFIER'S VALUE USED
    <>                 IDENTIFIER SET AND/OR USED
    --                 IDENTIFIER REFERENCED
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:206  
              MINI UREF LISTING

ARS IN PROCEDURE PUT_CMD   8179**DCL
DEBUG    7125**DCL
FTPCMD       7**PROC
FTPCMD_INIT    7323**ENTRY
I IN PROCEDURE LINE_SUB   8534**DCL
IP_WAIT_UETIME IN PROCEDURE GET_OPEN   8313**DCL
M$ACCT      34**DCL-ENT
M$ACTIVATE      37**DCL-ENT
M$ALIB      30**DCL-ENT
M$ASUSER      32**DCL-ENT
M$ATTACH      39**DCL-ENT
M$BADPP      57**DCL-ENT
M$CGCTL      38**DCL-ENT
M$CGINFO      38**DCL-ENT
M$CHECK      19**DCL-ENT
M$CHGUNIT      77**DCL-ENT
M$CLRSTK      75**DCL-ENT
M$CMDVAR      86**DCL-ENT
M$CONFIG      47**DCL-ENT
M$CORRES      22**DCL-ENT
M$CPEXIT      31**DCL-ENT
M$CVM      55**DCL-ENT
M$CVOL      20**DCL-ENT
M$DCLFLD      47**DCL-ENT
M$DEACTIVATE      37**DCL-ENT
M$DELREC      19**DCL-ENT
M$DEQ      84**DCL-ENT
M$DETACH      39**DCL-ENT
M$DEVICE      21**DCL-ENT
M$DISPLAY      84**DCL-ENT
M$DISPRES      24**DCL-ENT
M$DLIB      30**DCL-ENT
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:207  
M$DO IN PROCEDURE REPORT_ALT   8506**DCL
M$DRIBBLE      47**DCL-ENT
M$DRTN      75**DCL-ENT
M$DSUSER      32**DCL-ENT
M$ENQ      83**DCL-ENT
M$EOM      42**DCL-ENT
M$ERASE      48**DCL-ENT
M$ERR      29**DCL-ENT
M$EVENT      72**DCL-ENT
M$EXHUME      81**DCL-ENT
M$EXIT      29**DCL-ENT
M$EXTEND      21**DCL-ENT
M$FDP      53**DCL-ENT
M$FDS      52**DCL-ENT
M$FEBOOT      45**DCL-ENT
M$FECTL      46**DCL-ENT
M$FEDUMP      45**DCL-ENT
M$FINDPROC      34**DCL-ENT
M$FSUSER      32**DCL-ENT
M$FVP      54**DCL-ENT
M$FWCG      38**DCL-ENT
M$GBPL      58**DCL-ENT
M$GDDL      54**DCL-ENT
M$GDP      53**DCL-ENT
M$GDS      52**DCL-ENT
M$GETDCB      23**DCL-ENT
M$GETMOUSE      63**DCL-ENT
M$GETPM      64**DCL-ENT
M$GJOB      82**DCL-ENT
M$GLINEATTR      42**DCL-ENT
M$GOODPP      57**DCL-ENT
M$GPLATEN      50**DCL-ENT
M$GPROMPT      49**DCL-ENT
M$GTRMATTR      43**DCL-ENT
M$GTRMCTL      41**DCL-ENT
M$GTRMTAB      44**DCL-ENT
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:208  
M$GVP      53**DCL-ENT
M$HELP      80**DCL-ENT
M$INTRTN      33**DCL-ENT
M$IOQ      68**DCL-ENT
M$JOBSTATS      82**DCL-ENT
M$KEYIN      22**DCL-ENT
M$LDEV      17**DCL-ENT
M$LDTRC      30**DCL-ENT
M$LIMIT      23**DCL-ENT
M$LINES      22**DCL-ENT
M$LO IN PROCEDURE REPORT_TIME   8565**DCL
M$MADMUCK      25**DCL-ENT
M$MAKUSER      56**DCL-ENT
M$MBS      24**DCL-ENT
M$MDFFLD      48**DCL-ENT
M$MERC      73**DCL-ENT
M$MERCS      74**DCL-ENT
M$MIRROR      68**DCL-ENT
M$MONINFO      85**DCL-ENT
M$MPL      58**DCL-ENT
M$NODEINFO      49**DCL-ENT
M$NXTUSR      83**DCL-ENT
M$OCMSG      81**DCL-ENT
M$OLAY      29**DCL-ENT
M$PAS      58**DCL-ENT
M$PATHCON      81**DCL-ENT
M$PDS      52**DCL-ENT
M$PFIL      19**DCL-ENT
M$PLATEN      43**DCL-ENT
M$PRECORD      21**DCL-ENT
M$PROCNAME      34**DCL-ENT
M$PROFILE      45**DCL-ENT
M$RACST      25**DCL-ENT
M$RDSYSLOG      66**DCL-ENT
M$RELDCB      23**DCL-ENT
M$RELRES      24**DCL-ENT
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:209  
M$RELSTARF      26**DCL-ENT
M$REM      26**DCL-ENT
M$RENV      73**DCL-ENT
M$REQUIRE      25**DCL-ENT
M$RETRY      74**DCL-ENT
M$RETRYS      74**DCL-ENT
M$RLSFLD      48**DCL-ENT
M$RPRIV      76**DCL-ENT
M$RSPP      55**DCL-ENT
M$RSWITCH      77**DCL-ENT
M$RUE      83**DCL-ENT
M$SAD      56**DCL-ENT
M$SAVE      32**DCL-ENT
M$SCON      33**DCL-ENT
M$SCREECH      31**DCL-ENT
M$SENV      73**DCL-ENT
M$SETFMA      17**DCL-ENT
M$SETFP      46**DCL-ENT
M$SINPUT      44**DCL-ENT
M$SLCFLD      49**DCL-ENT
M$SMOUSE      63**DCL-ENT
M$SMPRT      55**DCL-ENT
M$SPRIV      76**DCL-ENT
M$SSC      56**DCL-ENT
M$SSWITCH      76**DCL-ENT
M$STATE      85**DCL-ENT
M$STD      57**DCL-ENT
M$STIMER      71**DCL-ENT
M$STLPP      54**DCL-ENT
M$STRAP      71**DCL-ENT
M$STRMATTR      43**DCL-ENT
M$STRMCTL      41**DCL-ENT
M$STRMTAB      44**DCL-ENT
M$SYMBIO      82**DCL-ENT
M$SYSCON      68**DCL-ENT
M$SYSID      86**DCL-ENT
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:210  
M$TDCLOSE      67**DCL-ENT
M$TDIO      67**DCL-ENT
M$TDOPEN      66**DCL-ENT
M$TDREQCPU      67**DCL-ENT
M$TEMPWROC      61**DCL-ENT
M$TRAP      71**DCL-ENT
M$TRMISC      46**DCL-ENT
M$TRMPRG      42**DCL-ENT
M$TRTN      75**DCL-ENT
M$TRUNC      18**DCL-ENT
M$TTIMER      71**DCL-ENT
M$UMPL      58**DCL-ENT
M$UNFID      80**DCL-ENT
M$UNLATCH      37**DCL-ENT
M$UNSHARE      34**DCL-ENT
M$USRFIELD      77**DCL-ENT
M$VIRTUAL      52**DCL-ENT
M$WAIT      75**DCL-ENT
M$WEOF      20**DCL-ENT
M$WRSYSLOG      66**DCL-ENT
M$XCON      72**DCL-ENT
M$XCONRTN      33**DCL-ENT
M$XEQTIME      85**DCL-ENT
M$XFLUSH      26**DCL-ENT
M$XMOUSE      63**DCL-ENT
M$YC      31**DCL-ENT
REMAINING_TIME IN PROCEDURE GET_OPEN   8315**DCL
REMOTE_ADMIN    5648**DCL-ENT
TCP_ERR_CODE    4424**DCL
TMPC    6732**DCL
X66_TRTN    5652**DCL-ENT
XUG$ALLMSG    3759**DCL-ENT
XUG$BLANK_PASSWORD    3762**DCL-ENT
XUG$CLOSE_DCBS    3751**DCL-ENT
XUG$CORRES    3747**DCL-ENT
XUG$ECHO    3745**DCL-ENT
PL6.E3A0      #001=FTPCMD File=TCF$FTPCMD.:TCA2TSI                               SUN 11/16/97 14:09 Page:211  
XUG$ECHOIF    3744**DCL-ENT
XUG$ECHOLAST    3748**DCL-ENT
XUG$ERRCNVRT    3764**DCL-ENT
XUG$ERRMSG    3749**DCL-ENT
XUG$ERRPTR    3743**DCL-ENT
XUG$ERRTOLCP6    3765**DCL-ENT
XUG$FINDDCB    3760**DCL-ENT
XUG$GETDCB    3761**DCL-ENT
XUG$HELP    3757**DCL-ENT
XUG$MOREMSG    3758**DCL-ENT
XUG$OPENOUT    3763**DCL-ENT
XUG$SETERRMSG    3750**DCL-ENT
XUG$SIMULATE_BREAK    3756**DCL-ENT
