VERSION E05

PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:1    
        1        1        /*M* ASA$LINK_VIRCIR - Processes the LINK opts and cmd. */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X*  DMC,DMR,CCC,PLM=0,IND=3,CTI=5,DCI=6,IAD=0,DTI=0,IDT=0,ENI=3,
        8        8              ECU=3,CSU=3,SDI=3                                           */
        9        9
       10       10        ASA$LINK_VIRCIR: PROC ;
       11       11
       12       12
       13       13
       14       14        /*********************************************************************/
       15       15        /*   Include files   include files   include files   include files   */
       16       16        /*********************************************************************/
       17       17
       18       18        %INCLUDE  AS_ENTRIES_M   ;
       19     1068        %INCLUDE  B$TABLES_C     ;   /*  for profile name translations  */
       20     1176        %INCLUDE  AS_MAC_C       ;
       21     1256        %INCLUDE  AS_SUPER_C     ;
       22     1691        %INCLUDE  XU_MACRO_C     ;
       23     4797        %INCLUDE  XU_FORMAT_C    ;
       24     4959        %INCLUDE  AS_SUBS_C      ;
       25     6373        %INCLUDE  AS_SSUBS_C     ;
       26     6465        %INCLUDE  AS_PERR_C      ;
       27     7067        %INCLUDE  CP_6           ;
       28     7148        %INCLUDE  KL_CONFIG_M    ;
       29     7910        %INCLUDE  KL_SUPER_C     ;
       30    10812        %INCLUDE  B_ERRORS_C     ;
       31    11939        %INCLUDE  AS_SUPER_R     ;
       32    14955        %INCLUDE  XU_SUBS_C      ;
       33    15047
       34    15048        %EJECT;
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:2    
       35    15049        /********************************************************************/
       36    15050        /*   Auto data       auto data       auto data       auto data       */
       37    15051        /*********************************************************************/
       38    15052
       39    15053    1   DCL SUBNDS SBIN WORD ;
       40    15054    1   DCL SUBS SBIN WORD ;
       41    15055    1   DCL PTR$ PTR ;
       42    15056    1   DCL CNT SBIN WORD ;
       43    15057    1   DCL I SBIN WORD ;
       44    15058    1   DCL J SBIN WORD ;
       45    15059    1   DCL K SBIN WORD ;
       46    15060    1   DCL ARS SBIN WORD ;
       47    15061    1   DCL MORE BIT(1) ;
       48    15062    1   DCL VIRCIR# SBIN WORD ;
       49    15063    1   DCL VIRCIR_INDEX SBIN WORD ;
       50    15064    1   DCL VIRCIR_EXISTS BIT(1) ;
       51    15065    1   DCL FOUND BIT(1) ;
       52    15066    1   DCL LINK BIT(1) ;
       53    15067    1   DCL VIRCIR BIT(1) ;
       54    15068    1   DCL LINKDEV BIT(1) ;
       55    15069    1   DCL BLK$ PTR ;
       56    15070    1   DCL PRO$ PTR ;
       57    15071    1   DCL DEV$ PTR;
       58    15072    1   DCL CREATE BIT(1) ;
       59    15073    1   DCL MOVE_SIZE SBIN WORD ;
       60    15074    1   DCL SIZE SBIN WORD ;
       61    15075    1   DCL DEV_START$ PTR ;
       62    15076    1   DCL DEV_STOP$ PTR ;
       63    15077    1   DCL DEV_SIZEW SBIN ;
       64    15078    1   DCL PRO_BUF CHAR(AS_PRO_BUF_SIZEC);
       65    15079    1   DCL 1 LINK_NAME,
       66    15080    1          2 COUNT UBIN BYTE UNAL,
       67    15081    1          2 TEXT CHAR(8) UNAL;
       68    15082    1   DCL TEMP_STR CHAR(4);
       69    15083    1   DCL DISP     UBIN;
       70    15084    1   DCL VC_ADDR_SET   BIT(1);
       71    15085    1   DCL LINK_DEST_SET BIT(1);
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:3    
       72    15086    1   DCL TEMP UBIN;
       73    15087    1   DCL PTR2$ PTR;
       74    15088    1   DCL PTR3$ PTR;
       75    15089    1   DCL XPNAME CHAR(11);
       76    15090        %EJECT ;
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:4    
       77    15091        /********************************************************************/
       78    15092        /*   Symref's        symref's        symref's        symref's        */
       79    15093        /*********************************************************************/
       80    15094
       81    15095    1   DCL LINK_CMD  SYMREF UBIN(36) ;
       82    15096    1   DCL LINK_OPTS_LIST SYMREF UBIN WORD ;
       83    15097    1   DCL VIR_CIR_CMD SYMREF UBIN WORD ;
       84    15098    1   DCL VIR_CIR_OPTS_LIST SYMREF UBIN WORD ;
       85    15099    1   DCL LINK_DEV_CMD SYMREF UBIN WORD ;
       86    15100    1   DCL LINK_DEV_OPTS_LIST SYMREF UBIN WORD ;
       87    15101    1   DCL B$TCB$ PTR SYMREF;
       88    15102        %B$XL_UPPER_UR;
       89    15106        %EJECT ;
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:5    
       90    15107        /********************************************************************/
       91    15108        /*   Static data     static data     static data     static data     */
       92    15109        /*********************************************************************/
       93    15110
       94    15111    1   DCL 1 LINK_KEY ALIGNED STATIC ,
       95    15112    1          2 CNT UBIN BYTE UNAL INIT( 9 ),
       96    15113    1          2 TXT UNAL ,
       97    15114    1             3 ACCT CHAR(8) UNAL INIT(' ') ,
       98    15115    1             3 ASTR CHAR(1) UNAL INIT('*') ;
       99    15116    1   DCL 1 ADRN ALIGNED STATIC,
      100    15117    1          2 LNG# UBIN BYTE UNAL ,
      101    15118    1          2 ADR (0:8) UNAL,
      102    15119    1             3 * UBIN(1) UNAL ,
      103    15120    1             3 BCD1# UBIN(4) UNAL ,
      104    15121    1             3 BCD2# UBIN(4) UNAL ;
      105    15122    1   DCL 1 ADRN18 ALIGNED STATIC,
      106    15123    1          2 LNG# UBIN BYTE UNAL ,
      107    15124    1          2 ADR (0:8) UNAL,
      108    15125    1             3 * UBIN(1) UNAL ,
      109    15126    1             3 BCD1# UBIN(4) UNAL ,
      110    15127    1             3 BCD2# UBIN(4) UNAL ;
      111    15128    1   DCL 1 LNGTH ALIGNED STATIC,
      112    15129    1          2 T UBIN(28) UNAL INIT(0),
      113    15130    1          2 B UBIN(8) UNAL INIT(0);
      114    15131    1   DCL LNG_CNT REDEF LNGTH UBIN;
      115    15132        %FPT_NODEINFO (NODEINFO=VLR_NODEINFO);
      116    15144        %VLR_NODEINFO;
      117    15159        %KL$TERM (NAME=KL_TERM_REC,STCLASS=STATIC);
      118    15208        %KL$TERM_KEY (NAME=KL_TERM_KEY,STCLASS=STATIC);
      119    15254
      120    15255        /*********************************************************************/
      121    15256        /*    Constant data     constant data     constant data              */
      122    15257        /*********************************************************************/
      123    15258        %KL_DREC( NAME = LINK_DREC,
      124    15259                  TYP = %KLAT_LNKLINE# ,
      125    15260                  SUPR = AS_LNK# ,
      126    15261                  STCLASS = CONSTANT ,
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:6    
      127    15262                  RNAME = ' ' ,
      128    15263                  PASS = ' ' ,
      129    15264                  WORG = ' ' ,
      130    15265                  LAST="," ) ;
      131    15378        %KL_LNK( NAME=LNK,
      132    15379                 LVL=2,
      133    15380                 STCLASS=CONSTANT,
      134    15381                 LAST=";");
      135    15605        %KL_LNKVC(
      136    15606                     LVL=1,
      137    15607                     STCLASS=CONSTANT);
      138    15831        %KL_LINKDEV (
      139    15832                     LVL=1,
      140    15833                     STCLASS=CONSTANT);
      141    16004
      142    16005        %PLIST ;
      143    16006        %EJECT ;
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:7    
      144    16007        /*********************************************************************/
      145    16008        /*   Local based     local based     local based     local based     */
      146    16009        /*********************************************************************/
      147    16010
      148    16011        %PARSE$OUT( NAME=P$NODE, STCLASS="BASED(NODE$)",
      149    16012                    NDTYPE=TYPE, NSUBLKS=SUBNODES) ;
      150    16057        %PARSE$SYM( NAME = OUT$SYM ,
      151    16058                    STCLASS="BASED(BLK$)") ;
      152    16096        %KL_DREC (NAME = KL$DREC ,
      153    16097                  LAST="," ,
      154    16098                  STCLASS="BASED( DSEG1$ )");
      155    16211        %KL_LNK( NAME=LNK,
      156    16212                 LVL=2,
      157    16213                 STCLASS=BASED,
      158    16214                 LAST=";");
      159    16438              %KL_DREC( NAME=RES$DEV, STCLASS="BASED( DSEG2$ )", LAST="," );
      160    16551              %KL_RES_CL_DEV( NAME=RES_DEV, STCLASS=STCLASS, LVL=2, LAST=";" );
      161    16611        %KL_LNKVC (NAME=KL$LNKVC,
      162    16612                     LVL=1,
      163    16613                     STCLASS="BASED(DSEG3$)" ) ;
      164    16837        %KL_LINKDEV (NAME=KL$LINKDEV,
      165    16838                     LVL=1,
      166    16839                     STCLASS="BASED(DSEG3$)" ) ;
      167    17010        %KL_PHDR (NAME = KL$PHDR ,
      168    17011                  STCLASS="BASED( PRO$ )") ;
      169    17052    1   DCL MOVE$TEMP CHAR(MOVE_SIZE) BASED ;
      170    17053        %KL$UBWORD( NAME=KL$UBWORD, STCLASS = AUTO);
      171    17063        %B$TCB;
      172    17066        %B$ALT;
      173    17074        %PLIST ;
      174    17075        %EJECT ;
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:8    
      175    17076        /********************************************************************/
      176    17077        /*   Entry dcls      entry dcls      entry dcls      entry dcls      */
      177    17078        /*********************************************************************/
      178    17079
      179    17080    1   DCL X$PARSE ENTRY(1) ALTRET ;
      180    17081        %ASB$FIND_NUM ;
      181    17084        %ASB$ENQ_HLP ;
      182    17087        %ASB$DEQ_HLP ;
      183    17090        %ASB$READ_HLP ;
      184    17093        %ASB$WRITE_HLP ;
      185    17096        %ASB$WRITE_LO ;
      186    17099        %ASB$GETSEG ;
      187    17102        %ASB$GET_MORE_SEG ;
      188    17105        %ASB$SET_PROMPT ;
      189    17108        %ASB$READ_SI ;
      190    17111        %ASD$READ_PRO ;
      191    17114        %ASH$ERROR ;
      192    17117        %ASH$WARN ;
      193    17120        %ASH$INFO ;
      194    17123        %ASZ$SCRAMBLE ;
      195    17126        %ASH$HELP ;
      196    17129        %ASH$QUEST ;
      197    17132        %ASH$DQUEST ;
      198    17135        %ASA$ERROR ;
      199    17138        %ASB$CHECK_TYPE ;
      200    17141        %ASB$READ_NETCON ;
      201    17144        %ASB$WRITE_NETCON ;
      202    17147        %ASB$CLOSE_NETCON ;
      203    17150        %ASD$HEX2OCT ;
      204    17153        %EJECT ;
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:9    
      205    17154        /********************************************************************/
      206    17155        /*   Procedure       procedure       procedure       procedure       */
      207    17156        /*********************************************************************/
      208    17157                                                              /**/
      209    17158        /*
      210    17159            ***            Begin procedure                    ***
      211    17160        */
      212    17161    1   VC_ADDR_SET = AS_FALSE;
      213    17162    1   LINK_DEST_SET = AS_FALSE;
      214    17163    1   LINK = (P$NODE.CODE = CR_MOD_LINK_VAL);
      215    17164    1   VIRCIR = (P$NODE.CODE = CR_MOD_VIR_CIR_VAL);
      216    17165    1   LINKDEV = (P$NODE.CODE = %CR_MOD_LINK_DEV_VAL);
      217    17166    1   IF LINK THEN
      218    17167    1      P_PCB.ROOT$ = ADDR( LINK_CMD ) ;
      219    17168    1   ELSE IF VIRCIR THEN
      220    17169    1         P_PCB.ROOT$ = ADDR( VIR_CIR_CMD ) ;
      221    17170    1      ELSE IF LINKDEV THEN
      222    17171    1            P_PCB.ROOT$ = ADDR( LINK_DEV_CMD ) ;
      223    17172    1   CALL X$PARSE( P_PCB )
      224    17173    2   WHENALTRETURN DO;
      225    17174    2      CALL ASH$ERROR (P_PCB.ERROR);
      226    17175    2      RETURN;
      227    17176    2      END; /*  Whenaltreturn  */
      228    17177                                                              /**/
      229    17178    1   NODE$ = P_PCB.OUT$ ;
      230    17179                                                              /**/
      231    17180    1   CREATE = ( P$NODE.CODE = CR_DEVICE_VAL );
      232    17181                                                              /**/
      233    17182    1   IF NOT DSEG_FLG THEN CALL ASB$GETSEG ALTRET( GETSEG_ERR );
      234    17183                                                          /* Check existence of line */
      235    17184    1   IF LINK THEN
      236    17185    1      BLK$ = NODE$ -> P$NODE.SUBLK$(0) ;
      237    17186    1   ELSE
      238    17187    1      BLK$ = NODE$ -> P$NODE.SUBLK$(1) ;
      239    17188    2   IF OUT$SYM.COUNT > 8 THEN DO;
      240    17189        /*E*  ERROR:    ASA-E$NNAMETOOBIG-C
      241    17190              MESSAGE:  Link name too long.
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:10   
      242    17191              MESSAGE1: Link names can be at most 8 characters.
      243    17192        */
      244    17193           %SCREAM( ERR#=E$NNAMETOOBIG, LEVEL=ERROR, MID='A' );
      245    17208    2      RETURN ;
      246    17209    2      END ;    /* Then do */
      247    17210    1   LINK_NAME.COUNT = OUT$SYM.COUNT ;
      248    17211    1   LINK_NAME.TEXT  = OUT$SYM.TEXT ;
      249    17212    1   LINK_KEY.TXT.ACCT = OUT$SYM.TEXT ;
      250    17213    1   USERS_KEY = LINK_KEY ;
      251    17214    1   CALL ASB$ENQ_HLP
      252    17215    2   WHENALTRETURN DO;
      253    17216    2      RETURN;
      254    17217    2      END; /*  Whenaltreturn  */
      255    17218    1   PTR$ = PINCRW (ADDR(KL$DREC.LNK),SIZEW(KL$DREC.LNK));
      256    17219    1   PTR2$ = PINCRC (DSEG1$, DSEG1SIZE-SIZEC(KL_LNKVC));
      257    17220    2   DO WHILE PTR$ < PTR2$;
      258    17221    2      PTR$->KL$LNKVC = '0'B;
      259    17222    2      PTR$ = PINCRC (PTR$,SIZEC(KL_LNKVC));
      260    17223    2      END;  /*  While PTR$ < PTR2$  */
      261    17224    1   ARS = DSEG1SIZE ;
      262    17225    1   CALL ASB$READ_HLP( DSEG1$, ARS, 1 )
      263    17226    2   WHENRETURN DO;
      264    17227    2      CALL ASB$CHECK_TYPE( DSEG1$, ARS, AS_LNK#, CREATE & LINK, LINK_NAME ) ALTRET(
             17227               EXIT#);
      265    17228    3      IF LINK AND CREATE THEN DO;
      266    17229           /*E*  ERROR:    ASA-E$LINK_ALREADY_EXISTS-C
      267    17230                 MESSAGE: Link %%U1 %already exists.
      268    17231                 MESSAGE1: Cannot CREATE a link that already exists.
      269    17232           */
      270    17233    3         AS_FIELD1 = LINK_NAME;
      271    17234              %SCREAM( ERR#=E$LINK_ALREADY_EXISTS, LEVEL=ERROR, MID='A') ;
      272    17249    3         GOTO EXIT#;
      273    17250    3         END ; /* Link and create */
      274    17251    2      END; /*  Whenreturn  */
      275    17252    2   WHENALTRETURN DO;
      276    17253    3      IF MERR_CODE.CODE ~= %E$NOKEY THEN DO;
      277    17254    3         CALL ASA$ERROR( USERS_KEY, E$UNABLE_TO_READ_HLP );
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:11   
      278    17255    3         GOTO EXIT#;
      279    17256    3         END;  /*  Error = no key  */
      280    17257    3      IF LINK THEN DO;
      281    17258    4         IF NOT CREATE THEN DO;
      282    17259           /*E*  ERROR:    ASA-E$LINK_NO_EXIST1-C
      283    17260                 MESSAGE: Link %%U1 %does not exist. Switching to CREATE mode.
      284    17261           */
      285    17262    4            AS_FIELD1 = LINK_NAME;
      286    17263                 %SCREAM( ERR#=E$LINK_NO_EXIST1, LEVEL=WARN, MID='A') ;
      287    17278    4            CREATE = AS_TRUE ;
      288    17279    4            END;  /*  Not create  */
      289    17280    3         END;  /*  Link  */
      290    17281    3      ELSE DO;
      291    17282           /*E*  ERROR:    ASA-E$LINK_NO_EXIST2-C
      292    17283                 MESSAGE1: Link %%U1 %does not exist.
      293    17284           */
      294    17285    3         AS_FIELD1 = LINK_NAME;
      295    17286              %SCREAM( ERR#=E$LINK_NO_EXIST2, LEVEL=WARN, MID='A') ;
      296    17301    3         GOTO EXIT#;
      297    17302    3         END;  /*  Not link  */
      298    17303    2      END; /*  Whenaltreturn  */
      299    17304                                                              /**/
      300    17305    2   IF NOT LINK THEN DO;
      301    17306    2      DEV_START$ = PINCRW(ADDR(KL$DREC.LNK), SIZEW(KL$DREC.LNK) );
      302    17307    2      DEV_SIZEW = KL$DREC.NWINFO - POFFW(DEV_START$,ADDR(KL$DREC.LNK));
      303    17308    2      CALL FIND_VIRCIR ALTRET(EXIT#);
      304    17309    2      END;
      305    17310    1   ELSE
      306    17311    2      IF CREATE THEN DO;          /* Initialize the link record */
      307    17312    2         KL$DREC = LINK_DREC;
      308    17313    2         KL$DREC.PASSWORD = BLANK_PASS;
      309    17314    2         KL$DREC.LNK = LINK_DREC.LNK;
      310    17315    2         KL$DREC.LNK.BLKHDR.LEV = 1;
      311    17316    2         KL$DREC.LNK.BLKHDR.NSUBS = 0;
      312    17317    2         LNG_CNT = LENGTHC( LINK_DREC.LNK );
      313    17318    2         KL$UBWORD.NUM = 0;
      314    17319    2         KL$UBWORD.REPLACE.T = LNGTH.T;
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:12   
      315    17320    2         KL$UBWORD.REPLACE.B = LNGTH.B;
      316    17321    2         KL$DREC.LNK.BLKHDR.LEN.BYT(0) = KL$UBWORD.REPLACE.T;
      317    17322    2         KL$DREC.LNK.BLKHDR.LEN.BYT(1) = KL$UBWORD.REPLACE.B;
      318    17323    2         KL$DREC.LNK.BLKHDR.BLKTYP = %KLTY_LINK#;
      319    17324    2         END;
      320    17325                                                              /*  Do options  */
      321    17326    1   MORE = AS_TRUE ;
      322    17327                                                              /**/
      323    17328    1   IF LINK THEN
      324    17329    1      P_PCB.ROOT$ = ADDR( LINK_OPTS_LIST ) ;
      325    17330    1   ELSE IF VIRCIR THEN
      326    17331    1         P_PCB.ROOT$ = ADDR( VIR_CIR_OPTS_LIST );
      327    17332    1      ELSE IF LINKDEV THEN
      328    17333    1            P_PCB.ROOT$ = ADDR( LINK_DEV_OPTS_LIST );
      329    17334    2   DO WHILE( MORE ) ;
      330    17335                                                              /* Set prompt */
      331    17336    2      CALL ASB$SET_PROMPT ( %PROMPT_OPT ) ;
      332    17337                                                              /* Read input */
      333    17338    2   LINK_LOOP: ;
      334    17339    2      CALL ASB$READ_SI( IN_BUF, ARS ) ;
      335    17340    2      P_PCB.NCHARS = ARS ;
      336    17341    2      CALL X$PARSE( P_PCB )
      337    17342    3      WHENALTRETURN DO;
      338    17343    3         CALL ASH$ERROR( P_PCB.ERROR );
      339    17344    3         GOTO LINK_LOOP;
      340    17345    3         END; /*  Whenaltreturn  */
      341    17346    2      NODE$ = P_PCB.OUT$ ;
      342    17347                                                              /**/
      343    17348    3      DO I = 0 TO P$NODE.SUBNODES-1 ;
      344    17349    3         PTR$ = P$NODE.SUBLK$(I) ;
      345    17350    3         CODE = PTR$ -> P$NODE.CODE ;
      346    17351    4         DO SELECT( CODE ) ;
      347    17352                                                              /**/
      348    17353                                                              /**/
      349    17354    4            SELECT( %LINK_PRO_VAL ) ;
      350    17355    4            BLK$ = PTR$ -> P$NODE.SUBLK$(0) ;
      351    17356    5            IF OUT$SYM.COUNT > 11 THEN DO;
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:13   
      352    17357                    %SCREAM( ERR#=E$PRO_TOO_LONG, LEVEL=ERROR, MID='A') ;
      353    17372    5               GOTO LOOP_END;
      354    17373    5               END ;    /* Then do */
      355    17374    4            PRO$ = ADDR(PRO_BUF);
      356    17375    4            ARS = LENGTHC(PRO_BUF);
      357    17376    4            CALL XLATE (XPNAME, B$XL_UPPER_UR, SUBSTR (OUT$SYM.TEXT, 0, OUT$SYM.COUNT))
             17376                     ;
      358    17377    4            USERS_KEY.COUNT = OUT$SYM.COUNT ;
      359    17378    4            USERS_KEY.TXTC = XPNAME;
      360    17379    4            CALL ASD$READ_PRO(USERS_KEY,KL$PHDR,ARS)
      361    17380    5            WHENALTRETURN DO;
      362    17381    5               AS_FIELD1 = USERS_KEY ;
      363    17382                    %SCREAM( ERR#=E$PRO_NO_EXIST, LEVEL=ERROR, MID='A' ) ;
      364    17397    5               GOTO LOOP_END;
      365    17398    5               END; /*  Whenaltreturn  */
      366    17399    4            IF LINK THEN
      367    17400    5               IF KL$PHDR.TTYP ~= %KLTY_LINK# THEN DO;
      368    17401        /*E* ERROR: ASA-E$LINKPROTYPE-0
      369    17402             MESSAGE: You must specify a profile that defines a link.
      370    17403             MESSAGE1: Examples: $LINK
      371    17404        */
      372    17405                       %SCREAM( ERR#=E$LINKPROTYPE, LEVEL=ERROR, MID='A' );
      373    17420    5                  END;
      374    17421    5               ELSE DO;
      375    17422    5                  KL$DREC.PNAME.CNT = OUT$SYM.COUNT ;
      376    17423    5                  KL$DREC.PNAME.TXT = XPNAME;
      377    17424    5                  END;
      378    17425    4            ELSE
      379    17426    5               IF KL$PHDR.TTYP ~= %KLTY_VIRCIR# THEN DO ;
      380    17427        /*E* ERROR: ASA-E$VIRCIRPROTYPE-0
      381    17428             MESSAGE: You must specify a profile that defines a virtual circuit.
      382    17429             MESSAGE1: Examples: $VIRCIR
      383    17430        */
      384    17431                       %SCREAM( ERR#=E$VIRCIRPROTYPE, LEVEL=ERROR, MID='A' );
      385    17446    5                  END;
      386    17447    5               ELSE DO;
      387    17448    5                  KL$LNKVC.PRONM.CNT = OUT$SYM.COUNT ;
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:14   
      388    17449    5                  KL$LNKVC.PRONM.TXT = XPNAME;
      389    17450    5                  END;
      390    17451
      391    17452                                                             /**/
      392    17453                                                              /**/
      393    17454    4            SELECT( %LINK_DFLTVCPRO_VAL ) ;
      394    17455    4            BLK$ = PTR$ -> P$NODE.SUBLK$(0) ;
      395    17456    5            IF OUT$SYM.COUNT > 11 THEN DO;
      396    17457                    %SCREAM( ERR#=E$PRO_TOO_LONG, LEVEL=ERROR, MID='A') ;
      397    17472    5               GOTO LOOP_END;
      398    17473    5               END ;    /* Count > 11  */
      399    17474    4            PRO$ = ADDR(PRO_BUF);
      400    17475    4            ARS = LENGTHC(PRO_BUF);
      401    17476    4            CALL XLATE (XPNAME, B$XL_UPPER_UR, SUBSTR (OUT$SYM.TEXT, 0, OUT$SYM.COUNT))
             17476                     ;
      402    17477    4            USERS_KEY.COUNT = OUT$SYM.COUNT ;
      403    17478    4            USERS_KEY.TXTC = XPNAME ;
      404    17479    4            CALL ASD$READ_PRO(USERS_KEY,KL$PHDR,ARS)
      405    17480    5            WHENALTRETURN DO;
      406    17481    5               AS_FIELD1 = USERS_KEY;
      407    17482                    %SCREAM (ERR# = E$PRO_NO_EXIST, LEVEL=ERROR, MID= 'A');
      408    17497    5               GOTO LOOP_END;
      409    17498    5               END; /*  Whenaltreturn  */
      410    17499    4            IF LINK THEN
      411    17500    5               IF KL$PHDR.TTYP ~= %KLTY_VIRCIR# THEN DO;
      412    17501                       %SCREAM( ERR#=E$VIRCIRPROTYPE, LEVEL=ERROR, MID='A' );
      413    17516    5                  END;  /*  Ttyp not vircir  */
      414    17517    5               ELSE DO;
      415    17518    5                  KL$DREC.LNK.DFLTVCPRO.CNT = OUT$SYM.COUNT ;
      416    17519    5                  KL$DREC.LNK.DFLTVCPRO.TXT = XPNAME ;
      417    17520    5                  END;  /*  Ttyp is vircir  */
      418    17521                                                             /**/
      419    17522    4            SELECT( %LINK_ADDRESS_VAL );
      420    17523    4            BLK$ = PTR$ -> P$NODE.SUBLK$(0);
      421    17524    4            CNT = OUT$SYM.COUNT;
      422    17525    5            IF CNT > 14 THEN DO;
      423    17526        /*E*  ERROR:  ASA-E$BAD_ADDRESS-C
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:15   
      424    17527              MESSAGE: ADDRESS can be at most 14 decimal digits.
      425    17528        */
      426    17529                    %SCREAM( ERR#=E$BAD_ADDRESS, LEVEL=ERROR, MID='A' );
      427    17544    5               END;
      428    17545    5            ELSE DO;
      429    17546    5               ADRN = '0'B;
      430    17547    5               K = CNT / 2 - 1;
      431    17548    5               ADRN.LNG# = CNT ;
      432    17549    5               J = MOD( CNT, 2 ) ;
      433    17550    5               IF J = 1 THEN
      434    17551    6               DO;
      435    17552    6                  CALL CHARBIN( J, SUBSTR(OUT$SYM.TEXT,CNT-1,1)) ;
      436    17553    6                  ADRN.ADR.BCD1#(K+1) = J ;
      437    17554    6                  END;
      438    17555    6               DO J = 0 TO K;
      439    17556    6                  CALL CHARBIN( CNT, SUBSTR(OUT$SYM.TEXT,J*2,1) );
      440    17557    6                  ADRN.ADR.BCD1#(J) = CNT;
      441    17558    6                  CALL CHARBIN( CNT, SUBSTR(OUT$SYM.TEXT,J*2+1,1) );
      442    17559    6                  ADRN.ADR.BCD2#(J) = CNT;
      443    17560    6                  END;
      444    17561    5               IF LINK THEN
      445    17562    5                  KL$DREC.LNK.ADR = ADRN ;
      446    17563    6               ELSE DO;
      447    17564    6                  KL$LNKVC.ADR = ADRN ;
      448    17565    6                  VC_ADDR_SET = AS_TRUE;
      449    17566    6                  END ;  /*  Else vircir  */
      450    17567    5               END ;  /*  A good address  */
      451    17568
      452    17569    4            SELECT ( %LINK_MODE_VAL);
      453    17570    4            IF PTR$->P$NODE.SUBLK$(0)->P$NODE.CODE = %LINK_DTE_VAL THEN
      454    17571    4               KL$DREC.LNK.MODE# = 0;
      455    17572    4            ELSE
      456    17573    4               KL$DREC.LNK.MODE# = 1;
      457    17574
      458    17575    4            SELECT ( %LINK_LIC_VAL);
      459    17576    4            BLK$ = PTR$ -> P$NODE.SUBLK$(0);
      460    17577    4            CALL CHARBIN (J, OUT$SYM.TEXT);
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:16   
      461    17578    5            IF J > 4095 THEN DO;
      462    17579        /*E* ERROR: ASA-E$LINK_CHAN_TOO_BIG-0
      463    17580             MESSAGE: The given value is too large for this LINK CHANNEL.
      464    17581             MESSAGE1: The maximum value for a LINK CHANNEL is 4095.
      465    17582        */
      466    17583                    %SCREAM (ERR#=E$LINK_CHAN_TOO_BIG, LEVEL=ERROR, MID='A');
      467    17598    5               END; /*  Lic > 4095  */
      468    17599    4            ELSE
      469    17600    4               KL$DREC.LNK.LIC = J;
      470    17601
      471    17602    4            SELECT ( %LINK_LOC_VAL);
      472    17603    4            BLK$ = PTR$ -> P$NODE.SUBLK$(0);
      473    17604    4            CALL CHARBIN (J, OUT$SYM.TEXT);
      474    17605    4            IF J > 4095 THEN
      475    17606    5            DO;
      476    17607                    %SCREAM (ERR#=E$LINK_CHAN_TOO_BIG, LEVEL=ERROR, MID='A');
      477    17622    5               END; /*  Loc > 4095  */
      478    17623    4            ELSE
      479    17624    4               KL$DREC.LNK.LOC = J;
      480    17625
      481    17626    4            SELECT ( %LINK_HIC_VAL);
      482    17627    4            BLK$ = PTR$ -> P$NODE.SUBLK$(0);
      483    17628    4            CALL CHARBIN (J, OUT$SYM.TEXT);
      484    17629    4            IF J > 4095 THEN
      485    17630    5            DO;
      486    17631                    %SCREAM (ERR#=E$LINK_CHAN_TOO_BIG, LEVEL=ERROR, MID='A');
      487    17646    5               END; /*  Hic > 4095  */
      488    17647    4            ELSE
      489    17648    4               KL$DREC.LNK.HIC = J;
      490    17649
      491    17650    4            SELECT ( %LINK_HOC_VAL);
      492    17651    4            BLK$ = PTR$ -> P$NODE.SUBLK$(0);
      493    17652    4            CALL CHARBIN (J, OUT$SYM.TEXT);
      494    17653    4            IF J > 4095 THEN
      495    17654    5            DO;
      496    17655                    %SCREAM (ERR#=E$LINK_CHAN_TOO_BIG, LEVEL=ERROR, MID='A');
      497    17670    5               END; /*  Hoc > 4095  */
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:17   
      498    17671    4            ELSE
      499    17672    4               KL$DREC.LNK.HOC = J;
      500    17673                                                              /**/
      501    17674    4            SELECT( %LINK_DEST_VAL ) ;
      502    17675
      503    17676    4            BLK$ = PTR$ -> P$NODE.SUBLK$(0);
      504    17677    4            CNT = OUT$SYM.COUNT;
      505    17678    5            IF CNT > 14 THEN DO;
      506    17679        /*E*  ERROR:  ASA-E$BAD_DEST-C
      507    17680              MESSAGE: DESTINATION can be at most 14 decimal digits.
      508    17681        */
      509    17682                    %SCREAM( ERR#=E$BAD_DEST, LEVEL=ERROR, MID='A' );
      510    17697    5               END;  /*  Dest value > 14 characters  */
      511    17698    5            ELSE DO;
      512    17699    5               ADRN = '0'B;
      513    17700    5               K = CNT / 2 - 1;
      514    17701    5               ADRN.LNG# = CNT ;
      515    17702    5               J = MOD( CNT, 2 ) ;
      516    17703    5               IF J = 1 THEN
      517    17704    6               DO;
      518    17705    6                  CALL CHARBIN( J, SUBSTR(OUT$SYM.TEXT,CNT-1,1)) ;
      519    17706    6                  ADRN.ADR.BCD1#(K+1) = J ;
      520    17707    6                  END;   /*  Odd length on dest  */
      521    17708    6               DO J = 0 TO K;
      522    17709    6                  CALL CHARBIN( CNT, SUBSTR(OUT$SYM.TEXT,J*2,1) );
      523    17710    6                  ADRN.ADR.BCD1#(J) = CNT;
      524    17711    6                  CALL CHARBIN( CNT, SUBSTR(OUT$SYM.TEXT,J*2+1,1) );
      525    17712    6                  ADRN.ADR.BCD2#(J) = CNT;
      526    17713    6                  END;   /*  Transfer node text to temp storage  */
      527    17714    5               KL$DREC.LNK.DEST = ADRN ;
      528    17715    5               LINK_DEST_SET = AS_TRUE;
      529    17716    5               END;   /*  Destination < 14 characters  */
      530    17717                                                              /**/
      531    17718    4            SELECT( %VC_DEST_VAL );
      532    17719
      533    17720    4            IF PTR$ -> P$NODE.SUBNODES = 0 THEN
      534    17721    4               KL$LNKVC.NODE# = 254;
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:18   
      535    17722    5            ELSE DO;  /*  There is a subnode  */
      536    17723    5               BLK$ = PTR$ -> P$NODE.SUBLK$(0) ;
      537    17724    5               IF BLK$->P$NODE.CODE = %VC_IS_NODE_VAL THEN
      538    17725    5                  KL$LNKVC.NODE# = 253;
      539    17726    6               ELSE DO;  /*  Node is a symbol  */
      540    17727    6                  CNT = OUT$SYM.COUNT ;
      541    17728    6                  KL$LNKVC.DST# = OUT$SYM.TEXT ;
      542    17729    6                  FPT_NODEINFO.V.NODENAME# = KL$LNKVC.DST#;
      543    17730    6                  CALL M$NODEINFO(FPT_NODEINFO)
      544    17731    7                  WHENRETURN DO;
      545    17732    7                     KL$LNKVC.NODE# = VLR_NODEINFO.NODENUM#;
      546    17733    7                     END;  /*  Whenreturn from M$NODEINFO  */
      547    17734    7                  WHENALTRETURN DO;
      548    17735                          %SCREAM(ERR#=E$VC_DESTUD, LEVEL=ERROR, MID='A' );
      549    17750        /*E* ERROR: ASA-E$VC_DESTUD-4
      550    17751             MESSAGE: Destination node is not defined.
      551    17752        */
      552    17753    7                     KL$LNKVC.DST# = ' ';
      553    17754    7                     END;  /*  Whenaltreturn from M$NODEINFO  */
      554    17755    6                  END;  /*  Code = symbol  */
      555    17756    5               END;  /*  There is a subnode  */
      556    17757
      557    17758    4            SELECT( %VC_CUG_VAL ) ;
      558    17759    4            BLK$ = PTR$ -> P$NODE.SUBLK$(0) ;
      559    17760    4            CNT = OUT$SYM.COUNT ;
      560    17761    4            IF OUT$SYM.CODE = %NONE_VAL THEN
      561    17762    4               KL$LNKVC.CUG.LNG# = 0;
      562    17763    5            ELSE DO;
      563    17764    6               IF CNT > 4 THEN DO ;
      564    17765        /*E* ERROR:  ASA-E$VC_CUG-C
      565    17766             MESSAGE: CUG can be at most 4 decimal digits.
      566    17767        */
      567    17768                       %SCREAM( ERR#=E$VC_CUG, LEVEL=ERROR, MID='A') ;
      568    17783    6                  END ; /*  Cnt > 4  */
      569    17784    6               ELSE DO;
      570    17785    6                  TEMP_STR = '0000';
      571    17786    6                  DISP = 4 - OUT$SYM.COUNT;
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:19   
      572    17787    6                  SUBSTR (TEMP_STR,DISP,CNT) = OUT$SYM.TEXT;
      573    17788    7                  DO I = 0 TO 3;
      574    17789    7                     CALL CHARBIN( J, SUBSTR(TEMP_STR,I,1)) ;
      575    17790
      576    17791    8                     DO SELECT (I);
      577    17792
      578    17793    8                        SELECT (0);
      579    17794
      580    17795    8                        KL$LNKVC.CUG.BCD1# = J ;
      581    17796
      582    17797    8                        SELECT (1);
      583    17798
      584    17799    8                        KL$LNKVC.CUG.BCD2# = J ;
      585    17800
      586    17801    8                        SELECT (2);
      587    17802
      588    17803    8                        KL$LNKVC.CUG.BCD3# = J ;
      589    17804
      590    17805    8                        SELECT (3);
      591    17806
      592    17807    8                        KL$LNKVC.CUG.BCD4# = J ;
      593    17808
      594    17809    8                        END; /*  Case i  */
      595    17810    7                     END; /*  Do i  */
      596    17811
      597    17812    7                  DO SELECT (CNT);
      598    17813
      599    17814    7                     SELECT (0) ;
      600    17815    7                     KL$LNKVC.CUG.LNG# = 0;
      601    17816
      602    17817    7                     SELECT (1,2) ;
      603    17818    7                     KL$LNKVC.CUG.LNG# = 1;
      604    17819
      605    17820    7                     SELECT (3,4) ;
      606    17821    7                     KL$LNKVC.CUG.LNG# = 2;
      607    17822
      608    17823    7                     END; /*  Do case (cnt)  */
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:20   
      609    17824    6                  END ; /*  Cnt <= 4  */
      610    17825    5               END; /* If OUT$SYM.TEXT ~= 'NONE' */
      611    17826
      612    17827    4            SELECT( %VC_QOS_VAL, %LINK_QOS_VAL ) ;
      613    17828    4            BLK$ = PTR$ -> P$NODE.SUBLK$(0) ;
      614    17829    4            CALL CHARBIN( CNT, OUT$SYM.TEXT) ;
      615    17830    5            IF CNT < 2 OR CNT > 255 THEN DO;
      616    17831        /*E* ERROR: ASA-E$QOS_OUT_OF_RANGE-0
      617    17832             MESSAGE:  QOS must be between 2 and 255, inclusive.
      618    17833        */
      619    17834                    %SCREAM (ERR#=%E$QOS_OUT_OF_RANGE, LEVEL=ERROR, MID='A');
      620    17849    5               GOTO LOOP_END;
      621    17850    5               END; /*  Qos out of range  */
      622    17851    4            IF LINK THEN
      623    17852    4               KL$DREC.LNK.QOS# = CNT ;
      624    17853    4            ELSE
      625    17854    4               KL$LNKVC.QOS# = CNT ;
      626    17855                                                              /**/
      627    17856    4            BLK$ = PTR$ -> P$NODE.SUBLK$(0) ;
      628    17857    4            CALL CHARBIN( CNT, OUT$SYM.TEXT) ;
      629    17858    4            KL$LNKVC.QOS# = CNT ;
      630    17859
      631    17860    4            SELECT ( %VC_PERM_VAL);
      632    17861    4            IF PTR$->P$NODE.SUBLK$(0)->P$NODE.CODE = NO_VAL THEN
      633    17862    4               KL$LNKVC.PERMANENT = '0'B;
      634    17863    4            ELSE
      635    17864    4               KL$LNKVC.PERMANENT = '1'B;
      636    17865
      637    17866    4            SELECT ( %LINK_DEV_CIRCUITS_VAL);
      638    17867    4            BLK$ = PTR$ -> P$NODE.SUBLK$(0);
      639    17868    4            CALL CHARBIN (CNT, OUT$SYM.TEXT);
      640    17869    4            IF CNT > 4095 THEN
      641    17870        /*E* ERROR: ASA-E$CIRCUITS_OUT_OF_RANGE-C
      642    17871             MESSAGE: CIRCUITS must be between 0 and 4095, inclusive.
      643    17872        */
      644    17873                    %SCREAM (ERR#=%E$CIRCUITS_OUT_OF_RANGE, LEVEL=ERROR, MID='A');
      645    17888    4            ELSE
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:21   
      646    17889    4               KL$LINKDEV.CIRCUITS# = CNT;
      647    17890
      648    17891    4            SELECT ( %LINK_DEV_PROTOCOL_VAL);
      649    17892    4            BLK$ = PTR$ -> P$NODE.SUBLK$(0);
      650    17893    5            IF OUT$SYM.NDTYPE ~= %DEC# THEN DO;
      651    17894    5               BLK$ = PTR$ -> P$NODE.SUBLK$(0);
      652    17895    5               CALL ASD$HEX2OCT(OUT$SYM, CNT);
      653    17896    5               END;
      654    17897    4            ELSE
      655    17898    4               CALL CHARBIN (CNT, OUT$SYM.TEXT);
      656    17899    4            IF CNT > 255 THEN
      657    17900        /*E* ERROR: ASA-E$PROTOCOL_OUT_OF_RANGE-C
      658    17901             MESSAGE:  PROTOCOL must be between 0 and 255, inclusive.
      659    17902        */
      660    17903                    %SCREAM (ERR#=E$PROTOCOL_OUT_OF_RANGE,LEVEL=ERROR,MID='A');
      661    17918    4            ELSE
      662    17919    4               KL$LINKDEV.PROTOCOL# = CNT;
      663    17920
      664    17921    4            SELECT ( %LINK_DEV_SUBADDR_VAL);
      665    17922    4            BLK$ = PTR$ -> P$NODE.SUBLK$(0);
      666    17923    4            CALL CHARBIN (CNT, OUT$SYM.TEXT);
      667    17924    4            IF CNT > 99 THEN
      668    17925        /*E* ERROR: ASA-E$SUBADDR_OUT_OF_RANGE-C
      669    17926             MESSAGE:  SUBADDRESS must be between 0 and 99, inclusive.
      670    17927        */
      671    17928                    %SCREAM (ERR#=E$SUBADDR_OUT_OF_RANGE,LEVEL=ERROR,MID='A');
      672    17943    4            ELSE
      673    17944    4               KL$LINKDEV.SUBADDR# = CNT;
      674    17945
      675    17946    4            SELECT ( %LINK_DEV_MODE_VAL ) ;
      676    17947    4            BLK$ = PTR$ -> P$NODE.SUBLK$(0) ;
      677    17948    4            KL$LINKDEV.MODE = BLK$ -> P$NODE.CODE;
      678    17949
      679    17950    4            SELECT( END_VAL, BLANK_LINE_VAL );
      680    17951    4            MORE = '0'B;
      681    17952
      682    17953    4            SELECT( HELP_VAL ) ;
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:22   
      683    17954    4            CALL ASH$HELP ;
      684    17955                                                              /**/
      685    17956    4            SELECT( QUESTION_VAL ) ;
      686    17957    4            CALL ASH$QUEST ;
      687    17958                                                              /**/
      688    17959    4            SELECT( DQUESTION_VAL ) ;
      689    17960    4            CALL ASH$DQUEST ;
      690    17961                                                              /**/
      691    17962    4            END ; /* Do case( code ) */
      692    17963    3   LOOP_END:
      693    17964    3         END ; /* Do i */
      694    17965    2      END ; /* Do while */
      695    17966    2   IF LINK THEN DO ;
      696    17967    3      IF KL$DREC.LNK.HIC < KL$DREC.LNK.LIC THEN DO;
      697    17968        /*E*  ERROR:  ASA-E$LIC_HIC-0
      698    17969              MESSAGE: Invalid LIC or invalid HIC.
      699    17970              MESSAGE1: The lowest incoming channel must be less than or
      700    17971                       equal to the highest incoming channel.
      701    17972        */
      702    17973              %SCREAM (ERR#=%E$LIC_HIC, LEVEL=ERROR, MID='A');
      703    17988    3         GOTO LINK_LOOP;
      704    17989    3         END;
      705    17990    3      IF KL$DREC.LNK.HOC < KL$DREC.LNK.LOC THEN DO;
      706    17991        /*E*  ERROR:  ASA-E$LOC_HOC-0
      707    17992              MESSAGE: Invalid LOC or invalid HOC.
      708    17993              MESSAGE1: The lowest outgoing channel must be less than or
      709    17994                       equal to the highest outgoing channel.
      710    17995        */
      711    17996              %SCREAM (ERR#=%E$LOC_HOC, LEVEL=ERROR, MID='A');
      712    18011    3         GOTO LINK_LOOP;
      713    18012    3         END;
      714    18013    2      END;
      715    18014    2   IF KL$DREC.PNAME.TXT=' ' THEN DO;
      716    18015        /*E* ERROR: ASA-E$LINKPRODFLT-0
      717    18016             MESSAGE: No profile specified, using $LINK, the default.
      718    18017        */
      719    18018           %SCREAM( ERR#=E$LINKPRODFLT, LEVEL=WARN, MID='A' ) ;
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:23   
      720    18033    2      KL$DREC.PNAME.TXT = '$LINK';
      721    18034    2      KL$DREC.PNAME.CNT = 5;
      722    18035    2      END;
      723    18036    2   IF VIRCIR THEN DO ;
      724    18037    3      IF KL$LNKVC.PRONM.TXT = ' ' THEN DO ;
      725    18038    4         IF KL$DREC.LNK.DFLTVCPRO.TXT = ' ' THEN DO;
      726    18039        /*E* ERROR: ASA-E$VIRCIRPRODFLT-0
      727    18040             MESSAGE: No profile specified, using $VIRCIR, the default.
      728    18041        */
      729    18042                 %SCREAM( ERR#=E$VIRCIRPRODFLT, LEVEL=WARN, MID='A' ) ;
      730    18057    4            KL$LNKVC.PRONM.TXT = '$VIRCIR';
      731    18058    4            KL$LNKVC.PRONM.CNT = 7;
      732    18059    4            END;
      733    18060    4         ELSE DO;
      734    18061    4            KL$LNKVC.PRONM.TXT = KL$DREC.LNK.DFLTVCPRO.TXT;
      735    18062    4            KL$LNKVC.PRONM.CNT = KL$DREC.LNK.DFLTVCPRO.CNT;
      736    18063    4            END;
      737    18064    3         END ;  /*  Default vircir profile  */
      738    18065    3      IF NOT VC_ADDR_SET AND NOT KL$LNKVC.PERMANENT AND CREATE THEN DO;
      739    18066        /*E* ERROR: ASA-E$NEEDADDR-0
      740    18067             MESSAGE: An address must be specified for a non-permanent vircir.
      741    18068        */
      742    18069              %SCREAM( ERR#=E$NEEDADDR, LEVEL=ERROR, MID='A' ) ;
      743    18084    3         GOTO LINK_LOOP;
      744    18085    3         END;   /*  Need an address for a non permanent vc  */
      745    18086
      746    18087    2      IF KL$LNKVC.DST# = ' ' THEN
      747    18088    2         KL$LNKVC.NODE# = 255;
      748    18089    3      IF NOT FOUND THEN DO;
      749    18090    3         KL$DREC.LNK.BLKHDR.NSUBS = KL$DREC.LNK.BLKHDR.NSUBS + 1;
      750    18091    3         PTR$ = DEV$;
      751    18092    3         DEV_SIZEW = DEV_SIZEW + SIZEW(KL_LNKVC);
      752    18093    3         END;
      753    18094    2      SIZE = POFFC (DEV_STOP$,DSEG1$)+SIZEW(KL_LNKVC);
      754    18095    3      IF SIZE > DSEG1SIZE THEN DO;
      755    18096    3         SIZE = (SIZE + 4095) / 4096;
      756    18097    3         CALL ASB$GET_MORE_SEG(1,SIZE) ALTRET(GETSEG_ERR);
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:24   
      757    18098    3         END;
      758    18099    2      DEV$->KL$LNKVC = KL$LNKVC;
      759    18100    2      END ;
      760    18101                                                              /* Output term rec */
      761    18102    2   IF LINKDEV THEN DO ;
      762    18103    2      ARS = DSEG2SIZE;
      763    18104    2      USERS_KEY.COUNT = 9;
      764    18105    2      CALL CONCAT ( USERS_KEY.TXTC, KL$LINKDEV.LOGON#, '*');
      765    18106    2      CALL ASB$READ_HLP ( DSEG2$, ARS, 2 )
      766    18107    3      WHENRETURN DO;
      767    18108    4         IF RES$DEV.RES_DEV.MODE ~= KL$LINKDEV.MODE THEN DO;
      768    18109        /*E*   ERROR: ASA-E$MODES_NO_MATCH-C
      769    18110               MESSAGE:  Modes do not match.
      770    18111               MESSAGE1:  This link devices mode does not match with the CL
      771    18112                          type devices mode.
      772    18113        */
      773    18114                 %SCREAM (ERR#=%E$MODES_NO_MATCH, LEVEL=WARN, MID='A');
      774    18129    4            END;  /*  ~ =  */
      775    18130    3         END;  /*  Whenreturn  */
      776    18131    3      WHENALTRETURN DO;
      777    18132    3         END; /*  Whenaltreturn  */
      778    18133    3      IF NOT FOUND THEN DO;
      779    18134    3         KL$DREC.LNK.BLKHDR.NSUBS = KL$DREC.LNK.BLKHDR.NSUBS + 1;
      780    18135    3         PTR$ = DEV$;
      781    18136    3         DEV_SIZEW = DEV_SIZEW + SIZEW(KL_LINKDEV);
      782    18137    3         END;  /*  Not found  */
      783    18138    2      SIZE = POFFC(DEV_STOP$,DSEG1$)+SIZEW(KL_LINKDEV);
      784    18139    3      IF SIZE > DSEG1SIZE THEN DO;
      785    18140    3         SIZE = (SIZE + 4095) / 4096;
      786    18141    3         CALL ASB$GET_MORE_SEG(1,SIZE) ALTRET(GETSEG_ERR);
      787    18142    3         END;  /*  Size > DSEG1SIZE  */
      788    18143    2      DEV$->KL$LINKDEV = KL$LINKDEV;
      789    18144    2      END;  /*  Linkdev  */
      790    18145    1   IF NOT LINK THEN
      791    18146    1      KL$DREC.NWINFO = LINK_DREC.NWINFO + SIZEW(LINK_DREC.LNK) + DEV_SIZEW;
      792    18147    1   ELSE IF CREATE THEN
      793    18148    1         KL$DREC.NWINFO = SIZEW(LINK_DREC.LNK) ;
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:25   
      794    18149    1   ARS = LENGTHC(KL_DREC_CNT) + ( KL$DREC.NWINFO * 4 ) ;
      795    18150    1   USERS_KEY = LINK_KEY ;
      796    18151    1   CALL ASB$WRITE_HLP( DSEG1$, ARS )
      797    18152    2   WHENALTRETURN DO;
      798    18153    2      CALL ASH$ERROR (ERR_CODE);
      799    18154    2      GOTO EXIT#;
      800    18155    2      END; /*  Whenaltreturn  */
      801    18156    2   IF CREATE THEN DO;
      802    18157    2      KL_TERM_REC = '0'B;
      803    18158    2      KL_TERM_KEY.TERMID.TERM.TERM_NAME = LINK_NAME.TEXT;
      804    18159    2      CALL ASB$WRITE_NETCON(VECTOR(KL_TERM_KEY),VECTOR(KL_TERM_REC)) ALTRET(NETCON_ERR)
             18159               ;
      805    18160    2      CALL ASB$CLOSE_NETCON;
      806    18161    2      END; /* If create */
      807    18162    2   ELSE DO;
      808    18163    2      KL_TERM_KEY.TERMID.TERM.TERM_NAME = LINK_NAME.TEXT;
      809    18164    2      CALL ASB$READ_NETCON(VECTOR(KL_TERM_KEY),VECTOR(KL_TERM_REC))
      810    18165    3      WHENALTRETURN DO;
      811    18166    3         IF (MERR_CODE.CODE = %E$NOKEY)
      812    18167    4         THEN DO;
      813    18168    4            KL_TERM_REC = '0'B;
      814    18169    4            KL_TERM_KEY.TERMID.TERM.TERM_NAME = LINK_NAME.TEXT;
      815    18170    4            CALL ASB$WRITE_NETCON(VECTOR(KL_TERM_KEY),VECTOR(KL_TERM_REC)) ALTRET(
             18170                     NETCON_ERR);
      816    18171    4            END;
      817    18172    4         ELSE DO;
      818    18173    4            GOTO NETCON_ERR;
      819    18174    4            END;
      820    18175    3         END;
      821    18176    2      CALL ASB$CLOSE_NETCON;
      822    18177    2      END;
      823    18178    1   EXIT#:
      824    18179    1   CALL ASB$DEQ_HLP;
      825    18180    1   RETURN ;
      826    18181                                                              /* Errors */
      827    18182    1   GETSEG_ERR: ;
      828    18183        %SCREAM( ERR#=%E$GETSEGERR, LEVEL=ERROR, MID='A') ;
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:26   
      829    18198    1   GOTO EXIT#;
      830    18199                                                              /**/
      831    18200    1   NETCON_ERR:;
      832    18201    1   ERR_CODE = B$TCB$->B$TCB.ALT$->B$ALT.ERR;
      833    18202    1   CALL ASH$ERROR(ERR_CODE);
      834    18203    1   RETURN;
      835    18204                                                              /**/
      836    18205        %EJECT;
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:27   
      837    18206    1   FIND_VIRCIR: PROC ALTRET;
      838    18207
      839    18208    2   DCL LINK$   PTR;
      840    18209    2   DCL 1 PRO$STRCT BASED,
      841    18210    2          2 TYPE  UBIN BYTE CALIGNED,
      842    18211    2          2 SIZE  UBIN BYTE CALIGNED;
      843    18212    2   DCL PRO_END$ PTR;
      844    18213        %KL_PHDR (NAME=PRO_HDR, STCLASS=CONSTANT);
      845    18254        %KL_LINK (NAME=KL$LINK, STCLASS=BASED);
      846    18350
      847    18351                                                          /* Get virtual circuit # */
      848    18352    2   BLK$ = P$NODE.SUBLK$(0);
      849    18353    3   IF VIRCIR THEN DO;
      850    18354    3      CALL CHARBIN( VIRCIR#, OUT$SYM.TEXT );
      851    18355    4      IF VIRCIR# > 4095 OR VIRCIR# < 1 THEN DO;
      852    18356        /*E*  ERROR:  AS-E$RNAMETOOBIG-C
      853    18357              MESSAGE: Illegal VIRTUAL CIRCUIT number.
      854    18358              MESSAGE1: A VIRTUAL CIRCUIT number must be between 1 and 4095.
      855    18359        */
      856    18360              %SCREAM( ERR#=E$RNAMETOOBIG, LEVEL=ERROR, MID='A' );
      857    18375    4         ALTRETURN;
      858    18376    4         END;  /* Vircir out of range  */
      859    18377    3      END;  /*  Vircir  */
      860    18378                                                     /* See if the virtual circuit exists.*/
      861    18379    2   DEV$ = DEV_START$;
      862    18380    2   DEV_STOP$ = PINCRW(DEV$, DEV_SIZEW) ;
      863    18381    2   FOUND = '0'B;
      864    18382    3   DO WHILE( DEV$ < DEV_STOP$ AND NOT FOUND );
      865    18383    4      IF DEV$->KL$LNKVC.BLKHDR.LEV = 2 THEN DO;  /*  We have a vir cir  */
      866    18384    4         IF DEV$ -> KL$LNKVC.VIRCIR# = VIRCIR# THEN
      867    18385    4            FOUND = AS_TRUE;
      868    18386    4         ELSE
      869    18387    4            DEV$ =  PINCRW( DEV$, SIZEW(KL_LNKVC));
      870    18388    4         END;  /*  Vir cir  */
      871    18389    4      IF DEV$->KL$LNKVC.BLKHDR.LEV = 3 THEN DO;  /*  We have a link dev */
      872    18390    4         IF DEV$ -> KL$LINKDEV.LOGON# = OUT$SYM.TEXT THEN
      873    18391    4            FOUND = AS_TRUE;
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:28   
      874    18392    4         ELSE
      875    18393    4            DEV$ =  PINCRW( DEV$, SIZEW(KL_LINKDEV));
      876    18394    4         END;  /*  Link dev  */
      877    18395    3      END;  /*  Do while not found  */
      878    18396
      879    18397    3   IF VIRCIR THEN DO;
      880    18398    4      IF FOUND THEN DO;
      881    18399    5         IF CREATE THEN DO;
      882    18400        /*E*  ERROR:  ASA-E$VIR_CIR_EXISTS-C
      883    18401              MESSAGE: Virtual Circuit %U1 already exists.
      884    18402              MESSAGE1: You cannot create a virtual circuit that already exists.
      885    18403        */
      886    18404    5            AS_FIELD1.COUNT = OUT$SYM.COUNT;
      887    18405    5            AS_FIELD1.TEXT  = OUT$SYM.TEXT;
      888    18406                 %SCREAM( ERR#=E$VIR_CIR_EXISTS, LEVEL=ERROR, MID='A' );
      889    18421    5            ALTRETURN;
      890    18422    5            END;  /*  Create  */
      891    18423    4         KL$LNKVC = DEV$ -> KL$LNKVC ;
      892    18424    4         END;   /*  Found  */
      893    18425    4      ELSE DO;  /*  Not found  */
      894    18426    5         IF NOT CREATE THEN DO;
      895    18427        /*E*  ERROR:  ASA-E$VIR_CIR_SWITCH-C
      896    18428              MESSAGE: Virtual circuit %U1 does not exist. Switching to CREATE mode.
      897    18429        */
      898    18430    5            AS_FIELD1.COUNT = OUT$SYM.COUNT;
      899    18431    5            AS_FIELD1.TEXT  = OUT$SYM.TEXT;
      900    18432                 %SCREAM( ERR#=E$VIR_CIR_SWITCH, LEVEL=WARN, MID='A' );
      901    18447    5            CREATE = AS_TRUE;
      902    18448    5            END;  /*  Not create  */
      903    18449    4         KL$LNKVC = KL_LNKVC;
      904    18450    4         KL$LNKVC.VIRCIR# = VIRCIR#;
      905    18451    4         KL$LNKVC.BLKHDR.LEV = 2;
      906    18452    4         KL$LNKVC.BLKHDR.NSUBS = 0;
      907    18453    4         KL$LNKVC.BLKHDR.DEVNUM = VIRCIR#;
      908    18454    4         LNG_CNT = LENGTHC( KL_LNKVC );
      909    18455    4         KL$UBWORD.NUM = 0;
      910    18456    4         KL$UBWORD.REPLACE.T = LNGTH.T;
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:29   
      911    18457    4         KL$UBWORD.REPLACE.B = LNGTH.B;
      912    18458    4         KL$LNKVC.BLKHDR.LEN.BYT(0) = KL$UBWORD.REPLACE.T;
      913    18459    4         KL$LNKVC.BLKHDR.LEN.BYT(1) = KL$UBWORD.REPLACE.B;
      914    18460    4         KL$LNKVC.BLKHDR.BLKTYP = %KLTY_VIRCIR#;
      915    18461    4         KL$LNKVC.BLKHDR.USE = KLUS_VC#;
      916    18462    4         END ;   /*  Not found  */
      917    18463    3      END ;  /*  Vircir  */
      918    18464    3   ELSE DO;   /*  Link dev  */
      919    18465    4      IF FOUND THEN DO;
      920    18466    5         IF CREATE THEN DO;
      921    18467        /*E*  ERROR:  ASA-E$LINK_DEV_EXISTS-C
      922    18468              MESSAGE: Link device %U1 already exists.
      923    18469              MESSAGE1: You cannot create a link device that already exists.
      924    18470        */
      925    18471    5            AS_FIELD1.COUNT = OUT$SYM.COUNT;
      926    18472    5            AS_FIELD1.TEXT  = OUT$SYM.TEXT;
      927    18473                 %SCREAM( ERR#=E$LINK_DEV_EXISTS, LEVEL=ERROR, MID='A' );
      928    18488    5            ALTRETURN;
      929    18489    5            END;  /*  Create  */
      930    18490    4         KL$LINKDEV = DEV$ -> KL$LINKDEV ;
      931    18491    4         END;  /*  Found  */
      932    18492    4      ELSE DO;  /*  Not found  */
      933    18493    5         IF NOT CREATE THEN DO;
      934    18494        /*E*  ERROR:  ASA-E$LINK_DEV_SWITCH-C
      935    18495              MESSAGE: Virtual circuit %U1 does not exist. Switching to CREATE mode.
      936    18496        */
      937    18497    5            AS_FIELD1.COUNT = OUT$SYM.COUNT;
      938    18498    5            AS_FIELD1.TEXT  = OUT$SYM.TEXT;
      939    18499                 %SCREAM( ERR#=E$LINK_DEV_SWITCH, LEVEL=WARN, MID='A' );
      940    18514    5            CREATE = AS_TRUE;
      941    18515    5            END;  /*  Not create  */
      942    18516    4         KL$LINKDEV = KL_LINKDEV;
      943    18517    4         KL$LINKDEV.BLKHDR.LEV = 3;
      944    18518    4         KL$LINKDEV.BLKHDR.NSUBS = 0;
      945    18519    4         LNG_CNT = LENGTHC( KL_LINKDEV );
      946    18520    4         KL$UBWORD.NUM = 0;
      947    18521    4         KL$UBWORD.REPLACE.T = LNGTH.T;
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:30   
      948    18522    4         KL$UBWORD.REPLACE.B = LNGTH.B;
      949    18523    4         KL$LINKDEV.BLKHDR.LEN.BYT(0) = KL$UBWORD.REPLACE.T;
      950    18524    4         KL$LINKDEV.BLKHDR.LEN.BYT(1) = KL$UBWORD.REPLACE.B;
      951    18525    4         KL$LINKDEV.BLKHDR.BLKTYP = %KLTY_LINKDEV#;
      952    18526    4         KL$LINKDEV.BLKHDR.USE = KLUS_RES_DEV#;
      953    18527    4         KL$LINKDEV.LOGON# = OUT$SYM.TEXT;
      954    18528    4         END ;    /*  Not found  */
      955    18529    3      END ;  /*  Linkdev  */
      956    18530        /*
      957    18531           Check the links profile for existence and correct type.
      958    18532           Issue warning if either check fails.
      959    18533        */
      960    18534    2   PRO$ = ADDR (PRO_BUF);
      961    18535    2   ARS = LENGTHC (PRO_BUF);
      962    18536    2   CALL ASD$READ_PRO (KL$DREC.PNAME,KL$PHDR,ARS)
      963    18537    3   WHENALTRETURN DO;
      964    18538           %SCREAM (ERR#=%E$PROFILE_NO_EXIST,LEVEL=WARN,MID='A');
      965    18553    3      RETURN;
      966    18554    3      END; /*  Whenaltreturn  */
      967    18555    2   LINK$ = PINCRW (ADDR(KL$PHDR), SIZEW (PRO_HDR));
      968    18556    2   PRO_END$ = PINCRC (LINK$, ARS);
      969    18557    2   IF KL$PHDR.TTYP ~= %KLTY_LINK# THEN
      970    18558    3   DO;
      971    18559           %SCREAM (ERR#=E$BADPROTYPE,LEVEL=WARN,MID='A');
      972    18574    3      RETURN;
      973    18575    3      END;
      974    18576    2   RETURN;
      975    18577
      976    18578    2   END FIND_VIRCIR;
      977    18579
      978    18580    1   END   ASA$LINK_VIRCIR ;

PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:31   
--  Include file information  --

   XU_SUBS_C.:E05TOU  is referenced.
   AS_SUPER_R.:E05TOU  cannot be made into a system file and is referenced.
   B_ERRORS_C.:E05TOU  is referenced.
   KL_SUPER_C.:E05TOU  is referenced.
   KL_CONFIG_M.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   AS_PERR_C.:E05TOU  is referenced.
   AS_SSUBS_C.:E05TOU  is referenced.
   AS_SUBS_C.:E05TOU  is referenced.
   XU_FORMAT_C.:E05TOU  is referenced.
   XU_MACRO_C.:E05TOU  is referenced.
   AS_SUPER_C.:E05TOU  is referenced.
   AS_MAC_C.:E05TOU  cannot be made into a system file and is referenced.
   B$TABLES_C.:E05TOU  cannot be made into a system file and is referenced.
   AS_ENTRIES_M.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure ASA$LINK_VIRCIR.

   Procedure ASA$LINK_VIRCIR requires 1743 words for executable code.
   Procedure ASA$LINK_VIRCIR requires 312 words of local(AUTO) storage.

    No errors detected in file ASA$LINK_VIRCIR.:E05TSI    .

PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:32   

 Object Unit name= ASA$LINK_VIRCIR                            File name= ASA$LINK_VIRCIR.:E05TOU
 UTS= JUL 29 '97 08:40:38.16 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   DCB   even  none     0      0  M$LO
    2   Data  even  none    34     42  ASA$LINK_VIRCIR
    3  RoData even  UTS    102    146  ASA$LINK_VIRCIR
    4   Proc  even  none  1743   3317  ASA$LINK_VIRCIR
    5  RoData even  none    61     75  ASA$LINK_VIRCIR

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     4      0   yes            yes      Std        0  ASA$LINK_VIRCIR
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:33   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes          ~proc      0 B_POINTER
 yes     yes           Std       2 ASD$HEX2OCT
         yes          ~proc      0 XU_OUTPUT_OPTIONS
         yes           Std       2 ASB$READ_SI
 yes     yes           Std       2 ASB$WRITE_HLP
 yes     yes           Std       1 X$PARSE
         yes           Std       2 ASH$ERROR
 yes     yes           Std       0 ASB$ENQ_HLP
 yes     yes           Std       3 ASB$READ_HLP
 yes     yes           Std       3 ASD$READ_PRO
         yes           Std       3 ASA$ERROR
         yes           Std       0 ASH$HELP
         yes           Std       0 ASH$QUEST
 yes     yes           Std       3 ASB$WRITE_NETCON
 yes     yes           Std       3 ASB$READ_NETCON
 yes     yes           Std       2 ASB$GET_MORE_SEG
 yes     yes           Std       0 ASB$GETSEG
         yes           Std       2 ASH$WARN
 yes     yes           Std       3 ASB$SET_PROMPT
 yes     yes           Std       0 ASB$DEQ_HLP
         yes           Std       0 ASH$DQUEST
 yes     yes           Std       5 ASB$CHECK_TYPE
 yes     yes           Std       0 ASB$CLOSE_NETCON
                       nStd      0 X66_AUTO_0
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:34   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                             r    AS_TRUE                          r    AS_FALSE
r    AS_MODE                          r    AS_FE_MODE                            M$LO
     USERS_KEY                             BLANK_PASS                            IN_BUF
     NODE$                                 CODE                                  ERR_CODE
     AS_FIELD1                             REMEM_VAR                             REM_FCMD
     ASA_BRKS_LOC                          DSEG_FLG                              DSEG1$
     DSEG1SIZE                             DSEG2$                                DSEG2SIZE
     DSEG3$                                P_PCB                                 KL_DREC_CNT
     LINK_CMD                              LINK_OPTS_LIST                        VIR_CIR_CMD
     VIR_CIR_OPTS_LIST                     LINK_DEV_CMD                          LINK_DEV_OPTS_LIST
     B$TCB$                           r    B$XL_UPPER_UR$                        B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:35   


        1        1        /*M* ASA$LINK_VIRCIR - Processes the LINK opts and cmd. */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X*  DMC,DMR,CCC,PLM=0,IND=3,CTI=5,DCI=6,IAD=0,DTI=0,IDT=0,ENI=3,
        8        8              ECU=3,CSU=3,SDI=3                                           */
        9        9
       10       10        ASA$LINK_VIRCIR: PROC ;

     10  4 000000   000000 700200 xent  ASA$LINK_VI* TSX0  ! X66_AUTO_0
         4 000001   000470 000000                    ZERO    312,0

       11       11
       12       12
       13       13
       14       14        /*********************************************************************/
       15       15        /*   Include files   include files   include files   include files   */
       16       16        /*********************************************************************/
       17       17
       18       18        %INCLUDE  AS_ENTRIES_M   ;
       19     1068        %INCLUDE  B$TABLES_C     ;   /*  for profile name translations  */
       20     1176        %INCLUDE  AS_MAC_C       ;
       21     1256        %INCLUDE  AS_SUPER_C     ;
       22     1691        %INCLUDE  XU_MACRO_C     ;
       23     4797        %INCLUDE  XU_FORMAT_C    ;
       24     4959        %INCLUDE  AS_SUBS_C      ;
       25     6373        %INCLUDE  AS_SSUBS_C     ;
       26     6465        %INCLUDE  AS_PERR_C      ;
       27     7067        %INCLUDE  CP_6           ;
       28     7148        %INCLUDE  KL_CONFIG_M    ;
       29     7910        %INCLUDE  KL_SUPER_C     ;
       30    10812        %INCLUDE  B_ERRORS_C     ;
       31    11939        %INCLUDE  AS_SUPER_R     ;
       32    14955        %INCLUDE  XU_SUBS_C      ;
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:36   
       33    15047
       34    15048        %EJECT;
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:37   
       35    15049        /********************************************************************/
       36    15050        /*   Auto data       auto data       auto data       auto data       */
       37    15051        /*********************************************************************/
       38    15052
       39    15053    1   DCL SUBNDS SBIN WORD ;
       40    15054    1   DCL SUBS SBIN WORD ;
       41    15055    1   DCL PTR$ PTR ;
       42    15056    1   DCL CNT SBIN WORD ;
       43    15057    1   DCL I SBIN WORD ;
       44    15058    1   DCL J SBIN WORD ;
       45    15059    1   DCL K SBIN WORD ;
       46    15060    1   DCL ARS SBIN WORD ;
       47    15061    1   DCL MORE BIT(1) ;
       48    15062    1   DCL VIRCIR# SBIN WORD ;
       49    15063    1   DCL VIRCIR_INDEX SBIN WORD ;
       50    15064    1   DCL VIRCIR_EXISTS BIT(1) ;
       51    15065    1   DCL FOUND BIT(1) ;
       52    15066    1   DCL LINK BIT(1) ;
       53    15067    1   DCL VIRCIR BIT(1) ;
       54    15068    1   DCL LINKDEV BIT(1) ;
       55    15069    1   DCL BLK$ PTR ;
       56    15070    1   DCL PRO$ PTR ;
       57    15071    1   DCL DEV$ PTR;
       58    15072    1   DCL CREATE BIT(1) ;
       59    15073    1   DCL MOVE_SIZE SBIN WORD ;
       60    15074    1   DCL SIZE SBIN WORD ;
       61    15075    1   DCL DEV_START$ PTR ;
       62    15076    1   DCL DEV_STOP$ PTR ;
       63    15077    1   DCL DEV_SIZEW SBIN ;
       64    15078    1   DCL PRO_BUF CHAR(AS_PRO_BUF_SIZEC);
       65    15079    1   DCL 1 LINK_NAME,
       66    15080    1          2 COUNT UBIN BYTE UNAL,
       67    15081    1          2 TEXT CHAR(8) UNAL;
       68    15082    1   DCL TEMP_STR CHAR(4);
       69    15083    1   DCL DISP     UBIN;
       70    15084    1   DCL VC_ADDR_SET   BIT(1);
       71    15085    1   DCL LINK_DEST_SET BIT(1);
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:38   
       72    15086    1   DCL TEMP UBIN;
       73    15087    1   DCL PTR2$ PTR;
       74    15088    1   DCL PTR3$ PTR;
       75    15089    1   DCL XPNAME CHAR(11);
       76    15090        %EJECT ;
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:39   
       77    15091        /********************************************************************/
       78    15092        /*   Symref's        symref's        symref's        symref's        */
       79    15093        /*********************************************************************/
       80    15094
       81    15095    1   DCL LINK_CMD  SYMREF UBIN(36) ;
       82    15096    1   DCL LINK_OPTS_LIST SYMREF UBIN WORD ;
       83    15097    1   DCL VIR_CIR_CMD SYMREF UBIN WORD ;
       84    15098    1   DCL VIR_CIR_OPTS_LIST SYMREF UBIN WORD ;
       85    15099    1   DCL LINK_DEV_CMD SYMREF UBIN WORD ;
       86    15100    1   DCL LINK_DEV_OPTS_LIST SYMREF UBIN WORD ;
       87    15101    1   DCL B$TCB$ PTR SYMREF;
       88    15102        %B$XL_UPPER_UR;
       89    15106        %EJECT ;
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:40   
       90    15107        /********************************************************************/
       91    15108        /*   Static data     static data     static data     static data     */
       92    15109        /*********************************************************************/
       93    15110
       94    15111    1   DCL 1 LINK_KEY ALIGNED STATIC ,
       95    15112    1          2 CNT UBIN BYTE UNAL INIT( 9 ),
       96    15113    1          2 TXT UNAL ,
       97    15114    1             3 ACCT CHAR(8) UNAL INIT(' ') ,
       98    15115    1             3 ASTR CHAR(1) UNAL INIT('*') ;
       99    15116    1   DCL 1 ADRN ALIGNED STATIC,
      100    15117    1          2 LNG# UBIN BYTE UNAL ,
      101    15118    1          2 ADR (0:8) UNAL,
      102    15119    1             3 * UBIN(1) UNAL ,
      103    15120    1             3 BCD1# UBIN(4) UNAL ,
      104    15121    1             3 BCD2# UBIN(4) UNAL ;
      105    15122    1   DCL 1 ADRN18 ALIGNED STATIC,
      106    15123    1          2 LNG# UBIN BYTE UNAL ,
      107    15124    1          2 ADR (0:8) UNAL,
      108    15125    1             3 * UBIN(1) UNAL ,
      109    15126    1             3 BCD1# UBIN(4) UNAL ,
      110    15127    1             3 BCD2# UBIN(4) UNAL ;
      111    15128    1   DCL 1 LNGTH ALIGNED STATIC,
      112    15129    1          2 T UBIN(28) UNAL INIT(0),
      113    15130    1          2 B UBIN(8) UNAL INIT(0);
      114    15131    1   DCL LNG_CNT REDEF LNGTH UBIN;
      115    15132        %FPT_NODEINFO (NODEINFO=VLR_NODEINFO);
      116    15144        %VLR_NODEINFO;
      117    15159        %KL$TERM (NAME=KL_TERM_REC,STCLASS=STATIC);
      118    15208        %KL$TERM_KEY (NAME=KL_TERM_KEY,STCLASS=STATIC);
      119    15254
      120    15255        /*********************************************************************/
      121    15256        /*    Constant data     constant data     constant data              */
      122    15257        /*********************************************************************/
      123    15258        %KL_DREC( NAME = LINK_DREC,
      124    15259                  TYP = %KLAT_LNKLINE# ,
      125    15260                  SUPR = AS_LNK# ,
      126    15261                  STCLASS = CONSTANT ,
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:41   
      127    15262                  RNAME = ' ' ,
      128    15263                  PASS = ' ' ,
      129    15264                  WORG = ' ' ,
      130    15265                  LAST="," ) ;
      131    15378        %KL_LNK( NAME=LNK,
      132    15379                 LVL=2,
      133    15380                 STCLASS=CONSTANT,
      134    15381                 LAST=";");
      135    15605        %KL_LNKVC(
      136    15606                     LVL=1,
      137    15607                     STCLASS=CONSTANT);
      138    15831        %KL_LINKDEV (
      139    15832                     LVL=1,
      140    15833                     STCLASS=CONSTANT);
      141    16004
      142    16005        %PLIST ;
      143    16006        %EJECT ;
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:42   
      144    16007        /*********************************************************************/
      145    16008        /*   Local based     local based     local based     local based     */
      146    16009        /*********************************************************************/
      147    16010
      148    16011        %PARSE$OUT( NAME=P$NODE, STCLASS="BASED(NODE$)",
      149    16012                    NDTYPE=TYPE, NSUBLKS=SUBNODES) ;
      150    16057        %PARSE$SYM( NAME = OUT$SYM ,
      151    16058                    STCLASS="BASED(BLK$)") ;
      152    16096        %KL_DREC (NAME = KL$DREC ,
      153    16097                  LAST="," ,
      154    16098                  STCLASS="BASED( DSEG1$ )");
      155    16211        %KL_LNK( NAME=LNK,
      156    16212                 LVL=2,
      157    16213                 STCLASS=BASED,
      158    16214                 LAST=";");
      159    16438              %KL_DREC( NAME=RES$DEV, STCLASS="BASED( DSEG2$ )", LAST="," );
      160    16551              %KL_RES_CL_DEV( NAME=RES_DEV, STCLASS=STCLASS, LVL=2, LAST=";" );
      161    16611        %KL_LNKVC (NAME=KL$LNKVC,
      162    16612                     LVL=1,
      163    16613                     STCLASS="BASED(DSEG3$)" ) ;
      164    16837        %KL_LINKDEV (NAME=KL$LINKDEV,
      165    16838                     LVL=1,
      166    16839                     STCLASS="BASED(DSEG3$)" ) ;
      167    17010        %KL_PHDR (NAME = KL$PHDR ,
      168    17011                  STCLASS="BASED( PRO$ )") ;
      169    17052    1   DCL MOVE$TEMP CHAR(MOVE_SIZE) BASED ;
      170    17053        %KL$UBWORD( NAME=KL$UBWORD, STCLASS = AUTO);
      171    17063        %B$TCB;
      172    17066        %B$ALT;
      173    17074        %PLIST ;
      174    17075        %EJECT ;
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:43   
      175    17076        /********************************************************************/
      176    17077        /*   Entry dcls      entry dcls      entry dcls      entry dcls      */
      177    17078        /*********************************************************************/
      178    17079
      179    17080    1   DCL X$PARSE ENTRY(1) ALTRET ;
      180    17081        %ASB$FIND_NUM ;
      181    17084        %ASB$ENQ_HLP ;
      182    17087        %ASB$DEQ_HLP ;
      183    17090        %ASB$READ_HLP ;
      184    17093        %ASB$WRITE_HLP ;
      185    17096        %ASB$WRITE_LO ;
      186    17099        %ASB$GETSEG ;
      187    17102        %ASB$GET_MORE_SEG ;
      188    17105        %ASB$SET_PROMPT ;
      189    17108        %ASB$READ_SI ;
      190    17111        %ASD$READ_PRO ;
      191    17114        %ASH$ERROR ;
      192    17117        %ASH$WARN ;
      193    17120        %ASH$INFO ;
      194    17123        %ASZ$SCRAMBLE ;
      195    17126        %ASH$HELP ;
      196    17129        %ASH$QUEST ;
      197    17132        %ASH$DQUEST ;
      198    17135        %ASA$ERROR ;
      199    17138        %ASB$CHECK_TYPE ;
      200    17141        %ASB$READ_NETCON ;
      201    17144        %ASB$WRITE_NETCON ;
      202    17147        %ASB$CLOSE_NETCON ;
      203    17150        %ASD$HEX2OCT ;
      204    17153        %EJECT ;
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:44   
      205    17154        /********************************************************************/
      206    17155        /*   Procedure       procedure       procedure       procedure       */
      207    17156        /*********************************************************************/
      208    17157                                                              /**/
      209    17158        /*
      210    17159            ***            Begin procedure                    ***
      211    17160        */
      212    17161    1   VC_ADDR_SET = AS_FALSE;

  17161  4 000002   000000 236000 xsym               LDQ     AS_FALSE
         4 000003   400000 376003                    ANQ     -131072,DU
         4 000004   200441 756100                    STQ     VC_ADDR_SET,,AUTO

      213    17162    1   LINK_DEST_SET = AS_FALSE;

  17162  4 000005   200442 756100                    STQ     LINK_DEST_SET,,AUTO

      214    17163    1   LINK = (P$NODE.CODE = CR_MOD_LINK_VAL);

  17163  4 000006   400000 220003                    LDX0    -131072,DU
         4 000007   000000 470400 xsym               LDP0    NODE$
         4 000010   000000 721100                    LXL1    0,,PR0
         4 000011   000077 101003                    CMPX1   63,DU
         4 000012   000014 600000 4                  TZE     s:17163+6
         4 000013   000000 220003                    LDX0    0,DU
         4 000014   000000 636010                    EAQ     0,X0
         4 000015   200020 756100                    STQ     LINK,,AUTO

      215    17164    1   VIRCIR = (P$NODE.CODE = CR_MOD_VIR_CIR_VAL);

  17164  4 000016   400000 220003                    LDX0    -131072,DU
         4 000017   000067 101003                    CMPX1   55,DU
         4 000020   000022 600000 4                  TZE     s:17164+4
         4 000021   000000 220003                    LDX0    0,DU
         4 000022   000000 636010                    EAQ     0,X0
         4 000023   200021 756100                    STQ     VIRCIR,,AUTO

PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:45   
      216    17165    1   LINKDEV = (P$NODE.CODE = %CR_MOD_LINK_DEV_VAL);

  17165  4 000024   400000 220003                    LDX0    -131072,DU
         4 000025   000034 101003                    CMPX1   28,DU
         4 000026   000030 600000 4                  TZE     s:17165+4
         4 000027   000000 220003                    LDX0    0,DU
         4 000030   000000 636010                    EAQ     0,X0
         4 000031   200022 756100                    STQ     LINKDEV,,AUTO

      217    17166    1   IF LINK THEN

  17166  4 000032   200020 234100                    SZN     LINK,,AUTO
         4 000033   000037 605000 4                  TPL     s:17168

      218    17167    1      P_PCB.ROOT$ = ADDR( LINK_CMD ) ;

  17167  4 000034   000000 236000 5                  LDQ     0
         4 000035   000001 756000 xsym               STQ     P_PCB+1
         4 000036   000050 710000 4                  TRA     s:17172

      219    17168    1   ELSE IF VIRCIR THEN

  17168  4 000037   200021 234100                    SZN     VIRCIR,,AUTO
         4 000040   000044 605000 4                  TPL     s:17170

      220    17169    1         P_PCB.ROOT$ = ADDR( VIR_CIR_CMD ) ;

  17169  4 000041   000001 236000 5                  LDQ     1
         4 000042   000001 756000 xsym               STQ     P_PCB+1
         4 000043   000050 710000 4                  TRA     s:17172

      221    17170    1      ELSE IF LINKDEV THEN

  17170  4 000044   200022 234100                    SZN     LINKDEV,,AUTO
         4 000045   000050 605000 4                  TPL     s:17172

      222    17171    1            P_PCB.ROOT$ = ADDR( LINK_DEV_CMD ) ;
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:46   

  17171  4 000046   000002 236000 5                  LDQ     2
         4 000047   000001 756000 xsym               STQ     P_PCB+1

      223    17172    1   CALL X$PARSE( P_PCB )

  17172  4 000050   000003 630400 5                  EPPR0   3
         4 000051   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 000052   000000 701000 xent               TSX1    X$PARSE
         4 000053   000055 702000 4                  TSX2    s:17174
         4 000054   000062 710000 4                  TRA     s:17178

      224    17173    2   WHENALTRETURN DO;

      225    17174    2      CALL ASH$ERROR (P_PCB.ERROR);

  17174  4 000055   000004 630400 5                  EPPR0   4
         4 000056   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 000057   000000 701000 xent               TSX1    ASH$ERROR
         4 000060   000000 011000                    NOP     0

      226    17175    2      RETURN;

  17175  4 000061   000000 702200 xent               TSX2  ! X66_ARET

      227    17176    2      END; /*  Whenaltreturn  */
      228    17177                                                              /**/
      229    17178    1   NODE$ = P_PCB.OUT$ ;

  17178  4 000062   000003 236000 xsym               LDQ     P_PCB+3
         4 000063   000000 756000 xsym               STQ     NODE$

      230    17179                                                              /**/
      231    17180    1   CREATE = ( P$NODE.CODE = CR_DEVICE_VAL );

  17180  4 000064   400000 220003                    LDX0    -131072,DU
         4 000065   000000 470400 xsym               LDP0    NODE$
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:47   
         4 000066   000000 721100                    LXL1    0,,PR0
         4 000067   000046 101003                    CMPX1   38,DU
         4 000070   000072 600000 4                  TZE     s:17180+6
         4 000071   000000 220003                    LDX0    0,DU
         4 000072   000000 636010                    EAQ     0,X0
         4 000073   200026 756100                    STQ     CREATE,,AUTO

      232    17181                                                              /**/
      233    17182    1   IF NOT DSEG_FLG THEN CALL ASB$GETSEG ALTRET( GETSEG_ERR );

  17182  4 000074   000000 234000 xsym               SZN     DSEG_FLG
         4 000075   000101 604000 4                  TMI     s:17184

  17182  4 000076   000002 631400 xsym               EPPR1   B_VECTNIL+2
         4 000077   000000 701000 xent               TSX1    ASB$GETSEG
         4 000100   002631 702000 4                  TSX2    GETSEG_ERR

      234    17183                                                          /* Check existence of line */
      235    17184    1   IF LINK THEN

  17184  4 000101   200020 234100                    SZN     LINK,,AUTO
         4 000102   000107 605000 4                  TPL     s:17187

      236    17185    1      BLK$ = NODE$ -> P$NODE.SUBLK$(0) ;

  17185  4 000103   000000 470400 xsym               LDP0    NODE$
         4 000104   000003 236100                    LDQ     3,,PR0
         4 000105   200023 756100                    STQ     BLK$,,AUTO
         4 000106   000112 710000 4                  TRA     s:17188

      237    17186    1   ELSE
      238    17187    1      BLK$ = NODE$ -> P$NODE.SUBLK$(1) ;

  17187  4 000107   000000 470400 xsym               LDP0    NODE$
         4 000110   000004 236100                    LDQ     4,,PR0
         4 000111   200023 756100                    STQ     BLK$,,AUTO

PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:48   
      239    17188    2   IF OUT$SYM.COUNT > 8 THEN DO;

  17188  4 000112   200023 471500                    LDP1    BLK$,,AUTO
         4 000113   100004 236100                    LDQ     4,,PR1
         4 000114   777000 376003                    ANQ     -512,DU
         4 000115   011000 116003                    CMPQ    4608,DU
         4 000116   000124 602000 4                  TNC     s:17210

      240    17189        /*E*  ERROR:    ASA-E$NNAMETOOBIG-C
      241    17190              MESSAGE:  Link name too long.
      242    17191              MESSAGE1: Link names can be at most 8 characters.
      243    17192        */
      244    17193           %SCREAM( ERR#=E$NNAMETOOBIG, LEVEL=ERROR, MID='A' );

  17205  4 000117   000005 630400 5                  EPPR0   5
         4 000120   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 000121   000000 701000 xent               TSX1    ASH$ERROR
         4 000122   000000 011000                    NOP     0

      245    17208    2      RETURN ;

  17208  4 000123   000000 702200 xent               TSX2  ! X66_ARET

      246    17209    2      END ;    /* Then do */
      247    17210    1   LINK_NAME.COUNT = OUT$SYM.COUNT ;

  17210  4 000124   100004 236100                    LDQ     4,,PR1
         4 000125   200434 552140                    STBQ    LINK_NAME,'40'O,AUTO

      248    17211    1   LINK_NAME.TEXT  = OUT$SYM.TEXT ;

  17211  4 000126   100004 236100                    LDQ     4,,PR1
         4 000127   000033 772000                    QRL     27
         4 000130   000000 620006                    EAX0    0,QL
         4 000131   040100 100540                    MLR     fill='040'O
         4 000132   100004 200010                    ADSC9   4,,PR1                   cn=1,n=*X0
         4 000133   200434 200010                    ADSC9   LINK_NAME,,AUTO          cn=1,n=8
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:49   

      249    17212    1   LINK_KEY.TXT.ACCT = OUT$SYM.TEXT ;

  17212  4 000134   100004 236100                    LDQ     4,,PR1
         4 000135   000033 772000                    QRL     27
         4 000136   000000 620006                    EAX0    0,QL
         4 000137   040000 100540                    MLR     fill='040'O
         4 000140   100004 200010                    ADSC9   4,,PR1                   cn=1,n=*X0
         4 000141   000000 200010 2                  ADSC9   LINK_KEY                 cn=1,n=8

      250    17213    1   USERS_KEY = LINK_KEY ;

  17213  4 000142   000000 100400                    MLR     fill='000'O
         4 000143   000000 000012 2                  ADSC9   LINK_KEY                 cn=0,n=10
         4 000144   000000 000052 xsym               ADSC9   USERS_KEY                cn=0,n=42

      251    17214    1   CALL ASB$ENQ_HLP

  17214  4 000145   000002 631400 xsym               EPPR1   B_VECTNIL+2
         4 000146   000000 701000 xent               TSX1    ASB$ENQ_HLP
         4 000147   000151 702000 4                  TSX2    s:17216
         4 000150   000152 710000 4                  TRA     s:17218

      252    17215    2   WHENALTRETURN DO;

      253    17216    2      RETURN;

  17216  4 000151   000000 702200 xent               TSX2  ! X66_ARET

      254    17217    2      END; /*  Whenaltreturn  */
      255    17218    1   PTR$ = PINCRW (ADDR(KL$DREC.LNK),SIZEW(KL$DREC.LNK));

  17218  4 000152   000000 236000 xsym               LDQ     DSEG1$
         4 000153   000034 036003                    ADLQ    28,DU
         4 000154   200005 756100                    STQ     PTR$,,AUTO

      256    17219    1   PTR2$ = PINCRC (DSEG1$, DSEG1SIZE-SIZEC(KL_LNKVC));
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:50   

  17219  4 000155   000000 236000 xsym               LDQ     DSEG1SIZE
         4 000156   000020 736000                    QLS     16
         4 000157   000014 136003                    SBLQ    12,DU
         4 000160   000000 036000 xsym               ADLQ    DSEG1$
         4 000161   200444 756100                    STQ     PTR2$,,AUTO

      257    17220    2   DO WHILE PTR$ < PTR2$;

  17220  4 000162   200005 116100                    CMPQ    PTR$,,AUTO
         4 000163   000176 602000 4                  TNC     s:17224
         4 000164   000176 600000 4                  TZE     s:17224

      258    17221    2      PTR$->KL$LNKVC = '0'B;

  17221  4 000165   200005 470500                    LDP0    PTR$,,AUTO
         4 000166   000100 100400                    MLR     fill='000'O
         4 000167   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         4 000170   000000 000060                    ADSC9   0,,PR0                   cn=0,n=48

      259    17222    2      PTR$ = PINCRC (PTR$,SIZEC(KL_LNKVC));

  17222  4 000171   200005 236100                    LDQ     PTR$,,AUTO
         4 000172   000014 036003                    ADLQ    12,DU
         4 000173   200005 756100                    STQ     PTR$,,AUTO

      260    17223    2      END;  /*  While PTR$ < PTR2$  */

  17223  4 000174   200444 116100                    CMPQ    PTR2$,,AUTO
         4 000175   000165 602000 4                  TNC     s:17221

      261    17224    1   ARS = DSEG1SIZE ;

  17224  4 000176   000000 235000 xsym               LDA     DSEG1SIZE
         4 000177   200012 755100                    STA     ARS,,AUTO

      262    17225    1   CALL ASB$READ_HLP( DSEG1$, ARS, 1 )
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:51   

  17225  4 000200   000006 236000 5                  LDQ     6
         4 000201   200460 756100                    STQ     PRO_END$+4,,AUTO
         4 000202   200012 630500                    EPPR0   ARS,,AUTO
         4 000203   200457 450500                    STP0    PRO_END$+3,,AUTO
         4 000204   000007 236000 5                  LDQ     7
         4 000205   200456 756100                    STQ     PRO_END$+2,,AUTO
         4 000206   200456 630500                    EPPR0   PRO_END$+2,,AUTO
         4 000207   000021 631400 xsym               EPPR1   B_VECTNIL+17
         4 000210   000000 701000 xent               TSX1    ASB$READ_HLP
         4 000211   000256 702000 4                  TSX2    s:17253

      263    17226    2   WHENRETURN DO;

      264    17227    2      CALL ASB$CHECK_TYPE( DSEG1$, ARS, AS_LNK#, CREATE & LINK, LINK_NAME ) ALTRET(
             17227               EXIT#);

  17227  4 000212   200020 236100                    LDQ     LINK,,AUTO
         4 000213   400000 376003                    ANQ     -131072,DU
         4 000214   200456 756100                    STQ     PRO_END$+2,,AUTO
         4 000215   200026 236100                    LDQ     CREATE,,AUTO
         4 000216   400000 376003                    ANQ     -131072,DU
         4 000217   200456 376100                    ANQ     PRO_END$+2,,AUTO
         4 000220   200460 676100                    ERQ     PRO_END$+4,,AUTO
         4 000221   400000 376003                    ANQ     -131072,DU
         4 000222   200460 656100                    ERSQ    PRO_END$+4,,AUTO
         4 000223   200434 630500                    EPPR0   LINK_NAME,,AUTO
         4 000224   200466 450500                    STP0    PRO_END$+10,,AUTO
         4 000225   200460 631500                    EPPR1   PRO_END$+4,,AUTO
         4 000226   200465 451500                    STP1    PRO_END$+9,,AUTO
         4 000227   000010 236000 5                  LDQ     8
         4 000230   200464 756100                    STQ     PRO_END$+8,,AUTO
         4 000231   200012 633500                    EPPR3   ARS,,AUTO
         4 000232   200463 453500                    STP3    PRO_END$+7,,AUTO
         4 000233   000007 236000 5                  LDQ     7
         4 000234   200462 756100                    STQ     PRO_END$+6,,AUTO
         4 000235   200462 630500                    EPPR0   PRO_END$+6,,AUTO
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:52   
         4 000236   000023 631400 xsym               EPPR1   B_VECTNIL+19
         4 000237   000000 701000 xent               TSX1    ASB$CHECK_TYPE
         4 000240   002625 702000 4                  TSX2    EXIT#

      265    17228    3      IF LINK AND CREATE THEN DO;

  17228  4 000241   200020 234100                    SZN     LINK,,AUTO
         4 000242   000255 605000 4                  TPL     s:17249+1
         4 000243   200026 234100                    SZN     CREATE,,AUTO
         4 000244   000255 605000 4                  TPL     s:17249+1

      266    17229           /*E*  ERROR:    ASA-E$LINK_ALREADY_EXISTS-C
      267    17230                 MESSAGE: Link %%U1 %already exists.
      268    17231                 MESSAGE1: Cannot CREATE a link that already exists.
      269    17232           */
      270    17233    3         AS_FIELD1 = LINK_NAME;

  17233  4 000245   000000 100500                    MLR     fill='000'O
         4 000246   200434 000011                    ADSC9   LINK_NAME,,AUTO          cn=0,n=9
         4 000247   000000 000051 xsym               ADSC9   AS_FIELD1                cn=0,n=41

      271    17234              %SCREAM( ERR#=E$LINK_ALREADY_EXISTS, LEVEL=ERROR, MID='A') ;

  17246  4 000250   000011 630400 5                  EPPR0   9
         4 000251   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 000252   000000 701000 xent               TSX1    ASH$ERROR
         4 000253   000000 011000                    NOP     0

      272    17249    3         GOTO EXIT#;

  17249  4 000254   002625 710000 4                  TRA     EXIT#
         4 000255   000316 710000 4                  TRA     s:17305

      273    17250    3         END ; /* Link and create */
      274    17251    2      END; /*  Whenreturn  */
      275    17252    2   WHENALTRETURN DO;

PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:53   
      276    17253    3      IF MERR_CODE.CODE ~= %E$NOKEY THEN DO;

  17253  4 000256   000000 236000 xsym               LDQ     ERR_CODE
         4 000257   377770 376007                    ANQ     131064,DL
         4 000260   001020 116007                    CMPQ    528,DL
         4 000261   000267 600000 4                  TZE     s:17257

      277    17254    3         CALL ASA$ERROR( USERS_KEY, E$UNABLE_TO_READ_HLP );

  17254  4 000262   000013 630400 5                  EPPR0   11
         4 000263   000020 631400 xsym               EPPR1   B_VECTNIL+16
         4 000264   000000 701000 xent               TSX1    ASA$ERROR
         4 000265   000000 011000                    NOP     0

      278    17255    3         GOTO EXIT#;

  17255  4 000266   002625 710000 4                  TRA     EXIT#

      279    17256    3         END;  /*  Error = no key  */
      280    17257    3      IF LINK THEN DO;

  17257  4 000267   200020 234100                    SZN     LINK,,AUTO
         4 000270   000306 605000 4                  TPL     s:17285

      281    17258    4         IF NOT CREATE THEN DO;

  17258  4 000271   200026 234100                    SZN     CREATE,,AUTO
         4 000272   000316 604000 4                  TMI     s:17305

      282    17259           /*E*  ERROR:    ASA-E$LINK_NO_EXIST1-C
      283    17260                 MESSAGE: Link %%U1 %does not exist. Switching to CREATE mode.
      284    17261           */
      285    17262    4            AS_FIELD1 = LINK_NAME;

  17262  4 000273   000000 100500                    MLR     fill='000'O
         4 000274   200434 000011                    ADSC9   LINK_NAME,,AUTO          cn=0,n=9
         4 000275   000000 000051 xsym               ADSC9   AS_FIELD1                cn=0,n=41
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:54   

      286    17263                 %SCREAM( ERR#=E$LINK_NO_EXIST1, LEVEL=WARN, MID='A') ;

  17273  4 000276   000015 630400 5                  EPPR0   13
         4 000277   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 000300   000000 701000 xent               TSX1    ASH$WARN
         4 000301   000000 011000                    NOP     0

      287    17278    4            CREATE = AS_TRUE ;

  17278  4 000302   000000 236000 xsym               LDQ     AS_TRUE
         4 000303   400000 376003                    ANQ     -131072,DU
         4 000304   200026 756100                    STQ     CREATE,,AUTO

      288    17279    4            END;  /*  Not create  */

      289    17280    3         END;  /*  Link  */

  17280  4 000305   000316 710000 4                  TRA     s:17305

      290    17281    3      ELSE DO;

      291    17282           /*E*  ERROR:    ASA-E$LINK_NO_EXIST2-C
      292    17283                 MESSAGE1: Link %%U1 %does not exist.
      293    17284           */
      294    17285    3         AS_FIELD1 = LINK_NAME;

  17285  4 000306   000000 100500                    MLR     fill='000'O
         4 000307   200434 000011                    ADSC9   LINK_NAME,,AUTO          cn=0,n=9
         4 000310   000000 000051 xsym               ADSC9   AS_FIELD1                cn=0,n=41

      295    17286              %SCREAM( ERR#=E$LINK_NO_EXIST2, LEVEL=WARN, MID='A') ;

  17296  4 000311   000016 630400 5                  EPPR0   14
         4 000312   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 000313   000000 701000 xent               TSX1    ASH$WARN
         4 000314   000000 011000                    NOP     0
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:55   

      296    17301    3         GOTO EXIT#;

  17301  4 000315   002625 710000 4                  TRA     EXIT#

      297    17302    3         END;  /*  Not link  */
      298    17303    2      END; /*  Whenaltreturn  */
      299    17304                                                              /**/
      300    17305    2   IF NOT LINK THEN DO;

  17305  4 000316   200020 234100                    SZN     LINK,,AUTO
         4 000317   000342 604000 4                  TMI     s:17311

      301    17306    2      DEV_START$ = PINCRW(ADDR(KL$DREC.LNK), SIZEW(KL$DREC.LNK) );

  17306  4 000320   000000 236000 xsym               LDQ     DSEG1$
         4 000321   000034 036003                    ADLQ    28,DU
         4 000322   200031 756100                    STQ     DEV_START$,,AUTO

      302    17307    2      DEV_SIZEW = KL$DREC.NWINFO - POFFW(DEV_START$,ADDR(KL$DREC.LNK));

  17307  4 000323   000000 236000 xsym               LDQ     DSEG1$
         4 000324   000020 036003                    ADLQ    16,DU
         4 000325   000022 772000                    QRL     18
         4 000326   200456 756100                    STQ     PRO_END$+2,,AUTO
         4 000327   200031 236100                    LDQ     DEV_START$,,AUTO
         4 000330   000022 772000                    QRL     18
         4 000331   200456 136100                    SBLQ    PRO_END$+2,,AUTO
         4 000332   200457 756100                    STQ     PRO_END$+3,,AUTO
         4 000333   000000 470400 xsym               LDP0    DSEG1$
         4 000334   000017 236100                    LDQ     15,,PR0
         4 000335   200457 136100                    SBLQ    PRO_END$+3,,AUTO
         4 000336   200033 756100                    STQ     DEV_SIZEW,,AUTO

      303    17308    2      CALL FIND_VIRCIR ALTRET(EXIT#);

  17308  4 000337   002647 701000 4                  TSX1    FIND_VIRCIR
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:56   
         4 000340   002625 702000 4                  TSX2    EXIT#

      304    17309    2      END;

  17309  4 000341   000412 710000 4                  TRA     s:17326

      305    17310    1   ELSE
      306    17311    2      IF CREATE THEN DO;          /* Initialize the link record */

  17311  4 000342   200026 234100                    SZN     CREATE,,AUTO
         4 000343   000412 605000 4                  TPL     s:17326

      307    17312    2         KL$DREC = LINK_DREC;

  17312  4 000344   000000 470400 xsym               LDP0    DSEG1$
         4 000345   000100 100400                    MLR     fill='000'O
         4 000346   000000 000160 3                  ADSC9   LINK_DREC                cn=0,n=112
         4 000347   000000 000160                    ADSC9   0,,PR0                   cn=0,n=112

      308    17313    2         KL$DREC.PASSWORD = BLANK_PASS;

  17313  4 000350   000000 470400 xsym               LDP0    DSEG1$
         4 000351   040100 100400                    MLR     fill='040'O
         4 000352   000000 000010 xsym               ADSC9   BLANK_PASS               cn=0,n=8
         4 000353   000002 000010                    ADSC9   2,,PR0                   cn=0,n=8

      309    17314    2         KL$DREC.LNK = LINK_DREC.LNK;

  17314  4 000354   000100 100400                    MLR     fill='000'O
         4 000355   000020 000060 3                  ADSC9   LINK_DREC+16             cn=0,n=48
         4 000356   000020 000060                    ADSC9   16,,PR0                  cn=0,n=48

      310    17315    2         KL$DREC.LNK.BLKHDR.LEV = 1;

  17315  4 000357   001000 236003                    LDQ     512,DU
         4 000360   000020 552140                    STBQ    16,'40'O,PR0

PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:57   
      311    17316    2         KL$DREC.LNK.BLKHDR.NSUBS = 0;

  17316  4 000361   000000 236003                    LDQ     0,DU
         4 000362   000020 552120                    STBQ    16,'20'O,PR0

      312    17317    2         LNG_CNT = LENGTHC( LINK_DREC.LNK );

  17317  4 000363   000060 235007                    LDA     48,DL
         4 000364   000011 755000 2                  STA     LNGTH

      313    17318    2         KL$UBWORD.NUM = 0;

  17318  4 000365   000000 220003                    LDX0    0,DU
         4 000366   200451 440100                    SXL0    KL$UBWORD,,AUTO

      314    17319    2         KL$UBWORD.REPLACE.T = LNGTH.T;

  17319  4 000367   000011 236000 2                  LDQ     LNGTH
         4 000370   000001 736000                    QLS     1
         4 000371   200451 676100                    ERQ     KL$UBWORD,,AUTO
         4 000372   377000 376007                    ANQ     130560,DL
         4 000373   200451 656100                    ERSQ    KL$UBWORD,,AUTO

      315    17320    2         KL$UBWORD.REPLACE.B = LNGTH.B;

  17320  4 000374   000011 236000 2                  LDQ     LNGTH
         4 000375   200451 676100                    ERQ     KL$UBWORD,,AUTO
         4 000376   000377 376007                    ANQ     255,DL
         4 000377   200451 656100                    ERSQ    KL$UBWORD,,AUTO

      316    17321    2         KL$DREC.LNK.BLKHDR.LEN.BYT(0) = KL$UBWORD.REPLACE.T;

  17321  4 000400   200451 236100                    LDQ     KL$UBWORD,,AUTO
         4 000401   000020 676100                    ERQ     16,,PR0
         4 000402   377000 376007                    ANQ     130560,DL
         4 000403   000020 656100                    ERSQ    16,,PR0

PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:58   
      317    17322    2         KL$DREC.LNK.BLKHDR.LEN.BYT(1) = KL$UBWORD.REPLACE.B;

  17322  4 000404   200451 236100                    LDQ     KL$UBWORD,,AUTO
         4 000405   000020 676100                    ERQ     16,,PR0
         4 000406   000377 376007                    ANQ     255,DL
         4 000407   000020 656100                    ERSQ    16,,PR0

      318    17323    2         KL$DREC.LNK.BLKHDR.BLKTYP = %KLTY_LINK#;

  17323  4 000410   004000 236003                    LDQ     2048,DU
         4 000411   000021 552140                    STBQ    17,'40'O,PR0

      319    17324    2         END;

      320    17325                                                              /*  Do options  */
      321    17326    1   MORE = AS_TRUE ;

  17326  4 000412   000000 236000 xsym               LDQ     AS_TRUE
         4 000413   400000 376003                    ANQ     -131072,DU
         4 000414   200013 756100                    STQ     MORE,,AUTO

      322    17327                                                              /**/
      323    17328    1   IF LINK THEN

  17328  4 000415   200020 234100                    SZN     LINK,,AUTO
         4 000416   000422 605000 4                  TPL     s:17330

      324    17329    1      P_PCB.ROOT$ = ADDR( LINK_OPTS_LIST ) ;

  17329  4 000417   000017 236000 5                  LDQ     15
         4 000420   000001 756000 xsym               STQ     P_PCB+1
         4 000421   000433 710000 4                  TRA     s:17334

      325    17330    1   ELSE IF VIRCIR THEN

  17330  4 000422   200021 234100                    SZN     VIRCIR,,AUTO
         4 000423   000427 605000 4                  TPL     s:17332
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:59   

      326    17331    1         P_PCB.ROOT$ = ADDR( VIR_CIR_OPTS_LIST );

  17331  4 000424   000020 236000 5                  LDQ     16
         4 000425   000001 756000 xsym               STQ     P_PCB+1
         4 000426   000433 710000 4                  TRA     s:17334

      327    17332    1      ELSE IF LINKDEV THEN

  17332  4 000427   200022 234100                    SZN     LINKDEV,,AUTO
         4 000430   000433 605000 4                  TPL     s:17334

      328    17333    1            P_PCB.ROOT$ = ADDR( LINK_DEV_OPTS_LIST );

  17333  4 000431   000021 236000 5                  LDQ     17
         4 000432   000001 756000 xsym               STQ     P_PCB+1

      329    17334    2   DO WHILE( MORE ) ;

  17334  4 000433   200013 234100                    SZN     MORE,,AUTO
         4 000434   002204 605000 4                  TPL     s:17966

      330    17335                                                              /* Set prompt */
      331    17336    2      CALL ASB$SET_PROMPT ( %PROMPT_OPT ) ;

  17336  4 000435   000006 630400 5                  EPPR0   6
         4 000436   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 000437   000000 701000 xent               TSX1    ASB$SET_PROMPT
         4 000440   000000 011000                    NOP     0

  17336  4 000441                       LINK_LOOP    null
      332    17337                                                              /* Read input */
      333    17338    2   LINK_LOOP: ;
      334    17339    2      CALL ASB$READ_SI( IN_BUF, ARS ) ;

  17339  4 000441   200012 630500                    EPPR0   ARS,,AUTO
         4 000442   200457 450500                    STP0    PRO_END$+3,,AUTO
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:60   
         4 000443   000022 236000 5                  LDQ     18
         4 000444   200456 756100                    STQ     PRO_END$+2,,AUTO
         4 000445   200456 630500                    EPPR0   PRO_END$+2,,AUTO
         4 000446   000020 631400 xsym               EPPR1   B_VECTNIL+16
         4 000447   000000 701000 xent               TSX1    ASB$READ_SI
         4 000450   000000 011000                    NOP     0

      335    17340    2      P_PCB.NCHARS = ARS ;

  17340  4 000451   200012 235100                    LDA     ARS,,AUTO
         4 000452   000011 755000 xsym               STA     P_PCB+9

      336    17341    2      CALL X$PARSE( P_PCB )

  17341  4 000453   000003 630400 5                  EPPR0   3
         4 000454   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 000455   000000 701000 xent               TSX1    X$PARSE
         4 000456   000460 702000 4                  TSX2    s:17343
         4 000457   000465 710000 4                  TRA     s:17346

      337    17342    3      WHENALTRETURN DO;

      338    17343    3         CALL ASH$ERROR( P_PCB.ERROR );

  17343  4 000460   000004 630400 5                  EPPR0   4
         4 000461   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 000462   000000 701000 xent               TSX1    ASH$ERROR
         4 000463   000000 011000                    NOP     0

      339    17344    3         GOTO LINK_LOOP;

  17344  4 000464   000441 710000 4                  TRA     LINK_LOOP

      340    17345    3         END; /*  Whenaltreturn  */
      341    17346    2      NODE$ = P_PCB.OUT$ ;

  17346  4 000465   000003 236000 xsym               LDQ     P_PCB+3
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:61   
         4 000466   000000 756000 xsym               STQ     NODE$

      342    17347                                                              /**/
      343    17348    3      DO I = 0 TO P$NODE.SUBNODES-1 ;

  17348  4 000467   200007 450100                    STZ     I,,AUTO
         4 000470   002175 710000 4                  TRA     LOOP_END+1

      344    17349    3         PTR$ = P$NODE.SUBLK$(I) ;

  17349  4 000471   000000 470400 xsym               LDP0    NODE$
         4 000472   200007 720100                    LXL0    I,,AUTO
         4 000473   000003 236110                    LDQ     3,X0,PR0
         4 000474   200005 756100                    STQ     PTR$,,AUTO

      345    17350    3         CODE = PTR$ -> P$NODE.CODE ;

  17350  4 000475   200005 471500                    LDP1    PTR$,,AUTO
         4 000476   100000 236100                    LDQ     0,,PR1
         4 000477   777777 376007                    ANQ     -1,DL
         4 000500   000000 756000 xsym               STQ     CODE

      346    17351    4         DO SELECT( CODE ) ;

  17351  4 000501   000017 116007                    CMPQ    15,DL
         4 000502   000557 602000 4                  TNC     s:17351+46
         4 000503   000740 600000 4                  TZE     s:17455
         4 000504   000031 116007                    CMPQ    25,DL
         4 000505   000535 602000 4                  TNC     s:17351+28
         4 000506   002027 600000 4                  TZE     s:17867
         4 000507   000034 116007                    CMPQ    28,DL
         4 000510   000526 602000 4                  TNC     s:17351+21
         4 000511   002121 600000 4                  TZE     s:17922
         4 000512   000455 116007                    CMPQ    301,DL
         4 000513   000520 602000 4                  TNC     s:17351+15
         4 000514   002165 600000 4                  TZE     s:17957
         4 000515   000456 116007                    CMPQ    302,DL
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:62   
         4 000516   002174 601000 4                  TNZ     LOOP_END
         4 000517   002161 710000 4                  TRA     s:17954
         4 000520   000035 116007                    CMPQ    29,DL
         4 000521   002174 602000 4                  TNC     LOOP_END
         4 000522   002147 600000 4                  TZE     s:17947
         4 000523   000454 116007                    CMPQ    300,DL
         4 000524   002174 601000 4                  TNZ     LOOP_END
         4 000525   002171 710000 4                  TRA     s:17960
         4 000526   000033 116007                    CMPQ    27,DL
         4 000527   000532 602000 4                  TNC     s:17351+25
         4 000530   002055 600000 4                  TZE     s:17892
         4 000531   002174 710000 4                  TRA     LOOP_END
         4 000532   000032 116007                    CMPQ    26,DL
         4 000533   002174 601000 4                  TNZ     LOOP_END
         4 000534   002157 710000 4                  TRA     s:17951
         4 000535   000025 116007                    CMPQ    21,DL
         4 000536   000551 602000 4                  TNC     s:17351+40
         4 000537   001553 600000 4                  TZE     s:17759
         4 000540   000027 116007                    CMPQ    23,DL
         4 000541   000546 602000 4                  TNC     s:17351+37
         4 000542   001737 600000 4                  TZE     s:17828
         4 000543   000030 116007                    CMPQ    24,DL
         4 000544   002174 601000 4                  TNZ     LOOP_END
         4 000545   002013 710000 4                  TRA     s:17861
         4 000546   000026 116007                    CMPQ    22,DL
         4 000547   002174 601000 4                  TNZ     LOOP_END
         4 000550   001473 710000 4                  TRA     s:17720
         4 000551   000020 116007                    CMPQ    16,DL
         4 000552   002174 602000 4                  TNC     LOOP_END
         4 000553   001345 600000 4                  TZE     s:17676
         4 000554   000023 116007                    CMPQ    19,DL
         4 000555   002174 601000 4                  TNZ     LOOP_END
         4 000556   001737 710000 4                  TRA     s:17828
         4 000557   000012 116007                    CMPQ    10,DL
         4 000560   000576 602000 4                  TNC     s:17351+61
         4 000561   001220 600000 4                  TZE     s:17576
         4 000562   000015 116007                    CMPQ    13,DL
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:63   
         4 000563   000570 602000 4                  TNC     s:17351+55
         4 000564   001272 600000 4                  TZE     s:17627
         4 000565   000016 116007                    CMPQ    14,DL
         4 000566   002174 601000 4                  TNZ     LOOP_END
         4 000567   001317 710000 4                  TRA     s:17651
         4 000570   000013 116007                    CMPQ    11,DL
         4 000571   002174 602000 4                  TNC     LOOP_END
         4 000572   001245 600000 4                  TZE     s:17603
         4 000573   000014 116007                    CMPQ    12,DL
         4 000574   002174 601000 4                  TNZ     LOOP_END
         4 000575   002157 710000 4                  TRA     s:17951
         4 000576   000010 116007                    CMPQ    8,DL
         4 000577   000604 602000 4                  TNC     s:17351+67
         4 000600   001046 600000 4                  TZE     s:17523
         4 000601   000011 116007                    CMPQ    9,DL
         4 000602   002174 601000 4                  TNZ     LOOP_END
         4 000603   001204 710000 4                  TRA     s:17570
         4 000604   000007 116007                    CMPQ    7,DL
         4 000605   002174 601000 4                  TNZ     LOOP_END
         4 000606   000607 710000 4                  TRA     s:17355

      347    17352                                                              /**/
      348    17353                                                              /**/
      349    17354    4            SELECT( %LINK_PRO_VAL ) ;

      350    17355    4            BLK$ = PTR$ -> P$NODE.SUBLK$(0) ;

  17355  4 000607   100003 236100                    LDQ     3,,PR1
         4 000610   200023 756100                    STQ     BLK$,,AUTO

      351    17356    5            IF OUT$SYM.COUNT > 11 THEN DO;

  17356  4 000611   200023 473500                    LDP3    BLK$,,AUTO
         4 000612   300004 236100                    LDQ     4,,PR3
         4 000613   777000 376003                    ANQ     -512,DU
         4 000614   014000 116003                    CMPQ    6144,DU
         4 000615   000623 602000 4                  TNC     s:17374
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:64   

      352    17357                    %SCREAM( ERR#=E$PRO_TOO_LONG, LEVEL=ERROR, MID='A') ;

  17369  4 000616   000023 630400 5                  EPPR0   19
         4 000617   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 000620   000000 701000 xent               TSX1    ASH$ERROR
         4 000621   000000 011000                    NOP     0

      353    17372    5               GOTO LOOP_END;

  17372  4 000622   002174 710000 4                  TRA     LOOP_END

      354    17373    5               END ;    /* Then do */
      355    17374    4            PRO$ = ADDR(PRO_BUF);

  17374  4 000623   200034 634500                    EPPR4   PRO_BUF,,AUTO
         4 000624   200024 454500                    STP4    PRO$,,AUTO

      356    17375    4            ARS = LENGTHC(PRO_BUF);

  17375  4 000625   002000 235007                    LDA     1024,DL
         4 000626   200012 755100                    STA     ARS,,AUTO

      357    17376    4           CALL XLATE (XPNAME, B$XL_UPPER_UR, SUBSTR (OUT$SYM.TEXT, 0, OUT$SYM.COUNT))
             17376                     ;

  17376  4 000627   300004 236100                    LDQ     4,,PR3
         4 000630   000033 772000                    QRL     27
         4 000631   000000 621006                    EAX1    0,QL
         4 000632   000000 475400 xsym               LDP5    B$XL_UPPER_UR$
         4 000633   040100 160540                    MVT     fill='040'O
         4 000634   300004 200011                    ADSC9   4,,PR3                   cn=1,n=*X1
         4 000635   200446 000013                    ADSC9   XPNAME,,AUTO             cn=0,n=11
         4 000636   500000 000100                    ARG     0,,PR5

      358    17377    4            USERS_KEY.COUNT = OUT$SYM.COUNT ;

PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:65   
  17377  4 000637   300004 236100                    LDQ     4,,PR3
         4 000640   000000 552040 xsym               STBQ    USERS_KEY,'40'O

      359    17378    4            USERS_KEY.TXTC = XPNAME;

  17378  4 000641   040000 100500                    MLR     fill='040'O
         4 000642   200446 000013                    ADSC9   XPNAME,,AUTO             cn=0,n=11
         4 000643   000000 200051 xsym               ADSC9   USERS_KEY                cn=1,n=41

      360    17379    4            CALL ASD$READ_PRO(USERS_KEY,KL$PHDR,ARS)

  17379  4 000644   200012 636500                    EPPR6   ARS,,AUTO
         4 000645   200460 456500                    STP6    PRO_END$+4,,AUTO
         4 000646   200024 236100                    LDQ     PRO$,,AUTO
         4 000647   000013 235000 5                  LDA     11
         4 000650   200456 757100                    STAQ    PRO_END$+2,,AUTO
         4 000651   200456 630500                    EPPR0   PRO_END$+2,,AUTO
         4 000652   000021 631400 xsym               EPPR1   B_VECTNIL+17
         4 000653   000000 701000 xent               TSX1    ASD$READ_PRO
         4 000654   000656 702000 4                  TSX2    s:17381
         4 000655   000666 710000 4                  TRA     s:17399

      361    17380    5            WHENALTRETURN DO;

      362    17381    5               AS_FIELD1 = USERS_KEY ;

  17381  4 000656   000000 100400                    MLR     fill='000'O
         4 000657   000000 000051 xsym               ADSC9   USERS_KEY                cn=0,n=41
         4 000660   000000 000051 xsym               ADSC9   AS_FIELD1                cn=0,n=41

      363    17382                    %SCREAM( ERR#=E$PRO_NO_EXIST, LEVEL=ERROR, MID='A' ) ;

  17394  4 000661   000024 630400 5                  EPPR0   20
         4 000662   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 000663   000000 701000 xent               TSX1    ASH$ERROR
         4 000664   000000 011000                    NOP     0

PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:66   
      364    17397    5               GOTO LOOP_END;

  17397  4 000665   002174 710000 4                  TRA     LOOP_END

      365    17398    5               END; /*  Whenaltreturn  */
      366    17399    4            IF LINK THEN

  17399  4 000666   200020 234100                    SZN     LINK,,AUTO
         4 000667   000714 605000 4                  TPL     s:17426

      367    17400    5               IF KL$PHDR.TTYP ~= %KLTY_LINK# THEN DO;

  17400  4 000670   200024 470500                    LDP0    PRO$,,AUTO
         4 000671   000100 101500                    MRL     fill='000'O
         4 000672   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
         4 000673   200456 000004                    ADSC9   PRO_END$+2,,AUTO         cn=0,n=4
         4 000674   200456 236100                    LDQ     PRO_END$+2,,AUTO
         4 000675   000004 116007                    CMPQ    4,DL
         4 000676   000704 600000 4                  TZE     s:17422

      368    17401        /*E* ERROR: ASA-E$LINKPROTYPE-0
      369    17402             MESSAGE: You must specify a profile that defines a link.
      370    17403             MESSAGE1: Examples: $LINK
      371    17404        */
      372    17405                       %SCREAM( ERR#=E$LINKPROTYPE, LEVEL=ERROR, MID='A' );

  17417  4 000677   000025 630400 5                  EPPR0   21
         4 000700   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 000701   000000 701000 xent               TSX1    ASH$ERROR
         4 000702   000000 011000                    NOP     0

      373    17420    5                  END;

  17420  4 000703   002174 710000 4                  TRA     LOOP_END

      374    17421    5               ELSE DO;

PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:67   
      375    17422    5                  KL$DREC.PNAME.CNT = OUT$SYM.COUNT ;

  17422  4 000704   200023 470500                    LDP0    BLK$,,AUTO
         4 000705   000000 471400 xsym               LDP1    DSEG1$
         4 000706   000004 236100                    LDQ     4,,PR0
         4 000707   100004 552140                    STBQ    4,'40'O,PR1

      376    17423    5                  KL$DREC.PNAME.TXT = XPNAME;

  17423  4 000710   040100 100500                    MLR     fill='040'O
         4 000711   200446 000013                    ADSC9   XPNAME,,AUTO             cn=0,n=11
         4 000712   100004 200013                    ADSC9   4,,PR1                   cn=1,n=11

      377    17424    5                  END;

  17424  4 000713   002174 710000 4                  TRA     LOOP_END

      378    17425    4            ELSE
      379    17426    5               IF KL$PHDR.TTYP ~= %KLTY_VIRCIR# THEN DO ;

  17426  4 000714   200024 470500                    LDP0    PRO$,,AUTO
         4 000715   000100 101500                    MRL     fill='000'O
         4 000716   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
         4 000717   200456 000004                    ADSC9   PRO_END$+2,,AUTO         cn=0,n=4
         4 000720   200456 236100                    LDQ     PRO_END$+2,,AUTO
         4 000721   000010 116007                    CMPQ    8,DL
         4 000722   000730 600000 4                  TZE     s:17448

      380    17427        /*E* ERROR: ASA-E$VIRCIRPROTYPE-0
      381    17428             MESSAGE: You must specify a profile that defines a virtual circuit.
      382    17429             MESSAGE1: Examples: $VIRCIR
      383    17430        */
      384    17431                       %SCREAM( ERR#=E$VIRCIRPROTYPE, LEVEL=ERROR, MID='A' );

  17443  4 000723   000026 630400 5                  EPPR0   22
         4 000724   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 000725   000000 701000 xent               TSX1    ASH$ERROR
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:68   
         4 000726   000000 011000                    NOP     0

      385    17446    5                  END;

  17446  4 000727   002174 710000 4                  TRA     LOOP_END

      386    17447    5               ELSE DO;

      387    17448    5                  KL$LNKVC.PRONM.CNT = OUT$SYM.COUNT ;

  17448  4 000730   200023 471500                    LDP1    BLK$,,AUTO
         4 000731   000000 473400 xsym               LDP3    DSEG3$
         4 000732   100004 236100                    LDQ     4,,PR1
         4 000733   300007 552140                    STBQ    7,'40'O,PR3

      388    17449    5                  KL$LNKVC.PRONM.TXT = XPNAME;

  17449  4 000734   040100 100500                    MLR     fill='040'O
         4 000735   200446 000013                    ADSC9   XPNAME,,AUTO             cn=0,n=11
         4 000736   300007 200013                    ADSC9   7,,PR3                   cn=1,n=11

      389    17450    5                  END;

  17450  4 000737   002174 710000 4                  TRA     LOOP_END

      390    17451
      391    17452                                                             /**/
      392    17453                                                              /**/
      393    17454    4            SELECT( %LINK_DFLTVCPRO_VAL ) ;

      394    17455    4            BLK$ = PTR$ -> P$NODE.SUBLK$(0) ;

  17455  4 000740   100003 236100                    LDQ     3,,PR1
         4 000741   200023 756100                    STQ     BLK$,,AUTO

      395    17456    5            IF OUT$SYM.COUNT > 11 THEN DO;

PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:69   
  17456  4 000742   200023 473500                    LDP3    BLK$,,AUTO
         4 000743   300004 236100                    LDQ     4,,PR3
         4 000744   777000 376003                    ANQ     -512,DU
         4 000745   014000 116003                    CMPQ    6144,DU
         4 000746   000754 602000 4                  TNC     s:17474

      396    17457                    %SCREAM( ERR#=E$PRO_TOO_LONG, LEVEL=ERROR, MID='A') ;

  17469  4 000747   000023 630400 5                  EPPR0   19
         4 000750   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 000751   000000 701000 xent               TSX1    ASH$ERROR
         4 000752   000000 011000                    NOP     0

      397    17472    5               GOTO LOOP_END;

  17472  4 000753   002174 710000 4                  TRA     LOOP_END

      398    17473    5               END ;    /* Count > 11  */
      399    17474    4            PRO$ = ADDR(PRO_BUF);

  17474  4 000754   200034 634500                    EPPR4   PRO_BUF,,AUTO
         4 000755   200024 454500                    STP4    PRO$,,AUTO

      400    17475    4            ARS = LENGTHC(PRO_BUF);

  17475  4 000756   002000 235007                    LDA     1024,DL
         4 000757   200012 755100                    STA     ARS,,AUTO

      401    17476    4           CALL XLATE (XPNAME, B$XL_UPPER_UR, SUBSTR (OUT$SYM.TEXT, 0, OUT$SYM.COUNT))
             17476                     ;

  17476  4 000760   300004 236100                    LDQ     4,,PR3
         4 000761   000033 772000                    QRL     27
         4 000762   000000 621006                    EAX1    0,QL
         4 000763   000000 475400 xsym               LDP5    B$XL_UPPER_UR$
         4 000764   040100 160540                    MVT     fill='040'O
         4 000765   300004 200011                    ADSC9   4,,PR3                   cn=1,n=*X1
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:70   
         4 000766   200446 000013                    ADSC9   XPNAME,,AUTO             cn=0,n=11
         4 000767   500000 000100                    ARG     0,,PR5

      402    17477    4            USERS_KEY.COUNT = OUT$SYM.COUNT ;

  17477  4 000770   300004 236100                    LDQ     4,,PR3
         4 000771   000000 552040 xsym               STBQ    USERS_KEY,'40'O

      403    17478    4            USERS_KEY.TXTC = XPNAME ;

  17478  4 000772   040000 100500                    MLR     fill='040'O
         4 000773   200446 000013                    ADSC9   XPNAME,,AUTO             cn=0,n=11
         4 000774   000000 200051 xsym               ADSC9   USERS_KEY                cn=1,n=41

      404    17479    4            CALL ASD$READ_PRO(USERS_KEY,KL$PHDR,ARS)

  17479  4 000775   200012 636500                    EPPR6   ARS,,AUTO
         4 000776   200460 456500                    STP6    PRO_END$+4,,AUTO
         4 000777   200024 236100                    LDQ     PRO$,,AUTO
         4 001000   000013 235000 5                  LDA     11
         4 001001   200456 757100                    STAQ    PRO_END$+2,,AUTO
         4 001002   200456 630500                    EPPR0   PRO_END$+2,,AUTO
         4 001003   000021 631400 xsym               EPPR1   B_VECTNIL+17
         4 001004   000000 701000 xent               TSX1    ASD$READ_PRO
         4 001005   001007 702000 4                  TSX2    s:17481
         4 001006   001017 710000 4                  TRA     s:17499

      405    17480    5            WHENALTRETURN DO;

      406    17481    5               AS_FIELD1 = USERS_KEY;

  17481  4 001007   000000 100400                    MLR     fill='000'O
         4 001010   000000 000051 xsym               ADSC9   USERS_KEY                cn=0,n=41
         4 001011   000000 000051 xsym               ADSC9   AS_FIELD1                cn=0,n=41

      407    17482                    %SCREAM (ERR# = E$PRO_NO_EXIST, LEVEL=ERROR, MID= 'A');

PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:71   
  17494  4 001012   000024 630400 5                  EPPR0   20
         4 001013   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 001014   000000 701000 xent               TSX1    ASH$ERROR
         4 001015   000000 011000                    NOP     0

      408    17497    5               GOTO LOOP_END;

  17497  4 001016   002174 710000 4                  TRA     LOOP_END

      409    17498    5               END; /*  Whenaltreturn  */
      410    17499    4            IF LINK THEN

  17499  4 001017   200020 234100                    SZN     LINK,,AUTO
         4 001020   002174 605000 4                  TPL     LOOP_END

      411    17500    5               IF KL$PHDR.TTYP ~= %KLTY_VIRCIR# THEN DO;

  17500  4 001021   200024 470500                    LDP0    PRO$,,AUTO
         4 001022   000100 101500                    MRL     fill='000'O
         4 001023   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
         4 001024   200456 000004                    ADSC9   PRO_END$+2,,AUTO         cn=0,n=4
         4 001025   200456 236100                    LDQ     PRO_END$+2,,AUTO
         4 001026   000010 116007                    CMPQ    8,DL
         4 001027   001035 600000 4                  TZE     s:17518

      412    17501                       %SCREAM( ERR#=E$VIRCIRPROTYPE, LEVEL=ERROR, MID='A' );

  17513  4 001030   000026 630400 5                  EPPR0   22
         4 001031   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 001032   000000 701000 xent               TSX1    ASH$ERROR
         4 001033   000000 011000                    NOP     0

      413    17516    5                  END;  /*  Ttyp not vircir  */

  17516  4 001034   002174 710000 4                  TRA     LOOP_END

      414    17517    5               ELSE DO;
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:72   

      415    17518    5                  KL$DREC.LNK.DFLTVCPRO.CNT = OUT$SYM.COUNT ;

  17518  4 001035   200023 471500                    LDP1    BLK$,,AUTO
         4 001036   000000 473400 xsym               LDP3    DSEG1$
         4 001037   100004 236100                    LDQ     4,,PR1
         4 001040   000011 772000                    QRL     9
         4 001041   300026 552120                    STBQ    22,'20'O,PR3

      416    17519    5                  KL$DREC.LNK.DFLTVCPRO.TXT = XPNAME ;

  17519  4 001042   040100 100500                    MLR     fill='040'O
         4 001043   200446 000013                    ADSC9   XPNAME,,AUTO             cn=0,n=11
         4 001044   300026 400013                    ADSC9   22,,PR3                  cn=2,n=11

      417    17520    5                  END;  /*  Ttyp is vircir  */

  17520  4 001045   002174 710000 4                  TRA     LOOP_END

      418    17521                                                             /**/
      419    17522    4            SELECT( %LINK_ADDRESS_VAL );

      420    17523    4            BLK$ = PTR$ -> P$NODE.SUBLK$(0);

  17523  4 001046   200005 470500                    LDP0    PTR$,,AUTO
         4 001047   000003 236100                    LDQ     3,,PR0
         4 001050   200023 756100                    STQ     BLK$,,AUTO

      421    17524    4            CNT = OUT$SYM.COUNT;

  17524  4 001051   200023 471500                    LDP1    BLK$,,AUTO
         4 001052   100004 236100                    LDQ     4,,PR1
         4 001053   000033 772000                    QRL     27
         4 001054   200006 756100                    STQ     CNT,,AUTO

      422    17525    5            IF CNT > 14 THEN DO;

PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:73   
  17525  4 001055   000016 116007                    CMPQ    14,DL
         4 001056   001064 604400 4                  TMOZ    s:17546

      423    17526        /*E*  ERROR:  ASA-E$BAD_ADDRESS-C
      424    17527              MESSAGE: ADDRESS can be at most 14 decimal digits.
      425    17528        */
      426    17529                    %SCREAM( ERR#=E$BAD_ADDRESS, LEVEL=ERROR, MID='A' );

  17541  4 001057   000027 630400 5                  EPPR0   23
         4 001060   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 001061   000000 701000 xent               TSX1    ASH$ERROR
         4 001062   000000 011000                    NOP     0

      427    17544    5               END;

  17544  4 001063   002174 710000 4                  TRA     LOOP_END

      428    17545    5            ELSE DO;

      429    17546    5               ADRN = '0'B;

  17546  4 001064   000000 100400                    MLR     fill='000'O
         4 001065   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         4 001066   000003 000012 2                  ADSC9   ADRN                     cn=0,n=10

      430    17547    5               K = CNT / 2 - 1;

  17547  4 001067   000002 506007                    DIV     2,DL
         4 001070   000001 136007                    SBLQ    1,DL
         4 001071   200011 756100                    STQ     K,,AUTO

      431    17548    5               ADRN.LNG# = CNT ;

  17548  4 001072   200006 236100                    LDQ     CNT,,AUTO
         4 001073   000033 736000                    QLS     27
         4 001074   000003 552040 2                  STBQ    ADRN,'40'O

PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:74   
      432    17549    5               J = MOD( CNT, 2 ) ;

  17549  4 001075   200006 236100                    LDQ     CNT,,AUTO
         4 001076   000002 506007                    DIV     2,DL
         4 001077   200010 755100                    STA     J,,AUTO

      433    17550    5               IF J = 1 THEN

  17550  4 001100   000001 115007                    CMPA    1,DL
         4 001101   001120 601000 4                  TNZ     s:17555

      434    17551    6               DO;

      435    17552    6                  CALL CHARBIN( J, SUBSTR(OUT$SYM.TEXT,CNT-1,1)) ;

  17552  4 001102   100004 236100                    LDQ     4,,PR1
         4 001103   000033 772000                    QRL     27
         4 001104   200006 235100                    LDA     CNT,,AUTO
         4 001105   000100 305505                    DTB
         4 001106   100004 030001                    NDSC9   4,A,PR1                  cn=0,s=nosgn,sf=0,n=1
         4 001107   200010 000004                    NDSC9   J,,AUTO                  cn=0,s=lsgnf,sf=0,n=4

      436    17553    6                  ADRN.ADR.BCD1#(K+1) = J ;

  17553  4 001110   200011 236100                    LDQ     K,,AUTO
         4 001111   000011 402007                    MPY     9,DL
         4 001112   000000 116003                    CMPQ    0,DU
         4 001113   001115 605000 4                  TPL     s:17553+5
         4 001114   000044 036003                    ADLQ    36,DU
         4 001115   003006 061500                    CSR     bolr='003'O
         4 001116   200010 000044                    BDSC    J,,AUTO                  by=0,bit=0,n=36
         4 001117   000003 410004 2                  BDSC    ADRN,Q                   by=2,bit=1,n=4

      437    17554    6                  END;

      438    17555    6               DO J = 0 TO K;

PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:75   
  17555  4 001120   200010 450100                    STZ     J,,AUTO
         4 001121   001162 710000 4                  TRA     s:17560+1

      439    17556    6                  CALL CHARBIN( CNT, SUBSTR(OUT$SYM.TEXT,J*2,1) );

  17556  4 001122   200023 470500                    LDP0    BLK$,,AUTO
         4 001123   000004 236100                    LDQ     4,,PR0
         4 001124   000033 772000                    QRL     27
         4 001125   200010 235100                    LDA     J,,AUTO
         4 001126   000001 735000                    ALS     1
         4 001127   000100 305505                    DTB
         4 001130   000004 230001                    NDSC9   4,A,PR0                  cn=1,s=nosgn,sf=0,n=1
         4 001131   200006 000004                    NDSC9   CNT,,AUTO                cn=0,s=lsgnf,sf=0,n=4

      440    17557    6                  ADRN.ADR.BCD1#(J) = CNT;

  17557  4 001132   200010 236100                    LDQ     J,,AUTO
         4 001133   000011 402007                    MPY     9,DL
         4 001134   000000 116003                    CMPQ    0,DU
         4 001135   001137 605000 4                  TPL     s:17557+5
         4 001136   000044 036003                    ADLQ    36,DU
         4 001137   003006 061500                    CSR     bolr='003'O
         4 001140   200006 000044                    BDSC    CNT,,AUTO                by=0,bit=0,n=36
         4 001141   000003 210004 2                  BDSC    ADRN,Q                   by=1,bit=1,n=4

      441    17558    6                  CALL CHARBIN( CNT, SUBSTR(OUT$SYM.TEXT,J*2+1,1) );

  17558  4 001142   000004 236100                    LDQ     4,,PR0
         4 001143   000033 772000                    QRL     27
         4 001144   200010 235100                    LDA     J,,AUTO
         4 001145   000001 735000                    ALS     1
         4 001146   000100 305505                    DTB
         4 001147   000004 430001                    NDSC9   4,A,PR0                  cn=2,s=nosgn,sf=0,n=1
         4 001150   200006 000004                    NDSC9   CNT,,AUTO                cn=0,s=lsgnf,sf=0,n=4

      442    17559    6                  ADRN.ADR.BCD2#(J) = CNT;

PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:76   
  17559  4 001151   200010 236100                    LDQ     J,,AUTO
         4 001152   000011 402007                    MPY     9,DL
         4 001153   000000 116003                    CMPQ    0,DU
         4 001154   001156 605000 4                  TPL     s:17559+5
         4 001155   000044 036003                    ADLQ    36,DU
         4 001156   003006 061500                    CSR     bolr='003'O
         4 001157   200006 000044                    BDSC    CNT,,AUTO                by=0,bit=0,n=36
         4 001160   000003 250004 2                  BDSC    ADRN,Q                   by=1,bit=5,n=4

      443    17560    6                  END;

  17560  4 001161   200010 054100                    AOS     J,,AUTO
         4 001162   200010 236100                    LDQ     J,,AUTO
         4 001163   200011 116100                    CMPQ    K,,AUTO
         4 001164   001122 604400 4                  TMOZ    s:17556

      444    17561    5               IF LINK THEN

  17561  4 001165   200020 234100                    SZN     LINK,,AUTO
         4 001166   001174 605000 4                  TPL     s:17564

      445    17562    5                  KL$DREC.LNK.ADR = ADRN ;

  17562  4 001167   000000 470400 xsym               LDP0    DSEG1$
         4 001170   000100 100400                    MLR     fill='000'O
         4 001171   000003 000010 2                  ADSC9   ADRN                     cn=0,n=8
         4 001172   000022 000010                    ADSC9   18,,PR0                  cn=0,n=8
         4 001173   002174 710000 4                  TRA     LOOP_END

      446    17563    6               ELSE DO;

      447    17564    6                  KL$LNKVC.ADR = ADRN ;

  17564  4 001174   000000 470400 xsym               LDP0    DSEG3$
         4 001175   000100 100400                    MLR     fill='000'O
         4 001176   000003 000010 2                  ADSC9   ADRN                     cn=0,n=8
         4 001177   000002 600010                    ADSC9   2,,PR0                   cn=3,n=8
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:77   

      448    17565    6                  VC_ADDR_SET = AS_TRUE;

  17565  4 001200   000000 236000 xsym               LDQ     AS_TRUE
         4 001201   400000 376003                    ANQ     -131072,DU
         4 001202   200441 756100                    STQ     VC_ADDR_SET,,AUTO

      449    17566    6                  END ;  /*  Else vircir  */

      450    17567    5               END ;  /*  A good address  */

  17567  4 001203   002174 710000 4                  TRA     LOOP_END

      451    17568
      452    17569    4            SELECT ( %LINK_MODE_VAL);

      453    17570    4            IF PTR$->P$NODE.SUBLK$(0)->P$NODE.CODE = %LINK_DTE_VAL THEN

  17570  4 001204   200005 470500                    LDP0    PTR$,,AUTO
         4 001205   000003 471500                    LDP1    3,,PR0
         4 001206   100000 720100                    LXL0    0,,PR1
         4 001207   001214 601000 4                  TNZ     s:17573

      454    17571    4               KL$DREC.LNK.MODE# = 0;

  17571  4 001210   000000 473400 xsym               LDP3    DSEG1$
         4 001211   000030 236000 5                  LDQ     24
         4 001212   300026 356100                    ANSQ    22,,PR3
         4 001213   002174 710000 4                  TRA     LOOP_END

      455    17572    4            ELSE
      456    17573    4               KL$DREC.LNK.MODE# = 1;

  17573  4 001214   000000 473400 xsym               LDP3    DSEG1$
         4 001215   200000 236003                    LDQ     65536,DU
         4 001216   300026 256100                    ORSQ    22,,PR3
         4 001217   002174 710000 4                  TRA     LOOP_END
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:78   

      457    17574
      458    17575    4            SELECT ( %LINK_LIC_VAL);

      459    17576    4            BLK$ = PTR$ -> P$NODE.SUBLK$(0);

  17576  4 001220   100003 236100                    LDQ     3,,PR1
         4 001221   200023 756100                    STQ     BLK$,,AUTO

      460    17577    4            CALL CHARBIN (J, OUT$SYM.TEXT);

  17577  4 001222   200023 473500                    LDP3    BLK$,,AUTO
         4 001223   300004 236100                    LDQ     4,,PR3
         4 001224   000033 772000                    QRL     27
         4 001225   000000 621006                    EAX1    0,QL
         4 001226   000100 305540                    DTB
         4 001227   300004 230011                    NDSC9   4,,PR3                   cn=1,s=nosgn,sf=0,n=*X1
         4 001230   200010 000004                    NDSC9   J,,AUTO                  cn=0,s=lsgnf,sf=0,n=4

      461    17578    5            IF J > 4095 THEN DO;

  17578  4 001231   200010 235100                    LDA     J,,AUTO
         4 001232   007777 115007                    CMPA    4095,DL
         4 001233   001241 604400 4                  TMOZ    s:17600

      462    17579        /*E* ERROR: ASA-E$LINK_CHAN_TOO_BIG-0
      463    17580             MESSAGE: The given value is too large for this LINK CHANNEL.
      464    17581             MESSAGE1: The maximum value for a LINK CHANNEL is 4095.
      465    17582        */
      466    17583                    %SCREAM (ERR#=E$LINK_CHAN_TOO_BIG, LEVEL=ERROR, MID='A');

  17595  4 001234   000031 630400 5                  EPPR0   25
         4 001235   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 001236   000000 701000 xent               TSX1    ASH$ERROR
         4 001237   000000 011000                    NOP     0

      467    17598    5               END; /*  Lic > 4095  */
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:79   

  17598  4 001240   002174 710000 4                  TRA     LOOP_END

      468    17599    4            ELSE
      469    17600    4               KL$DREC.LNK.LIC = J;

  17600  4 001241   000000 622005                    EAX2    0,AL
         4 001242   000000 474400 xsym               LDP4    DSEG1$
         4 001243   400024 742100                    STX2    20,,PR4
         4 001244   002174 710000 4                  TRA     LOOP_END

      470    17601
      471    17602    4            SELECT ( %LINK_LOC_VAL);

      472    17603    4            BLK$ = PTR$ -> P$NODE.SUBLK$(0);

  17603  4 001245   100003 236100                    LDQ     3,,PR1
         4 001246   200023 756100                    STQ     BLK$,,AUTO

      473    17604    4            CALL CHARBIN (J, OUT$SYM.TEXT);

  17604  4 001247   200023 473500                    LDP3    BLK$,,AUTO
         4 001250   300004 236100                    LDQ     4,,PR3
         4 001251   000033 772000                    QRL     27
         4 001252   000000 621006                    EAX1    0,QL
         4 001253   000100 305540                    DTB
         4 001254   300004 230011                    NDSC9   4,,PR3                   cn=1,s=nosgn,sf=0,n=*X1
         4 001255   200010 000004                    NDSC9   J,,AUTO                  cn=0,s=lsgnf,sf=0,n=4

      474    17605    4            IF J > 4095 THEN

  17605  4 001256   200010 235100                    LDA     J,,AUTO
         4 001257   007777 115007                    CMPA    4095,DL
         4 001260   001266 604400 4                  TMOZ    s:17624

      475    17606    5            DO;

PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:80   
      476    17607                    %SCREAM (ERR#=E$LINK_CHAN_TOO_BIG, LEVEL=ERROR, MID='A');

  17619  4 001261   000031 630400 5                  EPPR0   25
         4 001262   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 001263   000000 701000 xent               TSX1    ASH$ERROR
         4 001264   000000 011000                    NOP     0

      477    17622    5               END; /*  Loc > 4095  */

  17622  4 001265   002174 710000 4                  TRA     LOOP_END

      478    17623    4            ELSE
      479    17624    4               KL$DREC.LNK.LOC = J;

  17624  4 001266   000000 622005                    EAX2    0,AL
         4 001267   000000 474400 xsym               LDP4    DSEG1$
         4 001270   400025 742100                    STX2    21,,PR4
         4 001271   002174 710000 4                  TRA     LOOP_END

      480    17625
      481    17626    4            SELECT ( %LINK_HIC_VAL);

      482    17627    4            BLK$ = PTR$ -> P$NODE.SUBLK$(0);

  17627  4 001272   100003 236100                    LDQ     3,,PR1
         4 001273   200023 756100                    STQ     BLK$,,AUTO

      483    17628    4            CALL CHARBIN (J, OUT$SYM.TEXT);

  17628  4 001274   200023 473500                    LDP3    BLK$,,AUTO
         4 001275   300004 236100                    LDQ     4,,PR3
         4 001276   000033 772000                    QRL     27
         4 001277   000000 621006                    EAX1    0,QL
         4 001300   000100 305540                    DTB
         4 001301   300004 230011                    NDSC9   4,,PR3                   cn=1,s=nosgn,sf=0,n=*X1
         4 001302   200010 000004                    NDSC9   J,,AUTO                  cn=0,s=lsgnf,sf=0,n=4

PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:81   
      484    17629    4            IF J > 4095 THEN

  17629  4 001303   200010 235100                    LDA     J,,AUTO
         4 001304   007777 115007                    CMPA    4095,DL
         4 001305   001313 604400 4                  TMOZ    s:17648

      485    17630    5            DO;

      486    17631                    %SCREAM (ERR#=E$LINK_CHAN_TOO_BIG, LEVEL=ERROR, MID='A');

  17643  4 001306   000031 630400 5                  EPPR0   25
         4 001307   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 001310   000000 701000 xent               TSX1    ASH$ERROR
         4 001311   000000 011000                    NOP     0

      487    17646    5               END; /*  Hic > 4095  */

  17646  4 001312   002174 710000 4                  TRA     LOOP_END

      488    17647    4            ELSE
      489    17648    4               KL$DREC.LNK.HIC = J;

  17648  4 001313   000000 622005                    EAX2    0,AL
         4 001314   000000 474400 xsym               LDP4    DSEG1$
         4 001315   400024 442100                    SXL2    20,,PR4
         4 001316   002174 710000 4                  TRA     LOOP_END

      490    17649
      491    17650    4            SELECT ( %LINK_HOC_VAL);

      492    17651    4            BLK$ = PTR$ -> P$NODE.SUBLK$(0);

  17651  4 001317   200005 470500                    LDP0    PTR$,,AUTO
         4 001320   000003 236100                    LDQ     3,,PR0
         4 001321   200023 756100                    STQ     BLK$,,AUTO

      493    17652    4            CALL CHARBIN (J, OUT$SYM.TEXT);
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:82   

  17652  4 001322   200023 471500                    LDP1    BLK$,,AUTO
         4 001323   100004 236100                    LDQ     4,,PR1
         4 001324   000033 772000                    QRL     27
         4 001325   000000 620006                    EAX0    0,QL
         4 001326   000100 305540                    DTB
         4 001327   100004 230010                    NDSC9   4,,PR1                   cn=1,s=nosgn,sf=0,n=*X0
         4 001330   200010 000004                    NDSC9   J,,AUTO                  cn=0,s=lsgnf,sf=0,n=4

      494    17653    4            IF J > 4095 THEN

  17653  4 001331   200010 235100                    LDA     J,,AUTO
         4 001332   007777 115007                    CMPA    4095,DL
         4 001333   001341 604400 4                  TMOZ    s:17672

      495    17654    5            DO;

      496    17655                    %SCREAM (ERR#=E$LINK_CHAN_TOO_BIG, LEVEL=ERROR, MID='A');

  17667  4 001334   000031 630400 5                  EPPR0   25
         4 001335   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 001336   000000 701000 xent               TSX1    ASH$ERROR
         4 001337   000000 011000                    NOP     0

      497    17670    5               END; /*  Hoc > 4095  */

  17670  4 001340   002174 710000 4                  TRA     LOOP_END

      498    17671    4            ELSE
      499    17672    4               KL$DREC.LNK.HOC = J;

  17672  4 001341   000000 621005                    EAX1    0,AL
         4 001342   000000 473400 xsym               LDP3    DSEG1$
         4 001343   300025 441100                    SXL1    21,,PR3
         4 001344   002174 710000 4                  TRA     LOOP_END

      500    17673                                                              /**/
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:83   
      501    17674    4            SELECT( %LINK_DEST_VAL ) ;

      502    17675
      503    17676    4            BLK$ = PTR$ -> P$NODE.SUBLK$(0);

  17676  4 001345   100003 236100                    LDQ     3,,PR1
         4 001346   200023 756100                    STQ     BLK$,,AUTO

      504    17677    4            CNT = OUT$SYM.COUNT;

  17677  4 001347   200023 473500                    LDP3    BLK$,,AUTO
         4 001350   300004 236100                    LDQ     4,,PR3
         4 001351   000033 772000                    QRL     27
         4 001352   200006 756100                    STQ     CNT,,AUTO

      505    17678    5            IF CNT > 14 THEN DO;

  17678  4 001353   000016 116007                    CMPQ    14,DL
         4 001354   001362 604400 4                  TMOZ    s:17699

      506    17679        /*E*  ERROR:  ASA-E$BAD_DEST-C
      507    17680              MESSAGE: DESTINATION can be at most 14 decimal digits.
      508    17681        */
      509    17682                    %SCREAM( ERR#=E$BAD_DEST, LEVEL=ERROR, MID='A' );

  17694  4 001355   000032 630400 5                  EPPR0   26
         4 001356   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 001357   000000 701000 xent               TSX1    ASH$ERROR
         4 001360   000000 011000                    NOP     0

      510    17697    5               END;  /*  Dest value > 14 characters  */

  17697  4 001361   002174 710000 4                  TRA     LOOP_END

      511    17698    5            ELSE DO;

      512    17699    5               ADRN = '0'B;
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:84   

  17699  4 001362   000000 100400                    MLR     fill='000'O
         4 001363   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         4 001364   000003 000012 2                  ADSC9   ADRN                     cn=0,n=10

      513    17700    5               K = CNT / 2 - 1;

  17700  4 001365   000002 506007                    DIV     2,DL
         4 001366   000001 136007                    SBLQ    1,DL
         4 001367   200011 756100                    STQ     K,,AUTO

      514    17701    5               ADRN.LNG# = CNT ;

  17701  4 001370   200006 236100                    LDQ     CNT,,AUTO
         4 001371   000033 736000                    QLS     27
         4 001372   000003 552040 2                  STBQ    ADRN,'40'O

      515    17702    5               J = MOD( CNT, 2 ) ;

  17702  4 001373   200006 236100                    LDQ     CNT,,AUTO
         4 001374   000002 506007                    DIV     2,DL
         4 001375   200010 755100                    STA     J,,AUTO

      516    17703    5               IF J = 1 THEN

  17703  4 001376   000001 115007                    CMPA    1,DL
         4 001377   001416 601000 4                  TNZ     s:17708

      517    17704    6               DO;

      518    17705    6                  CALL CHARBIN( J, SUBSTR(OUT$SYM.TEXT,CNT-1,1)) ;

  17705  4 001400   300004 236100                    LDQ     4,,PR3
         4 001401   000033 772000                    QRL     27
         4 001402   200006 235100                    LDA     CNT,,AUTO
         4 001403   000100 305505                    DTB
         4 001404   300004 030001                    NDSC9   4,A,PR3                  cn=0,s=nosgn,sf=0,n=1
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:85   
         4 001405   200010 000004                    NDSC9   J,,AUTO                  cn=0,s=lsgnf,sf=0,n=4

      519    17706    6                  ADRN.ADR.BCD1#(K+1) = J ;

  17706  4 001406   200011 236100                    LDQ     K,,AUTO
         4 001407   000011 402007                    MPY     9,DL
         4 001410   000000 116003                    CMPQ    0,DU
         4 001411   001413 605000 4                  TPL     s:17706+5
         4 001412   000044 036003                    ADLQ    36,DU
         4 001413   003006 061500                    CSR     bolr='003'O
         4 001414   200010 000044                    BDSC    J,,AUTO                  by=0,bit=0,n=36
         4 001415   000003 410004 2                  BDSC    ADRN,Q                   by=2,bit=1,n=4

      520    17707    6                  END;   /*  Odd length on dest  */

      521    17708    6               DO J = 0 TO K;

  17708  4 001416   200010 450100                    STZ     J,,AUTO
         4 001417   001460 710000 4                  TRA     s:17713+1

      522    17709    6                  CALL CHARBIN( CNT, SUBSTR(OUT$SYM.TEXT,J*2,1) );

  17709  4 001420   200023 470500                    LDP0    BLK$,,AUTO
         4 001421   000004 236100                    LDQ     4,,PR0
         4 001422   000033 772000                    QRL     27
         4 001423   200010 235100                    LDA     J,,AUTO
         4 001424   000001 735000                    ALS     1
         4 001425   000100 305505                    DTB
         4 001426   000004 230001                    NDSC9   4,A,PR0                  cn=1,s=nosgn,sf=0,n=1
         4 001427   200006 000004                    NDSC9   CNT,,AUTO                cn=0,s=lsgnf,sf=0,n=4

      523    17710    6                  ADRN.ADR.BCD1#(J) = CNT;

  17710  4 001430   200010 236100                    LDQ     J,,AUTO
         4 001431   000011 402007                    MPY     9,DL
         4 001432   000000 116003                    CMPQ    0,DU
         4 001433   001435 605000 4                  TPL     s:17710+5
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:86   
         4 001434   000044 036003                    ADLQ    36,DU
         4 001435   003006 061500                    CSR     bolr='003'O
         4 001436   200006 000044                    BDSC    CNT,,AUTO                by=0,bit=0,n=36
         4 001437   000003 210004 2                  BDSC    ADRN,Q                   by=1,bit=1,n=4

      524    17711    6                  CALL CHARBIN( CNT, SUBSTR(OUT$SYM.TEXT,J*2+1,1) );

  17711  4 001440   000004 236100                    LDQ     4,,PR0
         4 001441   000033 772000                    QRL     27
         4 001442   200010 235100                    LDA     J,,AUTO
         4 001443   000001 735000                    ALS     1
         4 001444   000100 305505                    DTB
         4 001445   000004 430001                    NDSC9   4,A,PR0                  cn=2,s=nosgn,sf=0,n=1
         4 001446   200006 000004                    NDSC9   CNT,,AUTO                cn=0,s=lsgnf,sf=0,n=4

      525    17712    6                  ADRN.ADR.BCD2#(J) = CNT;

  17712  4 001447   200010 236100                    LDQ     J,,AUTO
         4 001450   000011 402007                    MPY     9,DL
         4 001451   000000 116003                    CMPQ    0,DU
         4 001452   001454 605000 4                  TPL     s:17712+5
         4 001453   000044 036003                    ADLQ    36,DU
         4 001454   003006 061500                    CSR     bolr='003'O
         4 001455   200006 000044                    BDSC    CNT,,AUTO                by=0,bit=0,n=36
         4 001456   000003 250004 2                  BDSC    ADRN,Q                   by=1,bit=5,n=4

      526    17713    6                  END;   /*  Transfer node text to temp storage  */

  17713  4 001457   200010 054100                    AOS     J,,AUTO
         4 001460   200010 236100                    LDQ     J,,AUTO
         4 001461   200011 116100                    CMPQ    K,,AUTO
         4 001462   001420 604400 4                  TMOZ    s:17709

      527    17714    5               KL$DREC.LNK.DEST = ADRN ;

  17714  4 001463   000000 470400 xsym               LDP0    DSEG1$
         4 001464   000100 100400                    MLR     fill='000'O
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:87   
         4 001465   000003 000010 2                  ADSC9   ADRN                     cn=0,n=8
         4 001466   000031 400010                    ADSC9   25,,PR0                  cn=2,n=8

      528    17715    5               LINK_DEST_SET = AS_TRUE;

  17715  4 001467   000000 236000 xsym               LDQ     AS_TRUE
         4 001470   400000 376003                    ANQ     -131072,DU
         4 001471   200442 756100                    STQ     LINK_DEST_SET,,AUTO

      529    17716    5               END;   /*  Destination < 14 characters  */

  17716  4 001472   002174 710000 4                  TRA     LOOP_END

      530    17717                                                              /**/
      531    17718    4            SELECT( %VC_DEST_VAL );

      532    17719
      533    17720    4            IF PTR$ -> P$NODE.SUBNODES = 0 THEN

  17720  4 001473   100001 221100                    LDX1    1,,PR1
         4 001474   001501 601000 4                  TNZ     s:17723

      534    17721    4               KL$LNKVC.NODE# = 254;

  17721  4 001475   000000 473400 xsym               LDP3    DSEG3$
         4 001476   000376 236003                    LDQ     254,DU
         4 001477   300012 552120                    STBQ    10,'20'O,PR3
         4 001500   002174 710000 4                  TRA     LOOP_END

      535    17722    5            ELSE DO;  /*  There is a subnode  */

      536    17723    5               BLK$ = PTR$ -> P$NODE.SUBLK$(0) ;

  17723  4 001501   100003 236100                    LDQ     3,,PR1
         4 001502   200023 756100                    STQ     BLK$,,AUTO

      537    17724    5               IF BLK$->P$NODE.CODE = %VC_IS_NODE_VAL THEN
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:88   

  17724  4 001503   200023 473500                    LDP3    BLK$,,AUTO
         4 001504   300000 722100                    LXL2    0,,PR3
         4 001505   000001 102003                    CMPX2   1,DU
         4 001506   001513 601000 4                  TNZ     s:17727

      538    17725    5                  KL$LNKVC.NODE# = 253;

  17725  4 001507   000000 474400 xsym               LDP4    DSEG3$
         4 001510   000375 236003                    LDQ     253,DU
         4 001511   400012 552120                    STBQ    10,'20'O,PR4
         4 001512   002174 710000 4                  TRA     LOOP_END

      539    17726    6               ELSE DO;  /*  Node is a symbol  */

      540    17727    6                  CNT = OUT$SYM.COUNT ;

  17727  4 001513   300004 236100                    LDQ     4,,PR3
         4 001514   000033 772000                    QRL     27
         4 001515   200006 756100                    STQ     CNT,,AUTO

      541    17728    6                  KL$LNKVC.DST# = OUT$SYM.TEXT ;

  17728  4 001516   300004 236100                    LDQ     4,,PR3
         4 001517   000033 772000                    QRL     27
         4 001520   000000 621006                    EAX1    0,QL
         4 001521   000000 474400 xsym               LDP4    DSEG3$
         4 001522   040100 100540                    MLR     fill='040'O
         4 001523   300004 200011                    ADSC9   4,,PR3                   cn=1,n=*X1
         4 001524   400005 000010                    ADSC9   5,,PR4                   cn=0,n=8

      542    17729    6                  FPT_NODEINFO.V.NODENAME# = KL$LNKVC.DST#;

  17729  4 001525   040000 100500                    MLR     fill='040'O
         4 001526   400005 000010                    ADSC9   5,,PR4                   cn=0,n=8
         4 001527   000016 000010 2                  ADSC9   FPT_NODEINFO+4           cn=0,n=8

PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:89   
      543    17730    6                  CALL M$NODEINFO(FPT_NODEINFO)

  17730  4 001530   000012 630400 2                  EPPR0   FPT_NODEINFO
         4 001531   560031 713400                    CLIMB   alt,+57369
         4 001532   400400 401760                    pmme    nvectors=2
         4 001533   001541 702000 4                  TSX2    s:17747

      544    17731    7                  WHENRETURN DO;

      545    17732    7                     KL$LNKVC.NODE# = VLR_NODEINFO.NODENUM#;

  17732  4 001534   000000 470400 xsym               LDP0    DSEG3$
         4 001535   000024 236000 2                  LDQ     VLR_NODEINFO+2
         4 001536   000011 772000                    QRL     9
         4 001537   000012 552120                    STBQ    10,'20'O,PR0

      546    17733    7                     END;  /*  Whenreturn from M$NODEINFO  */

  17733  4 001540   001552 710000 4                  TRA     s:17756

      547    17734    7                  WHENALTRETURN DO;

      548    17735                          %SCREAM(ERR#=E$VC_DESTUD, LEVEL=ERROR, MID='A' );

  17747  4 001541   000033 630400 5                  EPPR0   27
         4 001542   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 001543   000000 701000 xent               TSX1    ASH$ERROR
         4 001544   000000 011000                    NOP     0

      549    17750        /*E* ERROR: ASA-E$VC_DESTUD-4
      550    17751             MESSAGE: Destination node is not defined.
      551    17752        */
      552    17753    7                     KL$LNKVC.DST# = ' ';

  17753  4 001545   000000 470400 xsym               LDP0    DSEG3$
         4 001546   000035 235000 xsym               LDA     B_VECTNIL+29
         4 001547   000035 236000 xsym               LDQ     B_VECTNIL+29
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:90   
         4 001550   000005 755100                    STA     5,,PR0
         4 001551   000006 756100                    STQ     6,,PR0

      553    17754    7                     END;  /*  Whenaltreturn from M$NODEINFO  */

      554    17755    6                  END;  /*  Code = symbol  */

      555    17756    5               END;  /*  There is a subnode  */

  17756  4 001552   002174 710000 4                  TRA     LOOP_END

      556    17757
      557    17758    4            SELECT( %VC_CUG_VAL ) ;

      558    17759    4            BLK$ = PTR$ -> P$NODE.SUBLK$(0) ;

  17759  4 001553   100003 236100                    LDQ     3,,PR1
         4 001554   200023 756100                    STQ     BLK$,,AUTO

      559    17760    4            CNT = OUT$SYM.COUNT ;

  17760  4 001555   200023 473500                    LDP3    BLK$,,AUTO
         4 001556   300004 236100                    LDQ     4,,PR3
         4 001557   000033 772000                    QRL     27
         4 001560   200006 756100                    STQ     CNT,,AUTO

      560    17761    4            IF OUT$SYM.CODE = %NONE_VAL THEN

  17761  4 001561   300000 721100                    LXL1    0,,PR3
         4 001562   000007 101003                    CMPX1   7,DU
         4 001563   001570 601000 4                  TNZ     s:17764

      561    17762    4               KL$LNKVC.CUG.LNG# = 0;

  17762  4 001564   000000 474400 xsym               LDP4    DSEG3$
         4 001565   000034 236000 5                  LDQ     28
         4 001566   400002 356100                    ANSQ    2,,PR4
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:91   
         4 001567   002174 710000 4                  TRA     LOOP_END

      562    17763    5            ELSE DO;

      563    17764    6               IF CNT > 4 THEN DO ;

  17764  4 001570   000004 116007                    CMPQ    4,DL
         4 001571   001577 604400 4                  TMOZ    s:17785

      564    17765        /*E* ERROR:  ASA-E$VC_CUG-C
      565    17766             MESSAGE: CUG can be at most 4 decimal digits.
      566    17767        */
      567    17768                       %SCREAM( ERR#=E$VC_CUG, LEVEL=ERROR, MID='A') ;

  17780  4 001572   000035 630400 5                  EPPR0   29
         4 001573   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 001574   000000 701000 xent               TSX1    ASH$ERROR
         4 001575   000000 011000                    NOP     0

      568    17783    6                  END ; /*  Cnt > 4  */

  17783  4 001576   002174 710000 4                  TRA     LOOP_END

      569    17784    6               ELSE DO;

      570    17785    6                  TEMP_STR = '0000';

  17785  4 001577   000117 236000 3                  LDQ     PRO_HDR+33
         4 001600   200437 756100                    STQ     TEMP_STR,,AUTO

      571    17786    6                  DISP = 4 - OUT$SYM.COUNT;

  17786  4 001601   300004 236100                    LDQ     4,,PR3
         4 001602   000033 772000                    QRL     27
         4 001603   000027 676000 xsym               ERQ     B_VECTNIL+23
         4 001604   000005 036007                    ADLQ    5,DL
         4 001605   200440 756100                    STQ     DISP,,AUTO
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:92   

      572    17787    6                  SUBSTR (TEMP_STR,DISP,CNT) = OUT$SYM.TEXT;

  17787  4 001606   300004 236100                    LDQ     4,,PR3
         4 001607   000033 772000                    QRL     27
         4 001610   000000 622006                    EAX2    0,QL
         4 001611   200006 723100                    LXL3    CNT,,AUTO
         4 001612   200440 235100                    LDA     DISP,,AUTO
         4 001613   040145 100540                    MLR     fill='040'O
         4 001614   300004 200012                    ADSC9   4,,PR3                   cn=1,n=*X2
         4 001615   200437 000013                    ADSC9   TEMP_STR,A,AUTO          cn=0,n=*X3

      573    17788    7                  DO I = 0 TO 3;

  17788  4 001616   200007 450100                    STZ     I,,AUTO

      574    17789    7                     CALL CHARBIN( J, SUBSTR(TEMP_STR,I,1)) ;

  17789  4 001617   200007 235100                    LDA     I,,AUTO
         4 001620   000100 305505                    DTB
         4 001621   200437 030001                    NDSC9   TEMP_STR,A,AUTO          cn=0,s=nosgn,sf=0,n=1
         4 001622   200010 000004                    NDSC9   J,,AUTO                  cn=0,s=lsgnf,sf=0,n=4

      575    17790
      576    17791    8                     DO SELECT (I);

  17791  4 001623   200007 236100                    LDQ     I,,AUTO
         4 001624   000001 116007                    CMPQ    1,DL
         4 001625   001635 604000 4                  TMI     s:17791+10
         4 001626   001647 600000 4                  TZE     s:17799
         4 001627   000002 116007                    CMPQ    2,DL
         4 001630   001673 604000 4                  TMI     s:17810
         4 001631   001656 600000 4                  TZE     s:17803
         4 001632   000003 116007                    CMPQ    3,DL
         4 001633   001673 601000 4                  TNZ     s:17810
         4 001634   001665 710000 4                  TRA     s:17807
         4 001635   000000 116003                    CMPQ    0,DU
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:93   
         4 001636   001673 601000 4                  TNZ     s:17810
         4 001637   001640 710000 4                  TRA     s:17795

      577    17792
      578    17793    8                        SELECT (0);

      579    17794
      580    17795    8                        KL$LNKVC.CUG.BCD1# = J ;

  17795  4 001640   000000 470400 xsym               LDP0    DSEG3$
         4 001641   200010 236100                    LDQ     J,,AUTO
         4 001642   000026 736000                    QLS     22
         4 001643   000002 676100                    ERQ     2,,PR0
         4 001644   000360 376003                    ANQ     240,DU
         4 001645   000002 656100                    ERSQ    2,,PR0
         4 001646   001673 710000 4                  TRA     s:17810

      581    17796
      582    17797    8                        SELECT (1);

      583    17798
      584    17799    8                        KL$LNKVC.CUG.BCD2# = J ;

  17799  4 001647   000000 470400 xsym               LDP0    DSEG3$
         4 001650   200010 236100                    LDQ     J,,AUTO
         4 001651   000022 736000                    QLS     18
         4 001652   000002 676100                    ERQ     2,,PR0
         4 001653   000017 376003                    ANQ     15,DU
         4 001654   000002 656100                    ERSQ    2,,PR0
         4 001655   001673 710000 4                  TRA     s:17810

      585    17800
      586    17801    8                        SELECT (2);

      587    17802
      588    17803    8                        KL$LNKVC.CUG.BCD3# = J ;

PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:94   
  17803  4 001656   000000 470400 xsym               LDP0    DSEG3$
         4 001657   200010 236100                    LDQ     J,,AUTO
         4 001660   000015 736000                    QLS     13
         4 001661   000002 676100                    ERQ     2,,PR0
         4 001662   360000 376007                    ANQ     122880,DL
         4 001663   000002 656100                    ERSQ    2,,PR0
         4 001664   001673 710000 4                  TRA     s:17810

      589    17804
      590    17805    8                        SELECT (3);

      591    17806
      592    17807    8                        KL$LNKVC.CUG.BCD4# = J ;

  17807  4 001665   000000 470400 xsym               LDP0    DSEG3$
         4 001666   200010 236100                    LDQ     J,,AUTO
         4 001667   000011 736000                    QLS     9
         4 001670   000002 676100                    ERQ     2,,PR0
         4 001671   017000 376007                    ANQ     7680,DL
         4 001672   000002 656100                    ERSQ    2,,PR0

      593    17808
      594    17809    8                        END; /*  Case i  */

      595    17810    7                     END; /*  Do i  */

  17810  4 001673   200007 054100                    AOS     I,,AUTO
         4 001674   200007 235100                    LDA     I,,AUTO
         4 001675   000003 115007                    CMPA    3,DL
         4 001676   001617 604400 4                  TMOZ    s:17789

      596    17811
      597    17812    7                  DO SELECT (CNT);

  17812  4 001677   200006 236100                    LDQ     CNT,,AUTO
         4 001700   000001 116007                    CMPQ    1,DL
         4 001701   001714 604000 4                  TMI     s:17812+13
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:95   
         4 001702   001723 600000 4                  TZE     s:17818
         4 001703   000003 116007                    CMPQ    3,DL
         4 001704   001711 604000 4                  TMI     s:17812+10
         4 001705   001731 600000 4                  TZE     s:17821
         4 001706   000004 116007                    CMPQ    4,DL
         4 001707   002174 601000 4                  TNZ     LOOP_END
         4 001710   001731 710000 4                  TRA     s:17821
         4 001711   000002 116007                    CMPQ    2,DL
         4 001712   002174 601000 4                  TNZ     LOOP_END
         4 001713   001723 710000 4                  TRA     s:17818
         4 001714   000000 116003                    CMPQ    0,DU
         4 001715   002174 601000 4                  TNZ     LOOP_END
         4 001716   001717 710000 4                  TRA     s:17815

      598    17813
      599    17814    7                     SELECT (0) ;

      600    17815    7                     KL$LNKVC.CUG.LNG# = 0;

  17815  4 001717   000000 470400 xsym               LDP0    DSEG3$
         4 001720   000034 236000 5                  LDQ     28
         4 001721   000002 356100                    ANSQ    2,,PR0
         4 001722   002174 710000 4                  TRA     LOOP_END

      601    17816
      602    17817    7                     SELECT (1,2) ;

      603    17818    7                     KL$LNKVC.CUG.LNG# = 1;

  17818  4 001723   000000 470400 xsym               LDP0    DSEG3$
         4 001724   000002 236100                    LDQ     2,,PR0
         4 001725   000034 376000 5                  ANQ     28
         4 001726   100000 276003                    ORQ     32768,DU
         4 001727   000002 756100                    STQ     2,,PR0
         4 001730   002174 710000 4                  TRA     LOOP_END

      604    17819
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:96   
      605    17820    7                     SELECT (3,4) ;

      606    17821    7                     KL$LNKVC.CUG.LNG# = 2;

  17821  4 001731   000000 470400 xsym               LDP0    DSEG3$
         4 001732   000002 236100                    LDQ     2,,PR0
         4 001733   000034 376000 5                  ANQ     28
         4 001734   200000 276003                    ORQ     65536,DU
         4 001735   000002 756100                    STQ     2,,PR0

      607    17822
      608    17823    7                     END; /*  Do case (cnt)  */

      609    17824    6                  END ; /*  Cnt <= 4  */

      610    17825    5               END; /* If OUT$SYM.TEXT ~= 'NONE' */

  17825  4 001736   002174 710000 4                  TRA     LOOP_END

      611    17826
      612    17827    4            SELECT( %VC_QOS_VAL, %LINK_QOS_VAL ) ;

      613    17828    4            BLK$ = PTR$ -> P$NODE.SUBLK$(0) ;

  17828  4 001737   100003 236100                    LDQ     3,,PR1
         4 001740   200023 756100                    STQ     BLK$,,AUTO

      614    17829    4            CALL CHARBIN( CNT, OUT$SYM.TEXT) ;

  17829  4 001741   200023 473500                    LDP3    BLK$,,AUTO
         4 001742   300004 236100                    LDQ     4,,PR3
         4 001743   000033 772000                    QRL     27
         4 001744   000000 621006                    EAX1    0,QL
         4 001745   000100 305540                    DTB
         4 001746   300004 230011                    NDSC9   4,,PR3                   cn=1,s=nosgn,sf=0,n=*X1
         4 001747   200006 000004                    NDSC9   CNT,,AUTO                cn=0,s=lsgnf,sf=0,n=4

PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:97   
      615    17830    5            IF CNT < 2 OR CNT > 255 THEN DO;

  17830  4 001750   200006 235100                    LDA     CNT,,AUTO
         4 001751   000002 115007                    CMPA    2,DL
         4 001752   001755 604000 4                  TMI     s:17846
         4 001753   000377 115007                    CMPA    255,DL
         4 001754   001762 604400 4                  TMOZ    s:17851

      616    17831        /*E* ERROR: ASA-E$QOS_OUT_OF_RANGE-0
      617    17832             MESSAGE:  QOS must be between 2 and 255, inclusive.
      618    17833        */
      619    17834                    %SCREAM (ERR#=%E$QOS_OUT_OF_RANGE, LEVEL=ERROR, MID='A');

  17846  4 001755   000036 630400 5                  EPPR0   30
         4 001756   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 001757   000000 701000 xent               TSX1    ASH$ERROR
         4 001760   000000 011000                    NOP     0

      620    17849    5               GOTO LOOP_END;

  17849  4 001761   002174 710000 4                  TRA     LOOP_END

      621    17850    5               END; /*  Qos out of range  */
      622    17851    4            IF LINK THEN

  17851  4 001762   200020 234100                    SZN     LINK,,AUTO
         4 001763   001771 605000 4                  TPL     s:17854

      623    17852    4               KL$DREC.LNK.QOS# = CNT ;

  17852  4 001764   000000 474400 xsym               LDP4    DSEG1$
         4 001765   200006 236100                    LDQ     CNT,,AUTO
         4 001766   000011 736000                    QLS     9
         4 001767   400033 552110                    STBQ    27,'10'O,PR4
         4 001770   001775 710000 4                  TRA     s:17856

      624    17853    4            ELSE
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:98   
      625    17854    4               KL$LNKVC.QOS# = CNT ;

  17854  4 001771   000000 474400 xsym               LDP4    DSEG3$
         4 001772   200006 236100                    LDQ     CNT,,AUTO
         4 001773   000033 736000                    QLS     27
         4 001774   400013 552140                    STBQ    11,'40'O,PR4

      626    17855                                                              /**/
      627    17856    4            BLK$ = PTR$ -> P$NODE.SUBLK$(0) ;

  17856  4 001775   100003 236100                    LDQ     3,,PR1
         4 001776   200023 756100                    STQ     BLK$,,AUTO

      628    17857    4            CALL CHARBIN( CNT, OUT$SYM.TEXT) ;

  17857  4 001777   200023 473500                    LDP3    BLK$,,AUTO
         4 002000   300004 236100                    LDQ     4,,PR3
         4 002001   000033 772000                    QRL     27
         4 002002   000000 621006                    EAX1    0,QL
         4 002003   000100 305540                    DTB
         4 002004   300004 230011                    NDSC9   4,,PR3                   cn=1,s=nosgn,sf=0,n=*X1
         4 002005   200006 000004                    NDSC9   CNT,,AUTO                cn=0,s=lsgnf,sf=0,n=4

      629    17858    4            KL$LNKVC.QOS# = CNT ;

  17858  4 002006   000000 474400 xsym               LDP4    DSEG3$
         4 002007   200006 236100                    LDQ     CNT,,AUTO
         4 002010   000033 736000                    QLS     27
         4 002011   400013 552140                    STBQ    11,'40'O,PR4
         4 002012   002174 710000 4                  TRA     LOOP_END

      630    17859
      631    17860    4            SELECT ( %VC_PERM_VAL);

      632    17861    4            IF PTR$->P$NODE.SUBLK$(0)->P$NODE.CODE = NO_VAL THEN

  17861  4 002013   100003 473500                    LDP3    3,,PR1
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:99   
         4 002014   300000 721100                    LXL1    0,,PR3
         4 002015   000002 101003                    CMPX1   2,DU
         4 002016   002023 601000 4                  TNZ     s:17864

      633    17862    4               KL$LNKVC.PERMANENT = '0'B;

  17862  4 002017   000000 474400 xsym               LDP4    DSEG3$
         4 002020   000037 236000 5                  LDQ     31
         4 002021   400013 356100                    ANSQ    11,,PR4
         4 002022   002174 710000 4                  TRA     LOOP_END

      634    17863    4            ELSE
      635    17864    4               KL$LNKVC.PERMANENT = '1'B;

  17864  4 002023   000000 474400 xsym               LDP4    DSEG3$
         4 002024   000200 236003                    LDQ     128,DU
         4 002025   400013 256100                    ORSQ    11,,PR4
         4 002026   002174 710000 4                  TRA     LOOP_END

      636    17865
      637    17866    4            SELECT ( %LINK_DEV_CIRCUITS_VAL);

      638    17867    4            BLK$ = PTR$ -> P$NODE.SUBLK$(0);

  17867  4 002027   100003 236100                    LDQ     3,,PR1
         4 002030   200023 756100                    STQ     BLK$,,AUTO

      639    17868    4            CALL CHARBIN (CNT, OUT$SYM.TEXT);

  17868  4 002031   200023 473500                    LDP3    BLK$,,AUTO
         4 002032   300004 236100                    LDQ     4,,PR3
         4 002033   000033 772000                    QRL     27
         4 002034   000000 621006                    EAX1    0,QL
         4 002035   000100 305540                    DTB
         4 002036   300004 230011                    NDSC9   4,,PR3                   cn=1,s=nosgn,sf=0,n=*X1
         4 002037   200006 000004                    NDSC9   CNT,,AUTO                cn=0,s=lsgnf,sf=0,n=4

PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:100  
      640    17869    4            IF CNT > 4095 THEN

  17869  4 002040   200006 235100                    LDA     CNT,,AUTO
         4 002041   007777 115007                    CMPA    4095,DL
         4 002042   002050 604400 4                  TMOZ    s:17889

      641    17870        /*E* ERROR: ASA-E$CIRCUITS_OUT_OF_RANGE-C
      642    17871             MESSAGE: CIRCUITS must be between 0 and 4095, inclusive.
      643    17872        */
      644    17873                    %SCREAM (ERR#=%E$CIRCUITS_OUT_OF_RANGE, LEVEL=ERROR, MID='A');

  17885  4 002043   000040 630400 5                  EPPR0   32
         4 002044   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 002045   000000 701000 xent               TSX1    ASH$ERROR
         4 002046   000000 011000                    NOP     0
         4 002047   002174 710000 4                  TRA     LOOP_END

      645    17888    4            ELSE
      646    17889    4               KL$LINKDEV.CIRCUITS# = CNT;

  17889  4 002050   000000 474400 xsym               LDP4    DSEG3$
         4 002051   000100 101500                    MRL     fill='000'O
         4 002052   200006 000004                    ADSC9   CNT,,AUTO                cn=0,n=4
         4 002053   400002 000002                    ADSC9   2,,PR4                   cn=0,n=2
         4 002054   002174 710000 4                  TRA     LOOP_END

      647    17890
      648    17891    4            SELECT ( %LINK_DEV_PROTOCOL_VAL);

      649    17892    4            BLK$ = PTR$ -> P$NODE.SUBLK$(0);

  17892  4 002055   100003 236100                    LDQ     3,,PR1
         4 002056   200023 756100                    STQ     BLK$,,AUTO

      650    17893    5            IF OUT$SYM.NDTYPE ~= %DEC# THEN DO;

  17893  4 002057   200023 473500                    LDP3    BLK$,,AUTO
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:101  
         4 002060   300000 236100                    LDQ     0,,PR3
         4 002061   000077 376003                    ANQ     63,DU
         4 002062   000022 116003                    CMPQ    18,DU
         4 002063   002076 600000 4                  TZE     s:17898

      651    17894    5               BLK$ = PTR$ -> P$NODE.SUBLK$(0);

  17894  4 002064   100003 236100                    LDQ     3,,PR1
         4 002065   200023 756100                    STQ     BLK$,,AUTO

      652    17895    5               CALL ASD$HEX2OCT(OUT$SYM, CNT);

  17895  4 002066   200006 633500                    EPPR3   CNT,,AUTO
         4 002067   200457 453500                    STP3    PRO_END$+3,,AUTO
         4 002070   200456 756100                    STQ     PRO_END$+2,,AUTO
         4 002071   200456 630500                    EPPR0   PRO_END$+2,,AUTO
         4 002072   000020 631400 xsym               EPPR1   B_VECTNIL+16
         4 002073   000000 701000 xent               TSX1    ASD$HEX2OCT
         4 002074   000000 011000                    NOP     0

      653    17896    5               END;

  17896  4 002075   002104 710000 4                  TRA     s:17899

      654    17897    4            ELSE
      655    17898    4               CALL CHARBIN (CNT, OUT$SYM.TEXT);

  17898  4 002076   300004 236100                    LDQ     4,,PR3
         4 002077   000033 772000                    QRL     27
         4 002100   000000 621006                    EAX1    0,QL
         4 002101   000100 305540                    DTB
         4 002102   300004 230011                    NDSC9   4,,PR3                   cn=1,s=nosgn,sf=0,n=*X1
         4 002103   200006 000004                    NDSC9   CNT,,AUTO                cn=0,s=lsgnf,sf=0,n=4

      656    17899    4            IF CNT > 255 THEN

  17899  4 002104   200006 235100                    LDA     CNT,,AUTO
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:102  
         4 002105   000377 115007                    CMPA    255,DL
         4 002106   002114 604400 4                  TMOZ    s:17919

      657    17900        /*E* ERROR: ASA-E$PROTOCOL_OUT_OF_RANGE-C
      658    17901             MESSAGE:  PROTOCOL must be between 0 and 255, inclusive.
      659    17902        */
      660    17903                    %SCREAM (ERR#=E$PROTOCOL_OUT_OF_RANGE,LEVEL=ERROR,MID='A');

  17915  4 002107   000041 630400 5                  EPPR0   33
         4 002110   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 002111   000000 701000 xent               TSX1    ASH$ERROR
         4 002112   000000 011000                    NOP     0
         4 002113   002174 710000 4                  TRA     LOOP_END

      661    17918    4            ELSE
      662    17919    4               KL$LINKDEV.PROTOCOL# = CNT;

  17919  4 002114   000000 470400 xsym               LDP0    DSEG3$
         4 002115   000100 101500                    MRL     fill='000'O
         4 002116   200006 000004                    ADSC9   CNT,,AUTO                cn=0,n=4
         4 002117   000002 400001                    ADSC9   2,,PR0                   cn=2,n=1
         4 002120   002174 710000 4                  TRA     LOOP_END

      663    17920
      664    17921    4            SELECT ( %LINK_DEV_SUBADDR_VAL);

      665    17922    4            BLK$ = PTR$ -> P$NODE.SUBLK$(0);

  17922  4 002121   100003 236100                    LDQ     3,,PR1
         4 002122   200023 756100                    STQ     BLK$,,AUTO

      666    17923    4            CALL CHARBIN (CNT, OUT$SYM.TEXT);

  17923  4 002123   200023 473500                    LDP3    BLK$,,AUTO
         4 002124   300004 236100                    LDQ     4,,PR3
         4 002125   000033 772000                    QRL     27
         4 002126   000000 621006                    EAX1    0,QL
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:103  
         4 002127   000100 305540                    DTB
         4 002130   300004 230011                    NDSC9   4,,PR3                   cn=1,s=nosgn,sf=0,n=*X1
         4 002131   200006 000004                    NDSC9   CNT,,AUTO                cn=0,s=lsgnf,sf=0,n=4

      667    17924    4            IF CNT > 99 THEN

  17924  4 002132   200006 235100                    LDA     CNT,,AUTO
         4 002133   000143 115007                    CMPA    99,DL
         4 002134   002142 604400 4                  TMOZ    s:17944

      668    17925        /*E* ERROR: ASA-E$SUBADDR_OUT_OF_RANGE-C
      669    17926             MESSAGE:  SUBADDRESS must be between 0 and 99, inclusive.
      670    17927        */
      671    17928                    %SCREAM (ERR#=E$SUBADDR_OUT_OF_RANGE,LEVEL=ERROR,MID='A');

  17940  4 002135   000042 630400 5                  EPPR0   34
         4 002136   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 002137   000000 701000 xent               TSX1    ASH$ERROR
         4 002140   000000 011000                    NOP     0
         4 002141   002174 710000 4                  TRA     LOOP_END

      672    17943    4            ELSE
      673    17944    4               KL$LINKDEV.SUBADDR# = CNT;

  17944  4 002142   000000 474400 xsym               LDP4    DSEG3$
         4 002143   000100 101500                    MRL     fill='000'O
         4 002144   200006 000004                    ADSC9   CNT,,AUTO                cn=0,n=4
         4 002145   400002 600001                    ADSC9   2,,PR4                   cn=3,n=1
         4 002146   002174 710000 4                  TRA     LOOP_END

      674    17945
      675    17946    4            SELECT ( %LINK_DEV_MODE_VAL ) ;

      676    17947    4            BLK$ = PTR$ -> P$NODE.SUBLK$(0) ;

  17947  4 002147   100003 236100                    LDQ     3,,PR1
         4 002150   200023 756100                    STQ     BLK$,,AUTO
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:104  

      677    17948    4            KL$LINKDEV.MODE = BLK$ -> P$NODE.CODE;

  17948  4 002151   200023 473500                    LDP3    BLK$,,AUTO
         4 002152   000000 474400 xsym               LDP4    DSEG3$
         4 002153   003100 061500                    CSR     bolr='003'O
         4 002154   300000 400022                    BDSC    0,,PR3                   by=2,bit=0,n=18
         4 002155   400003 010010                    BDSC    3,,PR4                   by=0,bit=1,n=8
         4 002156   002174 710000 4                  TRA     LOOP_END

      678    17949
      679    17950    4            SELECT( END_VAL, BLANK_LINE_VAL );

      680    17951    4            MORE = '0'B;

  17951  4 002157   200013 450100                    STZ     MORE,,AUTO
         4 002160   002174 710000 4                  TRA     LOOP_END

      681    17952
      682    17953    4            SELECT( HELP_VAL ) ;

      683    17954    4            CALL ASH$HELP ;

  17954  4 002161   000002 631400 xsym               EPPR1   B_VECTNIL+2
         4 002162   000000 701000 xent               TSX1    ASH$HELP
         4 002163   000000 011000                    NOP     0
         4 002164   002174 710000 4                  TRA     LOOP_END

      684    17955                                                              /**/
      685    17956    4            SELECT( QUESTION_VAL ) ;

      686    17957    4            CALL ASH$QUEST ;

  17957  4 002165   000002 631400 xsym               EPPR1   B_VECTNIL+2
         4 002166   000000 701000 xent               TSX1    ASH$QUEST
         4 002167   000000 011000                    NOP     0
         4 002170   002174 710000 4                  TRA     LOOP_END
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:105  

      687    17958                                                              /**/
      688    17959    4            SELECT( DQUESTION_VAL ) ;

      689    17960    4            CALL ASH$DQUEST ;

  17960  4 002171   000002 631400 xsym               EPPR1   B_VECTNIL+2
         4 002172   000000 701000 xent               TSX1    ASH$DQUEST
         4 002173   000000 011000                    NOP     0

      690    17961                                                              /**/
      691    17962    4            END ; /* Do case( code ) */

      692    17963    3   LOOP_END:
      693    17964    3         END ; /* Do i */

  17964  4 002174   200007 054100       LOOP_END     AOS     I,,AUTO
         4 002175   000000 470400 xsym               LDP0    NODE$
         4 002176   000001 236100                    LDQ     1,,PR0
         4 002177   000022 772000                    QRL     18
         4 002200   200007 116100                    CMPQ    I,,AUTO
         4 002201   000471 605400 4                  TPNZ    s:17349

      694    17965    2      END ; /* Do while */

  17965  4 002202   200013 234100                    SZN     MORE,,AUTO
         4 002203   000435 604000 4                  TMI     s:17336

      695    17966    2   IF LINK THEN DO ;

  17966  4 002204   200020 234100                    SZN     LINK,,AUTO
         4 002205   002227 605000 4                  TPL     s:18014

      696    17967    3      IF KL$DREC.LNK.HIC < KL$DREC.LNK.LIC THEN DO;

  17967  4 002206   000000 470400 xsym               LDP0    DSEG1$
         4 002207   000024 720100                    LXL0    20,,PR0
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:106  
         4 002210   000024 100100                    CMPX0   20,,PR0
         4 002211   002217 603000 4                  TRC     s:17990

      697    17968        /*E*  ERROR:  ASA-E$LIC_HIC-0
      698    17969              MESSAGE: Invalid LIC or invalid HIC.
      699    17970              MESSAGE1: The lowest incoming channel must be less than or
      700    17971                       equal to the highest incoming channel.
      701    17972        */
      702    17973              %SCREAM (ERR#=%E$LIC_HIC, LEVEL=ERROR, MID='A');

  17985  4 002212   000043 630400 5                  EPPR0   35
         4 002213   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 002214   000000 701000 xent               TSX1    ASH$ERROR
         4 002215   000000 011000                    NOP     0

      703    17988    3         GOTO LINK_LOOP;

  17988  4 002216   000441 710000 4                  TRA     LINK_LOOP

      704    17989    3         END;
      705    17990    3      IF KL$DREC.LNK.HOC < KL$DREC.LNK.LOC THEN DO;

  17990  4 002217   000025 721100                    LXL1    21,,PR0
         4 002220   000025 101100                    CMPX1   21,,PR0
         4 002221   002227 603000 4                  TRC     s:18014

      706    17991        /*E*  ERROR:  ASA-E$LOC_HOC-0
      707    17992              MESSAGE: Invalid LOC or invalid HOC.
      708    17993              MESSAGE1: The lowest outgoing channel must be less than or
      709    17994                       equal to the highest outgoing channel.
      710    17995        */
      711    17996              %SCREAM (ERR#=%E$LOC_HOC, LEVEL=ERROR, MID='A');

  18008  4 002222   000044 630400 5                  EPPR0   36
         4 002223   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 002224   000000 701000 xent               TSX1    ASH$ERROR
         4 002225   000000 011000                    NOP     0
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:107  

      712    18011    3         GOTO LINK_LOOP;

  18011  4 002226   000441 710000 4                  TRA     LINK_LOOP

      713    18012    3         END;
      714    18013    2      END;
      715    18014    2   IF KL$DREC.PNAME.TXT=' ' THEN DO;

  18014  4 002227   000000 470400 xsym               LDP0    DSEG1$
         4 002230   040000 106500                    CMPC    fill='040'O
         4 002231   000004 200013                    ADSC9   4,,PR0                   cn=1,n=11
         4 002232   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         4 002233   002246 601000 4                  TNZ     s:18036

      716    18015        /*E* ERROR: ASA-E$LINKPRODFLT-0
      717    18016             MESSAGE: No profile specified, using $LINK, the default.
      718    18017        */
      719    18018           %SCREAM( ERR#=E$LINKPRODFLT, LEVEL=WARN, MID='A' ) ;

  18028  4 002234   000045 630400 5                  EPPR0   37
         4 002235   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 002236   000000 701000 xent               TSX1    ASH$WARN
         4 002237   000000 011000                    NOP     0

      720    18033    2      KL$DREC.PNAME.TXT = '$LINK';

  18033  4 002240   000000 470400 xsym               LDP0    DSEG1$
         4 002241   040100 100400                    MLR     fill='040'O
         4 002242   000127 000005 3                  ADSC9   PRO_HDR+41               cn=0,n=5
         4 002243   000004 200013                    ADSC9   4,,PR0                   cn=1,n=11

      721    18034    2      KL$DREC.PNAME.CNT = 5;

  18034  4 002244   005000 236003                    LDQ     2560,DU
         4 002245   000004 552140                    STBQ    4,'40'O,PR0

PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:108  
      722    18035    2      END;

      723    18036    2   IF VIRCIR THEN DO ;

  18036  4 002246   200021 234100                    SZN     VIRCIR,,AUTO
         4 002247   002374 605000 4                  TPL     s:18102

      724    18037    3      IF KL$LNKVC.PRONM.TXT = ' ' THEN DO ;

  18037  4 002250   000000 471400 xsym               LDP1    DSEG3$
         4 002251   040000 106500                    CMPC    fill='040'O
         4 002252   100007 200013                    ADSC9   7,,PR1                   cn=1,n=11
         4 002253   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         4 002254   002302 601000 4                  TNZ     s:18065

      725    18038    4         IF KL$DREC.LNK.DFLTVCPRO.TXT = ' ' THEN DO;

  18038  4 002255   040000 106500                    CMPC    fill='040'O
         4 002256   000026 400013                    ADSC9   22,,PR0                  cn=2,n=11
         4 002257   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         4 002260   002274 601000 4                  TNZ     s:18061

      726    18039        /*E* ERROR: ASA-E$VIRCIRPRODFLT-0
      727    18040             MESSAGE: No profile specified, using $VIRCIR, the default.
      728    18041        */
      729    18042                 %SCREAM( ERR#=E$VIRCIRPRODFLT, LEVEL=WARN, MID='A' ) ;

  18052  4 002261   000046 630400 5                  EPPR0   38
         4 002262   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 002263   000000 701000 xent               TSX1    ASH$WARN
         4 002264   000000 011000                    NOP     0

      730    18057    4            KL$LNKVC.PRONM.TXT = '$VIRCIR';

  18057  4 002265   000000 470400 xsym               LDP0    DSEG3$
         4 002266   040100 100400                    MLR     fill='040'O
         4 002267   000132 000007 3                  ADSC9   PRO_HDR+44               cn=0,n=7
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:109  
         4 002270   000007 200013                    ADSC9   7,,PR0                   cn=1,n=11

      731    18058    4            KL$LNKVC.PRONM.CNT = 7;

  18058  4 002271   007000 236003                    LDQ     3584,DU
         4 002272   000007 552140                    STBQ    7,'40'O,PR0

      732    18059    4            END;

  18059  4 002273   002302 710000 4                  TRA     s:18065

      733    18060    4         ELSE DO;

      734    18061    4            KL$LNKVC.PRONM.TXT = KL$DREC.LNK.DFLTVCPRO.TXT;

  18061  4 002274   040100 100500                    MLR     fill='040'O
         4 002275   000026 400013                    ADSC9   22,,PR0                  cn=2,n=11
         4 002276   100007 200013                    ADSC9   7,,PR1                   cn=1,n=11

      735    18062    4            KL$LNKVC.PRONM.CNT = KL$DREC.LNK.DFLTVCPRO.CNT;

  18062  4 002277   000026 236100                    LDQ     22,,PR0
         4 002300   000011 736000                    QLS     9
         4 002301   100007 552140                    STBQ    7,'40'O,PR1

      736    18063    4            END;

      737    18064    3         END ;  /*  Default vircir profile  */

      738    18065    3      IF NOT VC_ADDR_SET AND NOT KL$LNKVC.PERMANENT AND CREATE THEN DO;

  18065  4 002302   200441 234100                    SZN     VC_ADDR_SET,,AUTO
         4 002303   002317 604000 4                  TMI     s:18087
         4 002304   000000 470400 xsym               LDP0    DSEG3$
         4 002305   000013 236100                    LDQ     11,,PR0
         4 002306   000200 316003                    CANQ    128,DU
         4 002307   002317 601000 4                  TNZ     s:18087
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:110  
         4 002310   200026 234100                    SZN     CREATE,,AUTO
         4 002311   002317 605000 4                  TPL     s:18087

      739    18066        /*E* ERROR: ASA-E$NEEDADDR-0
      740    18067             MESSAGE: An address must be specified for a non-permanent vircir.
      741    18068        */
      742    18069              %SCREAM( ERR#=E$NEEDADDR, LEVEL=ERROR, MID='A' ) ;

  18081  4 002312   000047 630400 5                  EPPR0   39
         4 002313   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 002314   000000 701000 xent               TSX1    ASH$ERROR
         4 002315   000000 011000                    NOP     0

      743    18084    3         GOTO LINK_LOOP;

  18084  4 002316   000441 710000 4                  TRA     LINK_LOOP

      744    18085    3         END;   /*  Need an address for a non permanent vc  */
      745    18086
      746    18087    2      IF KL$LNKVC.DST# = ' ' THEN

  18087  4 002317   000000 470400 xsym               LDP0    DSEG3$
         4 002320   040000 106500                    CMPC    fill='040'O
         4 002321   000005 000010                    ADSC9   5,,PR0                   cn=0,n=8
         4 002322   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         4 002323   002326 601000 4                  TNZ     s:18089

      747    18088    2         KL$LNKVC.NODE# = 255;

  18088  4 002324   000377 236003                    LDQ     255,DU
         4 002325   000012 552120                    STBQ    10,'20'O,PR0

      748    18089    3      IF NOT FOUND THEN DO;

  18089  4 002326   200017 234100                    SZN     FOUND,,AUTO
         4 002327   002340 604000 4                  TMI     s:18094

PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:111  
      749    18090    3         KL$DREC.LNK.BLKHDR.NSUBS = KL$DREC.LNK.BLKHDR.NSUBS + 1;

  18090  4 002330   000000 471400 xsym               LDP1    DSEG1$
         4 002331   100020 236100                    LDQ     16,,PR1
         4 002332   000001 036003                    ADLQ    1,DU
         4 002333   100020 552120                    STBQ    16,'20'O,PR1

      750    18091    3         PTR$ = DEV$;

  18091  4 002334   200025 236100                    LDQ     DEV$,,AUTO
         4 002335   200005 756100                    STQ     PTR$,,AUTO

      751    18092    3         DEV_SIZEW = DEV_SIZEW + SIZEW(KL_LNKVC);

  18092  4 002336   000014 236007                    LDQ     12,DL
         4 002337   200033 056100                    ASQ     DEV_SIZEW,,AUTO

      752    18093    3         END;

      753    18094    2      SIZE = POFFC (DEV_STOP$,DSEG1$)+SIZEW(KL_LNKVC);

  18094  4 002340   000000 236000 xsym               LDQ     DSEG1$
         4 002341   000020 772000                    QRL     16
         4 002342   200456 756100                    STQ     PRO_END$+2,,AUTO
         4 002343   200032 236100                    LDQ     DEV_STOP$,,AUTO
         4 002344   000020 772000                    QRL     16
         4 002345   200456 136100                    SBLQ    PRO_END$+2,,AUTO
         4 002346   000014 036007                    ADLQ    12,DL
         4 002347   200030 756100                    STQ     SIZE,,AUTO

      754    18095    3      IF SIZE > DSEG1SIZE THEN DO;

  18095  4 002350   002367 604000 4                  TMI     s:18099
         4 002351   000000 116000 xsym               CMPQ    DSEG1SIZE
         4 002352   002367 602000 4                  TNC     s:18099
         4 002353   002367 600000 4                  TZE     s:18099

PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:112  
      755    18096    3         SIZE = (SIZE + 4095) / 4096;

  18096  4 002354   007777 036007                    ADLQ    4095,DL
         4 002355   010000 506007                    DIV     4096,DL
         4 002356   200030 756100                    STQ     SIZE,,AUTO

      756    18097    3         CALL ASB$GET_MORE_SEG(1,SIZE) ALTRET(GETSEG_ERR);

  18097  4 002357   200030 631500                    EPPR1   SIZE,,AUTO
         4 002360   200457 451500                    STP1    PRO_END$+3,,AUTO
         4 002361   000006 236000 5                  LDQ     6
         4 002362   200456 756100                    STQ     PRO_END$+2,,AUTO
         4 002363   200456 630500                    EPPR0   PRO_END$+2,,AUTO
         4 002364   000020 631400 xsym               EPPR1   B_VECTNIL+16
         4 002365   000000 701000 xent               TSX1    ASB$GET_MORE_SEG
         4 002366   002631 702000 4                  TSX2    GETSEG_ERR

      757    18098    3         END;

      758    18099    2      DEV$->KL$LNKVC = KL$LNKVC;

  18099  4 002367   000000 470400 xsym               LDP0    DSEG3$
         4 002370   200025 471500                    LDP1    DEV$,,AUTO
         4 002371   000100 100500                    MLR     fill='000'O
         4 002372   000000 000060                    ADSC9   0,,PR0                   cn=0,n=48
         4 002373   100000 000060                    ADSC9   0,,PR1                   cn=0,n=48

      759    18100    2      END ;

      760    18101                                                              /* Output term rec */
      761    18102    2   IF LINKDEV THEN DO ;

  18102  4 002374   200022 234100                    SZN     LINKDEV,,AUTO
         4 002375   002507 605000 4                  TPL     s:18145

      762    18103    2      ARS = DSEG2SIZE;

PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:113  
  18103  4 002376   000000 235000 xsym               LDA     DSEG2SIZE
         4 002377   200012 755100                    STA     ARS,,AUTO

      763    18104    2      USERS_KEY.COUNT = 9;

  18104  4 002400   011000 236003                    LDQ     4608,DU
         4 002401   000000 552040 xsym               STBQ    USERS_KEY,'40'O

      764    18105    2      CALL CONCAT ( USERS_KEY.TXTC, KL$LINKDEV.LOGON#, '*');

  18105  4 002402   000000 470400 xsym               LDP0    DSEG3$
         4 002403   040000 100500                    MLR     fill='040'O
         4 002404   000004 000010                    ADSC9   4,,PR0                   cn=0,n=8
         4 002405   000000 200010 xsym               ADSC9   USERS_KEY                cn=1,n=8
         4 002406   040000 100400                    MLR     fill='040'O
         4 002407   000050 000001 5                  ADSC9   40                       cn=0,n=1
         4 002410   000002 200041 xsym               ADSC9   USERS_KEY+2              cn=1,n=33

      765    18106    2      CALL ASB$READ_HLP ( DSEG2$, ARS, 2 )

  18106  4 002411   000051 236000 5                  LDQ     41
         4 002412   200460 756100                    STQ     PRO_END$+4,,AUTO
         4 002413   200012 630500                    EPPR0   ARS,,AUTO
         4 002414   200457 450500                    STP0    PRO_END$+3,,AUTO
         4 002415   000052 236000 5                  LDQ     42
         4 002416   200456 756100                    STQ     PRO_END$+2,,AUTO
         4 002417   200456 630500                    EPPR0   PRO_END$+2,,AUTO
         4 002420   000021 631400 xsym               EPPR1   B_VECTNIL+17
         4 002421   000000 701000 xent               TSX1    ASB$READ_HLP
         4 002422   002441 702000 4                  TSX2    s:18133

      766    18107    3      WHENRETURN DO;

      767    18108    4         IF RES$DEV.RES_DEV.MODE ~= KL$LINKDEV.MODE THEN DO;

  18108  4 002423   000000 470400 xsym               LDP0    DSEG3$
         4 002424   003100 061500                    CSR     bolr='003'O
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:114  
         4 002425   000003 010010                    BDSC    3,,PR0                   by=0,bit=1,n=8
         4 002426   200456 000044                    BDSC    PRO_END$+2,,AUTO         by=0,bit=0,n=36
         4 002427   000000 471400 xsym               LDP1    DSEG2$
         4 002430   100020 236100                    LDQ     16,,PR1
         4 002431   000033 772000                    QRL     27
         4 002432   200456 116100                    CMPQ    PRO_END$+2,,AUTO
         4 002433   002440 600000 4                  TZE     s:18130

      768    18109        /*E*   ERROR: ASA-E$MODES_NO_MATCH-C
      769    18110               MESSAGE:  Modes do not match.
      770    18111               MESSAGE1:  This link devices mode does not match with the CL
      771    18112                          type devices mode.
      772    18113        */
      773    18114                 %SCREAM (ERR#=%E$MODES_NO_MATCH, LEVEL=WARN, MID='A');

  18124  4 002434   000053 630400 5                  EPPR0   43
         4 002435   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 002436   000000 701000 xent               TSX1    ASH$WARN
         4 002437   000000 011000                    NOP     0

      774    18129    4            END;  /*  ~ =  */

      775    18130    3         END;  /*  Whenreturn  */

  18130  4 002440   002441 710000 4                  TRA     s:18133

      776    18131    3      WHENALTRETURN DO;

      777    18132    3         END; /*  Whenaltreturn  */

      778    18133    3      IF NOT FOUND THEN DO;

  18133  4 002441   200017 234100                    SZN     FOUND,,AUTO
         4 002442   002453 604000 4                  TMI     s:18138

      779    18134    3         KL$DREC.LNK.BLKHDR.NSUBS = KL$DREC.LNK.BLKHDR.NSUBS + 1;

PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:115  
  18134  4 002443   000000 470400 xsym               LDP0    DSEG1$
         4 002444   000020 236100                    LDQ     16,,PR0
         4 002445   000001 036003                    ADLQ    1,DU
         4 002446   000020 552120                    STBQ    16,'20'O,PR0

      780    18135    3         PTR$ = DEV$;

  18135  4 002447   200025 236100                    LDQ     DEV$,,AUTO
         4 002450   200005 756100                    STQ     PTR$,,AUTO

      781    18136    3         DEV_SIZEW = DEV_SIZEW + SIZEW(KL_LINKDEV);

  18136  4 002451   000006 236007                    LDQ     6,DL
         4 002452   200033 056100                    ASQ     DEV_SIZEW,,AUTO

      782    18137    3         END;  /*  Not found  */

      783    18138    2      SIZE = POFFC(DEV_STOP$,DSEG1$)+SIZEW(KL_LINKDEV);

  18138  4 002453   000000 236000 xsym               LDQ     DSEG1$
         4 002454   000020 772000                    QRL     16
         4 002455   200456 756100                    STQ     PRO_END$+2,,AUTO
         4 002456   200032 236100                    LDQ     DEV_STOP$,,AUTO
         4 002457   000020 772000                    QRL     16
         4 002460   200456 136100                    SBLQ    PRO_END$+2,,AUTO
         4 002461   000006 036007                    ADLQ    6,DL
         4 002462   200030 756100                    STQ     SIZE,,AUTO

      784    18139    3      IF SIZE > DSEG1SIZE THEN DO;

  18139  4 002463   002502 604000 4                  TMI     s:18143
         4 002464   000000 116000 xsym               CMPQ    DSEG1SIZE
         4 002465   002502 602000 4                  TNC     s:18143
         4 002466   002502 600000 4                  TZE     s:18143

      785    18140    3         SIZE = (SIZE + 4095) / 4096;

PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:116  
  18140  4 002467   007777 036007                    ADLQ    4095,DL
         4 002470   010000 506007                    DIV     4096,DL
         4 002471   200030 756100                    STQ     SIZE,,AUTO

      786    18141    3         CALL ASB$GET_MORE_SEG(1,SIZE) ALTRET(GETSEG_ERR);

  18141  4 002472   200030 630500                    EPPR0   SIZE,,AUTO
         4 002473   200457 450500                    STP0    PRO_END$+3,,AUTO
         4 002474   000006 236000 5                  LDQ     6
         4 002475   200456 756100                    STQ     PRO_END$+2,,AUTO
         4 002476   200456 630500                    EPPR0   PRO_END$+2,,AUTO
         4 002477   000020 631400 xsym               EPPR1   B_VECTNIL+16
         4 002500   000000 701000 xent               TSX1    ASB$GET_MORE_SEG
         4 002501   002631 702000 4                  TSX2    GETSEG_ERR

      787    18142    3         END;  /*  Size > DSEG1SIZE  */

      788    18143    2      DEV$->KL$LINKDEV = KL$LINKDEV;

  18143  4 002502   000000 470400 xsym               LDP0    DSEG3$
         4 002503   200025 471500                    LDP1    DEV$,,AUTO
         4 002504   000100 100500                    MLR     fill='000'O
         4 002505   000000 000030                    ADSC9   0,,PR0                   cn=0,n=24
         4 002506   100000 000030                    ADSC9   0,,PR1                   cn=0,n=24

      789    18144    2      END;  /*  Linkdev  */

      790    18145    1   IF NOT LINK THEN

  18145  4 002507   200020 234100                    SZN     LINK,,AUTO
         4 002510   002517 604000 4                  TMI     s:18147

      791    18146    1      KL$DREC.NWINFO = LINK_DREC.NWINFO + SIZEW(LINK_DREC.LNK) + DEV_SIZEW;

  18146  4 002511   000017 236000 3                  LDQ     LINK_DREC+15
         4 002512   200033 036100                    ADLQ    DEV_SIZEW,,AUTO
         4 002513   000014 036007                    ADLQ    12,DL
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:117  
         4 002514   000000 470400 xsym               LDP0    DSEG1$
         4 002515   000017 756100                    STQ     15,,PR0
         4 002516   002524 710000 4                  TRA     s:18149

      792    18147    1   ELSE IF CREATE THEN

  18147  4 002517   200026 234100                    SZN     CREATE,,AUTO
         4 002520   002524 605000 4                  TPL     s:18149

      793    18148    1         KL$DREC.NWINFO = SIZEW(LINK_DREC.LNK) ;

  18148  4 002521   000014 235007                    LDA     12,DL
         4 002522   000000 470400 xsym               LDP0    DSEG1$
         4 002523   000017 755100                    STA     15,,PR0

      794    18149    1   ARS = LENGTHC(KL_DREC_CNT) + ( KL$DREC.NWINFO * 4 ) ;

  18149  4 002524   000000 470400 xsym               LDP0    DSEG1$
         4 002525   000017 235100                    LDA     15,,PR0
         4 002526   000002 735000                    ALS     2
         4 002527   000100 035007                    ADLA    64,DL
         4 002530   200012 755100                    STA     ARS,,AUTO

      795    18150    1   USERS_KEY = LINK_KEY ;

  18150  4 002531   000000 100400                    MLR     fill='000'O
         4 002532   000000 000012 2                  ADSC9   LINK_KEY                 cn=0,n=10
         4 002533   000000 000052 xsym               ADSC9   USERS_KEY                cn=0,n=42

      796    18151    1   CALL ASB$WRITE_HLP( DSEG1$, ARS )

  18151  4 002534   200012 631500                    EPPR1   ARS,,AUTO
         4 002535   200457 451500                    STP1    PRO_END$+3,,AUTO
         4 002536   000007 236000 5                  LDQ     7
         4 002537   200456 756100                    STQ     PRO_END$+2,,AUTO
         4 002540   200456 630500                    EPPR0   PRO_END$+2,,AUTO
         4 002541   000020 631400 xsym               EPPR1   B_VECTNIL+16
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:118  
         4 002542   000000 701000 xent               TSX1    ASB$WRITE_HLP
         4 002543   002545 702000 4                  TSX2    s:18153
         4 002544   002552 710000 4                  TRA     s:18156

      797    18152    2   WHENALTRETURN DO;

      798    18153    2      CALL ASH$ERROR (ERR_CODE);

  18153  4 002545   000054 630400 5                  EPPR0   44
         4 002546   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 002547   000000 701000 xent               TSX1    ASH$ERROR
         4 002550   000000 011000                    NOP     0

      799    18154    2      GOTO EXIT#;

  18154  4 002551   002625 710000 4                  TRA     EXIT#

      800    18155    2      END; /*  Whenaltreturn  */
      801    18156    2   IF CREATE THEN DO;

  18156  4 002552   200026 234100                    SZN     CREATE,,AUTO
         4 002553   002572 605000 4                  TPL     s:18163

      802    18157    2      KL_TERM_REC = '0'B;

  18157  4 002554   000000 100400                    MLR     fill='000'O
         4 002555   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         4 002556   000030 000023 2                  ADSC9   KL_TERM_REC              cn=0,n=19

      803    18158    2      KL_TERM_KEY.TERMID.TERM.TERM_NAME = LINK_NAME.TEXT;

  18158  4 002557   040000 100500                    MLR     fill='040'O
         4 002560   200434 200010                    ADSC9   LINK_NAME,,AUTO          cn=1,n=8
         4 002561   000037 400010 2                  ADSC9   KL_TERM_KEY+2            cn=2,n=8

      804    18159    2     CALL ASB$WRITE_NETCON(VECTOR(KL_TERM_KEY),VECTOR(KL_TERM_REC)) ALTRET(NETCON_ERR)
             18159               ;
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:119  

  18159  4 002562   000062 630400 5                  EPPR0   50
         4 002563   000020 631400 xsym               EPPR1   B_VECTNIL+16
         4 002564   000000 701000 xent               TSX1    ASB$WRITE_NETCON
         4 002565   002636 702000 4                  TSX2    NETCON_ERR

      805    18160    2      CALL ASB$CLOSE_NETCON;

  18160  4 002566   000002 631400 xsym               EPPR1   B_VECTNIL+2
         4 002567   000000 701000 xent               TSX1    ASB$CLOSE_NETCON
         4 002570   000000 011000                    NOP     0

      806    18161    2      END; /* If create */

  18161  4 002571   002625 710000 4                  TRA     EXIT#

      807    18162    2   ELSE DO;

      808    18163    2      KL_TERM_KEY.TERMID.TERM.TERM_NAME = LINK_NAME.TEXT;

  18163  4 002572   040000 100500                    MLR     fill='040'O
         4 002573   200434 200010                    ADSC9   LINK_NAME,,AUTO          cn=1,n=8
         4 002574   000037 400010 2                  ADSC9   KL_TERM_KEY+2            cn=2,n=8

      809    18164    2      CALL ASB$READ_NETCON(VECTOR(KL_TERM_KEY),VECTOR(KL_TERM_REC))

  18164  4 002575   000062 630400 5                  EPPR0   50
         4 002576   000020 631400 xsym               EPPR1   B_VECTNIL+16
         4 002577   000000 701000 xent               TSX1    ASB$READ_NETCON
         4 002600   002602 702000 4                  TSX2    s:18166
         4 002601   002622 710000 4                  TRA     s:18176

      810    18165    3      WHENALTRETURN DO;

      811    18166    3         IF (MERR_CODE.CODE = %E$NOKEY)

  18166  4 002602   000000 236000 xsym               LDQ     ERR_CODE
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:120  
         4 002603   377770 376007                    ANQ     131064,DL
         4 002604   001020 116007                    CMPQ    528,DL
         4 002605   002621 601000 4                  TNZ     s:18173

      812    18167    4         THEN DO;

      813    18168    4            KL_TERM_REC = '0'B;

  18168  4 002606   000000 100400                    MLR     fill='000'O
         4 002607   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         4 002610   000030 000023 2                  ADSC9   KL_TERM_REC              cn=0,n=19

      814    18169    4            KL_TERM_KEY.TERMID.TERM.TERM_NAME = LINK_NAME.TEXT;

  18169  4 002611   040000 100500                    MLR     fill='040'O
         4 002612   200434 200010                    ADSC9   LINK_NAME,,AUTO          cn=1,n=8
         4 002613   000037 400010 2                  ADSC9   KL_TERM_KEY+2            cn=2,n=8

      815    18170    4            CALL ASB$WRITE_NETCON(VECTOR(KL_TERM_KEY),VECTOR(KL_TERM_REC)) ALTRET(
             18170                     NETCON_ERR);

  18170  4 002614   000062 630400 5                  EPPR0   50
         4 002615   000020 631400 xsym               EPPR1   B_VECTNIL+16
         4 002616   000000 701000 xent               TSX1    ASB$WRITE_NETCON
         4 002617   002636 702000 4                  TSX2    NETCON_ERR

      816    18171    4            END;

  18171  4 002620   002622 710000 4                  TRA     s:18176

      817    18172    4         ELSE DO;

      818    18173    4            GOTO NETCON_ERR;

  18173  4 002621   002636 710000 4                  TRA     NETCON_ERR

      819    18174    4            END;
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:121  
      820    18175    3         END;
      821    18176    2      CALL ASB$CLOSE_NETCON;

  18176  4 002622   000002 631400 xsym               EPPR1   B_VECTNIL+2
         4 002623   000000 701000 xent               TSX1    ASB$CLOSE_NETCON
         4 002624   000000 011000                    NOP     0

      822    18177    2      END;

      823    18178    1   EXIT#:
      824    18179    1   CALL ASB$DEQ_HLP;

  18179  4 002625   000002 631400 xsym  EXIT#        EPPR1   B_VECTNIL+2
         4 002626   000000 701000 xent               TSX1    ASB$DEQ_HLP
         4 002627   000000 011000                    NOP     0

      825    18180    1   RETURN ;

  18180  4 002630   000000 702200 xent               TSX2  ! X66_ARET

  18170  4 002631                       GETSEG_ERR   null
      826    18181                                                              /* Errors */
      827    18182    1   GETSEG_ERR: ;
      828    18183        %SCREAM( ERR#=%E$GETSEGERR, LEVEL=ERROR, MID='A') ;

  18195  4 002631   000064 630400 5                  EPPR0   52
         4 002632   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 002633   000000 701000 xent               TSX1    ASH$ERROR
         4 002634   000000 011000                    NOP     0

      829    18198    1   GOTO EXIT#;

  18198  4 002635   002625 710000 4                  TRA     EXIT#

  18198  4 002636                       NETCON_ERR   null
      830    18199                                                              /**/
      831    18200    1   NETCON_ERR:;
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:122  
      832    18201    1   ERR_CODE = B$TCB$->B$TCB.ALT$->B$ALT.ERR;

  18201  4 002636   000000 470400 xsym               LDP0    B$TCB$
         4 002637   000000 471500                    LDP1    0,,PR0
         4 002640   100102 236100                    LDQ     66,,PR1
         4 002641   000000 756000 xsym               STQ     ERR_CODE

      833    18202    1   CALL ASH$ERROR(ERR_CODE);

  18202  4 002642   000054 630400 5                  EPPR0   44
         4 002643   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 002644   000000 701000 xent               TSX1    ASH$ERROR
         4 002645   000000 011000                    NOP     0

      834    18203    1   RETURN;

  18203  4 002646   000000 702200 xent               TSX2  ! X66_ARET

      835    18204                                                              /**/
      836    18205        %EJECT;
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:123  
      837    18206    1   FIND_VIRCIR: PROC ALTRET;

  18206  4 002647   200452 741300       FIND_VIRCIR  STX1  ! KL$UBWORD+1,,AUTO

      838    18207
      839    18208    2   DCL LINK$   PTR;
      840    18209    2   DCL 1 PRO$STRCT BASED,
      841    18210    2          2 TYPE  UBIN BYTE CALIGNED,
      842    18211    2          2 SIZE  UBIN BYTE CALIGNED;
      843    18212    2   DCL PRO_END$ PTR;
      844    18213        %KL_PHDR (NAME=PRO_HDR, STCLASS=CONSTANT);
      845    18254        %KL_LINK (NAME=KL$LINK, STCLASS=BASED);
      846    18350
      847    18351                                                          /* Get virtual circuit # */
      848    18352    2   BLK$ = P$NODE.SUBLK$(0);

  18352  4 002650   000000 470400 xsym               LDP0    NODE$
         4 002651   000003 236100                    LDQ     3,,PR0
         4 002652   200023 756100                    STQ     BLK$,,AUTO

      849    18353    3   IF VIRCIR THEN DO;

  18353  4 002653   200021 234100                    SZN     VIRCIR,,AUTO
         4 002654   002677 605000 4                  TPL     s:18379

      850    18354    3      CALL CHARBIN( VIRCIR#, OUT$SYM.TEXT );

  18354  4 002655   200023 471500                    LDP1    BLK$,,AUTO
         4 002656   100004 236100                    LDQ     4,,PR1
         4 002657   000033 772000                    QRL     27
         4 002660   000000 620006                    EAX0    0,QL
         4 002661   000100 305540                    DTB
         4 002662   100004 230010                    NDSC9   4,,PR1                   cn=1,s=nosgn,sf=0,n=*X0
         4 002663   200014 000004                    NDSC9   VIRCIR#,,AUTO            cn=0,s=lsgnf,sf=0,n=4

      851    18355    4      IF VIRCIR# > 4095 OR VIRCIR# < 1 THEN DO;

PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:124  
  18355  4 002664   200014 235100                    LDA     VIRCIR#,,AUTO
         4 002665   007777 115007                    CMPA    4095,DL
         4 002666   002671 605400 4                  TPNZ    s:18372
         4 002667   000000 115003                    CMPA    0,DU
         4 002670   002677 605400 4                  TPNZ    s:18379

      852    18356        /*E*  ERROR:  AS-E$RNAMETOOBIG-C
      853    18357              MESSAGE: Illegal VIRTUAL CIRCUIT number.
      854    18358              MESSAGE1: A VIRTUAL CIRCUIT number must be between 1 and 4095.
      855    18359        */
      856    18360              %SCREAM( ERR#=E$RNAMETOOBIG, LEVEL=ERROR, MID='A' );

  18372  4 002671   000065 630400 5                  EPPR0   53
         4 002672   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 002673   000000 701000 xent               TSX1    ASH$ERROR
         4 002674   000000 011000                    NOP     0

      857    18375    4         ALTRETURN;

  18375  4 002675   200452 221300                    LDX1  ! KL$UBWORD+1,,AUTO
         4 002676   000000 702211                    TSX2  ! 0,X1

      858    18376    4         END;  /* Vircir out of range  */
      859    18377    3      END;  /*  Vircir  */
      860    18378                                                    /* See if the virtual circuit exists.*/
      861    18379    2   DEV$ = DEV_START$;

  18379  4 002677   200031 236100                    LDQ     DEV_START$,,AUTO
         4 002700   200025 756100                    STQ     DEV$,,AUTO

      862    18380    2   DEV_STOP$ = PINCRW(DEV$, DEV_SIZEW) ;

  18380  4 002701   200033 236100                    LDQ     DEV_SIZEW,,AUTO
         4 002702   000022 736000                    QLS     18
         4 002703   200025 036100                    ADLQ    DEV$,,AUTO
         4 002704   200032 756100                    STQ     DEV_STOP$,,AUTO

PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:125  
      863    18381    2   FOUND = '0'B;

  18381  4 002705   200017 450100                    STZ     FOUND,,AUTO

      864    18382    3   DO WHILE( DEV$ < DEV_STOP$ AND NOT FOUND );

  18382  4 002706   002753 710000 4                  TRA     s:18395

      865    18383    4      IF DEV$->KL$LNKVC.BLKHDR.LEV = 2 THEN DO;  /*  We have a vir cir  */

  18383  4 002707   200025 470500                    LDP0    DEV$,,AUTO
         4 002710   000000 236100                    LDQ     0,,PR0
         4 002711   777000 376003                    ANQ     -512,DU
         4 002712   002000 116003                    CMPQ    1024,DU
         4 002713   002727 601000 4                  TNZ     s:18389

      866    18384    4         IF DEV$ -> KL$LNKVC.VIRCIR# = VIRCIR# THEN

  18384  4 002714   000012 236100                    LDQ     10,,PR0
         4 002715   777777 376007                    ANQ     -1,DL
         4 002716   200014 116100                    CMPQ    VIRCIR#,,AUTO
         4 002717   002724 601000 4                  TNZ     s:18387

      867    18385    4            FOUND = AS_TRUE;

  18385  4 002720   000000 236000 xsym               LDQ     AS_TRUE
         4 002721   400000 376003                    ANQ     -131072,DU
         4 002722   200017 756100                    STQ     FOUND,,AUTO
         4 002723   002727 710000 4                  TRA     s:18389

      868    18386    4         ELSE
      869    18387    4            DEV$ =  PINCRW( DEV$, SIZEW(KL_LNKVC));

  18387  4 002724   200025 236100                    LDQ     DEV$,,AUTO
         4 002725   000014 036003                    ADLQ    12,DU
         4 002726   200025 756100                    STQ     DEV$,,AUTO

PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:126  
      870    18388    4         END;  /*  Vir cir  */

      871    18389    4      IF DEV$->KL$LNKVC.BLKHDR.LEV = 3 THEN DO;  /*  We have a link dev */

  18389  4 002727   200025 470500                    LDP0    DEV$,,AUTO
         4 002730   000000 236100                    LDQ     0,,PR0
         4 002731   777000 376003                    ANQ     -512,DU
         4 002732   003000 116003                    CMPQ    1536,DU
         4 002733   002753 601000 4                  TNZ     s:18395

      872    18390    4         IF DEV$ -> KL$LINKDEV.LOGON# = OUT$SYM.TEXT THEN

  18390  4 002734   200023 471500                    LDP1    BLK$,,AUTO
         4 002735   100004 236100                    LDQ     4,,PR1
         4 002736   000033 772000                    QRL     27
         4 002737   000000 620006                    EAX0    0,QL
         4 002740   040140 106500                    CMPC    fill='040'O
         4 002741   000004 000010                    ADSC9   4,,PR0                   cn=0,n=8
         4 002742   100004 200010                    ADSC9   4,,PR1                   cn=1,n=*X0
         4 002743   002750 601000 4                  TNZ     s:18393

      873    18391    4            FOUND = AS_TRUE;

  18391  4 002744   000000 236000 xsym               LDQ     AS_TRUE
         4 002745   400000 376003                    ANQ     -131072,DU
         4 002746   200017 756100                    STQ     FOUND,,AUTO
         4 002747   002753 710000 4                  TRA     s:18395

      874    18392    4         ELSE
      875    18393    4            DEV$ =  PINCRW( DEV$, SIZEW(KL_LINKDEV));

  18393  4 002750   200025 236100                    LDQ     DEV$,,AUTO
         4 002751   000006 036003                    ADLQ    6,DU
         4 002752   200025 756100                    STQ     DEV$,,AUTO

      876    18394    4         END;  /*  Link dev  */

PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:127  
      877    18395    3      END;  /*  Do while not found  */

  18395  4 002753   200025 236100                    LDQ     DEV$,,AUTO
         4 002754   200032 116100                    CMPQ    DEV_STOP$,,AUTO
         4 002755   002760 603000 4                  TRC     s:18397
         4 002756   200017 234100                    SZN     FOUND,,AUTO
         4 002757   002707 605000 4                  TPL     s:18383

      878    18396
      879    18397    3   IF VIRCIR THEN DO;

  18397  4 002760   200021 234100                    SZN     VIRCIR,,AUTO
         4 002761   003111 605000 4                  TPL     s:18465

      880    18398    4      IF FOUND THEN DO;

  18398  4 002762   200017 234100                    SZN     FOUND,,AUTO
         4 002763   003013 605000 4                  TPL     s:18426

      881    18399    5         IF CREATE THEN DO;

  18399  4 002764   200026 234100                    SZN     CREATE,,AUTO
         4 002765   003005 605000 4                  TPL     s:18423

      882    18400        /*E*  ERROR:  ASA-E$VIR_CIR_EXISTS-C
      883    18401              MESSAGE: Virtual Circuit %U1 already exists.
      884    18402              MESSAGE1: You cannot create a virtual circuit that already exists.
      885    18403        */
      886    18404    5            AS_FIELD1.COUNT = OUT$SYM.COUNT;

  18404  4 002766   200023 470500                    LDP0    BLK$,,AUTO
         4 002767   000004 236100                    LDQ     4,,PR0
         4 002770   000000 552040 xsym               STBQ    AS_FIELD1,'40'O

      887    18405    5            AS_FIELD1.TEXT  = OUT$SYM.TEXT;

  18405  4 002771   000004 236100                    LDQ     4,,PR0
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:128  
         4 002772   000033 772000                    QRL     27
         4 002773   000000 620006                    EAX0    0,QL
         4 002774   040000 100540                    MLR     fill='040'O
         4 002775   000004 200010                    ADSC9   4,,PR0                   cn=1,n=*X0
         4 002776   000000 200050 xsym               ADSC9   AS_FIELD1                cn=1,n=40

      888    18406                 %SCREAM( ERR#=E$VIR_CIR_EXISTS, LEVEL=ERROR, MID='A' );

  18418  4 002777   000066 630400 5                  EPPR0   54
         4 003000   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 003001   000000 701000 xent               TSX1    ASH$ERROR
         4 003002   000000 011000                    NOP     0

      889    18421    5            ALTRETURN;

  18421  4 003003   200452 221300                    LDX1  ! KL$UBWORD+1,,AUTO
         4 003004   000000 702211                    TSX2  ! 0,X1

      890    18422    5            END;  /*  Create  */
      891    18423    4         KL$LNKVC = DEV$ -> KL$LNKVC ;

  18423  4 003005   200025 470500                    LDP0    DEV$,,AUTO
         4 003006   000000 471400 xsym               LDP1    DSEG3$
         4 003007   000100 100500                    MLR     fill='000'O
         4 003010   000000 000060                    ADSC9   0,,PR0                   cn=0,n=48
         4 003011   100000 000060                    ADSC9   0,,PR1                   cn=0,n=48

      892    18424    4         END;   /*  Found  */

  18424  4 003012   003243 710000 4                  TRA     s:18534

      893    18425    4      ELSE DO;  /*  Not found  */

      894    18426    5         IF NOT CREATE THEN DO;

  18426  4 003013   200026 234100                    SZN     CREATE,,AUTO
         4 003014   003035 604000 4                  TMI     s:18449
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:129  

      895    18427        /*E*  ERROR:  ASA-E$VIR_CIR_SWITCH-C
      896    18428              MESSAGE: Virtual circuit %U1 does not exist. Switching to CREATE mode.
      897    18429        */
      898    18430    5            AS_FIELD1.COUNT = OUT$SYM.COUNT;

  18430  4 003015   200023 470500                    LDP0    BLK$,,AUTO
         4 003016   000004 236100                    LDQ     4,,PR0
         4 003017   000000 552040 xsym               STBQ    AS_FIELD1,'40'O

      899    18431    5            AS_FIELD1.TEXT  = OUT$SYM.TEXT;

  18431  4 003020   000004 236100                    LDQ     4,,PR0
         4 003021   000033 772000                    QRL     27
         4 003022   000000 620006                    EAX0    0,QL
         4 003023   040000 100540                    MLR     fill='040'O
         4 003024   000004 200010                    ADSC9   4,,PR0                   cn=1,n=*X0
         4 003025   000000 200050 xsym               ADSC9   AS_FIELD1                cn=1,n=40

      900    18432                 %SCREAM( ERR#=E$VIR_CIR_SWITCH, LEVEL=WARN, MID='A' );

  18442  4 003026   000067 630400 5                  EPPR0   55
         4 003027   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 003030   000000 701000 xent               TSX1    ASH$WARN
         4 003031   000000 011000                    NOP     0

      901    18447    5            CREATE = AS_TRUE;

  18447  4 003032   000000 236000 xsym               LDQ     AS_TRUE
         4 003033   400000 376003                    ANQ     -131072,DU
         4 003034   200026 756100                    STQ     CREATE,,AUTO

      902    18448    5            END;  /*  Not create  */

      903    18449    4         KL$LNKVC = KL_LNKVC;

  18449  4 003035   000000 470400 xsym               LDP0    DSEG3$
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:130  
         4 003036   000100 100400                    MLR     fill='000'O
         4 003037   000034 000060 3                  ADSC9   KL_LNKVC                 cn=0,n=48
         4 003040   000000 000060                    ADSC9   0,,PR0                   cn=0,n=48

      904    18450    4         KL$LNKVC.VIRCIR# = VIRCIR#;

  18450  4 003041   200014 720100                    LXL0    VIRCIR#,,AUTO
         4 003042   000000 470400 xsym               LDP0    DSEG3$
         4 003043   000012 440100                    SXL0    10,,PR0

      905    18451    4         KL$LNKVC.BLKHDR.LEV = 2;

  18451  4 003044   002000 236003                    LDQ     1024,DU
         4 003045   000000 552140                    STBQ    0,'40'O,PR0

      906    18452    4         KL$LNKVC.BLKHDR.NSUBS = 0;

  18452  4 003046   000000 470400 xsym               LDP0    DSEG3$
         4 003047   000000 236003                    LDQ     0,DU
         4 003050   000000 552120                    STBQ    0,'20'O,PR0

      907    18453    4         KL$LNKVC.BLKHDR.DEVNUM = VIRCIR#;

  18453  4 003051   000000 470400 xsym               LDP0    DSEG3$
         4 003052   200014 236100                    LDQ     VIRCIR#,,AUTO
         4 003053   000011 736000                    QLS     9
         4 003054   000001 552110                    STBQ    1,'10'O,PR0

      908    18454    4         LNG_CNT = LENGTHC( KL_LNKVC );

  18454  4 003055   000060 235007                    LDA     48,DL
         4 003056   000011 755000 2                  STA     LNGTH

      909    18455    4         KL$UBWORD.NUM = 0;

  18455  4 003057   000000 221003                    LDX1    0,DU
         4 003060   200451 441100                    SXL1    KL$UBWORD,,AUTO
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:131  

      910    18456    4         KL$UBWORD.REPLACE.T = LNGTH.T;

  18456  4 003061   000011 236000 2                  LDQ     LNGTH
         4 003062   000001 736000                    QLS     1
         4 003063   200451 676100                    ERQ     KL$UBWORD,,AUTO
         4 003064   377000 376007                    ANQ     130560,DL
         4 003065   200451 656100                    ERSQ    KL$UBWORD,,AUTO

      911    18457    4         KL$UBWORD.REPLACE.B = LNGTH.B;

  18457  4 003066   000011 236000 2                  LDQ     LNGTH
         4 003067   200451 676100                    ERQ     KL$UBWORD,,AUTO
         4 003070   000377 376007                    ANQ     255,DL
         4 003071   200451 656100                    ERSQ    KL$UBWORD,,AUTO

      912    18458    4         KL$LNKVC.BLKHDR.LEN.BYT(0) = KL$UBWORD.REPLACE.T;

  18458  4 003072   200451 236100                    LDQ     KL$UBWORD,,AUTO
         4 003073   000000 676100                    ERQ     0,,PR0
         4 003074   377000 376007                    ANQ     130560,DL
         4 003075   000000 656100                    ERSQ    0,,PR0

      913    18459    4         KL$LNKVC.BLKHDR.LEN.BYT(1) = KL$UBWORD.REPLACE.B;

  18459  4 003076   000000 470400 xsym               LDP0    DSEG3$
         4 003077   200451 236100                    LDQ     KL$UBWORD,,AUTO
         4 003100   000000 676100                    ERQ     0,,PR0
         4 003101   000377 376007                    ANQ     255,DL
         4 003102   000000 656100                    ERSQ    0,,PR0

      914    18460    4         KL$LNKVC.BLKHDR.BLKTYP = %KLTY_VIRCIR#;

  18460  4 003103   000000 470400 xsym               LDP0    DSEG3$
         4 003104   010000 236003                    LDQ     4096,DU
         4 003105   000001 552140                    STBQ    1,'40'O,PR0

PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:132  
      915    18461    4         KL$LNKVC.BLKHDR.USE = KLUS_VC#;

  18461  4 003106   000012 236007                    LDQ     10,DL
         4 003107   000001 552104                    STBQ    1,'04'O,PR0

      916    18462    4         END ;   /*  Not found  */

      917    18463    3      END ;  /*  Vircir  */

  18463  4 003110   003243 710000 4                  TRA     s:18534

      918    18464    3   ELSE DO;   /*  Link dev  */

      919    18465    4      IF FOUND THEN DO;

  18465  4 003111   200017 234100                    SZN     FOUND,,AUTO
         4 003112   003142 605000 4                  TPL     s:18493

      920    18466    5         IF CREATE THEN DO;

  18466  4 003113   200026 234100                    SZN     CREATE,,AUTO
         4 003114   003134 605000 4                  TPL     s:18490

      921    18467        /*E*  ERROR:  ASA-E$LINK_DEV_EXISTS-C
      922    18468              MESSAGE: Link device %U1 already exists.
      923    18469              MESSAGE1: You cannot create a link device that already exists.
      924    18470        */
      925    18471    5            AS_FIELD1.COUNT = OUT$SYM.COUNT;

  18471  4 003115   200023 470500                    LDP0    BLK$,,AUTO
         4 003116   000004 236100                    LDQ     4,,PR0
         4 003117   000000 552040 xsym               STBQ    AS_FIELD1,'40'O

      926    18472    5            AS_FIELD1.TEXT  = OUT$SYM.TEXT;

  18472  4 003120   000004 236100                    LDQ     4,,PR0
         4 003121   000033 772000                    QRL     27
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:133  
         4 003122   000000 620006                    EAX0    0,QL
         4 003123   040000 100540                    MLR     fill='040'O
         4 003124   000004 200010                    ADSC9   4,,PR0                   cn=1,n=*X0
         4 003125   000000 200050 xsym               ADSC9   AS_FIELD1                cn=1,n=40

      927    18473                 %SCREAM( ERR#=E$LINK_DEV_EXISTS, LEVEL=ERROR, MID='A' );

  18485  4 003126   000070 630400 5                  EPPR0   56
         4 003127   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 003130   000000 701000 xent               TSX1    ASH$ERROR
         4 003131   000000 011000                    NOP     0

      928    18488    5            ALTRETURN;

  18488  4 003132   200452 221300                    LDX1  ! KL$UBWORD+1,,AUTO
         4 003133   000000 702211                    TSX2  ! 0,X1

      929    18489    5            END;  /*  Create  */
      930    18490    4         KL$LINKDEV = DEV$ -> KL$LINKDEV ;

  18490  4 003134   200025 470500                    LDP0    DEV$,,AUTO
         4 003135   000000 471400 xsym               LDP1    DSEG3$
         4 003136   000100 100500                    MLR     fill='000'O
         4 003137   000000 000030                    ADSC9   0,,PR0                   cn=0,n=24
         4 003140   100000 000030                    ADSC9   0,,PR1                   cn=0,n=24

      931    18491    4         END;  /*  Found  */

  18491  4 003141   003243 710000 4                  TRA     s:18534

      932    18492    4      ELSE DO;  /*  Not found  */

      933    18493    5         IF NOT CREATE THEN DO;

  18493  4 003142   200026 234100                    SZN     CREATE,,AUTO
         4 003143   003164 604000 4                  TMI     s:18516

PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:134  
      934    18494        /*E*  ERROR:  ASA-E$LINK_DEV_SWITCH-C
      935    18495              MESSAGE: Virtual circuit %U1 does not exist. Switching to CREATE mode.
      936    18496        */
      937    18497    5            AS_FIELD1.COUNT = OUT$SYM.COUNT;

  18497  4 003144   200023 470500                    LDP0    BLK$,,AUTO
         4 003145   000004 236100                    LDQ     4,,PR0
         4 003146   000000 552040 xsym               STBQ    AS_FIELD1,'40'O

      938    18498    5            AS_FIELD1.TEXT  = OUT$SYM.TEXT;

  18498  4 003147   000004 236100                    LDQ     4,,PR0
         4 003150   000033 772000                    QRL     27
         4 003151   000000 620006                    EAX0    0,QL
         4 003152   040000 100540                    MLR     fill='040'O
         4 003153   000004 200010                    ADSC9   4,,PR0                   cn=1,n=*X0
         4 003154   000000 200050 xsym               ADSC9   AS_FIELD1                cn=1,n=40

      939    18499                 %SCREAM( ERR#=E$LINK_DEV_SWITCH, LEVEL=WARN, MID='A' );

  18509  4 003155   000071 630400 5                  EPPR0   57
         4 003156   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 003157   000000 701000 xent               TSX1    ASH$WARN
         4 003160   000000 011000                    NOP     0

      940    18514    5            CREATE = AS_TRUE;

  18514  4 003161   000000 236000 xsym               LDQ     AS_TRUE
         4 003162   400000 376003                    ANQ     -131072,DU
         4 003163   200026 756100                    STQ     CREATE,,AUTO

      941    18515    5            END;  /*  Not create  */

      942    18516    4         KL$LINKDEV = KL_LINKDEV;

  18516  4 003164   000000 470400 xsym               LDP0    DSEG3$
         4 003165   000100 100400                    MLR     fill='000'O
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:135  
         4 003166   000050 000030 3                  ADSC9   KL_LINKDEV               cn=0,n=24
         4 003167   000000 000030                    ADSC9   0,,PR0                   cn=0,n=24

      943    18517    4         KL$LINKDEV.BLKHDR.LEV = 3;

  18517  4 003170   000000 470400 xsym               LDP0    DSEG3$
         4 003171   000100 101400                    MRL     fill='000'O
         4 003172   000005 000004 xsym               ADSC9   B_VECTNIL+5              cn=0,n=4
         4 003173   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1

      944    18518    4         KL$LINKDEV.BLKHDR.NSUBS = 0;

  18518  4 003174   000000 470400 xsym               LDP0    DSEG3$
         4 003175   000100 101400                    MRL     fill='000'O
         4 003176   000002 000004 xsym               ADSC9   B_VECTNIL+2              cn=0,n=4
         4 003177   000000 200001                    ADSC9   0,,PR0                   cn=1,n=1

      945    18519    4         LNG_CNT = LENGTHC( KL_LINKDEV );

  18519  4 003200   000030 235007                    LDA     24,DL
         4 003201   000011 755000 2                  STA     LNGTH

      946    18520    4         KL$UBWORD.NUM = 0;

  18520  4 003202   000000 220003                    LDX0    0,DU
         4 003203   200451 440100                    SXL0    KL$UBWORD,,AUTO

      947    18521    4         KL$UBWORD.REPLACE.T = LNGTH.T;

  18521  4 003204   000011 236000 2                  LDQ     LNGTH
         4 003205   000001 736000                    QLS     1
         4 003206   200451 676100                    ERQ     KL$UBWORD,,AUTO
         4 003207   377000 376007                    ANQ     130560,DL
         4 003210   200451 656100                    ERSQ    KL$UBWORD,,AUTO

      948    18522    4         KL$UBWORD.REPLACE.B = LNGTH.B;

PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:136  
  18522  4 003211   000011 236000 2                  LDQ     LNGTH
         4 003212   200451 676100                    ERQ     KL$UBWORD,,AUTO
         4 003213   000377 376007                    ANQ     255,DL
         4 003214   200451 656100                    ERSQ    KL$UBWORD,,AUTO

      949    18523    4         KL$LINKDEV.BLKHDR.LEN.BYT(0) = KL$UBWORD.REPLACE.T;

  18523  4 003215   000000 470400 xsym               LDP0    DSEG3$
         4 003216   003100 060500                    CSL     bolr='003'O
         4 003217   200451 410010                    BDSC    KL$UBWORD,,AUTO          by=2,bit=1,n=8
         4 003220   000000 410010                    BDSC    0,,PR0                   by=2,bit=1,n=8

      950    18524    4         KL$LINKDEV.BLKHDR.LEN.BYT(1) = KL$UBWORD.REPLACE.B;

  18524  4 003221   000000 470400 xsym               LDP0    DSEG3$
         4 003222   003100 060500                    CSL     bolr='003'O
         4 003223   200451 610010                    BDSC    KL$UBWORD,,AUTO          by=3,bit=1,n=8
         4 003224   000000 610010                    BDSC    0,,PR0                   by=3,bit=1,n=8

      951    18525    4         KL$LINKDEV.BLKHDR.BLKTYP = %KLTY_LINKDEV#;

  18525  4 003225   000000 470400 xsym               LDP0    DSEG3$
         4 003226   000100 101400                    MRL     fill='000'O
         4 003227   000015 000004 xsym               ADSC9   B_VECTNIL+13             cn=0,n=4
         4 003230   000001 000001                    ADSC9   1,,PR0                   cn=0,n=1

      952    18526    4         KL$LINKDEV.BLKHDR.USE = KLUS_RES_DEV#;

  18526  4 003231   000100 101400                    MRL     fill='000'O
         4 003232   000072 000004 5                  ADSC9   58                       cn=0,n=4
         4 003233   000001 600001                    ADSC9   1,,PR0                   cn=3,n=1

      953    18527    4         KL$LINKDEV.LOGON# = OUT$SYM.TEXT;

  18527  4 003234   200023 471500                    LDP1    BLK$,,AUTO
         4 003235   100004 236100                    LDQ     4,,PR1
         4 003236   000033 772000                    QRL     27
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:137  
         4 003237   000000 621006                    EAX1    0,QL
         4 003240   040100 100540                    MLR     fill='040'O
         4 003241   100004 200011                    ADSC9   4,,PR1                   cn=1,n=*X1
         4 003242   000004 000010                    ADSC9   4,,PR0                   cn=0,n=8

      954    18528    4         END ;    /*  Not found  */

      955    18529    3      END ;  /*  Linkdev  */

      956    18530        /*
      957    18531           Check the links profile for existence and correct type.
      958    18532           Issue warning if either check fails.
      959    18533        */
      960    18534    2   PRO$ = ADDR (PRO_BUF);

  18534  4 003243   200034 630500                    EPPR0   PRO_BUF,,AUTO
         4 003244   200024 450500                    STP0    PRO$,,AUTO

      961    18535    2   ARS = LENGTHC (PRO_BUF);

  18535  4 003245   002000 235007                    LDA     1024,DL
         4 003246   200012 755100                    STA     ARS,,AUTO

      962    18536    2   CALL ASD$READ_PRO (KL$DREC.PNAME,KL$PHDR,ARS)

  18536  4 003247   200012 631500                    EPPR1   ARS,,AUTO
         4 003250   200460 451500                    STP1    PRO_END$+4,,AUTO
         4 003251   200024 236100                    LDQ     PRO$,,AUTO
         4 003252   200457 756100                    STQ     PRO_END$+3,,AUTO
         4 003253   000000 236000 xsym               LDQ     DSEG1$
         4 003254   000004 036003                    ADLQ    4,DU
         4 003255   200456 756100                    STQ     PRO_END$+2,,AUTO
         4 003256   200456 630500                    EPPR0   PRO_END$+2,,AUTO
         4 003257   000021 631400 xsym               EPPR1   B_VECTNIL+17
         4 003260   000000 701000 xent               TSX1    ASD$READ_PRO
         4 003261   003263 702000 4                  TSX2    s:18548
         4 003262   003271 710000 4                  TRA     s:18555
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:138  

      963    18537    3   WHENALTRETURN DO;

      964    18538           %SCREAM (ERR#=%E$PROFILE_NO_EXIST,LEVEL=WARN,MID='A');

  18548  4 003263   000073 630400 5                  EPPR0   59
         4 003264   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 003265   000000 701000 xent               TSX1    ASH$WARN
         4 003266   000000 011000                    NOP     0

      965    18553    3      RETURN;

  18553  4 003267   200452 221300                    LDX1  ! KL$UBWORD+1,,AUTO
         4 003270   000001 702211                    TSX2  ! 1,X1

      966    18554    3      END; /*  Whenaltreturn  */
      967    18555    2   LINK$ = PINCRW (ADDR(KL$PHDR), SIZEW (PRO_HDR));

  18555  4 003271   200024 236100                    LDQ     PRO$,,AUTO
         4 003272   000024 036003                    ADLQ    20,DU
         4 003273   200453 756100                    STQ     LINK$,,AUTO

      968    18556    2   PRO_END$ = PINCRC (LINK$, ARS);

  18556  4 003274   200012 236100                    LDQ     ARS,,AUTO
         4 003275   000020 736000                    QLS     16
         4 003276   200453 036100                    ADLQ    LINK$,,AUTO
         4 003277   200454 756100                    STQ     PRO_END$,,AUTO

      969    18557    2   IF KL$PHDR.TTYP ~= %KLTY_LINK# THEN

  18557  4 003300   200024 470500                    LDP0    PRO$,,AUTO
         4 003301   000100 101500                    MRL     fill='000'O
         4 003302   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
         4 003303   200456 000004                    ADSC9   PRO_END$+2,,AUTO         cn=0,n=4
         4 003304   200456 236100                    LDQ     PRO_END$+2,,AUTO
         4 003305   000004 116007                    CMPQ    4,DL
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:139  
         4 003306   003315 600000 4                  TZE     s:18576

      970    18558    3   DO;

      971    18559           %SCREAM (ERR#=E$BADPROTYPE,LEVEL=WARN,MID='A');

  18569  4 003307   000074 630400 5                  EPPR0   60
         4 003310   000017 631400 xsym               EPPR1   B_VECTNIL+15
         4 003311   000000 701000 xent               TSX1    ASH$WARN
         4 003312   000000 011000                    NOP     0

      972    18574    3      RETURN;

  18574  4 003313   200452 221300                    LDX1  ! KL$UBWORD+1,,AUTO
         4 003314   000001 702211                    TSX2  ! 1,X1

      973    18575    3      END;
      974    18576    2   RETURN;

  18576  4 003315   200452 221300                    LDX1  ! KL$UBWORD+1,,AUTO
         4 003316   000001 702211                    TSX2  ! 1,X1
      975    18577
      976    18578    2   END FIND_VIRCIR;
      977    18579
      978    18580    1   END   ASA$LINK_VIRCIR ;

PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:140  
--  Include file information  --

   XU_SUBS_C.:E05TOU  is referenced.
   AS_SUPER_R.:E05TOU  cannot be made into a system file and is referenced.
   B_ERRORS_C.:E05TOU  is referenced.
   KL_SUPER_C.:E05TOU  is referenced.
   KL_CONFIG_M.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   AS_PERR_C.:E05TOU  is referenced.
   AS_SSUBS_C.:E05TOU  is referenced.
   AS_SUBS_C.:E05TOU  is referenced.
   XU_FORMAT_C.:E05TOU  is referenced.
   XU_MACRO_C.:E05TOU  is referenced.
   AS_SUPER_C.:E05TOU  is referenced.
   AS_MAC_C.:E05TOU  cannot be made into a system file and is referenced.
   B$TABLES_C.:E05TOU  cannot be made into a system file and is referenced.
   AS_ENTRIES_M.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure ASA$LINK_VIRCIR.
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:141  

 **** Variables and constants ****

  ****  Section 002  Data  ASA$LINK_VIRCIR

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w STRC(90)    r     1 ADRN                      12-0-0/d STRC(288)   r     1 FPT_NODEINFO
    35-0-0/w STRC(162)   r     1 KL_TERM_KEY               30-0-0/c STRC(171)   r     1 KL_TERM_REC
     0-0-0/w STRC(90)    r     1 LINK_KEY                  11-0-0/w STRC        r     1 LNGTH
    11-0-0/w UBIN        r     1 LNG_CNT                   22-0-0/d STRC(216)   r     1 VLR_NODEINFO

  ****  Section 003 RoData ASA$LINK_VIRCIR

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    50-0-0/c STRC(216)   r     1 KL_LINKDEV                34-0-0/w STRC(432)   r     1 KL_LNKVC
     0-0-0/w STRC(1008)  r     1 LINK_DREC                 56-0-0/c STRC(720)   r     1 PRO_HDR

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    12-0-0/w SBIN        r     1 ARS                       23-0-0/w PTR         r     1 BLK$
     6-0-0/w SBIN        r     1 CNT                       26-0-0/b BIT         r     1 CREATE
    25-0-0/w PTR         r     1 DEV$                      33-0-0/w SBIN        r     1 DEV_SIZEW
    31-0-0/w PTR         r     1 DEV_START$                32-0-0/w PTR         r     1 DEV_STOP$
   440-0-0/w UBIN        r     1 DISP                      17-0-0/b BIT         r     1 FOUND
     7-0-0/w SBIN        r     1 I                         10-0-0/w SBIN        r     1 J
    11-0-0/w SBIN        r     1 K                        451-0-0/w STRC        r     1 KL$UBWORD
    20-0-0/b BIT         r     1 LINK                     453-0-0/w PTR         r     1 LINK$
    22-0-0/b BIT         r     1 LINKDEV                  442-0-0/b BIT         r     1 LINK_DEST_SET
   434-0-0/c STRC(81)    r     1 LINK_NAME                 13-0-0/b BIT         r     1 MORE
    27-0-0/w SBIN        r     1 MOVE_SIZE                 24-0-0/w PTR         r     1 PRO$
    34-0-0/c CHAR(1024)  r     1 PRO_BUF                  454-0-0/w PTR         r     1 PRO_END$
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:142  
     5-0-0/w PTR         r     1 PTR$                     444-0-0/w PTR         r     1 PTR2$
    30-0-0/w SBIN        r     1 SIZE                     437-0-0/c CHAR(4)     r     1 TEMP_STR
   441-0-0/b BIT         r     1 VC_ADDR_SET               21-0-0/b BIT         r     1 VIRCIR
    14-0-0/w SBIN        r     1 VIRCIR#                  446-0-0/c CHAR(11)    r     1 XPNAME

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/b BIT         r     1 AS_FALSE                   0-0-0/w STRC(369)   r     1 AS_FIELD1
     0-0-0/b BIT         r     1 AS_TRUE                    0-0-0/w PTR         r     1 B$TCB$
     0-0-0/w PTR         r     1 B$XL_UPPER_UR$             0-0-0/c CHAR(8)     r     1 BLANK_PASS
     0-0-0/w UBIN        r     1 CODE                       0-0-0/w PTR         r     1 DSEG1$
     0-0-0/w UBIN        r     1 DSEG1SIZE                  0-0-0/w PTR         r     1 DSEG2$
     0-0-0/w UBIN        r     1 DSEG2SIZE                  0-0-0/w PTR         r     1 DSEG3$
     0-0-0/b BIT         r     1 DSEG_FLG                   0-0-0/b STRC        r     1 ERR_CODE
     0-0-0/c CHAR(255)   r     1 IN_BUF                     0-0-0/w STRC(576)   r     1 KL_DREC_CNT
     0-0-0/w UBIN        r     1 LINK_CMD                   0-0-0/w UBIN        r     1 LINK_DEV_CMD
     0-0-0/w UBIN        r     1 LINK_DEV_OPTS_LIST         0-0-0/w UBIN        r     1 LINK_OPTS_LIST
     0-0-0/b STRC        r     1 MERR_CODE                  0-0-0/w PTR         r     1 NODE$
     0-0-0/w STRC(504)   r     1 P_PCB                      0-0-0/c STRC(378)   r     1 USERS_KEY
     0-0-0/w UBIN        r     1 VIR_CIR_CMD                0-0-0/w UBIN        r     1 VIR_CIR_OPTS_LIST

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(2448)  r     1 B$ALT                      0-0-0/w STRC(144)   r     1 B$TCB
     0-0-0/d STRC(4608)  r     1 B$XL_UPPER_UR              0-0-0/w STRC(1008)  r     1 KL$DREC
     0-0-0/c STRC(216)   r     1 KL$LINKDEV                 0-0-0/w STRC(432)   r     1 KL$LNKVC
     0-0-0/c STRC(720)   r     1 KL$PHDR                    0-0-0/w ASTR(153)   r     1 OUT$SYM
     0-0-0/w STRC(144)   r     1 P$NODE                     0-0-0/w STRC(729)   r     1 RES$DEV

PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:143  

   Procedure ASA$LINK_VIRCIR requires 1743 words for executable code.
   Procedure ASA$LINK_VIRCIR requires 312 words of local(AUTO) storage.

    No errors detected in file ASA$LINK_VIRCIR.:E05TSI    .
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:144  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:145  
          MINI XREF LISTING

ADRN
     15116**DCL     17546<<ASSIGN  17562>>ASSIGN  17564>>ASSIGN  17699<<ASSIGN  17714>>ASSIGN
ADRN.ADR.BCD1#
     15120**DCL     17553<<ASSIGN  17557<<ASSIGN  17706<<ASSIGN  17710<<ASSIGN
ADRN.ADR.BCD2#
     15121**DCL     17559<<ASSIGN  17712<<ASSIGN
ADRN.LNG#
     15117**DCL     17548<<ASSIGN  17701<<ASSIGN
ARS
     15060**DCL     17224<<ASSIGN  17225<>CALL    17227<>CALL    17339<>CALL    17340>>ASSIGN  17375<<ASSIGN
     17379<>CALL    17475<<ASSIGN  17479<>CALL    18103<<ASSIGN  18106<>CALL    18149<<ASSIGN  18151<>CALL
     18535<<ASSIGN  18536<>CALL    18556>>ASSIGN
ASA$ERROR
     17136**DCL-ENT 17254--CALL
ASA_BRKS_LOC
     12103**DCL     12103--REDEF
ASB$CHECK_TYPE
     17139**DCL-ENT 17227--CALL
ASB$CLOSE_NETCON
     17148**DCL-ENT 18160--CALL    18176--CALL
ASB$DEQ_HLP
     17088**DCL-ENT 18179--CALL
ASB$ENQ_HLP
     17085**DCL-ENT 17214--CALL
ASB$GETSEG
     17100**DCL-ENT 17182--CALL
ASB$GET_MORE_SEG
     17103**DCL-ENT 18097--CALL    18141--CALL
ASB$READ_HLP
     17091**DCL-ENT 17225--CALL    18106--CALL
ASB$READ_NETCON
     17142**DCL-ENT 18164--CALL
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:146  
ASB$READ_SI
     17109**DCL-ENT 17339--CALL
ASB$SET_PROMPT
     17106**DCL-ENT 17336--CALL
ASB$WRITE_HLP
     17094**DCL-ENT 18151--CALL
ASB$WRITE_NETCON
     17145**DCL-ENT 18159--CALL    18170--CALL
ASD$HEX2OCT
     17151**DCL-ENT 17895--CALL
ASD$READ_PRO
     17112**DCL-ENT 17379--CALL    17479--CALL    18536--CALL
ASH$DQUEST
     17133**DCL-ENT 17960--CALL
ASH$ERROR
     17115**DCL-ENT 17174--CALL    17205--CALL    17246--CALL    17343--CALL    17369--CALL    17394--CALL
     17417--CALL    17443--CALL    17469--CALL    17494--CALL    17513--CALL    17541--CALL    17595--CALL
     17619--CALL    17643--CALL    17667--CALL    17694--CALL    17747--CALL    17780--CALL    17846--CALL
     17885--CALL    17915--CALL    17940--CALL    17985--CALL    18008--CALL    18081--CALL    18153--CALL
     18195--CALL    18202--CALL    18372--CALL    18418--CALL    18485--CALL
ASH$HELP
     17127**DCL-ENT 17954--CALL
ASH$QUEST
     17130**DCL-ENT 17957--CALL
ASH$WARN
     17118**DCL-ENT 17273--CALL    17296--CALL    18028--CALL    18052--CALL    18124--CALL    18442--CALL
     18509--CALL    18548--CALL    18569--CALL
AS_DEFAULT.BANNER_PERM
     12796**DCL     12797--REDEF
AS_DEFAULT.BUDGET.MACCT
     12701**DCL     12705--REDEF
AS_DEFAULT.BUDGET.MAX_PROJECTS
     12714**DCL     12717--REDEF
AS_DEFAULT.BUDGET.PACCUM
     12697**DCL     12699--REDEF
AS_DEFAULT.BUDGET.PMAXC
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:147  
     12692**DCL     12694--REDEF
AS_DEFAULT.SETUP_CHRA.TXT
     12812**DCL     12813--REDEF   12814--REDEF
AS_DEFAULT_DREC.PASSWORD
     14066**DCL     14070--REDEF
AS_DEFAULT_DREC.RENAME
     14089**DCL     14090--REDEF
AS_DFLT.BANNER_PERM
     12618**DCL     12619--REDEF
AS_DFLT.BUDGET.MACCT
     12523**DCL     12527--REDEF
AS_DFLT.BUDGET.MAX_PROJECTS
     12536**DCL     12539--REDEF
AS_DFLT.BUDGET.PACCUM
     12519**DCL     12521--REDEF
AS_DFLT.BUDGET.PMAXC
     12514**DCL     12516--REDEF
AS_DFLT.SETUP_CHRA.TXT
     12634**DCL     12635--REDEF   12636--REDEF
AS_FALSE
     11963**DCL     17161>>ASSIGN  17162>>ASSIGN
AS_FE_MODE
     11969**DCL     11970--REDEF
AS_FIELD1
     12099**DCL     17233<<ASSIGN  17262<<ASSIGN  17285<<ASSIGN  17381<<ASSIGN  17481<<ASSIGN
AS_FIELD1.COUNT
     12100**DCL     18404<<ASSIGN  18430<<ASSIGN  18471<<ASSIGN  18497<<ASSIGN
AS_FIELD1.TEXT
     12100**DCL     18405<<ASSIGN  18431<<ASSIGN  18472<<ASSIGN  18498<<ASSIGN
AS_MODE
     11966**DCL     11968--REDEF
AS_MOD_USER.ACCESS
     14831**DCL     14832--REDEF
AS_MOD_USER.BANNER
     14818**DCL     14819--REDEF
AS_MOD_USER.BANNER_PERM
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:148  
     14820**DCL     14821--REDEF
AS_MOD_USER.BILL
     14826**DCL     14827--REDEF
AS_MOD_USER.CPROC
     14822**DCL     14823--REDEF
AS_MOD_USER.FEBILL
     14902**DCL     14903--REDEF
AS_MOD_USER.FECXTMEM
     14919**DCL     14920--REDEF
AS_MOD_USER.FEMINTS
     14904**DCL     14905--REDEF
AS_MOD_USER.FEMMEM
     14915**DCL     14916--REDEF
AS_MOD_USER.FEMTIME
     14913**DCL     14914--REDEF
AS_MOD_USER.FEPPRIV
     14910**DCL     14912--REDEF
AS_MOD_USER.FEPRIV
     14907**DCL     14909--REDEF
AS_MOD_USER.FORCE_BIT
     14816**DCL     14817--REDEF
AS_MOD_USER.KEY
     14898**DCL     14900--REDEF
AS_MOD_USER.LASTCPROC
     14824**DCL     14825--REDEF
AS_MOD_USER.LIMITS.DO_
     14872**DCL     14873--REDEF
AS_MOD_USER.LIMITS.FPOOLS
     14888**DCL     14889--REDEF
AS_MOD_USER.LIMITS.LO
     14868**DCL     14869--REDEF
AS_MOD_USER.LIMITS.MEM
     14864**DCL     14865--REDEF
AS_MOD_USER.LIMITS.MPRIO
     14892**DCL     14893--REDEF
AS_MOD_USER.LIMITS.PDIS
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:149  
     14880**DCL     14881--REDEF
AS_MOD_USER.LIMITS.PO
     14876**DCL     14877--REDEF
AS_MOD_USER.LIMITS.TDIS
     14884**DCL     14885--REDEF
AS_MOD_USER.LIMITS.TIME
     14860**DCL     14861--REDEF
AS_MOD_USER.MAXENQ
     14841**DCL     14842--REDEF
AS_MOD_USER.PERM_BIT
     14814**DCL     14815--REDEF
AS_MOD_USER.PPRIV
     14836**DCL     14838--REDEF
AS_MOD_USER.PRIOB
     14843**DCL     14844--REDEF
AS_MOD_USER.PRIV
     14833**DCL     14835--REDEF
AS_MOD_USER.QUAN
     14839**DCL     14840--REDEF
AS_MOD_USER.SETUP
     14812**DCL     14813--REDEF
AS_PROJECT.BANNER_PERM
     13152**DCL     13153--REDEF
AS_PROJECT.BUDGET.MACCT
     13057**DCL     13061--REDEF
AS_PROJECT.BUDGET.MAX_PROJECTS
     13070**DCL     13073--REDEF
AS_PROJECT.BUDGET.PACCUM
     13053**DCL     13055--REDEF
AS_PROJECT.BUDGET.PMAXC
     13048**DCL     13050--REDEF
AS_PROJECT.SETUP_CHRA.TXT
     13168**DCL     13169--REDEF   13170--REDEF
AS_PROJECT_DFLT.BANNER_PERM
     13330**DCL     13331--REDEF
AS_PROJECT_DFLT.BUDGET.MACCT
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:150  
     13235**DCL     13239--REDEF
AS_PROJECT_DFLT.BUDGET.MAX_PROJECTS
     13248**DCL     13251--REDEF
AS_PROJECT_DFLT.BUDGET.PACCUM
     13231**DCL     13233--REDEF
AS_PROJECT_DFLT.BUDGET.PMAXC
     13226**DCL     13228--REDEF
AS_PROJECT_DFLT.SETUP_CHRA.TXT
     13346**DCL     13347--REDEF   13348--REDEF
AS_PROJECT_DFLT_DREC.PASSWORD
     14552**DCL     14556--REDEF
AS_PROJECT_DFLT_DREC.RENAME
     14575**DCL     14576--REDEF
AS_PROJECT_DREC.PASSWORD
     14390**DCL     14394--REDEF
AS_PROJECT_DREC.RENAME
     14413**DCL     14414--REDEF
AS_PROJ_ADMIN.BANNER_PERM
     12974**DCL     12975--REDEF
AS_PROJ_ADMIN.BUDGET.MACCT
     12879**DCL     12883--REDEF
AS_PROJ_ADMIN.BUDGET.MAX_PROJECTS
     12892**DCL     12895--REDEF
AS_PROJ_ADMIN.BUDGET.PACCUM
     12875**DCL     12877--REDEF
AS_PROJ_ADMIN.BUDGET.PMAXC
     12870**DCL     12872--REDEF
AS_PROJ_ADMIN.SETUP_CHRA.TXT
     12990**DCL     12991--REDEF   12992--REDEF
AS_PROJ_ADMIN_DREC.PASSWORD
     14228**DCL     14232--REDEF
AS_PROJ_ADMIN_DREC.RENAME
     14251**DCL     14252--REDEF
AS_TRUE
     11963**DCL     17278>>ASSIGN  17326>>ASSIGN  17565>>ASSIGN  17715>>ASSIGN  18385>>ASSIGN  18391>>ASSIGN
     18447>>ASSIGN  18514>>ASSIGN
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:151  
AS_USERS.BANNER_PERM
     12440**DCL     12441--REDEF
AS_USERS.BUDGET.MACCT
     12345**DCL     12349--REDEF
AS_USERS.BUDGET.MAX_PROJECTS
     12358**DCL     12361--REDEF
AS_USERS.BUDGET.PACCUM
     12341**DCL     12343--REDEF
AS_USERS.BUDGET.PMAXC
     12336**DCL     12338--REDEF
AS_USERS.SETUP_CHRA.TXT
     12456**DCL     12457--REDEF   12458--REDEF
AS_USERS_CONSTANT.BANNER_PERM
     13508**DCL     13509--REDEF
AS_USERS_CONSTANT.BUDGET.MACCT
     13413**DCL     13417--REDEF
AS_USERS_CONSTANT.BUDGET.MAX_PROJECTS
     13426**DCL     13429--REDEF
AS_USERS_CONSTANT.BUDGET.PACCUM
     13409**DCL     13411--REDEF
AS_USERS_CONSTANT.BUDGET.PMAXC
     13404**DCL     13406--REDEF
AS_USERS_CONSTANT.SETUP_CHRA.TXT
     13524**DCL     13525--REDEF   13526--REDEF
B$ALT.CODE
     17068**DCL     17068--REDEF   17069--REDEF   17069--REDEF
B$ALT.ERR
     17069**DCL     18201>>ASSIGN
B$ALT.ERR.ERR#
     17070**DCL     17070--REDEF
B$ALT.EVID
     17069**DCL     17069--REDEF   17069--REDEF
B$TCB.ALT$
     17064**DCL     18201>>ASSIGN
B$TCB$
     15101**DCL     18201>>ASSIGN
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:152  
B$XL_UPPER_UR
     15104**DCL     17376>>CALLBLT 17476>>CALLBLT
B$XL_UPPER_UR$
     15103**DCL     15104--IMP-PTR 17376>>CALLBLT 17476>>CALLBLT
BLANK_PASS
     12094**DCL     17313>>ASSIGN
BLK$
     15069**DCL     16065--IMP-PTR 17185<<ASSIGN  17187<<ASSIGN  17188>>IF      17210>>ASSIGN  17211>>ASSIGN
     17211>>ASSIGN  17212>>ASSIGN  17212>>ASSIGN  17355<<ASSIGN  17356>>IF      17376>>CALLBLT 17376>>CALLBLT
     17376>>CALLBLT 17377>>ASSIGN  17422>>ASSIGN  17448>>ASSIGN  17455<<ASSIGN  17456>>IF      17476>>CALLBLT
     17476>>CALLBLT 17476>>CALLBLT 17477>>ASSIGN  17518>>ASSIGN  17523<<ASSIGN  17524>>ASSIGN  17552>>CALLBLT
     17552>>CALLBLT 17556>>CALLBLT 17556>>CALLBLT 17558>>CALLBLT 17558>>CALLBLT 17576<<ASSIGN  17577>>CALLBLT
     17577>>CALLBLT 17603<<ASSIGN  17604>>CALLBLT 17604>>CALLBLT 17627<<ASSIGN  17628>>CALLBLT 17628>>CALLBLT
     17651<<ASSIGN  17652>>CALLBLT 17652>>CALLBLT 17676<<ASSIGN  17677>>ASSIGN  17705>>CALLBLT 17705>>CALLBLT
     17709>>CALLBLT 17709>>CALLBLT 17711>>CALLBLT 17711>>CALLBLT 17723<<ASSIGN  17724>>IF      17727>>ASSIGN
     17728>>ASSIGN  17728>>ASSIGN  17759<<ASSIGN  17760>>ASSIGN  17761>>IF      17786>>ASSIGN  17787>>ASSIGN
     17787>>ASSIGN  17828<<ASSIGN  17829>>CALLBLT 17829>>CALLBLT 17856<<ASSIGN  17857>>CALLBLT 17857>>CALLBLT
     17867<<ASSIGN  17868>>CALLBLT 17868>>CALLBLT 17892<<ASSIGN  17893>>IF      17894<<ASSIGN  17895>>CALL
     17895>>CALL    17898>>CALLBLT 17898>>CALLBLT 17922<<ASSIGN  17923>>CALLBLT 17923>>CALLBLT 17947<<ASSIGN
     17948>>ASSIGN  18352<<ASSIGN  18354>>CALLBLT 18354>>CALLBLT 18390>>IF      18390>>IF      18404>>ASSIGN
     18405>>ASSIGN  18405>>ASSIGN  18430>>ASSIGN  18431>>ASSIGN  18431>>ASSIGN  18471>>ASSIGN  18472>>ASSIGN
     18472>>ASSIGN  18497>>ASSIGN  18498>>ASSIGN  18498>>ASSIGN  18527>>ASSIGN  18527>>ASSIGN
CNT
     15056**DCL     17524<<ASSIGN  17525>>IF      17547>>ASSIGN  17548>>ASSIGN  17549>>ASSIGN  17552>>CALLBLT
     17556<<CALLBLT 17557>>ASSIGN  17558<<CALLBLT 17559>>ASSIGN  17677<<ASSIGN  17678>>IF      17700>>ASSIGN
     17701>>ASSIGN  17702>>ASSIGN  17705>>CALLBLT 17709<<CALLBLT 17710>>ASSIGN  17711<<CALLBLT 17712>>ASSIGN
     17727<<ASSIGN  17760<<ASSIGN  17764>>IF      17787>>ASSIGN  17812>>DOSELCT 17829<<CALLBLT 17830>>IF
     17830>>IF      17852>>ASSIGN  17854>>ASSIGN  17857<<CALLBLT 17858>>ASSIGN  17868<<CALLBLT 17869>>IF
     17889>>ASSIGN  17895<>CALL    17898<<CALLBLT 17899>>IF      17919>>ASSIGN  17923<<CALLBLT 17924>>IF
     17944>>ASSIGN
CODE
     12096**DCL     17350<<ASSIGN  17351>>DOSELCT
CREATE
     15072**DCL     17180<<ASSIGN  17227>>CALL    17228>>IF      17258>>IF      17278<<ASSIGN  17311>>IF
     18065>>IF      18147>>IF      18156>>IF      18399>>IF      18426>>IF      18447<<ASSIGN  18466>>IF
     18493>>IF      18514<<ASSIGN
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:153  
DEV$
     15071**DCL     18091>>ASSIGN  18099>>ASSIGN  18135>>ASSIGN  18143>>ASSIGN  18379<<ASSIGN  18380>>ASSIGN
     18382>>DOWHILE 18383>>IF      18384>>IF      18387<<ASSIGN  18387>>ASSIGN  18389>>IF      18390>>IF
     18393<<ASSIGN  18393>>ASSIGN  18423>>ASSIGN  18490>>ASSIGN
DEV_SIZEW
     15077**DCL     17307<<ASSIGN  18092<<ASSIGN  18092>>ASSIGN  18136<<ASSIGN  18136>>ASSIGN  18146>>ASSIGN
     18380>>ASSIGN
DEV_START$
     15075**DCL     17306<<ASSIGN  17307>>ASSIGN  18379>>ASSIGN
DEV_STOP$
     15076**DCL     18094>>ASSIGN  18138>>ASSIGN  18380<<ASSIGN  18382>>DOWHILE
DISP
     15083**DCL     17786<<ASSIGN  17787>>ASSIGN
DSEG1$
     12104**DCL     16111--IMP-PTR 17218>>ASSIGN  17219>>ASSIGN  17225<>CALL    17227<>CALL    17306>>ASSIGN
     17307>>ASSIGN  17307>>ASSIGN  17312>>ASSIGN  17313>>ASSIGN  17314>>ASSIGN  17315>>ASSIGN  17316>>ASSIGN
     17321>>ASSIGN  17322>>ASSIGN  17323>>ASSIGN  17422>>ASSIGN  17423>>ASSIGN  17518>>ASSIGN  17519>>ASSIGN
     17562>>ASSIGN  17571>>ASSIGN  17573>>ASSIGN  17600>>ASSIGN  17624>>ASSIGN  17648>>ASSIGN  17672>>ASSIGN
     17714>>ASSIGN  17852>>ASSIGN  17967>>IF      17967>>IF      17990>>IF      17990>>IF      18014>>IF
     18033>>ASSIGN  18034>>ASSIGN  18038>>IF      18061>>ASSIGN  18062>>ASSIGN  18090>>ASSIGN  18090>>ASSIGN
     18094>>ASSIGN  18134>>ASSIGN  18134>>ASSIGN  18138>>ASSIGN  18146>>ASSIGN  18148>>ASSIGN  18149>>ASSIGN
     18151<>CALL    18536>>CALL
DSEG1SIZE
     12105**DCL     17219>>ASSIGN  17224>>ASSIGN  18095>>IF      18139>>IF
DSEG2$
     12105**DCL     16451--IMP-PTR 18106<>CALL    18108>>IF
DSEG2SIZE
     12105**DCL     18103>>ASSIGN
DSEG3$
     12105**DCL     16628--IMP-PTR 16856--IMP-PTR 17448>>ASSIGN  17449>>ASSIGN  17564>>ASSIGN  17721>>ASSIGN
     17725>>ASSIGN  17728>>ASSIGN  17729>>ASSIGN  17732>>ASSIGN  17753>>ASSIGN  17762>>ASSIGN  17795>>ASSIGN
     17799>>ASSIGN  17803>>ASSIGN  17807>>ASSIGN  17815>>ASSIGN  17818>>ASSIGN  17821>>ASSIGN  17854>>ASSIGN
     17858>>ASSIGN  17862>>ASSIGN  17864>>ASSIGN  17889>>ASSIGN  17919>>ASSIGN  17944>>ASSIGN  17948>>ASSIGN
     18037>>IF      18057>>ASSIGN  18058>>ASSIGN  18061>>ASSIGN  18062>>ASSIGN  18065>>IF      18087>>IF
     18088>>ASSIGN  18099>>ASSIGN  18105>>CALLBLT 18108>>IF      18143>>ASSIGN  18423>>ASSIGN  18449>>ASSIGN
     18450>>ASSIGN  18451>>ASSIGN  18452>>ASSIGN  18453>>ASSIGN  18458>>ASSIGN  18459>>ASSIGN  18460>>ASSIGN
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:154  
     18461>>ASSIGN  18490>>ASSIGN  18516>>ASSIGN  18517>>ASSIGN  18518>>ASSIGN  18523>>ASSIGN  18524>>ASSIGN
     18525>>ASSIGN  18526>>ASSIGN  18527>>ASSIGN
DSEG_FLG
     12104**DCL     17182>>IF
ERR_CODE
     12098**DCL     12099--REDEF   18153<>CALL    18201<<ASSIGN  18202<>CALL
EXIT#
     18179**LABEL   17227--CALLALT 17249--GOTO    17255--GOTO    17301--GOTO    17308--CALLALT 18154--GOTO
     18198--GOTO
FIND_VIRCIR
     18206**PROC    17308--CALL
FOUND
     15065**DCL     18089>>IF      18133>>IF      18381<<ASSIGN  18382>>DOWHILE 18385<<ASSIGN  18391<<ASSIGN
     18398>>IF      18465>>IF
FPT_NODEINFO
     15141**DCL     17730<>CALL
FPT_NODEINFO.V
     15141**DCL     15141--DCLINIT
FPT_NODEINFO.V.NODENAME#
     15141**DCL     17729<<ASSIGN
GETSEG_ERR
     18170**LABEL   17182--CALLALT 18097--CALLALT 18141--CALLALT
I
     15057**DCL     17348<<DOINDEX 17349>>ASSIGN  17788<<DOINDEX 17789>>CALLBLT 17791>>DOSELCT
IN_BUF
     12094**DCL     17339<>CALL
J
     15058**DCL     17549<<ASSIGN  17550>>IF      17552<<CALLBLT 17553>>ASSIGN  17555<<DOINDEX 17556>>CALLBLT
     17557>>ASSIGN  17558>>CALLBLT 17559>>ASSIGN  17577<<CALLBLT 17578>>IF      17600>>ASSIGN  17604<<CALLBLT
     17605>>IF      17624>>ASSIGN  17628<<CALLBLT 17629>>IF      17648>>ASSIGN  17652<<CALLBLT 17653>>IF
     17672>>ASSIGN  17702<<ASSIGN  17703>>IF      17705<<CALLBLT 17706>>ASSIGN  17708<<DOINDEX 17709>>CALLBLT
     17710>>ASSIGN  17711>>CALLBLT 17712>>ASSIGN  17789<<CALLBLT 17795>>ASSIGN  17799>>ASSIGN  17803>>ASSIGN
     17807>>ASSIGN
K
     15059**DCL     17547<<ASSIGN  17553>>ASSIGN  17555>>DOINDEX 17700<<ASSIGN  17706>>ASSIGN  17708>>DOINDEX
KL$DREC
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:155  
     16111**DCL     17312<<ASSIGN
KL$DREC.LNK
     16233**DCL     17218--ASSIGN  17218--ASSIGN  17306--ASSIGN  17306--ASSIGN  17307--ASSIGN  17314<<ASSIGN
KL$DREC.LNK.ADR
     16340**DCL     17562<<ASSIGN
KL$DREC.LNK.BLKHDR.BLKTYP
     16277**DCL     17323<<ASSIGN
KL$DREC.LNK.BLKHDR.LEN.BYT
     16270**DCL     17321<<ASSIGN  17322<<ASSIGN
KL$DREC.LNK.BLKHDR.LEV
     16253**DCL     17315<<ASSIGN
KL$DREC.LNK.BLKHDR.NSUBS
     16264**DCL     17316<<ASSIGN  18090<<ASSIGN  18090>>ASSIGN  18134<<ASSIGN  18134>>ASSIGN
KL$DREC.LNK.DEST
     16413**DCL     17714<<ASSIGN
KL$DREC.LNK.DFLTVCPRO.CNT
     16402**DCL     17518<<ASSIGN  18062>>ASSIGN
KL$DREC.LNK.DFLTVCPRO.TXT
     16405**DCL     17519<<ASSIGN  18038>>IF      18061>>ASSIGN
KL$DREC.LNK.HIC
     16369**DCL     17648<<ASSIGN  17967>>IF
KL$DREC.LNK.HOC
     16379**DCL     17672<<ASSIGN  17990>>IF
KL$DREC.LNK.LIC
     16364**DCL     17600<<ASSIGN  17967>>IF
KL$DREC.LNK.LOC
     16374**DCL     17624<<ASSIGN  17990>>IF
KL$DREC.LNK.MODE#
     16386**DCL     17571<<ASSIGN  17573<<ASSIGN
KL$DREC.LNK.QOS#
     16427**DCL     17852<<ASSIGN
KL$DREC.NWINFO
     16209**DCL     17307>>ASSIGN  18146<<ASSIGN  18148<<ASSIGN  18149>>ASSIGN
KL$DREC.PASSWORD
     16169**DCL     16173--REDEF   17313<<ASSIGN
KL$DREC.PNAME
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:156  
     16175**DCL     18536<>CALL
KL$DREC.PNAME.CNT
     16183**DCL     17422<<ASSIGN  18034<<ASSIGN
KL$DREC.PNAME.TXT
     16186**DCL     17423<<ASSIGN  18014>>IF      18033<<ASSIGN
KL$DREC.RENAME
     16192**DCL     16193--REDEF
KL$LINKDEV
     16856**DCL     18143<<ASSIGN  18143>>ASSIGN  18490<<ASSIGN  18490>>ASSIGN  18516<<ASSIGN
KL$LINKDEV.BLKHDR.BLKTYP
     16918**DCL     18525<<ASSIGN
KL$LINKDEV.BLKHDR.LEN.BYT
     16911**DCL     18523<<ASSIGN  18524<<ASSIGN
KL$LINKDEV.BLKHDR.LEV
     16894**DCL     18517<<ASSIGN
KL$LINKDEV.BLKHDR.NSUBS
     16905**DCL     18518<<ASSIGN
KL$LINKDEV.BLKHDR.USE
     16949**DCL     18526<<ASSIGN
KL$LINKDEV.CIRCUITS#
     16974**DCL     17889<<ASSIGN
KL$LINKDEV.LOGON#
     17008**DCL     18105>>CALLBLT 18390>>IF      18527<<ASSIGN
KL$LINKDEV.MODE
     16999**DCL     17948<<ASSIGN  18108>>IF
KL$LINKDEV.PROTOCOL#
     16980**DCL     17919<<ASSIGN
KL$LINKDEV.SUBADDR#
     16983**DCL     17944<<ASSIGN
KL$LNKVC
     16628**DCL     17221<<ASSIGN  18099<<ASSIGN  18099>>ASSIGN  18423<<ASSIGN  18423>>ASSIGN  18449<<ASSIGN
KL$LNKVC.ADR
     16774**DCL     17564<<ASSIGN
KL$LNKVC.BLKHDR.BLKTYP
     16674**DCL     18460<<ASSIGN
KL$LNKVC.BLKHDR.DEVNUM
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:157  
     16701**DCL     18453<<ASSIGN
KL$LNKVC.BLKHDR.LEN.BYT
     16667**DCL     18458<<ASSIGN  18459<<ASSIGN
KL$LNKVC.BLKHDR.LEV
     16650**DCL     18383>>IF      18389>>IF      18451<<ASSIGN
KL$LNKVC.BLKHDR.NSUBS
     16661**DCL     18452<<ASSIGN
KL$LNKVC.BLKHDR.USE
     16705**DCL     18461<<ASSIGN
KL$LNKVC.CUG
     16727**DCL     16771--REDEF
KL$LNKVC.CUG.BCD1#
     16752**DCL     17795<<ASSIGN
KL$LNKVC.CUG.BCD2#
     16756**DCL     17799<<ASSIGN
KL$LNKVC.CUG.BCD3#
     16763**DCL     17803<<ASSIGN
KL$LNKVC.CUG.BCD4#
     16767**DCL     17807<<ASSIGN
KL$LNKVC.CUG.LNG#
     16742**DCL     17762<<ASSIGN  17815<<ASSIGN  17818<<ASSIGN  17821<<ASSIGN
KL$LNKVC.DST#
     16794**DCL     17728<<ASSIGN  17729>>ASSIGN  17753<<ASSIGN  18087>>IF
KL$LNKVC.NODE#
     16814**DCL     17721<<ASSIGN  17725<<ASSIGN  17732<<ASSIGN  18088<<ASSIGN
KL$LNKVC.PERMANENT
     16833**DCL     17862<<ASSIGN  17864<<ASSIGN  18065>>IF
KL$LNKVC.PRONM.CNT
     16804**DCL     17448<<ASSIGN  18058<<ASSIGN  18062<<ASSIGN
KL$LNKVC.PRONM.TXT
     16808**DCL     17449<<ASSIGN  18037>>IF      18057<<ASSIGN  18061<<ASSIGN
KL$LNKVC.QOS#
     16826**DCL     17854<<ASSIGN  17858<<ASSIGN
KL$LNKVC.VIRCIR#
     16819**DCL     18384>>IF      18450<<ASSIGN
KL$PHDR
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:158  
     17024**DCL     17379<>CALL    17479<>CALL    18536<>CALL    18555--ASSIGN
KL$PHDR.TTYP
     17025**DCL     17400>>IF      17426>>IF      17500>>IF      18557>>IF
KL$UBWORD.NUM
     17056**DCL     17057--REDEF   17318<<ASSIGN  18455<<ASSIGN  18520<<ASSIGN
KL$UBWORD.REPLACE.B
     17061**DCL     17320<<ASSIGN  17322>>ASSIGN  18457<<ASSIGN  18459>>ASSIGN  18522<<ASSIGN  18524>>ASSIGN
KL$UBWORD.REPLACE.T
     17059**DCL     17319<<ASSIGN  17321>>ASSIGN  18456<<ASSIGN  18458>>ASSIGN  18521<<ASSIGN  18523>>ASSIGN
KL_DEFAULT.PASSWORD
     14714**DCL     14718--REDEF
KL_DEFAULT.RENAME
     14737**DCL     14738--REDEF
KL_DFLT.PASSWORD
     13904**DCL     13908--REDEF
KL_DFLT.RENAME
     13927**DCL     13928--REDEF
KL_DREC.PASSWORD
     13742**DCL     13746--REDEF
KL_DREC.RENAME
     13765**DCL     13766--REDEF
KL_DREC_CNT
     13571**DCL     18149--ASSIGN
KL_DREC_CNT.PASSWORD
     13629**DCL     13633--REDEF
KL_DREC_CNT.RENAME
     13652**DCL     13653--REDEF
KL_LINKDEV
     15850**DCL     18136--ASSIGN  18138--ASSIGN  18393--ASSIGN  18516>>ASSIGN  18519--ASSIGN
KL_LNKVC
     15622**DCL     17219--ASSIGN  17222--ASSIGN  18092--ASSIGN  18094--ASSIGN  18387--ASSIGN  18449>>ASSIGN
     18454--ASSIGN
KL_LNKVC.CUG
     15721**DCL     15765--REDEF
KL_TERM_KEY
     15221**DCL     18159--CALL    18164--CALL    18170--CALL
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:159  
KL_TERM_KEY.TERMID.TERM
     15242**DCL     15251--REDEF
KL_TERM_KEY.TERMID.TERM.TERM_NAME
     15251**DCL     18158<<ASSIGN  18163<<ASSIGN  18169<<ASSIGN
KL_TERM_REC
     15173**DCL     18157<<ASSIGN  18159--CALL    18164--CALL    18168<<ASSIGN  18170--CALL
KL_TERM_REC.TERMID.TERM
     15195**DCL     15204--REDEF
LINK
     15066**DCL     17163<<ASSIGN  17166>>IF      17184>>IF      17227>>CALL    17228>>IF      17257>>IF
     17305>>IF      17328>>IF      17399>>IF      17499>>IF      17561>>IF      17851>>IF      17966>>IF
     18145>>IF
LINK$ IN PROCEDURE FIND_VIRCIR
     18208**DCL     18555<<ASSIGN  18556>>ASSIGN
LINKDEV
     15068**DCL     17165<<ASSIGN  17170>>IF      17332>>IF      18102>>IF
LINK_CMD
     15095**DCL     17167--ASSIGN
LINK_DEST_SET
     15085**DCL     17162<<ASSIGN  17715<<ASSIGN
LINK_DEV_CMD
     15099**DCL     17171--ASSIGN
LINK_DEV_OPTS_LIST
     15100**DCL     17333--ASSIGN
LINK_DREC
     15278**DCL     17312>>ASSIGN
LINK_DREC.LNK
     15400**DCL     17314>>ASSIGN  17317--ASSIGN  18146--ASSIGN  18148--ASSIGN
LINK_DREC.NWINFO
     15376**DCL     18146>>ASSIGN
LINK_DREC.PASSWORD
     15336**DCL     15340--REDEF
LINK_DREC.RENAME
     15359**DCL     15360--REDEF
LINK_KEY
     15111**DCL     17213>>ASSIGN  18150>>ASSIGN
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:160  
LINK_KEY.TXT.ACCT
     15114**DCL     17212<<ASSIGN
LINK_LOOP
     17336**LABEL   17344--GOTO    17988--GOTO    18011--GOTO    18084--GOTO
LINK_NAME
     15079**DCL     17227<>CALL    17233>>ASSIGN  17262>>ASSIGN  17285>>ASSIGN
LINK_NAME.COUNT
     15080**DCL     17210<<ASSIGN
LINK_NAME.TEXT
     15081**DCL     17211<<ASSIGN  18158>>ASSIGN  18163>>ASSIGN  18169>>ASSIGN
LINK_OPTS_LIST
     15096**DCL     17329--ASSIGN
LNGTH
     15128**DCL     15131--REDEF
LNGTH.B
     15130**DCL     17320>>ASSIGN  18457>>ASSIGN  18522>>ASSIGN
LNGTH.T
     15129**DCL     17319>>ASSIGN  18456>>ASSIGN  18521>>ASSIGN
LNG_CNT
     15131**DCL     17317<<ASSIGN  18454<<ASSIGN  18519<<ASSIGN
LOOP_END
     17964**LABEL   17372--GOTO    17397--GOTO    17472--GOTO    17497--GOTO    17849--GOTO
M$NODEINFO
      7108**DCL-ENT 17730--CALL
MERR_CODE.CODE
     12099**DCL     17253>>IF      18166>>IF
MORE
     15061**DCL     17326<<ASSIGN  17334>>DOWHILE 17951<<ASSIGN
MOVE_SIZE
     15073**DCL     17052--IMP-SIZ
NETCON_ERR
     18198**LABEL   18159--CALLALT 18170--CALLALT 18173--GOTO
NODE$
     12096**DCL     16018--IMP-PTR 17163>>ASSIGN  17164>>ASSIGN  17165>>ASSIGN  17178<<ASSIGN  17180>>ASSIGN
     17185>>ASSIGN  17187>>ASSIGN  17346<<ASSIGN  17348>>DOINDEX 17349>>ASSIGN  18352>>ASSIGN
OUT$SYM
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:161  
     16065**DCL     17895<>CALL
OUT$SYM.CODE
     16071**DCL     17761>>IF
OUT$SYM.COUNT
     16088**DCL     16091--IMP-SIZ 17188>>IF      17210>>ASSIGN  17211>>ASSIGN  17212>>ASSIGN  17356>>IF
     17376>>CALLBLT 17376>>CALLBLT 17377>>ASSIGN  17422>>ASSIGN  17448>>ASSIGN  17456>>IF      17476>>CALLBLT
     17476>>CALLBLT 17477>>ASSIGN  17518>>ASSIGN  17524>>ASSIGN  17552>>CALLBLT 17556>>CALLBLT 17558>>CALLBLT
     17577>>CALLBLT 17604>>CALLBLT 17628>>CALLBLT 17652>>CALLBLT 17677>>ASSIGN  17705>>CALLBLT 17709>>CALLBLT
     17711>>CALLBLT 17727>>ASSIGN  17728>>ASSIGN  17760>>ASSIGN  17786>>ASSIGN  17787>>ASSIGN  17829>>CALLBLT
     17857>>CALLBLT 17868>>CALLBLT 17895>>CALL    17898>>CALLBLT 17923>>CALLBLT 18354>>CALLBLT 18390>>IF
     18404>>ASSIGN  18405>>ASSIGN  18430>>ASSIGN  18431>>ASSIGN  18471>>ASSIGN  18472>>ASSIGN  18497>>ASSIGN
     18498>>ASSIGN  18527>>ASSIGN
OUT$SYM.NDTYPE
     16068**DCL     17893>>IF
OUT$SYM.TEXT
     16091**DCL     17211>>ASSIGN  17212>>ASSIGN  17376>>CALLBLT 17476>>CALLBLT 17552>>CALLBLT 17556>>CALLBLT
     17558>>CALLBLT 17577>>CALLBLT 17604>>CALLBLT 17628>>CALLBLT 17652>>CALLBLT 17705>>CALLBLT 17709>>CALLBLT
     17711>>CALLBLT 17728>>ASSIGN  17787>>ASSIGN  17829>>CALLBLT 17857>>CALLBLT 17868>>CALLBLT 17898>>CALLBLT
     17923>>CALLBLT 18354>>CALLBLT 18390>>IF      18405>>ASSIGN  18431>>ASSIGN  18472>>ASSIGN  18498>>ASSIGN
     18527>>ASSIGN
P$NODE.CODE
     16026**DCL     17163>>ASSIGN  17164>>ASSIGN  17165>>ASSIGN  17180>>ASSIGN  17350>>ASSIGN  17570>>IF
     17724>>IF      17861>>IF      17948>>ASSIGN
P$NODE.SUBLK$
     16051**DCL     17185>>ASSIGN  17187>>ASSIGN  17349>>ASSIGN  17355>>ASSIGN  17455>>ASSIGN  17523>>ASSIGN
     17570>>IF      17576>>ASSIGN  17603>>ASSIGN  17627>>ASSIGN  17651>>ASSIGN  17676>>ASSIGN  17723>>ASSIGN
     17759>>ASSIGN  17828>>ASSIGN  17856>>ASSIGN  17861>>IF      17867>>ASSIGN  17892>>ASSIGN  17894>>ASSIGN
     17922>>ASSIGN  17947>>ASSIGN  18352>>ASSIGN
P$NODE.SUBNODES
     16030**DCL     17348>>DOINDEX 17720>>IF
PRO$
     15070**DCL     17024--IMP-PTR 17374<<ASSIGN  17379>>CALL    17400>>IF      17426>>IF      17474<<ASSIGN
     17479>>CALL    17500>>IF      18534<<ASSIGN  18536>>CALL    18555>>ASSIGN  18557>>IF
PROJ_KEY.TEXT
     11976**DCL     11976--REDEF
PROJ_KEY.TXT.PROJECT
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:162  
     11976**DCL     11976--REDEF
PRO_BUF
     15078**DCL     17374--ASSIGN  17375--ASSIGN  17474--ASSIGN  17475--ASSIGN  18534--ASSIGN  18535--ASSIGN
PRO_END$ IN PROCEDURE FIND_VIRCIR
     18212**DCL     18556<<ASSIGN
PRO_HDR IN PROCEDURE FIND_VIRCIR
     18226**DCL     18555--ASSIGN
PTR$
     15055**DCL     17218<<ASSIGN  17220>>DOWHILE 17221>>ASSIGN  17222<<ASSIGN  17222>>ASSIGN  17349<<ASSIGN
     17350>>ASSIGN  17355>>ASSIGN  17455>>ASSIGN  17523>>ASSIGN  17570>>IF      17576>>ASSIGN  17603>>ASSIGN
     17627>>ASSIGN  17651>>ASSIGN  17676>>ASSIGN  17720>>IF      17723>>ASSIGN  17759>>ASSIGN  17828>>ASSIGN
     17856>>ASSIGN  17861>>IF      17867>>ASSIGN  17892>>ASSIGN  17894>>ASSIGN  17922>>ASSIGN  17947>>ASSIGN
     18091<<ASSIGN  18135<<ASSIGN
PTR2$
     15087**DCL     17219<<ASSIGN  17220>>DOWHILE
P_PCB
     12131**DCL     17172<>CALL    17341<>CALL
P_PCB.ERROR
     12235**DCL     17174<>CALL    17343<>CALL
P_PCB.NCHARS
     12278**DCL     17340<<ASSIGN
P_PCB.OUT$
     12144**DCL     17178>>ASSIGN  17346>>ASSIGN
P_PCB.ROOT$
     12136**DCL     17167<<ASSIGN  17169<<ASSIGN  17171<<ASSIGN  17329<<ASSIGN  17331<<ASSIGN  17333<<ASSIGN
REMEM_VAR
     12102**DCL     12102--REDEF
REM_FCMD
     12102**DCL     12103--REDEF
RES$DEV.PASSWORD
     16509**DCL     16513--REDEF
RES$DEV.RENAME
     16532**DCL     16533--REDEF
RES$DEV.RES_DEV.MODE
     16582**DCL     18108>>IF
SIZE
PL6.E3A0      #001=ASA$LINK_VIRCIR File=ASA$LINK_VIRCIR.:E05TSI                  TUE 07/29/97 08:40 Page:163  
     15074**DCL     18094<<ASSIGN  18095>>IF      18096<<ASSIGN  18096>>ASSIGN  18097<>CALL    18138<<ASSIGN
     18139>>IF      18140<<ASSIGN  18140>>ASSIGN  18141<>CALL
TEMP_STR
     15082**DCL     17785<<ASSIGN  17787<<ASSIGN  17789>>CALLBLT
USERS_KEY
     11973**DCL     17213<<ASSIGN  17254<>CALL    17379<>CALL    17381>>ASSIGN  17479<>CALL    17481>>ASSIGN
     18150<<ASSIGN
USERS_KEY.COUNT
     11973**DCL     17377<<ASSIGN  17477<<ASSIGN  18104<<ASSIGN
USERS_KEY.TEXT
     11973**DCL     11974--REDEF   11974--REDEF   11974--REDEF   11975--REDEF
USERS_KEY.TXTC
     11974**DCL     17378<<ASSIGN  17478<<ASSIGN  18105<<CALLBLT
VC_ADDR_SET
     15084**DCL     17161<<ASSIGN  17565<<ASSIGN  18065>>IF
VIRCIR
     15067**DCL     17164<<ASSIGN  17168>>IF      17330>>IF      18036>>IF      18353>>IF      18397>>IF
VIRCIR#
     15062**DCL     18354<<CALLBLT 18355>>IF      18355>>IF      18384>>IF      18450>>ASSIGN  18453>>ASSIGN
VIR_CIR_CMD
     15097**DCL     17169--ASSIGN
VIR_CIR_OPTS_LIST
     15098**DCL     17331--ASSIGN
VLR_NODEINFO
     15153**DCL     15141--DCLINIT
VLR_NODEINFO.NODENUM#
     15153**DCL     17732>>ASSIGN
X$PARSE
     17080**DCL-ENT 17172--CALL    17341--CALL
XPNAME
     15089**DCL     17376<<CALLBLT 17378>>ASSIGN  17423>>ASSIGN  17449>>ASSIGN  17476<<CALLBLT 17478>>ASSIGN
     17519>>ASSIGN
