VERSION E05

PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:1    
        1        1        /*M*  End action poster for the OD controller               */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7
        8        8        /*F*
        9        9              NAME: FPA$ODIN
       10       10              PURPOSE:
       11       11                 To process Optical Disc input messages.
       12       12              DEESCRIPTION:
       13       13                 Called from KIA$ISCAN for input messages from the optical disc
       14       14                 controller.  This will altreturn with error K$WAIT_READ
       15       15                 to leave the message in the queue so the user code in
       16       16                 FPO$xxxx can look at it.
       17       17        */
       18       18
       19       19        FPA$ODIN: PROC (NK$LDCT,K$RWPARM) ALTRET;
       20       20
       21       21        %INCLUDE CP_6;
       22     5580        %INCLUDE CP_6_SUBS;
       23     6120        %INCLUDE B$USER;
       24     6336        %INCLUDE EL$TABLES;
       25     6659        %INCLUDE EL_SUBS_C;
       26     6743        %INCLUDE FR$RAT;
       27     6796        %FR$RAT;
       28     6836        %INCLUDE FR_SUBS;
       29     6904        %INCLUDE FT_SUBS;
       30     6984        %INCLUDE HF_LOCK_C;
       31     6998        %INCLUDE K_SUBS_C;
       32     7031        %INCLUDE K$RWPARM;
       33     7417        %INCLUDE KI$MHDR;
       34     7558        %INCLUDE KV$VDO;
       35     8573        %KV_VDO_E;                         /* VDO EQUs                       */
       36     8609        %INCLUDE KI_DATA_R;
       37     8635        %INCLUDE KI_MACROS_C;
PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:2    
       38     9243        %INCLUDE NI_DATA_R;
       39     9680        %INCLUDE NK$LDCT;
       40     9782        %INCLUDE NK_SUBS;
       41     9807        %INCLUDE OC_SUBS_C;
       42    10538        %INCLUDE FP_MACRO_C;
       43    10810        %INCLUDE FT$LBLS;
       44    11078        %INCLUDE FP$LBLS;
       45    11240        %INCLUDE SS_SCHED_C;
       46    11473
       47    11474        %SUB FRL_ANSTAP=3;
       48    11475        %SUB FRL_UXPANS=5;
       49    11476
       50    11477        /*    Parameters                   */
       51    11478
       52    11479        %NK$LDCT (STCLASS="");
       53    11525        %K$RWPARM (NAME=K$RWPARM);
       54    11841
       55    11842        /*    Based                        */
       56    11843
       57    11844    1   DCL UBNBSD UBIN WORD ALIGNED BASED;
       58    11845        %NI$DCT (STCLASS=BASED,NAME=DCT);
       59    11893        %NI$DQH;
       60    11916        %KI$QMHDR;
       61    11965        %KI$FEI;
       62    12049        %KV$VDO (STCLASS="BASED(K$RWPARM.UHDR$)");
       63    12076        %KV$VDO_EVT (STCLASS="BASED(K$RWPARM.UHDR$)");
       64    12118        %FPP$MNTACK (NAME = MNTACK,STCLASS="BASED(K$RWPARM.MSG$)");
       65    12137        %FPP$ERRMSG (NAME = ERRMSG,STCLASS="BASED(K$RWPARM.MSG$)");
       66    12161        %FPP$OCKEYNREQ (NAME = OCMSG, STCLASS = "BASED(K$RWPARM.MSG$)");
       67    12179        %FPP$XFERACK (NAME = MAPACK, STCLASS = "BASED(K$RWPARM.MSG$)");
       68    12209        %FPP$MHDR (STCLASS="BASED(K$RWPARM.MSG$)");
       69    12223
       70    12224        %INCLUDE FT$DDT;
       71    12285
       72    12286
       73    12287        /*    External                     */
       74    12288
PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:3    
       75    12289    1   DCL FR$HD$(0:0) PTR SYMREF;               /* Resource lists              */
       76    12290    1   DCL B$USRT$ PTR SYMREF;
       77    12291
       78    12292    1   DCL SSR$RUE ENTRY(4);
       79    12293    1   DCL FRC$AVR ENTRY(3) ALTRET;
       80    12294    1   DCL ELA$SYSLOG ENTRY(6) ALTRET;
       81    12295    1   DCL OCI$MK_WR ENTRY(7);
       82    12296    1   DCL SC_FPABADDEV ENTRY CONV(2,0);
       83    12297        /*    Auto                         */
       84    12298
       85    12299        %KV$VDO_EVT (NAME=VDO,STCLASS=AUTO);
       86    12341    1   DCL FEI UBIN;                      /* FEP number                     */
       87    12342    1   DCL M$  PTR;                       /* OD message ptr                 */
       88    12343    1   DCL O$  PTR;                       /* mount device RAT ptr           */
       89    12344    1   DCL R$  PTR;                       /* RAT ptr from message           */
       90    12345    1   DCL MNTDCT$ PTR;    /* ptr to mounted device DCT entry        */
       91    12346    1   DCL D$  PTR;                       /* ptr to device DDT entry        */
       92    12347    1   DCL V1$ PTR;                       /* ptr to OD volume label         */
       93    12348    1   DCL I  UBIN;                       /* temp                           */
       94    12349    1   DCL USR UBIN(9);                   /* user number for mapack   */
       95    12350    1   DCL DCTX UBIN;                     /* dct index                      */
       96    12351    1   DCL 1 CDCTX REDEF DCTX,            /* for conversion from controller */
       97    12352    1         2 * UBIN(20) UNAL,
       98    12353    1         2 HI UBIN(8) UNAL,
       99    12354    1         2 LO UBIN(8) UNAL;
      100    12355        %EL$FEPERR (STCLASS=AUTO);
      101    12434    1   DCL ERRCD UBIN WORD;
      102    12435    1   DCL 1 MSGTBL,
      103    12436    1         2 SN CHAR(6) CALIGNED,
      104    12437    1         2 MSGTYP UBIN BYTE UNAL,
      105    12438    1         2 MSGSEL UBIN BYTE UNAL;
      106    12439
      107    12440        /*    Static data                  */
      108    12441
      109    12442    1   DCL MSGL BIT(36) STATIC INIT('006001001000'O);
      110    12443
      111    12444
PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:4    
      112    12445
      113    12446    2         IF NK$LDCT.IP$ ~= ADDR(NIL) THEN DO;
      114    12447    2            K$RWPARM.ERR = %K$DEFER_IO;
      115    12448    2            ALTRETURN;
      116    12449    2            END;
      117    12450    1         NK$LDCT.IP$ = K$RWPARM.IP$;
      118    12451    1         NK$LDCT.IPFEI# = K$RWPARM.IP$->KI$QMHDR.FEI#;
      119    12452    1         FEI = NK$LDCT.IPFEI#;
      120    12453    1         VDO = KV$VDO_EVT;
      121    12454    2         DO CASE (VDO.FNC);
      122    12455    2         CASE (%KV_VDO_FNC_DAT);
      123    12456    2            IF FPP$MHDR.FNC ~= %FP_FNC_OCMSG AND
      124    12457    2               FPP$MHDR.FNC ~= %FP_FNC_MAP_ACK AND
      125    12458    3               FPP$MHDR.FNC ~= %FP_FNC_ERRLOG THEN DO;
      126    12459    3               DCTX = 0;
      127    12460    3               CDCTX.HI = MNTACK.DCTX.HI;
      128    12461    3               CDCTX.LO = MNTACK.DCTX.LO;   /* resource dct index    */
      129    12462    3               R$ = N$DCT$(DCTX)->DCT.RAT$;
      130    12463    3         MNTDCT$ = N$DCT$(DCTX);
      131    12464              /* Check if volume found */
      132    12465    3         IF MNTACK.STT = 1 AND MNTACK.FNC = %FP_FNC_MOUNT_ACK THEN
      133    12466    3           GOTO NO_VOLUME;
      134    12467                    /* Pass message ptr back to soliciting user in his DCT */
      135    12468    3               N$DCT$(DCTX)->DCT.OD.IP$ = K$RWPARM.IP$;
      136    12469                    /* Search for the fep and device number described by
      137    12470                       the message we just received.                    */
      138    12471    3               O$ = FR$HD$(FR_NPOOL);
      139    12472    4               DO WHILE (O$ ~= ADDR(NIL));
      140    12473    4                  MNTDCT$ = N$DCT$(O$->FR$RAT.DCTX);
      141    12474    4                  IF (O$->FR$RAT.TYP = 'OD' AND
      142    12475    4                     MNTDCT$->DCT.DVN = MNTACK.DEV# AND
      143    12476    4                     MNTDCT$->DCT.DQH$->NI$DQH.FEX = FEI) THEN
      144    12477    4                     GOTO GOTDCT;
      145    12478    4                  O$ = O$->FR$RAT.LNK$;
      146    12479    4                  END;
      147    12480    3               CALL SC_FPABADDEV;
      148    12481    3               RETURN;
PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:5    
      149    12482        /*S*
      150    12483              SCREECH_CODE: FPA-S$AVRDCT-8
      151    12484              TYPE: SCREECH
      152    12485              MESSAGE: The OD controller message contained a bad device number.
      153    12486              DESCRIPTION: The specified device number could not be found in
      154    12487              the list of dcts attached to the OD controller.
      155    12488        */
      156    12489    3   GOTDCT: ;
      157    12490    3               D$ = MNTDCT$->DCT.DDT$;
      158    12491    3               END;
      159    12492    2   NO_VOLUME: ;
      160    12493    3            DO CASE (FPP$MHDR.FNC);
      161    12494    3            CASE (%FP_FNC_MOUNT_ACK); /* Mount result from the OSAR     */
      162    12495    4               IF (MNTACK.STT = 0 OR MNTACK.STT = 2) THEN DO;
      163    12496                       /*  Put AVR data into DDT      */
      164    12497    4                  V1$ = ADDR(MNTACK.VOL1);
      165    12498    4                  D$->FT$DDT.ANST = %YES#;
      166    12499    4                  D$->FT$DDT.SOLICIT = 0;
      167    12500    4                  D$->FT$DDT.POSLOST = %NO#;
      168    12501    4                  D$->FT$DDT.RINGIN = %YES#;
      169    12502    4                  IF MNTACK.STT = 2 THEN
      170    12503    4                     D$->FT$DDT.RINGIN = %NO#;
      171    12504    4                  D$->FT$DDT.SN = V1$->FP$VOL1.SN;
      172    12505    4                  D$->FT$DDT.ACCT = V1$->FP$VOL1.ACCOUNT;
      173    12506    5                  IF D$->FT$DDT.ACCT ~= ' ' THEN DO;
      174    12507    5                     IF V1$->FP$VOL1.ACCESS = 'I' THEN
      175    12508    5                        D$->FT$DDT.VOLACCESS = %IN#; /* Determine volume protection */
      176    12509    5                     ELSE
      177    12510    5                        IF V1$->FP$VOL1.ACCESS = 'N' THEN
      178    12511    5                           D$->FT$DDT.VOLACCESS = %NONE#;
      179    12512    5                        ELSE
      180    12513    5                           D$->FT$DDT.VOLACCESS = %ALL#;
      181    12514    5                     END;
      182    12515    4                  CALL CHARBIN (I,MNTACK.FSEQU_NUM);
      183    12516    5                  IF (I = 0) THEN DO;   /* Any files on volume? */
      184    12517    5                     D$->FT$DDT.SCRTCH = %YES#;
      185    12518    5                     D$->FT$DDT.FSN = 0;
PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:6    
      186    12519    5                     D$->FT$DDT.FRSTFSN = 0;
      187    12520    5                     D$->FT$DDT.FRSTFSECT = 0;
      188    12521    5                     END;
      189    12522    5                  ELSE DO;
      190    12523    5                     D$->FT$DDT.SCRTCH = %NO#;
      191    12524    5                     D$->FT$DDT.FSN = I - 1;          /* Before next file     */
      192    12525    5                     D$->FT$DDT.FRSTFSN = I - 1;      /* First on volume    */
      193    12526    5                     CALL CHARBIN (I,MNTACK.FSECT );
      194    12527    5                     D$->FT$DDT.FRSTFSECT = I;        /* First section on volume */
      195    12528    5                     END;
      196    12529    4                  D$->FT$DDT.POS = FRL_ANSTAP;
      197    12530    4                  MNTDCT$->DCT.OD.USER# = R$->FR$RAT.SOLU; /* waiting user */
      198    12531                       /* Let resource management know about mounted DCT   */
      199    12532    4                  DCTX = O$->FR$RAT.DCTX;
      200    12533    4                  CALL FRC$AVR (DCTX,FRC_LBL#,D$->FT$DDT.SN) ALTRET(ILGLMNT);
      201    12534    5                  DO WHILE ('0'B);
      202    12535    5   ILGLMNT:          D$->FT$DDT.POSLOST = %YES#;
      203    12536    5                     END;
      204    12537    4                  D$->FT$DDT.POS = FTP_BOV#;
      205    12538    4                  D$->FT$DDT.SOLICIT = 0;
      206    12539    4                  END;
      207    12540    3            CASE (%FP_FNC_ERRLOG);
      208    12541    3               EL$FEPERR = '0'B;
      209    12542    3               EL$FEPERR.STATDATA.NODE = KI$FEI$(FEI)->KI$FEI.FEP#;
      210    12543                  /* Set errorcode to FPA-M-1700-2 plus ADSS code number */
      211    12544    3               EL$FEPERR.STATDATA.ERRCODE = '062001432442'O;
      212    12545    3               EL$FEPERR.STATDATA.ERRCODE.ERR# =
      213    12546    3                  EL$FEPERR.STATDATA.ERRCODE.ERR# + ERRMSG.ERRNUM;
      214    12547    4               DO I = 0 TO 3;
      215    12548    4                  EL$FEPERR.STATDATA.VALUES(I) = BITBIN(ERRMSG.VALUES(I));
      216    12549    4                  END;
      217    12550    3               EL$FEPERR.X.DYMDATA = ERRMSG.DYMDATA;
      218    12551    3               CALL ELA$SYSLOG(EL_FEPERR,EL$FEPERR,SIZEW(EL$FEPERR),'0'B,1,ERRCD);
      219    12552    3               GOTO GETOUT;
      220    12553    3            CASE (%FP_FNC_OCMSG);
      221    12554    3               MSGTBL.MSGSEL = 1;
      222    12555    3               MSGTBL.MSGTYP = OCMSG.TYPE;
PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:7    
      223    12556    3               MSGTBL.SN = OCMSG.SER;
      224    12557    3               CALL OCI$MK_WR(M_SYS,FP_OSAR_MSG#,3,MSGL,MSGTBL,,);
      225    12558    3               GOTO GETOUT;
      226    12559    3            CASE (%FP_FNC_MAP_ACK);
      227    12560    3               USR = MAPACK.USRNO.B1 * 256 + MAPACK.USRNO.B2;
      228    12561    3               CALL SSR$RUE (%SS_CIC,USR);
      229    12562    3               GOTO XIT2;
      230    12563    3            CASE (%FP_FNC_DISMOUNT_ACK);
      231    12564    3            CASE (%FP_FNC_POSEOV_ACK);
      232    12565    3            CASE (%FP_FNC_WRITELBL_ACK);
      233    12566    3            CASE (%FP_FNC_RDEOF_ACK);
      234    12567    3            CASE (%FP_FNC_FND_ACK);
      235    12568    3            CASE (%FP_FNC_RDWR_ACK);
      236    12569    3            CASE (%FP_FNC_LABEL_ACK);
      237    12570    3            CASE (%FP_FNC_OPENIN_ACK);
      238    12571    3            CASE (%FP_FNC_CLOSEIN_ACK);
      239    12572    3            END;
      240    12573              /* Wakeup the user.   */
      241    12574    2   XIT: ;
      242    12575    2            IF B$USRT$->B$USER.FLG(MNTDCT$->DCT.OD.USER#) & %U_SCIO AND
      243    12576    2               B$USRT$->B$USER.MISC$(MNTDCT$->DCT.OD.USER#) = ADDR(NK$LDCT) AND
      244    12577    2               B$USRT$->B$USER.US(MNTDCT$->DCT.OD.USER#) = %SS_SCW THEN
      245    12578    2               CALL SSR$RUE (%SS_CIC,MNTDCT$->DCT.OD.USER#);
      246    12579    3            ELSE DO;
      247    12580                    /* If user not waiting for message, discard it.  If there was
      248    12581                       an unrecoverable error on a mounted disk with no outstanding
      249    12582                       request, note it in the DDT.POSLOST so next access to disk will
      250    12583                       get the error.                                         */
      251    12584    3               IF MNTACK.STT = 6 THEN
      252    12585    3                  D$->FT$DDT.POSLOST = %YES#;
      253    12586    3               GOTO GETOUT;
      254    12587    3               END;
      255    12588    2   XIT2: ;
      256    12589    2            ADDR(K$RWPARM.IP$->KI$QMHDR.OFFSET)->UBNBSD =
      257    12590    2            POFFC(K$RWPARM.UHDR$,K$RWPARM.IP$) * 262144 +
      258    12591    2            K$RWPARM.UHDRSZ;
      259    12592    2            K$RWPARM.ERR = %K$WAIT_READ;
PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:8    
      260    12593    2            ALTRETURN;
      261    12594
      262    12595    2         CASE (%KV_VDO_FNC_RQSDAT);
      263    12596    2            IF NK$LDCT.TH.MAXNMBRCR > 0 OR
      264    12597    3               NK$LDCT.TH.MAXNMBBYT > 0 THEN DO;
      265    12598                    /* Search for the fep and device number described by
      266    12599                      the message we just received.                    */
      267    12600    3               O$ = FR$HD$(FR_NPOOL);
      268    12601    4               DO WHILE (O$ ~= ADDR(NIL));
      269    12602    4                  MNTDCT$ = N$DCT$(O$->FR$RAT.DCTX);
      270    12603    4                  IF O$->FR$RAT.TYP = 'OD' AND
      271    12604    4                     MNTDCT$->DCT.DQH$->NI$DQH.FEX = FEI AND
      272    12605    5                     MNTDCT$->DCT.OD.THRTLD ~= 0 THEN DO;
      273    12606    5                     MNTDCT$->DCT.OD.THRTLD = 0;
      274    12607    5                     CALL SSR$RUE (%SS_CUB,MNTDCT$->DCT.OD.USER#);
      275    12608    5                     END;
      276    12609    4                  O$ = O$->FR$RAT.LNK$;
      277    12610    4                  END;
      278    12611    3   GETOUT:     NK$LDCT.IP$ = ADDR(NIL);
      279    12612    3               RETURN;
      280    12613    3               END;
      281    12614    2         END;
      282    12615        %EJECT;
PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:9    
      283    12616        /*F*
      284    12617              NAME: FPA$ODDN
      285    12618              PURPOSE:
      286    12619                 To notify user of optical disc devices that the OD
      287    12620                 controller has been disconnected.
      288    12621              DESCRIPTION:
      289    12622                 Called from KIA$TERM with the LDCT of the disconnected
      290    12623                 controller.  This will search the NPOOL device list for
      291    12624                 OD type devices attached to this LDCT, with users waiting
      292    12625                 for input, and wake them up.  They will detect FEDN in the
      293    12626                 in the LDCT and act accordingly.
      294    12627        */
      295    12628
      296    12629    1   FPA$ODDN: ENTRY (NK$LDCT) ALTRET;
      297    12630
      298    12631    1         O$ = FR$HD$(FR_NPOOL);
      299    12632    2         DO WHILE (O$ ~= ADDR(NIL));
      300    12633    2            MNTDCT$ = N$DCT$(O$->FR$RAT.DCTX);
      301    12634    2            IF (O$->FR$RAT.TYP = 'OD' AND
      302    12635    3               MNTDCT$->DCT.OD.LDCT$ = ADDR(NK$LDCT)) THEN DO;
      303    12636    3               IF B$USRT$->B$USER.FLG(MNTDCT$->DCT.OD.USER#) & %U_SCIO
      304    12637    3                  AND B$USRT$->B$USER.MISC$(MNTDCT$->DCT.OD.USER#) =
      305    12638    4                  ADDR(NK$LDCT) THEN DO;
      306    12639    4                  CALL SSR$RUE (%SS_FC,MNTDCT$->DCT.OD.USER#);
      307    12640    4                  END;
      308    12641    3               END;
      309    12642    2            O$ = O$->FR$RAT.LNK$;
      310    12643    2            END;
      311    12644    1         NK$LDCT.DFLG.FEDN = '1'B;
      312    12645    1         RETURN;
      313    12646    1   END;

PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:10   
--  Include file information  --

   FT$DDT.:E05TOU  cannot be made into a system file and is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   FP$LBLS.:E05TOU  cannot be made into a system file and is referenced.
   FT$LBLS.:E05TOU  cannot be made into a system file and is referenced.
   FP_MACRO_C.:E05TOU  is referenced.
   OC_SUBS_C.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KI_MACROS_C.:E05TOU  is referenced.
   KI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KV$VDO.:E05TOU  is referenced.
   KI$MHDR.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_SUBS_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   FT_SUBS.:E05TOU  is referenced.
   FR_SUBS.:E05TOU  is referenced.
   FR$RAT.:E05TOU  is referenced.
   EL_SUBS_C.:E05TOU  is referenced.
   EL$TABLES.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FPA$ODIN.

   Procedure FPA$ODIN requires 569 words for executable code.
   Procedure FPA$ODIN requires 60 words of local(AUTO) storage.

    No errors detected in file FPA$ODEA.:E05TSI    .
PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:11   

PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:12   

 Object Unit name= FPA$ODIN                                   File name= FPA$ODEA.:E05TOU
 UTS= JUL 29 '97 17:17:05.48 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   Data  even  none     1      1  FPA$ODIN
    2  RoData even  UTS      3      3  FPA$ODIN
    3   Proc  even  none   569   1071  FPA$ODIN
    4  RoData even  none    25     31  FPA$ODIN

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     3      0   yes    yes     yes      Std        2  FPA$ODIN
     3   1012          yes     yes      Std        1  FPA$ODDN

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       3 FRC$AVR
 yes     yes           Std       6 ELA$SYSLOG
         yes           Std       7 OCI$MK_WR
         yes           Std       4 SSR$RUE
                       nStd      0 X66_AUTO_2
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AALT
                       nStd      0 X66_ARET
PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:13   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_FPABADDEV                          M$UC                                  KI_FEI$$
     N$DCT$$                               N$FQ$                                 NI$FQ$
     NI$IBUF$                              NI$RP$                                FR$HD$
     B$USRT$                               B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ASLENTSID                             ISSID
PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:14   


        1        1        /*M*  End action poster for the OD controller               */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7
        8        8        /*F*
        9        9              NAME: FPA$ODIN
       10       10              PURPOSE:
       11       11                 To process Optical Disc input messages.
       12       12              DEESCRIPTION:
       13       13                 Called from KIA$ISCAN for input messages from the optical disc
       14       14                 controller.  This will altreturn with error K$WAIT_READ
       15       15                 to leave the message in the queue so the user code in
       16       16                 FPO$xxxx can look at it.
       17       17        */
       18       18
       19       19        FPA$ODIN: PROC (NK$LDCT,K$RWPARM) ALTRET;

     19  3 000000   000000 700200 xent  FPA$ODIN     TSX0  ! X66_AUTO_2
         3 000001   000074 000002                    ZERO    60,2

       20       20
       21       21        %INCLUDE CP_6;
       22     5580        %INCLUDE CP_6_SUBS;
       23     6120        %INCLUDE B$USER;
       24     6336        %INCLUDE EL$TABLES;
       25     6659        %INCLUDE EL_SUBS_C;
       26     6743        %INCLUDE FR$RAT;
       27     6796        %FR$RAT;
       28     6836        %INCLUDE FR_SUBS;
       29     6904        %INCLUDE FT_SUBS;
       30     6984        %INCLUDE HF_LOCK_C;
       31     6998        %INCLUDE K_SUBS_C;
       32     7031        %INCLUDE K$RWPARM;
PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:15   
       33     7417        %INCLUDE KI$MHDR;
       34     7558        %INCLUDE KV$VDO;
       35     8573        %KV_VDO_E;                         /* VDO EQUs                       */
       36     8609        %INCLUDE KI_DATA_R;
       37     8635        %INCLUDE KI_MACROS_C;
       38     9243        %INCLUDE NI_DATA_R;
       39     9680        %INCLUDE NK$LDCT;
       40     9782        %INCLUDE NK_SUBS;
       41     9807        %INCLUDE OC_SUBS_C;
       42    10538        %INCLUDE FP_MACRO_C;
       43    10810        %INCLUDE FT$LBLS;
       44    11078        %INCLUDE FP$LBLS;
       45    11240        %INCLUDE SS_SCHED_C;
       46    11473
       47    11474        %SUB FRL_ANSTAP=3;
       48    11475        %SUB FRL_UXPANS=5;
       49    11476
       50    11477        /*    Parameters                   */
       51    11478
       52    11479        %NK$LDCT (STCLASS="");
       53    11525        %K$RWPARM (NAME=K$RWPARM);
       54    11841
       55    11842        /*    Based                        */
       56    11843
       57    11844    1   DCL UBNBSD UBIN WORD ALIGNED BASED;
       58    11845        %NI$DCT (STCLASS=BASED,NAME=DCT);
       59    11893        %NI$DQH;
       60    11916        %KI$QMHDR;
       61    11965        %KI$FEI;
       62    12049        %KV$VDO (STCLASS="BASED(K$RWPARM.UHDR$)");
       63    12076        %KV$VDO_EVT (STCLASS="BASED(K$RWPARM.UHDR$)");
       64    12118        %FPP$MNTACK (NAME = MNTACK,STCLASS="BASED(K$RWPARM.MSG$)");
       65    12137        %FPP$ERRMSG (NAME = ERRMSG,STCLASS="BASED(K$RWPARM.MSG$)");
       66    12161        %FPP$OCKEYNREQ (NAME = OCMSG, STCLASS = "BASED(K$RWPARM.MSG$)");
       67    12179        %FPP$XFERACK (NAME = MAPACK, STCLASS = "BASED(K$RWPARM.MSG$)");
       68    12209        %FPP$MHDR (STCLASS="BASED(K$RWPARM.MSG$)");
       69    12223
PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:16   
       70    12224        %INCLUDE FT$DDT;
       71    12285
       72    12286
       73    12287        /*    External                     */
       74    12288
       75    12289    1   DCL FR$HD$(0:0) PTR SYMREF;               /* Resource lists              */
       76    12290    1   DCL B$USRT$ PTR SYMREF;
       77    12291
       78    12292    1   DCL SSR$RUE ENTRY(4);
       79    12293    1   DCL FRC$AVR ENTRY(3) ALTRET;
       80    12294    1   DCL ELA$SYSLOG ENTRY(6) ALTRET;
       81    12295    1   DCL OCI$MK_WR ENTRY(7);
       82    12296    1   DCL SC_FPABADDEV ENTRY CONV(2,0);
       83    12297        /*    Auto                         */
       84    12298
       85    12299        %KV$VDO_EVT (NAME=VDO,STCLASS=AUTO);
       86    12341    1   DCL FEI UBIN;                      /* FEP number                     */
       87    12342    1   DCL M$  PTR;                       /* OD message ptr                 */
       88    12343    1   DCL O$  PTR;                       /* mount device RAT ptr           */
       89    12344    1   DCL R$  PTR;                       /* RAT ptr from message           */
       90    12345    1   DCL MNTDCT$ PTR;    /* ptr to mounted device DCT entry        */
       91    12346    1   DCL D$  PTR;                       /* ptr to device DDT entry        */
       92    12347    1   DCL V1$ PTR;                       /* ptr to OD volume label         */
       93    12348    1   DCL I  UBIN;                       /* temp                           */
       94    12349    1   DCL USR UBIN(9);                   /* user number for mapack   */
       95    12350    1   DCL DCTX UBIN;                     /* dct index                      */
       96    12351    1   DCL 1 CDCTX REDEF DCTX,            /* for conversion from controller */
       97    12352    1         2 * UBIN(20) UNAL,
       98    12353    1         2 HI UBIN(8) UNAL,
       99    12354    1         2 LO UBIN(8) UNAL;
      100    12355        %EL$FEPERR (STCLASS=AUTO);
      101    12434    1   DCL ERRCD UBIN WORD;
      102    12435    1   DCL 1 MSGTBL,
      103    12436    1         2 SN CHAR(6) CALIGNED,
      104    12437    1         2 MSGTYP UBIN BYTE UNAL,
      105    12438    1         2 MSGSEL UBIN BYTE UNAL;
      106    12439
PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:17   
      107    12440        /*    Static data                  */
      108    12441
      109    12442    1   DCL MSGL BIT(36) STATIC INIT('006001001000'O);
      110    12443
      111    12444
      112    12445
      113    12446    2         IF NK$LDCT.IP$ ~= ADDR(NIL) THEN DO;

  12446  3 000002   200003 470500                    LDP0    @NK$LDCT,,AUTO
         3 000003   000013 236100                    LDQ     11,,PR0
         3 000004   000001 116000 xsym               CMPQ    B_VECTNIL+1
         3 000005   000012 600000 3                  TZE     s:12450

      114    12447    2            K$RWPARM.ERR = %K$DEFER_IO;

  12447  3 000006   000003 235007                    LDA     3,DL
         3 000007   200004 471500                    LDP1    @K$RWPARM,,AUTO
         3 000010   100013 755100                    STA     11,,PR1

      115    12448    2            ALTRETURN;

  12448  3 000011   000000 702200 xent               TSX2  ! X66_AALT

      116    12449    2            END;
      117    12450    1         NK$LDCT.IP$ = K$RWPARM.IP$;

  12450  3 000012   200004 471500                    LDP1    @K$RWPARM,,AUTO
         3 000013   100012 236100                    LDQ     10,,PR1
         3 000014   000013 756100                    STQ     11,,PR0

      118    12451    1         NK$LDCT.IPFEI# = K$RWPARM.IP$->KI$QMHDR.FEI#;

  12451  3 000015   100012 473500                    LDP3    10,,PR1
         3 000016   300000 236100                    LDQ     0,,PR3
         3 000017   377000 376003                    ANQ     130560,DU
         3 000020   000022 772000                    QRL     18
         3 000021   000014 552110                    STBQ    12,'10'O,PR0
PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:18   

      119    12452    1         FEI = NK$LDCT.IPFEI#;

  12452  3 000022   000014 236100                    LDQ     12,,PR0
         3 000023   000011 772000                    QRL     9
         3 000024   000777 376007                    ANQ     511,DL
         3 000025   200006 756100                    STQ     FEI,,AUTO

      120    12453    1         VDO = KV$VDO_EVT;

  12453  3 000026   100014 473500                    LDP3    12,,PR1
         3 000027   000100 100500                    MLR     fill='000'O
         3 000030   300000 000004                    ADSC9   0,,PR3                   cn=0,n=4
         3 000031   200005 000004                    ADSC9   VDO,,AUTO                cn=0,n=4

      121    12454    2         DO CASE (VDO.FNC);

  12454  3 000032   200005 236100                    LDQ     VDO,,AUTO
         3 000033   000033 772000                    QRL     27
         3 000034   000005 136007                    SBLQ    5,DL
         3 000035   000022 116007                    CMPQ    18,DL
         3 000036   000040 602006 3                  TNC     s:12454+6,QL
         3 000037   001011 710000 3                  TRA     s:12614
         3 000040   000062 710000 3                  TRA     s:12456
         3 000041   001011 710000 3                  TRA     s:12614
         3 000042   001011 710000 3                  TRA     s:12614
         3 000043   001011 710000 3                  TRA     s:12614
         3 000044   001011 710000 3                  TRA     s:12614
         3 000045   001011 710000 3                  TRA     s:12614
         3 000046   001011 710000 3                  TRA     s:12614
         3 000047   001011 710000 3                  TRA     s:12614
         3 000050   001011 710000 3                  TRA     s:12614
         3 000051   001011 710000 3                  TRA     s:12614
         3 000052   001011 710000 3                  TRA     s:12614
         3 000053   001011 710000 3                  TRA     s:12614
         3 000054   001011 710000 3                  TRA     s:12614
         3 000055   001011 710000 3                  TRA     s:12614
PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:19   
         3 000056   001011 710000 3                  TRA     s:12614
         3 000057   001011 710000 3                  TRA     s:12614
         3 000060   001011 710000 3                  TRA     s:12614
         3 000061   000735 710000 3                  TRA     s:12596

      122    12455    2         CASE (%KV_VDO_FNC_DAT);

      123    12456    2            IF FPP$MHDR.FNC ~= %FP_FNC_OCMSG AND

  12456  3 000062   100000 474500                    LDP4    0,,PR1
         3 000063   003100 061500                    CSR     bolr='003'O
         3 000064   400000 000011                    BDSC    0,,PR4                   by=0,bit=0,n=9
         3 000065   200066 000044                    BDSC    MSGTBL+3,,AUTO           by=0,bit=0,n=36
         3 000066   200066 236100                    LDQ     MSGTBL+3,,AUTO
         3 000067   000042 116007                    CMPQ    34,DL
         3 000070   000215 600000 3                  TZE     NO_VOLUME
         3 000071   100000 473500                    LDP3    0,,PR1
         3 000072   003100 061500                    CSR     bolr='003'O
         3 000073   300000 000011                    BDSC    0,,PR3                   by=0,bit=0,n=9
         3 000074   200067 000044                    BDSC    MSGTBL+4,,AUTO           by=0,bit=0,n=36
         3 000075   200067 236100                    LDQ     MSGTBL+4,,AUTO
         3 000076   000030 116007                    CMPQ    24,DL
         3 000077   000215 600000 3                  TZE     NO_VOLUME
         3 000100   100000 473500                    LDP3    0,,PR1
         3 000101   003100 061500                    CSR     bolr='003'O
         3 000102   300000 000011                    BDSC    0,,PR3                   by=0,bit=0,n=9
         3 000103   200070 000044                    BDSC    MSGTBL+5,,AUTO           by=0,bit=0,n=36
         3 000104   200070 236100                    LDQ     MSGTBL+5,,AUTO
         3 000105   000035 116007                    CMPQ    29,DL
         3 000106   000215 600000 3                  TZE     NO_VOLUME

      124    12457    2               FPP$MHDR.FNC ~= %FP_FNC_MAP_ACK AND
      125    12458    3               FPP$MHDR.FNC ~= %FP_FNC_ERRLOG THEN DO;

      126    12459    3               DCTX = 0;

  12459  3 000107   200017 450100                    STZ     DCTX,,AUTO
PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:20   

      127    12460    3               CDCTX.HI = MNTACK.DCTX.HI;

  12460  3 000110   100000 473500                    LDP3    0,,PR1
         3 000111   003100 061500                    CSR     bolr='003'O
         3 000112   300001 000011                    BDSC    1,,PR3                   by=0,bit=0,n=9
         3 000113   200017 420010                    BDSC    DCTX,,AUTO               by=2,bit=2,n=8

      128    12461    3               CDCTX.LO = MNTACK.DCTX.LO;   /* resource dct index    */

  12461  3 000114   100000 473500                    LDP3    0,,PR1
         3 000115   003100 061500                    CSR     bolr='003'O
         3 000116   300001 200011                    BDSC    1,,PR3                   by=1,bit=0,n=9
         3 000117   200017 610010                    BDSC    DCTX,,AUTO               by=3,bit=1,n=8

      129    12462    3               R$ = N$DCT$(DCTX)->DCT.RAT$;

  12462  3 000120   000000 473400 xsym               LDP3    N$DCT$$
         3 000121   200017 720100                    LXL0    DCTX,,AUTO
         3 000122   300000 474510                    LDP4    0,X0,PR3
         3 000123   400005 236100                    LDQ     5,,PR4
         3 000124   200011 756100                    STQ     R$,,AUTO

      130    12463    3         MNTDCT$ = N$DCT$(DCTX);

  12463  3 000125   300000 236110                    LDQ     0,X0,PR3
         3 000126   200012 756100                    STQ     MNTDCT$,,AUTO

      131    12464              /* Check if volume found */
      132    12465    3         IF MNTACK.STT = 1 AND MNTACK.FNC = %FP_FNC_MOUNT_ACK THEN

  12465  3 000127   100000 475500                    LDP5    0,,PR1
         3 000130   000100 101500                    MRL     fill='000'O
         3 000131   500000 200001                    ADSC9   0,,PR5                   cn=1,n=1
         3 000132   200066 000004                    ADSC9   MSGTBL+3,,AUTO           cn=0,n=4
         3 000133   200066 236100                    LDQ     MSGTBL+3,,AUTO
         3 000134   000001 116007                    CMPQ    1,DL
PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:21   
         3 000135   000145 601000 3                  TNZ     s:12468
         3 000136   100000 474500                    LDP4    0,,PR1
         3 000137   000100 101500                    MRL     fill='000'O
         3 000140   400000 000001                    ADSC9   0,,PR4                   cn=0,n=1
         3 000141   200067 000004                    ADSC9   MSGTBL+4,,AUTO           cn=0,n=4
         3 000142   200067 236100                    LDQ     MSGTBL+4,,AUTO
         3 000143   000002 116007                    CMPQ    2,DL
         3 000144   000215 600000 3                  TZE     NO_VOLUME

      133    12466    3           GOTO NO_VOLUME;
      134    12467                    /* Pass message ptr back to soliciting user in his DCT */
      135    12468    3               N$DCT$(DCTX)->DCT.OD.IP$ = K$RWPARM.IP$;

  12468  3 000145   300000 474510                    LDP4    0,X0,PR3
         3 000146   100012 236100                    LDQ     10,,PR1
         3 000147   400034 756100                    STQ     28,,PR4

      136    12469                    /* Search for the fep and device number described by
      137    12470                       the message we just received.                    */
      138    12471    3               O$ = FR$HD$(FR_NPOOL);

  12471  3 000150   000002 236000 xsym               LDQ     FR$HD$+2
         3 000151   200010 756100                    STQ     O$,,AUTO

      139    12472    4               DO WHILE (O$ ~= ADDR(NIL));

  12472  3 000152   000206 710000 3                  TRA     s:12479

      140    12473    4                  MNTDCT$ = N$DCT$(O$->FR$RAT.DCTX);

  12473  3 000153   200010 470500                    LDP0    O$,,AUTO
         3 000154   000003 720100                    LXL0    3,,PR0
         3 000155   000000 471400 xsym               LDP1    N$DCT$$
         3 000156   100000 236110                    LDQ     0,X0,PR1
         3 000157   200012 756100                    STQ     MNTDCT$,,AUTO

      141    12474    4                  IF (O$->FR$RAT.TYP = 'OD' AND
PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:22   

  12474  3 000160   000010 221100                    LDX1    8,,PR0
         3 000161   000000 101000 2                  CMPX1   0
         3 000162   000204 601000 3                  TNZ     s:12478
         3 000163   200004 473500                    LDP3    @K$RWPARM,,AUTO
         3 000164   300000 474500                    LDP4    0,,PR3
         3 000165   000100 101500                    MRL     fill='000'O
         3 000166   400000 400001                    ADSC9   0,,PR4                   cn=2,n=1
         3 000167   200066 000004                    ADSC9   MSGTBL+3,,AUTO           cn=0,n=4
         3 000170   200012 474500                    LDP4    MNTDCT$,,AUTO
         3 000171   400007 236100                    LDQ     7,,PR4
         3 000172   000030 772000                    QRL     24
         3 000173   000077 376007                    ANQ     63,DL
         3 000174   200066 116100                    CMPQ    MSGTBL+3,,AUTO
         3 000175   000204 601000 3                  TNZ     s:12478
         3 000176   400023 475500                    LDP5    19,,PR4
         3 000177   500001 236100                    LDQ     1,,PR5
         3 000200   000006 772000                    QRL     6
         3 000201   000077 376007                    ANQ     63,DL
         3 000202   200006 116100                    CMPQ    FEI,,AUTO
         3 000203   000213 600000 3                  TZE     GOTDCT

      142    12475    4                     MNTDCT$->DCT.DVN = MNTACK.DEV# AND
      143    12476    4                     MNTDCT$->DCT.DQH$->NI$DQH.FEX = FEI) THEN
      144    12477    4                     GOTO GOTDCT;
      145    12478    4                  O$ = O$->FR$RAT.LNK$;

  12478  3 000204   000000 236100                    LDQ     0,,PR0
         3 000205   200010 756100                    STQ     O$,,AUTO

      146    12479    4                  END;

  12479  3 000206   000001 116000 xsym               CMPQ    B_VECTNIL+1
         3 000207   000153 601000 3                  TNZ     s:12473

      147    12480    3               CALL SC_FPABADDEV;

PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:23   
  12480  3 000210   000000 713400 xsym               CLIMB   SC_FPABADDEV
         3 000211   000000 600000 xsid               climb   nvectors=         0

      148    12481    3               RETURN;

  12481  3 000212   000000 702200 xent               TSX2  ! X66_ARET

  12478  3 000213                       GOTDCT       null
      149    12482        /*S*
      150    12483              SCREECH_CODE: FPA-S$AVRDCT-8
      151    12484              TYPE: SCREECH
      152    12485              MESSAGE: The OD controller message contained a bad device number.
      153    12486              DESCRIPTION: The specified device number could not be found in
      154    12487              the list of dcts attached to the OD controller.
      155    12488        */
      156    12489    3   GOTDCT: ;
      157    12490    3               D$ = MNTDCT$->DCT.DDT$;

  12490  3 000213   400004 236100                    LDQ     4,,PR4
         3 000214   200013 756100                    STQ     D$,,AUTO

      158    12491    3               END;

  12480  3 000215                       NO_VOLUME    null
      159    12492    2   NO_VOLUME: ;
      160    12493    3            DO CASE (FPP$MHDR.FNC);

  12493  3 000215   200004 470500                    LDP0    @K$RWPARM,,AUTO
         3 000216   000000 471500                    LDP1    0,,PR0
         3 000217   003100 061500                    CSR     bolr='003'O
         3 000220   100000 000011                    BDSC    0,,PR1                   by=0,bit=0,n=9
         3 000221   200066 000022                    BDSC    MSGTBL+3,,AUTO           by=0,bit=0,n=18
         3 000222   200066 220100                    LDX0    MSGTBL+3,,AUTO
         3 000223   000043 100003                    CMPX0   35,DU
         3 000224   000226 602010 3                  TNC     NO_VOLUME+9,X0
         3 000225   000645 710000 3                  TRA     XIT
         3 000226   000645 710000 3                  TRA     XIT
PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:24   
         3 000227   000645 710000 3                  TRA     XIT
         3 000230   000271 710000 3                  TRA     s:12495
         3 000231   000645 710000 3                  TRA     XIT
         3 000232   000645 710000 3                  TRA     XIT
         3 000233   000645 710000 3                  TRA     XIT
         3 000234   000645 710000 3                  TRA     XIT
         3 000235   000645 710000 3                  TRA     XIT
         3 000236   000645 710000 3                  TRA     XIT
         3 000237   000645 710000 3                  TRA     XIT
         3 000240   000645 710000 3                  TRA     XIT
         3 000241   000645 710000 3                  TRA     XIT
         3 000242   000645 710000 3                  TRA     XIT
         3 000243   000645 710000 3                  TRA     XIT
         3 000244   000645 710000 3                  TRA     XIT
         3 000245   000645 710000 3                  TRA     XIT
         3 000246   000645 710000 3                  TRA     XIT
         3 000247   000645 710000 3                  TRA     XIT
         3 000250   000645 710000 3                  TRA     XIT
         3 000251   000645 710000 3                  TRA     XIT
         3 000252   000645 710000 3                  TRA     XIT
         3 000253   000645 710000 3                  TRA     XIT
         3 000254   000645 710000 3                  TRA     XIT
         3 000255   000645 710000 3                  TRA     XIT
         3 000256   000620 710000 3                  TRA     s:12560
         3 000257   000645 710000 3                  TRA     XIT
         3 000260   000645 710000 3                  TRA     XIT
         3 000261   000645 710000 3                  TRA     XIT
         3 000262   000645 710000 3                  TRA     XIT
         3 000263   000474 710000 3                  TRA     s:12541
         3 000264   000645 710000 3                  TRA     XIT
         3 000265   000645 710000 3                  TRA     XIT
         3 000266   000645 710000 3                  TRA     XIT
         3 000267   000645 710000 3                  TRA     XIT
         3 000270   000573 710000 3                  TRA     s:12554

      161    12494    3            CASE (%FP_FNC_MOUNT_ACK); /* Mount result from the OSAR     */

PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:25   
      162    12495    4               IF (MNTACK.STT = 0 OR MNTACK.STT = 2) THEN DO;

  12495  3 000271   000000 471500                    LDP1    0,,PR0
         3 000272   000100 101500                    MRL     fill='000'O
         3 000273   100000 200001                    ADSC9   0,,PR1                   cn=1,n=1
         3 000274   200066 000004                    ADSC9   MSGTBL+3,,AUTO           cn=0,n=4
         3 000275   200066 236100                    LDQ     MSGTBL+3,,AUTO
         3 000276   000000 116003                    CMPQ    0,DU
         3 000277   000307 600000 3                  TZE     s:12497
         3 000300   000000 471500                    LDP1    0,,PR0
         3 000301   000100 101500                    MRL     fill='000'O
         3 000302   100000 200001                    ADSC9   0,,PR1                   cn=1,n=1
         3 000303   200067 000004                    ADSC9   MSGTBL+4,,AUTO           cn=0,n=4
         3 000304   200067 236100                    LDQ     MSGTBL+4,,AUTO
         3 000305   000002 116007                    CMPQ    2,DL
         3 000306   000645 601000 3                  TNZ     XIT

      163    12496                       /*  Put AVR data into DDT      */
      164    12497    4                  V1$ = ADDR(MNTACK.VOL1);

  12497  3 000307   000000 471500                    LDP1    0,,PR0
         3 000310   200066 451500                    STP1    MSGTBL+3,,AUTO
         3 000311   200066 236100                    LDQ     MSGTBL+3,,AUTO
         3 000312   000000 036000 4                  ADLQ    0
         3 000313   200014 756100                    STQ     V1$,,AUTO

      165    12498    4                  D$->FT$DDT.ANST = %YES#;

  12498  3 000314   200013 471500                    LDP1    D$,,AUTO
         3 000315   400000 236007                    LDQ     -131072,DL
         3 000316   100006 256100                    ORSQ    6,,PR1

      166    12499    4                  D$->FT$DDT.SOLICIT = 0;

  12499  3 000317   000001 236000 4                  LDQ     1
         3 000320   100006 356100                    ANSQ    6,,PR1

PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:26   
      167    12500    4                  D$->FT$DDT.POSLOST = %NO#;

  12500  3 000321   000002 236000 4                  LDQ     2
         3 000322   100006 356100                    ANSQ    6,,PR1

      168    12501    4                  D$->FT$DDT.RINGIN = %YES#;

  12501  3 000323   040000 236007                    LDQ     16384,DL
         3 000324   100006 256100                    ORSQ    6,,PR1

      169    12502    4                  IF MNTACK.STT = 2 THEN

  12502  3 000325   000000 473500                    LDP3    0,,PR0
         3 000326   000100 101500                    MRL     fill='000'O
         3 000327   300000 200001                    ADSC9   0,,PR3                   cn=1,n=1
         3 000330   200066 000004                    ADSC9   MSGTBL+3,,AUTO           cn=0,n=4
         3 000331   200066 236100                    LDQ     MSGTBL+3,,AUTO
         3 000332   000002 116007                    CMPQ    2,DL
         3 000333   000336 601000 3                  TNZ     s:12504

      170    12503    4                     D$->FT$DDT.RINGIN = %NO#;

  12503  3 000334   000003 236000 4                  LDQ     3
         3 000335   100006 356100                    ANSQ    6,,PR1

      171    12504    4                  D$->FT$DDT.SN = V1$->FP$VOL1.SN;

  12504  3 000336   200014 473500                    LDP3    V1$,,AUTO
         3 000337   040100 100500                    MLR     fill='040'O
         3 000340   300001 000006                    ADSC9   1,,PR3                   cn=0,n=6
         3 000341   100002 000006                    ADSC9   2,,PR1                   cn=0,n=6

      172    12505    4                  D$->FT$DDT.ACCT = V1$->FP$VOL1.ACCOUNT;

  12505  3 000342   040100 100500                    MLR     fill='040'O
         3 000343   300011 200010                    ADSC9   9,,PR3                   cn=1,n=8
         3 000344   100000 000010                    ADSC9   0,,PR1                   cn=0,n=8
PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:27   

      173    12506    5                  IF D$->FT$DDT.ACCT ~= ' ' THEN DO;

  12506  3 000345   040000 106500                    CMPC    fill='040'O
         3 000346   100000 000010                    ADSC9   0,,PR1                   cn=0,n=8
         3 000347   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         3 000350   000375 600000 3                  TZE     s:12515

      174    12507    5                     IF V1$->FP$VOL1.ACCESS = 'I' THEN

  12507  3 000351   040000 106500                    CMPC    fill='040'O
         3 000352   300002 400001                    ADSC9   2,,PR3                   cn=2,n=1
         3 000353   000004 000001 4                  ADSC9   4                        cn=0,n=1
         3 000354   000362 601000 3                  TNZ     s:12510

      175    12508    5                        D$->FT$DDT.VOLACCESS = %IN#; /* Determine volume protection */

  12508  3 000355   100007 236100                    LDQ     7,,PR1
         3 000356   000005 376000 4                  ANQ     5
         3 000357   000002 276007                    ORQ     2,DL
         3 000360   100007 756100                    STQ     7,,PR1
         3 000361   000375 710000 3                  TRA     s:12515

      176    12509    5                     ELSE
      177    12510    5                        IF V1$->FP$VOL1.ACCESS = 'N' THEN

  12510  3 000362   040000 106500                    CMPC    fill='040'O
         3 000363   300002 400001                    ADSC9   2,,PR3                   cn=2,n=1
         3 000364   000006 000001 4                  ADSC9   6                        cn=0,n=1
         3 000365   000371 601000 3                  TNZ     s:12513

      178    12511    5                           D$->FT$DDT.VOLACCESS = %NONE#;

  12511  3 000366   000003 236007                    LDQ     3,DL
         3 000367   100007 256100                    ORSQ    7,,PR1
         3 000370   000375 710000 3                  TRA     s:12515

PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:28   
      179    12512    5                        ELSE
      180    12513    5                           D$->FT$DDT.VOLACCESS = %ALL#;

  12513  3 000371   100007 236100                    LDQ     7,,PR1
         3 000372   000005 376000 4                  ANQ     5
         3 000373   000001 276007                    ORQ     1,DL
         3 000374   100007 756100                    STQ     7,,PR1

      181    12514    5                     END;

      182    12515    4                  CALL CHARBIN (I,MNTACK.FSEQU_NUM);

  12515  3 000375   000000 474500                    LDP4    0,,PR0
         3 000376   000100 305500                    DTB
         3 000377   400003 030006                    NDSC9   3,,PR4                   cn=0,s=nosgn,sf=0,n=6
         3 000400   200066 000010                    NDSC9   MSGTBL+3,,AUTO           cn=0,s=lsgnf,sf=0,n=8
         3 000401   200067 235100                    LDA     MSGTBL+4,,AUTO
         3 000402   200015 755100                    STA     I,,AUTO

      183    12516    5                  IF (I = 0) THEN DO;   /* Any files on volume? */

  12516  3 000403   000413 601000 3                  TNZ     s:12523

      184    12517    5                     D$->FT$DDT.SCRTCH = %YES#;

  12517  3 000404   200000 236007                    LDQ     65536,DL
         3 000405   100006 256100                    ORSQ    6,,PR1

      185    12518    5                     D$->FT$DDT.FSN = 0;

  12518  3 000406   000000 220003                    LDX0    0,DU
         3 000407   100005 740100                    STX0    5,,PR1

      186    12519    5                     D$->FT$DDT.FRSTFSN = 0;

  12519  3 000410   100005 440100                    SXL0    5,,PR1

PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:29   
      187    12520    5                     D$->FT$DDT.FRSTFSECT = 0;

  12520  3 000411   100007 740100                    STX0    7,,PR1

      188    12521    5                     END;

  12521  3 000412   000430 710000 3                  TRA     s:12529

      189    12522    5                  ELSE DO;

      190    12523    5                     D$->FT$DDT.SCRTCH = %NO#;

  12523  3 000413   000007 236000 4                  LDQ     7
         3 000414   100006 356100                    ANSQ    6,,PR1

      191    12524    5                     D$->FT$DDT.FSN = I - 1;          /* Before next file     */

  12524  3 000415   777777 620005                    EAX0    -1,AL
         3 000416   100005 740100                    STX0    5,,PR1

      192    12525    5                     D$->FT$DDT.FRSTFSN = I - 1;      /* First on volume    */

  12525  3 000417   100005 440100                    SXL0    5,,PR1

      193    12526    5                     CALL CHARBIN (I,MNTACK.FSECT );

  12526  3 000420   000000 474500                    LDP4    0,,PR0
         3 000421   000100 305500                    DTB
         3 000422   400001 430006                    NDSC9   1,,PR4                   cn=2,s=nosgn,sf=0,n=6
         3 000423   200066 000010                    NDSC9   MSGTBL+3,,AUTO           cn=0,s=lsgnf,sf=0,n=8
         3 000424   200067 235100                    LDA     MSGTBL+4,,AUTO
         3 000425   200015 755100                    STA     I,,AUTO

      194    12527    5                     D$->FT$DDT.FRSTFSECT = I;        /* First section on volume */

  12527  3 000426   000000 620005                    EAX0    0,AL
         3 000427   100007 740100                    STX0    7,,PR1
PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:30   

      195    12528    5                     END;

      196    12529    4                  D$->FT$DDT.POS = FRL_ANSTAP;

  12529  3 000430   100006 236100                    LDQ     6,,PR1
         3 000431   000010 376000 4                  ANQ     8
         3 000432   000060 276007                    ORQ     48,DL
         3 000433   100006 756100                    STQ     6,,PR1

      197    12530    4                  MNTDCT$->DCT.OD.USER# = R$->FR$RAT.SOLU; /* waiting user */

  12530  3 000434   200011 474500                    LDP4    R$,,AUTO
         3 000435   200012 475500                    LDP5    MNTDCT$,,AUTO
         3 000436   400010 236100                    LDQ     8,,PR4
         3 000437   000022 736000                    QLS     18
         3 000440   500033 552140                    STBQ    27,'40'O,PR5

      198    12531                       /* Let resource management know about mounted DCT   */
      199    12532    4                  DCTX = O$->FR$RAT.DCTX;

  12532  3 000441   200010 476500                    LDP6    O$,,AUTO
         3 000442   600003 236100                    LDQ     3,,PR6
         3 000443   777777 376007                    ANQ     -1,DL
         3 000444   200017 756100                    STQ     DCTX,,AUTO

      200    12533    4                  CALL FRC$AVR (DCTX,FRC_LBL#,D$->FT$DDT.SN) ALTRET(ILGLMNT);

  12533  3 000445   200013 236100                    LDQ     D$,,AUTO
         3 000446   000002 036003                    ADLQ    2,DU
         3 000447   200070 756100                    STQ     MSGTBL+5,,AUTO
         3 000450   000011 236000 4                  LDQ     9
         3 000451   200067 756100                    STQ     MSGTBL+4,,AUTO
         3 000452   200017 637500                    EPPR7   DCTX,,AUTO
         3 000453   200066 457500                    STP7    MSGTBL+3,,AUTO
         3 000454   200066 630500                    EPPR0   MSGTBL+3,,AUTO
         3 000455   000021 631400 xsym               EPPR1   B_VECTNIL+17
PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:31   
         3 000456   000000 701000 xent               TSX1    FRC$AVR
         3 000457   000461 702000 3                  TSX2    ILGLMNT

      201    12534    5                  DO WHILE ('0'B);

  12534  3 000460   000464 710000 3                  TRA     s:12537

      202    12535    5   ILGLMNT:          D$->FT$DDT.POSLOST = %YES#;

  12535  3 000461   200013 470500       ILGLMNT      LDP0    D$,,AUTO
         3 000462   004000 236007                    LDQ     2048,DL
         3 000463   000006 256100                    ORSQ    6,,PR0

      203    12536    5                     END;

      204    12537    4                  D$->FT$DDT.POS = FTP_BOV#;

  12537  3 000464   200013 470500                    LDP0    D$,,AUTO
         3 000465   000006 236100                    LDQ     6,,PR0
         3 000466   000010 376000 4                  ANQ     8
         3 000467   000020 276007                    ORQ     16,DL
         3 000470   000006 756100                    STQ     6,,PR0

      205    12538    4                  D$->FT$DDT.SOLICIT = 0;

  12538  3 000471   000001 236000 4                  LDQ     1
         3 000472   000006 356100                    ANSQ    6,,PR0

      206    12539    4                  END;

  12539  3 000473   000645 710000 3                  TRA     XIT

      207    12540    3            CASE (%FP_FNC_ERRLOG);

      208    12541    3               EL$FEPERR = '0'B;

  12541  3 000474   000100 100400                    MLR     fill='000'O
PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:32   
         3 000475   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         3 000476   200020 000210                    ADSC9   EL$FEPERR,,AUTO          cn=0,n=136

      209    12542    3               EL$FEPERR.STATDATA.NODE = KI$FEI$(FEI)->KI$FEI.FEP#;

  12542  3 000477   000000 471400 xsym               LDP1    KI_FEI$$
         3 000500   200006 721100                    LXL1    FEI,,AUTO
         3 000501   100000 473511                    LDP3    0,X1,PR1
         3 000502   300012 236100                    LDQ     10,,PR3
         3 000503   777000 376007                    ANQ     -512,DL
         3 000504   000013 736000                    QLS     11
         3 000505   200020 676100                    ERQ     EL$FEPERR,,AUTO
         3 000506   777774 376003                    ANQ     -4,DU
         3 000507   200020 656100                    ERSQ    EL$FEPERR,,AUTO

      210    12543                  /* Set errorcode to FPA-M-1700-2 plus ADSS code number */
      211    12544    3               EL$FEPERR.STATDATA.ERRCODE = '062001432442'O;

  12544  3 000510   000001 236000 2                  LDQ     1
         3 000511   200021 756100                    STQ     EL$FEPERR+1,,AUTO

      212    12545    3               EL$FEPERR.STATDATA.ERRCODE.ERR# =

  12545  3 000512   000000 473500                    LDP3    0,,PR0
         3 000513   000100 101500                    MRL     fill='000'O
         3 000514   300001 400001                    ADSC9   1,,PR3                   cn=2,n=1
         3 000515   200066 000004                    ADSC9   MSGTBL+3,,AUTO           cn=0,n=4
         3 000516   200021 236100                    LDQ     EL$FEPERR+1,,AUTO
         3 000517   000003 772000                    QRL     3
         3 000520   037777 376007                    ANQ     16383,DL
         3 000521   200066 036100                    ADLQ    MSGTBL+3,,AUTO
         3 000522   000003 736000                    QLS     3
         3 000523   200021 676100                    ERQ     EL$FEPERR+1,,AUTO
         3 000524   377770 376007                    ANQ     131064,DL
         3 000525   200021 656100                    ERSQ    EL$FEPERR+1,,AUTO

      213    12546    3                  EL$FEPERR.STATDATA.ERRCODE.ERR# + ERRMSG.ERRNUM;
PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:33   
      214    12547    4               DO I = 0 TO 3;

  12547  3 000526   200015 450100                    STZ     I,,AUTO

      215    12548    4                  EL$FEPERR.STATDATA.VALUES(I) = BITBIN(ERRMSG.VALUES(I));

  12548  3 000527   200004 470500                    LDP0    @K$RWPARM,,AUTO
         3 000530   000000 471500                    LDP1    0,,PR0
         3 000531   200015 235100                    LDA     I,,AUTO
         3 000532   000001 735000                    ALS     1
         3 000533   000100 101505                    MRL     fill='000'O
         3 000534   100002 000002                    ADSC9   2,A,PR1                  cn=0,n=2
         3 000535   200066 000004                    ADSC9   MSGTBL+3,,AUTO           cn=0,n=4
         3 000536   200066 236100                    LDQ     MSGTBL+3,,AUTO
         3 000537   200067 756100                    STQ     MSGTBL+4,,AUTO
         3 000540   000105 101500                    MRL     fill='000'O
         3 000541   200067 000004                    ADSC9   MSGTBL+4,,AUTO           cn=0,n=4
         3 000542   200023 000002                    ADSC9   EL$FEPERR+3,A,AUTO       cn=0,n=2

      216    12549    4                  END;

  12549  3 000543   200015 236100                    LDQ     I,,AUTO
         3 000544   000001 036007                    ADLQ    1,DL
         3 000545   200015 756100                    STQ     I,,AUTO
         3 000546   000004 116007                    CMPQ    4,DL
         3 000547   000527 602000 3                  TNC     s:12548

      217    12550    3               EL$FEPERR.X.DYMDATA = ERRMSG.DYMDATA;

  12550  3 000550   000000 471500                    LDP1    0,,PR0
         3 000551   040100 100500                    MLR     fill='040'O
         3 000552   100004 000144                    ADSC9   4,,PR1                   cn=0,n=100
         3 000553   200031 000144                    ADSC9   EL$FEPERR+9,,AUTO        cn=0,n=100

      218    12551    3               CALL ELA$SYSLOG(EL_FEPERR,EL$FEPERR,SIZEW(EL$FEPERR),'0'B,1,ERRCD);

  12551  3 000554   200062 631500                    EPPR1   ERRCD,,AUTO
PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:34   
         3 000555   200073 451500                    STP1    MSGTBL+8,,AUTO
         3 000556   000011 236000 4                  LDQ     9
         3 000557   200072 756100                    STQ     MSGTBL+7,,AUTO
         3 000560   000014 237000 4                  LDAQ    12
         3 000561   200070 757100                    STAQ    MSGTBL+5,,AUTO
         3 000562   200020 633500                    EPPR3   EL$FEPERR,,AUTO
         3 000563   200067 453500                    STP3    MSGTBL+4,,AUTO
         3 000564   000016 236000 4                  LDQ     14
         3 000565   200066 756100                    STQ     MSGTBL+3,,AUTO
         3 000566   200066 630500                    EPPR0   MSGTBL+3,,AUTO
         3 000567   000024 631400 xsym               EPPR1   B_VECTNIL+20
         3 000570   000000 701000 xent               TSX1    ELA$SYSLOG
         3 000571   000000 011000                    NOP     0

      219    12552    3               GOTO GETOUT;

  12552  3 000572   001005 710000 3                  TRA     GETOUT

      220    12553    3            CASE (%FP_FNC_OCMSG);

      221    12554    3               MSGTBL.MSGSEL = 1;

  12554  3 000573   000001 236007                    LDQ     1,DL
         3 000574   200064 552104                    STBQ    MSGTBL+1,'04'O,AUTO

      222    12555    3               MSGTBL.MSGTYP = OCMSG.TYPE;

  12555  3 000575   000000 471500                    LDP1    0,,PR0
         3 000576   000100 100500                    MLR     fill='000'O
         3 000577   100003 000001                    ADSC9   3,,PR1                   cn=0,n=1
         3 000600   200064 400001                    ADSC9   MSGTBL+1,,AUTO           cn=2,n=1

      223    12556    3               MSGTBL.SN = OCMSG.SER;

  12556  3 000601   000000 471500                    LDP1    0,,PR0
         3 000602   040100 100500                    MLR     fill='040'O
         3 000603   100001 400006                    ADSC9   1,,PR1                   cn=2,n=6
PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:35   
         3 000604   200063 000006                    ADSC9   MSGTBL,,AUTO             cn=0,n=6

      224    12557    3               CALL OCI$MK_WR(M_SYS,FP_OSAR_MSG#,3,MSGL,MSGTBL,,);

  12557  3 000605   200063 631500                    EPPR1   MSGTBL,,AUTO
         3 000606   200072 451500                    STP1    MSGTBL+7,,AUTO
         3 000607   000022 237000 4                  LDAQ    18
         3 000610   200070 757100                    STAQ    MSGTBL+5,,AUTO
         3 000611   000024 237000 4                  LDAQ    20
         3 000612   200066 757100                    STAQ    MSGTBL+3,,AUTO
         3 000613   200066 630500                    EPPR0   MSGTBL+3,,AUTO
         3 000614   000023 631400 xsym               EPPR1   B_VECTNIL+19
         3 000615   000000 701000 xent               TSX1    OCI$MK_WR
         3 000616   000000 011000                    NOP     0

      225    12558    3               GOTO GETOUT;

  12558  3 000617   001005 710000 3                  TRA     GETOUT

      226    12559    3            CASE (%FP_FNC_MAP_ACK);

      227    12560    3               USR = MAPACK.USRNO.B1 * 256 + MAPACK.USRNO.B2;

  12560  3 000620   000000 471500                    LDP1    0,,PR0
         3 000621   003100 061500                    CSR     bolr='003'O
         3 000622   100002 610010                    BDSC    2,,PR1                   by=3,bit=1,n=8
         3 000623   200066 000044                    BDSC    MSGTBL+3,,AUTO           by=0,bit=0,n=36
         3 000624   003100 061500                    CSR     bolr='003'O
         3 000625   100002 410010                    BDSC    2,,PR1                   by=2,bit=1,n=8
         3 000626   200067 000044                    BDSC    MSGTBL+4,,AUTO           by=0,bit=0,n=36
         3 000627   200067 236100                    LDQ     MSGTBL+4,,AUTO
         3 000630   000010 736000                    QLS     8
         3 000631   200066 036100                    ADLQ    MSGTBL+3,,AUTO
         3 000632   000033 736000                    QLS     27
         3 000633   200016 756100                    STQ     USR,,AUTO

      228    12561    3               CALL SSR$RUE (%SS_CIC,USR);
PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:36   

  12561  3 000634   200016 631500                    EPPR1   USR,,AUTO
         3 000635   200067 451500                    STP1    MSGTBL+4,,AUTO
         3 000636   000021 236000 4                  LDQ     17
         3 000637   200066 756100                    STQ     MSGTBL+3,,AUTO
         3 000640   200066 630500                    EPPR0   MSGTBL+3,,AUTO
         3 000641   000020 631400 xsym               EPPR1   B_VECTNIL+16
         3 000642   000000 701000 xent               TSX1    SSR$RUE
         3 000643   000000 011000                    NOP     0

      229    12562    3               GOTO XIT2;

  12562  3 000644   000717 710000 3                  TRA     XIT2

      230    12563    3            CASE (%FP_FNC_DISMOUNT_ACK);

      231    12564    3            CASE (%FP_FNC_POSEOV_ACK);

      232    12565    3            CASE (%FP_FNC_WRITELBL_ACK);

      233    12566    3            CASE (%FP_FNC_RDEOF_ACK);

      234    12567    3            CASE (%FP_FNC_FND_ACK);

      235    12568    3            CASE (%FP_FNC_RDWR_ACK);

      236    12569    3            CASE (%FP_FNC_LABEL_ACK);

      237    12570    3            CASE (%FP_FNC_OPENIN_ACK);

      238    12571    3            CASE (%FP_FNC_CLOSEIN_ACK);

      239    12572    3            END;

  12566  3 000645                       XIT          null
      240    12573              /* Wakeup the user.   */
      241    12574    2   XIT: ;
PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:37   
      242    12575    2            IF B$USRT$->B$USER.FLG(MNTDCT$->DCT.OD.USER#) & %U_SCIO AND

  12575  3 000645   200012 470500                    LDP0    MNTDCT$,,AUTO
         3 000646   000033 236100                    LDQ     27,,PR0
         3 000647   000027 772000                    QRL     23
         3 000650   017760 376007                    ANQ     8176,DL
         3 000651   000000 471400 xsym               LDP1    B$USRT$
         3 000652   100000 236106                    LDQ     0,QL,PR1
         3 000653   000002 376000 2                  ANQ     2
         3 000654   000703 600000 3                  TZE     s:12584
         3 000655   000033 236100                    LDQ     27,,PR0
         3 000656   000027 772000                    QRL     23
         3 000657   017760 376007                    ANQ     8176,DL
         3 000660   100017 236106                    LDQ     15,QL,PR1
         3 000661   200003 116100                    CMPQ    @NK$LDCT,,AUTO
         3 000662   000703 601000 3                  TNZ     s:12584
         3 000663   000033 236100                    LDQ     27,,PR0
         3 000664   000027 772000                    QRL     23
         3 000665   017760 376007                    ANQ     8176,DL
         3 000666   100011 236106                    LDQ     9,QL,PR1
         3 000667   770000 376003                    ANQ     -4096,DU
         3 000670   270000 116003                    CMPQ    94208,DU
         3 000671   000703 601000 3                  TNZ     s:12584

      243    12576    2               B$USRT$->B$USER.MISC$(MNTDCT$->DCT.OD.USER#) = ADDR(NK$LDCT) AND
      244    12577    2               B$USRT$->B$USER.US(MNTDCT$->DCT.OD.USER#) = %SS_SCW THEN
      245    12578    2               CALL SSR$RUE (%SS_CIC,MNTDCT$->DCT.OD.USER#);

  12578  3 000672   200012 236100                    LDQ     MNTDCT$,,AUTO
         3 000673   000033 036003                    ADLQ    27,DU
         3 000674   000021 235000 4                  LDA     17
         3 000675   200066 757100                    STAQ    MSGTBL+3,,AUTO
         3 000676   200066 630500                    EPPR0   MSGTBL+3,,AUTO
         3 000677   000020 631400 xsym               EPPR1   B_VECTNIL+16
         3 000700   000000 701000 xent               TSX1    SSR$RUE
         3 000701   000000 011000                    NOP     0
         3 000702   000717 710000 3                  TRA     XIT2
PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:38   

      246    12579    3            ELSE DO;

      247    12580                    /* If user not waiting for message, discard it.  If there was
      248    12581                       an unrecoverable error on a mounted disk with no outstanding
      249    12582                       request, note it in the DDT.POSLOST so next access to disk will
      250    12583                       get the error.                                         */
      251    12584    3               IF MNTACK.STT = 6 THEN

  12584  3 000703   200004 473500                    LDP3    @K$RWPARM,,AUTO
         3 000704   300000 474500                    LDP4    0,,PR3
         3 000705   000100 101500                    MRL     fill='000'O
         3 000706   400000 200001                    ADSC9   0,,PR4                   cn=1,n=1
         3 000707   200066 000004                    ADSC9   MSGTBL+3,,AUTO           cn=0,n=4
         3 000710   200066 236100                    LDQ     MSGTBL+3,,AUTO
         3 000711   000006 116007                    CMPQ    6,DL
         3 000712   000716 601000 3                  TNZ     s:12586

      252    12585    3                  D$->FT$DDT.POSLOST = %YES#;

  12585  3 000713   200013 474500                    LDP4    D$,,AUTO
         3 000714   004000 236007                    LDQ     2048,DL
         3 000715   400006 256100                    ORSQ    6,,PR4

      253    12586    3               GOTO GETOUT;

  12586  3 000716   001005 710000 3                  TRA     GETOUT

  12577  3 000717                       XIT2         null
      254    12587    3               END;
      255    12588    2   XIT2: ;
      256    12589    2            ADDR(K$RWPARM.IP$->KI$QMHDR.OFFSET)->UBNBSD =

  12589  3 000717   200004 470500                    LDP0    @K$RWPARM,,AUTO
         3 000720   000012 471500                    LDP1    10,,PR0
         3 000721   000012 236100                    LDQ     10,,PR0
         3 000722   000020 772000                    QRL     16
PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:39   
         3 000723   200066 756100                    STQ     MSGTBL+3,,AUTO
         3 000724   000014 236100                    LDQ     12,,PR0
         3 000725   000020 772000                    QRL     16
         3 000726   200066 136100                    SBLQ    MSGTBL+3,,AUTO
         3 000727   000022 736000                    QLS     18
         3 000730   000015 036100                    ADLQ    13,,PR0
         3 000731   100001 756100                    STQ     1,,PR1

      257    12590    2            POFFC(K$RWPARM.UHDR$,K$RWPARM.IP$) * 262144 +
      258    12591    2            K$RWPARM.UHDRSZ;
      259    12592    2            K$RWPARM.ERR = %K$WAIT_READ;

  12592  3 000732   000006 235007                    LDA     6,DL
         3 000733   000013 755100                    STA     11,,PR0

      260    12593    2            ALTRETURN;

  12593  3 000734   000000 702200 xent               TSX2  ! X66_AALT

      261    12594
      262    12595    2         CASE (%KV_VDO_FNC_RQSDAT);

      263    12596    2            IF NK$LDCT.TH.MAXNMBRCR > 0 OR

  12596  3 000735   000016 720100                    LXL0    14,,PR0
         3 000736   000741 605400 3                  TPNZ    s:12600
         3 000737   000017 721100                    LXL1    15,,PR0
         3 000740   001011 604400 3                  TMOZ    s:12614

      264    12597    3               NK$LDCT.TH.MAXNMBBYT > 0 THEN DO;

      265    12598                    /* Search for the fep and device number described by
      266    12599                      the message we just received.                    */
      267    12600    3               O$ = FR$HD$(FR_NPOOL);

  12600  3 000741   000002 236000 xsym               LDQ     FR$HD$+2
         3 000742   200010 756100                    STQ     O$,,AUTO
PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:40   

      268    12601    4               DO WHILE (O$ ~= ADDR(NIL));

  12601  3 000743   001003 710000 3                  TRA     s:12610

      269    12602    4                  MNTDCT$ = N$DCT$(O$->FR$RAT.DCTX);

  12602  3 000744   200010 470500                    LDP0    O$,,AUTO
         3 000745   000003 720100                    LXL0    3,,PR0
         3 000746   000000 471400 xsym               LDP1    N$DCT$$
         3 000747   100000 236110                    LDQ     0,X0,PR1
         3 000750   200012 756100                    STQ     MNTDCT$,,AUTO

      270    12603    4                  IF O$->FR$RAT.TYP = 'OD' AND

  12603  3 000751   000010 221100                    LDX1    8,,PR0
         3 000752   000000 101000 2                  CMPX1   0
         3 000753   001000 601000 3                  TNZ     s:12609
         3 000754   200012 473500                    LDP3    MNTDCT$,,AUTO
         3 000755   300023 474500                    LDP4    19,,PR3
         3 000756   400001 236100                    LDQ     1,,PR4
         3 000757   000006 772000                    QRL     6
         3 000760   000077 376007                    ANQ     63,DL
         3 000761   200006 116100                    CMPQ    FEI,,AUTO
         3 000762   001000 601000 3                  TNZ     s:12609
         3 000763   300033 236100                    LDQ     27,,PR3
         3 000764   000777 316003                    CANQ    511,DU
         3 000765   001000 600000 3                  TZE     s:12609

      271    12604    4                     MNTDCT$->DCT.DQH$->NI$DQH.FEX = FEI AND
      272    12605    5                     MNTDCT$->DCT.OD.THRTLD ~= 0 THEN DO;

      273    12606    5                     MNTDCT$->DCT.OD.THRTLD = 0;

  12606  3 000766   000000 236003                    LDQ     0,DU
         3 000767   300033 552120                    STBQ    27,'20'O,PR3

PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:41   
      274    12607    5                     CALL SSR$RUE (%SS_CUB,MNTDCT$->DCT.OD.USER#);

  12607  3 000770   200012 236100                    LDQ     MNTDCT$,,AUTO
         3 000771   000033 036003                    ADLQ    27,DU
         3 000772   000026 235000 4                  LDA     22
         3 000773   200066 757100                    STAQ    MSGTBL+3,,AUTO
         3 000774   200066 630500                    EPPR0   MSGTBL+3,,AUTO
         3 000775   000020 631400 xsym               EPPR1   B_VECTNIL+16
         3 000776   000000 701000 xent               TSX1    SSR$RUE
         3 000777   000000 011000                    NOP     0

      275    12608    5                     END;

      276    12609    4                  O$ = O$->FR$RAT.LNK$;

  12609  3 001000   200010 470500                    LDP0    O$,,AUTO
         3 001001   000000 236100                    LDQ     0,,PR0
         3 001002   200010 756100                    STQ     O$,,AUTO

      277    12610    4                  END;

  12610  3 001003   000001 116000 xsym               CMPQ    B_VECTNIL+1
         3 001004   000744 601000 3                  TNZ     s:12602

      278    12611    3   GETOUT:     NK$LDCT.IP$ = ADDR(NIL);

  12611  3 001005   000001 236000 xsym  GETOUT       LDQ     B_VECTNIL+1
         3 001006   200003 470500                    LDP0    @NK$LDCT,,AUTO
         3 001007   000013 756100                    STQ     11,,PR0

      279    12612    3               RETURN;

  12612  3 001010   000000 702200 xent               TSX2  ! X66_ARET

      280    12613    3               END;
      281    12614    2         END;

PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:42   
  12614  3 001011   001014 710000 3                  TRA     s:12631

      282    12615        %EJECT;
PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:43   
      283    12616        /*F*
      284    12617              NAME: FPA$ODDN
      285    12618              PURPOSE:
      286    12619                 To notify user of optical disc devices that the OD
      287    12620                 controller has been disconnected.
      288    12621              DESCRIPTION:
      289    12622                 Called from KIA$TERM with the LDCT of the disconnected
      290    12623                 controller.  This will search the NPOOL device list for
      291    12624                 OD type devices attached to this LDCT, with users waiting
      292    12625                 for input, and wake them up.  They will detect FEDN in the
      293    12626                 in the LDCT and act accordingly.
      294    12627        */
      295    12628
      296    12629    1   FPA$ODDN: ENTRY (NK$LDCT) ALTRET;

  12629  3 001012   000000 700200 xent  FPA$ODDN     TSX0  ! X66_AUTO_2
         3 001013   000074 000002                    ZERO    60,2

      297    12630
      298    12631    1         O$ = FR$HD$(FR_NPOOL);

  12631  3 001014   000002 236000 xsym               LDQ     FR$HD$+2
         3 001015   200010 756100                    STQ     O$,,AUTO

      299    12632    2         DO WHILE (O$ ~= ADDR(NIL));

  12632  3 001016   001063 710000 3                  TRA     s:12643

      300    12633    2            MNTDCT$ = N$DCT$(O$->FR$RAT.DCTX);

  12633  3 001017   200010 470500                    LDP0    O$,,AUTO
         3 001020   000003 720100                    LXL0    3,,PR0
         3 001021   000000 471400 xsym               LDP1    N$DCT$$
         3 001022   100000 236110                    LDQ     0,X0,PR1
         3 001023   200012 756100                    STQ     MNTDCT$,,AUTO

      301    12634    2            IF (O$->FR$RAT.TYP = 'OD' AND
PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:44   

  12634  3 001024   000010 221100                    LDX1    8,,PR0
         3 001025   000000 101000 2                  CMPX1   0
         3 001026   001060 601000 3                  TNZ     s:12642
         3 001027   200012 473500                    LDP3    MNTDCT$,,AUTO
         3 001030   300030 236100                    LDQ     24,,PR3
         3 001031   200003 116100                    CMPQ    @NK$LDCT,,AUTO
         3 001032   001060 601000 3                  TNZ     s:12642

      302    12635    3               MNTDCT$->DCT.OD.LDCT$ = ADDR(NK$LDCT)) THEN DO;

      303    12636    3               IF B$USRT$->B$USER.FLG(MNTDCT$->DCT.OD.USER#) & %U_SCIO

  12636  3 001033   300033 236100                    LDQ     27,,PR3
         3 001034   000027 772000                    QRL     23
         3 001035   017760 376007                    ANQ     8176,DL
         3 001036   000000 474400 xsym               LDP4    B$USRT$
         3 001037   400000 236106                    LDQ     0,QL,PR4
         3 001040   000002 376000 2                  ANQ     2
         3 001041   001060 600000 3                  TZE     s:12642
         3 001042   300033 236100                    LDQ     27,,PR3
         3 001043   000027 772000                    QRL     23
         3 001044   017760 376007                    ANQ     8176,DL
         3 001045   400017 236106                    LDQ     15,QL,PR4
         3 001046   200003 116100                    CMPQ    @NK$LDCT,,AUTO
         3 001047   001060 601000 3                  TNZ     s:12642

      304    12637    3                  AND B$USRT$->B$USER.MISC$(MNTDCT$->DCT.OD.USER#) =
      305    12638    4                  ADDR(NK$LDCT) THEN DO;

      306    12639    4                  CALL SSR$RUE (%SS_FC,MNTDCT$->DCT.OD.USER#);

  12639  3 001050   200012 236100                    LDQ     MNTDCT$,,AUTO
         3 001051   000033 036003                    ADLQ    27,DU
         3 001052   000030 235000 4                  LDA     24
         3 001053   200066 757100                    STAQ    MSGTBL+3,,AUTO
         3 001054   200066 630500                    EPPR0   MSGTBL+3,,AUTO
PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:45   
         3 001055   000020 631400 xsym               EPPR1   B_VECTNIL+16
         3 001056   000000 701000 xent               TSX1    SSR$RUE
         3 001057   000000 011000                    NOP     0

      307    12640    4                  END;

      308    12641    3               END;

      309    12642    2            O$ = O$->FR$RAT.LNK$;

  12642  3 001060   200010 470500                    LDP0    O$,,AUTO
         3 001061   000000 236100                    LDQ     0,,PR0
         3 001062   200010 756100                    STQ     O$,,AUTO

      310    12643    2            END;

  12643  3 001063   000001 116000 xsym               CMPQ    B_VECTNIL+1
         3 001064   001017 601000 3                  TNZ     s:12633

      311    12644    1         NK$LDCT.DFLG.FEDN = '1'B;

  12644  3 001065   200003 470500                    LDP0    @NK$LDCT,,AUTO
         3 001066   000020 236007                    LDQ     16,DL
         3 001067   000006 256100                    ORSQ    6,,PR0

      312    12645    1         RETURN;

  12645  3 001070   000000 702200 xent               TSX2  ! X66_ARET

MSGL
 Sect OctLoc
   1     000   006001 001000                                                    ....

(unnamed)
 Sect OctLoc
   2     000   117104 040040   062001 432442   000000 002000                    OD  2.......

PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:46   
(unnamed)
 Sect OctLoc
   4     000   000004 400000   777777 777770   777777 773777   777777 737777    ................
   4     004   111040 040040   777777 777774   116040 040040   777777 577777    I   ....N   ....
   4     010   777777 777617   000003 006000   000000 000313   000000 000042    ..............."
   4     014   000013 006000   000002 006000   000012 006000   200000 000000    ................
   4     020   000000 000506   000007 006000   000005 006000   000000 006000    ................
   4     024   000017 006000   000020 006000   000012 006000   000000 000050    ...............(
   4     030   000027 006000                                                    ....
      313    12646    1   END;

PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:47   
--  Include file information  --

   FT$DDT.:E05TOU  cannot be made into a system file and is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   FP$LBLS.:E05TOU  cannot be made into a system file and is referenced.
   FT$LBLS.:E05TOU  cannot be made into a system file and is referenced.
   FP_MACRO_C.:E05TOU  is referenced.
   OC_SUBS_C.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KI_MACROS_C.:E05TOU  is referenced.
   KI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KV$VDO.:E05TOU  is referenced.
   KI$MHDR.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_SUBS_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   FT_SUBS.:E05TOU  is referenced.
   FR_SUBS.:E05TOU  is referenced.
   FR$RAT.:E05TOU  is referenced.
   EL_SUBS_C.:E05TOU  is referenced.
   EL$TABLES.:E05TOU  is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FPA$ODIN.
PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:48   

 **** Variables and constants ****

  ****  Section 001  Data  FPA$ODIN

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/b BIT         r     1 MSGL

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @K$RWPARM                  3-0-0/w PTR         r     1 @NK$LDCT
    17-0-0/w STRC        r     1 CDCTX                     13-0-0/w PTR         r     1 D$
    17-0-0/w UBIN        r     1 DCTX                      20-0-0/w STRC(1224)  r     1 EL$FEPERR
    62-0-0/w UBIN        r     1 ERRCD                      6-0-0/w UBIN        r     1 FEI
    15-0-0/w UBIN        r     1 I                         *0-0-0/d STRC(1404)  r     1 K$RWPARM
    12-0-0/w PTR         r     1 MNTDCT$                   63-0-0/c STRC(72)    r     1 MSGTBL
    *0-0-0/d STRC(864)   r     1 NK$LDCT                   10-0-0/w PTR         r     1 O$
    11-0-0/w PTR         r     1 R$                        16-0-0/w UBIN(9)     r     1 USR
    14-0-0/w PTR         r     1 V1$                        5-0-0/h STRC        r     1 VDO

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$USRT$                    0-0-0/w PTR         r     1 FR$HD$(0:0)
     0-0-0/w PTR         r     1 KI_FEI$$                   0-0-0/w PTR         r     1 N$DCT$$
     0-0-0/w PTR         r     1 N$FQ$                      0-0-0/w PTR         r     1 NI$FQ$
     0-0-0/w PTR         r     1 NI$IBUF$                   0-0-0/w PTR         r     1 NI$RP$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:49   
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(576)   r     1 B$USER(0:0)                0-0-0/w STRC(1332)  r     1 DCT
     0-0-0/c STRC(1044)  r     1 ERRMSG                     0-0-0/c STRC(720)   r     1 FP$VOL1
     0-0-0/b STRC(54)    r     1 FPP$MHDR                   0-0-0/w STRC(324)   r     1 FR$RAT
     0-0-0/w STRC(288)   r     1 FT$DDT                     0-0-0/w STRC(612)   r     1 KI$FEI
     0-0-0/w PTR         r     1 KI$FEI$(0:0)
     0-0-0/w STRC(144)   r     1 KI$QMHDR                   0-0-0/h STRC        r     1 KV$VDO_EVT
     0-0-0/b STRC(108)   r     1 MAPACK                     0-0-0/c STRC(882)   r     1 MNTACK
     0-0-0/w PTR         r     1 N$DCT$(0:0)                0-0-0/w STRC(648)   r     1 NI$DQH
     0-0-0/c STRC(117)   r     1 OCMSG                      0-0-0/w UBIN        r     1 UBNBSD


   Procedure FPA$ODIN requires 569 words for executable code.
   Procedure FPA$ODIN requires 60 words of local(AUTO) storage.

    No errors detected in file FPA$ODEA.:E05TSI    .
PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:50   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:51   
          MINI XREF LISTING

B$DO.ECCINFO
      6271**DCL      6272--REDEF
B$U.MISC
      6250**DCL      6251--REDEF
B$USER.FLG
      6296**DCL     12575>>IF      12636>>IF
B$USER.MISC
      6326**DCL      6327--REDEF
B$USER.MISC$
      6327**DCL     12575>>IF      12636>>IF
B$USER.US
      6313**DCL     12575>>IF
B$USRT$
     12290**DCL     12575>>IF      12575>>IF      12575>>IF      12636>>IF      12636>>IF
CDCTX.HI
     12353**DCL     12460<<ASSIGN
CDCTX.LO
     12354**DCL     12461<<ASSIGN
D$
     12346**DCL     12490<<ASSIGN  12498>>ASSIGN  12499>>ASSIGN  12500>>ASSIGN  12501>>ASSIGN  12503>>ASSIGN
     12504>>ASSIGN  12505>>ASSIGN  12506>>IF      12508>>ASSIGN  12511>>ASSIGN  12513>>ASSIGN  12517>>ASSIGN
     12518>>ASSIGN  12519>>ASSIGN  12520>>ASSIGN  12523>>ASSIGN  12524>>ASSIGN  12525>>ASSIGN  12527>>ASSIGN
     12529>>ASSIGN  12533>>CALL    12535>>ASSIGN  12537>>ASSIGN  12538>>ASSIGN  12585>>ASSIGN
DCT.DDT$
     11855**DCL     12490>>ASSIGN
DCT.DP
     11874**DCL     11881--REDEF   11884--REDEF   11885--REDEF   11887--REDEF   11887--REDEF   11888--REDEF
     11889--REDEF   11889--REDEF
DCT.DQH$
     11870**DCL     12474>>IF      12603>>IF
DCT.DVN
     11863**DCL     12474>>IF
PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:52   
DCT.MPC.IOCHANX
     11882**DCL     11882--REDEF
DCT.OD.IP$
     11890**DCL     12468<<ASSIGN
DCT.OD.LDCT$
     11889**DCL     12634>>IF
DCT.OD.THRTLD
     11890**DCL     12603>>IF      12606<<ASSIGN
DCT.OD.USER#
     11890**DCL     12530<<ASSIGN  12575>>IF      12575>>IF      12575>>IF      12578<>CALL    12607<>CALL
     12636>>IF      12636>>IF      12639<>CALL
DCT.RAT$
     11855**DCL     12462>>ASSIGN
DCTX
     12350**DCL     12351--REDEF   12459<<ASSIGN  12462>>ASSIGN  12463>>ASSIGN  12468>>ASSIGN  12532<<ASSIGN
     12533<>CALL
EL$FEPERR
     12356**DCL     12541<<ASSIGN  12551<>CALL    12551--CALL
EL$FEPERR.STATDATA.ERRCODE
     12371**DCL     12544<<ASSIGN
EL$FEPERR.STATDATA.ERRCODE.ERR#
     12399**DCL     12545<<ASSIGN  12545>>ASSIGN
EL$FEPERR.STATDATA.NODE
     12356**DCL     12542<<ASSIGN
EL$FEPERR.STATDATA.TERMID.TERM
     12421**DCL     12430--REDEF
EL$FEPERR.STATDATA.VALUES
     12402**DCL     12548<<ASSIGN
EL$FEPERR.X.DYMDATA
     12432**DCL     12550<<ASSIGN
ELA$SYSLOG
     12294**DCL-ENT 12551--CALL
ERRCD
     12434**DCL     12551<>CALL
ERRMSG.DYMDATA
     12159**DCL     12550>>ASSIGN
PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:53   
ERRMSG.ERRNUM
     12152**DCL     12545>>ASSIGN
ERRMSG.VALUES
     12154**DCL     12548>>ASSIGN
FEI
     12341**DCL     12452<<ASSIGN  12474>>IF      12542>>ASSIGN  12603>>IF
FP$LBL1.SYSTEM_ID
     11168**DCL     11169--REDEF
FP$VOL1.ACCESS
     11094**DCL     12507>>IF      12510>>IF
FP$VOL1.ACCOUNT
     11103**DCL     12505>>ASSIGN
FP$VOL1.SN
     11093**DCL     12504>>ASSIGN
FPP$MHDR.FNC
     12215**DCL     12456>>IF      12456>>IF      12456>>IF      12493>>DOCASE
FR$HD$
     12289**DCL     12471>>ASSIGN  12600>>ASSIGN  12631>>ASSIGN
FR$RAT.DCTX
      6816**DCL     12473>>ASSIGN  12532>>ASSIGN  12602>>ASSIGN  12633>>ASSIGN
FR$RAT.LNK$
      6799**DCL     12478>>ASSIGN  12609>>ASSIGN  12642>>ASSIGN
FR$RAT.SOLU
      6823**DCL     12530>>ASSIGN
FR$RAT.TYP
      6822**DCL     12474>>IF      12603>>IF      12634>>IF
FRC$AVR
     12293**DCL-ENT 12533--CALL
FT$DDT.ACCT
     12233**DCL     12505<<ASSIGN  12506>>IF
FT$DDT.ANST
     12248**DCL     12498<<ASSIGN
FT$DDT.FRSTFSECT
     12269**DCL     12520<<ASSIGN  12527<<ASSIGN
FT$DDT.FRSTFSN
     12244**DCL     12519<<ASSIGN  12525<<ASSIGN
PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:54   
FT$DDT.FSN
     12242**DCL     12518<<ASSIGN  12524<<ASSIGN
FT$DDT.POS
     12266**DCL     12529<<ASSIGN  12537<<ASSIGN
FT$DDT.POSLOST
     12259**DCL     12500<<ASSIGN  12535<<ASSIGN  12585<<ASSIGN
FT$DDT.RINGIN
     12252**DCL     12501<<ASSIGN  12503<<ASSIGN
FT$DDT.SCRTCH
     12250**DCL     12517<<ASSIGN  12523<<ASSIGN
FT$DDT.SN
     12237**DCL     12504<<ASSIGN  12533<>CALL
FT$DDT.SOLICIT
     12268**DCL     12499<<ASSIGN  12538<<ASSIGN
FT$DDT.VOLACCESS
     12284**DCL     12508<<ASSIGN  12511<<ASSIGN  12513<<ASSIGN
FT$LBL1.SYSTEM_ID
     10900**DCL     10901--REDEF
FT$LBL2.CP6
     10973**DCL     10991--REDEF
FT$ULBL.LABEL_NBIN
     11067**DCL     11068--REDEF
GETOUT
     12611**LABEL   12552--GOTO    12558--GOTO    12586--GOTO
GOTDCT
     12478**LABEL   12477--GOTO
I
     12348**DCL     12515<<CALLBLT 12516>>IF      12524>>ASSIGN  12525>>ASSIGN  12526<<CALLBLT 12527>>ASSIGN
     12547<<DOINDEX 12548>>ASSIGN  12548>>ASSIGN
ILGLMNT
     12535**LABEL   12533--CALLALT
K$RWPARM
     11546**DCL        19--PROC
K$RWPARM.BLKREC
     11572**DCL     11597--REDEF
K$RWPARM.BLKREC.BLKU#
PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:55   
     11573**DCL     11575--REDEF
K$RWPARM.BLKREC.RECU#
     11585**DCL     11587--REDEF
K$RWPARM.DVE.DVBYTE.VFC
     11612**DCL     11613--REDEF
K$RWPARM.DVE.EOMCHAR
     11620**DCL     11624--REDEF
K$RWPARM.ERR
     11684**DCL     11689--REDEF   12447<<ASSIGN  12592<<ASSIGN
K$RWPARM.FC
     11648**DCL     11649--REDEF
K$RWPARM.FLDID
     11830**DCL     11831--REDEF
K$RWPARM.FPT$
     11711**DCL     11718--REDEF
K$RWPARM.IP$
     11676**DCL     12450>>ASSIGN  12451>>ASSIGN  12468>>ASSIGN  12589>>ASSIGN  12589>>ASSIGN
K$RWPARM.KEYTYPE
     11837**DCL     11838--REDEF
K$RWPARM.MSG$
     11547**DCL     11553--REDEF   12124--IMP-PTR 12143--IMP-PTR 12167--IMP-PTR 12185--IMP-PTR 12214--IMP-PTR
     12456>>IF      12456>>IF      12456>>IF      12460>>ASSIGN  12461>>ASSIGN  12465>>IF      12465>>IF
     12474>>IF      12493>>DOCASE  12495>>IF      12495>>IF      12497>>ASSIGN  12502>>IF      12515>>CALLBLT
     12526>>CALLBLT 12545>>ASSIGN  12548>>ASSIGN  12550>>ASSIGN  12555>>ASSIGN  12556>>ASSIGN  12560>>ASSIGN
     12560>>ASSIGN  12584>>IF
K$RWPARM.MSGID
     11659**DCL     11664--REDEF
K$RWPARM.MSGIDXT
     11672**DCL     11676--REDEF
K$RWPARM.ORG
     11808**DCL     11809--REDEF
K$RWPARM.THDRSZ
     11752**DCL     11756--REDEF
K$RWPARM.UHDR$
     11697**DCL     12069--IMP-PTR 12109--IMP-PTR 12453>>ASSIGN  12589>>ASSIGN
K$RWPARM.UHDRSZ
PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:56   
     11702**DCL     12589>>ASSIGN
K$RWPARM.VDOFLGS
     11810**DCL     11821--REDEF
KI$FEI.BD$
     12013**DCL     12014--REDEF
KI$FEI.BDAD.WADDR
     12015**DCL     12016--REDEF
KI$FEI.FEP#
     12023**DCL     12542>>ASSIGN
KI$FEI.RCVPB
     12029**DCL     12030--REDEF
KI$FEI$
      8621**DCL     12542>>ASSIGN
KI$QMHDR.FEI#
     11919**DCL     12451>>ASSIGN
KI$QMHDR.FPTSZ
     11952**DCL     11953--REDEF
KI$QMHDR.MSGSZ
     11958**DCL     11959--REDEF
KI$QMHDR.OFFSET
     11946**DCL     12589--ASSIGN
KI$QMHDR.UID
     11948**DCL     11949--REDEF
KI_FEI$$
      8620**DCL      8621--IMP-PTR 12542>>ASSIGN
KV$VDO_EVT
     12109**DCL     12453>>ASSIGN
MAPACK.USRNO.B1
     12205**DCL     12560>>ASSIGN
MAPACK.USRNO.B2
     12207**DCL     12560>>ASSIGN
MNTACK.DCTX.HI
     12130**DCL     12460>>ASSIGN
MNTACK.DCTX.LO
     12131**DCL     12461>>ASSIGN
MNTACK.DEV#
PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:57   
     12127**DCL     12474>>IF
MNTACK.FNC
     12125**DCL     12465>>IF
MNTACK.FSECT
     12133**DCL     12526>>CALLBLT
MNTACK.FSEQU_NUM
     12134**DCL     12515>>CALLBLT
MNTACK.STT
     12126**DCL     12465>>IF      12495>>IF      12495>>IF      12502>>IF      12584>>IF
MNTACK.VOL1
     12135**DCL     12497--ASSIGN
MNTDCT$
     12345**DCL     12463<<ASSIGN  12473<<ASSIGN  12474>>IF      12474>>IF      12490>>ASSIGN  12530>>ASSIGN
     12575>>IF      12575>>IF      12575>>IF      12578>>CALL    12602<<ASSIGN  12603>>IF      12603>>IF
     12606>>ASSIGN  12607>>CALL    12633<<ASSIGN  12634>>IF      12636>>IF      12636>>IF      12639>>CALL
MSGL
     12442**DCL     12557<>CALL
MSGTBL
     12435**DCL     12557<>CALL
MSGTBL.MSGSEL
     12438**DCL     12554<<ASSIGN
MSGTBL.MSGTYP
     12437**DCL     12555<<ASSIGN
MSGTBL.SN
     12436**DCL     12556<<ASSIGN
N$DCT$
      9675**DCL     12462>>ASSIGN  12463>>ASSIGN  12468>>ASSIGN  12473>>ASSIGN  12602>>ASSIGN  12633>>ASSIGN
N$DCT$$
      9541**DCL      9675--IMP-PTR 12462>>ASSIGN  12463>>ASSIGN  12468>>ASSIGN  12473>>ASSIGN  12602>>ASSIGN
     12633>>ASSIGN
N$FQ$
      9541**DCL      9676--IMP-PTR
N$REQ_INIT.BUFADDR
      9560**DCL      9561--REDEF    9561--REDEF
N$REQ_INIT.DLA.DRELADDR
      9552**DCL      9552--REDEF
PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:58   
N$REQ_INIT.DVE.EOMCHAR
      9589**DCL      9590--REDEF
N$REQ_INIT.EAINFO
      9583**DCL      9583--REDEF
N$REQ_INIT.EAINFOX
      9583**DCL      9584--REDEF
N$REQ_INIT.EVNTINFO
      9584**DCL      9584--REDEF
N$REQ_INIT.STATUS
      9565**DCL      9571--REDEF
NI$DQH.FEX
     11905**DCL     12474>>IF      12603>>IF
NI$DQH.IOCHANX
     11904**DCL     11905--REDEF
NI$DQH.MBX$
     11913**DCL     11914--REDEF
NI$FQ$
      9601**DCL      9677--IMP-PTR
NI$IBUF$
      9601**DCL      9677--IMP-PTR
NI$IMXMBX_INIT.PAGED_BASE
      9611**DCL      9612--REDEF    9612--REDEF
NI$IMXMBX_INIT.SIZE
      9613**DCL      9613--REDEF
NI$REQ_INIT.DCW
      9635**DCL      9638--REDEF
NI$REQ_INIT.DCW.TALLY
      9636**DCL      9636--REDEF
NI$REQ_INIT.IDCW.EXTA
      9638**DCL      9638--REDEF
NI$REQ_INIT.PCW
      9640**DCL      9644--REDEF
NI$REQ_INIT.SEEK
      9645**DCL      9646--REDEF    9647--REDEF
NI$RP$
      9649**DCL      9679--IMP-PTR
PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:59   
NI_MBX_INIT.DCW.CONTROL.AE
      9671**DCL      9671--REDEF
NI_MBX_INIT.LPW.CONTROL.AE
      9667**DCL      9667--REDEF
NK$LDCT
     11492**DCL        19--PROC    12575--IF      12629--ENTRY   12634--IF      12636--IF
NK$LDCT.DDT$
     11494**DCL     11494--REDEF
NK$LDCT.DFLG.FEDN
     11500**DCL     12644<<ASSIGN
NK$LDCT.IOQ$
     11493**DCL     11494--REDEF
NK$LDCT.IP$
     11514**DCL     12446>>IF      12450<<ASSIGN  12611<<ASSIGN
NK$LDCT.IPFEI#
     11515**DCL     12451<<ASSIGN  12452>>ASSIGN
NK$LDCT.LDCTX
     11495**DCL     11495--REDEF
NK$LDCT.LKFLG.ABORTED
     11507**DCL     11508--REDEF
NK$LDCT.RLCID.LDCTX
     11517**DCL     11517--REDEF
NK$LDCT.STA$
     11513**DCL     11514--REDEF
NK$LDCT.SYMB$
     11492**DCL     11492--REDEF   11492--REDEF   11493--REDEF
NK$LDCT.TH.MAXNMBBYT
     11519**DCL     12596>>IF
NK$LDCT.TH.MAXNMBRCR
     11518**DCL     12596>>IF
NO_VOLUME
     12480**LABEL   12466--GOTO
O$
     12343**DCL     12471<<ASSIGN  12472>>DOWHILE 12473>>ASSIGN  12474>>IF      12478<<ASSIGN  12478>>ASSIGN
     12532>>ASSIGN  12600<<ASSIGN  12601>>DOWHILE 12602>>ASSIGN  12603>>IF      12609<<ASSIGN  12609>>ASSIGN
     12631<<ASSIGN  12632>>DOWHILE 12633>>ASSIGN  12634>>IF      12642<<ASSIGN  12642>>ASSIGN
PL6.E3A0      #001=FPA$ODIN File=FPA$ODEA.:E05TSI                                TUE 07/29/97 17:17 Page:60   
OCI$MK_WR
     12295**DCL-ENT 12557--CALL
OCMSG.SER
     12176**DCL     12556>>ASSIGN
OCMSG.TYPE
     12177**DCL     12555>>ASSIGN
R$
     12344**DCL     12462<<ASSIGN  12530>>ASSIGN
SC_FPABADDEV
     12296**DCL-ENT 12480--CALL
SSR$RUE
     12292**DCL-ENT 12561--CALL    12578--CALL    12607--CALL    12639--CALL
UBNBSD
     11844**DCL     12589<<ASSIGN
USR
     12349**DCL     12560<<ASSIGN  12561<>CALL
V1$
     12347**DCL     12497<<ASSIGN  12504>>ASSIGN  12505>>ASSIGN  12507>>IF      12510>>IF
VDO
     12332**DCL     12453<<ASSIGN
VDO.FNC
     12336**DCL     12454>>DOCASE
XIT2
     12577**LABEL   12562--GOTO
