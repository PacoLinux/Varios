VERSION E05

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:1    
        1        1        /*M* KXX$VDI  -  X.29 Handler - VDH interface.        */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7
        8        8        /*X*   PLM = 4, IND=3, CTI=3, DCI=6, IAD=0, DTI=6, AND=Y, CSI=3, THI=3, STI=3, DMC=Y
                 8         */
        9        9
       10       10        KXX$VDI: PROC (PRM_USR_X) ALTRET;
       11       11        /*P*
       12       12             NAME: KXX$VDI
       13       13             PUROPSE:
       14       14                      THE PURPOSE OF THIS ROUTINE IS TO RECEIVE CALLS FROM THE
       15       15                      VDH TO THE X.29 HANDLER. THIS ROUTINE DETERMINES WHAT NEEDS
       16       16                      TO BE DONE AND EITHER DOES IT, OR CALLS ANOTHER ROUTINE WITHIN
       17       17                      X.29 TO DO WHAT NEEDS TO BE DONE.
       18       18        */
       19       19
       20       20
       21       21        /*****************************************************************
       22       22        *                                                                *
       23       23        *                           Include files                        *
       24       24        *                                                                *
       25       25        *****************************************************************/
       26       26
       27       27
       28       28        %INCLUDE LCP_6;
       29     4307        %INCLUDE G_JIT_M;
       30     4572        %INCLUDE CP_6_SUBS;
       31     5112        %INCLUDE KV$VDO;
       32     6127        %INCLUDE KV_ERRORS_C;
       33     6187        %KV_VDOVLP_E;
       34     6201        %INCLUDE KV$SND;
       35     6620        %KV_SND_FNC_E;
       36     6636        %INCLUDE KV_ASCCHR_E;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:2    
       37     6773        %INCLUDE KV_GLBASM_E;
       38     6791        %INCLUDE KV_GLBCNS_E; /*  VDH CONSTANTS                     */
       39     7132        %KV#DATMOD_E;
       40     7138          %KV_STRTYP_E;
       41     7176          %KV_SCHRSN_E;
       42     7183          %KV_VDH_EVT_ID_E;
       43     7189          %KV_USR_EVT_ID_E;
       44     7209          %KV_USR_FNC_E;
       45     7225          %KV_VDH_FNC_E;
       46     7245          %KV_CLKNMB_E;
       47     7254          %KV_CLKUNT_E;
       48     7259          %KV_DSCRSN_E;
       49     7268          %KV_INPOPRX_E;
       50     7280          %KV_PRTTYP_E;
       51     7287          %KV#CQ_HNDID_E;
       52     7292
       53     7293        %INCLUDE KH$STT; /* For KX_STATS_X29                         */
       54     7323        %INCLUDE KV$INT;
       55     7955        %INCLUDE KV_INT_M;
       56     8098        %INCLUDE KV$GLB;
       57     8517        %INCLUDE KV$GLBCTX;
       58     8962        %INCLUDE KX_MACROS_M;
       59     9733        %INCLUDE KXX_MACROS_M;
       60    10075        %INCLUDE KX_EQUS_E;
       61    10514        %INCLUDE KX_PERR_C;
       62    10643        %INCLUDE KX_DATA_C;
       63    10711        %INCLUDE KX_SCODE_C;
       64    10777        %INCLUDE KL_MACRO_C;
       65    14129        %INCLUDE KL_AFCN_C;
       66    14230        %INCLUDE KL_CONTROL_C;
       67    14610        %INCLUDE KL_SUPER_C;
       68    17512        %INCLUDE K_ID_E;
       69    17562          %K#LYRID_E;
       70    17569          %K#ENTID_E;
       71    17588        %INCLUDE KV_PRMID_E;
       72    17762          %KV_PRMID_E; /* set and get param stuff            */
       73    17918        %INCLUDE KV_GLB_M; /*  VDH user macros                   */
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:3    
       74    18040        %INCLUDE KA_GLBASM_E;
       75    18122        %INCLUDE KA_GLB_E;
       76    18200          %KA_HLTOTP_E;
       77    18209          %KA_INPFNC_E;
       78    18254
       79    18255        %INCLUDE KA_GLB;
       80    18332        %INCLUDE KV$USR;
       81    18644        %INCLUDE KV$VDH;
       82    19075        %INCLUDE KH$CHN; /* channel table items                */
       83    19197        %INCLUDE KH_CHN;
       84    19237        %INCLUDE KH_MACRO_C;
       85    19980        %INCLUDE K_ADDRESS_M;
       86    20483        %INCLUDE KNH_MACRO_C;
       87    20766        %EJECT;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:4    
       88    20767
       89    20768        /*****************************************************************
       90    20769        *                                                                *
       91    20770        *                           Based                                *
       92    20771        *                                                                *
       93    20772        *****************************************************************/
       94    20773
       95    20774        %KV$ERD; /*  VDH EXTENDED REAL DEVICE DEFINITION    */
       96    20858        %KV$MRD; /*  MASTER REAL DEVICE CONTEXT BLOCK  */
       97    20905        %KV$MVD; /*  MASTER VIRTUAL DEVICE CONTEXT BLOCK    */
       98    20949        %KV$PTR; /*  VDH POINTER BLOCK                 */
       99    20992        %KV$SSN; /*  SESSION CONTEXT                   */
      100    21071        %KV$VDI (STCLASS="BASED(VDI$)"); /*  VDI CONTEXT BLOCK                 */
      101    21142        %EQU KV_VDI=CHARTEXT('KV$VDI');
      102    21143        %KV$STR; /* stream context  */
      103    21230        %KV$TRNTBL; /*  TRANSLATE TABLE STUFF             */
      104    21288
      105    21289        %KV$OTPMRK;
      106    21316        %KX$X29_OTPBFR ( STCLASS = "BASED(DAT$)" ); /*  OUTPUT BUFFER TEMPLATE            */
      107    21339        %KX$X29 ( STCLASS = "BASED(X29$)" ); /*  X29 CONTEXT BLOCK               */
      108    21379        %KX$LINKDEV ( STCLASS = "BASED (CNTL$)" );
      109    21406        %KX$LINKDEV ( FPTN = B$LINKDEV, STCLASS = BASED );
      110    21433        %KX$VC_OTPBFR ( STCLASS = "BASED(DAT$)" ); /*  OUTPUT BUFFER TEMPLATE            */
      111    21460        %KX$VC ( STCLASS = "BASED(VC$)" ); /*  VC CONTEXT BLOCK               */
      112    21551        %KX$L3 ( STCLASS = "BASED(L3$)" );
      113    21954        %KX$L3 ( FPTN = KX$TL3, STCLASS = "BASED(TL3$)" );
      114    22357        %KX$TMRBLK ( FPTN = KX$BTMRBLK, STCLASS = BASED );
      115    22389        %KH$CHN;
      116    22513        %EQU TL3CHN = %CHARTEXT('KX$TL3.CHN$->KH$CHN');
      117    22514        %EQU L3CHN = %CHARTEXT('KX$L3.CHN$->KH$CHN');
      118    22515        %EQU KX_L2 = %CHARTEXT('KX$LINKDEV.L2$->KX$L2');
      119    22516
      120    22517    1   DCL CHRSTR CHAR(2000) CALIGNED BASED;
      121    22518    1   DCL Y$BYT(0:2000) UBIN BYTE CALIGNED BASED;
      122    22519    1   DCL PRTTBL CHAR(2000) CALIGNED BASED(PRTTBL$);
      123    22520    1   DCL BASED_WORD UBIN WORD BASED;
      124    22521        %G$JIT ( STCLASS = "BASED(G$JIT$)" );
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:5    
      125    22935        %VLP_SCODE ( FPTN=B$SCODE, STCLASS=BASED );
      126    22996        %KX$L2 ( STCLASS = BASED );
      127    23363    1   DCL B$STR CHAR(1000) BASED ALIGNED;
      128    23364    1   DCL 1 B$RLCID BASED ALIGNED,
      129    23365    1         2 * BIT (16),
      130    23366    1         2 RLCID UBIN WORD;
      131    23367
      132    23368        %EJECT;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:6    
      133    23369
      134    23370        /*****************************************************************
      135    23371        *                                                                *
      136    23372        *                           Symrefs                              *
      137    23373        *                                                                *
      138    23374        *****************************************************************/
      139    23375
      140    23376    1   DCL G$JIT$ PTR SYMREF;
      141    23377        %KV$STT (NAME = KV_STT, STCLASS = SYMREF);
      142    23771        %KV$USRPRM(NAME=KX_USRPRM,STCLASS=SYMREF); /* USRPRM STRUCTURE                */
      143    23822        %KV$VDH_DSC(NAME=KXX_VDH_DSC,STCLASS=SYMREF);
      144    23858        %KV$VDH_EVT(NAME=KV_VDH_EVT_RLSVDI,ID=KV_VDH_EVT_ID_RLSVDI,
      145    23859         STCLASS=SYMREF);
      146    23894        %KV$VDH_EVT (NAME=KV_VDH_EVT_RQSOTP, ID=KV_VDH_EVT_ID_RQSOTP,
      147    23895         STCLASS=SYMREF);
      148    23930        %KV$VDH_EVT(NAME=KV_VDH_EVT_CMPOTP,ID=KV_VDH_EVT_ID_CMPOTP,
      149    23931         STCLASS=SYMREF);
      150    23966        %KV$VDH_EVT ( NAME = KX_VDH_EVT_ATN, STCLASS = SYMREF );
      151    24001        %KV$VDH_OTPLCL(NAME = KV_VDH_OTPLCL, STCLASS = SYMREF);
      152    24074        %KV$VDH_OTPMRK(NAME = KV_VDH_OTPMRK, STCLASS = SYMREF);
      153    24136        %KV$VDH_SETCLK(NAME = KV_VDH_SETCLK, STCLASS = SYMREF);
      154    24172        %KV$VDH_DAT ( NAME = KV_VDH_DAT, STCLASS = SYMREF );
      155    24252
      156    24253        %KA_MSC;
      157    24275        %KX_DATA;
      158    24965        %KX_PRTTBL;
      159    24993        %KX_STATS_X29; /*  ASYNC STATS BUFFER TEMPLATE       */
      160    25334        %KA_TRNTBL_MSC; /*  ASYNC TRANSLATE TABLE ITEMS       */
      161    25355        %KH_CHNDAT;
      162    25373        %KH$CTLTBL ( FPTN = KH_CTLTBL, STCLASS = SYMREF );
      163    25585        %KV$ERD (NAME=KV_ERD,STCLASS="CONSTANT SYMDEF");
      164    25669        /*
      165    25670           get output buffer structure. Used by the marker request code
      166    25671           to call KAV$VDI itself.
      167    25672        */
      168    25673        %KV$USR_GETOTPBFR(NAME=KV_USR_GETOTPBFR,STCLASS=STATIC);
      169    25708
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:7    
      170    25709        /* Output buffer limit exceeded.                                              */
      171    25710
      172    25711    1   DCL KA_OTPBFRLMTEXC UBIN STATIC INIT(0);
      173    25712
      174    25713        /* constant array containing powers of 2 */
      175    25714
      176    25715    1   DCL Y_POWER_OF_2(0:15) UBIN WORD CONSTANT INIT(1,2,4,8,16,32,64,128,
      177    25716    1    256,512,1024,2048,4096,8192,16384,32768);
      178    25717    1   DCL 1 X28_PRTID CONSTANT,
      179    25718    1         2 BYT1 UBIN BYTE CALIGNED INIT(1),
      180    25719    1         2 BYT2 UBIN BYTE CALIGNED INIT(0),
      181    25720    1         2 BYT3 UBIN BYTE CALIGNED INIT(0),
      182    25721    1         2 BYT4 UBIN BYTE CALIGNED INIT(0);
      183    25722
      184    25723    1   DCL KX_BFR_BRK BIT(16) ALIGNED SYMREF;
      185    25724        %KX$VC ( FPTN = KX_VC, STCLASS = CONSTANT );
      186    25815        %VC$CAL ( FPTN = VC_CAL, STCLASS = SYMREF );
      187    25861        %VC$INT ( FPTN = VC_INT, STCLASS = SYMREF );
      188    25882        %VC$RST ( FPTN = VC_RST, STCLASS = SYMREF );
      189    25903        %VC$CLR ( FPTN = VC_CLR, STCLASS = SYMREF );
      190    25932        %KV$VDH_DAT ( NAME = KX_SND_DAT, STCLASS = SYMREF,
      191    25933           VDOVLPARY = KX_VDOVLPARY, DATMOD = %KV#DATMOD_TRN );
      192    26013        %KV$SND ( NAME = KX_VDOVLPARY, HDR = NO, VLP = YES, STCLASS = SYMREF );
      193    26046        %KV$VDOVLP_ERR ( NAME = KX_VDOVLP_ERR, STCLASS = CONSTANT SYMDEF );
      194    26143        %KV$VDOVLP_KEY ( NAME = KX_KEY_CAL_IND, STCLASS = SYMREF );
      195    26193        %KV$VDOVLP_KEY ( NAME = KX_KEY_CAL_CNF, STCLASS = SYMREF );
      196    26243        %KV$VDOVLP_KEY ( NAME = KX_KEY_DAT_IND, STCLASS = SYMREF );
      197    26293        %KV$VDOVLP_KEY ( NAME = KX_KEY_INT_IND, STCLASS = SYMREF );
      198    26343        %KV$VDOVLP_KEY ( NAME = KX_KEY_INT_CNF, STCLASS = SYMREF );
      199    26393        %KV$VDOVLP_KEY ( NAME = KX_KEY_RST_IND, STCLASS = SYMREF );
      200    26443        %KV$VDOVLP_KEY ( NAME = KX_KEY_RST_CNF, STCLASS = SYMREF );
      201    26493        %KV$VDOVLP_KEY ( NAME = KX_KEY_CLR_IND, STCLASS = SYMREF );
      202    26543        %KV$VDOVLP_KEY ( NAME = KX_KEY_INDX3, STCLASS = SYMREF );
      203    26593
      204    26594        /*
      205    26595           VLP_ERRCODEs
      206    26596        */
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:8    
      207    26597
      208    26598        %VLP_ERRCODE (STCLASS=CONSTANT,FCG='KX',MID='X',SEV=%G_WRSYSLOG_SEV_BAD_HARD#,
      209    26599                           FPTN = LINERRDSC,
      210    26600                           ERR# = %E_KXX_LINERRDSC# );
      211    26646        /*E*    ERROR:  KXX-E_KXX_LINERRDSC#-0
      212    26647              MESSAGE:  Excessive input line errors
      213    26648          DESCRIPTION:  An excessive number of parity errors was received.
      214    26649                       The count, in 1 minute, exceeded KA_LINERRLOGLMT.
      215    26650        */
      216    26651        %VLP_ERRCODE (STCLASS=SYMREF,FPTN=DEVLGNFAL);   /* symdef in KXP */
      217    26697        %VLP_ERRCODE (STCLASS=CONSTANT,FCG='KX',MID='X',SEV=%G_WRSYSLOG_SEV_SOFT#,
      218    26698                      FPTN=LGNRJC,
      219    26699                      ERR# = %E_KXX_LGNRJC# );
      220    26745        /*E*      ERROR:  KXX-E_KXX_LGNRJC#-0
      221    26746                MESSAGE:  Fail to logon to NODEADMN
      222    26747            DESCRIPTION:  NODEADMN possibly run out of room for devices.
      223    26748        */
      224    26749        %VLP_ERRCODE (STCLASS=CONSTANT,FCG='KX',MID='X',SEV=%G_WRSYSLOG_SEV_SOFT#,
      225    26750                      FPTN=X28_QBIT,
      226    26751                      ERR# = %E_KXX_X28QBIT# );
      227    26797        /*E*      ERROR:  KXX-E_KXX_X28QBIT#-0
      228    26798                MESSAGE:  sent Q-bit pkt on x.28 vc for host user.
      229    26799            DESCRIPTION:  Supposedly the host user meant it.
      230    26800        */
      231    26801        %VLP_ERRCODE (STCLASS=CONSTANT,FCG='KX',MID='X',SEV=%G_WRSYSLOG_SEV_SOFT#,
      232    26802                      FPTN=NOT_X28,
      233    26803                      ERR# = %E$BADVCX28 );
      234    26849        %VLP_ERRCODE (STCLASS=CONSTANT,FCG='KX',MID='X',SEV=%G_WRSYSLOG_SEV_SOFT#,
      235    26850                      FPTN=BAD_VCSTT,
      236    26851                      ERR# = %E$BADVCSTT );
      237    26897        %VLP_ERRCODE (STCLASS=CONSTANT,FCG='KX',MID='X',SEV=%G_WRSYSLOG_SEV_SOFT#,
      238    26898                      FPTN=UNK_VCFNC,
      239    26899                      ERR# = %E$BADVCFNC );
      240    26945
      241    26946        %VLP_ERRCODE (STCLASS=CONSTANT,FCG='KX',MID='P',SEV=%G_WRSYSLOG_SEV_SOFT#,
      242    26947                           FPTN = NO_L3CTX,
      243    26948                           ERR# = %E_KXP_NO_L3CTX# );
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:9    
      244    26994        %VLP_SCODE (FPTN=Y_UNKSCHRSN,STCLASS=CONSTANT,FCG=KX,MID=X,ERR#=%S$KX_UNKSCHRSN#);
      245    27055        %VLP_SCODE (FPTN=Y_UNKVDIEVT,STCLASS=CONSTANT,FCG=KX,MID=X,ERR#=%S$KX_UNKVDIEVT#);
      246    27116        %VLP_SCODE (FPTN=Y_UNKINPPRC,STCLASS=CONSTANT,FCG=KX,MID=X,ERR#=%S$KX_UNKINPPRC#);
      247    27177        %VLP_SCODE (FPTN=Y_UNKPRMID,STCLASS=CONSTANT,FCG=KX,MID=X,ERR#=%S$KX_UNKPRMID#);
      248    27238        %VLP_SCODE (FPTN=Y_UNKUSRFNC,STCLASS=CONSTANT,FCG=KX,MID=X,ERR#=%S$KX_UNKUSRFNC#);
      249    27299        %VLP_SCODE (FPTN=Y_NO_GET,STCLASS=CONSTANT,FCG=KX,MID=X,ERR#=%S$KX_NO_GET#);
      250    27360        %VLP_SCODE ( FPTN=Y_LINKDEVSTT,STCLASS=CONSTANT,FCG=KX,MID=X,ERR#=%S$KX_LINKDEVSTT#)
             27360            ;
      251    27421        %VLP_SCODE ( FPTN=Y_ILGDATSIZ,STCLASS=CONSTANT,FCG=KX,MID=X,ERR#=%S$KX_ILGDATSIZ#);
      252    27482        %VLP_SCODE ( FPTN=Y_NOMEM,STCLASS=CONSTANT,FCG=KX,MID=X,ERR#=%S$KX_NO_GET#);
      253    27543        %EJECT;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:10   
      254    27544
      255    27545        /*****************************************************************
      256    27546        *                                                                *
      257    27547        *                           Auto                                 *
      258    27548        *                                                                *
      259    27549        *****************************************************************/
      260    27550
      261    27551    1   DCL X29$ PTR;
      262    27552    1   DCL VC$ REDEF X29$ PTR;
      263    27553    1   DCL CNTL$ REDEF X29$ PTR;
      264    27554    1   DCL VDI$ PTR;
      265    27555    1   DCL DAT$ PTR;
      266    27556    1   DCL TEMP$ PTR;
      267    27557    1   DCL PRV$ PTR;
      268    27558    1   DCL TEMP1$ PTR;
      269    27559    1   DCL L3$ PTR;
      270    27560    1   DCL TL3$ PTR;
      271    27561    1   DCL Y@INDEX SBIN;
      272    27562    1   DCL CHRCNT UBIN;
      273    27563    1   DCL PRTTBL$ PTR;
      274    27564        %FPT_X25 ( FPTN = CALL_FPT, STCLASS = AUTO );
      275    27608    1   DCL FLWCTRPAD UBIN;
      276    27609    1   DCL PADECHO UBIN;
      277    27610    1   DCL Y@BYTSIZ UBIN;
      278    27611    1   DCL Y@BYTSIZ2 UBIN;
      279    27612        %VLP_ERRCODE ( STCLASS=AUTO,FPTN=ERCOD );
      280    27658        %KV$VDOVLP_ERR ( NAME=VDOVLP_ERR, STCLASS=AUTO );
      281    27755    1   DCL TEMP0 UBIN AUTO;
      282    27756    1   DCL LEVEL UBIN;
      283    27757        %KV$USR_EVT ( NAME = KV@USR_EVT, STCLASS = AUTO );
      284    27792    1   DCL Y@HLTOTP_ALL BIT(8);
      285    27793        /*
      286    27794           DCL AND REDEF FOR THE PARAMETER.
      287    27795        */
      288    27796    1   DCL PRM_USR_X CHAR(PRM_COPY);
      289    27797    1   DCL PRM_COPY REDEF PRM_USR_X UBIN;
      290    27798        %KV$USR_DAT(NAME=PRM_USR_DAT, /*  USER DATA                         */
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:11   
      291    27799         STCLASS=REDEF PRM_USR_X);
      292    27883        %KV$USR_EVT(NAME=PRM_USR_EVT, /*  REPORT EVENT TO USER              */
      293    27884         STCLASS=REDEF PRM_USR_X);
      294    27919        %KV$USR_EXTINPTRN(NAME=PRM_USR_EXTINPTRN,
      295    27920         STCLASS=REDEF PRM_USR_X);
      296    27956        %KV$USR_EXTOTPTRN(NAME=PRM_USR_EXTOTPTRN, /* USR EXTENDED OUTPUT TRANSLATION  */
      297    27957         STCLASS=REDEF PRM_USR_X);
      298    27993        %KV$USR_GETPRM(NAME=PRM_USR_GETPRM, /*  GET PARAMETER                     */
      299    27994         STCLASS=REDEF PRM_USR_X);
      300    28055        %KV$USR_GETOTPBFR(NAME=PRM_USR_GETOTPBFR, /* GET OTPBFR  ARGUMENT STRUCTURE   */
      301    28056         STCLASS=REDEF PRM_USR_X);
      302    28091        %KV$USR_INPPRC(NAME=PRM_USR_INPPRC, /*  INPUT PROCEDURE                   */
      303    28092         STCLASS=REDEF PRM_USR_X);
      304    28128        %KV$USR_OTPMRK(NAME=PRM_USR_OTPMRK, /*  USER MARKER REQUEST               */
      305    28129         STCLASS=REDEF PRM_USR_X);
      306    28191        %KV$USR_OTPRPTCHR(NAME=PRM_USR_OTPRPTCHR, /* OUTPUT REPEATED CHARACTER        */
      307    28192         STCLASS=REDEF PRM_USR_X);
      308    28227        %KV$USR_RQSDAT(NAME=PRM_USR_RQSDAT,
      309    28228         STCLASS=REDEF PRM_USR_X);
      310    28291        %KV$USR_SETPRM(NAME=PRM_USR_SETPRM, /*  USER SET PARAMETER ARGUMENT       */
      311    28292         STCLASS=REDEF PRM_USR_X);
      312    28354
      313    28355    1   DCL 1 Y_VDI_LCL ALIGNED,
      314    28356    1         2 BUF(0:3) CHAR(1) CALIGNED,
      315    28357        /* ACTUAL NUMBER OF BYTES TO BE OBTAINED FOR THE OUTPUT BUFFER                */
      316    28358    1         2 BYTSIZ UBIN WORD,
      317    28359        /* ABOVE EXPRESSED AS A LOG BASE 2                                            */
      318    28360    1         2 BYTSIZLOG2 UBIN WORD,
      319    28361        /* ACTUAL NUMBER OF BYTES NEEDED ON THIS GET BUFFER CALL                      */
      320    28362    1         2 SIGSIZ UBIN WORD,
      321    28363        /* NEXT COUNT*                                                                */
      322    28364    1         2 NXTCNT UBIN WORD,
      323    28365        /* CAUSE A SYNCHRONOUS FLOW CONTROL HALT AFTER THE REPEATED CHARACTERS.       */
      324    28366    1         2 SNCFLWCTRHLT BIT(1) ALIGNED;
      325    28367
      326    28368
      327    28369
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:12   
      328    28370        %KV$VDH_DSC(NAME = KV@VDH_DSC, STCLASS = AUTO);
      329    28406        %KV$VDH_OTPLCL(NAME = KV@VDH_OTPLCL, STCLASS = AUTO);
      330    28479        %KV$VDH_OTPMRK(NAME = KV@VDH_OTPMRK, STCLASS = AUTO);
      331    28541        %KV$VDH_SETCLK(NAME = KV@VDH_SETCLK, STCLASS = AUTO);
      332    28577        %KV$VDH_DAT(NAME = KV@VDH_DAT, STCLASS = AUTO);
      333    28657        %KV$VDH_DAT ( NAME=KV@SND_DAT, VDOVLPARY=KX_VDOVLPARY, STCLASS=AUTO );
      334    28737
      335    28738    1   DCL CNC_TYP UBIN;
      336    28739        /*****************************************************************
      337    28740        *                                                                *
      338    28741        *                           External Proc                        *
      339    28742        *                                                                *
      340    28743        *****************************************************************/
      341    28744
      342    28745    1   DCL KVV$VDI ENTRY (1) ALTRET;
      343    28746    1   DCL KXX$SNDX29MSG ENTRY (2) ALTRET;
      344    28747    1   DCL KXX$X29 ENTRY (1);
      345    28748    1   DCL KXS$GETL3 ENTRY (3) ALTRET;
      346    28749    1   DCL KXX$X28 ENTRY (1);
      347    28750    1   DCL KXV$VCVDH ENTRY (1) ALTRET;
      348    28751    1   DCL DWORD UBIN(32) SYMREF;
      349    28752    1   DCL KVM$SND REDEF DWORD EPTR;
      350    28753    1   DCL KXX$DFRINP ENTRY (1);
      351    28754    1   DCL KXX$MRK ENTRY (1);
      352    28755    1   DCL KXX$INTCNC ENTRY (2) ALTRET;
      353    28756    1   DCL KXX$RLSCTX ENTRY (1);
      354    28757    1   DCL KVB$RLSSYS ENTRY (2) ALTRET;
      355    28758    1   DCL KVB$RLS2NSYS ENTRY(2) ALTRET;
      356    28759    1   DCL KHD$SCREECH ENTRY (1);
      357    28760    1   DCL KVI$RE_DSPINP ENTRY;
      358    28761    1   DCL KXP$PACKET ENTRY (1) ALTRET;
      359    28762    1   DCL KXX$TRNOTP ENTRY (1) ALTRET;
      360    28763    1   DCL KVB$GETSYS ENTRY (2) ALTRET;
      361    28764    1   DCL KVB$GET2NSYS ENTRY(2) ALTRET;
      362    28765    1   DCL KHA$ERRLOG ENTRY (2) ALTRET;
      363    28766    1   DCL KXS$Q_SYSLOG ENTRY (1);
      364    28767    1   DCL KXS$SYSLOG ENTRY (7);
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:13   
      365    28768    1   DCL KXS$RLSL3 ENTRY (1);
      366    28769    1   DCL KHI$DISABLE ENTRY (1);
      367    28770    1   DCL KHI$ENABLE ENTRY;
      368    28771    1   DCL KHA$GET_CTX_PTR ENTRY (2) ALTRET;
      369    28772
      370    28773        /*****************************************************************
      371    28774        *                                                                *
      372    28775        *                           Procedure                            *
      373    28776        *                                                                *
      374    28777        *****************************************************************/
      375    28778
      376    28779    1       VDI$ = KV$PTR.VDI$;
      377    28780    1       X29$ = %KV_VDI.USRCTX$;
      378    28781    1       IF KX$X29.SBR$ = ENTADDR(KXX$X29)
      379    28782    1          THEN
      380    28783    1             CNC_TYP = %KXX_TYP_X29#;
      381    28784    1          ELSE
      382    28785    1             IF KX$X29.SBR$ = ENTADDR(KXV$VCVDH)
      383    28786    1                THEN
      384    28787    1                   CNC_TYP = %KXX_TYP_LINKDEV#;
      385    28788    1                ELSE
      386    28789    1                   CNC_TYP = %KXX_TYP_CNTL#;
      387    28790
      388    28791    2       DO CASE( PRM_USR_EVT.FNC );
      389    28792
      390    28793        /* KV$USR_DAT - DATA. We get here if doing a transparent write                */
      391    28794        /* to a device that uses synchronous flow control.                            */
      392    28795
      393    28796    2          CASE(%KV_USR_FNC_DAT );
      394    28797                  %DISABLE;
      395    28800    3             DO CASE ( CNC_TYP );
      396    28801    3                CASE ( %KXX_TYP_LINKDEV# );
      397    28802    3                   IF PRM_USR_DAT.DAT__.DATBYTSIZ ~= 0
      398    28803    3                      THEN
      399    28804    4                         DO;
      400    28805    4                            KX$VC.VDHENTERED = '1'B;
      401    28806    4                            CALL Y$DECODE_FPT;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:14   
      402    28807    4                            KX$VC.VDHENTERED = '0'B;
      403    28808    4                         END;
      404    28809    3                CASE ( %KXX_TYP_CNTL# );
      405    28810    3                   IF PRM_USR_DAT.DAT__.DATBYTSIZ ~= LENGTHC ( B$RLCID )
      406    28811    3                      THEN
      407    28812        /*S* SCREECH_CODE: KXX-S$KX_ILGDATSIZ#
      408    28813             MESSAGE: Illegal data length on link device control connection.
      409    28814        */
      410    28815    3                         CALL KHD$SCREECH ( Y_ILGDATSIZ );
      411    28816
      412    28817    3                   IF KX$LINKDEV.OUTBOUND
      413    28818    3                      THEN
      414    28819    4                         DO;
      415    28820    4                            IF KX$LINKDEV.CRCCNT >= KX$LINKDEV.CRC
      416    28821    4                               THEN
      417    28822    4                                  GOTO L_ALTRET2;
      418    28823    4                            CALL KXS$GETL3 ( KX$LINKDEV.L2$, L3$ ) ALTRET ( L_ALTRET2 )
             28823                                     ;
      419    28824    4                            CALL KVB$GETSYS ( SIZEW(KH$CHN), KX$L3.CHN$ ) WHENALTRETURN
      420    28825    5                                  DO;
      421    28826    5   L_ALTRET1:                        CALL KXS$RLSL3 ( L3$ );
      422    28827    5   L_ALTRET2:
      423    28828                                          %WRSYSLOG ( ERRCOD = NO_L3CTX,
      424    28829                                          TRMID = "KX$LINKDEV.CHN$->KH$CHN.TERMID" );
      425    28847                                          %ENABLE;
      426    28850    5                                     %KV_STR.ERR.COD = %E$CANTGETCTX;
      427    28851    5                                     ALTRETURN;
      428    28852    5                                  END;
      429    28853    4                            KX$L3.RLSCHN = '1'B;
      430    28854    4                            CALL KVB$GETSYS ( SIZEW(KX$VC), TEMP$ ) ALTRET ( L_ALTRET1
             28854                                     );
      431    28855    4                            KX$LINKDEV.CRCCNT = KX$LINKDEV.CRCCNT + 1;
      432    28856    4                            TEMP$->KX$VC = KX_VC;
      433    28857    4                            KX_STATS_X29.KHSTT.CTXBYTUTL =
      434    28858    4                               SIZEC(KX$VC) + KX_STATS_X29.KHSTT.CTXBYTUTL;
      435    28859    4                            KX_STATS_X29.CIRCUITS = KX_STATS_X29.CIRCUITS + 1;
      436    28860    4                            KX_STATS_X29.LINSPDDST(15) =
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:15   
      437    28861    4                               KX_STATS_X29.LINSPDDST(15) + 1;
      438    28862    4                            TEMP$->KX$VC.BLNK$ = KX$LINKDEV.L4_TAIL$;
      439    28863    4                            TEMP$->KX$VC.FLNK$ = ADDR(NIL);
      440    28864    4                            TEMP$->KX$VC.L3$ = L3$;
      441    28865    4                            TEMP$->KX$VC.CNTL$ = CNTL$;
      442    28866    4                            IF KX$LINKDEV.L4_TAIL$ ~= ADDR(NIL)
      443    28867    4                               THEN
      444    28868    4                                  KX$LINKDEV.L4_TAIL$->KX$VC.FLNK$ = TEMP$;
      445    28869    4                               ELSE
      446    28870    4                                  KX$LINKDEV.L4_HEAD$ = TEMP$;
      447    28871    4                            KX$LINKDEV.L4_TAIL$ = TEMP$;
      448    28872    4                            TEMP$->KX$VC.RLCID_STRING = SUBSTR ( PRM_USR_DAT.DAT__.ADR$
             28872                                     ->B$STR,
      449    28873    4                               PRM_USR_DAT.DAT__.BYTX, LENGTHC(B$RLCID) );
      450    28874    4                            KX$L3.TYP = %KX_VC_TYP_OUTBOUND#;
      451    28875    4                            KX$L3.CM$ = TEMP$;
      452    28876    4                            %L3CHN = KX$LINKDEV.CHN$->KH$CHN;
      453    28877    4                            %L3CHN.CTX$ = L3$;
      454    28878    4                            %L3CHN.LNK$ = ADDR(NIL);
      455    28879    4                            %L3CHN.TERMID.LEV = %TERMINAL_ID_LEV_SUBCHAN#;
      456    28880    4                            %L3CHN.TERMID.TTYP = %KLTY_VIRCIR#;
      457    28881        /*
      458    28882            find an available subdevice number for this L3.
      459    28883        */
      460    28884    5                            DO TEMP0 = 1 TO 4095;
      461    28885    5                               TL3$ = KX$LINKDEV.L2$->KX$L2.L3_HEAD$;
      462    28886    6                               DO WHILE ( TL3$ ~= L3$ AND
      463    28887    6                                  ( %TL3CHN.TERMID.LEV ~= %TERMINAL_ID_LEV_SUBCHAN#
      464    28888    6                                  OR %TL3CHN.TERMID.TERM.SUBDEVICE ~= TEMP0 ));
      465    28889    6                                  TL3$ = KX$TL3.NEXT$;
      466    28890    6                               END;  /* do while ( tl3$... */
      467    28891    5                               IF TL3$ = L3$
      468    28892    5                                  THEN
      469    28893    6                                     DO;
      470    28894    6                                        %L3CHN.TERMID.TERM.SUBDEVICE = TEMP0;
      471    28895    6                                        TEMP0 = 4096;
      472    28896    6                                     END;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:16   
      473    28897    5                            END; /* do temp0 = ... */
      474    28898        /*
      475    28899           give this new L3 a kick.
      476    28900        */
      477    28901    4                            VC$ = TEMP$;
      478    28902    4                            TEMP0 = %KX_P_EV_START#;
      479    28903    4                            TEMP1$ = ADDR(NIL);
      480    28904    4                            CALL Y$CAL_PAC;
      481    28905    4                         END;
      482    28906    3                      ELSE
      483    28907    4                         DO;  /* this rlcid is for an incoming vc */
      484    28908    4                            TEMP$ = KX$LINKDEV.L4_HEAD$;
      485    28909    5                            DO WHILE ( TEMP$ ~= ADDR(NIL)
      486    28910    5                               AND ( TEMP$->KX$VC.VDI$ ~= ADDR(NIL)
      487    28911    5                               OR TEMP$->KX$VC.STATE ~= %KX_VC_ST_RMTDCL# ) );
      488    28912    5                               TEMP$ = TEMP$->KX$VC.FLNK$;
      489    28913    5                            END;  /* do while ( temp$...) */
      490    28914    4                            IF TEMP$ = ADDR(NIL)
      491    28915    4                               THEN
      492    28916    4                                  GOTO L_ALTRET2;
      493    28917    4                            TEMP$->KX$VC.RLCID_STRING = SUBSTR ( PRM_USR_DAT.DAT__.ADR$
             28917                                     ->B$STR,
      494    28918    4                               PRM_USR_DAT.DAT__.BYTX, LENGTHC(B$RLCID) );
      495    28919    4                            CALL KXX$INTCNC ( TEMP$->KX$VC, TEMP$->KX$VC.RLCID )ALTRET
             28919                                     (L_ALTRET2);
      496    28920    4                         END;
      497    28921                        %KV$RQSOTP ( RQSOTP = YES );
             28933    4           IF NOT KV$VDI.RQSOTP  THEN DO;
             28934    4              KV$VDI.RQSOTP = '1'B;
             28935    4              CALL KVV$VDI(KV_VDH_EVT_RQSOTP);
             28936    4              END;                         /* END IF                             */
      498    28939    3                CASE ( %KXX_TYP_X29# );
      499    28940    3                   CHRCNT = %KV_VDI.OTPBFR_.BYTX - KX$X29.PRTX;
      500    28941    3                   IF %KV_VDI.OTPBFR_.ADR$ ~= ADDR(NIL) AND
      501    28942    3                      CHRCNT > 0 AND
      502    28943    3                      %KV_VDI.PRTTYP ~= %KV_PRTTYP_ZERO AND
      503    28944    3                      %KV_VDI.PRTTYP ~= %KV_PRTTYP_NONE
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:17   
      504    28945    3                      THEN
      505    28946    4                         DO;
      506    28947    4                            PRTTBL$ = KX_PRT_$ ( %KV_VDI.PRTTYP );
      507    28948    4                            CALL XLATE ( SUBSTR( %KV_VDI.OTPBFR_.ADR$->CHRSTR, KX$X29.
             28948                                     PRTX, CHRCNT ),
      508    28949    4                               PRTTBL, SUBSTR( %KV_VDI.OTPBFR_.ADR$->CHRSTR, KX$X29.
             28949                                        PRTX, CHRCNT ) );
      509    28950    4                         END;
      510    28951    3                   KX$X29.PRTX = %KV_VDI.OTPBFR_.BYTX;
      511    28952    3                   KV@VDH_OTPLCL = KV_VDH_OTPLCL;
      512    28953    3                   KV@VDH_OTPLCL.TRN = '1'B;
      513    28954    3                   KV@VDH_OTPLCL.BFR_.ADR$ = PRM_USR_DAT.DAT__.ADR$;
      514    28955    3                   KV@VDH_OTPLCL.BFR_.BYTX = PRM_USR_DAT.DAT__.BYTX;
      515    28956    3                   KV@VDH_OTPLCL.BFR_.BYTSIZ = PRM_USR_DAT.DAT__.DATBYTSIZ;
      516    28957    3                   %KV_VDI.OTPCHRCNTAFTLF = %KV_VDI.OTPCHRCNTAFTLF+%KV_VDI.TMPOTPCHRCNT
             28957                            ;
      517    28958    3                   KX$X29.OTPCHRCNTUTLHLT = KX$X29.OTPCHRCNTUTLHLT-%KV_VDI.TMPOTPCHRCNT
             28958                            ;
      518    28959    3                   %KV_VDI.TMPOTPCHRCNT = 0;
      519    28960    3                   IF (KV@VDH_OTPLCL.BFR_.BYTSIZ >= KX$X29.OTPCHRCNTUTLHLT)
      520    28961    3                      THEN
      521    28962    4                         DO;
      522    28963
      523    28964        /* The data in this record would require a flow control halt in               */
      524    28965        /* the middle of the record. Do the halt now.                                 */
      525    28966
      526    28967    4                            CALL Y$SNCFLWCTRHLT ;
      527    28968    4                            KX$X29.PRTX4NXTBFR = KV@VDH_OTPLCL.BFR_.BYTSIZ + LENGTHC (
             28968                                     KX$X29_OTPBFR );
      528    28969    4                            IF (KV@VDH_OTPLCL.BFR_.BYTSIZ >= KX$X29.OTPCHRCNTUTLHLT)
      529    28970    4                               THEN
      530    28971    5                                  DO;
      531    28972
      532    28973        /* The data in this record would require a flow control halt in               */
      533    28974        /* the middle of the record. Adjust the counter up to avoid that.             */
      534    28975
      535    28976    5                                     KX$X29.OTPCHRCNTUTLHLT = KV@VDH_OTPLCL.BFR_.BYTSIZ
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:18   
             28976                                              +1;
      536    28977    5                                  END /* IF */;
      537    28978    4                         END /* IF */;
      538    28979    3                      ELSE
      539    28980    3                         KX$X29.PRTX = KX$X29.PRTX + KV@VDH_OTPLCL.BFR_.BYTSIZ;
      540    28981    3                   CALL KVV$VDI(KV@VDH_OTPLCL) ;
      541    28982    3             END; /*  do case ( cnctyp ) */
      542    28983                  %ENABLE;
      543    28986
      544    28987        %EJECT;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:19   
      545    28988        /* KV$USR_FNC_EVT - REPORT EVENT                                              */
      546    28989
      547    28990    2          CASE(%KV_USR_FNC_EVT );
      548    28991
      549    28992        /* BRANCH OUT DEPENDING ON THE EVENT REPORTED                                 */
      550    28993
      551    28994    3             DO CASE( PRM_USR_EVT.ID );
      552    28995
      553    28996    3                CASE(%KV_USR_EVT_ID_DLTOTP );
      554    28997
      555    28998        /* PURGE ALL Q'D OUTPUT TO THE REAL DEVICE                                    */
      556    28999
      557    29000        /*
      558    29001                      Delete output buffers (with pure user data) waiting to
      559    29002                      go out on a virtual circuit. X.29 messages scattered
      560    29003                      in the chain will be relocated to the end of the chain,
      561    29004                      order preserved, and NXTLOD$ will point to the first
      562    29005                      of these X.29 messages.
      563    29006        */
      564    29007                        %DISABLE;
      565    29010    3                   IF CNC_TYP = %KXX_TYP_LINKDEV#
      566    29011    3                      THEN
      567    29012    4                         DO;
      568    29013    5                            DO WHILE ( KX$VC.SND.HED$ ~= ADDR(NIL) );
      569    29014    5                               DAT$ = KX$VC.SND.HED$;
      570    29015    5                               KX$VC.SND.HED$ = KX$VC_OTPBFR.LNK$;
      571    29016    5                               Y@BYTSIZ = KX$VC_OTPBFR.BFRBYTSIZ;
      572    29017    5                               KX$VC.OTPBFRBYTCNT = KX$VC.OTPBFRBYTCNT - Y@BYTSIZ;
      573    29018    5                               KX_STATS_X29.KHSTT.OTPBFRBYTUTL =
      574    29019    5                                  KX_STATS_X29.KHSTT.OTPBFRBYTUTL - Y@BYTSIZ;
      575    29020    5                               CALL KVB$RLS2NSYS ( KX$VC_OTPBFR.RLSWRDSIZ, DAT$ );
      576    29021    5                            END;
      577    29022    4                            KX$VC.SND.TAL$ = ADDR(NIL);
      578    29023    4                            KX$VC.SND.NXTLOD$ = KX$VC.SND.TAL$;
      579    29024    4                            GOTO UNBLK;
      580    29025    4                         END;
      581    29026    3                      ELSE
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:20   
      582    29027    3                         IF CNC_TYP = %KXX_TYP_CNTL#
      583    29028    3                            THEN
      584    29029    3                               GOTO L_ALTRET3;
      585    29030
      586    29031    3                   KX$X29.HLTOTP = '0'B;
      587    29032    3                   KX$X29.HLTOTPNXTBFR = '0'B;
      588    29033    3                   KX$X29.ASNHLTOTP = '0'B;
      589    29034
      590    29035    3                   IF KX$X29.SND.NXTLOD$ = ADDR(NIL)
      591    29036    3                      THEN
      592    29037    3                         GOTO L_ALTRET3;
      593    29038
      594    29039    3                   %KV_VDI.OTPBFR_.BYTSIZ = 0;
      595    29040    3                   %KV_VDI.OTPBFR_.BYTX = LENGTHC ( KX$X29_OTPBFR );
      596    29041    3                   %KV_VDI.OTPBFR_.ADR$ = ADDR(NIL);
      597    29042
      598    29043    3                   DAT$ = KX$X29.SND.HED$;
      599    29044    3                   IF DAT$ ~= KX$X29.SND.NXTLOD$ AND KX$X29_OTPBFR.Q
      600    29045    3                      THEN
      601    29046    4                         DO;
      602    29047    4                            Y@BYTSIZ = Y_POWER_OF_2 ( KX$X29_OTPBFR.BYTSIZLOG2 );
      603    29048    4                            KX$X29.OTPBFRBYTCNT = KX$X29.OTPBFRBYTCNT - Y@BYTSIZ;
      604    29049    4                            DAT$ = KX$X29_OTPBFR.LNK$;
      605    29050    4                            CALL KVB$RLSSYS ( Y@BYTSIZ/2, KX$X29.SND.HED$ );
      606    29051    4                            KX$X29.SND.HED$ = DAT$;
      607    29052    4                            KX_STATS_X29.KHSTT.OTPBFRBYTUTL = KX_STATS_X29.KHSTT.
             29052                                     OTPBFRBYTUTL - Y@BYTSIZ;
      608    29053    4                         END;
      609    29054        /*
      610    29055           Start going through the chain.
      611    29056        */
      612    29057    3                   PRV$ = ADDR(NIL);
      613    29058    4                   DO WHILE ( DAT$ ~= ADDR(NIL) );
      614    29059
      615    29060    4                      IF NOT KX$X29_OTPBFR.Q
      616    29061    4                         THEN
      617    29062    5                            DO;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:21   
      618    29063    5                               IF PRV$ = ADDR(NIL)
      619    29064    5                                  THEN
      620    29065    5                                     KX$X29.SND.HED$ = KX$X29_OTPBFR.LNK$;
      621    29066    5                                  ELSE
      622    29067    5                                     PRV$->KX$X29_OTPBFR.LNK$ = KX$X29_OTPBFR.LNK$;
      623    29068    5                               TEMP$ = KX$X29_OTPBFR.LNK$;
      624    29069    5                               IF KX$X29_OTPBFR.NMBMRK > 0
      625    29070    5                                  THEN
      626    29071    6                                     DO;
      627    29072    6                                        KX$X29_OTPBFR.DLT = '1'B;
      628    29073    6                                        CALL KXX$MRK ( KX$X29_OTPBFR );
      629    29074    6                                     END;
      630    29075    5                               Y@BYTSIZ = Y_POWER_OF_2 ( KX$X29_OTPBFR.BYTSIZLOG2 );
      631    29076    5                               KX$X29.OTPBFRBYTCNT = KX$X29.OTPBFRBYTCNT - Y@BYTSIZ;
      632    29077    5                               CALL KVB$RLSSYS ( Y@BYTSIZ / 2, DAT$ );
      633    29078    5                               DAT$ = TEMP$;
      634    29079    5                               KX_STATS_X29.KHSTT.OTPBFRBYTUTL = KX_STATS_X29.KHSTT.
             29079                                        OTPBFRBYTUTL - Y@BYTSIZ;
      635    29080    5                               PRM_USR_EVT.ACT = '1'B;
      636    29081    5                            END;
      637    29082    4                         ELSE
      638    29083    5                            DO;
      639    29084    5                               PRV$ = DAT$;
      640    29085    5                               DAT$ = KX$X29_OTPBFR.LNK$;
      641    29086    5                            END;
      642    29087    4                   END; /*  DO WHILE ...  */
      643    29088
      644    29089    3                   KX$X29.SND.NXTLOD$ = KX$X29.SND.HED$;
      645    29090    3                   KX$X29.SND.TAL$ = PRV$;
      646    29091    3                   KX$X29.HLTOTP_ALL = KX$X29.HLTOTPNXTBFR_ALL | KX$X29.HLTOTP_ALL;
      647    29092    3                   KX$X29.HLTOTPNXTBFR = '0'B;
      648    29093
      649    29094    3                   IF %KV_VDI.RE_DSPINP
      650    29095    3                      THEN
      651    29096    4                         DO;
      652    29097    4                            CALL KVI$RE_DSPINP;
      653    29098    4                            %KV_VDI.RE_DSPINP = '0'B;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:22   
      654    29099    4                         END;
      655    29100    3   UNBLK:          ;
      656    29101                        %KV$RQSOTP ( RQSOTP = YES );
             29113    4           IF NOT KV$VDI.RQSOTP  THEN DO;
             29114    4              KV$VDI.RQSOTP = '1'B;
             29115    4              CALL KVV$VDI(KV_VDH_EVT_RQSOTP);
             29116    4              END;                         /* END IF                             */
      657    29119    3                   IF %KV_VDI.VDHEVTENB(%KV_VDH_EVT_ID_RLSVDI)
      658    29120    3                      AND KX$X29.SND.HED$ = ADDR(NIL)
      659    29121    3                      THEN
      660    29122    4                         DO;
      661    29123
      662    29124        /* We are to report to VDH quiescence in ASYNC                                */
      663    29125        /* so we can complete the releasing of VDI.                                   */
      664    29126
      665    29127    4                            CALL KVV$VDI(KV_VDH_EVT_RLSVDI) ;
      666    29128    4                         END;
      667    29129    3   L_ALTRET3:
      668    29130                        %ENABLE;
      669    29133    3                   ALTRETURN; /* USR_EVT.ACT is already properly set.    */
      670    29134    3                CASE(%KV_USR_EVT_ID_DSC );
      671    29135    3                   IF CNC_TYP = %KXX_TYP_X29#
      672    29136    3                      THEN
      673    29137    4                         DO;
      674    29138    4                            KX$X29.HLTOTP_ALL = '0'B;
      675    29139    4                            KX$X29.ASNHLTOTP = '0'B;
      676    29140    4                         END;
      677    29141    3                CASE(%KV_USR_EVT_ID_ENDSETPRM );
      678    29142    3                   IF CNC_TYP = %KXX_TYP_X29# AND KX$X29.SNDX3PRM
      679    29143    3                      THEN
      680    29144    4                         DO;
      681    29145                                 %DISABLE;
      682    29148    4                            CALL KXX$SNDX29MSG ( %KX_X29MSGTYP_SETREDX3#, KX$X29 );
      683    29149                                 %ENABLE;
      684    29152    4                            KX$X29.SNDX3PRM = '0'B;
      685    29153    4                            KX$X29.WAT4PRM = KX$X29.WAT4PRM + 1;
      686    29154    4                         END;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:23   
      687    29155    3                CASE(%KV_USR_EVT_ID_GETSTR );
      688    29156
      689    29157        /* VDH is getting a structure that we're interested in.                       */
      690    29158
      691    29159    3                   IF (PRM_USR_EVT.PRM = %KV_STRTYP_MRD)
      692    29160    3                      THEN
      693    29161    4                         DO;
      694    29162
      695    29163        /* VDH is getting a KV$MRD structure.                                         */
      696    29164
      697    29165    4                            %KV_MRD.MINSP_FORPST = KA_MINSP_FORPST(%KV_VDI.LINSPD);
      698    29166    4                            %KV_MRD.CALUSR_ERS = '0'B;
      699    29167    4                            %KV_MRD.CALUSR_PST = '0'B;
      700    29168    4                            %KV_MRD.CALUSR_SETATR = '0'B;
      701    29169    4                            %KV_MRD.CALUSR_OTPRPTCHR = '0'B;
      702    29170    4                            %KV_MRD.ERD$ = ADDR(KV_ERD);
      703    29171    4                         END /* IF */;
      704    29172    3                CASE(%KV_USR_EVT_ID_HLTOTP );
      705    29173
      706    29174        /* A SYNCHRONOUS OUTPUT HALT HAS BEEN REQUESTED                               */
      707    29175
      708    29176    3                   IF CNC_TYP = %KXX_TYP_X29#
      709    29177    3                      THEN
      710    29178    3                         CALL Y$SNCHLTOTP(%KA#HLTOTP_USRX) ;
      711    29179    3                CASE(%KV_USR_EVT_ID_RLSSTR );
      712    29180
      713    29181        /* VDH is releasing a structure that we're interested in.                     */
      714    29182
      715    29183    3                   IF (PRM_USR_EVT.PRM = %KV_STRTYP_VDI)
      716    29184    3                      THEN
      717    29185    4                         DO;
      718    29186                                 %DISABLE;
      719    29189    5                            DO CASE ( CNC_TYP );
      720    29190    5                               CASE ( %KXX_TYP_LINKDEV# );
      721    29191        /* it is a LINKDEV */
      722    29192    5                                  GOTO RLSCTX;
      723    29193    5                               CASE ( %KXX_TYP_CNTL# );
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:24   
      724    29194        /* it is a control connection for a LINKDEV */
      725    29195    5                                  IF KX$LINKDEV.L2$ ~= ADDR(NIL)
      726    29196    5                                     THEN
      727    29197    6                                        DO;
      728    29198    6                                           IF KX$LINKDEV.RECNC
      729    29199    6                                              THEN
      730    29200    7                                                 DO;
      731    29201    7                                                    KX$LINKDEV.VDI$ = ADDR(NIL);
      732    29202    7                                                    KX$LINKDEV.RECNC = '0'B;
      733    29203    7                                                    GOTO INTCNC;
      734    29204    7                                                 END;
      735    29205    6                                           GOTO L_3;
      736    29206    6                                        END;
      737    29207    5                                  CALL KVB$RLSSYS ( SIZEW(KX$LINKDEV), X29$ );
      738    29208
      739    29209
      740    29210        /* KV$MRD is being released. That's our queue to do our final                 */
      741    29211        /* phase of disconnect.                                                       */
      742    29212
      743    29213        /*
      744    29214           If X29 handler state is normal, it is the user typing "OFF"
      745    29215           and the channel table does not say DRPDTR. So we are to
      746    29216           reconnect to VDH. Otherwise, the VC must have already been
      747    29217           cleared, and all we have to do is to release the X.29 context.
      748    29218        */
      749    29219    5                               CASE ( %KXX_TYP_X29# );
      750    29220    5                                  IF KX$X29.STATE ~= %KX_X29_ST_NRM#
      751    29221    6                                     THEN DO;
      752    29222    6                                           IF KX$X29.L3$ ~= ADDR(NIL)
      753    29223    6                                              THEN
      754    29224    6                                                 IF KX$X29.L3$->KX$L3.PVC
      755    29225    6                                                    THEN
      756    29226    7                                                       DO;
      757    29227    7   /* can't release x29 context for PVCs */               KX$X29.STATE = %
             29227            KX_X29_ST_VCUP#;
      758    29228    7                                                          GOTO L_3; /* enable & ret */
      759    29229    7                                                       END;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:25   
      760    29230    6                                                    ELSE
      761    29231    6                                                       KX$X29.L3$->KX$L3.CM$ = ADDR(NIL
             29231                                                                );
      762    29232    6   RLSCTX:                                 CALL KXX$RLSCTX ( KX$X29 );
      763    29233    6                                        END;
      764    29234    5                                     ELSE
      765    29235    6                                        DO;
      766    29236    6   INTCNC:                                 CALL KXX$INTCNC ( KX$X29 );
      767    29237    6                                        END /* IF */;
      768    29238    5                            END; /* do case ( type ) */
      769    29239    4                            GOTO L_3; /* enable & return */
      770    29240    4                         END;
      771    29241    3                CASE(%KV_USR_EVT_ID_RLSVDI );
      772    29242
      773    29243    3                   IF CNC_TYP = %KXX_TYP_CNTL#
      774    29244    3                      THEN
      775    29245    3                         GOTO CLR_VDI$;
      776    29246
      777    29247        /* VDH is ready to enter into the phase of disconnect where                   */
      778    29248        /* this instance of VDI will be released. See if we're ready.                 */
      779    29249
      780    29250    3                   IF CNC_TYP = %KXX_TYP_LINKDEV#
      781    29251    3                      THEN
      782    29252    4                         DO;
      783    29253    4                            IF KX$VC.SND.HED$ ~= ADDR(NIL)
      784    29254    4                               THEN
      785    29255    4                                  ALTRETURN;
      786    29256    4                            IF KX$VC.STATE = %KX_VC_ST_READY#
      787    29257    4                               THEN
      788    29258    5                                  DO;
      789    29259    5                                     IF KX$VC.L3$ ~= ADDR(NIL)
      790    29260    5                                        THEN
      791    29261    6                                           DO;
      792    29262                                                   %DISABLE;
      793    29265    6                                              L3$ = KX$VC.L3$;
      794    29266        /* I have to use an auto copy of L3$ here. */
      795    29267    6                                              CALL KXS$RLSL3 ( L3$ );
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:26   
      796    29268                                                   %ENABLE;
      797    29271    6                                           END;
      798    29272    5                                     KX$VC.STATE = %KX_VC_ST_ENDPHSDSC#;
      799    29273    5                                  END;
      800    29274    4                            IF KX$VC.STATE = %KX_VC_ST_BGNPHSDSC# OR
      801    29275    4                               KX$VC.STATE = %KX_VC_ST_ENDPHSDSC#
      802    29276    4                               THEN
      803    29277    4                                  GOTO CLR_VDI$;
      804    29278    4                               ELSE
      805    29279    5                                  DO;
      806    29280    5                                     KX$VC.STATE = %KX_VC_ST_BGNPHSDSC#;
      807    29281    5                                     GOTO CLR_VC;
      808    29282    5                                  END;
      809    29283    4                         END;
      810    29284    3                   IF (KX$X29.SND.HED$ ~= ADDR(NIL)) AND NOT %KV_VDI.INTPHSDSC
      811    29285    3                      THEN
      812    29286    4                         DO;
      813    29287
      814    29288        /* There are still output buffers Q'd. We aren't ready to                     */
      815    29289        /* disconnect. We'll get this call later, after we say                        */
      816    29290        /* %KV_VDH_EVT_ID_RLSVDI.                                                     */
      817    29291
      818    29292    4                            ALTRETURN;
      819    29293    4                         END;
      820    29294    3                   IF ( ( %KH_CHN.DRPDTR OR %KV_VDI.INTPHSDSC )
      821    29295    3                      AND KX$X29.STATE ~= %KX_X29_ST_ENDPHSDSC# )
      822    29296    3                      THEN
      823    29297    4                         DO;
      824    29298        /*
      825    29299           We are to clear the VC.
      826    29300        */
      827    29301    4                            KX$X29.STATE = %KX_X29_ST_BGNPHSDSC#;
      828    29302    4   CLR_VC:                  ;
      829    29303    4                            IF KX$X29.L3$ ~= ADDR(NIL)
      830    29304    4                               THEN
      831    29305    5                                  DO;
      832    29306                                          %DISABLE;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:27   
      833    29309    5                                     TEMP0 = %KX_P_EV_VCLST# ;
      834    29310    5                                     TEMP1$ = ADDR(NIL);
      835    29311    5                                     CALL Y$CAL_PAC ;
      836    29312                                          %ENABLE;
      837    29315    5                                  END;
      838    29316
      839    29317    4                         END /* IF */;
      840    29318    3   CLR_VDI$:       ;
      841    29319    3                   KX$X29.VDI$ = ADDR(NIL);
      842    29320    3                CASE(%KV_USR_EVT_ID_SCH );
      843    29321
      844    29322        /* VDH is calling us because we interrupted it with an interrupt.             */
      845    29323        /* We'll do the processing now that we would have done earlier.               */
      846    29324
      847    29325    4                   DO CASE( PRM_USR_EVT.PRM );
      848    29326    4                      CASE(%KV_SCHRSN_DFR1 );
      849    29327
      850    29328        /* Deferred input interrupt.                                                  */
      851    29329    4   RED_ENTRY:            ;
      852    29330                              %DISABLE;
      853    29333    4                         IF CNC_TYP~= %KXX_TYP_LINKDEV#
      854    29334    4                            THEN
      855    29335    4                               CALL KXX$DFRINP ( KX$X29 );
      856    29336    4                            ELSE
      857    29337    4                               IF %KV_VDI.USRRQSDAT.RED
      858    29338    4                                  THEN
      859    29339    5                                     DO;
      860    29340    5                                        KX$VC.VDHENTERED = '1'B;
      861    29341    5                                        CALL Y$CHKPNDBITS;
      862    29342    5                                        KX$VC.VDHENTERED = '0'B;
      863    29343    5                                     END;
      864    29344    4   L_3:                  ;
      865    29345                              %ENABLE;
      866    29348    4                         RETURN;
      867    29349    4                      CASE(%KV_SCHRSN_DFR0 );
      868    29350
      869    29351        /* Deferred output interrupt, i.e., L3 called us for more data.               */
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:28   
      870    29352
      871    29353    4                         GOTO SAME_AS_VDHEXT;   /* in case USR_EVT_ID_VDHEXT */
      872    29354
      873    29355    4                      CASE(%KV_SCHRSN_DFR3 );
      874    29356
      875    29357        /* A VCLST was received for the VC while it was busy. */
      876    29358
      877    29359                              %DISABLE;
      878    29362    4                         CALL_FPT = '0'B;
      879    29363    4                         CALL_FPT.CAL$ = KX$VC.L3$;
      880    29364    4                         CALL_FPT.RCV$ = VC$;
      881    29365    4                         CALL_FPT.EVN = %KX_CM_EV_VCLST#;
      882    29366
      883    29367    4                         IF CNC_TYP = %KXX_TYP_LINKDEV#
      884    29368    4                            THEN
      885    29369    5                               DO;
      886    29370    5                                  KX$VC.VDHENTERED = '1'B;
      887    29371    5                                  CALL KXV$VCVDH ( CALL_FPT );
      888    29372    5                                  KX$VC.VDHENTERED = '0'B;
      889    29373    5                                  GOTO L_3;
      890    29374    5                               END;
      891    29375    4                            ELSE
      892    29376    5                               DO;
      893    29377    5                                  KX$X29.VDHEXTCAL = '1'B;
      894    29378    5                                  CALL KXX$X29 ( CALL_FPT );
      895    29379    5                                  KX$X29.VDHEXTCAL = '0'B;
      896    29380    5                                  GOTO L_3;
      897    29381    5                               END;
      898    29382    4                      CASE(%KV_SCHRSN_DFR2);
      899    29383
      900    29384    5                         DO CASE ( CNC_TYP );
      901    29385    5                            CASE ( %KXX_TYP_X29# );
      902    29386        /* A break was deferred. Send it to VDH now. */
      903    29387                                    %DISABLE;
      904    29390    5                               CALL KXX$SNDX29MSG ( %KX_X29MSGTYP_RSMOTP#, KX$X29 );
      905    29391                                    %ENABLE;
      906    29394    5                               KV@VDH_DAT = KV_VDH_DAT;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:29   
      907    29395    5                               KV@VDH_DAT.DAT__.ADR$ = ADDR(KX_BFR_BRK);
      908    29396    5                               KV@VDH_DAT.DAT__.DATBYTSIZ = 2;
      909    29397    5                               KV@VDH_DAT.DAT__.BFRBYTSIZ = 2;
      910    29398    5                               CALL KVV$VDI ( KV@VDH_DAT );
      911    29399    5                            CASE ( %KXX_TYP_CNTL# );
      912    29400    6                               DO TEMP0 = 1 TO KX$LINKDEV.PNDEVTCNT;
      913    29401    6                                  CALL KVV$VDI ( KX_VDH_EVT_ATN );
      914    29402    6                               END;
      915    29403    5                               KX$LINKDEV.PNDEVTCNT = 0;
      916    29404    5                         END; /* do case ( cnc_typ ) */
      917    29405    4                      CASE(ELSE);
      918    29406        /*S* SCREECH_CODE: KXX-S$KX_UNKSCHRSN#
      919    29407             MESSAGE: KXX$VDI called by VDH for an unknown schedule reason.
      920    29408        */
      921    29409    4                         CALL KHD$SCREECH ( Y_UNKSCHRSN );
      922    29410    4                   END /* CASE on schrsn */;
      923    29411    3                CASE(%KV_USR_EVT_ID_TRMUSRRQSDAT );
      924    29412
      925    29413        /* Terminate user request data. VDH is activating the read.                   */
      926    29414        /* Shut off the paper tape reader, if in paper tape mode.                     */
      927    29415
      928    29416    3                   IF %KV_VDI.HALFDUPLEXPAPERTAPE OR %KV_VDI.FULLDUPLEXPAPERTAPE
      929    29417    3                      THEN
      930    29418    4                         DO;
      931    29419
      932    29420        /* WE'RE IN PAPER TAPE MODE. SEND A DC3 (XOFF) CHARACTER TO                   */
      933    29421        /* STOP THE READER.                                                           */
      934    29422
      935    29423    4                            IF %KV_VDI.OTPBFR_.BYTSIZ = 0
      936    29424    4                               THEN
      937    29425    5                                  DO;
      938    29426    5                                     CALL KXX$VDI ( KV_USR_GETOTPBFR )
      939    29427    5                                        WHENALTRETURN
      940    29428    6                                           DO;
      941    29429    6                                              RETURN;
      942    29430    6                                           END;
      943    29431    5                                  END;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:30   
      944    29432    4                            %KV_VDI.OTPBFR_.ADR$->Y$BYT(%KV_VDI.OTPBFR_.BYTX) = %BITBIN
             29432                                     (%ASCIIDC3);
      945    29433    4                            %KV_VDI.OTPBFR_.BYTX = %KV_VDI.OTPBFR_.BYTX + 1;
      946    29434    4                            %KV_VDI.OTPBFR_.BYTSIZ = %KV_VDI.OTPBFR_.BYTSIZ - 1;
      947    29435    4                         END /* IF */;
      948    29436    3                CASE(%KV_USR_EVT_ID_VDHEXT );
      949    29437    3   SAME_AS_VDHEXT:
      950    29438    3                   TEMP0 = %KX_P_EV_DATAVL#;
      951    29439    3                   TEMP1$ = ADDR(NIL);
      952    29440                        %DISABLE;
      953    29443    4                   DO CASE ( CNC_TYP );
      954    29444    4                      CASE ( %KXX_TYP_CNTL# );
      955    29445    4                      CASE ( %KXX_TYP_LINKDEV# );
      956    29446    4                         KX$VC.VDHENTERED = '1'B;
      957    29447    4                         IF KX$VC.STATE <= %KX_VC_ST_NRM# AND KX$VC.SND.NXTLOD$ ~= ADDR
             29447                                  (NIL)
      958    29448    4                            AND KX$VC.L3$ ~= ADDR(NIL)
      959    29449    4                            THEN
      960    29450    4                               CALL Y$CAL_PAC;
      961    29451    4                         CALL Y$CHKPNDBITS;
      962    29452    4                         KX$VC.VDHENTERED = '0'B;
      963    29453    4                      CASE ( %KXX_TYP_X29# );
      964    29454                              %KV$CMPOTP;
             29459    5           IF KV$VDI.OTPCNDPND THEN DO;
             29460    5              CALL KVV$VDI(KV_VDH_EVT_CMPOTP);
             29461    5              END;                         /* END IF                             */
      965    29463    4                         IF NOT KX$X29.HLTOTP AND KX$X29.RPRDAT
      966    29464    4                            AND KX$X29.SND.NXTLOD$ ~= ADDR(NIL)
      967    29465    4                            AND KX$X29.STATE <= %KX_X29_ST_NRM#
      968    29466    4                            AND KX$X29.L3$ ~= ADDR(NIL)
      969    29467    4                            THEN
      970    29468    5                               DO;
      971    29469    5                                  KX$X29.RPRDAT = '0'B;
      972    29470    5                                  KX$X29.VDHEXTCAL = '1'B;
      973    29471    5                                  CALL Y$CAL_PAC ;
      974    29472    5                                  KX$X29.VDHEXTCAL = '0'B;
      975    29473    5                                  KX$X29.RPRDAT = '1'B;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:31   
      976    29474    5                               END;
      977    29475    4                   END;   /* do case ( cnc_typ ) */
      978    29476    3                   GOTO L_3;   /* enable and return; */
      979    29477    3                CASE ( %KV_USR_EVT_ID_INHDLTOTP );
      980    29478
      981    29479    3                   IF %KV_VDI.OTPBFR_.ADR$ ~= ADDR(NIL)
      982    29480    3                      AND %KV_VDI.OTPBFR_.BYTSIZ < PRM_USR_EVT.PRM
      983    29481    3                      AND CNC_TYP = %KXX_TYP_X29#
      984    29482    3                      THEN
      985    29483    3                         CALL KXX$TRNOTP ( %KV_VDI );
      986    29484
      987    29485    3                CASE (%KV_USR_EVT_ID_LGNRJC );
      988    29486        /* We are not able to start this circuit. Better drop it. */
      989    29487    3                   %KV_VDI.INTPHSDSC = '1'B;
      990    29488    3                   IF CNC_TYP ~= %KXX_TYP_CNTL#
      991    29489    3                      THEN
      992    29490    3                         ERCOD = LGNRJC;
      993    29491    3                      ELSE
      994    29492    3                         ERCOD = DEVLGNFAL;
      995    29493    3                   CALL Y$ER;
      996    29494
      997    29495    3                CASE (%KV_USR_EVT_ID_LGNACP );
      998    29496        /*
      999    29497           By this time, NODEADMN has created a channel table for this VC.
     1000    29498           Let's use that instead of the one we build in our buffer pool.
     1001    29499        */
     1002    29500    4                   DO CASE ( CNC_TYP );
     1003    29501    4                      CASE ( %KXX_TYP_CNTL# );
     1004    29502    4                         RETURN;
     1005    29503    4                      CASE ( %KXX_TYP_X29# );
     1006    29504    4                      CASE ( %KXX_TYP_LINKDEV# );
     1007    29505    5                         DO CASE ( KX$VC.STATE );
     1008    29506    5                            CASE ( %KX_VC_ST_RMTDCL# );
     1009    29507    5                               KX$VC.CALINDPND = '1'B;
     1010    29508    5                               IF %KV_VDI.USRRQSDAT.RED
     1011    29509    5                                  THEN
     1012    29510    6                                     DO;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:32   
     1013    29511    6                                        KV@SND_DAT = KX_SND_DAT;
     1014    29512    6                                        KX_VDOVLPARY.VDOVLP.KEY$ = ADDR(KX_KEY_CAL_IND)
             29512                                                 ;
     1015    29513    6                                        KV@SND_DAT.DAT__.ADR$ = KX$VC.CALPKT$;
     1016    29514    6                                        KV@SND_DAT.DAT__.BYTX = 0;
     1017    29515    6                                        KV@SND_DAT.DAT__.DATBYTSIZ = KX$VC.CALMSGBYTSIZ
             29515                                                 ;
     1018    29516    6                                        CALL KVV$VDI ( KV@SND_DAT ) WHENRETURN
     1019    29517    7                                              DO;
     1020    29518    7                                                 CALL KVB$RLSSYS ( (KX$VC.CALMSGBYTSIZ+
             29518                                                          1)/2, KX$VC.CALPKT$ );
     1021    29519    7                                                 KX$VC.CALPKT$ = ADDR(NIL);
     1022    29520    7                                                 KX$VC.CALMSGBYTSIZ = 0;
     1023    29521    7                                                 KX$VC.CALINDPND = '0'B;
     1024    29522    7                                              END;
     1025    29523    6                                     END;
     1026    29524    5                               KX$VC.STATE = %KX_VC_ST_WCA#;
     1027    29525    5                            CASE ( %KX_VC_ST_DCL# );
     1028    29526    5                               KX$VC.STATE = %KX_VC_ST_READY#;
     1029    29527    5                            CASE ( %KX_VC_ST_BGNPHSDSC#, %KX_VC_ST_ENDPHSDSC# );
     1030    29528        /* vc cleared before fully logged on */
     1031    29529    5                               GOTO L_CLEARED;
     1032    29530    5                            CASE ( ELSE );
     1033    29531        /*S* SCREECH_CODE: KXX-S$KX_LINKDEVSTT#
     1034    29532             MESSAGE: Event inconsistent with link device state.
     1035    29533        */
     1036    29534    5                               CALL KHD$SCREECH ( Y_LINKDEVSTT );
     1037    29535    5                         END;  /* do case ( .state ) */
     1038    29536    4                   END; /* do case ( cnc_typ ) */
     1039    29537    3                   IF KX$X29.L3$ ~= ADDR(NIL) AND KX$X29.L3$->KX$L3.RLSCHN
     1040    29538    3                      THEN
     1041    29539    3                         CALL KHA$GET_CTX_PTR ( KX$X29.CHN$->KH$CHN.TERMID, DAT$ )
     1042    29540    3                            WHENRETURN
     1043    29541    4                               DO;
     1044    29542    4                                  KX$X29.CHN$ = DAT$;
     1045    29543    4                                  %KV_VDI.CHN$ = KX$X29.CHN$;
     1046    29544    4                                  TEMP1$ = KX$X29.CHN$;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:33   
     1047    29545    4                                  TEMP0 = %KX_P_EV_UPDCHN#;
     1048    29546                                       %DISABLE;
     1049    29549    4                                  CALL Y$CAL_PAC;
     1050    29550                                       %ENABLE;
     1051    29553    4                               END;
     1052    29554    3                            WHENALTRETURN
     1053    29555    4                               DO;
     1054    29556        /*N* Eh? */
     1055    29557    4                               END;
     1056    29558    3   L_CLEARED:      ;
     1057    29559    3                CASE ( %KV_USR_EVT_ID_OPN );
     1058    29560        /*
     1059    29561           Only control connections get this event.
     1060    29562        */
     1061    29563    3                   KX$LINKDEV.OPNSSN = '1'B;
     1062    29564    3                CASE ( %KV_USR_EVT_ID_CLS );
     1063    29565        /*
     1064    29566           Only control connections get this event.
     1065    29567        */
     1066    29568    3                   KX$LINKDEV.OPNSSN = '0'B;
     1067    29569    3                   KX$LINKDEV.CLSSSN = '1'B;
     1068    29570    3                CASE (ELSE);
     1069    29571
     1070    29572        /*S* SCREECH_CODE: KXX-S$KX_UNKVDIEVT#
     1071    29573             MESSAGE: KXX$VDI called by VDH with an unknown user event.
     1072    29574        */
     1073    29575    3                   CALL KHD$SCREECH ( Y_UNKVDIEVT );
     1074    29576
     1075    29577    3             END; /* DO CASE(...EVT_ID...)  */
     1076    29578
     1077    29579
     1078    29580        %EJECT;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:34   
     1079    29581        /* KV$USR_EXTINPTRN - EXTENDED INPUT TRANSLATION                              */
     1080    29582
     1081    29583    2          CASE(%KV_USR_FNC_EXTINPTRN );
     1082    29584
     1083    29585    3             DO SELECT(ASCBIT(PRM_USR_EXTINPTRN.ORGCHR)
     1084    29586    3                & BINBIT(BITBIN(%KV_TRNTBL.INPCHRMSK),8));
     1085    29587    3                SELECT (%ASCIIDEL,%ASCIINUL);
     1086    29588
     1087    29589        /* THIS IS A DEL OR NUL CHARACTER. IF IN PAPER TAPE MODE AND NOT              */
     1088    29590        /* DOING A TRANSPARENT READ, IGNORE IT.                                       */
     1089    29591
     1090    29592    3                IF NOT KV$PTR.INPCNDPND.TRN
     1091    29593    3                   THEN
     1092    29594    4                      DO;
     1093    29595
     1094    29596        /* WE'RE NOT IN TRANSPARENT MODE.                                             */
     1095    29597
     1096    29598    4                         IF (%KV_VDI.HALFDUPLEXPAPERTAPE OR %KV_VDI.FULLDUPLEXPAPERTAPE
             29598                                  )
     1097    29599    4                            THEN
     1098    29600    5                               DO;
     1099    29601
     1100    29602        /* WE'RE IN A PAPER TAPE MODE. IGNORE THE CHARACTER.                          */
     1101    29603
     1102    29604    5                                  RETURN;
     1103    29605    5                               END /* IF PAPER TAPE MODE */;
     1104    29606    4                      END /* IF TRNASPARENT MODE */;
     1105    29607    3                SELECT(%ASCIICR);
     1106    29608    3                IF (KX$X29.HLTOTP.BITT(%KA#HLTOTP_USRX)
     1107    29609    3                   AND PRM_USR_EXTINPTRN.IMD)
     1108    29610    3                   THEN
     1109    29611    4                      DO;
     1110    29612
     1111    29613        /* THIS IS A CR (CARRIAGE RETURN).                                            */
     1112    29614        /* THERE IS A USER OUTPUT HALT IN EFFECT* OTHERWISE IGNORE THE CR.            */
     1113    29615
     1114    29616
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:35   
     1115    29617    4                         KX$X29.HLTOTP.BITT ( %KA#HLTOTP_USRX ) = '0'B;
     1116    29618    4                         IF NOT KX$X29.HLTOTP
     1117    29619    4                            THEN
     1118    29620    4                               KX$X29.ASNHLTOTP = '0'B;
     1119    29621    4                         GOTO CHECK_RETURN;
     1120    29622    4                      END;
     1121    29623    3                   ELSE
     1122    29624    3                      IF NOT KX$X29.HLTOTP.BITT(%KA#HLTOTP_USRX)
     1123    29625    3                         THEN
     1124    29626    4                            DO;
     1125    29627    4                               IF KX$X29.SND.NXTLOD$ ~= ADDR(NIL) AND
     1126    29628    4                                  KX$X29.SND.NXTLOD$->KX$X29_OTPBFR.HLTOTP.BITT(%
             29628                                           KA#HLTOTP_USRX)
     1127    29629    4                                  THEN
     1128    29630    5                                     DO;
     1129    29631    5                                        KX$X29.SND.NXTLOD$->KX$X29_OTPBFR.HLTOTP.BITT(%
             29631                                                 KA#HLTOTP_USRX) = '0'B;
     1130    29632    5                                        GOTO CHECK_RETURN;
     1131    29633    5                                     END;
     1132    29634    4                                  ELSE
     1133    29635    4                                     IF KX$X29.HLTOTPNXTBFR.BITT(%KA#HLTOTP_USRX)
     1134    29636    4                                        THEN
     1135    29637    5                                           DO;
     1136    29638    5                                              KX$X29.HLTOTPNXTBFR.BITT(%KA#HLTOTP_USRX)
             29638                                                       = '0'B;
     1137    29639    5                                              GOTO CHECK_RETURN;
     1138    29640    5                                           END;
     1139    29641    4                            END;
     1140    29642    3                SELECT(%ASCIIACK);
     1141    29643
     1142    29644        /* THIS IS AN ACK CHARACTER.                                                  */
     1143    29645
     1144    29646    3                IF (%KV_MRD.DVCFLWCTRALG = %G_DVCFLWCTRALG_ENQACK#
     1145    29647    3                   OR %KV_MRD.DVCFLWCTRALG = %G_DVCFLWCTRALG_ETXACK#)
     1146    29648    3                   THEN
     1147    29649    4                      DO;
     1148    29650
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:36   
     1149    29651        /* THIS DEVICE SENDS ACK CHARACTERS TO CONTROL THE                            */
     1150    29652        /* FLOW OF DATA TO IT. RESUME OUTPUT, AND IGNORE THE CHARACTER.               */
     1151    29653
     1152    29654    4                         IF NOT KX$X29.HLTOTP.BITT(%KA#HLTOTP_DVCX)
     1153    29655    4                            THEN
     1154    29656    5                               DO;
     1155    29657
     1156    29658        /* OUTPUT HAS BEEN HALTED, BUT WE DON'T KNOW THAT YET. THE FLOW               */
     1157    29659        /* CONTROL CHARACTER HAS BEEN SENT, BUT WE HAVEN'T PROCESSED THE              */
     1158    29660        /* OUTPUT INTERRRUPT YET THAT MARKS OUTPUT AS BEING HALTED.                   */
     1159    29661        /* WE'VE RECEIVED THE GO-AHEAD CHARACTER (WE GOT IT FAST), SO RESET           */
     1160    29662        /* THE BITS THAT ARE ABOUT TO CAUSE US TO HALT.                               */
     1161    29663
     1162    29664    5                                  IF KX$X29.SND.NXTLOD$ ~= ADDR(NIL) AND
     1163    29665    5                                     KX$X29.SND.NXTLOD$->KX$X29_OTPBFR.HLTOTP.BITT(%
             29665                                              KA#HLTOTP_DVCX)
     1164    29666    5                                     THEN
     1165    29667
     1166    29668        /* THE NEXT BUFFER TO BE IOLD'D IS THE ONE WITH THE HALT BIT.                 */
     1167    29669
     1168    29670    5                                        KX$X29.SND.NXTLOD$->KX$X29_OTPBFR.HLTOTP.BITT(%
             29670                                                 KA#HLTOTP_DVCX) = '0'B;
     1169    29671    5                                     ELSE
     1170    29672    5                                        IF KX$X29.HLTOTPNXTBFR.BITT(%KA#HLTOTP_DVCX)
     1171    29673    5                                           THEN
     1172    29674
     1173    29675        /* THE LAST BUFFER IN THE CHAIN IS THE ONE THAT CONTAINED                     */
     1174    29676        /* THE FLOW CONTROL CHARACTER.                                                */
     1175    29677
     1176    29678    5                                              KX$X29.HLTOTPNXTBFR.BITT(%KA#HLTOTP_DVCX)
             29678                                                       = '0'B;
     1177    29679    5                               END;
     1178    29680    4                            ELSE
     1179    29681
     1180    29682        /* OUR OUTPUT STATUS INDICATES WE KNOW WE'RE HALTED.                          */
     1181    29683        /* RESUME OUTPUT.                                                             */
     1182    29684
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:37   
     1183    29685
     1184    29686    4   L_5:
     1185    29687    5                               DO;
     1186    29688    5                                  KX$X29.HLTOTP.BITT ( %KA#HLTOTP_DVCX ) = '0'B;
     1187    29689    5                                  IF NOT KX$X29.HLTOTP
     1188    29690    5                                     THEN
     1189    29691    5                                        KX$X29.ASNHLTOTP = '0'B;
     1190    29692    5                               END;
     1191    29693    4   CHECK_RETURN:         IF KX$X29.OTPBFRBYTCNT > 0 AND KX$X29.L3$~=ADDR(NIL)
     1192    29694    4                            THEN
     1193    29695    4                               KX$X29.L3$->KX$L3.L2$->KX$L2.FLG.DATAVL = '1'B;
     1194    29696    4                         RETURN;
     1195    29697    4                      END /* IF */;
     1196    29698    3             END; /* SELECT                             */
     1197    29699        /* We dont know about this character, say we didnt do anything. */
     1198    29700
     1199    29701    2             ALTRETURN;
     1200    29702
     1201    29703        %EJECT;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:38   
     1202    29704    2          CASE(%KV_USR_FNC_GETOTPBFR );
     1203    29705
     1204    29706
     1205    29707        /*
     1206    29708           Raise L2's DATAVL bit so that this new output will flow.
     1207    29709        */
     1208    29710    2             IF CNC_TYP ~= %KXX_TYP_X29# OR KX$X29.STATE > %KX_X29_ST_NRM#
     1209    29711    2                OR KX$X29.L3$ = ADDR(NIL)
     1210    29712    2                THEN ALTRETURN;
     1211    29713    2             KX$X29.L3$->KX$L3.L2$->KX$L2.FLG.DATAVL = '1'B;
     1212    29714        /* UPDATE A FEW COUNTERS SPECIFIC TO ASYNC                                    */
     1213    29715
     1214    29716    2             %KV_VDI.OTPCHRCNTAFTLF = %KV_VDI.OTPCHRCNTAFTLF+%KV_VDI.TMPOTPCHRCNT;
     1215    29717    2             IF (KX$X29.OTPBFRBYTCNT > KA_OTPBLKLMT(%KV_VDI.LINSPD)*2
     1216    29718    2                - KA_OTPUN_BLKLMT(%KV_VDI.LINSPD) + 5000)
     1217    29719    2                THEN
     1218    29720    3                   DO;
     1219    29721
     1220    29722        /* The output buffer byte count is getting excessive.                         */
     1221    29723        /* Assume we're out of control, and not allocate any more                     */
     1222    29724        /* space.                                                                     */
     1223    29725
     1224    29726    3                      KA_OTPBFRLMTEXC = KA_OTPBFRLMTEXC+1;
     1225    29727    3                      ALTRETURN;
     1226    29728    3                   END;
     1227    29729    2                ELSE
     1228    29730
     1229    29731        /* We don't have excessive output buffers allocated.                          */
     1230    29732
     1231    29733        /* This GROUP is exited if we satisfy the caller's buffer                     */
     1232    29734        /* requirements without allocating a new buffer.                              */
     1233    29735
     1234    29736        /* CHECK TO SEE IF FLOW CONTROL IS ON                                         */
     1235    29737    3   Y@DOGROUP:      DO;
     1236    29738    3                      IF (KA_DVCFLWCTRCHR(%KV_MRD.DVCFLWCTRALG) ~= 0)
     1237    29739    3                         THEN
     1238    29740    4                            DO;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:39   
     1239    29741
     1240    29742        /* FLOW CONTROL IS ON                                                         */
     1241    29743
     1242    29744    4                               KX$X29.OTPCHRCNTUTLHLT = KX$X29.OTPCHRCNTUTLHLT-%KV_VDI.
             29744                                        TMPOTPCHRCNT;
     1243    29745    4                               IF (KX$X29.OTPCHRCNTUTLHLT <= 0)
     1244    29746    4                                  THEN
     1245    29747    5                                     DO;
     1246    29748
     1247    29749        /* WE SHOULD SEND THE DEVICE FLOW CONTROL SEQUENCE                            */
     1248    29750
     1249    29751    5                                        CALL Y$SNCFLWCTRHLT ;
     1250    29752    5                                     END /* IF */;
     1251    29753
     1252    29754        /* SETUP Y_VDI_LCL.SIGSIZ TO BE THE NUMBER OF CHARS TO NEXT HALT              */
     1253    29755
     1254    29756    4                               Y_VDI_LCL.SIGSIZ = KX$X29.OTPCHRCNTUTLHLT;
     1255    29757
     1256    29758        /* SEE IF WE ACTUALLY NEED ANOTHER BUFFER OR WHETHER THERE IS                 */
     1257    29759
     1258    29760    4                               IF (%KV_VDI.OTPBFR_.ADR$ ~= ADDR(NIL))
     1259    29761    4                                  THEN
     1260    29762    5                                     DO;
     1261    29763
     1262    29764        /* SEE HOW BIG THIS BUFFER ACTUALLY IS                                        */
     1263    29765
     1264    29766    5                                        Y@BYTSIZ =
     1265    29767    5                                           Y_POWER_OF_2(%KV_VDI.OTPBFR_.ADR$->
             29767                                                    KX$X29_OTPBFR.BYTSIZLOG2)
     1266    29768    5                                           -%KV_VDI.OTPBFR_.BYTX
     1267    29769    5                                           -%KV_VDI.OTPBFR_.ADR$->KX$X29_OTPBFR.NMBMRK*
             29769                                                    SIZEC(KV$OTPMRK);
     1268    29770    5                                        IF (Y@BYTSIZ >= 2)
     1269    29771    5                                           THEN
     1270    29772    6                                              DO;
     1271    29773
     1272    29774        /* There are at least two bytes left in the current output buffer.            */
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:40   
     1273    29775        /* Give some of them to the caller, rather than allocating another            */
     1274    29776        /* buffer.                                                                    */
     1275    29777
     1276    29778    6                                                 IF (KX$X29.OTPCHRCNTUTLHLT <= Y@BYTSIZ
             29778                                                          )
     1277    29779    6                                                    THEN
     1278    29780    7                                                       DO;
     1279    29781
     1280    29782        /* We're to halt for flow control before we'd fill the rest of                */
     1281    29783        /* the buffer. Declare the framed portion of the buffer to be the             */
     1282    29784        /* character count until we halt.                                             */
     1283    29785
     1284    29786    7                                                          %KV_VDI.OTPBFR_.BYTSIZ =
             29786                                                                   KX$X29.OTPCHRCNTUTLHLT;
     1285    29787    7                                                       END;
     1286    29788    6                                                    ELSE
     1287    29789    7                                                       DO;
     1288    29790
     1289    29791        /* Give the caller the rest of the buffer.                                    */
     1290    29792
     1291    29793    7                                                          %KV_VDI.OTPBFR_.BYTSIZ =
             29793                                                                   Y@BYTSIZ;
     1292    29794    7                                                       END /* IF */;
     1293    29795    6                                                 EXIT Y@DOGROUP;
             29795                                                    /* LOOK BELOW                         */
     1294    29796    6                                              END /* IF */;
     1295    29797    5                                     END /* IF */;
     1296    29798    4                            END;
     1297    29799    3                         ELSE
     1298    29800    4                            DO;
     1299    29801
     1300    29802        /* THERE IS NO FLOW CONTROL IN EFFECT. SETUP Y_VDI_LCL.SIGSIZ TO NOT 1        */
     1301    29803        /* BE A LIMITING FACTOR                                                       */
     1302    29804
     1303    29805    4                               Y_VDI_LCL.SIGSIZ = %BITBIN('7FFF'X);
     1304    29806    4                            END /* IF */;
     1305    29807
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:41   
     1306    29808        /* WE NEED TO TRUNCATE AND BUILD A NEW OUTPUT BUFFER                          */
     1307    29809
     1308    29810    3                      CALL KXX$TRNOTP ( %KV_VDI );
     1309    29811    3                      IF (PRM_USR_GETOTPBFR.ESTBYTSIZ < Y_VDI_LCL.SIGSIZ)
     1310    29812    3                         THEN
     1311    29813    4                            DO;
     1312    29814
     1313    29815        /* The estimated byte size of the buffer needed is less than                  */
     1314    29816        /* the maximum size otherwise needed. Use the estimated size                  */
     1315    29817        /* in determining what size buffer to get.                                    */
     1316    29818
     1317    29819    4                               Y@BYTSIZ = PRM_USR_GETOTPBFR.ESTBYTSIZ;
     1318    29820    4                            END /* IF */;
     1319    29821
     1320    29822        /* WE NEED TO ALLOCATE A BUFFER AT LEAST Y@BYTSIZ BYTES LONG. SEE WHICH       */
     1321    29823        /* SIZE BUFFER WE SHOULD USE                                                  */
     1322    29824
     1323    29825    3                      Y@BYTSIZ2 = Y@BYTSIZ;
     1324    29826    3                      Y@BYTSIZ = Y@BYTSIZ + LENGTHC(KX$X29_OTPBFR);
     1325    29827    3                      IF (Y@BYTSIZ2 = 1) AND (KX$X29.SND.HED$ = ADDR(NIL))
     1326    29828    3                         THEN
     1327    29829    4                            DO;
     1328    29830
     1329    29831        /* We're being asked to get only one byte of space, and we                    */
     1330    29832        /* currently have no output buffers. Assume this is the                       */
     1331    29833        /* echoplex case, and get a small buffer irregardless of                      */
     1332    29834        /* the status of the previous output buffer used.                             */
     1333    29835
     1334    29836    4                               Y_VDI_LCL.BYTSIZ = KA_OTPBFRBYTSIZ_SML;
     1335    29837    4                               Y_VDI_LCL.BYTSIZLOG2 = KA_OTPBFRBYTSIZ_SMLLOG2;
     1336    29838    4                               KX_STATS_X29.OTPBFRGETCNT_SML = KX_STATS_X29.
             29838                                        OTPBFRGETCNT_SML+1;
     1337    29839    4                            END;
     1338    29840    3                         ELSE
     1339    29841    3                            IF (Y@BYTSIZ <= KA_OTPBFRBYTSIZ_SML) AND NOT KX$X29.
             29841                                     PRVOTPBFRDATEXCSML
     1340    29842    3                               THEN
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:42   
     1341    29843    4                                  DO;
     1342    29844
     1343    29845        /* The amount of buffer space we're being asked to get is less                */
     1344    29846        /* than what fits in a small buffer, and the previous output                  */
     1345    29847        /* buffer's data didn't exceed what fits in a small buffer.                   */
     1346    29848        /* Get a small buffer, on the assumption that what we're being                */
     1347    29849        /* asked to get isn't only a small portion of our total buffer                */
     1348    29850        /* requirements for the next few (hundred) milliseconds.                      */
     1349    29851
     1350    29852    4                                     Y_VDI_LCL.BYTSIZ = KA_OTPBFRBYTSIZ_SML;
     1351    29853    4                                     Y_VDI_LCL.BYTSIZLOG2 = KA_OTPBFRBYTSIZ_SMLLOG2;
     1352    29854    4                                     KX_STATS_X29.OTPBFRGETCNT_SML = KX_STATS_X29.
             29854                                              OTPBFRGETCNT_SML+1;
     1353    29855    4                                  END;
     1354    29856    3                               ELSE
     1355    29857    4                                  DO;
     1356    29858
     1357    29859        /* Get a big output buffer.                                                   */
     1358    29860
     1359    29861    4                                     Y_VDI_LCL.BYTSIZ = KA_OTPBFRBYTSIZ_BIG;
     1360    29862    4                                     Y_VDI_LCL.BYTSIZLOG2 = KA_OTPBFRBYTSIZ_BIGLOG2;
     1361    29863    4                                     KX_STATS_X29.OTPBFRGETCNT_BIG = KX_STATS_X29.
             29863                                              OTPBFRGETCNT_BIG+1;
     1362    29864    4                                  END /* IF */;
     1363    29865    3                      Y@BYTSIZ = Y_VDI_LCL.BYTSIZ - LENGTHC(KX$X29_OTPBFR);
     1364    29866    3                      IF (Y_VDI_LCL.SIGSIZ > Y@BYTSIZ)
     1365    29867    3                         THEN
     1366    29868    4                            DO;
     1367    29869
     1368    29870        /* The data space in the buffer we'd like to have is less than                */
     1369    29871        /* that in the buffer we're getting. Adjust the size we wanted                */
     1370    29872        /* down, so that it is the size we're getting.                                */
     1371    29873
     1372    29874    4                               Y_VDI_LCL.SIGSIZ = Y@BYTSIZ;
     1373    29875    4                            END /* IF */;
     1374    29876
     1375    29877                           %DISABLE;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:43   
     1376    29880
     1377    29881    3                      CALL KVB$GETSYS(Y_VDI_LCL.BYTSIZ/2,%KV_VDI.OTPBFR_.ADR$)
     1378    29882    3                         WHENALTRETURN
     1379    29883    4                            DO;
     1380    29884    4                               IF (Y_VDI_LCL.BYTSIZ <= KA_OTPBFRBYTSIZ_SML)
     1381    29885    4                                  THEN
     1382    29886    5                                     DO;
     1383    29887        /*
     1384    29888           we can't even get a small buffer. Screech
     1385    29889        */
     1386    29890    5                                        KX$X29.PRTX4NXTBFR = 0;
     1387    29891    5                                        CALL KHD$SCREECH ( Y_NO_GET );
     1388    29892    5                                        ALTRETURN;
     1389    29893    5                                     END;
     1390    29894
     1391    29895    4                                  ELSE
     1392    29896    5                                     DO;
     1393    29897        /*
     1394    29898           try to get small buffer before screeching
     1395    29899        */
     1396    29900    5                                        KX_STATS_X29.OTPBFRGETCNT_BIG = KX_STATS_X29.
             29900                                                 OTPBFRGETCNT_BIG - 1;
     1397    29901    5                                        KX_STATS_X29.OTPBFRGETCNT_SML = KX_STATS_X29.
             29901                                                 OTPBFRGETCNT_SML + 1;
     1398    29902    5                                        Y_VDI_LCL.BYTSIZ = KA_OTPBFRBYTSIZ_SML;
     1399    29903    5                                        Y_VDI_LCL.BYTSIZLOG2 = KA_OTPBFRBYTSIZ_SMLLOG2;
     1400    29904    5                                        Y@BYTSIZ = Y_VDI_LCL.BYTSIZ - LENGTHC(
             29904                                                 KX$X29_OTPBFR);
     1401    29905    5                                        IF (Y_VDI_LCL.SIGSIZ > Y@BYTSIZ)
     1402    29906    5                                           THEN
     1403    29907    6                                              DO;
     1404    29908    6                                                 Y_VDI_LCL.SIGSIZ = Y@BYTSIZ;
     1405    29909    6                                              END;
     1406    29910    5                                        CALL KVB$GETSYS(Y_VDI_LCL.BYTSIZ/2,%KV_VDI.
             29910                                                 OTPBFR_.ADR$)
     1407    29911    5                                           WHENALTRETURN
     1408    29912    6                                              DO;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:44   
     1409    29913    6                                                 KX$X29.PRTX4NXTBFR = 0;
     1410    29914    6                                                 CALL KHD$SCREECH ( Y_NO_GET );
     1411    29915    6                                                 ALTRETURN;
     1412    29916    6                                              END;
     1413    29917    5                                     END;
     1414    29918    4                            END; /* WHENALTRETURN                      */
     1415    29919
     1416    29920    3                      IF KX$X29.PRTX4NXTBFR ~= 0
     1417    29921    3                         THEN
     1418    29922    4                            DO;
     1419    29923    4                               KX$X29.PRTX = KX$X29.PRTX4NXTBFR;
     1420    29924    4                               KX$X29.PRTX4NXTBFR = 0;
     1421    29925    4                            END;
     1422    29926    3                         ELSE
     1423    29927    3                            KX$X29.PRTX = LENGTHC ( KX$X29_OTPBFR );
     1424    29928    3                      KX_STATS_X29.KHSTT.OTPBFRBYTUTL = KX_STATS_X29.KHSTT.OTPBFRBYTUTL
             29928                               +Y_VDI_LCL.BYTSIZ;
     1425    29929    3                      %KV_VDI.OTPBFR_.BYTX = LENGTHC(KX$X29_OTPBFR);
     1426    29930    3                      %KV_VDI.OTPBFR_.BYTSIZ = Y_VDI_LCL.SIGSIZ;
     1427    29931
     1428    29932        /* SETUP THE BUFFER HEADER                                                    */
     1429    29933
     1430    29934    3                      %KV_VDI.OTPBFR_.ADR$->KX$X29_OTPBFR = '0'B;
     1431    29935    3                      %KV_VDI.OTPBFR_.ADR$->KX$X29_OTPBFR.BYTSIZLOG2 = Y_VDI_LCL.
             29935                               BYTSIZLOG2;
     1432    29936
     1433    29937
     1434    29938    3                      KX$X29.OTPBFRBYTCNT = KX$X29.OTPBFRBYTCNT+Y_VDI_LCL.BYTSIZ;
     1435    29939    3                      IF (KX$X29.OTPBFRBYTCNT >= KA_OTPBLKLMT(%KV_VDI.LINSPD))
     1436    29940    3                         THEN
     1437    29941    4                            DO;
     1438    29942
     1439    29943        /* The output buffer byte count is greater than the block limit.              */
     1440    29944        /* Wind down the flow of output.                                              */
     1441    29945
     1442    29946                                    %KV$RQSOTP (RQSOTP=NO);
             29952    5           IF KV$VDI.RQSOTP THEN DO;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:45   
             29953    5              KV$VDI.RQSOTP = '0'B;
             29954    5              IF KV$VDI.SSNCNT>1
             29955    5              THEN CALL KVV$VDI (KV_VDH_EVT_RQSOTP);
             29956    5              END;
     1443    29964    4                            END /* IF */;
     1444    29965
     1445    29966        /* UPDATE THE OUTPUT BUFFER CHAIN                                             */
     1446    29967
     1447    29968    3                      IF (KX$X29.SND.TAL$ = ADDR(NIL))
     1448    29969    3                         THEN
     1449    29970    4                            DO;
     1450    29971
     1451    29972        /* THERE IS NO CHAIN                                                          */
     1452    29973
     1453    29974    4                               KX$X29.SND.HED$ = %KV_VDI.OTPBFR_.ADR$;
     1454    29975    4                               KX$X29.SND.NXTLOD$ = %KV_VDI.OTPBFR_.ADR$;
     1455    29976
     1456    29977        /* OTHERWISE, A CHAIN EXISTS. ADD THIS BUFFER TO THE TAIL                     */
     1457    29978
     1458    29979    4                            END;
     1459    29980    3                         ELSE
     1460    29981    4                            DO;
     1461    29982    4                               %KV_VDI.OTPBFR_.ADR$->KX$X29_OTPBFR.HLTOTP_ALL = KX$X29.
             29982                                        HLTOTPNXTBFR_ALL;
     1462    29983    4                               KX$X29.HLTOTPNXTBFR = '0'B;
     1463    29984    4                               KX$X29.SND.TAL$->KX$X29_OTPBFR.LNK$ = %KV_VDI.OTPBFR_.
             29984                                        ADR$;
     1464    29985    4                               IF (KX$X29.SND.NXTLOD$ = ADDR(NIL))
     1465    29986    4                                  THEN
     1466    29987    5                                     DO;
     1467    29988
     1468    29989        /* INIT THE IOLD BUFFER                                                       */
     1469    29990
     1470    29991    5                                        KX$X29.SND.NXTLOD$ = %KV_VDI.OTPBFR_.ADR$;
     1471    29992    5                                     END /* IF */;
     1472    29993    4                            END /* IF */;
     1473    29994
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:46   
     1474    29995        /* SETUP THE TAIL POINTER.                                                    */
     1475    29996
     1476    29997    3                      KX$X29.SND.TAL$ = %KV_VDI.OTPBFR_.ADR$;
     1477    29998
     1478    29999
     1479    30000        /* Go back to the level we were at */
     1480    30001
     1481    30002                           %ENABLE;
     1482    30005    3                   END Y@DOGROUP;
     1483    30006        /* CLEAR THE HANDLER SPECIFIC BYTE COUNT                                      */
     1484    30007
     1485    30008    2             %KV_VDI.TMPOTPCHRCNT = 0;
     1486    30009
     1487    30010        %EJECT;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:47   
     1488    30011        /* KV$USR_GETPRM - GET PARAMETER REQUEST                                      */
     1489    30012
     1490    30013    2          CASE(%KV_USR_FNC_GETPRM );
     1491    30014
     1492    30015        /* We don't do any GETPRMs, but we get asked about some things                */
     1493    30016        /* we don't know about. Just doing nothing is ok.                             */
     1494    30017
     1495    30018
     1496    30019        %EJECT;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:48   
     1497    30020        /* KV$USR_INPPRC - INPUT PROCEDURE                                            */
     1498    30021
     1499    30022    2          CASE(%KV_USR_FNC_INPPRC );
     1500    30023    2             IF CNC_TYP ~= %KXX_TYP_X29# THEN GOTO DIE;
     1501    30024    3             DO CASE( PRM_USR_INPPRC.ID );
     1502    30025    3                CASE( %KA#INPPRC_PRTERR );
     1503    30026
     1504    30027    3                   ERCOD = LINERRDSC;   /* prepare to call Y$ER  */
     1505    30028        /* THIS IS A CLA OVER-RUN OR PARITY ERROR.                                    */
     1506    30029
     1507    30030    3                   IF (KA_LINERRDSCLMT ~= BITBIN('FF'X))
     1508    30031    3                      THEN
     1509    30032    4                         DO;
     1510    30033
     1511    30034        /* The line error disconnect limit indicates we should monitor                */
     1512    30035        /* line errors for disconnect purposes.                                       */
     1513    30036
     1514    30037    4                            IF (KX$X29.LINERRDSCCNT >= KA_LINERRDSCLMT)
     1515    30038    4                               THEN
     1516    30039    5                                  DO;
     1517    30040
     1518    30041        /* The line error count exceeds the limit. Disconnect, error-log,             */
     1519    30042        /* and possibly disable the line.                                             */
     1520    30043
     1521    30044    5                                     CALL Y$ER ;
     1522    30045
     1523    30046
     1524    30047    5                                     %KV_VDI.INTPHSDSC = '1'B;
     1525    30048    5                                     KV@VDH_DSC = KXX_VDH_DSC;
     1526    30049    5                                     KV@VDH_DSC.RSN = %KV_DSCRSN_HRDERR;
     1527    30050    5                                     CALL KVV$VDI(KV@VDH_DSC) ;
     1528    30051    5                                  END;
     1529    30052    4                               ELSE
     1530    30053    5                                  DO;
     1531    30054
     1532    30055        /* The line error count doesn't exceed the limit.                             */
     1533    30056
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:49   
     1534    30057    5                                     KV@VDH_SETCLK = KV_VDH_SETCLK;
     1535    30058    5                                     KV@VDH_SETCLK.UNT = %KV_CLKUNT_MNT;
     1536    30059    5                                     KV@VDH_SETCLK.PRD = 1;
     1537    30060    5                                     KV@VDH_SETCLK.CLKNMB = %KV_CLKNMB_USRCLK1;
     1538    30061    5                                     CALL KVV$VDI(KV@VDH_SETCLK) ;
     1539    30062    5                                  END /* IF */;
     1540    30063    4                         END /* IF */;
     1541    30064    3                   KX$X29.LINERRDSCCNT = KX$X29.LINERRDSCCNT+1;
     1542    30065    3                   IF (KA_LINERRLOGLMT ~= BITBIN('FF'X))
     1543    30066    3                      THEN
     1544    30067    4                         DO;
     1545    30068
     1546    30069        /* The line error log limit indicates we should monitor                       */
     1547    30070        /* line errors for log purposes.                                              */
     1548    30071
     1549    30072    4                            IF (KX$X29.LINERRLOGCNT >= KA_LINERRLOGLMT)
     1550    30073    4                               THEN
     1551    30074    5                                  DO;
     1552    30075
     1553    30076        /* The line error count exceeds the limit. Log the error.                     */
     1554    30077
     1555    30078    5                                     CALL Y$ER ;
     1556    30079
     1557    30080
     1558    30081    5                                     KX$X29.LINERRLOGCNT = 0;
     1559    30082    5                                  END;
     1560    30083    4                               ELSE
     1561    30084    5                                  DO;
     1562    30085
     1563    30086        /* The line error count doesn't exceed the limit.                             */
     1564    30087
     1565    30088    5                                     KX$X29.LINERRLOGCNT = KX$X29.LINERRLOGCNT+1;
     1566    30089    5                                  END /* IF */;
     1567    30090    4                         END /* IF */;
     1568    30091    3                CASE(%KA#INPPRC_DVCOTPBFRCLR );
     1569    30092
     1570    30093        /* THE DEVICE'S OUTPUT BUFFER HAS BEEN CLEARED.                               */
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:50   
     1571    30094        /* RESET THE OUTPUT CHARACTER COUNT UNTIL HALT BACK TO                        */
     1572    30095        /* THE DEVICE'S OUTPUT BUFFER SIZE, SINCE THE BUFFER                          */
     1573    30096        /* IS NOW EMPTY. THIS IS TO AVOID SENDING THE SYNCHRONOUS                     */
     1574    30097        /* FLOW CONTROL CHARACTER (E.G., ETX) WHILE THE DEVICE IS                     */
     1575    30098        /* THROWING AWAY CHARACTERS. IF WE DO, THE LINE GOES DEAD.                    */
     1576    30099
     1577    30100    3                   KX$X29.OTPCHRCNTUTLHLT = %KV_ERD.DVCOTPBFRSIZ;
     1578    30101    3                CASE(%KA#INPPRC_HLTOTP );
     1579    30102
     1580    30103        /* THIS IS AN OUTPUT HALT REQUEST.                                            */
     1581    30104
     1582    30105
     1583    30106
     1584    30107    3                   IF %KV_VDI.PHSDSC OR %KV_SSN.LGCDSC OR
     1585    30108    3                      ( %KV_SSN.USRHLTINH )
     1586    30109    3                      THEN
     1587    30110    3                         GOTO L_2 ;
     1588    30111
     1589    30112    3                   Y@HLTOTP_ALL = KX$X29.HLTOTP_ALL;
     1590    30113    3                   KX$X29.HLTOTP.BITT ( %KA#HLTOTP_USRX ) = '1'B;
     1591    30114    3                   IF NOT Y@HLTOTP_ALL AND KX$X29.SND.TAL$ ~= ADDR(NIL)
     1592    30115    3                      THEN
     1593    30116    3                         KX$X29.ASNHLTOTP = '1'B;
     1594    30117    3   L_2:            ;
     1595    30118
     1596    30119    3                CASE(%KA#INPPRC_SETTRNTBL );
     1597    30120
     1598    30121        /* THIS IS A TOGGLE ASCII-APL REQUEST.                                        */
     1599    30122
     1600    30123    3                   Y@INDEX = 0;
     1601    30124    3   Y@LOOP2:
     1602    30125    4                   DO WHILE ('1'B); /* LOOP START                         */
     1603    30126
     1604    30127        /* THIS LOOP IS TRAVERSED FOR EACH CHARACTER IN THE KA_TRNTBLCHNCHR_...       */
     1605    30128        /* TABLE EXAMINED.                                                            */
     1606    30129
     1607    30130    4                      IF (PRM_USR_INPPRC.CHR = KA_TRNTBLCHNCHR$(%KV_TRNTBL.FNTCLS)->
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:51   
             30130                               KA$TRNTBLCHNCHR(Y@INDEX))
     1608    30131
     1609    30132    4                         THEN
     1610    30133    5                            DO;
     1611    30134
     1612    30135        /* WE'VE FOUND THE TRANSLATED '$'. SET THE NEW TRANSLATE TABLE POINTER        */
     1613    30136        /* TO THE TRANSLATE TABLE INDICATED BY THE '$' VALUE.                         */
     1614    30137
     1615    30138    5                               IF %KV_MVD.APLLCNRM
     1616    30139    5                                  THEN
     1617    30140    6                                     DO;
     1618    30141
     1619    30142        /* IF WE ARE GOING TO AN APL TRANSLATE TABLE, GO TO THE PARTIAL (PRINT 'LOWERC*/
     1620    30143        /* CHARACTERS AS UPPERCASE) VERSION.                                          */
     1621    30144
     1622    30145    6                                        %KV_MVD.TRNTBL$ = KA_TRNTBL_PRT$(Y@INDEX);
     1623    30146    6                                     END;
     1624    30147    5                                  ELSE
     1625    30148    6                                     DO;
     1626    30149
     1627    30150        /* IF WE ARE GOING TO AN APL TRANSLATE TABLE, GO TO THE FULL (UNDERSCORED     */
     1628    30151        /* 'LOWERCASE' CHARACTERS) VERSION.                                           */
     1629    30152
     1630    30153    6                                        %KV_MVD.TRNTBL$ = KA_TRNTBL_FUL$(Y@INDEX);
     1631    30154    6                                     END /* IF */;
     1632    30155    5                               EXIT Y@LOOP2; /* LOOK BELOW                         */
     1633    30156    5                            END /* IF */;
     1634    30157    4                      IF (Y@INDEX >= %KV_FNTCLS_HI)
     1635    30158    4                         THEN
     1636    30159    4                            EXIT Y@LOOP2;
     1637    30160
     1638    30161        /* EITHER THERE IS AN ERROR IN ONE OF THE TABLES THAT GETS US                 */
     1639    30162        /* HERE, OR THIS IS AN ILLEGAL ESCAPE SEQUENCE.                               */
     1640    30163
     1641    30164    4                      Y@INDEX = Y@INDEX+1;
     1642    30165    4                   END Y@LOOP2;
     1643    30166    3                CASE(ELSE);
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:52   
     1644    30167
     1645    30168        /*S* SCREECH_CODE: KXX-S$KX_UNKINPPRC#
     1646    30169             MESSAGE: KXX$VDI called by VDH with unknown INPPRC.
     1647    30170        */
     1648    30171
     1649    30172    3                   CALL KHD$SCREECH ( Y_UNKINPPRC );
     1650    30173    3             END /* CASE */;
     1651    30174
     1652    30175        /* KV$USR_OTPMRK - OUTPUT MARKER REQUEST                                      */
     1653    30176
     1654    30177    2          CASE(%KV_USR_FNC_OTPMRK );
     1655    30178
     1656    30179
     1657    30180        /* If there is no output buffer at all, send the marker right back            */
     1658    30181
     1659    30182    2             IF (KX$X29.OTPBFRBYTCNT = 0 OR CNC_TYP ~= %KXX_TYP_X29#)
     1660    30183    2                THEN
     1661    30184    3                   DO;
     1662    30185    3                      KV@VDH_OTPMRK = KV_VDH_OTPMRK;
     1663    30186    3                      KV@VDH_OTPMRK.DAT = PRM_USR_OTPMRK.DAT;
     1664    30187    3                      CALL KVV$VDI(KV@VDH_OTPMRK) ;
     1665    30188    3                   END;
     1666    30189    2                ELSE
     1667    30190    3                   DO;
     1668    30191        %EJECT;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:53   
     1669    30192        /*
     1670    30193           A picture is needed to explain the following code about where to put
     1671    30194           the marker and how to update KV$VDI.OTPBFR_.BYTSIZ :
     1672    30195
     1673    30196                                   .__________________.
     1674    30197                      DAT$ ------->|       H D R      |
     1675    30198                                   |__________________|
     1676    30199                                   |                  |
     1677    30200                                   |       O T P      |
     1678    30201                                   |       C H R      |
     1679    30202                                   |__________________|
     1680    30203         KV$VDI.OTPBFR_.BYTX ---A->|                  |  A
     1681    30204                                |  |                  |  |
     1682    30205                                |  |                  | KV$VDI.OTPBFR_.BYTSIZ
     1683    30206                                |  |                  |  |
     1684    30207                      Spare space  |__________________|  V
     1685    30208                                |  /  /  /  /  /  /  /|
     1686    30209                                |  | /  /  /  /  /  / |
     1687    30210                                |  |/  /  /  /  /  /  /
     1688    30211                                   |__/__/__/__/__/__/|
     1689    30212                   Y@INDEX -----V->|   NEW MARKER     |
     1690    30213                                   |__________________|
     1691    30214                                   |                  |
     1692    30215                                   |       M R K      |
     1693    30216                                   |__________________|
     1694    30217
     1695    30218        */
     1696    30219
     1697    30220    3                      DAT$ = %KV_VDI.OTPBFR_.ADR$;
     1698    30221    3                      IF (DAT$ ~= ADDR(NIL))
     1699    30222    3                         THEN
     1700    30223    4                            DO;
     1701    30224    4                               Y@INDEX = Y_POWER_OF_2(KX$X29_OTPBFR.BYTSIZLOG2)
     1702    30225    4                                  - (KX$X29_OTPBFR.NMBMRK+1)*SIZEC(KV$OTPMRK);
     1703    30226    4                               IF (Y@INDEX <= %KV_VDI.OTPBFR_.BYTX)
     1704    30227    4                                  THEN
     1705    30228    5                                     DO;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:54   
     1706    30229    5                                        CALL KXX$TRNOTP ( %KV_VDI );
     1707    30230    5                                        KX$X29.PRVOTPBFRDATEXCSML = '1'B;
     1708    30231    5                                     END;
     1709    30232    4                            END;
     1710    30233    3                      IF %KV_VDI.OTPBFR_.ADR$ = ADDR(NIL)
     1711    30234    3                         THEN
     1712    30235    4                            DO;
     1713    30236        /*
     1714    30237           Either we have just truncated the last buffer in the chain,
     1715    30238           or there is not enough room in the current buffer for the marker.
     1716    30239           Request another output buffer and place the marker there.
     1717    30240        */
     1718    30241    4                               KV_USR_GETOTPBFR.ESTBYTSIZ = 2;
             30241                                        /* anything > 1 will do           */
     1719    30242    4                               CALL KXX$VDI(KV_USR_GETOTPBFR)
     1720    30243    4                                  WHENALTRETURN
     1721    30244    5                                     DO;
     1722    30245    5                                        ALTRETURN;
     1723    30246    5                                     END;
     1724    30247
     1725    30248        /* Put the marker at the bottom of this newly obtained buffer */
     1726    30249
     1727    30250    4                               DAT$ = %KV_VDI.OTPBFR_.ADR$;
     1728    30251    4                               Y@INDEX = Y_POWER_OF_2(KX$X29_OTPBFR.BYTSIZLOG2)
     1729    30252    4                                  - SIZEC(KV$OTPMRK);
     1730    30253    4                            END;
     1731    30254
     1732    30255    3                      PINCRC(DAT$,Y@INDEX)->KV$OTPMRK = PRM_USR_OTPMRK.DAT;
     1733    30256    3                      KX$X29_OTPBFR.NMBMRK = KX$X29_OTPBFR.NMBMRK + 1;
     1734    30257    3                      IF %KV_VDI.OTPBFR_.BYTSIZ > Y@INDEX-%KV_VDI.OTPBFR_.BYTX
     1735    30258    3                         THEN
     1736    30259    3                            %KV_VDI.OTPBFR_.BYTSIZ = Y@INDEX-%KV_VDI.OTPBFR_.BYTX;
     1737    30260    3                   END;
     1738    30261    2             IF PRM_USR_OTPMRK.CMPOTP
     1739    30262    2                THEN
     1740    30263                        %KV$CMPOTP;
             30268    3           IF KV$VDI.OTPCNDPND THEN DO;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:55   
             30269    3              CALL KVV$VDI(KV_VDH_EVT_CMPOTP);
             30270    3              END;                         /* END IF                             */
     1741    30272
     1742    30273        /* KV$USR_RQSDAT - REQUEST DATA                                               */
     1743    30274
     1744    30275    2          CASE(%KV_USR_FNC_RQSDAT );
     1745    30276    2             IF CNC_TYP = %KXX_TYP_LINKDEV#
     1746    30277    2                THEN
     1747    30278    3                   DO;
     1748    30279    3                      IF KX$VC.ERCOD.ERR# ~= 0
     1749    30280    3                         THEN
     1750    30281    4                            DO;
     1751    30282    4                               VDOVLP_ERR = KX_VDOVLP_ERR;
     1752    30283    4                               VDOVLP_ERR.ERRCODE = KX$VC.ERCOD;
     1753    30284    4                               KV@SND_DAT = KX_SND_DAT;
     1754    30285    4                               KX_VDOVLPARY.VDOVLP.ERR$ = ADDR(VDOVLP_ERR);
     1755    30286    4                               KX_VDOVLPARY.VDOVLP.KEY$ = ADDR(NIL);
     1756    30287    4                               CALL KVV$VDI ( KV@SND_DAT );
     1757    30288    4                               KX_VDOVLPARY.VDOVLP.ERR$ = ADDR(NIL);
     1758    30289    4                               KX$VC.ERCOD.ERR# = 0;
     1759    30290    4                               RETURN;
     1760    30291    4                            END;
     1761    30292    3                         ELSE
     1762    30293    3                            GOTO RED_ENTRY;
     1763    30294    3                   END;
     1764    30295        /* KV$USR_SETPRM - SET PARAM PROCESSING                                       */
     1765    30296
     1766    30297    2          CASE(%KV_USR_FNC_SETPRM );
     1767    30298
     1768    30299        /* DETERMINE WHICH PARAMETER WE WERE INVOKED TO SET                           */
     1769    30300
     1770    30301    2             IF CNC_TYP ~= %KXX_TYP_X29# THEN RETURN;
     1771    30302    3             DO SELECT(PRM_USR_SETPRM.PRMID);
     1772    30303    3                SELECT(%KV_PRMID_CTRCHR, %KV_PRMID_DVCFLWCTRALG);
     1773    30304
     1774    30305        /* Handle miscellaneous parameters that influence other parameters.           */
     1775    30306        /*
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:56   
     1776    30307           If there is a change in whether the device is using DC1/DC3
     1777    30308           flow control, send the X.29 message to change X.3 param 12
     1778    30309           only when the user is turning on DC1DC3.
     1779    30310        */
     1780    30311    3                IF %KV_MRD.DVCFLWCTRALG = %G_DVCFLWCTRALG_DC1DC3#
     1781    30312    3                   THEN
     1782    30313    4                      DO;
     1783    30314    4                         FLWCTRPAD = 1;
     1784    30315    4                         IF KX$X29.X3PRM ( %KX_X3PRMX_FLWCTRPAD# ) = 0
     1785    30316    4                            THEN
     1786    30317    4                               KX$X29.SNDX3PRM = '1'B;
     1787    30318    4                      END;
     1788    30319    3                   ELSE
     1789    30320    3                      FLWCTRPAD = 0;
     1790    30321    3                KX$X29.X3PRM ( %KX_X3PRMX_FLWCTRPAD# ) = FLWCTRPAD;
     1791    30322
     1792    30323    3                IF (KA_DVCFLWCTRCHR(%KV_MRD.DVCFLWCTRALG) ~= 0) AND
     1793    30324    3                   (%KV_ERD.DVCOTPBFRSIZ > 10)
     1794    30325    3                   THEN
     1795    30326    4                      DO;
     1796    30327
     1797    30328        /* There is a synchronous flow control algorithm in effect.                   */
     1798    30329        /* Ask for control when getting transparent writes so we can                  */
     1799    30330        /* do flow control at the beginning of the record (rather than                */
     1800    30331        /* in the middle, which causes bad problems occasionally).                    */
     1801    30332
     1802    30333    4                         %KV_VDI.USEOTPBFRTRN = '0'B;
     1803    30334    4                         %KV_VDI.USEOTPBFRBNR = '0'B;
     1804    30335    4                      END;
     1805    30336    3                   ELSE
     1806    30337    4                      DO;
     1807    30338
     1808    30339        /* No synchronous flow control. Let VDH do the buffering directly.            */
     1809    30340
     1810    30341    4                         %KV_VDI.USEOTPBFRTRN = '1'B;
     1811    30342    4                         %KV_VDI.USEOTPBFRBNR = '1'B;
     1812    30343    4                      END /* IF */;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:57   
     1813    30344    3                SELECT ( %KV_PRMID_LOCALECHO, %KV_PRMID_DISPINPUT );
     1814    30345        /*
     1815    30346           We probably have to change the X.3 param for PAD echo.
     1816    30347        */
     1817    30348    3                IF ( %KV_MRD.LOCALECHO AND %KV_MVD.DISPINPUT )
     1818    30349    3                   THEN
     1819    30350    3                      PADECHO = 1;
     1820    30351    3                   ELSE
     1821    30352    3                      PADECHO = 0;
     1822    30353    3                IF ( PADECHO ~= KX$X29.X3PRM ( %KX_X3PRMX_PADECH# ) )
     1823    30354    3                   THEN
     1824    30355    4                      DO;
     1825    30356    4                         KX$X29.SNDX3PRM = '1'B;
     1826    30357    4                         KX$X29.X3PRM ( %KX_X3PRMX_PADECH# ) = PADECHO;
     1827    30358    4                      END;
     1828    30359    3                SELECT(%KV_PRMID_HALFDUPLEXPAPERTAPE,%KV_PRMID_FULLDUPLEXPAPERTAPE);
     1829    30360
     1830    30361        /* If either half or full duplex paper tape is set, we need to                */
     1831    30362        /* be called when VDH no longer wants data so we can turn off the             */
     1832    30363        /* paper tape reader.                                                         */
     1833    30364
     1834    30365    3                %KV_VDI.USREVTENB(%KV_USR_EVT_ID_TRMUSRRQSDAT) =
     1835    30366    3                   %KV_VDI.HALFDUPLEXPAPERTAPE|%KV_VDI.FULLDUPLEXPAPERTAPE;
     1836    30367    3                SELECT(ELSE);
     1837    30368
     1838    30369        /* WE GOT A PRMID WE DIDNT UNDERSTAND                                         */
     1839    30370
     1840    30371        /*S* SCREECH_CODE: KXX-S$KX_UNKPRMID#
     1841    30372             MESSAGE: KXX$VDI called by VDH with unknown PRMID.   */
     1842    30373    3             CALL KHD$SCREECH ( Y_UNKPRMID );
     1843    30374    3             END; /* DO SELECT                          */
     1844    30375
     1845    30376    2          CASE(ELSE);
     1846    30377
     1847    30378        /* WE GOT A FUNCTION CODE WE DIDNT UNDERSTAND                                 */
     1848    30379
     1849    30380        /*S* SCREECH_CODE: KXX-S$KX_UNKUSRFNC#                                        */
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:58   
     1850    30381        /*S* MESSAGE: KXX$VDI called by VDH with unknown user function code.          */
     1851    30382    2   DIE:      CALL KHD$SCREECH ( Y_UNKUSRFNC );
     1852    30383    2       END /* CASE */;
     1853    30384    1       RETURN;
     1854    30385        %EJECT;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:59   
     1855    30386    1   Y$SNCFLWCTRHLT: PROC ( PARM );
     1856    30387
     1857    30388    2   DCL PARM UBIN;
     1858    30389    2   DCL PARM1 UBIN;
     1859    30390
     1860    30391    2       %KV_VDI.TMPOTPCHRCNT = 1; /* (counting this one)                */
     1861    30392    2       IF (%KV_ERD.DVCOTPBFRSIZ >= 10)
     1862    30393    2          THEN
     1863    30394    3             DO;
     1864    30395
     1865    30396        /* THE OUTPUT BUFFER IN THE DEVICE IS REASONABLY LARGE.                       */
     1866    30397        /* DO FLOW CONTROL FOR THE DEVICE.                                            */
     1867    30398
     1868    30399    3                KX$X29.OTPCHRCNTUTLHLT = %KV_ERD.DVCOTPBFRSIZ;
     1869    30400    3                IF %KV_VDI.OTPBFR_.BYTSIZ = 0
     1870    30401    3                   THEN
     1871    30402    4                      DO;
     1872    30403    4                         CALL KXX$VDI (KV_USR_GETOTPBFR)
     1873    30404    4                            WHENALTRETURN
     1874    30405    5                               DO;
     1875    30406    5                                  RETURN;
     1876    30407    5                               END;
     1877    30408    4                      END;
     1878    30409
     1879    30410    3                %KV_SSN.OTPCHRCNT = %KV_SSN.OTPCHRCNT+1;
     1880    30411    3                KV_STT.OTPCHRCNT = KV_STT.OTPCHRCNT+1;
     1881    30412
     1882    30413    3                %KV_VDI.OTPBFR_.ADR$->Y$BYT(%KV_VDI.OTPBFR_.BYTX) =
     1883    30414    3                   KA_DVCFLWCTRCHR(%KV_MRD.DVCFLWCTRALG);
     1884    30415    3                %KV_VDI.OTPBFR_.BYTX = %KV_VDI.OTPBFR_.BYTX+1;
     1885    30416    3                %KV_VDI.OTPBFR_.BYTSIZ = %KV_VDI.OTPBFR_.BYTSIZ-1;
     1886    30417    3                PARM1 = %KA#HLTOTP_DVCX;
     1887    30418    3                GOTO SUB_COMMON;
     1888    30419    3             END;
     1889    30420    2          ELSE
     1890    30421    3             DO;
     1891    30422
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:60   
     1892    30423        /* THE DECLARED SIZE OF THE OUTPUT BUFFER IN THE DEVICE ISN'T                 */
     1893    30424        /* REASONABLY LARGE. IT'S PROBABLY MISDECLARED. WE CAN'T USE IT.              */
     1894    30425
     1895    30426    3                KX$X29.OTPCHRCNTUTLHLT = 16000;
     1896    30427    3                RETURN;
     1897    30428    3             END /* IF */;
     1898    30429    2   Y$SNCHLTOTP: ENTRY (PARM);
     1899    30430    2       PARM1 = PARM;
     1900    30431    2   SUB_COMMON:;
     1901    30432    2       IF (%KV_SSN.USRHLTINH AND (PARM1 = %KA#HLTOTP_USRX))
     1902    30433    2          THEN
     1903    30434    3             DO;
     1904    30435
     1905    30436        /* THIS IS A USER OUTPUT HALT REQUEST, AND USER HALTS ARE INHIBITED.          */
     1906    30437
     1907    30438    3                RETURN;
     1908    30439    3             END /* IF */;
     1909    30440    2       CALL KXX$TRNOTP ( %KV_VDI );
     1910    30441    2       IF (KX$X29.SND.TAL$ ~= ADDR(NIL))
     1911    30442    2          THEN
     1912    30443    3             DO;
     1913    30444
     1914    30445        /* WE HAVE AN OUTPUT BUFFER CHAIN* SET THE HALT BIT IN THE NEXT OUTPUT BUFFER */
     1915    30446
     1916    30447    3                KX$X29.HLTOTPNXTBFR.BITT(PARM1) = '1'B;
     1917    30448    3             END;
     1918    30449    2          ELSE
     1919    30450    3             DO;
     1920    30451
     1921    30452        /* THERE IS NO OUTPUT BUFFER CHAIN* OUTPUT IS CURRENTLY HALTED.               */
     1922    30453
     1923    30454    3                IF PARM1 = %KA#HLTOTP_USRX
     1924    30455    3                   THEN
     1925    30456    3                      KX$X29.HLTOTP.BITT(PARM1) = '1'B;
     1926    30457    3                   ELSE
     1927    30458    4                      DO;
     1928    30459                              %DISABLE;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:61   
     1929    30462    4                         CALL KXX$SNDX29MSG ( %KX_X29MSGTYP_HLTMRK#, KX$X29 );
     1930    30463                              %ENABLE;
     1931    30466    4                      END;
     1932    30467    3             END /* IF */;
     1933    30468    2   END Y$SNCFLWCTRHLT;
     1934    30469
     1935    30470        %EJECT;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:62   
     1936    30471
     1937    30472    1   Y$CAL_PAC:
     1938    30473    1       PROC ;
     1939    30474    2       CALL_FPT = '0'B;
     1940    30475    2       CALL_FPT.CAL$ = X29$;
     1941    30476    2       CALL_FPT.RCV$ = KX$X29.L3$;
     1942    30477    2       CALL_FPT.EVN = TEMP0 ;
     1943    30478    2       CALL_FPT.PRM1$ = TEMP1$;
     1944    30479    2       CALL KXP$PACKET (CALL_FPT)
     1945    30480    3          WHENALTRETURN DO;
     1946    30481    3                CALL KHD$SCREECH ( CALL_FPT.PRM1$->B$SCODE );
     1947    30482    3             END;
     1948    30483    2       RETURN ;
     1949    30484    2   END ;
     1950    30485
     1951    30486
     1952    30487    1   Y$ER:
     1953    30488    1       PROC ;
     1954    30489
     1955    30490               %WRSYSLOG  (  ERRCOD = ERCOD ,
     1956    30491                  TRMID ="KX$X29.CHN$->KH$CHN.TERMID") ;
     1957    30509
     1958    30510    2       RETURN ; END ;
     1959    30511
     1960    30512        %EJECT ;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:63   
     1961    30513
     1962    30514
     1963    30515    1   Y$DECODE_FPT: PROC;
     1964    30516
     1965    30517        %VC$CAL ( FPTN = Y_VC_CAL, STCLASS = AUTO );
     1966    30563        %VC$CAL;
     1967    30609        %VC$DAT;
     1968    30630        %EQU Y_VC_DAT=CHARTEXT('ADDR(Y_VC_CAL)->VC$DAT');
     1969    30631        %VC$RST;
     1970    30652        %EQU Y_VC_RST=CHARTEXT('ADDR(Y_VC_CAL)->VC$RST');
     1971    30653        %VC$INT;
     1972    30674        %EQU Y_VC_INT=CHARTEXT('ADDR(Y_VC_CAL)->VC$INT');
     1973    30675        %VC$CLR;
     1974    30704        %EQU Y_VC_CLR=CHARTEXT('ADDR(Y_VC_CAL)->VC$CLR');
     1975    30705    2   DCL B$STR CHAR(2000) BASED ALIGNED;
     1976    30706    2   DCL USR@DAT_ADR$ PTR;
     1977    30707    2   DCL USR@DAT_BYTX UBIN;
     1978    30708    2   DCL USR@DAT_BYTSIZ UBIN;
     1979    30709    2   DCL PCKSIZ UBIN;
     1980    30710    2   DCL FULPCKS UBIN;
     1981    30711    2   DCL WRDSIZ2N UBIN;
     1982    30712
     1983    30713    2       CALL_FPT = '0'B;       /* prepare to call L3 */
     1984    30714    2       CALL_FPT.CAL$ = VC$;
     1985    30715    2       CALL_FPT.RCV$ = KX$VC.L3$;
     1986    30716    2       L3$ = CALL_FPT.RCV$;
     1987    30717    2       Y_VC_CAL =PINCRC (PRM_USR_DAT.DAT__.ADR$, PRM_USR_DAT.DAT__.BYTX) ->VC$CAL;
     1988    30718    2       VDOVLP_ERR = KX_VDOVLP_ERR;
     1989    30719
     1990    30720    3       DO CASE ( Y_VC_CAL.FUNCTION );
     1991    30721
     1992    30722    3          CASE ( %KX_VCFNC_CAL_RQS# );
     1993    30723        /*
     1994    30724           If state is WCA, it is the AU writing the call packet info to us so
     1995    30725           that the call receiver will see it. Buffer it and wait for OPNSSN.
     1996    30726        */
     1997    30727    3             IF KX$VC.STATE = %KX_VC_ST_WCA#
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:64   
     1998    30728    3                THEN
     1999    30729    4                   DO;
     2000    30730    4                      KX$VC.CALMSGBYTSIZ = PRM_USR_DAT.DAT__.DATBYTSIZ;
     2001    30731    4                      CALL KVB$GETSYS ( (KX$VC.CALMSGBYTSIZ+1)/2, KX$VC.CALPKT$ )
     2002    30732    4                         ALTRET ( L_NOMEM );
     2003    30733    4                      SUBSTR(KX$VC.CALPKT$->B$STR,0,KX$VC.CALMSGBYTSIZ) =
     2004    30734    4                         SUBSTR(PRM_USR_DAT.DAT__.ADR$->B$STR,PRM_USR_DAT.DAT__.BYTX,
     2005    30735    4                         KX$VC.CALMSGBYTSIZ);
     2006    30736    4                      KX$VC.CALINDPND = '1'B;
     2007    30737    4                      RETURN;
     2008    30738    4                   END;
     2009    30739        /*
     2010    30740           A call request from the HOST. State has to be READY#. Change state to WCC#,
     2011    30741           and send the call through L3.
     2012    30742        */
     2013    30743    3             IF KX$VC.STATE ~= %KX_VC_ST_READY#
     2014    30744    3                THEN
     2015    30745    4                   DO;
     2016    30746    4   BAD_VCSTT:         VDOVLP_ERR.ERRCODE = BAD_VCSTT;
     2017    30747    4   BAD_STATE:         IF %KV_VDI.USRRQSDAT.RED
     2018    30748        /*
     2019    30749           Activate the read just to pass back an error code.
     2020    30750        */
     2021    30751    4                         THEN
     2022    30752    5                            DO;
     2023    30753    5                               KV@SND_DAT = KX_SND_DAT;
     2024    30754    5                               KX_VDOVLPARY.VDOVLP.ERR$ = ADDR(VDOVLP_ERR);
     2025    30755    5                               KX_VDOVLPARY.VDOVLP.KEY$ = ADDR(NIL);
     2026    30756    5                               CALL KVV$VDI ( KV@SND_DAT );
     2027    30757    5                               KX_VDOVLPARY.VDOVLP.ERR$ = ADDR(NIL);
     2028    30758    5                            END;
     2029    30759    4                         ELSE
     2030    30760    4                            KX$VC.ERCOD = VDOVLP_ERR.ERRCODE;
     2031    30761    4                      RETURN;
     2032    30762    4                   END;
     2033    30763    3             KX$VC.STATE = %KX_VC_ST_WCC#;
     2034    30764    3             KX$L3.CALL_OPTS.RCVADR.SIZ = Y_VC_CAL.CLDADRLNG;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:65   
     2035    30765    3             KX$L3.CALL_OPTS.RCVADR.ADR_STRING = Y_VC_CAL.CLDADRSTRING;
     2036    30766    3             KX$L3.DFL_OPTS = KX$L3.CALL_OPTS;
     2037    30767    3             KX$L3.CM_OPTS = KX$L3.CALL_OPTS;
     2038    30768    3             KX$L3.FSTSLC = Y_VC_CAL.FSTSLC;
     2039    30769    3             KX$L3.RVS = Y_VC_CAL.RVS;
     2040    30770    3             IF Y_VC_CAL.PROTOCOL = %KX_PRTID_X28#
     2041    30771    3                THEN
     2042    30772    4                   DO;
     2043    30773    4                      KX$VC.X28 = '1'B;
     2044    30774    4                      KX$VC.RPRX3 = Y_VC_CAL.RPRX3;
     2045    30775    4                      KX$VC.X3PRM = Y_VC_CAL.X3;
     2046    30776    4                      IF Y_VC_CAL.USRDATLNG = 0  /* we'll supply it then */
     2047    30777    4                         THEN
     2048    30778    5                            DO;
     2049    30779    5                               CALL_FPT.EVN = %KX_P_EV_VCUP#;
     2050    30780    5                               CALL_FPT.V_.ADR$ = ADDR(X28_PRTID);
     2051    30781    5                               CALL_FPT.V_.BYTX = 0;
     2052    30782    5                               CALL_FPT.V_.BYTSIZ = LENGTHC(X28_PRTID);
     2053    30783    5                               GOTO CAL_KXP0;
     2054    30784    5                            END;
     2055    30785    4                   END;
     2056    30786    3   CALL_VCUP: CALL_FPT.EVN = %KX_P_EV_VCUP#;
     2057    30787    3             CALL_FPT.V_.ADR$ = PRM_USR_DAT.DAT__.ADR$;
     2058    30788    3             CALL_FPT.V_.BYTX = LENGTHC(Y_VC_CAL) + PRM_USR_DAT.DAT__.BYTX + Y_VC_CAL.
             30788                      USRDATBYTX;
     2059    30789        /*N* validate USRDATLNG ?? */
     2060    30790    3             CALL_FPT.V_.BYTSIZ = Y_VC_CAL.USRDATLNG;
     2061    30791    3   CAL_KXP0: IF NOT Y_VC_CAL.REASSEMBLY
     2062    30792    3                THEN
     2063    30793    3                   KX$L3.NOREASM = '1'B;
     2064    30794        /* Save the call user data. May have to use it again later */
     2065    30795    3             KX$VC.CALMSGBYTSIZ = CALL_FPT.V_.BYTSIZ;
     2066    30796    3             IF CALL_FPT.V_.BYTSIZ > 0
     2067    30797    3                THEN
     2068    30798    4                   DO;
     2069    30799    4                      CALL KVB$GETSYS ( (KX$VC.CALMSGBYTSIZ+1)/2, KX$VC.CALPKT$ )
     2070    30800    4                         ALTRET (L_NOMEM);
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:66   
     2071    30801    4                      SUBSTR(KX$VC.CALPKT$->B$STR,0,CALL_FPT.V_.BYTSIZ) =
     2072    30802    4                         SUBSTR(CALL_FPT.V_.ADR$->B$STR,CALL_FPT.V_.BYTX,CALL_FPT.V_.
             30802                                  BYTSIZ);
     2073    30803    4                   END;
     2074    30804    3   CAL_KXP:  CALL KXP$PACKET ( CALL_FPT ) WHENALTRETURN
     2075    30805    4                   DO;
     2076    30806    4   L_KXPALT:          CALL KHD$SCREECH ( CALL_FPT.PRM1$->B$SCODE );
     2077    30807    4                   END;
     2078    30808    3          CASE ( %KX_VCFNC_CAL_RSP# );
     2079    30809        /*
     2080    30810           HOST accepts an incoming call. If state is WCA# then
     2081    30811           send call_c via L3. If state is ENDPHSDSC# then vc has been cleared by
     2082    30812           remote end (and HOST has been notified) and there is nothing to do.
     2083    30813        */
     2084    30814    3             IF KX$VC.STATE = %KX_VC_ST_WCA#
     2085    30815    3                THEN
     2086    30816    3                   GOTO CALL_VCUP;
     2087    30817    3                ELSE
     2088    30818    3                   IF KX$VC.STATE ~= %KX_VC_ST_ENDPHSDSC#
     2089    30819    3                      THEN
     2090    30820    3                         GOTO BAD_VCSTT;
     2091    30821
     2092    30822    3          CASE ( %KX_VCFNC_DAT_RQS# );
     2093    30823        /*
     2094    30824           Host wants to send data. Make sure state is NRM#. If RPRDAT then call L3.
     2095    30825        */
     2096    30826    3             IF KX$VC.STATE ~= %KX_VC_ST_NRM#
     2097    30827    3                THEN
     2098    30828    3                   GOTO BAD_VCSTT;
     2099    30829    3             USR@DAT_ADR$ = PRM_USR_DAT.DAT__.ADR$;
     2100    30830    3             USR@DAT_BYTX = PRM_USR_DAT.DAT__.BYTX + LENGTHC(VC$DAT);
     2101    30831    3             USR@DAT_BYTSIZ = PRM_USR_DAT.DAT__.DATBYTSIZ - LENGTHC(VC$DAT);
     2102    30832        /*
     2103    30833           First fill up the tail buffer that contains a partial packet with M-bit set,
     2104    30834           if that's the case.
     2105    30835        */
     2106    30836    3             IF KX$VC.SND.NXTLOD$ = ADDR(NIL)
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:67   
     2107    30837    3                THEN
     2108    30838    3                   GOTO L_NEWBFR;
     2109    30839    3             DAT$ = KX$VC.SND.TAL$;
     2110    30840    3             IF (NOT KX$VC_OTPBFR.M) OR (KX$VC_OTPBFR.BFRBYTSIZ = KX$VC_OTPBFR.BYTX)
     2111    30841    3                THEN
     2112    30842    3                   GOTO L_NEWBFR;
     2113    30843    3             Y@BYTSIZ = MINIMUM ( KX$VC_OTPBFR.BFRBYTSIZ-KX$VC_OTPBFR.BYTX,
             30843                      USR@DAT_BYTSIZ);
     2114    30844    3             IF USR@DAT_BYTSIZ = 0
     2115    30845    3                THEN
     2116    30846    4                   DO;
     2117    30847        /* This must be a flush command to clear previous M-bit */
     2118    30848    4                      KX$VC_OTPBFR.M = '0'B;
     2119    30849    4                   END;
     2120    30850    3                ELSE
     2121    30851    4                   DO;
     2122    30852    4                      SUBSTR ( DAT$->B$STR, KX$VC_OTPBFR.BYTX, Y@BYTSIZ ) =
     2123    30853    4                         SUBSTR(USR@DAT_ADR$->B$STR,USR@DAT_BYTX,Y@BYTSIZ);
     2124    30854    4                      USR@DAT_BYTX = USR@DAT_BYTX + Y@BYTSIZ;
     2125    30855    4                      USR@DAT_BYTSIZ = USR@DAT_BYTSIZ - Y@BYTSIZ;
     2126    30856    4                      KX$VC_OTPBFR.BYTX = KX$VC_OTPBFR.BYTX + Y@BYTSIZ;
     2127    30857    4                      IF NOT %Y_VC_DAT.M AND KX$VC_OTPBFR.BFRBYTSIZ > KX$VC_OTPBFR.BYTX
     2128    30858    4                         THEN
     2129    30859    4                            KX$VC_OTPBFR.M = '0'B;
     2130    30860    4                   END;
     2131    30861    3   L_NEWBFR: ;
     2132    30862    3             IF USR@DAT_BYTSIZ = 0
     2133    30863    3                THEN
     2134    30864    3                   GOTO L_RPRDAT;
     2135    30865        /*
     2136    30866           Get new output buffer(s) for the remaining data. If the M-bit is also set
     2137    30867           this time, we need to break this data into one chunk whose size is a
     2138    30868           multiple of the full packet size, and one chunk that contains the rest.
     2139    30869        */
     2140    30870    3             PCKSIZ = KX_BUF.SIZ(KX$L3.CALL_OPTS.SNDPCKSIZ);
     2141    30871    3             FULPCKS = ( USR@DAT_BYTSIZ / PCKSIZ ) * PCKSIZ;
     2142    30872    3             IF %Y_VC_DAT.M AND FULPCKS > 0
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:68   
     2143    30873    3                THEN
     2144    30874    4                   DO;
     2145    30875    4                      CALL Y$BFROTP ALTRET ( L_NOMEM );
     2146    30876    4                      USR@DAT_BYTX = USR@DAT_BYTX + FULPCKS;
     2147    30877    4                      USR@DAT_BYTSIZ = USR@DAT_BYTSIZ - FULPCKS;
     2148    30878    4                   END;
     2149    30879    3             IF USR@DAT_BYTSIZ = 0
     2150    30880    3                THEN
     2151    30881    3                   GOTO L_RPRDAT;
     2152    30882    3             IF %Y_VC_DAT.M
     2153    30883    3                THEN
     2154    30884    3                   FULPCKS = PCKSIZ;
     2155    30885    3                ELSE
     2156    30886    3                   FULPCKS = USR@DAT_BYTSIZ;
     2157    30887    3             CALL Y$BFROTP ALTRET ( L_NOMEM );
     2158    30888    3   L_RPRDAT: ;
     2159    30889    3             IF KX$VC.OTPBFRBYTCNT > KX$VC.MAXOTPBYT
     2160    30890    3                THEN
     2161    30891                        %KV$RQSOTP ( RQSOTP = NO );
             30897    4           IF KV$VDI.RQSOTP THEN DO;
             30898    4              KV$VDI.RQSOTP = '0'B;
             30899    4              IF KV$VDI.SSNCNT>1
             30900    4              THEN CALL KVV$VDI (KV_VDH_EVT_RQSOTP);
             30901    4              END;
     2162    30909    3             IF KX$VC.RPRDAT
     2163    30910    3                THEN
     2164    30911    4                   DO;
     2165    30912    4                      CALL_FPT.EVN = %KX_P_EV_DATAVL#;
     2166    30913    4                      GOTO CAL_KXP;
     2167    30914    4                   END;
     2168    30915
     2169    30916
     2170    30917    3          CASE ( %KX_VCFNC_INT_RQS# );
     2171    30918        /*
     2172    30919           HOST wants to send an interrupt. Make sure state is NRM#. Call L3 to send
     2173    30920           the interrupt packet.
     2174    30921        */
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:69   
     2175    30922    3             IF KX$VC.STATE ~= %KX_VC_ST_NRM#
     2176    30923    3                THEN
     2177    30924    3                   GOTO BAD_VCSTT;
     2178    30925    3             CALL_FPT.EVN = %KX_P_EV_SNDINT#;
     2179    30926    3             CALL_FPT.V_.ADR$ = PRM_USR_DAT.DAT__.ADR$;
     2180    30927    3             CALL_FPT.V_.BYTX = LENGTHC(VC$INT) + PRM_USR_DAT.DAT__.BYTX;
     2181    30928    3             IF %Y_VC_INT.INTDATLNG <= PRM_USR_DAT.DAT__.DATBYTSIZ -LENGTHC(VC$INT)
     2182    30929    3                THEN
     2183    30930    3                   CALL_FPT.V_.BYTSIZ = %Y_VC_INT.INTDATLNG;
     2184    30931        /*N*         ELSE
     2185    30932                        errlog ? */
     2186    30933    3             GOTO CAL_KXP;
     2187    30934
     2188    30935    3          CASE ( %KX_VCFNC_RST_RQS# );
     2189    30936        /*
     2190    30937           HOST wants to reset this circuit. Make sure state is NRM#. Call L3 to send
     2191    30938           the reset packet.
     2192    30939        */
     2193    30940    3             IF KX$VC.STATE ~= %KX_VC_ST_NRM#
     2194    30941    3                THEN
     2195    30942    3                   GOTO BAD_VCSTT;
     2196    30943    3             CALL_FPT.EVN = %KX_P_EV_VCRST#;
     2197    30944    3             CALL_FPT.PRS.PRM1 = '1'B;
     2198    30945    3             CALL_FPT.PRM1 = %Y_VC_RST.DIAG;
     2199    30946    3             GOTO CAL_KXP;
     2200    30947
     2201    30948    3          CASE ( %KX_VCFNC_CLR_RQS# );
     2202    30949        /*
     2203    30950           HOST wants to clear this circuit. The only state this is not allowed is READY#.
     2204    30951           The new state is BGNPHSDSC#. Call L3 to start the clear procedure.
     2205    30952           Disconnect.
     2206    30953        */
     2207    30954    3             IF KX$VC.STATE = %KX_VC_ST_READY#
     2208    30955    3                THEN
     2209    30956    3                   GOTO BAD_VCSTT;
     2210    30957    3             KX$VC.STATE = %KX_VC_ST_BGNPHSDSC#;
     2211    30958    3             CALL_FPT.EVN = %KX_P_EV_VCLST#;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:70   
     2212    30959    3             CALL_FPT.PRS.PRM1 = '1'B;
     2213    30960    3             CALL_FPT.PRM1 = %Y_VC_CLR.DIAG;
     2214    30961    3             CALL_FPT.V_.ADR$ = PRM_USR_DAT.DAT__.ADR$;
     2215    30962    3             CALL_FPT.V_.BYTX = LENGTHC(VC$CLR) +
     2216    30963    3                %Y_VC_CLR.USRDATBYTX + PRM_USR_DAT.DAT__.BYTX;
     2217    30964    3             IF %Y_VC_CLR.USRDATLNG <= PRM_USR_DAT.DAT__.DATBYTSIZ -LENGTHC(VC$CLR)
     2218    30965    3                THEN
     2219    30966    3                   CALL_FPT.V_.BYTSIZ = %Y_VC_CLR.USRDATLNG;
     2220    30967        /*N*         ELSE
     2221    30968                        errlog ?  */
     2222    30969    3             CALL KXP$PACKET ( CALL_FPT ) ALTRET ( L_KXPALT );
     2223    30970    3             CALL KVV$VDI ( KXX_VDH_DSC );
     2224    30971
     2225    30972    3          CASE ( %KX_VCFNC_CLR_RSP# );
     2226    30973        /*
     2227    30974           Not used for now, at least.
     2228    30975        */
     2229    30976    3          CASE ( %KX_VCFNC_BRK_RQS# );
     2230    30977        /*
     2231    30978           HOST wants to send a break. Make sure state is NRM# and this is an x.28
     2232    30979           vc. Figure out what exactly to send from the x.3 parameter.
     2233    30980        */
     2234    30981    3             IF KX$VC.STATE ~= %KX_VC_ST_NRM#
     2235    30982    3                THEN
     2236    30983    3                   GOTO BAD_VCSTT;
     2237    30984    3             IF NOT KX$VC.X28
     2238    30985    3                THEN
     2239    30986    3                   GOTO L_NOT_X28;
     2240    30987    4             DO CASE ( KX$VC.X3PRM(%KX_X3PRMX_ACTBRK#) );
     2241    30988    4                CASE ( 0, 8 );  /* nothing to do */
     2242    30989    4                CASE ( 1 );     /* send interrupt */
     2243    30990    4                   CALL_FPT.EVN = %KX_P_EV_SNDINT#;
     2244    30991    4                   GOTO CAL_KXP;
     2245    30992    4                CASE ( 2 );     /* reset the vc */
     2246    30993    4                   CALL_FPT.EVN = %KX_P_EV_VCRST#;
     2247    30994    4                   GOTO CAL_KXP;
     2248    30995    4                CASE ( 4 );     /* send indication of break */
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:71   
     2249    30996    4   L_4:            CALL KXX$SNDX29MSG ( %KX_X29MSGTYP_BRKIND#, KX$VC );
     2250    30997    4                CASE ( 16 );    /* discard output to terminal, i.e. input to us */
     2251    30998    4   L_DSCOTP:       KX$VC.X3PRM(%KX_X3PRMX_DSCOTP#) = 1;
     2252    30999    4                   IF KX$VC.BLK_L3
     2253    31000    4                      THEN
     2254    31001    5                         DO;
     2255    31002    5                            CALL_FPT.EVN = %KX_P_EV_REDRQS#;
     2256    31003    5                            GOTO CAL_KXP;
     2257    31004    5                         END;
     2258    31005    4                CASE ( 21 );    /* = 1+4+16 */
     2259    31006    4                   CALL_FPT.EVN = %KX_P_EV_SNDINT#;
     2260    31007    4                   CALL KXP$PACKET ( CALL_FPT ) ALTRET ( L_KXPALT );
     2261    31008    4                   CALL KXX$SNDX29MSG ( %KX_X29MSGTYP_BRKIND#, KX$VC );
     2262    31009    4                   GOTO L_DSCOTP;
     2263    31010    4                CASE ( ELSE );  /* illegal value in x.3 param 7, treat as 4. */
     2264    31011    4                   GOTO L_4;    /* errlog ? */
     2265    31012    4             END; /* do case ( prmx_actbrk ) */
     2266    31013    3          CASE ( %KX_VCFNC_SETX3# );
     2267    31014    3             KX$VC.X3PRM = Y_VC_CAL.X3;
     2268    31015    3          CASE ( %KX_VCFNC_REDX3# );
     2269    31016    3             IF NOT KX$VC.X28
     2270    31017    3                THEN
     2271    31018    4                   DO;
     2272    31019    4   L_NOT_X28:         VDOVLP_ERR.ERRCODE = NOT_X28;
     2273    31020    4                      GOTO BAD_STATE;
     2274    31021    4                   END;
     2275    31022    3             KV@SND_DAT = KX_SND_DAT;
     2276    31023    3             IF NOT KX$VC.X3PND
     2277    31024    3                THEN
     2278    31025    4                   DO;
     2279    31026    4                      KX$VC.CALMSGBYTSIZ = LENGTHC(VC$CAL);
     2280    31027    4                      CALL KVB$GETSYS ( (KX$VC.CALMSGBYTSIZ+1)/2, KX$VC.CALPKT$ )
     2281    31028    4                         ALTRET ( L_NOMEM );
     2282    31029    4                      KX$VC.CALPKT$->VC$CAL = '0'B;
     2283    31030    4                      KX$VC.CALPKT$->VC$CAL.FUNCTION = %KX_VCFNC_INDX3#;
     2284    31031    4                      KX$VC.X3PND = '1'B;
     2285    31032    4                      KX_VDOVLPARY.VDOVLP.KEY$ = ADDR(KX_KEY_INDX3);
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:72   
     2286    31033    4                   END;
     2287    31034    3                ELSE
     2288    31035    4                   DO;
     2289    31036    4                      KX_VDOVLPARY.VDOVLP.KEY$ = ADDR(KX_KEY_CAL_CNF);
     2290    31037    4                   END;
     2291    31038    3             KX$VC.CALPKT$->VC$CAL.X3 = KX$VC.X3PRM;
     2292    31039    3             IF %KV_VDI.USRRQSDAT.RED
     2293    31040    3                THEN
     2294    31041    4                   DO;
     2295    31042    4                      KV@SND_DAT.DAT__.ADR$ = KX$VC.CALPKT$;
     2296    31043    4                      KV@SND_DAT.DAT__.BYTX = 0;
     2297    31044    4                      KV@SND_DAT.DAT__.DATBYTSIZ = KX$VC.CALMSGBYTSIZ;
     2298    31045    4                      CALL KVV$VDI ( KV@SND_DAT ) WHENRETURN
     2299    31046    5                            DO;
     2300    31047    5                               KX$VC.X3PND = '0'B;
     2301    31048    5                               CALL KVB$RLSSYS ( (KX$VC.CALMSGBYTSIZ+1)/2, KX$VC.
             31048                                        CALPKT$ );
     2302    31049    5                               KX$VC.CALPKT$ = ADDR(NIL);
     2303    31050    5                               KX$VC.CALMSGBYTSIZ = 0;
     2304    31051    5                            END;
     2305    31052    4                   END;
     2306    31053    3          CASE ( ELSE );
     2307    31054    3             VDOVLP_ERR.ERRCODE = UNK_VCFNC;
     2308    31055    3             GOTO BAD_STATE;
     2309    31056    3       END;  /* do case ( function ) */
     2310    31057    2       RETURN;
     2311    31058
     2312    31059    2   L_NOMEM:
     2313    31060    2       CALL KHD$SCREECH ( Y_NOMEM );
     2314    31061
     2315    31062    2   Y$BFROTP: PROC ALTRET;
     2316    31063
     2317    31064    3       Y@BYTSIZ = FULPCKS + LENGTHC ( KX$VC_OTPBFR );
     2318    31065    3       WRDSIZ2N = (Y@BYTSIZ+1)/2;
     2319    31066    4       CALL KVB$GET2NSYS ( WRDSIZ2N, DAT$ ) WHENALTRETURN DO;
     2320    31067    4                ALTRETURN;
     2321    31068    4             END;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:73   
     2322    31069    3       KX_STATS_X29.KHSTT.OTPBFRBYTUTL =
     2323    31070    3          KX_STATS_X29.KHSTT.OTPBFRBYTUTL + Y@BYTSIZ;
     2324    31071    3       KX$VC_OTPBFR.RLSWRDSIZ = WRDSIZ2N;
     2325    31072    3       KX$VC.OTPBFRBYTCNT = KX$VC.OTPBFRBYTCNT + Y@BYTSIZ;
     2326    31073    3       KX$VC_OTPBFR.BFRBYTSIZ = Y@BYTSIZ;
     2327    31074    3       KX$VC_OTPBFR.BYTX = Y@BYTSIZ;
     2328    31075    3       KX$VC_OTPBFR.Q = %Y_VC_DAT.Q;
     2329    31076    3       KX$VC_OTPBFR.M = %Y_VC_DAT.M;
     2330    31077    3       IF FULPCKS > USR@DAT_BYTSIZ
     2331    31078    3          THEN
     2332    31079    3             FULPCKS = USR@DAT_BYTSIZ;
     2333    31080    3       SUBSTR ( DAT$->B$STR, LENGTHC(KX$VC_OTPBFR), FULPCKS ) =
     2334    31081    3          SUBSTR ( USR@DAT_ADR$->B$STR, USR@DAT_BYTX, FULPCKS );
     2335    31082    3       IF KX$VC.SND.HED$ = ADDR(NIL)
     2336    31083    3          THEN
     2337    31084    3             KX$VC.SND.HED$ = DAT$;
     2338    31085    3          ELSE
     2339    31086    3             KX$VC.SND.TAL$->KX$VC_OTPBFR.LNK$ = DAT$;
     2340    31087    3       KX$VC.SND.TAL$ = DAT$;
     2341    31088    3       KX$VC_OTPBFR.LNK$ = ADDR(NIL);
     2342    31089    3       IF KX$VC.SND.NXTLOD$ = ADDR(NIL)
     2343    31090    3          THEN
     2344    31091    3             KX$VC.SND.NXTLOD$ = DAT$;
     2345    31092
     2346    31093    3   END Y$BFROTP;
     2347    31094    2   END Y$DECODE_FPT;
     2348    31095        %EJECT;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:74   
     2349    31096
     2350    31097    1   Y$CHKPNDBITS: PROC;
     2351    31098        %VC$CAL ( STCLASS = BASED );
     2352    31144        /*
     2353    31145           We have a chance to send queued input to the HOST.
     2354    31146        */
     2355    31147    2       KV@SND_DAT = KX_SND_DAT;
     2356    31148    2       IF KX$VC.CALINDPND AND %KV_VDI.USRRQSDAT.RED
     2357    31149    2          THEN
     2358    31150    3             DO;
     2359    31151    3                KX_VDOVLPARY.VDOVLP.KEY$ = ADDR(KX_KEY_CAL_IND);
     2360    31152    3                KV@SND_DAT.DAT__.ADR$ = KX$VC.CALPKT$;
     2361    31153    3                KV@SND_DAT.DAT__.DATBYTSIZ = KX$VC.CALMSGBYTSIZ;
     2362    31154    3                CALL Y$SNDDAT ALTRET (L_RETURN);
     2363    31155    3                KX$VC.CALINDPND = '0'B;
     2364    31156    3                KX$VC.CALPKT$ = ADDR(NIL);
     2365    31157    3                KX$VC.CALMSGBYTSIZ = 0;
     2366    31158    3             END;
     2367    31159    2       IF KX$VC.CALCNFPND AND %KV_VDI.USRRQSDAT.RED
     2368    31160    2          THEN
     2369    31161    3             DO;
     2370    31162    3                IF KX$VC.CALPKT$->VC$CAL.FUNCTION = %KX_VCFNC_CAL_CNF#
     2371    31163    3                   THEN
     2372    31164    3                      KX_VDOVLPARY.VDOVLP.KEY$ = ADDR(KX_KEY_CAL_CNF);
     2373    31165    3                   ELSE
     2374    31166    3                      KX_VDOVLPARY.VDOVLP.KEY$ = ADDR(KX_KEY_INDX3);
     2375    31167    3                KV@SND_DAT.DAT__.ADR$ = KX$VC.CALPKT$;
     2376    31168    3                KV@SND_DAT.DAT__.DATBYTSIZ = KX$VC.CALMSGBYTSIZ;
     2377    31169    3                CALL Y$SNDDAT ALTRET (L_RETURN);
     2378    31170    3                KX$VC.CALCNFPND = '0'B;
     2379    31171    3                KX$VC.CALPKT$ = ADDR(NIL);
     2380    31172    3                KX$VC.CALMSGBYTSIZ = 0;
     2381    31173    3             END;
     2382    31174    2       IF KX$VC.INTINDPND AND %KV_VDI.USRRQSDAT.RED
     2383    31175    2          THEN
     2384    31176    3             DO;
     2385    31177    3                KX_VDOVLPARY.VDOVLP.KEY$ = ADDR(KX_KEY_INT_IND);
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:75   
     2386    31178    3                KV@SND_DAT.DAT__.ADR$ = KX$VC.INTPKT$;
     2387    31179    3                KV@SND_DAT.DAT__.DATBYTSIZ = KX$VC.INTMSGBYTSIZ;
     2388    31180    3                CALL Y$SNDDAT ALTRET (L_RETURN);
     2389    31181    3                KX$VC.INTINDPND = '0'B;
     2390    31182    3                KX$VC.INTPKT$ = ADDR(NIL);
     2391    31183    3                KX$VC.INTMSGBYTSIZ = 0;
     2392    31184    3             END;
     2393    31185    2       IF KX$VC.INTCNFPND AND %KV_VDI.USRRQSDAT.RED
     2394    31186    2          THEN
     2395    31187    3             DO;
     2396    31188    3                KX_VDOVLPARY.VDOVLP.KEY$ = ADDR(KX_KEY_INT_CNF);
     2397    31189    3                VC_INT.FUNCTION = %KX_VCFNC_INT_CNF#;
     2398    31190    3                KV@SND_DAT.DAT__.ADR$ = ADDR(VC_INT);
     2399    31191    3                KV@SND_DAT.DAT__.DATBYTSIZ = LENGTHC(VC_INT);
     2400    31192    3                CALL KVV$VDI ( KV@SND_DAT ) ALTRET (L_RETURN);
     2401    31193    3                KX$VC.INTCNFPND = '0'B;
     2402    31194    3             END;
     2403    31195    2       IF KX$VC.RSTINDPND AND %KV_VDI.USRRQSDAT.RED
     2404    31196    2          THEN
     2405    31197    3             DO;
     2406    31198    3                KX_VDOVLPARY.VDOVLP.KEY$ = ADDR(KX_KEY_RST_IND);
     2407    31199    3                VC_RST.FUNCTION = %KX_VCFNC_RST_IND#;
     2408    31200    3                VC_RST.CAUSE = KX$VC.RST_CAUSE;
     2409    31201    3                VC_RST.DIAG = KX$VC.RST_DIAG;
     2410    31202    3                KV@SND_DAT.DAT__.ADR$ = ADDR(VC_RST);
     2411    31203    3                KV@SND_DAT.DAT__.DATBYTSIZ = LENGTHC(VC_RST);
     2412    31204    3                CALL KVV$VDI ( KV@SND_DAT ) ALTRET (L_RETURN);
     2413    31205    3                KX$VC.RSTINDPND = '0'B;
     2414    31206    3             END;
     2415    31207    2       IF KX$VC.RSTCNFPND AND %KV_VDI.USRRQSDAT.RED
     2416    31208    2          THEN
     2417    31209    3             DO;
     2418    31210    3                KX_VDOVLPARY.VDOVLP.KEY$ = ADDR(KX_KEY_RST_CNF);
     2419    31211    3                VC_RST.FUNCTION = %KX_VCFNC_RST_CNF#;
     2420    31212    3                KV@SND_DAT.DAT__.ADR$ = ADDR(VC_RST);
     2421    31213    3                KV@SND_DAT.DAT__.DATBYTSIZ = LENGTHC(VC_RST);
     2422    31214    3                CALL KVV$VDI ( KV@SND_DAT ) ALTRET (L_RETURN);
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:76   
     2423    31215    3                KX$VC.RSTCNFPND = '0'B;
     2424    31216    3             END;
     2425    31217    2       IF KX$VC.CLRINDPND AND %KV_VDI.USRRQSDAT.RED
     2426    31218    2          THEN
     2427    31219    3             DO;
     2428    31220    3                KX_VDOVLPARY.VDOVLP.KEY$ = ADDR(KX_KEY_CLR_IND);
     2429    31221    3                KV@SND_DAT.DAT__.ADR$ = KX$VC.CLRPKT$;
     2430    31222    3                KV@SND_DAT.DAT__.DATBYTSIZ = KX$VC.CLRMSGBYTSIZ;
     2431    31223    3                CALL Y$SNDDAT ALTRET (L_RETURN);
     2432    31224    3                KX$VC.CLRINDPND = '0'B;
     2433    31225    3                KX$VC.CLRPKT$ = ADDR(NIL);
     2434    31226    3                KX$VC.CLRMSGBYTSIZ = 0;
     2435    31227    3             END;
     2436    31228    2       IF KX$VC.L3$ = ADDR(NIL)
     2437    31229    2          THEN
     2438    31230    2             GOTO L_RETURN;
     2439    31231    2       CALL_FPT = '0'B;
     2440    31232    2       CALL_FPT.CAL$ = VC$;
     2441    31233    2       CALL_FPT.RCV$ = KX$VC.L3$;
     2442    31234    2       IF KX$VC.BLK_L3
     2443    31235    2          THEN
     2444    31236    3             DO;
     2445    31237    3                IF %KV_VDI.USRRQSDAT.RED
     2446    31238    3                   THEN
     2447    31239    4                      DO;
     2448    31240    4                         KX$VC.BLK_L3 = '0'B;
     2449    31241    4                         CALL_FPT.EVN = %KX_P_EV_REDRQS#;
     2450    31242    4                         CALL KXP$PACKET ( CALL_FPT ) WHENALTRETURN
     2451    31243    5                               DO;
     2452    31244    5   L_KXPALT2:                     CALL KHD$SCREECH ( CALL_FPT.PRM1$->B$SCODE );
     2453    31245    5                               END;
     2454    31246    4                      END;
     2455    31247    3             END;
     2456    31248    2       IF KX$VC.INV2CLR AND NOT KX$VC.BLK_L3
     2457    31249    2          THEN
     2458    31250    3             DO;
     2459    31251    3                KV@VDH_DSC = KXX_VDH_DSC;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:77   
     2460    31252    3                CALL KVV$VDI ( KV@VDH_DSC );
     2461    31253    3                CALL_FPT.EVN = %KX_P_EV_VCLST#;
     2462    31254    3                CALL KXP$PACKET ( CALL_FPT ) ALTRET ( L_KXPALT2 );
     2463    31255    3                KX$VC.STATE = %KX_VC_ST_BGNPHSDSC#;
     2464    31256    3             END;
     2465    31257    2   L_RETURN: ;
     2466    31258    2       RETURN;
     2467    31259
     2468    31260    2   Y$SNDDAT: PROC ALTRET;
     2469    31261    3   DCL KVBSIZ UBIN ALIGNED BASED(KV@SND_DAT.DAT__.ADR$);
     2470    31262
     2471    31263    3       CALL KVV$VDI ( KV@SND_DAT )
     2472    31264    3          WHENALTRETURN
     2473    31265    4             DO;
     2474    31266    4                ALTRETURN;
     2475    31267    4             END;
     2476    31268    3       KVBSIZ = (KV@SND_DAT.DAT__.DATBYTSIZ+1)/2;
     2477    31269    3       CALL KVB$RLSSYS ( KVBSIZ );
     2478    31270
     2479    31271    3   END Y$SNDDAT;
     2480    31272    2   END Y$CHKPNDBITS;
     2481    31273
     2482    31274    1   END KXX$VDI;

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:78   
--  Include file information  --

   KNH_MACRO_C.:E05TOU  is referenced.
   K_ADDRESS_M.:E05TOU  is referenced.
   KH_MACRO_C.:E05TOU  is referenced.
   KH_CHN.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   KV$VDH.:E05TOU  is referenced.
   KV$USR.:E05TOU  is referenced.
   KA_GLB.:E05TOU  is referenced.
   KA_GLB_E.:E05TOU  is referenced.
   KA_GLBASM_E.:E05TOU  is referenced.
   KV_GLB_M.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  is referenced.
   K_ID_E.:E05TOU  is referenced.
   KL_SUPER_C.:E05TOU  is referenced.
   KL_CONTROL_C.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   KX_SCODE_C.:E05TOU  is referenced.
   KX_DATA_C.:E05TOU  is referenced.
   KX_PERR_C.:E05TOU  is referenced.
   KX_EQUS_E.:E05TOU  is referenced.
   KXX_MACROS_M.:E05TOU  is referenced.
   KX_MACROS_M.:E05TOU  is referenced.
   KV$GLBCTX.:E05TOU  is referenced.
   KV$GLB.:E05TOU  is referenced.
   KV_INT_M.:E05TOU  is referenced.
   KV$INT.:E05TOU  is referenced.
   KH$STT.:E05TOU  is referenced.
   KV_GLBCNS_E.:E05TOU  is referenced.
   KV_GLBASM_E.:E05TOU  is referenced.
   KV_ASCCHR_E.:E05TOU  is referenced.
   KV$SND.:E05TOU  is referenced.
   KV_ERRORS_C.:E05TOU  is referenced.
   KV$VDO.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:79   
   G_JIT_M.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure KXX$VDI.

   Procedure KXX$VDI requires 5792 words for executable code.
   Procedure KXX$VDI requires 136 words of local(AUTO) storage.

    No errors detected in file KXX$VDI.:E05TSI    .

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:80   

 Object Unit name= KXX$VDI                                    File name= KXX$VDI.:E05TOU
 UTS= JUL 30 '97 02:34:47.68 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0  RoData even  UTS    160     A0  KXX$VDI
    1   Data  even  none     3      3  KXX$VDI
    2   Proc  even  none  5792   16A0  KXX$VDI
    3  RoData even  none    31     1F  KXX$VDI

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     2      0   yes    yes     yes      Std        1  KXX$VDI

  ****  Data defs  ****

 Sect HexLoc  Name                           Sect HexLoc  Name
    0      0  KV_ERD                             0     74  KX_VDOVLP_ERR
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:81   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 KXV$VCVDH
 yes     yes           Std       2 KVB$GETSYS
 yes     yes           Std       2 KVB$RLS2NSYS
 yes     yes           Std       2 KXX$SNDX29MSG
         yes           Std       1 KXX$DFRINP
 yes     yes           Std       1 KXX$TRNOTP
         yes           Std       7 KXS$SYSLOG
         yes           Std       1 KXX$X29
         yes           Std       1 KHI$DISABLE
 yes     yes           Std       3 KXS$GETL3
         yes           Std       0 KHI$ENABLE
 yes     yes           Std       2 KHA$GET_CTX_PTR
         yes           Std       1 KXS$RLSL3
 yes     yes           Std       2 KVB$RLSSYS
 yes     yes           Std       2 KXX$INTCNC
 yes     yes           Std       1 KVV$VDI
         yes           Std       0 KVI$RE_DSPINP
         yes           Std       1 KHD$SCREECH
         yes           Std       1 KXX$MRK
         yes           Std       1 KXX$RLSCTX
 yes     yes           Std       1 KXP$PACKET
 yes     yes           Std       2 KVB$GET2NSYS
                       nStd      0 X6A_AUTO_1
                       nStd      0 X6A_AALT
                       nStd      0 X6C_MAT
                       nStd      0 X6A_ARET
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:82   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KV$PTR$                               G$JIT$                                KV_STT
     KXX_VDH_DSC                           KV_VDH_EVT_RLSVDI                     KV_VDH_EVT_RQSOTP
     KV_VDH_EVT_CMPOTP                     KX_VDH_EVT_ATN                        KV_VDH_OTPLCL
     KV_VDH_OTPMRK                         KV_VDH_SETCLK                         KV_VDH_DAT
     KA_OTPBFRBYTSIZ_BIG                   KA_OTPBFRBYTSIZ_BIGLOG2               KA_OTPBFRBYTSIZ_SML
     KA_OTPBFRBYTSIZ_SMLLOG2               KA_OTPUN_BLKLMT                       KA_OTPBLKLMT
     KA_MINSP_FORPST                       KA_DVCFLWCTRCHR                       KA_LINERRDSCLMT
     KA_LINERRLOGLMT                       KX_BUF                                KX_PM$
     KX_PRT_$                              KX_STATS_X29                     r    KA_TRNTBLCHNCHR$
r    KA_TRNTBL_FUL$                   r    KA_TRNTBL_PRT$                   r    KH_CHNHI
r    KH_CHNLOW                             KH_CTLTBL                             KX_BFR_BRK
     VC_INT                                VC_RST                                KX_SND_DAT
     KX_VDOVLPARY                          KX_KEY_CAL_IND                        KX_KEY_CAL_CNF
     KX_KEY_INT_IND                        KX_KEY_INT_CNF                        KX_KEY_RST_IND
     KX_KEY_RST_CNF                        KX_KEY_CLR_IND                        KX_KEY_INDX3
     DEVLGNFAL                             DWORD                            r    G$ROS$
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:83   


        1        1        /*M* KXX$VDI  -  X.29 Handler - VDH interface.        */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7
        8        8        /*X*  PLM = 4, IND=3, CTI=3, DCI=6, IAD=0, DTI=6, AND=Y, CSI=3, THI=3, STI=3, DMC=Y
                 8         */
        9        9
       10       10        KXX$VDI: PROC (PRM_USR_X) ALTRET;

     10   2 000000  D380 0000 0000  xent KXX$VDI         LNJ,B5   X6A_AUTO_1
          2 000003       0088 0001                       DC       136,1

       11       11        /*P*
       12       12             NAME: KXX$VDI
       13       13             PUROPSE:
       14       14                      THE PURPOSE OF THIS ROUTINE IS TO RECEIVE CALLS FROM THE
       15       15                      VDH TO THE X.29 HANDLER. THIS ROUTINE DETERMINES WHAT NEEDS
       16       16                      TO BE DONE AND EITHER DOES IT, OR CALLS ANOTHER ROUTINE WITHIN
       17       17                      X.29 TO DO WHAT NEEDS TO BE DONE.
       18       18        */
       19       19
       20       20
       21       21        /*****************************************************************
       22       22        *                                                                *
       23       23        *                           Include files                        *
       24       24        *                                                                *
       25       25        *****************************************************************/
       26       26
       27       27
       28       28        %INCLUDE LCP_6;
       29     4307        %INCLUDE G_JIT_M;
       30     4572        %INCLUDE CP_6_SUBS;
       31     5112        %INCLUDE KV$VDO;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:84   
       32     6127        %INCLUDE KV_ERRORS_C;
       33     6187        %KV_VDOVLP_E;
       34     6201        %INCLUDE KV$SND;
       35     6620        %KV_SND_FNC_E;
       36     6636        %INCLUDE KV_ASCCHR_E;
       37     6773        %INCLUDE KV_GLBASM_E;
       38     6791        %INCLUDE KV_GLBCNS_E; /*  VDH CONSTANTS                     */
       39     7132        %KV#DATMOD_E;
       40     7138          %KV_STRTYP_E;
       41     7176          %KV_SCHRSN_E;
       42     7183          %KV_VDH_EVT_ID_E;
       43     7189          %KV_USR_EVT_ID_E;
       44     7209          %KV_USR_FNC_E;
       45     7225          %KV_VDH_FNC_E;
       46     7245          %KV_CLKNMB_E;
       47     7254          %KV_CLKUNT_E;
       48     7259          %KV_DSCRSN_E;
       49     7268          %KV_INPOPRX_E;
       50     7280          %KV_PRTTYP_E;
       51     7287          %KV#CQ_HNDID_E;
       52     7292
       53     7293        %INCLUDE KH$STT; /* For KX_STATS_X29                         */
       54     7323        %INCLUDE KV$INT;
       55     7955        %INCLUDE KV_INT_M;
       56     8098        %INCLUDE KV$GLB;
       57     8517        %INCLUDE KV$GLBCTX;
       58     8962        %INCLUDE KX_MACROS_M;
       59     9733        %INCLUDE KXX_MACROS_M;
       60    10075        %INCLUDE KX_EQUS_E;
       61    10514        %INCLUDE KX_PERR_C;
       62    10643        %INCLUDE KX_DATA_C;
       63    10711        %INCLUDE KX_SCODE_C;
       64    10777        %INCLUDE KL_MACRO_C;
       65    14129        %INCLUDE KL_AFCN_C;
       66    14230        %INCLUDE KL_CONTROL_C;
       67    14610        %INCLUDE KL_SUPER_C;
       68    17512        %INCLUDE K_ID_E;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:85   
       69    17562          %K#LYRID_E;
       70    17569          %K#ENTID_E;
       71    17588        %INCLUDE KV_PRMID_E;
       72    17762          %KV_PRMID_E; /* set and get param stuff            */
       73    17918        %INCLUDE KV_GLB_M; /*  VDH user macros                   */
       74    18040        %INCLUDE KA_GLBASM_E;
       75    18122        %INCLUDE KA_GLB_E;
       76    18200          %KA_HLTOTP_E;
       77    18209          %KA_INPFNC_E;
       78    18254
       79    18255        %INCLUDE KA_GLB;
       80    18332        %INCLUDE KV$USR;
       81    18644        %INCLUDE KV$VDH;
       82    19075        %INCLUDE KH$CHN; /* channel table items                */
       83    19197        %INCLUDE KH_CHN;
       84    19237        %INCLUDE KH_MACRO_C;
       85    19980        %INCLUDE K_ADDRESS_M;
       86    20483        %INCLUDE KNH_MACRO_C;
       87    20766        %EJECT;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:86   
       88    20767
       89    20768        /*****************************************************************
       90    20769        *                                                                *
       91    20770        *                           Based                                *
       92    20771        *                                                                *
       93    20772        *****************************************************************/
       94    20773
       95    20774        %KV$ERD; /*  VDH EXTENDED REAL DEVICE DEFINITION    */
       96    20858        %KV$MRD; /*  MASTER REAL DEVICE CONTEXT BLOCK  */
       97    20905        %KV$MVD; /*  MASTER VIRTUAL DEVICE CONTEXT BLOCK    */
       98    20949        %KV$PTR; /*  VDH POINTER BLOCK                 */
       99    20992        %KV$SSN; /*  SESSION CONTEXT                   */
      100    21071        %KV$VDI (STCLASS="BASED(VDI$)"); /*  VDI CONTEXT BLOCK                 */
      101    21142        %EQU KV_VDI=CHARTEXT('KV$VDI');
      102    21143        %KV$STR; /* stream context  */
      103    21230        %KV$TRNTBL; /*  TRANSLATE TABLE STUFF             */
      104    21288
      105    21289        %KV$OTPMRK;
      106    21316        %KX$X29_OTPBFR ( STCLASS = "BASED(DAT$)" ); /*  OUTPUT BUFFER TEMPLATE           */
      107    21339        %KX$X29 ( STCLASS = "BASED(X29$)" ); /*  X29 CONTEXT BLOCK               */
      108    21379        %KX$LINKDEV ( STCLASS = "BASED (CNTL$)" );
      109    21406        %KX$LINKDEV ( FPTN = B$LINKDEV, STCLASS = BASED );
      110    21433        %KX$VC_OTPBFR ( STCLASS = "BASED(DAT$)" ); /*  OUTPUT BUFFER TEMPLATE            */
      111    21460        %KX$VC ( STCLASS = "BASED(VC$)" ); /*  VC CONTEXT BLOCK               */
      112    21551        %KX$L3 ( STCLASS = "BASED(L3$)" );
      113    21954        %KX$L3 ( FPTN = KX$TL3, STCLASS = "BASED(TL3$)" );
      114    22357        %KX$TMRBLK ( FPTN = KX$BTMRBLK, STCLASS = BASED );
      115    22389        %KH$CHN;
      116    22513        %EQU TL3CHN = %CHARTEXT('KX$TL3.CHN$->KH$CHN');
      117    22514        %EQU L3CHN = %CHARTEXT('KX$L3.CHN$->KH$CHN');
      118    22515        %EQU KX_L2 = %CHARTEXT('KX$LINKDEV.L2$->KX$L2');
      119    22516
      120    22517    1   DCL CHRSTR CHAR(2000) CALIGNED BASED;
      121    22518    1   DCL Y$BYT(0:2000) UBIN BYTE CALIGNED BASED;
      122    22519    1   DCL PRTTBL CHAR(2000) CALIGNED BASED(PRTTBL$);
      123    22520    1   DCL BASED_WORD UBIN WORD BASED;
      124    22521        %G$JIT ( STCLASS = "BASED(G$JIT$)" );
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:87   
      125    22935        %VLP_SCODE ( FPTN=B$SCODE, STCLASS=BASED );
      126    22996        %KX$L2 ( STCLASS = BASED );
      127    23363    1   DCL B$STR CHAR(1000) BASED ALIGNED;
      128    23364    1   DCL 1 B$RLCID BASED ALIGNED,
      129    23365    1         2 * BIT (16),
      130    23366    1         2 RLCID UBIN WORD;
      131    23367
      132    23368        %EJECT;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:88   
      133    23369
      134    23370        /*****************************************************************
      135    23371        *                                                                *
      136    23372        *                           Symrefs                              *
      137    23373        *                                                                *
      138    23374        *****************************************************************/
      139    23375
      140    23376    1   DCL G$JIT$ PTR SYMREF;
      141    23377        %KV$STT (NAME = KV_STT, STCLASS = SYMREF);
      142    23771        %KV$USRPRM(NAME=KX_USRPRM,STCLASS=SYMREF); /* USRPRM STRUCTURE                */
      143    23822        %KV$VDH_DSC(NAME=KXX_VDH_DSC,STCLASS=SYMREF);
      144    23858        %KV$VDH_EVT(NAME=KV_VDH_EVT_RLSVDI,ID=KV_VDH_EVT_ID_RLSVDI,
      145    23859         STCLASS=SYMREF);
      146    23894        %KV$VDH_EVT (NAME=KV_VDH_EVT_RQSOTP, ID=KV_VDH_EVT_ID_RQSOTP,
      147    23895         STCLASS=SYMREF);
      148    23930        %KV$VDH_EVT(NAME=KV_VDH_EVT_CMPOTP,ID=KV_VDH_EVT_ID_CMPOTP,
      149    23931         STCLASS=SYMREF);
      150    23966        %KV$VDH_EVT ( NAME = KX_VDH_EVT_ATN, STCLASS = SYMREF );
      151    24001        %KV$VDH_OTPLCL(NAME = KV_VDH_OTPLCL, STCLASS = SYMREF);
      152    24074        %KV$VDH_OTPMRK(NAME = KV_VDH_OTPMRK, STCLASS = SYMREF);
      153    24136        %KV$VDH_SETCLK(NAME = KV_VDH_SETCLK, STCLASS = SYMREF);
      154    24172        %KV$VDH_DAT ( NAME = KV_VDH_DAT, STCLASS = SYMREF );
      155    24252
      156    24253        %KA_MSC;
      157    24275        %KX_DATA;
      158    24965        %KX_PRTTBL;
      159    24993        %KX_STATS_X29; /*  ASYNC STATS BUFFER TEMPLATE       */
      160    25334        %KA_TRNTBL_MSC; /*  ASYNC TRANSLATE TABLE ITEMS       */
      161    25355        %KH_CHNDAT;
      162    25373        %KH$CTLTBL ( FPTN = KH_CTLTBL, STCLASS = SYMREF );
      163    25585        %KV$ERD (NAME=KV_ERD,STCLASS="CONSTANT SYMDEF");
      164    25669        /*
      165    25670           get output buffer structure. Used by the marker request code
      166    25671           to call KAV$VDI itself.
      167    25672        */
      168    25673        %KV$USR_GETOTPBFR(NAME=KV_USR_GETOTPBFR,STCLASS=STATIC);
      169    25708
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:89   
      170    25709        /* Output buffer limit exceeded.                                              */
      171    25710
      172    25711    1   DCL KA_OTPBFRLMTEXC UBIN STATIC INIT(0);
      173    25712
      174    25713        /* constant array containing powers of 2 */
      175    25714
      176    25715    1   DCL Y_POWER_OF_2(0:15) UBIN WORD CONSTANT INIT(1,2,4,8,16,32,64,128,
      177    25716    1    256,512,1024,2048,4096,8192,16384,32768);
      178    25717    1   DCL 1 X28_PRTID CONSTANT,
      179    25718    1         2 BYT1 UBIN BYTE CALIGNED INIT(1),
      180    25719    1         2 BYT2 UBIN BYTE CALIGNED INIT(0),
      181    25720    1         2 BYT3 UBIN BYTE CALIGNED INIT(0),
      182    25721    1         2 BYT4 UBIN BYTE CALIGNED INIT(0);
      183    25722
      184    25723    1   DCL KX_BFR_BRK BIT(16) ALIGNED SYMREF;
      185    25724        %KX$VC ( FPTN = KX_VC, STCLASS = CONSTANT );
      186    25815        %VC$CAL ( FPTN = VC_CAL, STCLASS = SYMREF );
      187    25861        %VC$INT ( FPTN = VC_INT, STCLASS = SYMREF );
      188    25882        %VC$RST ( FPTN = VC_RST, STCLASS = SYMREF );
      189    25903        %VC$CLR ( FPTN = VC_CLR, STCLASS = SYMREF );
      190    25932        %KV$VDH_DAT ( NAME = KX_SND_DAT, STCLASS = SYMREF,
      191    25933           VDOVLPARY = KX_VDOVLPARY, DATMOD = %KV#DATMOD_TRN );
      192    26013        %KV$SND ( NAME = KX_VDOVLPARY, HDR = NO, VLP = YES, STCLASS = SYMREF );
      193    26046        %KV$VDOVLP_ERR ( NAME = KX_VDOVLP_ERR, STCLASS = CONSTANT SYMDEF );
      194    26143        %KV$VDOVLP_KEY ( NAME = KX_KEY_CAL_IND, STCLASS = SYMREF );
      195    26193        %KV$VDOVLP_KEY ( NAME = KX_KEY_CAL_CNF, STCLASS = SYMREF );
      196    26243        %KV$VDOVLP_KEY ( NAME = KX_KEY_DAT_IND, STCLASS = SYMREF );
      197    26293        %KV$VDOVLP_KEY ( NAME = KX_KEY_INT_IND, STCLASS = SYMREF );
      198    26343        %KV$VDOVLP_KEY ( NAME = KX_KEY_INT_CNF, STCLASS = SYMREF );
      199    26393        %KV$VDOVLP_KEY ( NAME = KX_KEY_RST_IND, STCLASS = SYMREF );
      200    26443        %KV$VDOVLP_KEY ( NAME = KX_KEY_RST_CNF, STCLASS = SYMREF );
      201    26493        %KV$VDOVLP_KEY ( NAME = KX_KEY_CLR_IND, STCLASS = SYMREF );
      202    26543        %KV$VDOVLP_KEY ( NAME = KX_KEY_INDX3, STCLASS = SYMREF );
      203    26593
      204    26594        /*
      205    26595           VLP_ERRCODEs
      206    26596        */
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:90   
      207    26597
      208    26598        %VLP_ERRCODE (STCLASS=CONSTANT,FCG='KX',MID='X',SEV=%G_WRSYSLOG_SEV_BAD_HARD#,
      209    26599                           FPTN = LINERRDSC,
      210    26600                           ERR# = %E_KXX_LINERRDSC# );
      211    26646        /*E*    ERROR:  KXX-E_KXX_LINERRDSC#-0
      212    26647              MESSAGE:  Excessive input line errors
      213    26648          DESCRIPTION:  An excessive number of parity errors was received.
      214    26649                       The count, in 1 minute, exceeded KA_LINERRLOGLMT.
      215    26650        */
      216    26651        %VLP_ERRCODE (STCLASS=SYMREF,FPTN=DEVLGNFAL);   /* symdef in KXP */
      217    26697        %VLP_ERRCODE (STCLASS=CONSTANT,FCG='KX',MID='X',SEV=%G_WRSYSLOG_SEV_SOFT#,
      218    26698                      FPTN=LGNRJC,
      219    26699                      ERR# = %E_KXX_LGNRJC# );
      220    26745        /*E*      ERROR:  KXX-E_KXX_LGNRJC#-0
      221    26746                MESSAGE:  Fail to logon to NODEADMN
      222    26747            DESCRIPTION:  NODEADMN possibly run out of room for devices.
      223    26748        */
      224    26749        %VLP_ERRCODE (STCLASS=CONSTANT,FCG='KX',MID='X',SEV=%G_WRSYSLOG_SEV_SOFT#,
      225    26750                      FPTN=X28_QBIT,
      226    26751                      ERR# = %E_KXX_X28QBIT# );
      227    26797        /*E*      ERROR:  KXX-E_KXX_X28QBIT#-0
      228    26798                MESSAGE:  sent Q-bit pkt on x.28 vc for host user.
      229    26799            DESCRIPTION:  Supposedly the host user meant it.
      230    26800        */
      231    26801        %VLP_ERRCODE (STCLASS=CONSTANT,FCG='KX',MID='X',SEV=%G_WRSYSLOG_SEV_SOFT#,
      232    26802                      FPTN=NOT_X28,
      233    26803                      ERR# = %E$BADVCX28 );
      234    26849        %VLP_ERRCODE (STCLASS=CONSTANT,FCG='KX',MID='X',SEV=%G_WRSYSLOG_SEV_SOFT#,
      235    26850                      FPTN=BAD_VCSTT,
      236    26851                      ERR# = %E$BADVCSTT );
      237    26897        %VLP_ERRCODE (STCLASS=CONSTANT,FCG='KX',MID='X',SEV=%G_WRSYSLOG_SEV_SOFT#,
      238    26898                      FPTN=UNK_VCFNC,
      239    26899                      ERR# = %E$BADVCFNC );
      240    26945
      241    26946        %VLP_ERRCODE (STCLASS=CONSTANT,FCG='KX',MID='P',SEV=%G_WRSYSLOG_SEV_SOFT#,
      242    26947                           FPTN = NO_L3CTX,
      243    26948                           ERR# = %E_KXP_NO_L3CTX# );
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:91   
      244    26994        %VLP_SCODE (FPTN=Y_UNKSCHRSN,STCLASS=CONSTANT,FCG=KX,MID=X,ERR#=%S$KX_UNKSCHRSN#);
      245    27055        %VLP_SCODE (FPTN=Y_UNKVDIEVT,STCLASS=CONSTANT,FCG=KX,MID=X,ERR#=%S$KX_UNKVDIEVT#);
      246    27116        %VLP_SCODE (FPTN=Y_UNKINPPRC,STCLASS=CONSTANT,FCG=KX,MID=X,ERR#=%S$KX_UNKINPPRC#);
      247    27177        %VLP_SCODE (FPTN=Y_UNKPRMID,STCLASS=CONSTANT,FCG=KX,MID=X,ERR#=%S$KX_UNKPRMID#);
      248    27238        %VLP_SCODE (FPTN=Y_UNKUSRFNC,STCLASS=CONSTANT,FCG=KX,MID=X,ERR#=%S$KX_UNKUSRFNC#);
      249    27299        %VLP_SCODE (FPTN=Y_NO_GET,STCLASS=CONSTANT,FCG=KX,MID=X,ERR#=%S$KX_NO_GET#);
      250    27360       %VLP_SCODE ( FPTN=Y_LINKDEVSTT,STCLASS=CONSTANT,FCG=KX,MID=X,ERR#=%S$KX_LINKDEVSTT#)
             27360            ;
      251    27421        %VLP_SCODE ( FPTN=Y_ILGDATSIZ,STCLASS=CONSTANT,FCG=KX,MID=X,ERR#=%S$KX_ILGDATSIZ#);
      252    27482        %VLP_SCODE ( FPTN=Y_NOMEM,STCLASS=CONSTANT,FCG=KX,MID=X,ERR#=%S$KX_NO_GET#);
      253    27543        %EJECT;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:92   
      254    27544
      255    27545        /*****************************************************************
      256    27546        *                                                                *
      257    27547        *                           Auto                                 *
      258    27548        *                                                                *
      259    27549        *****************************************************************/
      260    27550
      261    27551    1   DCL X29$ PTR;
      262    27552    1   DCL VC$ REDEF X29$ PTR;
      263    27553    1   DCL CNTL$ REDEF X29$ PTR;
      264    27554    1   DCL VDI$ PTR;
      265    27555    1   DCL DAT$ PTR;
      266    27556    1   DCL TEMP$ PTR;
      267    27557    1   DCL PRV$ PTR;
      268    27558    1   DCL TEMP1$ PTR;
      269    27559    1   DCL L3$ PTR;
      270    27560    1   DCL TL3$ PTR;
      271    27561    1   DCL Y@INDEX SBIN;
      272    27562    1   DCL CHRCNT UBIN;
      273    27563    1   DCL PRTTBL$ PTR;
      274    27564        %FPT_X25 ( FPTN = CALL_FPT, STCLASS = AUTO );
      275    27608    1   DCL FLWCTRPAD UBIN;
      276    27609    1   DCL PADECHO UBIN;
      277    27610    1   DCL Y@BYTSIZ UBIN;
      278    27611    1   DCL Y@BYTSIZ2 UBIN;
      279    27612        %VLP_ERRCODE ( STCLASS=AUTO,FPTN=ERCOD );
      280    27658        %KV$VDOVLP_ERR ( NAME=VDOVLP_ERR, STCLASS=AUTO );
      281    27755    1   DCL TEMP0 UBIN AUTO;
      282    27756    1   DCL LEVEL UBIN;
      283    27757        %KV$USR_EVT ( NAME = KV@USR_EVT, STCLASS = AUTO );
      284    27792    1   DCL Y@HLTOTP_ALL BIT(8);
      285    27793        /*
      286    27794           DCL AND REDEF FOR THE PARAMETER.
      287    27795        */
      288    27796    1   DCL PRM_USR_X CHAR(PRM_COPY);
      289    27797    1   DCL PRM_COPY REDEF PRM_USR_X UBIN;
      290    27798        %KV$USR_DAT(NAME=PRM_USR_DAT, /*  USER DATA                         */
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:93   
      291    27799         STCLASS=REDEF PRM_USR_X);
      292    27883        %KV$USR_EVT(NAME=PRM_USR_EVT, /*  REPORT EVENT TO USER              */
      293    27884         STCLASS=REDEF PRM_USR_X);
      294    27919        %KV$USR_EXTINPTRN(NAME=PRM_USR_EXTINPTRN,
      295    27920         STCLASS=REDEF PRM_USR_X);
      296    27956        %KV$USR_EXTOTPTRN(NAME=PRM_USR_EXTOTPTRN, /* USR EXTENDED OUTPUT TRANSLATION  */
      297    27957         STCLASS=REDEF PRM_USR_X);
      298    27993        %KV$USR_GETPRM(NAME=PRM_USR_GETPRM, /*  GET PARAMETER                     */
      299    27994         STCLASS=REDEF PRM_USR_X);
      300    28055        %KV$USR_GETOTPBFR(NAME=PRM_USR_GETOTPBFR, /* GET OTPBFR  ARGUMENT STRUCTURE   */
      301    28056         STCLASS=REDEF PRM_USR_X);
      302    28091        %KV$USR_INPPRC(NAME=PRM_USR_INPPRC, /*  INPUT PROCEDURE                   */
      303    28092         STCLASS=REDEF PRM_USR_X);
      304    28128        %KV$USR_OTPMRK(NAME=PRM_USR_OTPMRK, /*  USER MARKER REQUEST               */
      305    28129         STCLASS=REDEF PRM_USR_X);
      306    28191        %KV$USR_OTPRPTCHR(NAME=PRM_USR_OTPRPTCHR, /* OUTPUT REPEATED CHARACTER        */
      307    28192         STCLASS=REDEF PRM_USR_X);
      308    28227        %KV$USR_RQSDAT(NAME=PRM_USR_RQSDAT,
      309    28228         STCLASS=REDEF PRM_USR_X);
      310    28291        %KV$USR_SETPRM(NAME=PRM_USR_SETPRM, /*  USER SET PARAMETER ARGUMENT       */
      311    28292         STCLASS=REDEF PRM_USR_X);
      312    28354
      313    28355    1   DCL 1 Y_VDI_LCL ALIGNED,
      314    28356    1         2 BUF(0:3) CHAR(1) CALIGNED,
      315    28357        /* ACTUAL NUMBER OF BYTES TO BE OBTAINED FOR THE OUTPUT BUFFER                */
      316    28358    1         2 BYTSIZ UBIN WORD,
      317    28359        /* ABOVE EXPRESSED AS A LOG BASE 2                                            */
      318    28360    1         2 BYTSIZLOG2 UBIN WORD,
      319    28361        /* ACTUAL NUMBER OF BYTES NEEDED ON THIS GET BUFFER CALL                      */
      320    28362    1         2 SIGSIZ UBIN WORD,
      321    28363        /* NEXT COUNT*                                                                */
      322    28364    1         2 NXTCNT UBIN WORD,
      323    28365        /* CAUSE A SYNCHRONOUS FLOW CONTROL HALT AFTER THE REPEATED CHARACTERS.       */
      324    28366    1         2 SNCFLWCTRHLT BIT(1) ALIGNED;
      325    28367
      326    28368
      327    28369
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:94   
      328    28370        %KV$VDH_DSC(NAME = KV@VDH_DSC, STCLASS = AUTO);
      329    28406        %KV$VDH_OTPLCL(NAME = KV@VDH_OTPLCL, STCLASS = AUTO);
      330    28479        %KV$VDH_OTPMRK(NAME = KV@VDH_OTPMRK, STCLASS = AUTO);
      331    28541        %KV$VDH_SETCLK(NAME = KV@VDH_SETCLK, STCLASS = AUTO);
      332    28577        %KV$VDH_DAT(NAME = KV@VDH_DAT, STCLASS = AUTO);
      333    28657        %KV$VDH_DAT ( NAME=KV@SND_DAT, VDOVLPARY=KX_VDOVLPARY, STCLASS=AUTO );
      334    28737
      335    28738    1   DCL CNC_TYP UBIN;
      336    28739        /*****************************************************************
      337    28740        *                                                                *
      338    28741        *                           External Proc                        *
      339    28742        *                                                                *
      340    28743        *****************************************************************/
      341    28744
      342    28745    1   DCL KVV$VDI ENTRY (1) ALTRET;
      343    28746    1   DCL KXX$SNDX29MSG ENTRY (2) ALTRET;
      344    28747    1   DCL KXX$X29 ENTRY (1);
      345    28748    1   DCL KXS$GETL3 ENTRY (3) ALTRET;
      346    28749    1   DCL KXX$X28 ENTRY (1);
      347    28750    1   DCL KXV$VCVDH ENTRY (1) ALTRET;
      348    28751    1   DCL DWORD UBIN(32) SYMREF;
      349    28752    1   DCL KVM$SND REDEF DWORD EPTR;
      350    28753    1   DCL KXX$DFRINP ENTRY (1);
      351    28754    1   DCL KXX$MRK ENTRY (1);
      352    28755    1   DCL KXX$INTCNC ENTRY (2) ALTRET;
      353    28756    1   DCL KXX$RLSCTX ENTRY (1);
      354    28757    1   DCL KVB$RLSSYS ENTRY (2) ALTRET;
      355    28758    1   DCL KVB$RLS2NSYS ENTRY(2) ALTRET;
      356    28759    1   DCL KHD$SCREECH ENTRY (1);
      357    28760    1   DCL KVI$RE_DSPINP ENTRY;
      358    28761    1   DCL KXP$PACKET ENTRY (1) ALTRET;
      359    28762    1   DCL KXX$TRNOTP ENTRY (1) ALTRET;
      360    28763    1   DCL KVB$GETSYS ENTRY (2) ALTRET;
      361    28764    1   DCL KVB$GET2NSYS ENTRY(2) ALTRET;
      362    28765    1   DCL KHA$ERRLOG ENTRY (2) ALTRET;
      363    28766    1   DCL KXS$Q_SYSLOG ENTRY (1);
      364    28767    1   DCL KXS$SYSLOG ENTRY (7);
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:95   
      365    28768    1   DCL KXS$RLSL3 ENTRY (1);
      366    28769    1   DCL KHI$DISABLE ENTRY (1);
      367    28770    1   DCL KHI$ENABLE ENTRY;
      368    28771    1   DCL KHA$GET_CTX_PTR ENTRY (2) ALTRET;
      369    28772
      370    28773        /*****************************************************************
      371    28774        *                                                                *
      372    28775        *                           Procedure                            *
      373    28776        *                                                                *
      374    28777        *****************************************************************/
      375    28778
      376    28779    1       VDI$ = KV$PTR.VDI$;

  28779   2 000005  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          2 000008  DC86                                 LDB,B5   ,B6
          2 000009  DFC7 0008                            STB,B5   VDI$,AUTO

      377    28780    1       X29$ = %KV_VDI.USRCTX$;

  28780   2 00000B  CCC5 0002                            LDB,B4   2,B5
          2 00000D  CFC7 0006                            STB,B4   X29$,AUTO

      378    28781    1       IF KX$X29.SBR$ = ENTADDR(KXX$X29)

  28781   2 00000F  BB80 0000 0000  xent                 LAB,B3   KXX$X29
          2 000012  AC84                                 LDB,B2   ,B4
          2 000013  BFC7 0082                            STB,B3   WRDSIZ2N+3,AUTO
          2 000015  ADC7 0082                            CMB,B2   WRDSIZ2N+3,AUTO
          2 000017  0981 0006                            BNE      s:28785,PREL

      379    28782    1          THEN
      380    28783    1             CNC_TYP = %KXX_TYP_X29#;

  28783   2 000019  6C01                                 LDV,R6   1
          2 00001A  EF47 005F                            STR,R6   CNC_TYP,AUTO
          2 00001C  0F81 0013                            B        s:28791,PREL

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:96   
      381    28784    1          ELSE
      382    28785    1             IF KX$X29.SBR$ = ENTADDR(KXV$VCVDH)

  28785   2 00001E  AB80 0000 0000  xent                 LAB,B2   KXV$VCVDH
          2 000021  9C84                                 LDB,B1   ,B4
          2 000022  AFC7 0082                            STB,B2   WRDSIZ2N+3,AUTO
          2 000024  9DC7 0082                            CMB,B1   WRDSIZ2N+3,AUTO
          2 000026  0981 0006                            BNE      s:28789,PREL

      383    28786    1                THEN
      384    28787    1                   CNC_TYP = %KXX_TYP_LINKDEV#;

  28787   2 000028  6C03                                 LDV,R6   3
          2 000029  EF47 005F                            STR,R6   CNC_TYP,AUTO
          2 00002B  0F81 0004                            B        s:28791,PREL

      385    28788    1                ELSE
      386    28789    1                   CNC_TYP = %KXX_TYP_CNTL#;

  28789   2 00002D  6C02                                 LDV,R6   2
          2 00002E  EF47 005F                            STR,R6   CNC_TYP,AUTO

      387    28790
      388    28791    2       DO CASE( PRM_USR_EVT.FNC );

  28791   2 000030  BCC7 0004                            LDB,B3   @PRM_USR_X,AUTO
          2 000032  B283                                 LLH,R3   ,B3
          2 000033  3D10                                 CMV,R3   16
          2 000034  0281 0EB2                            BGE      s:30376,PREL
          2 000036  A830 0000 003C  02                   LDR,R2   s:28791+12,R3
          2 000039  83A0 0000 004C  02                   JMP      s:28798,R2
          2 00003C       0E9B                            DC       s:30376,PREL
          2 00003D       0000                            DC       s:28798,PREL
          2 00003E       0E9B                            DC       s:30376,PREL
          2 00003F       0E9B                            DC       s:30376,PREL
          2 000040       02A5                            DC       s:28994,PREL
          2 000041       0939                            DC       s:29585,PREL
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:97   
          2 000042       0E9B                            DC       s:30376,PREL
          2 000043       09E8                            DC       s:29710,PREL
          2 000044       0EA4                            DC       s:30384,PREL
          2 000045       0C07                            DC       s:30023,PREL
          2 000046       0CFC                            DC       s:30182,PREL
          2 000047       0E9B                            DC       s:30376,PREL
          2 000048       0E9B                            DC       s:30376,PREL
          2 000049       0DAA                            DC       s:30276,PREL
          2 00004A       0E9B                            DC       s:30376,PREL
          2 00004B       0DEE                            DC       s:30301,PREL

      389    28792
      390    28793        /* KV$USR_DAT - DATA. We get here if doing a transparent write                */
      391    28794        /* to a device that uses synchronous flow control.                            */
      392    28795
      393    28796    2          CASE(%KV_USR_FNC_DAT );

      394    28797                  %DISABLE;

  28798   2 00004C  AC80 0000 0002  xsym                 LDB,B2   KH_CTLTBL+2
          2 00004F  D802                                 LDR,R5   ,B2
          2 000050  DF47 0034                            STR,R5   LEVEL,AUTO

  28798   2 000052  9BC7 0034                            LAB,B1   LEVEL,AUTO
          2 000054  9FC7 0082                            STB,B1   WRDSIZ2N+3,AUTO
          2 000056  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 000058  CBF0 0100                            LAB,B4   256,IMO
          2 00005A  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          2 00005D       0001                            DC       s:28800,PREL

      395    28800    3             DO CASE ( CNC_TYP );

  28800   2 00005E  B847 005F                            LDR,R3   CNC_TYP,AUTO
          2 000060  3D04                                 CMV,R3   4
          2 000061  0281 027F                            BGE      s:28984,PREL
          2 000063  A830 0000 0069  02                   LDR,R2   s:28800+11,R3
          2 000066  83A0 0000 006D  02                   JMP      s:28802,R2
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:98   
          2 000069       0274                            DC       s:28984,PREL
          2 00006A       01D5                            DC       s:28940,PREL
          2 00006B       0015                            DC       s:28810,PREL
          2 00006C       0000                            DC       s:28802,PREL

      396    28801    3                CASE ( %KXX_TYP_LINKDEV# );

      397    28802    3                   IF PRM_USR_DAT.DAT__.DATBYTSIZ ~= 0

  28802   2 00006D  ECC7 0004                            LDB,B6   @PRM_USR_X,AUTO
          2 00006F  E846 0004                            LDR,R6   4,B6
          2 000071  6901 026F                            BEZ,R6   s:28984,PREL

      398    28803    3                      THEN
      399    28804    4                         DO;

      400    28805    4                            KX$VC.VDHENTERED = '1'B;

  28805   2 000073  DCC7 0006                            LDB,B5   X29$,AUTO
          2 000075  8945 0016                            LBT,'2000'X       22,B5
          2 000077       2000

      401    28806    4                            CALL Y$DECODE_FPT;

  28806   2 000078  E3C0 0F95                            LNJ,B6   s:0,PREL
          2 00007A       0001                            DC       s:28807,PREL

      402    28807    4                            KX$VC.VDHENTERED = '0'B;

  28807   2 00007B  ECC7 0006                            LDB,B6   X29$,AUTO
          2 00007D  8846 0016                            LBF,'2000'X       22,B6
          2 00007F       2000

      403    28808    4                         END;

  28808   2 000080  0F81 0260                            B        s:28984,PREL

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:99   
      404    28809    3                CASE ( %KXX_TYP_CNTL# );

      405    28810    3                   IF PRM_USR_DAT.DAT__.DATBYTSIZ ~= LENGTHC ( B$RLCID )

  28810   2 000082  ECC7 0004                            LDB,B6   @PRM_USR_X,AUTO
          2 000084  E846 0004                            LDR,R6   4,B6
          2 000086  6D04                                 CMV,R6   4
          2 000087  0901 000A                            BE       s:28817,PREL

      406    28811    3                      THEN
      407    28812        /*S* SCREECH_CODE: KXX-S$KX_ILGDATSIZ#
      408    28813             MESSAGE: Illegal data length on link device control connection.
      409    28814        */
      410    28815    3                         CALL KHD$SCREECH ( Y_ILGDATSIZ );

  28815   2 000089  BB80 0000 0000  03                   LAB,B3   0
          2 00008C  CBF0 0100                            LAB,B4   256,IMO
          2 00008E  E380 0000 0000  xent                 LNJ,B6   KHD$SCREECH
          2 000091       0001                            DC       s:28817,PREL

      411    28816
      412    28817    3                   IF KX$LINKDEV.OUTBOUND

  28817   2 000092  ECC7 0006                            LDB,B6   X29$,AUTO
          2 000094  82C6 0017                            LB,'0080'X        23,B6
          2 000096       0080
          2 000097  0581 015E                            BBF      s:28908,PREL

      413    28818    3                      THEN
      414    28819    4                         DO;

      415    28820    4                            IF KX$LINKDEV.CRCCNT >= KX$LINKDEV.CRC

  28820   2 000099  E846 0011                            LDR,R6   17,B6
          2 00009B  E946 0010                            CMR,R6   16,B6
          2 00009D  0281 0031                            BGE      s:28845,PREL

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:100  
      416    28821    4                               THEN
      417    28822    4                                  GOTO L_ALTRET2;
      418    28823    4                           CALL KXS$GETL3 ( KX$LINKDEV.L2$, L3$ ) ALTRET ( L_ALTRET2 )
             28823                                     ;

  28823   2 00009F  DBC7 0012                            LAB,B5   L3$,AUTO
          2 0000A1  DFC7 0084                            STB,B5   WRDSIZ2N+5,AUTO
          2 0000A3  CBC6 000A                            LAB,B4   10,B6
          2 0000A5  CFC7 0082                            STB,B4   WRDSIZ2N+3,AUTO
          2 0000A7  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 0000A9  CBF0 0200                            LAB,B4   512,IMO
          2 0000AB  E380 0000 0000  xent                 LNJ,B6   KXS$GETL3
          2 0000AE       0021                            DC       s:28845,PREL

      419    28824    4                           CALL KVB$GETSYS ( SIZEW(KH$CHN), KX$L3.CHN$ ) WHENALTRETURN

  28824   2 0000AF  EBF0 0020                            LAB,B6   32,IMO
          2 0000B1  DCC7 0012                            LDB,B5   L3$,AUTO
          2 0000B3  CBC5 0006                            LAB,B4   6,B5
          2 0000B5  CFC7 0084                            STB,B4   WRDSIZ2N+5,AUTO
          2 0000B7  EFC7 0082                            STB,B6   WRDSIZ2N+3,AUTO
          2 0000B9  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 0000BB  CBF0 0200                            LAB,B4   512,IMO
          2 0000BD  E380 0000 0000  xent                 LNJ,B6   KVB$GETSYS
          2 0000C0       0003                            DC       s:28825,PREL
          2 0000C1  0F81 0041                            B        s:28853,PREL

      420    28825    5                                  DO;

      421    28826    5   L_ALTRET1:                        CALL KXS$RLSL3 ( L3$ );

  28826   2 0000C3  EBC7 0012            L_ALTRET1       LAB,B6   L3$,AUTO
          2 0000C5  EFC7 0082                            STB,B6   WRDSIZ2N+3,AUTO
          2 0000C7  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 0000C9  CBF0 0100                            LAB,B4   256,IMO
          2 0000CB  E380 0000 0000  xent                 LNJ,B6   KXS$RLSL3
          2 0000CE       0001                            DC       s:28845,PREL
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:101  

      422    28827    5   L_ALTRET2:
      423    28828                                          %WRSYSLOG ( ERRCOD = NO_L3CTX,
      424    28829                                          TRMID = "KX$LINKDEV.CHN$->KH$CHN.TERMID" );

  28845   2 0000CF  ECC7 0006            L_ALTRET2       LDB,B6   X29$,AUTO
          2 0000D1  DCC6 0004                            LDB,B5   4,B6
          2 0000D3  CB80 0000 0000                       LAB,B4   0
          2 0000D6  CFC7 0086                            STB,B4   WRDSIZ2N+7,AUTO
          2 0000D8  BBC5 0012                            LAB,B3   18,B5
          2 0000DA  BFC7 0084                            STB,B3   WRDSIZ2N+5,AUTO
          2 0000DC  DB80 0000 0083  00                   LAB,B5   NO_L3CTX
          2 0000DF  DFC7 0082                            STB,B5   WRDSIZ2N+3,AUTO
          2 0000E1  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 0000E3  CBF0 0300                            LAB,B4   768,IMO
          2 0000E5  E380 0000 0000  xent                 LNJ,B6   KXS$SYSLOG
          2 0000E8       0001                            DC       s:28848,PREL

      425    28847                                          %ENABLE;

  28848   2 0000E9  EC80 0000 0002  xsym                 LDB,B6   KH_CTLTBL+2
          2 0000EC  E847 0034                            LDR,R6   LEVEL,AUTO
          2 0000EE  E906                                 CMR,R6   ,B6
          2 0000EF  0901 0007                            BE       s:28850,PREL

  28848   2 0000F1  CBF0 0000                            LAB,B4   0,IMO
          2 0000F3  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          2 0000F6       0001                            DC       s:28850,PREL

      426    28850    5                                     %KV_STR.ERR.COD = %E$CANTGETCTX;

  28850   2 0000F7  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          2 0000FA  DCC6 0004                            LDB,B5   4,B6
          2 0000FC  E870 05C8                            LDR,R6   1480,IMO
          2 0000FE  EF45 0013                            STR,R6   19,B5

      427    28851    5                                     ALTRETURN;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:102  

  28851   2 000100  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      428    28852    5                                  END;
      429    28853    4                            KX$L3.RLSCHN = '1'B;

  28853   2 000103  ECC7 0012                            LDB,B6   L3$,AUTO
          2 000105  8946 0029                            LBT,'0400'X       41,B6
          2 000107       0400

      430    28854    4                            CALL KVB$GETSYS ( SIZEW(KX$VC), TEMP$ ) ALTRET ( L_ALTRET1
             28854                                     );

  28854   2 000108  DBF0 0034                            LAB,B5   52,IMO
          2 00010A  CBC7 000C                            LAB,B4   TEMP$,AUTO
          2 00010C  CFC7 0084                            STB,B4   WRDSIZ2N+5,AUTO
          2 00010E  DFC7 0082                            STB,B5   WRDSIZ2N+3,AUTO
          2 000110  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 000112  CBF0 0200                            LAB,B4   512,IMO
          2 000114  E380 0000 0000  xent                 LNJ,B6   KVB$GETSYS
          2 000117       FFAC                            DC       s:28825,PREL

      431    28855    4                            KX$LINKDEV.CRCCNT = KX$LINKDEV.CRCCNT + 1;

  28855   2 000118  ECC7 0006                            LDB,B6   X29$,AUTO
          2 00011A  8AC6 0011                            INC      17,B6

      432    28856    4                            TEMP$->KX$VC = KX_VC;

  28856   2 00011C  AB80 0000 0040  00                   LAB,B2   KX_VC
          2 00011F  2C00                                 LDV,R2   0
          2 000120  6C67                                 LDV,R6   103
          2 000121  BCC7 000C                            LDB,B3   TEMP$,AUTO
          2 000123  3C00                                 LDV,R3   0
          2 000124  0008                                 MMM

      433    28857    4                            KX_STATS_X29.KHSTT.CTXBYTUTL =
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:103  

  28857   2 000125  8C80 0000 0020  xsym                 LDI      KX_STATS_X29+32
          2 000128  8470 0000 0068                       AID      104,IMO
          2 00012B  8D00 0000 0020  xsym                 SDI      KX_STATS_X29+32

      434    28858    4                               SIZEC(KX$VC) + KX_STATS_X29.KHSTT.CTXBYTUTL;
      435    28859    4                            KX_STATS_X29.CIRCUITS = KX_STATS_X29.CIRCUITS + 1;

  28859   2 00012E  8A80 0000 004B  xsym                 INC      KX_STATS_X29+75
          2 000131  8E80 0000 004A  xsym                 CAD      KX_STATS_X29+74

      436    28860    4                            KX_STATS_X29.LINSPDDST(15) =

  28860   2 000134  8A80 0000 0041  xsym                 INC      KX_STATS_X29+65
          2 000137  8E80 0000 0040  xsym                 CAD      KX_STATS_X29+64

      437    28861    4                               KX_STATS_X29.LINSPDDST(15) + 1;
      438    28862    4                            TEMP$->KX$VC.BLNK$ = KX$LINKDEV.L4_TAIL$;

  28862   2 00013A  ECC7 0006                            LDB,B6   X29$,AUTO
          2 00013C  DCC6 000E                            LDB,B5   14,B6
          2 00013E  CCC7 000C                            LDB,B4   TEMP$,AUTO
          2 000140  DFC4 000A                            STB,B5   10,B4

      439    28863    4                            TEMP$->KX$VC.FLNK$ = ADDR(NIL);

  28863   2 000142  DB80 0000 0000                       LAB,B5   0
          2 000145  CCC7 000C                            LDB,B4   TEMP$,AUTO
          2 000147  DFC4 0008                            STB,B5   8,B4

      440    28864    4                            TEMP$->KX$VC.L3$ = L3$;

  28864   2 000149  DCC7 0012                            LDB,B5   L3$,AUTO
          2 00014B  CCC7 000C                            LDB,B4   TEMP$,AUTO
          2 00014D  DFC4 0006                            STB,B5   6,B4

      441    28865    4                            TEMP$->KX$VC.CNTL$ = CNTL$;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:104  

  28865   2 00014F  ECC7 0006                            LDB,B6   X29$,AUTO
          2 000151  DCC7 000C                            LDB,B5   TEMP$,AUTO
          2 000153  EFC5 0012                            STB,B6   18,B5

      442    28866    4                            IF KX$LINKDEV.L4_TAIL$ ~= ADDR(NIL)

  28866   2 000155  8DC6 000E                            CMN      14,B6
          2 000157  0901 0007                            BE       s:28870,PREL

      443    28867    4                               THEN
      444    28868    4                                  KX$LINKDEV.L4_TAIL$->KX$VC.FLNK$ = TEMP$;

  28868   2 000159  CCC6 000E                            LDB,B4   14,B6
          2 00015B  DFC4 0008                            STB,B5   8,B4
          2 00015D  0F81 0003                            B        s:28871,PREL

      445    28869    4                               ELSE
      446    28870    4                                  KX$LINKDEV.L4_HEAD$ = TEMP$;

  28870   2 00015F  DFC6 000C                            STB,B5   12,B6

      447    28871    4                            KX$LINKDEV.L4_TAIL$ = TEMP$;

  28871   2 000161  DCC7 000C                            LDB,B5   TEMP$,AUTO
          2 000163  DFC6 000E                            STB,B5   14,B6

      448    28872    4                           TEMP$->KX$VC.RLCID_STRING = SUBSTR ( PRM_USR_DAT.DAT__.ADR$
             28872                                     ->B$STR,

  28872   2 000165  CCC7 0004                            LDB,B4   @PRM_USR_X,AUTO
          2 000167  BCC4 0001                            LDB,B3   1,B4
          2 000169  E844 0003                            LDR,R6   3,B4
          2 00016B  AB83                                 LAB,B2   ,B3
          2 00016C  A856                                 LDR,R2   R6
          2 00016D  6C04                                 LDV,R6   4
          2 00016E  BB85                                 LAB,B3   ,B5
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:105  
          2 00016F  3C5E                                 LDV,R3   94
          2 000170  0008                                 MMM

      449    28873    4                               PRM_USR_DAT.DAT__.BYTX, LENGTHC(B$RLCID) );
      450    28874    4                            KX$L3.TYP = %KX_VC_TYP_OUTBOUND#;

  28874   2 000171  ECC7 0012                            LDB,B6   L3$,AUTO
          2 000173  6C04                                 LDV,R6   4
          2 000174  EF46 0013                            STR,R6   19,B6

      451    28875    4                            KX$L3.CM$ = TEMP$;

  28875   2 000176  ECC7 000C                            LDB,B6   TEMP$,AUTO
          2 000178  ACC7 0012                            LDB,B2   L3$,AUTO
          2 00017A  EFC2 0004                            STB,B6   4,B2

      452    28876    4                            %L3CHN = KX$LINKDEV.CHN$->KH$CHN;

  28876   2 00017C  ECC7 0012                            LDB,B6   L3$,AUTO
          2 00017E  ACC6 0006                            LDB,B2   6,B6
          2 000180  9CC7 0006                            LDB,B1   X29$,AUTO
          2 000182  ECC1 0004                            LDB,B6   4,B1
          2 000184  AFC7 0082                            STB,B2   WRDSIZ2N+3,AUTO
          2 000186  AB86                                 LAB,B2   ,B6
          2 000187  2C00                                 LDV,R2   0
          2 000188  6C40                                 LDV,R6   64
          2 000189  BCC7 0082                            LDB,B3   WRDSIZ2N+3,AUTO
          2 00018B  3C00                                 LDV,R3   0
          2 00018C  0008                                 MMM

      453    28877    4                            %L3CHN.CTX$ = L3$;

  28877   2 00018D  ECC7 0012                            LDB,B6   L3$,AUTO
          2 00018F  ACC6 0006                            LDB,B2   6,B6
          2 000191  EFC2 000C                            STB,B6   12,B2

      454    28878    4                            %L3CHN.LNK$ = ADDR(NIL);
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:106  

  28878   2 000193  ECC7 0012                            LDB,B6   L3$,AUTO
          2 000195  ACC6 0006                            LDB,B2   6,B6
          2 000197  9B80 0000 0000                       LAB,B1   0
          2 00019A  9FC2 001C                            STB,B1   28,B2

      455    28879    4                            %L3CHN.TERMID.LEV = %TERMINAL_ID_LEV_SUBCHAN#;

  28879   2 00019C  ACC6 0006                            LDB,B2   6,B6
          2 00019E  6C02                                 LDV,R6   2
          2 00019F  EAC2 0012                            SRM,R6,'00FF'X    18,B2
          2 0001A1       00FF

      456    28880    4                            %L3CHN.TERMID.TTYP = %KLTY_VIRCIR#;

  28880   2 0001A2  ECC7 0012                            LDB,B6   L3$,AUTO
          2 0001A4  ACC6 0006                            LDB,B2   6,B6
          2 0001A6  5C08                                 LDV,R5   8
          2 0001A7  D7C2 0012                            STH,R5   18,B2

      457    28881        /*
      458    28882            find an available subdevice number for this L3.
      459    28883        */
      460    28884    5                            DO TEMP0 = 1 TO 4095;

  28884   2 0001A9  4C01                                 LDV,R4   1
          2 0001AA  CF47 0033                            STR,R4   TEMP0,AUTO

      461    28885    5                               TL3$ = KX$LINKDEV.L2$->KX$L2.L3_HEAD$;

  28885   2 0001AC  ECC7 0006                            LDB,B6   X29$,AUTO
          2 0001AE  DCC6 000A                            LDB,B5   10,B6
          2 0001B0  CCC5 0034                            LDB,B4   52,B5
          2 0001B2  CFC7 0014                            STB,B4   TL3$,AUTO

      462    28886    6                               DO WHILE ( TL3$ ~= L3$ AND

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:107  
  28886   2 0001B4  0F81 0006                            B        s:28890,PREL

      463    28887    6                                  ( %TL3CHN.TERMID.LEV ~= %TERMINAL_ID_LEV_SUBCHAN#
      464    28888    6                                  OR %TL3CHN.TERMID.TERM.SUBDEVICE ~= TEMP0 ));
      465    28889    6                                  TL3$ = KX$TL3.NEXT$;

  28889   2 0001B6  ECC7 0014                            LDB,B6   TL3$,AUTO
          2 0001B8  DC86                                 LDB,B5   ,B6
          2 0001B9  DFC7 0014                            STB,B5   TL3$,AUTO

      466    28890    6                               END;  /* do while ( tl3$... */

  28890   2 0001BB  ECC7 0014                            LDB,B6   TL3$,AUTO
          2 0001BD  EDC7 0012                            CMB,B6   L3$,AUTO
          2 0001BF  0901 000E                            BE       s:28891,PREL
          2 0001C1  DCC6 0006                            LDB,B5   6,B6
          2 0001C3  E845 0012                            LDR,R6   18,B5
          2 0001C5  E570 00FF                            AND,R6   255,IMO
          2 0001C7  6D02                                 CMV,R6   2
          2 0001C8  09EE                                 BNE      s:28889,SPREL
          2 0001C9  D845 0014                            LDR,R5   20,B5
          2 0001CB  D947 0033                            CMR,R5   TEMP0,AUTO
          2 0001CD  09E9                                 BNE      s:28889,SPREL

      467    28891    5                               IF TL3$ = L3$

  28891   2 0001CE  EDC7 0012                            CMB,B6   L3$,AUTO
          2 0001D0  0981 000D                            BNE      s:28897,PREL

      468    28892    5                                  THEN
      469    28893    6                                     DO;

      470    28894    6                                        %L3CHN.TERMID.TERM.SUBDEVICE = TEMP0;

  28894   2 0001D2  DCC7 0012                            LDB,B5   L3$,AUTO
          2 0001D4  CCC5 0006                            LDB,B4   6,B5
          2 0001D6  E847 0033                            LDR,R6   TEMP0,AUTO
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:108  
          2 0001D8  EF44 0014                            STR,R6   20,B4

      471    28895    6                                        TEMP0 = 4096;

  28895   2 0001DA  E870 1000                            LDR,R6   4096,IMO
          2 0001DC  EF47 0033                            STR,R6   TEMP0,AUTO

      472    28896    6                                     END;

      473    28897    5                            END; /* do temp0 = ... */

  28897   2 0001DE  8AC7 0033                            INC      TEMP0,AUTO
          2 0001E0  E847 0033                            LDR,R6   TEMP0,AUTO
          2 0001E2  E970 0FFF                            CMR,R6   4095,IMO
          2 0001E4  03C8                                 BLE      s:28885,SPREL

      474    28898        /*
      475    28899           give this new L3 a kick.
      476    28900        */
      477    28901    4                            VC$ = TEMP$;

  28901   2 0001E5  DCC7 000C                            LDB,B5   TEMP$,AUTO
          2 0001E7  DFC7 0006                            STB,B5   X29$,AUTO

      478    28902    4                            TEMP0 = %KX_P_EV_START#;

  28902   2 0001E9  6C01                                 LDV,R6   1
          2 0001EA  EF47 0033                            STR,R6   TEMP0,AUTO

      479    28903    4                            TEMP1$ = ADDR(NIL);

  28903   2 0001EC  CB80 0000 0000                       LAB,B4   0
          2 0001EF  CFC7 0010                            STB,B4   TEMP1$,AUTO

      480    28904    4                            CALL Y$CAL_PAC;

  28904   2 0001F1  E3C0 0DCA                            LNJ,B6   s:0,PREL
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:109  
          2 0001F3       0001                            DC       s:28905,PREL

      481    28905    4                         END;

  28905   2 0001F4  0F81 0038                            B        s:28933,PREL

      482    28906    3                      ELSE
      483    28907    4                         DO;  /* this rlcid is for an incoming vc */

      484    28908    4                            TEMP$ = KX$LINKDEV.L4_HEAD$;

  28908   2 0001F6  DCC6 000C                            LDB,B5   12,B6
          2 0001F8  DFC7 000C                            STB,B5   TEMP$,AUTO

      485    28909    5                            DO WHILE ( TEMP$ ~= ADDR(NIL)

  28909   2 0001FA  0F81 0007                            B        s:28913,PREL

      486    28910    5                               AND ( TEMP$->KX$VC.VDI$ ~= ADDR(NIL)
      487    28911    5                               OR TEMP$->KX$VC.STATE ~= %KX_VC_ST_RMTDCL# ) );
      488    28912    5                               TEMP$ = TEMP$->KX$VC.FLNK$;

  28912   2 0001FC  ECC7 000C                            LDB,B6   TEMP$,AUTO
          2 0001FE  DCC6 0008                            LDB,B5   8,B6
          2 000200  DFC7 000C                            STB,B5   TEMP$,AUTO

      489    28913    5                            END;  /* do while ( temp$...) */

  28913   2 000202  8DC7 000C                            CMN      TEMP$,AUTO
          2 000204  0901 0008                            BE       s:28914,PREL
          2 000206  8DC5 0002                            CMN      2,B5
          2 000208  09F4                                 BNE      s:28912,SPREL
          2 000209  E2C5 0033                            LLH,R6   51,B5
          2 00020B  6D02                                 CMV,R6   2
          2 00020C  09F0                                 BNE      s:28912,SPREL

      490    28914    4                            IF TEMP$ = ADDR(NIL)
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:110  

  28914   2 00020D  8DC7 000C                            CMN      TEMP$,AUTO
          2 00020F  0901 FEBF                            BE       s:28845,PREL

      491    28915    4                               THEN
      492    28916    4                                  GOTO L_ALTRET2;
      493    28917    4                           TEMP$->KX$VC.RLCID_STRING = SUBSTR ( PRM_USR_DAT.DAT__.ADR$
             28917                                     ->B$STR,

  28917   2 000211  ECC7 0004                            LDB,B6   @PRM_USR_X,AUTO
          2 000213  CCC6 0001                            LDB,B4   1,B6
          2 000215  E846 0003                            LDR,R6   3,B6
          2 000217  AB84                                 LAB,B2   ,B4
          2 000218  A856                                 LDR,R2   R6
          2 000219  6C04                                 LDV,R6   4
          2 00021A  BB85                                 LAB,B3   ,B5
          2 00021B  3C5E                                 LDV,R3   94
          2 00021C  0008                                 MMM

      494    28918    4                               PRM_USR_DAT.DAT__.BYTX, LENGTHC(B$RLCID) );
      495    28919    4                            CALL KXX$INTCNC ( TEMP$->KX$VC, TEMP$->KX$VC.RLCID )ALTRET
             28919                                     (L_ALTRET2);

  28919   2 00021D  9CC7 000C                            LDB,B1   TEMP$,AUTO
          2 00021F  EBC1 002F                            LAB,B6   47,B1
          2 000221  EFC7 0084                            STB,B6   WRDSIZ2N+5,AUTO
          2 000223  9FC7 0082                            STB,B1   WRDSIZ2N+3,AUTO
          2 000225  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 000227  CBF0 0200                            LAB,B4   512,IMO
          2 000229  E380 0000 0000  xent                 LNJ,B6   KXX$INTCNC
          2 00022C       FEA3                            DC       s:28845,PREL

      496    28920    4                         END;

      497    28921                        %KV$RQSOTP ( RQSOTP = YES );
             28933    4           IF NOT KV$VDI.RQSOTP  THEN DO;

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:111  
  28933   2 00022D  ECC7 0008                            LDB,B6   VDI$,AUTO
          2 00022F  82C6 0019                            LB,'0008'X        25,B6
          2 000231       0008
          2 000232  0501 00AE                            BBT      s:28984,PREL

             28934    4              KV$VDI.RQSOTP = '1'B;

  28934   2 000234  8946 0019                            LBT,'0008'X       25,B6
  28934   2 000236       0008

             28935    4              CALL KVV$VDI(KV_VDH_EVT_RQSOTP);

  28935   2 000237  BB80 0000 0002  03                   LAB,B3   +2
          2 00023A  CBF0 0100                            LAB,B4   256,IMO
          2 00023C  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          2 00023F       0001                            DC       s:28936,PREL

             28936    4              END;                         /* END IF                             */

  28936   2 000240  0F81 00A0                            B        s:28984,PREL

      498    28939    3                CASE ( %KXX_TYP_X29# );

      499    28940    3                   CHRCNT = %KV_VDI.OTPBFR_.BYTX - KX$X29.PRTX;

  28940   2 000242  ECC7 0008                            LDB,B6   VDI$,AUTO
          2 000244  DCC7 0006                            LDB,B5   X29$,AUTO
          2 000246  E846 000C                            LDR,R6   12,B6
          2 000248  E245 0019                            SUB,R6   25,B5
          2 00024A  EF47 0017                            STR,R6   CHRCNT,AUTO

      500    28941    3                   IF %KV_VDI.OTPBFR_.ADR$ ~= ADDR(NIL) AND

  28941   2 00024C  8DC6 000A                            CMN      10,B6
          2 00024E  0901 002A                            BE       s:28951,PREL
          2 000250  6901 0028                            BEZ,R6   s:28951,PREL
          2 000252  D2C6 0019                            LLH,R5   25,B6
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:112  
          2 000254  5D04                                 CMV,R5   4
          2 000255  0901 0023                            BE       s:28951,PREL
          2 000257  5901 0021                            BEZ,R5   s:28951,PREL

      501    28942    3                      CHRCNT > 0 AND
      502    28943    3                      %KV_VDI.PRTTYP ~= %KV_PRTTYP_ZERO AND
      503    28944    3                      %KV_VDI.PRTTYP ~= %KV_PRTTYP_NONE
      504    28945    3                      THEN
      505    28946    4                         DO;

      506    28947    4                            PRTTBL$ = KX_PRT_$ ( %KV_VDI.PRTTYP );

  28947   2 000259  9855                                 LDR,R1   R5
          2 00025A  CC90 0000 0000  xsym                 LDB,B4   KX_PRT_$,R1
          2 00025D  CFC7 0018                            STB,B4   PRTTBL$,AUTO

      507    28948    4                            CALL XLATE ( SUBSTR( %KV_VDI.OTPBFR_.ADR$->CHRSTR, KX$X29.
             28948                                     PRTX, CHRCNT ),

  28948   2 00025F  BCC6 000A                            LDB,B3   10,B6
          2 000261  C845 0019                            LDR,R4   25,B5
          2 000263  B800 0000 0004  03                   LDR,R3   +4
          2 000266  EBB0 0000 0000  02                   LAB,B6   s:10,R3
          2 000269  CF47 0082                            STR,R4   WRDSIZ2N+3,AUTO
          2 00026B  BFC7 0083                            STB,B3   WRDSIZ2N+4,AUTO
          2 00026D  AB83                                 LAB,B2   ,B3
          2 00026E  A854                                 LDR,R2   R4
          2 00026F  BB82                                 LAB,B3   ,B2
          2 000270  B852                                 LDR,R3   R2
          2 000271  F856                                 LDR,R7   R6
          2 000272  9B84                                 LAB,B1   ,B4
          2 000273  1C00                                 LDV,R1   0
          2 000274  D870 00FF                            LDR,R5   255,IMO
          2 000276  D380 0000 0000  xent                 LNJ,B5   X6C_MAT

      508    28949    4                               PRTTBL, SUBSTR( %KV_VDI.OTPBFR_.ADR$->CHRSTR, KX$X29.
             28949                                        PRTX, CHRCNT ) );
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:113  
      509    28950    4                         END;

      510    28951    3                   KX$X29.PRTX = %KV_VDI.OTPBFR_.BYTX;

  28951   2 000279  ECC7 0006                            LDB,B6   X29$,AUTO
          2 00027B  DCC7 0008                            LDB,B5   VDI$,AUTO
          2 00027D  E845 000C                            LDR,R6   12,B5
          2 00027F  EF46 0019                            STR,R6   25,B6

      511    28952    3                   KV@VDH_OTPLCL = KV_VDH_OTPLCL;

  28952   2 000281  AB80 0000 0000  xsym                 LAB,B2   KV_VDH_OTPLCL
          2 000284  2C00                                 LDV,R2   0
          2 000285  6C0A                                 LDV,R6   10
          2 000286  BBC7 0041                            LAB,B3   KV@VDH_OTPLCL,AUTO
          2 000288  3C00                                 LDV,R3   0
          2 000289  0008                                 MMM

      512    28953    3                   KV@VDH_OTPLCL.TRN = '1'B;

  28953   2 00028A  8947 0041                            LBT,'0040'X       KV@VDH_OTPLCL,AUTO
  28953   2 00028C       0040

      513    28954    3                   KV@VDH_OTPLCL.BFR_.ADR$ = PRM_USR_DAT.DAT__.ADR$;

  28954   2 00028D  ECC7 0004                            LDB,B6   @PRM_USR_X,AUTO
          2 00028F  DCC6 0001                            LDB,B5   1,B6
          2 000291  DFC7 0042                            STB,B5   KV@VDH_OTPLCL+1,AUTO

      514    28955    3                   KV@VDH_OTPLCL.BFR_.BYTX = PRM_USR_DAT.DAT__.BYTX;

  28955   2 000293  E846 0003                            LDR,R6   3,B6
          2 000295  EF47 0044                            STR,R6   KV@VDH_OTPLCL+3,AUTO

      515    28956    3                   KV@VDH_OTPLCL.BFR_.BYTSIZ = PRM_USR_DAT.DAT__.DATBYTSIZ;

  28956   2 000297  D846 0004                            LDR,R5   4,B6
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:114  
          2 000299  DF47 0045                            STR,R5   KV@VDH_OTPLCL+4,AUTO

      516    28957    3                  %KV_VDI.OTPCHRCNTAFTLF = %KV_VDI.OTPCHRCNTAFTLF+%KV_VDI.TMPOTPCHRCNT
             28957                            ;

  28957   2 00029B  CCC7 0008                            LDB,B4   VDI$,AUTO
          2 00029D  C844 001C                            LDR,R4   28,B4
          2 00029F  CA44 0015                            ADD,R4   21,B4
          2 0002A1  CF44 001C                            STR,R4   28,B4

      517    28958    3                  KX$X29.OTPCHRCNTUTLHLT = KX$X29.OTPCHRCNTUTLHLT-%KV_VDI.TMPOTPCHRCNT
             28958                            ;

  28958   2 0002A3  DCC7 0006                            LDB,B5   X29$,AUTO
          2 0002A5  E845 0013                            LDR,R6   19,B5
          2 0002A7  E244 0015                            SUB,R6   21,B4
          2 0002A9  EF45 0013                            STR,R6   19,B5

      518    28959    3                   %KV_VDI.TMPOTPCHRCNT = 0;

  28959   2 0002AB  8744 0015                            CL       21,B4

      519    28960    3                   IF (KV@VDH_OTPLCL.BFR_.BYTSIZ >= KX$X29.OTPCHRCNTUTLHLT)

  28960   2 0002AD  E847 0045                            LDR,R6   KV@VDH_OTPLCL+4,AUTO
          2 0002AF  6801 0005                            BLZ,R6   s:28967,PREL
          2 0002B1  E945 0013                            CMR,R6   19,B5
          2 0002B3  0801 001D                            BAL      s:28980,PREL

      520    28961    3                      THEN
      521    28962    4                         DO;

      522    28963
      523    28964        /* The data in this record would require a flow control halt in               */
      524    28965        /* the middle of the record. Do the halt now.                                 */
      525    28966
      526    28967    4                            CALL Y$SNCFLWCTRHLT ;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:115  

  28967   2 0002B5  BB80 0000 0000                       LAB,B3   0
          2 0002B8  BFC7 0062                            STB,B3   CNC_TYP+3,AUTO
          2 0002BA  E3C0 0C38                            LNJ,B6   s:0,PREL
          2 0002BC       0001                            DC       s:28968,PREL

      527    28968    4                            KX$X29.PRTX4NXTBFR = KV@VDH_OTPLCL.BFR_.BYTSIZ + LENGTHC (
             28968                                     KX$X29_OTPBFR );

  28968   2 0002BD  ECC7 0006                            LDB,B6   X29$,AUTO
          2 0002BF  E847 0045                            LDR,R6   KV@VDH_OTPLCL+4,AUTO
          2 0002C1  6E08                                 ADV,R6   8
          2 0002C2  EF46 001A                            STR,R6   26,B6

      528    28969    4                            IF (KV@VDH_OTPLCL.BFR_.BYTSIZ >= KX$X29.OTPCHRCNTUTLHLT)

  28969   2 0002C4  D847 0045                            LDR,R5   KV@VDH_OTPLCL+4,AUTO
          2 0002C6  5801 0005                            BLZ,R5   s:28976,PREL
          2 0002C8  D946 0013                            CMR,R5   19,B6
          2 0002CA  0801 000A                            BAL      s:28981,PREL

      529    28970    4                               THEN
      530    28971    5                                  DO;

      531    28972
      532    28973        /* The data in this record would require a flow control halt in               */
      533    28974        /* the middle of the record. Adjust the counter up to avoid that.             */
      534    28975
      535    28976    5                                    KX$X29.OTPCHRCNTUTLHLT = KV@VDH_OTPLCL.BFR_.BYTSIZ
             28976                                              +1;

  28976   2 0002CC  5E01                                 ADV,R5   1
          2 0002CD  DF46 0013                            STR,R5   19,B6

      536    28977    5                                  END /* IF */;

      537    28978    4                         END /* IF */;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:116  

  28978   2 0002CF  0F81 0005                            B        s:28981,PREL

      538    28979    3                      ELSE
      539    28980    3                         KX$X29.PRTX = KX$X29.PRTX + KV@VDH_OTPLCL.BFR_.BYTSIZ;

  28980   2 0002D1  EA45 0019                            ADD,R6   25,B5
          2 0002D3  EF45 0019                            STR,R6   25,B5

      540    28981    3                   CALL KVV$VDI(KV@VDH_OTPLCL) ;

  28981   2 0002D5  EBC7 0041                            LAB,B6   KV@VDH_OTPLCL,AUTO
          2 0002D7  EFC7 0082                            STB,B6   WRDSIZ2N+3,AUTO
          2 0002D9  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 0002DB  CBF0 0100                            LAB,B4   256,IMO
          2 0002DD  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          2 0002E0       0001                            DC       s:28984,PREL

      541    28982    3             END; /*  do case ( cnctyp ) */

      542    28983                  %ENABLE;

  28984   2 0002E1  EC80 0000 0002  xsym                 LDB,B6   KH_CTLTBL+2
          2 0002E4  E847 0034                            LDR,R6   LEVEL,AUTO
          2 0002E6  E906                                 CMR,R6   ,B6
          2 0002E7  0901 0C08                            BE       s:30384,PREL

  28984   2 0002E9  CBF0 0000                            LAB,B4   0,IMO
          2 0002EB  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          2 0002EE       0001                            DC       s:28984+14,PREL
          2 0002EF  0F81 0C00                            B        s:30384,PREL

      543    28986
      544    28987        %EJECT;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:117  
      545    28988        /* KV$USR_FNC_EVT - REPORT EVENT                                              */
      546    28989
      547    28990    2          CASE(%KV_USR_FNC_EVT );

      548    28991
      549    28992        /* BRANCH OUT DEPENDING ON THE EVENT REPORTED                                 */
      550    28993
      551    28994    3             DO CASE( PRM_USR_EVT.ID );

  28994   2 0002F1  9803                                 LDR,R1   ,B3
          2 0002F2  9570 007F                            AND,R1   127,IMO
          2 0002F4  1D12                                 CMV,R1   18
          2 0002F5  0281 0684                            BGE      s:29575,PREL
          2 0002F7  B810 0000 02FD  02                   LDR,R3   s:28994+12,R1
          2 0002FA  83B0 0000 030F  02                   JMP      s:29008,R3
          2 0002FD       066B                            DC       s:29575,PREL
          2 0002FE       066B                            DC       s:29575,PREL
          2 0002FF       0663                            DC       s:29568,PREL
          2 000300       0000                            DC       s:29008,PREL
          2 000301       019E                            DC       s:29135,PREL
          2 000302       01A9                            DC       s:29142,PREL
          2 000303       01EF                            DC       s:29159,PREL
          2 000304       021A                            DC       s:29176,PREL
          2 000305       0573                            DC       s:29500,PREL
          2 000306       055C                            DC       s:29487,PREL
          2 000307       065E                            DC       s:29563,PREL
          2 000308       0226                            DC       s:29183,PREL
          2 000309       0365                            DC       s:29325,PREL
          2 00030A       0495                            DC       s:29416,PREL
          2 00030B       04BE                            DC       s:29436,PREL
          2 00030C       02AC                            DC       s:29243,PREL
          2 00030D       066B                            DC       s:29575,PREL
          2 00030E       0543                            DC       s:29479,PREL

      552    28995
      553    28996    3                CASE(%KV_USR_EVT_ID_DLTOTP );

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:118  
      554    28997
      555    28998        /* PURGE ALL Q'D OUTPUT TO THE REAL DEVICE                                    */
      556    28999
      557    29000        /*
      558    29001                      Delete output buffers (with pure user data) waiting to
      559    29002                      go out on a virtual circuit. X.29 messages scattered
      560    29003                      in the chain will be relocated to the end of the chain,
      561    29004                      order preserved, and NXTLOD$ will point to the first
      562    29005                      of these X.29 messages.
      563    29006        */
      564    29007                        %DISABLE;

  29008   2 00030F  AC80 0000 0002  xsym                 LDB,B2   KH_CTLTBL+2
          2 000312  D802                                 LDR,R5   ,B2
          2 000313  DF47 0034                            STR,R5   LEVEL,AUTO

  29008   2 000315  9BC7 0034                            LAB,B1   LEVEL,AUTO
          2 000317  9FC7 0082                            STB,B1   WRDSIZ2N+3,AUTO
          2 000319  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 00031B  CBF0 0100                            LAB,B4   256,IMO
          2 00031D  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          2 000320       0001                            DC       s:29010,PREL

      565    29010    3                   IF CNC_TYP = %KXX_TYP_LINKDEV#

  29010   2 000321  E847 005F                            LDR,R6   CNC_TYP,AUTO
          2 000323  6D03                                 CMV,R6   3
          2 000324  0981 0043                            BNE      s:29027,PREL

      566    29011    3                      THEN
      567    29012    4                         DO;

      568    29013    5                            DO WHILE ( KX$VC.SND.HED$ ~= ADDR(NIL) );

  29013   2 000326  0F81 0033                            B        s:29021,PREL

      569    29014    5                               DAT$ = KX$VC.SND.HED$;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:119  

  29014   2 000328  ECC7 0006                            LDB,B6   X29$,AUTO
          2 00032A  DCC6 000C                            LDB,B5   12,B6
          2 00032C  DFC7 000A                            STB,B5   DAT$,AUTO

      570    29015    5                               KX$VC.SND.HED$ = KX$VC_OTPBFR.LNK$;

  29015   2 00032E  CC85                                 LDB,B4   ,B5
          2 00032F  CFC6 000C                            STB,B4   12,B6

      571    29016    5                               Y@BYTSIZ = KX$VC_OTPBFR.BFRBYTSIZ;

  29016   2 000331  E845 0002                            LDR,R6   2,B5
          2 000333  E570 3FFF                            AND,R6   16383,IMO
          2 000335  EF47 002C                            STR,R6   Y@BYTSIZ,AUTO

      572    29017    5                               KX$VC.OTPBFRBYTCNT = KX$VC.OTPBFRBYTCNT - Y@BYTSIZ;

  29017   2 000337  E246 0014                            SUB,R6   20,B6
          2 000339  8256                                 NEG      R6
          2 00033A  EF46 0014                            STR,R6   20,B6

      573    29018    5                               KX_STATS_X29.KHSTT.OTPBFRBYTUTL =

  29018   2 00033C  F847 002C                            LDR,R7   Y@BYTSIZ,AUTO
          2 00033E  6C00                                 LDV,R6   0
          2 00033F  8480 0000 001E  xsym                 SID      KX_STATS_X29+30
          2 000342  8656                                 CPL      R6
          2 000343  8657                                 CPL      R7
          2 000344  8470 0000 0001                       AID      1,IMO
          2 000347  8D00 0000 001E  xsym                 SDI      KX_STATS_X29+30

      574    29019    5                                  KX_STATS_X29.KHSTT.OTPBFRBYTUTL - Y@BYTSIZ;
      575    29020    5                               CALL KVB$RLS2NSYS ( KX$VC_OTPBFR.RLSWRDSIZ, DAT$ );

  29020   2 00034A  CBC7 000A                            LAB,B4   DAT$,AUTO
          2 00034C  CFC7 0084                            STB,B4   WRDSIZ2N+5,AUTO
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:120  
          2 00034E  BBC5 0004                            LAB,B3   4,B5
          2 000350  BFC7 0082                            STB,B3   WRDSIZ2N+3,AUTO
          2 000352  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 000354  CBF0 0200                            LAB,B4   512,IMO
          2 000356  E380 0000 0000  xent                 LNJ,B6   KVB$RLS2NSYS
          2 000359       0001                            DC       s:29021,PREL

      576    29021    5                            END;

  29021   2 00035A  ECC7 0006                            LDB,B6   X29$,AUTO
          2 00035C  8DC6 000C                            CMN      12,B6
          2 00035E  09CA                                 BNE      s:29014,SPREL

      577    29022    4                            KX$VC.SND.TAL$ = ADDR(NIL);

  29022   2 00035F  DB80 0000 0000                       LAB,B5   0
          2 000362  DFC6 0010                            STB,B5   16,B6

      578    29023    4                            KX$VC.SND.NXTLOD$ = KX$VC.SND.TAL$;

  29023   2 000364  DFC6 000E                            STB,B5   14,B6

      579    29024    4                            GOTO UNBLK;

  29024   2 000366  0F81 010C                            B        s:29099,PREL

      580    29025    4                         END;
      581    29026    3                      ELSE
      582    29027    3                         IF CNC_TYP = %KXX_TYP_CNTL#

  29027   2 000368  6D02                                 CMV,R6   2
          2 000369  0901 0132                            BE       s:29128,PREL

      583    29028    3                            THEN
      584    29029    3                               GOTO L_ALTRET3;
      585    29030
      586    29031    3                   KX$X29.HLTOTP = '0'B;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:121  

  29031   2 00036B  ECC7 0006                            LDB,B6   X29$,AUTO
          2 00036D  8846 0015                            LBF,'C000'X       21,B6
          2 00036F       C000

      587    29032    3                   KX$X29.HLTOTPNXTBFR = '0'B;

  29032   2 000370  8846 0016                            LBF,'C000'X       22,B6
  29032   2 000372       C000

      588    29033    3                   KX$X29.ASNHLTOTP = '0'B;

  29033   2 000373  8846 0016                            LBF,'2000'X       22,B6
  29033   2 000375       2000

      589    29034
      590    29035    3                   IF KX$X29.SND.NXTLOD$ = ADDR(NIL)

  29035   2 000376  8DC6 000E                            CMN      14,B6
          2 000378  0901 0123                            BE       s:29128,PREL

      591    29036    3                      THEN
      592    29037    3                         GOTO L_ALTRET3;
      593    29038
      594    29039    3                   %KV_VDI.OTPBFR_.BYTSIZ = 0;

  29039   2 00037A  DCC7 0008                            LDB,B5   VDI$,AUTO
          2 00037C  8745 000D                            CL       13,B5

      595    29040    3                   %KV_VDI.OTPBFR_.BYTX = LENGTHC ( KX$X29_OTPBFR );

  29040   2 00037E  5C08                                 LDV,R5   8
          2 00037F  DF45 000C                            STR,R5   12,B5

      596    29041    3                   %KV_VDI.OTPBFR_.ADR$ = ADDR(NIL);

  29041   2 000381  CB80 0000 0000                       LAB,B4   0
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:122  
          2 000384  CFC5 000A                            STB,B4   10,B5

      597    29042
      598    29043    3                   DAT$ = KX$X29.SND.HED$;

  29043   2 000386  BCC6 000C                            LDB,B3   12,B6
          2 000388  BFC7 000A                            STB,B3   DAT$,AUTO

      599    29044    3                   IF DAT$ ~= KX$X29.SND.NXTLOD$ AND KX$X29_OTPBFR.Q

  29044   2 00038A  BDC6 000E                            CMB,B3   14,B6
          2 00038C  0901 0041                            BE       s:29057,PREL
          2 00038E  82C3 0003                            LB,'0080'X        3,B3
          2 000390       0080
          2 000391  0581 003C                            BBF      s:29057,PREL

      600    29045    3                      THEN
      601    29046    4                         DO;

      602    29047    4                            Y@BYTSIZ = Y_POWER_OF_2 ( KX$X29_OTPBFR.BYTSIZLOG2 );

  29047   2 000393  B843 0002                            LDR,R3   2,B3
          2 000395  304A                                 SOR,R3   10
          2 000396  B570 000F                            AND,R3   15,IMO
          2 000398  C830 0000 002E  00                   LDR,R4   Y_POWER_OF_2,R3
          2 00039B  CF47 002C                            STR,R4   Y@BYTSIZ,AUTO

      603    29048    4                            KX$X29.OTPBFRBYTCNT = KX$X29.OTPBFRBYTCNT - Y@BYTSIZ;

  29048   2 00039D  C246 0012                            SUB,R4   18,B6
          2 00039F  8254                                 NEG      R4
          2 0003A0  CF46 0012                            STR,R4   18,B6

      604    29049    4                            DAT$ = KX$X29_OTPBFR.LNK$;

  29049   2 0003A2  CC83                                 LDB,B4   ,B3
          2 0003A3  CFC7 000A                            STB,B4   DAT$,AUTO
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:123  

      605    29050    4                            CALL KVB$RLSSYS ( Y@BYTSIZ/2, KX$X29.SND.HED$ );

  29050   2 0003A5  B847 002C                            LDR,R3   Y@BYTSIZ,AUTO
          2 0003A7  3041                                 SOR,R3   1
          2 0003A8  BF47 0082                            STR,R3   WRDSIZ2N+3,AUTO
          2 0003AA  BBC6 000C                            LAB,B3   12,B6
          2 0003AC  BFC7 0085                            STB,B3   WRDSIZ2N+6,AUTO
          2 0003AE  ABC7 0082                            LAB,B2   WRDSIZ2N+3,AUTO
          2 0003B0  AFC7 0083                            STB,B2   WRDSIZ2N+4,AUTO
          2 0003B2  BBC7 0083                            LAB,B3   WRDSIZ2N+4,AUTO
          2 0003B4  CBF0 0200                            LAB,B4   512,IMO
          2 0003B6  E380 0000 0000  xent                 LNJ,B6   KVB$RLSSYS
          2 0003B9       0001                            DC       s:29051,PREL

      606    29051    4                            KX$X29.SND.HED$ = DAT$;

  29051   2 0003BA  ECC7 000A                            LDB,B6   DAT$,AUTO
          2 0003BC  DCC7 0006                            LDB,B5   X29$,AUTO
          2 0003BE  EFC5 000C                            STB,B6   12,B5

      607    29052    4                            KX_STATS_X29.KHSTT.OTPBFRBYTUTL = KX_STATS_X29.KHSTT.
             29052                                     OTPBFRBYTUTL - Y@BYTSIZ;

  29052   2 0003C0  F847 002C                            LDR,R7   Y@BYTSIZ,AUTO
          2 0003C2  6C00                                 LDV,R6   0
          2 0003C3  8480 0000 001E  xsym                 SID      KX_STATS_X29+30
          2 0003C6  8656                                 CPL      R6
          2 0003C7  8657                                 CPL      R7
          2 0003C8  8470 0000 0001                       AID      1,IMO
          2 0003CB  8D00 0000 001E  xsym                 SDI      KX_STATS_X29+30

      608    29053    4                         END;

      609    29054        /*
      610    29055           Start going through the chain.
      611    29056        */
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:124  
      612    29057    3                   PRV$ = ADDR(NIL);

  29057   2 0003CE  EB80 0000 0000                       LAB,B6   0
          2 0003D1  EFC7 000E                            STB,B6   PRV$,AUTO

      613    29058    4                   DO WHILE ( DAT$ ~= ADDR(NIL) );

  29058   2 0003D3  0F81 0070                            B        s:29087,PREL

      614    29059
      615    29060    4                      IF NOT KX$X29_OTPBFR.Q

  29060   2 0003D5  ECC7 000A                            LDB,B6   DAT$,AUTO
          2 0003D7  82C6 0003                            LB,'0080'X        3,B6
          2 0003D9       0080
          2 0003DA  0501 0064                            BBT      s:29084,PREL

      616    29061    4                         THEN
      617    29062    5                            DO;

      618    29063    5                               IF PRV$ = ADDR(NIL)

  29063   2 0003DC  8DC7 000E                            CMN      PRV$,AUTO
          2 0003DE  0981 0008                            BNE      s:29067,PREL

      619    29064    5                                  THEN
      620    29065    5                                     KX$X29.SND.HED$ = KX$X29_OTPBFR.LNK$;

  29065   2 0003E0  DC86                                 LDB,B5   ,B6
          2 0003E1  CCC7 0006                            LDB,B4   X29$,AUTO
          2 0003E3  DFC4 000C                            STB,B5   12,B4
          2 0003E5  0F81 0005                            B        s:29068,PREL

      621    29066    5                                  ELSE
      622    29067    5                                     PRV$->KX$X29_OTPBFR.LNK$ = KX$X29_OTPBFR.LNK$;

  29067   2 0003E7  DC86                                 LDB,B5   ,B6
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:125  
          2 0003E8  CCC7 000E                            LDB,B4   PRV$,AUTO
          2 0003EA  DF84                                 STB,B5   ,B4

      623    29068    5                               TEMP$ = KX$X29_OTPBFR.LNK$;

  29068   2 0003EB  ECC7 000A                            LDB,B6   DAT$,AUTO
          2 0003ED  DC86                                 LDB,B5   ,B6
          2 0003EE  DFC7 000C                            STB,B5   TEMP$,AUTO

      624    29069    5                               IF KX$X29_OTPBFR.NMBMRK > 0

  29069   2 0003F0  E2C6 0003                            LLH,R6   3,B6
          2 0003F2  6901 000C                            BEZ,R6   s:29075,PREL

      625    29070    5                                  THEN
      626    29071    6                                     DO;

      627    29072    6                                        KX$X29_OTPBFR.DLT = '1'B;

  29072   2 0003F4  8946 0003                            LBT,'0040'X       3,B6
  29072   2 0003F6       0040

      628    29073    6                                        CALL KXX$MRK ( KX$X29_OTPBFR );

  29073   2 0003F7  BBC7 000A                            LAB,B3   DAT$,AUTO
          2 0003F9  CBF0 0100                            LAB,B4   256,IMO
          2 0003FB  E380 0000 0000  xent                 LNJ,B6   KXX$MRK
          2 0003FE       0001                            DC       s:29075,PREL

      629    29074    6                                     END;

      630    29075    5                               Y@BYTSIZ = Y_POWER_OF_2 ( KX$X29_OTPBFR.BYTSIZLOG2 );

  29075   2 0003FF  ECC7 000A                            LDB,B6   DAT$,AUTO
          2 000401  B846 0002                            LDR,R3   2,B6
          2 000403  304A                                 SOR,R3   10
          2 000404  B570 000F                            AND,R3   15,IMO
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:126  
          2 000406  E830 0000 002E  00                   LDR,R6   Y_POWER_OF_2,R3
          2 000409  EF47 002C                            STR,R6   Y@BYTSIZ,AUTO

      631    29076    5                               KX$X29.OTPBFRBYTCNT = KX$X29.OTPBFRBYTCNT - Y@BYTSIZ;

  29076   2 00040B  DCC7 0006                            LDB,B5   X29$,AUTO
          2 00040D  E245 0012                            SUB,R6   18,B5
          2 00040F  8256                                 NEG      R6
          2 000410  EF45 0012                            STR,R6   18,B5

      632    29077    5                               CALL KVB$RLSSYS ( Y@BYTSIZ / 2, DAT$ );

  29077   2 000412  D847 002C                            LDR,R5   Y@BYTSIZ,AUTO
          2 000414  5041                                 SOR,R5   1
          2 000415  DF47 0082                            STR,R5   WRDSIZ2N+3,AUTO
          2 000417  CBC7 000A                            LAB,B4   DAT$,AUTO
          2 000419  CFC7 0085                            STB,B4   WRDSIZ2N+6,AUTO
          2 00041B  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 00041D  BFC7 0083                            STB,B3   WRDSIZ2N+4,AUTO
          2 00041F  BBC7 0083                            LAB,B3   WRDSIZ2N+4,AUTO
          2 000421  CBF0 0200                            LAB,B4   512,IMO
          2 000423  E380 0000 0000  xent                 LNJ,B6   KVB$RLSSYS
          2 000426       0001                            DC       s:29078,PREL

      633    29078    5                               DAT$ = TEMP$;

  29078   2 000427  ECC7 000C                            LDB,B6   TEMP$,AUTO
          2 000429  EFC7 000A                            STB,B6   DAT$,AUTO

      634    29079    5                               KX_STATS_X29.KHSTT.OTPBFRBYTUTL = KX_STATS_X29.KHSTT.
             29079                                        OTPBFRBYTUTL - Y@BYTSIZ;

  29079   2 00042B  F847 002C                            LDR,R7   Y@BYTSIZ,AUTO
          2 00042D  6C00                                 LDV,R6   0
          2 00042E  8480 0000 001E  xsym                 SID      KX_STATS_X29+30
          2 000431  8656                                 CPL      R6
          2 000432  8657                                 CPL      R7
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:127  
          2 000433  8470 0000 0001                       AID      1,IMO
          2 000436  8D00 0000 001E  xsym                 SDI      KX_STATS_X29+30

      635    29080    5                               PRM_USR_EVT.ACT = '1'B;

  29080   2 000439  DCC7 0004                            LDB,B5   @PRM_USR_X,AUTO
          2 00043B  8905                                 LBT,'0080'X       ,B5
          2 00043C       0080

      636    29081    5                            END;

  29081   2 00043D  0F81 0006                            B        s:29087,PREL

      637    29082    4                         ELSE
      638    29083    5                            DO;

      639    29084    5                               PRV$ = DAT$;

  29084   2 00043F  EFC7 000E                            STB,B6   PRV$,AUTO

      640    29085    5                               DAT$ = KX$X29_OTPBFR.LNK$;

  29085   2 000441  DC86                                 LDB,B5   ,B6
          2 000442  DFC7 000A                            STB,B5   DAT$,AUTO

      641    29086    5                            END;

      642    29087    4                   END; /*  DO WHILE ...  */

  29087   2 000444  8DC7 000A                            CMN      DAT$,AUTO
          2 000446  0981 FF8E                            BNE      s:29060,PREL

      643    29088
      644    29089    3                   KX$X29.SND.NXTLOD$ = KX$X29.SND.HED$;

  29089   2 000448  ECC7 0006                            LDB,B6   X29$,AUTO
          2 00044A  DCC6 000C                            LDB,B5   12,B6
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:128  
          2 00044C  DFC6 000E                            STB,B5   14,B6

      645    29090    3                   KX$X29.SND.TAL$ = PRV$;

  29090   2 00044E  CCC7 000E                            LDB,B4   PRV$,AUTO
          2 000450  CFC6 0010                            STB,B4   16,B6

      646    29091    3                   KX$X29.HLTOTP_ALL = KX$X29.HLTOTPNXTBFR_ALL | KX$X29.HLTOTP_ALL;

  29091   2 000452  E846 0016                            LDR,R6   22,B6
          2 000454  E570 C000                            AND,R6   -16384,IMO
          2 000456  D846 0015                            LDR,R5   21,B6
          2 000458  D570 C000                            AND,R5   -16384,IMO
          2 00045A  E455                                 OR,R6    R5
          2 00045B  EAC6 0015                            SRM,R6,'C000'X    21,B6
          2 00045D       C000

      647    29092    3                   KX$X29.HLTOTPNXTBFR = '0'B;

  29092   2 00045E  8846 0016                            LBF,'C000'X       22,B6
  29092   2 000460       C000

      648    29093
      649    29094    3                   IF %KV_VDI.RE_DSPINP

  29094   2 000461  BCC7 0008                            LDB,B3   VDI$,AUTO
          2 000463  82C3 0019                            LB,'0010'X        25,B3
          2 000465       0010
          2 000466  0581 000C                            BBF      s:29099,PREL

      650    29095    3                      THEN
      651    29096    4                         DO;

      652    29097    4                            CALL KVI$RE_DSPINP;

  29097   2 000468  CBF0 0000                            LAB,B4   0,IMO
          2 00046A  E380 0000 0000  xent                 LNJ,B6   KVI$RE_DSPINP
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:129  
          2 00046D       0001                            DC       s:29098,PREL

      653    29098    4                            %KV_VDI.RE_DSPINP = '0'B;

  29098   2 00046E  ECC7 0008                            LDB,B6   VDI$,AUTO
          2 000470  8846 0019                            LBF,'0010'X       25,B6
          2 000472       0010

      654    29099    4                         END;

  29094   2                              UNBLK           null
      655    29100    3   UNBLK:          ;
      656    29101                        %KV$RQSOTP ( RQSOTP = YES );
             29113    4           IF NOT KV$VDI.RQSOTP  THEN DO;

  29113   2 000473  ECC7 0008            UNBLK           LDB,B6   VDI$,AUTO
          2 000475  82C6 0019                            LB,'0008'X        25,B6
          2 000477       0008
          2 000478  0501 000D                            BBT      s:29119,PREL

             29114    4              KV$VDI.RQSOTP = '1'B;

  29114   2 00047A  8946 0019                            LBT,'0008'X       25,B6
  29114   2 00047C       0008

             29115    4              CALL KVV$VDI(KV_VDH_EVT_RQSOTP);

  29115   2 00047D  BB80 0000 0002  03                   LAB,B3   +2
          2 000480  CBF0 0100                            LAB,B4   256,IMO
          2 000482  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          2 000485       0001                            DC       s:29119,PREL

             29116    4              END;                         /* END IF                             */

      657    29119    3                   IF %KV_VDI.VDHEVTENB(%KV_VDH_EVT_ID_RLSVDI)

  29119   2 000486  ECC7 0008                            LDB,B6   VDI$,AUTO
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:130  
          2 000488  82C6 001F                            LB,'0002'X        31,B6
          2 00048A       0002
          2 00048B  0581 0010                            BBF      s:29128,PREL
          2 00048D  DCC7 0006                            LDB,B5   X29$,AUTO
          2 00048F  8DC5 000C                            CMN      12,B5
          2 000491  0981 000A                            BNE      s:29128,PREL

      658    29120    3                      AND KX$X29.SND.HED$ = ADDR(NIL)
      659    29121    3                      THEN
      660    29122    4                         DO;

      661    29123
      662    29124        /* We are to report to VDH quiescence in ASYNC                                */
      663    29125        /* so we can complete the releasing of VDI.                                   */
      664    29126
      665    29127    4                            CALL KVV$VDI(KV_VDH_EVT_RLSVDI) ;

  29127   2 000493  BB80 0000 0005  03                   LAB,B3   +5
          2 000496  CBF0 0100                            LAB,B4   256,IMO
          2 000498  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          2 00049B       0001                            DC       s:29128,PREL

      666    29128    4                         END;

      667    29129    3   L_ALTRET3:
      668    29130                        %ENABLE;

  29131   2 00049C  EC80 0000 0002  xsym L_ALTRET3       LDB,B6   KH_CTLTBL+2
          2 00049F  E847 0034                            LDR,R6   LEVEL,AUTO
          2 0004A1  E906                                 CMR,R6   ,B6
          2 0004A2  0901 0007                            BE       s:29133,PREL

  29131   2 0004A4  CBF0 0000                            LAB,B4   0,IMO
          2 0004A6  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          2 0004A9       0001                            DC       s:29133,PREL

      669    29133    3                   ALTRETURN; /* USR_EVT.ACT is already properly set.    */
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:131  

  29133   2 0004AA  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      670    29134    3                CASE(%KV_USR_EVT_ID_DSC );

      671    29135    3                   IF CNC_TYP = %KXX_TYP_X29#

  29135   2 0004AD  6D01                                 CMV,R6   1
          2 0004AE  0981 0A41                            BNE      s:30384,PREL

      672    29136    3                      THEN
      673    29137    4                         DO;

      674    29138    4                            KX$X29.HLTOTP_ALL = '0'B;

  29138   2 0004B0  8844 0015                            LBF,'C000'X       21,B4
  29138   2 0004B2       C000

      675    29139    4                            KX$X29.ASNHLTOTP = '0'B;

  29139   2 0004B3  8844 0016                            LBF,'2000'X       22,B4
  29139   2 0004B5       2000

      676    29140    4                         END;

  29140   2 0004B6  0F81 0A39                            B        s:30384,PREL

      677    29141    3                CASE(%KV_USR_EVT_ID_ENDSETPRM );

      678    29142    3                   IF CNC_TYP = %KXX_TYP_X29# AND KX$X29.SNDX3PRM

  29142   2 0004B8  6D01                                 CMV,R6   1
          2 0004B9  0981 0A36                            BNE      s:30384,PREL
          2 0004BB  82C4 0015                            LB,'0800'X        21,B4
          2 0004BD       0800
          2 0004BE  0581 0A31                            BBF      s:30384,PREL

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:132  
      679    29143    3                      THEN
      680    29144    4                         DO;

      681    29145                                 %DISABLE;

  29146   2 0004C0  AC80 0000 0002  xsym                 LDB,B2   KH_CTLTBL+2
          2 0004C3  D802                                 LDR,R5   ,B2
          2 0004C4  DF47 0034                            STR,R5   LEVEL,AUTO

  29146   2 0004C6  9BC7 0034                            LAB,B1   LEVEL,AUTO
          2 0004C8  9FC7 0082                            STB,B1   WRDSIZ2N+3,AUTO
          2 0004CA  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 0004CC  CBF0 0100                            LAB,B4   256,IMO
          2 0004CE  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          2 0004D1       0001                            DC       s:29148,PREL

      682    29148    4                            CALL KXX$SNDX29MSG ( %KX_X29MSGTYP_SETREDX3#, KX$X29 );

  29148   2 0004D2  EBF0 0006                            LAB,B6   6,IMO
          2 0004D4  DCC7 0006                            LDB,B5   X29$,AUTO
          2 0004D6  DFC7 0084                            STB,B5   WRDSIZ2N+5,AUTO
          2 0004D8  EFC7 0082                            STB,B6   WRDSIZ2N+3,AUTO
          2 0004DA  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 0004DC  CBF0 0200                            LAB,B4   512,IMO
          2 0004DE  E380 0000 0000  xent                 LNJ,B6   KXX$SNDX29MSG
          2 0004E1       0001                            DC       s:29150,PREL

      683    29149                                 %ENABLE;

  29150   2 0004E2  EC80 0000 0002  xsym                 LDB,B6   KH_CTLTBL+2
          2 0004E5  E847 0034                            LDR,R6   LEVEL,AUTO
          2 0004E7  E906                                 CMR,R6   ,B6
          2 0004E8  0901 0007                            BE       s:29152,PREL

  29150   2 0004EA  CBF0 0000                            LAB,B4   0,IMO
          2 0004EC  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          2 0004EF       0001                            DC       s:29152,PREL
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:133  

      684    29152    4                            KX$X29.SNDX3PRM = '0'B;

  29152   2 0004F0  ECC7 0006                            LDB,B6   X29$,AUTO
          2 0004F2  8846 0015                            LBF,'0800'X       21,B6
          2 0004F4       0800

      685    29153    4                            KX$X29.WAT4PRM = KX$X29.WAT4PRM + 1;

  29153   2 0004F5  E846 0015                            LDR,R6   21,B6
          2 0004F7  EA70 0100                            ADD,R6   256,IMO
          2 0004F9  EAC6 0015                            SRM,R6,'0700'X    21,B6
          2 0004FB       0700

      686    29154    4                         END;

  29154   2 0004FC  0F81 09F3                            B        s:30384,PREL

      687    29155    3                CASE(%KV_USR_EVT_ID_GETSTR );

      688    29156
      689    29157        /* VDH is getting a structure that we're interested in.                       */
      690    29158
      691    29159    3                   IF (PRM_USR_EVT.PRM = %KV_STRTYP_MRD)

  29159   2 0004FE  D843 0001                            LDR,R5   1,B3
          2 000500  5D0A                                 CMV,R5   10
          2 000501  0981 09EE                            BNE      s:30384,PREL

      692    29160    3                      THEN
      693    29161    4                         DO;

      694    29162
      695    29163        /* VDH is getting a KV$MRD structure.                                         */
      696    29164
      697    29165    4                            %KV_MRD.MINSP_FORPST = KA_MINSP_FORPST(%KV_VDI.LINSPD);

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:134  
  29165   2 000503  ACC6 0008                            LDB,B2   8,B6
          2 000505  A2C5 001E                            LLH,R2   30,B5
          2 000507  C820 0000 0000  xsym                 LDR,R4   KA_MINSP_FORPST,R2
          2 00050A  C7C2 000C                            STH,R4   12,B2

      698    29166    4                            %KV_MRD.CALUSR_ERS = '0'B;

  29166   2 00050C  ACC6 0008                            LDB,B2   8,B6
          2 00050E  8842 000C                            LBF,'0080'X       12,B2
          2 000510       0080

      699    29167    4                            %KV_MRD.CALUSR_PST = '0'B;

  29167   2 000511  ACC6 0008                            LDB,B2   8,B6
          2 000513  8842 000C                            LBF,'0040'X       12,B2
          2 000515       0040

      700    29168    4                            %KV_MRD.CALUSR_SETATR = '0'B;

  29168   2 000516  ACC6 0008                            LDB,B2   8,B6
          2 000518  8842 000C                            LBF,'0020'X       12,B2
          2 00051A       0020

      701    29169    4                            %KV_MRD.CALUSR_OTPRPTCHR = '0'B;

  29169   2 00051B  ACC6 0008                            LDB,B2   8,B6
          2 00051D  8842 0018                            LBF,'0100'X       24,B2
          2 00051F       0100

      702    29170    4                            %KV_MRD.ERD$ = ADDR(KV_ERD);

  29170   2 000520  ACC6 0008                            LDB,B2   8,B6
          2 000522  9B80 0000 0000  00                   LAB,B1   KV_ERD
          2 000525  9FC2 0008                            STB,B1   8,B2

      703    29171    4                         END /* IF */;

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:135  
  29171   2 000527  0F81 09C8                            B        s:30384,PREL

      704    29172    3                CASE(%KV_USR_EVT_ID_HLTOTP );

      705    29173
      706    29174        /* A SYNCHRONOUS OUTPUT HALT HAS BEEN REQUESTED                               */
      707    29175
      708    29176    3                   IF CNC_TYP = %KXX_TYP_X29#

  29176   2 000529  6D01                                 CMV,R6   1
          2 00052A  0981 09C5                            BNE      s:30384,PREL

      709    29177    3                      THEN
      710    29178    3                         CALL Y$SNCHLTOTP(%KA#HLTOTP_USRX) ;

  29178   2 00052C  ABF0 0001                            LAB,B2   1,IMO
          2 00052E  AFC7 0062                            STB,B2   CNC_TYP+3,AUTO
          2 000530  E3C0 0A1D                            LNJ,B6   s:0,PREL
          2 000532       0001                            DC       s:29178+7,PREL
          2 000533  0F81 09BC                            B        s:30384,PREL

      711    29179    3                CASE(%KV_USR_EVT_ID_RLSSTR );

      712    29180
      713    29181        /* VDH is releasing a structure that we're interested in.                     */
      714    29182
      715    29183    3                   IF (PRM_USR_EVT.PRM = %KV_STRTYP_VDI)

  29183   2 000535  D843 0001                            LDR,R5   1,B3
          2 000537  5D1D                                 CMV,R5   29
          2 000538  0981 09B7                            BNE      s:30384,PREL

      716    29184    3                      THEN
      717    29185    4                         DO;

      718    29186                                 %DISABLE;

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:136  
  29187   2 00053A  AC80 0000 0002  xsym                 LDB,B2   KH_CTLTBL+2
          2 00053D  C802                                 LDR,R4   ,B2
          2 00053E  CF47 0034                            STR,R4   LEVEL,AUTO

  29187   2 000540  9BC7 0034                            LAB,B1   LEVEL,AUTO
          2 000542  9FC7 0082                            STB,B1   WRDSIZ2N+3,AUTO
          2 000544  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 000546  CBF0 0100                            LAB,B4   256,IMO
          2 000548  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          2 00054B       0001                            DC       s:29189,PREL

      719    29189    5                            DO CASE ( CNC_TYP );

  29189   2 00054C  B847 005F                            LDR,R3   CNC_TYP,AUTO
          2 00054E  3D04                                 CMV,R3   4
          2 00054F  0281 0069                            BGE      s:29239,PREL
          2 000551  A830 0000 0557  02                   LDR,R2   s:29189+11,R3
          2 000554  83A0 0000 055B  02                   JMP      s:29192,R2
          2 000557       005E                            DC       s:29239,PREL
          2 000558       002D                            DC       s:29220,PREL
          2 000559       0002                            DC       s:29195,PREL
          2 00055A       0000                            DC       s:29192,PREL

      720    29190    5                               CASE ( %KXX_TYP_LINKDEV# );

      721    29191        /* it is a LINKDEV */
      722    29192    5                                  GOTO RLSCTX;

  29192   2 00055B  0F81 004B                            B        s:29232,PREL

      723    29193    5                               CASE ( %KXX_TYP_CNTL# );

      724    29194        /* it is a control connection for a LINKDEV */
      725    29195    5                                  IF KX$LINKDEV.L2$ ~= ADDR(NIL)

  29195   2 00055D  ECC7 0006                            LDB,B6   X29$,AUTO
          2 00055F  8DC6 000A                            CMN      10,B6
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:137  
          2 000561  0901 0014                            BE       s:29207,PREL

      726    29196    5                                     THEN
      727    29197    6                                        DO;

      728    29198    6                                           IF KX$LINKDEV.RECNC

  29198   2 000563  82C6 0017                            LB,'0008'X        23,B6
  29198   2 000565       0008
          2 000566  0581 000D                            BBF      s:29205,PREL

      729    29199    6                                              THEN
      730    29200    7                                                 DO;

      731    29201    7                                                    KX$LINKDEV.VDI$ = ADDR(NIL);

  29201   2 000568  DB80 0000 0000                       LAB,B5   0
          2 00056B  DFC6 0002                            STB,B5   2,B6

      732    29202    7                                                    KX$LINKDEV.RECNC = '0'B;

  29202   2 00056D  ECC7 0006                            LDB,B6   X29$,AUTO
          2 00056F  8846 0017                            LBF,'0008'X       23,B6
          2 000571       0008

      733    29203    7                                                    GOTO INTCNC;

  29203   2 000572  0F81 003E                            B        s:29235,PREL

      734    29204    7                                                 END;
      735    29205    6                                           GOTO L_3;

  29205   2 000574  0F81 0143                            B        s:29343,PREL

      736    29206    6                                        END;
      737    29207    5                                  CALL KVB$RLSSYS ( SIZEW(KX$LINKDEV), X29$ );

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:138  
  29207   2 000576  DBF0 0018                            LAB,B5   24,IMO
          2 000578  CBC7 0006                            LAB,B4   X29$,AUTO
          2 00057A  CFC7 0084                            STB,B4   WRDSIZ2N+5,AUTO
          2 00057C  DFC7 0082                            STB,B5   WRDSIZ2N+3,AUTO
          2 00057E  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 000580  CBF0 0200                            LAB,B4   512,IMO
          2 000582  E380 0000 0000  xent                 LNJ,B6   KVB$RLSSYS
          2 000585       0001                            DC       s:29207+16,PREL
          2 000586  0F81 0032                            B        s:29239,PREL

      738    29208
      739    29209
      740    29210        /* KV$MRD is being released. That's our queue to do our final                 */
      741    29211        /* phase of disconnect.                                                       */
      742    29212
      743    29213        /*
      744    29214           If X29 handler state is normal, it is the user typing "OFF"
      745    29215           and the channel table does not say DRPDTR. So we are to
      746    29216           reconnect to VDH. Otherwise, the VC must have already been
      747    29217           cleared, and all we have to do is to release the X.29 context.
      748    29218        */
      749    29219    5                               CASE ( %KXX_TYP_X29# );

      750    29220    5                                  IF KX$X29.STATE ~= %KX_X29_ST_NRM#

  29220   2 000588  ECC7 0006                            LDB,B6   X29$,AUTO
          2 00058A  E846 0018                            LDR,R6   24,B6
          2 00058C  E570 00FF                            AND,R6   255,IMO
          2 00058E  6D04                                 CMV,R6   4
          2 00058F  0901 0021                            BE       s:29235,PREL

      751    29221    6                                     THEN DO;

      752    29222    6                                           IF KX$X29.L3$ ~= ADDR(NIL)

  29222   2 000591  8DC6 0006                            CMN      6,B6
          2 000593  0901 0013                            BE       s:29232,PREL
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:139  

      753    29223    6                                              THEN
      754    29224    6                                                 IF KX$X29.L3$->KX$L3.PVC

  29224   2 000595  DCC6 0006                            LDB,B5   6,B6
          2 000597  82C5 0029                            LB,'0100'X        41,B5
          2 000599       0100
          2 00059A  0581 0007                            BBF      s:29231,PREL

      755    29225    6                                                    THEN
      756    29226    7                                                       DO;

      757    29227    7   /* can't release x29 context for PVCs */               KX$X29.STATE = %
             29227            KX_X29_ST_VCUP#;

  29227   2 00059C  5C01                                 LDV,R5   1
          2 00059D  DAC6 0018                            SRM,R5,'00FF'X    24,B6
          2 00059F       00FF

      758    29228    7                                                          GOTO L_3; /* enable & ret */

  29228   2 0005A0  0F81 0117                            B        s:29343,PREL

      759    29229    7                                                       END;
      760    29230    6                                                    ELSE
      761    29231    6                                                      KX$X29.L3$->KX$L3.CM$ = ADDR(NIL
             29231                                                                );

  29231   2 0005A2  CB80 0000 0000                       LAB,B4   0
          2 0005A5  CFC5 0004                            STB,B4   4,B5

      762    29232    6   RLSCTX:                                 CALL KXX$RLSCTX ( KX$X29 );

  29232   2 0005A7  BBC7 0006            RLSCTX          LAB,B3   X29$,AUTO
          2 0005A9  CBF0 0100                            LAB,B4   256,IMO
          2 0005AB  E380 0000 0000  xent                 LNJ,B6   KXX$RLSCTX
          2 0005AE       0001                            DC       s:29233,PREL
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:140  

      763    29233    6                                        END;

  29233   2 0005AF  0F81 0009                            B        s:29239,PREL

      764    29234    5                                     ELSE
      765    29235    6                                        DO;

      766    29236    6   INTCNC:                                 CALL KXX$INTCNC ( KX$X29 );

  29236   2 0005B1  BBC7 0006            INTCNC          LAB,B3   X29$,AUTO
          2 0005B3  CBF0 0100                            LAB,B4   256,IMO
          2 0005B5  E380 0000 0000  xent                 LNJ,B6   KXX$INTCNC
          2 0005B8       0001                            DC       s:29239,PREL

      767    29237    6                                        END /* IF */;

      768    29238    5                            END; /* do case ( type ) */

      769    29239    4                            GOTO L_3; /* enable & return */

  29239   2 0005B9  0F81 00FE                            B        s:29343,PREL

      770    29240    4                         END;
      771    29241    3                CASE(%KV_USR_EVT_ID_RLSVDI );

      772    29242
      773    29243    3                   IF CNC_TYP = %KXX_TYP_CNTL#

  29243   2 0005BB  6D02                                 CMV,R6   2
          2 0005BC  0901 00AE                            BE       s:29317,PREL

      774    29244    3                      THEN
      775    29245    3                         GOTO CLR_VDI$;
      776    29246
      777    29247        /* VDH is ready to enter into the phase of disconnect where                   */
      778    29248        /* this instance of VDI will be released. See if we're ready.                 */
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:141  
      779    29249
      780    29250    3                   IF CNC_TYP = %KXX_TYP_LINKDEV#

  29250   2 0005BE  6D03                                 CMV,R6   3
          2 0005BF  0981 0057                            BNE      s:29284,PREL

      781    29251    3                      THEN
      782    29252    4                         DO;

      783    29253    4                            IF KX$VC.SND.HED$ ~= ADDR(NIL)

  29253   2 0005C1  8DC4 000C                            CMN      12,B4
          2 0005C3  0901 0004                            BE       s:29256,PREL

      784    29254    4                               THEN
      785    29255    4                                  ALTRETURN;

  29255   2 0005C5  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      786    29256    4                            IF KX$VC.STATE = %KX_VC_ST_READY#

  29256   2 0005C8  D2C4 0033                            LLH,R5   51,B4
          2 0005CA  5D03                                 CMV,R5   3
          2 0005CB  0981 003C                            BNE      s:29274,PREL

      787    29257    4                               THEN
      788    29258    5                                  DO;

      789    29259    5                                     IF KX$VC.L3$ ~= ADDR(NIL)

  29259   2 0005CD  8DC4 0006                            CMN      6,B4
          2 0005CF  0901 0033                            BE       s:29272,PREL

      790    29260    5                                        THEN
      791    29261    6                                           DO;

      792    29262                                                   %DISABLE;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:142  

  29263   2 0005D1  AC80 0000 0002  xsym                 LDB,B2   KH_CTLTBL+2
          2 0005D4  C802                                 LDR,R4   ,B2
          2 0005D5  CF47 0034                            STR,R4   LEVEL,AUTO

  29263   2 0005D7  9BC7 0034                            LAB,B1   LEVEL,AUTO
          2 0005D9  9FC7 0082                            STB,B1   WRDSIZ2N+3,AUTO
          2 0005DB  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 0005DD  CBF0 0100                            LAB,B4   256,IMO
          2 0005DF  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          2 0005E2       0001                            DC       s:29265,PREL

      793    29265    6                                              L3$ = KX$VC.L3$;

  29265   2 0005E3  ECC7 0006                            LDB,B6   X29$,AUTO
          2 0005E5  DCC6 0006                            LDB,B5   6,B6
          2 0005E7  DFC7 0012                            STB,B5   L3$,AUTO

      794    29266        /* I have to use an auto copy of L3$ here. */
      795    29267    6                                              CALL KXS$RLSL3 ( L3$ );

  29267   2 0005E9  CBC7 0012                            LAB,B4   L3$,AUTO
          2 0005EB  CFC7 0082                            STB,B4   WRDSIZ2N+3,AUTO
          2 0005ED  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 0005EF  CBF0 0100                            LAB,B4   256,IMO
          2 0005F1  E380 0000 0000  xent                 LNJ,B6   KXS$RLSL3
          2 0005F4       0001                            DC       s:29269,PREL

      796    29268                                                   %ENABLE;

  29269   2 0005F5  EC80 0000 0002  xsym                 LDB,B6   KH_CTLTBL+2
          2 0005F8  E847 0034                            LDR,R6   LEVEL,AUTO
          2 0005FA  E906                                 CMR,R6   ,B6
          2 0005FB  0901 0007                            BE       s:29272,PREL

  29269   2 0005FD  CBF0 0000                            LAB,B4   0,IMO
          2 0005FF  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:143  
          2 000602       0001                            DC       s:29272,PREL

      797    29271    6                                           END;

      798    29272    5                                     KX$VC.STATE = %KX_VC_ST_ENDPHSDSC#;

  29272   2 000603  6C08                                 LDV,R6   8
          2 000604  ECC7 0006                            LDB,B6   X29$,AUTO
          2 000606  E7C6 0033                            STH,R6   51,B6

      799    29273    5                                  END;

      800    29274    4                            IF KX$VC.STATE = %KX_VC_ST_BGNPHSDSC# OR

  29274   2 000608  ECC7 0006                            LDB,B6   X29$,AUTO
          2 00060A  E2C6 0033                            LLH,R6   51,B6
          2 00060C  6D07                                 CMV,R6   7
          2 00060D  0901 005D                            BE       s:29317,PREL
          2 00060F  6D08                                 CMV,R6   8
          2 000610  0901 005A                            BE       s:29317,PREL

      801    29275    4                               KX$VC.STATE = %KX_VC_ST_ENDPHSDSC#
      802    29276    4                               THEN
      803    29277    4                                  GOTO CLR_VDI$;
      804    29278    4                               ELSE
      805    29279    5                                  DO;

      806    29280    5                                     KX$VC.STATE = %KX_VC_ST_BGNPHSDSC#;

  29280   2 000612  5C07                                 LDV,R5   7
          2 000613  D7C6 0033                            STH,R5   51,B6

      807    29281    5                                     GOTO CLR_VC;

  29281   2 000615  0F81 0024                            B        s:29301,PREL

      808    29282    5                                  END;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:144  
      809    29283    4                         END;
      810    29284    3                   IF (KX$X29.SND.HED$ ~= ADDR(NIL)) AND NOT %KV_VDI.INTPHSDSC

  29284   2 000617  8DC4 000C                            CMN      12,B4
          2 000619  0901 0009                            BE       s:29294,PREL
          2 00061B  82C5 001D                            LB,'0800'X        29,B5
          2 00061D       0800
          2 00061E  0501 0004                            BBT      s:29294,PREL

      811    29285    3                      THEN
      812    29286    4                         DO;

      813    29287
      814    29288        /* There are still output buffers Q'd. We aren't ready to                     */
      815    29289        /* disconnect. We'll get this call later, after we say                        */
      816    29290        /* %KV_VDH_EVT_ID_RLSVDI.                                                     */
      817    29291
      818    29292    4                            ALTRETURN;

  29292   2 000620  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      819    29293    4                         END;
      820    29294    3                   IF ( ( %KH_CHN.DRPDTR OR %KV_VDI.INTPHSDSC )

  29294   2 000623  AC86                                 LDB,B2   ,B6
          2 000624  9C82                                 LDB,B1   ,B2
          2 000625  82C1 0008                            LB,'0020'X        8,B1
          2 000627       0020
          2 000628  0501 0006                            BBT      s:29294+12,PREL
          2 00062A  82C5 001D                            LB,'0800'X        29,B5
          2 00062C       0800
          2 00062D  0581 003D                            BBF      s:29317,PREL
          2 00062F  D844 0018                            LDR,R5   24,B4
          2 000631  D570 00FF                            AND,R5   255,IMO
          2 000633  5D06                                 CMV,R5   6
          2 000634  0901 0036                            BE       s:29317,PREL

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:145  
      821    29295    3                      AND KX$X29.STATE ~= %KX_X29_ST_ENDPHSDSC# )
      822    29296    3                      THEN
      823    29297    4                         DO;

      824    29298        /*
      825    29299           We are to clear the VC.
      826    29300        */
      827    29301    4                            KX$X29.STATE = %KX_X29_ST_BGNPHSDSC#;

  29301   2 000636  4C05                                 LDV,R4   5
          2 000637  CAC4 0018                            SRM,R4,'00FF'X    24,B4
          2 000639       00FF

  29301   2                              CLR_VC          null
      828    29302    4   CLR_VC:                  ;
      829    29303    4                            IF KX$X29.L3$ ~= ADDR(NIL)

  29303   2 00063A  ECC7 0006            CLR_VC          LDB,B6   X29$,AUTO
          2 00063C  8DC6 0006                            CMN      6,B6
          2 00063E  0901 002C                            BE       s:29317,PREL

      830    29304    4                               THEN
      831    29305    5                                  DO;

      832    29306                                          %DISABLE;

  29307   2 000640  DC80 0000 0002  xsym                 LDB,B5   KH_CTLTBL+2
          2 000643  E805                                 LDR,R6   ,B5
          2 000644  EF47 0034                            STR,R6   LEVEL,AUTO

  29307   2 000646  CBC7 0034                            LAB,B4   LEVEL,AUTO
          2 000648  CFC7 0082                            STB,B4   WRDSIZ2N+3,AUTO
          2 00064A  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 00064C  CBF0 0100                            LAB,B4   256,IMO
          2 00064E  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          2 000651       0001                            DC       s:29309,PREL

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:146  
      833    29309    5                                     TEMP0 = %KX_P_EV_VCLST# ;

  29309   2 000652  6C09                                 LDV,R6   9
          2 000653  EF47 0033                            STR,R6   TEMP0,AUTO

      834    29310    5                                     TEMP1$ = ADDR(NIL);

  29310   2 000655  EB80 0000 0000                       LAB,B6   0
          2 000658  EFC7 0010                            STB,B6   TEMP1$,AUTO

      835    29311    5                                     CALL Y$CAL_PAC ;

  29311   2 00065A  E3C0 0961                            LNJ,B6   s:0,PREL
          2 00065C       0001                            DC       s:29313,PREL

      836    29312                                          %ENABLE;

  29313   2 00065D  EC80 0000 0002  xsym                 LDB,B6   KH_CTLTBL+2
          2 000660  E847 0034                            LDR,R6   LEVEL,AUTO
          2 000662  E906                                 CMR,R6   ,B6
          2 000663  0901 0007                            BE       s:29317,PREL

  29313   2 000665  CBF0 0000                            LAB,B4   0,IMO
          2 000667  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          2 00066A       0001                            DC       s:29317,PREL

      837    29315    5                                  END;

      838    29316
      839    29317    4                         END /* IF */;

  29317   2                              CLR_VDI$        null
      840    29318    3   CLR_VDI$:       ;
      841    29319    3                   KX$X29.VDI$ = ADDR(NIL);

  29319   2 00066B  EB80 0000 0000       CLR_VDI$        LAB,B6   0
          2 00066E  DCC7 0006                            LDB,B5   X29$,AUTO
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:147  
          2 000670  EFC5 0002                            STB,B6   2,B5
          2 000672  0F81 087D                            B        s:30384,PREL

      842    29320    3                CASE(%KV_USR_EVT_ID_SCH );

      843    29321
      844    29322        /* VDH is calling us because we interrupted it with an interrupt.             */
      845    29323        /* We'll do the processing now that we would have done earlier.               */
      846    29324
      847    29325    4                   DO CASE( PRM_USR_EVT.PRM );

  29325   2 000674  A843 0001                            LDR,R2   1,B3
          2 000676  2D04                                 CMV,R2   4
          2 000677  0281 0121                            BGE      s:29409,PREL
          2 000679  B820 0000 067F  02                   LDR,R3   s:29325+11,R2
          2 00067C  83B0 0000 0683  02                   JMP      RED_ENTRY,R3
          2 00067F       0046                            DC       s:29353,PREL
          2 000680       0000                            DC       s:29326,PREL
          2 000681       009D                            DC       s:29384,PREL
          2 000682       0048                            DC       s:29360,PREL

      848    29326    4                      CASE(%KV_SCHRSN_DFR1 );

  29313   2                              RED_ENTRY       null
      849    29327
      850    29328        /* Deferred input interrupt.                                                  */
      851    29329    4   RED_ENTRY:            ;
      852    29330                              %DISABLE;

  29331   2 000683  EC80 0000 0002  xsym RED_ENTRY       LDB,B6   KH_CTLTBL+2
          2 000686  E806                                 LDR,R6   ,B6
          2 000687  EF47 0034                            STR,R6   LEVEL,AUTO

  29331   2 000689  DBC7 0034                            LAB,B5   LEVEL,AUTO
          2 00068B  DFC7 0082                            STB,B5   WRDSIZ2N+3,AUTO
          2 00068D  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 00068F  CBF0 0100                            LAB,B4   256,IMO
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:148  
          2 000691  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          2 000694       0001                            DC       s:29333,PREL

      853    29333    4                         IF CNC_TYP~= %KXX_TYP_LINKDEV#

  29333   2 000695  E847 005F                            LDR,R6   CNC_TYP,AUTO
          2 000697  6D03                                 CMV,R6   3
          2 000698  0901 000B                            BE       s:29337,PREL

      854    29334    4                            THEN
      855    29335    4                               CALL KXX$DFRINP ( KX$X29 );

  29335   2 00069A  BBC7 0006                            LAB,B3   X29$,AUTO
          2 00069C  CBF0 0100                            LAB,B4   256,IMO
          2 00069E  E380 0000 0000  xent                 LNJ,B6   KXX$DFRINP
          2 0006A1       0001                            DC       s:29335+8,PREL
          2 0006A2  0F81 0015                            B        s:29343,PREL

      856    29336    4                            ELSE
      857    29337    4                               IF %KV_VDI.USRRQSDAT.RED

  29337   2 0006A4  ECC7 0008                            LDB,B6   VDI$,AUTO
          2 0006A6  82C6 001D                            LB,'0010'X        29,B6
          2 0006A8       0010
          2 0006A9  0581 000E                            BBF      s:29343,PREL

      858    29338    4                                  THEN
      859    29339    5                                     DO;

      860    29340    5                                        KX$VC.VDHENTERED = '1'B;

  29340   2 0006AB  DCC7 0006                            LDB,B5   X29$,AUTO
          2 0006AD  8945 0016                            LBT,'2000'X       22,B5
          2 0006AF       2000

      861    29341    5                                        CALL Y$CHKPNDBITS;

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:149  
  29341   2 0006B0  E3C0 0E05                            LNJ,B6   s:0,PREL
          2 0006B2       0001                            DC       s:29342,PREL

      862    29342    5                                        KX$VC.VDHENTERED = '0'B;

  29342   2 0006B3  ECC7 0006                            LDB,B6   X29$,AUTO
          2 0006B5  8846 0016                            LBF,'2000'X       22,B6
          2 0006B7       2000

      863    29343    5                                     END;

  29333   2                              L_3             null
      864    29344    4   L_3:                  ;
      865    29345                              %ENABLE;

  29346   2 0006B8  EC80 0000 0002  xsym L_3             LDB,B6   KH_CTLTBL+2
          2 0006BB  E847 0034                            LDR,R6   LEVEL,AUTO
          2 0006BD  E906                                 CMR,R6   ,B6
          2 0006BE  0901 0007                            BE       s:29348,PREL

  29346   2 0006C0  CBF0 0000                            LAB,B4   0,IMO
          2 0006C2  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          2 0006C5       0001                            DC       s:29348,PREL

      866    29348    4                         RETURN;

  29348   2 0006C6  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      867    29349    4                      CASE(%KV_SCHRSN_DFR0 );

      868    29350
      869    29351        /* Deferred output interrupt, i.e., L3 called us for more data.               */
      870    29352
      871    29353    4                         GOTO SAME_AS_VDHEXT;   /* in case USR_EVT_ID_VDHEXT */

  29353   2 0006C9  0F81 0103                            B        s:29436,PREL

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:150  
      872    29354
      873    29355    4                      CASE(%KV_SCHRSN_DFR3 );

      874    29356
      875    29357        /* A VCLST was received for the VC while it was busy. */
      876    29358
      877    29359                              %DISABLE;

  29360   2 0006CB  AC80 0000 0002  xsym                 LDB,B2   KH_CTLTBL+2
          2 0006CE  D802                                 LDR,R5   ,B2
          2 0006CF  DF47 0034                            STR,R5   LEVEL,AUTO

  29360   2 0006D1  9BC7 0034                            LAB,B1   LEVEL,AUTO
          2 0006D3  9FC7 0082                            STB,B1   WRDSIZ2N+3,AUTO
          2 0006D5  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 0006D7  CBF0 0100                            LAB,B4   256,IMO
          2 0006D9  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          2 0006DC       0001                            DC       s:29362,PREL

      878    29362    4                         CALL_FPT = '0'B;

  29362   2 0006DD  5C20                                 LDV,R5   32
          2 0006DE  0021                                 ALR      ;
          2 0006DF       4178 0000                                ALPHANUM('0000'X,IMO,,1),;
          2 0006E1       4007 001A                                ALPHANUM(CALL_FPT,AUTO,,R5,FILL)

      879    29363    4                         CALL_FPT.CAL$ = KX$VC.L3$;

  29363   2 0006E3  ECC7 0006                            LDB,B6   X29$,AUTO
          2 0006E5  437F                                 CSYNC    s:29363+1,SPREL
          2 0006E6  DCC6 0006                            LDB,B5   6,B6
          2 0006E8  DFC7 001B                            STB,B5   CALL_FPT+1,AUTO

      880    29364    4                         CALL_FPT.RCV$ = VC$;

  29364   2 0006EA  EFC7 001D                            STB,B6   CALL_FPT+3,AUTO

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:151  
      881    29365    4                         CALL_FPT.EVN = %KX_CM_EV_VCLST#;

  29365   2 0006EC  6C04                                 LDV,R6   4
          2 0006ED  EF47 001A                            STR,R6   CALL_FPT,AUTO

      882    29366
      883    29367    4                         IF CNC_TYP = %KXX_TYP_LINKDEV#

  29367   2 0006EF  C847 005F                            LDR,R4   CNC_TYP,AUTO
          2 0006F1  4D03                                 CMV,R4   3
          2 0006F2  0981 0017                            BNE      s:29377,PREL

      884    29368    4                            THEN
      885    29369    5                               DO;

      886    29370    5                                  KX$VC.VDHENTERED = '1'B;

  29370   2 0006F4  8946 0016                            LBT,'2000'X       22,B6
  29370   2 0006F6       2000

      887    29371    5                                  CALL KXV$VCVDH ( CALL_FPT );

  29371   2 0006F7  DBC7 001A                            LAB,B5   CALL_FPT,AUTO
          2 0006F9  DFC7 0082                            STB,B5   WRDSIZ2N+3,AUTO
          2 0006FB  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 0006FD  CBF0 0100                            LAB,B4   256,IMO
          2 0006FF  E380 0000 0000  xent                 LNJ,B6   KXV$VCVDH
          2 000702       0001                            DC       s:29372,PREL

      888    29372    5                                  KX$VC.VDHENTERED = '0'B;

  29372   2 000703  ECC7 0006                            LDB,B6   X29$,AUTO
          2 000705  8846 0016                            LBF,'2000'X       22,B6
          2 000707       2000

      889    29373    5                                  GOTO L_3;

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:152  
  29373   2 000708  0F81 FFAF                            B        s:29343,PREL

      890    29374    5                               END;
      891    29375    4                            ELSE
      892    29376    5                               DO;

      893    29377    5                                  KX$X29.VDHEXTCAL = '1'B;

  29377   2 00070A  8946 0016                            LBT,'0800'X       22,B6
  29377   2 00070C       0800

      894    29378    5                                  CALL KXX$X29 ( CALL_FPT );

  29378   2 00070D  DBC7 001A                            LAB,B5   CALL_FPT,AUTO
          2 00070F  DFC7 0082                            STB,B5   WRDSIZ2N+3,AUTO
          2 000711  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 000713  CBF0 0100                            LAB,B4   256,IMO
          2 000715  E380 0000 0000  xent                 LNJ,B6   KXX$X29
          2 000718       0001                            DC       s:29379,PREL

      895    29379    5                                  KX$X29.VDHEXTCAL = '0'B;

  29379   2 000719  ECC7 0006                            LDB,B6   X29$,AUTO
          2 00071B  8846 0016                            LBF,'0800'X       22,B6
          2 00071D       0800

      896    29380    5                                  GOTO L_3;

  29380   2 00071E  0F81 FF99                            B        s:29343,PREL

      897    29381    5                               END;
      898    29382    4                      CASE(%KV_SCHRSN_DFR2);

      899    29383
      900    29384    5                         DO CASE ( CNC_TYP );

  29384   2 000720  B856                                 LDR,R3   R6
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:153  
          2 000721  3D03                                 CMV,R3   3
          2 000722  0281 07CD                            BGE      s:30384,PREL
          2 000724  A830 0000 072A  02                   LDR,R2   s:29384+10,R3
          2 000727  83A0 0000 072D  02                   JMP      s:29388,R2
          2 00072A       006A                            DC       s:29404,PREL
          2 00072B       0000                            DC       s:29388,PREL
          2 00072C       0051                            DC       s:29400,PREL

      901    29385    5                            CASE ( %KXX_TYP_X29# );

      902    29386        /* A break was deferred. Send it to VDH now. */
      903    29387                                    %DISABLE;

  29388   2 00072D  AC80 0000 0002  xsym                 LDB,B2   KH_CTLTBL+2
          2 000730  D802                                 LDR,R5   ,B2
          2 000731  DF47 0034                            STR,R5   LEVEL,AUTO

  29388   2 000733  9BC7 0034                            LAB,B1   LEVEL,AUTO
          2 000735  9FC7 0082                            STB,B1   WRDSIZ2N+3,AUTO
          2 000737  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 000739  CBF0 0100                            LAB,B4   256,IMO
          2 00073B  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          2 00073E       0001                            DC       s:29390,PREL

      904    29390    5                               CALL KXX$SNDX29MSG ( %KX_X29MSGTYP_RSMOTP#, KX$X29 );

  29390   2 00073F  EBF0 0007                            LAB,B6   7,IMO
          2 000741  DCC7 0006                            LDB,B5   X29$,AUTO
          2 000743  DFC7 0084                            STB,B5   WRDSIZ2N+5,AUTO
          2 000745  EFC7 0082                            STB,B6   WRDSIZ2N+3,AUTO
          2 000747  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 000749  CBF0 0200                            LAB,B4   512,IMO
          2 00074B  E380 0000 0000  xent                 LNJ,B6   KXX$SNDX29MSG
          2 00074E       0001                            DC       s:29392,PREL

      905    29391                                    %ENABLE;

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:154  
  29392   2 00074F  EC80 0000 0002  xsym                 LDB,B6   KH_CTLTBL+2
          2 000752  E847 0034                            LDR,R6   LEVEL,AUTO
          2 000754  E906                                 CMR,R6   ,B6
          2 000755  0901 0007                            BE       s:29394,PREL

  29392   2 000757  CBF0 0000                            LAB,B4   0,IMO
          2 000759  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          2 00075C       0001                            DC       s:29394,PREL

      906    29394    5                               KV@VDH_DAT = KV_VDH_DAT;

  29394   2 00075D  AB80 0000 0000  xsym                 LAB,B2   KV_VDH_DAT
          2 000760  2C00                                 LDV,R2   0
          2 000761  6C10                                 LDV,R6   16
          2 000762  BBC7 004D                            LAB,B3   KV@VDH_DAT,AUTO
          2 000764  3C00                                 LDV,R3   0
          2 000765  0008                                 MMM

      907    29395    5                               KV@VDH_DAT.DAT__.ADR$ = ADDR(KX_BFR_BRK);

  29395   2 000766  EB80 0000 0000  xsym                 LAB,B6   KX_BFR_BRK
          2 000769  EFC7 004E                            STB,B6   KV@VDH_DAT+1,AUTO

      908    29396    5                               KV@VDH_DAT.DAT__.DATBYTSIZ = 2;

  29396   2 00076B  6C02                                 LDV,R6   2
          2 00076C  EF47 0051                            STR,R6   KV@VDH_DAT+4,AUTO

      909    29397    5                               KV@VDH_DAT.DAT__.BFRBYTSIZ = 2;

  29397   2 00076E  EF47 0052                            STR,R6   KV@VDH_DAT+5,AUTO

      910    29398    5                               CALL KVV$VDI ( KV@VDH_DAT );

  29398   2 000770  DBC7 004D                            LAB,B5   KV@VDH_DAT,AUTO
          2 000772  DFC7 0082                            STB,B5   WRDSIZ2N+3,AUTO
          2 000774  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:155  
          2 000776  CBF0 0100                            LAB,B4   256,IMO
          2 000778  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          2 00077B       0001                            DC       s:29398+12,PREL
          2 00077C  0F81 0773                            B        s:30384,PREL

      911    29399    5                            CASE ( %KXX_TYP_CNTL# );

      912    29400    6                               DO TEMP0 = 1 TO KX$LINKDEV.PNDEVTCNT;

  29400   2 00077E  5C01                                 LDV,R5   1
          2 00077F  DF47 0033                            STR,R5   TEMP0,AUTO
          2 000781  0F81 000C                            B        s:29402+2,PREL

      913    29401    6                                  CALL KVV$VDI ( KX_VDH_EVT_ATN );

  29401   2 000783  BB80 0000 0007  03                   LAB,B3   +7
          2 000786  CBF0 0100                            LAB,B4   256,IMO
          2 000788  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          2 00078B       0001                            DC       s:29402,PREL

      914    29402    6                               END;

  29402   2 00078C  8AC7 0033                            INC      TEMP0,AUTO
          2 00078E  ECC7 0006                            LDB,B6   X29$,AUTO
          2 000790  E2C6 0017                            LLH,R6   23,B6
          2 000792  E947 0033                            CMR,R6   TEMP0,AUTO
          2 000794  02EF                                 BGE      s:29401,SPREL

      915    29403    5                               KX$LINKDEV.PNDEVTCNT = 0;

  29403   2 000795  87C6 0017                            CLH      23,B6

      916    29404    5                         END; /* do case ( cnc_typ ) */

  29404   2 000797  0F81 0758                            B        s:30384,PREL

      917    29405    4                      CASE(ELSE);
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:156  

      918    29406        /*S* SCREECH_CODE: KXX-S$KX_UNKSCHRSN#
      919    29407             MESSAGE: KXX$VDI called by VDH for an unknown schedule reason.
      920    29408        */
      921    29409    4                         CALL KHD$SCREECH ( Y_UNKSCHRSN );

  29409   2 000799  BB80 0000 0009  03                   LAB,B3   +9
          2 00079C  CBF0 0100                            LAB,B4   256,IMO
          2 00079E  E380 0000 0000  xent                 LNJ,B6   KHD$SCREECH
          2 0007A1       0001                            DC       s:29410,PREL

      922    29410    4                   END /* CASE on schrsn */;

  29410   2 0007A2  0F81 074D                            B        s:30384,PREL

      923    29411    3                CASE(%KV_USR_EVT_ID_TRMUSRRQSDAT );

      924    29412
      925    29413        /* Terminate user request data. VDH is activating the read.                   */
      926    29414        /* Shut off the paper tape reader, if in paper tape mode.                     */
      927    29415
      928    29416    3                   IF %KV_VDI.HALFDUPLEXPAPERTAPE OR %KV_VDI.FULLDUPLEXPAPERTAPE

  29416   2 0007A4  82C5 0019                            LB,'0002'X        25,B5
  29416   2 0007A6       0002
          2 0007A7  0501 0006                            BBT      s:29423,PREL
          2 0007A9  82C5 0019                            LB,'0020'X        25,B5
          2 0007AB       0020
          2 0007AC  0581 0743                            BBF      s:30384,PREL

      929    29417    3                      THEN
      930    29418    4                         DO;

      931    29419
      932    29420        /* WE'RE IN PAPER TAPE MODE. SEND A DC3 (XOFF) CHARACTER TO                   */
      933    29421        /* STOP THE READER.                                                           */
      934    29422
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:157  
      935    29423    4                            IF %KV_VDI.OTPBFR_.BYTSIZ = 0

  29423   2 0007AE  D845 000D                            LDR,R5   13,B5
          2 0007B0  5981 000E                            BNEZ,R5  s:29432,PREL

      936    29424    4                               THEN
      937    29425    5                                  DO;

      938    29426    5                                     CALL KXX$VDI ( KV_USR_GETOTPBFR )

  29426   2 0007B2  BB80 0000 000B  03                   LAB,B3   +11
          2 0007B5  CBF0 0100                            LAB,B4   256,IMO
          2 0007B7  E3C0 F848                            LNJ,B6   s:10,PREL
          2 0007B9       0003                            DC       s:29429,PREL
          2 0007BA  0F81 0004                            B        s:29432,PREL

      939    29427    5                                        WHENALTRETURN
      940    29428    6                                           DO;

      941    29429    6                                              RETURN;

  29429   2 0007BC  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      942    29430    6                                           END;
      943    29431    5                                  END;

      944    29432    4                           %KV_VDI.OTPBFR_.ADR$->Y$BYT(%KV_VDI.OTPBFR_.BYTX) = %BITBIN
             29432                                     (%ASCIIDC3);

  29432   2 0007BF  ECC7 0008                            LDB,B6   VDI$,AUTO
          2 0007C1  DCC6 000A                            LDB,B5   10,B6
          2 0007C3  B846 000C                            LDR,R3   12,B6
          2 0007C5  6C13                                 LDV,R6   19
          2 0007C6  E7B5                                 STH,R6   ,B5,R3

      945    29433    4                            %KV_VDI.OTPBFR_.BYTX = %KV_VDI.OTPBFR_.BYTX + 1;

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:158  
  29433   2 0007C7  8AC6 000C                            INC      12,B6

      946    29434    4                            %KV_VDI.OTPBFR_.BYTSIZ = %KV_VDI.OTPBFR_.BYTSIZ - 1;

  29434   2 0007C9  88C6 000D                            DEC      13,B6

      947    29435    4                         END /* IF */;

  29435   2 0007CB  0F81 0724                            B        s:30384,PREL

      948    29436    3                CASE(%KV_USR_EVT_ID_VDHEXT );

      949    29437    3   SAME_AS_VDHEXT:
      950    29438    3                   TEMP0 = %KX_P_EV_DATAVL#;

  29438   2 0007CD  5C0B                 SAME_AS_VDHEXT  LDV,R5   11
          2 0007CE  DF47 0033                            STR,R5   TEMP0,AUTO

      951    29439    3                   TEMP1$ = ADDR(NIL);

  29439   2 0007D0  AB80 0000 0000                       LAB,B2   0
          2 0007D3  AFC7 0010                            STB,B2   TEMP1$,AUTO

      952    29440                        %DISABLE;

  29441   2 0007D5  9C80 0000 0002  xsym                 LDB,B1   KH_CTLTBL+2
          2 0007D8  C801                                 LDR,R4   ,B1
          2 0007D9  CF47 0034                            STR,R4   LEVEL,AUTO

  29441   2 0007DB  EBC7 0034                            LAB,B6   LEVEL,AUTO
          2 0007DD  EFC7 0082                            STB,B6   WRDSIZ2N+3,AUTO
          2 0007DF  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 0007E1  CBF0 0100                            LAB,B4   256,IMO
          2 0007E3  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          2 0007E6       0001                            DC       s:29443,PREL

      953    29443    4                   DO CASE ( CNC_TYP );
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:159  

  29443   2 0007E7  B847 005F                            LDR,R3   CNC_TYP,AUTO
          2 0007E9  3D04                                 CMV,R3   4
          2 0007EA  0281 0065                            BGE      s:29476,PREL
          2 0007EC  A830 0000 07F2  02                   LDR,R2   s:29443+11,R3
          2 0007EF  83A0 0000 07F6  02                   JMP      s:29446,R2
          2 0007F2       005A                            DC       s:29476,PREL
          2 0007F3       001F                            DC       s:29459,PREL
          2 0007F4       005A                            DC       s:29476,PREL
          2 0007F5       0000                            DC       s:29446,PREL

      954    29444    4                      CASE ( %KXX_TYP_CNTL# );

      955    29445    4                      CASE ( %KXX_TYP_LINKDEV# );

      956    29446    4                         KX$VC.VDHENTERED = '1'B;

  29446   2 0007F6  ECC7 0006                            LDB,B6   X29$,AUTO
          2 0007F8  8946 0016                            LBT,'2000'X       22,B6
          2 0007FA       2000

      957    29447    4                        IF KX$VC.STATE <= %KX_VC_ST_NRM# AND KX$VC.SND.NXTLOD$ ~= ADDR
             29447                                  (NIL)

  29447   2 0007FB  E2C6 0033                            LLH,R6   51,B6
          2 0007FD  6D06                                 CMV,R6   6
          2 0007FE  0301 000C                            BG       s:29451,PREL
          2 000800  8DC6 000E                            CMN      14,B6
          2 000802  0901 0008                            BE       s:29451,PREL
          2 000804  8DC6 0006                            CMN      6,B6
          2 000806  0901 0004                            BE       s:29451,PREL

      958    29448    4                            AND KX$VC.L3$ ~= ADDR(NIL)
      959    29449    4                            THEN
      960    29450    4                               CALL Y$CAL_PAC;

  29450   2 000808  E3C0 07B3                            LNJ,B6   s:0,PREL
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:160  
          2 00080A       0001                            DC       s:29451,PREL

      961    29451    4                         CALL Y$CHKPNDBITS;

  29451   2 00080B  E3C0 0CAA                            LNJ,B6   s:0,PREL
          2 00080D       0001                            DC       s:29452,PREL

      962    29452    4                         KX$VC.VDHENTERED = '0'B;

  29452   2 00080E  ECC7 0006                            LDB,B6   X29$,AUTO
          2 000810  8846 0016                            LBF,'2000'X       22,B6
          2 000812       2000
          2 000813  0F81 003C                            B        s:29476,PREL

      963    29453    4                      CASE ( %KXX_TYP_X29# );

      964    29454                              %KV$CMPOTP;
             29459    5           IF KV$VDI.OTPCNDPND THEN DO;

  29459   2 000815  ECC7 0008                            LDB,B6   VDI$,AUTO
          2 000817  E846 001A                            LDR,R6   26,B6
          2 000819  6901 000A                            BEZ,R6   s:29463,PREL

             29460    5              CALL KVV$VDI(KV_VDH_EVT_CMPOTP);

  29460   2 00081B  BB80 0000 000D  03                   LAB,B3   +13
          2 00081E  CBF0 0100                            LAB,B4   256,IMO
          2 000820  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          2 000823       0001                            DC       s:29463,PREL

             29461    5              END;                         /* END IF                             */

      965    29463    4                         IF NOT KX$X29.HLTOTP AND KX$X29.RPRDAT

  29463   2 000824  ECC7 0006                            LDB,B6   X29$,AUTO
          2 000826  82C6 0015                            LB,'C000'X        21,B6
          2 000828       C000
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:161  
          2 000829  0501 0026                            BBT      s:29476,PREL
          2 00082B  82C6 0016                            LB,'1000'X        22,B6
          2 00082D       1000
          2 00082E  0581 0021                            BBF      s:29476,PREL
          2 000830  8DC6 000E                            CMN      14,B6
          2 000832  0901 001D                            BE       s:29476,PREL
          2 000834  E846 0018                            LDR,R6   24,B6
          2 000836  E570 00FF                            AND,R6   255,IMO
          2 000838  6D04                                 CMV,R6   4
          2 000839  0301 0016                            BG       s:29476,PREL
          2 00083B  8DC6 0006                            CMN      6,B6
          2 00083D  0901 0012                            BE       s:29476,PREL

      966    29464    4                            AND KX$X29.SND.NXTLOD$ ~= ADDR(NIL)
      967    29465    4                            AND KX$X29.STATE <= %KX_X29_ST_NRM#
      968    29466    4                            AND KX$X29.L3$ ~= ADDR(NIL)
      969    29467    4                            THEN
      970    29468    5                               DO;

      971    29469    5                                  KX$X29.RPRDAT = '0'B;

  29469   2 00083F  8846 0016                            LBF,'1000'X       22,B6
  29469   2 000841       1000

      972    29470    5                                  KX$X29.VDHEXTCAL = '1'B;

  29470   2 000842  8946 0016                            LBT,'0800'X       22,B6
  29470   2 000844       0800

      973    29471    5                                  CALL Y$CAL_PAC ;

  29471   2 000845  E3C0 0776                            LNJ,B6   s:0,PREL
          2 000847       0001                            DC       s:29472,PREL

      974    29472    5                                  KX$X29.VDHEXTCAL = '0'B;

  29472   2 000848  ECC7 0006                            LDB,B6   X29$,AUTO
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:162  
          2 00084A  8846 0016                            LBF,'0800'X       22,B6
          2 00084C       0800

      975    29473    5                                  KX$X29.RPRDAT = '1'B;

  29473   2 00084D  8946 0016                            LBT,'1000'X       22,B6
  29473   2 00084F       1000

      976    29474    5                               END;

      977    29475    4                   END;   /* do case ( cnc_typ ) */

      978    29476    3                   GOTO L_3;   /* enable and return; */

  29476   2 000850  0F81 FE67                            B        s:29343,PREL

      979    29477    3                CASE ( %KV_USR_EVT_ID_INHDLTOTP );

      980    29478
      981    29479    3                   IF %KV_VDI.OTPBFR_.ADR$ ~= ADDR(NIL)

  29479   2 000852  8DC5 000A                            CMN      10,B5
          2 000854  0901 069B                            BE       s:30384,PREL
          2 000856  D845 000D                            LDR,R5   13,B5
          2 000858  5801 0697                            BLZ,R5   s:30384,PREL
          2 00085A  D943 0001                            CMR,R5   1,B3
          2 00085C  0881 0693                            BAGE     s:30384,PREL
          2 00085E  6D01                                 CMV,R6   1
          2 00085F  0981 0690                            BNE      s:30384,PREL

      982    29480    3                      AND %KV_VDI.OTPBFR_.BYTSIZ < PRM_USR_EVT.PRM
      983    29481    3                      AND CNC_TYP = %KXX_TYP_X29#
      984    29482    3                      THEN
      985    29483    3                         CALL KXX$TRNOTP ( %KV_VDI );

  29483   2 000861  BBC7 0008                            LAB,B3   VDI$,AUTO
          2 000863  CBF0 0100                            LAB,B4   256,IMO
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:163  
          2 000865  E380 0000 0000  xent                 LNJ,B6   KXX$TRNOTP
          2 000868       0001                            DC       s:29483+8,PREL
          2 000869  0F81 0686                            B        s:30384,PREL

      986    29484
      987    29485    3                CASE (%KV_USR_EVT_ID_LGNRJC );

      988    29486        /* We are not able to start this circuit. Better drop it. */
      989    29487    3                   %KV_VDI.INTPHSDSC = '1'B;

  29487   2 00086B  8945 001D                            LBT,'0800'X       29,B5
  29487   2 00086D       0800

      990    29488    3                   IF CNC_TYP ~= %KXX_TYP_CNTL#

  29488   2 00086E  6D02                                 CMV,R6   2
          2 00086F  0901 0008                            BE       s:29492,PREL

      991    29489    3                      THEN
      992    29490    3                         ERCOD = LGNRJC;

  29490   2 000871  8C80 0000 0079  00                   LDI      LGNRJC
          2 000874  8D47 002E                            SDI      ERCOD,AUTO
          2 000876  0F81 0006                            B        s:29493,PREL

      993    29491    3                      ELSE
      994    29492    3                         ERCOD = DEVLGNFAL;

  29492   2 000878  8C80 0000 0000  xsym                 LDI      DEVLGNFAL
          2 00087B  8D47 002E                            SDI      ERCOD,AUTO

      995    29493    3                   CALL Y$ER;

  29493   2 00087D  E3C0 0771                            LNJ,B6   s:0,PREL
          2 00087F       0001                            DC       s:29493+3,PREL
          2 000880  0F81 066F                            B        s:30384,PREL

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:164  
      996    29494
      997    29495    3                CASE (%KV_USR_EVT_ID_LGNACP );

      998    29496        /*
      999    29497           By this time, NODEADMN has created a channel table for this VC.
     1000    29498           Let's use that instead of the one we build in our buffer pool.
     1001    29499        */
     1002    29500    4                   DO CASE ( CNC_TYP );

  29500   2 000882  A856                                 LDR,R2   R6
          2 000883  2D04                                 CMV,R2   4
          2 000884  0281 008C                            BGE      s:29537,PREL
          2 000886  B820 0000 088C  02                   LDR,R3   s:29500+10,R2
          2 000889  83B0 0000 0890  02                   JMP      s:29502,R3
          2 00088C       0081                            DC       s:29537,PREL
          2 00088D       0081                            DC       s:29537,PREL
          2 00088E       0000                            DC       s:29502,PREL
          2 00088F       0003                            DC       s:29505,PREL

     1003    29501    4                      CASE ( %KXX_TYP_CNTL# );

     1004    29502    4                         RETURN;

  29502   2 000890  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1005    29503    4                      CASE ( %KXX_TYP_X29# );

     1006    29504    4                      CASE ( %KXX_TYP_LINKDEV# );

     1007    29505    5                         DO CASE ( KX$VC.STATE );

  29505   2 000893  B2C4 0033                            LLH,R3   51,B4
          2 000895  3D09                                 CMV,R3   9
          2 000896  0281 0071                            BGE      s:29534,PREL
          2 000898  A830 0000 089E  02                   LDR,R2   s:29505+11,R3
          2 00089B  83A0 0000 08A7  02                   JMP      s:29507,R2
          2 00089E       0061                            DC       s:29534,PREL
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:165  
          2 00089F       005A                            DC       s:29526,PREL
          2 0008A0       0000                            DC       s:29507,PREL
          2 0008A1       0061                            DC       s:29534,PREL
          2 0008A2       0061                            DC       s:29534,PREL
          2 0008A3       0061                            DC       s:29534,PREL
          2 0008A4       0061                            DC       s:29534,PREL
          2 0008A5       005F                            DC       s:29529,PREL
          2 0008A6       005F                            DC       s:29529,PREL

     1008    29506    5                            CASE ( %KX_VC_ST_RMTDCL# );

     1009    29507    5                               KX$VC.CALINDPND = '1'B;

  29507   2 0008A7  8944 0016                            LBT,'1000'X       22,B4
  29507   2 0008A9       1000

     1010    29508    5                               IF %KV_VDI.USRRQSDAT.RED

  29508   2 0008AA  82C5 001D                            LB,'0010'X        29,B5
  29508   2 0008AC       0010
          2 0008AD  0581 004C                            BBF      s:29524,PREL

     1011    29509    5                                  THEN
     1012    29510    6                                     DO;

     1013    29511    6                                        KV@SND_DAT = KX_SND_DAT;

  29511   2 0008AF  AB80 0000 0000  xsym                 LAB,B2   KX_SND_DAT
          2 0008B2  2C00                                 LDV,R2   0
          2 0008B3  6C14                                 LDV,R6   20
          2 0008B4  BBC7 0055                            LAB,B3   KV@SND_DAT,AUTO
          2 0008B6  3C00                                 LDV,R3   0
          2 0008B7  0008                                 MMM

     1014    29512    6                                       KX_VDOVLPARY.VDOVLP.KEY$ = ADDR(KX_KEY_CAL_IND)
             29512                                                 ;

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:166  
  29512   2 0008B8  EB80 0000 0000  xsym                 LAB,B6   KX_KEY_CAL_IND
          2 0008BB  EF80 0000 000A  xsym                 STB,B6   KX_VDOVLPARY+10

     1015    29513    6                                        KV@SND_DAT.DAT__.ADR$ = KX$VC.CALPKT$;

  29513   2 0008BE  DCC7 0006                            LDB,B5   X29$,AUTO
          2 0008C0  CCC5 0026                            LDB,B4   38,B5
          2 0008C2  CFC7 0056                            STB,B4   KV@SND_DAT+1,AUTO

     1016    29514    6                                        KV@SND_DAT.DAT__.BYTX = 0;

  29514   2 0008C4  8747 0058                            CL       KV@SND_DAT+3,AUTO

     1017    29515    6                                       KV@SND_DAT.DAT__.DATBYTSIZ = KX$VC.CALMSGBYTSIZ
             29515                                                 ;

  29515   2 0008C6  E845 0028                            LDR,R6   40,B5
          2 0008C8  EF47 0059                            STR,R6   KV@SND_DAT+4,AUTO

     1018    29516    6                                        CALL KVV$VDI ( KV@SND_DAT ) WHENRETURN

  29516   2 0008CA  BBC7 0055                            LAB,B3   KV@SND_DAT,AUTO
          2 0008CC  BFC7 0082                            STB,B3   WRDSIZ2N+3,AUTO
          2 0008CE  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 0008D0  CBF0 0100                            LAB,B4   256,IMO
          2 0008D2  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          2 0008D5       0025                            DC       s:29524,PREL

     1019    29517    7                                              DO;

     1020    29518    7                                                CALL KVB$RLSSYS ( (KX$VC.CALMSGBYTSIZ+
             29518                                                          1)/2, KX$VC.CALPKT$ );

  29518   2 0008D6  ECC7 0006                            LDB,B6   X29$,AUTO
          2 0008D8  E846 0028                            LDR,R6   40,B6
          2 0008DA  6E01                                 ADV,R6   1
          2 0008DB  6041                                 SOR,R6   1
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:167  
          2 0008DC  EF47 0082                            STR,R6   WRDSIZ2N+3,AUTO
          2 0008DE  DBC6 0026                            LAB,B5   38,B6
          2 0008E0  DFC7 0085                            STB,B5   WRDSIZ2N+6,AUTO
          2 0008E2  CBC7 0082                            LAB,B4   WRDSIZ2N+3,AUTO
          2 0008E4  CFC7 0083                            STB,B4   WRDSIZ2N+4,AUTO
          2 0008E6  BBC7 0083                            LAB,B3   WRDSIZ2N+4,AUTO
          2 0008E8  CBF0 0200                            LAB,B4   512,IMO
          2 0008EA  E380 0000 0000  xent                 LNJ,B6   KVB$RLSSYS
          2 0008ED       0001                            DC       s:29519,PREL

     1021    29519    7                                                 KX$VC.CALPKT$ = ADDR(NIL);

  29519   2 0008EE  EB80 0000 0000                       LAB,B6   0
          2 0008F1  DCC7 0006                            LDB,B5   X29$,AUTO
          2 0008F3  EFC5 0026                            STB,B6   38,B5

     1022    29520    7                                                 KX$VC.CALMSGBYTSIZ = 0;

  29520   2 0008F5  8745 0028                            CL       40,B5

     1023    29521    7                                                 KX$VC.CALINDPND = '0'B;

  29521   2 0008F7  8845 0016                            LBF,'1000'X       22,B5
  29521   2 0008F9       1000

     1024    29522    7                                              END;

     1025    29523    6                                     END;

     1026    29524    5                               KX$VC.STATE = %KX_VC_ST_WCA#;

  29524   2 0008FA  6C05                                 LDV,R6   5
          2 0008FB  ECC7 0006                            LDB,B6   X29$,AUTO
          2 0008FD  E7C6 0033                            STH,R6   51,B6
          2 0008FF  0F81 0011                            B        s:29537,PREL

     1027    29525    5                            CASE ( %KX_VC_ST_DCL# );
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:168  

     1028    29526    5                               KX$VC.STATE = %KX_VC_ST_READY#;

  29526   2 000901  5C03                                 LDV,R5   3
          2 000902  D7C4 0033                            STH,R5   51,B4
          2 000904  0F81 000C                            B        s:29537,PREL

     1029    29527    5                            CASE ( %KX_VC_ST_BGNPHSDSC#, %KX_VC_ST_ENDPHSDSC# );

     1030    29528        /* vc cleared before fully logged on */
     1031    29529    5                               GOTO L_CLEARED;

  29529   2 000906  0F81 0064                            B        s:29557,PREL

     1032    29530    5                            CASE ( ELSE );

     1033    29531        /*S* SCREECH_CODE: KXX-S$KX_LINKDEVSTT#
     1034    29532             MESSAGE: Event inconsistent with link device state.
     1035    29533        */
     1036    29534    5                               CALL KHD$SCREECH ( Y_LINKDEVSTT );

  29534   2 000908  BB80 0000 000F  03                   LAB,B3   +15
          2 00090B  CBF0 0100                            LAB,B4   256,IMO
          2 00090D  E380 0000 0000  xent                 LNJ,B6   KHD$SCREECH
          2 000910       0001                            DC       s:29537,PREL

     1037    29535    5                         END;  /* do case ( .state ) */

     1038    29536    4                   END; /* do case ( cnc_typ ) */

     1039    29537    3                   IF KX$X29.L3$ ~= ADDR(NIL) AND KX$X29.L3$->KX$L3.RLSCHN

  29537   2 000911  ECC7 0006                            LDB,B6   X29$,AUTO
          2 000913  8DC6 0006                            CMN      6,B6
          2 000915  0901 0055                            BE       s:29557,PREL
          2 000917  DCC6 0006                            LDB,B5   6,B6
          2 000919  82C5 0029                            LB,'0400'X        41,B5
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:169  
          2 00091B       0400
          2 00091C  0581 004E                            BBF      s:29557,PREL

     1040    29538    3                      THEN
     1041    29539    3                         CALL KHA$GET_CTX_PTR ( KX$X29.CHN$->KH$CHN.TERMID, DAT$ )

  29539   2 00091E  CCC6 0004                            LDB,B4   4,B6
          2 000920  BBC7 000A                            LAB,B3   DAT$,AUTO
          2 000922  BFC7 0084                            STB,B3   WRDSIZ2N+5,AUTO
          2 000924  DBC4 0012                            LAB,B5   18,B4
          2 000926  DFC7 0082                            STB,B5   WRDSIZ2N+3,AUTO
          2 000928  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 00092A  CBF0 0200                            LAB,B4   512,IMO
          2 00092C  E380 0000 0000  xent                 LNJ,B6   KHA$GET_CTX_PTR
          2 00092F       003C                            DC       s:29557,PREL

     1042    29540    3                            WHENRETURN
     1043    29541    4                               DO;

     1044    29542    4                                  KX$X29.CHN$ = DAT$;

  29542   2 000930  ECC7 000A                            LDB,B6   DAT$,AUTO
          2 000932  DCC7 0006                            LDB,B5   X29$,AUTO
          2 000934  EFC5 0004                            STB,B6   4,B5

     1045    29543    4                                  %KV_VDI.CHN$ = KX$X29.CHN$;

  29543   2 000936  ECC7 0006                            LDB,B6   X29$,AUTO
          2 000938  DCC6 0004                            LDB,B5   4,B6
          2 00093A  CCC7 0008                            LDB,B4   VDI$,AUTO
          2 00093C  DF84                                 STB,B5   ,B4

     1046    29544    4                                  TEMP1$ = KX$X29.CHN$;

  29544   2 00093D  ECC7 0006                            LDB,B6   X29$,AUTO
          2 00093F  BCC6 0004                            LDB,B3   4,B6
          2 000941  BFC7 0010                            STB,B3   TEMP1$,AUTO
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:170  

     1047    29545    4                                  TEMP0 = %KX_P_EV_UPDCHN#;

  29545   2 000943  6C13                                 LDV,R6   19
          2 000944  EF47 0033                            STR,R6   TEMP0,AUTO

     1048    29546                                       %DISABLE;

  29547   2 000946  AC80 0000 0002  xsym                 LDB,B2   KH_CTLTBL+2
          2 000949  D802                                 LDR,R5   ,B2
          2 00094A  DF47 0034                            STR,R5   LEVEL,AUTO

  29547   2 00094C  DBC7 0034                            LAB,B5   LEVEL,AUTO
          2 00094E  DFC7 0082                            STB,B5   WRDSIZ2N+3,AUTO
          2 000950  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 000952  CBF0 0100                            LAB,B4   256,IMO
          2 000954  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          2 000957       0001                            DC       s:29549,PREL

     1049    29549    4                                  CALL Y$CAL_PAC;

  29549   2 000958  E3C0 0663                            LNJ,B6   s:0,PREL
          2 00095A       0001                            DC       s:29551,PREL

     1050    29550                                       %ENABLE;

  29551   2 00095B  EC80 0000 0002  xsym                 LDB,B6   KH_CTLTBL+2
          2 00095E  E847 0034                            LDR,R6   LEVEL,AUTO
          2 000960  E906                                 CMR,R6   ,B6
          2 000961  0901 0007                            BE       s:29553,PREL

  29551   2 000963  CBF0 0000                            LAB,B4   0,IMO
          2 000965  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          2 000968       0001                            DC       s:29553,PREL

     1051    29553    4                               END;

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:171  
  29553   2 000969  0F81 0001                            B        s:29557,PREL

     1052    29554    3                            WHENALTRETURN
     1053    29555    4                               DO;

     1054    29556        /*N* Eh? */
     1055    29557    4                               END;

  29557   2 00096B  0F81 0584            L_CLEARED       B        s:30384,PREL

     1056    29558    3   L_CLEARED:      ;
     1057    29559    3                CASE ( %KV_USR_EVT_ID_OPN );

     1058    29560        /*
     1059    29561           Only control connections get this event.
     1060    29562        */
     1061    29563    3                   KX$LINKDEV.OPNSSN = '1'B;

  29563   2 00096D  8944 0017                            LBT,'0020'X       23,B4
  29563   2 00096F       0020
          2 000970  0F81 057F                            B        s:30384,PREL

     1062    29564    3                CASE ( %KV_USR_EVT_ID_CLS );

     1063    29565        /*
     1064    29566           Only control connections get this event.
     1065    29567        */
     1066    29568    3                   KX$LINKDEV.OPNSSN = '0'B;

  29568   2 000972  8844 0017                            LBF,'0020'X       23,B4
  29568   2 000974       0020

     1067    29569    3                   KX$LINKDEV.CLSSSN = '1'B;

  29569   2 000975  8944 0017                            LBT,'0010'X       23,B4
  29569   2 000977       0010
          2 000978  0F81 0577                            B        s:30384,PREL
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:172  

     1068    29570    3                CASE (ELSE);

     1069    29571
     1070    29572        /*S* SCREECH_CODE: KXX-S$KX_UNKVDIEVT#
     1071    29573             MESSAGE: KXX$VDI called by VDH with an unknown user event.
     1072    29574        */
     1073    29575    3                   CALL KHD$SCREECH ( Y_UNKVDIEVT );

  29575   2 00097A  BB80 0000 0011  03                   LAB,B3   +17
          2 00097D  CBF0 0100                            LAB,B4   256,IMO
          2 00097F  E380 0000 0000  xent                 LNJ,B6   KHD$SCREECH
          2 000982       0001                            DC       s:29577,PREL

     1074    29576
     1075    29577    3             END; /* DO CASE(...EVT_ID...)  */

  29577   2 000983  0F81 056C                            B        s:30384,PREL

     1076    29578
     1077    29579
     1078    29580        %EJECT;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:173  
     1079    29581        /* KV$USR_EXTINPTRN - EXTENDED INPUT TRANSLATION                              */
     1080    29582
     1081    29583    2          CASE(%KV_USR_FNC_EXTINPTRN );

     1082    29584
     1083    29585    3             DO SELECT(ASCBIT(PRM_USR_EXTINPTRN.ORGCHR)

  29585   2 000985  ACC6 0006                            LDB,B2   6,B6
          2 000987  9CC2 000E                            LDB,B1   14,B2
          2 000989  D841 001A                            LDR,R5   26,B1
          2 00098B  5008                                 SOL,R5   8
          2 00098C  C843 0001                            LDR,R4   1,B3
          2 00098E  4008                                 SOL,R4   8
          2 00098F  D554                                 AND,R5   R4
          2 000990  D970 0D00                            CMR,R5   3328,IMO
          2 000992  0201 0009                            BL       s:29585+23,PREL
          2 000994  0901 0020                            BE       s:29608,PREL
          2 000996  D970 7F00                            CMR,R5   32512,IMO
          2 000998  0981 0098                            BNE      s:29701,PREL
          2 00099A  0F81 0009                            B        s:29592,PREL
          2 00099C  5901 0007                            BEZ,R5   s:29592,PREL
          2 00099E  D970 0600                            CMR,R5   1536,IMO
          2 0009A0  0981 0090                            BNE      s:29701,PREL
          2 0009A2  0F81 0047                            B        s:29646,PREL

     1084    29586    3                & BINBIT(BITBIN(%KV_TRNTBL.INPCHRMSK),8));
     1085    29587    3                SELECT (%ASCIIDEL,%ASCIINUL);

     1086    29588
     1087    29589        /* THIS IS A DEL OR NUL CHARACTER. IF IN PAPER TAPE MODE AND NOT              */
     1088    29590        /* DOING A TRANSPARENT READ, IGNORE IT.                                       */
     1089    29591
     1090    29592    3                IF NOT KV$PTR.INPCNDPND.TRN

  29592   2 0009A4  89C6 001B                            CMZ      27,B6
          2 0009A6  0801 008A                            BAL      s:29701,PREL

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:174  
     1091    29593    3                   THEN
     1092    29594    4                      DO;

     1093    29595
     1094    29596        /* WE'RE NOT IN TRANSPARENT MODE.                                             */
     1095    29597
     1096    29598    4                        IF (%KV_VDI.HALFDUPLEXPAPERTAPE OR %KV_VDI.FULLDUPLEXPAPERTAPE
             29598                                  )

  29598   2 0009A8  82C5 0019                            LB,'0002'X        25,B5
  29598   2 0009AA       0002
          2 0009AB  0501 0006                            BBT      s:29604,PREL
          2 0009AD  82C5 0019                            LB,'0020'X        25,B5
          2 0009AF       0020
          2 0009B0  0581 0080                            BBF      s:29701,PREL

     1097    29599    4                            THEN
     1098    29600    5                               DO;

     1099    29601
     1100    29602        /* WE'RE IN A PAPER TAPE MODE. IGNORE THE CHARACTER.                          */
     1101    29603
     1102    29604    5                                  RETURN;

  29604   2 0009B2  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1103    29605    5                               END /* IF PAPER TAPE MODE */;
     1104    29606    4                      END /* IF TRNASPARENT MODE */;
     1105    29607    3                SELECT(%ASCIICR);

     1106    29608    3                IF (KX$X29.HLTOTP.BITT(%KA#HLTOTP_USRX)

  29608   2 0009B5  82C4 0015                            LB,'4000'X        21,B4
  29608   2 0009B7       4000
          2 0009B8  0581 0012                            BBF      s:29624,PREL
          2 0009BA  8283                                 LB,'0040'X        ,B3
          2 0009BB       0040
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:175  
          2 0009BC  0581 000E                            BBF      s:29624,PREL

     1107    29609    3                   AND PRM_USR_EXTINPTRN.IMD)
     1108    29610    3                   THEN
     1109    29611    4                      DO;

     1110    29612
     1111    29613        /* THIS IS A CR (CARRIAGE RETURN).                                            */
     1112    29614        /* THERE IS A USER OUTPUT HALT IN EFFECT* OTHERWISE IGNORE THE CR.            */
     1113    29615
     1114    29616
     1115    29617    4                         KX$X29.HLTOTP.BITT ( %KA#HLTOTP_USRX ) = '0'B;

  29617   2 0009BE  8844 0015                            LBF,'4000'X       21,B4
  29617   2 0009C0       4000

     1116    29618    4                         IF NOT KX$X29.HLTOTP

  29618   2 0009C1  82C4 0015                            LB,'C000'X        21,B4
  29618   2 0009C3       C000
          2 0009C4  0501 0004                            BBT      s:29621,PREL

     1117    29619    4                            THEN
     1118    29620    4                               KX$X29.ASNHLTOTP = '0'B;

  29620   2 0009C6  8844 0016                            LBF,'2000'X       22,B4
  29620   2 0009C8       2000

     1119    29621    4                         GOTO CHECK_RETURN;

  29621   2 0009C9  0F81 0053                            B        s:29692,PREL

     1120    29622    4                      END;
     1121    29623    3                   ELSE
     1122    29624    3                      IF NOT KX$X29.HLTOTP.BITT(%KA#HLTOTP_USRX)

  29624   2 0009CB  82C4 0015                            LB,'4000'X        21,B4
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:176  
  29624   2 0009CD       4000
          2 0009CE  0501 0062                            BBT      s:29701,PREL

     1123    29625    3                         THEN
     1124    29626    4                            DO;

     1125    29627    4                               IF KX$X29.SND.NXTLOD$ ~= ADDR(NIL) AND

  29627   2 0009D0  8DC4 000E                            CMN      14,B4
          2 0009D2  0901 000D                            BE       s:29635,PREL
          2 0009D4  ECC4 000E                            LDB,B6   14,B4
          2 0009D6  82C6 0002                            LB,'4000'X        2,B6
          2 0009D8       4000
          2 0009D9  0581 0006                            BBF      s:29635,PREL

     1126    29628    4                                  KX$X29.SND.NXTLOD$->KX$X29_OTPBFR.HLTOTP.BITT(%
             29628                                           KA#HLTOTP_USRX)
     1127    29629    4                                  THEN
     1128    29630    5                                     DO;

     1129    29631    5                                       KX$X29.SND.NXTLOD$->KX$X29_OTPBFR.HLTOTP.BITT(%
             29631                                                 KA#HLTOTP_USRX) = '0'B;

  29631   2 0009DB  8846 0002                            LBF,'4000'X       2,B6
  29631   2 0009DD       4000

     1130    29632    5                                        GOTO CHECK_RETURN;

  29632   2 0009DE  0F81 003E                            B        s:29692,PREL

     1131    29633    5                                     END;
     1132    29634    4                                  ELSE
     1133    29635    4                                     IF KX$X29.HLTOTPNXTBFR.BITT(%KA#HLTOTP_USRX)

  29635   2 0009E0  82C4 0016                            LB,'4000'X        22,B4
  29635   2 0009E2       4000
          2 0009E3  0581 004D                            BBF      s:29701,PREL
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:177  

     1134    29636    4                                        THEN
     1135    29637    5                                           DO;

     1136    29638    5                                             KX$X29.HLTOTPNXTBFR.BITT(%KA#HLTOTP_USRX)
             29638                                                       = '0'B;

  29638   2 0009E5  8844 0016                            LBF,'4000'X       22,B4
  29638   2 0009E7       4000

     1137    29639    5                                              GOTO CHECK_RETURN;

  29639   2 0009E8  0F81 0034                            B        s:29692,PREL

     1138    29640    5                                           END;
     1139    29641    4                            END;
     1140    29642    3                SELECT(%ASCIIACK);

     1141    29643
     1142    29644        /* THIS IS AN ACK CHARACTER.                                                  */
     1143    29645
     1144    29646    3                IF (%KV_MRD.DVCFLWCTRALG = %G_DVCFLWCTRALG_ENQACK#

  29646   2 0009EA  DCC6 0008                            LDB,B5   8,B6
          2 0009EC  D845 0015                            LDR,R5   21,B5
          2 0009EE  D570 00FF                            AND,R5   255,IMO
          2 0009F0  5D01                                 CMV,R5   1
          2 0009F1  0901 0004                            BE       s:29654,PREL
          2 0009F3  5D02                                 CMV,R5   2
          2 0009F4  0981 003C                            BNE      s:29701,PREL

     1145    29647    3                   OR %KV_MRD.DVCFLWCTRALG = %G_DVCFLWCTRALG_ETXACK#)
     1146    29648    3                   THEN
     1147    29649    4                      DO;

     1148    29650
     1149    29651        /* THIS DEVICE SENDS ACK CHARACTERS TO CONTROL THE                            */
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:178  
     1150    29652        /* FLOW OF DATA TO IT. RESUME OUTPUT, AND IGNORE THE CHARACTER.               */
     1151    29653
     1152    29654    4                         IF NOT KX$X29.HLTOTP.BITT(%KA#HLTOTP_DVCX)

  29654   2 0009F6  89C4 0015                            CMZ      21,B4
          2 0009F8  0801 0019                            BAL      s:29687,PREL

     1153    29655    4                            THEN
     1154    29656    5                               DO;

     1155    29657
     1156    29658        /* OUTPUT HAS BEEN HALTED, BUT WE DON'T KNOW THAT YET. THE FLOW               */
     1157    29659        /* CONTROL CHARACTER HAS BEEN SENT, BUT WE HAVEN'T PROCESSED THE              */
     1158    29660        /* OUTPUT INTERRRUPT YET THAT MARKS OUTPUT AS BEING HALTED.                   */
     1159    29661        /* WE'VE RECEIVED THE GO-AHEAD CHARACTER (WE GOT IT FAST), SO RESET           */
     1160    29662        /* THE BITS THAT ARE ABOUT TO CAUSE US TO HALT.                               */
     1161    29663
     1162    29664    5                                  IF KX$X29.SND.NXTLOD$ ~= ADDR(NIL) AND

  29664   2 0009FA  8DC4 000E                            CMN      14,B4
          2 0009FC  0901 000C                            BE       s:29672,PREL
          2 0009FE  ECC4 000E                            LDB,B6   14,B4
          2 000A00  89C6 0002                            CMZ      2,B6
          2 000A02  0881 0006                            BAGE     s:29672,PREL

     1163    29665    5                                     KX$X29.SND.NXTLOD$->KX$X29_OTPBFR.HLTOTP.BITT(%
             29665                                              KA#HLTOTP_DVCX)
     1164    29666    5                                     THEN
     1165    29667
     1166    29668        /* THE NEXT BUFFER TO BE IOLD'D IS THE ONE WITH THE HALT BIT.                 */
     1167    29669
     1168    29670    5                                       KX$X29.SND.NXTLOD$->KX$X29_OTPBFR.HLTOTP.BITT(%
             29670                                                 KA#HLTOTP_DVCX) = '0'B;

  29670   2 000A04  8846 0002                            LBF,'8000'X       2,B6
  29670   2 000A06       8000
          2 000A07  0F81 0015                            B        s:29692,PREL
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:179  

     1169    29671    5                                     ELSE
     1170    29672    5                                        IF KX$X29.HLTOTPNXTBFR.BITT(%KA#HLTOTP_DVCX)

  29672   2 000A09  89C4 0016                            CMZ      22,B4
          2 000A0B  0881 0011                            BAGE     s:29692,PREL

     1171    29673    5                                           THEN
     1172    29674
     1173    29675        /* THE LAST BUFFER IN THE CHAIN IS THE ONE THAT CONTAINED                     */
     1174    29676        /* THE FLOW CONTROL CHARACTER.                                                */
     1175    29677
     1176    29678    5                                             KX$X29.HLTOTPNXTBFR.BITT(%KA#HLTOTP_DVCX)
             29678                                                       = '0'B;

  29678   2 000A0D  8844 0016                            LBF,'8000'X       22,B4
  29678   2 000A0F       8000

     1177    29679    5                               END;

  29679   2 000A10  0F81 000C                            B        s:29692,PREL

     1178    29680    4                            ELSE
     1179    29681
     1180    29682        /* OUR OUTPUT STATUS INDICATES WE KNOW WE'RE HALTED.                          */
     1181    29683        /* RESUME OUTPUT.                                                             */
     1182    29684
     1183    29685
     1184    29686    4   L_5:
     1185    29687    5                               DO;

  29687   2                              L_5             null
     1186    29688    5                                  KX$X29.HLTOTP.BITT ( %KA#HLTOTP_DVCX ) = '0'B;

  29688   2 000A12  8844 0015            L_5             LBF,'8000'X       21,B4
  29688   2 000A14       8000

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:180  
     1187    29689    5                                  IF NOT KX$X29.HLTOTP

  29689   2 000A15  82C4 0015                            LB,'C000'X        21,B4
  29689   2 000A17       C000
          2 000A18  0501 0004                            BBT      s:29692,PREL

     1188    29690    5                                     THEN
     1189    29691    5                                        KX$X29.ASNHLTOTP = '0'B;

  29691   2 000A1A  8844 0016                            LBF,'2000'X       22,B4
  29691   2 000A1C       2000

     1190    29692    5                               END;

     1191    29693    4   CHECK_RETURN:         IF KX$X29.OTPBFRBYTCNT > 0 AND KX$X29.L3$~=ADDR(NIL)

  29693   2 000A1D  ECC7 0006            CHECK_RETURN    LDB,B6   X29$,AUTO
          2 000A1F  D846 0012                            LDR,R5   18,B6
          2 000A21  5901 000C                            BEZ,R5   s:29696,PREL
          2 000A23  8DC6 0006                            CMN      6,B6
          2 000A25  0901 0008                            BE       s:29696,PREL

     1192    29694    4                            THEN
     1193    29695    4                               KX$X29.L3$->KX$L3.L2$->KX$L2.FLG.DATAVL = '1'B;

  29695   2 000A27  DCC6 0006                            LDB,B5   6,B6
          2 000A29  CCC5 0002                            LDB,B4   2,B5
          2 000A2B  8944 002E                            LBT,'0002'X       46,B4
          2 000A2D       0002

     1194    29696    4                         RETURN;

  29696   2 000A2E  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1195    29697    4                      END /* IF */;
     1196    29698    3             END; /* SELECT                             */

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:181  
     1197    29699        /* We dont know about this character, say we didnt do anything. */
     1198    29700
     1199    29701    2             ALTRETURN;

  29701   2 000A31  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

     1200    29702
     1201    29703        %EJECT;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:182  
     1202    29704    2          CASE(%KV_USR_FNC_GETOTPBFR );

     1203    29705
     1204    29706
     1205    29707        /*
     1206    29708           Raise L2's DATAVL bit so that this new output will flow.
     1207    29709        */
     1208    29710    2             IF CNC_TYP ~= %KXX_TYP_X29# OR KX$X29.STATE > %KX_X29_ST_NRM#

  29710   2 000A34  6D01                                 CMV,R6   1
          2 000A35  0981 000C                            BNE      s:29712,PREL
          2 000A37  D844 0018                            LDR,R5   24,B4
          2 000A39  D570 00FF                            AND,R5   255,IMO
          2 000A3B  5D04                                 CMV,R5   4
          2 000A3C  0301 0005                            BG       s:29712,PREL
          2 000A3E  8DC4 0006                            CMN      6,B4
          2 000A40  0981 0004                            BNE      s:29713,PREL

     1209    29711    2                OR KX$X29.L3$ = ADDR(NIL)
     1210    29712    2                THEN ALTRETURN;

  29712   2 000A42  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

     1211    29713    2             KX$X29.L3$->KX$L3.L2$->KX$L2.FLG.DATAVL = '1'B;

  29713   2 000A45  ACC4 0006                            LDB,B2   6,B4
          2 000A47  9CC2 0002                            LDB,B1   2,B2
          2 000A49  8941 002E                            LBT,'0002'X       46,B1
          2 000A4B       0002

     1212    29714        /* UPDATE A FEW COUNTERS SPECIFIC TO ASYNC                                    */
     1213    29715
     1214    29716    2             %KV_VDI.OTPCHRCNTAFTLF = %KV_VDI.OTPCHRCNTAFTLF+%KV_VDI.TMPOTPCHRCNT;

  29716   2 000A4C  D845 001C                            LDR,R5   28,B5
          2 000A4E  DA45 0015                            ADD,R5   21,B5
          2 000A50  DF45 001C                            STR,R5   28,B5
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:183  

     1215    29717    2             IF (KX$X29.OTPBFRBYTCNT > KA_OTPBLKLMT(%KV_VDI.LINSPD)*2

  29717   2 000A52  B2C5 001E                            LLH,R3   30,B5
          2 000A54  C830 0000 0000  xsym                 LDR,R4   KA_OTPBLKLMT,R3
          2 000A57  4001                                 SOL,R4   1
          2 000A58  8254                                 NEG      R4
          2 000A59  CA30 0000 0000  xsym                 ADD,R4   KA_OTPUN_BLKLMT,R3
          2 000A5C  8254                                 NEG      R4
          2 000A5D  CA70 1388                            ADD,R4   5000,IMO
          2 000A5F  4801 0005                            BLZ,R4   s:29726,PREL
          2 000A61  C944 0012                            CMR,R4   18,B4
          2 000A63  0281 0007                            BGE      s:29737,PREL

     1216    29718    2                - KA_OTPUN_BLKLMT(%KV_VDI.LINSPD) + 5000)
     1217    29719    2                THEN
     1218    29720    3                   DO;

     1219    29721
     1220    29722        /* The output buffer byte count is getting excessive.                         */
     1221    29723        /* Assume we're out of control, and not allocate any more                     */
     1222    29724        /* space.                                                                     */
     1223    29725
     1224    29726    3                      KA_OTPBFRLMTEXC = KA_OTPBFRLMTEXC+1;

  29726   2 000A65  8A80 0000 0002  01                   INC      KA_OTPBFRLMTEXC

     1225    29727    3                      ALTRETURN;

  29727   2 000A68  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

     1226    29728    3                   END;
     1227    29729    2                ELSE
     1228    29730
     1229    29731        /* We don't have excessive output buffers allocated.                          */
     1230    29732
     1231    29733        /* This GROUP is exited if we satisfy the caller's buffer                     */
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:184  
     1232    29734        /* requirements without allocating a new buffer.                              */
     1233    29735
     1234    29736        /* CHECK TO SEE IF FLOW CONTROL IS ON                                         */
     1235    29737    3   Y@DOGROUP:      DO;

  29737   2                              Y@DOGROUP       null
     1236    29738    3                      IF (KA_DVCFLWCTRCHR(%KV_MRD.DVCFLWCTRALG) ~= 0)

  29738   2 000A6B  ACC6 0008            Y@DOGROUP       LDB,B2   8,B6
          2 000A6D  A842 0015                            LDR,R2   21,B2
          2 000A6F  A570 00FF                            AND,R2   255,IMO
          2 000A71  2001                                 SOL,R2   1
          2 000A72  C2A0 0000 0000  xsym                 LLH,R4   KA_DVCFLWCTRCHR,R2
          2 000A75  4901 003F                            BEZ,R4   s:29805,PREL

     1237    29739    3                         THEN
     1238    29740    4                            DO;

     1239    29741
     1240    29742        /* FLOW CONTROL IS ON                                                         */
     1241    29743
     1242    29744    4                              KX$X29.OTPCHRCNTUTLHLT = KX$X29.OTPCHRCNTUTLHLT-%KV_VDI.
             29744                                        TMPOTPCHRCNT;

  29744   2 000A77  C844 0013                            LDR,R4   19,B4
          2 000A79  C245 0015                            SUB,R4   21,B5
          2 000A7B  CF44 0013                            STR,R4   19,B4

     1243    29745    4                               IF (KX$X29.OTPCHRCNTUTLHLT <= 0)

  29745   2 000A7D  4A01 0009                            BGZ,R4   s:29756,PREL

     1244    29746    4                                  THEN
     1245    29747    5                                     DO;

     1246    29748
     1247    29749        /* WE SHOULD SEND THE DEVICE FLOW CONTROL SEQUENCE                            */
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:185  
     1248    29750
     1249    29751    5                                        CALL Y$SNCFLWCTRHLT ;

  29751   2 000A7F  AB80 0000 0000                       LAB,B2   0
          2 000A82  AFC7 0062                            STB,B2   CNC_TYP+3,AUTO
          2 000A84  E3C0 046E                            LNJ,B6   s:0,PREL
          2 000A86       0001                            DC       s:29756,PREL

     1250    29752    5                                     END /* IF */;

     1251    29753
     1252    29754        /* SETUP Y_VDI_LCL.SIGSIZ TO BE THE NUMBER OF CHARS TO NEXT HALT              */
     1253    29755
     1254    29756    4                               Y_VDI_LCL.SIGSIZ = KX$X29.OTPCHRCNTUTLHLT;

  29756   2 000A87  ECC7 0006                            LDB,B6   X29$,AUTO
          2 000A89  E846 0013                            LDR,R6   19,B6
          2 000A8B  EF47 003C                            STR,R6   Y_VDI_LCL+4,AUTO

     1255    29757
     1256    29758        /* SEE IF WE ACTUALLY NEED ANOTHER BUFFER OR WHETHER THERE IS                 */
     1257    29759
     1258    29760    4                               IF (%KV_VDI.OTPBFR_.ADR$ ~= ADDR(NIL))

  29760   2 000A8D  DCC7 0008                            LDB,B5   VDI$,AUTO
          2 000A8F  8DC5 000A                            CMN      10,B5
          2 000A91  0901 0027                            BE       s:29810,PREL

     1259    29761    4                                  THEN
     1260    29762    5                                     DO;

     1261    29763
     1262    29764        /* SEE HOW BIG THIS BUFFER ACTUALLY IS                                        */
     1263    29765
     1264    29766    5                                        Y@BYTSIZ =

  29766   2 000A93  CCC5 000A                            LDB,B4   10,B5
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:186  
          2 000A95  B844 0002                            LDR,R3   2,B4
          2 000A97  304A                                 SOR,R3   10
          2 000A98  B570 000F                            AND,R3   15,IMO
          2 000A9A  D830 0000 002E  00                   LDR,R5   Y_POWER_OF_2,R3
          2 000A9D  D245 000C                            SUB,R5   12,B5
          2 000A9F  C2C4 0003                            LLH,R4   3,B4
          2 000AA1  4FFA                                 MLV,R4   -6
          2 000AA2  CA55                                 ADD,R4   R5
          2 000AA3  CF47 002C                            STR,R4   Y@BYTSIZ,AUTO

     1265    29767    5                                           Y_POWER_OF_2(%KV_VDI.OTPBFR_.ADR$->
             29767                                                    KX$X29_OTPBFR.BYTSIZLOG2)
     1266    29768    5                                           -%KV_VDI.OTPBFR_.BYTX
     1267    29769    5                                          -%KV_VDI.OTPBFR_.ADR$->KX$X29_OTPBFR.NMBMRK*
             29769                                                    SIZEC(KV$OTPMRK);
     1268    29770    5                                        IF (Y@BYTSIZ >= 2)

  29770   2 000AA5  4D02                                 CMV,R4   2
          2 000AA6  0201 0012                            BL       s:29810,PREL

     1269    29771    5                                           THEN
     1270    29772    6                                              DO;

     1271    29773
     1272    29774        /* There are at least two bytes left in the current output buffer.            */
     1273    29775        /* Give some of them to the caller, rather than allocating another            */
     1274    29776        /* buffer.                                                                    */
     1275    29777
     1276    29778    6                                                IF (KX$X29.OTPCHRCNTUTLHLT <= Y@BYTSIZ
             29778                                                          )

  29778   2 000AA8  6801 0004                            BLZ,R6   s:29786,PREL
          2 000AAA  E954                                 CMR,R6   R4
          2 000AAB  0301 0005                            BG       s:29793,PREL

     1277    29779    6                                                    THEN
     1278    29780    7                                                       DO;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:187  

     1279    29781
     1280    29782        /* We're to halt for flow control before we'd fill the rest of                */
     1281    29783        /* the buffer. Declare the framed portion of the buffer to be the             */
     1282    29784        /* character count until we halt.                                             */
     1283    29785
     1284    29786    7                                                          %KV_VDI.OTPBFR_.BYTSIZ =
             29786                                                                   KX$X29.OTPCHRCNTUTLHLT;

  29786   2 000AAD  EF45 000D                            STR,R6   13,B5

     1285    29787    7                                                       END;

  29787   2 000AAF  0F81 0003                            B        s:29795,PREL

     1286    29788    6                                                    ELSE
     1287    29789    7                                                       DO;

     1288    29790
     1289    29791        /* Give the caller the rest of the buffer.                                    */
     1290    29792
     1291    29793    7                                                          %KV_VDI.OTPBFR_.BYTSIZ =
             29793                                                                   Y@BYTSIZ;

  29793   2 000AB1  CF45 000D                            STR,R4   13,B5

     1292    29794    7                                                       END /* IF */;

     1293    29795    6                                                 EXIT Y@DOGROUP;
             29795                                                    /* LOOK BELOW                        */

  29795   2 000AB3  0F81 0199                            B        s:30008,PREL

     1294    29796    6                                              END /* IF */;
     1295    29797    5                                     END /* IF */;
     1296    29798    4                            END;
     1297    29799    3                         ELSE
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:188  
     1298    29800    4                            DO;

     1299    29801
     1300    29802        /* THERE IS NO FLOW CONTROL IN EFFECT. SETUP Y_VDI_LCL.SIGSIZ TO NOT 1        */
     1301    29803        /* BE A LIMITING FACTOR                                                       */
     1302    29804
     1303    29805    4                               Y_VDI_LCL.SIGSIZ = %BITBIN('7FFF'X);

  29805   2 000AB5  C870 7FFF                            LDR,R4   32767,IMO
          2 000AB7  CF47 003C                            STR,R4   Y_VDI_LCL+4,AUTO

     1304    29806    4                            END /* IF */;

     1305    29807
     1306    29808        /* WE NEED TO TRUNCATE AND BUILD A NEW OUTPUT BUFFER                          */
     1307    29809
     1308    29810    3                      CALL KXX$TRNOTP ( %KV_VDI );

  29810   2 000AB9  BBC7 0008                            LAB,B3   VDI$,AUTO
          2 000ABB  CBF0 0100                            LAB,B4   256,IMO
          2 000ABD  E380 0000 0000  xent                 LNJ,B6   KXX$TRNOTP
          2 000AC0       0001                            DC       s:29811,PREL

     1309    29811    3                      IF (PRM_USR_GETOTPBFR.ESTBYTSIZ < Y_VDI_LCL.SIGSIZ)

  29811   2 000AC1  ECC7 0004                            LDB,B6   @PRM_USR_X,AUTO
          2 000AC3  E846 0001                            LDR,R6   1,B6
          2 000AC5  E947 003C                            CMR,R6   Y_VDI_LCL+4,AUTO
          2 000AC7  0281 0003                            BGE      s:29825,PREL

     1310    29812    3                         THEN
     1311    29813    4                            DO;

     1312    29814
     1313    29815        /* The estimated byte size of the buffer needed is less than                  */
     1314    29816        /* the maximum size otherwise needed. Use the estimated size                  */
     1315    29817        /* in determining what size buffer to get.                                    */
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:189  
     1316    29818
     1317    29819    4                               Y@BYTSIZ = PRM_USR_GETOTPBFR.ESTBYTSIZ;

  29819   2 000AC9  EF47 002C                            STR,R6   Y@BYTSIZ,AUTO

     1318    29820    4                            END /* IF */;

     1319    29821
     1320    29822        /* WE NEED TO ALLOCATE A BUFFER AT LEAST Y@BYTSIZ BYTES LONG. SEE WHICH       */
     1321    29823        /* SIZE BUFFER WE SHOULD USE                                                  */
     1322    29824
     1323    29825    3                      Y@BYTSIZ2 = Y@BYTSIZ;

  29825   2 000ACB  D847 002C                            LDR,R5   Y@BYTSIZ,AUTO
          2 000ACD  DF47 002D                            STR,R5   Y@BYTSIZ2,AUTO

     1324    29826    3                      Y@BYTSIZ = Y@BYTSIZ + LENGTHC(KX$X29_OTPBFR);

  29826   2 000ACF  5E08                                 ADV,R5   8
          2 000AD0  DF47 002C                            STR,R5   Y@BYTSIZ,AUTO

     1325    29827    3                      IF (Y@BYTSIZ2 = 1) AND (KX$X29.SND.HED$ = ADDR(NIL))

  29827   2 000AD2  C847 002D                            LDR,R4   Y@BYTSIZ2,AUTO
          2 000AD4  4D01                                 CMV,R4   1
          2 000AD5  0981 0019                            BNE      s:29841,PREL
          2 000AD7  DCC7 0006                            LDB,B5   X29$,AUTO
          2 000AD9  8DC5 000C                            CMN      12,B5
          2 000ADB  0981 0013                            BNE      s:29841,PREL

     1326    29828    3                         THEN
     1327    29829    4                            DO;

     1328    29830
     1329    29831        /* We're being asked to get only one byte of space, and we                    */
     1330    29832        /* currently have no output buffers. Assume this is the                       */
     1331    29833        /* echoplex case, and get a small buffer irregardless of                      */
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:190  
     1332    29834        /* the status of the previous output buffer used.                             */
     1333    29835
     1334    29836    4                               Y_VDI_LCL.BYTSIZ = KA_OTPBFRBYTSIZ_SML;

  29836   2 000ADD  B800 0000 0000  xsym                 LDR,R3   KA_OTPBFRBYTSIZ_SML
          2 000AE0  BF47 003A                            STR,R3   Y_VDI_LCL+2,AUTO

     1335    29837    4                               Y_VDI_LCL.BYTSIZLOG2 = KA_OTPBFRBYTSIZ_SMLLOG2;

  29837   2 000AE2  A800 0000 0000  xsym                 LDR,R2   KA_OTPBFRBYTSIZ_SMLLOG2
          2 000AE5  AF47 003B                            STR,R2   Y_VDI_LCL+3,AUTO

     1336    29838    4                               KX_STATS_X29.OTPBFRGETCNT_SML = KX_STATS_X29.
             29838                                        OTPBFRGETCNT_SML+1;

  29838   2 000AE7  8A80 0000 0043  xsym                 INC      KX_STATS_X29+67
          2 000AEA  8E80 0000 0042  xsym                 CAD      KX_STATS_X29+66

     1337    29839    4                            END;

  29839   2 000AED  0F81 002F                            B        s:29865,PREL

     1338    29840    3                         ELSE
     1339    29841    3                            IF (Y@BYTSIZ <= KA_OTPBFRBYTSIZ_SML) AND NOT KX$X29.
             29841                                     PRVOTPBFRDATEXCSML

  29841   2 000AEF  D900 0000 0000  xsym                 CMR,R5   KA_OTPBFRBYTSIZ_SML
          2 000AF2  0301 001A                            BG       s:29861,PREL
          2 000AF4  DCC7 0006                            LDB,B5   X29$,AUTO
          2 000AF6  82C5 0015                            LB,'2000'X        21,B5
          2 000AF8       2000
          2 000AF9  0501 0013                            BBT      s:29861,PREL

     1340    29842    3                               THEN
     1341    29843    4                                  DO;

     1342    29844
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:191  
     1343    29845        /* The amount of buffer space we're being asked to get is less                */
     1344    29846        /* than what fits in a small buffer, and the previous output                  */
     1345    29847        /* buffer's data didn't exceed what fits in a small buffer.                   */
     1346    29848        /* Get a small buffer, on the assumption that what we're being                */
     1347    29849        /* asked to get isn't only a small portion of our total buffer                */
     1348    29850        /* requirements for the next few (hundred) milliseconds.                      */
     1349    29851
     1350    29852    4                                     Y_VDI_LCL.BYTSIZ = KA_OTPBFRBYTSIZ_SML;

  29852   2 000AFB  B800 0000 0000  xsym                 LDR,R3   KA_OTPBFRBYTSIZ_SML
          2 000AFE  BF47 003A                            STR,R3   Y_VDI_LCL+2,AUTO

     1351    29853    4                                     Y_VDI_LCL.BYTSIZLOG2 = KA_OTPBFRBYTSIZ_SMLLOG2;

  29853   2 000B00  A800 0000 0000  xsym                 LDR,R2   KA_OTPBFRBYTSIZ_SMLLOG2
          2 000B03  AF47 003B                            STR,R2   Y_VDI_LCL+3,AUTO

     1352    29854    4                                     KX_STATS_X29.OTPBFRGETCNT_SML = KX_STATS_X29.
             29854                                              OTPBFRGETCNT_SML+1;

  29854   2 000B05  8A80 0000 0043  xsym                 INC      KX_STATS_X29+67
          2 000B08  8E80 0000 0042  xsym                 CAD      KX_STATS_X29+66

     1353    29855    4                                  END;

  29855   2 000B0B  0F81 0011                            B        s:29865,PREL

     1354    29856    3                               ELSE
     1355    29857    4                                  DO;

     1356    29858
     1357    29859        /* Get a big output buffer.                                                   */
     1358    29860
     1359    29861    4                                     Y_VDI_LCL.BYTSIZ = KA_OTPBFRBYTSIZ_BIG;

  29861   2 000B0D  B800 0000 0000  xsym                 LDR,R3   KA_OTPBFRBYTSIZ_BIG
          2 000B10  BF47 003A                            STR,R3   Y_VDI_LCL+2,AUTO
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:192  

     1360    29862    4                                     Y_VDI_LCL.BYTSIZLOG2 = KA_OTPBFRBYTSIZ_BIGLOG2;

  29862   2 000B12  A800 0000 0000  xsym                 LDR,R2   KA_OTPBFRBYTSIZ_BIGLOG2
          2 000B15  AF47 003B                            STR,R2   Y_VDI_LCL+3,AUTO

     1361    29863    4                                     KX_STATS_X29.OTPBFRGETCNT_BIG = KX_STATS_X29.
             29863                                              OTPBFRGETCNT_BIG+1;

  29863   2 000B17  8A80 0000 0045  xsym                 INC      KX_STATS_X29+69
          2 000B1A  8E80 0000 0044  xsym                 CAD      KX_STATS_X29+68

     1362    29864    4                                  END /* IF */;

     1363    29865    3                      Y@BYTSIZ = Y_VDI_LCL.BYTSIZ - LENGTHC(KX$X29_OTPBFR);

  29865   2 000B1D  D853                                 LDR,R5   R3
          2 000B1E  5EF8                                 ADV,R5   -8
          2 000B1F  DF47 002C                            STR,R5   Y@BYTSIZ,AUTO

     1364    29866    3                      IF (Y_VDI_LCL.SIGSIZ > Y@BYTSIZ)

  29866   2 000B21  D947 003C                            CMR,R5   Y_VDI_LCL+4,AUTO
          2 000B23  0281 0003                            BGE      s:29878,PREL

     1365    29867    3                         THEN
     1366    29868    4                            DO;

     1367    29869
     1368    29870        /* The data space in the buffer we'd like to have is less than                */
     1369    29871        /* that in the buffer we're getting. Adjust the size we wanted                */
     1370    29872        /* down, so that it is the size we're getting.                                */
     1371    29873
     1372    29874    4                               Y_VDI_LCL.SIGSIZ = Y@BYTSIZ;

  29874   2 000B25  DF47 003C                            STR,R5   Y_VDI_LCL+4,AUTO

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:193  
     1373    29875    4                            END /* IF */;

     1374    29876
     1375    29877                           %DISABLE;

  29878   2 000B27  DC80 0000 0002  xsym                 LDB,B5   KH_CTLTBL+2
          2 000B2A  E805                                 LDR,R6   ,B5
          2 000B2B  EF47 0034                            STR,R6   LEVEL,AUTO

  29878   2 000B2D  CBC7 0034                            LAB,B4   LEVEL,AUTO
          2 000B2F  CFC7 0082                            STB,B4   WRDSIZ2N+3,AUTO
          2 000B31  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 000B33  CBF0 0100                            LAB,B4   256,IMO
          2 000B35  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          2 000B38       0001                            DC       s:29881,PREL

     1376    29880
     1377    29881    3                      CALL KVB$GETSYS(Y_VDI_LCL.BYTSIZ/2,%KV_VDI.OTPBFR_.ADR$)

  29881   2 000B39  E847 003A                            LDR,R6   Y_VDI_LCL+2,AUTO
          2 000B3B  6041                                 SOR,R6   1
          2 000B3C  EF47 0082                            STR,R6   WRDSIZ2N+3,AUTO
          2 000B3E  ECC7 0008                            LDB,B6   VDI$,AUTO
          2 000B40  DBC6 000A                            LAB,B5   10,B6
          2 000B42  DFC7 0085                            STB,B5   WRDSIZ2N+6,AUTO
          2 000B44  CBC7 0082                            LAB,B4   WRDSIZ2N+3,AUTO
          2 000B46  CFC7 0083                            STB,B4   WRDSIZ2N+4,AUTO
          2 000B48  BBC7 0083                            LAB,B3   WRDSIZ2N+4,AUTO
          2 000B4A  CBF0 0200                            LAB,B4   512,IMO
          2 000B4C  E380 0000 0000  xent                 LNJ,B6   KVB$GETSYS
          2 000B4F       0003                            DC       s:29884,PREL
          2 000B50  0F81 0063                            B        s:29920,PREL

     1378    29882    3                         WHENALTRETURN
     1379    29883    4                            DO;

     1380    29884    4                               IF (Y_VDI_LCL.BYTSIZ <= KA_OTPBFRBYTSIZ_SML)
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:194  

  29884   2 000B52  E847 003A                            LDR,R6   Y_VDI_LCL+2,AUTO
          2 000B54  E900 0000 0000  xsym                 CMR,R6   KA_OTPBFRBYTSIZ_SML
          2 000B57  0301 0011                            BG       s:29900,PREL

     1381    29885    4                                  THEN
     1382    29886    5                                     DO;

     1383    29887        /*
     1384    29888           we can't even get a small buffer. Screech
     1385    29889        */
     1386    29890    5                                        KX$X29.PRTX4NXTBFR = 0;

  29890   2 000B59  ECC7 0006                            LDB,B6   X29$,AUTO
          2 000B5B  8746 001A                            CL       26,B6

     1387    29891    5                                        CALL KHD$SCREECH ( Y_NO_GET );

  29891   2 000B5D  BB80 0000 0013  03                   LAB,B3   +19
          2 000B60  CBF0 0100                            LAB,B4   256,IMO
          2 000B62  E380 0000 0000  xent                 LNJ,B6   KHD$SCREECH
          2 000B65       0001                            DC       s:29892,PREL

     1388    29892    5                                        ALTRETURN;

  29892   2 000B66  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

     1389    29893    5                                     END;
     1390    29894
     1391    29895    4                                  ELSE
     1392    29896    5                                     DO;

     1393    29897        /*
     1394    29898           try to get small buffer before screeching
     1395    29899        */
     1396    29900    5                                        KX_STATS_X29.OTPBFRGETCNT_BIG = KX_STATS_X29.
             29900                                                 OTPBFRGETCNT_BIG - 1;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:195  

  29900   2 000B69  8C80 0000 0044  xsym                 LDI      KX_STATS_X29+68
          2 000B6C  8470 FFFF FFFF                       AID      -1,IMO
          2 000B6F  8D00 0000 0044  xsym                 SDI      KX_STATS_X29+68

     1397    29901    5                                        KX_STATS_X29.OTPBFRGETCNT_SML = KX_STATS_X29.
             29901                                                 OTPBFRGETCNT_SML + 1;

  29901   2 000B72  8A80 0000 0043  xsym                 INC      KX_STATS_X29+67
          2 000B75  8E80 0000 0042  xsym                 CAD      KX_STATS_X29+66

     1398    29902    5                                        Y_VDI_LCL.BYTSIZ = KA_OTPBFRBYTSIZ_SML;

  29902   2 000B78  D800 0000 0000  xsym                 LDR,R5   KA_OTPBFRBYTSIZ_SML
          2 000B7B  DF47 003A                            STR,R5   Y_VDI_LCL+2,AUTO

     1399    29903    5                                       Y_VDI_LCL.BYTSIZLOG2 = KA_OTPBFRBYTSIZ_SMLLOG2;

  29903   2 000B7D  C800 0000 0000  xsym                 LDR,R4   KA_OTPBFRBYTSIZ_SMLLOG2
          2 000B80  CF47 003B                            STR,R4   Y_VDI_LCL+3,AUTO

     1400    29904    5                                        Y@BYTSIZ = Y_VDI_LCL.BYTSIZ - LENGTHC(
             29904                                                 KX$X29_OTPBFR);

  29904   2 000B82  5EF8                                 ADV,R5   -8
          2 000B83  DF47 002C                            STR,R5   Y@BYTSIZ,AUTO

     1401    29905    5                                        IF (Y_VDI_LCL.SIGSIZ > Y@BYTSIZ)

  29905   2 000B85  D947 003C                            CMR,R5   Y_VDI_LCL+4,AUTO
          2 000B87  0281 0003                            BGE      s:29910,PREL

     1402    29906    5                                           THEN
     1403    29907    6                                              DO;

     1404    29908    6                                                 Y_VDI_LCL.SIGSIZ = Y@BYTSIZ;

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:196  
  29908   2 000B89  DF47 003C                            STR,R5   Y_VDI_LCL+4,AUTO

     1405    29909    6                                              END;

     1406    29910    5                                        CALL KVB$GETSYS(Y_VDI_LCL.BYTSIZ/2,%KV_VDI.
             29910                                                 OTPBFR_.ADR$)

  29910   2 000B8B  B847 003A                            LDR,R3   Y_VDI_LCL+2,AUTO
          2 000B8D  3041                                 SOR,R3   1
          2 000B8E  BF47 0082                            STR,R3   WRDSIZ2N+3,AUTO
          2 000B90  ECC7 0008                            LDB,B6   VDI$,AUTO
          2 000B92  DBC6 000A                            LAB,B5   10,B6
          2 000B94  DFC7 0085                            STB,B5   WRDSIZ2N+6,AUTO
          2 000B96  CBC7 0082                            LAB,B4   WRDSIZ2N+3,AUTO
          2 000B98  CFC7 0083                            STB,B4   WRDSIZ2N+4,AUTO
          2 000B9A  BBC7 0083                            LAB,B3   WRDSIZ2N+4,AUTO
          2 000B9C  CBF0 0200                            LAB,B4   512,IMO
          2 000B9E  E380 0000 0000  xent                 LNJ,B6   KVB$GETSYS
          2 000BA1       0003                            DC       s:29913,PREL
          2 000BA2  0F81 0011                            B        s:29920,PREL

     1407    29911    5                                           WHENALTRETURN
     1408    29912    6                                              DO;

     1409    29913    6                                                 KX$X29.PRTX4NXTBFR = 0;

  29913   2 000BA4  ECC7 0006                            LDB,B6   X29$,AUTO
          2 000BA6  8746 001A                            CL       26,B6

     1410    29914    6                                                 CALL KHD$SCREECH ( Y_NO_GET );

  29914   2 000BA8  BB80 0000 0013  03                   LAB,B3   +19
          2 000BAB  CBF0 0100                            LAB,B4   256,IMO
          2 000BAD  E380 0000 0000  xent                 LNJ,B6   KHD$SCREECH
          2 000BB0       0001                            DC       s:29915,PREL

     1411    29915    6                                                 ALTRETURN;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:197  

  29915   2 000BB1  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

     1412    29916    6                                              END;
     1413    29917    5                                     END;

     1414    29918    4                            END; /* WHENALTRETURN                      */

     1415    29919
     1416    29920    3                      IF KX$X29.PRTX4NXTBFR ~= 0

  29920   2 000BB4  ECC7 0006                            LDB,B6   X29$,AUTO
          2 000BB6  E846 001A                            LDR,R6   26,B6
          2 000BB8  6901 0007                            BEZ,R6   s:29927,PREL

     1417    29921    3                         THEN
     1418    29922    4                            DO;

     1419    29923    4                               KX$X29.PRTX = KX$X29.PRTX4NXTBFR;

  29923   2 000BBA  EF46 0019                            STR,R6   25,B6

     1420    29924    4                               KX$X29.PRTX4NXTBFR = 0;

  29924   2 000BBC  8746 001A                            CL       26,B6

     1421    29925    4                            END;

  29925   2 000BBE  0F81 0004                            B        s:29928,PREL

     1422    29926    3                         ELSE
     1423    29927    3                            KX$X29.PRTX = LENGTHC ( KX$X29_OTPBFR );

  29927   2 000BC0  5C08                                 LDV,R5   8
          2 000BC1  DF46 0019                            STR,R5   25,B6

     1424    29928    3                     KX_STATS_X29.KHSTT.OTPBFRBYTUTL = KX_STATS_X29.KHSTT.OTPBFRBYTUTL
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:198  
             29928                               +Y_VDI_LCL.BYTSIZ;

  29928   2 000BC3  F847 003A                            LDR,R7   Y_VDI_LCL+2,AUTO
          2 000BC5  6C00                                 LDV,R6   0
          2 000BC6  8400 0000 001E  xsym                 AID      KX_STATS_X29+30
          2 000BC9  8D00 0000 001E  xsym                 SDI      KX_STATS_X29+30

     1425    29929    3                      %KV_VDI.OTPBFR_.BYTX = LENGTHC(KX$X29_OTPBFR);

  29929   2 000BCC  DCC7 0008                            LDB,B5   VDI$,AUTO
          2 000BCE  5C08                                 LDV,R5   8
          2 000BCF  DF45 000C                            STR,R5   12,B5

     1426    29930    3                      %KV_VDI.OTPBFR_.BYTSIZ = Y_VDI_LCL.SIGSIZ;

  29930   2 000BD1  E847 003C                            LDR,R6   Y_VDI_LCL+4,AUTO
          2 000BD3  EF45 000D                            STR,R6   13,B5

     1427    29931
     1428    29932        /* SETUP THE BUFFER HEADER                                                    */
     1429    29933
     1430    29934    3                      %KV_VDI.OTPBFR_.ADR$->KX$X29_OTPBFR = '0'B;

  29934   2 000BD5  CCC5 000A                            LDB,B4   10,B5
          2 000BD7  0021                                 ALR      ;
          2 000BD8       4178 0000                                ALPHANUM('0000'X,IMO,,1),;
          2 000BDA       4004 0000                                ALPHANUM(0,B4,,R5,FILL)

     1431    29935    3                      %KV_VDI.OTPBFR_.ADR$->KX$X29_OTPBFR.BYTSIZLOG2 = Y_VDI_LCL.
             29935                               BYTSIZLOG2;

  29935   2 000BDC  437F                                 CSYNC    s:29934+6,SPREL
          2 000BDD  ECC7 0008                            LDB,B6   VDI$,AUTO
          2 000BDF  DCC6 000A                            LDB,B5   10,B6
          2 000BE1  E847 003B                            LDR,R6   Y_VDI_LCL+3,AUTO
          2 000BE3  600A                                 SOL,R6   10
          2 000BE4  EAC5 0002                            SRM,R6,'3C00'X    2,B5
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:199  
          2 000BE6       3C00

     1432    29936
     1433    29937
     1434    29938    3                      KX$X29.OTPBFRBYTCNT = KX$X29.OTPBFRBYTCNT+Y_VDI_LCL.BYTSIZ;

  29938   2 000BE7  DCC7 0006                            LDB,B5   X29$,AUTO
          2 000BE9  E845 0012                            LDR,R6   18,B5
          2 000BEB  EA47 003A                            ADD,R6   Y_VDI_LCL+2,AUTO
          2 000BED  EF45 0012                            STR,R6   18,B5

     1435    29939    3                      IF (KX$X29.OTPBFRBYTCNT >= KA_OTPBLKLMT(%KV_VDI.LINSPD))

  29939   2 000BEF  B2C6 001E                            LLH,R3   30,B6
          2 000BF1  E930 0000 0000  xsym                 CMR,R6   KA_OTPBLKLMT,R3
          2 000BF4  0201 0017                            BL       s:29968,PREL

     1436    29940    3                         THEN
     1437    29941    4                            DO;

     1438    29942
     1439    29943        /* The output buffer byte count is greater than the block limit.              */
     1440    29944        /* Wind down the flow of output.                                              */
     1441    29945
     1442    29946                                    %KV$RQSOTP (RQSOTP=NO);
             29952    5           IF KV$VDI.RQSOTP THEN DO;

  29952   2 000BF6  82C6 0019                            LB,'0008'X        25,B6
  29952   2 000BF8       0008
          2 000BF9  0581 0012                            BBF      s:29968,PREL

             29953    5              KV$VDI.RQSOTP = '0'B;

  29953   2 000BFB  8846 0019                            LBF,'0008'X       25,B6
  29953   2 000BFD       0008

             29954    5              IF KV$VDI.SSNCNT>1
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:200  

  29954   2 000BFE  E846 000E                            LDR,R6   14,B6
          2 000C00  6D01                                 CMV,R6   1
          2 000C01  0381 000A                            BLE      s:29968,PREL

             29955    5              THEN CALL KVV$VDI (KV_VDH_EVT_RQSOTP);

  29955   2 000C03  BB80 0000 0002  03                   LAB,B3   +2
          2 000C06  CBF0 0100                            LAB,B4   256,IMO
          2 000C08  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          2 000C0B       0001                            DC       s:29968,PREL

             29956    5              END;

     1443    29964    4                            END /* IF */;

     1444    29965
     1445    29966        /* UPDATE THE OUTPUT BUFFER CHAIN                                             */
     1446    29967
     1447    29968    3                      IF (KX$X29.SND.TAL$ = ADDR(NIL))

  29968   2 000C0C  ECC7 0006                            LDB,B6   X29$,AUTO
          2 000C0E  8DC6 0010                            CMN      16,B6
          2 000C10  0981 000D                            BNE      s:29982,PREL

     1448    29969    3                         THEN
     1449    29970    4                            DO;

     1450    29971
     1451    29972        /* THERE IS NO CHAIN                                                          */
     1452    29973
     1453    29974    4                               KX$X29.SND.HED$ = %KV_VDI.OTPBFR_.ADR$;

  29974   2 000C12  DCC7 0008                            LDB,B5   VDI$,AUTO
          2 000C14  CCC5 000A                            LDB,B4   10,B5
          2 000C16  CFC6 000C                            STB,B4   12,B6

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:201  
     1454    29975    4                               KX$X29.SND.NXTLOD$ = %KV_VDI.OTPBFR_.ADR$;

  29975   2 000C18  BCC5 000A                            LDB,B3   10,B5
          2 000C1A  BFC6 000E                            STB,B3   14,B6

     1455    29976
     1456    29977        /* OTHERWISE, A CHAIN EXISTS. ADD THIS BUFFER TO THE TAIL                     */
     1457    29978
     1458    29979    4                            END;

  29979   2 000C1C  0F81 001E                            B        s:29997,PREL

     1459    29980    3                         ELSE
     1460    29981    4                            DO;

     1461    29982    4                              %KV_VDI.OTPBFR_.ADR$->KX$X29_OTPBFR.HLTOTP_ALL = KX$X29.
             29982                                        HLTOTPNXTBFR_ALL;

  29982   2 000C1E  DCC7 0008                            LDB,B5   VDI$,AUTO
          2 000C20  CCC5 000A                            LDB,B4   10,B5
          2 000C22  E846 0016                            LDR,R6   22,B6
          2 000C24  EAC4 0002                            SRM,R6,'C000'X    2,B4
          2 000C26       C000

     1462    29983    4                               KX$X29.HLTOTPNXTBFR = '0'B;

  29983   2 000C27  ECC7 0006                            LDB,B6   X29$,AUTO
          2 000C29  8846 0016                            LBF,'C000'X       22,B6
          2 000C2B       C000

     1463    29984    4                               KX$X29.SND.TAL$->KX$X29_OTPBFR.LNK$ = %KV_VDI.OTPBFR_.
             29984                                        ADR$;

  29984   2 000C2C  CCC6 0010                            LDB,B4   16,B6
          2 000C2E  BCC5 000A                            LDB,B3   10,B5
          2 000C30  BF84                                 STB,B3   ,B4

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:202  
     1464    29985    4                               IF (KX$X29.SND.NXTLOD$ = ADDR(NIL))

  29985   2 000C31  ECC7 0006                            LDB,B6   X29$,AUTO
          2 000C33  8DC6 000E                            CMN      14,B6
          2 000C35  0981 0005                            BNE      s:29997,PREL

     1465    29986    4                                  THEN
     1466    29987    5                                     DO;

     1467    29988
     1468    29989        /* INIT THE IOLD BUFFER                                                       */
     1469    29990
     1470    29991    5                                        KX$X29.SND.NXTLOD$ = %KV_VDI.OTPBFR_.ADR$;

  29991   2 000C37  CCC5 000A                            LDB,B4   10,B5
          2 000C39  CFC6 000E                            STB,B4   14,B6

     1471    29992    5                                     END /* IF */;

     1472    29993    4                            END /* IF */;

     1473    29994
     1474    29995        /* SETUP THE TAIL POINTER.                                                    */
     1475    29996
     1476    29997    3                      KX$X29.SND.TAL$ = %KV_VDI.OTPBFR_.ADR$;

  29997   2 000C3B  CCC5 000A                            LDB,B4   10,B5
          2 000C3D  CFC6 0010                            STB,B4   16,B6

     1477    29998
     1478    29999
     1479    30000        /* Go back to the level we were at */
     1480    30001
     1481    30002                           %ENABLE;

  30003   2 000C3F  BC80 0000 0002  xsym                 LDB,B3   KH_CTLTBL+2
          2 000C42  E847 0034                            LDR,R6   LEVEL,AUTO
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:203  
          2 000C44  E903                                 CMR,R6   ,B3
          2 000C45  0901 0007                            BE       s:30008,PREL

  30003   2 000C47  CBF0 0000                            LAB,B4   0,IMO
          2 000C49  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          2 000C4C       0001                            DC       s:30008,PREL

     1482    30005    3                   END Y@DOGROUP;

     1483    30006        /* CLEAR THE HANDLER SPECIFIC BYTE COUNT                                      */
     1484    30007
     1485    30008    2             %KV_VDI.TMPOTPCHRCNT = 0;

  30008   2 000C4D  ECC7 0008                            LDB,B6   VDI$,AUTO
          2 000C4F  8746 0015                            CL       21,B6
          2 000C51  0F81 029E                            B        s:30384,PREL

     1486    30009
     1487    30010        %EJECT;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:204  
     1488    30011        /* KV$USR_GETPRM - GET PARAMETER REQUEST                                      */
     1489    30012
     1490    30013    2          CASE(%KV_USR_FNC_GETPRM );

     1491    30014
     1492    30015        /* We don't do any GETPRMs, but we get asked about some things                */
     1493    30016        /* we don't know about. Just doing nothing is ok.                             */
     1494    30017
     1495    30018
     1496    30019        %EJECT;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:205  
     1497    30020        /* KV$USR_INPPRC - INPUT PROCEDURE                                            */
     1498    30021
     1499    30022    2          CASE(%KV_USR_FNC_INPPRC );

     1500    30023    2             IF CNC_TYP ~= %KXX_TYP_X29# THEN GOTO DIE;

  30023   2 000C53  6D01                                 CMV,R6   1
          2 000C54  0981 0292                            BNE      s:30376,PREL

     1501    30024    3             DO CASE( PRM_USR_INPPRC.ID );

  30024   2 000C56  92C3 0002                            LLH,R1   2,B3
          2 000C58  1D06                                 CMV,R1   6
          2 000C59  0281 00E3                            BGE      s:30172,PREL
          2 000C5B  B810 0000 0C61  02                   LDR,R3   s:30024+11,R1
          2 000C5E  83B0 0000 0C67  02                   JMP      s:30027,R3
          2 000C61       00D6                            DC       s:30172,PREL
          2 000C62       00D6                            DC       s:30172,PREL
          2 000C63       0071                            DC       s:30100,PREL
          2 000C64       007B                            DC       s:30107,PREL
          2 000C65       0000                            DC       s:30027,PREL
          2 000C66       00A4                            DC       s:30123,PREL

     1502    30025    3                CASE( %KA#INPPRC_PRTERR );

     1503    30026
     1504    30027    3                   ERCOD = LINERRDSC;   /* prepare to call Y$ER  */

  30027   2 000C67  8C80 0000 0077  00                   LDI      LINERRDSC
          2 000C6A  8D47 002E                            SDI      ERCOD,AUTO

     1505    30028        /* THIS IS A CLA OVER-RUN OR PARITY ERROR.                                    */
     1506    30029
     1507    30030    3                   IF (KA_LINERRDSCLMT ~= BITBIN('FF'X))

  30030   2 000C6C  D800 0000 0000  xsym                 LDR,R5   KA_LINERRDSCLMT
          2 000C6F  D970 00FF                            CMR,R5   255,IMO
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:206  
          2 000C71  0901 0043                            BE       s:30064,PREL

     1508    30031    3                      THEN
     1509    30032    4                         DO;

     1510    30033
     1511    30034        /* The line error disconnect limit indicates we should monitor                */
     1512    30035        /* line errors for disconnect purposes.                                       */
     1513    30036
     1514    30037    4                            IF (KX$X29.LINERRDSCCNT >= KA_LINERRDSCLMT)

  30037   2 000C73  C844 0016                            LDR,R4   22,B4
          2 000C75  C570 00FF                            AND,R4   255,IMO
          2 000C77  C955                                 CMR,R4   R5
          2 000C78  0201 0020                            BL       s:30057,PREL

     1515    30038    4                               THEN
     1516    30039    5                                  DO;

     1517    30040
     1518    30041        /* The line error count exceeds the limit. Disconnect, error-log,             */
     1519    30042        /* and possibly disable the line.                                             */
     1520    30043
     1521    30044    5                                     CALL Y$ER ;

  30044   2 000C7A  E3C0 0374                            LNJ,B6   s:0,PREL
          2 000C7C       0001                            DC       s:30047,PREL

     1522    30045
     1523    30046
     1524    30047    5                                     %KV_VDI.INTPHSDSC = '1'B;

  30047   2 000C7D  ECC7 0008                            LDB,B6   VDI$,AUTO
          2 000C7F  8946 001D                            LBT,'0800'X       29,B6
          2 000C81       0800

     1525    30048    5                                     KV@VDH_DSC = KXX_VDH_DSC;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:207  

  30048   2 000C82  8C80 0000 0000  xsym                 LDI      KXX_VDH_DSC
          2 000C85  8D47 003F                            SDI      KV@VDH_DSC,AUTO

     1526    30049    5                                     KV@VDH_DSC.RSN = %KV_DSCRSN_HRDERR;

  30049   2 000C87  5C04                                 LDV,R5   4
          2 000C88  DAC7 003F                            SRM,R5,'00FF'X    KV@VDH_DSC,AUTO
          2 000C8A       00FF

     1527    30050    5                                     CALL KVV$VDI(KV@VDH_DSC) ;

  30050   2 000C8B  DBC7 003F                            LAB,B5   KV@VDH_DSC,AUTO
          2 000C8D  DFC7 0082                            STB,B5   WRDSIZ2N+3,AUTO
          2 000C8F  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 000C91  CBF0 0100                            LAB,B4   256,IMO
          2 000C93  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          2 000C96       0001                            DC       s:30051,PREL

     1528    30051    5                                  END;

  30051   2 000C97  0F81 001D                            B        s:30064,PREL

     1529    30052    4                               ELSE
     1530    30053    5                                  DO;

     1531    30054
     1532    30055        /* The line error count doesn't exceed the limit.                             */
     1533    30056
     1534    30057    5                                     KV@VDH_SETCLK = KV_VDH_SETCLK;

  30057   2 000C99  8C80 0000 0000  xsym                 LDI      KV_VDH_SETCLK
          2 000C9C  8D47 004B                            SDI      KV@VDH_SETCLK,AUTO

     1535    30058    5                                     KV@VDH_SETCLK.UNT = %KV_CLKUNT_MNT;

  30058   2 000C9E  4C02                                 LDV,R4   2
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:208  
          2 000C9F  CAC7 004B                            SRM,R4,'00FF'X    KV@VDH_SETCLK,AUTO
          2 000CA1       00FF

     1536    30059    5                                     KV@VDH_SETCLK.PRD = 1;

  30059   2 000CA2  3C01                                 LDV,R3   1
          2 000CA3  B7C7 004C                            STH,R3   KV@VDH_SETCLK+1,AUTO

     1537    30060    5                                     KV@VDH_SETCLK.CLKNMB = %KV_CLKNMB_USRCLK1;

  30060   2 000CA5  2C04                                 LDV,R2   4
          2 000CA6  AAC7 004C                            SRM,R2,'00FF'X    KV@VDH_SETCLK+1,AUTO
          2 000CA8       00FF

     1538    30061    5                                     CALL KVV$VDI(KV@VDH_SETCLK) ;

  30061   2 000CA9  ABC7 004B                            LAB,B2   KV@VDH_SETCLK,AUTO
          2 000CAB  AFC7 0082                            STB,B2   WRDSIZ2N+3,AUTO
          2 000CAD  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 000CAF  CBF0 0100                            LAB,B4   256,IMO
          2 000CB1  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          2 000CB4       0001                            DC       s:30064,PREL

     1539    30062    5                                  END /* IF */;

     1540    30063    4                         END /* IF */;

     1541    30064    3                   KX$X29.LINERRDSCCNT = KX$X29.LINERRDSCCNT+1;

  30064   2 000CB5  ECC7 0006                            LDB,B6   X29$,AUTO
          2 000CB7  E846 0016                            LDR,R6   22,B6
          2 000CB9  EA70 0001                            ADD,R6   1,IMO
          2 000CBB  EAC6 0016                            SRM,R6,'00FF'X    22,B6
          2 000CBD       00FF

     1542    30065    3                   IF (KA_LINERRLOGLMT ~= BITBIN('FF'X))

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:209  
  30065   2 000CBE  E800 0000 0000  xsym                 LDR,R6   KA_LINERRLOGLMT
          2 000CC1  E970 00FF                            CMR,R6   255,IMO
          2 000CC3  0901 022C                            BE       s:30384,PREL

     1543    30066    3                      THEN
     1544    30067    4                         DO;

     1545    30068
     1546    30069        /* The line error log limit indicates we should monitor                       */
     1547    30070        /* line errors for log purposes.                                              */
     1548    30071
     1549    30072    4                            IF (KX$X29.LINERRLOGCNT >= KA_LINERRLOGLMT)

  30072   2 000CC5  D2C6 0017                            LLH,R5   23,B6
          2 000CC7  D956                                 CMR,R5   R6
          2 000CC8  0201 000A                            BL       s:30088,PREL

     1550    30073    4                               THEN
     1551    30074    5                                  DO;

     1552    30075
     1553    30076        /* The line error count exceeds the limit. Log the error.                     */
     1554    30077
     1555    30078    5                                     CALL Y$ER ;

  30078   2 000CCA  E3C0 0324                            LNJ,B6   s:0,PREL
          2 000CCC       0001                            DC       s:30081,PREL

     1556    30079
     1557    30080
     1558    30081    5                                     KX$X29.LINERRLOGCNT = 0;

  30081   2 000CCD  ECC7 0006                            LDB,B6   X29$,AUTO
          2 000CCF  87C6 0017                            CLH      23,B6

     1559    30082    5                                  END;

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:210  
  30082   2 000CD1  0F81 021E                            B        s:30384,PREL

     1560    30083    4                               ELSE
     1561    30084    5                                  DO;

     1562    30085
     1563    30086        /* The line error count doesn't exceed the limit.                             */
     1564    30087
     1565    30088    5                                     KX$X29.LINERRLOGCNT = KX$X29.LINERRLOGCNT+1;

  30088   2 000CD3  5E01                                 ADV,R5   1
          2 000CD4  D7C6 0017                            STH,R5   23,B6

     1566    30089    5                                  END /* IF */;

     1567    30090    4                         END /* IF */;

  30090   2 000CD6  0F81 0219                            B        s:30384,PREL

     1568    30091    3                CASE(%KA#INPPRC_DVCOTPBFRCLR );

     1569    30092
     1570    30093        /* THE DEVICE'S OUTPUT BUFFER HAS BEEN CLEARED.                               */
     1571    30094        /* RESET THE OUTPUT CHARACTER COUNT UNTIL HALT BACK TO                        */
     1572    30095        /* THE DEVICE'S OUTPUT BUFFER SIZE, SINCE THE BUFFER                          */
     1573    30096        /* IS NOW EMPTY. THIS IS TO AVOID SENDING THE SYNCHRONOUS                     */
     1574    30097        /* FLOW CONTROL CHARACTER (E.G., ETX) WHILE THE DEVICE IS                     */
     1575    30098        /* THROWING AWAY CHARACTERS. IF WE DO, THE LINE GOES DEAD.                    */
     1576    30099
     1577    30100    3                   KX$X29.OTPCHRCNTUTLHLT = %KV_ERD.DVCOTPBFRSIZ;

  30100   2 000CD8  ACC6 0008                            LDB,B2   8,B6
          2 000CDA  9CC2 0008                            LDB,B1   8,B2
          2 000CDC  D841 0013                            LDR,R5   19,B1
          2 000CDE  DF44 0013                            STR,R5   19,B4
          2 000CE0  0F81 020F                            B        s:30384,PREL

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:211  
     1578    30101    3                CASE(%KA#INPPRC_HLTOTP );

     1579    30102
     1580    30103        /* THIS IS AN OUTPUT HALT REQUEST.                                            */
     1581    30104
     1582    30105
     1583    30106
     1584    30107    3                   IF %KV_VDI.PHSDSC OR %KV_SSN.LGCDSC OR

  30107   2 000CE2  82C5 0019                            LB,'0040'X        25,B5
  30107   2 000CE4       0040
          2 000CE5  0501 0023                            BBT      s:30114,PREL
          2 000CE7  ACC6 0002                            LDB,B2   2,B6
          2 000CE9  82C2 0028                            LB,'0400'X        40,B2
          2 000CEB       0400
          2 000CEC  0501 001C                            BBT      s:30114,PREL
          2 000CEE  82C2 0028                            LB,'0010'X        40,B2
          2 000CF0       0010
          2 000CF1  0501 0017                            BBT      s:30114,PREL

     1585    30108    3                      ( %KV_SSN.USRHLTINH )
     1586    30109    3                      THEN
     1587    30110    3                         GOTO L_2 ;
     1588    30111
     1589    30112    3                   Y@HLTOTP_ALL = KX$X29.HLTOTP_ALL;

  30112   2 000CF3  D844 0015                            LDR,R5   21,B4
          2 000CF5  D570 C000                            AND,R5   -16384,IMO
          2 000CF7  5048                                 SOR,R5   8
          2 000CF8  D7C7 0037                            STH,R5   Y@HLTOTP_ALL,AUTO

     1590    30113    3                   KX$X29.HLTOTP.BITT ( %KA#HLTOTP_USRX ) = '1'B;

  30113   2 000CFA  8944 0015                            LBT,'4000'X       21,B4
  30113   2 000CFC       4000

     1591    30114    3                   IF NOT Y@HLTOTP_ALL AND KX$X29.SND.TAL$ ~= ADDR(NIL)
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:212  

  30114   2 000CFD  D2C7 0037                            LLH,R5   Y@HLTOTP_ALL,AUTO
          2 000CFF  5008                                 SOL,R5   8
          2 000D00  5981 0008                            BNEZ,R5  s:30114,PREL
          2 000D02  8DC4 0010                            CMN      16,B4
          2 000D04  0901 0004                            BE       s:30114,PREL

     1592    30115    3                      THEN
     1593    30116    3                         KX$X29.ASNHLTOTP = '1'B;

  30116   2 000D06  8944 0016                            LBT,'2000'X       22,B4
  30116   2 000D08       2000

  30114   2 000D09  0F81 01E6            L_2             B        s:30384,PREL

     1594    30117    3   L_2:            ;
     1595    30118
     1596    30119    3                CASE(%KA#INPPRC_SETTRNTBL );

     1597    30120
     1598    30121        /* THIS IS A TOGGLE ASCII-APL REQUEST.                                        */
     1599    30122
     1600    30123    3                   Y@INDEX = 0;

  30123   2 000D0B  8747 0016                            CL       Y@INDEX,AUTO

     1601    30124    3   Y@LOOP2:
     1602    30125    4                   DO WHILE ('1'B); /* LOOP START                         */

  30125   2                              Y@LOOP2         null
     1603    30126
     1604    30127        /* THIS LOOP IS TRAVERSED FOR EACH CHARACTER IN THE KA_TRNTBLCHNCHR_...       */
     1605    30128        /* TABLE EXAMINED.                                                            */
     1606    30129
     1607    30130    4                      IF (PRM_USR_INPPRC.CHR = KA_TRNTBLCHNCHR$(%KV_TRNTBL.FNTCLS)->
             30130                               KA$TRNTBLCHNCHR(Y@INDEX))

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:213  
  30130   2 000D0D  EC80 0000 0000  xsym Y@LOOP2         LDB,B6   KV$PTR$
          2 000D10  DCC6 0006                            LDB,B5   6,B6
          2 000D12  CCC5 000E                            LDB,B4   14,B5
          2 000D14  B2C4 001D                            LLH,R3   29,B4
          2 000D16  BCB0 0000 0000  xsym                 LDB,B3   KA_TRNTBLCHNCHR$,R3
          2 000D19  ACC7 0004                            LDB,B2   @PRM_USR_X,AUTO
          2 000D1B  A847 0016                            LDR,R2   Y@INDEX,AUTO
          2 000D1D  E2A3                                 LLH,R6   ,B3,R2
          2 000D1E  E942 0001                            CMR,R6   1,B2
          2 000D20  0981 0014                            BNE      s:30157,PREL

     1608    30131
     1609    30132    4                         THEN
     1610    30133    5                            DO;

     1611    30134
     1612    30135        /* WE'VE FOUND THE TRANSLATED '$'. SET THE NEW TRANSLATE TABLE POINTER        */
     1613    30136        /* TO THE TRANSLATE TABLE INDICATED BY THE '$' VALUE.                         */
     1614    30137
     1615    30138    5                               IF %KV_MVD.APLLCNRM

  30138   2 000D22  82C5 0016                            LB,'0020'X        22,B5
  30138   2 000D24       0020
          2 000D25  0581 0008                            BBF      s:30153,PREL

     1616    30139    5                                  THEN
     1617    30140    6                                     DO;

     1618    30141
     1619    30142        /* IF WE ARE GOING TO AN APL TRANSLATE TABLE, GO TO THE PARTIAL (PRINT 'LOWERC*/
     1620    30143        /* CHARACTERS AS UPPERCASE) VERSION.                                          */
     1621    30144
     1622    30145    6                                        %KV_MVD.TRNTBL$ = KA_TRNTBL_PRT$(Y@INDEX);

  30145   2 000D27  9CA0 0000 0000  xsym                 LDB,B1   KA_TRNTBL_PRT$,R2
          2 000D2A  9FC5 000E                            STB,B1   14,B5

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:214  
     1623    30146    6                                     END;

  30146   2 000D2C  0F81 0006                            B        s:30155,PREL

     1624    30147    5                                  ELSE
     1625    30148    6                                     DO;

     1626    30149
     1627    30150        /* IF WE ARE GOING TO AN APL TRANSLATE TABLE, GO TO THE FULL (UNDERSCORED     */
     1628    30151        /* 'LOWERCASE' CHARACTERS) VERSION.                                           */
     1629    30152
     1630    30153    6                                        %KV_MVD.TRNTBL$ = KA_TRNTBL_FUL$(Y@INDEX);

  30153   2 000D2E  9CA0 0000 0000  xsym                 LDB,B1   KA_TRNTBL_FUL$,R2
          2 000D31  9FC5 000E                            STB,B1   14,B5

     1631    30154    6                                     END /* IF */;

     1632    30155    5                               EXIT Y@LOOP2; /* LOOK BELOW                         */

  30155   2 000D33  0F81 0007                            B        s:30165+1,PREL

     1633    30156    5                            END /* IF */;
     1634    30157    4                      IF (Y@INDEX >= %KV_FNTCLS_HI)

  30157   2 000D35  2D03                                 CMV,R2   3
          2 000D36  0881 0004                            BAGE     s:30165+1,PREL

     1635    30158    4                         THEN
     1636    30159    4                            EXIT Y@LOOP2;
     1637    30160
     1638    30161        /* EITHER THERE IS AN ERROR IN ONE OF THE TABLES THAT GETS US                 */
     1639    30162        /* HERE, OR THIS IS AN ILLEGAL ESCAPE SEQUENCE.                               */
     1640    30163
     1641    30164    4                      Y@INDEX = Y@INDEX+1;

  30164   2 000D38  8AC7 0016                            INC      Y@INDEX,AUTO
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:215  

     1642    30165    4                   END Y@LOOP2;

  30165   2 000D3A  0FD3                                 B        s:30125,SPREL
          2 000D3B  0F81 01B4                            B        s:30384,PREL

     1643    30166    3                CASE(ELSE);

     1644    30167
     1645    30168        /*S* SCREECH_CODE: KXX-S$KX_UNKINPPRC#
     1646    30169             MESSAGE: KXX$VDI called by VDH with unknown INPPRC.
     1647    30170        */
     1648    30171
     1649    30172    3                   CALL KHD$SCREECH ( Y_UNKINPPRC );

  30172   2 000D3D  BB80 0000 0015  03                   LAB,B3   +21
          2 000D40  CBF0 0100                            LAB,B4   256,IMO
          2 000D42  E380 0000 0000  xent                 LNJ,B6   KHD$SCREECH
          2 000D45       0001                            DC       s:30173,PREL

     1650    30173    3             END /* CASE */;

  30173   2 000D46  0F81 01A9                            B        s:30384,PREL

     1651    30174
     1652    30175        /* KV$USR_OTPMRK - OUTPUT MARKER REQUEST                                      */
     1653    30176
     1654    30177    2          CASE(%KV_USR_FNC_OTPMRK );

     1655    30178
     1656    30179
     1657    30180        /* If there is no output buffer at all, send the marker right back            */
     1658    30181
     1659    30182    2             IF (KX$X29.OTPBFRBYTCNT = 0 OR CNC_TYP ~= %KXX_TYP_X29#)

  30182   2 000D48  D844 0012                            LDR,R5   18,B4
          2 000D4A  5901 0004                            BEZ,R5   s:30185,PREL
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:216  
          2 000D4C  6D01                                 CMV,R6   1
          2 000D4D  0901 0020                            BE       s:30220,PREL

     1660    30183    2                THEN
     1661    30184    3                   DO;

     1662    30185    3                      KV@VDH_OTPMRK = KV_VDH_OTPMRK;

  30185   2 000D4F  AB80 0000 0000  xsym                 LAB,B2   KV_VDH_OTPMRK
          2 000D52  2C00                                 LDV,R2   0
          2 000D53  6C0A                                 LDV,R6   10
          2 000D54  BBC7 0046                            LAB,B3   KV@VDH_OTPMRK,AUTO
          2 000D56  3C00                                 LDV,R3   0
          2 000D57  0008                                 MMM

     1663    30186    3                      KV@VDH_OTPMRK.DAT = PRM_USR_OTPMRK.DAT;

  30186   2 000D58  ACC7 0004                            LDB,B2   @PRM_USR_X,AUTO
          2 000D5A  2C02                                 LDV,R2   2
          2 000D5B  6C06                                 LDV,R6   6
          2 000D5C  BBC7 0047                            LAB,B3   KV@VDH_OTPMRK+1,AUTO
          2 000D5E  3C00                                 LDV,R3   0
          2 000D5F  0008                                 MMM

     1664    30187    3                      CALL KVV$VDI(KV@VDH_OTPMRK) ;

  30187   2 000D60  EBC7 0046                            LAB,B6   KV@VDH_OTPMRK,AUTO
          2 000D62  EFC7 0082                            STB,B6   WRDSIZ2N+3,AUTO
          2 000D64  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 000D66  CBF0 0100                            LAB,B4   256,IMO
          2 000D68  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          2 000D6B       0001                            DC       s:30188,PREL

     1665    30188    3                   END;

  30188   2 000D6C  0F81 0072                            B        s:30261,PREL

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:217  
     1666    30189    2                ELSE
     1667    30190    3                   DO;

     1668    30191        %EJECT;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:218  
     1669    30192        /*
     1670    30193           A picture is needed to explain the following code about where to put
     1671    30194           the marker and how to update KV$VDI.OTPBFR_.BYTSIZ :
     1672    30195
     1673    30196                                   .__________________.
     1674    30197                      DAT$ ------->|       H D R      |
     1675    30198                                   |__________________|
     1676    30199                                   |                  |
     1677    30200                                   |       O T P      |
     1678    30201                                   |       C H R      |
     1679    30202                                   |__________________|
     1680    30203         KV$VDI.OTPBFR_.BYTX ---A->|                  |  A
     1681    30204                                |  |                  |  |
     1682    30205                                |  |                  | KV$VDI.OTPBFR_.BYTSIZ
     1683    30206                                |  |                  |  |
     1684    30207                      Spare space  |__________________|  V
     1685    30208                                |  /  /  /  /  /  /  /|
     1686    30209                                |  | /  /  /  /  /  / |
     1687    30210                                |  |/  /  /  /  /  /  /
     1688    30211                                   |__/__/__/__/__/__/|
     1689    30212                   Y@INDEX -----V->|   NEW MARKER     |
     1690    30213                                   |__________________|
     1691    30214                                   |                  |
     1692    30215                                   |       M R K      |
     1693    30216                                   |__________________|
     1694    30217
     1695    30218        */
     1696    30219
     1697    30220    3                      DAT$ = %KV_VDI.OTPBFR_.ADR$;

  30220   2 000D6E  ACC5 000A                            LDB,B2   10,B5
          2 000D70  AFC7 000A                            STB,B2   DAT$,AUTO

     1698    30221    3                      IF (DAT$ ~= ADDR(NIL))

  30221   2 000D72  8DC7 000A                            CMN      DAT$,AUTO
          2 000D74  0901 0020                            BE       s:30233,PREL
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:219  

     1699    30222    3                         THEN
     1700    30223    4                            DO;

     1701    30224    4                               Y@INDEX = Y_POWER_OF_2(KX$X29_OTPBFR.BYTSIZLOG2)

  30224   2 000D76  B842 0002                            LDR,R3   2,B2
          2 000D78  304A                                 SOR,R3   10
          2 000D79  B570 000F                            AND,R3   15,IMO
          2 000D7B  C2C2 0003                            LLH,R4   3,B2
          2 000D7D  4FFA                                 MLV,R4   -6
          2 000D7E  CA30 0000 002E  00                   ADD,R4   Y_POWER_OF_2,R3
          2 000D81  4EFA                                 ADV,R4   -6
          2 000D82  CF47 0016                            STR,R4   Y@INDEX,AUTO

     1702    30225    4                                  - (KX$X29_OTPBFR.NMBMRK+1)*SIZEC(KV$OTPMRK);
     1703    30226    4                               IF (Y@INDEX <= %KV_VDI.OTPBFR_.BYTX)

  30226   2 000D84  C945 000C                            CMR,R4   12,B5
          2 000D86  0A01 000E                            BAG      s:30233,PREL

     1704    30227    4                                  THEN
     1705    30228    5                                     DO;

     1706    30229    5                                        CALL KXX$TRNOTP ( %KV_VDI );

  30229   2 000D88  BBC7 0008                            LAB,B3   VDI$,AUTO
          2 000D8A  CBF0 0100                            LAB,B4   256,IMO
          2 000D8C  E380 0000 0000  xent                 LNJ,B6   KXX$TRNOTP
          2 000D8F       0001                            DC       s:30230,PREL

     1707    30230    5                                        KX$X29.PRVOTPBFRDATEXCSML = '1'B;

  30230   2 000D90  ECC7 0006                            LDB,B6   X29$,AUTO
          2 000D92  8946 0015                            LBT,'2000'X       21,B6
          2 000D94       2000

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:220  
     1708    30231    5                                     END;

     1709    30232    4                            END;

     1710    30233    3                      IF %KV_VDI.OTPBFR_.ADR$ = ADDR(NIL)

  30233   2 000D95  ECC7 0008                            LDB,B6   VDI$,AUTO
          2 000D97  8DC6 000A                            CMN      10,B6
          2 000D99  0981 0023                            BNE      s:30255,PREL

     1711    30234    3                         THEN
     1712    30235    4                            DO;

     1713    30236        /*
     1714    30237           Either we have just truncated the last buffer in the chain,
     1715    30238           or there is not enough room in the current buffer for the marker.
     1716    30239           Request another output buffer and place the marker there.
     1717    30240        */
     1718    30241    4                               KV_USR_GETOTPBFR.ESTBYTSIZ = 2;
             30241                                        /* anything > 1 will do           */

  30241   2 000D9B  6C02                                 LDV,R6   2
          2 000D9C  EF00 0000 0001  01                   STR,R6   KV_USR_GETOTPBFR+1

     1719    30242    4                               CALL KXX$VDI(KV_USR_GETOTPBFR)

  30242   2 000D9F  BB80 0000 000B  03                   LAB,B3   +11
          2 000DA2  CBF0 0100                            LAB,B4   256,IMO
          2 000DA4  E3C0 F25B                            LNJ,B6   s:10,PREL
          2 000DA6       0003                            DC       s:30245,PREL
          2 000DA7  0F81 0004                            B        s:30250,PREL

     1720    30243    4                                  WHENALTRETURN
     1721    30244    5                                     DO;

     1722    30245    5                                        ALTRETURN;

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:221  
  30245   2 000DA9  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

     1723    30246    5                                     END;
     1724    30247
     1725    30248        /* Put the marker at the bottom of this newly obtained buffer */
     1726    30249
     1727    30250    4                               DAT$ = %KV_VDI.OTPBFR_.ADR$;

  30250   2 000DAC  ECC7 0008                            LDB,B6   VDI$,AUTO
          2 000DAE  DCC6 000A                            LDB,B5   10,B6
          2 000DB0  DFC7 000A                            STB,B5   DAT$,AUTO

     1728    30251    4                               Y@INDEX = Y_POWER_OF_2(KX$X29_OTPBFR.BYTSIZLOG2)

  30251   2 000DB2  B845 0002                            LDR,R3   2,B5
          2 000DB4  304A                                 SOR,R3   10
          2 000DB5  B570 000F                            AND,R3   15,IMO
          2 000DB7  E830 0000 002E  00                   LDR,R6   Y_POWER_OF_2,R3
          2 000DBA  6EFA                                 ADV,R6   -6
          2 000DBB  EF47 0016                            STR,R6   Y@INDEX,AUTO

     1729    30252    4                                  - SIZEC(KV$OTPMRK);
     1730    30253    4                            END;

     1731    30254
     1732    30255    3                      PINCRC(DAT$,Y@INDEX)->KV$OTPMRK = PRM_USR_OTPMRK.DAT;

  30255   2 000DBD  ACC7 0004                            LDB,B2   @PRM_USR_X,AUTO
          2 000DBF  2C02                                 LDV,R2   2
          2 000DC0  6C06                                 LDV,R6   6
          2 000DC1  BCC7 000A                            LDB,B3   DAT$,AUTO
          2 000DC3  B847 0016                            LDR,R3   Y@INDEX,AUTO
          2 000DC5  0008                                 MMM

     1733    30256    3                      KX$X29_OTPBFR.NMBMRK = KX$X29_OTPBFR.NMBMRK + 1;

  30256   2 000DC6  ECC7 000A                            LDB,B6   DAT$,AUTO
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:222  
          2 000DC8  E2C6 0003                            LLH,R6   3,B6
          2 000DCA  6E01                                 ADV,R6   1
          2 000DCB  E7C6 0003                            STH,R6   3,B6

     1734    30257    3                      IF %KV_VDI.OTPBFR_.BYTSIZ > Y@INDEX-%KV_VDI.OTPBFR_.BYTX

  30257   2 000DCD  ECC7 0008                            LDB,B6   VDI$,AUTO
          2 000DCF  E847 0016                            LDR,R6   Y@INDEX,AUTO
          2 000DD1  E246 000C                            SUB,R6   12,B6
          2 000DD3  6801 0005                            BLZ,R6   s:30259,PREL
          2 000DD5  E946 000D                            CMR,R6   13,B6
          2 000DD7  0281 0007                            BGE      s:30261,PREL

     1735    30258    3                         THEN
     1736    30259    3                            %KV_VDI.OTPBFR_.BYTSIZ = Y@INDEX-%KV_VDI.OTPBFR_.BYTX;

  30259   2 000DD9  E847 0016                            LDR,R6   Y@INDEX,AUTO
          2 000DDB  E246 000C                            SUB,R6   12,B6
          2 000DDD  EF46 000D                            STR,R6   13,B6

     1737    30260    3                   END;

     1738    30261    2             IF PRM_USR_OTPMRK.CMPOTP

  30261   2 000DDF  ECC7 0004                            LDB,B6   @PRM_USR_X,AUTO
          2 000DE1  8286                                 LB,'0080'X        ,B6
          2 000DE2       0080
          2 000DE3  0581 010C                            BBF      s:30384,PREL

     1739    30262    2                THEN
     1740    30263                        %KV$CMPOTP;
             30268    3           IF KV$VDI.OTPCNDPND THEN DO;

  30268   2 000DE5  DCC7 0008                            LDB,B5   VDI$,AUTO
          2 000DE7  E845 001A                            LDR,R6   26,B5
          2 000DE9  6901 0106                            BEZ,R6   s:30384,PREL

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:223  
             30269    3              CALL KVV$VDI(KV_VDH_EVT_CMPOTP);

  30269   2 000DEB  BB80 0000 000D  03                   LAB,B3   +13
          2 000DEE  CBF0 0100                            LAB,B4   256,IMO
          2 000DF0  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          2 000DF3       0001                            DC       s:30270,PREL

             30270    3              END;                         /* END IF                             */

  30270   2 000DF4  0F81 00FB                            B        s:30384,PREL

     1741    30272
     1742    30273        /* KV$USR_RQSDAT - REQUEST DATA                                               */
     1743    30274
     1744    30275    2          CASE(%KV_USR_FNC_RQSDAT );

     1745    30276    2             IF CNC_TYP = %KXX_TYP_LINKDEV#

  30276   2 000DF6  6D03                                 CMV,R6   3
          2 000DF7  0981 00F8                            BNE      s:30384,PREL

     1746    30277    2                THEN
     1747    30278    3                   DO;

     1748    30279    3                      IF KX$VC.ERCOD.ERR# ~= 0

  30279   2 000DF9  82C4 0032                            LB,'FFF8'X        50,B4
  30279   2 000DFB       FFF8
          2 000DFC  0581 F886                            BBF      s:29326,PREL

     1749    30280    3                         THEN
     1750    30281    4                            DO;

     1751    30282    4                               VDOVLP_ERR = KX_VDOVLP_ERR;

  30282   2 000DFE  AB80 0000 0074  00                   LAB,B2   KX_VDOVLP_ERR
          2 000E01  2C00                                 LDV,R2   0
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:224  
          2 000E02  6C06                                 LDV,R6   6
          2 000E03  BB87                                 LAB,B3   ,AUTO
          2 000E04  3C60                                 LDV,R3   96
          2 000E05  0008                                 MMM

     1752    30283    4                               VDOVLP_ERR.ERRCODE = KX$VC.ERCOD;

  30283   2 000E06  ECC7 0006                            LDB,B6   X29$,AUTO
          2 000E08  8CC6 0031                            LDI      49,B6
          2 000E0A  8D47 0031                            SDI      VDOVLP_ERR+1,AUTO

     1753    30284    4                               KV@SND_DAT = KX_SND_DAT;

  30284   2 000E0C  AB80 0000 0000  xsym                 LAB,B2   KX_SND_DAT
          2 000E0F  2C00                                 LDV,R2   0
          2 000E10  6C14                                 LDV,R6   20
          2 000E11  BBC7 0055                            LAB,B3   KV@SND_DAT,AUTO
          2 000E13  3C00                                 LDV,R3   0
          2 000E14  0008                                 MMM

     1754    30285    4                               KX_VDOVLPARY.VDOVLP.ERR$ = ADDR(VDOVLP_ERR);

  30285   2 000E15  EBC7 0030                            LAB,B6   VDOVLP_ERR,AUTO
          2 000E17  EF80 0000 0006  xsym                 STB,B6   KX_VDOVLPARY+6

     1755    30286    4                               KX_VDOVLPARY.VDOVLP.KEY$ = ADDR(NIL);

  30286   2 000E1A  DB80 0000 0000                       LAB,B5   0
          2 000E1D  DF80 0000 000A  xsym                 STB,B5   KX_VDOVLPARY+10

     1756    30287    4                               CALL KVV$VDI ( KV@SND_DAT );

  30287   2 000E20  CBC7 0055                            LAB,B4   KV@SND_DAT,AUTO
          2 000E22  CFC7 0082                            STB,B4   WRDSIZ2N+3,AUTO
          2 000E24  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 000E26  CBF0 0100                            LAB,B4   256,IMO
          2 000E28  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:225  
          2 000E2B       0001                            DC       s:30288,PREL

     1757    30288    4                               KX_VDOVLPARY.VDOVLP.ERR$ = ADDR(NIL);

  30288   2 000E2C  EB80 0000 0000                       LAB,B6   0
          2 000E2F  EF80 0000 0006  xsym                 STB,B6   KX_VDOVLPARY+6

     1758    30289    4                               KX$VC.ERCOD.ERR# = 0;

  30289   2 000E32  DCC7 0006                            LDB,B5   X29$,AUTO
          2 000E34  8845 0032                            LBF,'FFF8'X       50,B5
          2 000E36       FFF8

     1759    30290    4                               RETURN;

  30290   2 000E37  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1760    30291    4                            END;
     1761    30292    3                         ELSE
     1762    30293    3                            GOTO RED_ENTRY;
     1763    30294    3                   END;
     1764    30295        /* KV$USR_SETPRM - SET PARAM PROCESSING                                       */
     1765    30296
     1766    30297    2          CASE(%KV_USR_FNC_SETPRM );

     1767    30298
     1768    30299        /* DETERMINE WHICH PARAMETER WE WERE INVOKED TO SET                           */
     1769    30300
     1770    30301    2             IF CNC_TYP ~= %KXX_TYP_X29# THEN RETURN;

  30301   2 000E3A  6D01                                 CMV,R6   1
          2 000E3B  0901 0004                            BE       s:30302,PREL

  30301   2 000E3D  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1771    30302    3             DO SELECT(PRM_USR_SETPRM.PRMID);

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:226  
  30302   2 000E40  D843 0001                            LDR,R5   1,B3
          2 000E42  D970 004A                            CMR,R5   74,IMO
          2 000E44  0201 000F                            BL       s:30302+20,PREL
          2 000E46  0901 0084                            BE       s:30365,PREL
          2 000E48  D970 0089                            CMR,R5   137,IMO
          2 000E4A  0201 0091                            BL       s:30373,PREL
          2 000E4C  0901 0057                            BE       s:30348,PREL
          2 000E4E  D970 00A5                            CMR,R5   165,IMO
          2 000E50  0981 008B                            BNE      s:30373,PREL
          2 000E52  0F81 0011                            B        s:30311,PREL
          2 000E54  D970 0044                            CMR,R5   68,IMO
          2 000E56  0201 0008                            BL       s:30302+31,PREL
          2 000E58  0901 004B                            BE       s:30348,PREL
          2 000E5A  5D49                                 CMV,R5   73
          2 000E5B  0981 0080                            BNE      s:30373,PREL
          2 000E5D  0F81 006D                            B        s:30365,PREL
          2 000E5F  5D0F                                 CMV,R5   15
          2 000E60  0981 007B                            BNE      s:30373,PREL
          2 000E62  0F81 0001                            B        s:30311,PREL

     1772    30303    3                SELECT(%KV_PRMID_CTRCHR, %KV_PRMID_DVCFLWCTRALG);

     1773    30304
     1774    30305        /* Handle miscellaneous parameters that influence other parameters.           */
     1775    30306        /*
     1776    30307           If there is a change in whether the device is using DC1/DC3
     1777    30308           flow control, send the X.29 message to change X.3 param 12
     1778    30309           only when the user is turning on DC1DC3.
     1779    30310        */
     1780    30311    3                IF %KV_MRD.DVCFLWCTRALG = %G_DVCFLWCTRALG_DC1DC3#

  30311   2 000E64  ACC6 0008                            LDB,B2   8,B6
          2 000E66  C842 0015                            LDR,R4   21,B2
          2 000E68  C570 00FF                            AND,R4   255,IMO
          2 000E6A  4D03                                 CMV,R4   3
          2 000E6B  0981 000E                            BNE      s:30320,PREL

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:227  
     1781    30312    3                   THEN
     1782    30313    4                      DO;

     1783    30314    4                         FLWCTRPAD = 1;

  30314   2 000E6D  1C01                                 LDV,R1   1
          2 000E6E  9F47 002A                            STR,R1   FLWCTRPAD,AUTO

     1784    30315    4                         IF KX$X29.X3PRM ( %KX_X3PRMX_FLWCTRPAD# ) = 0

  30315   2 000E70  82C4 0020                            LB,'00FF'X        32,B4
  30315   2 000E72       00FF
          2 000E73  0501 0008                            BBT      s:30321,PREL

     1785    30316    4                            THEN
     1786    30317    4                               KX$X29.SNDX3PRM = '1'B;

  30317   2 000E75  8944 0015                            LBT,'0800'X       21,B4
  30317   2 000E77       0800

     1787    30318    4                      END;

  30318   2 000E78  0F81 0003                            B        s:30321,PREL

     1788    30319    3                   ELSE
     1789    30320    3                      FLWCTRPAD = 0;

  30320   2 000E7A  8747 002A                            CL       FLWCTRPAD,AUTO

     1790    30321    3                KX$X29.X3PRM ( %KX_X3PRMX_FLWCTRPAD# ) = FLWCTRPAD;

  30321   2 000E7C  D847 002A                            LDR,R5   FLWCTRPAD,AUTO
          2 000E7E  DAC4 0020                            SRM,R5,'00FF'X    32,B4
          2 000E80       00FF

     1791    30322
     1792    30323    3                IF (KA_DVCFLWCTRCHR(%KV_MRD.DVCFLWCTRALG) ~= 0) AND
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:228  

  30323   2 000E81  ACC6 0008                            LDB,B2   8,B6
          2 000E83  B842 0015                            LDR,R3   21,B2
          2 000E85  B570 00FF                            AND,R3   255,IMO
          2 000E87  3001                                 SOL,R3   1
          2 000E88  C2B0 0000 0000  xsym                 LLH,R4   KA_DVCFLWCTRCHR,R3
          2 000E8B  4901 0010                            BEZ,R4   s:30341,PREL
          2 000E8D  9CC2 0008                            LDB,B1   8,B2
          2 000E8F  C841 0013                            LDR,R4   19,B1
          2 000E91  4D0A                                 CMV,R4   10
          2 000E92  0381 0009                            BLE      s:30341,PREL

     1793    30324    3                   (%KV_ERD.DVCOTPBFRSIZ > 10)
     1794    30325    3                   THEN
     1795    30326    4                      DO;

     1796    30327
     1797    30328        /* There is a synchronous flow control algorithm in effect.                   */
     1798    30329        /* Ask for control when getting transparent writes so we can                  */
     1799    30330        /* do flow control at the beginning of the record (rather than                */
     1800    30331        /* in the middle, which causes bad problems occasionally).                    */
     1801    30332
     1802    30333    4                         %KV_VDI.USEOTPBFRTRN = '0'B;

  30333   2 000E94  8845 001D                            LBF,'0080'X       29,B5
  30333   2 000E96       0080

     1803    30334    4                         %KV_VDI.USEOTPBFRBNR = '0'B;

  30334   2 000E97  8845 001D                            LBF,'0100'X       29,B5
  30334   2 000E99       0100

     1804    30335    4                      END;

  30335   2 000E9A  0F81 0055                            B        s:30384,PREL

     1805    30336    3                   ELSE
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:229  
     1806    30337    4                      DO;

     1807    30338
     1808    30339        /* No synchronous flow control. Let VDH do the buffering directly.            */
     1809    30340
     1810    30341    4                         %KV_VDI.USEOTPBFRTRN = '1'B;

  30341   2 000E9C  8945 001D                            LBT,'0080'X       29,B5
  30341   2 000E9E       0080

     1811    30342    4                         %KV_VDI.USEOTPBFRBNR = '1'B;

  30342   2 000E9F  8945 001D                            LBT,'0100'X       29,B5
  30342   2 000EA1       0100

     1812    30343    4                      END /* IF */;

  30343   2 000EA2  0F81 004D                            B        s:30384,PREL

     1813    30344    3                SELECT ( %KV_PRMID_LOCALECHO, %KV_PRMID_DISPINPUT );

     1814    30345        /*
     1815    30346           We probably have to change the X.3 param for PAD echo.
     1816    30347        */
     1817    30348    3                IF ( %KV_MRD.LOCALECHO AND %KV_MVD.DISPINPUT )

  30348   2 000EA4  ACC6 0008                            LDB,B2   8,B6
          2 000EA6  82C2 0018                            LB,'0040'X        24,B2
          2 000EA8       0040
          2 000EA9  0581 000D                            BBF      s:30352,PREL
          2 000EAB  9CC6 0006                            LDB,B1   6,B6
          2 000EAD  82C1 0015                            LB,'0080'X        21,B1
          2 000EAF       0080
          2 000EB0  0581 0006                            BBF      s:30352,PREL

     1818    30349    3                   THEN
     1819    30350    3                      PADECHO = 1;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:230  

  30350   2 000EB2  4C01                                 LDV,R4   1
          2 000EB3  CF47 002B                            STR,R4   PADECHO,AUTO
          2 000EB5  0F81 0003                            B        s:30353,PREL

     1820    30351    3                   ELSE
     1821    30352    3                      PADECHO = 0;

  30352   2 000EB7  8747 002B                            CL       PADECHO,AUTO

     1822    30353    3                IF ( PADECHO ~= KX$X29.X3PRM ( %KX_X3PRMX_PADECH# ) )

  30353   2 000EB9  C844 001B                            LDR,R4   27,B4
          2 000EBB  C570 00FF                            AND,R4   255,IMO
          2 000EBD  C947 002B                            CMR,R4   PADECHO,AUTO
          2 000EBF  0901 0030                            BE       s:30384,PREL

     1823    30354    3                   THEN
     1824    30355    4                      DO;

     1825    30356    4                         KX$X29.SNDX3PRM = '1'B;

  30356   2 000EC1  8944 0015                            LBT,'0800'X       21,B4
  30356   2 000EC3       0800

     1826    30357    4                         KX$X29.X3PRM ( %KX_X3PRMX_PADECH# ) = PADECHO;

  30357   2 000EC4  D847 002B                            LDR,R5   PADECHO,AUTO
          2 000EC6  DAC4 001B                            SRM,R5,'00FF'X    27,B4
          2 000EC8       00FF

     1827    30358    4                      END;

  30358   2 000EC9  0F81 0026                            B        s:30384,PREL

     1828    30359    3                SELECT(%KV_PRMID_HALFDUPLEXPAPERTAPE,%KV_PRMID_FULLDUPLEXPAPERTAPE);

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:231  
     1829    30360
     1830    30361        /* If either half or full duplex paper tape is set, we need to                */
     1831    30362        /* be called when VDH no longer wants data so we can turn off the             */
     1832    30363        /* paper tape reader.                                                         */
     1833    30364
     1834    30365    3                %KV_VDI.USREVTENB(%KV_USR_EVT_ID_TRMUSRRQSDAT) =

  30365   2 000ECB  C845 0019                            LDR,R4   25,B5
          2 000ECD  400E                                 SOL,R4   14
          2 000ECE  C570 8000                            AND,R4   -32768,IMO
          2 000ED0  9845 0019                            LDR,R1   25,B5
          2 000ED2  100A                                 SOL,R1   10
          2 000ED3  9570 8000                            AND,R1   -32768,IMO
          2 000ED5  C451                                 OR,R4    R1
          2 000ED6  4045                                 SOR,R4   5
          2 000ED7  CAC5 001F                            SRM,R4,'0400'X    31,B5
          2 000ED9       0400
          2 000EDA  0F81 0015                            B        s:30384,PREL

     1835    30366    3                   %KV_VDI.HALFDUPLEXPAPERTAPE|%KV_VDI.FULLDUPLEXPAPERTAPE;
     1836    30367    3                SELECT(ELSE);

     1837    30368
     1838    30369        /* WE GOT A PRMID WE DIDNT UNDERSTAND                                         */
     1839    30370
     1840    30371        /*S* SCREECH_CODE: KXX-S$KX_UNKPRMID#
     1841    30372             MESSAGE: KXX$VDI called by VDH with unknown PRMID.   */
     1842    30373    3             CALL KHD$SCREECH ( Y_UNKPRMID );

  30373   2 000EDC  BB80 0000 0017  03                   LAB,B3   +23
          2 000EDF  CBF0 0100                            LAB,B4   256,IMO
          2 000EE1  E380 0000 0000  xent                 LNJ,B6   KHD$SCREECH
          2 000EE4       0001                            DC       s:30374,PREL

     1843    30374    3             END; /* DO SELECT                          */

  30374   2 000EE5  0F81 000A                            B        s:30384,PREL
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:232  

     1844    30375
     1845    30376    2          CASE(ELSE);

     1846    30377
     1847    30378        /* WE GOT A FUNCTION CODE WE DIDNT UNDERSTAND                                 */
     1848    30379
     1849    30380        /*S* SCREECH_CODE: KXX-S$KX_UNKUSRFNC#                                        */
     1850    30381        /*S* MESSAGE: KXX$VDI called by VDH with unknown user function code.          */
     1851    30382    2   DIE:      CALL KHD$SCREECH ( Y_UNKUSRFNC );

  30382   2 000EE7  BB80 0000 0019  03   DIE             LAB,B3   +25
          2 000EEA  CBF0 0100                            LAB,B4   256,IMO
          2 000EEC  E380 0000 0000  xent                 LNJ,B6   KHD$SCREECH
          2 000EEF       0001                            DC       s:30384,PREL

     1852    30383    2       END /* CASE */;

     1853    30384    1       RETURN;

  30384   2 000EF0  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1854    30385        %EJECT;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:233  
     1855    30386    1   Y$SNCFLWCTRHLT: PROC ( PARM );

  30386   2 000EF3  EFC7 0060            Y$SNCFLWCTRHLT  STB,B6   CNC_TYP+1,AUTO

     1856    30387
     1857    30388    2   DCL PARM UBIN;
     1858    30389    2   DCL PARM1 UBIN;
     1859    30390
     1860    30391    2       %KV_VDI.TMPOTPCHRCNT = 1; /* (counting this one)                */

  30391   2 000EF5  DCC7 0008                            LDB,B5   VDI$,AUTO
          2 000EF7  6C01                                 LDV,R6   1
          2 000EF8  EF45 0015                            STR,R6   21,B5

     1861    30392    2       IF (%KV_ERD.DVCOTPBFRSIZ >= 10)

  30392   2 000EFA  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          2 000EFD  CCC6 0008                            LDB,B4   8,B6
          2 000EFF  BCC4 0008                            LDB,B3   8,B4
          2 000F01  D843 0013                            LDR,R5   19,B3
          2 000F03  5D0A                                 CMV,R5   10
          2 000F04  0201 003F                            BL       s:30426,PREL

     1862    30393    2          THEN
     1863    30394    3             DO;

     1864    30395
     1865    30396        /* THE OUTPUT BUFFER IN THE DEVICE IS REASONABLY LARGE.                       */
     1866    30397        /* DO FLOW CONTROL FOR THE DEVICE.                                            */
     1867    30398
     1868    30399    3                KX$X29.OTPCHRCNTUTLHLT = %KV_ERD.DVCOTPBFRSIZ;

  30399   2 000F06  ACC7 0006                            LDB,B2   X29$,AUTO
          2 000F08  DF42 0013                            STR,R5   19,B2

     1869    30400    3                IF %KV_VDI.OTPBFR_.BYTSIZ = 0

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:234  
  30400   2 000F0A  C845 000D                            LDR,R4   13,B5
          2 000F0C  4981 000F                            BNEZ,R4  s:30410,PREL

     1870    30401    3                   THEN
     1871    30402    4                      DO;

     1872    30403    4                         CALL KXX$VDI (KV_USR_GETOTPBFR)

  30403   2 000F0E  BB80 0000 000B  03                   LAB,B3   +11
          2 000F11  CBF0 0100                            LAB,B4   256,IMO
          2 000F13  E3C0 F0EC                            LNJ,B6   s:10,PREL
          2 000F15       0003                            DC       s:30406,PREL
          2 000F16  0F81 0005                            B        s:30410,PREL

     1873    30404    4                            WHENALTRETURN
     1874    30405    5                               DO;

     1875    30406    5                                  RETURN;

  30406   2 000F18  ECC7 0060                            LDB,B6   CNC_TYP+1,AUTO
          2 000F1A  C3C6 0001                            LNJ,B4   1,B6

     1876    30407    5                               END;
     1877    30408    4                      END;

     1878    30409
     1879    30410    3                %KV_SSN.OTPCHRCNT = %KV_SSN.OTPCHRCNT+1;

  30410   2 000F1C  EC80 0000 0000  xsym                 LDB,B6   KV$PTR$
          2 000F1F  DCC6 0002                            LDB,B5   2,B6
          2 000F21  8AC5 0019                            INC      25,B5
          2 000F23  8EC5 0018                            CAD      24,B5

     1880    30411    3                KV_STT.OTPCHRCNT = KV_STT.OTPCHRCNT+1;

  30411   2 000F25  8A80 0000 0035  xsym                 INC      KV_STT+53
          2 000F28  8E80 0000 0034  xsym                 CAD      KV_STT+52
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:235  

     1881    30412
     1882    30413    3                %KV_VDI.OTPBFR_.ADR$->Y$BYT(%KV_VDI.OTPBFR_.BYTX) =

  30413   2 000F2B  DCC7 0008                            LDB,B5   VDI$,AUTO
          2 000F2D  CCC5 000A                            LDB,B4   10,B5
          2 000F2F  B845 000C                            LDR,R3   12,B5
          2 000F31  BCC6 0008                            LDB,B3   8,B6
          2 000F33  A843 0015                            LDR,R2   21,B3
          2 000F35  A570 00FF                            AND,R2   255,IMO
          2 000F37  2001                                 SOL,R2   1
          2 000F38  E2A0 0000 0000  xsym                 LLH,R6   KA_DVCFLWCTRCHR,R2
          2 000F3B  E7B4                                 STH,R6   ,B4,R3

     1883    30414    3                   KA_DVCFLWCTRCHR(%KV_MRD.DVCFLWCTRALG);
     1884    30415    3                %KV_VDI.OTPBFR_.BYTX = %KV_VDI.OTPBFR_.BYTX+1;

  30415   2 000F3C  8AC5 000C                            INC      12,B5

     1885    30416    3                %KV_VDI.OTPBFR_.BYTSIZ = %KV_VDI.OTPBFR_.BYTSIZ-1;

  30416   2 000F3E  88C5 000D                            DEC      13,B5

     1886    30417    3                PARM1 = %KA#HLTOTP_DVCX;

  30417   2 000F40  8747 0064                            CL       PARM1,AUTO

     1887    30418    3                GOTO SUB_COMMON;

  30418   2 000F42  0F81 0012                            B        s:30430,PREL

     1888    30419    3             END;
     1889    30420    2          ELSE
     1890    30421    3             DO;

     1891    30422
     1892    30423        /* THE DECLARED SIZE OF THE OUTPUT BUFFER IN THE DEVICE ISN'T                 */
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:236  
     1893    30424        /* REASONABLY LARGE. IT'S PROBABLY MISDECLARED. WE CAN'T USE IT.              */
     1894    30425
     1895    30426    3                KX$X29.OTPCHRCNTUTLHLT = 16000;

  30426   2 000F44  ACC7 0006                            LDB,B2   X29$,AUTO
          2 000F46  C870 3E80                            LDR,R4   16000,IMO
          2 000F48  CF42 0013                            STR,R4   19,B2

     1896    30427    3                RETURN;

  30427   2 000F4A  ECC7 0060                            LDB,B6   CNC_TYP+1,AUTO
          2 000F4C  C3C6 0001                            LNJ,B4   1,B6

     1897    30428    3             END /* IF */;
     1898    30429    2   Y$SNCHLTOTP: ENTRY (PARM);

  30429   2 000F4E  EFC7 0060            Y$SNCHLTOTP     STB,B6   CNC_TYP+1,AUTO

     1899    30430    2       PARM1 = PARM;

  30430   2 000F50  DCC7 0062                            LDB,B5   @PARM,AUTO
          2 000F52  E805                                 LDR,R6   ,B5
          2 000F53  EF47 0064                            STR,R6   PARM1,AUTO

  30430   2                              SUB_COMMON      null
     1900    30431    2   SUB_COMMON:;
     1901    30432    2       IF (%KV_SSN.USRHLTINH AND (PARM1 = %KA#HLTOTP_USRX))

  30432   2 000F55  EC80 0000 0000  xsym SUB_COMMON      LDB,B6   KV$PTR$
          2 000F58  DCC6 0002                            LDB,B5   2,B6
          2 000F5A  82C5 0028                            LB,'0010'X        40,B5
          2 000F5C       0010
          2 000F5D  0581 000A                            BBF      s:30440,PREL
          2 000F5F  E847 0064                            LDR,R6   PARM1,AUTO
          2 000F61  6D01                                 CMV,R6   1
          2 000F62  0981 0005                            BNE      s:30440,PREL

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:237  
     1902    30433    2          THEN
     1903    30434    3             DO;

     1904    30435
     1905    30436        /* THIS IS A USER OUTPUT HALT REQUEST, AND USER HALTS ARE INHIBITED.          */
     1906    30437
     1907    30438    3                RETURN;

  30438   2 000F64  ECC7 0060                            LDB,B6   CNC_TYP+1,AUTO
          2 000F66  C3C6 0001                            LNJ,B4   1,B6

     1908    30439    3             END /* IF */;
     1909    30440    2       CALL KXX$TRNOTP ( %KV_VDI );

  30440   2 000F68  BBC7 0008                            LAB,B3   VDI$,AUTO
          2 000F6A  CBF0 0100                            LAB,B4   256,IMO
          2 000F6C  E380 0000 0000  xent                 LNJ,B6   KXX$TRNOTP
          2 000F6F       0001                            DC       s:30441,PREL

     1910    30441    2       IF (KX$X29.SND.TAL$ ~= ADDR(NIL))

  30441   2 000F70  ECC7 0006                            LDB,B6   X29$,AUTO
          2 000F72  8DC6 0010                            CMN      16,B6
          2 000F74  0901 0008                            BE       s:30454,PREL

     1911    30442    2          THEN
     1912    30443    3             DO;

     1913    30444
     1914    30445        /* WE HAVE AN OUTPUT BUFFER CHAIN* SET THE HALT BIT IN THE NEXT OUTPUT BUFFER */
     1915    30446
     1916    30447    3                KX$X29.HLTOTPNXTBFR.BITT(PARM1) = '1'B;

  30447   2 000F76  DBC6 0016                            LAB,B5   22,B6
          2 000F78  B847 0064                            LDR,R3   PARM1,AUTO
          2 000F7A  8935                                 LBT      ,B5,R3

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:238  
     1917    30448    3             END;

  30448   2 000F7B  0F81 003C                            B        s:30468,PREL

     1918    30449    2          ELSE
     1919    30450    3             DO;

     1920    30451
     1921    30452        /* THERE IS NO OUTPUT BUFFER CHAIN* OUTPUT IS CURRENTLY HALTED.               */
     1922    30453
     1923    30454    3                IF PARM1 = %KA#HLTOTP_USRX

  30454   2 000F7D  E847 0064                            LDR,R6   PARM1,AUTO
          2 000F7F  6D01                                 CMV,R6   1
          2 000F80  0981 0007                            BNE      s:30460,PREL

     1924    30455    3                   THEN
     1925    30456    3                      KX$X29.HLTOTP.BITT(PARM1) = '1'B;

  30456   2 000F82  DBC6 0015                            LAB,B5   21,B6
          2 000F84  B856                                 LDR,R3   R6
          2 000F85  8935                                 LBT      ,B5,R3
          2 000F86  0F81 0031                            B        s:30468,PREL

     1926    30457    3                   ELSE
     1927    30458    4                      DO;

     1928    30459                              %DISABLE;

  30460   2 000F88  DC80 0000 0002  xsym                 LDB,B5   KH_CTLTBL+2
          2 000F8B  D805                                 LDR,R5   ,B5
          2 000F8C  DF47 0034                            STR,R5   LEVEL,AUTO

  30460   2 000F8E  CBC7 0034                            LAB,B4   LEVEL,AUTO
          2 000F90  CFC7 0082                            STB,B4   WRDSIZ2N+3,AUTO
          2 000F92  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 000F94  CBF0 0100                            LAB,B4   256,IMO
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:239  
          2 000F96  E380 0000 0000  xent                 LNJ,B6   KHI$DISABLE
          2 000F99       0001                            DC       s:30462,PREL

     1929    30462    4                         CALL KXX$SNDX29MSG ( %KX_X29MSGTYP_HLTMRK#, KX$X29 );

  30462   2 000F9A  EBF0 0009                            LAB,B6   9,IMO
          2 000F9C  DCC7 0006                            LDB,B5   X29$,AUTO
          2 000F9E  DFC7 0084                            STB,B5   WRDSIZ2N+5,AUTO
          2 000FA0  EFC7 0082                            STB,B6   WRDSIZ2N+3,AUTO
          2 000FA2  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 000FA4  CBF0 0200                            LAB,B4   512,IMO
          2 000FA6  E380 0000 0000  xent                 LNJ,B6   KXX$SNDX29MSG
          2 000FA9       0001                            DC       s:30464,PREL

     1930    30463                              %ENABLE;

  30464   2 000FAA  EC80 0000 0002  xsym                 LDB,B6   KH_CTLTBL+2
          2 000FAD  E847 0034                            LDR,R6   LEVEL,AUTO
          2 000FAF  E906                                 CMR,R6   ,B6
          2 000FB0  0901 0007                            BE       s:30468,PREL

  30464   2 000FB2  CBF0 0000                            LAB,B4   0,IMO
          2 000FB4  E380 0000 0000  xent                 LNJ,B6   KHI$ENABLE
          2 000FB7       0001                            DC       s:30468,PREL

     1931    30466    4                      END;

     1932    30467    3             END /* IF */;

     1933    30468    2   END Y$SNCFLWCTRHLT;

  30468   2 000FB8  ECC7 0060                            LDB,B6   CNC_TYP+1,AUTO
          2 000FBA  C3C6 0001                            LNJ,B4   1,B6

     1934    30469
     1935    30470        %EJECT;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:240  
     1936    30471
     1937    30472    1   Y$CAL_PAC:

  30472   2 000FBC  EFC7 0060            Y$CAL_PAC       STB,B6   CNC_TYP+1,AUTO

     1938    30473    1       PROC ;
     1939    30474    2       CALL_FPT = '0'B;

  30474   2 000FBE  5C20                                 LDV,R5   32
          2 000FBF  0021                                 ALR      ;
          2 000FC0       4178 0000                                ALPHANUM('0000'X,IMO,,1),;
          2 000FC2       4007 001A                                ALPHANUM(CALL_FPT,AUTO,,R5,FILL)

     1940    30475    2       CALL_FPT.CAL$ = X29$;

  30475   2 000FC4  ECC7 0006                            LDB,B6   X29$,AUTO
          2 000FC6  437F                                 CSYNC    s:30475+1,SPREL
          2 000FC7  EFC7 001B                            STB,B6   CALL_FPT+1,AUTO

     1941    30476    2       CALL_FPT.RCV$ = KX$X29.L3$;

  30476   2 000FC9  DCC6 0006                            LDB,B5   6,B6
          2 000FCB  DFC7 001D                            STB,B5   CALL_FPT+3,AUTO

     1942    30477    2       CALL_FPT.EVN = TEMP0 ;

  30477   2 000FCD  E847 0033                            LDR,R6   TEMP0,AUTO
          2 000FCF  EF47 001A                            STR,R6   CALL_FPT,AUTO

     1943    30478    2       CALL_FPT.PRM1$ = TEMP1$;

  30478   2 000FD1  CCC7 0010                            LDB,B4   TEMP1$,AUTO
          2 000FD3  CFC7 0021                            STB,B4   CALL_FPT+7,AUTO

     1944    30479    2       CALL KXP$PACKET (CALL_FPT)

  30479   2 000FD5  BBC7 001A                            LAB,B3   CALL_FPT,AUTO
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:241  
          2 000FD7  BFC7 0082                            STB,B3   WRDSIZ2N+3,AUTO
          2 000FD9  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 000FDB  CBF0 0100                            LAB,B4   256,IMO
          2 000FDD  E380 0000 0000  xent                 LNJ,B6   KXP$PACKET
          2 000FE0       0003                            DC       s:30481,PREL
          2 000FE1  0F81 0009                            B        s:30483,PREL

     1945    30480    3          WHENALTRETURN DO;

     1946    30481    3                CALL KHD$SCREECH ( CALL_FPT.PRM1$->B$SCODE );

  30481   2 000FE3  BBC7 0021                            LAB,B3   CALL_FPT+7,AUTO
          2 000FE5  CBF0 0100                            LAB,B4   256,IMO
          2 000FE7  E380 0000 0000  xent                 LNJ,B6   KHD$SCREECH
          2 000FEA       0001                            DC       s:30483,PREL

     1947    30482    3             END;

     1948    30483    2       RETURN ;

  30483   2 000FEB  ECC7 0060                            LDB,B6   CNC_TYP+1,AUTO
          2 000FED  C3C6 0001                            LNJ,B4   1,B6

     1949    30484    2   END ;
     1950    30485
     1951    30486
     1952    30487    1   Y$ER:

  30487   2 000FEF  EFC7 0060            Y$ER            STB,B6   CNC_TYP+1,AUTO

     1953    30488    1       PROC ;
     1954    30489
     1955    30490               %WRSYSLOG  (  ERRCOD = ERCOD ,
     1956    30491                  TRMID ="KX$X29.CHN$->KH$CHN.TERMID") ;

  30507   2 000FF1  DCC7 0006                            LDB,B5   X29$,AUTO
          2 000FF3  CCC5 0004                            LDB,B4   4,B5
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:242  
          2 000FF5  BB80 0000 0000                       LAB,B3   0
          2 000FF8  BFC7 0086                            STB,B3   WRDSIZ2N+7,AUTO
          2 000FFA  ABC4 0012                            LAB,B2   18,B4
          2 000FFC  AFC7 0084                            STB,B2   WRDSIZ2N+5,AUTO
          2 000FFE  CBC7 002E                            LAB,B4   ERCOD,AUTO
          2 001000  CFC7 0082                            STB,B4   WRDSIZ2N+3,AUTO
          2 001002  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 001004  CBF0 0300                            LAB,B4   768,IMO
          2 001006  E380 0000 0000  xent                 LNJ,B6   KXS$SYSLOG
          2 001009       0001                            DC       s:30510,PREL

     1957    30509
     1958    30510    2       RETURN ; END ;

  30510   2 00100A  ECC7 0060                            LDB,B6   CNC_TYP+1,AUTO
          2 00100C  C3C6 0001                            LNJ,B4   1,B6

     1959    30511
     1960    30512        %EJECT ;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:243  
     1961    30513
     1962    30514
     1963    30515    1   Y$DECODE_FPT: PROC;

  30515   2 00100E  EFC7 0060            Y$DECODE_FPT    STB,B6   CNC_TYP+1,AUTO

     1964    30516
     1965    30517        %VC$CAL ( FPTN = Y_VC_CAL, STCLASS = AUTO );
     1966    30563        %VC$CAL;
     1967    30609        %VC$DAT;
     1968    30630        %EQU Y_VC_DAT=CHARTEXT('ADDR(Y_VC_CAL)->VC$DAT');
     1969    30631        %VC$RST;
     1970    30652        %EQU Y_VC_RST=CHARTEXT('ADDR(Y_VC_CAL)->VC$RST');
     1971    30653        %VC$INT;
     1972    30674        %EQU Y_VC_INT=CHARTEXT('ADDR(Y_VC_CAL)->VC$INT');
     1973    30675        %VC$CLR;
     1974    30704        %EQU Y_VC_CLR=CHARTEXT('ADDR(Y_VC_CAL)->VC$CLR');
     1975    30705    2   DCL B$STR CHAR(2000) BASED ALIGNED;
     1976    30706    2   DCL USR@DAT_ADR$ PTR;
     1977    30707    2   DCL USR@DAT_BYTX UBIN;
     1978    30708    2   DCL USR@DAT_BYTSIZ UBIN;
     1979    30709    2   DCL PCKSIZ UBIN;
     1980    30710    2   DCL FULPCKS UBIN;
     1981    30711    2   DCL WRDSIZ2N UBIN;
     1982    30712
     1983    30713    2       CALL_FPT = '0'B;       /* prepare to call L3 */

  30713   2 001010  5C20                                 LDV,R5   32
          2 001011  0021                                 ALR      ;
          2 001012       4178 0000                                ALPHANUM('0000'X,IMO,,1),;
          2 001014       4007 001A                                ALPHANUM(CALL_FPT,AUTO,,R5,FILL)

     1984    30714    2       CALL_FPT.CAL$ = VC$;

  30714   2 001016  ECC7 0006                            LDB,B6   X29$,AUTO
          2 001018  437F                                 CSYNC    s:30714+1,SPREL
          2 001019  EFC7 001B                            STB,B6   CALL_FPT+1,AUTO
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:244  

     1985    30715    2       CALL_FPT.RCV$ = KX$VC.L3$;

  30715   2 00101B  DCC6 0006                            LDB,B5   6,B6
          2 00101D  DFC7 001D                            STB,B5   CALL_FPT+3,AUTO

     1986    30716    2       L3$ = CALL_FPT.RCV$;

  30716   2 00101F  DFC7 0012                            STB,B5   L3$,AUTO

     1987    30717    2       Y_VC_CAL =PINCRC (PRM_USR_DAT.DAT__.ADR$, PRM_USR_DAT.DAT__.BYTX) ->VC$CAL;

  30717   2 001021  CCC7 0004                            LDB,B4   @PRM_USR_X,AUTO
          2 001023  B844 0003                            LDR,R3   3,B4
          2 001025  BCC4 0001                            LDB,B3   1,B4
          2 001027  AB83                                 LAB,B2   ,B3
          2 001028  A853                                 LDR,R2   R3
          2 001029  6C2E                                 LDV,R6   46
          2 00102A  BBC7 0062                            LAB,B3   Y_VC_CAL,AUTO
          2 00102C  3C00                                 LDV,R3   0
          2 00102D  0008                                 MMM

     1988    30718    2       VDOVLP_ERR = KX_VDOVLP_ERR;

  30718   2 00102E  AB80 0000 0074  00                   LAB,B2   KX_VDOVLP_ERR
          2 001031  2C00                                 LDV,R2   0
          2 001032  6C06                                 LDV,R6   6
          2 001033  BB87                                 LAB,B3   ,AUTO
          2 001034  3C60                                 LDV,R3   96
          2 001035  0008                                 MMM

     1989    30719
     1990    30720    3       DO CASE ( Y_VC_CAL.FUNCTION );

  30720   2 001036  B2C7 0062                            LLH,R3   Y_VC_CAL,AUTO
          2 001038  3D14                                 CMV,R3   20
          2 001039  0281 03D4                            BGE      s:31054,PREL
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:245  
          2 00103B  A830 0000 1041  02                   LDR,R2   s:30720+11,R3
          2 00103E  83A0 0000 1055  02                   JMP      s:30727,R2
          2 001041       03B9                            DC       s:31054,PREL
          2 001042       0000                            DC       s:30727,PREL
          2 001043       03B9                            DC       s:31054,PREL
          2 001044       0131                            DC       s:30814,PREL
          2 001045       03B9                            DC       s:31054,PREL
          2 001046       013D                            DC       s:30826,PREL
          2 001047       03B9                            DC       s:31054,PREL
          2 001048       0214                            DC       s:30922,PREL
          2 001049       03B9                            DC       s:31054,PREL
          2 00104A       03B9                            DC       s:31054,PREL
          2 00104B       0235                            DC       s:30940,PREL
          2 00104C       03B9                            DC       s:31054,PREL
          2 00104D       03B9                            DC       s:31054,PREL
          2 00104E       0248                            DC       s:30954,PREL
          2 00104F       03B9                            DC       s:31054,PREL
          2 001050       03B9                            DC       s:31054,PREL
          2 001051       03C0                            DC       s:31057,PREL
          2 001052       028B                            DC       s:30981,PREL
          2 001053       0309                            DC       s:31014,PREL
          2 001054       0313                            DC       s:31016,PREL

     1991    30721
     1992    30722    3          CASE ( %KX_VCFNC_CAL_RQS# );

     1993    30723        /*
     1994    30724           If state is WCA, it is the AU writing the call packet info to us so
     1995    30725           that the call receiver will see it. Buffer it and wait for OPNSSN.
     1996    30726        */
     1997    30727    3             IF KX$VC.STATE = %KX_VC_ST_WCA#

  30727   2 001055  ECC7 0006                            LDB,B6   X29$,AUTO
          2 001057  E2C6 0033                            LLH,R6   51,B6
          2 001059  6D05                                 CMV,R6   5
          2 00105A  0981 0033                            BNE      s:30743,PREL

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:246  
     1998    30728    3                THEN
     1999    30729    4                   DO;

     2000    30730    4                      KX$VC.CALMSGBYTSIZ = PRM_USR_DAT.DAT__.DATBYTSIZ;

  30730   2 00105C  C844 0004                            LDR,R4   4,B4
          2 00105E  CF46 0028                            STR,R4   40,B6

     2001    30731    4                      CALL KVB$GETSYS ( (KX$VC.CALMSGBYTSIZ+1)/2, KX$VC.CALPKT$ )

  30731   2 001060  4E01                                 ADV,R4   1
          2 001061  4041                                 SOR,R4   1
          2 001062  CF47 0082                            STR,R4   WRDSIZ2N+3,AUTO
          2 001064  DBC6 0026                            LAB,B5   38,B6
          2 001066  DFC7 0085                            STB,B5   WRDSIZ2N+6,AUTO
          2 001068  ABC7 0082                            LAB,B2   WRDSIZ2N+3,AUTO
          2 00106A  AFC7 0083                            STB,B2   WRDSIZ2N+4,AUTO
          2 00106C  BBC7 0083                            LAB,B3   WRDSIZ2N+4,AUTO
          2 00106E  CBF0 0200                            LAB,B4   512,IMO
          2 001070  E380 0000 0000  xent                 LNJ,B6   KVB$GETSYS
          2 001073       03A6                            DC       s:31060,PREL

     2002    30732    4                         ALTRET ( L_NOMEM );
     2003    30733    4                      SUBSTR(KX$VC.CALPKT$->B$STR,0,KX$VC.CALMSGBYTSIZ) =

  30733   2 001074  ECC7 0006                            LDB,B6   X29$,AUTO
          2 001076  DCC6 0026                            LDB,B5   38,B6
          2 001078  E846 0028                            LDR,R6   40,B6
          2 00107A  CCC7 0004                            LDB,B4   @PRM_USR_X,AUTO
          2 00107C  BCC4 0001                            LDB,B3   1,B4
          2 00107E  D844 0003                            LDR,R5   3,B4
          2 001080  AB83                                 LAB,B2   ,B3
          2 001081  A855                                 LDR,R2   R5
          2 001082  BB85                                 LAB,B3   ,B5
          2 001083  3C00                                 LDV,R3   0
          2 001084  0008                                 MMM

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:247  
     2004    30734    4                         SUBSTR(PRM_USR_DAT.DAT__.ADR$->B$STR,PRM_USR_DAT.DAT__.BYTX,
     2005    30735    4                         KX$VC.CALMSGBYTSIZ);
     2006    30736    4                      KX$VC.CALINDPND = '1'B;

  30736   2 001085  ECC7 0006                            LDB,B6   X29$,AUTO
          2 001087  8946 0016                            LBT,'1000'X       22,B6
          2 001089       1000

     2007    30737    4                      RETURN;

  30737   2 00108A  ECC7 0060                            LDB,B6   CNC_TYP+1,AUTO
          2 00108C  C3C6 0001                            LNJ,B4   1,B6

     2008    30738    4                   END;
     2009    30739        /*
     2010    30740           A call request from the HOST. State has to be READY#. Change state to WCC#,
     2011    30741           and send the call through L3.
     2012    30742        */
     2013    30743    3             IF KX$VC.STATE ~= %KX_VC_ST_READY#

  30743   2 00108E  6D03                                 CMV,R6   3
          2 00108F  0901 003F                            BE       s:30763,PREL

     2014    30744    3                THEN
     2015    30745    4                   DO;

     2016    30746    4   BAD_VCSTT:         VDOVLP_ERR.ERRCODE = BAD_VCSTT;

  30746   2 001091  8C80 0000 007F  00   BAD_VCSTT       LDI      BAD_VCSTT
          2 001094  8D47 0031                            SDI      VDOVLP_ERR+1,AUTO

     2017    30747    4   BAD_STATE:         IF %KV_VDI.USRRQSDAT.RED

  30747   2 001096  ECC7 0008            BAD_STATE       LDB,B6   VDI$,AUTO
          2 001098  82C6 001D                            LB,'0010'X        29,B6
          2 00109A       0010
          2 00109B  0581 0029                            BBF      s:30760,PREL
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:248  

     2018    30748        /*
     2019    30749           Activate the read just to pass back an error code.
     2020    30750        */
     2021    30751    4                         THEN
     2022    30752    5                            DO;

     2023    30753    5                               KV@SND_DAT = KX_SND_DAT;

  30753   2 00109D  AB80 0000 0000  xsym                 LAB,B2   KX_SND_DAT
          2 0010A0  2C00                                 LDV,R2   0
          2 0010A1  6C14                                 LDV,R6   20
          2 0010A2  BBC7 0055                            LAB,B3   KV@SND_DAT,AUTO
          2 0010A4  3C00                                 LDV,R3   0
          2 0010A5  0008                                 MMM

     2024    30754    5                               KX_VDOVLPARY.VDOVLP.ERR$ = ADDR(VDOVLP_ERR);

  30754   2 0010A6  EBC7 0030                            LAB,B6   VDOVLP_ERR,AUTO
          2 0010A8  EF80 0000 0006  xsym                 STB,B6   KX_VDOVLPARY+6

     2025    30755    5                               KX_VDOVLPARY.VDOVLP.KEY$ = ADDR(NIL);

  30755   2 0010AB  DB80 0000 0000                       LAB,B5   0
          2 0010AE  DF80 0000 000A  xsym                 STB,B5   KX_VDOVLPARY+10

     2026    30756    5                               CALL KVV$VDI ( KV@SND_DAT );

  30756   2 0010B1  CBC7 0055                            LAB,B4   KV@SND_DAT,AUTO
          2 0010B3  CFC7 0082                            STB,B4   WRDSIZ2N+3,AUTO
          2 0010B5  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 0010B7  CBF0 0100                            LAB,B4   256,IMO
          2 0010B9  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          2 0010BC       0001                            DC       s:30757,PREL

     2027    30757    5                               KX_VDOVLPARY.VDOVLP.ERR$ = ADDR(NIL);

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:249  
  30757   2 0010BD  EB80 0000 0000                       LAB,B6   0
          2 0010C0  EF80 0000 0006  xsym                 STB,B6   KX_VDOVLPARY+6

     2028    30758    5                            END;

  30758   2 0010C3  0F81 0007                            B        s:30761,PREL

     2029    30759    4                         ELSE
     2030    30760    4                            KX$VC.ERCOD = VDOVLP_ERR.ERRCODE;

  30760   2 0010C5  8CC7 0031                            LDI      VDOVLP_ERR+1,AUTO
          2 0010C7  DCC7 0006                            LDB,B5   X29$,AUTO
          2 0010C9  8D45 0031                            SDI      49,B5

     2031    30761    4                      RETURN;

  30761   2 0010CB  ECC7 0060                            LDB,B6   CNC_TYP+1,AUTO
          2 0010CD  C3C6 0001                            LNJ,B4   1,B6

     2032    30762    4                   END;
     2033    30763    3             KX$VC.STATE = %KX_VC_ST_WCC#;

  30763   2 0010CF  4C04                                 LDV,R4   4
          2 0010D0  C7C6 0033                            STH,R4   51,B6

     2034    30764    3             KX$L3.CALL_OPTS.RCVADR.SIZ = Y_VC_CAL.CLDADRLNG;

  30764   2 0010D2  E847 0062                            LDR,R6   Y_VC_CAL,AUTO
          2 0010D4  E570 000F                            AND,R6   15,IMO
          2 0010D6  DCC7 0012                            LDB,B5   L3$,AUTO
          2 0010D8  E7C5 0017                            STH,R6   23,B5

     2035    30765    3             KX$L3.CALL_OPTS.RCVADR.ADR_STRING = Y_VC_CAL.CLDADRSTRING;

  30765   2 0010DA  ABC7 0066                            LAB,B2   PARM1+2,AUTO
          2 0010DC  2C01                                 LDV,R2   1
          2 0010DD  6C07                                 LDV,R6   7
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:250  
          2 0010DE  BB85                                 LAB,B3   ,B5
          2 0010DF  3C2F                                 LDV,R3   47
          2 0010E0  0008                                 MMM

     2036    30766    3             KX$L3.DFL_OPTS = KX$L3.CALL_OPTS;

  30766   2 0010E1  ACC7 0012                            LDB,B2   L3$,AUTO
          2 0010E3  2C28                                 LDV,R2   40
          2 0010E4  6C0E                                 LDV,R6   14
          2 0010E5  BB82                                 LAB,B3   ,B2
          2 0010E6  3C44                                 LDV,R3   68
          2 0010E7  0008                                 MMM

     2037    30767    3             KX$L3.CM_OPTS = KX$L3.CALL_OPTS;

  30767   2 0010E8  ACC7 0012                            LDB,B2   L3$,AUTO
          2 0010EA  2C28                                 LDV,R2   40
          2 0010EB  6C0E                                 LDV,R6   14
          2 0010EC  BB82                                 LAB,B3   ,B2
          2 0010ED  3C36                                 LDV,R3   54
          2 0010EE  0008                                 MMM

     2038    30768    3             KX$L3.FSTSLC = Y_VC_CAL.FSTSLC;

  30768   2 0010EF  ECC7 0012                            LDB,B6   L3$,AUTO
          2 0010F1  E847 006B                            LDR,R6   PARM1+7,AUTO
          2 0010F3  6048                                 SOR,R6   8
          2 0010F4  EAC6 0029                            SRM,R6,'00C0'X    41,B6
          2 0010F6       00C0

     2039    30769    3             KX$L3.RVS = Y_VC_CAL.RVS;

  30769   2 0010F7  E847 006B                            LDR,R6   PARM1+7,AUTO
          2 0010F9  604C                                 SOR,R6   12
          2 0010FA  EAC6 0029                            SRM,R6,'0001'X    41,B6
          2 0010FC       0001

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:251  
     2040    30770    3             IF Y_VC_CAL.PROTOCOL = %KX_PRTID_X28#

  30770   2 0010FD  E847 006A                            LDR,R6   PARM1+6,AUTO
          2 0010FF  E570 00FF                            AND,R6   255,IMO
          2 001101  6D02                                 CMV,R6   2
          2 001102  0981 0024                            BNE      s:30786,PREL

     2041    30771    3                THEN
     2042    30772    4                   DO;

     2043    30773    4                      KX$VC.X28 = '1'B;

  30773   2 001104  9CC7 0006                            LDB,B1   X29$,AUTO
          2 001106  8941 0016                            LBT,'0010'X       22,B1
          2 001108       0010

     2044    30774    4                      KX$VC.RPRX3 = Y_VC_CAL.RPRX3;

  30774   2 001109  E847 006B                            LDR,R6   PARM1+7,AUTO
          2 00110B  604B                                 SOR,R6   11
          2 00110C  EAC1 0016                            SRM,R6,'0004'X    22,B1
          2 00110E       0004

     2045    30775    4                      KX$VC.X3PRM = Y_VC_CAL.X3;

  30775   2 00110F  ABC7 006B                            LAB,B2   PARM1+7,AUTO
          2 001111  2C01                                 LDV,R2   1
          2 001112  6C16                                 LDV,R6   22
          2 001113  BB81                                 LAB,B3   ,B1
          2 001114  3C31                                 LDV,R3   49
          2 001115  0008                                 MMM

     2046    30776    4                      IF Y_VC_CAL.USRDATLNG = 0  /* we'll supply it then */

  30776   2 001116  E847 0077                            LDR,R6   PARM1+19,AUTO
          2 001118  6981 000E                            BNEZ,R6  s:30786,PREL

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:252  
     2047    30777    4                         THEN
     2048    30778    5                            DO;

     2049    30779    5                               CALL_FPT.EVN = %KX_P_EV_VCUP#;

  30779   2 00111A  CF47 001A                            STR,R4   CALL_FPT,AUTO

     2050    30780    5                               CALL_FPT.V_.ADR$ = ADDR(X28_PRTID);

  30780   2 00111C  EB80 0000 003E  00                   LAB,B6   X28_PRTID
          2 00111F  EFC7 0025                            STB,B6   CALL_FPT+11,AUTO

     2051    30781    5                               CALL_FPT.V_.BYTX = 0;

  30781   2 001121  8747 0027                            CL       CALL_FPT+13,AUTO

     2052    30782    5                               CALL_FPT.V_.BYTSIZ = LENGTHC(X28_PRTID);

  30782   2 001123  CF47 0028                            STR,R4   CALL_FPT+14,AUTO

     2053    30783    5                               GOTO CAL_KXP0;

  30783   2 001125  0F81 0015                            B        s:30791,PREL

     2054    30784    5                            END;
     2055    30785    4                   END;
     2056    30786    3   CALL_VCUP: CALL_FPT.EVN = %KX_P_EV_VCUP#;

  30786   2 001127  6C04                 CALL_VCUP       LDV,R6   4
          2 001128  EF47 001A                            STR,R6   CALL_FPT,AUTO

     2057    30787    3             CALL_FPT.V_.ADR$ = PRM_USR_DAT.DAT__.ADR$;

  30787   2 00112A  ECC7 0004                            LDB,B6   @PRM_USR_X,AUTO
          2 00112C  DCC6 0001                            LDB,B5   1,B6
          2 00112E  DFC7 0025                            STB,B5   CALL_FPT+11,AUTO

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:253  
     2058    30788    3             CALL_FPT.V_.BYTX = LENGTHC(Y_VC_CAL) + PRM_USR_DAT.DAT__.BYTX + Y_VC_CAL.
             30788                      USRDATBYTX;

  30788   2 001130  D846 0003                            LDR,R5   3,B6
          2 001132  DA47 0078                            ADD,R5   PARM1+20,AUTO
          2 001134  5E2E                                 ADV,R5   46
          2 001135  DF47 0027                            STR,R5   CALL_FPT+13,AUTO

     2059    30789        /*N* validate USRDATLNG ?? */
     2060    30790    3             CALL_FPT.V_.BYTSIZ = Y_VC_CAL.USRDATLNG;

  30790   2 001137  C847 0077                            LDR,R4   PARM1+19,AUTO
          2 001139  CF47 0028                            STR,R4   CALL_FPT+14,AUTO

     2061    30791    3   CAL_KXP0: IF NOT Y_VC_CAL.REASSEMBLY

  30791   2 00113B  82C7 006B            CAL_KXP0        LB,'0800'X        PARM1+7,AUTO
  30791   2 00113D       0800
          2 00113E  0501 0006                            BBT      s:30795,PREL

     2062    30792    3                THEN
     2063    30793    3                   KX$L3.NOREASM = '1'B;

  30793   2 001140  ECC7 0012                            LDB,B6   L3$,AUTO
          2 001142  8946 0076                            LBT,'0080'X       118,B6
          2 001144       0080

     2064    30794        /* Save the call user data. May have to use it again later */
     2065    30795    3             KX$VC.CALMSGBYTSIZ = CALL_FPT.V_.BYTSIZ;

  30795   2 001145  ECC7 0006                            LDB,B6   X29$,AUTO
          2 001147  CF46 0028                            STR,R4   40,B6

     2066    30796    3             IF CALL_FPT.V_.BYTSIZ > 0

  30796   2 001149  E847 0028                            LDR,R6   CALL_FPT+14,AUTO
          2 00114B  6901 0022                            BEZ,R6   s:30803,PREL
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:254  

     2067    30797    3                THEN
     2068    30798    4                   DO;

     2069    30799    4                      CALL KVB$GETSYS ( (KX$VC.CALMSGBYTSIZ+1)/2, KX$VC.CALPKT$ )

  30799   2 00114D  4E01                                 ADV,R4   1
          2 00114E  4041                                 SOR,R4   1
          2 00114F  CF47 0082                            STR,R4   WRDSIZ2N+3,AUTO
          2 001151  DBC6 0026                            LAB,B5   38,B6
          2 001153  DFC7 0085                            STB,B5   WRDSIZ2N+6,AUTO
          2 001155  CBC7 0082                            LAB,B4   WRDSIZ2N+3,AUTO
          2 001157  CFC7 0083                            STB,B4   WRDSIZ2N+4,AUTO
          2 001159  BBC7 0083                            LAB,B3   WRDSIZ2N+4,AUTO
          2 00115B  CBF0 0200                            LAB,B4   512,IMO
          2 00115D  E380 0000 0000  xent                 LNJ,B6   KVB$GETSYS
          2 001160       02B9                            DC       s:31060,PREL

     2070    30800    4                         ALTRET (L_NOMEM);
     2071    30801    4                      SUBSTR(KX$VC.CALPKT$->B$STR,0,CALL_FPT.V_.BYTSIZ) =

  30801   2 001161  ECC7 0006                            LDB,B6   X29$,AUTO
          2 001163  DCC6 0026                            LDB,B5   38,B6
          2 001165  ACC7 0025                            LDB,B2   CALL_FPT+11,AUTO
          2 001167  A847 0027                            LDR,R2   CALL_FPT+13,AUTO
          2 001169  E847 0028                            LDR,R6   CALL_FPT+14,AUTO
          2 00116B  BB85                                 LAB,B3   ,B5
          2 00116C  3C00                                 LDV,R3   0
          2 00116D  0008                                 MMM

     2072    30802    4                         SUBSTR(CALL_FPT.V_.ADR$->B$STR,CALL_FPT.V_.BYTX,CALL_FPT.V_.
             30802                                  BYTSIZ);
     2073    30803    4                   END;

     2074    30804    3   CAL_KXP:  CALL KXP$PACKET ( CALL_FPT ) WHENALTRETURN

  30804   2 00116E  EBC7 001A            CAL_KXP         LAB,B6   CALL_FPT,AUTO
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:255  
          2 001170  EFC7 0082                            STB,B6   WRDSIZ2N+3,AUTO
          2 001172  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 001174  CBF0 0100                            LAB,B4   256,IMO
          2 001176  E380 0000 0000  xent                 LNJ,B6   KXP$PACKET
          2 001179       0003                            DC       s:30805,PREL
          2 00117A  0F81 0009                            B        s:30807,PREL

     2075    30805    4                   DO;

     2076    30806    4   L_KXPALT:          CALL KHD$SCREECH ( CALL_FPT.PRM1$->B$SCODE );

  30806   2 00117C  BBC7 0021            L_KXPALT        LAB,B3   CALL_FPT+7,AUTO
          2 00117E  CBF0 0100                            LAB,B4   256,IMO
          2 001180  E380 0000 0000  xent                 LNJ,B6   KHD$SCREECH
          2 001183       0001                            DC       s:30807,PREL

     2077    30807    4                   END;

  30807   2 001184  0F81 0290                            B        s:31057,PREL

     2078    30808    3          CASE ( %KX_VCFNC_CAL_RSP# );

     2079    30809        /*
     2080    30810           HOST accepts an incoming call. If state is WCA# then
     2081    30811           send call_c via L3. If state is ENDPHSDSC# then vc has been cleared by
     2082    30812           remote end (and HOST has been notified) and there is nothing to do.
     2083    30813        */
     2084    30814    3             IF KX$VC.STATE = %KX_VC_ST_WCA#

  30814   2 001186  ECC7 0006                            LDB,B6   X29$,AUTO
          2 001188  E2C6 0033                            LLH,R6   51,B6
          2 00118A  6D05                                 CMV,R6   5
          2 00118B  0901 FF9B                            BE       s:30786,PREL

     2085    30815    3                THEN
     2086    30816    3                   GOTO CALL_VCUP;
     2087    30817    3                ELSE
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:256  
     2088    30818    3                   IF KX$VC.STATE ~= %KX_VC_ST_ENDPHSDSC#

  30818   2 00118D  6D08                                 CMV,R6   8
          2 00118E  0981 FF02                            BNE      s:30745,PREL
          2 001190  0F81 0284                            B        s:31057,PREL

     2089    30819    3                      THEN
     2090    30820    3                         GOTO BAD_VCSTT;
     2091    30821
     2092    30822    3          CASE ( %KX_VCFNC_DAT_RQS# );

     2093    30823        /*
     2094    30824           Host wants to send data. Make sure state is NRM#. If RPRDAT then call L3.
     2095    30825        */
     2096    30826    3             IF KX$VC.STATE ~= %KX_VC_ST_NRM#

  30826   2 001192  ECC7 0006                            LDB,B6   X29$,AUTO
          2 001194  E2C6 0033                            LLH,R6   51,B6
          2 001196  6D06                                 CMV,R6   6
          2 001197  0981 FEF9                            BNE      s:30745,PREL

     2097    30827    3                THEN
     2098    30828    3                   GOTO BAD_VCSTT;
     2099    30829    3             USR@DAT_ADR$ = PRM_USR_DAT.DAT__.ADR$;

  30829   2 001199  DCC4 0001                            LDB,B5   1,B4
          2 00119B  DFC7 0079                            STB,B5   USR@DAT_ADR$,AUTO

     2100    30830    3             USR@DAT_BYTX = PRM_USR_DAT.DAT__.BYTX + LENGTHC(VC$DAT);

  30830   2 00119D  C844 0003                            LDR,R4   3,B4
          2 00119F  4E02                                 ADV,R4   2
          2 0011A0  CF47 007B                            STR,R4   USR@DAT_BYTX,AUTO

     2101    30831    3             USR@DAT_BYTSIZ = PRM_USR_DAT.DAT__.DATBYTSIZ - LENGTHC(VC$DAT);

  30831   2 0011A2  9844 0004                            LDR,R1   4,B4
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:257  
          2 0011A4  1EFE                                 ADV,R1   -2
          2 0011A5  9F47 007C                            STR,R1   USR@DAT_BYTSIZ,AUTO

     2102    30832        /*
     2103    30833           First fill up the tail buffer that contains a partial packet with M-bit set,
     2104    30834           if that's the case.
     2105    30835        */
     2106    30836    3             IF KX$VC.SND.NXTLOD$ = ADDR(NIL)

  30836   2 0011A7  8DC6 000E                            CMN      14,B6
          2 0011A9  0901 0054                            BE       s:30860,PREL

     2107    30837    3                THEN
     2108    30838    3                   GOTO L_NEWBFR;
     2109    30839    3             DAT$ = KX$VC.SND.TAL$;

  30839   2 0011AB  ACC6 0010                            LDB,B2   16,B6
          2 0011AD  AFC7 000A                            STB,B2   DAT$,AUTO

     2110    30840    3             IF (NOT KX$VC_OTPBFR.M) OR (KX$VC_OTPBFR.BFRBYTSIZ = KX$VC_OTPBFR.BYTX)

  30840   2 0011AF  82C2 0002                            LB,'4000'X        2,B2
  30840   2 0011B1       4000
          2 0011B2  0581 004B                            BBF      s:30860,PREL
          2 0011B4  E842 0002                            LDR,R6   2,B2
          2 0011B6  E570 3FFF                            AND,R6   16383,IMO
          2 0011B8  E942 0003                            CMR,R6   3,B2
          2 0011BA  0901 0043                            BE       s:30860,PREL

     2111    30841    3                THEN
     2112    30842    3                   GOTO L_NEWBFR;
     2113    30843    3             Y@BYTSIZ = MINIMUM ( KX$VC_OTPBFR.BFRBYTSIZ-KX$VC_OTPBFR.BYTX,
             30843                      USR@DAT_BYTSIZ);

  30843   2 0011BC  E242 0003                            SUB,R6   3,B2
          2 0011BE  E951                                 CMR,R6   R1
          2 0011BF  0A81 0002                            BALE     s:30843+6,PREL
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:258  
          2 0011C1  E851                                 LDR,R6   R1
          2 0011C2  EF47 002C                            STR,R6   Y@BYTSIZ,AUTO

     2114    30844    3             IF USR@DAT_BYTSIZ = 0

  30844   2 0011C4  1981 0006                            BNEZ,R1  s:30852,PREL

     2115    30845    3                THEN
     2116    30846    4                   DO;

     2117    30847        /* This must be a flush command to clear previous M-bit */
     2118    30848    4                      KX$VC_OTPBFR.M = '0'B;

  30848   2 0011C6  8842 0002                            LBF,'4000'X       2,B2
  30848   2 0011C8       4000

     2119    30849    4                   END;

  30849   2 0011C9  0F81 0034                            B        s:30860,PREL

     2120    30850    3                ELSE
     2121    30851    4                   DO;

     2122    30852    4                      SUBSTR ( DAT$->B$STR, KX$VC_OTPBFR.BYTX, Y@BYTSIZ ) =

  30852   2 0011CB  E842 0003                            LDR,R6   3,B2
          2 0011CD  AB85                                 LAB,B2   ,B5
          2 0011CE  A854                                 LDR,R2   R4
          2 0011CF  EF47 0082                            STR,R6   WRDSIZ2N+3,AUTO
          2 0011D1  E847 002C                            LDR,R6   Y@BYTSIZ,AUTO
          2 0011D3  BCC7 000A                            LDB,B3   DAT$,AUTO
          2 0011D5  B847 0082                            LDR,R3   WRDSIZ2N+3,AUTO
          2 0011D7  0008                                 MMM

     2123    30853    4                         SUBSTR(USR@DAT_ADR$->B$STR,USR@DAT_BYTX,Y@BYTSIZ);
     2124    30854    4                      USR@DAT_BYTX = USR@DAT_BYTX + Y@BYTSIZ;

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:259  
  30854   2 0011D8  E847 007B                            LDR,R6   USR@DAT_BYTX,AUTO
          2 0011DA  EA47 002C                            ADD,R6   Y@BYTSIZ,AUTO
          2 0011DC  EF47 007B                            STR,R6   USR@DAT_BYTX,AUTO

     2125    30855    4                      USR@DAT_BYTSIZ = USR@DAT_BYTSIZ - Y@BYTSIZ;

  30855   2 0011DE  B847 007C                            LDR,R3   USR@DAT_BYTSIZ,AUTO
          2 0011E0  B247 002C                            SUB,R3   Y@BYTSIZ,AUTO
          2 0011E2  BF47 007C                            STR,R3   USR@DAT_BYTSIZ,AUTO

     2126    30856    4                      KX$VC_OTPBFR.BYTX = KX$VC_OTPBFR.BYTX + Y@BYTSIZ;

  30856   2 0011E4  ECC7 000A                            LDB,B6   DAT$,AUTO
          2 0011E6  A846 0003                            LDR,R2   3,B6
          2 0011E8  AA47 002C                            ADD,R2   Y@BYTSIZ,AUTO
          2 0011EA  AF46 0003                            STR,R2   3,B6

     2127    30857    4                     IF NOT %Y_VC_DAT.M AND KX$VC_OTPBFR.BFRBYTSIZ > KX$VC_OTPBFR.BYTX

  30857   2 0011EC  82C7 0062                            LB,'0040'X        Y_VC_CAL,AUTO
  30857   2 0011EE       0040
          2 0011EF  0501 000E                            BBT      s:30860,PREL
          2 0011F1  ECC7 000A                            LDB,B6   DAT$,AUTO
          2 0011F3  A846 0002                            LDR,R2   2,B6
          2 0011F5  A570 3FFF                            AND,R2   16383,IMO
          2 0011F7  A946 0003                            CMR,R2   3,B6
          2 0011F9  0381 0004                            BLE      s:30860,PREL

     2128    30858    4                         THEN
     2129    30859    4                            KX$VC_OTPBFR.M = '0'B;

  30859   2 0011FB  8846 0002                            LBF,'4000'X       2,B6
  30859   2 0011FD       4000

     2130    30860    4                   END;

  30855   2                              L_NEWBFR        null
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:260  
     2131    30861    3   L_NEWBFR: ;
     2132    30862    3             IF USR@DAT_BYTSIZ = 0

  30862   2 0011FE  E847 007C            L_NEWBFR        LDR,R6   USR@DAT_BYTSIZ,AUTO
          2 001200  6901 003D                            BEZ,R6   s:30882,PREL

     2133    30863    3                THEN
     2134    30864    3                   GOTO L_RPRDAT;
     2135    30865        /*
     2136    30866           Get new output buffer(s) for the remaining data. If the M-bit is also set
     2137    30867           this time, we need to break this data into one chunk whose size is a
     2138    30868           multiple of the full packet size, and one chunk that contains the rest.
     2139    30869        */
     2140    30870    3             PCKSIZ = KX_BUF.SIZ(KX$L3.CALL_OPTS.SNDPCKSIZ);

  30870   2 001202  ECC7 0012                            LDB,B6   L3$,AUTO
          2 001204  B846 0015                            LDR,R3   21,B6
          2 001206  B570 00FF                            AND,R3   255,IMO
          2 001208  C830 0000 001E  xsym                 LDR,R4   KX_BUF+30,R3
          2 00120B  CF47 007D                            STR,R4   PCKSIZ,AUTO

     2141    30871    3             FULPCKS = ( USR@DAT_BYTSIZ / PCKSIZ ) * PCKSIZ;

  30871   2 00120D  F856                                 LDR,R7   R6
          2 00120E  6C00                                 LDV,R6   0
          2 00120F  F354                                 DIV,R7   R4
          2 001210  FB54                                 MUL,R7   R4
          2 001211  E857                                 LDR,R6   R7
          2 001212  EF47 007E                            STR,R6   FULPCKS,AUTO

     2142    30872    3             IF %Y_VC_DAT.M AND FULPCKS > 0

  30872   2 001214  82C7 0062                            LB,'0040'X        Y_VC_CAL,AUTO
  30872   2 001216       0040
          2 001217  0581 0012                            BBF      s:30879,PREL
          2 001219  6901 0010                            BEZ,R6   s:30879,PREL

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:261  
     2143    30873    3                THEN
     2144    30874    4                   DO;

     2145    30875    4                      CALL Y$BFROTP ALTRET ( L_NOMEM );

  30875   2 00121B  E3C0 0208                            LNJ,B6   s:0,PREL
          2 00121D       01FC                            DC       s:31060,PREL

     2146    30876    4                      USR@DAT_BYTX = USR@DAT_BYTX + FULPCKS;

  30876   2 00121E  E847 007B                            LDR,R6   USR@DAT_BYTX,AUTO
          2 001220  EA47 007E                            ADD,R6   FULPCKS,AUTO
          2 001222  EF47 007B                            STR,R6   USR@DAT_BYTX,AUTO

     2147    30877    4                      USR@DAT_BYTSIZ = USR@DAT_BYTSIZ - FULPCKS;

  30877   2 001224  D847 007C                            LDR,R5   USR@DAT_BYTSIZ,AUTO
          2 001226  D247 007E                            SUB,R5   FULPCKS,AUTO
          2 001228  DF47 007C                            STR,R5   USR@DAT_BYTSIZ,AUTO

     2148    30878    4                   END;

     2149    30879    3             IF USR@DAT_BYTSIZ = 0

  30879   2 00122A  E847 007C                            LDR,R6   USR@DAT_BYTSIZ,AUTO
          2 00122C  6901 0011                            BEZ,R6   s:30882,PREL

     2150    30880    3                THEN
     2151    30881    3                   GOTO L_RPRDAT;
     2152    30882    3             IF %Y_VC_DAT.M

  30882   2 00122E  82C7 0062                            LB,'0040'X        Y_VC_CAL,AUTO
  30882   2 001230       0040
          2 001231  0581 0007                            BBF      s:30886,PREL

     2153    30883    3                THEN
     2154    30884    3                   FULPCKS = PCKSIZ;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:262  

  30884   2 001233  D847 007D                            LDR,R5   PCKSIZ,AUTO
          2 001235  DF47 007E                            STR,R5   FULPCKS,AUTO
          2 001237  0F81 0003                            B        s:30887,PREL

     2155    30885    3                ELSE
     2156    30886    3                   FULPCKS = USR@DAT_BYTSIZ;

  30886   2 001239  EF47 007E                            STR,R6   FULPCKS,AUTO

     2157    30887    3             CALL Y$BFROTP ALTRET ( L_NOMEM );

  30887   2 00123B  E3C0 01E8                            LNJ,B6   s:0,PREL
          2 00123D       01DC                            DC       s:31060,PREL

  30882   2                              L_RPRDAT        null
     2158    30888    3   L_RPRDAT: ;
     2159    30889    3             IF KX$VC.OTPBFRBYTCNT > KX$VC.MAXOTPBYT

  30889   2 00123E  ECC7 0006            L_RPRDAT        LDB,B6   X29$,AUTO
          2 001240  E846 0014                            LDR,R6   20,B6
          2 001242  E946 0015                            CMR,R6   21,B6
          2 001244  0381 0019                            BLE      s:30909,PREL

     2160    30890    3                THEN
     2161    30891                        %KV$RQSOTP ( RQSOTP = NO );
             30897    4           IF KV$VDI.RQSOTP THEN DO;

  30897   2 001246  DCC7 0008                            LDB,B5   VDI$,AUTO
          2 001248  82C5 0019                            LB,'0008'X        25,B5
          2 00124A       0008
          2 00124B  0581 0012                            BBF      s:30909,PREL

             30898    4              KV$VDI.RQSOTP = '0'B;

  30898   2 00124D  8845 0019                            LBF,'0008'X       25,B5
  30898   2 00124F       0008
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:263  

             30899    4              IF KV$VDI.SSNCNT>1

  30899   2 001250  E845 000E                            LDR,R6   14,B5
          2 001252  6D01                                 CMV,R6   1
          2 001253  0381 000A                            BLE      s:30909,PREL

             30900    4              THEN CALL KVV$VDI (KV_VDH_EVT_RQSOTP);

  30900   2 001255  BB80 0000 0002  03                   LAB,B3   +2
          2 001258  CBF0 0100                            LAB,B4   256,IMO
          2 00125A  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          2 00125D       0001                            DC       s:30909,PREL

             30901    4              END;

     2162    30909    3             IF KX$VC.RPRDAT

  30909   2 00125E  ECC7 0006                            LDB,B6   X29$,AUTO
          2 001260  89C6 0016                            CMZ      22,B6
          2 001262  0881 01B2                            BAGE     s:31057,PREL

     2163    30910    3                THEN
     2164    30911    4                   DO;

     2165    30912    4                      CALL_FPT.EVN = %KX_P_EV_DATAVL#;

  30912   2 001264  6C0B                                 LDV,R6   11
          2 001265  EF47 001A                            STR,R6   CALL_FPT,AUTO

     2166    30913    4                      GOTO CAL_KXP;

  30913   2 001267  0F81 FF06                            B        s:30803,PREL

     2167    30914    4                   END;
     2168    30915
     2169    30916
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:264  
     2170    30917    3          CASE ( %KX_VCFNC_INT_RQS# );

     2171    30918        /*
     2172    30919           HOST wants to send an interrupt. Make sure state is NRM#. Call L3 to send
     2173    30920           the interrupt packet.
     2174    30921        */
     2175    30922    3             IF KX$VC.STATE ~= %KX_VC_ST_NRM#

  30922   2 001269  ECC7 0006                            LDB,B6   X29$,AUTO
          2 00126B  E2C6 0033                            LLH,R6   51,B6
          2 00126D  6D06                                 CMV,R6   6
          2 00126E  0981 FE22                            BNE      s:30745,PREL

     2176    30923    3                THEN
     2177    30924    3                   GOTO BAD_VCSTT;
     2178    30925    3             CALL_FPT.EVN = %KX_P_EV_SNDINT#;

  30925   2 001270  4C12                                 LDV,R4   18
          2 001271  CF47 001A                            STR,R4   CALL_FPT,AUTO

     2179    30926    3             CALL_FPT.V_.ADR$ = PRM_USR_DAT.DAT__.ADR$;

  30926   2 001273  DCC4 0001                            LDB,B5   1,B4
          2 001275  DFC7 0025                            STB,B5   CALL_FPT+11,AUTO

     2180    30927    3             CALL_FPT.V_.BYTX = LENGTHC(VC$INT) + PRM_USR_DAT.DAT__.BYTX;

  30927   2 001277  9844 0003                            LDR,R1   3,B4
          2 001279  1E02                                 ADV,R1   2
          2 00127A  9F47 0027                            STR,R1   CALL_FPT+13,AUTO

     2181    30928    3             IF %Y_VC_INT.INTDATLNG <= PRM_USR_DAT.DAT__.DATBYTSIZ -LENGTHC(VC$INT)

  30928   2 00127C  E847 0062                            LDR,R6   Y_VC_CAL,AUTO
          2 00127E  E570 00FF                            AND,R6   255,IMO
          2 001280  D844 0004                            LDR,R5   4,B4
          2 001282  5EFE                                 ADV,R5   -2
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:265  
          2 001283  E955                                 CMR,R6   R5
          2 001284  0A01 0003                            BAG      s:30933,PREL

     2182    30929    3                THEN
     2183    30930    3                   CALL_FPT.V_.BYTSIZ = %Y_VC_INT.INTDATLNG;

  30930   2 001286  EF47 0028                            STR,R6   CALL_FPT+14,AUTO

     2184    30931        /*N*         ELSE
     2185    30932                        errlog ? */
     2186    30933    3             GOTO CAL_KXP;

  30933   2 001288  0F81 FEE5                            B        s:30803,PREL

     2187    30934
     2188    30935    3          CASE ( %KX_VCFNC_RST_RQS# );

     2189    30936        /*
     2190    30937           HOST wants to reset this circuit. Make sure state is NRM#. Call L3 to send
     2191    30938           the reset packet.
     2192    30939        */
     2193    30940    3             IF KX$VC.STATE ~= %KX_VC_ST_NRM#

  30940   2 00128A  ECC7 0006                            LDB,B6   X29$,AUTO
          2 00128C  E2C6 0033                            LLH,R6   51,B6
          2 00128E  6D06                                 CMV,R6   6
          2 00128F  0981 FE01                            BNE      s:30745,PREL

     2194    30941    3                THEN
     2195    30942    3                   GOTO BAD_VCSTT;
     2196    30943    3             CALL_FPT.EVN = %KX_P_EV_VCRST#;

  30943   2 001291  4C0A                                 LDV,R4   10
          2 001292  CF47 001A                            STR,R4   CALL_FPT,AUTO

     2197    30944    3             CALL_FPT.PRS.PRM1 = '1'B;

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:266  
  30944   2 001294  8947 0029                            LBT,'8000'X       CALL_FPT+15,AUTO
  30944   2 001296       8000

     2198    30945    3             CALL_FPT.PRM1 = %Y_VC_RST.DIAG;

  30945   2 001297  92C7 0063                            LLH,R1   Y_VC_CAL+1,AUTO
          2 001299  9F47 001F                            STR,R1   CALL_FPT+5,AUTO

     2199    30946    3             GOTO CAL_KXP;

  30946   2 00129B  0F81 FED2                            B        s:30803,PREL

     2200    30947
     2201    30948    3          CASE ( %KX_VCFNC_CLR_RQS# );

     2202    30949        /*
     2203    30950           HOST wants to clear this circuit. The only state this is not allowed is READY#.
     2204    30951           The new state is BGNPHSDSC#. Call L3 to start the clear procedure.
     2205    30952           Disconnect.
     2206    30953        */
     2207    30954    3             IF KX$VC.STATE = %KX_VC_ST_READY#

  30954   2 00129D  ECC7 0006                            LDB,B6   X29$,AUTO
          2 00129F  E2C6 0033                            LLH,R6   51,B6
          2 0012A1  6D03                                 CMV,R6   3
          2 0012A2  0901 FDEE                            BE       s:30745,PREL

     2208    30955    3                THEN
     2209    30956    3                   GOTO BAD_VCSTT;
     2210    30957    3             KX$VC.STATE = %KX_VC_ST_BGNPHSDSC#;

  30957   2 0012A4  4C07                                 LDV,R4   7
          2 0012A5  C7C6 0033                            STH,R4   51,B6

     2211    30958    3             CALL_FPT.EVN = %KX_P_EV_VCLST#;

  30958   2 0012A7  6C09                                 LDV,R6   9
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:267  
          2 0012A8  EF47 001A                            STR,R6   CALL_FPT,AUTO

     2212    30959    3             CALL_FPT.PRS.PRM1 = '1'B;

  30959   2 0012AA  8947 0029                            LBT,'8000'X       CALL_FPT+15,AUTO
  30959   2 0012AC       8000

     2213    30960    3             CALL_FPT.PRM1 = %Y_VC_CLR.DIAG;

  30960   2 0012AD  B2C7 0063                            LLH,R3   Y_VC_CAL+1,AUTO
          2 0012AF  BF47 001F                            STR,R3   CALL_FPT+5,AUTO

     2214    30961    3             CALL_FPT.V_.ADR$ = PRM_USR_DAT.DAT__.ADR$;

  30961   2 0012B1  DCC4 0001                            LDB,B5   1,B4
          2 0012B3  DFC7 0025                            STB,B5   CALL_FPT+11,AUTO

     2215    30962    3             CALL_FPT.V_.BYTX = LENGTHC(VC$CLR) +

  30962   2 0012B5  A847 006B                            LDR,R2   PARM1+7,AUTO
          2 0012B7  AA44 0003                            ADD,R2   3,B4
          2 0012B9  2E14                                 ADV,R2   20
          2 0012BA  AF47 0027                            STR,R2   CALL_FPT+13,AUTO

     2216    30963    3                %Y_VC_CLR.USRDATBYTX + PRM_USR_DAT.DAT__.BYTX;
     2217    30964    3             IF %Y_VC_CLR.USRDATLNG <= PRM_USR_DAT.DAT__.DATBYTSIZ -LENGTHC(VC$CLR)

  30964   2 0012BC  9844 0004                            LDR,R1   4,B4
          2 0012BE  1EEC                                 ADV,R1   -20
          2 0012BF  1801 0009                            BLZ,R1   s:30969,PREL
          2 0012C1  9947 006A                            CMR,R1   PARM1+6,AUTO
          2 0012C3  0201 0005                            BL       s:30969,PREL

     2218    30965    3                THEN
     2219    30966    3                   CALL_FPT.V_.BYTSIZ = %Y_VC_CLR.USRDATLNG;

  30966   2 0012C5  E847 006A                            LDR,R6   PARM1+6,AUTO
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:268  
          2 0012C7  EF47 0028                            STR,R6   CALL_FPT+14,AUTO

     2220    30967        /*N*         ELSE
     2221    30968                        errlog ?  */
     2222    30969    3             CALL KXP$PACKET ( CALL_FPT ) ALTRET ( L_KXPALT );

  30969   2 0012C9  ABC7 001A                            LAB,B2   CALL_FPT,AUTO
          2 0012CB  AFC7 0082                            STB,B2   WRDSIZ2N+3,AUTO
          2 0012CD  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 0012CF  CBF0 0100                            LAB,B4   256,IMO
          2 0012D1  E380 0000 0000  xent                 LNJ,B6   KXP$PACKET
          2 0012D4       FEA8                            DC       s:30805,PREL

     2223    30970    3             CALL KVV$VDI ( KXX_VDH_DSC );

  30970   2 0012D5  BB80 0000 001B  03                   LAB,B3   +27
          2 0012D8  CBF0 0100                            LAB,B4   256,IMO
          2 0012DA  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          2 0012DD       0001                            DC       s:30970+9,PREL
          2 0012DE  0F81 0136                            B        s:31057,PREL

     2224    30971
     2225    30972    3          CASE ( %KX_VCFNC_CLR_RSP# );

     2226    30973        /*
     2227    30974           Not used for now, at least.
     2228    30975        */
     2229    30976    3          CASE ( %KX_VCFNC_BRK_RQS# );

     2230    30977        /*
     2231    30978           HOST wants to send a break. Make sure state is NRM# and this is an x.28
     2232    30979           vc. Figure out what exactly to send from the x.3 parameter.
     2233    30980        */
     2234    30981    3             IF KX$VC.STATE ~= %KX_VC_ST_NRM#

  30981   2 0012E0  ECC7 0006                            LDB,B6   X29$,AUTO
          2 0012E2  E2C6 0033                            LLH,R6   51,B6
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:269  
          2 0012E4  6D06                                 CMV,R6   6
          2 0012E5  0981 FDAB                            BNE      s:30745,PREL

     2235    30982    3                THEN
     2236    30983    3                   GOTO BAD_VCSTT;
     2237    30984    3             IF NOT KX$VC.X28

  30984   2 0012E7  82C6 0016                            LB,'0010'X        22,B6
  30984   2 0012E9       0010
          2 0012EA  0581 0084                            BBF      s:31018,PREL

     2238    30985    3                THEN
     2239    30986    3                   GOTO L_NOT_X28;
     2240    30987    4             DO CASE ( KX$VC.X3PRM(%KX_X3PRMX_ACTBRK#) );

  30987   2 0012EC  9846 001B                            LDR,R1   27,B6
          2 0012EE  9570 00FF                            AND,R1   255,IMO
          2 0012F0  1D16                                 CMV,R1   22
          2 0012F1  0281 0068                            BGE      s:31011,PREL
          2 0012F3  B810 0000 12F9  02                   LDR,R3   s:30987+13,R1
          2 0012F6  83B0 0000 130F  02                   JMP      s:30990,R3
          2 0012F9       004D                            DC       s:31012,PREL
          2 0012FA       0000                            DC       s:30990,PREL
          2 0012FB       0005                            DC       s:30993,PREL
          2 0012FC       004B                            DC       s:31011,PREL
          2 0012FD       000A                            DC       s:30995,PREL
          2 0012FE       004B                            DC       s:31011,PREL
          2 0012FF       004B                            DC       s:31011,PREL
          2 001300       004B                            DC       s:31011,PREL
          2 001301       004D                            DC       s:31012,PREL
          2 001302       004B                            DC       s:31011,PREL
          2 001303       004B                            DC       s:31011,PREL
          2 001304       004B                            DC       s:31011,PREL
          2 001305       004B                            DC       s:31011,PREL
          2 001306       004B                            DC       s:31011,PREL
          2 001307       004B                            DC       s:31011,PREL
          2 001308       004B                            DC       s:31011,PREL
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:270  
          2 001309       001C                            DC       s:30997,PREL
          2 00130A       004B                            DC       s:31011,PREL
          2 00130B       004B                            DC       s:31011,PREL
          2 00130C       004B                            DC       s:31011,PREL
          2 00130D       004B                            DC       s:31011,PREL
          2 00130E       002B                            DC       s:31006,PREL

     2241    30988    4                CASE ( 0, 8 );  /* nothing to do */

     2242    30989    4                CASE ( 1 );     /* send interrupt */

     2243    30990    4                   CALL_FPT.EVN = %KX_P_EV_SNDINT#;

  30990   2 00130F  4C12                                 LDV,R4   18
          2 001310  CF47 001A                            STR,R4   CALL_FPT,AUTO

     2244    30991    4                   GOTO CAL_KXP;

  30991   2 001312  0F81 FE5B                            B        s:30803,PREL

     2245    30992    4                CASE ( 2 );     /* reset the vc */

     2246    30993    4                   CALL_FPT.EVN = %KX_P_EV_VCRST#;

  30993   2 001314  4C0A                                 LDV,R4   10
          2 001315  CF47 001A                            STR,R4   CALL_FPT,AUTO

     2247    30994    4                   GOTO CAL_KXP;

  30994   2 001317  0F81 FE56                            B        s:30803,PREL

     2248    30995    4                CASE ( 4 );     /* send indication of break */

     2249    30996    4   L_4:            CALL KXX$SNDX29MSG ( %KX_X29MSGTYP_BRKIND#, KX$VC );

  30996   2 001319  EBF0 0003            L_4             LAB,B6   3,IMO
          2 00131B  DCC7 0006                            LDB,B5   X29$,AUTO
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:271  
          2 00131D  DFC7 0084                            STB,B5   WRDSIZ2N+5,AUTO
          2 00131F  EFC7 0082                            STB,B6   WRDSIZ2N+3,AUTO
          2 001321  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 001323  CBF0 0200                            LAB,B4   512,IMO
          2 001325  E380 0000 0000  xent                 LNJ,B6   KXX$SNDX29MSG
          2 001328       0001                            DC       s:30995+16,PREL
          2 001329  0F81 00EB                            B        s:31057,PREL

     2250    30997    4                CASE ( 16 );    /* discard output to terminal, i.e. input to us */

     2251    30998    4   L_DSCOTP:       KX$VC.X3PRM(%KX_X3PRMX_DSCOTP#) = 1;

  30998   2 00132B  6C01                 L_DSCOTP        LDV,R6   1
          2 00132C  ECC7 0006                            LDB,B6   X29$,AUTO
          2 00132E  E7C6 001C                            STH,R6   28,B6

     2252    30999    4                   IF KX$VC.BLK_L3

  30999   2 001330  82C6 0016                            LB,'4000'X        22,B6
  30999   2 001332       4000
          2 001333  0581 00E1                            BBF      s:31057,PREL

     2253    31000    4                      THEN
     2254    31001    5                         DO;

     2255    31002    5                            CALL_FPT.EVN = %KX_P_EV_REDRQS#;

  31002   2 001335  5C15                                 LDV,R5   21
          2 001336  DF47 001A                            STR,R5   CALL_FPT,AUTO

     2256    31003    5                            GOTO CAL_KXP;

  31003   2 001338  0F81 FE35                            B        s:30803,PREL

     2257    31004    5                         END;
     2258    31005    4                CASE ( 21 );    /* = 1+4+16 */

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:272  
     2259    31006    4                   CALL_FPT.EVN = %KX_P_EV_SNDINT#;

  31006   2 00133A  4C12                                 LDV,R4   18
          2 00133B  CF47 001A                            STR,R4   CALL_FPT,AUTO

     2260    31007    4                   CALL KXP$PACKET ( CALL_FPT ) ALTRET ( L_KXPALT );

  31007   2 00133D  DBC7 001A                            LAB,B5   CALL_FPT,AUTO
          2 00133F  DFC7 0082                            STB,B5   WRDSIZ2N+3,AUTO
          2 001341  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 001343  CBF0 0100                            LAB,B4   256,IMO
          2 001345  E380 0000 0000  xent                 LNJ,B6   KXP$PACKET
          2 001348       FE34                            DC       s:30805,PREL

     2261    31008    4                   CALL KXX$SNDX29MSG ( %KX_X29MSGTYP_BRKIND#, KX$VC );

  31008   2 001349  EBF0 0003                            LAB,B6   3,IMO
          2 00134B  DCC7 0006                            LDB,B5   X29$,AUTO
          2 00134D  DFC7 0084                            STB,B5   WRDSIZ2N+5,AUTO
          2 00134F  EFC7 0082                            STB,B6   WRDSIZ2N+3,AUTO
          2 001351  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 001353  CBF0 0200                            LAB,B4   512,IMO
          2 001355  E380 0000 0000  xent                 LNJ,B6   KXX$SNDX29MSG
          2 001358       0001                            DC       s:31009,PREL

     2262    31009    4                   GOTO L_DSCOTP;

  31009   2 001359  0FD2                                 B        s:30997,SPREL

     2263    31010    4                CASE ( ELSE );  /* illegal value in x.3 param 7, treat as 4. */

     2264    31011    4                   GOTO L_4;    /* errlog ? */

  31011   2 00135A  0F81 FFBE                            B        s:30995,PREL

     2265    31012    4             END; /* do case ( prmx_actbrk ) */

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:273  
  31012   2 00135C  0F81 00B8                            B        s:31057,PREL

     2266    31013    3          CASE ( %KX_VCFNC_SETX3# );

     2267    31014    3             KX$VC.X3PRM = Y_VC_CAL.X3;

  31014   2 00135E  ABC7 006B                            LAB,B2   PARM1+7,AUTO
          2 001360  2C01                                 LDV,R2   1
          2 001361  6C16                                 LDV,R6   22
          2 001362  BCC7 0006                            LDB,B3   X29$,AUTO
          2 001364  3C31                                 LDV,R3   49
          2 001365  0008                                 MMM
          2 001366  0F81 00AE                            B        s:31057,PREL

     2268    31015    3          CASE ( %KX_VCFNC_REDX3# );

     2269    31016    3             IF NOT KX$VC.X28

  31016   2 001368  ECC7 0006                            LDB,B6   X29$,AUTO
          2 00136A  82C6 0016                            LB,'0010'X        22,B6
          2 00136C       0010
          2 00136D  0501 0008                            BBT      s:31022,PREL

     2270    31017    3                THEN
     2271    31018    4                   DO;

     2272    31019    4   L_NOT_X28:         VDOVLP_ERR.ERRCODE = NOT_X28;

  31019   2 00136F  8C80 0000 007D  00   L_NOT_X28       LDI      NOT_X28
          2 001372  8D47 0031                            SDI      VDOVLP_ERR+1,AUTO

     2273    31020    4                      GOTO BAD_STATE;

  31020   2 001374  0F81 FD21                            B        s:30747,PREL

     2274    31021    4                   END;
     2275    31022    3             KV@SND_DAT = KX_SND_DAT;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:274  

  31022   2 001376  AB80 0000 0000  xsym                 LAB,B2   KX_SND_DAT
          2 001379  2C00                                 LDV,R2   0
          2 00137A  6C14                                 LDV,R6   20
          2 00137B  BBC7 0055                            LAB,B3   KV@SND_DAT,AUTO
          2 00137D  3C00                                 LDV,R3   0
          2 00137E  0008                                 MMM

     2276    31023    3             IF NOT KX$VC.X3PND

  31023   2 00137F  ECC7 0006                            LDB,B6   X29$,AUTO
          2 001381  82C6 0016                            LB,'0800'X        22,B6
          2 001383       0800
          2 001384  0501 0036                            BBT      s:31036,PREL

     2277    31024    3                THEN
     2278    31025    4                   DO;

     2279    31026    4                      KX$VC.CALMSGBYTSIZ = LENGTHC(VC$CAL);

  31026   2 001386  6C2E                                 LDV,R6   46
          2 001387  EF46 0028                            STR,R6   40,B6

     2280    31027    4                      CALL KVB$GETSYS ( (KX$VC.CALMSGBYTSIZ+1)/2, KX$VC.CALPKT$ )

  31027   2 001389  6E01                                 ADV,R6   1
          2 00138A  6041                                 SOR,R6   1
          2 00138B  EF47 0082                            STR,R6   WRDSIZ2N+3,AUTO
          2 00138D  DBC6 0026                            LAB,B5   38,B6
          2 00138F  DFC7 0085                            STB,B5   WRDSIZ2N+6,AUTO
          2 001391  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 001393  BFC7 0083                            STB,B3   WRDSIZ2N+4,AUTO
          2 001395  BBC7 0083                            LAB,B3   WRDSIZ2N+4,AUTO
          2 001397  CBF0 0200                            LAB,B4   512,IMO
          2 001399  E380 0000 0000  xent                 LNJ,B6   KVB$GETSYS
          2 00139C       007D                            DC       s:31060,PREL

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:275  
     2281    31028    4                         ALTRET ( L_NOMEM );
     2282    31029    4                      KX$VC.CALPKT$->VC$CAL = '0'B;

  31029   2 00139D  ECC7 0006                            LDB,B6   X29$,AUTO
          2 00139F  DCC6 0026                            LDB,B5   38,B6
          2 0013A1  5C2E                                 LDV,R5   46
          2 0013A2  0021                                 ALR      ;
          2 0013A3       4178 0000                                ALPHANUM('0000'X,IMO,,1),;
          2 0013A5       4005 0000                                ALPHANUM(0,B5,,R5,FILL)

     2283    31030    4                      KX$VC.CALPKT$->VC$CAL.FUNCTION = %KX_VCFNC_INDX3#;

  31030   2 0013A7  437F                                 CSYNC    s:31029+9,SPREL
          2 0013A8  ECC7 0006                            LDB,B6   X29$,AUTO
          2 0013AA  DCC6 0026                            LDB,B5   38,B6
          2 0013AC  6C14                                 LDV,R6   20
          2 0013AD  E785                                 STH,R6   ,B5

     2284    31031    4                      KX$VC.X3PND = '1'B;

  31031   2 0013AE  ECC7 0006                            LDB,B6   X29$,AUTO
          2 0013B0  8946 0016                            LBT,'0800'X       22,B6
          2 0013B2       0800

     2285    31032    4                      KX_VDOVLPARY.VDOVLP.KEY$ = ADDR(KX_KEY_INDX3);

  31032   2 0013B3  DB80 0000 0000  xsym                 LAB,B5   KX_KEY_INDX3
          2 0013B6  DF80 0000 000A  xsym                 STB,B5   KX_VDOVLPARY+10

     2286    31033    4                   END;

  31033   2 0013B9  0F81 0007                            B        s:31038,PREL

     2287    31034    3                ELSE
     2288    31035    4                   DO;

     2289    31036    4                      KX_VDOVLPARY.VDOVLP.KEY$ = ADDR(KX_KEY_CAL_CNF);
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:276  

  31036   2 0013BB  DB80 0000 0000  xsym                 LAB,B5   KX_KEY_CAL_CNF
          2 0013BE  DF80 0000 000A  xsym                 STB,B5   KX_VDOVLPARY+10

     2290    31037    4                   END;

     2291    31038    3             KX$VC.CALPKT$->VC$CAL.X3 = KX$VC.X3PRM;

  31038   2 0013C1  CCC6 0026                            LDB,B4   38,B6
          2 0013C3  AB86                                 LAB,B2   ,B6
          2 0013C4  2C31                                 LDV,R2   49
          2 0013C5  6C16                                 LDV,R6   22
          2 0013C6  BB84                                 LAB,B3   ,B4
          2 0013C7  3C13                                 LDV,R3   19
          2 0013C8  0008                                 MMM

     2292    31039    3             IF %KV_VDI.USRRQSDAT.RED

  31039   2 0013C9  DCC7 0008                            LDB,B5   VDI$,AUTO
          2 0013CB  82C5 001D                            LB,'0010'X        29,B5
          2 0013CD       0010
          2 0013CE  0581 0046                            BBF      s:31057,PREL

     2293    31040    3                THEN
     2294    31041    4                   DO;

     2295    31042    4                      KV@SND_DAT.DAT__.ADR$ = KX$VC.CALPKT$;

  31042   2 0013D0  9CC7 0006                            LDB,B1   X29$,AUTO
          2 0013D2  ECC1 0026                            LDB,B6   38,B1
          2 0013D4  EFC7 0056                            STB,B6   KV@SND_DAT+1,AUTO

     2296    31043    4                      KV@SND_DAT.DAT__.BYTX = 0;

  31043   2 0013D6  8747 0058                            CL       KV@SND_DAT+3,AUTO

     2297    31044    4                      KV@SND_DAT.DAT__.DATBYTSIZ = KX$VC.CALMSGBYTSIZ;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:277  

  31044   2 0013D8  E841 0028                            LDR,R6   40,B1
          2 0013DA  EF47 0059                            STR,R6   KV@SND_DAT+4,AUTO

     2298    31045    4                      CALL KVV$VDI ( KV@SND_DAT ) WHENRETURN

  31045   2 0013DC  ABC7 0055                            LAB,B2   KV@SND_DAT,AUTO
          2 0013DE  AFC7 0082                            STB,B2   WRDSIZ2N+3,AUTO
          2 0013E0  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 0013E2  CBF0 0100                            LAB,B4   256,IMO
          2 0013E4  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          2 0013E7       0025                            DC       s:31052,PREL

     2299    31046    5                            DO;

     2300    31047    5                               KX$VC.X3PND = '0'B;

  31047   2 0013E8  ECC7 0006                            LDB,B6   X29$,AUTO
          2 0013EA  8846 0016                            LBF,'0800'X       22,B6
          2 0013EC       0800

     2301    31048    5                               CALL KVB$RLSSYS ( (KX$VC.CALMSGBYTSIZ+1)/2, KX$VC.
             31048                                        CALPKT$ );

  31048   2 0013ED  E846 0028                            LDR,R6   40,B6
          2 0013EF  6E01                                 ADV,R6   1
          2 0013F0  6041                                 SOR,R6   1
          2 0013F1  EF47 0082                            STR,R6   WRDSIZ2N+3,AUTO
          2 0013F3  DBC6 0026                            LAB,B5   38,B6
          2 0013F5  DFC7 0085                            STB,B5   WRDSIZ2N+6,AUTO
          2 0013F7  CBC7 0082                            LAB,B4   WRDSIZ2N+3,AUTO
          2 0013F9  CFC7 0083                            STB,B4   WRDSIZ2N+4,AUTO
          2 0013FB  BBC7 0083                            LAB,B3   WRDSIZ2N+4,AUTO
          2 0013FD  CBF0 0200                            LAB,B4   512,IMO
          2 0013FF  E380 0000 0000  xent                 LNJ,B6   KVB$RLSSYS
          2 001402       0001                            DC       s:31049,PREL

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:278  
     2302    31049    5                               KX$VC.CALPKT$ = ADDR(NIL);

  31049   2 001403  EB80 0000 0000                       LAB,B6   0
          2 001406  DCC7 0006                            LDB,B5   X29$,AUTO
          2 001408  EFC5 0026                            STB,B6   38,B5

     2303    31050    5                               KX$VC.CALMSGBYTSIZ = 0;

  31050   2 00140A  8745 0028                            CL       40,B5

     2304    31051    5                            END;

     2305    31052    4                   END;

  31052   2 00140C  0F81 0008                            B        s:31057,PREL

     2306    31053    3          CASE ( ELSE );

     2307    31054    3             VDOVLP_ERR.ERRCODE = UNK_VCFNC;

  31054   2 00140E  8C80 0000 0081  00                   LDI      UNK_VCFNC
          2 001411  8D47 0031                            SDI      VDOVLP_ERR+1,AUTO

     2308    31055    3             GOTO BAD_STATE;

  31055   2 001413  0F81 FC82                            B        s:30747,PREL

     2309    31056    3       END;  /* do case ( function ) */

     2310    31057    2       RETURN;

  31057   2 001415  ECC7 0060                            LDB,B6   CNC_TYP+1,AUTO
          2 001417  C3C6 0001                            LNJ,B4   1,B6

     2311    31058
     2312    31059    2   L_NOMEM:
     2313    31060    2       CALL KHD$SCREECH ( Y_NOMEM );
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:279  

  31060   2 001419  BB80 0000 001D  03   L_NOMEM         LAB,B3   +29
          2 00141C  CBF0 0100                            LAB,B4   256,IMO
          2 00141E  E380 0000 0000  xent                 LNJ,B6   KHD$SCREECH
          2 001421       0001                            DC       s:31060+9,PREL
          2 001422  0F81 008F                            B        s:31094,PREL

     2314    31061
     2315    31062    2   Y$BFROTP: PROC ALTRET;

  31062   2 001424  EFC7 0080            Y$BFROTP        STB,B6   WRDSIZ2N+1,AUTO

     2316    31063
     2317    31064    3       Y@BYTSIZ = FULPCKS + LENGTHC ( KX$VC_OTPBFR );

  31064   2 001426  E847 007E                            LDR,R6   FULPCKS,AUTO
          2 001428  6E0A                                 ADV,R6   10
          2 001429  EF47 002C                            STR,R6   Y@BYTSIZ,AUTO

     2318    31065    3       WRDSIZ2N = (Y@BYTSIZ+1)/2;

  31065   2 00142B  6E01                                 ADV,R6   1
          2 00142C  6041                                 SOR,R6   1
          2 00142D  EF47 007F                            STR,R6   WRDSIZ2N,AUTO

     2319    31066    4       CALL KVB$GET2NSYS ( WRDSIZ2N, DAT$ ) WHENALTRETURN DO;

  31066   2 00142F  DBC7 000A                            LAB,B5   DAT$,AUTO
          2 001431  DFC7 0084                            STB,B5   WRDSIZ2N+5,AUTO
          2 001433  CBC7 007F                            LAB,B4   WRDSIZ2N,AUTO
          2 001435  CFC7 0082                            STB,B4   WRDSIZ2N+3,AUTO
          2 001437  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 001439  CBF0 0200                            LAB,B4   512,IMO
          2 00143B  E380 0000 0000  xent                 LNJ,B6   KVB$GET2NSYS
          2 00143E       0003                            DC       s:31067,PREL
          2 00143F  0F81 0005                            B        s:31069,PREL

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:280  
     2320    31067    4                ALTRETURN;

  31067   2 001441  ECC7 0080                            LDB,B6   WRDSIZ2N+1,AUTO
          2 001443  B806                                 LDR,R3   ,B6
          2 001444  C3B6                                 LNJ,B4   ,B6,R3

     2321    31068    4             END;
     2322    31069    3       KX_STATS_X29.KHSTT.OTPBFRBYTUTL =

  31069   2 001445  F847 002C                            LDR,R7   Y@BYTSIZ,AUTO
          2 001447  6C00                                 LDV,R6   0
          2 001448  8400 0000 001E  xsym                 AID      KX_STATS_X29+30
          2 00144B  8D00 0000 001E  xsym                 SDI      KX_STATS_X29+30

     2323    31070    3          KX_STATS_X29.KHSTT.OTPBFRBYTUTL + Y@BYTSIZ;
     2324    31071    3       KX$VC_OTPBFR.RLSWRDSIZ = WRDSIZ2N;

  31071   2 00144E  ECC7 000A                            LDB,B6   DAT$,AUTO
          2 001450  D847 007F                            LDR,R5   WRDSIZ2N,AUTO
          2 001452  DF46 0004                            STR,R5   4,B6

     2325    31072    3       KX$VC.OTPBFRBYTCNT = KX$VC.OTPBFRBYTCNT + Y@BYTSIZ;

  31072   2 001454  ECC7 0006                            LDB,B6   X29$,AUTO
          2 001456  E846 0014                            LDR,R6   20,B6
          2 001458  EA47 002C                            ADD,R6   Y@BYTSIZ,AUTO
          2 00145A  EF46 0014                            STR,R6   20,B6

     2326    31073    3       KX$VC_OTPBFR.BFRBYTSIZ = Y@BYTSIZ;

  31073   2 00145C  D847 002C                            LDR,R5   Y@BYTSIZ,AUTO
          2 00145E  DCC7 000A                            LDB,B5   DAT$,AUTO
          2 001460  DAC5 0002                            SRM,R5,'3FFF'X    2,B5
          2 001462       3FFF

     2327    31074    3       KX$VC_OTPBFR.BYTX = Y@BYTSIZ;

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:281  
  31074   2 001463  ECC7 000A                            LDB,B6   DAT$,AUTO
          2 001465  DF46 0003                            STR,R5   3,B6

     2328    31075    3       KX$VC_OTPBFR.Q = %Y_VC_DAT.Q;

  31075   2 001467  E847 0062                            LDR,R6   Y_VC_CAL,AUTO
          2 001469  6008                                 SOL,R6   8
          2 00146A  ECC7 000A                            LDB,B6   DAT$,AUTO
          2 00146C  EAC6 0002                            SRM,R6,'8000'X    2,B6
          2 00146E       8000

     2329    31076    3       KX$VC_OTPBFR.M = %Y_VC_DAT.M;

  31076   2 00146F  E847 0062                            LDR,R6   Y_VC_CAL,AUTO
          2 001471  6008                                 SOL,R6   8
          2 001472  ECC7 000A                            LDB,B6   DAT$,AUTO
          2 001474  EAC6 0002                            SRM,R6,'4000'X    2,B6
          2 001476       4000

     2330    31077    3       IF FULPCKS > USR@DAT_BYTSIZ

  31077   2 001477  E847 007E                            LDR,R6   FULPCKS,AUTO
          2 001479  E947 007C                            CMR,R6   USR@DAT_BYTSIZ,AUTO
          2 00147B  0381 0005                            BLE      s:31080,PREL

     2331    31078    3          THEN
     2332    31079    3             FULPCKS = USR@DAT_BYTSIZ;

  31079   2 00147D  E847 007C                            LDR,R6   USR@DAT_BYTSIZ,AUTO
          2 00147F  EF47 007E                            STR,R6   FULPCKS,AUTO

     2333    31080    3       SUBSTR ( DAT$->B$STR, LENGTHC(KX$VC_OTPBFR), FULPCKS ) =

  31080   2 001481  ACC7 0079                            LDB,B2   USR@DAT_ADR$,AUTO
          2 001483  A847 007B                            LDR,R2   USR@DAT_BYTX,AUTO
          2 001485  BCC7 000A                            LDB,B3   DAT$,AUTO
          2 001487  3C0A                                 LDV,R3   10
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:282  
          2 001488  0008                                 MMM

     2334    31081    3          SUBSTR ( USR@DAT_ADR$->B$STR, USR@DAT_BYTX, FULPCKS );
     2335    31082    3       IF KX$VC.SND.HED$ = ADDR(NIL)

  31082   2 001489  ECC7 0006                            LDB,B6   X29$,AUTO
          2 00148B  8DC6 000C                            CMN      12,B6
          2 00148D  0981 0007                            BNE      s:31086,PREL

     2336    31083    3          THEN
     2337    31084    3             KX$VC.SND.HED$ = DAT$;

  31084   2 00148F  DCC7 000A                            LDB,B5   DAT$,AUTO
          2 001491  DFC6 000C                            STB,B5   12,B6
          2 001493  0F81 0006                            B        s:31087,PREL

     2338    31085    3          ELSE
     2339    31086    3             KX$VC.SND.TAL$->KX$VC_OTPBFR.LNK$ = DAT$;

  31086   2 001495  DCC6 0010                            LDB,B5   16,B6
          2 001497  CCC7 000A                            LDB,B4   DAT$,AUTO
          2 001499  CF85                                 STB,B4   ,B5

     2340    31087    3       KX$VC.SND.TAL$ = DAT$;

  31087   2 00149A  ECC7 000A                            LDB,B6   DAT$,AUTO
          2 00149C  DCC7 0006                            LDB,B5   X29$,AUTO
          2 00149E  EFC5 0010                            STB,B6   16,B5

     2341    31088    3       KX$VC_OTPBFR.LNK$ = ADDR(NIL);

  31088   2 0014A0  CB80 0000 0000                       LAB,B4   0
          2 0014A3  CF86                                 STB,B4   ,B6

     2342    31089    3       IF KX$VC.SND.NXTLOD$ = ADDR(NIL)

  31089   2 0014A4  ECC7 0006                            LDB,B6   X29$,AUTO
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:283  
          2 0014A6  8DC6 000E                            CMN      14,B6
          2 0014A8  0981 0005                            BNE      s:31093,PREL

     2343    31090    3          THEN
     2344    31091    3             KX$VC.SND.NXTLOD$ = DAT$;

  31091   2 0014AA  DCC7 000A                            LDB,B5   DAT$,AUTO
          2 0014AC  DFC6 000E                            STB,B5   14,B6

     2345    31092
     2346    31093    3   END Y$BFROTP;

  31093   2 0014AE  ECC7 0080                            LDB,B6   WRDSIZ2N+1,AUTO
          2 0014B0  C3C6 0001                            LNJ,B4   1,B6

     2347    31094    2   END Y$DECODE_FPT;

  31094   2 0014B2  ECC7 0060                            LDB,B6   CNC_TYP+1,AUTO
          2 0014B4  C3C6 0001                            LNJ,B4   1,B6

     2348    31095        %EJECT;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:284  
     2349    31096
     2350    31097    1   Y$CHKPNDBITS: PROC;

  31097   2 0014B6  EFC7 0060            Y$CHKPNDBITS    STB,B6   CNC_TYP+1,AUTO

     2351    31098        %VC$CAL ( STCLASS = BASED );
     2352    31144        /*
     2353    31145           We have a chance to send queued input to the HOST.
     2354    31146        */
     2355    31147    2       KV@SND_DAT = KX_SND_DAT;

  31147   2 0014B8  AB80 0000 0000  xsym                 LAB,B2   KX_SND_DAT
          2 0014BB  2C00                                 LDV,R2   0
          2 0014BC  6C14                                 LDV,R6   20
          2 0014BD  BBC7 0055                            LAB,B3   KV@SND_DAT,AUTO
          2 0014BF  3C00                                 LDV,R3   0
          2 0014C0  0008                                 MMM

     2356    31148    2       IF KX$VC.CALINDPND AND %KV_VDI.USRRQSDAT.RED

  31148   2 0014C1  ECC7 0006                            LDB,B6   X29$,AUTO
          2 0014C3  82C6 0016                            LB,'1000'X        22,B6
          2 0014C5       1000
          2 0014C6  0581 0025                            BBF      s:31159,PREL
          2 0014C8  DCC7 0008                            LDB,B5   VDI$,AUTO
          2 0014CA  82C5 001D                            LB,'0010'X        29,B5
          2 0014CC       0010
          2 0014CD  0581 001E                            BBF      s:31159,PREL

     2357    31149    2          THEN
     2358    31150    3             DO;

     2359    31151    3                KX_VDOVLPARY.VDOVLP.KEY$ = ADDR(KX_KEY_CAL_IND);

  31151   2 0014CF  CB80 0000 0000  xsym                 LAB,B4   KX_KEY_CAL_IND
          2 0014D2  CF80 0000 000A  xsym                 STB,B4   KX_VDOVLPARY+10

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:285  
     2360    31152    3                KV@SND_DAT.DAT__.ADR$ = KX$VC.CALPKT$;

  31152   2 0014D5  BCC6 0026                            LDB,B3   38,B6
          2 0014D7  BFC7 0056                            STB,B3   KV@SND_DAT+1,AUTO

     2361    31153    3                KV@SND_DAT.DAT__.DATBYTSIZ = KX$VC.CALMSGBYTSIZ;

  31153   2 0014D9  E846 0028                            LDR,R6   40,B6
          2 0014DB  EF47 0059                            STR,R6   KV@SND_DAT+4,AUTO

     2362    31154    3                CALL Y$SNDDAT ALTRET (L_RETURN);

  31154   2 0014DD  E3C0 019B                            LNJ,B6   s:0,PREL
          2 0014DF       0196                            DC       s:31256,PREL

     2363    31155    3                KX$VC.CALINDPND = '0'B;

  31155   2 0014E0  ECC7 0006                            LDB,B6   X29$,AUTO
          2 0014E2  8846 0016                            LBF,'1000'X       22,B6
          2 0014E4       1000

     2364    31156    3                KX$VC.CALPKT$ = ADDR(NIL);

  31156   2 0014E5  DB80 0000 0000                       LAB,B5   0
          2 0014E8  DFC6 0026                            STB,B5   38,B6

     2365    31157    3                KX$VC.CALMSGBYTSIZ = 0;

  31157   2 0014EA  8746 0028                            CL       40,B6

     2366    31158    3             END;

     2367    31159    2       IF KX$VC.CALCNFPND AND %KV_VDI.USRRQSDAT.RED

  31159   2 0014EC  82C6 0016                            LB,'0800'X        22,B6
  31159   2 0014EE       0800
          2 0014EF  0581 0031                            BBF      s:31174,PREL
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:286  
          2 0014F1  DCC7 0008                            LDB,B5   VDI$,AUTO
          2 0014F3  82C5 001D                            LB,'0010'X        29,B5
          2 0014F5       0010
          2 0014F6  0581 002A                            BBF      s:31174,PREL

     2368    31160    2          THEN
     2369    31161    3             DO;

     2370    31162    3                IF KX$VC.CALPKT$->VC$CAL.FUNCTION = %KX_VCFNC_CAL_CNF#

  31162   2 0014F8  CCC6 0026                            LDB,B4   38,B6
          2 0014FA  E284                                 LLH,R6   ,B4
          2 0014FB  6D04                                 CMV,R6   4
          2 0014FC  0981 0009                            BNE      s:31166,PREL

     2371    31163    3                   THEN
     2372    31164    3                      KX_VDOVLPARY.VDOVLP.KEY$ = ADDR(KX_KEY_CAL_CNF);

  31164   2 0014FE  BB80 0000 0000  xsym                 LAB,B3   KX_KEY_CAL_CNF
          2 001501  BF80 0000 000A  xsym                 STB,B3   KX_VDOVLPARY+10
          2 001504  0F81 0007                            B        s:31167,PREL

     2373    31165    3                   ELSE
     2374    31166    3                      KX_VDOVLPARY.VDOVLP.KEY$ = ADDR(KX_KEY_INDX3);

  31166   2 001506  BB80 0000 0000  xsym                 LAB,B3   KX_KEY_INDX3
          2 001509  BF80 0000 000A  xsym                 STB,B3   KX_VDOVLPARY+10

     2375    31167    3                KV@SND_DAT.DAT__.ADR$ = KX$VC.CALPKT$;

  31167   2 00150C  CFC7 0056                            STB,B4   KV@SND_DAT+1,AUTO

     2376    31168    3                KV@SND_DAT.DAT__.DATBYTSIZ = KX$VC.CALMSGBYTSIZ;

  31168   2 00150E  E846 0028                            LDR,R6   40,B6
          2 001510  EF47 0059                            STR,R6   KV@SND_DAT+4,AUTO

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:287  
     2377    31169    3                CALL Y$SNDDAT ALTRET (L_RETURN);

  31169   2 001512  E3C0 0166                            LNJ,B6   s:0,PREL
          2 001514       0161                            DC       s:31256,PREL

     2378    31170    3                KX$VC.CALCNFPND = '0'B;

  31170   2 001515  ECC7 0006                            LDB,B6   X29$,AUTO
          2 001517  8846 0016                            LBF,'0800'X       22,B6
          2 001519       0800

     2379    31171    3                KX$VC.CALPKT$ = ADDR(NIL);

  31171   2 00151A  DB80 0000 0000                       LAB,B5   0
          2 00151D  DFC6 0026                            STB,B5   38,B6

     2380    31172    3                KX$VC.CALMSGBYTSIZ = 0;

  31172   2 00151F  8746 0028                            CL       40,B6

     2381    31173    3             END;

     2382    31174    2       IF KX$VC.INTINDPND AND %KV_VDI.USRRQSDAT.RED

  31174   2 001521  82C6 0016                            LB,'0400'X        22,B6
  31174   2 001523       0400
          2 001524  0581 0025                            BBF      s:31185,PREL
          2 001526  DCC7 0008                            LDB,B5   VDI$,AUTO
          2 001528  82C5 001D                            LB,'0010'X        29,B5
          2 00152A       0010
          2 00152B  0581 001E                            BBF      s:31185,PREL

     2383    31175    2          THEN
     2384    31176    3             DO;

     2385    31177    3                KX_VDOVLPARY.VDOVLP.KEY$ = ADDR(KX_KEY_INT_IND);

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:288  
  31177   2 00152D  CB80 0000 0000  xsym                 LAB,B4   KX_KEY_INT_IND
          2 001530  CF80 0000 000A  xsym                 STB,B4   KX_VDOVLPARY+10

     2386    31178    3                KV@SND_DAT.DAT__.ADR$ = KX$VC.INTPKT$;

  31178   2 001533  BCC6 002C                            LDB,B3   44,B6
          2 001535  BFC7 0056                            STB,B3   KV@SND_DAT+1,AUTO

     2387    31179    3                KV@SND_DAT.DAT__.DATBYTSIZ = KX$VC.INTMSGBYTSIZ;

  31179   2 001537  E846 002E                            LDR,R6   46,B6
          2 001539  EF47 0059                            STR,R6   KV@SND_DAT+4,AUTO

     2388    31180    3                CALL Y$SNDDAT ALTRET (L_RETURN);

  31180   2 00153B  E3C0 013D                            LNJ,B6   s:0,PREL
          2 00153D       0138                            DC       s:31256,PREL

     2389    31181    3                KX$VC.INTINDPND = '0'B;

  31181   2 00153E  ECC7 0006                            LDB,B6   X29$,AUTO
          2 001540  8846 0016                            LBF,'0400'X       22,B6
          2 001542       0400

     2390    31182    3                KX$VC.INTPKT$ = ADDR(NIL);

  31182   2 001543  DB80 0000 0000                       LAB,B5   0
          2 001546  DFC6 002C                            STB,B5   44,B6

     2391    31183    3                KX$VC.INTMSGBYTSIZ = 0;

  31183   2 001548  8746 002E                            CL       46,B6

     2392    31184    3             END;

     2393    31185    2       IF KX$VC.INTCNFPND AND %KV_VDI.USRRQSDAT.RED

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:289  
  31185   2 00154A  82C6 0016                            LB,'0200'X        22,B6
  31185   2 00154C       0200
          2 00154D  0581 002B                            BBF      s:31195,PREL
          2 00154F  DCC7 0008                            LDB,B5   VDI$,AUTO
          2 001551  82C5 001D                            LB,'0010'X        29,B5
          2 001553       0010
          2 001554  0581 0024                            BBF      s:31195,PREL

     2394    31186    2          THEN
     2395    31187    3             DO;

     2396    31188    3                KX_VDOVLPARY.VDOVLP.KEY$ = ADDR(KX_KEY_INT_CNF);

  31188   2 001556  CB80 0000 0000  xsym                 LAB,B4   KX_KEY_INT_CNF
          2 001559  CF80 0000 000A  xsym                 STB,B4   KX_VDOVLPARY+10

     2397    31189    3                VC_INT.FUNCTION = %KX_VCFNC_INT_CNF#;

  31189   2 00155C  6C09                                 LDV,R6   9
          2 00155D  E780 0000 0000  xsym                 STH,R6   VC_INT

     2398    31190    3                KV@SND_DAT.DAT__.ADR$ = ADDR(VC_INT);

  31190   2 001560  BB80 0000 0000  xsym                 LAB,B3   VC_INT
          2 001563  BFC7 0056                            STB,B3   KV@SND_DAT+1,AUTO

     2399    31191    3                KV@SND_DAT.DAT__.DATBYTSIZ = LENGTHC(VC_INT);

  31191   2 001565  5C02                                 LDV,R5   2
          2 001566  DF47 0059                            STR,R5   KV@SND_DAT+4,AUTO

     2400    31192    3                CALL KVV$VDI ( KV@SND_DAT ) ALTRET (L_RETURN);

  31192   2 001568  ABC7 0055                            LAB,B2   KV@SND_DAT,AUTO
          2 00156A  AFC7 0082                            STB,B2   WRDSIZ2N+3,AUTO
          2 00156C  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 00156E  CBF0 0100                            LAB,B4   256,IMO
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:290  
          2 001570  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          2 001573       0102                            DC       s:31256,PREL

     2401    31193    3                KX$VC.INTCNFPND = '0'B;

  31193   2 001574  ECC7 0006                            LDB,B6   X29$,AUTO
          2 001576  8846 0016                            LBF,'0200'X       22,B6
          2 001578       0200

     2402    31194    3             END;

     2403    31195    2       IF KX$VC.RSTINDPND AND %KV_VDI.USRRQSDAT.RED

  31195   2 001579  82C6 0016                            LB,'0100'X        22,B6
  31195   2 00157B       0100
          2 00157C  0581 0036                            BBF      s:31207,PREL
          2 00157E  DCC7 0008                            LDB,B5   VDI$,AUTO
          2 001580  82C5 001D                            LB,'0010'X        29,B5
          2 001582       0010
          2 001583  0581 002F                            BBF      s:31207,PREL

     2404    31196    2          THEN
     2405    31197    3             DO;

     2406    31198    3                KX_VDOVLPARY.VDOVLP.KEY$ = ADDR(KX_KEY_RST_IND);

  31198   2 001585  CB80 0000 0000  xsym                 LAB,B4   KX_KEY_RST_IND
          2 001588  CF80 0000 000A  xsym                 STB,B4   KX_VDOVLPARY+10

     2407    31199    3                VC_RST.FUNCTION = %KX_VCFNC_RST_IND#;

  31199   2 00158B  6C0B                                 LDV,R6   11
          2 00158C  E780 0000 0000  xsym                 STH,R6   VC_RST

     2408    31200    3                VC_RST.CAUSE = KX$VC.RST_CAUSE;

  31200   2 00158F  D846 0024                            LDR,R5   36,B6
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:291  
          2 001591  DA80 0000 0000  xsym                 SRM,R5,'00FF'X    VC_RST
          2 001594       00FF

     2409    31201    3                VC_RST.DIAG = KX$VC.RST_DIAG;

  31201   2 001595  C2C6 0025                            LLH,R4   37,B6
          2 001597  C780 0000 0001  xsym                 STH,R4   VC_RST+1

     2410    31202    3                KV@SND_DAT.DAT__.ADR$ = ADDR(VC_RST);

  31202   2 00159A  BB80 0000 0000  xsym                 LAB,B3   VC_RST
          2 00159D  BFC7 0056                            STB,B3   KV@SND_DAT+1,AUTO

     2411    31203    3                KV@SND_DAT.DAT__.DATBYTSIZ = LENGTHC(VC_RST);

  31203   2 00159F  5C03                                 LDV,R5   3
          2 0015A0  DF47 0059                            STR,R5   KV@SND_DAT+4,AUTO

     2412    31204    3                CALL KVV$VDI ( KV@SND_DAT ) ALTRET (L_RETURN);

  31204   2 0015A2  ABC7 0055                            LAB,B2   KV@SND_DAT,AUTO
          2 0015A4  AFC7 0082                            STB,B2   WRDSIZ2N+3,AUTO
          2 0015A6  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 0015A8  CBF0 0100                            LAB,B4   256,IMO
          2 0015AA  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          2 0015AD       00C8                            DC       s:31256,PREL

     2413    31205    3                KX$VC.RSTINDPND = '0'B;

  31205   2 0015AE  ECC7 0006                            LDB,B6   X29$,AUTO
          2 0015B0  8846 0016                            LBF,'0100'X       22,B6
          2 0015B2       0100

     2414    31206    3             END;

     2415    31207    2       IF KX$VC.RSTCNFPND AND %KV_VDI.USRRQSDAT.RED

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:292  
  31207   2 0015B3  82C6 0016                            LB,'0080'X        22,B6
  31207   2 0015B5       0080
          2 0015B6  0581 002B                            BBF      s:31217,PREL
          2 0015B8  DCC7 0008                            LDB,B5   VDI$,AUTO
          2 0015BA  82C5 001D                            LB,'0010'X        29,B5
          2 0015BC       0010
          2 0015BD  0581 0024                            BBF      s:31217,PREL

     2416    31208    2          THEN
     2417    31209    3             DO;

     2418    31210    3                KX_VDOVLPARY.VDOVLP.KEY$ = ADDR(KX_KEY_RST_CNF);

  31210   2 0015BF  CB80 0000 0000  xsym                 LAB,B4   KX_KEY_RST_CNF
          2 0015C2  CF80 0000 000A  xsym                 STB,B4   KX_VDOVLPARY+10

     2419    31211    3                VC_RST.FUNCTION = %KX_VCFNC_RST_CNF#;

  31211   2 0015C5  6C0C                                 LDV,R6   12
          2 0015C6  E780 0000 0000  xsym                 STH,R6   VC_RST

     2420    31212    3                KV@SND_DAT.DAT__.ADR$ = ADDR(VC_RST);

  31212   2 0015C9  BB80 0000 0000  xsym                 LAB,B3   VC_RST
          2 0015CC  BFC7 0056                            STB,B3   KV@SND_DAT+1,AUTO

     2421    31213    3                KV@SND_DAT.DAT__.DATBYTSIZ = LENGTHC(VC_RST);

  31213   2 0015CE  5C03                                 LDV,R5   3
          2 0015CF  DF47 0059                            STR,R5   KV@SND_DAT+4,AUTO

     2422    31214    3                CALL KVV$VDI ( KV@SND_DAT ) ALTRET (L_RETURN);

  31214   2 0015D1  ABC7 0055                            LAB,B2   KV@SND_DAT,AUTO
          2 0015D3  AFC7 0082                            STB,B2   WRDSIZ2N+3,AUTO
          2 0015D5  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 0015D7  CBF0 0100                            LAB,B4   256,IMO
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:293  
          2 0015D9  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          2 0015DC       0099                            DC       s:31256,PREL

     2423    31215    3                KX$VC.RSTCNFPND = '0'B;

  31215   2 0015DD  ECC7 0006                            LDB,B6   X29$,AUTO
          2 0015DF  8846 0016                            LBF,'0080'X       22,B6
          2 0015E1       0080

     2424    31216    3             END;

     2425    31217    2       IF KX$VC.CLRINDPND AND %KV_VDI.USRRQSDAT.RED

  31217   2 0015E2  82C6 0016                            LB,'0040'X        22,B6
  31217   2 0015E4       0040
          2 0015E5  0581 0025                            BBF      s:31228,PREL
          2 0015E7  DCC7 0008                            LDB,B5   VDI$,AUTO
          2 0015E9  82C5 001D                            LB,'0010'X        29,B5
          2 0015EB       0010
          2 0015EC  0581 001E                            BBF      s:31228,PREL

     2426    31218    2          THEN
     2427    31219    3             DO;

     2428    31220    3                KX_VDOVLPARY.VDOVLP.KEY$ = ADDR(KX_KEY_CLR_IND);

  31220   2 0015EE  CB80 0000 0000  xsym                 LAB,B4   KX_KEY_CLR_IND
          2 0015F1  CF80 0000 000A  xsym                 STB,B4   KX_VDOVLPARY+10

     2429    31221    3                KV@SND_DAT.DAT__.ADR$ = KX$VC.CLRPKT$;

  31221   2 0015F4  BCC6 0029                            LDB,B3   41,B6
          2 0015F6  BFC7 0056                            STB,B3   KV@SND_DAT+1,AUTO

     2430    31222    3                KV@SND_DAT.DAT__.DATBYTSIZ = KX$VC.CLRMSGBYTSIZ;

  31222   2 0015F8  E846 002B                            LDR,R6   43,B6
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:294  
          2 0015FA  EF47 0059                            STR,R6   KV@SND_DAT+4,AUTO

     2431    31223    3                CALL Y$SNDDAT ALTRET (L_RETURN);

  31223   2 0015FC  E3C0 007C                            LNJ,B6   s:0,PREL
          2 0015FE       0077                            DC       s:31256,PREL

     2432    31224    3                KX$VC.CLRINDPND = '0'B;

  31224   2 0015FF  ECC7 0006                            LDB,B6   X29$,AUTO
          2 001601  8846 0016                            LBF,'0040'X       22,B6
          2 001603       0040

     2433    31225    3                KX$VC.CLRPKT$ = ADDR(NIL);

  31225   2 001604  DB80 0000 0000                       LAB,B5   0
          2 001607  DFC6 0029                            STB,B5   41,B6

     2434    31226    3                KX$VC.CLRMSGBYTSIZ = 0;

  31226   2 001609  8746 002B                            CL       43,B6

     2435    31227    3             END;

     2436    31228    2       IF KX$VC.L3$ = ADDR(NIL)

  31228   2 00160B  8DC6 0006                            CMN      6,B6
          2 00160D  0901 0067                            BE       s:31256,PREL

     2437    31229    2          THEN
     2438    31230    2             GOTO L_RETURN;
     2439    31231    2       CALL_FPT = '0'B;

  31231   2 00160F  5C20                                 LDV,R5   32
          2 001610  0021                                 ALR      ;
          2 001611       4178 0000                                ALPHANUM('0000'X,IMO,,1),;
          2 001613       4007 001A                                ALPHANUM(CALL_FPT,AUTO,,R5,FILL)
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:295  

     2440    31232    2       CALL_FPT.CAL$ = VC$;

  31232   2 001615  437F                                 CSYNC    s:31231+5,SPREL
          2 001616  EFC7 001B                            STB,B6   CALL_FPT+1,AUTO

     2441    31233    2       CALL_FPT.RCV$ = KX$VC.L3$;

  31233   2 001618  DCC6 0006                            LDB,B5   6,B6
          2 00161A  DFC7 001D                            STB,B5   CALL_FPT+3,AUTO

     2442    31234    2       IF KX$VC.BLK_L3

  31234   2 00161C  82C6 0016                            LB,'4000'X        22,B6
  31234   2 00161E       4000
          2 00161F  0581 0024                            BBF      s:31248,PREL

     2443    31235    2          THEN
     2444    31236    3             DO;

     2445    31237    3                IF %KV_VDI.USRRQSDAT.RED

  31237   2 001621  CCC7 0008                            LDB,B4   VDI$,AUTO
          2 001623  82C4 001D                            LB,'0010'X        29,B4
          2 001625       0010
          2 001626  0581 001D                            BBF      s:31248,PREL

     2446    31238    3                   THEN
     2447    31239    4                      DO;

     2448    31240    4                         KX$VC.BLK_L3 = '0'B;

  31240   2 001628  8846 0016                            LBF,'4000'X       22,B6
  31240   2 00162A       4000

     2449    31241    4                         CALL_FPT.EVN = %KX_P_EV_REDRQS#;

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:296  
  31241   2 00162B  6C15                                 LDV,R6   21
          2 00162C  EF47 001A                            STR,R6   CALL_FPT,AUTO

     2450    31242    4                         CALL KXP$PACKET ( CALL_FPT ) WHENALTRETURN

  31242   2 00162E  DBC7 001A                            LAB,B5   CALL_FPT,AUTO
          2 001630  DFC7 0082                            STB,B5   WRDSIZ2N+3,AUTO
          2 001632  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 001634  CBF0 0100                            LAB,B4   256,IMO
          2 001636  E380 0000 0000  xent                 LNJ,B6   KXP$PACKET
          2 001639       0003                            DC       s:31243,PREL
          2 00163A  0F81 0009                            B        s:31248,PREL

     2451    31243    5                               DO;

     2452    31244    5   L_KXPALT2:                     CALL KHD$SCREECH ( CALL_FPT.PRM1$->B$SCODE );

  31244   2 00163C  BBC7 0021            L_KXPALT2       LAB,B3   CALL_FPT+7,AUTO
          2 00163E  CBF0 0100                            LAB,B4   256,IMO
          2 001640  E380 0000 0000  xent                 LNJ,B6   KHD$SCREECH
          2 001643       0001                            DC       s:31248,PREL

     2453    31245    5                               END;

     2454    31246    4                      END;

     2455    31247    3             END;

     2456    31248    2       IF KX$VC.INV2CLR AND NOT KX$VC.BLK_L3

  31248   2 001644  ECC7 0006                            LDB,B6   X29$,AUTO
          2 001646  82C6 0016                            LB,'0008'X        22,B6
          2 001648       0008
          2 001649  0581 002B                            BBF      s:31256,PREL
          2 00164B  82C6 0016                            LB,'4000'X        22,B6
          2 00164D       4000
          2 00164E  0501 0026                            BBT      s:31256,PREL
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:297  

     2457    31249    2          THEN
     2458    31250    3             DO;

     2459    31251    3                KV@VDH_DSC = KXX_VDH_DSC;

  31251   2 001650  8C80 0000 0000  xsym                 LDI      KXX_VDH_DSC
          2 001653  8D47 003F                            SDI      KV@VDH_DSC,AUTO

     2460    31252    3                CALL KVV$VDI ( KV@VDH_DSC );

  31252   2 001655  DBC7 003F                            LAB,B5   KV@VDH_DSC,AUTO
          2 001657  DFC7 0082                            STB,B5   WRDSIZ2N+3,AUTO
          2 001659  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 00165B  CBF0 0100                            LAB,B4   256,IMO
          2 00165D  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          2 001660       0001                            DC       s:31253,PREL

     2461    31253    3                CALL_FPT.EVN = %KX_P_EV_VCLST#;

  31253   2 001661  6C09                                 LDV,R6   9
          2 001662  EF47 001A                            STR,R6   CALL_FPT,AUTO

     2462    31254    3                CALL KXP$PACKET ( CALL_FPT ) ALTRET ( L_KXPALT2 );

  31254   2 001664  EBC7 001A                            LAB,B6   CALL_FPT,AUTO
          2 001666  EFC7 0082                            STB,B6   WRDSIZ2N+3,AUTO
          2 001668  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 00166A  CBF0 0100                            LAB,B4   256,IMO
          2 00166C  E380 0000 0000  xent                 LNJ,B6   KXP$PACKET
          2 00166F       FFCD                            DC       s:31243,PREL

     2463    31255    3                KX$VC.STATE = %KX_VC_ST_BGNPHSDSC#;

  31255   2 001670  6C07                                 LDV,R6   7
          2 001671  ECC7 0006                            LDB,B6   X29$,AUTO
          2 001673  E7C6 0033                            STH,R6   51,B6
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:298  

     2464    31256    3             END;

  31248   2                              L_RETURN        null
     2465    31257    2   L_RETURN: ;
     2466    31258    2       RETURN;

  31258   2 001675  ECC7 0060            L_RETURN        LDB,B6   CNC_TYP+1,AUTO
          2 001677  C3C6 0001                            LNJ,B4   1,B6

     2467    31259
     2468    31260    2   Y$SNDDAT: PROC ALTRET;

  31260   2 001679  EFC7 0062            Y$SNDDAT        STB,B6   Y_VC_CAL,AUTO

     2469    31261    3   DCL KVBSIZ UBIN ALIGNED BASED(KV@SND_DAT.DAT__.ADR$);
     2470    31262
     2471    31263    3       CALL KVV$VDI ( KV@SND_DAT )

  31263   2 00167B  DBC7 0055                            LAB,B5   KV@SND_DAT,AUTO
          2 00167D  DFC7 0082                            STB,B5   WRDSIZ2N+3,AUTO
          2 00167F  BBC7 0082                            LAB,B3   WRDSIZ2N+3,AUTO
          2 001681  CBF0 0100                            LAB,B4   256,IMO
          2 001683  E380 0000 0000  xent                 LNJ,B6   KVV$VDI
          2 001686       0003                            DC       s:31266,PREL
          2 001687  0F81 0005                            B        s:31268,PREL

     2472    31264    3          WHENALTRETURN
     2473    31265    4             DO;

     2474    31266    4                ALTRETURN;

  31266   2 001689  ECC7 0062                            LDB,B6   Y_VC_CAL,AUTO
          2 00168B  B806                                 LDR,R3   ,B6
          2 00168C  C3B6                                 LNJ,B4   ,B6,R3

     2475    31267    4             END;
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:299  
     2476    31268    3       KVBSIZ = (KV@SND_DAT.DAT__.DATBYTSIZ+1)/2;

  31268   2 00168D  E847 0059                            LDR,R6   KV@SND_DAT+4,AUTO
          2 00168F  6E01                                 ADV,R6   1
          2 001690  6041                                 SOR,R6   1
          2 001691  ECC7 0056                            LDB,B6   KV@SND_DAT+1,AUTO
          2 001693  EF06                                 STR,R6   ,B6

     2477    31269    3       CALL KVB$RLSSYS ( KVBSIZ );

  31269   2 001694  BBC7 0056                            LAB,B3   KV@SND_DAT+1,AUTO
          2 001696  CBF0 0100                            LAB,B4   256,IMO
          2 001698  E380 0000 0000  xent                 LNJ,B6   KVB$RLSSYS
          2 00169B       0001                            DC       s:31271,PREL

     2478    31270
     2479    31271    3   END Y$SNDDAT;

  31271   2 00169C  ECC7 0062                            LDB,B6   Y_VC_CAL,AUTO
          2 00169E  C3C6 0001                            LNJ,B4   1,B6
     2480    31272    2   END Y$CHKPNDBITS;
     2481    31273
     2482    31274    1   END KXX$VDI;

PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:300  
--  Include file information  --

   KNH_MACRO_C.:E05TOU  is referenced.
   K_ADDRESS_M.:E05TOU  is referenced.
   KH_MACRO_C.:E05TOU  is referenced.
   KH_CHN.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   KV$VDH.:E05TOU  is referenced.
   KV$USR.:E05TOU  is referenced.
   KA_GLB.:E05TOU  is referenced.
   KA_GLB_E.:E05TOU  is referenced.
   KA_GLBASM_E.:E05TOU  is referenced.
   KV_GLB_M.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  is referenced.
   K_ID_E.:E05TOU  is referenced.
   KL_SUPER_C.:E05TOU  is referenced.
   KL_CONTROL_C.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   KX_SCODE_C.:E05TOU  is referenced.
   KX_DATA_C.:E05TOU  is referenced.
   KX_PERR_C.:E05TOU  is referenced.
   KX_EQUS_E.:E05TOU  is referenced.
   KXX_MACROS_M.:E05TOU  is referenced.
   KX_MACROS_M.:E05TOU  is referenced.
   KV$GLBCTX.:E05TOU  is referenced.
   KV$GLB.:E05TOU  is referenced.
   KV_INT_M.:E05TOU  is referenced.
   KV$INT.:E05TOU  is referenced.
   KH$STT.:E05TOU  is referenced.
   KV_GLBCNS_E.:E05TOU  is referenced.
   KV_GLBASM_E.:E05TOU  is referenced.
   KV_ASCCHR_E.:E05TOU  is referenced.
   KV$SND.:E05TOU  is referenced.
   KV_ERRORS_C.:E05TOU  is referenced.
   KV$VDO.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:301  
   G_JIT_M.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure KXX$VDI.
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:302  

 **** Variables and constants ****

  ****  Section 000 RoData KXX$VDI

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

    7F-0-0/w STRC(32)    r     1 BAD_VCSTT                  0-0-0/w STRC(728)   r     1 KV_ERD
    40-0-0/w STRC(824)   r     1 KX_VC                     74-0-0/w STRC(48)    r     1 KX_VDOVLP_ERR
    79-0-0/w STRC(32)    r     1 LGNRJC                    77-0-0/w STRC(32)    r     1 LINERRDSC
    7D-0-0/w STRC(32)    r     1 NOT_X28                   83-0-0/w STRC(32)    r     1 NO_L3CTX
    81-0-0/w STRC(32)    r     1 UNK_VCFNC                 3E-0-0/c STRC(32)    r     1 X28_PRTID
    9A-0-0/w STRC(48)    r     1 Y_ILGDATSIZ               97-0-0/w STRC(48)    r     1 Y_LINKDEVSTT
    9D-0-0/w STRC(48)    r     1 Y_NOMEM                   94-0-0/w STRC(48)    r     1 Y_NO_GET
    2E-0-0/w UBIN(16)    r     1 Y_POWER_OF_2(0:15)
    8B-0-0/w STRC(48)    r     1 Y_UNKINPPRC               8E-0-0/w STRC(48)    r     1 Y_UNKPRMID
    85-0-0/w STRC(48)    r     1 Y_UNKSCHRSN               91-0-0/w STRC(48)    r     1 Y_UNKUSRFNC
    88-0-0/w STRC(48)    r     1 Y_UNKVDIEVT

  ****  Section 001  Data  KXX$VDI

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     2-0-0/w UBIN(16)    r     1 KA_OTPBFRLMTEXC            0-0-0/w STRC(32)    r     1 KV_USR_GETOTPBFR

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

    62-0-0/w PTR         r     1 @PARM                      4-0-0/w PTR         r     1 @PRM_USR_X
    1A-0-0/w STRC(256)   r     1 CALL_FPT                  17-0-0/w UBIN(16)    r     1 CHRCNT
    5F-0-0/w UBIN(16)    r     1 CNC_TYP                    6-0-0/w PTR         r     1 CNTL$
     A-0-0/w PTR         r     1 DAT$                      2E-0-0/w STRC(32)    r     1 ERCOD
    2A-0-0/w UBIN(16)    r     1 FLWCTRPAD                 7E-0-0/w UBIN(16)    r     1 FULPCKS
    55-0-0/w STRC(160)   r     1 KV@SND_DAT                4D-0-0/w STRC(128)   r     1 KV@VDH_DAT
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:303  
    3F-0-0/w STRC(32)    r     1 KV@VDH_DSC                41-0-0/w STRC(80)    r     1 KV@VDH_OTPLCL
    46-0-0/w STRC(80)    r     1 KV@VDH_OTPMRK             4B-0-0/w STRC(32)    r     1 KV@VDH_SETCLK
    12-0-0/w PTR         r     1 L3$                       34-0-0/w UBIN(16)    r     1 LEVEL
    2B-0-0/w UBIN(16)    r     1 PADECHO                   *0-0-0/w UBIN(16)    r     1 PARM
    64-0-0/w UBIN(16)    r     1 PARM1                     7D-0-0/w UBIN(16)    r     1 PCKSIZ
    *0-0-0/w UBIN(16)    r     1 PRM_COPY                  *0-0-0/w STRC(128)   r     1 PRM_USR_DAT
    *0-0-0/w STRC(32)    r     1 PRM_USR_EVT               *0-0-0/w STRC(32)    r     1 PRM_USR_EXTINPTRN
    *0-0-0/w STRC(32)    r     1 PRM_USR_GETOTPBFR         *0-0-0/w STRC(48)    r     1 PRM_USR_INPPRC
    *0-0-0/w STRC(64)    r     1 PRM_USR_OTPMRK            *0-0-0/w STRC(128)   r     1 PRM_USR_SETPRM
    *0-0-0/w ACHR        r     1 PRM_USR_X                 18-0-0/w PTR         r     1 PRTTBL$
     E-0-0/w PTR         r     1 PRV$                       C-0-0/w PTR         r     1 TEMP$
    33-0-0/w UBIN(16)    r     1 TEMP0                     10-0-0/w PTR         r     1 TEMP1$
    14-0-0/w PTR         r     1 TL3$                      79-0-0/w PTR         r     1 USR@DAT_ADR$
    7C-0-0/w UBIN(16)    r     1 USR@DAT_BYTSIZ            7B-0-0/w UBIN(16)    r     1 USR@DAT_BYTX
     6-0-0/w PTR         r     1 VC$                        8-0-0/w PTR         r     1 VDI$
    30-0-0/w STRC(48)    r     1 VDOVLP_ERR                7F-0-0/w UBIN(16)    r     1 WRDSIZ2N
     6-0-0/w PTR         r     1 X29$                      2C-0-0/w UBIN(16)    r     1 Y@BYTSIZ
    2D-0-0/w UBIN(16)    r     1 Y@BYTSIZ2                 37-0-0/b BIT (8)     r     1 Y@HLTOTP_ALL
    16-0-0/w SBIN(16)    r     1 Y@INDEX                   62-0-0/w STRC(368)   r     1 Y_VC_CAL
    38-0-0/w STRC(112)   r     1 Y_VDI_LCL

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(32)    r     1 DEVLGNFAL                  0-0-0/w PTR         r     1 G$JIT$
     0-0-0/w UBIN(8)     r     1 KA_DVCFLWCTRCHR(0:3)
     0-0-0/w UBIN(16)    r     1 KA_LINERRDSCLMT            0-0-0/w UBIN(16)    r     1 KA_LINERRLOGLMT
     0-0-0/w UBIN(16)    r     1 KA_MINSP_FORPST(0:15)
     0-0-0/w UBIN(16)    r     1 KA_OTPBFRBYTSIZ_BIG
     0-0-0/w UBIN(16)    r     1 KA_OTPBFRBYTSIZ_BIGLOG2
     0-0-0/w UBIN(16)    r     1 KA_OTPBFRBYTSIZ_SML
     0-0-0/w UBIN(16)    r     1 KA_OTPBFRBYTSIZ_SMLLOG2
     0-0-0/w UBIN(16)    r     1 KA_OTPBLKLMT(0:15)
     0-0-0/w UBIN(16)    r     1 KA_OTPUN_BLKLMT(0:15)
     0-0-0/b PTR         r     1 KA_TRNTBLCHNCHR$(0:3)
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:304  
     0-0-0/b PTR         r     1 KA_TRNTBL_FUL$(0:3)
     0-0-0/b PTR         r     1 KA_TRNTBL_PRT$(0:3)
     0-0-0/w STRC(64)    r     1 KH_CTLTBL                  0-0-0/w PTR         r     1 KV$PTR$
     0-0-0/w EPTR        r     1 KVM$SND                    0-0-0/w STRC(8960)  r     1 KV_STT
     0-0-0/w STRC(128)   r     1 KV_VDH_DAT                 0-0-0/w STRC(32)    r     1 KV_VDH_EVT_CMPOTP
     0-0-0/w STRC(32)    r     1 KV_VDH_EVT_RLSVDI          0-0-0/w STRC(32)    r     1 KV_VDH_EVT_RQSOTP
     0-0-0/w STRC(80)    r     1 KV_VDH_OTPLCL              0-0-0/w STRC(80)    r     1 KV_VDH_OTPMRK
     0-0-0/w STRC(32)    r     1 KV_VDH_SETCLK              0-0-0/w STRC(32)    r     1 KXX_VDH_DSC
     0-0-0/w BIT (16)    r     1 KX_BFR_BRK                 0-0-0/w STRC(672)   r     1 KX_BUF
     0-0-0/w STRC(16)    r     1 KX_KEY_CAL_CNF             0-0-0/w STRC(16)    r     1 KX_KEY_CAL_IND
     0-0-0/w STRC(16)    r     1 KX_KEY_CLR_IND             0-0-0/w STRC(16)    r     1 KX_KEY_INDX3
     0-0-0/w STRC(16)    r     1 KX_KEY_INT_CNF             0-0-0/w STRC(16)    r     1 KX_KEY_INT_IND
     0-0-0/w STRC(16)    r     1 KX_KEY_RST_CNF             0-0-0/w STRC(16)    r     1 KX_KEY_RST_IND
     0-0-0/b EPTR        r     1 KX_PM$(0:2)
     0-0-0/w PTR         r     1 KX_PRT_$(0:4)
     0-0-0/w STRC(160)   r     1 KX_SND_DAT                 0-0-0/w STRC(1248)  r     1 KX_STATS_X29
     0-0-0/w STRC(32)    r     1 KX_VDH_EVT_ATN             0-0-0/w STRC(224)   r     1 KX_VDOVLPARY
     0-0-0/c STRC(16)    r     1 VC_INT                     0-0-0/c STRC(24)    r     1 VC_RST

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(32)    r     1 B$RLCID                    0-0-0/w STRC(48)    r     1 B$SCODE
     0-0-0/w CHAR(1000)  r     1 B$STR                      0-0-0/w CHAR(2000)  r     1 B$STR
     0-0-0/w UBIN(16)    r     1 BASED_WORD                 0-0-0/c CHAR(2000)  r     1 CHRSTR
     0-0-0/c UBIN(8)     r     1 KA$TRNTBLCHNCHR(0:3)
     0-0-0/w STRC(512)   r     1 KH$CHN                     0-0-0/w STRC(728)   r     1 KV$ERD
     0-0-0/w STRC(512)   r     1 KV$MRD                     0-0-0/w STRC(512)   r     1 KV$MVD
     0-0-0/w STRC(48)    r     1 KV$OTPMRK                  0-0-0/w STRC(480)   r     1 KV$PTR
     0-0-0/w STRC(1024)  r     1 KV$SSN                     0-0-0/w STRC(512)   r     1 KV$STR
     0-0-0/w STRC(499)   r     1 KV$TRNTBL                  0-0-0/w STRC(512)   r     1 KV$VDI
     0-0-0/w UBIN(16)    r     1 KVBSIZ                     0-0-0/w STRC(4992)  r     1 KX$L2
     0-0-0/w STRC(2320)  r     1 KX$L3                      0-0-0/w STRC(384)   r     1 KX$LINKDEV
     0-0-0/w STRC(2320)  r     1 KX$TL3                     0-0-0/w STRC(824)   r     1 KX$VC
     0-0-0/w STRC(80)    r     1 KX$VC_OTPBFR               0-0-0/w STRC(576)   r     1 KX$X29
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:305  
     0-0-0/w STRC(64)    r     1 KX$X29_OTPBFR              0-0-0/c CHAR(2000)  r     1 PRTTBL
     0-0-0/w STRC(368)   r     1 VC$CAL                     0-0-0/w STRC(368)   r     1 VC$CAL
     0-0-0/w STRC(160)   r     1 VC$CLR                     0-0-0/c STRC(16)    r     1 VC$DAT
     0-0-0/c STRC(16)    r     1 VC$INT                     0-0-0/c STRC(24)    r     1 VC$RST
     0-0-0/c UBIN(8)     r     1 Y$BYT(0:2000)


   Procedure KXX$VDI requires 5792 words for executable code.
   Procedure KXX$VDI requires 136 words of local(AUTO) storage.

    No errors detected in file KXX$VDI.:E05TSI    .
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:306  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:307  
          MINI XREF LISTING

B$RLCID
     23364**DCL     28810--IF      28872--ASSIGN  28917--ASSIGN
B$SCODE
     22962**DCL     30481<>CALL    30806<>CALL    31244<>CALL
B$STR
     23363**DCL     28872>>ASSIGN  28917>>ASSIGN
B$STR IN PROCEDURE Y$DECODE_FPT
     30705**DCL     30733<<ASSIGN  30733>>ASSIGN  30801<<ASSIGN  30801>>ASSIGN  30852<<ASSIGN  30852>>ASSIGN
     31080<<ASSIGN  31080>>ASSIGN
BAD_STATE IN PROCEDURE Y$DECODE_FPT
     30747**LABEL   31020--GOTO    31055--GOTO
BAD_VCSTT
     26865**DCL     30746>>ASSIGN
BAD_VCSTT IN PROCEDURE Y$DECODE_FPT
     30746**LABEL   30820--GOTO    30828--GOTO    30924--GOTO    30942--GOTO    30956--GOTO    30983--GOTO
BASED_WORD
     22520**DCL     28798>>ASSIGN  28848>>IF      28984>>IF      29008>>ASSIGN  29131>>IF      29146>>ASSIGN
     29150>>IF      29187>>ASSIGN  29263>>ASSIGN  29269>>IF      29307>>ASSIGN  29313>>IF      29331>>ASSIGN
     29346>>IF      29360>>ASSIGN  29388>>ASSIGN  29392>>IF      29441>>ASSIGN  29547>>ASSIGN  29551>>IF
     29878>>ASSIGN  30003>>IF      30460>>ASSIGN  30464>>IF
CALL_FPT
     27591**DCL     29362<<ASSIGN  29371<>CALL    29378<>CALL    30474<<ASSIGN  30479<>CALL    30713<<ASSIGN
     30804<>CALL    30969<>CALL    31007<>CALL    31231<<ASSIGN  31242<>CALL    31254<>CALL
CALL_FPT.CAL$
     27595**DCL     29363<<ASSIGN  30475<<ASSIGN  30714<<ASSIGN  31232<<ASSIGN
CALL_FPT.EVN
     27595**DCL     29365<<ASSIGN  30477<<ASSIGN  30779<<ASSIGN  30786<<ASSIGN  30912<<ASSIGN  30925<<ASSIGN
     30943<<ASSIGN  30958<<ASSIGN  30990<<ASSIGN  30993<<ASSIGN  31002<<ASSIGN  31006<<ASSIGN  31241<<ASSIGN
     31253<<ASSIGN
CALL_FPT.PRM1
     27596**DCL     30945<<ASSIGN  30960<<ASSIGN
CALL_FPT.PRM1$
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:308  
     27596**DCL     27597--REDEF   30478<<ASSIGN  30481>>CALL    30806>>CALL    31244>>CALL
CALL_FPT.PRM2$
     27598**DCL     27598--REDEF
CALL_FPT.PRS.PRM1
     27601**DCL     30944<<ASSIGN  30959<<ASSIGN
CALL_FPT.RCV$
     27595**DCL     29364<<ASSIGN  30476<<ASSIGN  30715<<ASSIGN  30716>>ASSIGN  31233<<ASSIGN
CALL_FPT.V_.ADR$
     27599**DCL     30780<<ASSIGN  30787<<ASSIGN  30801>>ASSIGN  30926<<ASSIGN  30961<<ASSIGN
CALL_FPT.V_.BYTSIZ
     27600**DCL     30782<<ASSIGN  30790<<ASSIGN  30795>>ASSIGN  30796>>IF      30801>>ASSIGN  30801>>ASSIGN
     30930<<ASSIGN  30966<<ASSIGN
CALL_FPT.V_.BYTX
     27600**DCL     30781<<ASSIGN  30788<<ASSIGN  30801>>ASSIGN  30927<<ASSIGN  30962<<ASSIGN
CALL_VCUP IN PROCEDURE Y$DECODE_FPT
     30786**LABEL   30816--GOTO
CAL_KXP IN PROCEDURE Y$DECODE_FPT
     30804**LABEL   30913--GOTO    30933--GOTO    30946--GOTO    30991--GOTO    30994--GOTO    31003--GOTO
CAL_KXP0 IN PROCEDURE Y$DECODE_FPT
     30791**LABEL   30783--GOTO
CHECK_RETURN
     29693**LABEL   29621--GOTO    29632--GOTO    29639--GOTO
CHRCNT
     27562**DCL     28940<<ASSIGN  28941>>IF      28948>>CALLBLT 28948>>CALLBLT
CHRSTR
     22517**DCL     28948<<CALLBLT 28948>>CALLBLT
CLR_VC
     29301**LABEL   29281--GOTO
CLR_VDI$
     29317**LABEL   29245--GOTO    29277--GOTO
CNC_TYP
     28738**DCL     28783<<ASSIGN  28787<<ASSIGN  28789<<ASSIGN  28800>>DOCASE  29010>>IF      29027>>IF
     29135>>IF      29142>>IF      29176>>IF      29189>>DOCASE  29243>>IF      29250>>IF      29333>>IF
     29367>>IF      29384>>DOCASE  29443>>DOCASE  29479>>IF      29488>>IF      29500>>DOCASE  29710>>IF
     30023>>IF      30182>>IF      30276>>IF      30301>>IF
CNTL$
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:309  
     27553**DCL     21397--IMP-PTR 28817>>IF      28820>>IF      28820>>IF      28823>>CALL    28845>>CALL
     28855>>ASSIGN  28855>>ASSIGN  28862>>ASSIGN  28865>>ASSIGN  28866>>IF      28868>>ASSIGN  28870>>ASSIGN
     28871>>ASSIGN  28876>>ASSIGN  28885>>ASSIGN  28908>>ASSIGN  29195>>IF      29198>>IF      29201>>ASSIGN
     29202>>ASSIGN  29400>>DOINDEX 29403>>ASSIGN  29563>>ASSIGN  29568>>ASSIGN  29569>>ASSIGN
DAT$
     27555**DCL     21330--IMP-PTR 21452--IMP-PTR 29014<<ASSIGN  29015>>ASSIGN  29016>>ASSIGN  29020>>CALL
     29020<>CALL    29043<<ASSIGN  29044>>IF      29044>>IF      29047>>ASSIGN  29049<<ASSIGN  29049>>ASSIGN
     29051>>ASSIGN  29058>>DOWHILE 29060>>IF      29065>>ASSIGN  29067>>ASSIGN  29068>>ASSIGN  29069>>IF
     29072>>ASSIGN  29073>>CALL    29075>>ASSIGN  29077<>CALL    29078<<ASSIGN  29084>>ASSIGN  29085<<ASSIGN
     29085>>ASSIGN  29539<>CALL    29542>>ASSIGN  30220<<ASSIGN  30221>>IF      30224>>ASSIGN  30224>>ASSIGN
     30250<<ASSIGN  30251>>ASSIGN  30255>>ASSIGN  30256>>ASSIGN  30256>>ASSIGN  30839<<ASSIGN  30840>>IF
     30840>>IF      30840>>IF      30843>>ASSIGN  30843>>ASSIGN  30848>>ASSIGN  30852>>ASSIGN  30852>>ASSIGN
     30856>>ASSIGN  30856>>ASSIGN  30857>>IF      30857>>IF      30859>>ASSIGN  31066<>CALL    31071>>ASSIGN
     31073>>ASSIGN  31074>>ASSIGN  31075>>ASSIGN  31076>>ASSIGN  31080>>ASSIGN  31084>>ASSIGN  31086>>ASSIGN
     31087>>ASSIGN  31088>>ASSIGN  31091>>ASSIGN
DEVLGNFAL
     26665**DCL     29492>>ASSIGN
DIE
     30382**LABEL   30023--GOTO
DWORD
     28751**DCL     28752--REDEF
ERCOD
     27626**DCL     29490<<ASSIGN  29492<<ASSIGN  30027<<ASSIGN  30507<>CALL
FLWCTRPAD
     27608**DCL     30314<<ASSIGN  30320<<ASSIGN  30321>>ASSIGN
FULPCKS IN PROCEDURE Y$DECODE_FPT
     30710**DCL     30871<<ASSIGN  30872>>IF      30876>>ASSIGN  30877>>ASSIGN  30884<<ASSIGN  30886<<ASSIGN
     31064>>ASSIGN  31077>>IF      31079<<ASSIGN  31080>>ASSIGN  31080>>ASSIGN
G$JIT.ERRLOG
     22865**DCL     22868--REDEF
G$JIT.JSUNIT
     22604**DCL     22605--REDEF
G$JIT.MCLS
     22603**DCL     22603--REDEF
G$JIT.TMRZ
     22872**DCL     22873--REDEF
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:310  
G$JIT.USER_EXTIME
     22596**DCL     22597--REDEF
G$JIT.USER_MEMTIME
     22599**DCL     22599--REDEF
G$JIT.USER_SVTIME
     22598**DCL     22598--REDEF
G$JIT$
     23376**DCL     22535--IMP-PTR
INTCNC
     29236**LABEL   29203--GOTO
KA$TRNTBLCHNCHR
     25353**DCL     30130>>IF
KA_DVCFLWCTRCHR
     24271**DCL     29738>>IF      30323>>IF      30413>>ASSIGN
KA_LINERRDSCLMT
     24272**DCL     30030>>IF      30037>>IF
KA_LINERRLOGLMT
     24272**DCL     30065>>IF      30072>>IF
KA_MINSP_FORPST
     24269**DCL     29165>>ASSIGN
KA_OTPBFRBYTSIZ_BIG
     24266**DCL     29861>>ASSIGN
KA_OTPBFRBYTSIZ_BIGLOG2
     24266**DCL     29862>>ASSIGN
KA_OTPBFRBYTSIZ_SML
     24266**DCL     29836>>ASSIGN  29841>>IF      29852>>ASSIGN  29884>>IF      29902>>ASSIGN
KA_OTPBFRBYTSIZ_SMLLOG2
     24267**DCL     29837>>ASSIGN  29853>>ASSIGN  29903>>ASSIGN
KA_OTPBFRLMTEXC
     25711**DCL     29726<<ASSIGN  29726>>ASSIGN
KA_OTPBLKLMT
     24268**DCL     29717>>IF      29939>>IF
KA_OTPUN_BLKLMT
     24267**DCL     29717>>IF
KA_TRNTBLCHNCHR$
     25349**DCL     30130>>IF
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:311  
KA_TRNTBL_FUL$
     25351**DCL     30153>>ASSIGN
KA_TRNTBL_PRT$
     25352**DCL     30145>>ASSIGN
KH$CHN
     22404**DCL     28824--CALL    28876<<ASSIGN  28876>>ASSIGN
KH$CHN.CTX$
     22474**DCL     28877<<ASSIGN
KH$CHN.DRPDTR
     22457**DCL     29294>>IF
KH$CHN.LNK$
     22511**DCL     28878<<ASSIGN
KH$CHN.TERMID
     22498**DCL     28845<>CALL    29539<>CALL    30507<>CALL
KH$CHN.TERMID.LEV
     22500**DCL     28879<<ASSIGN  28886>>DOWHILE
KH$CHN.TERMID.TERM
     22500**DCL     22509--REDEF
KH$CHN.TERMID.TERM.SUBDEVICE
     22506**DCL     28886>>DOWHILE 28894<<ASSIGN
KH$CHN.TERMID.TTYP
     22500**DCL     28880<<ASSIGN
KHA$GET_CTX_PTR
     28771**DCL-ENT 29539--CALL
KHD$SCREECH
     28759**DCL-ENT 28815--CALL    29409--CALL    29534--CALL    29575--CALL    29891--CALL    29914--CALL
     30172--CALL    30373--CALL    30382--CALL    30481--CALL    30806--CALL    31060--CALL    31244--CALL
KHI$DISABLE
     28769**DCL-ENT 28798--CALL    29008--CALL    29146--CALL    29187--CALL    29263--CALL    29307--CALL
     29331--CALL    29360--CALL    29388--CALL    29441--CALL    29547--CALL    29878--CALL    30460--CALL
KHI$ENABLE
     28770**DCL-ENT 28848--CALL    28984--CALL    29131--CALL    29150--CALL    29269--CALL    29313--CALL
     29346--CALL    29392--CALL    29551--CALL    30003--CALL    30464--CALL
KH_CHNHI
     25368**DCL     25369--REDEF
KH_CHNLOW
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:312  
     25369**DCL     25370--REDEF
KH_CTLTBL.PARM.PTR$
     25516**DCL     28798>>ASSIGN  28848>>IF      28984>>IF      29008>>ASSIGN  29131>>IF      29146>>ASSIGN
     29150>>IF      29187>>ASSIGN  29263>>ASSIGN  29269>>IF      29307>>ASSIGN  29313>>IF      29331>>ASSIGN
     29346>>IF      29360>>ASSIGN  29388>>ASSIGN  29392>>IF      29441>>ASSIGN  29547>>ASSIGN  29551>>IF
     29878>>ASSIGN  30003>>IF      30460>>ASSIGN  30464>>IF
KV$ERD.DVCOTPBFRSIZ
     20831**DCL     30100>>ASSIGN  30323>>IF      30392>>IF      30399>>ASSIGN
KV$ERD.EXTSRD_CHR
     20852**DCL     20852--REDEF   20853--REDEF
KV$MRD.CALUSR_ERS
     20882**DCL     29166<<ASSIGN
KV$MRD.CALUSR_OTPRPTCHR
     20894**DCL     29169<<ASSIGN
KV$MRD.CALUSR_PST
     20882**DCL     29167<<ASSIGN
KV$MRD.CALUSR_SETATR
     20883**DCL     29168<<ASSIGN
KV$MRD.DVCFLWCTRALG
     20884**DCL     29646>>IF      29646>>IF      29738>>IF      30311>>IF      30323>>IF      30413>>ASSIGN
KV$MRD.ERD$
     20880**DCL     29170<<ASSIGN  30100>>ASSIGN  30323>>IF      30392>>IF      30399>>ASSIGN
KV$MRD.LOCALECHO
     20894**DCL     30348>>IF
KV$MRD.MINSP_FORPST
     20882**DCL     29165<<ASSIGN
KV$MVD.APLLCNRM
     20935**DCL     30138>>IF
KV$MVD.DISPINPUT
     20932**DCL     30348>>IF
KV$MVD.TRNTBL$
     20929**DCL     29585>>DOSELCT 30130>>IF      30145<<ASSIGN  30153<<ASSIGN
KV$OTPMRK
     21308**DCL     29766--ASSIGN  30224--ASSIGN  30251--ASSIGN  30255<<ASSIGN
KV$OTPMRK.ID
     21313**DCL     21313--REDEF   21314--REDEF
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:313  
KV$PTR.INPCNDPND
     20976**DCL     20985--REDEF   20989--REDEF
KV$PTR.INPCNDPND.TRN
     20980**DCL     29592>>IF
KV$PTR.LINLST$
     20972**DCL     20973--REDEF
KV$PTR.MRD$
     20971**DCL     29165>>ASSIGN  29166>>ASSIGN  29167>>ASSIGN  29168>>ASSIGN  29169>>ASSIGN  29170>>ASSIGN
     29646>>IF      29646>>IF      29738>>IF      30100>>ASSIGN  30311>>IF      30323>>IF      30323>>IF
     30348>>IF      30392>>IF      30399>>ASSIGN  30413>>ASSIGN
KV$PTR.MVD$
     20971**DCL     29585>>DOSELCT 30130>>IF      30138>>IF      30145>>ASSIGN  30153>>ASSIGN  30348>>IF
KV$PTR.SSN$
     20970**DCL     30107>>IF      30107>>IF      30410>>ASSIGN  30410>>ASSIGN  30432>>IF
KV$PTR.STR$
     20970**DCL     28850>>ASSIGN
KV$PTR.VDI$
     20970**DCL     28779>>ASSIGN  29294>>IF
KV$PTR$
     20964**DCL     20970--IMP-PTR 28779>>ASSIGN  28850>>ASSIGN  29165>>ASSIGN  29166>>ASSIGN  29167>>ASSIGN
     29168>>ASSIGN  29169>>ASSIGN  29170>>ASSIGN  29294>>IF      29585>>DOSELCT 29592>>IF      29646>>IF
     29646>>IF      29738>>IF      30100>>ASSIGN  30107>>IF      30107>>IF      30130>>IF      30138>>IF
     30145>>ASSIGN  30153>>ASSIGN  30311>>IF      30323>>IF      30323>>IF      30348>>IF      30348>>IF
     30392>>IF      30399>>ASSIGN  30410>>ASSIGN  30410>>ASSIGN  30413>>ASSIGN  30432>>IF
KV$SSN.LGCDSC
     21031**DCL     30107>>IF
KV$SSN.OTPCHRCNT
     21021**DCL     30410<<ASSIGN  30410>>ASSIGN
KV$SSN.REDRSPCNT
     21021**DCL     21022--REDEF
KV$SSN.USRHLTINH
     21032**DCL     30107>>IF      30432>>IF
KV$STR.ERR.COD
     21218**DCL     28850<<ASSIGN
KV$TRNTBL.FNTCLS
     21283**DCL     30130>>IF
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:314  
KV$TRNTBL.INPCHRMSK
     21280**DCL     29585>>DOSELCT
KV$TRNTBL.OTPESCCHR
     21281**DCL     21281--REDEF
KV$VDI
     21092**DCL     29483<>CALL    29810<>CALL    30229<>CALL    30440<>CALL
KV$VDI.CHN$
     21092**DCL     29294>>IF      29543<<ASSIGN
KV$VDI.FULLDUPLEXPAPERTAPE
     21127**DCL     29416>>IF      29598>>IF      30365>>ASSIGN
KV$VDI.HALFDUPLEXPAPERTAPE
     21128**DCL     29416>>IF      29598>>IF      30365>>ASSIGN
KV$VDI.INTPHSDSC
     21131**DCL     29284>>IF      29294>>IF      29487<<ASSIGN  30047<<ASSIGN
KV$VDI.LINSPD
     21134**DCL     29165>>ASSIGN  29717>>IF      29717>>IF      29939>>IF
KV$VDI.OTPBFR_.ADR$
     21118**DCL     28941>>IF      28948>>CALLBLT 28948>>CALLBLT 29041<<ASSIGN  29432>>ASSIGN  29479>>IF
     29760>>IF      29766>>ASSIGN  29766>>ASSIGN  29881<>CALL    29910<>CALL    29934>>ASSIGN  29935>>ASSIGN
     29974>>ASSIGN  29975>>ASSIGN  29982>>ASSIGN  29984>>ASSIGN  29991>>ASSIGN  29997>>ASSIGN  30220>>ASSIGN
     30233>>IF      30250>>ASSIGN  30413>>ASSIGN
KV$VDI.OTPBFR_.BYTSIZ
     21118**DCL     29039<<ASSIGN  29423>>IF      29434<<ASSIGN  29434>>ASSIGN  29479>>IF      29786<<ASSIGN
     29793<<ASSIGN  29930<<ASSIGN  30257>>IF      30259<<ASSIGN  30400>>IF      30416<<ASSIGN  30416>>ASSIGN
KV$VDI.OTPBFR_.BYTX
     21118**DCL     28940>>ASSIGN  28951>>ASSIGN  29040<<ASSIGN  29432>>ASSIGN  29433<<ASSIGN  29433>>ASSIGN
     29766>>ASSIGN  29929<<ASSIGN  30226>>IF      30257>>IF      30259>>ASSIGN  30413>>ASSIGN  30415<<ASSIGN
     30415>>ASSIGN
KV$VDI.OTPCHRCNTAFTLF
     21130**DCL     28957<<ASSIGN  28957>>ASSIGN  29716<<ASSIGN  29716>>ASSIGN
KV$VDI.OTPCNDPND
     21129**DCL     29459>>IF      30268>>IF
KV$VDI.PHSDSC
     21127**DCL     30107>>IF
KV$VDI.PRTTYP
     21126**DCL     28941>>IF      28941>>IF      28947>>ASSIGN
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:315  
KV$VDI.RE_DSPINP
     21127**DCL     29094>>IF      29098<<ASSIGN
KV$VDI.RQSOTP
     21128**DCL     28933>>IF      28934<<ASSIGN  29113>>IF      29114<<ASSIGN  29952>>IF      29953<<ASSIGN
     30897>>IF      30898<<ASSIGN
KV$VDI.SSNCNT
     21121**DCL     29954>>IF      30899>>IF
KV$VDI.TMPOTPCHRCNT
     21123**DCL     28957>>ASSIGN  28958>>ASSIGN  28959<<ASSIGN  29716>>ASSIGN  29744>>ASSIGN  30008<<ASSIGN
     30391<<ASSIGN
KV$VDI.USEOTPBFRBNR
     21132**DCL     30334<<ASSIGN  30342<<ASSIGN
KV$VDI.USEOTPBFRTRN
     21133**DCL     30333<<ASSIGN  30341<<ASSIGN
KV$VDI.USRCTX$
     21092**DCL     28780>>ASSIGN
KV$VDI.USREVTENB
     21135**DCL     30365<<ASSIGN
KV$VDI.USRRQSDAT.RED
     21133**DCL     29337>>IF      29508>>IF      30747>>IF      31039>>IF      31148>>IF      31159>>IF
     31174>>IF      31185>>IF      31195>>IF      31207>>IF      31217>>IF      31237>>IF
KV$VDI.VDHEVTENB
     21140**DCL     29119>>IF
KV@SND_DAT
     28690**DCL     29511<<ASSIGN  29516<>CALL    30284<<ASSIGN  30287<>CALL    30753<<ASSIGN  30756<>CALL
     31022<<ASSIGN  31045<>CALL    31147<<ASSIGN  31192<>CALL    31204<>CALL    31214<>CALL    31263<>CALL
KV@SND_DAT.DAT__.ADR$
     28726**DCL     29513<<ASSIGN  31042<<ASSIGN  31152<<ASSIGN  31167<<ASSIGN  31178<<ASSIGN  31190<<ASSIGN
     31202<<ASSIGN  31212<<ASSIGN  31221<<ASSIGN  31261--IMP-PTR 31268>>ASSIGN  31269>>CALL
KV@SND_DAT.DAT__.BYTX
     28726**DCL     29514<<ASSIGN  31043<<ASSIGN
KV@SND_DAT.DAT__.DATBYTSIZ
     28726**DCL     29515<<ASSIGN  31044<<ASSIGN  31153<<ASSIGN  31168<<ASSIGN  31179<<ASSIGN  31191<<ASSIGN
     31203<<ASSIGN  31213<<ASSIGN  31222<<ASSIGN  31268>>ASSIGN
KV@VDH_DAT
     28610**DCL     29394<<ASSIGN  29398<>CALL
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:316  
KV@VDH_DAT.DAT__.ADR$
     28646**DCL     29395<<ASSIGN
KV@VDH_DAT.DAT__.BFRBYTSIZ
     28647**DCL     29397<<ASSIGN
KV@VDH_DAT.DAT__.DATBYTSIZ
     28646**DCL     29396<<ASSIGN
KV@VDH_DSC
     28397**DCL     30048<<ASSIGN  30050<>CALL    31251<<ASSIGN  31252<>CALL
KV@VDH_DSC.RSN
     28403**DCL     30049<<ASSIGN
KV@VDH_OTPLCL
     28442**DCL     28952<<ASSIGN  28981<>CALL
KV@VDH_OTPLCL.BFR_.ADR$
     28475**DCL     28954<<ASSIGN
KV@VDH_OTPLCL.BFR_.BYTSIZ
     28475**DCL     28956<<ASSIGN  28960>>IF      28968>>ASSIGN  28969>>IF      28976>>ASSIGN  28980>>ASSIGN
KV@VDH_OTPLCL.BFR_.BYTX
     28475**DCL     28955<<ASSIGN
KV@VDH_OTPLCL.TRN
     28448**DCL     28953<<ASSIGN
KV@VDH_OTPMRK
     28506**DCL     30185<<ASSIGN  30187<>CALL
KV@VDH_OTPMRK.DAT
     28533**DCL     30186<<ASSIGN
KV@VDH_OTPMRK.DAT.ID
     28536**DCL     28536--REDEF   28537--REDEF
KV@VDH_SETCLK
     28568**DCL     30057<<ASSIGN  30061<>CALL
KV@VDH_SETCLK.CLKNMB
     28574**DCL     30060<<ASSIGN
KV@VDH_SETCLK.PRD
     28574**DCL     30059<<ASSIGN
KV@VDH_SETCLK.UNT
     28574**DCL     30058<<ASSIGN
KVB$GET2NSYS
     28764**DCL-ENT 31066--CALL
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:317  
KVB$GETSYS
     28763**DCL-ENT 28824--CALL    28854--CALL    29881--CALL    29910--CALL    30731--CALL    30799--CALL
     31027--CALL
KVB$RLS2NSYS
     28758**DCL-ENT 29020--CALL
KVB$RLSSYS
     28757**DCL-ENT 29050--CALL    29077--CALL    29207--CALL    29518--CALL    31048--CALL    31269--CALL
KVBSIZ IN PROCEDURE Y$SNDDAT
     31261**DCL     31268<<ASSIGN  31269<>CALL
KVI$RE_DSPINP
     28760**DCL-ENT 29097--CALL
KVV$VDI
     28745**DCL-ENT 28935--CALL    28981--CALL    29115--CALL    29127--CALL    29398--CALL    29401--CALL
     29460--CALL    29516--CALL    29955--CALL    30050--CALL    30061--CALL    30187--CALL    30269--CALL
     30287--CALL    30756--CALL    30900--CALL    30970--CALL    31045--CALL    31192--CALL    31204--CALL
     31214--CALL    31252--CALL    31263--CALL
KV_ERD
     25620**DCL     25629--DCLINIT 29170--ASSIGN
KV_ERD.EXTSRD_CHR
     25663**DCL     25663--REDEF   25664--REDEF
KV_STT.OTPCHRCNT
     23759**DCL     30411<<ASSIGN  30411>>ASSIGN
KV_STT.REQSTATS.DSPMSK
     23650**DCL     23656--REDEF
KV_STT.REQSTATS.SLCMSK
     23691**DCL     23698--REDEF
KV_USR_GETOTPBFR
     25700**DCL     29426<>CALL    30242<>CALL    30403<>CALL
KV_USR_GETOTPBFR.ESTBYTSIZ
     25706**DCL     30241<<ASSIGN
KV_VDH_DAT
     24205**DCL     29394>>ASSIGN
KV_VDH_EVT_CMPOTP
     23958**DCL     29460<>CALL    30269<>CALL
KV_VDH_EVT_RLSVDI
     23886**DCL     29127<>CALL
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:318  
KV_VDH_EVT_RQSOTP
     23922**DCL     28935<>CALL    29115<>CALL    29955<>CALL    30900<>CALL
KV_VDH_OTPLCL
     24037**DCL     28952>>ASSIGN
KV_VDH_OTPMRK
     24101**DCL     30185>>ASSIGN
KV_VDH_OTPMRK.DAT.ID
     24131**DCL     24131--REDEF   24132--REDEF
KV_VDH_SETCLK
     24163**DCL     30057>>ASSIGN
KX$L2.DFLVCPRF.TRADEL
     23154**DCL     23164--REDEF
KX$L2.DSTSNPA.ADR_STRING
     23345**DCL     23345--REDEF
KX$L2.FLG.DATAVL
     23060**DCL     29695<<ASSIGN  29713<<ASSIGN
KX$L2.FRMR_NSNR
     23131**DCL     23132--REDEF
KX$L2.L3_HEAD$
     23063**DCL     28885>>ASSIGN
KX$L2.NTWADR.ADR_STRING
     23065**DCL     23065--REDEF
KX$L2.STATES
     23043**DCL     23043--REDEF
KX$L3.CALL_OPTS
     21606**DCL     30766>>ASSIGN  30767>>ASSIGN
KX$L3.CALL_OPTS.RCVADR.ADR_STRING
     21611**DCL     21611--REDEF   30765<<ASSIGN
KX$L3.CALL_OPTS.RCVADR.SIZ
     21611**DCL     30764<<ASSIGN
KX$L3.CALL_OPTS.SNDPCKSIZ
     21609**DCL     30870>>ASSIGN
KX$L3.CHN$
     21572**DCL     28824<>CALL    28876>>ASSIGN  28877>>ASSIGN  28878>>ASSIGN  28879>>ASSIGN  28880>>ASSIGN
     28894>>ASSIGN
KX$L3.CM$
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:319  
     21571**DCL     28875<<ASSIGN  29231<<ASSIGN
KX$L3.CM_OPTS
     21641**DCL     30767<<ASSIGN
KX$L3.CM_OPTS.RCVADR.ADR_STRING
     21646**DCL     21646--REDEF
KX$L3.CUG
     21689**DCL     21690--REDEF
KX$L3.DFL_OPTS
     21676**DCL     30766<<ASSIGN
KX$L3.DFL_OPTS.RCVADR.ADR_STRING
     21681**DCL     21681--REDEF
KX$L3.FSTSLC
     21686**DCL     30768<<ASSIGN
KX$L3.L2$
     21571**DCL     29695>>ASSIGN  29713>>ASSIGN
KX$L3.LCLADR.ADR_STRING
     21806**DCL     21806--REDEF
KX$L3.LCLNSAP
     21823**DCL     21879--REDEF
KX$L3.LCLNSAP.NSAP.ADDRESS_N
     21874**DCL     21875--REDEF
KX$L3.LCN#
     21688**DCL     21689--REDEF
KX$L3.NOREASM
     21804**DCL     30793<<ASSIGN
KX$L3.PVC
     21685**DCL     29224>>IF
KX$L3.RLSCHN
     21685**DCL     28853<<ASSIGN  29537>>IF
KX$L3.RMTNSAP
     21896**DCL     21952--REDEF
KX$L3.RMTNSAP.NSAP.ADDRESS_N
     21947**DCL     21948--REDEF
KX$L3.RVS
     21687**DCL     30769<<ASSIGN
KX$L3.STATES
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:320  
     21694**DCL     21694--REDEF
KX$L3.TRNDLY
     21690**DCL     21691--REDEF
KX$L3.TRNDLYIND
     21691**DCL     21692--REDEF
KX$L3.TYP
     21577**DCL     28874<<ASSIGN
KX$LINKDEV
     21397**DCL     29207--CALL
KX$LINKDEV.CHN$
     21397**DCL     28845>>CALL    28876>>ASSIGN
KX$LINKDEV.CLSSSN
     21403**DCL     29569<<ASSIGN
KX$LINKDEV.CRC
     21400**DCL     28820>>IF
KX$LINKDEV.CRCCNT
     21400**DCL     28820>>IF      28855<<ASSIGN  28855>>ASSIGN
KX$LINKDEV.L2$
     21399**DCL     28823<>CALL    28885>>ASSIGN  29195>>IF
KX$LINKDEV.L4_HEAD$
     21399**DCL     28870<<ASSIGN  28908>>ASSIGN
KX$LINKDEV.L4_TAIL$
     21399**DCL     28862>>ASSIGN  28866>>IF      28868>>ASSIGN  28871<<ASSIGN
KX$LINKDEV.OPNSSN
     21403**DCL     29563<<ASSIGN  29568<<ASSIGN
KX$LINKDEV.OUTBOUND
     21402**DCL     28817>>IF
KX$LINKDEV.PNDEVTCNT
     21402**DCL     29400>>DOINDEX 29403<<ASSIGN
KX$LINKDEV.RECNC
     21403**DCL     29198>>IF      29202<<ASSIGN
KX$LINKDEV.VDI$
     21397**DCL     29201<<ASSIGN
KX$TL3.CALL_OPTS.RCVADR.ADR_STRING
     22014**DCL     22014--REDEF
KX$TL3.CHN$
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:321  
     21975**DCL     28886>>DOWHILE 28886>>DOWHILE
KX$TL3.CM_OPTS.RCVADR.ADR_STRING
     22049**DCL     22049--REDEF
KX$TL3.CUG
     22092**DCL     22093--REDEF
KX$TL3.DFL_OPTS.RCVADR.ADR_STRING
     22084**DCL     22084--REDEF
KX$TL3.LCLADR.ADR_STRING
     22209**DCL     22209--REDEF
KX$TL3.LCLNSAP
     22226**DCL     22282--REDEF
KX$TL3.LCLNSAP.NSAP.ADDRESS_N
     22277**DCL     22278--REDEF
KX$TL3.LCN#
     22091**DCL     22092--REDEF
KX$TL3.NEXT$
     21974**DCL     28889>>ASSIGN
KX$TL3.RMTNSAP
     22299**DCL     22355--REDEF
KX$TL3.RMTNSAP.NSAP.ADDRESS_N
     22350**DCL     22351--REDEF
KX$TL3.STATES
     22097**DCL     22097--REDEF
KX$TL3.TRNDLY
     22093**DCL     22094--REDEF
KX$TL3.TRNDLYIND
     22094**DCL     22095--REDEF
KX$VC
     21479**DCL     28854--CALL    28856<<ASSIGN  28857--ASSIGN  28919<>CALL    30996<>CALL    31008<>CALL
KX$VC.BLK_L3
     21488**DCL     30999>>IF      31234>>IF      31240<<ASSIGN  31248>>IF
KX$VC.BLNK$
     21485**DCL     28862<<ASSIGN
KX$VC.CALCNFPND
     21489**DCL     21490--REDEF   31159>>IF      31170<<ASSIGN
KX$VC.CALINDPND
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:322  
     21489**DCL     29507<<ASSIGN  29521<<ASSIGN  30736<<ASSIGN  31148>>IF      31155<<ASSIGN
KX$VC.CALMSGBYTSIZ
     21497**DCL     29515>>ASSIGN  29518>>CALL    29520<<ASSIGN  30730<<ASSIGN  30731>>CALL    30733>>ASSIGN
     30733>>ASSIGN  30795<<ASSIGN  30799>>CALL    31026<<ASSIGN  31027>>CALL    31044>>ASSIGN  31048>>CALL
     31050<<ASSIGN  31153>>ASSIGN  31157<<ASSIGN  31168>>ASSIGN  31172<<ASSIGN
KX$VC.CALPKT$
     21497**DCL     29513>>ASSIGN  29518<>CALL    29519<<ASSIGN  30731<>CALL    30733>>ASSIGN  30799<>CALL
     30801>>ASSIGN  31027<>CALL    31029>>ASSIGN  31030>>ASSIGN  31038>>ASSIGN  31042>>ASSIGN  31048<>CALL
     31049<<ASSIGN  31152>>ASSIGN  31156<<ASSIGN  31162>>IF      31167>>ASSIGN  31171<<ASSIGN
KX$VC.CLRINDPND
     21491**DCL     31217>>IF      31224<<ASSIGN
KX$VC.CLRMSGBYTSIZ
     21498**DCL     31222>>ASSIGN  31226<<ASSIGN
KX$VC.CLRPKT$
     21498**DCL     31221>>ASSIGN  31225<<ASSIGN
KX$VC.CNTL$
     21486**DCL     28865<<ASSIGN
KX$VC.ERCOD
     21519**DCL     30283>>ASSIGN  30760<<ASSIGN
KX$VC.ERCOD.ERR#
     21546**DCL     30279>>IF      30289<<ASSIGN
KX$VC.FLNK$
     21484**DCL     28863<<ASSIGN  28868<<ASSIGN  28912>>ASSIGN
KX$VC.INTCNFPND
     21490**DCL     31185>>IF      31193<<ASSIGN
KX$VC.INTINDPND
     21490**DCL     31174>>IF      31181<<ASSIGN
KX$VC.INTMSGBYTSIZ
     21499**DCL     31179>>ASSIGN  31183<<ASSIGN
KX$VC.INTPKT$
     21499**DCL     31178>>ASSIGN  31182<<ASSIGN
KX$VC.INV2CLR
     21492**DCL     31248>>IF
KX$VC.L3$
     21484**DCL     28864<<ASSIGN  29259>>IF      29265>>ASSIGN  29363>>ASSIGN  29447>>IF      30715>>ASSIGN
     31228>>IF      31233>>ASSIGN
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:323  
KX$VC.MAXOTPBYT
     21487**DCL     30889>>IF
KX$VC.OTPBFRBYTCNT
     21487**DCL     29017<<ASSIGN  29017>>ASSIGN  30889>>IF      31072<<ASSIGN  31072>>ASSIGN
KX$VC.RLCID
     21500**DCL     21500--REDEF   28919<>CALL
KX$VC.RLCID_STRING
     21500**DCL     28872<<ASSIGN  28917<<ASSIGN
KX$VC.RPRDAT
     21488**DCL     30909>>IF
KX$VC.RPRX3
     21492**DCL     30774<<ASSIGN
KX$VC.RSTCNFPND
     21491**DCL     31207>>IF      31215<<ASSIGN
KX$VC.RSTINDPND
     21491**DCL     31195>>IF      31205<<ASSIGN
KX$VC.RST_CAUSE
     21496**DCL     31200>>ASSIGN
KX$VC.RST_DIAG
     21496**DCL     31201>>ASSIGN
KX$VC.SND.HED$
     21485**DCL     29013>>DOWHILE 29014>>ASSIGN  29015<<ASSIGN  29253>>IF      31082>>IF      31084<<ASSIGN
KX$VC.SND.NXTLOD$
     21486**DCL     29023<<ASSIGN  29447>>IF      30836>>IF      31089>>IF      31091<<ASSIGN
KX$VC.SND.TAL$
     21486**DCL     29022<<ASSIGN  29023>>ASSIGN  30839>>ASSIGN  31086>>ASSIGN  31087<<ASSIGN
KX$VC.STATE
     21549**DCL     28909>>DOWHILE 29256>>IF      29272<<ASSIGN  29274>>IF      29274>>IF      29280<<ASSIGN
     29447>>IF      29505>>DOCASE  29524<<ASSIGN  29526<<ASSIGN  30727>>IF      30743>>IF      30763<<ASSIGN
     30814>>IF      30818>>IF      30826>>IF      30922>>IF      30940>>IF      30954>>IF      30957<<ASSIGN
     30981>>IF      31255<<ASSIGN
KX$VC.VDHENTERED
     21489**DCL     28805<<ASSIGN  28807<<ASSIGN  29340<<ASSIGN  29342<<ASSIGN  29370<<ASSIGN  29372<<ASSIGN
     29446<<ASSIGN  29452<<ASSIGN
KX$VC.VDI$
     21483**DCL     28909>>DOWHILE
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:324  
KX$VC.X28
     21492**DCL     30773<<ASSIGN  30984>>IF      31016>>IF
KX$VC.X3PND
     21490**DCL     31023>>IF      31031<<ASSIGN  31047<<ASSIGN
KX$VC.X3PRM
     21494**DCL     30775<<ASSIGN  30987>>DOCASE  30998<<ASSIGN  31014<<ASSIGN  31038>>ASSIGN
KX$VC.X3_PRM_BITS
     21493**DCL     21494--REDEF
KX$VC_OTPBFR
     21452**DCL     31064--ASSIGN  31080--ASSIGN
KX$VC_OTPBFR.BFRBYTSIZ
     21456**DCL     29016>>ASSIGN  30840>>IF      30843>>ASSIGN  30857>>IF      31073<<ASSIGN
KX$VC_OTPBFR.BYTX
     21457**DCL     30840>>IF      30843>>ASSIGN  30852>>ASSIGN  30856<<ASSIGN  30856>>ASSIGN  30857>>IF
     31074<<ASSIGN
KX$VC_OTPBFR.LNK$
     21456**DCL     29015>>ASSIGN  31086<<ASSIGN  31088<<ASSIGN
KX$VC_OTPBFR.M
     21456**DCL     30840>>IF      30848<<ASSIGN  30859<<ASSIGN  31076<<ASSIGN
KX$VC_OTPBFR.Q
     21456**DCL     31075<<ASSIGN
KX$VC_OTPBFR.RLSWRDSIZ
     21457**DCL     29020<>CALL    31071<<ASSIGN
KX$X29
     21358**DCL     29148<>CALL    29232<>CALL    29236<>CALL    29335<>CALL    29390<>CALL    30462<>CALL
KX$X29.ASNHLTOTP
     21372**DCL     29033<<ASSIGN  29139<<ASSIGN  29620<<ASSIGN  29691<<ASSIGN  30116<<ASSIGN
KX$X29.CHN$
     21362**DCL     29539>>CALL    29542<<ASSIGN  29543>>ASSIGN  29544>>ASSIGN  30507>>CALL
KX$X29.HLTOTP
     21368**DCL     21368--REDEF   29031<<ASSIGN  29463>>IF      29618>>IF      29689>>IF
KX$X29.HLTOTP.BITT
     21368**DCL     29608>>IF      29617<<ASSIGN  29624>>IF      29654>>IF      29688<<ASSIGN  30113<<ASSIGN
     30456<<ASSIGN
KX$X29.HLTOTPNXTBFR
     21371**DCL     21372--REDEF   29032<<ASSIGN  29092<<ASSIGN  29983<<ASSIGN
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:325  
KX$X29.HLTOTPNXTBFR.BITT
     21371**DCL     29635>>IF      29638<<ASSIGN  29672>>IF      29678<<ASSIGN  30447<<ASSIGN
KX$X29.HLTOTPNXTBFR_ALL
     21372**DCL     29091>>ASSIGN  29982>>ASSIGN
KX$X29.HLTOTP_ALL
     21368**DCL     29091<<ASSIGN  29091>>ASSIGN  29138<<ASSIGN  30112>>ASSIGN
KX$X29.L3$
     21363**DCL     29222>>IF      29224>>IF      29231>>ASSIGN  29303>>IF      29463>>IF      29537>>IF
     29537>>IF      29693>>IF      29695>>ASSIGN  29710>>IF      29713>>ASSIGN  30476>>ASSIGN
KX$X29.LINERRDSCCNT
     21373**DCL     30037>>IF      30064<<ASSIGN  30064>>ASSIGN
KX$X29.LINERRLOGCNT
     21374**DCL     30072>>IF      30081<<ASSIGN  30088<<ASSIGN  30088>>ASSIGN
KX$X29.OTPBFRBYTCNT
     21366**DCL     29048<<ASSIGN  29048>>ASSIGN  29076<<ASSIGN  29076>>ASSIGN  29693>>IF      29717>>IF
     29938<<ASSIGN  29938>>ASSIGN  29939>>IF      30182>>IF
KX$X29.OTPCHRCNTUTLHLT
     21366**DCL     28958<<ASSIGN  28958>>ASSIGN  28960>>IF      28969>>IF      28976<<ASSIGN  29744<<ASSIGN
     29744>>ASSIGN  29745>>IF      29756>>ASSIGN  29778>>IF      29786>>ASSIGN  30100<<ASSIGN  30399<<ASSIGN
     30426<<ASSIGN
KX$X29.PRTX
     21375**DCL     28940>>ASSIGN  28948>>CALLBLT 28948>>CALLBLT 28951<<ASSIGN  28980<<ASSIGN  28980>>ASSIGN
     29923<<ASSIGN  29927<<ASSIGN
KX$X29.PRTX4NXTBFR
     21376**DCL     28968<<ASSIGN  29890<<ASSIGN  29913<<ASSIGN  29920>>IF      29923>>ASSIGN  29924<<ASSIGN
KX$X29.PRVOTPBFRDATEXCSML
     21369**DCL     29841>>IF      30230<<ASSIGN
KX$X29.RPRDAT
     21373**DCL     29463>>IF      29469<<ASSIGN  29473<<ASSIGN
KX$X29.SBR$
     21362**DCL     28781>>IF      28785>>IF
KX$X29.SND.HED$
     21364**DCL     29043>>ASSIGN  29050<>CALL    29051<<ASSIGN  29065<<ASSIGN  29089>>ASSIGN  29119>>IF
     29284>>IF      29827>>IF      29974<<ASSIGN
KX$X29.SND.NXTLOD$
     21365**DCL     29035>>IF      29044>>IF      29089<<ASSIGN  29463>>IF      29627>>IF      29627>>IF
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:326  
     29631>>ASSIGN  29664>>IF      29664>>IF      29670>>ASSIGN  29975<<ASSIGN  29985>>IF      29991<<ASSIGN
KX$X29.SND.TAL$
     21365**DCL     29090<<ASSIGN  29968>>IF      29984>>ASSIGN  29997<<ASSIGN  30114>>IF      30441>>IF
KX$X29.SNDX3PRM
     21370**DCL     29142>>IF      29152<<ASSIGN  30317<<ASSIGN  30356<<ASSIGN
KX$X29.STATE
     21375**DCL     29220>>IF      29227<<ASSIGN  29294>>IF      29301<<ASSIGN  29463>>IF      29710>>IF
KX$X29.VDHEXTCAL
     21373**DCL     29377<<ASSIGN  29379<<ASSIGN  29470<<ASSIGN  29472<<ASSIGN
KX$X29.VDI$
     21362**DCL     29319<<ASSIGN
KX$X29.WAT4PRM
     21370**DCL     29153<<ASSIGN  29153>>ASSIGN
KX$X29.X3PRM
     21376**DCL     30315>>IF      30321<<ASSIGN  30353>>IF      30357<<ASSIGN
KX$X29_OTPBFR
     21330**DCL     28968--ASSIGN  29040--ASSIGN  29073<>CALL    29826--ASSIGN  29865--ASSIGN  29904--ASSIGN
     29927--ASSIGN  29929--ASSIGN  29934<<ASSIGN
KX$X29_OTPBFR.BYTSIZLOG2
     21335**DCL     29047>>ASSIGN  29075>>ASSIGN  29766>>ASSIGN  29935<<ASSIGN  30224>>ASSIGN  30251>>ASSIGN
KX$X29_OTPBFR.DLT
     21336**DCL     29072<<ASSIGN
KX$X29_OTPBFR.HLTOTP
     21334**DCL     21335--REDEF
KX$X29_OTPBFR.HLTOTP.BITT
     21334**DCL     29627>>IF      29631<<ASSIGN  29664>>IF      29670<<ASSIGN
KX$X29_OTPBFR.HLTOTP_ALL
     21335**DCL     29982<<ASSIGN
KX$X29_OTPBFR.LNK$
     21334**DCL     29049>>ASSIGN  29065>>ASSIGN  29067<<ASSIGN  29067>>ASSIGN  29068>>ASSIGN  29085>>ASSIGN
     29984<<ASSIGN
KX$X29_OTPBFR.NMBMRK
     21336**DCL     29069>>IF      29766>>ASSIGN  30224>>ASSIGN  30256<<ASSIGN  30256>>ASSIGN
KX$X29_OTPBFR.Q
     21336**DCL     29044>>IF      29060>>IF
KXP$PACKET
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:327  
     28761**DCL-ENT 30479--CALL    30804--CALL    30969--CALL    31007--CALL    31242--CALL    31254--CALL
KXS$GETL3
     28748**DCL-ENT 28823--CALL
KXS$RLSL3
     28768**DCL-ENT 28826--CALL    29267--CALL
KXS$SYSLOG
     28767**DCL-ENT 28845--CALL    30507--CALL
KXV$VCVDH
     28750**DCL-ENT 25747--DCLINIT 28785--IF      29371--CALL
KXX$DFRINP
     28753**DCL-ENT 29335--CALL
KXX$INTCNC
     28755**DCL-ENT 28919--CALL    29236--CALL
KXX$MRK
     28754**DCL-ENT 29073--CALL
KXX$RLSCTX
     28756**DCL-ENT 29232--CALL
KXX$SNDX29MSG
     28746**DCL-ENT 29148--CALL    29390--CALL    30462--CALL    30996--CALL    31008--CALL
KXX$TRNOTP
     28762**DCL-ENT 29483--CALL    29810--CALL    30229--CALL    30440--CALL
KXX$VDI
        10**PROC    29426--CALL    30242--CALL    30403--CALL
KXX$X29
     28747**DCL-ENT 28781--IF      29378--CALL
KXX_VDH_DSC
     23849**DCL     30048>>ASSIGN  30970<>CALL    31251>>ASSIGN
KX_BFR_BRK
     25723**DCL     29395--ASSIGN
KX_BUF.SIZ
     24291**DCL     30870>>ASSIGN
KX_KEY_CAL_CNF
     26228**DCL     31036--ASSIGN  31164--ASSIGN
KX_KEY_CAL_IND
     26178**DCL     29512--ASSIGN  31151--ASSIGN
KX_KEY_CLR_IND
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:328  
     26528**DCL     31220--ASSIGN
KX_KEY_INDX3
     26578**DCL     31032--ASSIGN  31166--ASSIGN
KX_KEY_INT_CNF
     26378**DCL     31188--ASSIGN
KX_KEY_INT_IND
     26328**DCL     31177--ASSIGN
KX_KEY_RST_CNF
     26478**DCL     31210--ASSIGN
KX_KEY_RST_IND
     26428**DCL     31198--ASSIGN
KX_PRT_$
     24990**DCL     28947>>ASSIGN
KX_SND_DAT
     25966**DCL     29511>>ASSIGN  30284>>ASSIGN  30753>>ASSIGN  31022>>ASSIGN  31147>>ASSIGN
KX_STATS_HDLC.REQSTATS.DSPMSK
     24562**DCL     24568--REDEF
KX_STATS_HDLC.REQSTATS.SLCMSK
     24603**DCL     24610--REDEF
KX_STATS_X25.REQSTATS.DSPMSK
     24887**DCL     24893--REDEF
KX_STATS_X25.REQSTATS.SLCMSK
     24928**DCL     24935--REDEF
KX_STATS_X29.CIRCUITS
     25331**DCL     28859<<ASSIGN  28859>>ASSIGN
KX_STATS_X29.KHSTT.CTXBYTUTL
     25327**DCL     28857<<ASSIGN  28857>>ASSIGN
KX_STATS_X29.KHSTT.OTPBFRBYTUTL
     25326**DCL     29018<<ASSIGN  29018>>ASSIGN  29052<<ASSIGN  29052>>ASSIGN  29079<<ASSIGN  29079>>ASSIGN
     29928<<ASSIGN  29928>>ASSIGN  31069<<ASSIGN  31069>>ASSIGN
KX_STATS_X29.LINSPDDST
     25329**DCL     28860<<ASSIGN  28860>>ASSIGN
KX_STATS_X29.OTPBFRGETCNT_BIG
     25330**DCL     29863<<ASSIGN  29863>>ASSIGN  29900<<ASSIGN  29900>>ASSIGN
KX_STATS_X29.OTPBFRGETCNT_SML
     25329**DCL     29838<<ASSIGN  29838>>ASSIGN  29854<<ASSIGN  29854>>ASSIGN  29901<<ASSIGN  29901>>ASSIGN
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:329  
KX_STATS_X29.REQSTATS.DSPMSK
     25254**DCL     25260--REDEF
KX_STATS_X29.REQSTATS.SLCMSK
     25295**DCL     25302--REDEF
KX_VC
     25743**DCL     28856>>ASSIGN
KX_VC.CALCNFPND
     25753**DCL     25754--REDEF
KX_VC.RLCID
     25764**DCL     25764--REDEF
KX_VC.X3_PRM_BITS
     25757**DCL     25758--REDEF
KX_VDH_EVT_ATN
     23993**DCL     29401<>CALL
KX_VDOVLPARY.VDOVLP
     26040**DCL     26043--REDEF
KX_VDOVLPARY.VDOVLP.ERR$
     26041**DCL     30285<<ASSIGN  30288<<ASSIGN  30754<<ASSIGN  30757<<ASSIGN
KX_VDOVLPARY.VDOVLP.KEY$
     26042**DCL     29512<<ASSIGN  30286<<ASSIGN  30755<<ASSIGN  31032<<ASSIGN  31036<<ASSIGN  31151<<ASSIGN
     31164<<ASSIGN  31166<<ASSIGN  31177<<ASSIGN  31188<<ASSIGN  31198<<ASSIGN  31210<<ASSIGN  31220<<ASSIGN
KX_VDOVLP_ERR
     26081**DCL     30282>>ASSIGN  30718>>ASSIGN
L3$
     27559**DCL     21571--IMP-PTR 28823<>CALL    28824>>CALL    28826<>CALL    28853>>ASSIGN  28864>>ASSIGN
     28874>>ASSIGN  28875>>ASSIGN  28876>>ASSIGN  28877>>ASSIGN  28877>>ASSIGN  28878>>ASSIGN  28879>>ASSIGN
     28880>>ASSIGN  28886>>DOWHILE 28891>>IF      28894>>ASSIGN  29265<<ASSIGN  29267<>CALL    30716<<ASSIGN
     30764>>ASSIGN  30765>>ASSIGN  30766>>ASSIGN  30766>>ASSIGN  30767>>ASSIGN  30767>>ASSIGN  30768>>ASSIGN
     30769>>ASSIGN  30793>>ASSIGN  30870>>ASSIGN
LEVEL
     27756**DCL     28798<<ASSIGN  28798<>CALL    28848>>IF      28984>>IF      29008<<ASSIGN  29008<>CALL
     29131>>IF      29146<<ASSIGN  29146<>CALL    29150>>IF      29187<<ASSIGN  29187<>CALL    29263<<ASSIGN
     29263<>CALL    29269>>IF      29307<<ASSIGN  29307<>CALL    29313>>IF      29331<<ASSIGN  29331<>CALL
     29346>>IF      29360<<ASSIGN  29360<>CALL    29388<<ASSIGN  29388<>CALL    29392>>IF      29441<<ASSIGN
     29441<>CALL    29547<<ASSIGN  29547<>CALL    29551>>IF      29878<<ASSIGN  29878<>CALL    30003>>IF
     30460<<ASSIGN  30460<>CALL    30464>>IF
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:330  
LGNRJC
     26713**DCL     29490>>ASSIGN
LINERRDSC
     26614**DCL     30027>>ASSIGN
L_2
     30114**LABEL   30110--GOTO
L_3
     29333**LABEL   29205--GOTO    29228--GOTO    29239--GOTO    29373--GOTO    29380--GOTO    29476--GOTO
L_4 IN PROCEDURE Y$DECODE_FPT
     30996**LABEL   31011--GOTO
L_ALTRET1
     28826**LABEL   28854--CALLALT
L_ALTRET2
     28845**LABEL   28822--GOTO    28823--CALLALT 28916--GOTO    28919--CALLALT
L_ALTRET3
     29131**LABEL   29029--GOTO    29037--GOTO
L_CLEARED
     29557**LABEL   29529--GOTO
L_DSCOTP IN PROCEDURE Y$DECODE_FPT
     30998**LABEL   31009--GOTO
L_KXPALT IN PROCEDURE Y$DECODE_FPT
     30806**LABEL   30969--CALLALT 31007--CALLALT
L_KXPALT2 IN PROCEDURE Y$CHKPNDBITS
     31244**LABEL   31254--CALLALT
L_NEWBFR IN PROCEDURE Y$DECODE_FPT
     30855**LABEL   30838--GOTO    30842--GOTO
L_NOMEM IN PROCEDURE Y$DECODE_FPT
     31060**LABEL   30731--CALLALT 30799--CALLALT 30875--CALLALT 30887--CALLALT 31027--CALLALT
L_NOT_X28 IN PROCEDURE Y$DECODE_FPT
     31019**LABEL   30986--GOTO
L_RETURN IN PROCEDURE Y$CHKPNDBITS
     31248**LABEL   31154--CALLALT 31169--CALLALT 31180--CALLALT 31192--CALLALT 31204--CALLALT 31214--CALLALT
     31223--CALLALT 31230--GOTO
L_RPRDAT IN PROCEDURE Y$DECODE_FPT
     30882**LABEL   30864--GOTO    30881--GOTO
NOT_X28
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:331  
     26817**DCL     31019>>ASSIGN
NO_L3CTX
     26962**DCL     28845<>CALL
PADECHO
     27609**DCL     30350<<ASSIGN  30352<<ASSIGN  30353>>IF      30357>>ASSIGN
PARM IN PROCEDURE Y$SNCFLWCTRHLT
     30388**DCL     30386--PROC    30429--ENTRY   30430>>ASSIGN
PARM1 IN PROCEDURE Y$SNCFLWCTRHLT
     30389**DCL     30417<<ASSIGN  30430<<ASSIGN  30432>>IF      30447>>ASSIGN  30454>>IF      30456>>ASSIGN
PCKSIZ IN PROCEDURE Y$DECODE_FPT
     30709**DCL     30870<<ASSIGN  30871>>ASSIGN  30871>>ASSIGN  30884>>ASSIGN
PRM_COPY
     27797**DCL     27796--IMP-SIZ
PRM_USR_DAT.DAT__.ADR$
     27871**DCL     28872>>ASSIGN  28917>>ASSIGN  28954>>ASSIGN  30717>>ASSIGN  30733>>ASSIGN  30787>>ASSIGN
     30829>>ASSIGN  30926>>ASSIGN  30961>>ASSIGN
PRM_USR_DAT.DAT__.BYTX
     27871**DCL     28872>>ASSIGN  28917>>ASSIGN  28955>>ASSIGN  30717>>ASSIGN  30733>>ASSIGN  30788>>ASSIGN
     30830>>ASSIGN  30927>>ASSIGN  30962>>ASSIGN
PRM_USR_DAT.DAT__.DATBYTSIZ
     27871**DCL     28802>>IF      28810>>IF      28956>>ASSIGN  30730>>ASSIGN  30831>>ASSIGN  30928>>IF
     30964>>IF
PRM_USR_EVT.ACT
     27917**DCL     29080<<ASSIGN
PRM_USR_EVT.FNC
     27915**DCL     28791>>DOCASE
PRM_USR_EVT.ID
     27917**DCL     28994>>DOCASE
PRM_USR_EVT.PRM
     27917**DCL     29159>>IF      29183>>IF      29325>>DOCASE  29479>>IF
PRM_USR_EXTINPTRN.IMD
     27953**DCL     29608>>IF
PRM_USR_EXTINPTRN.ORGCHR
     27954**DCL     29585>>DOSELCT
PRM_USR_GETOTPBFR.ESTBYTSIZ
     28089**DCL     29811>>IF      29819>>ASSIGN
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:332  
PRM_USR_INPPRC.CHR
     28125**DCL     30130>>IF
PRM_USR_INPPRC.ID
     28125**DCL     30024>>DOCASE
PRM_USR_OTPMRK.CMPOTP
     28162**DCL     30261>>IF
PRM_USR_OTPMRK.DAT
     28184**DCL     30186>>ASSIGN  30255>>ASSIGN
PRM_USR_OTPMRK.DAT.ID
     28187**DCL     28187--REDEF   28188--REDEF
PRM_USR_SETPRM.PRMID
     28325**DCL     30302>>DOSELCT
PRM_USR_X
     27796**DCL        10--PROC    27797--REDEF   27815--REDEF   27911--REDEF   27947--REDEF   27984--REDEF
     28021--REDEF   28083--REDEF   28119--REDEF   28156--REDEF   28219--REDEF   28255--REDEF   28319--REDEF
PRTTBL
     22519**DCL     28948>>CALLBLT
PRTTBL$
     27563**DCL     22519--IMP-PTR 28947<<ASSIGN  28948>>CALLBLT
PRV$
     27557**DCL     29057<<ASSIGN  29063>>IF      29067>>ASSIGN  29084<<ASSIGN  29090>>ASSIGN
RED_ENTRY
     29313**LABEL   30293--GOTO
RLSCTX
     29232**LABEL   29192--GOTO
SAME_AS_VDHEXT
     29438**LABEL   29353--GOTO
SUB_COMMON IN PROCEDURE Y$SNCFLWCTRHLT
     30430**LABEL   30418--GOTO
TEMP$
     27556**DCL     28854<>CALL    28856>>ASSIGN  28862>>ASSIGN  28863>>ASSIGN  28864>>ASSIGN  28865>>ASSIGN
     28868>>ASSIGN  28870>>ASSIGN  28871>>ASSIGN  28872>>ASSIGN  28875>>ASSIGN  28901>>ASSIGN  28908<<ASSIGN
     28909>>DOWHILE 28909>>DOWHILE 28909>>DOWHILE 28912<<ASSIGN  28912>>ASSIGN  28914>>IF      28917>>ASSIGN
     28919>>CALL    28919>>CALL    29068<<ASSIGN  29078>>ASSIGN
TEMP0
     27755**DCL     28884<<DOINDEX 28886>>DOWHILE 28894>>ASSIGN  28895<<ASSIGN  28902<<ASSIGN  29309<<ASSIGN
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:333  
     29400<<DOINDEX 29438<<ASSIGN  29545<<ASSIGN  30477>>ASSIGN
TEMP1$
     27558**DCL     28903<<ASSIGN  29310<<ASSIGN  29439<<ASSIGN  29544<<ASSIGN  30478>>ASSIGN
TL3$
     27560**DCL     21974--IMP-PTR 28885<<ASSIGN  28886>>DOWHILE 28886>>DOWHILE 28886>>DOWHILE 28889<<ASSIGN
     28889>>ASSIGN  28891>>IF
UNBLK
     29094**LABEL   29024--GOTO
UNK_VCFNC
     26913**DCL     31054>>ASSIGN
USR@DAT_ADR$ IN PROCEDURE Y$DECODE_FPT
     30706**DCL     30829<<ASSIGN  30852>>ASSIGN  31080>>ASSIGN
USR@DAT_BYTSIZ IN PROCEDURE Y$DECODE_FPT
     30708**DCL     30831<<ASSIGN  30843>>ASSIGN  30844>>IF      30855<<ASSIGN  30855>>ASSIGN  30862>>IF
     30871>>ASSIGN  30877<<ASSIGN  30877>>ASSIGN  30879>>IF      30886>>ASSIGN  31077>>IF      31079>>ASSIGN
USR@DAT_BYTX IN PROCEDURE Y$DECODE_FPT
     30707**DCL     30830<<ASSIGN  30852>>ASSIGN  30854<<ASSIGN  30854>>ASSIGN  30876<<ASSIGN  30876>>ASSIGN
     31080>>ASSIGN
VC$
     27552**DCL     21479--IMP-PTR 28805>>ASSIGN  28807>>ASSIGN  28901<<ASSIGN  29013>>DOWHILE 29014>>ASSIGN
     29015>>ASSIGN  29017>>ASSIGN  29017>>ASSIGN  29022>>ASSIGN  29023>>ASSIGN  29023>>ASSIGN  29253>>IF
     29256>>IF      29259>>IF      29265>>ASSIGN  29272>>ASSIGN  29274>>IF      29274>>IF      29280>>ASSIGN
     29340>>ASSIGN  29342>>ASSIGN  29363>>ASSIGN  29364>>ASSIGN  29370>>ASSIGN  29372>>ASSIGN  29446>>ASSIGN
     29447>>IF      29447>>IF      29447>>IF      29452>>ASSIGN  29505>>DOCASE  29507>>ASSIGN  29513>>ASSIGN
     29515>>ASSIGN  29518>>CALL    29518>>CALL    29519>>ASSIGN  29520>>ASSIGN  29521>>ASSIGN  29524>>ASSIGN
     29526>>ASSIGN  30279>>IF      30283>>ASSIGN  30289>>ASSIGN  30714>>ASSIGN  30715>>ASSIGN  30727>>IF
     30730>>ASSIGN  30731>>CALL    30731>>CALL    30733>>ASSIGN  30733>>ASSIGN  30733>>ASSIGN  30736>>ASSIGN
     30743>>IF      30760>>ASSIGN  30763>>ASSIGN  30773>>ASSIGN  30774>>ASSIGN  30775>>ASSIGN  30795>>ASSIGN
     30799>>CALL    30799>>CALL    30801>>ASSIGN  30814>>IF      30818>>IF      30826>>IF      30836>>IF
     30839>>ASSIGN  30889>>IF      30889>>IF      30909>>IF      30922>>IF      30940>>IF      30954>>IF
     30957>>ASSIGN  30981>>IF      30984>>IF      30987>>DOCASE  30996>>CALL    30998>>ASSIGN  30999>>IF
     31008>>CALL    31014>>ASSIGN  31016>>IF      31023>>IF      31026>>ASSIGN  31027>>CALL    31027>>CALL
     31029>>ASSIGN  31030>>ASSIGN  31031>>ASSIGN  31038>>ASSIGN  31038>>ASSIGN  31042>>ASSIGN  31044>>ASSIGN
     31047>>ASSIGN  31048>>CALL    31048>>CALL    31049>>ASSIGN  31050>>ASSIGN  31072>>ASSIGN  31072>>ASSIGN
     31082>>IF      31084>>ASSIGN  31086>>ASSIGN  31087>>ASSIGN  31089>>IF      31091>>ASSIGN  31148>>IF
     31152>>ASSIGN  31153>>ASSIGN  31155>>ASSIGN  31156>>ASSIGN  31157>>ASSIGN  31159>>IF      31162>>IF
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:334  
     31167>>ASSIGN  31168>>ASSIGN  31170>>ASSIGN  31171>>ASSIGN  31172>>ASSIGN  31174>>IF      31178>>ASSIGN
     31179>>ASSIGN  31181>>ASSIGN  31182>>ASSIGN  31183>>ASSIGN  31185>>IF      31193>>ASSIGN  31195>>IF
     31200>>ASSIGN  31201>>ASSIGN  31205>>ASSIGN  31207>>IF      31215>>ASSIGN  31217>>IF      31221>>ASSIGN
     31222>>ASSIGN  31224>>ASSIGN  31225>>ASSIGN  31226>>ASSIGN  31228>>IF      31232>>ASSIGN  31233>>ASSIGN
     31234>>IF      31240>>ASSIGN  31248>>IF      31248>>IF      31255>>ASSIGN
VC$CAL.CLDADR IN PROCEDURE Y$CHKPNDBITS
     31122**DCL     31126--REDEF   31126--REDEF
VC$CAL.CLGADR IN PROCEDURE Y$CHKPNDBITS
     31117**DCL     31121--REDEF   31122--REDEF
VC$CAL.FUNCTION IN PROCEDURE Y$CHKPNDBITS
     31116**DCL     31162>>IF
VC$CAL.X3S IN PROCEDURE Y$CHKPNDBITS
     31130**DCL     31140--REDEF
VC$CAL IN PROCEDURE Y$DECODE_FPT
     30581**DCL     30717>>ASSIGN  31026--ASSIGN  31029<<ASSIGN
VC$CAL.CLDADR IN PROCEDURE Y$DECODE_FPT
     30587**DCL     30591--REDEF   30591--REDEF
VC$CAL.CLGADR IN PROCEDURE Y$DECODE_FPT
     30582**DCL     30586--REDEF   30587--REDEF
VC$CAL.FUNCTION IN PROCEDURE Y$DECODE_FPT
     30581**DCL     31030<<ASSIGN
VC$CAL.X3 IN PROCEDURE Y$DECODE_FPT
     30605**DCL     31038<<ASSIGN
VC$CAL.X3S IN PROCEDURE Y$DECODE_FPT
     30595**DCL     30605--REDEF
VC$CLR IN PROCEDURE Y$DECODE_FPT
     30693**DCL     30962--ASSIGN  30964--IF
VC$CLR.CLDADR IN PROCEDURE Y$DECODE_FPT
     30695**DCL     30699--REDEF   30699--REDEF
VC$CLR.DIAG IN PROCEDURE Y$DECODE_FPT
     30694**DCL     30960>>ASSIGN
VC$CLR.USRDATBYTX IN PROCEDURE Y$DECODE_FPT
     30702**DCL     30962>>ASSIGN
VC$CLR.USRDATLNG IN PROCEDURE Y$DECODE_FPT
     30701**DCL     30964>>IF      30966>>ASSIGN
VC$DAT IN PROCEDURE Y$DECODE_FPT
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:335  
     30627**DCL     30830--ASSIGN  30831--ASSIGN
VC$DAT.M IN PROCEDURE Y$DECODE_FPT
     30628**DCL     30857>>IF      30872>>IF      30882>>IF      31076>>ASSIGN
VC$DAT.Q IN PROCEDURE Y$DECODE_FPT
     30627**DCL     31075>>ASSIGN
VC$INT IN PROCEDURE Y$DECODE_FPT
     30671**DCL     30927--ASSIGN  30928--IF
VC$INT.INTDATLNG IN PROCEDURE Y$DECODE_FPT
     30671**DCL     30928>>IF      30930>>ASSIGN
VC$RST.DIAG IN PROCEDURE Y$DECODE_FPT
     30650**DCL     30945>>ASSIGN
VC_CAL.CLDADR
     25839**DCL     25843--REDEF   25843--REDEF
VC_CAL.CLGADR
     25834**DCL     25838--REDEF   25839--REDEF
VC_CAL.X3S
     25847**DCL     25857--REDEF
VC_CLR.CLDADR
     25923**DCL     25927--REDEF   25927--REDEF
VC_INT
     25879**DCL     31190--ASSIGN  31191--ASSIGN
VC_INT.FUNCTION
     25879**DCL     31189<<ASSIGN
VC_RST
     25900**DCL     31202--ASSIGN  31203--ASSIGN  31212--ASSIGN  31213--ASSIGN
VC_RST.CAUSE
     25900**DCL     31200<<ASSIGN
VC_RST.DIAG
     25901**DCL     31201<<ASSIGN
VC_RST.FUNCTION
     25900**DCL     31199<<ASSIGN  31211<<ASSIGN
VDI$
     27554**DCL     21092--IMP-PTR 28779<<ASSIGN  28780>>ASSIGN  28933>>IF      28934>>ASSIGN  28940>>ASSIGN
     28941>>IF      28941>>IF      28941>>IF      28947>>ASSIGN  28948>>CALLBLT 28948>>CALLBLT 28951>>ASSIGN
     28957>>ASSIGN  28957>>ASSIGN  28957>>ASSIGN  28958>>ASSIGN  28959>>ASSIGN  29039>>ASSIGN  29040>>ASSIGN
     29041>>ASSIGN  29094>>IF      29098>>ASSIGN  29113>>IF      29114>>ASSIGN  29119>>IF      29165>>ASSIGN
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:336  
     29284>>IF      29294>>IF      29337>>IF      29416>>IF      29416>>IF      29423>>IF      29432>>ASSIGN
     29432>>ASSIGN  29433>>ASSIGN  29433>>ASSIGN  29434>>ASSIGN  29434>>ASSIGN  29459>>IF      29479>>IF
     29479>>IF      29483>>CALL    29487>>ASSIGN  29508>>IF      29543>>ASSIGN  29598>>IF      29598>>IF
     29716>>ASSIGN  29716>>ASSIGN  29716>>ASSIGN  29717>>IF      29717>>IF      29744>>ASSIGN  29760>>IF
     29766>>ASSIGN  29766>>ASSIGN  29766>>ASSIGN  29786>>ASSIGN  29793>>ASSIGN  29810>>CALL    29881>>CALL
     29910>>CALL    29929>>ASSIGN  29930>>ASSIGN  29934>>ASSIGN  29935>>ASSIGN  29939>>IF      29952>>IF
     29953>>ASSIGN  29954>>IF      29974>>ASSIGN  29975>>ASSIGN  29982>>ASSIGN  29984>>ASSIGN  29991>>ASSIGN
     29997>>ASSIGN  30008>>ASSIGN  30047>>ASSIGN  30107>>IF      30220>>ASSIGN  30226>>IF      30229>>CALL
     30233>>IF      30250>>ASSIGN  30257>>IF      30257>>IF      30259>>ASSIGN  30259>>ASSIGN  30268>>IF
     30333>>ASSIGN  30334>>ASSIGN  30341>>ASSIGN  30342>>ASSIGN  30365>>ASSIGN  30365>>ASSIGN  30365>>ASSIGN
     30391>>ASSIGN  30400>>IF      30413>>ASSIGN  30413>>ASSIGN  30415>>ASSIGN  30415>>ASSIGN  30416>>ASSIGN
     30416>>ASSIGN  30440>>CALL    30747>>IF      30897>>IF      30898>>ASSIGN  30899>>IF      31039>>IF
     31148>>IF      31159>>IF      31174>>IF      31185>>IF      31195>>IF      31207>>IF      31217>>IF
     31237>>IF
VDOVLP_ERR
     27693**DCL     30282<<ASSIGN  30285--ASSIGN  30718<<ASSIGN  30754--ASSIGN
VDOVLP_ERR.ERRCODE
     27724**DCL     30283<<ASSIGN  30746<<ASSIGN  30760>>ASSIGN  31019<<ASSIGN  31054<<ASSIGN
WRDSIZ2N IN PROCEDURE Y$DECODE_FPT
     30711**DCL     31065<<ASSIGN  31066<>CALL    31071>>ASSIGN
X28_PRTID
     25717**DCL     30780--ASSIGN  30782--ASSIGN
X29$
     27551**DCL     21358--IMP-PTR 27552--REDEF   27553--REDEF   28780<<ASSIGN  28781>>IF      28785>>IF
     28940>>ASSIGN  28948>>CALLBLT 28948>>CALLBLT 28951>>ASSIGN  28958>>ASSIGN  28958>>ASSIGN  28960>>IF
     28968>>ASSIGN  28969>>IF      28976>>ASSIGN  28980>>ASSIGN  28980>>ASSIGN  29031>>ASSIGN  29032>>ASSIGN
     29033>>ASSIGN  29035>>IF      29043>>ASSIGN  29044>>IF      29048>>ASSIGN  29048>>ASSIGN  29050>>CALL
     29051>>ASSIGN  29065>>ASSIGN  29076>>ASSIGN  29076>>ASSIGN  29089>>ASSIGN  29089>>ASSIGN  29090>>ASSIGN
     29091>>ASSIGN  29091>>ASSIGN  29091>>ASSIGN  29092>>ASSIGN  29119>>IF      29138>>ASSIGN  29139>>ASSIGN
     29142>>IF      29148>>CALL    29152>>ASSIGN  29153>>ASSIGN  29153>>ASSIGN  29207<>CALL    29220>>IF
     29222>>IF      29224>>IF      29227>>ASSIGN  29231>>ASSIGN  29232>>CALL    29236>>CALL    29284>>IF
     29294>>IF      29301>>ASSIGN  29303>>IF      29319>>ASSIGN  29335>>CALL    29377>>ASSIGN  29379>>ASSIGN
     29390>>CALL    29463>>IF      29463>>IF      29463>>IF      29463>>IF      29463>>IF      29469>>ASSIGN
     29470>>ASSIGN  29472>>ASSIGN  29473>>ASSIGN  29537>>IF      29537>>IF      29539>>CALL    29542>>ASSIGN
     29543>>ASSIGN  29544>>ASSIGN  29608>>IF      29617>>ASSIGN  29618>>IF      29620>>ASSIGN  29624>>IF
     29627>>IF      29627>>IF      29631>>ASSIGN  29635>>IF      29638>>ASSIGN  29654>>IF      29664>>IF
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:337  
     29664>>IF      29670>>ASSIGN  29672>>IF      29678>>ASSIGN  29688>>ASSIGN  29689>>IF      29691>>ASSIGN
     29693>>IF      29693>>IF      29695>>ASSIGN  29710>>IF      29710>>IF      29713>>ASSIGN  29717>>IF
     29744>>ASSIGN  29744>>ASSIGN  29745>>IF      29756>>ASSIGN  29778>>IF      29786>>ASSIGN  29827>>IF
     29841>>IF      29890>>ASSIGN  29913>>ASSIGN  29920>>IF      29923>>ASSIGN  29923>>ASSIGN  29924>>ASSIGN
     29927>>ASSIGN  29938>>ASSIGN  29938>>ASSIGN  29939>>IF      29968>>IF      29974>>ASSIGN  29975>>ASSIGN
     29982>>ASSIGN  29983>>ASSIGN  29984>>ASSIGN  29985>>IF      29991>>ASSIGN  29997>>ASSIGN  30037>>IF
     30064>>ASSIGN  30064>>ASSIGN  30072>>IF      30081>>ASSIGN  30088>>ASSIGN  30088>>ASSIGN  30100>>ASSIGN
     30112>>ASSIGN  30113>>ASSIGN  30114>>IF      30116>>ASSIGN  30182>>IF      30230>>ASSIGN  30315>>IF
     30317>>ASSIGN  30321>>ASSIGN  30353>>IF      30356>>ASSIGN  30357>>ASSIGN  30399>>ASSIGN  30426>>ASSIGN
     30441>>IF      30447>>ASSIGN  30456>>ASSIGN  30462>>CALL    30475>>ASSIGN  30476>>ASSIGN  30507>>CALL
Y$BFROTP IN PROCEDURE Y$DECODE_FPT
     31062**PROC    30875--CALL    30887--CALL
Y$BYT
     22518**DCL     29432<<ASSIGN  30413<<ASSIGN
Y$CAL_PAC
     30473**PROC    28904--CALL    29311--CALL    29450--CALL    29471--CALL    29549--CALL
Y$CHKPNDBITS
     31097**PROC    29341--CALL    29451--CALL
Y$DECODE_FPT
     30515**PROC    28806--CALL
Y$ER
     30488**PROC    29493--CALL    30044--CALL    30078--CALL
Y$SNCFLWCTRHLT
     30386**PROC    28967--CALL    29751--CALL
Y$SNCHLTOTP IN PROCEDURE Y$SNCFLWCTRHLT
     30429**ENTRY   29178--CALL
Y$SNDDAT IN PROCEDURE Y$CHKPNDBITS
     31260**PROC    31154--CALL    31169--CALL    31180--CALL    31223--CALL
Y@BYTSIZ
     27610**DCL     29016<<ASSIGN  29017>>ASSIGN  29018>>ASSIGN  29047<<ASSIGN  29048>>ASSIGN  29050>>CALL
     29052>>ASSIGN  29075<<ASSIGN  29076>>ASSIGN  29077>>CALL    29079>>ASSIGN  29766<<ASSIGN  29770>>IF
     29778>>IF      29793>>ASSIGN  29819<<ASSIGN  29825>>ASSIGN  29826<<ASSIGN  29826>>ASSIGN  29841>>IF
     29865<<ASSIGN  29866>>IF      29874>>ASSIGN  29904<<ASSIGN  29905>>IF      29908>>ASSIGN  30843<<ASSIGN
     30852>>ASSIGN  30852>>ASSIGN  30854>>ASSIGN  30855>>ASSIGN  30856>>ASSIGN  31064<<ASSIGN  31065>>ASSIGN
     31069>>ASSIGN  31072>>ASSIGN  31073>>ASSIGN  31074>>ASSIGN
Y@BYTSIZ2
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:338  
     27611**DCL     29825<<ASSIGN  29827>>IF
Y@DOGROUP
     29737**LABEL   29795--EXIT
Y@HLTOTP_ALL
     27792**DCL     30112<<ASSIGN  30114>>IF
Y@INDEX
     27561**DCL     30123<<ASSIGN  30130>>IF      30145>>ASSIGN  30153>>ASSIGN  30157>>IF      30164<<ASSIGN
     30164>>ASSIGN  30224<<ASSIGN  30226>>IF      30251<<ASSIGN  30255>>ASSIGN  30257>>IF      30259>>ASSIGN
Y@LOOP2
     30125**LABEL   30155--EXIT    30159--EXIT
Y_ILGDATSIZ
     27448**DCL     28815<>CALL
Y_LINKDEVSTT
     27387**DCL     29534<>CALL
Y_NOMEM
     27509**DCL     31060<>CALL
Y_NO_GET
     27326**DCL     29891<>CALL    29914<>CALL
Y_POWER_OF_2
     25715**DCL     29047>>ASSIGN  29075>>ASSIGN  29766>>ASSIGN  30224>>ASSIGN  30251>>ASSIGN
Y_UNKINPPRC
     27143**DCL     30172<>CALL
Y_UNKPRMID
     27204**DCL     30373<>CALL
Y_UNKSCHRSN
     27021**DCL     29409<>CALL
Y_UNKUSRFNC
     27265**DCL     30382<>CALL
Y_UNKVDIEVT
     27082**DCL     29575<>CALL
Y_VC_CAL IN PROCEDURE Y$DECODE_FPT
     30535**DCL     30717<<ASSIGN  30788--ASSIGN  30857--IF      30872--IF      30882--IF      30928--IF
     30930--ASSIGN  30945--ASSIGN  30960--ASSIGN  30962--ASSIGN  30964--IF      30966--ASSIGN  31075--ASSIGN
     31076--ASSIGN
Y_VC_CAL.CLDADR IN PROCEDURE Y$DECODE_FPT
     30541**DCL     30545--REDEF   30545--REDEF
PL6.E3A0      #001=KXX$VDI File=KXX$VDI.:E05TSI                                  WED 07/30/97 02:34 Page:339  
Y_VC_CAL.CLDADRLNG IN PROCEDURE Y$DECODE_FPT
     30536**DCL     30764>>ASSIGN
Y_VC_CAL.CLDADRSTRING IN PROCEDURE Y$DECODE_FPT
     30545**DCL     30765>>ASSIGN
Y_VC_CAL.CLGADR IN PROCEDURE Y$DECODE_FPT
     30536**DCL     30540--REDEF   30541--REDEF
Y_VC_CAL.FSTSLC IN PROCEDURE Y$DECODE_FPT
     30547**DCL     30768>>ASSIGN
Y_VC_CAL.FUNCTION IN PROCEDURE Y$DECODE_FPT
     30535**DCL     30720>>DOCASE
Y_VC_CAL.PROTOCOL IN PROCEDURE Y$DECODE_FPT
     30546**DCL     30770>>IF
Y_VC_CAL.REASSEMBLY IN PROCEDURE Y$DECODE_FPT
     30548**DCL     30791>>IF
Y_VC_CAL.RPRX3 IN PROCEDURE Y$DECODE_FPT
     30547**DCL     30774>>ASSIGN
Y_VC_CAL.RVS IN PROCEDURE Y$DECODE_FPT
     30548**DCL     30769>>ASSIGN
Y_VC_CAL.USRDATBYTX IN PROCEDURE Y$DECODE_FPT
     30560**DCL     30788>>ASSIGN
Y_VC_CAL.USRDATLNG IN PROCEDURE Y$DECODE_FPT
     30560**DCL     30776>>IF      30790>>ASSIGN
Y_VC_CAL.X3 IN PROCEDURE Y$DECODE_FPT
     30559**DCL     30775>>ASSIGN  31014>>ASSIGN
Y_VC_CAL.X3S IN PROCEDURE Y$DECODE_FPT
     30549**DCL     30559--REDEF
Y_VDI_LCL.BYTSIZ
     28358**DCL     29836<<ASSIGN  29852<<ASSIGN  29861<<ASSIGN  29865>>ASSIGN  29881>>CALL    29884>>IF
     29902<<ASSIGN  29904>>ASSIGN  29910>>CALL    29928>>ASSIGN  29938>>ASSIGN
Y_VDI_LCL.BYTSIZLOG2
     28360**DCL     29837<<ASSIGN  29853<<ASSIGN  29862<<ASSIGN  29903<<ASSIGN  29935>>ASSIGN
Y_VDI_LCL.SIGSIZ
     28362**DCL     29756<<ASSIGN  29805<<ASSIGN  29811>>IF      29866>>IF      29874<<ASSIGN  29905>>IF
     29908<<ASSIGN  29930>>ASSIGN
