
PL6.E3A0      #001=ZIM$ECKPT File=ZIM$CKROL.:ZIC0TSI                             FRI 09/05/97 12:36 Page:1    
        1        1        /*T***********************************************************/
        2        2        /*T*                                                         */
        3        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        4        4        /*T*                                                         */
        5        5        /*T***********************************************************/
        6        6        ZIM$ECKPT: PROC ALTRET
        7        7               AVOID($PR5,$PR6,$PR7);
        8        8        %INCLUDE ZI$GLOBAL;
        9      494            %GLOBALS;
       10      802        %INCLUDE ZI$USER;
       11      947            %IA;
       12      996        %INCLUDE ZI_ERRORS_C;
       13     1322    1   DCL PS0$ PTR SYMREF;
       14     1323    1   DCL PS2$ PTR SYMREF;
       15     1324    1   DCL ZIM$CHKPT ENTRY(1) ALTRET;
       16     1325    1   DCL ONEWORD UBIN(36) BASED;
       17     1326    1   DCL 1 DBSTATUS BASED(PS0$),
       18     1327    1         2 STATUS CHAR(7),
       19     1328    1         2 * CHAR(1);
       20     1329    1       CALL ZIM$CHKPT(PS2$->ONEWORD) ALTRET(ER_ALT);
       21     1330    1       CALL BINCHAR(DBSTATUS.STATUS,0);
       22     1331    1       IA.SYSERR=GLOBAL.RET.SYSERR#;
       23     1332    1       RETURN;
       24     1333    1   ER_ALT: CALL BINCHAR(DBSTATUS.STATUS,GLOBAL.RET.ERROR#+
       25     1334    1          GLOBAL.RET.STCD#*FTL#ERR#INCR);
       26     1335    1       IA.SYSERR=GLOBAL.RET.SYSERR#;
       27     1336    1       RETURN;
       28     1337    1   END ZIM$ECKPT;
       29     1338        %EOD;

PL6.E3A0      #001=ZIM$ECKPT File=ZIM$CKROL.:ZIC0TSI                             FRI 09/05/97 12:36 Page:2    
--  Include file information  --

   ZI_ERRORS_C.:ZIC0TOU  is referenced.
   ZI$USER.:ZIC0TOU  is referenced.
   ZI$GLOBAL.:ZIC0TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure ZIM$ECKPT.

   Procedure ZIM$ECKPT requires 33 words for executable code.
   Procedure ZIM$ECKPT requires 6 words of local(AUTO) storage.

PL6.E3A0      #001=ZIM$ECKPT File=ZIM$CKROL.:ZIC0TSI                             FRI 09/05/97 12:36 Page:3    

 Object Unit name= ZIM$ECKPT                                  File name= ZIM$CKROL.:ZIC0TOU
 UTS= SEP 05 '97 12:36:38.96 FRI                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none    33     41  ZIM$ECKPT
    1  RoData even  none     1      1  ZIM$ECKPT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes    yes     yes      XStd       0  ZIM$ECKPT

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           XStd      1 ZIM$CHKPT
                       nStd      0 X66_AUTO_0
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
r    GLOBAL$                               IA$                                   PS0$
     PS2$
PL6.E3A0      #001=ZIM$ECKPT File=ZIM$CKROL.:ZIC0TSI                             FRI 09/05/97 12:36 Page:4    


        1        1        /*T***********************************************************/
        2        2        /*T*                                                         */
        3        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        4        4        /*T*                                                         */
        5        5        /*T***********************************************************/
        6        6        ZIM$ECKPT: PROC ALTRET

      6  0 000000   000000 700200 xent  ZIM$ECKPT    TSX0  ! X66_AUTO_0
         0 000001   000006 000000                    ZERO    6,0

        7        7               AVOID($PR5,$PR6,$PR7);
        8        8        %INCLUDE ZI$GLOBAL;
        9      494            %GLOBALS;
       10      802        %INCLUDE ZI$USER;
       11      947            %IA;
       12      996        %INCLUDE ZI_ERRORS_C;
       13     1322    1   DCL PS0$ PTR SYMREF;
       14     1323    1   DCL PS2$ PTR SYMREF;
       15     1324    1   DCL ZIM$CHKPT ENTRY(1) ALTRET;
       16     1325    1   DCL ONEWORD UBIN(36) BASED;
       17     1326    1   DCL 1 DBSTATUS BASED(PS0$),
       18     1327    1         2 STATUS CHAR(7),
       19     1328    1         2 * CHAR(1);
       20     1329    1       CALL ZIM$CHKPT(PS2$->ONEWORD) ALTRET(ER_ALT);

   1329  0 000002   000000 630400 xsym               EPPR0   PS2$
         0 000003   000000 631400 1                  EPPR1   0
         0 000004   000000 701000 xent               TSX1    ZIM$CHKPT
         0 000005   000022 702000 0                  TSX2    ER_ALT

       21     1330    1       CALL BINCHAR(DBSTATUS.STATUS,0);

   1330  0 000006   000000 235003                    LDA     0,DU
         0 000007   000044 773000                    LRL     36
         0 000010   200004 757100                    STAQ    4,,AUTO
         0 000011   000000 470400 xsym               LDP0    PS0$
PL6.E3A0      #001=ZIM$ECKPT File=ZIM$CKROL.:ZIC0TSI                             FRI 09/05/97 12:36 Page:5    
         0 000012   000100 301500                    BTD
         0 000013   200004 000010                    NDSC9   4,,AUTO                  cn=0,s=lsgnf,sf=0,n=8
         0 000014   000000 030007                    NDSC9   0,,PR0                   cn=0,s=nosgn,sf=0,n=7

       22     1331    1       IA.SYSERR=GLOBAL.RET.SYSERR#;

   1331  0 000015   000000 470400 xsym               LDP0    GLOBAL$
         0 000016   000007 236100                    LDQ     7,,PR0
         0 000017   000000 471400 xsym               LDP1    IA$
         0 000020   100005 756100                    STQ     5,,PR1

       23     1332    1       RETURN;

   1332  0 000021   000000 702200 xent               TSX2  ! X66_ARET

       24     1333    1   ER_ALT: CALL BINCHAR(DBSTATUS.STATUS,GLOBAL.RET.ERROR#+

   1333  0 000022   000000 470400 xsym  ER_ALT       LDP0    GLOBAL$
         0 000023   000014 236100                    LDQ     12,,PR0
         0 000024   777777 376007                    ANQ     -1,DL
         0 000025   303240 402007                    MPY     100000,DL
         0 000026   000006 036100                    ADLQ    6,,PR0
         0 000027   000000 235003                    LDA     0,DU
         0 000030   200004 757100                    STAQ    4,,AUTO
         0 000031   000000 471400 xsym               LDP1    PS0$
         0 000032   000100 301500                    BTD
         0 000033   200004 000010                    NDSC9   4,,AUTO                  cn=0,s=lsgnf,sf=0,n=8
         0 000034   100000 030007                    NDSC9   0,,PR1                   cn=0,s=nosgn,sf=0,n=7

       25     1334    1          GLOBAL.RET.STCD#*FTL#ERR#INCR);
       26     1335    1       IA.SYSERR=GLOBAL.RET.SYSERR#;

   1335  0 000035   000007 236100                    LDQ     7,,PR0
         0 000036   000000 471400 xsym               LDP1    IA$
         0 000037   100005 756100                    STQ     5,,PR1

       27     1336    1       RETURN;
PL6.E3A0      #001=ZIM$ECKPT File=ZIM$CKROL.:ZIC0TSI                             FRI 09/05/97 12:36 Page:6    

   1336  0 000040   000000 702200 xent               TSX2  ! X66_ARET

(unnamed)
 Sect OctLoc
   1     000   000001 000000                                                    ....
       28     1337    1   END ZIM$ECKPT;
       29     1338        %EOD;

PL6.E3A0      #001=ZIM$ECKPT File=ZIM$CKROL.:ZIC0TSI                             FRI 09/05/97 12:36 Page:7    
--  Include file information  --

   ZI_ERRORS_C.:ZIC0TOU  is referenced.
   ZI$USER.:ZIC0TOU  is referenced.
   ZI$GLOBAL.:ZIC0TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure ZIM$ECKPT.

   Procedure ZIM$ECKPT requires 33 words for executable code.
   Procedure ZIM$ECKPT requires 6 words of local(AUTO) storage.
PL6.E3A0      #001=ZIM$ECKPT File=ZIM$CKROL.:ZIC0TSI                             FRI 09/05/97 12:36 Page:8    
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=ZIM$ECKPT File=ZIM$CKROL.:ZIC0TSI                             FRI 09/05/97 12:36 Page:9    
          MINI XREF LISTING

DBSTATUS.STATUS
      1327**DCL      1330<<CALLBLT  1333<<CALLBLT
ER_ALT
      1333**LABEL    1329--CALLALT
GLOBAL.ACTIVE.DBCB$
       501**DCL       502--REDEF
GLOBAL.ACTIVE.SSS$
       497**DCL       498--REDEF
GLOBAL.KEY
       705**DCL       708--REDEF
GLOBAL.PARAN.TRACE.MODE
       580**DCL       587--REDEF
GLOBAL.PRINTBUF.BUFFER
       739**DCL       740--REDEF     741--REDEF     742--REDEF
GLOBAL.PRINTBUF.ERR.V
       744**DCL       747--REDEF     748--REDEF     749--REDEF
GLOBAL.RET.ERROR#
       515**DCL      1333>>CALLBLT
GLOBAL.RET.STCD#
       522**DCL      1333>>CALLBLT
GLOBAL.RET.SYSERR#
       516**DCL      1331>>ASSIGN   1335>>ASSIGN
GLOBAL$
       799**DCL       495--IMP-PTR  1331>>ASSIGN   1333>>CALLBLT  1333>>CALLBLT  1335>>ASSIGN
IA.SNAME
       972**DCL       973--REDEF
IA.SSDT
       984**DCL       985--REDEF
IA.SSNAME
       975**DCL       976--REDEF
IA.SYSERR
       958**DCL      1331<<ASSIGN   1335<<ASSIGN
PL6.E3A0      #001=ZIM$ECKPT File=ZIM$CKROL.:ZIC0TSI                             FRI 09/05/97 12:36 Page:10   
IA$
       986**DCL       951--IMP-PTR  1331>>ASSIGN   1335>>ASSIGN
ONEWORD
      1325**DCL      1329<>CALL
PS0$
      1322**DCL      1326--IMP-PTR  1330>>CALLBLT  1333>>CALLBLT
PS2$
      1323**DCL      1329>>CALL
ZIM$CHKPT
      1324**DCL-ENT  1329--CALL

PL6.E3A0      #002=ZIM$CHKPT File=ZIM$CKROL.:ZIC0TSI                             FRI 09/05/97 12:36 Page:11   
       30        1        /*T***********************************************************/
       31        2        /*T*                                                         */
       32        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
       33        4        /*T*                                                         */
       34        5        /*T***********************************************************/
       35        6        ZIM$CHKPT: PROC(CKPTNO) ALTRET
       36        7               AVOID($PR5,$PR6,$PR7);
       37        8        %INCLUDE ZI$GLOBAL;
       38      494            %GLOBALS;
       39      802        %INCLUDE ZI$USER;
       40      947            %IA;
       41      996        %INCLUDE CP_6_SUBS;
       42     1536    1   DCL ZIM$JCKPT ENTRY(1);
       43     1537    1   DCL ZIM$NULL ENTRY ALTRET;
       44     1538    1   DCL ZIO$FLUSH ENTRY(1) ALTRET;
       45     1539    1   DCL ERROR UBIN(36);
       46     1540    1   DCL CKPTNO UBIN(36);
       47     1541    1       ERROR=0;
       48     1542    1       IF ~GLOBAL.PENDING.XCON THEN
       49     1543    1           GLOBAL.ROLLADDR=IA.UCALL_LOC;
       50     1544    1       CALL ZIO$FLUSH(%NO#) ALTRET(ER_ALT);
       51     1545    1       IF CKPTNO=0 THEN
       52     1546    2       DO;
       53     1547    2           GLOBAL.CKPTNO=GLOBAL.CKPTNO-1;
       54     1548    2           CALL ZIM$JCKPT(GLOBAL.CKPTNO);
       55     1549    2           END;
       56     1550    1       ELSE
       57     1551    1           CALL ZIM$JCKPT(CKPTNO);
       58     1552        /*       Clear outstanding ENQ's and null currencies */
       59     1553    1       CALL ZIM$NULL ALTRET(ER_ALT);
       60     1554    1       RETURN;
       61     1555    1   ER_ALT: ;
       62     1556            %DBALT;
       63     1570    1   END ZIM$CHKPT;
       64     1571        %EOD;

PL6.E3A0      #002=ZIM$CHKPT File=ZIM$CKROL.:ZIC0TSI                             FRI 09/05/97 12:36 Page:12   
--  Include file information  --

   CP_6_SUBS.:LIB_E05  is referenced.
   ZI$USER.:ZIC0TOU  is referenced.
   ZI$GLOBAL.:ZIC0TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure ZIM$CHKPT.

   Procedure ZIM$CHKPT requires 57 words for executable code.
   Procedure ZIM$CHKPT requires 8 words of local(AUTO) storage.

PL6.E3A0      #002=ZIM$CHKPT File=ZIM$CKROL.:ZIC0TSI                             FRI 09/05/97 12:36 Page:13   

 Object Unit name= ZIM$CHKPT                                  File name= ZIM$CKROL.:ZIC0TOU
 UTS= SEP 05 '97 12:36:42.88 FRI                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none    57     71  ZIM$CHKPT
    1  RoData even  none     3      3  ZIM$CHKPT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes    yes     yes      XStd       1  ZIM$CHKPT

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           XStd      1 ZIO$FLUSH
         yes           XStd      1 ZIM$JCKPT
         yes           XStd      0 ZIB$ERR
 yes     yes           XStd      0 ZIM$NULL
                       nStd      0 X66_AUTO_1
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
r    GLOBAL$                               IA$
PL6.E3A0      #002=ZIM$CHKPT File=ZIM$CKROL.:ZIC0TSI                             FRI 09/05/97 12:36 Page:14   

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #002=ZIM$CHKPT File=ZIM$CKROL.:ZIC0TSI                             FRI 09/05/97 12:36 Page:15   


       30        1        /*T***********************************************************/
       31        2        /*T*                                                         */
       32        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
       33        4        /*T*                                                         */
       34        5        /*T***********************************************************/
       35        6        ZIM$CHKPT: PROC(CKPTNO) ALTRET

      6  0 000000   000000 700200 xent  ZIM$CHKPT    TSX0  ! X66_AUTO_1
         0 000001   000010 000001                    ZERO    8,1

       36        7               AVOID($PR5,$PR6,$PR7);
       37        8        %INCLUDE ZI$GLOBAL;
       38      494            %GLOBALS;
       39      802        %INCLUDE ZI$USER;
       40      947            %IA;
       41      996        %INCLUDE CP_6_SUBS;
       42     1536    1   DCL ZIM$JCKPT ENTRY(1);
       43     1537    1   DCL ZIM$NULL ENTRY ALTRET;
       44     1538    1   DCL ZIO$FLUSH ENTRY(1) ALTRET;
       45     1539    1   DCL ERROR UBIN(36);
       46     1540    1   DCL CKPTNO UBIN(36);
       47     1541    1       ERROR=0;

   1541  0 000002   200004 450100                    STZ     ERROR,,AUTO

       48     1542    1       IF ~GLOBAL.PENDING.XCON THEN

   1542  0 000003   000000 470400 xsym               LDP0    GLOBAL$
         0 000004   000017 236100                    LDQ     15,,PR0
         0 000005   000006 736000                    QLS     6
         0 000006   400000 376003                    ANQ     -131072,DU
         0 000007   400000 676003                    ERQ     -131072,DU
         0 000010   000015 600000 0                  TZE     s:1544

       49     1543    1           GLOBAL.ROLLADDR=IA.UCALL_LOC;

PL6.E3A0      #002=ZIM$CHKPT File=ZIM$CKROL.:ZIC0TSI                             FRI 09/05/97 12:36 Page:16   
   1543  0 000011   000000 471400 xsym               LDP1    IA$
         0 000012   100006 236100                    LDQ     6,,PR1
         0 000013   777777 376007                    ANQ     -1,DL
         0 000014   002612 756100                    STQ     1418,,PR0

       50     1544    1       CALL ZIO$FLUSH(%NO#) ALTRET(ER_ALT);

   1544  0 000015   000002 630400 1                  EPPR0   2
         0 000016   000000 631400 1                  EPPR1   0
         0 000017   000000 701000 xent               TSX1    ZIO$FLUSH
         0 000020   000050 702000 0                  TSX2    ER_ALT

       51     1545    1       IF CKPTNO=0 THEN

   1545  0 000021   200003 470500                    LDP0    @CKPTNO,,AUTO
         0 000022   000000 235100                    LDA     0,,PR0
         0 000023   000040 601000 0                  TNZ     s:1551

       52     1546    2       DO;

       53     1547    2           GLOBAL.CKPTNO=GLOBAL.CKPTNO-1;

   1547  0 000024   000000 471400 xsym               LDP1    GLOBAL$
         0 000025   102611 235100                    LDA     1417,,PR1
         0 000026   000001 135007                    SBLA    1,DL
         0 000027   102611 755100                    STA     1417,,PR1

       54     1548    2           CALL ZIM$JCKPT(GLOBAL.CKPTNO);

   1548  0 000030   000000 236000 xsym               LDQ     GLOBAL$
         0 000031   002611 036003                    ADLQ    1417,DU
         0 000032   200006 756100                    STQ     ERROR+2,,AUTO
         0 000033   200006 630500                    EPPR0   ERROR+2,,AUTO
         0 000034   000000 631400 1                  EPPR1   0
         0 000035   000000 701000 xent               TSX1    ZIM$JCKPT
         0 000036   000000 011000                    NOP     0

PL6.E3A0      #002=ZIM$CHKPT File=ZIM$CKROL.:ZIC0TSI                             FRI 09/05/97 12:36 Page:17   
       55     1549    2           END;

   1549  0 000037   000044 710000 0                  TRA     s:1553

       56     1550    1       ELSE
       57     1551    1           CALL ZIM$JCKPT(CKPTNO);

   1551  0 000040   200003 630500                    EPPR0   @CKPTNO,,AUTO
         0 000041   000000 631400 1                  EPPR1   0
         0 000042   000000 701000 xent               TSX1    ZIM$JCKPT
         0 000043   000000 011000                    NOP     0

       58     1552        /*       Clear outstanding ENQ's and null currencies */
       59     1553    1       CALL ZIM$NULL ALTRET(ER_ALT);

   1553  0 000044   000001 631400 1                  EPPR1   1
         0 000045   000000 701000 xent               TSX1    ZIM$NULL
         0 000046   000050 702000 0                  TSX2    ER_ALT

       60     1554    1       RETURN;

   1554  0 000047   000000 702200 xent               TSX2  ! X66_ARET

   1545  0 000050                       ER_ALT       null
       61     1555    1   ER_ALT: ;
       62     1556            %DBALT;

   1557  0 000050   000000 470400 xsym               LDP0    GLOBAL$
         0 000051   000006 235100                    LDA     6,,PR0
         0 000052   000061 601000 0                  TNZ     s:1565

   1559  0 000053   000010 450100                    STZ     8,,PR0

   1560  0 000054   000012 450100                    STZ     10,,PR0

   1561  0 000055   000013 450100                    STZ     11,,PR0

PL6.E3A0      #002=ZIM$CHKPT File=ZIM$CKROL.:ZIC0TSI                             FRI 09/05/97 12:36 Page:18   
   1562  0 000056   000011 450100                    STZ     9,,PR0

   1563  0 000057   200004 236100                    LDQ     ERROR,,AUTO
         0 000060   000006 756100                    STQ     6,,PR0

   1565  0 000061   000006 235100                    LDA     6,,PR0
         0 000062   303240 115007                    CMPA    100000,DL
         0 000063   000065 603000 0                  TRC     s:1568

   1566  0 000064   000000 702200 xent               TSX2  ! X66_AALT

   1568  0 000065   000001 631400 1                  EPPR1   1
         0 000066   000000 701000 xent               TSX1    ZIB$ERR
         0 000067   000000 011000                    NOP     0

       63     1570    1   END ZIM$CHKPT;

   1570  0 000070   000000 702200 xent               TSX2  ! X66_ARET

(unnamed)
 Sect OctLoc
   1     000   000001 000000   000000 000000   000001 006000                    ............
       64     1571        %EOD;

PL6.E3A0      #002=ZIM$CHKPT File=ZIM$CKROL.:ZIC0TSI                             FRI 09/05/97 12:36 Page:19   
--  Include file information  --

   CP_6_SUBS.:LIB_E05  is referenced.
   ZI$USER.:ZIC0TOU  is referenced.
   ZI$GLOBAL.:ZIC0TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure ZIM$CHKPT.

   Procedure ZIM$CHKPT requires 57 words for executable code.
   Procedure ZIM$CHKPT requires 8 words of local(AUTO) storage.
PL6.E3A0      #002=ZIM$CHKPT File=ZIM$CKROL.:ZIC0TSI                             FRI 09/05/97 12:36 Page:20   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=ZIM$CHKPT File=ZIM$CKROL.:ZIC0TSI                             FRI 09/05/97 12:36 Page:21   
          MINI XREF LISTING

CKPTNO
      1540**DCL         6--PROC     1545>>IF       1551<>CALL
ERROR
      1539**DCL      1541<<ASSIGN   1563>>ASSIGN
ER_ALT
      1545**LABEL    1544--CALLALT  1553--CALLALT
GLOBAL.ACTIVE.DBCB$
       501**DCL       502--REDEF
GLOBAL.ACTIVE.SSS$
       497**DCL       498--REDEF
GLOBAL.CKPTNO
       691**DCL      1547<<ASSIGN   1547>>ASSIGN   1548<>CALL
GLOBAL.KEY
       705**DCL       708--REDEF
GLOBAL.PARAN.TRACE.MODE
       580**DCL       587--REDEF
GLOBAL.PENDING.XCON
       534**DCL      1542>>IF
GLOBAL.PRINTBUF.BUFFER
       739**DCL       740--REDEF     741--REDEF     742--REDEF
GLOBAL.PRINTBUF.ERR.V
       744**DCL       747--REDEF     748--REDEF     749--REDEF
GLOBAL.RET.AC#
       517**DCL      1559<<ASSIGN
GLOBAL.RET.ERROR#
       515**DCL      1557>>IF       1563<<ASSIGN   1565>>IF
GLOBAL.RET.FR#
       518**DCL      1562<<ASSIGN
GLOBAL.RET.RC#
       520**DCL      1561<<ASSIGN
GLOBAL.RET.SC#
       519**DCL      1560<<ASSIGN
PL6.E3A0      #002=ZIM$CHKPT File=ZIM$CKROL.:ZIC0TSI                             FRI 09/05/97 12:36 Page:22   
GLOBAL.ROLLADDR
       692**DCL      1543<<ASSIGN
GLOBAL$
       799**DCL       495--IMP-PTR  1542>>IF       1543>>ASSIGN   1547>>ASSIGN   1547>>ASSIGN   1548>>CALL
      1557>>IF       1559>>ASSIGN   1560>>ASSIGN   1561>>ASSIGN   1562>>ASSIGN   1563>>ASSIGN   1565>>IF
IA.SNAME
       972**DCL       973--REDEF
IA.SSDT
       984**DCL       985--REDEF
IA.SSNAME
       975**DCL       976--REDEF
IA.UCALL_LOC
       960**DCL      1543>>ASSIGN
IA$
       986**DCL       951--IMP-PTR  1543>>ASSIGN
ZIB$ERR
       800**DCL-ENT  1568--CALL
ZIM$JCKPT
      1536**DCL-ENT  1548--CALL     1551--CALL
ZIM$NULL
      1537**DCL-ENT  1553--CALL
ZIO$FLUSH
      1538**DCL-ENT  1544--CALL

PL6.E3A0      #003=ZIM$EROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:23   
       65        1        /*T***********************************************************/
       66        2        /*T*                                                         */
       67        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
       68        4        /*T*                                                         */
       69        5        /*T***********************************************************/
       70        6        ZIM$EROL: PROC ALTRET
       71        7               AVOID($PR5,$PR6,$PR7);
       72        8    1   DCL ZIM$PROL ENTRY ALTRET;
       73        9    1   DCL ZIO$FLUSH ENTRY(1) ALTRET;
       74       10    1   DCL PS0$ PTR SYMREF;
       75       11    1   DCL B$JIT$ PTR SYMREF;
       76       12    1   DCL 1 DBSTATUS BASED(PS0$),
       77       13    1         2 STATUS CHAR(7),
       78       14    1         2 * CHAR(1);
       79       15    1   DCL ROLLMSG CHAR(37) CONSTANT INIT('Rollback unsuccessful during recovery');
       80       16        %INCLUDE CP_6;
       81       97         %FPT_KEYIN(FPTN=FPT$KEYIN,STCLASS=BASED);
       82      116        %INCLUDE CP_6_SUBS;
       83      656        %INCLUDE ZI$GLOBAL;
       84     1142        %GLOBALS;
       85     1450        %INCLUDE ZI_ERRORS_C;
       86     1776        %INCLUDE ZI$USER;
       87     1921         %IA;
       88     1970        %INCLUDE B$JIT;
       89     2260
       90     2261
       91     2262    1       CALL ZIO$FLUSH(%YES#) ALTRET(ALT);
       92     2263    2       IF B$JIT$->B$JIT.SYSID=1 AND B$JIT$->B$JIT.USER=1 THEN DO;
       93     2264    2           GLOBAL.PENDING.RECVRY = '1'B;
       94     2265    2           GLOBAL.PENDING.RELEASE=%YES#;
       95     2266    2           END;
       96     2267    2       IF GLOBAL.PENDING.RECVRY OR GLOBAL.UPDATE.TJRNL>0 THEN DO;
       97     2268    2           CALL ZIM$PROL ALTRET(ER_PROL);
       98     2269    2           IF NOT GLOBAL.PENDING.RECVRY THEN
       99     2270    2               CALL BINCHAR(DBSTATUS.STATUS,GLOBAL.RET.ERROR#+
      100     2271    2                  GLOBAL.RET.STCD#*FTL#ERR#INCR);
      101     2272    2           END;
PL6.E3A0      #003=ZIM$EROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:24   
      102     2273    2       ELSE DO; /* User called Rollback when not valid. */
      103     2274    2           GLOBAL.RET.ERROR#=ERR#RL#TJNA;
      104     2275    2           CALL BINCHAR(DBSTATUS.STATUS,GLOBAL.RET.ERROR#+
      105     2276    2              GLOBAL.RET.STCD#*FTL#ERR#INCR);
      106     2277    2           IA.SYSERR=GLOBAL.RET.SYSERR#;
      107     2278    2           END;
      108     2279    1       RETURN;
      109     2280    1   ER_PROL: ;
      110     2281    1   ALT: ;
      111     2282    2       IF ~GLOBAL.PENDING.RECVRY THEN DO;
      112     2283    2           CALL BINCHAR(DBSTATUS.STATUS,GLOBAL.RET.ERROR#+
      113     2284    2              GLOBAL.RET.STCD#*FTL#ERR#INCR);
      114     2285    2           IA.SYSERR=GLOBAL.RET.SYSERR#;
      115     2286    2           END;
      116     2287    2       ELSE DO;
      117     2288    2           GLOBAL.PRINTBUF.BUFFER=ROLLMSG;
      118     2289    2           CALL M$KEYIN(GLOBAL.KEYIN$->FPT$KEYIN);
      119     2290    2           END;
      120     2291    1       CALL M$ERR;
      121     2292    1   END ZIM$EROL;
      122     2293        %EOD;

PL6.E3A0      #003=ZIM$EROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:25   
--  Include file information  --

   B$JIT.:LIB_E05  cannot be made into a system file and is referenced.
   ZI$USER.:ZIC0TOU  is referenced.
   ZI_ERRORS_C.:ZIC0TOU  is referenced.
   ZI$GLOBAL.:ZIC0TOU  is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure ZIM$EROL.

   Procedure ZIM$EROL requires 89 words for executable code.
   Procedure ZIM$EROL requires 6 words of local(AUTO) storage.

PL6.E3A0      #003=ZIM$EROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:26   

 Object Unit name= ZIM$EROL                                   File name= ZIM$CKROL.:ZIC0TOU
 UTS= SEP 05 '97 12:36:47.84 FRI                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS     10     12  ZIM$EROL
    1   DCB   even  none     0      0  M$UC
    2   Proc  even  none    89    131  ZIM$EROL
    3  RoData even  none     4      4  ZIM$EROL

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     2      0   yes    yes     yes      XStd       0  ZIM$EROL

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           XStd      1 ZIO$FLUSH
 yes     yes           XStd      0 ZIM$PROL
                       nStd      0 X66_AUTO_0
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     PS0$                                  B$JIT$                                M$UC
r    GLOBAL$                               IA$
PL6.E3A0      #003=ZIM$EROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:27   

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #003=ZIM$EROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:28   


       65        1        /*T***********************************************************/
       66        2        /*T*                                                         */
       67        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
       68        4        /*T*                                                         */
       69        5        /*T***********************************************************/
       70        6        ZIM$EROL: PROC ALTRET

      6  2 000000   000000 700200 xent  ZIM$EROL     TSX0  ! X66_AUTO_0
         2 000001   000006 000000                    ZERO    6,0

       71        7               AVOID($PR5,$PR6,$PR7);
       72        8    1   DCL ZIM$PROL ENTRY ALTRET;
       73        9    1   DCL ZIO$FLUSH ENTRY(1) ALTRET;
       74       10    1   DCL PS0$ PTR SYMREF;
       75       11    1   DCL B$JIT$ PTR SYMREF;
       76       12    1   DCL 1 DBSTATUS BASED(PS0$),
       77       13    1         2 STATUS CHAR(7),
       78       14    1         2 * CHAR(1);
       79       15    1   DCL ROLLMSG CHAR(37) CONSTANT INIT('Rollback unsuccessful during recovery');
       80       16        %INCLUDE CP_6;
       81       97         %FPT_KEYIN(FPTN=FPT$KEYIN,STCLASS=BASED);
       82      116        %INCLUDE CP_6_SUBS;
       83      656        %INCLUDE ZI$GLOBAL;
       84     1142        %GLOBALS;
       85     1450        %INCLUDE ZI_ERRORS_C;
       86     1776        %INCLUDE ZI$USER;
       87     1921         %IA;
       88     1970        %INCLUDE B$JIT;
       89     2260
       90     2261
       91     2262    1       CALL ZIO$FLUSH(%YES#) ALTRET(ALT);

   2262  2 000002   000002 630400 3                  EPPR0   2
         2 000003   000000 631400 3                  EPPR1   0
         2 000004   000000 701000 xent               TSX1    ZIO$FLUSH
         2 000005   000073 702000 2                  TSX2    ER_PROL
PL6.E3A0      #003=ZIM$EROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:29   

       92     2263    2       IF B$JIT$->B$JIT.SYSID=1 AND B$JIT$->B$JIT.USER=1 THEN DO;

   2263  2 000006   000000 470400 xsym               LDP0    B$JIT$
         2 000007   000000 720100                    LXL0    0,,PR0
         2 000010   000001 100003                    CMPX0   1,DU
         2 000011   000023 601000 2                  TNZ     s:2267
         2 000012   000000 236100                    LDQ     0,,PR0
         2 000013   000777 376003                    ANQ     511,DU
         2 000014   000001 116003                    CMPQ    1,DU
         2 000015   000023 601000 2                  TNZ     s:2267

       93     2264    2           GLOBAL.PENDING.RECVRY = '1'B;

   2264  2 000016   000000 471400 xsym               LDP1    GLOBAL$
         2 000017   010000 236003                    LDQ     4096,DU
         2 000020   100017 256100                    ORSQ    15,,PR1

       94     2265    2           GLOBAL.PENDING.RELEASE=%YES#;

   2265  2 000021   400000 236003                    LDQ     -131072,DU
         2 000022   100017 256100                    ORSQ    15,,PR1

       95     2266    2           END;

       96     2267    2       IF GLOBAL.PENDING.RECVRY OR GLOBAL.UPDATE.TJRNL>0 THEN DO;

   2267  2 000023   000000 471400 xsym               LDP1    GLOBAL$
         2 000024   100017 236100                    LDQ     15,,PR1
         2 000025   010000 316003                    CANQ    4096,DU
         2 000026   000031 601000 2                  TNZ     s:2268
         2 000027   102613 220100                    LDX0    1419,,PR1
         2 000030   000053 600000 2                  TZE     s:2274

       97     2268    2           CALL ZIM$PROL ALTRET(ER_PROL);

   2268  2 000031   000003 631400 3                  EPPR1   3
PL6.E3A0      #003=ZIM$EROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:30   
         2 000032   000000 701000 xent               TSX1    ZIM$PROL
         2 000033   000073 702000 2                  TSX2    ER_PROL

       98     2269    2           IF NOT GLOBAL.PENDING.RECVRY THEN

   2269  2 000034   000000 470400 xsym               LDP0    GLOBAL$
         2 000035   000017 236100                    LDQ     15,,PR0
         2 000036   010000 316003                    CANQ    4096,DU
         2 000037   000072 601000 2                  TNZ     s:2279

       99     2270    2               CALL BINCHAR(DBSTATUS.STATUS,GLOBAL.RET.ERROR#+

   2270  2 000040   000014 236100                    LDQ     12,,PR0
         2 000041   777777 376007                    ANQ     -1,DL
         2 000042   303240 402007                    MPY     100000,DL
         2 000043   000006 036100                    ADLQ    6,,PR0
         2 000044   000000 235003                    LDA     0,DU
         2 000045   200004 757100                    STAQ    4,,AUTO
         2 000046   000000 471400 xsym               LDP1    PS0$
         2 000047   000100 301500                    BTD
         2 000050   200004 000010                    NDSC9   4,,AUTO                  cn=0,s=lsgnf,sf=0,n=8
         2 000051   100000 030007                    NDSC9   0,,PR1                   cn=0,s=nosgn,sf=0,n=7

      100     2271    2                  GLOBAL.RET.STCD#*FTL#ERR#INCR);
      101     2272    2           END;

   2272  2 000052   000072 710000 2                  TRA     s:2279

      102     2273    2       ELSE DO; /* User called Rollback when not valid. */

      103     2274    2           GLOBAL.RET.ERROR#=ERR#RL#TJNA;

   2274  2 000053   210723 235007                    LDA     70099,DL
         2 000054   100006 755100                    STA     6,,PR1

      104     2275    2           CALL BINCHAR(DBSTATUS.STATUS,GLOBAL.RET.ERROR#+

PL6.E3A0      #003=ZIM$EROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:31   
   2275  2 000055   100014 236100                    LDQ     12,,PR1
         2 000056   777777 376007                    ANQ     -1,DL
         2 000057   303240 402007                    MPY     100000,DL
         2 000060   100006 036100                    ADLQ    6,,PR1
         2 000061   000000 235003                    LDA     0,DU
         2 000062   200004 757100                    STAQ    4,,AUTO
         2 000063   000000 473400 xsym               LDP3    PS0$
         2 000064   000100 301500                    BTD
         2 000065   200004 000010                    NDSC9   4,,AUTO                  cn=0,s=lsgnf,sf=0,n=8
         2 000066   300000 030007                    NDSC9   0,,PR3                   cn=0,s=nosgn,sf=0,n=7

      105     2276    2              GLOBAL.RET.STCD#*FTL#ERR#INCR);
      106     2277    2           IA.SYSERR=GLOBAL.RET.SYSERR#;

   2277  2 000067   100007 236100                    LDQ     7,,PR1
         2 000070   000000 470400 xsym               LDP0    IA$
         2 000071   000005 756100                    STQ     5,,PR0

      107     2278    2           END;

      108     2279    1       RETURN;

   2279  2 000072   000000 702200 xent               TSX2  ! X66_ARET

      109     2280    1   ER_PROL: ;

   2280  2 000073                       ER_PROL      null
   2280  2 000073                       ALT          null
      110     2281    1   ALT: ;
      111     2282    2       IF ~GLOBAL.PENDING.RECVRY THEN DO;

   2282  2 000073   000000 470400 xsym               LDP0    GLOBAL$
         2 000074   000017 236100                    LDQ     15,,PR0
         2 000075   000005 736000                    QLS     5
         2 000076   400000 376003                    ANQ     -131072,DU
         2 000077   400000 676003                    ERQ     -131072,DU
         2 000100   000117 600000 2                  TZE     s:2288
PL6.E3A0      #003=ZIM$EROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:32   

      112     2283    2           CALL BINCHAR(DBSTATUS.STATUS,GLOBAL.RET.ERROR#+

   2283  2 000101   000014 236100                    LDQ     12,,PR0
         2 000102   777777 376007                    ANQ     -1,DL
         2 000103   303240 402007                    MPY     100000,DL
         2 000104   000006 036100                    ADLQ    6,,PR0
         2 000105   000000 235003                    LDA     0,DU
         2 000106   200004 757100                    STAQ    4,,AUTO
         2 000107   000000 471400 xsym               LDP1    PS0$
         2 000110   000100 301500                    BTD
         2 000111   200004 000010                    NDSC9   4,,AUTO                  cn=0,s=lsgnf,sf=0,n=8
         2 000112   100000 030007                    NDSC9   0,,PR1                   cn=0,s=nosgn,sf=0,n=7

      113     2284    2              GLOBAL.RET.STCD#*FTL#ERR#INCR);
      114     2285    2           IA.SYSERR=GLOBAL.RET.SYSERR#;

   2285  2 000113   000007 236100                    LDQ     7,,PR0
         2 000114   000000 471400 xsym               LDP1    IA$
         2 000115   100005 756100                    STQ     5,,PR1

      115     2286    2           END;

   2286  2 000116   000126 710000 2                  TRA     s:2291

      116     2287    2       ELSE DO;

      117     2288    2           GLOBAL.PRINTBUF.BUFFER=ROLLMSG;

   2288  2 000117   040100 100400                    MLR     fill='040'O
         2 000120   000000 000045 0                  ADSC9   ROLLMSG                  cn=0,n=37
         2 000121   005025 000204                    ADSC9   2581,,PR0                cn=0,n=132

      118     2289    2           CALL M$KEYIN(GLOBAL.KEYIN$->FPT$KEYIN);

   2289  2 000122   005125 471500                    LDP1    2645,,PR0
         2 000123   100000 630500                    EPPR0   0,,PR1
PL6.E3A0      #003=ZIM$EROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:33   
         2 000124   120000 713400                    CLIMB   40960
         2 000125   401400 401760                    pmme    nvectors=4

      119     2290    2           END;

      120     2291    1       CALL M$ERR;

   2291  2 000126   000002 713400                    CLIMB   err
         2 000127   000000 401760                    pmme    nvectors=0

      121     2292    1   END ZIM$EROL;

   2292  2 000130   000000 702200 xent               TSX2  ! X66_ARET

ROLLMSG
 Sect OctLoc
   0     000   122157 154154   142141 143153   040165 156163   165143 143145    Rollback unsucce
   0     004   163163 146165   154040 144165   162151 156147   040162 145143    ssful during rec
   0     010   157166 145162   171*** ******                                    overy...

(unnamed)
 Sect OctLoc
   3     000   000001 000000   400000 000000   000001 006000   000000 000000    ................
      122     2293        %EOD;

PL6.E3A0      #003=ZIM$EROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:34   
--  Include file information  --

   B$JIT.:LIB_E05  cannot be made into a system file and is referenced.
   ZI$USER.:ZIC0TOU  is referenced.
   ZI_ERRORS_C.:ZIC0TOU  is referenced.
   ZI$GLOBAL.:ZIC0TOU  is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure ZIM$EROL.

   Procedure ZIM$EROL requires 89 words for executable code.
   Procedure ZIM$EROL requires 6 words of local(AUTO) storage.
PL6.E3A0      #003=ZIM$EROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:35   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=ZIM$EROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:36   
          MINI XREF LISTING

ALT
      2280**LABEL    2262--CALLALT
B$JIT.CPFLAGS1.SLEAZE
      2078**DCL      2078--REDEF
B$JIT.ERR.MID
      1985**DCL      1985--REDEF
B$JIT.JRESPEAK
      2146**DCL      2147--REDEF
B$JIT.ORIGINATOR_PORT.FROM_CR
      2255**DCL      2255--REDEF    2256--REDEF
B$JIT.PNR
      2159**DCL      2159--REDEF
B$JIT.SYSID
      1984**DCL      2263>>IF
B$JIT.TSLINE
      2253**DCL      2254--REDEF
B$JIT.USER
      1984**DCL      2263>>IF
B$JIT$
        11**DCL      1979--IMP-PTR  2263>>IF       2263>>IF
DBSTATUS.STATUS
        13**DCL      2270<<CALLBLT  2275<<CALLBLT  2283<<CALLBLT
ER_PROL
      2280**LABEL    2268--CALLALT
FPT$KEYIN
       108**DCL      2289<>CALL
GLOBAL.ACTIVE.DBCB$
      1149**DCL      1150--REDEF
GLOBAL.ACTIVE.SSS$
      1145**DCL      1146--REDEF
GLOBAL.KEY
      1353**DCL      1356--REDEF
PL6.E3A0      #003=ZIM$EROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:37   
GLOBAL.KEYIN$
      1431**DCL      2289>>CALL
GLOBAL.PARAN.TRACE.MODE
      1228**DCL      1235--REDEF
GLOBAL.PENDING.RECVRY
      1181**DCL      2264<<ASSIGN   2267>>IF       2269>>IF       2282>>IF
GLOBAL.PENDING.RELEASE
      1177**DCL      2265<<ASSIGN
GLOBAL.PRINTBUF.BUFFER
      1387**DCL      1388--REDEF    1389--REDEF    1390--REDEF    2288<<ASSIGN
GLOBAL.PRINTBUF.ERR.V
      1392**DCL      1395--REDEF    1396--REDEF    1397--REDEF
GLOBAL.RET.ERROR#
      1163**DCL      2270>>CALLBLT  2274<<ASSIGN   2275>>CALLBLT  2283>>CALLBLT
GLOBAL.RET.STCD#
      1170**DCL      2270>>CALLBLT  2275>>CALLBLT  2283>>CALLBLT
GLOBAL.RET.SYSERR#
      1164**DCL      2277>>ASSIGN   2285>>ASSIGN
GLOBAL.UPDATE.TJRNL
      1342**DCL      2267>>IF
GLOBAL$
      1447**DCL      1143--IMP-PTR  2264>>ASSIGN   2265>>ASSIGN   2267>>IF       2267>>IF       2269>>IF
      2270>>CALLBLT  2270>>CALLBLT  2274>>ASSIGN   2275>>CALLBLT  2275>>CALLBLT  2277>>ASSIGN   2282>>IF
      2283>>CALLBLT  2283>>CALLBLT  2285>>ASSIGN   2288>>ASSIGN   2289>>CALL
IA.SNAME
      1946**DCL      1947--REDEF
IA.SSDT
      1958**DCL      1959--REDEF
IA.SSNAME
      1949**DCL      1950--REDEF
IA.SYSERR
      1932**DCL      2277<<ASSIGN   2285<<ASSIGN
IA$
      1960**DCL      1925--IMP-PTR  2277>>ASSIGN   2285>>ASSIGN
M$ERR
        37**DCL-ENT  2291--CALL
PL6.E3A0      #003=ZIM$EROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:38   
M$KEYIN
        30**DCL-ENT  2289--CALL
PS0$
        10**DCL        12--IMP-PTR  2270>>CALLBLT  2275>>CALLBLT  2283>>CALLBLT
ROLLMSG
        15**DCL      2288>>ASSIGN
ZIM$PROL
         8**DCL-ENT  2268--CALL
ZIO$FLUSH
         9**DCL-ENT  2262--CALL

PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:39   
      123        1        /*T***********************************************************/
      124        2        /*T*                                                         */
      125        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      126        4        /*T*                                                         */
      127        5        /*T***********************************************************/
      128        6        ZIM$PROL: PROC ALTRET
      129        7               AVOID ($PR5,$PR6,$PR7);
      130        8    1   DCL 1 I_O_BUF BASED(I_O_BUF$) ALIGNED,
      131        9    1         2 HW (0:2047) UBIN(18) UNAL,
      132       10    1         2 WD (0:1023) REDEF HW UBIN(36) UNAL;
      133       11    1   DCL 1 REC BASED(REC$) UNAL,
      134       12    1         2 LDEL UBIN(2) UNAL,
      135       13    1         2 TYPE UBIN(16) UNAL,
      136       14    1         2 LEN UBIN(18) UNAL,
      137       15    1         2 * CHAR(REC_SIZ) UNAL;
      138       16    1   DCL MREC_SIZ UBIN(36);
      139       17    1   DCL 1 MREC BASED(MREC$) UNAL,
      140       18    1         2 VAL CHAR(MREC_SIZ) UNAL;
      141       19    1   DCL 1 AWS_TAB (0:511) ALIGNED ,
      142       20    1         2 AWS$ PTR;
      143       21    1   DCL 1 TMP_KEY ALIGNED,
      144       22    1         2 LENGTH UBIN(9) UNAL,
      145       23    1         2 IXID UBIN(18) UNAL,
      146       24    1         2 VALUE CHAR(253) UNAL;
      147       25    1   DCL REC_SIZ UBIN(36) ALIGNED;
      148       26    1   DCL REC_RD CHAR(REC_RD_SIZ) BASED(REC$) CALIGNED;
      149       27    1   DCL ERROR UBIN(36);
      150       28    1   DCL REC_RD_SIZ UBIN(36) UNAL;
      151       29    1   DCL I UBIN(36) ALIGNED;
      152       30    1   DCL REC_OFF UBIN(36) ALIGNED;
      153       31    1   DCL LAST_OFF UBIN(36) ALIGNED;
      154       32    1   DCL J UBIN(36);
      155       33    1   DCL TEMP_SAVE UBIN(36) ;
      156       34    1   DCL TEMP# UBIN(36);
      157       35    1   DCL PARTIAL BIT(1);
      158       36        /**/
      159       37    1   DCL ZIO$DBREAD ENTRY ALTRET;
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:40   
      160       38    1   DCL ZIO$DBCLOSE ENTRY ALTRET;
      161       39    1   DCL ZIM$OPEN ENTRY ALTRET;
      162       40    1   DCL ZIO$MODIFY ENTRY ALTRET;
      163       41    1   DCL ZIM$ICKSM ENTRY;
      164       42    1   DCL ZIM$ICKSMJ ENTRY;
      165       43    1   DCL ZIB$FIXREGS ENTRY ALTRET;
      166       44    1   DCL ZIM$JROLL ENTRY;
      167       45    1   DCL ZIM$NULL ENTRY ALTRET;
      168       46    1   DCL ZIO$GETSEG ENTRY(3) ALTRET;
      169       47    1   DCL ZIO$FLUSH ENTRY(1) ALTRET;
      170       48    1   DCL ZIM$MRL_SHIFT ENTRY(3);
      171       49        /**/
      172       50    1   DCL ZI_TJNAME CHAR(4) SYMREF;
      173       51    1   DCL I$ROL UBIN(36) SYMREF;
      174       52    1   DCL B$TCB$ PTR SYMREF;
      175       53    1   DCL B$DS3$ PTR SYMREF;
      176       54    1   DCL IS$ PTR SYMREF;
      177       55    1   DCL F$DCB$ PTR;
      178       56    1   DCL FPT$ PTR ;
      179       57    1   DCL I_O_BUF$ PTR;
      180       58    1   DCL REC$ PTR;
      181       59    1   DCL MREC$ PTR;
      182       60    1   DCL BOTTOM$ PTR;
      183       61        /**/
      184       62        %INCLUDE ZI$GLOBAL;
      185      548        %GLOBALS;
      186      856        %INCLUDE ZI$PG_STRUCTS;
      187      959        %ATBLK_PG(PSTCLASS=AUTO);
      188     1015        %INCLUDE ZI$JRNL;
      189     1123        %JRNL_REC (STCLASS="AUTO");
      190     1198        %INCLUDE ZI$DBCB;
      191     1840        %AWS;
      192     1880        %INCLUDE ZI$SSS;
      193     2429        %OA1;
      194     2437        %OA;
      195     2502        %AC;
      196     2597        %INCLUDE ZI$USER;
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:41   
      197     2742         %IA;
      198     2791        %INCLUDE CP_6;
      199     2872        %INCLUDE CP_6_SUBS;
      200     3412        %FPT_PRECORD(FPTN=FPT$PRECJ,STCLASS=BASED);
      201     3433        %FPT_PRECORD(FPTN=FPT$PRECI,STCLASS=BASED);
      202     3454        %FPT_PFIL(FPTN=FPT$PFIL,STCLASS=BASED);
      203     3469        %FPT_DELREC(FPTN=FPT$DELR,STCLASS=BASED);
      204     3488        %FPT_DELREC(FPTN=FPT$DELI,STCLASS=BASED);
      205     3507        %FPT_READ(FPTN=FPT$READJ,STCLASS=BASED);
      206     3546        %FPT_WRITE(FPTN=FPT$WRTK,STCLASS=BASED);
      207     3577         %FPT_WRITE(FPTN=FPT$WRTI,STCLASS=BASED);
      208     3608        %FPT_OPEN(FPTN=FPT$REOPEN,STCLASS=BASED);
      209     3717        %FPT_OPEN(FPTN=FPT$OPNDFLT,STCLASS=BASED);
      210     3826        %FPT_CLOSE(FPTN=FPT$CLOSE,STCLASS=BASED);
      211     3868        %VLP_VECTOR(FPTN=VLP$VECTOR,STCLASS=BASED);
      212     3883        %FPT_OPEN(FPTN=FPT$OPNSCRB,STCLASS="BASED");
      213     3992        %FPT_RELDCB(FPTN=FPT$RELDCB,STCLASS="BASED");
      214     4006        %FPT_GETDCB(FPTN=FPT$GETDCB,STCLASS="BASED");
      215     4021        %FPT_TIME(FPTN=FPT$TIME,STCLASS=BASED);
      216     4040        %F$DCB (BASED="BASED(F$DCB$)");
      217     4097        %VLP_SN(FPTN=VLP_SN,N=1,SN='      ',STCLASS=AUTO);
      218     4110        %INCLUDE ZI_ERRORS_C;
      219     4436        %INCLUDE B_ERRORS_C;
      220     5563        %B$ALT;
      221     5571        %B$TCB;
      222     5574        %SUB ALTF#SUFFIX=':';
      223     5575        /**/
      224     5576    1       ERROR=0; /*Initialize the error*/
      225     5577    1       GLOBAL.PENDING.ROLL= %YES#;
      226     5578    1       CALL M$TIME(GLOBAL.TIME$->FPT$TIME);
      227     5579    2       DO I=0 TO 511 BY 1;
      228     5580    2           AWS_TAB.AWS$(I)=ADDR(NIL);
      229     5581    2           END;
      230     5582    1       IF GLOBAL.PENDING.RECVRY THEN /* SET AT ZIM$EROL */
      231     5583    2       DO; /*This is recovery mode*/
      232     5584    2           GLOBAL.DCBNAME.LENGTH=5;
      233     5585    2           GLOBAL.DCBNAME.TEXT='TJRNL';
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:42   
      234     5586    2           GLOBAL.GETDCB$->FPT$GETDCB.V.TEST#=%NO#;
      235     5587    2           CALL M$GETDCB(GLOBAL.GETDCB$->FPT$GETDCB) ALTRET(ER_GDCB);
      236     5588    2           GLOBAL.ACCT=' ';
      237     5589    2           GLOBAL.FILENAME.LENGTH=2;
      238     5590    2           GLOBAL.FILENAME.TEXT=ZI_TJNAME;
      239     5591    2           GLOBAL.OPNSCRB$->FPT$OPNSCRB.V.DCB#=GLOBAL.DCBNUMBER;
      240     5592    2           GLOBAL.OPNSCRB$->FPT$OPNSCRB.V.FUN#=%IN#;
      241     5593    2           GLOBAL.OPNSCRB$->FPT$OPNSCRB.V.ACS#=%SEQUEN#;
      242     5594        /*             Open the transient journal. */
      243     5595    2           CALL M$OPEN(GLOBAL.OPNSCRB$->FPT$OPNSCRB) ALTRET(ER_OPNT);
      244     5596    2           GLOBAL.TJRNL.DCB#=GLOBAL.DCBNUMBER;
      245     5597    2           GLOBAL.READJ$->FPT$READJ.V.DCB#=GLOBAL.DCBNUMBER;
      246     5598    2           JRNL$=ADDR(GLOBAL.JRECORD);
      247     5599    2           J=0;
      248     5600    3           DO WHILE (%YES#);
      249     5601    3               CALL M$READ(GLOBAL.READJ$->FPT$READJ) ALTRET(ER_READ);
      250     5602    3               IF FILE.TYPE=T#ROL OR FILE.TYPE=T#CKPT THEN
      251     5603    3                   GOTO FLUSH;
      252     5604    3               IF FILE.TYPE~=T#FID THEN
      253     5605    3                   GOTO FLUSH;
      254     5606    3               CALL ZIO$GETSEG(B$DS3$,SIZEW(AWS)) ALTRET(ER_GS);
      255     5607    3               AWS_TAB.AWS$(FILE.DCB#)=PINCRW(B$DS3$,J*SIZEW(AWS));
      256     5608    3               AWS$=AWS_TAB.AWS$(FILE.DCB#);
      257     5609    3               AWS.ENCRP=FILE.CRPT; /*Fill in the  AWS*/
      258     5610    3               AWS.DDCB=0;
      259     5611    3               AWS.ATRIB.KEYED=FILE.KEYED;
      260     5612    3               AWS.ATRIB.FUN=%UPDATE#;
      261     5613    3               AWS.ATRIB.CHKSUM=FILE.CHKSUM;
      262     5614    3               AWS.ATRIB.ATMP=FILE.ATMP;
      263     5615    3               GLOBAL.DCBNAME.LENGTH=FILE.ID.NAME#.L;
      264     5616    3               GLOBAL.DCBNAME.TEXT=FILE.ID.NAME#.C;
      265     5617    3               GLOBAL.ACCT=FILE.ID.ACCT#;
      266     5618    3               GLOBAL.FILENAME.LENGTH=FILE.ID.NAME#.L;
      267     5619    3               GLOBAL.FILENAME.TEXT=FILE.ID.NAME#.C;
      268     5620    3               VLP_SN.NUM#=1;
      269     5621    3               VLP_SN.SN#(0)=FILE.ID.PSN#;
      270     5622    3               GLOBAL.OPNDFLT$->FPT$OPNDFLT.SN_=VECTOR(VLP_SN);
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:43   
      271     5623    3               GLOBAL.PARAN.IO.AWS$=AWS$;
      272     5624    3               CALL ZIM$OPEN
      273     5625    4               WHENALTRETURN DO;
      274     5626    4                   GLOBAL.OPNDFLT$->FPT$OPNDFLT.SN_=VECTOR(NIL);
      275     5627    4                   GOTO ALT;
      276     5628    4                   END;
      277     5629    3               GLOBAL.OPNDFLT$->FPT$OPNDFLT.SN_=VECTOR(NIL);
      278     5630    3               AWS.ATRIB.UNPROTECT='0'B;
      279     5631    3               IF FILE.INDEXED='0'B AND FILE.ATMP='0'B THEN
      280     5632    4               DO; /* LOCK IT AT BEGINNIG OF RECOVERY */
      281     5633    4                   GLOBAL.PARAN.IO.PGNO=0; /* READ ATRIB PAGE */
      282     5634    4                   CALL ZIO$DBREAD ALTRET(ALT);
      283     5635    4                   I_O_BUF$=PINCRW(GLOBAL.PARAN.IO.BUF$,-3);
      284     5636    4                   I_O_BUF$->ATBLK_PG.STATUS.LOCKED='1'B;
      285     5637    4                   IF FILE.KEYED THEN /* ALSO LOCK OUT KEYED FILE */
      286     5638    4                       I_O_BUF$->ATBLK_PG.STATUS.KFILE_CURR='1'B;
      287     5639    4                   I_O_BUF$->ATBLK_PG.REASON_LOCKED.ROLLBACK_FAIL='1'B;
      288     5640    4                   I_O_BUF$->ATBLK_PG.TIME_LOCKED=GLOBAL.TIME.TSTAMP;
      289     5641    4                   CALL ZIO$MODIFY ALTRET(ALT);
      290     5642    4                   END;
      291     5643    3               J=J+1;
      292     5644    3               END;
      293     5645    2           END;
      294     5646    1       ELSE
      295     5647    1           IF GLOBAL.TJRNL.DCB#=0 THEN
      296     5648    1               GOTO ER_TJNA;
      297     5649    1   FLUSH: /* FLUSH ALL BUFFERS IN POOL */
      298     5650    1       GLOBAL.PENDING.FORGET='1'B;
      299     5651    1       CALL ZIO$FLUSH(%YES#) ALTRET(ALT);
      300     5652    1       CALL ZIM$PPROL ALTRET(ALT);
      301     5653    1       GLOBAL.PENDING.FORGET='0'B;
      302     5654    1       CALL ZIO$FLUSH(%NO#) ALTRET(ALT);
      303     5655    1       IF ~GLOBAL.PENDING.RECVRY THEN
      304     5656    2       DO;
      305     5657    2           GLOBAL.PENDING.ROLL=%NO#;
      306     5658    2           CALL ZIM$JROLL;
      307     5659    2           CALL ZIM$NULL ALTRET(ALT);
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:44   
      308     5660    2           IF GLOBAL.ROLLADDR~=0 AND ~GLOBAL.PENDING.XCON THEN
      309     5661    3           DO;
      310     5662    3               IA.UCALL_LOC=GLOBAL.ROLLADDR;
      311     5663    3               IA.ROLLFLAG=%YES#;
      312     5664    3               END;
      313     5665    2           END;
      314     5666    1       ELSE
      315     5667    2       DO;
      316     5668    3           DO I = 0 TO 511 BY 1; /*Close all the areas that were open*/
      317     5669    3               IF AWS_TAB.AWS$(I) ~= ADDR(NIL) THEN
      318     5670    4               DO;
      319     5671    4                   GLOBAL.PARAN.IO.AWS$=AWS_TAB.AWS$(I);
      320     5672    4                   CALL ZIO$DBCLOSE ALTRET(ALT);
      321     5673    4                   END;
      322     5674    3               END;
      323     5675    2           GLOBAL.CLOSE$->FPT$CLOSE.V.DCB#=GLOBAL.TJRNL.DCB#; /*Also close the Tjrnl*/
      324     5676    2           GLOBAL.CLOSE$->FPT$CLOSE.V.DISP#=%RELEASE#;
      325     5677    2           CALL M$CLOSE(GLOBAL.CLOSE$->FPT$CLOSE) ALTRET(ER_RJRNL);
      326     5678    2           END;
      327     5679    1       GLOBAL.RET.ERROR#=EXC#ROLL;
      328     5680    1       GLOBAL.RET.STCD#=STMTCD#IDS;
      329     5681    1   RET: GLOBAL.PENDING.ROLL='0'B;
      330     5682    1       RETURN;
      331     5683    1   ER_TJNA: GLOBAL.RET.ERROR#=ERR#RL#FTJNA; /* NO TJRNL FOR THE USER */
      332     5684    1       GOTO RET;
      333     5685    1   ER_READ: IF B$TCB$->B$TCB.ALT$->B$ALT.ERR.ERR#=%E$EOF THEN
      334     5686    1           GOTO FLUSH;
      335     5687    1   ER_RJRNL:
      336     5688    1       ERROR=ERR#RL#RJRNL;
      337     5689    1       GLOBAL.RET.SYSERR#=B$TCB$->B$TCB.ALT$->B$ALT.ERR;
      338     5690    1       GOTO COMMON;
      339     5691    1   ER_GS:
      340     5692    1       ERROR=ERR#RL#GDS;
      341     5693    1       GLOBAL.RET.SYSERR#=B$TCB$->B$TCB.ALT$->B$ALT.ERR;
      342     5694    1       GOTO COMMON;
      343     5695    1   ER_OPNT: GLOBAL.RET.DCB#=GLOBAL.DCBNUMBER;
      344     5696    1   ER_GDCB:
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:45   
      345     5697    1       ERROR=ERR#IO#OPNT;
      346     5698    1       GLOBAL.RET.SYSERR#=B$TCB$->B$TCB.ALT$->B$ALT.ERR;
      347     5699    1       GOTO COMMON;
      348     5700    1   COMMON: ;
      349     5701    1       GLOBAL.RET.ERROR#=ERROR;
      350     5702    1       GLOBAL.RET.STCD#=STMTCD#IDS;
      351     5703    1   ALT: ;
      352     5704    1   ER_MOD: ;
      353     5705    1       ALTRETURN;
      354     5706         %EJECT;
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:46   
      355     5707    1   ZIM$PPROL: PROC ALTRET;
      356     5708        /*
      357     5709                  Start by positioning to end of trans journal file.
      358     5710        */
      359     5711    2       GLOBAL.PFIL$ -> FPT$PFIL.V.DCB# = GLOBAL.TJRNL.DCB#;
      360     5712    2       GLOBAL.PFIL$ -> FPT$PFIL.V.BOF# = %NO#;
      361     5713    2       CALL M$PFIL(GLOBAL.PFIL$ -> FPT$PFIL) ALTRET(ER_PFIL);
      362     5714    2       GLOBAL.PRECJ$->FPT$PRECJ.V.DCB#=GLOBAL.TJRNL.DCB#;
      363     5715    2       GLOBAL.PRECJ$->FPT$PRECJ.V.N#=-1;
      364     5716    2       GLOBAL.READJ$->FPT$READJ.V.DCB#=GLOBAL.TJRNL.DCB#;
      365     5717    2       JRNL$=ADDR(GLOBAL.JRECORD);
      366     5718        /*       If possible partial update from other than ROLLBACK
      367     5719                 allow mistake of first rollback record since cant tell */
      368     5720    2       IF POFFW(ADDR(I$ROL),IS$)~=GLOBAL.FCN.CODE THEN
      369     5721    2           PARTIAL=%YES#;
      370     5722    3       DO WHILE (%YES#);
      371     5723    3           CALL M$PRECORD(GLOBAL.PRECJ$->FPT$PRECJ) ALTRET(ER_PJRNL);
      372     5724    3           CALL M$READ(GLOBAL.READJ$->FPT$READJ) ALTRET(ER_READ);
      373     5725        /*
      374     5726           The type of journaling action (ie delete,store..etc) is found in
      375     5727           the first byte of the journal record. JREC.TYPE
      376     5728        */
      377     5729    4           DO CASE(JREC.TYPE);
      378     5730    4           CASE(T#STO);
      379     5731    4               IF NOT GLOBAL.PENDING.ROLL_ABORTED THEN
      380     5732    4                   CALL ZIM$STO ALTRET(ALT);
      381     5733    4           CASE(T#DEL);
      382     5734    4               IF NOT GLOBAL.PENDING.ROLL_ABORTED THEN
      383     5735    4                   CALL ZIM$DEL ALTRET(ALT);
      384     5736    4           CASE(T#MOD);
      385     5737    4               IF NOT GLOBAL.PENDING.ROLL_ABORTED THEN
      386     5738    4                   CALL ZIM$MOD ALTRET(ALT);
      387     5739    4           CASE(T#CKB);
      388     5740    4               IF NOT GLOBAL.PENDING.ROLL_ABORTED THEN
      389     5741    4                   CALL ZIM$SUM ALTRET(ALT);
      390     5742    4           CASE(T#KSTO);
      391     5743    4               IF NOT GLOBAL.PENDING.ROLL_ABORTED THEN
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:47   
      392     5744    4                   CALL ZIM$KEYSTO ALTRET(ALT);
      393     5745    4           CASE(T#KDEL);
      394     5746    4               IF NOT GLOBAL.PENDING.ROLL_ABORTED THEN
      395     5747    4                   CALL ZIM$KEYDEL ALTRET(ALT);
      396     5748    4           CASE(T#MSET);
      397     5749    4               IF NOT GLOBAL.PENDING.ROLL_ABORTED THEN
      398     5750    4                   CALL ZIM$MSET ALTRET(ALT);
      399     5751    4           CASE(T#ISTO);
      400     5752    4               IF NOT GLOBAL.PENDING.ROLL_ABORTED THEN
      401     5753    4                   CALL ZIM$RISTO ALTRET(ALT);
      402     5754    4           CASE(T#IDEL);
      403     5755    4               IF NOT GLOBAL.PENDING.ROLL_ABORTED THEN
      404     5756    4                   CALL ZIM$RIDEL ALTRET(ALT);
      405     5757    4           CASE(T#IMOD);
      406     5758    4               IF NOT GLOBAL.PENDING.ROLL_ABORTED THEN
      407     5759    4                   CALL ZIM$RIMOD ALTRET(ALT);
      408     5760    4           CASE(T#CKPT,T#ROL);
      409     5761    4           CASE(T#FID);
      410     5762    4               CALL ZIM$FID ALTRET(ALT);
      411     5763    4               END;
      412     5764    3           PARTIAL=%NO#;
      413     5765    3           GLOBAL.PRECJ$->FPT$PRECJ.V.N#=-2;
      414     5766    3           END;
      415     5767    2   RET: RETURN;
      416     5768    2   ER_PJRNL:
      417     5769    2       IF B$TCB$->B$TCB.ALT$->B$ALT.ERR.ERR#=%E$BOF THEN
      418     5770    2           GOTO RET;
      419     5771    2       ERROR=ERR#RL#PJRNL;
      420     5772    2       GLOBAL.RET.SYSERR#=B$TCB$->B$TCB.ALT$->B$ALT.ERR;
      421     5773    2       GLOBAL.RET.DCB#=GLOBAL.TJRNL.DCB#;
      422     5774    2       RETURN;
      423     5775    2   ER_READ:
      424     5776    2       ERROR=ERR#RL#RJRNL;
      425     5777    2       GLOBAL.RET.SYSERR#=B$TCB$->B$TCB.ALT$->B$ALT.ERR;
      426     5778    2       GLOBAL.RET.DCB#=GLOBAL.TJRNL.DCB#;
      427     5779    2       GOTO ALT;
      428     5780    2   ER_PFIL:
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:48   
      429     5781    2       ERROR=ERR#RL#ERPFIL;
      430     5782    2       GLOBAL.RET.SYSERR#=B$TCB$->B$TCB.ALT$->B$ALT.ERR;
      431     5783    2       GLOBAL.RET.DCB#=GLOBAL.TJRNL.DCB#;
      432     5784    2       GOTO ALT;
      433     5785    2   ALT:
      434     5786    2       ALTRETURN;
      435     5787        %EJECT;
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:49   
      436     5788    2   ZIM$STO: PROC ALTRET;
      437     5789
      438     5790    3       CALL ZIM$CK_AWS ALTRET(ALT);
      439     5791    3       IF AWS.ATRIB.ATMP THEN GOTO RET;
      440     5792    3       CALL ZIM$READ_PG ALTRET(ALT);
      441     5793    3       IF JREC.TIME>I_O_BUF.WD(1) THEN
      442     5794    3           GOTO RET; /* PAGE HAS NOT BEEN WRITTEN TO DISK */
      443     5795
      444     5796    3       IF I_O_BUF.HW(2047-JREC.LINE)<=11 OR
      445     5797    3          I_O_BUF.HW(2047-JREC.LINE)>=131072 OR
      446     5798    3          I_O_BUF.HW(2047-JREC.LINE)~=JREC.OFFSET THEN
      447     5799    3           GOTO ER_STO; /* THE STORED RECORD IS NOT IN OFFSET ARRAY */
      448     5800    3       REC_RD_SIZ=JREC.LENGTH;
      449     5801    3       REC$=PINCRC(I_O_BUF$,JREC.OFFSET+12);
      450     5802    3       IF JREC.VALUE~=REC$->REC_RD THEN
      451     5803    3           GOTO ER_STO; /* THE RECORD THERE IS NOT THE ONE JUST STORED */
      452     5804    3       LAST_OFF=4094-I_O_BUF.HW(7)-I_O_BUF.HW(11)*2;
      453     5805         /* END OF DATA = PAGE_SIZE-SPACE_AVAIL-HIGH_LINE-2 */
      454     5806    3       IF LAST_OFF ~= JREC.OFFSET+12+REC.LEN THEN
      455     5807    3           GOTO ER_STO; /* THERE CANT BE ANY REC AFTER THIS ONE */
      456     5808
      457     5809    3       I_O_BUF.HW(7)=I_O_BUF.HW(7)+REC.LEN; /* UPD SP AVAIL */
      458     5810    3       MREC_SIZ=REC.LEN; /* NOW, ZERO THE REC STORED */
      459     5811    3       REC$->MREC = '0'B;
      460     5812
      461     5813         /* NOW, INSERT THIS LINE INTO AVAILABLE LINE CHAIN */
      462     5814    3       I=I_O_BUF.HW(10); /* I=FIRST AVAIL LINE */
      463     5815    3       IF (I=0 AND I_O_BUF.HW(2047)<131072) OR /* NO AVAIL LINE */
      464     5816    3          I > JREC.LINE THEN /* OR 1ST AVAIL > DELETED LINE */
      465     5817    4       DO;
      466     5818    4           I_O_BUF.HW(2047-JREC.LINE)=131072+I;
      467     5819    4           I_O_BUF.HW(10)=JREC.LINE;
      468     5820    4           END;
      469     5821    3       ELSE
      470     5822    4       DO; /* WALK THRU THE CHAIN THE FIND INSERTION POINT */
      471     5823    5           DO WHILE(I_O_BUF.HW(2047-I)-131072<JREC.LINE AND
      472     5824    5              I_O_BUF.HW(2047-I)-131072~=0);
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:50   
      473     5825    5               IF I_O_BUF.HW(2047-I)<131072 THEN
      474     5826    5                   GOTO ER_STO; /* BAD PTR IN CHAIN */
      475     5827    5               I=I_O_BUF.HW(2047-I)-131072;
      476     5828    5               END;
      477     5829         /* INSERTION POINT FOUND, RIGHT AFTER I */
      478     5830    4           I_O_BUF.HW(2047-JREC.LINE)=I_O_BUF.HW(2047-I);
      479     5831    4           I_O_BUF.HW(2047-I)=131072+JREC.LINE;
      480     5832    4           END;
      481     5833
      482     5834    3       CALL ZIO$MODIFY ALTRET(ALT);
      483     5835    3   RET: RETURN;
      484     5836
      485     5837    3   ER_STO: ERROR=ERR#RL#INCNS;
      486     5838    3   ALT: ALTRETURN;
      487     5839    3   END ZIM$STO;
      488     5840        %EJECT;
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:51   
      489     5841        /*
      490     5842              INTERNAL SUBR   UPD_ARRAY:  CUT OFFSET ARRAY IN SIZE
      491     5843                 CALLED BY ZIM$DEL  AND  ZIM$MOD
      492     5844                 WHEN THERE IS NO ENOUGH SPACE FOR A ROLLBACKED RECORD.
      493     5845                 INPUT: I=NUMBER OF HIGH ENTRIES TO DELETE FROM OFFSET ARRAY.
      494     5846        */
      495     5847    2   UPD_ARRAY: PROC ALTRET;
      496     5848
      497     5849    3       J=I_O_BUF.HW(11); /* J = CURRENT HIGH LINE */
      498     5850    3       IF I > J THEN ALTRETURN; /* REQ TOO MAY, RESULTING NO LINES */
      499     5851    3       I_O_BUF.HW(11)=J-I; /* NEW CURRENT HIGH LINE */
      500     5852    3       I_O_BUF.HW(7)=I_O_BUF.HW(7)+2*I; /* NEW SPACE AVAIL */
      501     5853    4       DO WHILE (I > 0);
      502     5854    4           IF I_O_BUF.HW(2047-J) >= 131072 THEN
      503     5855    4               I_O_BUF.HW(2047-J) = 0; /* ZERO OUT */
      504     5856    4           ELSE /* CANNOT FREE THIS ENTRY FOR SPACE */
      505     5857    4               ALTRETURN; /* THEN THIS IS A FATAL ERROR. */
      506     5858    4           I=I-1;
      507     5859    4           J=J-1;
      508     5860    4           END;
      509     5861    3       IF I_O_BUF.HW(10) > I_O_BUF.HW(11) THEN
      510     5862    3           I_O_BUF.HW(10)=0; /* NO MORE AVAIL LINE LEFT */
      511     5863    3       ELSE
      512     5864    4       DO;
      513     5865    5           DO WHILE(I_O_BUF.HW(2047-J)<131072); /* LOOK FOR THE LAST AVAIL LINE */
      514     5866    5               IF J = 0 THEN /* CANNOT FIND ANY AVAIL LINE */
      515     5867    5                   ALTRETURN; /* MUST BE A BAD OFFSET ARRAY */
      516     5868    5               J = J - 1;
      517     5869    5               END;
      518     5870    4           I_O_BUF.HW(2047-J)=131072; /* SET LAST ONE AS TAIL OF CHAIN */
      519     5871    4           END;
      520     5872
      521     5873    3   END UPD_ARRAY;
      522     5874        %EJECT;
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:52   
      523     5875    2   ZIM$DEL: PROC ALTRET;
      524     5876
      525     5877    3       CALL ZIM$CK_AWS ALTRET(ALT);
      526     5878    3       IF AWS.ATRIB.ATMP THEN
      527     5879    3           GOTO RET; /* TEMPORARY AREAS */
      528     5880    3       CALL ZIM$READ_PG ALTRET(ALT);
      529     5881    3       IF JREC.TIME > I_O_BUF.WD(1) THEN
      530     5882    3           GOTO RET; /* PAGE HAS NOT BEEN WRITTEN TO DISK */
      531     5883    3       IF I_O_BUF.HW(2047-JREC.LINE)<131072 THEN
      532     5884    3           GOTO ER_DEL; /* THE DELETED LINE IS NOT AVAILABLE */
      533     5885
      534     5886    3       REC$=PINCRC(I_O_BUF$,JREC.OFFSET+12);
      535     5887    3       REC_RD_SIZ=JREC.LENGTH;
      536     5888        /*
      537     5889                 IT IS POSSIBLE THAT THERE IS NO ENOUGH SPACE TO
      538     5890                 PUT BACK THIS DELETED RECORD, BECAUSE OFFSET ARRAY
      539     5891                 HAS GROWN LARGER, BUT WE SHOULD BE ABLE TO REDUCE ITS SIZE
      540     5892        */
      541     5893    3       IF REC_RD_SIZ > I_O_BUF.HW(7) THEN
      542     5894    4       DO; /* GET RID OF SOME ENTRIES IN OFFSET ARRAY */
      543     5895    4           I = (REC_RD_SIZ-I_O_BUF.HW(7)+1)/2; /* HOW MANY */
      544     5896    4           CALL UPD_ARRAY ALTRET(ER_DEL);
      545     5897    4           END;
      546     5898    3       REC_SIZ=JREC.LENGTH-4;
      547     5899    3       MREC$=PINCRC(REC$,JREC.LENGTH);
      548     5900    3       LAST_OFF=4094-I_O_BUF.HW(7)-I_O_BUF.HW(11)*2;
      549     5901         /* OFFSET TO END OF DATA = PAGE_SIZE-SPACE_AVAIL-HIGH_LINE-2 */
      550     5902    3       MREC_SIZ=LAST_OFF-(JREC.OFFSET+12);
      551     5903    3       CALL ZIM$MRL_SHIFT(REC$,MREC$,MREC_SIZ); /* MAKE ROOM */
      552     5904    3       MREC_SIZ=JREC.LENGTH;
      553     5905    3       REC$->MREC.VAL=JREC.VALUE; /* RESTORE THE DELETED REC */
      554     5906
      555     5907         /* NOW, WALK AVAIL CHAIN TO GET THE PRIOR LINE */
      556     5908    3       I = I_O_BUF.HW(10); /* GET 1ST AVALI LINE NUMBER */
      557     5909    3       J = 2037; /* J SHOULD CONTAIN THE PRIOR LINE NUMBER */
      558     5910    4       DO WHILE(I~=JREC.LINE); /* WALK CHAIN UNTIL FOUND JREC.LINE */
      559     5911    4           J=I; /*  SAVE AS PRIOR */
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:53   
      560     5912    4           IF I_O_BUF.HW(2047-I)<=131072 THEN /* END OF CHAIN */
      561     5913    4               GOTO ER_DEL; /* OR BAD PTR IN CHAIN */
      562     5914    4           I=I_O_BUF.HW(2047-I)-131072;
      563     5915    4           END; /* KEEP WALKING */
      564     5916
      565     5917    3       IF J=2037 THEN /* IF 1ST AVAIL NEEDS UPDATED */
      566     5918    3           I_O_BUF.HW(10)=I_O_BUF.HW(2047-I)-131072;
      567     5919    3       ELSE
      568     5920    3           I_O_BUF.HW(2047-J)=I_O_BUF.HW(2047-I);
      569     5921    3       I_O_BUF.HW(2047-I)=JREC.OFFSET;
      570     5922    3       I_O_BUF.HW(7)=I_O_BUF.HW(7)-JREC.LENGTH; /* UPD SP AVAIL */
      571     5923    4       DO J=0 TO I_O_BUF.HW(11); /* LOOP THRU THE OFFSET ARRAY */
      572     5924    4           IF I_O_BUF.HW(2047-J)<131072 AND
      573     5925    4              I_O_BUF.HW(2047-J)>=JREC.OFFSET AND J~=I THEN
      574     5926    4               I_O_BUF.HW(2047-J)=I_O_BUF.HW(2047-J)+JREC.LENGTH;
      575     5927    4           END;
      576     5928    3       CALL ZIO$MODIFY ALTRET(ALT);
      577     5929    3   RET: RETURN;
      578     5930
      579     5931    3   ER_DEL: ERROR=ERR#RL#INCNS; /* INCONSISTANT IN ROLL DEL REC */
      580     5932    3   ALT: ALTRETURN;
      581     5933    3   END ZIM$DEL;
      582     5934        %EJECT;
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:54   
      583     5935    2   ZIM$MOD: PROC ALTRET;
      584     5936
      585     5937    3       CALL ZIM$CK_AWS ALTRET(ALT);
      586     5938    3       IF AWS.ATRIB.ATMP THEN GOTO RET;
      587     5939    3       CALL ZIM$READ_PG ALTRET(ALT);
      588     5940    3       IF JREC.TIME>I_O_BUF.WD(1) THEN
      589     5941    3           GOTO RET; /* PAGE HAS NOT BEEN UPDATED IN DISK */
      590     5942    3       IF JREC.OFFSET~=I_O_BUF.HW(2047-JREC.LINE) THEN
      591     5943    3           GOTO ER_MOD; /* VERY INCONSISTANT */
      592     5944
      593     5945    3       REC$=PINCRC(I_O_BUF$,JREC.OFFSET+12);
      594     5946    3       IF JREC.LENGTH > REC$->REC.LEN THEN
      595     5947    4       DO; /* REC IS VAR LENGTH, THE ONE IN *I IS LARGER */
      596     5948    4           J = JREC.LENGTH - REC$->REC.LEN; /* DIFFERECNE IN BYTES */
      597     5949    4           IF J > I_O_BUF.HW(7) THEN /* NO ENOUGH SPACE FOR IT */
      598     5950    5           DO; /* GET RID OF SOME HIGH ENTRIES IN OFFSET ARRAY */
      599     5951    5               I=(J+1)/2; /* I=NUMBER OF ENTRIES TO BE PURGED */
      600     5952    5               CALL UPD_ARRAY ALTRET(ER_MOD);
      601     5953    5               J=JREC.LENGTH-REC.LEN; /* RESTORE J */
      602     5954    5               END;
      603     5955         /* SPACE IS OK, SO MOVE STUFF BELOW THE REC DOWN BY J BYTES */
      604     5956    4           MREC$=PINCRC(REC$,REC$->REC.LEN); /* FROM AFTER THE REC */
      605     5957    4           BOTTOM$=PINCRC(MREC$,J); /* TO J BYTES DOWN */
      606     5958    4           LAST_OFF=4094-I_O_BUF.HW(7)-I_O_BUF.HW(11)*2;
      607     5959    4           MREC_SIZ=LAST_OFF-(JREC.OFFSET+12+REC.LEN);
      608     5960    4           CALL ZIM$MRL_SHIFT(MREC$,BOTTOM$,MREC_SIZ);
      609     5961    4           I_O_BUF.HW(7)=I_O_BUF.HW(7)-J; /* UPD SPACE AVAIL */
      610     5962    5           DO I=0 TO I_O_BUF.HW(11); /* UPD OFFSET ARRAY */
      611     5963    5               IF I_O_BUF.HW(2047-I) > JREC.OFFSET AND
      612     5964    5                  I_O_BUF.HW(2047-I) < 131072 THEN
      613     5965    5                   I_O_BUF.HW(2047-I) = I_O_BUF.HW(2047-I) + J;
      614     5966    5               END;
      615     5967    4           END;
      616     5968    3       ELSE
      617     5969    3           IF JREC.LENGTH < REC$->REC.LEN THEN
      618     5970    4           DO; /* THE ONE TO ROLLBACK IS SMALLER */
      619     5971    4               LAST_OFF=4094-I_O_BUF.HW(7)-I_O_BUF.HW(11)*2;
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:55   
      620     5972    4               MREC_SIZ=LAST_OFF-(JREC.OFFSET+12+REC.LEN);
      621     5973    4               J=REC$->REC.LEN - JREC.LENGTH;
      622     5974    4               MREC$=PINCRC(REC$,REC$->REC.LEN);
      623     5975         /* MOVE STUFF BELOW THE REC UP BY J BYTES */
      624     5976    4               PINCRC(MREC$,-1*J)->MREC.VAL=MREC$->MREC.VAL;
      625     5977    4               MREC$=PINCRC(MREC$,MREC_SIZ-J);
      626     5978    4               MREC_SIZ=J;
      627     5979    4               MREC$->MREC = '0'B; /* FILL THE NEW GAP WITH ZEROS */
      628     5980    4               I_O_BUF.HW(7)=I_O_BUF.HW(7)+J; /* UPD SPACE AVAIL */
      629     5981    5               DO I=0 TO I_O_BUF.HW(11);
      630     5982    5                   IF I_O_BUF.HW(2047-I) > JREC.OFFSET AND
      631     5983    5                      I_O_BUF.HW(2047-I) < 131072 THEN
      632     5984    5                       I_O_BUF.HW(2047-I) = I_O_BUF.HW(2047-I) - J;
      633     5985    5                   END;
      634     5986    4               END;
      635     5987    3       MREC_SIZ = JREC.LENGTH;
      636     5988    3       REC$->MREC.VAL = JREC.VALUE;
      637     5989    3       CALL ZIO$MODIFY ALTRET(ALT);
      638     5990    3   RET: RETURN;
      639     5991
      640     5992    3   ER_MOD: ERROR=ERR#RL#INCNS;
      641     5993    3   ALT: ALTRETURN;
      642     5994    3   END ZIM$MOD;
      643     5995        %EJECT;
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:56   
      644     5996    2   ZIM$RISTO: PROC ALTRET;
      645     5997    3       CALL ZIM$CK_AWS ALTRET(ALT);
      646     5998    3       IF AWS.ATRIB.ATMP THEN
      647     5999    3           GOTO RET;
      648     6000    3       GLOBAL.KEY.LENGTH=JREC.LENGTH;
      649     6001    3       GLOBAL.KEY.VALUE=JREC.VALUE;
      650     6002    3       GLOBAL.PRECI$->FPT$PRECI.V.DCB#=AWS.DDCB;
      651     6003    3       GLOBAL.PRECI$->FPT$PRECI.V.INDX#=1;
      652     6004    3       GLOBAL.PRECI$->FPT$PRECI.V.N#=0;
      653     6005    3       ADDR(GLOBAL.PRECI$->FPT$PRECI.KEY_)->VLP$VECTOR.W1.VSIZE#=
      654     6006    3          JREC.LENGTH-1;
      655     6007    3       CALL M$PRECORD(GLOBAL.PRECI$->FPT$PRECI) ALTRET(ER_PREC);
      656     6008    3       GLOBAL.DELI$->FPT$DELI.V.DCB#=AWS.DDCB;
      657     6009    3       ADDR(GLOBAL.DELI$->FPT$DELI.KEY_)->VLP$VECTOR.W1.VSIZE#=
      658     6010    3          JREC.LENGTH-1;
      659     6011    3       CALL M$DELREC(GLOBAL.DELI$->FPT$DELI) ALTRET(ER_DELR);
      660     6012    3       GLOBAL.STATS.CURR.READS=GLOBAL.STATS.CURR.READS+1;
      661     6013    3       GLOBAL.STATS.CURR.WRITES=GLOBAL.STATS.CURR.WRITES+1;
      662     6014    3   RET: RETURN;
      663     6015    3   ER_PREC: IF PARTIAL THEN
      664     6016    3           GOTO RET;
      665     6017    3   ER_DELR: ERROR=ERR#RL#INCNS;
      666     6018    3       GLOBAL.RET.SYSERR#=B$TCB$->B$TCB.ALT$->B$ALT.ERR;
      667     6019    3       GLOBAL.RET.DCB#=AWS.DDCB;
      668     6020    3       GOTO ALT;
      669     6021    3   ALT: ALTRETURN;
      670     6022    3   END ZIM$RISTO;
      671     6023        %EJECT;
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:57   
      672     6024    2   ZIM$RIDEL: PROC ALTRET;
      673     6025    3       CALL ZIM$CK_AWS ALTRET(ALT);
      674     6026    3       IF AWS.ATRIB.ATMP THEN
      675     6027    3           GOTO RET;
      676     6028    3       GLOBAL.WRTI$->FPT$WRTI.V.DCB#=AWS.DDCB;
      677     6029    3       GLOBAL.WRTI$->FPT$WRTI.V.ONEWKEY#=%NO#;
      678     6030    3       GLOBAL.WRTI$->FPT$WRTI.BUF_.BUF$=ADDR(JREC.VALUE);
      679     6031    3       GLOBAL.WRTI$->FPT$WRTI.BUF_.BOUND=JREC.LENGTH-1;
      680     6032    3       CALL M$WRITE(GLOBAL.WRTI$->FPT$WRTI) ALTRET(ER_WRT);
      681     6033    3       GLOBAL.STATS.CURR.READS=GLOBAL.STATS.CURR.READS+1;
      682     6034    3       GLOBAL.STATS.CURR.WRITES=GLOBAL.STATS.CURR.WRITES+1;
      683     6035    3   RET: RETURN;
      684     6036    3   ER_WRT: IF PARTIAL THEN
      685     6037    3           GOTO RET;
      686     6038    3       ERROR=ERR#RL#INCNS;
      687     6039    3       GLOBAL.RET.SYSERR#=B$TCB$->B$TCB.ALT$->B$ALT.ERR;
      688     6040    3       GLOBAL.RET.DCB#=AWS.DDCB;
      689     6041    3       GOTO ALT;
      690     6042    3   ALT: ALTRETURN;
      691     6043    3   END ZIM$RIDEL;
      692     6044        %EJECT;
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:58   
      693     6045    2   ZIM$RIMOD: PROC ALTRET;
      694     6046    3       CALL ZIM$CK_AWS ALTRET(ALT);
      695     6047    3       IF AWS.ATRIB.ATMP THEN
      696     6048    3           GOTO RET;
      697     6049    3       GLOBAL.WRTI$->FPT$WRTI.V.DCB#=AWS.DDCB;
      698     6050    3       GLOBAL.WRTI$->FPT$WRTI.V.ONEWKEY#=%YES#;
      699     6051    3       GLOBAL.WRTI$->FPT$WRTI.BUF_.BUF$=ADDR(JREC.VALUE);
      700     6052    3       GLOBAL.WRTI$->FPT$WRTI.BUF_.BOUND=JREC.LENGTH-1;
      701     6053    3       CALL M$WRITE(GLOBAL.WRTI$->FPT$WRTI) ALTRET(ER_WRT);
      702     6054    3       GLOBAL.STATS.CURR.READS=GLOBAL.STATS.CURR.READS+1;
      703     6055    3       GLOBAL.STATS.CURR.WRITES=GLOBAL.STATS.CURR.WRITES+1;
      704     6056    3   RET: RETURN;
      705     6057    3   ER_WRT: IF PARTIAL THEN
      706     6058    3           GOTO RET;
      707     6059    3       ERROR=ERR#RL#INCNS;
      708     6060    3       GLOBAL.RET.SYSERR#=B$TCB$->B$TCB.ALT$->B$ALT.ERR;
      709     6061    3       GLOBAL.RET.DCB#=AWS.DDCB;
      710     6062    3       GOTO ALT;
      711     6063    3   ALT: ALTRETURN;
      712     6064    3   END ZIM$RIMOD;
      713     6065        %EJECT;
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:59   
      714     6066    2   ZIM$SUM: PROC ALTRET;
      715     6067    3       CALL ZIM$CK_AWS ALTRET(ALT);
      716     6068    3       CALL ZIM$READ_PG ALTRET(ALT);
      717     6069    3       IF JREC.TIME > I_O_BUF.WD(1) THEN GOTO RET; /*Page never was written out*/
      718     6070    3       GLOBAL.PARAN.ICKSM.P$=I_O_BUF$;
      719     6071    3       CALL ZIM$ICKSMJ; /*This chksum is special for rollback..
      720     6072         							  doesn't count the offset array or the 3 ids hdr words*/
      721     6073    3       IF CKSM.CKSM ~= GLOBAL.PARAN.ICKSM.V THEN GOTO ER_CHKSUM;
      722     6074    3       IF AWS.ATRIB.CHKSUM THEN /* Is this area CHECKSUMMED ? */
      723     6075    4       DO;
      724     6076    4           GLOBAL.PARAN.ICKSM.P$=I_O_BUF$;
      725     6077    4           CALL ZIM$ICKSM; /*Get the real checksum value*/
      726     6078    4           I_O_BUF.WD(2)=GLOBAL.PARAN.ICKSM.V;
      727     6079    4           END;
      728     6080    3   RET:
      729     6081    3       RETURN;
      730     6082    3   ER_CHKSUM:
      731     6083    3       ERROR=ERR#RL#INCNS;
      732     6084    3       GOTO ALT;
      733     6085    3   ALT: ALTRETURN;
      734     6086    3   END ZIM$SUM;
      735     6087        %EJECT;
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:60   
      736     6088    2   ZIM$MSET: PROC ALTRET;
      737     6089    3       CALL ZIM$CK_AWS ALTRET(ALT);
      738     6090    3       IF AWS.ATRIB.ATMP THEN RETURN;
      739     6091    3       CALL ZIM$READ_PG ALTRET(ALT);
      740     6092    3       IF JREC.TIME > I_O_BUF.WD(1) THEN GOTO RET; /*Page never was written out*/
      741     6093    3       REC$=PINCRC(I_O_BUF$,JREC.OFFSET+12);
      742     6094    3       MREC_SIZ=JREC.LENGTH;
      743     6095    3       IF JREC.VALUE=REC$->MREC.VAL THEN GOTO RET;
      744     6096    3       ELSE REC$->MREC.VAL=JREC.VALUE;
      745     6097    3       CALL ZIO$MODIFY;
      746     6098    3   RET:
      747     6099    3       RETURN;
      748     6100    3   ALT: ALTRETURN;
      749     6101    3   END ZIM$MSET;
      750     6102        %EJECT;
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:61   
      751     6103    2   ZIM$KEYSTO: PROC ALTRET;
      752     6104    3       CALL ZIM$CK_AWS ALTRET(ALT);
      753     6105    3       GLOBAL.DELR$->FPT$DELR.V.DCB#=AWS.KDCB;
      754     6106    3       GLOBAL.KEY.LENGTH=JREC.LENGTH;
      755     6107    3       GLOBAL.KEY.VALUE=JREC.VALUE;
      756     6108    3       CALL M$DELREC(GLOBAL.DELR$->FPT$DELR) ALTRET(ER_DELR);
      757     6109    3       GLOBAL.STATS.CURR.WRITES=GLOBAL.STATS.CURR.WRITES+1;
      758     6110    3       RETURN;
      759     6111    3   ER_DELR:
      760     6112        /*Key was already deleted so just return....must have never have been stored*/
      761     6113    3       RETURN;
      762     6114    3   ALT: ALTRETURN;
      763     6115    3   END ZIM$KEYSTO;
      764     6116        %EJECT;
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:62   
      765     6117    2   ZIM$KEYDEL: PROC ALTRET;
      766     6118    3       CALL ZIM$CK_AWS ALTRET(ALT);
      767     6119    3       IF AWS.ATRIB.ATMP THEN RETURN;
      768     6120    3       GLOBAL.WRTK$->FPT$WRTK.V.DCB#=AWS.KDCB;
      769     6121    3       GLOBAL.KEY.LENGTH=JREC.LENGTH;
      770     6122    3       GLOBAL.KEY.VALUE=JREC.VALUE;
      771     6123    3       CALL M$WRITE(GLOBAL.WRTK$->FPT$WRTK) ALTRET (ER_WRT);
      772     6124    3       GLOBAL.STATS.CURR.READS=GLOBAL.STATS.CURR.READS+1;
      773     6125    3       GLOBAL.STATS.CURR.WRITES=GLOBAL.STATS.CURR.WRITES+1;
      774     6126    3       IF DCBADDR(AWS.KDCB)->F$DCB.RDL0# > 3 THEN
      775     6127    4       DO;
      776     6128    4           GLOBAL.CLOSE$->FPT$CLOSE.V.DCB#=AWS.KDCB;
      777     6129    4           CALL M$CLOSE(GLOBAL.CLOSE$->FPT$CLOSE) ALTRET(ER_CLSK);
      778     6130    4           GLOBAL.REOPEN$->FPT$REOPEN.V.DCB#=AWS.KDCB;
      779     6131    4           CALL M$OPEN(GLOBAL.REOPEN$->FPT$REOPEN) ALTRET(ER_OPNK);
      780     6132    4           END;
      781     6133    3       RETURN;
      782     6134    3   ER_WRT:
      783     6135    3       ERROR=ERR#IX#DLDBK;
      784     6136    3       GLOBAL.RET.SYSERR#=B$TCB$->B$TCB.ALT$->B$ALT.ERR;
      785     6137    3       GLOBAL.RET.DCB#=AWS.KDCB;
      786     6138    3       GOTO ALT;
      787     6139    3   ER_CLSK:
      788     6140    3       ERROR=ERR#IO#CLSK;
      789     6141    3       GLOBAL.RET.SYSERR#=B$TCB$->B$TCB.ALT$->B$ALT.ERR;
      790     6142    3       GLOBAL.RET.DCB#=AWS.KDCB;
      791     6143    3       GOTO ALT;
      792     6144    3   ER_OPNK:
      793     6145    3       ERROR=ERR#IO#OPNK;
      794     6146    3       GLOBAL.RET.SYSERR#=B$TCB$->B$TCB.ALT$->B$ALT.ERR;
      795     6147    3       GLOBAL.RET.DCB#=AWS.KDCB;
      796     6148    3       GOTO ALT;
      797     6149    3   ALT: ALTRETURN;
      798     6150    3   END ZIM$KEYDEL;
      799     6151        %EJECT;
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:63   
      800     6152        /*
      801     6153              SET LOCKOUT BIT FOR UNPROTECTED UPDATE USERS.
      802     6154        */
      803     6155    2   ZIM$FID: PROC ALTRET;
      804     6156
      805     6157    3       IF NOT GLOBAL.PENDING.ROLL_ABORTED AND
      806     6158    3          NOT FILE.UNPROTECT THEN
      807     6159    3           GOTO RET;
      808     6160    3       CALL ZIM$CK_AWS ALTRET(ALT);
      809     6161    3       AWS.ATRIB.UNPROTECT=%YES#; /* IN CASE RECOVERY, LOCKOUT NOT RESET */
      810     6162    3       GLOBAL.TJRNL.UNCHECK=%YES#;
      811     6163    3       JREC.PAGE = 0; /* READ ATTRIBUTE PAGE */
      812     6164    3       CALL ZIM$READ_PG ALTRET(ALT);
      813     6165    3       I_O_BUF$->ATBLK_PG.STATUS.LOCKED='1'B;
      814     6166    3       IF FILE.KEYED THEN /* ALSO LOCK OUT KEYED FILE TILL REBUILD */
      815     6167    3           I_O_BUF$->ATBLK_PG.STATUS.KFILE_CURR='1'B;
      816     6168    3       I_O_BUF$->ATBLK_PG.TIME_LOCKED=GLOBAL.TIME.TSTAMP;
      817     6169    3       I_O_BUF$->ATBLK_PG.REASON_LOCKED.UNPROTECT_ABORT='1'B;
      818     6170    3       I_O_BUF$->ATBLK_PG.REASON_LOCKED.ROLLBACK_FAIL='0'B;
      819     6171    3       CALL ZIO$MODIFY ALTRET(ALT);
      820     6172    3   RET: RETURN;
      821     6173
      822     6174    3   ALT: ALTRETURN;
      823     6175    3   END ZIM$FID;
      824     6176        %EJECT;
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:64   
      825     6177    2   ZIM$READ_PG: PROC ALTRET;
      826     6178    3       GLOBAL.PARAN.IO.PGNO=JREC.PAGE;
      827     6179    3       GLOBAL.PARAN.IO.AWS$=AWS$;
      828     6180    3       CALL ZIO$DBREAD ALTRET(ER_IDSRD);
      829     6181    3       I_O_BUF$=PINCRW(GLOBAL.PARAN.IO.BUF$,-3);
      830     6182    3       RETURN;
      831     6183    3   ER_IDSRD:
      832     6184    3       GOTO ALT;
      833     6185    3   ALT:
      834     6186    3       ALTRETURN;
      835     6187    3   END ZIM$READ_PG;
      836     6188        %EJECT;
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:65   
      837     6189    2   ZIM$CK_AWS: PROC ALTRET;
      838     6190    3       IF AWS_TAB.AWS$(JREC.DCB#) ~= ADDR(NIL) THEN
      839     6191    4       DO;
      840     6192    4           AWS$=AWS_TAB.AWS$(JREC.DCB#);
      841     6193    4           RETURN;
      842     6194    4           END;
      843     6195    4       ELSE DO I = 1 TO 5 BY 1;
      844     6196    4           IF GLOBAL.DB.SSS$(I) ~= ADDR(NIL) THEN
      845     6197    5           DO;
      846     6198    5               SSS$=GLOBAL.DB.SSS$(I);
      847     6199    5               AC$=PINCRW(SSS$,SIZEW(OA1));
      848     6200    6               DO WHILE (AC.OAACN ~= 0);
      849     6201    6                   AC$ = PINCRW(SSS$, AC.OAACN);
      850     6202    6                   AWS$=PINCRW(GLOBAL.DB.DBCB$(I),AC.WSOF);
      851     6203    6                   IF AWS.DDCB = JREC.DCB# THEN
      852     6204    7                   DO;
      853     6205    7                       AWS_TAB.AWS$(JREC.DCB#)=AWS$;
      854     6206    7                       RETURN;
      855     6207    7                       END;
      856     6208    6                   END;
      857     6209    5               END;
      858     6210    4           END;
      859     6211    3   ALT: ERROR = ERR#RL#BADAWS;
      860     6212    3       ALTRETURN;
      861     6213    3   END ZIM$CK_AWS;
      862     6214    2   END ZIM$PPROL;
      863     6215    1   END; /*ZIM$PROL*/

PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:66   
--  Include file information  --

   B_ERRORS_C.:LIB_E05  is referenced.
   ZI_ERRORS_C.:ZIC0TOU  is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
   ZI$USER.:ZIC0TOU  is referenced.
   ZI$SSS.:ZIC0TOU  cannot be made into a system file and is referenced.
   ZI$DBCB.:ZIC0TOU  is referenced.
   ZI$JRNL.:ZIC0TOU  is referenced.
   ZI$PG_STRUCTS.:ZIC0TOU  is referenced.
   ZI$GLOBAL.:ZIC0TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure ZIM$PROL.

   Procedure ZIM$PROL requires 1795 words for executable code.
   Procedure ZIM$PROL requires 620 words of local(AUTO) storage.

    No errors detected in file ZIM$CKROL.:ZIC0TSI    .

PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:67   

 Object Unit name= ZIM$PROL                                   File name= ZIM$CKROL.:ZIC0TOU
 UTS= SEP 05 '97 12:36:58.12 FRI                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1  RoData even  UTS      2      2  ZIM$PROL
    2   Proc  even  none  1795   3403  ZIM$PROL
    3  RoData even  none    29     35  ZIM$PROL

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     2      0   yes    yes     yes      XStd       0  ZIM$PROL
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:68   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           XStd      0 ZIM$OPEN
 yes     yes           XStd      0 ZIO$DBREAD
 yes     yes           XStd      3 ZIO$GETSEG
 yes     yes           XStd      0 ZIO$MODIFY
 yes     yes           XStd      1 ZIO$FLUSH
         yes           XStd      0 ZIM$JROLL
 yes     yes           XStd      0 ZIM$NULL
 yes     yes           XStd      0 ZIO$DBCLOSE
         yes           XStd      3 ZIM$MRL_SHIFT
         yes           XStd      0 ZIM$ICKSMJ
         yes           XStd      0 ZIM$ICKSM
                       nStd      0 X66_AUTO_0
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ZI_TJNAME                             I$ROL                                 B$TCB$
     B$DS3$                                IS$                              r    GLOBAL$
     IA$                                   M$UC

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     NULLSID                               ROSID                                 ISSID
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:69   


      123        1        /*T***********************************************************/
      124        2        /*T*                                                         */
      125        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      126        4        /*T*                                                         */
      127        5        /*T***********************************************************/
      128        6        ZIM$PROL: PROC ALTRET

      6  2 000000   000000 700200 xent  ZIM$PROL     TSX0  ! X66_AUTO_0
         2 000001   001154 000000                    ZERO    620,0

      129        7               AVOID ($PR5,$PR6,$PR7);
      130        8    1   DCL 1 I_O_BUF BASED(I_O_BUF$) ALIGNED,
      131        9    1         2 HW (0:2047) UBIN(18) UNAL,
      132       10    1         2 WD (0:1023) REDEF HW UBIN(36) UNAL;
      133       11    1   DCL 1 REC BASED(REC$) UNAL,
      134       12    1         2 LDEL UBIN(2) UNAL,
      135       13    1         2 TYPE UBIN(16) UNAL,
      136       14    1         2 LEN UBIN(18) UNAL,
      137       15    1         2 * CHAR(REC_SIZ) UNAL;
      138       16    1   DCL MREC_SIZ UBIN(36);
      139       17    1   DCL 1 MREC BASED(MREC$) UNAL,
      140       18    1         2 VAL CHAR(MREC_SIZ) UNAL;
      141       19    1   DCL 1 AWS_TAB (0:511) ALIGNED ,
      142       20    1         2 AWS$ PTR;
      143       21    1   DCL 1 TMP_KEY ALIGNED,
      144       22    1         2 LENGTH UBIN(9) UNAL,
      145       23    1         2 IXID UBIN(18) UNAL,
      146       24    1         2 VALUE CHAR(253) UNAL;
      147       25    1   DCL REC_SIZ UBIN(36) ALIGNED;
      148       26    1   DCL REC_RD CHAR(REC_RD_SIZ) BASED(REC$) CALIGNED;
      149       27    1   DCL ERROR UBIN(36);
      150       28    1   DCL REC_RD_SIZ UBIN(36) UNAL;
      151       29    1   DCL I UBIN(36) ALIGNED;
      152       30    1   DCL REC_OFF UBIN(36) ALIGNED;
      153       31    1   DCL LAST_OFF UBIN(36) ALIGNED;
      154       32    1   DCL J UBIN(36);
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:70   
      155       33    1   DCL TEMP_SAVE UBIN(36) ;
      156       34    1   DCL TEMP# UBIN(36);
      157       35    1   DCL PARTIAL BIT(1);
      158       36        /**/
      159       37    1   DCL ZIO$DBREAD ENTRY ALTRET;
      160       38    1   DCL ZIO$DBCLOSE ENTRY ALTRET;
      161       39    1   DCL ZIM$OPEN ENTRY ALTRET;
      162       40    1   DCL ZIO$MODIFY ENTRY ALTRET;
      163       41    1   DCL ZIM$ICKSM ENTRY;
      164       42    1   DCL ZIM$ICKSMJ ENTRY;
      165       43    1   DCL ZIB$FIXREGS ENTRY ALTRET;
      166       44    1   DCL ZIM$JROLL ENTRY;
      167       45    1   DCL ZIM$NULL ENTRY ALTRET;
      168       46    1   DCL ZIO$GETSEG ENTRY(3) ALTRET;
      169       47    1   DCL ZIO$FLUSH ENTRY(1) ALTRET;
      170       48    1   DCL ZIM$MRL_SHIFT ENTRY(3);
      171       49        /**/
      172       50    1   DCL ZI_TJNAME CHAR(4) SYMREF;
      173       51    1   DCL I$ROL UBIN(36) SYMREF;
      174       52    1   DCL B$TCB$ PTR SYMREF;
      175       53    1   DCL B$DS3$ PTR SYMREF;
      176       54    1   DCL IS$ PTR SYMREF;
      177       55    1   DCL F$DCB$ PTR;
      178       56    1   DCL FPT$ PTR ;
      179       57    1   DCL I_O_BUF$ PTR;
      180       58    1   DCL REC$ PTR;
      181       59    1   DCL MREC$ PTR;
      182       60    1   DCL BOTTOM$ PTR;
      183       61        /**/
      184       62        %INCLUDE ZI$GLOBAL;
      185      548        %GLOBALS;
      186      856        %INCLUDE ZI$PG_STRUCTS;
      187      959        %ATBLK_PG(PSTCLASS=AUTO);
      188     1015        %INCLUDE ZI$JRNL;
      189     1123        %JRNL_REC (STCLASS="AUTO");
      190     1198        %INCLUDE ZI$DBCB;
      191     1840        %AWS;
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:71   
      192     1880        %INCLUDE ZI$SSS;
      193     2429        %OA1;
      194     2437        %OA;
      195     2502        %AC;
      196     2597        %INCLUDE ZI$USER;
      197     2742         %IA;
      198     2791        %INCLUDE CP_6;
      199     2872        %INCLUDE CP_6_SUBS;
      200     3412        %FPT_PRECORD(FPTN=FPT$PRECJ,STCLASS=BASED);
      201     3433        %FPT_PRECORD(FPTN=FPT$PRECI,STCLASS=BASED);
      202     3454        %FPT_PFIL(FPTN=FPT$PFIL,STCLASS=BASED);
      203     3469        %FPT_DELREC(FPTN=FPT$DELR,STCLASS=BASED);
      204     3488        %FPT_DELREC(FPTN=FPT$DELI,STCLASS=BASED);
      205     3507        %FPT_READ(FPTN=FPT$READJ,STCLASS=BASED);
      206     3546        %FPT_WRITE(FPTN=FPT$WRTK,STCLASS=BASED);
      207     3577         %FPT_WRITE(FPTN=FPT$WRTI,STCLASS=BASED);
      208     3608        %FPT_OPEN(FPTN=FPT$REOPEN,STCLASS=BASED);
      209     3717        %FPT_OPEN(FPTN=FPT$OPNDFLT,STCLASS=BASED);
      210     3826        %FPT_CLOSE(FPTN=FPT$CLOSE,STCLASS=BASED);
      211     3868        %VLP_VECTOR(FPTN=VLP$VECTOR,STCLASS=BASED);
      212     3883        %FPT_OPEN(FPTN=FPT$OPNSCRB,STCLASS="BASED");
      213     3992        %FPT_RELDCB(FPTN=FPT$RELDCB,STCLASS="BASED");
      214     4006        %FPT_GETDCB(FPTN=FPT$GETDCB,STCLASS="BASED");
      215     4021        %FPT_TIME(FPTN=FPT$TIME,STCLASS=BASED);
      216     4040        %F$DCB (BASED="BASED(F$DCB$)");
      217     4097        %VLP_SN(FPTN=VLP_SN,N=1,SN='      ',STCLASS=AUTO);
      218     4110        %INCLUDE ZI_ERRORS_C;
      219     4436        %INCLUDE B_ERRORS_C;
      220     5563        %B$ALT;
      221     5571        %B$TCB;
      222     5574        %SUB ALTF#SUFFIX=':';
      223     5575        /**/
      224     5576    1       ERROR=0; /*Initialize the error*/

   5576  2 000002   201105 450100                    STZ     ERROR,,AUTO

      225     5577    1       GLOBAL.PENDING.ROLL= %YES#;
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:72   

   5577  2 000003   000000 470400 xsym               LDP0    GLOBAL$
         2 000004   001000 236003                    LDQ     512,DU
         2 000005   000017 256100                    ORSQ    15,,PR0

      226     5578    1       CALL M$TIME(GLOBAL.TIME$->FPT$TIME);

   5578  2 000006   005117 471500                    LDP1    2639,,PR0
         2 000007   100000 630500                    EPPR0   0,,PR1
         2 000010   020004 713400                    CLIMB   8196
         2 000011   402000 401760                    pmme    nvectors=5

      227     5579    2       DO I=0 TO 511 BY 1;

   5579  2 000012   201107 450100                    STZ     I,,AUTO

      228     5580    2           AWS_TAB.AWS$(I)=ADDR(NIL);

   5580  2 000013   000000 236000 3                  LDQ     0
         2 000014   201107 720100                    LXL0    I,,AUTO
         2 000015   200004 756110                    STQ     AWS_TAB,X0,AUTO

      229     5581    2           END;

   5581  2 000016   201107 235100                    LDA     I,,AUTO
         2 000017   000001 035007                    ADLA    1,DL
         2 000020   201107 755100                    STA     I,,AUTO
         2 000021   001000 115007                    CMPA    512,DL
         2 000022   000013 602000 2                  TNC     s:5580

      230     5582    1       IF GLOBAL.PENDING.RECVRY THEN /* SET AT ZIM$EROL */

   5582  2 000023   000000 470400 xsym               LDP0    GLOBAL$
         2 000024   000017 236100                    LDQ     15,,PR0
         2 000025   010000 316003                    CANQ    4096,DU
         2 000026   000305 600000 2                  TZE     s:5647

PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:73   
      231     5583    2       DO; /*This is recovery mode*/

      232     5584    2           GLOBAL.DCBNAME.LENGTH=5;

   5584  2 000027   005000 236003                    LDQ     2560,DU
         2 000030   004734 552140                    STBQ    2524,'40'O,PR0

      233     5585    2           GLOBAL.DCBNAME.TEXT='TJRNL';

   5585  2 000031   040100 100400                    MLR     fill='040'O
         2 000032   000000 000005 1                  ADSC9   0                        cn=0,n=5
         2 000033   004734 200037                    ADSC9   2524,,PR0                cn=1,n=31

      234     5586    2           GLOBAL.GETDCB$->FPT$GETDCB.V.TEST#=%NO#;

   5586  2 000034   005104 471500                    LDP1    2628,,PR0
         2 000035   000001 236000 3                  LDQ     1
         2 000036   100006 356100                    ANSQ    6,,PR1

      235     5587    2           CALL M$GETDCB(GLOBAL.GETDCB$->FPT$GETDCB) ALTRET(ER_GDCB);

   5587  2 000037   005104 471500                    LDP1    2628,,PR0
         2 000040   100000 630500                    EPPR0   0,,PR1
         2 000041   460002 713400                    CLIMB   alt,+24578
         2 000042   401000 401760                    pmme    nvectors=3
         2 000043   000463 702000 2                  TSX2    ER_GDCB

      236     5588    2           GLOBAL.ACCT=' ';

   5588  2 000044   000002 235000 3                  LDA     2
         2 000045   000002 236000 3                  LDQ     2
         2 000046   000000 470400 xsym               LDP0    GLOBAL$
         2 000047   004744 757100                    STAQ    2532,,PR0

      237     5589    2           GLOBAL.FILENAME.LENGTH=2;

   5589  2 000050   002000 236003                    LDQ     1024,DU
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:74   
         2 000051   004724 552140                    STBQ    2516,'40'O,PR0

      238     5590    2           GLOBAL.FILENAME.TEXT=ZI_TJNAME;

   5590  2 000052   040100 100400                    MLR     fill='040'O
         2 000053   000000 000004 xsym               ADSC9   ZI_TJNAME                cn=0,n=4
         2 000054   004724 200037                    ADSC9   2516,,PR0                cn=1,n=31

      239     5591    2           GLOBAL.OPNSCRB$->FPT$OPNSCRB.V.DCB#=GLOBAL.DCBNUMBER;

   5591  2 000055   005070 471500                    LDP1    2616,,PR0
         2 000056   004623 720100                    LXL0    2451,,PR0
         2 000057   100044 740100                    STX0    36,,PR1

      240     5592    2           GLOBAL.OPNSCRB$->FPT$OPNSCRB.V.FUN#=%IN#;

   5592  2 000060   005070 471500                    LDP1    2616,,PR0
         2 000061   002000 236007                    LDQ     1024,DL
         2 000062   100045 552110                    STBQ    37,'10'O,PR1

      241     5593    2           GLOBAL.OPNSCRB$->FPT$OPNSCRB.V.ACS#=%SEQUEN#;

   5593  2 000063   005070 471500                    LDP1    2616,,PR0
         2 000064   000001 236007                    LDQ     1,DL
         2 000065   100046 552104                    STBQ    38,'04'O,PR1

      242     5594        /*             Open the transient journal. */
      243     5595    2           CALL M$OPEN(GLOBAL.OPNSCRB$->FPT$OPNSCRB) ALTRET(ER_OPNT);

   5595  2 000066   005070 471500                    LDP1    2616,,PR0
         2 000067   100000 630500                    EPPR0   0,,PR1
         2 000070   450000 713400                    CLIMB   alt,open
         2 000071   410400 401760                    pmme    nvectors=18
         2 000072   000460 702000 2                  TSX2    ER_OPNT

      244     5596    2           GLOBAL.TJRNL.DCB#=GLOBAL.DCBNUMBER;

PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:75   
   5596  2 000073   000000 470400 xsym               LDP0    GLOBAL$
         2 000074   004623 235100                    LDA     2451,,PR0
         2 000075   002604 755100                    STA     1412,,PR0

      245     5597    2           GLOBAL.READJ$->FPT$READJ.V.DCB#=GLOBAL.DCBNUMBER;

   5597  2 000076   005116 471500                    LDP1    2638,,PR0
         2 000077   004623 720100                    LXL0    2451,,PR0
         2 000100   100010 740100                    STX0    8,,PR1

      246     5598    2           JRNL$=ADDR(GLOBAL.JRECORD);

   5598  2 000101   000000 236000 xsym               LDQ     GLOBAL$
         2 000102   002622 036003                    ADLQ    1426,DU
         2 000103   201125 756100                    STQ     JRNL$,,AUTO

      247     5599    2           J=0;

   5599  2 000104   201112 450100                    STZ     J,,AUTO

      248     5600    3           DO WHILE (%YES#);

      249     5601    3               CALL M$READ(GLOBAL.READJ$->FPT$READJ) ALTRET(ER_READ);

   5601  2 000105   000000 470400 xsym               LDP0    GLOBAL$
         2 000106   005116 471500                    LDP1    2638,,PR0
         2 000107   100000 630500                    EPPR0   0,,PR1
         2 000110   440000 713400                    CLIMB   alt,read
         2 000111   401400 401760                    pmme    nvectors=4
         2 000112   000432 702000 2                  TSX2    ER_READ

      250     5602    3               IF FILE.TYPE=T#ROL OR FILE.TYPE=T#CKPT THEN

   5602  2 000113   201125 470500                    LDP0    JRNL$,,AUTO
         2 000114   000001 236100                    LDQ     1,,PR0
         2 000115   777000 376003                    ANQ     -512,DU
         2 000116   013000 116003                    CMPQ    5632,DU
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:76   
         2 000117   000307 600000 2                  TZE     FLUSH
         2 000120   014000 116003                    CMPQ    6144,DU
         2 000121   000307 600000 2                  TZE     FLUSH

      251     5603    3                   GOTO FLUSH;
      252     5604    3               IF FILE.TYPE~=T#FID THEN

   5604  2 000122   003000 116003                    CMPQ    1536,DU
         2 000123   000307 601000 2                  TNZ     FLUSH

      253     5605    3                   GOTO FLUSH;
      254     5606    3               CALL ZIO$GETSEG(B$DS3$,SIZEW(AWS)) ALTRET(ER_GS);

   5606  2 000124   000005 630400 3                  EPPR0   5
         2 000125   000003 631400 3                  EPPR1   3
         2 000126   000000 701000 xent               TSX1    ZIO$GETSEG
         2 000127   000450 702000 2                  TSX2    ER_GS

      255     5607    3               AWS_TAB.AWS$(FILE.DCB#)=PINCRW(B$DS3$,J*SIZEW(AWS));

   5607  2 000130   201125 470500                    LDP0    JRNL$,,AUTO
         2 000131   000001 720100                    LXL0    1,,PR0
         2 000132   201112 236100                    LDQ     J,,AUTO
         2 000133   000012 402003                    MPY     10,DU
         2 000134   000000 036000 xsym               ADLQ    B$DS3$
         2 000135   200004 756110                    STQ     AWS_TAB,X0,AUTO

      256     5608    3               AWS$=AWS_TAB.AWS$(FILE.DCB#);

   5608  2 000136   201126 756100                    STQ     AWS$,,AUTO

      257     5609    3               AWS.ENCRP=FILE.CRPT; /*Fill in the  AWS*/

   5609  2 000137   000002 236100                    LDQ     2,,PR0
         2 000140   201126 471500                    LDP1    AWS$,,AUTO
         2 000141   100007 756100                    STQ     7,,PR1

PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:77   
      258     5610    3               AWS.DDCB=0;

   5610  2 000142   000000 220003                    LDX0    0,DU
         2 000143   100006 740100                    STX0    6,,PR1

      259     5611    3               AWS.ATRIB.KEYED=FILE.KEYED;

   5611  2 000144   000003 236100                    LDQ     3,,PR0
         2 000145   000017 772000                    QRL     15
         2 000146   100000 676100                    ERQ     0,,PR1
         2 000147   000004 376003                    ANQ     4,DU
         2 000150   100000 656100                    ERSQ    0,,PR1

      260     5612    3               AWS.ATRIB.FUN=%UPDATE#;

   5612  2 000151   100000 236100                    LDQ     0,,PR1
         2 000152   000007 376000 3                  ANQ     7
         2 000153   000020 276003                    ORQ     16,DU
         2 000154   100000 756100                    STQ     0,,PR1

      261     5613    3               AWS.ATRIB.CHKSUM=FILE.CHKSUM;

   5613  2 000155   000003 236100                    LDQ     3,,PR0
         2 000156   000004 772000                    QRL     4
         2 000157   100000 676100                    ERQ     0,,PR1
         2 000160   010000 376003                    ANQ     4096,DU
         2 000161   100000 656100                    ERSQ    0,,PR1

      262     5614    3               AWS.ATRIB.ATMP=FILE.ATMP;

   5614  2 000162   000003 236100                    LDQ     3,,PR0
         2 000163   000011 772000                    QRL     9
         2 000164   100000 676100                    ERQ     0,,PR1
         2 000165   000100 376003                    ANQ     64,DU
         2 000166   100000 656100                    ERSQ    0,,PR1

      263     5615    3               GLOBAL.DCBNAME.LENGTH=FILE.ID.NAME#.L;
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:78   

   5615  2 000167   000000 473400 xsym               LDP3    GLOBAL$
         2 000170   000010 236100                    LDQ     8,,PR0
         2 000171   000033 736000                    QLS     27
         2 000172   304734 552140                    STBQ    2524,'40'O,PR3

      264     5616    3               GLOBAL.DCBNAME.TEXT=FILE.ID.NAME#.C;

   5616  2 000173   040100 100500                    MLR     fill='040'O
         2 000174   000011 000037                    ADSC9   9,,PR0                   cn=0,n=31
         2 000175   304734 200037                    ADSC9   2524,,PR3                cn=1,n=31

      265     5617    3               GLOBAL.ACCT=FILE.ID.ACCT#;

   5617  2 000176   040100 100500                    MLR     fill='040'O
         2 000177   000003 200010                    ADSC9   3,,PR0                   cn=1,n=8
         2 000200   304744 000010                    ADSC9   2532,,PR3                cn=0,n=8

      266     5618    3               GLOBAL.FILENAME.LENGTH=FILE.ID.NAME#.L;

   5618  2 000201   000010 236100                    LDQ     8,,PR0
         2 000202   000033 736000                    QLS     27
         2 000203   304724 552140                    STBQ    2516,'40'O,PR3

      267     5619    3               GLOBAL.FILENAME.TEXT=FILE.ID.NAME#.C;

   5619  2 000204   040100 100500                    MLR     fill='040'O
         2 000205   000011 000037                    ADSC9   9,,PR0                   cn=0,n=31
         2 000206   304724 200037                    ADSC9   2516,,PR3                cn=1,n=31

      268     5620    3               VLP_SN.NUM#=1;

   5620  2 000207   000001 235007                    LDA     1,DL
         2 000210   201134 755100                    STA     VLP_SN,,AUTO

      269     5621    3               VLP_SN.SN#(0)=FILE.ID.PSN#;

PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:79   
   5621  2 000211   040100 100500                    MLR     fill='040'O
         2 000212   000007 200006                    ADSC9   7,,PR0                   cn=1,n=6
         2 000213   201135 000006                    ADSC9   VLP_SN+1,,AUTO           cn=0,n=6

      270     5622    3               GLOBAL.OPNDFLT$->FPT$OPNDFLT.SN_=VECTOR(VLP_SN);

   5622  2 000214   305067 474500                    LDP4    2615,,PR3
         2 000215   000010 235000 3                  LDA     8
         2 000216   201146 452500                    STP2    VLP_SN+10,,AUTO
         2 000217   201146 236100                    LDQ     VLP_SN+10,,AUTO
         2 000220   001134 036003                    ADLQ    604,DU
         2 000221   400002 757100                    STAQ    2,,PR4

      271     5623    3               GLOBAL.PARAN.IO.AWS$=AWS$;

   5623  2 000222   201126 236100                    LDQ     AWS$,,AUTO
         2 000223   300020 756100                    STQ     16,,PR3

      272     5624    3               CALL ZIM$OPEN

   5624  2 000224   000011 631400 3                  EPPR1   9
         2 000225   000000 701000 xent               TSX1    ZIM$OPEN
         2 000226   000230 702000 2                  TSX2    s:5626
         2 000227   000235 710000 2                  TRA     s:5629

      273     5625    4               WHENALTRETURN DO;

      274     5626    4                   GLOBAL.OPNDFLT$->FPT$OPNDFLT.SN_=VECTOR(NIL);

   5626  2 000230   000000 470400 xsym               LDP0    GLOBAL$
         2 000231   005067 471500                    LDP1    2615,,PR0
         2 000232   000012 237000 3                  LDAQ    10
         2 000233   100002 757100                    STAQ    2,,PR1

      275     5627    4                   GOTO ALT;

   5627  2 000234   000476 710000 2                  TRA     ALT
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:80   

      276     5628    4                   END;
      277     5629    3               GLOBAL.OPNDFLT$->FPT$OPNDFLT.SN_=VECTOR(NIL);

   5629  2 000235   000000 470400 xsym               LDP0    GLOBAL$
         2 000236   005067 471500                    LDP1    2615,,PR0
         2 000237   000012 237000 3                  LDAQ    10
         2 000240   100002 757100                    STAQ    2,,PR1

      278     5630    3               AWS.ATRIB.UNPROTECT='0'B;

   5630  2 000241   201126 471500                    LDP1    AWS$,,AUTO
         2 000242   000014 236000 3                  LDQ     12
         2 000243   100000 356100                    ANSQ    0,,PR1

      279     5631    3               IF FILE.INDEXED='0'B AND FILE.ATMP='0'B THEN

   5631  2 000244   201125 473500                    LDP3    JRNL$,,AUTO
         2 000245   300003 236100                    LDQ     3,,PR3
         2 000246   040000 316003                    CANQ    16384,DU
         2 000247   000301 601000 2                  TNZ     s:5643
         2 000250   100000 316003                    CANQ    32768,DU
         2 000251   000301 601000 2                  TNZ     s:5643

      280     5632    4               DO; /* LOCK IT AT BEGINNIG OF RECOVERY */

      281     5633    4                   GLOBAL.PARAN.IO.PGNO=0; /* READ ATRIB PAGE */

   5633  2 000252   000021 450100                    STZ     17,,PR0

      282     5634    4                   CALL ZIO$DBREAD ALTRET(ALT);

   5634  2 000253   000011 631400 3                  EPPR1   9
         2 000254   000000 701000 xent               TSX1    ZIO$DBREAD
         2 000255   000476 702000 2                  TSX2    ALT

      283     5635    4                   I_O_BUF$=PINCRW(GLOBAL.PARAN.IO.BUF$,-3);
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:81   

   5635  2 000256   000000 470400 xsym               LDP0    GLOBAL$
         2 000257   000022 236100                    LDQ     18,,PR0
         2 000260   777775 036003                    ADLQ    -3,DU
         2 000261   201120 756100                    STQ     I_O_BUF$,,AUTO

      284     5636    4                   I_O_BUF$->ATBLK_PG.STATUS.LOCKED='1'B;

   5636  2 000262   201120 471500                    LDP1    I_O_BUF$,,AUTO
         2 000263   400000 236003                    LDQ     -131072,DU
         2 000264   100041 256100                    ORSQ    33,,PR1

      285     5637    4                   IF FILE.KEYED THEN /* ALSO LOCK OUT KEYED FILE */

   5637  2 000265   201125 473500                    LDP3    JRNL$,,AUTO
         2 000266   300003 234100                    SZN     3,,PR3
         2 000267   000272 605000 2                  TPL     s:5639

      286     5638    4                       I_O_BUF$->ATBLK_PG.STATUS.KFILE_CURR='1'B;

   5638  2 000270   100000 236003                    LDQ     32768,DU
         2 000271   100041 256100                    ORSQ    33,,PR1

      287     5639    4                   I_O_BUF$->ATBLK_PG.REASON_LOCKED.ROLLBACK_FAIL='1'B;

   5639  2 000272   100000 236003                    LDQ     32768,DU
         2 000273   100043 256100                    ORSQ    35,,PR1

      288     5640    4                   I_O_BUF$->ATBLK_PG.TIME_LOCKED=GLOBAL.TIME.TSTAMP;

   5640  2 000274   005001 235100                    LDA     2561,,PR0
         2 000275   100042 755100                    STA     34,,PR1

      289     5641    4                   CALL ZIO$MODIFY ALTRET(ALT);

   5641  2 000276   000011 631400 3                  EPPR1   9
         2 000277   000000 701000 xent               TSX1    ZIO$MODIFY
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:82   
         2 000300   000476 702000 2                  TSX2    ALT

      290     5642    4                   END;

      291     5643    3               J=J+1;

   5643  2 000301   201112 235100                    LDA     J,,AUTO
         2 000302   000001 035007                    ADLA    1,DL
         2 000303   201112 755100                    STA     J,,AUTO

      292     5644    3               END;

   5644  2 000304   000105 710000 2                  TRA     s:5601

      293     5645    2           END;
      294     5646    1       ELSE
      295     5647    1           IF GLOBAL.TJRNL.DCB#=0 THEN

   5647  2 000305   002604 235100                    LDA     1412,,PR0
         2 000306   000427 600000 2                  TZE     ER_TJNA

      296     5648    1               GOTO ER_TJNA;
      297     5649    1   FLUSH: /* FLUSH ALL BUFFERS IN POOL */
      298     5650    1       GLOBAL.PENDING.FORGET='1'B;

   5650  2 000307   000000 470400 xsym  FLUSH        LDP0    GLOBAL$
         2 000310   000100 236003                    LDQ     64,DU
         2 000311   000017 256100                    ORSQ    15,,PR0

      299     5651    1       CALL ZIO$FLUSH(%YES#) ALTRET(ALT);

   5651  2 000312   000017 630400 3                  EPPR0   15
         2 000313   000015 631400 3                  EPPR1   13
         2 000314   000000 701000 xent               TSX1    ZIO$FLUSH
         2 000315   000476 702000 2                  TSX2    ALT

      300     5652    1       CALL ZIM$PPROL ALTRET(ALT);
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:83   

   5652  2 000316   000477 701000 2                  TSX1    ZIM$PPROL
         2 000317   000476 702000 2                  TSX2    ALT

      301     5653    1       GLOBAL.PENDING.FORGET='0'B;

   5653  2 000320   000000 470400 xsym               LDP0    GLOBAL$
         2 000321   000020 236000 3                  LDQ     16
         2 000322   000017 356100                    ANSQ    15,,PR0

      302     5654    1       CALL ZIO$FLUSH(%NO#) ALTRET(ALT);

   5654  2 000323   000021 630400 3                  EPPR0   17
         2 000324   000015 631400 3                  EPPR1   13
         2 000325   000000 701000 xent               TSX1    ZIO$FLUSH
         2 000326   000476 702000 2                  TSX2    ALT

      303     5655    1       IF ~GLOBAL.PENDING.RECVRY THEN

   5655  2 000327   000000 470400 xsym               LDP0    GLOBAL$
         2 000330   000017 236100                    LDQ     15,,PR0
         2 000331   000005 736000                    QLS     5
         2 000332   400000 376003                    ANQ     -131072,DU
         2 000333   400000 676003                    ERQ     -131072,DU
         2 000334   000363 600000 2                  TZE     s:5668

      304     5656    2       DO;

      305     5657    2           GLOBAL.PENDING.ROLL=%NO#;

   5657  2 000335   000022 236000 3                  LDQ     18
         2 000336   000017 356100                    ANSQ    15,,PR0

      306     5658    2           CALL ZIM$JROLL;

   5658  2 000337   000011 631400 3                  EPPR1   9
         2 000340   000000 701000 xent               TSX1    ZIM$JROLL
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:84   
         2 000341   000000 011000                    NOP     0

      307     5659    2           CALL ZIM$NULL ALTRET(ALT);

   5659  2 000342   000011 631400 3                  EPPR1   9
         2 000343   000000 701000 xent               TSX1    ZIM$NULL
         2 000344   000476 702000 2                  TSX2    ALT

      308     5660    2           IF GLOBAL.ROLLADDR~=0 AND ~GLOBAL.PENDING.XCON THEN

   5660  2 000345   000000 470400 xsym               LDP0    GLOBAL$
         2 000346   002612 235100                    LDA     1418,,PR0
         2 000347   000416 600000 2                  TZE     s:5679
         2 000350   000017 236100                    LDQ     15,,PR0
         2 000351   000006 736000                    QLS     6
         2 000352   400000 376003                    ANQ     -131072,DU
         2 000353   400000 676003                    ERQ     -131072,DU
         2 000354   000416 600000 2                  TZE     s:5679

      309     5661    3           DO;

      310     5662    3               IA.UCALL_LOC=GLOBAL.ROLLADDR;

   5662  2 000355   002612 720100                    LXL0    1418,,PR0
         2 000356   000000 471400 xsym               LDP1    IA$
         2 000357   100006 440100                    SXL0    6,,PR1

      311     5663    3               IA.ROLLFLAG=%YES#;

   5663  2 000360   400000 221003                    LDX1    -131072,DU
         2 000361   100006 741100                    STX1    6,,PR1

      312     5664    3               END;

      313     5665    2           END;

   5665  2 000362   000416 710000 2                  TRA     s:5679
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:85   

      314     5666    1       ELSE
      315     5667    2       DO;

      316     5668    3           DO I = 0 TO 511 BY 1; /*Close all the areas that were open*/

   5668  2 000363   201107 450100                    STZ     I,,AUTO

      317     5669    3               IF AWS_TAB.AWS$(I) ~= ADDR(NIL) THEN

   5669  2 000364   201107 720100                    LXL0    I,,AUTO
         2 000365   200004 236110                    LDQ     AWS_TAB,X0,AUTO
         2 000366   000000 116000 3                  CMPQ    0
         2 000367   000375 600000 2                  TZE     s:5674

      318     5670    4               DO;

      319     5671    4                   GLOBAL.PARAN.IO.AWS$=AWS_TAB.AWS$(I);

   5671  2 000370   000000 470400 xsym               LDP0    GLOBAL$
         2 000371   000020 756100                    STQ     16,,PR0

      320     5672    4                   CALL ZIO$DBCLOSE ALTRET(ALT);

   5672  2 000372   000011 631400 3                  EPPR1   9
         2 000373   000000 701000 xent               TSX1    ZIO$DBCLOSE
         2 000374   000476 702000 2                  TSX2    ALT

      321     5673    4                   END;

      322     5674    3               END;

   5674  2 000375   201107 235100                    LDA     I,,AUTO
         2 000376   000001 035007                    ADLA    1,DL
         2 000377   201107 755100                    STA     I,,AUTO
         2 000400   001000 115007                    CMPA    512,DL
         2 000401   000364 602000 2                  TNC     s:5669
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:86   

      323     5675    2           GLOBAL.CLOSE$->FPT$CLOSE.V.DCB#=GLOBAL.TJRNL.DCB#; /*Also close the Tjrnl*/

   5675  2 000402   000000 470400 xsym               LDP0    GLOBAL$
         2 000403   005072 471500                    LDP1    2618,,PR0
         2 000404   002604 720100                    LXL0    1412,,PR0
         2 000405   100032 740100                    STX0    26,,PR1

      324     5676    2           GLOBAL.CLOSE$->FPT$CLOSE.V.DISP#=%RELEASE#;

   5676  2 000406   005072 471500                    LDP1    2618,,PR0
         2 000407   000001 236007                    LDQ     1,DL
         2 000410   100032 552104                    STBQ    26,'04'O,PR1

      325     5677    2           CALL M$CLOSE(GLOBAL.CLOSE$->FPT$CLOSE) ALTRET(ER_RJRNL);

   5677  2 000411   005072 471500                    LDP1    2618,,PR0
         2 000412   100000 630500                    EPPR0   0,,PR1
         2 000413   450001 713400                    CLIMB   alt,close
         2 000414   406000 401760                    pmme    nvectors=13
         2 000415   000440 702000 2                  TSX2    ER_RJRNL

      326     5678    2           END;

      327     5679    1       GLOBAL.RET.ERROR#=EXC#ROLL;

   5679  2 000416   002114 235007                    LDA     1100,DL
         2 000417   000000 470400 xsym               LDP0    GLOBAL$
         2 000420   000006 755100                    STA     6,,PR0

      328     5680    1       GLOBAL.RET.STCD#=STMTCD#IDS;

   5680  2 000421   000023 220003                    LDX0    19,DU
         2 000422   000014 440100                    SXL0    12,,PR0

      329     5681    1   RET: GLOBAL.PENDING.ROLL='0'B;

PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:87   
   5681  2 000423   000000 470400 xsym  RET          LDP0    GLOBAL$
         2 000424   000022 236000 3                  LDQ     18
         2 000425   000017 356100                    ANSQ    15,,PR0

      330     5682    1       RETURN;

   5682  2 000426   000000 702200 xent               TSX2  ! X66_ARET

      331     5683    1   ER_TJNA: GLOBAL.RET.ERROR#=ERR#RL#FTJNA; /* NO TJRNL FOR THE USER */

   5683  2 000427   303450 235007       ER_TJNA      LDA     100136,DL
         2 000430   000006 755100                    STA     6,,PR0

      332     5684    1       GOTO RET;

   5684  2 000431   000423 710000 2                  TRA     RET

      333     5685    1   ER_READ: IF B$TCB$->B$TCB.ALT$->B$ALT.ERR.ERR#=%E$EOF THEN

   5685  2 000432   000000 470400 xsym  ER_READ      LDP0    B$TCB$
         2 000433   000000 471500                    LDP1    0,,PR0
         2 000434   100102 236100                    LDQ     66,,PR1
         2 000435   377770 376007                    ANQ     131064,DL
         2 000436   000060 116007                    CMPQ    48,DL
         2 000437   000307 600000 2                  TZE     FLUSH

      334     5686    1           GOTO FLUSH;
      335     5687    1   ER_RJRNL:
      336     5688    1       ERROR=ERR#RL#RJRNL;

   5688  2 000440   303407 235007       ER_RJRNL     LDA     100103,DL
         2 000441   201105 755100                    STA     ERROR,,AUTO

      337     5689    1       GLOBAL.RET.SYSERR#=B$TCB$->B$TCB.ALT$->B$ALT.ERR;

   5689  2 000442   000000 470400 xsym               LDP0    B$TCB$
         2 000443   000000 471500                    LDP1    0,,PR0
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:88   
         2 000444   100102 236100                    LDQ     66,,PR1
         2 000445   000000 473400 xsym               LDP3    GLOBAL$
         2 000446   300007 756100                    STQ     7,,PR3

      338     5690    1       GOTO COMMON;

   5690  2 000447   000473 710000 2                  TRA     COMMON

      339     5691    1   ER_GS:
      340     5692    1       ERROR=ERR#RL#GDS;

   5692  2 000450   303413 235007       ER_GS        LDA     100107,DL
         2 000451   201105 755100                    STA     ERROR,,AUTO

      341     5693    1       GLOBAL.RET.SYSERR#=B$TCB$->B$TCB.ALT$->B$ALT.ERR;

   5693  2 000452   000000 470400 xsym               LDP0    B$TCB$
         2 000453   000000 471500                    LDP1    0,,PR0
         2 000454   100102 236100                    LDQ     66,,PR1
         2 000455   000000 473400 xsym               LDP3    GLOBAL$
         2 000456   300007 756100                    STQ     7,,PR3

      342     5694    1       GOTO COMMON;

   5694  2 000457   000473 710000 2                  TRA     COMMON

      343     5695    1   ER_OPNT: GLOBAL.RET.DCB#=GLOBAL.DCBNUMBER;

   5695  2 000460   000000 470400 xsym  ER_OPNT      LDP0    GLOBAL$
         2 000461   004623 720100                    LXL0    2451,,PR0
         2 000462   000014 740100                    STX0    12,,PR0

      344     5696    1   ER_GDCB:
      345     5697    1       ERROR=ERR#IO#OPNT;

   5697  2 000463   210716 235007       ER_GDCB      LDA     70094,DL
         2 000464   201105 755100                    STA     ERROR,,AUTO
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:89   

      346     5698    1       GLOBAL.RET.SYSERR#=B$TCB$->B$TCB.ALT$->B$ALT.ERR;

   5698  2 000465   000000 470400 xsym               LDP0    B$TCB$
         2 000466   000000 471500                    LDP1    0,,PR0
         2 000467   100102 236100                    LDQ     66,,PR1
         2 000470   000000 473400 xsym               LDP3    GLOBAL$
         2 000471   300007 756100                    STQ     7,,PR3

      347     5699    1       GOTO COMMON;

   5699  2 000472   000473 710000 2                  TRA     COMMON

   5698  2 000473                       COMMON       null
      348     5700    1   COMMON: ;
      349     5701    1       GLOBAL.RET.ERROR#=ERROR;

   5701  2 000473   300006 755100                    STA     6,,PR3

      350     5702    1       GLOBAL.RET.STCD#=STMTCD#IDS;

   5702  2 000474   000023 220003                    LDX0    19,DU
         2 000475   300014 440100                    SXL0    12,,PR3

   5702  2 000476                       ALT          null
   5702  2 000476                       ER_MOD       null
      351     5703    1   ALT: ;
      352     5704    1   ER_MOD: ;
      353     5705    1       ALTRETURN;

   5705  2 000476   000000 702200 xent               TSX2  ! X66_AALT

      354     5706         %EJECT;
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:90   
      355     5707    1   ZIM$PPROL: PROC ALTRET;

   5707  2 000477   201140 741300       ZIM$PPROL    STX1  ! VLP_SN+4,,AUTO

      356     5708        /*
      357     5709                  Start by positioning to end of trans journal file.
      358     5710        */
      359     5711    2       GLOBAL.PFIL$ -> FPT$PFIL.V.DCB# = GLOBAL.TJRNL.DCB#;

   5711  2 000500   000000 470400 xsym               LDP0    GLOBAL$
         2 000501   005114 471500                    LDP1    2636,,PR0
         2 000502   002604 720100                    LXL0    1412,,PR0
         2 000503   100002 740100                    STX0    2,,PR1

      360     5712    2       GLOBAL.PFIL$ -> FPT$PFIL.V.BOF# = %NO#;

   5712  2 000504   005114 471500                    LDP1    2636,,PR0
         2 000505   000014 236000 3                  LDQ     12
         2 000506   100002 356100                    ANSQ    2,,PR1

      361     5713    2       CALL M$PFIL(GLOBAL.PFIL$ -> FPT$PFIL) ALTRET(ER_PFIL);

   5713  2 000507   005114 471500                    LDP1    2636,,PR0
         2 000510   100000 630500                    EPPR0   0,,PR1
         2 000511   440004 713400                    CLIMB   alt,+16388
         2 000512   400000 401760                    pmme    nvectors=1
         2 000513   000766 702000 2                  TSX2    ER_PFIL

      362     5714    2       GLOBAL.PRECJ$->FPT$PRECJ.V.DCB#=GLOBAL.TJRNL.DCB#;

   5714  2 000514   000000 470400 xsym               LDP0    GLOBAL$
         2 000515   005124 471500                    LDP1    2644,,PR0
         2 000516   002604 720100                    LXL0    1412,,PR0
         2 000517   100006 740100                    STX0    6,,PR1

      363     5715    2       GLOBAL.PRECJ$->FPT$PRECJ.V.N#=-1;

PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:91   
   5715  2 000520   005124 471500                    LDP1    2644,,PR0
         2 000521   000001 335007                    LCA     1,DL
         2 000522   100007 755100                    STA     7,,PR1

      364     5716    2       GLOBAL.READJ$->FPT$READJ.V.DCB#=GLOBAL.TJRNL.DCB#;

   5716  2 000523   005116 471500                    LDP1    2638,,PR0
         2 000524   002604 720100                    LXL0    1412,,PR0
         2 000525   100010 740100                    STX0    8,,PR1

      365     5717    2       JRNL$=ADDR(GLOBAL.JRECORD);

   5717  2 000526   000000 236000 xsym               LDQ     GLOBAL$
         2 000527   002622 036003                    ADLQ    1426,DU
         2 000530   201125 756100                    STQ     JRNL$,,AUTO

      366     5718        /*       If possible partial update from other than ROLLBACK
      367     5719                 allow mistake of first rollback record since cant tell */
      368     5720    2       IF POFFW(ADDR(I$ROL),IS$)~=GLOBAL.FCN.CODE THEN

   5720  2 000531   000023 236000 3                  LDQ     19
         2 000532   000022 772000                    QRL     18
         2 000533   000000 235000 xsym               LDA     IS$
         2 000534   000022 771000                    ARL     18
         2 000535   201146 755100                    STA     VLP_SN+10,,AUTO
         2 000536   201146 136100                    SBLQ    VLP_SN+10,,AUTO
         2 000537   201147 756100                    STQ     VLP_SN+11,,AUTO
         2 000540   000004 236100                    LDQ     4,,PR0
         2 000541   777777 376007                    ANQ     -1,DL
         2 000542   201150 756100                    STQ     VLP_SN+12,,AUTO
         2 000543   201147 236100                    LDQ     VLP_SN+11,,AUTO
         2 000544   201150 116100                    CMPQ    VLP_SN+12,,AUTO
         2 000545   000550 600000 2                  TZE     s:5723

      369     5721    2           PARTIAL=%YES#;

   5721  2 000546   400000 236003                    LDQ     -131072,DU
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:92   
         2 000547   201115 756100                    STQ     PARTIAL,,AUTO

      370     5722    3       DO WHILE (%YES#);

      371     5723    3           CALL M$PRECORD(GLOBAL.PRECJ$->FPT$PRECJ) ALTRET(ER_PJRNL);

   5723  2 000550   000000 470400 xsym               LDP0    GLOBAL$
         2 000551   005124 471500                    LDP1    2644,,PR0
         2 000552   100000 630500                    EPPR0   0,,PR1
         2 000553   440003 713400                    CLIMB   alt,+16387
         2 000554   401000 401760                    pmme    nvectors=3
         2 000555   000735 702000 2                  TSX2    ER_PJRNL

      372     5724    3           CALL M$READ(GLOBAL.READJ$->FPT$READJ) ALTRET(ER_READ);

   5724  2 000556   000000 470400 xsym               LDP0    GLOBAL$
         2 000557   005116 471500                    LDP1    2638,,PR0
         2 000560   100000 630500                    EPPR0   0,,PR1
         2 000561   440000 713400                    CLIMB   alt,read
         2 000562   401400 401760                    pmme    nvectors=4
         2 000563   000754 702000 2                  TSX2    ER_READ

      373     5725        /*
      374     5726           The type of journaling action (ie delete,store..etc) is found in
      375     5727           the first byte of the journal record. JREC.TYPE
      376     5728        */
      377     5729    4           DO CASE(JREC.TYPE);

   5729  2 000564   201125 470500                    LDP0    JRNL$,,AUTO
         2 000565   000001 236100                    LDQ     1,,PR0
         2 000566   000033 772000                    QRL     27
         2 000567   000023 116007                    CMPQ    19,DL
         2 000570   000572 602006 2                  TNC     s:5729+6,QL
         2 000571   000725 710000 2                  TRA     s:5764
         2 000572   000725 710000 2                  TRA     s:5764
         2 000573   000725 710000 2                  TRA     s:5764
         2 000574   000725 710000 2                  TRA     s:5764
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:93   
         2 000575   000723 710000 2                  TRA     s:5762
         2 000576   000725 710000 2                  TRA     s:5764
         2 000577   000667 710000 2                  TRA     s:5749
         2 000600   000615 710000 2                  TRA     s:5731
         2 000601   000624 710000 2                  TRA     s:5734
         2 000602   000633 710000 2                  TRA     s:5737
         2 000603   000642 710000 2                  TRA     s:5740
         2 000604   000725 710000 2                  TRA     s:5764
         2 000605   000725 710000 2                  TRA     s:5764
         2 000606   000725 710000 2                  TRA     s:5764
         2 000607   000725 710000 2                  TRA     s:5764
         2 000610   000651 710000 2                  TRA     s:5743
         2 000611   000660 710000 2                  TRA     s:5746
         2 000612   000676 710000 2                  TRA     s:5752
         2 000613   000705 710000 2                  TRA     s:5755
         2 000614   000714 710000 2                  TRA     s:5758

      378     5730    4           CASE(T#STO);

      379     5731    4               IF NOT GLOBAL.PENDING.ROLL_ABORTED THEN

   5731  2 000615   000000 471400 xsym               LDP1    GLOBAL$
         2 000616   100017 236100                    LDQ     15,,PR1
         2 000617   000040 316003                    CANQ    32,DU
         2 000620   000725 601000 2                  TNZ     s:5764

      380     5732    4                   CALL ZIM$STO ALTRET(ALT);

   5732  2 000621   001002 701000 2                  TSX1    ZIM$STO
         2 000622   001000 702000 2                  TSX2    ALT
         2 000623   000725 710000 2                  TRA     s:5764

      381     5733    4           CASE(T#DEL);

      382     5734    4               IF NOT GLOBAL.PENDING.ROLL_ABORTED THEN

   5734  2 000624   000000 471400 xsym               LDP1    GLOBAL$
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:94   
         2 000625   100017 236100                    LDQ     15,,PR1
         2 000626   000040 316003                    CANQ    32,DU
         2 000627   000725 601000 2                  TNZ     s:5764

      383     5735    4                   CALL ZIM$DEL ALTRET(ALT);

   5735  2 000630   001420 701000 2                  TSX1    ZIM$DEL
         2 000631   001000 702000 2                  TSX2    ALT
         2 000632   000725 710000 2                  TRA     s:5764

      384     5736    4           CASE(T#MOD);

      385     5737    4               IF NOT GLOBAL.PENDING.ROLL_ABORTED THEN

   5737  2 000633   000000 471400 xsym               LDP1    GLOBAL$
         2 000634   100017 236100                    LDQ     15,,PR1
         2 000635   000040 316003                    CANQ    32,DU
         2 000636   000725 601000 2                  TNZ     s:5764

      386     5738    4                   CALL ZIM$MOD ALTRET(ALT);

   5738  2 000637   001750 701000 2                  TSX1    ZIM$MOD
         2 000640   001000 702000 2                  TSX2    ALT
         2 000641   000725 710000 2                  TRA     s:5764

      387     5739    4           CASE(T#CKB);

      388     5740    4               IF NOT GLOBAL.PENDING.ROLL_ABORTED THEN

   5740  2 000642   000000 471400 xsym               LDP1    GLOBAL$
         2 000643   100017 236100                    LDQ     15,,PR1
         2 000644   000040 316003                    CANQ    32,DU
         2 000645   000725 601000 2                  TNZ     s:5764

      389     5741    4                   CALL ZIM$SUM ALTRET(ALT);

   5741  2 000646   002674 701000 2                  TSX1    ZIM$SUM
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:95   
         2 000647   001000 702000 2                  TSX2    ALT
         2 000650   000725 710000 2                  TRA     s:5764

      390     5742    4           CASE(T#KSTO);

      391     5743    4               IF NOT GLOBAL.PENDING.ROLL_ABORTED THEN

   5743  2 000651   000000 471400 xsym               LDP1    GLOBAL$
         2 000652   100017 236100                    LDQ     15,,PR1
         2 000653   000040 316003                    CANQ    32,DU
         2 000654   000725 601000 2                  TNZ     s:5764

      392     5744    4                   CALL ZIM$KEYSTO ALTRET(ALT);

   5744  2 000655   003020 701000 2                  TSX1    ZIM$KEYSTO
         2 000656   001000 702000 2                  TSX2    ALT
         2 000657   000725 710000 2                  TRA     s:5764

      393     5745    4           CASE(T#KDEL);

      394     5746    4               IF NOT GLOBAL.PENDING.ROLL_ABORTED THEN

   5746  2 000660   000000 471400 xsym               LDP1    GLOBAL$
         2 000661   100017 236100                    LDQ     15,,PR1
         2 000662   000040 316003                    CANQ    32,DU
         2 000663   000725 601000 2                  TNZ     s:5764

      395     5747    4                   CALL ZIM$KEYDEL ALTRET(ALT);

   5747  2 000664   003057 701000 2                  TSX1    ZIM$KEYDEL
         2 000665   001000 702000 2                  TSX2    ALT
         2 000666   000725 710000 2                  TRA     s:5764

      396     5748    4           CASE(T#MSET);

      397     5749    4               IF NOT GLOBAL.PENDING.ROLL_ABORTED THEN

PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:96   
   5749  2 000667   000000 471400 xsym               LDP1    GLOBAL$
         2 000670   100017 236100                    LDQ     15,,PR1
         2 000671   000040 316003                    CANQ    32,DU
         2 000672   000725 601000 2                  TNZ     s:5764

      398     5750    4                   CALL ZIM$MSET ALTRET(ALT);

   5750  2 000673   002745 701000 2                  TSX1    ZIM$MSET
         2 000674   001000 702000 2                  TSX2    ALT
         2 000675   000725 710000 2                  TRA     s:5764

      399     5751    4           CASE(T#ISTO);

      400     5752    4               IF NOT GLOBAL.PENDING.ROLL_ABORTED THEN

   5752  2 000676   000000 471400 xsym               LDP1    GLOBAL$
         2 000677   100017 236100                    LDQ     15,,PR1
         2 000700   000040 316003                    CANQ    32,DU
         2 000701   000725 601000 2                  TNZ     s:5764

      401     5753    4                   CALL ZIM$RISTO ALTRET(ALT);

   5753  2 000702   002374 701000 2                  TSX1    ZIM$RISTO
         2 000703   001000 702000 2                  TSX2    ALT
         2 000704   000725 710000 2                  TRA     s:5764

      402     5754    4           CASE(T#IDEL);

      403     5755    4               IF NOT GLOBAL.PENDING.ROLL_ABORTED THEN

   5755  2 000705   000000 471400 xsym               LDP1    GLOBAL$
         2 000706   100017 236100                    LDQ     15,,PR1
         2 000707   000040 316003                    CANQ    32,DU
         2 000710   000725 601000 2                  TNZ     s:5764

      404     5756    4                   CALL ZIM$RIDEL ALTRET(ALT);

PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:97   
   5756  2 000711   002514 701000 2                  TSX1    ZIM$RIDEL
         2 000712   001000 702000 2                  TSX2    ALT
         2 000713   000725 710000 2                  TRA     s:5764

      405     5757    4           CASE(T#IMOD);

      406     5758    4               IF NOT GLOBAL.PENDING.ROLL_ABORTED THEN

   5758  2 000714   000000 471400 xsym               LDP1    GLOBAL$
         2 000715   100017 236100                    LDQ     15,,PR1
         2 000716   000040 316003                    CANQ    32,DU
         2 000717   000725 601000 2                  TNZ     s:5764

      407     5759    4                   CALL ZIM$RIMOD ALTRET(ALT);

   5759  2 000720   002604 701000 2                  TSX1    ZIM$RIMOD
         2 000721   001000 702000 2                  TSX2    ALT
         2 000722   000725 710000 2                  TRA     s:5764

      408     5760    4           CASE(T#CKPT,T#ROL);

      409     5761    4           CASE(T#FID);

      410     5762    4               CALL ZIM$FID ALTRET(ALT);

   5762  2 000723   003220 701000 2                  TSX1    ZIM$FID
         2 000724   001000 702000 2                  TSX2    ALT

      411     5763    4               END;

      412     5764    3           PARTIAL=%NO#;

   5764  2 000725   201115 450100                    STZ     PARTIAL,,AUTO

      413     5765    3           GLOBAL.PRECJ$->FPT$PRECJ.V.N#=-2;

   5765  2 000726   000000 470400 xsym               LDP0    GLOBAL$
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:98   
         2 000727   005124 471500                    LDP1    2644,,PR0
         2 000730   000002 335007                    LCA     2,DL
         2 000731   100007 755100                    STA     7,,PR1

      414     5766    3           END;

   5766  2 000732   000550 710000 2                  TRA     s:5723

      415     5767    2   RET: RETURN;

   5767  2 000733   201140 221300       RET          LDX1  ! VLP_SN+4,,AUTO
         2 000734   000001 702211                    TSX2  ! 1,X1

      416     5768    2   ER_PJRNL:
      417     5769    2       IF B$TCB$->B$TCB.ALT$->B$ALT.ERR.ERR#=%E$BOF THEN

   5769  2 000735   000000 470400 xsym  ER_PJRNL     LDP0    B$TCB$
         2 000736   000000 471500                    LDP1    0,,PR0
         2 000737   100102 236100                    LDQ     66,,PR1
         2 000740   377770 376007                    ANQ     131064,DL
         2 000741   000040 116007                    CMPQ    32,DL
         2 000742   000733 600000 2                  TZE     RET

      418     5770    2           GOTO RET;
      419     5771    2       ERROR=ERR#RL#PJRNL;

   5771  2 000743   303406 235007                    LDA     100102,DL
         2 000744   201105 755100                    STA     ERROR,,AUTO

      420     5772    2       GLOBAL.RET.SYSERR#=B$TCB$->B$TCB.ALT$->B$ALT.ERR;

   5772  2 000745   100102 236100                    LDQ     66,,PR1
         2 000746   000000 473400 xsym               LDP3    GLOBAL$
         2 000747   300007 756100                    STQ     7,,PR3

      421     5773    2       GLOBAL.RET.DCB#=GLOBAL.TJRNL.DCB#;

PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:99   
   5773  2 000750   302604 720100                    LXL0    1412,,PR3
         2 000751   300014 740100                    STX0    12,,PR3

      422     5774    2       RETURN;

   5774  2 000752   201140 221300                    LDX1  ! VLP_SN+4,,AUTO
         2 000753   000001 702211                    TSX2  ! 1,X1

      423     5775    2   ER_READ:
      424     5776    2       ERROR=ERR#RL#RJRNL;

   5776  2 000754   303407 235007       ER_READ      LDA     100103,DL
         2 000755   201105 755100                    STA     ERROR,,AUTO

      425     5777    2       GLOBAL.RET.SYSERR#=B$TCB$->B$TCB.ALT$->B$ALT.ERR;

   5777  2 000756   000000 470400 xsym               LDP0    B$TCB$
         2 000757   000000 471500                    LDP1    0,,PR0
         2 000760   100102 236100                    LDQ     66,,PR1
         2 000761   000000 473400 xsym               LDP3    GLOBAL$
         2 000762   300007 756100                    STQ     7,,PR3

      426     5778    2       GLOBAL.RET.DCB#=GLOBAL.TJRNL.DCB#;

   5778  2 000763   302604 720100                    LXL0    1412,,PR3
         2 000764   300014 740100                    STX0    12,,PR3

      427     5779    2       GOTO ALT;

   5779  2 000765   001000 710000 2                  TRA     ALT

      428     5780    2   ER_PFIL:
      429     5781    2       ERROR=ERR#RL#ERPFIL;

   5781  2 000766   303411 235007       ER_PFIL      LDA     100105,DL
         2 000767   201105 755100                    STA     ERROR,,AUTO

PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:100  
      430     5782    2       GLOBAL.RET.SYSERR#=B$TCB$->B$TCB.ALT$->B$ALT.ERR;

   5782  2 000770   000000 470400 xsym               LDP0    B$TCB$
         2 000771   000000 471500                    LDP1    0,,PR0
         2 000772   100102 236100                    LDQ     66,,PR1
         2 000773   000000 473400 xsym               LDP3    GLOBAL$
         2 000774   300007 756100                    STQ     7,,PR3

      431     5783    2       GLOBAL.RET.DCB#=GLOBAL.TJRNL.DCB#;

   5783  2 000775   302604 720100                    LXL0    1412,,PR3
         2 000776   300014 740100                    STX0    12,,PR3

      432     5784    2       GOTO ALT;

   5784  2 000777   001000 710000 2                  TRA     ALT

      433     5785    2   ALT:
      434     5786    2       ALTRETURN;

   5786  2 001000   201140 221300       ALT          LDX1  ! VLP_SN+4,,AUTO
         2 001001   000000 702211                    TSX2  ! 0,X1

      435     5787        %EJECT;
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:101  
      436     5788    2   ZIM$STO: PROC ALTRET;

   5788  2 001002   201142 741300       ZIM$STO      STX1  ! VLP_SN+6,,AUTO

      437     5789
      438     5790    3       CALL ZIM$CK_AWS ALTRET(ALT);

   5790  2 001003   003316 701000 2                  TSX1    ZIM$CK_AWS
         2 001004   001275 702000 2                  TSX2    ALT

      439     5791    3       IF AWS.ATRIB.ATMP THEN GOTO RET;

   5791  2 001005   201126 470500                    LDP0    AWS$,,AUTO
         2 001006   000000 236100                    LDQ     0,,PR0
         2 001007   000100 316003                    CANQ    64,DU
         2 001010   001271 601000 2                  TNZ     RET

      440     5792    3       CALL ZIM$READ_PG ALTRET(ALT);

   5792  2 001011   003273 701000 2                  TSX1    ZIM$READ_PG
         2 001012   001275 702000 2                  TSX2    ALT

      441     5793    3       IF JREC.TIME>I_O_BUF.WD(1) THEN

   5793  2 001013   201120 470500                    LDP0    I_O_BUF$,,AUTO
         2 001014   201125 471500                    LDP1    JRNL$,,AUTO
         2 001015   000001 236100                    LDQ     1,,PR0
         2 001016   100000 116100                    CMPQ    0,,PR1
         2 001017   001271 602000 2                  TNC     RET

      442     5794    3           GOTO RET; /* PAGE HAS NOT BEEN WRITTEN TO DISK */
      443     5795
      444     5796    3       IF I_O_BUF.HW(2047-JREC.LINE)<=11 OR

   5796  2 001020   100003 236100                    LDQ     3,,PR1
         2 001021   777777 376007                    ANQ     -1,DL
         2 001022   000001 736000                    QLS     1
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:102  
         2 001023   000024 676000 3                  ERQ     20
         2 001024   000001 036007                    ADLQ    1,DL
         2 001025   000100 101506                    MRL     fill='000'O
         2 001026   001777 400002                    ADSC9   1023,Q,PR0               cn=2,n=2
         2 001027   201146 000004                    ADSC9   VLP_SN+10,,AUTO          cn=0,n=4
         2 001030   201146 236100                    LDQ     VLP_SN+10,,AUTO
         2 001031   000014 116007                    CMPQ    12,DL
         2 001032   001273 604000 2                  TMI     ER_STO
         2 001033   100003 236100                    LDQ     3,,PR1
         2 001034   777777 376007                    ANQ     -1,DL
         2 001035   000001 736000                    QLS     1
         2 001036   000024 676000 3                  ERQ     20
         2 001037   000001 036007                    ADLQ    1,DL
         2 001040   000100 101506                    MRL     fill='000'O
         2 001041   001777 400002                    ADSC9   1023,Q,PR0               cn=2,n=2
         2 001042   201147 000004                    ADSC9   VLP_SN+11,,AUTO          cn=0,n=4
         2 001043   201147 236100                    LDQ     VLP_SN+11,,AUTO
         2 001044   400000 116007                    CMPQ    -131072,DL
         2 001045   001273 605000 2                  TPL     ER_STO
         2 001046   100003 236100                    LDQ     3,,PR1
         2 001047   777777 376007                    ANQ     -1,DL
         2 001050   201150 756100                    STQ     VLP_SN+12,,AUTO
         2 001051   100004 236100                    LDQ     4,,PR1
         2 001052   000022 772000                    QRL     18
         2 001053   201151 756100                    STQ     VLP_SN+13,,AUTO
         2 001054   000000 235003                    LDA     0,DU
         2 001055   201150 135100                    SBLA    VLP_SN+12,,AUTO
         2 001056   000001 735000                    ALS     1
         2 001057   000100 101505                    MRL     fill='000'O
         2 001060   001777 400002                    ADSC9   1023,A,PR0               cn=2,n=2
         2 001061   201152 000004                    ADSC9   VLP_SN+14,,AUTO          cn=0,n=4
         2 001062   201152 236100                    LDQ     VLP_SN+14,,AUTO
         2 001063   201151 116100                    CMPQ    VLP_SN+13,,AUTO
         2 001064   001273 601000 2                  TNZ     ER_STO

      445     5797    3          I_O_BUF.HW(2047-JREC.LINE)>=131072 OR
      446     5798    3          I_O_BUF.HW(2047-JREC.LINE)~=JREC.OFFSET THEN
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:103  
      447     5799    3           GOTO ER_STO; /* THE STORED RECORD IS NOT IN OFFSET ARRAY */
      448     5800    3       REC_RD_SIZ=JREC.LENGTH;

   5800  2 001065   100003 236100                    LDQ     3,,PR1
         2 001066   000022 772000                    QRL     18
         2 001067   201106 756100                    STQ     REC_RD_SIZ,,AUTO

      449     5801    3       REC$=PINCRC(I_O_BUF$,JREC.OFFSET+12);

   5801  2 001070   100004 236100                    LDQ     4,,PR1
         2 001071   000022 772000                    QRL     18
         2 001072   000020 736000                    QLS     16
         2 001073   000003 036003                    ADLQ    3,DU
         2 001074   201120 036100                    ADLQ    I_O_BUF$,,AUTO
         2 001075   201121 756100                    STQ     REC$,,AUTO

      450     5802    3       IF JREC.VALUE~=REC$->REC_RD THEN

   5802  2 001076   100003 220100                    LDX0    3,,PR1
         2 001077   201121 473500                    LDP3    REC$,,AUTO
         2 001100   201106 721100                    LXL1    REC_RD_SIZ,,AUTO
         2 001101   040140 106540                    CMPC    fill='040'O
         2 001102   100004 400010                    ADSC9   4,,PR1                   cn=2,n=*X0
         2 001103   300000 000011                    ADSC9   0,,PR3                   cn=0,n=*X1
         2 001104   001273 601000 2                  TNZ     ER_STO

      451     5803    3           GOTO ER_STO; /* THE RECORD THERE IS NOT THE ONE JUST STORED */
      452     5804    3       LAST_OFF=4094-I_O_BUF.HW(7)-I_O_BUF.HW(11)*2;

   5804  2 001105   000003 236100                    LDQ     3,,PR0
         2 001106   777777 376007                    ANQ     -1,DL
         2 001107   201146 756100                    STQ     VLP_SN+10,,AUTO
         2 001110   000005 236100                    LDQ     5,,PR0
         2 001111   000001 736000                    QLS     1
         2 001112   000025 376000 3                  ANQ     21
         2 001113   201146 036100                    ADLQ    VLP_SN+10,,AUTO
         2 001114   000024 676000 3                  ERQ     20
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:104  
         2 001115   007777 036007                    ADLQ    4095,DL
         2 001116   201111 756100                    STQ     LAST_OFF,,AUTO

      453     5805         /* END OF DATA = PAGE_SIZE-SPACE_AVAIL-HIGH_LINE-2 */
      454     5806    3       IF LAST_OFF ~= JREC.OFFSET+12+REC.LEN THEN

   5806  2 001117   000100 101500                    MRL     fill='000'O
         2 001120   300000 400002                    ADSC9   0,,PR3                   cn=2,n=2
         2 001121   201146 000004                    ADSC9   VLP_SN+10,,AUTO          cn=0,n=4
         2 001122   100004 236100                    LDQ     4,,PR1
         2 001123   000022 772000                    QRL     18
         2 001124   201146 036100                    ADLQ    VLP_SN+10,,AUTO
         2 001125   000014 036007                    ADLQ    12,DL
         2 001126   201111 116100                    CMPQ    LAST_OFF,,AUTO
         2 001127   001273 601000 2                  TNZ     ER_STO

      455     5807    3           GOTO ER_STO; /* THERE CANT BE ANY REC AFTER THIS ONE */
      456     5808
      457     5809    3       I_O_BUF.HW(7)=I_O_BUF.HW(7)+REC.LEN; /* UPD SP AVAIL */

   5809  2 001130   000100 101500                    MRL     fill='000'O
         2 001131   300000 400002                    ADSC9   0,,PR3                   cn=2,n=2
         2 001132   201146 000004                    ADSC9   VLP_SN+10,,AUTO          cn=0,n=4
         2 001133   000003 236100                    LDQ     3,,PR0
         2 001134   777777 376007                    ANQ     -1,DL
         2 001135   201146 036100                    ADLQ    VLP_SN+10,,AUTO
         2 001136   000000 620006                    EAX0    0,QL
         2 001137   000003 440100                    SXL0    3,,PR0

      458     5810    3       MREC_SIZ=REC.LEN; /* NOW, ZERO THE REC STORED */

   5810  2 001140   201121 473500                    LDP3    REC$,,AUTO
         2 001141   000100 101500                    MRL     fill='000'O
         2 001142   300000 400002                    ADSC9   0,,PR3                   cn=2,n=2
         2 001143   200003 000004                    ADSC9   MREC_SIZ,,AUTO           cn=0,n=4

      459     5811    3       REC$->MREC = '0'B;
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:105  

   5811  2 001144   200003 720100                    LXL0    MREC_SIZ,,AUTO
         2 001145   000140 100400                    MLR     fill='000'O
         2 001146   000011 000001 3                  ADSC9   9                        cn=0,n=1
         2 001147   300000 000010                    ADSC9   0,,PR3                   cn=0,n=*X0

      460     5812
      461     5813         /* NOW, INSERT THIS LINE INTO AVAILABLE LINE CHAIN */
      462     5814    3       I=I_O_BUF.HW(10); /* I=FIRST AVAIL LINE */

   5814  2 001150   000005 236100                    LDQ     5,,PR0
         2 001151   000022 772000                    QRL     18
         2 001152   201107 756100                    STQ     I,,AUTO

      463     5815    3       IF (I=0 AND I_O_BUF.HW(2047)<131072) OR /* NO AVAIL LINE */

   5815  2 001153   001157 601000 2                  TNZ     s:5815+4
         2 001154   001777 720100                    LXL0    1023,,PR0
         2 001155   400000 100003                    CMPX0   -131072,DU
         2 001156   001163 602000 2                  TNC     s:5818
         2 001157   100003 236100                    LDQ     3,,PR1
         2 001160   777777 376007                    ANQ     -1,DL
         2 001161   201107 116100                    CMPQ    I,,AUTO
         2 001162   001202 603000 2                  TRC     s:5823

      464     5816    3          I > JREC.LINE THEN /* OR 1ST AVAIL > DELETED LINE */
      465     5817    4       DO;

      466     5818    4           I_O_BUF.HW(2047-JREC.LINE)=131072+I;

   5818  2 001163   100003 236100                    LDQ     3,,PR1
         2 001164   777777 376007                    ANQ     -1,DL
         2 001165   201147 756100                    STQ     VLP_SN+11,,AUTO
         2 001166   201107 236100                    LDQ     I,,AUTO
         2 001167   400000 036007                    ADLQ    -131072,DL
         2 001170   201146 756100                    STQ     VLP_SN+10,,AUTO
         2 001171   000000 235003                    LDA     0,DU
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:106  
         2 001172   201147 135100                    SBLA    VLP_SN+11,,AUTO
         2 001173   000001 735000                    ALS     1
         2 001174   000105 101500                    MRL     fill='000'O
         2 001175   201146 000004                    ADSC9   VLP_SN+10,,AUTO          cn=0,n=4
         2 001176   001777 400002                    ADSC9   1023,A,PR0               cn=2,n=2

      467     5819    4           I_O_BUF.HW(10)=JREC.LINE;

   5819  2 001177   100003 720100                    LXL0    3,,PR1
         2 001200   000005 740100                    STX0    5,,PR0

      468     5820    4           END;

   5820  2 001201   001266 710000 2                  TRA     s:5834

      469     5821    3       ELSE
      470     5822    4       DO; /* WALK THRU THE CHAIN THE FIND INSERTION POINT */

      471     5823    5           DO WHILE(I_O_BUF.HW(2047-I)-131072<JREC.LINE AND

   5823  2 001202   001223 710000 2                  TRA     s:5828

      472     5824    5              I_O_BUF.HW(2047-I)-131072~=0);
      473     5825    5               IF I_O_BUF.HW(2047-I)<131072 THEN

   5825  2 001203   000000 235003                    LDA     0,DU
         2 001204   201107 135100                    SBLA    I,,AUTO
         2 001205   000001 735000                    ALS     1
         2 001206   201120 470500                    LDP0    I_O_BUF$,,AUTO
         2 001207   000100 101505                    MRL     fill='000'O
         2 001210   001777 400002                    ADSC9   1023,A,PR0               cn=2,n=2
         2 001211   201146 000004                    ADSC9   VLP_SN+10,,AUTO          cn=0,n=4
         2 001212   201146 236100                    LDQ     VLP_SN+10,,AUTO
         2 001213   400000 116007                    CMPQ    -131072,DL
         2 001214   001273 604000 2                  TMI     ER_STO

      474     5826    5                   GOTO ER_STO; /* BAD PTR IN CHAIN */
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:107  
      475     5827    5               I=I_O_BUF.HW(2047-I)-131072;

   5827  2 001215   000100 101505                    MRL     fill='000'O
         2 001216   001777 400002                    ADSC9   1023,A,PR0               cn=2,n=2
         2 001217   201146 000004                    ADSC9   VLP_SN+10,,AUTO          cn=0,n=4
         2 001220   201146 236100                    LDQ     VLP_SN+10,,AUTO
         2 001221   400000 136007                    SBLQ    -131072,DL
         2 001222   201107 756100                    STQ     I,,AUTO

      476     5828    5               END;

   5828  2 001223   201125 471500                    LDP1    JRNL$,,AUTO
         2 001224   100003 236100                    LDQ     3,,PR1
         2 001225   777777 376007                    ANQ     -1,DL
         2 001226   201146 756100                    STQ     VLP_SN+10,,AUTO
         2 001227   000000 235003                    LDA     0,DU
         2 001230   201107 135100                    SBLA    I,,AUTO
         2 001231   000001 735000                    ALS     1
         2 001232   000100 101505                    MRL     fill='000'O
         2 001233   001777 400002                    ADSC9   1023,A,PR0               cn=2,n=2
         2 001234   201147 000004                    ADSC9   VLP_SN+11,,AUTO          cn=0,n=4
         2 001235   201147 236100                    LDQ     VLP_SN+11,,AUTO
         2 001236   400000 136007                    SBLQ    -131072,DL
         2 001237   201146 116100                    CMPQ    VLP_SN+10,,AUTO
         2 001240   001247 605000 2                  TPL     s:5830
         2 001241   000100 101505                    MRL     fill='000'O
         2 001242   001777 400002                    ADSC9   1023,A,PR0               cn=2,n=2
         2 001243   201150 000004                    ADSC9   VLP_SN+12,,AUTO          cn=0,n=4
         2 001244   201150 236100                    LDQ     VLP_SN+12,,AUTO
         2 001245   400000 116007                    CMPQ    -131072,DL
         2 001246   001203 601000 2                  TNZ     s:5825

      477     5829         /* INSERTION POINT FOUND, RIGHT AFTER I */
      478     5830    4           I_O_BUF.HW(2047-JREC.LINE)=I_O_BUF.HW(2047-I);

   5830  2 001247   100003 236100                    LDQ     3,,PR1
         2 001250   777777 376007                    ANQ     -1,DL
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:108  
         2 001251   000001 736000                    QLS     1
         2 001252   000024 676000 3                  ERQ     20
         2 001253   000001 036007                    ADLQ    1,DL
         2 001254   000106 100505                    MLR     fill='000'O
         2 001255   001777 400002                    ADSC9   1023,A,PR0               cn=2,n=2
         2 001256   001777 400002                    ADSC9   1023,Q,PR0               cn=2,n=2

      479     5831    4           I_O_BUF.HW(2047-I)=131072+JREC.LINE;

   5831  2 001257   100003 236100                    LDQ     3,,PR1
         2 001260   777777 376007                    ANQ     -1,DL
         2 001261   400000 036007                    ADLQ    -131072,DL
         2 001262   201146 756100                    STQ     VLP_SN+10,,AUTO
         2 001263   000105 101500                    MRL     fill='000'O
         2 001264   201146 000004                    ADSC9   VLP_SN+10,,AUTO          cn=0,n=4
         2 001265   001777 400002                    ADSC9   1023,A,PR0               cn=2,n=2

      480     5832    4           END;

      481     5833
      482     5834    3       CALL ZIO$MODIFY ALTRET(ALT);

   5834  2 001266   000011 631400 3                  EPPR1   9
         2 001267   000000 701000 xent               TSX1    ZIO$MODIFY
         2 001270   001275 702000 2                  TSX2    ALT

      483     5835    3   RET: RETURN;

   5835  2 001271   201142 221300       RET          LDX1  ! VLP_SN+6,,AUTO
         2 001272   000001 702211                    TSX2  ! 1,X1

      484     5836
      485     5837    3   ER_STO: ERROR=ERR#RL#INCNS;

   5837  2 001273   303404 235007       ER_STO       LDA     100100,DL
         2 001274   201105 755100                    STA     ERROR,,AUTO

PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:109  
      486     5838    3   ALT: ALTRETURN;

   5838  2 001275   201142 221300       ALT          LDX1  ! VLP_SN+6,,AUTO
         2 001276   000000 702211                    TSX2  ! 0,X1

      487     5839    3   END ZIM$STO;
      488     5840        %EJECT;
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:110  
      489     5841        /*
      490     5842              INTERNAL SUBR   UPD_ARRAY:  CUT OFFSET ARRAY IN SIZE
      491     5843                 CALLED BY ZIM$DEL  AND  ZIM$MOD
      492     5844                 WHEN THERE IS NO ENOUGH SPACE FOR A ROLLBACKED RECORD.
      493     5845                 INPUT: I=NUMBER OF HIGH ENTRIES TO DELETE FROM OFFSET ARRAY.
      494     5846        */
      495     5847    2   UPD_ARRAY: PROC ALTRET;

   5847  2 001277   201144 741300       UPD_ARRAY    STX1  ! VLP_SN+8,,AUTO

      496     5848
      497     5849    3       J=I_O_BUF.HW(11); /* J = CURRENT HIGH LINE */

   5849  2 001300   201120 470500                    LDP0    I_O_BUF$,,AUTO
         2 001301   000005 236100                    LDQ     5,,PR0
         2 001302   777777 376007                    ANQ     -1,DL
         2 001303   201112 756100                    STQ     J,,AUTO

      498     5850    3       IF I > J THEN ALTRETURN; /* REQ TOO MAY, RESULTING NO LINES */

   5850  2 001304   201107 116100                    CMPQ    I,,AUTO
         2 001305   001307 603000 2                  TRC     s:5851

   5850  2 001306   000000 702211                    TSX2  ! 0,X1

      499     5851    3       I_O_BUF.HW(11)=J-I; /* NEW CURRENT HIGH LINE */

   5851  2 001307   201107 136100                    SBLQ    I,,AUTO
         2 001310   000000 620006                    EAX0    0,QL
         2 001311   000005 440100                    SXL0    5,,PR0

      500     5852    3       I_O_BUF.HW(7)=I_O_BUF.HW(7)+2*I; /* NEW SPACE AVAIL */

   5852  2 001312   000003 236100                    LDQ     3,,PR0
         2 001313   777777 376007                    ANQ     -1,DL
         2 001314   201146 756100                    STQ     VLP_SN+10,,AUTO
         2 001315   201107 236100                    LDQ     I,,AUTO
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:111  
         2 001316   000001 736000                    QLS     1
         2 001317   201146 036100                    ADLQ    VLP_SN+10,,AUTO
         2 001320   000000 620006                    EAX0    0,QL
         2 001321   000003 440100                    SXL0    3,,PR0

      501     5853    4       DO WHILE (I > 0);

   5853  2 001322   201107 235100                    LDA     I,,AUTO
         2 001323   001354 600000 2                  TZE     s:5861

      502     5854    4           IF I_O_BUF.HW(2047-J) >= 131072 THEN

   5854  2 001324   000000 235003                    LDA     0,DU
         2 001325   201112 135100                    SBLA    J,,AUTO
         2 001326   000001 735000                    ALS     1
         2 001327   201120 470500                    LDP0    I_O_BUF$,,AUTO
         2 001330   000100 101505                    MRL     fill='000'O
         2 001331   001777 400002                    ADSC9   1023,A,PR0               cn=2,n=2
         2 001332   201146 000004                    ADSC9   VLP_SN+10,,AUTO          cn=0,n=4
         2 001333   201146 236100                    LDQ     VLP_SN+10,,AUTO
         2 001334   400000 116007                    CMPQ    -131072,DL
         2 001335   001342 604000 2                  TMI     s:5857

      503     5855    4               I_O_BUF.HW(2047-J) = 0; /* ZERO OUT */

   5855  2 001336   000105 101400                    MRL     fill='000'O
         2 001337   000011 000004 3                  ADSC9   9                        cn=0,n=4
         2 001340   001777 400002                    ADSC9   1023,A,PR0               cn=2,n=2
         2 001341   001344 710000 2                  TRA     s:5858

      504     5856    4           ELSE /* CANNOT FREE THIS ENTRY FOR SPACE */
      505     5857    4               ALTRETURN; /* THEN THIS IS A FATAL ERROR. */

   5857  2 001342   201144 221300                    LDX1  ! VLP_SN+8,,AUTO
         2 001343   000000 702211                    TSX2  ! 0,X1

      506     5858    4           I=I-1;
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:112  

   5858  2 001344   201107 236100                    LDQ     I,,AUTO
         2 001345   000001 136007                    SBLQ    1,DL
         2 001346   201107 756100                    STQ     I,,AUTO

      507     5859    4           J=J-1;

   5859  2 001347   201112 235100                    LDA     J,,AUTO
         2 001350   000001 135007                    SBLA    1,DL
         2 001351   201112 755100                    STA     J,,AUTO

      508     5860    4           END;

   5860  2 001352   000000 116003                    CMPQ    0,DU
         2 001353   001324 601000 2                  TNZ     s:5854

      509     5861    3       IF I_O_BUF.HW(10) > I_O_BUF.HW(11) THEN

   5861  2 001354   000005 720100                    LXL0    5,,PR0
         2 001355   000005 100100                    CMPX0   5,,PR0
         2 001356   001362 603000 2                  TRC     s:5865

      510     5862    3           I_O_BUF.HW(10)=0; /* NO MORE AVAIL LINE LEFT */

   5862  2 001357   000000 221003                    LDX1    0,DU
         2 001360   000005 741100                    STX1    5,,PR0
         2 001361   001416 710000 2                  TRA     s:5873

      511     5863    3       ELSE
      512     5864    4       DO;

      513     5865    5           DO WHILE(I_O_BUF.HW(2047-J)<131072); /* LOOK FOR THE LAST AVAIL LINE */

   5865  2 001362   000000 235003                    LDA     0,DU
         2 001363   201112 135100                    SBLA    J,,AUTO
         2 001364   000001 735000                    ALS     1
         2 001365   000100 101505                    MRL     fill='000'O
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:113  
         2 001366   001777 400002                    ADSC9   1023,A,PR0               cn=2,n=2
         2 001367   201146 000004                    ADSC9   VLP_SN+10,,AUTO          cn=0,n=4
         2 001370   201146 236100                    LDQ     VLP_SN+10,,AUTO
         2 001371   400000 116007                    CMPQ    -131072,DL
         2 001372   001413 605000 2                  TPL     s:5870

      514     5866    5               IF J = 0 THEN /* CANNOT FIND ANY AVAIL LINE */

   5866  2 001373   201112 235100                    LDA     J,,AUTO
         2 001374   001377 601000 2                  TNZ     s:5868

      515     5867    5                   ALTRETURN; /* MUST BE A BAD OFFSET ARRAY */

   5867  2 001375   201144 221300                    LDX1  ! VLP_SN+8,,AUTO
         2 001376   000000 702211                    TSX2  ! 0,X1

      516     5868    5               J = J - 1;

   5868  2 001377   000001 135007                    SBLA    1,DL
         2 001400   201112 755100                    STA     J,,AUTO

      517     5869    5               END;

   5869  2 001401   000001 735000                    ALS     1
         2 001402   000024 675000 3                  ERA     20
         2 001403   000001 035007                    ADLA    1,DL
         2 001404   201120 470500                    LDP0    I_O_BUF$,,AUTO
         2 001405   000100 101505                    MRL     fill='000'O
         2 001406   001777 400002                    ADSC9   1023,A,PR0               cn=2,n=2
         2 001407   201146 000004                    ADSC9   VLP_SN+10,,AUTO          cn=0,n=4
         2 001410   201146 236100                    LDQ     VLP_SN+10,,AUTO
         2 001411   400000 116007                    CMPQ    -131072,DL
         2 001412   001373 604000 2                  TMI     s:5866

      518     5870    4           I_O_BUF.HW(2047-J)=131072; /* SET LAST ONE AS TAIL OF CHAIN */

   5870  2 001413   000105 101400                    MRL     fill='000'O
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:114  
         2 001414   000026 000004 3                  ADSC9   22                       cn=0,n=4
         2 001415   001777 400002                    ADSC9   1023,A,PR0               cn=2,n=2

      519     5871    4           END;

      520     5872
      521     5873    3   END UPD_ARRAY;

   5873  2 001416   201144 221300                    LDX1  ! VLP_SN+8,,AUTO
         2 001417   000001 702211                    TSX2  ! 1,X1

      522     5874        %EJECT;
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:115  
      523     5875    2   ZIM$DEL: PROC ALTRET;

   5875  2 001420   201142 741300       ZIM$DEL      STX1  ! VLP_SN+6,,AUTO

      524     5876
      525     5877    3       CALL ZIM$CK_AWS ALTRET(ALT);

   5877  2 001421   003316 701000 2                  TSX1    ZIM$CK_AWS
         2 001422   001746 702000 2                  TSX2    ALT

      526     5878    3       IF AWS.ATRIB.ATMP THEN

   5878  2 001423   201126 470500                    LDP0    AWS$,,AUTO
         2 001424   000000 236100                    LDQ     0,,PR0
         2 001425   000100 316003                    CANQ    64,DU
         2 001426   001742 601000 2                  TNZ     RET

      527     5879    3           GOTO RET; /* TEMPORARY AREAS */
      528     5880    3       CALL ZIM$READ_PG ALTRET(ALT);

   5880  2 001427   003273 701000 2                  TSX1    ZIM$READ_PG
         2 001430   001746 702000 2                  TSX2    ALT

      529     5881    3       IF JREC.TIME > I_O_BUF.WD(1) THEN

   5881  2 001431   201120 470500                    LDP0    I_O_BUF$,,AUTO
         2 001432   201125 471500                    LDP1    JRNL$,,AUTO
         2 001433   000001 236100                    LDQ     1,,PR0
         2 001434   100000 116100                    CMPQ    0,,PR1
         2 001435   001742 602000 2                  TNC     RET

      530     5882    3           GOTO RET; /* PAGE HAS NOT BEEN WRITTEN TO DISK */
      531     5883    3       IF I_O_BUF.HW(2047-JREC.LINE)<131072 THEN

   5883  2 001436   100003 236100                    LDQ     3,,PR1
         2 001437   777777 376007                    ANQ     -1,DL
         2 001440   000001 736000                    QLS     1
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:116  
         2 001441   000024 676000 3                  ERQ     20
         2 001442   000001 036007                    ADLQ    1,DL
         2 001443   000100 101506                    MRL     fill='000'O
         2 001444   001777 400002                    ADSC9   1023,Q,PR0               cn=2,n=2
         2 001445   201146 000004                    ADSC9   VLP_SN+10,,AUTO          cn=0,n=4
         2 001446   201146 236100                    LDQ     VLP_SN+10,,AUTO
         2 001447   400000 116007                    CMPQ    -131072,DL
         2 001450   001744 604000 2                  TMI     ER_DEL

      532     5884    3           GOTO ER_DEL; /* THE DELETED LINE IS NOT AVAILABLE */
      533     5885
      534     5886    3       REC$=PINCRC(I_O_BUF$,JREC.OFFSET+12);

   5886  2 001451   100004 236100                    LDQ     4,,PR1
         2 001452   000022 772000                    QRL     18
         2 001453   000020 736000                    QLS     16
         2 001454   000003 036003                    ADLQ    3,DU
         2 001455   201120 036100                    ADLQ    I_O_BUF$,,AUTO
         2 001456   201121 756100                    STQ     REC$,,AUTO

      535     5887    3       REC_RD_SIZ=JREC.LENGTH;

   5887  2 001457   100003 236100                    LDQ     3,,PR1
         2 001460   000022 772000                    QRL     18
         2 001461   201106 756100                    STQ     REC_RD_SIZ,,AUTO

      536     5888        /*
      537     5889                 IT IS POSSIBLE THAT THERE IS NO ENOUGH SPACE TO
      538     5890                 PUT BACK THIS DELETED RECORD, BECAUSE OFFSET ARRAY
      539     5891                 HAS GROWN LARGER, BUT WE SHOULD BE ABLE TO REDUCE ITS SIZE
      540     5892        */
      541     5893    3       IF REC_RD_SIZ > I_O_BUF.HW(7) THEN

   5893  2 001462   000003 236100                    LDQ     3,,PR0
         2 001463   777777 376007                    ANQ     -1,DL
         2 001464   201106 116100                    CMPQ    REC_RD_SIZ,,AUTO
         2 001465   001476 603000 2                  TRC     s:5898
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:117  

      542     5894    4       DO; /* GET RID OF SOME ENTRIES IN OFFSET ARRAY */

      543     5895    4           I = (REC_RD_SIZ-I_O_BUF.HW(7)+1)/2; /* HOW MANY */

   5895  2 001466   201146 756100                    STQ     VLP_SN+10,,AUTO
         2 001467   201106 236100                    LDQ     REC_RD_SIZ,,AUTO
         2 001470   201146 136100                    SBLQ    VLP_SN+10,,AUTO
         2 001471   000001 036007                    ADLQ    1,DL
         2 001472   000002 506007                    DIV     2,DL
         2 001473   201107 756100                    STQ     I,,AUTO

      544     5896    4           CALL UPD_ARRAY ALTRET(ER_DEL);

   5896  2 001474   001277 701000 2                  TSX1    UPD_ARRAY
         2 001475   001744 702000 2                  TSX2    ER_DEL

      545     5897    4           END;

      546     5898    3       REC_SIZ=JREC.LENGTH-4;

   5898  2 001476   201125 470500                    LDP0    JRNL$,,AUTO
         2 001477   000003 236100                    LDQ     3,,PR0
         2 001500   000022 772000                    QRL     18
         2 001501   000004 136007                    SBLQ    4,DL
         2 001502   201104 756100                    STQ     REC_SIZ,,AUTO

      547     5899    3       MREC$=PINCRC(REC$,JREC.LENGTH);

   5899  2 001503   000003 236100                    LDQ     3,,PR0
         2 001504   000022 772000                    QRL     18
         2 001505   000020 736000                    QLS     16
         2 001506   201121 036100                    ADLQ    REC$,,AUTO
         2 001507   201122 756100                    STQ     MREC$,,AUTO

      548     5900    3       LAST_OFF=4094-I_O_BUF.HW(7)-I_O_BUF.HW(11)*2;

PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:118  
   5900  2 001510   201120 471500                    LDP1    I_O_BUF$,,AUTO
         2 001511   100003 236100                    LDQ     3,,PR1
         2 001512   777777 376007                    ANQ     -1,DL
         2 001513   201146 756100                    STQ     VLP_SN+10,,AUTO
         2 001514   100005 236100                    LDQ     5,,PR1
         2 001515   000001 736000                    QLS     1
         2 001516   000025 376000 3                  ANQ     21
         2 001517   201146 036100                    ADLQ    VLP_SN+10,,AUTO
         2 001520   000024 676000 3                  ERQ     20
         2 001521   007777 036007                    ADLQ    4095,DL
         2 001522   201111 756100                    STQ     LAST_OFF,,AUTO

      549     5901         /* OFFSET TO END OF DATA = PAGE_SIZE-SPACE_AVAIL-HIGH_LINE-2 */
      550     5902    3       MREC_SIZ=LAST_OFF-(JREC.OFFSET+12);

   5902  2 001523   000004 236100                    LDQ     4,,PR0
         2 001524   000022 772000                    QRL     18
         2 001525   201146 756100                    STQ     VLP_SN+10,,AUTO
         2 001526   201111 236100                    LDQ     LAST_OFF,,AUTO
         2 001527   201146 136100                    SBLQ    VLP_SN+10,,AUTO
         2 001530   000014 136007                    SBLQ    12,DL
         2 001531   200003 756100                    STQ     MREC_SIZ,,AUTO

      551     5903    3       CALL ZIM$MRL_SHIFT(REC$,MREC$,MREC_SIZ); /* MAKE ROOM */

   5903  2 001532   200003 633500                    EPPR3   MREC_SIZ,,AUTO
         2 001533   201150 453500                    STP3    VLP_SN+12,,AUTO
         2 001534   201122 634500                    EPPR4   MREC$,,AUTO
         2 001535   201147 454500                    STP4    VLP_SN+11,,AUTO
         2 001536   201121 630500                    EPPR0   REC$,,AUTO
         2 001537   201146 450500                    STP0    VLP_SN+10,,AUTO
         2 001540   201146 630500                    EPPR0   VLP_SN+10,,AUTO
         2 001541   000027 631400 3                  EPPR1   23
         2 001542   000000 701000 xent               TSX1    ZIM$MRL_SHIFT
         2 001543   000000 011000                    NOP     0

      552     5904    3       MREC_SIZ=JREC.LENGTH;
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:119  

   5904  2 001544   201125 470500                    LDP0    JRNL$,,AUTO
         2 001545   000003 236100                    LDQ     3,,PR0
         2 001546   000022 772000                    QRL     18
         2 001547   200003 756100                    STQ     MREC_SIZ,,AUTO

      553     5905    3       REC$->MREC.VAL=JREC.VALUE; /* RESTORE THE DELETED REC */

   5905  2 001550   000003 220100                    LDX0    3,,PR0
         2 001551   201121 471500                    LDP1    REC$,,AUTO
         2 001552   000000 621006                    EAX1    0,QL
         2 001553   040140 100540                    MLR     fill='040'O
         2 001554   000004 400010                    ADSC9   4,,PR0                   cn=2,n=*X0
         2 001555   100000 000011                    ADSC9   0,,PR1                   cn=0,n=*X1

      554     5906
      555     5907         /* NOW, WALK AVAIL CHAIN TO GET THE PRIOR LINE */
      556     5908    3       I = I_O_BUF.HW(10); /* GET 1ST AVALI LINE NUMBER */

   5908  2 001556   201120 471500                    LDP1    I_O_BUF$,,AUTO
         2 001557   100005 236100                    LDQ     5,,PR1
         2 001560   000022 772000                    QRL     18
         2 001561   201107 756100                    STQ     I,,AUTO

      557     5909    3       J = 2037; /* J SHOULD CONTAIN THE PRIOR LINE NUMBER */

   5909  2 001562   003765 235007                    LDA     2037,DL
         2 001563   201112 755100                    STA     J,,AUTO

      558     5910    4       DO WHILE(I~=JREC.LINE); /* WALK CHAIN UNTIL FOUND JREC.LINE */

   5910  2 001564   000003 236100                    LDQ     3,,PR0
         2 001565   777777 376007                    ANQ     -1,DL
         2 001566   201107 116100                    CMPQ    I,,AUTO
         2 001567   001617 600000 2                  TZE     s:5917

      559     5911    4           J=I; /*  SAVE AS PRIOR */
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:120  

   5911  2 001570   201107 235100                    LDA     I,,AUTO
         2 001571   201112 755100                    STA     J,,AUTO

      560     5912    4           IF I_O_BUF.HW(2047-I)<=131072 THEN /* END OF CHAIN */

   5912  2 001572   000001 735000                    ALS     1
         2 001573   000024 675000 3                  ERA     20
         2 001574   000001 035007                    ADLA    1,DL
         2 001575   201120 470500                    LDP0    I_O_BUF$,,AUTO
         2 001576   000100 101505                    MRL     fill='000'O
         2 001577   001777 400002                    ADSC9   1023,A,PR0               cn=2,n=2
         2 001600   201146 000004                    ADSC9   VLP_SN+10,,AUTO          cn=0,n=4
         2 001601   201146 236100                    LDQ     VLP_SN+10,,AUTO
         2 001602   400001 116007                    CMPQ    -131071,DL
         2 001603   001744 604000 2                  TMI     ER_DEL

      561     5913    4               GOTO ER_DEL; /* OR BAD PTR IN CHAIN */
      562     5914    4           I=I_O_BUF.HW(2047-I)-131072;

   5914  2 001604   000100 101505                    MRL     fill='000'O
         2 001605   001777 400002                    ADSC9   1023,A,PR0               cn=2,n=2
         2 001606   201146 000004                    ADSC9   VLP_SN+10,,AUTO          cn=0,n=4
         2 001607   201146 236100                    LDQ     VLP_SN+10,,AUTO
         2 001610   400000 136007                    SBLQ    -131072,DL
         2 001611   201107 756100                    STQ     I,,AUTO

      563     5915    4           END; /* KEEP WALKING */

   5915  2 001612   201125 471500                    LDP1    JRNL$,,AUTO
         2 001613   100003 236100                    LDQ     3,,PR1
         2 001614   777777 376007                    ANQ     -1,DL
         2 001615   201107 116100                    CMPQ    I,,AUTO
         2 001616   001570 601000 2                  TNZ     s:5911

      564     5916
      565     5917    3       IF J=2037 THEN /* IF 1ST AVAIL NEEDS UPDATED */
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:121  

   5917  2 001617   201112 235100                    LDA     J,,AUTO
         2 001620   003765 115007                    CMPA    2037,DL
         2 001621   001635 601000 2                  TNZ     s:5920

      566     5918    3           I_O_BUF.HW(10)=I_O_BUF.HW(2047-I)-131072;

   5918  2 001622   000000 236003                    LDQ     0,DU
         2 001623   201107 136100                    SBLQ    I,,AUTO
         2 001624   000001 736000                    QLS     1
         2 001625   201120 470500                    LDP0    I_O_BUF$,,AUTO
         2 001626   000100 100506                    MLR     fill='000'O
         2 001627   001777 400002                    ADSC9   1023,Q,PR0               cn=2,n=2
         2 001630   201146 000004                    ADSC9   VLP_SN+10,,AUTO          cn=0,n=4
         2 001631   201146 220100                    LDX0    VLP_SN+10,,AUTO
         2 001632   400000 621010                    EAX1    -131072,X0
         2 001633   000005 741100                    STX1    5,,PR0
         2 001634   001647 710000 2                  TRA     s:5921

      567     5919    3       ELSE
      568     5920    3           I_O_BUF.HW(2047-J)=I_O_BUF.HW(2047-I);

   5920  2 001635   000000 236003                    LDQ     0,DU
         2 001636   201107 136100                    SBLQ    I,,AUTO
         2 001637   000001 736000                    QLS     1
         2 001640   000001 735000                    ALS     1
         2 001641   000024 675000 3                  ERA     20
         2 001642   000001 035007                    ADLA    1,DL
         2 001643   201120 470500                    LDP0    I_O_BUF$,,AUTO
         2 001644   000105 100506                    MLR     fill='000'O
         2 001645   001777 400002                    ADSC9   1023,Q,PR0               cn=2,n=2
         2 001646   001777 400002                    ADSC9   1023,A,PR0               cn=2,n=2

      569     5921    3       I_O_BUF.HW(2047-I)=JREC.OFFSET;

   5921  2 001647   201125 471500                    LDP1    JRNL$,,AUTO
         2 001650   000106 100500                    MLR     fill='000'O
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:122  
         2 001651   100004 000002                    ADSC9   4,,PR1                   cn=0,n=2
         2 001652   001777 400002                    ADSC9   1023,Q,PR0               cn=2,n=2

      570     5922    3       I_O_BUF.HW(7)=I_O_BUF.HW(7)-JREC.LENGTH; /* UPD SP AVAIL */

   5922  2 001653   100003 236100                    LDQ     3,,PR1
         2 001654   000022 772000                    QRL     18
         2 001655   201146 756100                    STQ     VLP_SN+10,,AUTO
         2 001656   000003 236100                    LDQ     3,,PR0
         2 001657   777777 376007                    ANQ     -1,DL
         2 001660   201146 136100                    SBLQ    VLP_SN+10,,AUTO
         2 001661   000000 620006                    EAX0    0,QL
         2 001662   000003 440100                    SXL0    3,,PR0

      571     5923    4       DO J=0 TO I_O_BUF.HW(11); /* LOOP THRU THE OFFSET ARRAY */

   5923  2 001663   201112 450100                    STZ     J,,AUTO
         2 001664   001733 710000 2                  TRA     s:5927+3

      572     5924    4           IF I_O_BUF.HW(2047-J)<131072 AND

   5924  2 001665   000000 235003                    LDA     0,DU
         2 001666   201112 135100                    SBLA    J,,AUTO
         2 001667   000001 735000                    ALS     1
         2 001670   201120 470500                    LDP0    I_O_BUF$,,AUTO
         2 001671   000100 101505                    MRL     fill='000'O
         2 001672   001777 400002                    ADSC9   1023,A,PR0               cn=2,n=2
         2 001673   201146 000004                    ADSC9   VLP_SN+10,,AUTO          cn=0,n=4
         2 001674   201146 236100                    LDQ     VLP_SN+10,,AUTO
         2 001675   400000 116007                    CMPQ    -131072,DL
         2 001676   001730 605000 2                  TPL     s:5927
         2 001677   201125 471500                    LDP1    JRNL$,,AUTO
         2 001700   100004 236100                    LDQ     4,,PR1
         2 001701   000022 772000                    QRL     18
         2 001702   201147 756100                    STQ     VLP_SN+11,,AUTO
         2 001703   000100 101505                    MRL     fill='000'O
         2 001704   001777 400002                    ADSC9   1023,A,PR0               cn=2,n=2
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:123  
         2 001705   201150 000004                    ADSC9   VLP_SN+12,,AUTO          cn=0,n=4
         2 001706   201150 236100                    LDQ     VLP_SN+12,,AUTO
         2 001707   201147 116100                    CMPQ    VLP_SN+11,,AUTO
         2 001710   001730 604000 2                  TMI     s:5927
         2 001711   201112 236100                    LDQ     J,,AUTO
         2 001712   201107 116100                    CMPQ    I,,AUTO
         2 001713   001730 600000 2                  TZE     s:5927

      573     5925    4              I_O_BUF.HW(2047-J)>=JREC.OFFSET AND J~=I THEN
      574     5926    4               I_O_BUF.HW(2047-J)=I_O_BUF.HW(2047-J)+JREC.LENGTH;

   5926  2 001714   100003 236100                    LDQ     3,,PR1
         2 001715   000022 772000                    QRL     18
         2 001716   201146 756100                    STQ     VLP_SN+10,,AUTO
         2 001717   000100 101505                    MRL     fill='000'O
         2 001720   001777 400002                    ADSC9   1023,A,PR0               cn=2,n=2
         2 001721   201147 000004                    ADSC9   VLP_SN+11,,AUTO          cn=0,n=4
         2 001722   201147 236100                    LDQ     VLP_SN+11,,AUTO
         2 001723   201146 036100                    ADLQ    VLP_SN+10,,AUTO
         2 001724   201150 756100                    STQ     VLP_SN+12,,AUTO
         2 001725   000105 101500                    MRL     fill='000'O
         2 001726   201150 000004                    ADSC9   VLP_SN+12,,AUTO          cn=0,n=4
         2 001727   001777 400002                    ADSC9   1023,A,PR0               cn=2,n=2

      575     5927    4           END;

   5927  2 001730   201112 236100                    LDQ     J,,AUTO
         2 001731   000001 036007                    ADLQ    1,DL
         2 001732   201112 756100                    STQ     J,,AUTO
         2 001733   000005 236100                    LDQ     5,,PR0
         2 001734   777777 376007                    ANQ     -1,DL
         2 001735   201112 116100                    CMPQ    J,,AUTO
         2 001736   001665 603000 2                  TRC     s:5924

      576     5928    3       CALL ZIO$MODIFY ALTRET(ALT);

   5928  2 001737   000011 631400 3                  EPPR1   9
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:124  
         2 001740   000000 701000 xent               TSX1    ZIO$MODIFY
         2 001741   001746 702000 2                  TSX2    ALT

      577     5929    3   RET: RETURN;

   5929  2 001742   201142 221300       RET          LDX1  ! VLP_SN+6,,AUTO
         2 001743   000001 702211                    TSX2  ! 1,X1

      578     5930
      579     5931    3   ER_DEL: ERROR=ERR#RL#INCNS; /* INCONSISTANT IN ROLL DEL REC */

   5931  2 001744   303404 235007       ER_DEL       LDA     100100,DL
         2 001745   201105 755100                    STA     ERROR,,AUTO

      580     5932    3   ALT: ALTRETURN;

   5932  2 001746   201142 221300       ALT          LDX1  ! VLP_SN+6,,AUTO
         2 001747   000000 702211                    TSX2  ! 0,X1

      581     5933    3   END ZIM$DEL;
      582     5934        %EJECT;
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:125  
      583     5935    2   ZIM$MOD: PROC ALTRET;

   5935  2 001750   201142 741300       ZIM$MOD      STX1  ! VLP_SN+6,,AUTO

      584     5936
      585     5937    3       CALL ZIM$CK_AWS ALTRET(ALT);

   5937  2 001751   003316 701000 2                  TSX1    ZIM$CK_AWS
         2 001752   002372 702000 2                  TSX2    ALT

      586     5938    3       IF AWS.ATRIB.ATMP THEN GOTO RET;

   5938  2 001753   201126 470500                    LDP0    AWS$,,AUTO
         2 001754   000000 236100                    LDQ     0,,PR0
         2 001755   000100 316003                    CANQ    64,DU
         2 001756   002366 601000 2                  TNZ     RET

      587     5939    3       CALL ZIM$READ_PG ALTRET(ALT);

   5939  2 001757   003273 701000 2                  TSX1    ZIM$READ_PG
         2 001760   002372 702000 2                  TSX2    ALT

      588     5940    3       IF JREC.TIME>I_O_BUF.WD(1) THEN

   5940  2 001761   201120 470500                    LDP0    I_O_BUF$,,AUTO
         2 001762   201125 471500                    LDP1    JRNL$,,AUTO
         2 001763   000001 236100                    LDQ     1,,PR0
         2 001764   100000 116100                    CMPQ    0,,PR1
         2 001765   002366 602000 2                  TNC     RET

      589     5941    3           GOTO RET; /* PAGE HAS NOT BEEN UPDATED IN DISK */
      590     5942    3       IF JREC.OFFSET~=I_O_BUF.HW(2047-JREC.LINE) THEN

   5942  2 001766   100003 236100                    LDQ     3,,PR1
         2 001767   777777 376007                    ANQ     -1,DL
         2 001770   000001 736000                    QLS     1
         2 001771   000024 676000 3                  ERQ     20
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:126  
         2 001772   000001 036007                    ADLQ    1,DL
         2 001773   000100 101506                    MRL     fill='000'O
         2 001774   001777 400002                    ADSC9   1023,Q,PR0               cn=2,n=2
         2 001775   201146 000004                    ADSC9   VLP_SN+10,,AUTO          cn=0,n=4
         2 001776   100004 236100                    LDQ     4,,PR1
         2 001777   000022 772000                    QRL     18
         2 002000   201146 116100                    CMPQ    VLP_SN+10,,AUTO
         2 002001   002370 601000 2                  TNZ     ER_MOD

      591     5943    3           GOTO ER_MOD; /* VERY INCONSISTANT */
      592     5944
      593     5945    3       REC$=PINCRC(I_O_BUF$,JREC.OFFSET+12);

   5945  2 002002   000020 736000                    QLS     16
         2 002003   000003 036003                    ADLQ    3,DU
         2 002004   201120 036100                    ADLQ    I_O_BUF$,,AUTO
         2 002005   201121 756100                    STQ     REC$,,AUTO

      594     5946    3       IF JREC.LENGTH > REC$->REC.LEN THEN

   5946  2 002006   100003 236100                    LDQ     3,,PR1
         2 002007   000022 772000                    QRL     18
         2 002010   201146 756100                    STQ     VLP_SN+10,,AUTO
         2 002011   201121 473500                    LDP3    REC$,,AUTO
         2 002012   000100 101500                    MRL     fill='000'O
         2 002013   300000 400002                    ADSC9   0,,PR3                   cn=2,n=2
         2 002014   201147 000004                    ADSC9   VLP_SN+11,,AUTO          cn=0,n=4
         2 002015   201147 236100                    LDQ     VLP_SN+11,,AUTO
         2 002016   201146 116100                    CMPQ    VLP_SN+10,,AUTO
         2 002017   002201 605000 2                  TPL     s:5969

      595     5947    4       DO; /* REC IS VAR LENGTH, THE ONE IN *I IS LARGER */

      596     5948    4           J = JREC.LENGTH - REC$->REC.LEN; /* DIFFERECNE IN BYTES */

   5948  2 002020   000100 101500                    MRL     fill='000'O
         2 002021   300000 400002                    ADSC9   0,,PR3                   cn=2,n=2
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:127  
         2 002022   201146 000004                    ADSC9   VLP_SN+10,,AUTO          cn=0,n=4
         2 002023   100003 236100                    LDQ     3,,PR1
         2 002024   000022 772000                    QRL     18
         2 002025   201146 136100                    SBLQ    VLP_SN+10,,AUTO
         2 002026   201112 756100                    STQ     J,,AUTO

      597     5949    4           IF J > I_O_BUF.HW(7) THEN /* NO ENOUGH SPACE FOR IT */

   5949  2 002027   000003 236100                    LDQ     3,,PR0
         2 002030   777777 376007                    ANQ     -1,DL
         2 002031   201112 116100                    CMPQ    J,,AUTO
         2 002032   002052 603000 2                  TRC     s:5956

      598     5950    5           DO; /* GET RID OF SOME HIGH ENTRIES IN OFFSET ARRAY */

      599     5951    5               I=(J+1)/2; /* I=NUMBER OF ENTRIES TO BE PURGED */

   5951  2 002033   201112 236100                    LDQ     J,,AUTO
         2 002034   000001 036007                    ADLQ    1,DL
         2 002035   000001 772000                    QRL     1
         2 002036   201107 756100                    STQ     I,,AUTO

      600     5952    5               CALL UPD_ARRAY ALTRET(ER_MOD);

   5952  2 002037   001277 701000 2                  TSX1    UPD_ARRAY
         2 002040   002370 702000 2                  TSX2    ER_MOD

      601     5953    5               J=JREC.LENGTH-REC.LEN; /* RESTORE J */

   5953  2 002041   201121 470500                    LDP0    REC$,,AUTO
         2 002042   000100 101500                    MRL     fill='000'O
         2 002043   000000 400002                    ADSC9   0,,PR0                   cn=2,n=2
         2 002044   201146 000004                    ADSC9   VLP_SN+10,,AUTO          cn=0,n=4
         2 002045   201125 471500                    LDP1    JRNL$,,AUTO
         2 002046   100003 236100                    LDQ     3,,PR1
         2 002047   000022 772000                    QRL     18
         2 002050   201146 136100                    SBLQ    VLP_SN+10,,AUTO
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:128  
         2 002051   201112 756100                    STQ     J,,AUTO

      602     5954    5               END;

      603     5955         /* SPACE IS OK, SO MOVE STUFF BELOW THE REC DOWN BY J BYTES */
      604     5956    4           MREC$=PINCRC(REC$,REC$->REC.LEN); /* FROM AFTER THE REC */

   5956  2 002052   201121 470500                    LDP0    REC$,,AUTO
         2 002053   000100 101500                    MRL     fill='000'O
         2 002054   000000 400002                    ADSC9   0,,PR0                   cn=2,n=2
         2 002055   201146 000004                    ADSC9   VLP_SN+10,,AUTO          cn=0,n=4
         2 002056   201146 236100                    LDQ     VLP_SN+10,,AUTO
         2 002057   000020 736000                    QLS     16
         2 002060   201121 036100                    ADLQ    REC$,,AUTO
         2 002061   201122 756100                    STQ     MREC$,,AUTO

      605     5957    4           BOTTOM$=PINCRC(MREC$,J); /* TO J BYTES DOWN */

   5957  2 002062   201112 236100                    LDQ     J,,AUTO
         2 002063   000020 736000                    QLS     16
         2 002064   201122 036100                    ADLQ    MREC$,,AUTO
         2 002065   201123 756100                    STQ     BOTTOM$,,AUTO

      606     5958    4           LAST_OFF=4094-I_O_BUF.HW(7)-I_O_BUF.HW(11)*2;

   5958  2 002066   201120 473500                    LDP3    I_O_BUF$,,AUTO
         2 002067   300003 236100                    LDQ     3,,PR3
         2 002070   777777 376007                    ANQ     -1,DL
         2 002071   201146 756100                    STQ     VLP_SN+10,,AUTO
         2 002072   300005 236100                    LDQ     5,,PR3
         2 002073   000001 736000                    QLS     1
         2 002074   000025 376000 3                  ANQ     21
         2 002075   201146 036100                    ADLQ    VLP_SN+10,,AUTO
         2 002076   000024 676000 3                  ERQ     20
         2 002077   007777 036007                    ADLQ    4095,DL
         2 002100   201111 756100                    STQ     LAST_OFF,,AUTO

PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:129  
      607     5959    4           MREC_SIZ=LAST_OFF-(JREC.OFFSET+12+REC.LEN);

   5959  2 002101   000100 101500                    MRL     fill='000'O
         2 002102   000000 400002                    ADSC9   0,,PR0                   cn=2,n=2
         2 002103   201146 000004                    ADSC9   VLP_SN+10,,AUTO          cn=0,n=4
         2 002104   100004 236100                    LDQ     4,,PR1
         2 002105   000022 772000                    QRL     18
         2 002106   201146 036100                    ADLQ    VLP_SN+10,,AUTO
         2 002107   201147 756100                    STQ     VLP_SN+11,,AUTO
         2 002110   201111 236100                    LDQ     LAST_OFF,,AUTO
         2 002111   201147 136100                    SBLQ    VLP_SN+11,,AUTO
         2 002112   000014 136007                    SBLQ    12,DL
         2 002113   200003 756100                    STQ     MREC_SIZ,,AUTO

      608     5960    4           CALL ZIM$MRL_SHIFT(MREC$,BOTTOM$,MREC_SIZ);

   5960  2 002114   200003 634500                    EPPR4   MREC_SIZ,,AUTO
         2 002115   201150 454500                    STP4    VLP_SN+12,,AUTO
         2 002116   201123 630500                    EPPR0   BOTTOM$,,AUTO
         2 002117   201147 450500                    STP0    VLP_SN+11,,AUTO
         2 002120   201122 630500                    EPPR0   MREC$,,AUTO
         2 002121   201146 450500                    STP0    VLP_SN+10,,AUTO
         2 002122   201146 630500                    EPPR0   VLP_SN+10,,AUTO
         2 002123   000027 631400 3                  EPPR1   23
         2 002124   000000 701000 xent               TSX1    ZIM$MRL_SHIFT
         2 002125   000000 011000                    NOP     0

      609     5961    4           I_O_BUF.HW(7)=I_O_BUF.HW(7)-J; /* UPD SPACE AVAIL */

   5961  2 002126   201120 470500                    LDP0    I_O_BUF$,,AUTO
         2 002127   000003 236100                    LDQ     3,,PR0
         2 002130   777777 376007                    ANQ     -1,DL
         2 002131   201112 136100                    SBLQ    J,,AUTO
         2 002132   000000 620006                    EAX0    0,QL
         2 002133   000003 440100                    SXL0    3,,PR0

      610     5962    5           DO I=0 TO I_O_BUF.HW(11); /* UPD OFFSET ARRAY */
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:130  

   5962  2 002134   201107 450100                    STZ     I,,AUTO
         2 002135   002174 710000 2                  TRA     s:5966+3

      611     5963    5               IF I_O_BUF.HW(2047-I) > JREC.OFFSET AND

   5963  2 002136   000000 235003                    LDA     0,DU
         2 002137   201107 135100                    SBLA    I,,AUTO
         2 002140   000001 735000                    ALS     1
         2 002141   201120 470500                    LDP0    I_O_BUF$,,AUTO
         2 002142   000100 101505                    MRL     fill='000'O
         2 002143   001777 400002                    ADSC9   1023,A,PR0               cn=2,n=2
         2 002144   201146 000004                    ADSC9   VLP_SN+10,,AUTO          cn=0,n=4
         2 002145   201125 471500                    LDP1    JRNL$,,AUTO
         2 002146   100004 236100                    LDQ     4,,PR1
         2 002147   000022 772000                    QRL     18
         2 002150   201146 116100                    CMPQ    VLP_SN+10,,AUTO
         2 002151   002171 605000 2                  TPL     s:5966
         2 002152   000100 101505                    MRL     fill='000'O
         2 002153   001777 400002                    ADSC9   1023,A,PR0               cn=2,n=2
         2 002154   201147 000004                    ADSC9   VLP_SN+11,,AUTO          cn=0,n=4
         2 002155   201147 236100                    LDQ     VLP_SN+11,,AUTO
         2 002156   400000 116007                    CMPQ    -131072,DL
         2 002157   002171 605000 2                  TPL     s:5966

      612     5964    5                  I_O_BUF.HW(2047-I) < 131072 THEN
      613     5965    5                   I_O_BUF.HW(2047-I) = I_O_BUF.HW(2047-I) + J;

   5965  2 002160   000100 101505                    MRL     fill='000'O
         2 002161   001777 400002                    ADSC9   1023,A,PR0               cn=2,n=2
         2 002162   201146 000004                    ADSC9   VLP_SN+10,,AUTO          cn=0,n=4
         2 002163   201146 236100                    LDQ     VLP_SN+10,,AUTO
         2 002164   201112 036100                    ADLQ    J,,AUTO
         2 002165   201147 756100                    STQ     VLP_SN+11,,AUTO
         2 002166   000105 101500                    MRL     fill='000'O
         2 002167   201147 000004                    ADSC9   VLP_SN+11,,AUTO          cn=0,n=4
         2 002170   001777 400002                    ADSC9   1023,A,PR0               cn=2,n=2
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:131  

      614     5966    5               END;

   5966  2 002171   201107 236100                    LDQ     I,,AUTO
         2 002172   000001 036007                    ADLQ    1,DL
         2 002173   201107 756100                    STQ     I,,AUTO
         2 002174   000005 236100                    LDQ     5,,PR0
         2 002175   777777 376007                    ANQ     -1,DL
         2 002176   201107 116100                    CMPQ    I,,AUTO
         2 002177   002136 603000 2                  TRC     s:5963

      615     5967    4           END;

   5967  2 002200   002351 710000 2                  TRA     s:5987

      616     5968    3       ELSE
      617     5969    3           IF JREC.LENGTH < REC$->REC.LEN THEN

   5969  2 002201   000100 101500                    MRL     fill='000'O
         2 002202   300000 400002                    ADSC9   0,,PR3                   cn=2,n=2
         2 002203   201146 000004                    ADSC9   VLP_SN+10,,AUTO          cn=0,n=4
         2 002204   100003 236100                    LDQ     3,,PR1
         2 002205   000022 772000                    QRL     18
         2 002206   201146 116100                    CMPQ    VLP_SN+10,,AUTO
         2 002207   002351 605000 2                  TPL     s:5987

      618     5970    4           DO; /* THE ONE TO ROLLBACK IS SMALLER */

      619     5971    4               LAST_OFF=4094-I_O_BUF.HW(7)-I_O_BUF.HW(11)*2;

   5971  2 002210   000003 236100                    LDQ     3,,PR0
         2 002211   777777 376007                    ANQ     -1,DL
         2 002212   201146 756100                    STQ     VLP_SN+10,,AUTO
         2 002213   000005 236100                    LDQ     5,,PR0
         2 002214   000001 736000                    QLS     1
         2 002215   000025 376000 3                  ANQ     21
         2 002216   201146 036100                    ADLQ    VLP_SN+10,,AUTO
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:132  
         2 002217   000024 676000 3                  ERQ     20
         2 002220   007777 036007                    ADLQ    4095,DL
         2 002221   201111 756100                    STQ     LAST_OFF,,AUTO

      620     5972    4               MREC_SIZ=LAST_OFF-(JREC.OFFSET+12+REC.LEN);

   5972  2 002222   000100 101500                    MRL     fill='000'O
         2 002223   300000 400002                    ADSC9   0,,PR3                   cn=2,n=2
         2 002224   201146 000004                    ADSC9   VLP_SN+10,,AUTO          cn=0,n=4
         2 002225   100004 236100                    LDQ     4,,PR1
         2 002226   000022 772000                    QRL     18
         2 002227   201146 036100                    ADLQ    VLP_SN+10,,AUTO
         2 002230   201147 756100                    STQ     VLP_SN+11,,AUTO
         2 002231   201111 236100                    LDQ     LAST_OFF,,AUTO
         2 002232   201147 136100                    SBLQ    VLP_SN+11,,AUTO
         2 002233   000014 136007                    SBLQ    12,DL
         2 002234   200003 756100                    STQ     MREC_SIZ,,AUTO

      621     5973    4               J=REC$->REC.LEN - JREC.LENGTH;

   5973  2 002235   100003 236100                    LDQ     3,,PR1
         2 002236   000022 772000                    QRL     18
         2 002237   201146 756100                    STQ     VLP_SN+10,,AUTO
         2 002240   000100 101500                    MRL     fill='000'O
         2 002241   300000 400002                    ADSC9   0,,PR3                   cn=2,n=2
         2 002242   201147 000004                    ADSC9   VLP_SN+11,,AUTO          cn=0,n=4
         2 002243   201147 236100                    LDQ     VLP_SN+11,,AUTO
         2 002244   201146 136100                    SBLQ    VLP_SN+10,,AUTO
         2 002245   201112 756100                    STQ     J,,AUTO

      622     5974    4               MREC$=PINCRC(REC$,REC$->REC.LEN);

   5974  2 002246   000100 101500                    MRL     fill='000'O
         2 002247   300000 400002                    ADSC9   0,,PR3                   cn=2,n=2
         2 002250   201146 000004                    ADSC9   VLP_SN+10,,AUTO          cn=0,n=4
         2 002251   201146 236100                    LDQ     VLP_SN+10,,AUTO
         2 002252   000020 736000                    QLS     16
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:133  
         2 002253   201121 036100                    ADLQ    REC$,,AUTO
         2 002254   201122 756100                    STQ     MREC$,,AUTO

      623     5975         /* MOVE STUFF BELOW THE REC UP BY J BYTES */
      624     5976    4               PINCRC(MREC$,-1*J)->MREC.VAL=MREC$->MREC.VAL;

   5976  2 002255   000000 235003                    LDA     0,DU
         2 002256   201112 135100                    SBLA    J,,AUTO
         2 002257   201122 474500                    LDP4    MREC$,,AUTO
         2 002260   200003 720100                    LXL0    MREC_SIZ,,AUTO
         2 002261   040145 100540                    MLR     fill='040'O
         2 002262   400000 000010                    ADSC9   0,,PR4                   cn=0,n=*X0
         2 002263   400000 000010                    ADSC9   0,A,PR4                  cn=0,n=*X0

      625     5977    4               MREC$=PINCRC(MREC$,MREC_SIZ-J);

   5977  2 002264   200003 236100                    LDQ     MREC_SIZ,,AUTO
         2 002265   201112 136100                    SBLQ    J,,AUTO
         2 002266   000020 736000                    QLS     16
         2 002267   201122 036100                    ADLQ    MREC$,,AUTO
         2 002270   201122 756100                    STQ     MREC$,,AUTO

      626     5978    4               MREC_SIZ=J;

   5978  2 002271   201112 235100                    LDA     J,,AUTO
         2 002272   200003 755100                    STA     MREC_SIZ,,AUTO

      627     5979    4               MREC$->MREC = '0'B; /* FILL THE NEW GAP WITH ZEROS */

   5979  2 002273   201122 473500                    LDP3    MREC$,,AUTO
         2 002274   000000 620005                    EAX0    0,AL
         2 002275   000140 100400                    MLR     fill='000'O
         2 002276   000011 000001 3                  ADSC9   9                        cn=0,n=1
         2 002277   300000 000010                    ADSC9   0,,PR3                   cn=0,n=*X0

      628     5980    4               I_O_BUF.HW(7)=I_O_BUF.HW(7)+J; /* UPD SPACE AVAIL */

PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:134  
   5980  2 002300   000003 236100                    LDQ     3,,PR0
         2 002301   777777 376007                    ANQ     -1,DL
         2 002302   201112 036100                    ADLQ    J,,AUTO
         2 002303   000000 620006                    EAX0    0,QL
         2 002304   000003 440100                    SXL0    3,,PR0

      629     5981    5               DO I=0 TO I_O_BUF.HW(11);

   5981  2 002305   201107 450100                    STZ     I,,AUTO
         2 002306   002345 710000 2                  TRA     s:5985+3

      630     5982    5                   IF I_O_BUF.HW(2047-I) > JREC.OFFSET AND

   5982  2 002307   000000 235003                    LDA     0,DU
         2 002310   201107 135100                    SBLA    I,,AUTO
         2 002311   000001 735000                    ALS     1
         2 002312   201120 470500                    LDP0    I_O_BUF$,,AUTO
         2 002313   000100 101505                    MRL     fill='000'O
         2 002314   001777 400002                    ADSC9   1023,A,PR0               cn=2,n=2
         2 002315   201146 000004                    ADSC9   VLP_SN+10,,AUTO          cn=0,n=4
         2 002316   201125 471500                    LDP1    JRNL$,,AUTO
         2 002317   100004 236100                    LDQ     4,,PR1
         2 002320   000022 772000                    QRL     18
         2 002321   201146 116100                    CMPQ    VLP_SN+10,,AUTO
         2 002322   002342 605000 2                  TPL     s:5985
         2 002323   000100 101505                    MRL     fill='000'O
         2 002324   001777 400002                    ADSC9   1023,A,PR0               cn=2,n=2
         2 002325   201147 000004                    ADSC9   VLP_SN+11,,AUTO          cn=0,n=4
         2 002326   201147 236100                    LDQ     VLP_SN+11,,AUTO
         2 002327   400000 116007                    CMPQ    -131072,DL
         2 002330   002342 605000 2                  TPL     s:5985

      631     5983    5                      I_O_BUF.HW(2047-I) < 131072 THEN
      632     5984    5                       I_O_BUF.HW(2047-I) = I_O_BUF.HW(2047-I) - J;

   5984  2 002331   000100 101505                    MRL     fill='000'O
         2 002332   001777 400002                    ADSC9   1023,A,PR0               cn=2,n=2
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:135  
         2 002333   201146 000004                    ADSC9   VLP_SN+10,,AUTO          cn=0,n=4
         2 002334   201146 236100                    LDQ     VLP_SN+10,,AUTO
         2 002335   201112 136100                    SBLQ    J,,AUTO
         2 002336   201147 756100                    STQ     VLP_SN+11,,AUTO
         2 002337   000105 101500                    MRL     fill='000'O
         2 002340   201147 000004                    ADSC9   VLP_SN+11,,AUTO          cn=0,n=4
         2 002341   001777 400002                    ADSC9   1023,A,PR0               cn=2,n=2

      633     5985    5                   END;

   5985  2 002342   201107 236100                    LDQ     I,,AUTO
         2 002343   000001 036007                    ADLQ    1,DL
         2 002344   201107 756100                    STQ     I,,AUTO
         2 002345   000005 236100                    LDQ     5,,PR0
         2 002346   777777 376007                    ANQ     -1,DL
         2 002347   201107 116100                    CMPQ    I,,AUTO
         2 002350   002307 603000 2                  TRC     s:5982

      634     5986    4               END;

      635     5987    3       MREC_SIZ = JREC.LENGTH;

   5987  2 002351   201125 471500                    LDP1    JRNL$,,AUTO
         2 002352   100003 236100                    LDQ     3,,PR1
         2 002353   000022 772000                    QRL     18
         2 002354   200003 756100                    STQ     MREC_SIZ,,AUTO

      636     5988    3       REC$->MREC.VAL = JREC.VALUE;

   5988  2 002355   100003 220100                    LDX0    3,,PR1
         2 002356   201121 473500                    LDP3    REC$,,AUTO
         2 002357   000000 621006                    EAX1    0,QL
         2 002360   040140 100540                    MLR     fill='040'O
         2 002361   100004 400010                    ADSC9   4,,PR1                   cn=2,n=*X0
         2 002362   300000 000011                    ADSC9   0,,PR3                   cn=0,n=*X1

      637     5989    3       CALL ZIO$MODIFY ALTRET(ALT);
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:136  

   5989  2 002363   000011 631400 3                  EPPR1   9
         2 002364   000000 701000 xent               TSX1    ZIO$MODIFY
         2 002365   002372 702000 2                  TSX2    ALT

      638     5990    3   RET: RETURN;

   5990  2 002366   201142 221300       RET          LDX1  ! VLP_SN+6,,AUTO
         2 002367   000001 702211                    TSX2  ! 1,X1

      639     5991
      640     5992    3   ER_MOD: ERROR=ERR#RL#INCNS;

   5992  2 002370   303404 235007       ER_MOD       LDA     100100,DL
         2 002371   201105 755100                    STA     ERROR,,AUTO

      641     5993    3   ALT: ALTRETURN;

   5993  2 002372   201142 221300       ALT          LDX1  ! VLP_SN+6,,AUTO
         2 002373   000000 702211                    TSX2  ! 0,X1

      642     5994    3   END ZIM$MOD;
      643     5995        %EJECT;
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:137  
      644     5996    2   ZIM$RISTO: PROC ALTRET;

   5996  2 002374   201142 741300       ZIM$RISTO    STX1  ! VLP_SN+6,,AUTO

      645     5997    3       CALL ZIM$CK_AWS ALTRET(ALT);

   5997  2 002375   003316 701000 2                  TSX1    ZIM$CK_AWS
         2 002376   002512 702000 2                  TSX2    ALT

      646     5998    3       IF AWS.ATRIB.ATMP THEN

   5998  2 002377   201126 470500                    LDP0    AWS$,,AUTO
         2 002400   000000 236100                    LDQ     0,,PR0
         2 002401   000100 316003                    CANQ    64,DU
         2 002402   002473 601000 2                  TNZ     RET

      647     5999    3           GOTO RET;
      648     6000    3       GLOBAL.KEY.LENGTH=JREC.LENGTH;

   6000  2 002403   000000 471400 xsym               LDP1    GLOBAL$
         2 002404   201125 473500                    LDP3    JRNL$,,AUTO
         2 002405   300003 236100                    LDQ     3,,PR3
         2 002406   000011 736000                    QLS     9
         2 002407   104624 552140                    STBQ    2452,'40'O,PR1

      649     6001    3       GLOBAL.KEY.VALUE=JREC.VALUE;

   6001  2 002410   300003 220100                    LDX0    3,,PR3
         2 002411   040100 100540                    MLR     fill='040'O
         2 002412   300004 400010                    ADSC9   4,,PR3                   cn=2,n=*X0
         2 002413   104624 200377                    ADSC9   2452,,PR1                cn=1,n=255

      650     6002    3       GLOBAL.PRECI$->FPT$PRECI.V.DCB#=AWS.DDCB;

   6002  2 002414   105131 474500                    LDP4    2649,,PR1
         2 002415   000006 220100                    LDX0    6,,PR0
         2 002416   400006 740100                    STX0    6,,PR4
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:138  

      651     6003    3       GLOBAL.PRECI$->FPT$PRECI.V.INDX#=1;

   6003  2 002417   105131 474500                    LDP4    2649,,PR1
         2 002420   000001 236007                    LDQ     1,DL
         2 002421   400006 552104                    STBQ    6,'04'O,PR4

      652     6004    3       GLOBAL.PRECI$->FPT$PRECI.V.N#=0;

   6004  2 002422   105131 474500                    LDP4    2649,,PR1
         2 002423   400007 450100                    STZ     7,,PR4

      653     6005    3       ADDR(GLOBAL.PRECI$->FPT$PRECI.KEY_)->VLP$VECTOR.W1.VSIZE#=

   6005  2 002424   105131 474500                    LDP4    2649,,PR1
         2 002425   300003 236100                    LDQ     3,,PR3
         2 002426   000022 772000                    QRL     18
         2 002427   000001 136007                    SBLQ    1,DL
         2 002430   000020 736000                    QLS     16
         2 002431   400002 676100                    ERQ     2,,PR4
         2 002432   000030 376000 3                  ANQ     24
         2 002433   400002 656100                    ERSQ    2,,PR4

      654     6006    3          JREC.LENGTH-1;
      655     6007    3       CALL M$PRECORD(GLOBAL.PRECI$->FPT$PRECI) ALTRET(ER_PREC);

   6007  2 002434   105131 474500                    LDP4    2649,,PR1
         2 002435   400000 630500                    EPPR0   0,,PR4
         2 002436   440003 713400                    CLIMB   alt,+16387
         2 002437   401000 401760                    pmme    nvectors=3
         2 002440   002475 702000 2                  TSX2    ER_PREC

      656     6008    3       GLOBAL.DELI$->FPT$DELI.V.DCB#=AWS.DDCB;

   6008  2 002441   000000 470400 xsym               LDP0    GLOBAL$
         2 002442   005132 471500                    LDP1    2650,,PR0
         2 002443   201126 473500                    LDP3    AWS$,,AUTO
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:139  
         2 002444   300006 220100                    LDX0    6,,PR3
         2 002445   100010 740100                    STX0    8,,PR1

      657     6009    3       ADDR(GLOBAL.DELI$->FPT$DELI.KEY_)->VLP$VECTOR.W1.VSIZE#=

   6009  2 002446   005132 471500                    LDP1    2650,,PR0
         2 002447   201125 474500                    LDP4    JRNL$,,AUTO
         2 002450   400003 236100                    LDQ     3,,PR4
         2 002451   000022 772000                    QRL     18
         2 002452   000001 136007                    SBLQ    1,DL
         2 002453   000020 736000                    QLS     16
         2 002454   100002 676100                    ERQ     2,,PR1
         2 002455   000030 376000 3                  ANQ     24
         2 002456   100002 656100                    ERSQ    2,,PR1

      658     6010    3          JREC.LENGTH-1;
      659     6011    3       CALL M$DELREC(GLOBAL.DELI$->FPT$DELI) ALTRET(ER_DELR);

   6011  2 002457   005132 471500                    LDP1    2650,,PR0
         2 002460   100000 630500                    EPPR0   0,,PR1
         2 002461   440002 713400                    CLIMB   alt,+16386
         2 002462   401400 401760                    pmme    nvectors=4
         2 002463   002477 702000 2                  TSX2    ER_DELR

      660     6012    3       GLOBAL.STATS.CURR.READS=GLOBAL.STATS.CURR.READS+1;

   6012  2 002464   000000 470400 xsym               LDP0    GLOBAL$
         2 002465   001425 235100                    LDA     789,,PR0
         2 002466   000001 035007                    ADLA    1,DL
         2 002467   001425 755100                    STA     789,,PR0

      661     6013    3       GLOBAL.STATS.CURR.WRITES=GLOBAL.STATS.CURR.WRITES+1;

   6013  2 002470   001426 235100                    LDA     790,,PR0
         2 002471   000001 035007                    ADLA    1,DL
         2 002472   001426 755100                    STA     790,,PR0

PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:140  
      662     6014    3   RET: RETURN;

   6014  2 002473   201142 221300       RET          LDX1  ! VLP_SN+6,,AUTO
         2 002474   000001 702211                    TSX2  ! 1,X1

      663     6015    3   ER_PREC: IF PARTIAL THEN

   6015  2 002475   201115 234100       ER_PREC      SZN     PARTIAL,,AUTO
         2 002476   002473 604000 2                  TMI     RET

      664     6016    3           GOTO RET;
      665     6017    3   ER_DELR: ERROR=ERR#RL#INCNS;

   6017  2 002477   303404 235007       ER_DELR      LDA     100100,DL
         2 002500   201105 755100                    STA     ERROR,,AUTO

      666     6018    3       GLOBAL.RET.SYSERR#=B$TCB$->B$TCB.ALT$->B$ALT.ERR;

   6018  2 002501   000000 470400 xsym               LDP0    B$TCB$
         2 002502   000000 471500                    LDP1    0,,PR0
         2 002503   100102 236100                    LDQ     66,,PR1
         2 002504   000000 473400 xsym               LDP3    GLOBAL$
         2 002505   300007 756100                    STQ     7,,PR3

      667     6019    3       GLOBAL.RET.DCB#=AWS.DDCB;

   6019  2 002506   201126 471500                    LDP1    AWS$,,AUTO
         2 002507   100006 220100                    LDX0    6,,PR1
         2 002510   300014 740100                    STX0    12,,PR3

      668     6020    3       GOTO ALT;

   6020  2 002511   002512 710000 2                  TRA     ALT

      669     6021    3   ALT: ALTRETURN;

   6021  2 002512   201142 221300       ALT          LDX1  ! VLP_SN+6,,AUTO
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:141  
         2 002513   000000 702211                    TSX2  ! 0,X1

      670     6022    3   END ZIM$RISTO;
      671     6023        %EJECT;
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:142  
      672     6024    2   ZIM$RIDEL: PROC ALTRET;

   6024  2 002514   201142 741300       ZIM$RIDEL    STX1  ! VLP_SN+6,,AUTO

      673     6025    3       CALL ZIM$CK_AWS ALTRET(ALT);

   6025  2 002515   003316 701000 2                  TSX1    ZIM$CK_AWS
         2 002516   002602 702000 2                  TSX2    ALT

      674     6026    3       IF AWS.ATRIB.ATMP THEN

   6026  2 002517   201126 470500                    LDP0    AWS$,,AUTO
         2 002520   000000 236100                    LDQ     0,,PR0
         2 002521   000100 316003                    CANQ    64,DU
         2 002522   002563 601000 2                  TNZ     RET

      675     6027    3           GOTO RET;
      676     6028    3       GLOBAL.WRTI$->FPT$WRTI.V.DCB#=AWS.DDCB;

   6028  2 002523   000000 471400 xsym               LDP1    GLOBAL$
         2 002524   105076 473500                    LDP3    2622,,PR1
         2 002525   000006 220100                    LDX0    6,,PR0
         2 002526   300010 740100                    STX0    8,,PR3

      677     6029    3       GLOBAL.WRTI$->FPT$WRTI.V.ONEWKEY#=%NO#;

   6029  2 002527   105076 473500                    LDP3    2622,,PR1
         2 002530   000031 236000 3                  LDQ     25
         2 002531   300010 356100                    ANSQ    8,,PR3

      678     6030    3       GLOBAL.WRTI$->FPT$WRTI.BUF_.BUF$=ADDR(JREC.VALUE);

   6030  2 002532   105076 473500                    LDP3    2622,,PR1
         2 002533   201125 236100                    LDQ     JRNL$,,AUTO
         2 002534   000032 036000 3                  ADLQ    26
         2 002535   300005 756100                    STQ     5,,PR3

PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:143  
      679     6031    3       GLOBAL.WRTI$->FPT$WRTI.BUF_.BOUND=JREC.LENGTH-1;

   6031  2 002536   105076 473500                    LDP3    2622,,PR1
         2 002537   201125 474500                    LDP4    JRNL$,,AUTO
         2 002540   400003 236100                    LDQ     3,,PR4
         2 002541   000022 772000                    QRL     18
         2 002542   000001 136007                    SBLQ    1,DL
         2 002543   000020 736000                    QLS     16
         2 002544   300004 676100                    ERQ     4,,PR3
         2 002545   000030 376000 3                  ANQ     24
         2 002546   300004 656100                    ERSQ    4,,PR3

      680     6032    3       CALL M$WRITE(GLOBAL.WRTI$->FPT$WRTI) ALTRET(ER_WRT);

   6032  2 002547   105076 473500                    LDP3    2622,,PR1
         2 002550   300000 630500                    EPPR0   0,,PR3
         2 002551   440001 713400                    CLIMB   alt,write
         2 002552   401400 401760                    pmme    nvectors=4
         2 002553   002565 702000 2                  TSX2    ER_WRT

      681     6033    3       GLOBAL.STATS.CURR.READS=GLOBAL.STATS.CURR.READS+1;

   6033  2 002554   000000 470400 xsym               LDP0    GLOBAL$
         2 002555   001425 235100                    LDA     789,,PR0
         2 002556   000001 035007                    ADLA    1,DL
         2 002557   001425 755100                    STA     789,,PR0

      682     6034    3       GLOBAL.STATS.CURR.WRITES=GLOBAL.STATS.CURR.WRITES+1;

   6034  2 002560   001426 235100                    LDA     790,,PR0
         2 002561   000001 035007                    ADLA    1,DL
         2 002562   001426 755100                    STA     790,,PR0

      683     6035    3   RET: RETURN;

   6035  2 002563   201142 221300       RET          LDX1  ! VLP_SN+6,,AUTO
         2 002564   000001 702211                    TSX2  ! 1,X1
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:144  

      684     6036    3   ER_WRT: IF PARTIAL THEN

   6036  2 002565   201115 234100       ER_WRT       SZN     PARTIAL,,AUTO
         2 002566   002563 604000 2                  TMI     RET

      685     6037    3           GOTO RET;
      686     6038    3       ERROR=ERR#RL#INCNS;

   6038  2 002567   303404 235007                    LDA     100100,DL
         2 002570   201105 755100                    STA     ERROR,,AUTO

      687     6039    3       GLOBAL.RET.SYSERR#=B$TCB$->B$TCB.ALT$->B$ALT.ERR;

   6039  2 002571   000000 470400 xsym               LDP0    B$TCB$
         2 002572   000000 471500                    LDP1    0,,PR0
         2 002573   100102 236100                    LDQ     66,,PR1
         2 002574   000000 473400 xsym               LDP3    GLOBAL$
         2 002575   300007 756100                    STQ     7,,PR3

      688     6040    3       GLOBAL.RET.DCB#=AWS.DDCB;

   6040  2 002576   201126 471500                    LDP1    AWS$,,AUTO
         2 002577   100006 220100                    LDX0    6,,PR1
         2 002600   300014 740100                    STX0    12,,PR3

      689     6041    3       GOTO ALT;

   6041  2 002601   002602 710000 2                  TRA     ALT

      690     6042    3   ALT: ALTRETURN;

   6042  2 002602   201142 221300       ALT          LDX1  ! VLP_SN+6,,AUTO
         2 002603   000000 702211                    TSX2  ! 0,X1

      691     6043    3   END ZIM$RIDEL;
      692     6044        %EJECT;
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:145  
      693     6045    2   ZIM$RIMOD: PROC ALTRET;

   6045  2 002604   201142 741300       ZIM$RIMOD    STX1  ! VLP_SN+6,,AUTO

      694     6046    3       CALL ZIM$CK_AWS ALTRET(ALT);

   6046  2 002605   003316 701000 2                  TSX1    ZIM$CK_AWS
         2 002606   002672 702000 2                  TSX2    ALT

      695     6047    3       IF AWS.ATRIB.ATMP THEN

   6047  2 002607   201126 470500                    LDP0    AWS$,,AUTO
         2 002610   000000 236100                    LDQ     0,,PR0
         2 002611   000100 316003                    CANQ    64,DU
         2 002612   002653 601000 2                  TNZ     RET

      696     6048    3           GOTO RET;
      697     6049    3       GLOBAL.WRTI$->FPT$WRTI.V.DCB#=AWS.DDCB;

   6049  2 002613   000000 471400 xsym               LDP1    GLOBAL$
         2 002614   105076 473500                    LDP3    2622,,PR1
         2 002615   000006 220100                    LDX0    6,,PR0
         2 002616   300010 740100                    STX0    8,,PR3

      698     6050    3       GLOBAL.WRTI$->FPT$WRTI.V.ONEWKEY#=%YES#;

   6050  2 002617   105076 473500                    LDP3    2622,,PR1
         2 002620   000400 236007                    LDQ     256,DL
         2 002621   300010 256100                    ORSQ    8,,PR3

      699     6051    3       GLOBAL.WRTI$->FPT$WRTI.BUF_.BUF$=ADDR(JREC.VALUE);

   6051  2 002622   105076 473500                    LDP3    2622,,PR1
         2 002623   201125 236100                    LDQ     JRNL$,,AUTO
         2 002624   000032 036000 3                  ADLQ    26
         2 002625   300005 756100                    STQ     5,,PR3

PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:146  
      700     6052    3       GLOBAL.WRTI$->FPT$WRTI.BUF_.BOUND=JREC.LENGTH-1;

   6052  2 002626   105076 473500                    LDP3    2622,,PR1
         2 002627   201125 474500                    LDP4    JRNL$,,AUTO
         2 002630   400003 236100                    LDQ     3,,PR4
         2 002631   000022 772000                    QRL     18
         2 002632   000001 136007                    SBLQ    1,DL
         2 002633   000020 736000                    QLS     16
         2 002634   300004 676100                    ERQ     4,,PR3
         2 002635   000030 376000 3                  ANQ     24
         2 002636   300004 656100                    ERSQ    4,,PR3

      701     6053    3       CALL M$WRITE(GLOBAL.WRTI$->FPT$WRTI) ALTRET(ER_WRT);

   6053  2 002637   105076 473500                    LDP3    2622,,PR1
         2 002640   300000 630500                    EPPR0   0,,PR3
         2 002641   440001 713400                    CLIMB   alt,write
         2 002642   401400 401760                    pmme    nvectors=4
         2 002643   002655 702000 2                  TSX2    ER_WRT

      702     6054    3       GLOBAL.STATS.CURR.READS=GLOBAL.STATS.CURR.READS+1;

   6054  2 002644   000000 470400 xsym               LDP0    GLOBAL$
         2 002645   001425 235100                    LDA     789,,PR0
         2 002646   000001 035007                    ADLA    1,DL
         2 002647   001425 755100                    STA     789,,PR0

      703     6055    3       GLOBAL.STATS.CURR.WRITES=GLOBAL.STATS.CURR.WRITES+1;

   6055  2 002650   001426 235100                    LDA     790,,PR0
         2 002651   000001 035007                    ADLA    1,DL
         2 002652   001426 755100                    STA     790,,PR0

      704     6056    3   RET: RETURN;

   6056  2 002653   201142 221300       RET          LDX1  ! VLP_SN+6,,AUTO
         2 002654   000001 702211                    TSX2  ! 1,X1
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:147  

      705     6057    3   ER_WRT: IF PARTIAL THEN

   6057  2 002655   201115 234100       ER_WRT       SZN     PARTIAL,,AUTO
         2 002656   002653 604000 2                  TMI     RET

      706     6058    3           GOTO RET;
      707     6059    3       ERROR=ERR#RL#INCNS;

   6059  2 002657   303404 235007                    LDA     100100,DL
         2 002660   201105 755100                    STA     ERROR,,AUTO

      708     6060    3       GLOBAL.RET.SYSERR#=B$TCB$->B$TCB.ALT$->B$ALT.ERR;

   6060  2 002661   000000 470400 xsym               LDP0    B$TCB$
         2 002662   000000 471500                    LDP1    0,,PR0
         2 002663   100102 236100                    LDQ     66,,PR1
         2 002664   000000 473400 xsym               LDP3    GLOBAL$
         2 002665   300007 756100                    STQ     7,,PR3

      709     6061    3       GLOBAL.RET.DCB#=AWS.DDCB;

   6061  2 002666   201126 471500                    LDP1    AWS$,,AUTO
         2 002667   100006 220100                    LDX0    6,,PR1
         2 002670   300014 740100                    STX0    12,,PR3

      710     6062    3       GOTO ALT;

   6062  2 002671   002672 710000 2                  TRA     ALT

      711     6063    3   ALT: ALTRETURN;

   6063  2 002672   201142 221300       ALT          LDX1  ! VLP_SN+6,,AUTO
         2 002673   000000 702211                    TSX2  ! 0,X1

      712     6064    3   END ZIM$RIMOD;
      713     6065        %EJECT;
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:148  
      714     6066    2   ZIM$SUM: PROC ALTRET;

   6066  2 002674   201142 741300       ZIM$SUM      STX1  ! VLP_SN+6,,AUTO

      715     6067    3       CALL ZIM$CK_AWS ALTRET(ALT);

   6067  2 002675   003316 701000 2                  TSX1    ZIM$CK_AWS
         2 002676   002743 702000 2                  TSX2    ALT

      716     6068    3       CALL ZIM$READ_PG ALTRET(ALT);

   6068  2 002677   003273 701000 2                  TSX1    ZIM$READ_PG
         2 002700   002743 702000 2                  TSX2    ALT

      717     6069    3       IF JREC.TIME > I_O_BUF.WD(1) THEN GOTO RET; /*Page never was written out*/

   6069  2 002701   201120 470500                    LDP0    I_O_BUF$,,AUTO
         2 002702   201125 471500                    LDP1    JRNL$,,AUTO
         2 002703   000001 236100                    LDQ     1,,PR0
         2 002704   100000 116100                    CMPQ    0,,PR1
         2 002705   002736 602000 2                  TNC     RET

      718     6070    3       GLOBAL.PARAN.ICKSM.P$=I_O_BUF$;

   6070  2 002706   201120 236100                    LDQ     I_O_BUF$,,AUTO
         2 002707   000000 473400 xsym               LDP3    GLOBAL$
         2 002710   300023 756100                    STQ     19,,PR3

      719     6071    3       CALL ZIM$ICKSMJ; /*This chksum is special for rollback..

   6071  2 002711   000011 631400 3                  EPPR1   9
         2 002712   000000 701000 xent               TSX1    ZIM$ICKSMJ
         2 002713   000000 011000                    NOP     0

      720     6072         							  doesn't count the offset array or the 3 ids hdr words*/
      721     6073    3       IF CKSM.CKSM ~= GLOBAL.PARAN.ICKSM.V THEN GOTO ER_CHKSUM;

PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:149  
   6073  2 002714   201125 470500                    LDP0    JRNL$,,AUTO
         2 002715   000000 471400 xsym               LDP1    GLOBAL$
         2 002716   000003 236100                    LDQ     3,,PR0
         2 002717   100024 116100                    CMPQ    20,,PR1
         2 002720   002740 601000 2                  TNZ     ER_CHKSUM

      722     6074    3       IF AWS.ATRIB.CHKSUM THEN /* Is this area CHECKSUMMED ? */

   6074  2 002721   201126 473500                    LDP3    AWS$,,AUTO
         2 002722   300000 236100                    LDQ     0,,PR3
         2 002723   010000 316003                    CANQ    4096,DU
         2 002724   002736 600000 2                  TZE     RET

      723     6075    4       DO;

      724     6076    4           GLOBAL.PARAN.ICKSM.P$=I_O_BUF$;

   6076  2 002725   201120 236100                    LDQ     I_O_BUF$,,AUTO
         2 002726   100023 756100                    STQ     19,,PR1

      725     6077    4           CALL ZIM$ICKSM; /*Get the real checksum value*/

   6077  2 002727   000011 631400 3                  EPPR1   9
         2 002730   000000 701000 xent               TSX1    ZIM$ICKSM
         2 002731   000000 011000                    NOP     0

      726     6078    4           I_O_BUF.WD(2)=GLOBAL.PARAN.ICKSM.V;

   6078  2 002732   000000 470400 xsym               LDP0    GLOBAL$
         2 002733   201120 471500                    LDP1    I_O_BUF$,,AUTO
         2 002734   000024 235100                    LDA     20,,PR0
         2 002735   100002 755100                    STA     2,,PR1

      727     6079    4           END;

      728     6080    3   RET:
      729     6081    3       RETURN;
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:150  

   6081  2 002736   201142 221300       RET          LDX1  ! VLP_SN+6,,AUTO
         2 002737   000001 702211                    TSX2  ! 1,X1

      730     6082    3   ER_CHKSUM:
      731     6083    3       ERROR=ERR#RL#INCNS;

   6083  2 002740   303404 235007       ER_CHKSUM    LDA     100100,DL
         2 002741   201105 755100                    STA     ERROR,,AUTO

      732     6084    3       GOTO ALT;

   6084  2 002742   002743 710000 2                  TRA     ALT

      733     6085    3   ALT: ALTRETURN;

   6085  2 002743   201142 221300       ALT          LDX1  ! VLP_SN+6,,AUTO
         2 002744   000000 702211                    TSX2  ! 0,X1

      734     6086    3   END ZIM$SUM;
      735     6087        %EJECT;
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:151  
      736     6088    2   ZIM$MSET: PROC ALTRET;

   6088  2 002745   201142 741300       ZIM$MSET     STX1  ! VLP_SN+6,,AUTO

      737     6089    3       CALL ZIM$CK_AWS ALTRET(ALT);

   6089  2 002746   003316 701000 2                  TSX1    ZIM$CK_AWS
         2 002747   003016 702000 2                  TSX2    ALT

      738     6090    3       IF AWS.ATRIB.ATMP THEN RETURN;

   6090  2 002750   201126 470500                    LDP0    AWS$,,AUTO
         2 002751   000000 236100                    LDQ     0,,PR0
         2 002752   000100 316003                    CANQ    64,DU
         2 002753   002756 600000 2                  TZE     s:6091

   6090  2 002754   201142 221300                    LDX1  ! VLP_SN+6,,AUTO
         2 002755   000001 702211                    TSX2  ! 1,X1

      739     6091    3       CALL ZIM$READ_PG ALTRET(ALT);

   6091  2 002756   003273 701000 2                  TSX1    ZIM$READ_PG
         2 002757   003016 702000 2                  TSX2    ALT

      740     6092    3       IF JREC.TIME > I_O_BUF.WD(1) THEN GOTO RET; /*Page never was written out*/

   6092  2 002760   201120 470500                    LDP0    I_O_BUF$,,AUTO
         2 002761   201125 471500                    LDP1    JRNL$,,AUTO
         2 002762   000001 236100                    LDQ     1,,PR0
         2 002763   100000 116100                    CMPQ    0,,PR1
         2 002764   003014 602000 2                  TNC     RET

      741     6093    3       REC$=PINCRC(I_O_BUF$,JREC.OFFSET+12);

   6093  2 002765   100004 236100                    LDQ     4,,PR1
         2 002766   000022 772000                    QRL     18
         2 002767   000020 736000                    QLS     16
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:152  
         2 002770   000003 036003                    ADLQ    3,DU
         2 002771   201120 036100                    ADLQ    I_O_BUF$,,AUTO
         2 002772   201121 756100                    STQ     REC$,,AUTO

      742     6094    3       MREC_SIZ=JREC.LENGTH;

   6094  2 002773   100003 236100                    LDQ     3,,PR1
         2 002774   000022 772000                    QRL     18
         2 002775   200003 756100                    STQ     MREC_SIZ,,AUTO

      743     6095    3       IF JREC.VALUE=REC$->MREC.VAL THEN GOTO RET;

   6095  2 002776   100003 220100                    LDX0    3,,PR1
         2 002777   201121 473500                    LDP3    REC$,,AUTO
         2 003000   000000 621006                    EAX1    0,QL
         2 003001   040140 106540                    CMPC    fill='040'O
         2 003002   100004 400010                    ADSC9   4,,PR1                   cn=2,n=*X0
         2 003003   300000 000011                    ADSC9   0,,PR3                   cn=0,n=*X1
         2 003004   003014 600000 2                  TZE     RET

      744     6096    3       ELSE REC$->MREC.VAL=JREC.VALUE;

   6096  2 003005   200003 721100                    LXL1    MREC_SIZ,,AUTO
         2 003006   040140 100540                    MLR     fill='040'O
         2 003007   100004 400010                    ADSC9   4,,PR1                   cn=2,n=*X0
         2 003010   300000 000011                    ADSC9   0,,PR3                   cn=0,n=*X1

      745     6097    3       CALL ZIO$MODIFY;

   6097  2 003011   000011 631400 3                  EPPR1   9
         2 003012   000000 701000 xent               TSX1    ZIO$MODIFY
         2 003013   000000 011000                    NOP     0

      746     6098    3   RET:
      747     6099    3       RETURN;

   6099  2 003014   201142 221300       RET          LDX1  ! VLP_SN+6,,AUTO
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:153  
         2 003015   000001 702211                    TSX2  ! 1,X1

      748     6100    3   ALT: ALTRETURN;

   6100  2 003016   201142 221300       ALT          LDX1  ! VLP_SN+6,,AUTO
         2 003017   000000 702211                    TSX2  ! 0,X1

      749     6101    3   END ZIM$MSET;
      750     6102        %EJECT;
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:154  
      751     6103    2   ZIM$KEYSTO: PROC ALTRET;

   6103  2 003020   201142 741300       ZIM$KEYSTO   STX1  ! VLP_SN+6,,AUTO

      752     6104    3       CALL ZIM$CK_AWS ALTRET(ALT);

   6104  2 003021   003316 701000 2                  TSX1    ZIM$CK_AWS
         2 003022   003055 702000 2                  TSX2    ALT

      753     6105    3       GLOBAL.DELR$->FPT$DELR.V.DCB#=AWS.KDCB;

   6105  2 003023   000000 470400 xsym               LDP0    GLOBAL$
         2 003024   005101 471500                    LDP1    2625,,PR0
         2 003025   201126 473500                    LDP3    AWS$,,AUTO
         2 003026   300006 720100                    LXL0    6,,PR3
         2 003027   100010 740100                    STX0    8,,PR1

      754     6106    3       GLOBAL.KEY.LENGTH=JREC.LENGTH;

   6106  2 003030   201125 471500                    LDP1    JRNL$,,AUTO
         2 003031   100003 236100                    LDQ     3,,PR1
         2 003032   000011 736000                    QLS     9
         2 003033   004624 552140                    STBQ    2452,'40'O,PR0

      755     6107    3       GLOBAL.KEY.VALUE=JREC.VALUE;

   6107  2 003034   100003 220100                    LDX0    3,,PR1
         2 003035   040100 100540                    MLR     fill='040'O
         2 003036   100004 400010                    ADSC9   4,,PR1                   cn=2,n=*X0
         2 003037   004624 200377                    ADSC9   2452,,PR0                cn=1,n=255

      756     6108    3       CALL M$DELREC(GLOBAL.DELR$->FPT$DELR) ALTRET(ER_DELR);

   6108  2 003040   005101 474500                    LDP4    2625,,PR0
         2 003041   400000 630500                    EPPR0   0,,PR4
         2 003042   440002 713400                    CLIMB   alt,+16386
         2 003043   401400 401760                    pmme    nvectors=4
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:155  
         2 003044   003053 702000 2                  TSX2    ER_DELR

      757     6109    3       GLOBAL.STATS.CURR.WRITES=GLOBAL.STATS.CURR.WRITES+1;

   6109  2 003045   000000 470400 xsym               LDP0    GLOBAL$
         2 003046   001426 235100                    LDA     790,,PR0
         2 003047   000001 035007                    ADLA    1,DL
         2 003050   001426 755100                    STA     790,,PR0

      758     6110    3       RETURN;

   6110  2 003051   201142 221300                    LDX1  ! VLP_SN+6,,AUTO
         2 003052   000001 702211                    TSX2  ! 1,X1

      759     6111    3   ER_DELR:
      760     6112        /*Key was already deleted so just return....must have never have been stored*/
      761     6113    3       RETURN;

   6113  2 003053   201142 221300       ER_DELR      LDX1  ! VLP_SN+6,,AUTO
         2 003054   000001 702211                    TSX2  ! 1,X1

      762     6114    3   ALT: ALTRETURN;

   6114  2 003055   201142 221300       ALT          LDX1  ! VLP_SN+6,,AUTO
         2 003056   000000 702211                    TSX2  ! 0,X1

      763     6115    3   END ZIM$KEYSTO;
      764     6116        %EJECT;
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:156  
      765     6117    2   ZIM$KEYDEL: PROC ALTRET;

   6117  2 003057   201142 741300       ZIM$KEYDEL   STX1  ! VLP_SN+6,,AUTO

      766     6118    3       CALL ZIM$CK_AWS ALTRET(ALT);

   6118  2 003060   003316 701000 2                  TSX1    ZIM$CK_AWS
         2 003061   003216 702000 2                  TSX2    ALT

      767     6119    3       IF AWS.ATRIB.ATMP THEN RETURN;

   6119  2 003062   201126 470500                    LDP0    AWS$,,AUTO
         2 003063   000000 236100                    LDQ     0,,PR0
         2 003064   000100 316003                    CANQ    64,DU
         2 003065   003070 600000 2                  TZE     s:6120

   6119  2 003066   201142 221300                    LDX1  ! VLP_SN+6,,AUTO
         2 003067   000001 702211                    TSX2  ! 1,X1

      768     6120    3       GLOBAL.WRTK$->FPT$WRTK.V.DCB#=AWS.KDCB;

   6120  2 003070   000000 471400 xsym               LDP1    GLOBAL$
         2 003071   105100 473500                    LDP3    2624,,PR1
         2 003072   000006 720100                    LXL0    6,,PR0
         2 003073   300010 740100                    STX0    8,,PR3

      769     6121    3       GLOBAL.KEY.LENGTH=JREC.LENGTH;

   6121  2 003074   201125 473500                    LDP3    JRNL$,,AUTO
         2 003075   300003 236100                    LDQ     3,,PR3
         2 003076   000011 736000                    QLS     9
         2 003077   104624 552140                    STBQ    2452,'40'O,PR1

      770     6122    3       GLOBAL.KEY.VALUE=JREC.VALUE;

   6122  2 003100   300003 220100                    LDX0    3,,PR3
         2 003101   040100 100540                    MLR     fill='040'O
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:157  
         2 003102   300004 400010                    ADSC9   4,,PR3                   cn=2,n=*X0
         2 003103   104624 200377                    ADSC9   2452,,PR1                cn=1,n=255

      771     6123    3       CALL M$WRITE(GLOBAL.WRTK$->FPT$WRTK) ALTRET (ER_WRT);

   6123  2 003104   105100 474500                    LDP4    2624,,PR1
         2 003105   400000 630500                    EPPR0   0,,PR4
         2 003106   440001 713400                    CLIMB   alt,write
         2 003107   401400 401760                    pmme    nvectors=4
         2 003110   003155 702000 2                  TSX2    ER_WRT

      772     6124    3       GLOBAL.STATS.CURR.READS=GLOBAL.STATS.CURR.READS+1;

   6124  2 003111   000000 470400 xsym               LDP0    GLOBAL$
         2 003112   001425 235100                    LDA     789,,PR0
         2 003113   000001 035007                    ADLA    1,DL
         2 003114   001425 755100                    STA     789,,PR0

      773     6125    3       GLOBAL.STATS.CURR.WRITES=GLOBAL.STATS.CURR.WRITES+1;

   6125  2 003115   001426 235100                    LDA     790,,PR0
         2 003116   000001 035007                    ADLA    1,DL
         2 003117   001426 755100                    STA     790,,PR0

      774     6126    3       IF DCBADDR(AWS.KDCB)->F$DCB.RDL0# > 3 THEN

   6126  2 003120   000033 471400 3                  LDP1    27
         2 003121   100000 473500                    LDP3    0,,PR1
         2 003122   201126 474500                    LDP4    AWS$,,AUTO
         2 003123   400006 720100                    LXL0    6,,PR4
         2 003124   300000 470510                    LDP0    0,X0,PR3
         2 003125   000003 236100                    LDQ     3,,PR0
         2 003126   000777 376003                    ANQ     511,DU
         2 003127   000004 116003                    CMPQ    4,DU
         2 003130   003153 602000 2                  TNC     s:6133

      775     6127    4       DO;
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:158  

      776     6128    4           GLOBAL.CLOSE$->FPT$CLOSE.V.DCB#=AWS.KDCB;

   6128  2 003131   000000 470400 xsym               LDP0    GLOBAL$
         2 003132   005072 471500                    LDP1    2618,,PR0
         2 003133   100032 740100                    STX0    26,,PR1

      777     6129    4           CALL M$CLOSE(GLOBAL.CLOSE$->FPT$CLOSE) ALTRET(ER_CLSK);

   6129  2 003134   005072 471500                    LDP1    2618,,PR0
         2 003135   100000 630500                    EPPR0   0,,PR1
         2 003136   450001 713400                    CLIMB   alt,close
         2 003137   406000 401760                    pmme    nvectors=13
         2 003140   003170 702000 2                  TSX2    ER_CLSK

      778     6130    4           GLOBAL.REOPEN$->FPT$REOPEN.V.DCB#=AWS.KDCB;

   6130  2 003141   000000 470400 xsym               LDP0    GLOBAL$
         2 003142   005071 471500                    LDP1    2617,,PR0
         2 003143   201126 473500                    LDP3    AWS$,,AUTO
         2 003144   300006 720100                    LXL0    6,,PR3
         2 003145   100044 740100                    STX0    36,,PR1

      779     6131    4           CALL M$OPEN(GLOBAL.REOPEN$->FPT$REOPEN) ALTRET(ER_OPNK);

   6131  2 003146   005071 471500                    LDP1    2617,,PR0
         2 003147   100000 630500                    EPPR0   0,,PR1
         2 003150   450000 713400                    CLIMB   alt,open
         2 003151   410400 401760                    pmme    nvectors=18
         2 003152   003203 702000 2                  TSX2    ER_OPNK

      780     6132    4           END;

      781     6133    3       RETURN;

   6133  2 003153   201142 221300                    LDX1  ! VLP_SN+6,,AUTO
         2 003154   000001 702211                    TSX2  ! 1,X1
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:159  

      782     6134    3   ER_WRT:
      783     6135    3       ERROR=ERR#IX#DLDBK;

   6135  2 003155   303414 235007       ER_WRT       LDA     100108,DL
         2 003156   201105 755100                    STA     ERROR,,AUTO

      784     6136    3       GLOBAL.RET.SYSERR#=B$TCB$->B$TCB.ALT$->B$ALT.ERR;

   6136  2 003157   000000 470400 xsym               LDP0    B$TCB$
         2 003160   000000 471500                    LDP1    0,,PR0
         2 003161   100102 236100                    LDQ     66,,PR1
         2 003162   000000 473400 xsym               LDP3    GLOBAL$
         2 003163   300007 756100                    STQ     7,,PR3

      785     6137    3       GLOBAL.RET.DCB#=AWS.KDCB;

   6137  2 003164   201126 471500                    LDP1    AWS$,,AUTO
         2 003165   100006 720100                    LXL0    6,,PR1
         2 003166   300014 740100                    STX0    12,,PR3

      786     6138    3       GOTO ALT;

   6138  2 003167   003216 710000 2                  TRA     ALT

      787     6139    3   ER_CLSK:
      788     6140    3       ERROR=ERR#IO#CLSK;

   6140  2 003170   303355 235007       ER_CLSK      LDA     100077,DL
         2 003171   201105 755100                    STA     ERROR,,AUTO

      789     6141    3       GLOBAL.RET.SYSERR#=B$TCB$->B$TCB.ALT$->B$ALT.ERR;

   6141  2 003172   000000 470400 xsym               LDP0    B$TCB$
         2 003173   000000 471500                    LDP1    0,,PR0
         2 003174   100102 236100                    LDQ     66,,PR1
         2 003175   000000 473400 xsym               LDP3    GLOBAL$
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:160  
         2 003176   300007 756100                    STQ     7,,PR3

      790     6142    3       GLOBAL.RET.DCB#=AWS.KDCB;

   6142  2 003177   201126 471500                    LDP1    AWS$,,AUTO
         2 003200   100006 720100                    LXL0    6,,PR1
         2 003201   300014 740100                    STX0    12,,PR3

      791     6143    3       GOTO ALT;

   6143  2 003202   003216 710000 2                  TRA     ALT

      792     6144    3   ER_OPNK:
      793     6145    3       ERROR=ERR#IO#OPNK;

   6145  2 003203   210700 235007       ER_OPNK      LDA     70080,DL
         2 003204   201105 755100                    STA     ERROR,,AUTO

      794     6146    3       GLOBAL.RET.SYSERR#=B$TCB$->B$TCB.ALT$->B$ALT.ERR;

   6146  2 003205   000000 470400 xsym               LDP0    B$TCB$
         2 003206   000000 471500                    LDP1    0,,PR0
         2 003207   100102 236100                    LDQ     66,,PR1
         2 003210   000000 473400 xsym               LDP3    GLOBAL$
         2 003211   300007 756100                    STQ     7,,PR3

      795     6147    3       GLOBAL.RET.DCB#=AWS.KDCB;

   6147  2 003212   201126 471500                    LDP1    AWS$,,AUTO
         2 003213   100006 720100                    LXL0    6,,PR1
         2 003214   300014 740100                    STX0    12,,PR3

      796     6148    3       GOTO ALT;

   6148  2 003215   003216 710000 2                  TRA     ALT

      797     6149    3   ALT: ALTRETURN;
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:161  

   6149  2 003216   201142 221300       ALT          LDX1  ! VLP_SN+6,,AUTO
         2 003217   000000 702211                    TSX2  ! 0,X1

      798     6150    3   END ZIM$KEYDEL;
      799     6151        %EJECT;
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:162  
      800     6152        /*
      801     6153              SET LOCKOUT BIT FOR UNPROTECTED UPDATE USERS.
      802     6154        */
      803     6155    2   ZIM$FID: PROC ALTRET;

   6155  2 003220   201142 741300       ZIM$FID      STX1  ! VLP_SN+6,,AUTO

      804     6156
      805     6157    3       IF NOT GLOBAL.PENDING.ROLL_ABORTED AND

   6157  2 003221   000000 470400 xsym               LDP0    GLOBAL$
         2 003222   000017 236100                    LDQ     15,,PR0
         2 003223   000040 316003                    CANQ    32,DU
         2 003224   003231 601000 2                  TNZ     s:6160
         2 003225   201125 471500                    LDP1    JRNL$,,AUTO
         2 003226   100003 236100                    LDQ     3,,PR1
         2 003227   010000 316003                    CANQ    4096,DU
         2 003230   003267 600000 2                  TZE     RET

      806     6158    3          NOT FILE.UNPROTECT THEN
      807     6159    3           GOTO RET;
      808     6160    3       CALL ZIM$CK_AWS ALTRET(ALT);

   6160  2 003231   003316 701000 2                  TSX1    ZIM$CK_AWS
         2 003232   003271 702000 2                  TSX2    ALT

      809     6161    3       AWS.ATRIB.UNPROTECT=%YES#; /* IN CASE RECOVERY, LOCKOUT NOT RESET */

   6161  2 003233   201126 470500                    LDP0    AWS$,,AUTO
         2 003234   400000 236007                    LDQ     -131072,DL
         2 003235   000000 256100                    ORSQ    0,,PR0

      810     6162    3       GLOBAL.TJRNL.UNCHECK=%YES#;

   6162  2 003236   000000 471400 xsym               LDP1    GLOBAL$
         2 003237   400000 236003                    LDQ     -131072,DU
         2 003240   102606 256100                    ORSQ    1414,,PR1
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:163  

      811     6163    3       JREC.PAGE = 0; /* READ ATTRIBUTE PAGE */

   6163  2 003241   201125 473500                    LDP3    JRNL$,,AUTO
         2 003242   300002 450100                    STZ     2,,PR3

      812     6164    3       CALL ZIM$READ_PG ALTRET(ALT);

   6164  2 003243   003273 701000 2                  TSX1    ZIM$READ_PG
         2 003244   003271 702000 2                  TSX2    ALT

      813     6165    3       I_O_BUF$->ATBLK_PG.STATUS.LOCKED='1'B;

   6165  2 003245   201120 470500                    LDP0    I_O_BUF$,,AUTO
         2 003246   400000 236003                    LDQ     -131072,DU
         2 003247   000041 256100                    ORSQ    33,,PR0

      814     6166    3       IF FILE.KEYED THEN /* ALSO LOCK OUT KEYED FILE TILL REBUILD */

   6166  2 003250   201125 471500                    LDP1    JRNL$,,AUTO
         2 003251   100003 234100                    SZN     3,,PR1
         2 003252   003255 605000 2                  TPL     s:6168

      815     6167    3           I_O_BUF$->ATBLK_PG.STATUS.KFILE_CURR='1'B;

   6167  2 003253   100000 236003                    LDQ     32768,DU
         2 003254   000041 256100                    ORSQ    33,,PR0

      816     6168    3       I_O_BUF$->ATBLK_PG.TIME_LOCKED=GLOBAL.TIME.TSTAMP;

   6168  2 003255   000000 473400 xsym               LDP3    GLOBAL$
         2 003256   305001 235100                    LDA     2561,,PR3
         2 003257   000042 755100                    STA     34,,PR0

      817     6169    3       I_O_BUF$->ATBLK_PG.REASON_LOCKED.UNPROTECT_ABORT='1'B;

   6169  2 003260   040000 236003                    LDQ     16384,DU
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:164  
         2 003261   000043 256100                    ORSQ    35,,PR0

      818     6170    3       I_O_BUF$->ATBLK_PG.REASON_LOCKED.ROLLBACK_FAIL='0'B;

   6170  2 003262   000034 236000 3                  LDQ     28
         2 003263   000043 356100                    ANSQ    35,,PR0

      819     6171    3       CALL ZIO$MODIFY ALTRET(ALT);

   6171  2 003264   000011 631400 3                  EPPR1   9
         2 003265   000000 701000 xent               TSX1    ZIO$MODIFY
         2 003266   003271 702000 2                  TSX2    ALT

      820     6172    3   RET: RETURN;

   6172  2 003267   201142 221300       RET          LDX1  ! VLP_SN+6,,AUTO
         2 003270   000001 702211                    TSX2  ! 1,X1

      821     6173
      822     6174    3   ALT: ALTRETURN;

   6174  2 003271   201142 221300       ALT          LDX1  ! VLP_SN+6,,AUTO
         2 003272   000000 702211                    TSX2  ! 0,X1

      823     6175    3   END ZIM$FID;
      824     6176        %EJECT;
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:165  
      825     6177    2   ZIM$READ_PG: PROC ALTRET;

   6177  2 003273   201144 741300       ZIM$READ_PG  STX1  ! VLP_SN+8,,AUTO

      826     6178    3       GLOBAL.PARAN.IO.PGNO=JREC.PAGE;

   6178  2 003274   201125 470500                    LDP0    JRNL$,,AUTO
         2 003275   000000 471400 xsym               LDP1    GLOBAL$
         2 003276   000002 235100                    LDA     2,,PR0
         2 003277   100021 755100                    STA     17,,PR1

      827     6179    3       GLOBAL.PARAN.IO.AWS$=AWS$;

   6179  2 003300   201126 236100                    LDQ     AWS$,,AUTO
         2 003301   100020 756100                    STQ     16,,PR1

      828     6180    3       CALL ZIO$DBREAD ALTRET(ER_IDSRD);

   6180  2 003302   000011 631400 3                  EPPR1   9
         2 003303   000000 701000 xent               TSX1    ZIO$DBREAD
         2 003304   003313 702000 2                  TSX2    ER_IDSRD

      829     6181    3       I_O_BUF$=PINCRW(GLOBAL.PARAN.IO.BUF$,-3);

   6181  2 003305   000000 470400 xsym               LDP0    GLOBAL$
         2 003306   000022 236100                    LDQ     18,,PR0
         2 003307   777775 036003                    ADLQ    -3,DU
         2 003310   201120 756100                    STQ     I_O_BUF$,,AUTO

      830     6182    3       RETURN;

   6182  2 003311   201144 221300                    LDX1  ! VLP_SN+8,,AUTO
         2 003312   000001 702211                    TSX2  ! 1,X1

      831     6183    3   ER_IDSRD:
      832     6184    3       GOTO ALT;

PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:166  
   6184  2 003313   003314 710000 2     ER_IDSRD     TRA     ALT

      833     6185    3   ALT:
      834     6186    3       ALTRETURN;

   6186  2 003314   201144 221300       ALT          LDX1  ! VLP_SN+8,,AUTO
         2 003315   000000 702211                    TSX2  ! 0,X1

      835     6187    3   END ZIM$READ_PG;
      836     6188        %EJECT;
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:167  
      837     6189    2   ZIM$CK_AWS: PROC ALTRET;

   6189  2 003316   201144 741300       ZIM$CK_AWS   STX1  ! VLP_SN+8,,AUTO

      838     6190    3       IF AWS_TAB.AWS$(JREC.DCB#) ~= ADDR(NIL) THEN

   6190  2 003317   201125 470500                    LDP0    JRNL$,,AUTO
         2 003320   000001 720100                    LXL0    1,,PR0
         2 003321   200004 236110                    LDQ     AWS_TAB,X0,AUTO
         2 003322   000000 116000 3                  CMPQ    0
         2 003323   003326 600000 2                  TZE     s:6195

      839     6191    4       DO;

      840     6192    4           AWS$=AWS_TAB.AWS$(JREC.DCB#);

   6192  2 003324   201126 756100                    STQ     AWS$,,AUTO

      841     6193    4           RETURN;

   6193  2 003325   000001 702211                    TSX2  ! 1,X1

      842     6194    4           END;
      843     6195    4       ELSE DO I = 1 TO 5 BY 1;

   6195  2 003326   000001 235007                    LDA     1,DL
         2 003327   201107 755100                    STA     I,,AUTO

      844     6196    4           IF GLOBAL.DB.SSS$(I) ~= ADDR(NIL) THEN

   6196  2 003330   000000 470400 xsym               LDP0    GLOBAL$
         2 003331   201107 720100                    LXL0    I,,AUTO
         2 003332   000153 236110                    LDQ     107,X0,PR0
         2 003333   000000 116000 3                  CMPQ    0
         2 003334   003372 600000 2                  TZE     s:6210

      845     6197    5           DO;
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:168  

      846     6198    5               SSS$=GLOBAL.DB.SSS$(I);

   6198  2 003335   201127 756100                    STQ     SSS$,,AUTO

      847     6199    5               AC$=PINCRW(SSS$,SIZEW(OA1));

   6199  2 003336   000001 036003                    ADLQ    1,DU
         2 003337   201132 756100                    STQ     AC$,,AUTO

      848     6200    6               DO WHILE (AC.OAACN ~= 0);

   6200  2 003340   201132 471500                    LDP1    AC$,,AUTO
         2 003341   100001 221100                    LDX1    1,,PR1
         2 003342   003372 600000 2                  TZE     s:6210

      849     6201    6                   AC$ = PINCRW(SSS$, AC.OAACN);

   6201  2 003343   201132 470500                    LDP0    AC$,,AUTO
         2 003344   000001 220100                    LDX0    1,,PR0
         2 003345   000000 636010                    EAQ     0,X0
         2 003346   201127 036100                    ADLQ    SSS$,,AUTO
         2 003347   201132 756100                    STQ     AC$,,AUTO

      850     6202    6                   AWS$=PINCRW(GLOBAL.DB.DBCB$(I),AC.WSOF);

   6202  2 003350   201132 470500                    LDP0    AC$,,AUTO
         2 003351   000003 220100                    LDX0    3,,PR0
         2 003352   000000 471400 xsym               LDP1    GLOBAL$
         2 003353   201107 721100                    LXL1    I,,AUTO
         2 003354   100161 473511                    LDP3    113,X1,PR1
         2 003355   300000 634510                    EPPR4   0,X0,PR3
         2 003356   201126 454500                    STP4    AWS$,,AUTO

      851     6203    6                   IF AWS.DDCB = JREC.DCB# THEN

   6203  2 003357   201125 470500                    LDP0    JRNL$,,AUTO
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:169  
         2 003360   000001 720100                    LXL0    1,,PR0
         2 003361   400006 100100                    CMPX0   6,,PR4
         2 003362   003367 601000 2                  TNZ     s:6208

      852     6204    7                   DO;

      853     6205    7                       AWS_TAB.AWS$(JREC.DCB#)=AWS$;

   6205  2 003363   201126 236100                    LDQ     AWS$,,AUTO
         2 003364   200004 756110                    STQ     AWS_TAB,X0,AUTO

      854     6206    7                       RETURN;

   6206  2 003365   201144 221300                    LDX1  ! VLP_SN+8,,AUTO
         2 003366   000001 702211                    TSX2  ! 1,X1

      855     6207    7                       END;
      856     6208    6                   END;

   6208  2 003367   201132 470500                    LDP0    AC$,,AUTO
         2 003370   000001 220100                    LDX0    1,,PR0
         2 003371   003343 601000 2                  TNZ     s:6201

      857     6209    5               END;

      858     6210    4           END;

   6210  2 003372   201107 235100                    LDA     I,,AUTO
         2 003373   000001 035007                    ADLA    1,DL
         2 003374   201107 755100                    STA     I,,AUTO
         2 003375   000006 115007                    CMPA    6,DL
         2 003376   003330 602000 2                  TNC     s:6196

      859     6211    3   ALT: ERROR = ERR#RL#BADAWS;

   6211  2 003377   303410 236007       ALT          LDQ     100104,DL
         2 003400   201105 756100                    STQ     ERROR,,AUTO
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:170  

      860     6212    3       ALTRETURN;

   6212  2 003401   201144 221300                    LDX1  ! VLP_SN+8,,AUTO
         2 003402   000000 702211                    TSX2  ! 0,X1

(unnamed)
 Sect OctLoc
   1     000   124112 122116   114040 040040                                    TJRNL

(unnamed)
 Sect OctLoc
   3     000   000000 006014   777777 577777   040040 040040   000002 000000    ........    ....
   3     004   000000 000012   000000 006000   000004 006000   777717 777777    ................
   3     010   000003 777640   000000 000000   000000 177640   000000 006014    ................
   3     014   777777 377777   000001 000000   400000 000000   000016 006000    ................
   3     020   777677 777777   000011 006000   776777 777777   000000 006000    ................
   3     024   777777 777777   000001 777776   000000 400000   000003 000000    ................
   3     030   777777 600000   777777 777377   000004 400000   000000 006003    ................
   3     034   677777 777777                                                    ....
      861     6213    3   END ZIM$CK_AWS;
      862     6214    2   END ZIM$PPROL;
      863     6215    1   END; /*ZIM$PROL*/

PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:171  
--  Include file information  --

   B_ERRORS_C.:LIB_E05  is referenced.
   ZI_ERRORS_C.:ZIC0TOU  is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
   ZI$USER.:ZIC0TOU  is referenced.
   ZI$SSS.:ZIC0TOU  cannot be made into a system file and is referenced.
   ZI$DBCB.:ZIC0TOU  is referenced.
   ZI$JRNL.:ZIC0TOU  is referenced.
   ZI$PG_STRUCTS.:ZIC0TOU  is referenced.
   ZI$GLOBAL.:ZIC0TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure ZIM$PROL.

   Procedure ZIM$PROL requires 1795 words for executable code.
   Procedure ZIM$PROL requires 620 words of local(AUTO) storage.

    No errors detected in file ZIM$CKROL.:ZIC0TSI    .
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:172  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:173  
          MINI XREF LISTING

AC.DEF.ANL
      2522**DCL      2593--IMP-SIZ
AC.DEF.FORG
      2509**DCL      2513--REDEF
AC.OAACN
      2523**DCL      6200>>DOWHILE  6201>>ASSIGN
AC.WSOF
      2526**DCL      6202>>ASSIGN
AC$
      2505**DCL      2506--IMP-PTR  6199<<ASSIGN   6200>>DOWHILE  6201<<ASSIGN   6201>>ASSIGN   6202>>ASSIGN
ALT
      5702**LABEL    5627--GOTO     5634--CALLALT  5641--CALLALT  5651--CALLALT  5652--CALLALT  5654--CALLALT
      5659--CALLALT  5672--CALLALT
ALT IN PROCEDURE ZIM$DEL
      5932**LABEL    5877--CALLALT  5880--CALLALT  5928--CALLALT
ALT IN PROCEDURE ZIM$FID
      6174**LABEL    6160--CALLALT  6164--CALLALT  6171--CALLALT
ALT IN PROCEDURE ZIM$KEYDEL
      6149**LABEL    6118--CALLALT  6138--GOTO     6143--GOTO     6148--GOTO
ALT IN PROCEDURE ZIM$KEYSTO
      6114**LABEL    6104--CALLALT
ALT IN PROCEDURE ZIM$MOD
      5993**LABEL    5937--CALLALT  5939--CALLALT  5989--CALLALT
ALT IN PROCEDURE ZIM$MSET
      6100**LABEL    6089--CALLALT  6091--CALLALT
ALT IN PROCEDURE ZIM$PPROL
      5786**LABEL    5732--CALLALT  5735--CALLALT  5738--CALLALT  5741--CALLALT  5744--CALLALT  5747--CALLALT
      5750--CALLALT  5753--CALLALT  5756--CALLALT  5759--CALLALT  5762--CALLALT  5779--GOTO     5784--GOTO
ALT IN PROCEDURE ZIM$READ_PG
      6186**LABEL    6184--GOTO
ALT IN PROCEDURE ZIM$RIDEL
      6042**LABEL    6025--CALLALT  6041--GOTO
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:174  
ALT IN PROCEDURE ZIM$RIMOD
      6063**LABEL    6046--CALLALT  6062--GOTO
ALT IN PROCEDURE ZIM$RISTO
      6021**LABEL    5997--CALLALT  6020--GOTO
ALT IN PROCEDURE ZIM$STO
      5838**LABEL    5790--CALLALT  5792--CALLALT  5834--CALLALT
ALT IN PROCEDURE ZIM$SUM
      6085**LABEL    6067--CALLALT  6068--CALLALT  6084--GOTO
ATBLK$
       960**DCL       961--IMP-PTR
ATBLK_PG.AREA_NM
       986**DCL       987--REDEF
ATBLK_PG.REASON_LOCKED.ROLLBACK_FAIL
      1010**DCL      5639<<ASSIGN   6170<<ASSIGN
ATBLK_PG.REASON_LOCKED.UNPROTECT_ABORT
      1011**DCL      6169<<ASSIGN
ATBLK_PG.STATUS
       995**DCL      1003--REDEF
ATBLK_PG.STATUS.KFILE_CURR
       998**DCL      5638<<ASSIGN   6167<<ASSIGN
ATBLK_PG.STATUS.LOCKED
       996**DCL      5636<<ASSIGN   6165<<ASSIGN
ATBLK_PG.TIME_LOCKED
      1006**DCL      5640<<ASSIGN   6168<<ASSIGN
AWS
      1842**DCL      5606--CALL     5607--ASSIGN
AWS.ATRIB.ATMP
      1854**DCL      5614<<ASSIGN   5791>>IF       5878>>IF       5938>>IF       5998>>IF       6026>>IF
      6047>>IF       6090>>IF       6119>>IF
AWS.ATRIB.CHKSUM
      1849**DCL      5613<<ASSIGN   6074>>IF
AWS.ATRIB.FUN
      1855**DCL      5612<<ASSIGN
AWS.ATRIB.KEYED
      1857**DCL      5611<<ASSIGN
AWS.ATRIB.UNPROTECT
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:175  
      1860**DCL      5630<<ASSIGN   6161<<ASSIGN
AWS.DDCB
      1867**DCL      5610<<ASSIGN   6002>>ASSIGN   6008>>ASSIGN   6019>>ASSIGN   6028>>ASSIGN   6040>>ASSIGN
      6049>>ASSIGN   6061>>ASSIGN   6203>>IF
AWS.ENCRP
      1869**DCL      5609<<ASSIGN
AWS.KDCB
      1868**DCL      6105>>ASSIGN   6120>>ASSIGN   6126--IF       6128>>ASSIGN   6130>>ASSIGN   6137>>ASSIGN
      6142>>ASSIGN   6147>>ASSIGN
AWS$
      1841**DCL      1842--IMP-PTR  5608<<ASSIGN   5609>>ASSIGN   5610>>ASSIGN   5611>>ASSIGN   5612>>ASSIGN
      5613>>ASSIGN   5614>>ASSIGN   5623>>ASSIGN   5630>>ASSIGN   5791>>IF       5878>>IF       5938>>IF
      5998>>IF       6002>>ASSIGN   6008>>ASSIGN   6019>>ASSIGN   6026>>IF       6028>>ASSIGN   6040>>ASSIGN
      6047>>IF       6049>>ASSIGN   6061>>ASSIGN   6074>>IF       6090>>IF       6105>>ASSIGN   6119>>IF
      6120>>ASSIGN   6126>>IF       6128>>ASSIGN   6130>>ASSIGN   6137>>ASSIGN   6142>>ASSIGN   6147>>ASSIGN
      6161>>ASSIGN   6179>>ASSIGN   6192<<ASSIGN   6202<<ASSIGN   6203>>IF       6205>>ASSIGN
AWS_TAB.AWS$
        20**DCL      5580<<ASSIGN   5607<<ASSIGN   5608>>ASSIGN   5669>>IF       5671>>ASSIGN   6190>>IF
      6192>>ASSIGN   6205<<ASSIGN
B$ALT.CODE
      5565**DCL      5565--REDEF    5566--REDEF    5566--REDEF
B$ALT.ERR
      5566**DCL      5689>>ASSIGN   5693>>ASSIGN   5698>>ASSIGN   5772>>ASSIGN   5777>>ASSIGN   5782>>ASSIGN
      6018>>ASSIGN   6039>>ASSIGN   6060>>ASSIGN   6136>>ASSIGN   6141>>ASSIGN   6146>>ASSIGN
B$ALT.ERR.ERR#
      5567**DCL      5567--REDEF    5685>>IF       5769>>IF
B$ALT.EVID
      5566**DCL      5566--REDEF    5566--REDEF
B$DS3$
        53**DCL      5606<>CALL     5607>>ASSIGN
B$TCB.ALT$
      5572**DCL      5685>>IF       5689>>ASSIGN   5693>>ASSIGN   5698>>ASSIGN   5769>>IF       5772>>ASSIGN
      5777>>ASSIGN   5782>>ASSIGN   6018>>ASSIGN   6039>>ASSIGN   6060>>ASSIGN   6136>>ASSIGN   6141>>ASSIGN
      6146>>ASSIGN
B$TCB$
        52**DCL      5685>>IF       5689>>ASSIGN   5693>>ASSIGN   5698>>ASSIGN   5769>>IF       5772>>ASSIGN
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:176  
      5777>>ASSIGN   5782>>ASSIGN   6018>>ASSIGN   6039>>ASSIGN   6060>>ASSIGN   6136>>ASSIGN   6141>>ASSIGN
      6146>>ASSIGN
BERC.DCB#
      1166**DCL      1167--REDEF
BOTTOM$
        60**DCL      5957<<ASSIGN   5960<>CALL
CKSM.CKSM
      1161**DCL      6073>>IF
COMMON
      5698**LABEL    5690--GOTO     5694--GOTO     5699--GOTO
ERROR
        27**DCL      5576<<ASSIGN   5688<<ASSIGN   5692<<ASSIGN   5697<<ASSIGN   5701>>ASSIGN   5771<<ASSIGN
      5776<<ASSIGN   5781<<ASSIGN   5837<<ASSIGN   5931<<ASSIGN   5992<<ASSIGN   6017<<ASSIGN   6038<<ASSIGN
      6059<<ASSIGN   6083<<ASSIGN   6135<<ASSIGN   6140<<ASSIGN   6145<<ASSIGN   6211<<ASSIGN
ER_CHKSUM IN PROCEDURE ZIM$SUM
      6083**LABEL    6073--GOTO
ER_CLSK IN PROCEDURE ZIM$KEYDEL
      6140**LABEL    6129--CALLALT
ER_DEL IN PROCEDURE ZIM$DEL
      5931**LABEL    5884--GOTO     5896--CALLALT  5913--GOTO
ER_DELR IN PROCEDURE ZIM$KEYSTO
      6113**LABEL    6108--CALLALT
ER_DELR IN PROCEDURE ZIM$RISTO
      6017**LABEL    6011--CALLALT
ER_GDCB
      5697**LABEL    5587--CALLALT
ER_GS
      5692**LABEL    5606--CALLALT
ER_IDSRD IN PROCEDURE ZIM$READ_PG
      6184**LABEL    6180--CALLALT
ER_MOD IN PROCEDURE ZIM$MOD
      5992**LABEL    5943--GOTO     5952--CALLALT
ER_OPNK IN PROCEDURE ZIM$KEYDEL
      6145**LABEL    6131--CALLALT
ER_OPNT
      5695**LABEL    5595--CALLALT
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:177  
ER_PFIL IN PROCEDURE ZIM$PPROL
      5781**LABEL    5713--CALLALT
ER_PJRNL IN PROCEDURE ZIM$PPROL
      5769**LABEL    5723--CALLALT
ER_PREC IN PROCEDURE ZIM$RISTO
      6015**LABEL    6007--CALLALT
ER_READ
      5685**LABEL    5601--CALLALT
ER_READ IN PROCEDURE ZIM$PPROL
      5776**LABEL    5724--CALLALT
ER_RJRNL
      5688**LABEL    5677--CALLALT
ER_STO IN PROCEDURE ZIM$STO
      5837**LABEL    5799--GOTO     5803--GOTO     5807--GOTO     5826--GOTO
ER_TJNA
      5683**LABEL    5648--GOTO
ER_WRT IN PROCEDURE ZIM$KEYDEL
      6135**LABEL    6123--CALLALT
ER_WRT IN PROCEDURE ZIM$RIDEL
      6036**LABEL    6032--CALLALT
ER_WRT IN PROCEDURE ZIM$RIMOD
      6057**LABEL    6053--CALLALT
F$DCB.ACTPOS
      4073**DCL      4073--REDEF
F$DCB.ARS#
      4047**DCL      4047--REDEF
F$DCB.ATTR
      4066**DCL      4067--REDEF
F$DCB.BORROW
      4081**DCL      4081--REDEF    4081--REDEF    4081--REDEF
F$DCB.DCBNAME.L
      4095**DCL      4095--IMP-SIZ
F$DCB.EOMCHAR#
      4051**DCL      4051--REDEF
F$DCB.FLDID
      4076**DCL      4076--REDEF
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:178  
F$DCB.FORM$
      4070**DCL      4070--REDEF
F$DCB.FSECT
      4086**DCL      4086--REDEF
F$DCB.FSN#
      4063**DCL      4063--REDEF    4063--REDEF    4064--REDEF
F$DCB.HEADER$
      4069**DCL      4069--REDEF
F$DCB.IXTNSIZE#
      4067**DCL      4067--REDEF
F$DCB.LASTSTA$
      4056**DCL      4056--REDEF
F$DCB.LVL
      4082**DCL      4082--REDEF
F$DCB.NAME#.C
      4057**DCL      4057--REDEF
F$DCB.NOEOF
      4079**DCL      4079--REDEF
F$DCB.NRECS#
      4068**DCL      4068--REDEF
F$DCB.NRECX
      4087**DCL      4087--REDEF
F$DCB.OHDR
      4079**DCL      4079--REDEF
F$DCB.ORG#
      4062**DCL      4062--REDEF
F$DCB.PRECNO
      4085**DCL      4085--REDEF
F$DCB.RCSZ
      4091**DCL      4091--REDEF
F$DCB.RDL0#
      4051**DCL      6126>>IF
F$DCB.RES#
      4058**DCL      4058--REDEF
F$DCB.SETX
      4070**DCL      4070--REDEF
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:179  
F$DCB.TAB$
      4070**DCL      4070--REDEF
F$DCB.TDA
      4084**DCL      4085--REDEF
F$DCB.WSN#
      4058**DCL      4058--REDEF
F$DCB$
        55**DCL      4041--IMP-PTR
FILE.ATMP
      1133**DCL      5614>>ASSIGN   5631>>IF
FILE.CHKSUM
      1132**DCL      5613>>ASSIGN
FILE.CRPT
      1130**DCL      5609>>ASSIGN
FILE.DCB#
      1129**DCL      5607>>ASSIGN   5608>>ASSIGN
FILE.ID.ACCT#
      1139**DCL      5617>>ASSIGN
FILE.ID.NAME#.C
      1144**DCL      5616>>ASSIGN   5619>>ASSIGN
FILE.ID.NAME#.L
      1143**DCL      5615>>ASSIGN   5618>>ASSIGN
FILE.ID.PSN#
      1141**DCL      5621>>ASSIGN
FILE.INDEXED
      1134**DCL      5631>>IF
FILE.KEYED
      1131**DCL      5611>>ASSIGN   5637>>IF       6166>>IF
FILE.TYPE
      1127**DCL      5602>>IF       5602>>IF       5604>>IF
FILE.UNPROTECT
      1136**DCL      6157>>IF
FLUSH
      5650**LABEL    5603--GOTO     5605--GOTO     5686--GOTO
FPT$CLOSE
      3849**DCL      5677<>CALL     6129<>CALL
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:180  
FPT$CLOSE.SN_
      3849**DCL      3849--REDEF
FPT$CLOSE.UTL_
      3850**DCL      3850--REDEF
FPT$CLOSE.V.DCB#
      3855**DCL      5675<<ASSIGN   6128<<ASSIGN
FPT$CLOSE.V.DISP#
      3858**DCL      5676<<ASSIGN
FPT$CLOSE.V.EXPIRE#
      3864**DCL      3864--REDEF
FPT$CLOSE.V.TYPE#
      3862**DCL      3862--REDEF
FPT$CLOSE.V.XTNSIZE#
      3859**DCL      3859--REDEF    3861--REDEF
FPT$DELI
      3499**DCL      6011<>CALL
FPT$DELI.KEY_
      3499**DCL      6009--ASSIGN
FPT$DELI.V.DCB#
      3503**DCL      6008<<ASSIGN
FPT$DELR
      3480**DCL      6108<>CALL
FPT$DELR.V.DCB#
      3484**DCL      6105<<ASSIGN
FPT$GETDCB
      4017**DCL      5587<>CALL
FPT$GETDCB.V.TEST#
      4019**DCL      5586<<ASSIGN
FPT$OPNDFLT.ACSVEH_
      3784**DCL      3785--REDEF
FPT$OPNDFLT.ALTKEYS_
      3790**DCL      3791--REDEF    3791--REDEF
FPT$OPNDFLT.HDR_
      3789**DCL      3790--REDEF
FPT$OPNDFLT.SN_
      3782**DCL      5622<<ASSIGN   5626<<ASSIGN   5629<<ASSIGN
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:181  
FPT$OPNDFLT.TAB_
      3788**DCL      3789--REDEF
FPT$OPNDFLT.UHL_
      3782**DCL      3783--REDEF    3783--REDEF
FPT$OPNDFLT.V.FSN#
      3822**DCL      3822--REDEF    3822--REDEF
FPT$OPNDFLT.WSN_
      3788**DCL      3788--REDEF
FPT$OPNSCRB
      3948**DCL      5595<>CALL
FPT$OPNSCRB.ACSVEH_
      3950**DCL      3951--REDEF
FPT$OPNSCRB.ALTKEYS_
      3956**DCL      3957--REDEF    3957--REDEF
FPT$OPNSCRB.HDR_
      3955**DCL      3956--REDEF
FPT$OPNSCRB.TAB_
      3954**DCL      3955--REDEF
FPT$OPNSCRB.UHL_
      3948**DCL      3949--REDEF    3949--REDEF
FPT$OPNSCRB.V.ACS#
      3968**DCL      5593<<ASSIGN
FPT$OPNSCRB.V.DCB#
      3957**DCL      5591<<ASSIGN
FPT$OPNSCRB.V.FSN#
      3988**DCL      3988--REDEF    3988--REDEF
FPT$OPNSCRB.V.FUN#
      3967**DCL      5592<<ASSIGN
FPT$OPNSCRB.WSN_
      3954**DCL      3954--REDEF
FPT$PFIL
      3465**DCL      5713<>CALL
FPT$PFIL.V.BOF#
      3466**DCL      5712<<ASSIGN
FPT$PFIL.V.DCB#
      3465**DCL      5711<<ASSIGN
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:182  
FPT$PRECI
      3444**DCL      6007<>CALL
FPT$PRECI.KEY_
      3444**DCL      6005--ASSIGN
FPT$PRECI.V.DCB#
      3446**DCL      6002<<ASSIGN
FPT$PRECI.V.INDX#
      3449**DCL      6003<<ASSIGN
FPT$PRECI.V.N#
      3450**DCL      6004<<ASSIGN
FPT$PRECJ
      3423**DCL      5723<>CALL
FPT$PRECJ.V.DCB#
      3425**DCL      5714<<ASSIGN
FPT$PRECJ.V.N#
      3429**DCL      5715<<ASSIGN   5765<<ASSIGN
FPT$READJ
      3524**DCL      5601<>CALL     5724<>CALL
FPT$READJ.STATION_
      3527**DCL      3528--REDEF
FPT$READJ.V.DCB#
      3528**DCL      5597<<ASSIGN   5716<<ASSIGN
FPT$READJ.V.DVBYTE.REREAD#
      3539**DCL      3539--REDEF
FPT$READJ.V.INDX#
      3537**DCL      3537--REDEF
FPT$REOPEN
      3673**DCL      6131<>CALL
FPT$REOPEN.ACSVEH_
      3675**DCL      3676--REDEF
FPT$REOPEN.ALTKEYS_
      3681**DCL      3682--REDEF    3682--REDEF
FPT$REOPEN.HDR_
      3680**DCL      3681--REDEF
FPT$REOPEN.TAB_
      3679**DCL      3680--REDEF
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:183  
FPT$REOPEN.UHL_
      3673**DCL      3674--REDEF    3674--REDEF
FPT$REOPEN.V.DCB#
      3682**DCL      6130<<ASSIGN
FPT$REOPEN.V.FSN#
      3713**DCL      3713--REDEF    3713--REDEF
FPT$REOPEN.WSN_
      3679**DCL      3679--REDEF
FPT$TIME
      4032**DCL      5578<>CALL
FPT$WRTI
      3594**DCL      6032<>CALL     6053<>CALL
FPT$WRTI.BUF_.BOUND
      3594**DCL      6031<<ASSIGN   6052<<ASSIGN
FPT$WRTI.BUF_.BUF$
      3596**DCL      6030<<ASSIGN   6051<<ASSIGN
FPT$WRTI.STATION_
      3596**DCL      3596--REDEF
FPT$WRTI.V.DCB#
      3597**DCL      6028<<ASSIGN   6049<<ASSIGN
FPT$WRTI.V.DVBYTE.VFC#
      3603**DCL      3603--REDEF
FPT$WRTI.V.ONEWKEY#
      3599**DCL      6029<<ASSIGN   6050<<ASSIGN
FPT$WRTK
      3563**DCL      6123<>CALL
FPT$WRTK.STATION_
      3565**DCL      3565--REDEF
FPT$WRTK.V.DCB#
      3566**DCL      6120<<ASSIGN
FPT$WRTK.V.DVBYTE.VFC#
      3572**DCL      3572--REDEF
GLOBAL.ACCT
       772**DCL      5588<<ASSIGN   5617<<ASSIGN
GLOBAL.ACTIVE.DBCB$
       555**DCL       556--REDEF
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:184  
GLOBAL.ACTIVE.SSS$
       551**DCL       552--REDEF
GLOBAL.CLOSE$
       810**DCL      5675>>ASSIGN   5676>>ASSIGN   5677>>CALL     6128>>ASSIGN   6129>>CALL
GLOBAL.DB.DBCB$
       649**DCL      6202>>ASSIGN
GLOBAL.DB.SSS$
       648**DCL      6196>>IF       6198>>ASSIGN
GLOBAL.DCBNAME.LENGTH
       770**DCL      5584<<ASSIGN   5615<<ASSIGN
GLOBAL.DCBNAME.TEXT
       771**DCL      5585<<ASSIGN   5616<<ASSIGN
GLOBAL.DCBNUMBER
       758**DCL      5591>>ASSIGN   5596>>ASSIGN   5597>>ASSIGN   5695>>ASSIGN
GLOBAL.DELI$
       842**DCL      6008>>ASSIGN   6009>>ASSIGN   6011>>CALL
GLOBAL.DELR$
       817**DCL      6105>>ASSIGN   6108>>CALL
GLOBAL.FCN.CODE
       564**DCL      5720>>IF
GLOBAL.FILENAME.LENGTH
       767**DCL      5589<<ASSIGN   5618<<ASSIGN
GLOBAL.FILENAME.TEXT
       768**DCL      5590<<ASSIGN   5619<<ASSIGN
GLOBAL.GETDCB$
       820**DCL      5586>>ASSIGN   5587>>CALL
GLOBAL.JRECORD
       754**DCL      5598--ASSIGN   5717--ASSIGN
GLOBAL.KEY
       759**DCL       762--REDEF
GLOBAL.KEY.LENGTH
       760**DCL      6000<<ASSIGN   6106<<ASSIGN   6121<<ASSIGN
GLOBAL.KEY.VALUE
       761**DCL      6001<<ASSIGN   6107<<ASSIGN   6122<<ASSIGN
GLOBAL.OPNDFLT$
       807**DCL      5622>>ASSIGN   5626>>ASSIGN   5629>>ASSIGN
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:185  
GLOBAL.OPNSCRB$
       808**DCL      5591>>ASSIGN   5592>>ASSIGN   5593>>ASSIGN   5595>>CALL
GLOBAL.PARAN.ICKSM.P$
       602**DCL      6070<<ASSIGN   6076<<ASSIGN
GLOBAL.PARAN.ICKSM.V
       603**DCL      6073>>IF       6078>>ASSIGN
GLOBAL.PARAN.IO.AWS$
       598**DCL      5623<<ASSIGN   5671<<ASSIGN   6179<<ASSIGN
GLOBAL.PARAN.IO.BUF$
       600**DCL      5635>>ASSIGN   6181>>ASSIGN
GLOBAL.PARAN.IO.PGNO
       599**DCL      5633<<ASSIGN   6178<<ASSIGN
GLOBAL.PARAN.TRACE.MODE
       634**DCL       641--REDEF
GLOBAL.PENDING.FORGET
       593**DCL      5650<<ASSIGN   5653<<ASSIGN
GLOBAL.PENDING.RECVRY
       587**DCL      5582>>IF       5655>>IF
GLOBAL.PENDING.ROLL
       590**DCL      5577<<ASSIGN   5657<<ASSIGN   5681<<ASSIGN
GLOBAL.PENDING.ROLL_ABORTED
       594**DCL      5731>>IF       5734>>IF       5737>>IF       5740>>IF       5743>>IF       5746>>IF
      5749>>IF       5752>>IF       5755>>IF       5758>>IF       6157>>IF
GLOBAL.PENDING.XCON
       588**DCL      5660>>IF
GLOBAL.PFIL$
       828**DCL      5711>>ASSIGN   5712>>ASSIGN   5713>>CALL
GLOBAL.PRECI$
       841**DCL      6002>>ASSIGN   6003>>ASSIGN   6004>>ASSIGN   6005>>ASSIGN   6007>>CALL
GLOBAL.PRECJ$
       836**DCL      5714>>ASSIGN   5715>>ASSIGN   5723>>CALL     5765>>ASSIGN
GLOBAL.PRINTBUF.BUFFER
       793**DCL       794--REDEF     795--REDEF     796--REDEF
GLOBAL.PRINTBUF.ERR.V
       798**DCL       801--REDEF     802--REDEF     803--REDEF
GLOBAL.READJ$
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:186  
       830**DCL      5597>>ASSIGN   5601>>CALL     5716>>ASSIGN   5724>>CALL
GLOBAL.REOPEN$
       809**DCL      6130>>ASSIGN   6131>>CALL
GLOBAL.RET.DCB#
       575**DCL      5695<<ASSIGN   5773<<ASSIGN   5778<<ASSIGN   5783<<ASSIGN   6019<<ASSIGN   6040<<ASSIGN
      6061<<ASSIGN   6137<<ASSIGN   6142<<ASSIGN   6147<<ASSIGN
GLOBAL.RET.ERROR#
       569**DCL      5679<<ASSIGN   5683<<ASSIGN   5701<<ASSIGN
GLOBAL.RET.STCD#
       576**DCL      5680<<ASSIGN   5702<<ASSIGN
GLOBAL.RET.SYSERR#
       570**DCL      5689<<ASSIGN   5693<<ASSIGN   5698<<ASSIGN   5772<<ASSIGN   5777<<ASSIGN   5782<<ASSIGN
      6018<<ASSIGN   6039<<ASSIGN   6060<<ASSIGN   6136<<ASSIGN   6141<<ASSIGN   6146<<ASSIGN
GLOBAL.ROLLADDR
       746**DCL      5660>>IF       5662>>ASSIGN
GLOBAL.STATS.CURR.READS
       709**DCL      6012<<ASSIGN   6012>>ASSIGN   6033<<ASSIGN   6033>>ASSIGN   6054<<ASSIGN   6054>>ASSIGN
      6124<<ASSIGN   6124>>ASSIGN
GLOBAL.STATS.CURR.WRITES
       710**DCL      6013<<ASSIGN   6013>>ASSIGN   6034<<ASSIGN   6034>>ASSIGN   6055<<ASSIGN   6055>>ASSIGN
      6109<<ASSIGN   6109>>ASSIGN   6125<<ASSIGN   6125>>ASSIGN
GLOBAL.TIME.TSTAMP
       782**DCL      5640>>ASSIGN   6168>>ASSIGN
GLOBAL.TIME$
       831**DCL      5578>>CALL
GLOBAL.TJRNL.DCB#
       738**DCL      5596<<ASSIGN   5647>>IF       5675>>ASSIGN   5711>>ASSIGN   5714>>ASSIGN   5716>>ASSIGN
      5773>>ASSIGN   5778>>ASSIGN   5783>>ASSIGN
GLOBAL.TJRNL.UNCHECK
       740**DCL      6162<<ASSIGN
GLOBAL.WRTI$
       814**DCL      6028>>ASSIGN   6029>>ASSIGN   6030>>ASSIGN   6031>>ASSIGN   6032>>CALL     6049>>ASSIGN
      6050>>ASSIGN   6051>>ASSIGN   6052>>ASSIGN   6053>>CALL
GLOBAL.WRTK$
       816**DCL      6120>>ASSIGN   6123>>CALL
GLOBAL$
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:187  
       853**DCL       549--IMP-PTR  5577>>ASSIGN   5578>>CALL     5582>>IF       5584>>ASSIGN   5585>>ASSIGN
      5586>>ASSIGN   5587>>CALL     5588>>ASSIGN   5589>>ASSIGN   5590>>ASSIGN   5591>>ASSIGN   5591>>ASSIGN
      5592>>ASSIGN   5593>>ASSIGN   5595>>CALL     5596>>ASSIGN   5596>>ASSIGN   5597>>ASSIGN   5597>>ASSIGN
      5598>>ASSIGN   5601>>CALL     5615>>ASSIGN   5616>>ASSIGN   5617>>ASSIGN   5618>>ASSIGN   5619>>ASSIGN
      5622>>ASSIGN   5623>>ASSIGN   5626>>ASSIGN   5629>>ASSIGN   5633>>ASSIGN   5635>>ASSIGN   5640>>ASSIGN
      5647>>IF       5650>>ASSIGN   5653>>ASSIGN   5655>>IF       5657>>ASSIGN   5660>>IF       5660>>IF
      5662>>ASSIGN   5671>>ASSIGN   5675>>ASSIGN   5675>>ASSIGN   5676>>ASSIGN   5677>>CALL     5679>>ASSIGN
      5680>>ASSIGN   5681>>ASSIGN   5683>>ASSIGN   5689>>ASSIGN   5693>>ASSIGN   5695>>ASSIGN   5695>>ASSIGN
      5698>>ASSIGN   5701>>ASSIGN   5702>>ASSIGN   5711>>ASSIGN   5711>>ASSIGN   5712>>ASSIGN   5713>>CALL
      5714>>ASSIGN   5714>>ASSIGN   5715>>ASSIGN   5716>>ASSIGN   5716>>ASSIGN   5717>>ASSIGN   5720>>IF
      5723>>CALL     5724>>CALL     5731>>IF       5734>>IF       5737>>IF       5740>>IF       5743>>IF
      5746>>IF       5749>>IF       5752>>IF       5755>>IF       5758>>IF       5765>>ASSIGN   5772>>ASSIGN
      5773>>ASSIGN   5773>>ASSIGN   5777>>ASSIGN   5778>>ASSIGN   5778>>ASSIGN   5782>>ASSIGN   5783>>ASSIGN
      5783>>ASSIGN   6000>>ASSIGN   6001>>ASSIGN   6002>>ASSIGN   6003>>ASSIGN   6004>>ASSIGN   6005>>ASSIGN
      6007>>CALL     6008>>ASSIGN   6009>>ASSIGN   6011>>CALL     6012>>ASSIGN   6012>>ASSIGN   6013>>ASSIGN
      6013>>ASSIGN   6018>>ASSIGN   6019>>ASSIGN   6028>>ASSIGN   6029>>ASSIGN   6030>>ASSIGN   6031>>ASSIGN
      6032>>CALL     6033>>ASSIGN   6033>>ASSIGN   6034>>ASSIGN   6034>>ASSIGN   6039>>ASSIGN   6040>>ASSIGN
      6049>>ASSIGN   6050>>ASSIGN   6051>>ASSIGN   6052>>ASSIGN   6053>>CALL     6054>>ASSIGN   6054>>ASSIGN
      6055>>ASSIGN   6055>>ASSIGN   6060>>ASSIGN   6061>>ASSIGN   6070>>ASSIGN   6073>>IF       6076>>ASSIGN
      6078>>ASSIGN   6105>>ASSIGN   6106>>ASSIGN   6107>>ASSIGN   6108>>CALL     6109>>ASSIGN   6109>>ASSIGN
      6120>>ASSIGN   6121>>ASSIGN   6122>>ASSIGN   6123>>CALL     6124>>ASSIGN   6124>>ASSIGN   6125>>ASSIGN
      6125>>ASSIGN   6128>>ASSIGN   6129>>CALL     6130>>ASSIGN   6131>>CALL     6136>>ASSIGN   6137>>ASSIGN
      6141>>ASSIGN   6142>>ASSIGN   6146>>ASSIGN   6147>>ASSIGN   6157>>IF       6162>>ASSIGN   6168>>ASSIGN
      6178>>ASSIGN   6179>>ASSIGN   6181>>ASSIGN   6196>>IF       6198>>ASSIGN   6202>>ASSIGN
I
        29**DCL      5579<<DOINDEX  5580>>ASSIGN   5668<<DOINDEX  5669>>IF       5671>>ASSIGN   5814<<ASSIGN
      5815>>IF       5815>>IF       5818>>ASSIGN   5823>>DOWHILE  5823>>DOWHILE  5825>>IF       5827<<ASSIGN
      5827>>ASSIGN   5830>>ASSIGN   5831>>ASSIGN   5850>>IF       5851>>ASSIGN   5852>>ASSIGN   5853>>DOWHILE
      5858<<ASSIGN   5858>>ASSIGN   5895<<ASSIGN   5908<<ASSIGN   5910>>DOWHILE  5911>>ASSIGN   5912>>IF
      5914<<ASSIGN   5914>>ASSIGN   5918>>ASSIGN   5920>>ASSIGN   5921>>ASSIGN   5924>>IF       5951<<ASSIGN
      5962<<DOINDEX  5963>>IF       5963>>IF       5965>>ASSIGN   5965>>ASSIGN   5981<<DOINDEX  5982>>IF
      5982>>IF       5984>>ASSIGN   5984>>ASSIGN   6195<<DOINDEX  6196>>IF       6198>>ASSIGN   6202>>ASSIGN
I$ROL
        51**DCL      5720--IF
IA.ROLLFLAG
      2754**DCL      5663<<ASSIGN
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:188  
IA.SNAME
      2767**DCL      2768--REDEF
IA.SSDT
      2779**DCL      2780--REDEF
IA.SSNAME
      2770**DCL      2771--REDEF
IA.UCALL_LOC
      2755**DCL      5662<<ASSIGN
IA$
      2781**DCL      2746--IMP-PTR  5662>>ASSIGN   5663>>ASSIGN
IS$
        54**DCL      5720>>IF
I_O_BUF.HW
         9**DCL        10--REDEF    5796>>IF       5796>>IF       5796>>IF       5804>>ASSIGN   5804>>ASSIGN
      5809<<ASSIGN   5809>>ASSIGN   5814>>ASSIGN   5815>>IF       5818<<ASSIGN   5819<<ASSIGN   5823>>DOWHILE
      5823>>DOWHILE  5825>>IF       5827>>ASSIGN   5830<<ASSIGN   5830>>ASSIGN   5831<<ASSIGN   5849>>ASSIGN
      5851<<ASSIGN   5852<<ASSIGN   5852>>ASSIGN   5854>>IF       5855<<ASSIGN   5861>>IF       5861>>IF
      5862<<ASSIGN   5865>>DOWHILE  5870<<ASSIGN   5883>>IF       5893>>IF       5895>>ASSIGN   5900>>ASSIGN
      5900>>ASSIGN   5908>>ASSIGN   5912>>IF       5914>>ASSIGN   5918<<ASSIGN   5918>>ASSIGN   5920<<ASSIGN
      5920>>ASSIGN   5921<<ASSIGN   5922<<ASSIGN   5922>>ASSIGN   5923>>DOINDEX  5924>>IF       5924>>IF
      5926<<ASSIGN   5926>>ASSIGN   5942>>IF       5949>>IF       5958>>ASSIGN   5958>>ASSIGN   5961<<ASSIGN
      5961>>ASSIGN   5962>>DOINDEX  5963>>IF       5963>>IF       5965<<ASSIGN   5965>>ASSIGN   5971>>ASSIGN
      5971>>ASSIGN   5980<<ASSIGN   5980>>ASSIGN   5981>>DOINDEX  5982>>IF       5982>>IF       5984<<ASSIGN
      5984>>ASSIGN
I_O_BUF.WD
        10**DCL      5793>>IF       5881>>IF       5940>>IF       6069>>IF       6078<<ASSIGN   6092>>IF
I_O_BUF$
        57**DCL         8--IMP-PTR  5635<<ASSIGN   5636>>ASSIGN   5638>>ASSIGN   5639>>ASSIGN   5640>>ASSIGN
      5793>>IF       5796>>IF       5796>>IF       5796>>IF       5801>>ASSIGN   5804>>ASSIGN   5804>>ASSIGN
      5809>>ASSIGN   5809>>ASSIGN   5814>>ASSIGN   5815>>IF       5818>>ASSIGN   5819>>ASSIGN   5823>>DOWHILE
      5823>>DOWHILE  5825>>IF       5827>>ASSIGN   5830>>ASSIGN   5830>>ASSIGN   5831>>ASSIGN   5849>>ASSIGN
      5851>>ASSIGN   5852>>ASSIGN   5852>>ASSIGN   5854>>IF       5855>>ASSIGN   5861>>IF       5861>>IF
      5862>>ASSIGN   5865>>DOWHILE  5870>>ASSIGN   5881>>IF       5883>>IF       5886>>ASSIGN   5893>>IF
      5895>>ASSIGN   5900>>ASSIGN   5900>>ASSIGN   5908>>ASSIGN   5912>>IF       5914>>ASSIGN   5918>>ASSIGN
      5918>>ASSIGN   5920>>ASSIGN   5920>>ASSIGN   5921>>ASSIGN   5922>>ASSIGN   5922>>ASSIGN   5923>>DOINDEX
      5924>>IF       5924>>IF       5926>>ASSIGN   5926>>ASSIGN   5940>>IF       5942>>IF       5945>>ASSIGN
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:189  
      5949>>IF       5958>>ASSIGN   5958>>ASSIGN   5961>>ASSIGN   5961>>ASSIGN   5962>>DOINDEX  5963>>IF
      5963>>IF       5965>>ASSIGN   5965>>ASSIGN   5971>>ASSIGN   5971>>ASSIGN   5980>>ASSIGN   5980>>ASSIGN
      5981>>DOINDEX  5982>>IF       5982>>IF       5984>>ASSIGN   5984>>ASSIGN   6069>>IF       6070>>ASSIGN
      6076>>ASSIGN   6078>>ASSIGN   6092>>IF       6093>>ASSIGN   6165>>ASSIGN   6167>>ASSIGN   6168>>ASSIGN
      6169>>ASSIGN   6170>>ASSIGN   6181<<ASSIGN
J
        32**DCL      5599<<ASSIGN   5607>>ASSIGN   5643<<ASSIGN   5643>>ASSIGN   5849<<ASSIGN   5850>>IF
      5851>>ASSIGN   5854>>IF       5855>>ASSIGN   5859<<ASSIGN   5859>>ASSIGN   5865>>DOWHILE  5866>>IF
      5868<<ASSIGN   5868>>ASSIGN   5870>>ASSIGN   5909<<ASSIGN   5911<<ASSIGN   5917>>IF       5920>>ASSIGN
      5923<<DOINDEX  5924>>IF       5924>>IF       5924>>IF       5926>>ASSIGN   5926>>ASSIGN   5948<<ASSIGN
      5949>>IF       5951>>ASSIGN   5953<<ASSIGN   5957>>ASSIGN   5961>>ASSIGN   5965>>ASSIGN   5973<<ASSIGN
      5976>>ASSIGN   5977>>ASSIGN   5978>>ASSIGN   5980>>ASSIGN   5984>>ASSIGN
JREC.DCB#
      1149**DCL      6190>>IF       6192>>ASSIGN   6203>>IF       6205>>ASSIGN
JREC.LENGTH
      1151**DCL      1154--IMP-SIZ  5800>>ASSIGN   5802>>IF       5887>>ASSIGN   5898>>ASSIGN   5899>>ASSIGN
      5904>>ASSIGN   5905>>ASSIGN   5922>>ASSIGN   5926>>ASSIGN   5946>>IF       5948>>ASSIGN   5953>>ASSIGN
      5969>>IF       5973>>ASSIGN   5987>>ASSIGN   5988>>ASSIGN   6000>>ASSIGN   6001>>ASSIGN   6005>>ASSIGN
      6009>>ASSIGN   6031>>ASSIGN   6052>>ASSIGN   6094>>ASSIGN   6095>>IF       6096>>ASSIGN   6106>>ASSIGN
      6107>>ASSIGN   6121>>ASSIGN   6122>>ASSIGN
JREC.LINE
      1152**DCL      5796>>IF       5796>>IF       5796>>IF       5815>>IF       5818>>ASSIGN   5819>>ASSIGN
      5823>>DOWHILE  5830>>ASSIGN   5831>>ASSIGN   5883>>IF       5910>>DOWHILE  5942>>IF
JREC.OFFSET
      1153**DCL      5796>>IF       5801>>ASSIGN   5806>>IF       5886>>ASSIGN   5902>>ASSIGN   5921>>ASSIGN
      5924>>IF       5942>>IF       5945>>ASSIGN   5959>>ASSIGN   5963>>IF       5972>>ASSIGN   5982>>IF
      6093>>ASSIGN
JREC.PAGE
      1150**DCL      6163<<ASSIGN   6178>>ASSIGN
JREC.TIME
      1146**DCL      5793>>IF       5881>>IF       5940>>IF       6069>>IF       6092>>IF
JREC.TYPE
      1147**DCL      5729>>DOCASE
JREC.VALUE
      1154**DCL      5802>>IF       5905>>ASSIGN   5988>>ASSIGN   6001>>ASSIGN   6030--ASSIGN   6051--ASSIGN
      6095>>IF       6096>>ASSIGN   6107>>ASSIGN   6122>>ASSIGN
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:190  
JRNL$
      1124**DCL      1125--IMP-PTR  1145--IMP-PTR  1155--IMP-PTR  1162--IMP-PTR  1168--IMP-PTR  5598<<ASSIGN
      5602>>IF       5602>>IF       5604>>IF       5607>>ASSIGN   5608>>ASSIGN   5609>>ASSIGN   5611>>ASSIGN
      5613>>ASSIGN   5614>>ASSIGN   5615>>ASSIGN   5616>>ASSIGN   5617>>ASSIGN   5618>>ASSIGN   5619>>ASSIGN
      5621>>ASSIGN   5631>>IF       5631>>IF       5637>>IF       5717<<ASSIGN   5729>>DOCASE   5793>>IF
      5796>>IF       5796>>IF       5796>>IF       5796>>IF       5800>>ASSIGN   5801>>ASSIGN   5802>>IF
      5802>>IF       5806>>IF       5815>>IF       5818>>ASSIGN   5819>>ASSIGN   5823>>DOWHILE  5830>>ASSIGN
      5831>>ASSIGN   5881>>IF       5883>>IF       5886>>ASSIGN   5887>>ASSIGN   5898>>ASSIGN   5899>>ASSIGN
      5902>>ASSIGN   5904>>ASSIGN   5905>>ASSIGN   5905>>ASSIGN   5910>>DOWHILE  5921>>ASSIGN   5922>>ASSIGN
      5924>>IF       5926>>ASSIGN   5940>>IF       5942>>IF       5942>>IF       5945>>ASSIGN   5946>>IF
      5948>>ASSIGN   5953>>ASSIGN   5959>>ASSIGN   5963>>IF       5969>>IF       5972>>ASSIGN   5973>>ASSIGN
      5982>>IF       5987>>ASSIGN   5988>>ASSIGN   5988>>ASSIGN   6000>>ASSIGN   6001>>ASSIGN   6001>>ASSIGN
      6005>>ASSIGN   6009>>ASSIGN   6030>>ASSIGN   6031>>ASSIGN   6051>>ASSIGN   6052>>ASSIGN   6069>>IF
      6073>>IF       6092>>IF       6093>>ASSIGN   6094>>ASSIGN   6095>>IF       6095>>IF       6096>>ASSIGN
      6096>>ASSIGN   6106>>ASSIGN   6107>>ASSIGN   6107>>ASSIGN   6121>>ASSIGN   6122>>ASSIGN   6122>>ASSIGN
      6157>>IF       6163>>ASSIGN   6166>>IF       6178>>ASSIGN   6190>>IF       6192>>ASSIGN   6203>>IF
      6205>>ASSIGN
LAST_OFF
        31**DCL      5804<<ASSIGN   5806>>IF       5900<<ASSIGN   5902>>ASSIGN   5958<<ASSIGN   5959>>ASSIGN
      5971<<ASSIGN   5972>>ASSIGN
M$CLOSE
      2800**DCL-ENT  5677--CALL     6129--CALL
M$DELREC
      2802**DCL-ENT  6011--CALL     6108--CALL
M$GETDCB
      2806**DCL-ENT  5587--CALL
M$OPEN
      2800**DCL-ENT  5595--CALL     6131--CALL
M$PFIL
      2802**DCL-ENT  5713--CALL
M$PRECORD
      2804**DCL-ENT  5723--CALL     6007--CALL
M$READ
      2801**DCL-ENT  5601--CALL     5724--CALL
M$TIME
      2867**DCL-ENT  5578--CALL
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:191  
M$WRITE
      2801**DCL-ENT  6032--CALL     6053--CALL     6123--CALL
MREC
        17**DCL      5811<<ASSIGN   5979<<ASSIGN
MREC.VAL
        18**DCL      5905<<ASSIGN   5976<<ASSIGN   5976>>ASSIGN   5988<<ASSIGN   6095>>IF       6096<<ASSIGN
MREC$
        59**DCL        17--IMP-PTR  5899<<ASSIGN   5903<>CALL     5956<<ASSIGN   5957>>ASSIGN   5960<>CALL
      5974<<ASSIGN   5976>>ASSIGN   5976>>ASSIGN   5977<<ASSIGN   5977>>ASSIGN   5979>>ASSIGN
MREC_SIZ
        16**DCL        18--IMP-SIZ  5810<<ASSIGN   5811>>ASSIGN   5902<<ASSIGN   5903<>CALL     5904<<ASSIGN
      5905>>ASSIGN   5959<<ASSIGN   5960<>CALL     5972<<ASSIGN   5976>>ASSIGN   5976>>ASSIGN   5977>>ASSIGN
      5978<<ASSIGN   5979>>ASSIGN   5987<<ASSIGN   5988>>ASSIGN   6094<<ASSIGN   6095>>IF       6096>>ASSIGN
OA.SCNAM.EIS.COUNT
      2462**DCL      2497--IMP-SIZ
OA$
      2440**DCL      2441--IMP-PTR
OA1
      2432**DCL      6199--ASSIGN
OA1$
      2431**DCL      2432--IMP-PTR
PARTIAL
        35**DCL      5721<<ASSIGN   5764<<ASSIGN   6015>>IF       6036>>IF       6057>>IF
REC.LEN
        14**DCL      5806>>IF       5809>>ASSIGN   5810>>ASSIGN   5946>>IF       5948>>ASSIGN   5953>>ASSIGN
      5956>>ASSIGN   5959>>ASSIGN   5969>>IF       5972>>ASSIGN   5973>>ASSIGN   5974>>ASSIGN
REC$
        58**DCL        11--IMP-PTR    26--IMP-PTR  5801<<ASSIGN   5802>>IF       5806>>IF       5809>>ASSIGN
      5810>>ASSIGN   5811>>ASSIGN   5886<<ASSIGN   5899>>ASSIGN   5903<>CALL     5905>>ASSIGN   5945<<ASSIGN
      5946>>IF       5948>>ASSIGN   5953>>ASSIGN   5956>>ASSIGN   5956>>ASSIGN   5959>>ASSIGN   5969>>IF
      5972>>ASSIGN   5973>>ASSIGN   5974>>ASSIGN   5974>>ASSIGN   5988>>ASSIGN   6093<<ASSIGN   6095>>IF
      6096>>ASSIGN
REC_RD
        26**DCL      5802>>IF
REC_RD_SIZ
        28**DCL        26--IMP-SIZ  5800<<ASSIGN   5802>>IF       5887<<ASSIGN   5893>>IF       5895>>ASSIGN
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:192  
REC_SIZ
        25**DCL        15--IMP-SIZ  5898<<ASSIGN
RET
      5681**LABEL    5684--GOTO
RET IN PROCEDURE ZIM$DEL
      5929**LABEL    5879--GOTO     5882--GOTO
RET IN PROCEDURE ZIM$FID
      6172**LABEL    6159--GOTO
RET IN PROCEDURE ZIM$MOD
      5990**LABEL    5938--GOTO     5941--GOTO
RET IN PROCEDURE ZIM$MSET
      6099**LABEL    6092--GOTO     6095--GOTO
RET IN PROCEDURE ZIM$PPROL
      5767**LABEL    5770--GOTO
RET IN PROCEDURE ZIM$RIDEL
      6035**LABEL    6027--GOTO     6037--GOTO
RET IN PROCEDURE ZIM$RIMOD
      6056**LABEL    6048--GOTO     6058--GOTO
RET IN PROCEDURE ZIM$RISTO
      6014**LABEL    5999--GOTO     6016--GOTO
RET IN PROCEDURE ZIM$STO
      5835**LABEL    5791--GOTO     5794--GOTO
RET IN PROCEDURE ZIM$SUM
      6081**LABEL    6069--GOTO
SSS$
      1887**DCL      6198<<ASSIGN   6199>>ASSIGN   6201>>ASSIGN
UPD_ARRAY IN PROCEDURE ZIM$PPROL
      5847**PROC     5896--CALL     5952--CALL
VLP$VECTOR.W1.VSIZE#
      3879**DCL      6005<<ASSIGN   6009<<ASSIGN
VLP$VECTOR.W2
      3880**DCL      3881--REDEF
VLP_SN
      4108**DCL      5622--ASSIGN
VLP_SN.NUM#
      4108**DCL      5620<<ASSIGN
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:193  
VLP_SN.SN#
      4108**DCL      5621<<ASSIGN
ZIM$CK_AWS IN PROCEDURE ZIM$PPROL
      6189**PROC     5790--CALL     5877--CALL     5937--CALL     5997--CALL     6025--CALL     6046--CALL
      6067--CALL     6089--CALL     6104--CALL     6118--CALL     6160--CALL
ZIM$DEL IN PROCEDURE ZIM$PPROL
      5875**PROC     5735--CALL
ZIM$FID IN PROCEDURE ZIM$PPROL
      6155**PROC     5762--CALL
ZIM$ICKSM
        41**DCL-ENT  6077--CALL
ZIM$ICKSMJ
        42**DCL-ENT  6071--CALL
ZIM$JROLL
        44**DCL-ENT  5658--CALL
ZIM$KEYDEL IN PROCEDURE ZIM$PPROL
      6117**PROC     5747--CALL
ZIM$KEYSTO IN PROCEDURE ZIM$PPROL
      6103**PROC     5744--CALL
ZIM$MOD IN PROCEDURE ZIM$PPROL
      5935**PROC     5738--CALL
ZIM$MRL_SHIFT
        48**DCL-ENT  5903--CALL     5960--CALL
ZIM$MSET IN PROCEDURE ZIM$PPROL
      6088**PROC     5750--CALL
ZIM$NULL
        45**DCL-ENT  5659--CALL
ZIM$OPEN
        39**DCL-ENT  5624--CALL
ZIM$PPROL
      5707**PROC     5652--CALL
ZIM$READ_PG IN PROCEDURE ZIM$PPROL
      6177**PROC     5792--CALL     5880--CALL     5939--CALL     6068--CALL     6091--CALL     6164--CALL
ZIM$RIDEL IN PROCEDURE ZIM$PPROL
      6024**PROC     5756--CALL
ZIM$RIMOD IN PROCEDURE ZIM$PPROL
PL6.E3A0      #004=ZIM$PROL File=ZIM$CKROL.:ZIC0TSI                              FRI 09/05/97 12:36 Page:194  
      6045**PROC     5759--CALL
ZIM$RISTO IN PROCEDURE ZIM$PPROL
      5996**PROC     5753--CALL
ZIM$STO IN PROCEDURE ZIM$PPROL
      5788**PROC     5732--CALL
ZIM$SUM IN PROCEDURE ZIM$PPROL
      6066**PROC     5741--CALL
ZIO$DBCLOSE
        38**DCL-ENT  5672--CALL
ZIO$DBREAD
        37**DCL-ENT  5634--CALL     6180--CALL
ZIO$FLUSH
        47**DCL-ENT  5651--CALL     5654--CALL
ZIO$GETSEG
        46**DCL-ENT  5606--CALL
ZIO$MODIFY
        40**DCL-ENT  5641--CALL     5834--CALL     5928--CALL     5989--CALL     6097--CALL     6171--CALL
ZI_TJNAME
        50**DCL      5590>>ASSIGN
