VERSION B06

PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:1    
        1        1        /*M* VMM$SUBR - VMM$COPY_MESSAGE, VMM$DELETE_MESSAGE, VMM$EDIT_MESSAGE_OUT, VMM$EDIT
                 1        _MESSAGE_IN */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMC,PLM=4,IND=4,CTI=2,DTI=0,ENI=0,ECI=0,CSI=0,DCI=4 */
        8        8        /*P*
        9        9             NAME: VMM$COPY_MESSAGE
       10       10             PURPOSE:
       11       11                  To support MOVE, COPY and MAILMAN in moving messages between folders.
       12       12             DESCRIPTION:
       13       13                  This routine has seven parameters:
       14       14
       15       15                     IN_NUM     - number of message to move in first folder.
       16       16                     OUT_NUM    - number of new message to create.
       17       17                     IN_DCB#    - open to folder to get message from.
       18       18                     OUT_DCB#   - open to folder to put message into.
       19       19                     INSEED     - seed used to encrypt input message (optional)
       20       20                     OUTSEED    - seed used to encrypt output message (optional)
       21       21
       22       22                  This routine will move a copy of the message in the folder
       23       23                  pointed to by IN_DCB# with a number of IN_NUM into the
       24       24                  folder pointed to by OUT_DCB#. The number of the new message
       25       25                  will be OUT_NUM.
       26       26
       27       27                  NOTE: This routine expects the header (VM_HEADER) to
       28       28                        already exist in the VM_HEADER$ data segment.
       29       29        */
       30       30        VMM$COPY_MESSAGE: PROC (IN_NUM,OUT_NUM,IN_DCB#,OUT_DCB#,INSEED,OUTSEED) ALTRET;
       31       31        /***** Include files *****/
       32       32         %INCLUDE CP_6;
       33     5591         %INCLUDE CP_6_SUBS;
       34     6131         %INCLUDE VM_MACRO_C;
       35     7399         %INCLUDE VM_SUBS_C;
       36     7659         %INCLUDE VM_DATA_R;
PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:2    
       37     8090        %INCLUDE B_ERRORS_C;
       38     9217
       39     9218        %B$TCB (STCLASS="BASED(B$TCB$)");
       40     9221        %B$ALT;
       41     9229
       42     9230        /***** Parameters *****/
       43     9231    1   DCL IN_NUM SBIN WORD;
       44     9232    1   DCL OUT_NUM SBIN WORD;
       45     9233    1   DCL IN_DCB# UBIN WORD;
       46     9234    1   DCL OUT_DCB# UBIN WORD;
       47     9235    1   DCL INSEED UBIN WORD;
       48     9236    1   DCL OUTSEED UBIN WORD;
       49     9237        /***** External routines *****/
       50     9238        /********** specials, will be dummies for mail ***********/
       51     9239        %FPT_READ (FPTN=VO_READ_CG, STCLASS=SYMREF );
       52     9278    1   DCL VO_NEED_READ BIT(1) SYMREF;
       53     9279    1   DCL VO_PROCESS BIT(1) SYMREF;
       54     9280    1   DCL VMA$GET_ADD_RECORD ENTRY(4) ALTRET;
       55     9281    1   DCL VMA$PUT_ADD_RECORD ENTRY(4) ALTRET;
       56     9282    1   DCL VOM$PROCESS ENTRY;
       57     9283    1   DCL VMD$PUT_HEADER ENTRY(2) ALTRET;
       58     9284    1   DCL VMD$GET_BODY ENTRY (9) ALTRET;
       59     9285    1   DCL VMD$PUT_BODY ENTRY (7) ALTRET;
       60     9286    1   DCL VMD$GET_TRACE ENTRY (7) ALTRET;
       61     9287    1   DCL VMD$PUT_TRACE ENTRY (7) ALTRET;
       62     9288    1   DCL VMD$GET_ENCL ENTRY (9) ALTRET;
       63     9289    1   DCL VMD$PUT_ENCL ENTRY (9) ALTRET;
       64     9290    1   DCL VMD$PUT_ID ENTRY (3) ALTRET;
       65     9291    1   DCL VMD$GET_SITE ENTRY (2) ALTRET;
       66     9292    1   DCL VMD$PUT_SITE ENTRY (2) ALTRET;
       67     9293        /***** Mail structures *****/
       68     9294         %VM_HEADER;
       69     9423         %VM_SITE;
       70     9447        %VM_ENCLOS (STCLASS="BASED(ENCL$)");
       71     9478        %VM_ADD_HEAD (NAME=VM_ENCL_HEAD,STCLASS="BASED(VM_ENCLLIST$)");
       72     9507        /***** Local variables *****/
       73     9508    1   DCL I SBIN WORD STATIC;
PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:3    
       74     9509    1   DCL J SBIN WORD STATIC;
       75     9510    1   DCL K SBIN WORD STATIC;
       76     9511    1   DCL COUNT SBIN WORD AUTO;
       77     9512    1   DCL DVBYTE BIT(8);
       78     9513    1   DCL TSEEDIN UBIN WORD;
       79     9514    1   DCL PAGESIZE SBIN WORD STATIC INIT(4096);
       80     9515    1   DCL ENCL_NUM SBIN WORD STATIC;
       81     9516    1   DCL ENCL$ PTR;
       82     9517          %VM_BODYTYPES;
       83     9523          %VM_KEYTYPES;
       84     9544          %VM_BODYREC (STCLASS=AUTO,VARYLEN=NO);
       85     9576        %VM_BODYREC (NAME=VM_ENCLREC,STCLASS="BASED(VM_ENCLREC$)",
       86     9577                     TYP=%VM_BODY_BINARY_ENCL,VARYLEN=YES);
       87     9609        %EJECT;
PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:4    
       88     9610
       89     9611    1       GOTO START_COPY;
       90     9612    1   VMM$COPY_MESSAGE_INTERSYS: ENTRY (IN_NUM,OUT_NUM,IN_DCB#,OUT_DCB#,INSEED,OUTSEED)
              9612            ALTRET;
       91     9613
       92     9614        /*
       93     9615             ***** If this is an intersystem message,
       94     9616                   copy the intersystem address records ...
       95     9617        */
       96     9618    1       CALL VMD$GET_SITE (VM_SITE,IN_DCB#) ALTRET(NO_SITE);
       97     9619    1       CALL VMD$PUT_SITE (VM_SITE,OUT_DCB#) ALTRET(NO_SITE);
       98     9620    1       CALL VMA$GET_ADD_RECORD (%VM_TYPE_ITO,VM_WORK_,IN_DCB#,IN_NUM) ALTRET(E_ITO);
       99     9621    1       CALL VMA$PUT_ADD_RECORD (%VM_TYPE_ITO,VM_WORK_,OUT_DCB#,OUT_NUM) ALTRET(E_TO);
      100     9622    1   E_ITO: ;
      101     9623    1       CALL VMA$GET_ADD_RECORD (%VM_TYPE_IC,VM_WORK_,IN_DCB#,IN_NUM) ALTRET(E_IC);
      102     9624    1       CALL VMA$PUT_ADD_RECORD (%VM_TYPE_IC,VM_WORK_,OUT_DCB#,OUT_NUM) ALTRET(E_IC);
      103     9625    1   E_IC: ;
      104     9626    1       CALL VMA$GET_ADD_RECORD (%VM_TYPE_IBC,VM_WORK_,IN_DCB#,IN_NUM) ALTRET(E_IBC);
      105     9627    1       CALL VMA$PUT_ADD_RECORD (%VM_TYPE_IBC,VM_WORK_,OUT_DCB#,OUT_NUM) ALTRET(E_IBC);
      106     9628    1   E_IBC: ;
      107     9629    1   NO_SITE: ;
      108     9630
      109     9631    1   START_COPY:
      110     9632
      111     9633        /* Make sure the comgroup gets read at least once here.  Mailman
      112     9634           does not read in his send mail loop, this will do it for him */
      113     9635    2       IF VO_NEED_READ THEN DO;
      114     9636    2           VO_NEED_READ = '0'B;
      115     9637    2           CALL M$READ (VO_READ_CG);
      116     9638    2       END;
      117     9639    1       IF VO_PROCESS THEN CALL VOM$PROCESS;
      118     9640        /*
      119     9641             ***** Move the address records ...
      120     9642        */
      121     9643    1       IF VM_HEADER.TO$ ~= ADDR(NIL)
      122     9644    1       THEN
      123     9645    2       DO;
PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:5    
      124     9646    2           CALL VMA$GET_ADD_RECORD (%VM_TYPE_TO,VM_WORK_,IN_DCB#,IN_NUM) ALTRET(E_TO);
      125     9647    2           CALL VMA$PUT_ADD_RECORD (%VM_TYPE_TO,VM_WORK_,OUT_DCB#,OUT_NUM) ALTRET(E_TO)
              9647                    ;
      126     9648    2   E_TO:   ;
      127     9649    2       END;
      128     9650
      129     9651    1       IF VM_HEADER.COPY$ ~= ADDR(NIL)
      130     9652    1       THEN
      131     9653    2       DO;
      132     9654    2           CALL VMA$GET_ADD_RECORD (%VM_TYPE_C,VM_WORK_,IN_DCB#,IN_NUM) ALTRET(E_COPY);
      133     9655    2           CALL VMA$PUT_ADD_RECORD (%VM_TYPE_C,VM_WORK_,OUT_DCB#,OUT_NUM) ALTRET(E_COPY
              9655                    );
      134     9656    2   E_COPY: ;
      135     9657    2       END;
      136     9658
      137     9659    1       IF VM_HEADER.BLIND$ ~= ADDR(NIL)
      138     9660    1       THEN
      139     9661    2       DO;
      140     9662    2           CALL VMA$GET_ADD_RECORD (%VM_TYPE_BC,VM_WORK_,IN_DCB#,IN_NUM) ALTRET(E_BLIND
              9662                    );
      141     9663    2           CALL VMA$PUT_ADD_RECORD (%VM_TYPE_BC,VM_WORK_,OUT_DCB#,OUT_NUM) ALTRET(
              9663                    E_BLIND);
      142     9664    2   E_BLIND: ;
      143     9665    2       END;
      144     9666
      145     9667    1       IF VM_HEADER.REPLY_TO$ ~= ADDR(NIL)
      146     9668    1       THEN
      147     9669    2       DO;
      148     9670    2           CALL VMA$GET_ADD_RECORD (%VM_TYPE_RTO,VM_WORK_,IN_DCB#,IN_NUM) ALTRET(
              9670                    E_REPLYTO);
      149     9671    2           CALL VMA$PUT_ADD_RECORD (%VM_TYPE_RTO,VM_WORK_,OUT_DCB#,OUT_NUM) ALTRET(
              9671                    E_REPLYTO);
      150     9672    2   E_REPLYTO: ;
      151     9673    2       END;
      152     9674
      153     9675    1       GOTO COPY_THE_BODY;
      154     9676
PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:6    
      155     9677    1   VMM$COPY_MESSAGE_BODY: ENTRY (IN_NUM,OUT_NUM,IN_DCB#,OUT_DCB#,INSEED,OUTSEED) ALTRET
              9677            ;
      156     9678
      157     9679    1   COPY_THE_BODY:
      158     9680
      159     9681        /*
      160     9682            ***** Move all body records ...
      161     9683        */
      162     9684    1       I = 0;
      163     9685    2       DO FOREVER;
      164     9686    2           VM_BODYREC.VALUE.COUNT = LENGTHC(VM_BODYREC.VALUE.DATA);
      165     9687    2           CALL VMD$GET_BODY (IN_NUM,IN_DCB#,I,COUNT,INSEED,
      166     9688    2             VM_BODYREC,DVBYTE) ALTRET(END_BODY);
      167     9689    2           CALL VMD$PUT_BODY (OUT_NUM,OUT_DCB#,I,COUNT,OUTSEED,
      168     9690    2             VM_BODYREC,DVBYTE) ALTRET(E_BODY);
      169     9691    2           I = I + 1;
      170     9692    3           IF VO_NEED_READ THEN DO;
      171     9693    3               VO_NEED_READ = '0'B;
      172     9694    3               CALL M$READ (VO_READ_CG);
      173     9695    3           END;
      174     9696    2           IF VO_PROCESS THEN CALL VOM$PROCESS;
      175     9697    2       END;
      176     9698    1   END_BODY:
      177     9699    1       VM_HEADER.NUM_RECORDS = I;
      178     9700        /*
      179     9701            ***** Move all the enclosure records *****
      180     9702        */
      181     9703
      182     9704    1       I = 0;
      183     9705    2       IF VM_HEADER.STATUS.ENCL = %YES# THEN DO;
      184     9706
      185     9707            /*
      186     9708               Read the enclosure context record
      187     9709            */
      188     9710
      189     9711    2   READ_ENCL_CONTEXT:;
      190     9712    2           CALL VMA$GET_ADD_RECORD (%VM_TYPE_ENCL,VM_ENCLLIST_,IN_DCB#,IN_NUM)
PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:7    
      191     9713    3           WHENALTRETURN DO;
      192     9714    4               IF B$TCB.ALT$->B$ALT.ERR.CODE = %E$LD THEN DO;
      193     9715    4                   VBOUND(VM_ENCLLIST_) = VBOUND(VM_ENCLLIST_) + PAGESIZE;
      194     9716    4                   GOTO READ_ENCL_CONTEXT;
      195     9717    4               END;
      196     9718    3               ELSE GOTO END_ENCL;
      197     9719    3           END;
      198     9720
      199     9721    2           ENCL$ = VM_ENCL_HEAD.HEAD$;
      200     9722    3           DO J = 0 TO VM_ENCL_HEAD.NUM_ENTRIES - 1;
      201     9723    3               ENCL_NUM = VM_ENCLOS.TYPE - %VM_TYPE_ENCL;
      202     9724    4               DO K = 0 TO VM_ENCLOS.NRECS - 1;
      203     9725    4   READ_ENCL:      ;
      204     9726    4                   CALL VMD$GET_ENCL (IN_NUM,IN_DCB#,K,COUNT,INSEED,,,ENCL_NUM,
              9726                            VM_ENCLREC$)
      205     9727
      206     9728    5                   WHENALTRETURN DO;
      207     9729    6                       IF B$TCB.ALT$->B$ALT.ERR.CODE = %E$LD THEN DO;
      208     9730    6                           VBOUND(VM_ENCLREC_) = VBOUND(VM_ENCLREC_) + PAGESIZE;
      209     9731    6                           GOTO READ_ENCL;
      210     9732    6                       END;
      211     9733    5                   END;
      212     9734    4                   CALL VMD$PUT_ENCL (OUT_NUM,OUT_DCB#,K,COUNT,OUTSEED,,,ENCL_NUM,
              9734                            VM_ENCLREC$) ALTRET (E_BODY);
      213     9735    5                   IF VO_NEED_READ THEN DO;
      214     9736    5                       I = I + 1;
      215     9737    5                       VO_NEED_READ = '0'B;
      216     9738    5                       CALL M$READ (VO_READ_CG);
      217     9739    5                   END;
      218     9740    4                   IF VO_PROCESS THEN CALL VOM$PROCESS;
      219     9741    4               END;
      220     9742    3               ENCL$ = VM_ENCLOS.NEXT$;
      221     9743    3           END;
      222     9744    2           CALL VMA$PUT_ADD_RECORD (%VM_TYPE_ENCL,VM_ENCLLIST_,OUT_DCB#,OUT_NUM) ALTRET
              9744                    (E_BODY);
      223     9745    2       END;
      224     9746    1   END_ENCL:
PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:8    
      225     9747    1       VM_HEADER.NUM_ENCL_RECORDS = I;
      226     9748        /*
      227     9749            ***** Move all trace records ...
      228     9750        */
      229     9751    1       I = 0;
      230     9752    2       DO FOREVER;
      231     9753    2           VM_BODYREC.VALUE.COUNT = LENGTHC(VM_BODYREC.VALUE.DATA);
      232     9754    2           CALL VMD$GET_TRACE (IN_NUM,IN_DCB#,I,COUNT,,
      233     9755    2             VM_BODYREC,DVBYTE) ALTRET(END_TRACE);
      234     9756    2           CALL VMD$PUT_TRACE (OUT_NUM,OUT_DCB#,I,COUNT,,
      235     9757    2             VM_BODYREC,DVBYTE) ALTRET(END_TRACE);
      236     9758    2           I = I + 1;
      237     9759    3           IF VO_NEED_READ THEN DO;
      238     9760    3               VO_NEED_READ = '0'B;
      239     9761    3               CALL M$READ (VO_READ_CG);
      240     9762    3           END;
      241     9763    2           IF VO_PROCESS THEN CALL VOM$PROCESS;
      242     9764    2       END;
      243     9765    1   END_TRACE:
      244     9766    1       VM_HEADER.NUM_TRACE_RECORDS = I;
      245     9767        /*
      246     9768            ***** Write the unique-id record
      247     9769        */
      248     9770    1       IF VM_HEADER.UNIQUE_ID$ ~= ADDR(NIL)
      249     9771    1       THEN
      250     9772    1           CALL VMD$PUT_ID (VM_HEADER.UNIQUE_ID$ -> X$STRING, OUT_DCB#, OUT_NUM);
      251     9773        /*
      252     9774            ***** Write the header ...
      253     9775        */
      254     9776    1       CALL VMD$PUT_HEADER (OUT_NUM,OUT_DCB#) ALTRET(E_MOVE);
      255     9777
      256     9778    1       RETURN;
      257     9779        /**/
      258     9780    1   E_MOVE:
      259     9781    1       ALTRETURN;
      260     9782    1   E_BODY:
      261     9783    1       CALL M$SENV ALTRET(END_BODY);
PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:9    
      262     9784    1       VM_HEADER.NUM_RECORDS = I;
      263     9785    1       CALL VMD$PUT_HEADER (OUT_NUM,OUT_DCB#)
      264     9786    2       WHENALTRETURN DO;
      265     9787    2       END;
      266     9788    1       CALL M$RENV;
      267     9789    1       ALTRETURN;
      268     9790    1   END VMM$COPY_MESSAGE;
      269     9791        %EOD;

PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:10   
--  Include file information  --

   B_ERRORS_C.:LIB_E05  is referenced.
   B_MACROS_C.:LIB_E05  is referenced.
   VM_DATA_R.:VMB6TOU  cannot be made into a system file and is referenced.
   VM_SUBS_C.:VMB6TOU  is referenced.
   VM_MACRO_C.:VMB6TOU  is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   CP_6_C.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure VMM$COPY_MESSAGE.

   Procedure VMM$COPY_MESSAGE requires 451 words for executable code.
   Procedure VMM$COPY_MESSAGE requires 100 words of local(AUTO) storage.

PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:11   

 Object Unit name= VMM$COPY_MESSAGE                           File name= VMM$MESSAGE.:VMB6TOU
 UTS= AUG 20 '97 15:16:57.28 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   DCB   even  none     0      0  M$MAIL_FILE
    2   DCB   even  none     0      0  M$MAIL_CENTRAL
    3   DCB   even  none     0      0  M$MAIL_GLOBAL
    4   DCB   even  none     0      0  M$WORK
    5   DCB   even  none     0      0  M$MAIL_COMGROUP
    6   DCB   even  none     0      0  M$DO
    7   DCB   even  none     0      0  M$LO
    8   DCB   even  none     0      0  M$ME
    9   DCB   even  none     0      0  M$NODE
   10   DCB   even  none     0      0  M$SI
   11   Data  even  none    61     75  VMM$COPY_MESSAGE
   12   Proc  even  none   451    703  VMM$COPY_MESSAGE
   13  RoData even  none    37     45  VMM$COPY_MESSAGE

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
    12      0   yes    yes     yes      Std        6  VMM$COPY_MESSAGE
    12      3          yes     yes      Std        6  VMM$COPY_MESSAGE_INTERSYS
    12    255          yes     yes      Std        6  VMM$COPY_MESSAGE_BODY
PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:12   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       2 VMD$GET_SITE
 yes     yes           Std       4 VMA$GET_ADD_RECORD
         yes           Std       0 VOM$PROCESS
 yes     yes           Std       9 VMD$GET_ENCL
 yes     yes           Std       9 VMD$PUT_ENCL
 yes     yes           Std       7 VMD$PUT_BODY
 yes     yes           Std       7 VMD$PUT_TRACE
 yes     yes           Std       3 VMD$PUT_ID
 yes     yes           Std       2 VMD$PUT_HEADER
 yes     yes           Std       2 VMD$PUT_SITE
 yes     yes           Std       4 VMA$PUT_ADD_RECORD
 yes     yes           Std       7 VMD$GET_TRACE
 yes     yes           Std       9 VMD$GET_BODY
                       nStd      0 X66_AUTO_N
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT
PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:13   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                             r    VM_HEADER$                       r    VM_PROFILE$
r    VM_ADDLIST$                      r    VM_ADDREC$                       r    VM_WORK$
r    VM_SELECT$                       r    VM_PARSEAREA$                    r    VM_INPUT$
r    VM_COPY$                              VM_ENCLLIST$                          VM_ENCLREC$
     VM_HEADER_                            VM_HEADER_INIT_                       VM_PROFILE_
     VM_ADDLIST_                           VM_ADDREC_                            VM_WORK_
     VM_SELECT_                            VM_PARSEAREA_                         VM_INPUT_
     VM_COPY_                              VM_ENCLLIST_                          VM_ENCLREC_
     M$MAIL_FILE                           M$MAIL_CENTRAL                        M$MAIL_GLOBAL
     M$WORK                                M$MAIL_COMGROUP                       M$DO
     M$LO                                  M$ME                                  M$NODE
     M$SI                                  M$MAIL_FILE_NUM                       M$MAIL_CENTRAL_NUM
     M$MAIL_GLOBAL_NUM                     M$WORK_NUM                            M$MAIL_COMGROUP_NUM
     M$DO_NUM                              M$ME_NUM                              M$LO_NUM
     M$SI_NUM                              M$NODE_NUM                       r    B$JIT$
r    B$TCB$                                VM_MAIL_ACCT                          VM_NAME_MAP_NAME
     ERRMSG_FID                            VM_SEND_FILE_NAME                     VM_FORWARD_FILE_NAME
     VM_FORWARD_ENCL_NAME                  VM_FORWARD_FILE_PASS                  VM_MAILCG_NAME
     VM_SITENAME                           VM_MAILCG_SETSTA                      VO_READ_CG
     VO_NEED_READ                          VO_PROCESS

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     NULLSID                               ISSID
PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:14   


        1        1       /*M* VMM$SUBR - VMM$COPY_MESSAGE, VMM$DELETE_MESSAGE, VMM$EDIT_MESSAGE_OUT, VMM$EDIT
                 1        _MESSAGE_IN */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMC,PLM=4,IND=4,CTI=2,DTI=0,ENI=0,ECI=0,CSI=0,DCI=4 */
        8        8        /*P*
        9        9             NAME: VMM$COPY_MESSAGE
       10       10             PURPOSE:
       11       11                  To support MOVE, COPY and MAILMAN in moving messages between folders.
       12       12             DESCRIPTION:
       13       13                  This routine has seven parameters:
       14       14
       15       15                     IN_NUM     - number of message to move in first folder.
       16       16                     OUT_NUM    - number of new message to create.
       17       17                     IN_DCB#    - open to folder to get message from.
       18       18                     OUT_DCB#   - open to folder to put message into.
       19       19                     INSEED     - seed used to encrypt input message (optional)
       20       20                     OUTSEED    - seed used to encrypt output message (optional)
       21       21
       22       22                  This routine will move a copy of the message in the folder
       23       23                  pointed to by IN_DCB# with a number of IN_NUM into the
       24       24                  folder pointed to by OUT_DCB#. The number of the new message
       25       25                  will be OUT_NUM.
       26       26
       27       27                  NOTE: This routine expects the header (VM_HEADER) to
       28       28                        already exist in the VM_HEADER$ data segment.
       29       29        */
       30       30        VMM$COPY_MESSAGE: PROC (IN_NUM,OUT_NUM,IN_DCB#,OUT_DCB#,INSEED,OUTSEED) ALTRET;

     30 12 000000   000000 700200 xent  VMM$COPY_ME* TSX0  ! X66_AUTO_N
        12 000001   000144 000006                    ZERO    100,6

       31       31        /***** Include files *****/
PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:15   
       32       32         %INCLUDE CP_6;
       33     5591         %INCLUDE CP_6_SUBS;
       34     6131         %INCLUDE VM_MACRO_C;
       35     7399         %INCLUDE VM_SUBS_C;
       36     7659         %INCLUDE VM_DATA_R;
       37     8090        %INCLUDE B_ERRORS_C;
       38     9217
       39     9218        %B$TCB (STCLASS="BASED(B$TCB$)");
       40     9221        %B$ALT;
       41     9229
       42     9230        /***** Parameters *****/
       43     9231    1   DCL IN_NUM SBIN WORD;
       44     9232    1   DCL OUT_NUM SBIN WORD;
       45     9233    1   DCL IN_DCB# UBIN WORD;
       46     9234    1   DCL OUT_DCB# UBIN WORD;
       47     9235    1   DCL INSEED UBIN WORD;
       48     9236    1   DCL OUTSEED UBIN WORD;
       49     9237        /***** External routines *****/
       50     9238        /********** specials, will be dummies for mail ***********/
       51     9239        %FPT_READ (FPTN=VO_READ_CG, STCLASS=SYMREF );
       52     9278    1   DCL VO_NEED_READ BIT(1) SYMREF;
       53     9279    1   DCL VO_PROCESS BIT(1) SYMREF;
       54     9280    1   DCL VMA$GET_ADD_RECORD ENTRY(4) ALTRET;
       55     9281    1   DCL VMA$PUT_ADD_RECORD ENTRY(4) ALTRET;
       56     9282    1   DCL VOM$PROCESS ENTRY;
       57     9283    1   DCL VMD$PUT_HEADER ENTRY(2) ALTRET;
       58     9284    1   DCL VMD$GET_BODY ENTRY (9) ALTRET;
       59     9285    1   DCL VMD$PUT_BODY ENTRY (7) ALTRET;
       60     9286    1   DCL VMD$GET_TRACE ENTRY (7) ALTRET;
       61     9287    1   DCL VMD$PUT_TRACE ENTRY (7) ALTRET;
       62     9288    1   DCL VMD$GET_ENCL ENTRY (9) ALTRET;
       63     9289    1   DCL VMD$PUT_ENCL ENTRY (9) ALTRET;
       64     9290    1   DCL VMD$PUT_ID ENTRY (3) ALTRET;
       65     9291    1   DCL VMD$GET_SITE ENTRY (2) ALTRET;
       66     9292    1   DCL VMD$PUT_SITE ENTRY (2) ALTRET;
       67     9293        /***** Mail structures *****/
       68     9294         %VM_HEADER;
PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:16   
       69     9423         %VM_SITE;
       70     9447        %VM_ENCLOS (STCLASS="BASED(ENCL$)");
       71     9478        %VM_ADD_HEAD (NAME=VM_ENCL_HEAD,STCLASS="BASED(VM_ENCLLIST$)");
       72     9507        /***** Local variables *****/
       73     9508    1   DCL I SBIN WORD STATIC;
       74     9509    1   DCL J SBIN WORD STATIC;
       75     9510    1   DCL K SBIN WORD STATIC;
       76     9511    1   DCL COUNT SBIN WORD AUTO;
       77     9512    1   DCL DVBYTE BIT(8);
       78     9513    1   DCL TSEEDIN UBIN WORD;
       79     9514    1   DCL PAGESIZE SBIN WORD STATIC INIT(4096);
       80     9515    1   DCL ENCL_NUM SBIN WORD STATIC;
       81     9516    1   DCL ENCL$ PTR;
       82     9517          %VM_BODYTYPES;
       83     9523          %VM_KEYTYPES;
       84     9544          %VM_BODYREC (STCLASS=AUTO,VARYLEN=NO);
       85     9576        %VM_BODYREC (NAME=VM_ENCLREC,STCLASS="BASED(VM_ENCLREC$)",
       86     9577                     TYP=%VM_BODY_BINARY_ENCL,VARYLEN=YES);
       87     9609        %EJECT;
PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:17   
       88     9610
       89     9611    1       GOTO START_COPY;

   9611 12 000002   000111 710000 12                 TRA     E_IBC

       90     9612    1   VMM$COPY_MESSAGE_INTERSYS: ENTRY (IN_NUM,OUT_NUM,IN_DCB#,OUT_DCB#,INSEED,OUTSEED)
              9612            ALTRET;

   9612 12 000003   000000 700200 xent  VMM$COPY_ME* TSX0  ! X66_AUTO_N
        12 000004   000144 000006                    ZERO    100,6

       91     9613
       92     9614        /*
       93     9615             ***** If this is an intersystem message,
       94     9616                   copy the intersystem address records ...
       95     9617        */
       96     9618    1       CALL VMD$GET_SITE (VM_SITE,IN_DCB#) ALTRET(NO_SITE);

   9618 12 000005   200005 236100                    LDQ     @IN_DCB#,,AUTO
        12 000006   000001 235000 13                 LDA     1
        12 000007   200132 757100                    STAQ    VM_BODYREC+77,,AUTO
        12 000010   200132 630500                    EPPR0   VM_BODYREC+77,,AUTO
        12 000011   000000 631400 13                 EPPR1   0
        12 000012   000000 701000 xent               TSX1    VMD$GET_SITE
        12 000013   000111 702000 12                 TSX2    E_IBC

       97     9619    1       CALL VMD$PUT_SITE (VM_SITE,OUT_DCB#) ALTRET(NO_SITE);

   9619 12 000014   200006 236100                    LDQ     @OUT_DCB#,,AUTO
        12 000015   000001 235000 13                 LDA     1
        12 000016   200132 757100                    STAQ    VM_BODYREC+77,,AUTO
        12 000017   200132 630500                    EPPR0   VM_BODYREC+77,,AUTO
        12 000020   000000 631400 13                 EPPR1   0
        12 000021   000000 701000 xent               TSX1    VMD$PUT_SITE
        12 000022   000111 702000 12                 TSX2    E_IBC

       98     9620    1       CALL VMA$GET_ADD_RECORD (%VM_TYPE_ITO,VM_WORK_,IN_DCB#,IN_NUM) ALTRET(E_ITO);
PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:18   

   9620 12 000023   200003 236100                    LDQ     @IN_NUM,,AUTO
        12 000024   200005 235100                    LDA     @IN_DCB#,,AUTO
        12 000025   200134 757100                    STAQ    VM_BODYREC+79,,AUTO
        12 000026   000004 237000 13                 LDAQ    4
        12 000027   200132 757100                    STAQ    VM_BODYREC+77,,AUTO
        12 000030   200132 630500                    EPPR0   VM_BODYREC+77,,AUTO
        12 000031   000002 631400 13                 EPPR1   2
        12 000032   000000 701000 xent               TSX1    VMA$GET_ADD_RECORD
        12 000033   000045 702000 12                 TSX2    E_ITO

       99     9621    1       CALL VMA$PUT_ADD_RECORD (%VM_TYPE_ITO,VM_WORK_,OUT_DCB#,OUT_NUM) ALTRET(E_TO);

   9621 12 000034   200004 236100                    LDQ     @OUT_NUM,,AUTO
        12 000035   200006 235100                    LDA     @OUT_DCB#,,AUTO
        12 000036   200134 757100                    STAQ    VM_BODYREC+79,,AUTO
        12 000037   000004 237000 13                 LDAQ    4
        12 000040   200132 757100                    STAQ    VM_BODYREC+77,,AUTO
        12 000041   200132 630500                    EPPR0   VM_BODYREC+77,,AUTO
        12 000042   000002 631400 13                 EPPR1   2
        12 000043   000000 701000 xent               TSX1    VMA$PUT_ADD_RECORD
        12 000044   000152 702000 12                 TSX2    E_TO

   9621 12 000045                       E_ITO        null
      100     9622    1   E_ITO: ;
      101     9623    1       CALL VMA$GET_ADD_RECORD (%VM_TYPE_IC,VM_WORK_,IN_DCB#,IN_NUM) ALTRET(E_IC);

   9623 12 000045   200003 236100                    LDQ     @IN_NUM,,AUTO
        12 000046   200005 235100                    LDA     @IN_DCB#,,AUTO
        12 000047   200134 757100                    STAQ    VM_BODYREC+79,,AUTO
        12 000050   000010 237000 13                 LDAQ    8
        12 000051   200132 757100                    STAQ    VM_BODYREC+77,,AUTO
        12 000052   200132 630500                    EPPR0   VM_BODYREC+77,,AUTO
        12 000053   000002 631400 13                 EPPR1   2
        12 000054   000000 701000 xent               TSX1    VMA$GET_ADD_RECORD
        12 000055   000067 702000 12                 TSX2    E_IC

PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:19   
      102     9624    1       CALL VMA$PUT_ADD_RECORD (%VM_TYPE_IC,VM_WORK_,OUT_DCB#,OUT_NUM) ALTRET(E_IC);

   9624 12 000056   200004 236100                    LDQ     @OUT_NUM,,AUTO
        12 000057   200006 235100                    LDA     @OUT_DCB#,,AUTO
        12 000060   200134 757100                    STAQ    VM_BODYREC+79,,AUTO
        12 000061   000010 237000 13                 LDAQ    8
        12 000062   200132 757100                    STAQ    VM_BODYREC+77,,AUTO
        12 000063   200132 630500                    EPPR0   VM_BODYREC+77,,AUTO
        12 000064   000002 631400 13                 EPPR1   2
        12 000065   000000 701000 xent               TSX1    VMA$PUT_ADD_RECORD
        12 000066   000067 702000 12                 TSX2    E_IC

   9621 12 000067                       E_IC         null
      103     9625    1   E_IC: ;
      104     9626    1       CALL VMA$GET_ADD_RECORD (%VM_TYPE_IBC,VM_WORK_,IN_DCB#,IN_NUM) ALTRET(E_IBC);

   9626 12 000067   200003 236100                    LDQ     @IN_NUM,,AUTO
        12 000070   200005 235100                    LDA     @IN_DCB#,,AUTO
        12 000071   200134 757100                    STAQ    VM_BODYREC+79,,AUTO
        12 000072   000012 237000 13                 LDAQ    10
        12 000073   200132 757100                    STAQ    VM_BODYREC+77,,AUTO
        12 000074   200132 630500                    EPPR0   VM_BODYREC+77,,AUTO
        12 000075   000002 631400 13                 EPPR1   2
        12 000076   000000 701000 xent               TSX1    VMA$GET_ADD_RECORD
        12 000077   000111 702000 12                 TSX2    E_IBC

      105     9627    1       CALL VMA$PUT_ADD_RECORD (%VM_TYPE_IBC,VM_WORK_,OUT_DCB#,OUT_NUM) ALTRET(E_IBC);

   9627 12 000100   200004 236100                    LDQ     @OUT_NUM,,AUTO
        12 000101   200006 235100                    LDA     @OUT_DCB#,,AUTO
        12 000102   200134 757100                    STAQ    VM_BODYREC+79,,AUTO
        12 000103   000012 237000 13                 LDAQ    10
        12 000104   200132 757100                    STAQ    VM_BODYREC+77,,AUTO
        12 000105   200132 630500                    EPPR0   VM_BODYREC+77,,AUTO
        12 000106   000002 631400 13                 EPPR1   2
        12 000107   000000 701000 xent               TSX1    VMA$PUT_ADD_RECORD
        12 000110   000111 702000 12                 TSX2    E_IBC
PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:20   

   9626 12 000111                       E_IBC        null
   9626 12 000111                       NO_SITE      null
      106     9628    1   E_IBC: ;
      107     9629    1   NO_SITE: ;
      108     9630
      109     9631    1   START_COPY:
      110     9632
      111     9633        /* Make sure the comgroup gets read at least once here.  Mailman
      112     9634           does not read in his send mail loop, this will do it for him */
      113     9635    2       IF VO_NEED_READ THEN DO;

   9635 12 000111   000000 234000 xsym  START_COPY   SZN     VO_NEED_READ
        12 000112   000117 605000 12                 TPL     s:9639

      114     9636    2           VO_NEED_READ = '0'B;

   9636 12 000113   000000 450000 xsym               STZ     VO_NEED_READ

      115     9637    2           CALL M$READ (VO_READ_CG);

   9637 12 000114   000000 630400 xsym               EPPR0   VO_READ_CG
        12 000115   040000 713400                    CLIMB   read
        12 000116   401400 401760                    pmme    nvectors=4

      116     9638    2       END;

      117     9639    1       IF VO_PROCESS THEN CALL VOM$PROCESS;

   9639 12 000117   000000 234000 xsym               SZN     VO_PROCESS
        12 000120   000124 605000 12                 TPL     s:9643

   9639 12 000121   000014 631400 13                 EPPR1   12
        12 000122   000000 701000 xent               TSX1    VOM$PROCESS
        12 000123   000000 011000                    NOP     0

      118     9640        /*
PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:21   
      119     9641             ***** Move the address records ...
      120     9642        */
      121     9643    1       IF VM_HEADER.TO$ ~= ADDR(NIL)

   9643 12 000124   000000 470400 xsym               LDP0    VM_HEADER$
        12 000125   000031 236100                    LDQ     25,,PR0
        12 000126   000015 116000 13                 CMPQ    13
        12 000127   000152 600000 12                 TZE     E_TO

      122     9644    1       THEN
      123     9645    2       DO;

      124     9646    2           CALL VMA$GET_ADD_RECORD (%VM_TYPE_TO,VM_WORK_,IN_DCB#,IN_NUM) ALTRET(E_TO);

   9646 12 000130   200003 236100                    LDQ     @IN_NUM,,AUTO
        12 000131   200005 235100                    LDA     @IN_DCB#,,AUTO
        12 000132   200134 757100                    STAQ    VM_BODYREC+79,,AUTO
        12 000133   000020 237000 13                 LDAQ    16
        12 000134   200132 757100                    STAQ    VM_BODYREC+77,,AUTO
        12 000135   200132 630500                    EPPR0   VM_BODYREC+77,,AUTO
        12 000136   000002 631400 13                 EPPR1   2
        12 000137   000000 701000 xent               TSX1    VMA$GET_ADD_RECORD
        12 000140   000152 702000 12                 TSX2    E_TO

      125     9647    2          CALL VMA$PUT_ADD_RECORD (%VM_TYPE_TO,VM_WORK_,OUT_DCB#,OUT_NUM) ALTRET(E_TO)
              9647                    ;

   9647 12 000141   200004 236100                    LDQ     @OUT_NUM,,AUTO
        12 000142   200006 235100                    LDA     @OUT_DCB#,,AUTO
        12 000143   200134 757100                    STAQ    VM_BODYREC+79,,AUTO
        12 000144   000020 237000 13                 LDAQ    16
        12 000145   200132 757100                    STAQ    VM_BODYREC+77,,AUTO
        12 000146   200132 630500                    EPPR0   VM_BODYREC+77,,AUTO
        12 000147   000002 631400 13                 EPPR1   2
        12 000150   000000 701000 xent               TSX1    VMA$PUT_ADD_RECORD
        12 000151   000152 702000 12                 TSX2    E_TO

PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:22   
   9646 12 000152                       E_TO         null
      126     9648    2   E_TO:   ;
      127     9649    2       END;

      128     9650
      129     9651    1       IF VM_HEADER.COPY$ ~= ADDR(NIL)

   9651 12 000152   000000 470400 xsym               LDP0    VM_HEADER$
        12 000153   000021 236100                    LDQ     17,,PR0
        12 000154   000015 116000 13                 CMPQ    13
        12 000155   000200 600000 12                 TZE     E_COPY

      130     9652    1       THEN
      131     9653    2       DO;

      132     9654    2          CALL VMA$GET_ADD_RECORD (%VM_TYPE_C,VM_WORK_,IN_DCB#,IN_NUM) ALTRET(E_COPY);

   9654 12 000156   200003 236100                    LDQ     @IN_NUM,,AUTO
        12 000157   200005 235100                    LDA     @IN_DCB#,,AUTO
        12 000160   200134 757100                    STAQ    VM_BODYREC+79,,AUTO
        12 000161   000022 237000 13                 LDAQ    18
        12 000162   200132 757100                    STAQ    VM_BODYREC+77,,AUTO
        12 000163   200132 630500                    EPPR0   VM_BODYREC+77,,AUTO
        12 000164   000002 631400 13                 EPPR1   2
        12 000165   000000 701000 xent               TSX1    VMA$GET_ADD_RECORD
        12 000166   000200 702000 12                 TSX2    E_COPY

      133     9655    2          CALL VMA$PUT_ADD_RECORD (%VM_TYPE_C,VM_WORK_,OUT_DCB#,OUT_NUM) ALTRET(E_COPY
              9655                    );

   9655 12 000167   200004 236100                    LDQ     @OUT_NUM,,AUTO
        12 000170   200006 235100                    LDA     @OUT_DCB#,,AUTO
        12 000171   200134 757100                    STAQ    VM_BODYREC+79,,AUTO
        12 000172   000022 237000 13                 LDAQ    18
        12 000173   200132 757100                    STAQ    VM_BODYREC+77,,AUTO
        12 000174   200132 630500                    EPPR0   VM_BODYREC+77,,AUTO
        12 000175   000002 631400 13                 EPPR1   2
PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:23   
        12 000176   000000 701000 xent               TSX1    VMA$PUT_ADD_RECORD
        12 000177   000200 702000 12                 TSX2    E_COPY

   9654 12 000200                       E_COPY       null
      134     9656    2   E_COPY: ;
      135     9657    2       END;

      136     9658
      137     9659    1       IF VM_HEADER.BLIND$ ~= ADDR(NIL)

   9659 12 000200   000000 470400 xsym               LDP0    VM_HEADER$
        12 000201   000020 236100                    LDQ     16,,PR0
        12 000202   000015 116000 13                 CMPQ    13
        12 000203   000226 600000 12                 TZE     E_BLIND

      138     9660    1       THEN
      139     9661    2       DO;

      140     9662    2          CALL VMA$GET_ADD_RECORD (%VM_TYPE_BC,VM_WORK_,IN_DCB#,IN_NUM) ALTRET(E_BLIND
              9662                    );

   9662 12 000204   200003 236100                    LDQ     @IN_NUM,,AUTO
        12 000205   200005 235100                    LDA     @IN_DCB#,,AUTO
        12 000206   200134 757100                    STAQ    VM_BODYREC+79,,AUTO
        12 000207   000026 237000 13                 LDAQ    22
        12 000210   200132 757100                    STAQ    VM_BODYREC+77,,AUTO
        12 000211   200132 630500                    EPPR0   VM_BODYREC+77,,AUTO
        12 000212   000002 631400 13                 EPPR1   2
        12 000213   000000 701000 xent               TSX1    VMA$GET_ADD_RECORD
        12 000214   000226 702000 12                 TSX2    E_BLIND

      141     9663    2           CALL VMA$PUT_ADD_RECORD (%VM_TYPE_BC,VM_WORK_,OUT_DCB#,OUT_NUM) ALTRET(
              9663                    E_BLIND);

   9663 12 000215   200004 236100                    LDQ     @OUT_NUM,,AUTO
        12 000216   200006 235100                    LDA     @OUT_DCB#,,AUTO
        12 000217   200134 757100                    STAQ    VM_BODYREC+79,,AUTO
PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:24   
        12 000220   000026 237000 13                 LDAQ    22
        12 000221   200132 757100                    STAQ    VM_BODYREC+77,,AUTO
        12 000222   200132 630500                    EPPR0   VM_BODYREC+77,,AUTO
        12 000223   000002 631400 13                 EPPR1   2
        12 000224   000000 701000 xent               TSX1    VMA$PUT_ADD_RECORD
        12 000225   000226 702000 12                 TSX2    E_BLIND

   9662 12 000226                       E_BLIND      null
      142     9664    2   E_BLIND: ;
      143     9665    2       END;

      144     9666
      145     9667    1       IF VM_HEADER.REPLY_TO$ ~= ADDR(NIL)

   9667 12 000226   000000 470400 xsym               LDP0    VM_HEADER$
        12 000227   000025 236100                    LDQ     21,,PR0
        12 000230   000015 116000 13                 CMPQ    13
        12 000231   000254 600000 12                 TZE     E_REPLYTO

      146     9668    1       THEN
      147     9669    2       DO;

      148     9670    2           CALL VMA$GET_ADD_RECORD (%VM_TYPE_RTO,VM_WORK_,IN_DCB#,IN_NUM) ALTRET(
              9670                    E_REPLYTO);

   9670 12 000232   200003 236100                    LDQ     @IN_NUM,,AUTO
        12 000233   200005 235100                    LDA     @IN_DCB#,,AUTO
        12 000234   200134 757100                    STAQ    VM_BODYREC+79,,AUTO
        12 000235   000030 237000 13                 LDAQ    24
        12 000236   200132 757100                    STAQ    VM_BODYREC+77,,AUTO
        12 000237   200132 630500                    EPPR0   VM_BODYREC+77,,AUTO
        12 000240   000002 631400 13                 EPPR1   2
        12 000241   000000 701000 xent               TSX1    VMA$GET_ADD_RECORD
        12 000242   000254 702000 12                 TSX2    E_REPLYTO

      149     9671    2           CALL VMA$PUT_ADD_RECORD (%VM_TYPE_RTO,VM_WORK_,OUT_DCB#,OUT_NUM) ALTRET(
              9671                    E_REPLYTO);
PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:25   

   9671 12 000243   200004 236100                    LDQ     @OUT_NUM,,AUTO
        12 000244   200006 235100                    LDA     @OUT_DCB#,,AUTO
        12 000245   200134 757100                    STAQ    VM_BODYREC+79,,AUTO
        12 000246   000030 237000 13                 LDAQ    24
        12 000247   200132 757100                    STAQ    VM_BODYREC+77,,AUTO
        12 000250   200132 630500                    EPPR0   VM_BODYREC+77,,AUTO
        12 000251   000002 631400 13                 EPPR1   2
        12 000252   000000 701000 xent               TSX1    VMA$PUT_ADD_RECORD
        12 000253   000254 702000 12                 TSX2    E_REPLYTO

   9670 12 000254                       E_REPLYTO    null
      150     9672    2   E_REPLYTO: ;
      151     9673    2       END;

      152     9674
      153     9675    1       GOTO COPY_THE_BODY;

   9675 12 000254   000257 710000 12                 TRA     COPY_THE_BODY

      154     9676
      155     9677    1  VMM$COPY_MESSAGE_BODY: ENTRY (IN_NUM,OUT_NUM,IN_DCB#,OUT_DCB#,INSEED,OUTSEED) ALTRET
              9677            ;

   9677 12 000255   000000 700200 xent  VMM$COPY_ME* TSX0  ! X66_AUTO_N
        12 000256   000144 000006                    ZERO    100,6

      156     9678
      157     9679    1   COPY_THE_BODY:
      158     9680
      159     9681        /*
      160     9682            ***** Move all body records ...
      161     9683        */
      162     9684    1       I = 0;

   9684 12 000257   000070 450000 11    COPY_THE_BO* STZ     I

PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:26   
      163     9685    2       DO FOREVER;

      164     9686    2           VM_BODYREC.VALUE.COUNT = LENGTHC(VM_BODYREC.VALUE.DATA);

   9686 12 000260   000454 235007                    LDA     300,DL
        12 000261   200016 755100                    STA     VM_BODYREC+1,,AUTO

      165     9687    2           CALL VMD$GET_BODY (IN_NUM,IN_DCB#,I,COUNT,INSEED,

   9687 12 000262   200012 630500                    EPPR0   DVBYTE,,AUTO
        12 000263   200140 450500                    STP0    VM_BODYREC+83,,AUTO
        12 000264   200015 631500                    EPPR1   VM_BODYREC,,AUTO
        12 000265   200137 451500                    STP1    VM_BODYREC+82,,AUTO
        12 000266   200007 236100                    LDQ     @INSEED,,AUTO
        12 000267   200136 756100                    STQ     VM_BODYREC+81,,AUTO
        12 000270   200011 633500                    EPPR3   COUNT,,AUTO
        12 000271   200135 453500                    STP3    VM_BODYREC+80,,AUTO
        12 000272   000033 236000 13                 LDQ     27
        12 000273   200134 756100                    STQ     VM_BODYREC+79,,AUTO
        12 000274   200005 236100                    LDQ     @IN_DCB#,,AUTO
        12 000275   200003 235100                    LDA     @IN_NUM,,AUTO
        12 000276   200132 757100                    STAQ    VM_BODYREC+77,,AUTO
        12 000277   200132 630500                    EPPR0   VM_BODYREC+77,,AUTO
        12 000300   000032 631400 13                 EPPR1   26
        12 000301   000000 701000 xent               TSX1    VMD$GET_BODY
        12 000302   000341 702000 12                 TSX2    END_BODY

      166     9688    2             VM_BODYREC,DVBYTE) ALTRET(END_BODY);
      167     9689    2           CALL VMD$PUT_BODY (OUT_NUM,OUT_DCB#,I,COUNT,OUTSEED,

   9689 12 000303   200012 630500                    EPPR0   DVBYTE,,AUTO
        12 000304   200140 450500                    STP0    VM_BODYREC+83,,AUTO
        12 000305   200015 631500                    EPPR1   VM_BODYREC,,AUTO
        12 000306   200137 451500                    STP1    VM_BODYREC+82,,AUTO
        12 000307   200010 236100                    LDQ     @OUTSEED,,AUTO
        12 000310   200136 756100                    STQ     VM_BODYREC+81,,AUTO
        12 000311   200011 633500                    EPPR3   COUNT,,AUTO
PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:27   
        12 000312   200135 453500                    STP3    VM_BODYREC+80,,AUTO
        12 000313   000033 236000 13                 LDQ     27
        12 000314   200134 756100                    STQ     VM_BODYREC+79,,AUTO
        12 000315   200006 236100                    LDQ     @OUT_DCB#,,AUTO
        12 000316   200004 235100                    LDA     @OUT_NUM,,AUTO
        12 000317   200132 757100                    STAQ    VM_BODYREC+77,,AUTO
        12 000320   200132 630500                    EPPR0   VM_BODYREC+77,,AUTO
        12 000321   000032 631400 13                 EPPR1   26
        12 000322   000000 701000 xent               TSX1    VMD$PUT_BODY
        12 000323   000662 702000 12                 TSX2    E_BODY

      168     9690    2             VM_BODYREC,DVBYTE) ALTRET(E_BODY);
      169     9691    2           I = I + 1;

   9691 12 000324   000070 054000 11                 AOS     I

      170     9692    3           IF VO_NEED_READ THEN DO;

   9692 12 000325   000000 234000 xsym               SZN     VO_NEED_READ
        12 000326   000333 605000 12                 TPL     s:9696

      171     9693    3               VO_NEED_READ = '0'B;

   9693 12 000327   000000 450000 xsym               STZ     VO_NEED_READ

      172     9694    3               CALL M$READ (VO_READ_CG);

   9694 12 000330   000000 630400 xsym               EPPR0   VO_READ_CG
        12 000331   040000 713400                    CLIMB   read
        12 000332   401400 401760                    pmme    nvectors=4

      173     9695    3           END;

      174     9696    2           IF VO_PROCESS THEN CALL VOM$PROCESS;

   9696 12 000333   000000 234000 xsym               SZN     VO_PROCESS
        12 000334   000260 605000 12                 TPL     s:9686
PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:28   

   9696 12 000335   000014 631400 13                 EPPR1   12
        12 000336   000000 701000 xent               TSX1    VOM$PROCESS
        12 000337   000000 011000                    NOP     0

      175     9697    2       END;

   9697 12 000340   000260 710000 12                 TRA     s:9686

      176     9698    1   END_BODY:
      177     9699    1       VM_HEADER.NUM_RECORDS = I;

   9699 12 000341   000070 235000 11    END_BODY     LDA     I
        12 000342   000000 470400 xsym               LDP0    VM_HEADER$
        12 000343   000011 755100                    STA     9,,PR0

      178     9700        /*
      179     9701            ***** Move all the enclosure records *****
      180     9702        */
      181     9703
      182     9704    1       I = 0;

   9704 12 000344   000070 450000 11                 STZ     I

      183     9705    2       IF VM_HEADER.STATUS.ENCL = %YES# THEN DO;

   9705 12 000345   000012 236100                    LDQ     10,,PR0
        12 000346   004000 316007                    CANQ    2048,DL
        12 000347   000544 600000 12                 TZE     END_ENCL

   9692 12 000350                       READ_ENCL_C* null
      184     9706
      185     9707            /*
      186     9708               Read the enclosure context record
      187     9709            */
      188     9710
      189     9711    2   READ_ENCL_CONTEXT:;
PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:29   
      190     9712    2           CALL VMA$GET_ADD_RECORD (%VM_TYPE_ENCL,VM_ENCLLIST_,IN_DCB#,IN_NUM)

   9712 12 000350   200003 236100                    LDQ     @IN_NUM,,AUTO
        12 000351   200005 235100                    LDA     @IN_DCB#,,AUTO
        12 000352   200134 757100                    STAQ    VM_BODYREC+79,,AUTO
        12 000353   000036 237000 13                 LDAQ    30
        12 000354   200132 757100                    STAQ    VM_BODYREC+77,,AUTO
        12 000355   200132 630500                    EPPR0   VM_BODYREC+77,,AUTO
        12 000356   000002 631400 13                 EPPR1   2
        12 000357   000000 701000 xent               TSX1    VMA$GET_ADD_RECORD
        12 000360   000362 702000 12                 TSX2    s:9714
        12 000361   000400 710000 12                 TRA     s:9721

      191     9713    3           WHENALTRETURN DO;

      192     9714    4               IF B$TCB.ALT$->B$ALT.ERR.CODE = %E$LD THEN DO;

   9714 12 000362   000000 470400 xsym               LDP0    B$TCB$
        12 000363   000000 471500                    LDP1    0,,PR0
        12 000364   100102 236100                    LDQ     66,,PR1
        12 000365   377770 376007                    ANQ     131064,DL
        12 000366   000070 116007                    CMPQ    56,DL
        12 000367   000544 601000 12                 TNZ     END_ENCL

      193     9715    4                   VBOUND(VM_ENCLLIST_) = VBOUND(VM_ENCLLIST_) + PAGESIZE;

   9715 12 000370   000000 236000 xsym               LDQ     VM_ENCLLIST_
        12 000371   000020 772000                    QRL     16
        12 000372   000073 036000 11                 ADLQ    PAGESIZE
        12 000373   000020 736000                    QLS     16
        12 000374   000000 676000 xsym               ERQ     VM_ENCLLIST_
        12 000375   000035 376000 13                 ANQ     29
        12 000376   000000 656000 xsym               ERSQ    VM_ENCLLIST_

      194     9716    4                   GOTO READ_ENCL_CONTEXT;

   9716 12 000377   000350 710000 12                 TRA     READ_ENCL_CONTEXT
PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:30   

      195     9717    4               END;
      196     9718    3               ELSE GOTO END_ENCL;
      197     9719    3           END;
      198     9720
      199     9721    2           ENCL$ = VM_ENCL_HEAD.HEAD$;

   9721 12 000400   000000 470400 xsym               LDP0    VM_ENCLLIST$
        12 000401   000003 236100                    LDQ     3,,PR0
        12 000402   200014 756100                    STQ     ENCL$,,AUTO

      200     9722    3           DO J = 0 TO VM_ENCL_HEAD.NUM_ENTRIES - 1;

   9722 12 000403   000071 450000 11                 STZ     J
        12 000404   000526 710000 12                 TRA     s:9743+1

      201     9723    3               ENCL_NUM = VM_ENCLOS.TYPE - %VM_TYPE_ENCL;

   9723 12 000405   200014 470500                    LDP0    ENCL$,,AUTO
        12 000406   000012 236100                    LDQ     10,,PR0
        12 000407   000033 772000                    QRL     27
        12 000410   000144 136007                    SBLQ    100,DL
        12 000411   000074 756000 11                 STQ     ENCL_NUM

      202     9724    4               DO K = 0 TO VM_ENCLOS.NRECS - 1;

   9724 12 000412   000072 450000 11                 STZ     K
        12 000413   000516 710000 12                 TRA     s:9741+1

   9724 12 000414                       READ_ENCL    null
      203     9725    4   READ_ENCL:      ;
      204     9726    4                   CALL VMD$GET_ENCL (IN_NUM,IN_DCB#,K,COUNT,INSEED,,,ENCL_NUM,
              9726                            VM_ENCLREC$)

   9726 12 000414   000041 236000 13                 LDQ     33
        12 000415   200142 756100                    STQ     VM_BODYREC+85,,AUTO
        12 000416   000042 236000 13                 LDQ     34
PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:31   
        12 000417   000015 235000 13                 LDA     13
        12 000420   200140 757100                    STAQ    VM_BODYREC+83,,AUTO
        12 000421   000015 236000 13                 LDQ     13
        12 000422   200007 235100                    LDA     @INSEED,,AUTO
        12 000423   200136 757100                    STAQ    VM_BODYREC+81,,AUTO
        12 000424   200011 630500                    EPPR0   COUNT,,AUTO
        12 000425   200135 450500                    STP0    VM_BODYREC+80,,AUTO
        12 000426   000043 236000 13                 LDQ     35
        12 000427   200134 756100                    STQ     VM_BODYREC+79,,AUTO
        12 000430   200005 236100                    LDQ     @IN_DCB#,,AUTO
        12 000431   200003 235100                    LDA     @IN_NUM,,AUTO
        12 000432   200132 757100                    STAQ    VM_BODYREC+77,,AUTO
        12 000433   200132 630500                    EPPR0   VM_BODYREC+77,,AUTO
        12 000434   000040 631400 13                 EPPR1   32
        12 000435   000000 701000 xent               TSX1    VMD$GET_ENCL
        12 000436   000440 702000 12                 TSX2    s:9729
        12 000437   000456 710000 12                 TRA     s:9734

      205     9727
      206     9728    5                   WHENALTRETURN DO;

      207     9729    6                       IF B$TCB.ALT$->B$ALT.ERR.CODE = %E$LD THEN DO;

   9729 12 000440   000000 470400 xsym               LDP0    B$TCB$
        12 000441   000000 471500                    LDP1    0,,PR0
        12 000442   100102 236100                    LDQ     66,,PR1
        12 000443   377770 376007                    ANQ     131064,DL
        12 000444   000070 116007                    CMPQ    56,DL
        12 000445   000456 601000 12                 TNZ     s:9734

      208     9730    6                           VBOUND(VM_ENCLREC_) = VBOUND(VM_ENCLREC_) + PAGESIZE;

   9730 12 000446   000000 236000 xsym               LDQ     VM_ENCLREC_
        12 000447   000020 772000                    QRL     16
        12 000450   000073 036000 11                 ADLQ    PAGESIZE
        12 000451   000020 736000                    QLS     16
        12 000452   000000 676000 xsym               ERQ     VM_ENCLREC_
PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:32   
        12 000453   000035 376000 13                 ANQ     29
        12 000454   000000 656000 xsym               ERSQ    VM_ENCLREC_

      209     9731    6                           GOTO READ_ENCL;

   9731 12 000455   000414 710000 12                 TRA     READ_ENCL

      210     9732    6                       END;
      211     9733    5                   END;
      212     9734    4                   CALL VMD$PUT_ENCL (OUT_NUM,OUT_DCB#,K,COUNT,OUTSEED,,,ENCL_NUM,
              9734                            VM_ENCLREC$) ALTRET (E_BODY);

   9734 12 000456   000041 236000 13                 LDQ     33
        12 000457   200142 756100                    STQ     VM_BODYREC+85,,AUTO
        12 000460   000042 236000 13                 LDQ     34
        12 000461   000015 235000 13                 LDA     13
        12 000462   200140 757100                    STAQ    VM_BODYREC+83,,AUTO
        12 000463   000015 236000 13                 LDQ     13
        12 000464   200010 235100                    LDA     @OUTSEED,,AUTO
        12 000465   200136 757100                    STAQ    VM_BODYREC+81,,AUTO
        12 000466   200011 630500                    EPPR0   COUNT,,AUTO
        12 000467   200135 450500                    STP0    VM_BODYREC+80,,AUTO
        12 000470   000043 236000 13                 LDQ     35
        12 000471   200134 756100                    STQ     VM_BODYREC+79,,AUTO
        12 000472   200006 236100                    LDQ     @OUT_DCB#,,AUTO
        12 000473   200004 235100                    LDA     @OUT_NUM,,AUTO
        12 000474   200132 757100                    STAQ    VM_BODYREC+77,,AUTO
        12 000475   200132 630500                    EPPR0   VM_BODYREC+77,,AUTO
        12 000476   000040 631400 13                 EPPR1   32
        12 000477   000000 701000 xent               TSX1    VMD$PUT_ENCL
        12 000500   000662 702000 12                 TSX2    E_BODY

      213     9735    5                   IF VO_NEED_READ THEN DO;

   9735 12 000501   000000 234000 xsym               SZN     VO_NEED_READ
        12 000502   000510 605000 12                 TPL     s:9740

PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:33   
      214     9736    5                       I = I + 1;

   9736 12 000503   000070 054000 11                 AOS     I

      215     9737    5                       VO_NEED_READ = '0'B;

   9737 12 000504   000000 450000 xsym               STZ     VO_NEED_READ

      216     9738    5                       CALL M$READ (VO_READ_CG);

   9738 12 000505   000000 630400 xsym               EPPR0   VO_READ_CG
        12 000506   040000 713400                    CLIMB   read
        12 000507   401400 401760                    pmme    nvectors=4

      217     9739    5                   END;

      218     9740    4                   IF VO_PROCESS THEN CALL VOM$PROCESS;

   9740 12 000510   000000 234000 xsym               SZN     VO_PROCESS
        12 000511   000515 605000 12                 TPL     s:9741

   9740 12 000512   000014 631400 13                 EPPR1   12
        12 000513   000000 701000 xent               TSX1    VOM$PROCESS
        12 000514   000000 011000                    NOP     0

      219     9741    4               END;

   9741 12 000515   000072 054000 11                 AOS     K
        12 000516   200014 470500                    LDP0    ENCL$,,AUTO
        12 000517   000072 236000 11                 LDQ     K
        12 000520   000414 604000 12                 TMI     READ_ENCL
        12 000521   000011 116100                    CMPQ    9,,PR0
        12 000522   000414 602000 12                 TNC     READ_ENCL

      220     9742    3               ENCL$ = VM_ENCLOS.NEXT$;

   9742 12 000523   000000 236100                    LDQ     0,,PR0
PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:34   
        12 000524   200014 756100                    STQ     ENCL$,,AUTO

      221     9743    3           END;

   9743 12 000525   000071 054000 11                 AOS     J
        12 000526   000000 470400 xsym               LDP0    VM_ENCLLIST$
        12 000527   000071 236000 11                 LDQ     J
        12 000530   000405 604000 12                 TMI     s:9723
        12 000531   000001 116100                    CMPQ    1,,PR0
        12 000532   000405 602000 12                 TNC     s:9723

      222     9744    2          CALL VMA$PUT_ADD_RECORD (%VM_TYPE_ENCL,VM_ENCLLIST_,OUT_DCB#,OUT_NUM) ALTRET
              9744                    (E_BODY);

   9744 12 000533   200004 236100                    LDQ     @OUT_NUM,,AUTO
        12 000534   200006 235100                    LDA     @OUT_DCB#,,AUTO
        12 000535   200134 757100                    STAQ    VM_BODYREC+79,,AUTO
        12 000536   000036 237000 13                 LDAQ    30
        12 000537   200132 757100                    STAQ    VM_BODYREC+77,,AUTO
        12 000540   200132 630500                    EPPR0   VM_BODYREC+77,,AUTO
        12 000541   000002 631400 13                 EPPR1   2
        12 000542   000000 701000 xent               TSX1    VMA$PUT_ADD_RECORD
        12 000543   000662 702000 12                 TSX2    E_BODY

      223     9745    2       END;

      224     9746    1   END_ENCL:
      225     9747    1       VM_HEADER.NUM_ENCL_RECORDS = I;

   9747 12 000544   000070 235000 11    END_ENCL     LDA     I
        12 000545   000000 470400 xsym               LDP0    VM_HEADER$
        12 000546   000035 755100                    STA     29,,PR0

      226     9748        /*
      227     9749            ***** Move all trace records ...
      228     9750        */
      229     9751    1       I = 0;
PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:35   

   9751 12 000547   000070 450000 11                 STZ     I

      230     9752    2       DO FOREVER;

      231     9753    2           VM_BODYREC.VALUE.COUNT = LENGTHC(VM_BODYREC.VALUE.DATA);

   9753 12 000550   000454 235007                    LDA     300,DL
        12 000551   200016 755100                    STA     VM_BODYREC+1,,AUTO

      232     9754    2           CALL VMD$GET_TRACE (IN_NUM,IN_DCB#,I,COUNT,,

   9754 12 000552   200012 630500                    EPPR0   DVBYTE,,AUTO
        12 000553   200140 450500                    STP0    VM_BODYREC+83,,AUTO
        12 000554   200015 631500                    EPPR1   VM_BODYREC,,AUTO
        12 000555   200137 451500                    STP1    VM_BODYREC+82,,AUTO
        12 000556   000015 236000 13                 LDQ     13
        12 000557   200136 756100                    STQ     VM_BODYREC+81,,AUTO
        12 000560   200011 633500                    EPPR3   COUNT,,AUTO
        12 000561   200135 453500                    STP3    VM_BODYREC+80,,AUTO
        12 000562   000033 236000 13                 LDQ     27
        12 000563   200134 756100                    STQ     VM_BODYREC+79,,AUTO
        12 000564   200005 236100                    LDQ     @IN_DCB#,,AUTO
        12 000565   200003 235100                    LDA     @IN_NUM,,AUTO
        12 000566   200132 757100                    STAQ    VM_BODYREC+77,,AUTO
        12 000567   200132 630500                    EPPR0   VM_BODYREC+77,,AUTO
        12 000570   000032 631400 13                 EPPR1   26
        12 000571   000000 701000 xent               TSX1    VMD$GET_TRACE
        12 000572   000631 702000 12                 TSX2    END_TRACE

      233     9755    2             VM_BODYREC,DVBYTE) ALTRET(END_TRACE);
      234     9756    2           CALL VMD$PUT_TRACE (OUT_NUM,OUT_DCB#,I,COUNT,,

   9756 12 000573   200012 630500                    EPPR0   DVBYTE,,AUTO
        12 000574   200140 450500                    STP0    VM_BODYREC+83,,AUTO
        12 000575   200015 631500                    EPPR1   VM_BODYREC,,AUTO
        12 000576   200137 451500                    STP1    VM_BODYREC+82,,AUTO
PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:36   
        12 000577   000015 236000 13                 LDQ     13
        12 000600   200136 756100                    STQ     VM_BODYREC+81,,AUTO
        12 000601   200011 633500                    EPPR3   COUNT,,AUTO
        12 000602   200135 453500                    STP3    VM_BODYREC+80,,AUTO
        12 000603   000033 236000 13                 LDQ     27
        12 000604   200134 756100                    STQ     VM_BODYREC+79,,AUTO
        12 000605   200006 236100                    LDQ     @OUT_DCB#,,AUTO
        12 000606   200004 235100                    LDA     @OUT_NUM,,AUTO
        12 000607   200132 757100                    STAQ    VM_BODYREC+77,,AUTO
        12 000610   200132 630500                    EPPR0   VM_BODYREC+77,,AUTO
        12 000611   000032 631400 13                 EPPR1   26
        12 000612   000000 701000 xent               TSX1    VMD$PUT_TRACE
        12 000613   000631 702000 12                 TSX2    END_TRACE

      235     9757    2             VM_BODYREC,DVBYTE) ALTRET(END_TRACE);
      236     9758    2           I = I + 1;

   9758 12 000614   000070 054000 11                 AOS     I

      237     9759    3           IF VO_NEED_READ THEN DO;

   9759 12 000615   000000 234000 xsym               SZN     VO_NEED_READ
        12 000616   000623 605000 12                 TPL     s:9763

      238     9760    3               VO_NEED_READ = '0'B;

   9760 12 000617   000000 450000 xsym               STZ     VO_NEED_READ

      239     9761    3               CALL M$READ (VO_READ_CG);

   9761 12 000620   000000 630400 xsym               EPPR0   VO_READ_CG
        12 000621   040000 713400                    CLIMB   read
        12 000622   401400 401760                    pmme    nvectors=4

      240     9762    3           END;

      241     9763    2           IF VO_PROCESS THEN CALL VOM$PROCESS;
PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:37   

   9763 12 000623   000000 234000 xsym               SZN     VO_PROCESS
        12 000624   000550 605000 12                 TPL     s:9753

   9763 12 000625   000014 631400 13                 EPPR1   12
        12 000626   000000 701000 xent               TSX1    VOM$PROCESS
        12 000627   000000 011000                    NOP     0

      242     9764    2       END;

   9764 12 000630   000550 710000 12                 TRA     s:9753

      243     9765    1   END_TRACE:
      244     9766    1       VM_HEADER.NUM_TRACE_RECORDS = I;

   9766 12 000631   000070 235000 11    END_TRACE    LDA     I
        12 000632   000000 470400 xsym               LDP0    VM_HEADER$
        12 000633   000034 755100                    STA     28,,PR0

      245     9767        /*
      246     9768            ***** Write the unique-id record
      247     9769        */
      248     9770    1       IF VM_HEADER.UNIQUE_ID$ ~= ADDR(NIL)

   9770 12 000634   000032 236100                    LDQ     26,,PR0
        12 000635   000015 116000 13                 CMPQ    13
        12 000636   000651 600000 12                 TZE     s:9776

      249     9771    1       THEN
      250     9772    1           CALL VMD$PUT_ID (VM_HEADER.UNIQUE_ID$ -> X$STRING, OUT_DCB#, OUT_NUM);

   9772 12 000637   000032 471500                    LDP1    26,,PR0
        12 000640   200004 236100                    LDQ     @OUT_NUM,,AUTO
        12 000641   200134 756100                    STQ     VM_BODYREC+79,,AUTO
        12 000642   200006 236100                    LDQ     @OUT_DCB#,,AUTO
        12 000643   200133 756100                    STQ     VM_BODYREC+78,,AUTO
        12 000644   200132 451500                    STP1    VM_BODYREC+77,,AUTO
PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:38   
        12 000645   200132 630500                    EPPR0   VM_BODYREC+77,,AUTO
        12 000646   000044 631400 13                 EPPR1   36
        12 000647   000000 701000 xent               TSX1    VMD$PUT_ID
        12 000650   000000 011000                    NOP     0

      251     9773        /*
      252     9774            ***** Write the header ...
      253     9775        */
      254     9776    1       CALL VMD$PUT_HEADER (OUT_NUM,OUT_DCB#) ALTRET(E_MOVE);

   9776 12 000651   200006 236100                    LDQ     @OUT_DCB#,,AUTO
        12 000652   200004 235100                    LDA     @OUT_NUM,,AUTO
        12 000653   200132 757100                    STAQ    VM_BODYREC+77,,AUTO
        12 000654   200132 630500                    EPPR0   VM_BODYREC+77,,AUTO
        12 000655   000000 631400 13                 EPPR1   0
        12 000656   000000 701000 xent               TSX1    VMD$PUT_HEADER
        12 000657   000661 702000 12                 TSX2    E_MOVE

      255     9777
      256     9778    1       RETURN;

   9778 12 000660   000000 702200 xent               TSX2  ! X66_ARET

      257     9779        /**/
      258     9780    1   E_MOVE:
      259     9781    1       ALTRETURN;

   9781 12 000661   000000 702200 xent  E_MOVE       TSX2  ! X66_AALT

      260     9782    1   E_BODY:
      261     9783    1       CALL M$SENV ALTRET(END_BODY);

   9783 12 000662   410011 713400       E_BODY       CLIMB   alt,+4105
        12 000663   000000 401760                    pmme    nvectors=0
        12 000664   000341 702000 12                 TSX2    END_BODY

      262     9784    1       VM_HEADER.NUM_RECORDS = I;
PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:39   

   9784 12 000665   000070 235000 11                 LDA     I
        12 000666   000000 470400 xsym               LDP0    VM_HEADER$
        12 000667   000011 755100                    STA     9,,PR0

      263     9785    1       CALL VMD$PUT_HEADER (OUT_NUM,OUT_DCB#)

   9785 12 000670   200006 236100                    LDQ     @OUT_DCB#,,AUTO
        12 000671   200004 235100                    LDA     @OUT_NUM,,AUTO
        12 000672   200132 757100                    STAQ    VM_BODYREC+77,,AUTO
        12 000673   200132 630500                    EPPR0   VM_BODYREC+77,,AUTO
        12 000674   000000 631400 13                 EPPR1   0
        12 000675   000000 701000 xent               TSX1    VMD$PUT_HEADER
        12 000676   000700 702000 12                 TSX2    s:9788
        12 000677   000700 710000 12                 TRA     s:9788

      264     9786    2       WHENALTRETURN DO;

      265     9787    2       END;

      266     9788    1       CALL M$RENV;

   9788 12 000700   010016 713400                    CLIMB   4110
        12 000701   000000 401760                    pmme    nvectors=0

      267     9789    1       ALTRETURN;

   9789 12 000702   000000 702200 xent               TSX2  ! X66_AALT

VM_SITE
 Sect OctLoc
  11     000   000000 000000   000000 000000   040040 040040   040040 040040    ........
  11     064*  ****** ******   ****** ******   ****** ******   ****** ******    ................

PAGESIZE
 Sect OctLoc
  11     073   000000 010000                                                    ....
PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:40   

(unnamed)
 Sect OctLoc
  13     000   000002 000000   000000 006000   000004 000000   000000 000021    ................
  13     004   000003 006000   000000 006000   000000 000031   000000 000041    ...............!
  13     010   000006 006000   000000 006000   000007 006000   000000 006000    ................
  13     014   000000 000000   000000 006014   000000 000020   000000 000030    ................
  13     020   000016 006000   000000 006000   000017 006000   000000 006000    ................
  13     024   000000 000040   000000 000044   000024 006000   000000 006000    ... ...$........
  13     030   000025 006000   000000 006000   000007 000000   000070 006000    .............8..
  13     034   000000 000144   777777 600000   000034 006000   000000 006000    ...d............
  13     040   000011 000000   000000 006000   000074 006000   000072 006000    .........<...:..
  13     044   000003 000000                                                    ....
      268     9790    1   END VMM$COPY_MESSAGE;
      269     9791        %EOD;

PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:41   
--  Include file information  --

   B_ERRORS_C.:LIB_E05  is referenced.
   B_MACROS_C.:LIB_E05  is referenced.
   VM_DATA_R.:VMB6TOU  cannot be made into a system file and is referenced.
   VM_SUBS_C.:VMB6TOU  is referenced.
   VM_MACRO_C.:VMB6TOU  is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   CP_6_C.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure VMM$COPY_MESSAGE.
PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:42   

 **** Variables and constants ****

  ****  Section 011  Data  VMM$COPY_MESSAGE

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    74-0-0/w SBIN        r     1 ENCL_NUM                  70-0-0/w SBIN        r     1 I
    71-0-0/w SBIN        r     1 J                         72-0-0/w SBIN        r     1 K
    73-0-0/w SBIN        r     1 PAGESIZE                   0-0-0/w STRC(2016)  r     1 VM_SITE

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     7-0-0/w PTR         r     1 @INSEED                    5-0-0/w PTR         r     1 @IN_DCB#
     3-0-0/w PTR         r     1 @IN_NUM                   10-0-0/w PTR         r     1 @OUTSEED
     6-0-0/w PTR         r     1 @OUT_DCB#                  4-0-0/w PTR         r     1 @OUT_NUM
    11-0-0/w SBIN        r     1 COUNT                     12-0-0/b BIT (8)     r     1 DVBYTE
    14-0-0/w PTR         r     1 ENCL$                     *0-0-0/w UBIN        r     1 INSEED
    *0-0-0/w UBIN        r     1 IN_DCB#                   *0-0-0/w SBIN        r     1 IN_NUM
    *0-0-0/w UBIN        r     1 OUTSEED                   *0-0-0/w UBIN        r     1 OUT_DCB#
    *0-0-0/w SBIN        r     1 OUT_NUM                   13-0-0/w UBIN              1 TSEEDIN
    15-0-0/w STRC(2772)  r     1 VM_BODYREC

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR               1 B$JIT$                     0-0-0/w PTR         r     1 B$TCB$
     0-0-0/c ASTR(9)     r     1 ERRMSG_FID                 0-0-0/w UBIN              1 M$DO_NUM
     0-0-0/w UBIN              1 M$LO_NUM                   0-0-0/w UBIN              1 M$MAIL_CENTRAL_NUM
     0-0-0/w UBIN              1 M$MAIL_COMGROUP_NUM        0-0-0/w UBIN              1 M$MAIL_FILE_NUM
     0-0-0/w UBIN              1 M$MAIL_GLOBAL_NUM          0-0-0/w UBIN              1 M$ME_NUM
     0-0-0/w UBIN              1 M$NODE_NUM                 0-0-0/w UBIN              1 M$SI_NUM
PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:43   
     0-0-0/w UBIN              1 M$WORK_NUM                 0-0-0/w PTR               1 VM_ADDLIST$
     0-0-0/d VECT              1 VM_ADDLIST_                0-0-0/w PTR               1 VM_ADDREC$
     0-0-0/d VECT              1 VM_ADDREC_                 0-0-0/w PTR               1 VM_COPY$
     0-0-0/d VECT              1 VM_COPY_                   0-0-0/w PTR         r     1 VM_ENCLLIST$
     0-0-0/d VECT        r     1 VM_ENCLLIST_               0-0-0/w PTR         r     1 VM_ENCLREC$
     0-0-0/d VECT        r     1 VM_ENCLREC_                0-0-0/c STRC(270)         1 VM_FORWARD_ENCL_NAME
     0-0-0/c STRC(270)         1 VM_FORWARD_FILE_NAME       0-0-0/c STRC(72)          1 VM_FORWARD_FILE_PASS
     0-0-0/w PTR         r     1 VM_HEADER$                 0-0-0/d VECT              1 VM_HEADER_
     0-0-0/d VECT              1 VM_HEADER_INIT_            0-0-0/w PTR               1 VM_INPUT$
     0-0-0/d VECT              1 VM_INPUT_                  0-0-0/c STRC(72)          1 VM_MAILCG_NAME
     0-0-0/w STRC(432)         1 VM_MAILCG_SETSTA           0-0-0/c STRC(72)          1 VM_MAIL_ACCT
     0-0-0/c STRC(54)          1 VM_NAME_MAP_NAME           0-0-0/w PTR               1 VM_PARSEAREA$
     0-0-0/d VECT              1 VM_PARSEAREA_              0-0-0/w PTR               1 VM_PROFILE$
     0-0-0/d VECT              1 VM_PROFILE_                0-0-0/w PTR               1 VM_SELECT$
     0-0-0/d VECT              1 VM_SELECT_                 0-0-0/c STRC(288)         1 VM_SEND_FILE_NAME
     0-0-0/c CHAR(8)           1 VM_SITENAME                0-0-0/w PTR               1 VM_WORK$
     0-0-0/d VECT        r     1 VM_WORK_                   0-0-0/b BIT         r     1 VO_NEED_READ
     0-0-0/b BIT         r     1 VO_PROCESS                 0-0-0/d STRC(504)   r     1 VO_READ_CG

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(2448)  r     1 B$ALT                      0-0-0/w STRC(144)   r     1 B$TCB
     0-0-0N  NULL        r     1 M$DO                       0-0-0N  NULL        r     1 M$LO
     0-0-0N  NULL        r     1 M$MAIL_CENTRAL             0-0-0N  NULL        r     1 M$MAIL_COMGROUP
     0-0-0N  NULL        r     1 M$MAIL_FILE                0-0-0N  NULL        r     1 M$MAIL_GLOBAL
     0-0-0N  NULL        r     1 M$ME                       0-0-0N  NULL        r     1 M$NODE
     0-0-0N  NULL        r     1 M$SI                       0-0-0N  NULL        r     1 M$UC
     0-0-0N  NULL        r     1 M$WORK                     0-0-0/w STRC(432)   r     1 VM_ENCLOS
     0-0-0/w ASTR(72)    r     1 VM_ENCLREC                 0-0-0/w STRC(252)   r     1 VM_ENCL_HEAD
     0-0-0/w STRC(1332)  r     1 VM_HEADER                  0-0-0/c ASTR(9)     r     1 X$STRING


   Procedure VMM$COPY_MESSAGE requires 451 words for executable code.
PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:44   
   Procedure VMM$COPY_MESSAGE requires 100 words of local(AUTO) storage.
PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:45   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:46   
          MINI XREF LISTING

B$ALT.CODE
      9223**DCL      9223--REDEF    9224--REDEF    9224--REDEF
B$ALT.ERR.CODE
      9225**DCL      9714>>IF       9729>>IF
B$ALT.ERR.ERR#
      9225**DCL      9225--REDEF
B$ALT.EVID
      9224**DCL      9224--REDEF    9224--REDEF
B$TCB.ALT$
      9219**DCL      9714>>IF       9729>>IF
B$TCB$
      7867**DCL      9219--IMP-PTR  9714>>IF       9729>>IF
COPY_THE_BODY
      9684**LABEL    9675--GOTO
COUNT
      9511**DCL      9687<>CALL     9689<>CALL     9726<>CALL     9734<>CALL     9754<>CALL     9756<>CALL
DVBYTE
      9512**DCL      9687<>CALL     9689<>CALL     9754<>CALL     9756<>CALL
ENCL$
      9516**DCL      9457--IMP-PTR  9721<<ASSIGN   9723>>ASSIGN   9724>>DOINDEX  9742<<ASSIGN   9742>>ASSIGN
ENCL_NUM
      9515**DCL      9723<<ASSIGN   9726<>CALL     9734<>CALL
END_BODY
      9699**LABEL    9687--CALLALT  9783--CALLALT
END_ENCL
      9747**LABEL    9718--GOTO
END_TRACE
      9766**LABEL    9754--CALLALT  9756--CALLALT
ERRMSG_FID.L#
      7935**DCL      7935--IMP-SIZ
E_BLIND
      9662**LABEL    9662--CALLALT  9663--CALLALT
PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:47   
E_BODY
      9783**LABEL    9689--CALLALT  9734--CALLALT  9744--CALLALT
E_COPY
      9654**LABEL    9654--CALLALT  9655--CALLALT
E_IBC
      9626**LABEL    9626--CALLALT  9627--CALLALT
E_IC
      9621**LABEL    9623--CALLALT  9624--CALLALT
E_ITO
      9621**LABEL    9620--CALLALT
E_MOVE
      9781**LABEL    9776--CALLALT
E_REPLYTO
      9670**LABEL    9670--CALLALT  9671--CALLALT
E_TO
      9646**LABEL    9621--CALLALT  9646--CALLALT  9647--CALLALT
I
      9508**DCL      9684<<ASSIGN   9687<>CALL     9689<>CALL     9691<<ASSIGN   9691>>ASSIGN   9699>>ASSIGN
      9704<<ASSIGN   9736<<ASSIGN   9736>>ASSIGN   9747>>ASSIGN   9751<<ASSIGN   9754<>CALL     9756<>CALL
      9758<<ASSIGN   9758>>ASSIGN   9766>>ASSIGN   9784>>ASSIGN
INSEED
      9235**DCL        30--PROC     9612--ENTRY    9677--ENTRY    9687<>CALL     9726<>CALL
IN_DCB#
      9233**DCL        30--PROC     9612--ENTRY    9618<>CALL     9620<>CALL     9623<>CALL     9626<>CALL
      9646<>CALL     9654<>CALL     9662<>CALL     9670<>CALL     9677--ENTRY    9687<>CALL     9712<>CALL
      9726<>CALL     9754<>CALL
IN_NUM
      9231**DCL        30--PROC     9612--ENTRY    9620<>CALL     9623<>CALL     9626<>CALL     9646<>CALL
      9654<>CALL     9662<>CALL     9670<>CALL     9677--ENTRY    9687<>CALL     9712<>CALL     9726<>CALL
      9754<>CALL
J
      9509**DCL      9722<<DOINDEX
K
      9510**DCL      9724<<DOINDEX  9726<>CALL     9734<>CALL
M$READ
      5520**DCL-ENT  9637--CALL     9694--CALL     9738--CALL     9761--CALL
PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:48   
M$RENV
      5575**DCL-ENT  9788--CALL
M$SENV
      5575**DCL-ENT  9783--CALL
NO_SITE
      9626**LABEL    9618--CALLALT  9619--CALLALT
OUTSEED
      9236**DCL        30--PROC     9612--ENTRY    9677--ENTRY    9689<>CALL     9734<>CALL
OUT_DCB#
      9234**DCL        30--PROC     9612--ENTRY    9619<>CALL     9621<>CALL     9624<>CALL     9627<>CALL
      9647<>CALL     9655<>CALL     9663<>CALL     9671<>CALL     9677--ENTRY    9689<>CALL     9734<>CALL
      9744<>CALL     9756<>CALL     9772<>CALL     9776<>CALL     9785<>CALL
OUT_NUM
      9232**DCL        30--PROC     9612--ENTRY    9621<>CALL     9624<>CALL     9627<>CALL     9647<>CALL
      9655<>CALL     9663<>CALL     9671<>CALL     9677--ENTRY    9689<>CALL     9734<>CALL     9744<>CALL
      9756<>CALL     9772<>CALL     9776<>CALL     9785<>CALL
PAGESIZE
      9514**DCL      9715>>ASSIGN   9730>>ASSIGN
READ_ENCL
      9724**LABEL    9731--GOTO
READ_ENCL_CONTEXT
      9692**LABEL    9716--GOTO
START_COPY
      9635**LABEL    9611--GOTO
VMA$GET_ADD_RECORD
      9280**DCL-ENT  9620--CALL     9623--CALL     9626--CALL     9646--CALL     9654--CALL     9662--CALL
      9670--CALL     9712--CALL
VMA$PUT_ADD_RECORD
      9281**DCL-ENT  9621--CALL     9624--CALL     9627--CALL     9647--CALL     9655--CALL     9663--CALL
      9671--CALL     9744--CALL
VMD$GET_BODY
      9284**DCL-ENT  9687--CALL
VMD$GET_ENCL
      9288**DCL-ENT  9726--CALL
VMD$GET_SITE
      9291**DCL-ENT  9618--CALL
PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:49   
VMD$GET_TRACE
      9286**DCL-ENT  9754--CALL
VMD$PUT_BODY
      9285**DCL-ENT  9689--CALL
VMD$PUT_ENCL
      9289**DCL-ENT  9734--CALL
VMD$PUT_HEADER
      9283**DCL-ENT  9776--CALL     9785--CALL
VMD$PUT_ID
      9290**DCL-ENT  9772--CALL
VMD$PUT_SITE
      9292**DCL-ENT  9619--CALL
VMD$PUT_TRACE
      9287**DCL-ENT  9756--CALL
VM_BODYREC
      9554**DCL      9687<>CALL     9689<>CALL     9754<>CALL     9756<>CALL
VM_BODYREC.VALUE.COUNT
      9560**DCL      9686<<ASSIGN   9753<<ASSIGN
VM_BODYREC.VALUE.DATA
      9572**DCL      9686--ASSIGN   9753--ASSIGN
VM_ENCLLIST$
      7804**DCL      9488--IMP-PTR  9721>>ASSIGN   9722>>DOINDEX
VM_ENCLLIST_
      7820**DCL      9712<>CALL     9715<<ASSIGN   9715>>ASSIGN   9744<>CALL
VM_ENCLOS.NEXT$
      9458**DCL      9742>>ASSIGN
VM_ENCLOS.NRECS
      9471**DCL      9724>>DOINDEX
VM_ENCLOS.TYPE
      9473**DCL      9723>>ASSIGN
VM_ENCLREC.VALUE.COUNT
      9593**DCL      9603--IMP-SIZ
VM_ENCLREC$
      7806**DCL      9587--IMP-PTR  9726<>CALL     9734<>CALL
VM_ENCLREC_
      7821**DCL      9730<<ASSIGN   9730>>ASSIGN
PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:50   
VM_ENCL_HEAD.HEAD$
      9498**DCL      9721>>ASSIGN
VM_ENCL_HEAD.NUM_ENTRIES
      9491**DCL      9722>>DOINDEX
VM_HEADER.BLIND$
      9390**DCL      9659>>IF
VM_HEADER.COPY$
      9392**DCL      9651>>IF
VM_HEADER.NUM_ENCL_RECORDS
      9416**DCL      9747<<ASSIGN
VM_HEADER.NUM_RECORDS
      9315**DCL      9699<<ASSIGN   9784<<ASSIGN
VM_HEADER.NUM_TRACE_RECORDS
      9414**DCL      9766<<ASSIGN
VM_HEADER.REPLY_TO$
      9400**DCL      9667>>IF
VM_HEADER.STATUS.ENCL
      9369**DCL      9705>>IF
VM_HEADER.TO$
      9408**DCL      9643>>IF
VM_HEADER.UNIQUE_ID$
      9410**DCL      9770>>IF       9772>>CALL     9772>>CALL
VM_HEADER$
      7785**DCL      9304--IMP-PTR  9643>>IF       9651>>IF       9659>>IF       9667>>IF       9699>>ASSIGN
      9705>>IF       9747>>ASSIGN   9766>>ASSIGN   9770>>IF       9772>>CALL     9772>>CALL     9784>>ASSIGN
VM_SITE
      9433**DCL      9618<>CALL     9619<>CALL
VM_WORK_
      7815**DCL      9620<>CALL     9621<>CALL     9623<>CALL     9624<>CALL     9626<>CALL     9627<>CALL
      9646<>CALL     9647<>CALL     9654<>CALL     9655<>CALL     9662<>CALL     9663<>CALL     9670<>CALL
      9671<>CALL
VOM$PROCESS
      9282**DCL-ENT  9639--CALL     9696--CALL     9740--CALL     9763--CALL
VO_NEED_READ
      9278**DCL      9635>>IF       9636<<ASSIGN   9692>>IF       9693<<ASSIGN   9735>>IF       9737<<ASSIGN
      9759>>IF       9760<<ASSIGN
PL6.E3A0      #001=VMM$COPY_MESSAGE File=VMM$MESSAGE.:VMB6TSI                    WED 08/20/97 15:16 Page:51   
VO_PROCESS
      9279**DCL      9639>>IF       9696>>IF       9740>>IF       9763>>IF
VO_READ_CG
      9256**DCL      9637<>CALL     9694<>CALL     9738<>CALL     9761<>CALL
VO_READ_CG.STATION_
      9259**DCL      9260--REDEF
VO_READ_CG.V.DVBYTE.REREAD#
      9271**DCL      9271--REDEF
VO_READ_CG.V.INDX#
      9269**DCL      9269--REDEF
X$STRING
      7780**DCL      9772<>CALL
X$STRING.SIZ
      7781**DCL      7782--IMP-SIZ  9772>>CALL

PL6.E3A0      #002=VMM$DELETE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                  WED 08/20/97 15:17 Page:52   
      270        1        /*T***********************************************************/
      271        2        /*T*                                                         */
      272        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      273        4        /*T*                                                         */
      274        5        /*T***********************************************************/
      275        6        /*X* DMC,PLM=4,IND=4,CTI=2,DTI=0,ENI=0,ECI=0,CSI=0,DCI=4 */
      276        7        /*P*
      277        8             NAME: VMM$DELETE_MESSAGE
      278        9             PURPOSE:
      279       10                  To delete specified messages.
      280       11             DESCRIPTION:
      281       12                  This routine has two parameters:
      282       13
      283       14                     MESSAGE_NUM   - number of the message to delete.
      284       15                     DCB#          - open to folder containing message to delete.
      285       16
      286       17                  This routine will delete the specified message in the folder
      287       18                  pointed to by DCB#.
      288       19        */
      289       20        VMM$DELETE_MESSAGE: PROC (MESSAGE_NUM, DCB#) ALTRET;
      290       21        /***** Include files *****/
      291       22         %INCLUDE CP_6;
      292     5581         %INCLUDE CP_6_SUBS;
      293     6121         %INCLUDE VM_MACRO_C;
      294     7389         %INCLUDE VM_SUBS_C;
      295     7649         %INCLUDE VM_DATA_R;
      296     8080        %INCLUDE B_ERRORS_C;
      297     9207
      298     9208        %B$TCB (STCLASS="BASED(B$TCB$)");
      299     9211        %B$ALT;
      300     9219
      301     9220        /***** Parameters *****/
      302     9221    1   DCL MESSAGE_NUM UBIN WORD;
      303     9222    1   DCL DCB# UBIN WORD;
      304     9223        /***** External routines *****/
      305     9224    1   DCL VMD$GET_HEADER ENTRY(2) ALTRET;
      306     9225    1   DCL VMD$DEL_HEADER ENTRY(2) ALTRET;
PL6.E3A0      #002=VMM$DELETE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                  WED 08/20/97 15:17 Page:53   
      307     9226    1   DCL VMD$DEL_BODY ENTRY (7) ALTRET;
      308     9227    1   DCL VMD$DEL_TRACE ENTRY (7) ALTRET;
      309     9228    1   DCL VMD$GET_ID ENTRY (3) ALTRET;
      310     9229    1   DCL VMD$DEL_ID ENTRY (2) ALTRET;
      311     9230    1   DCL VMA$DEL_ADD_RECORD ENTRY(4) ALTRET;
      312     9231    1   DCL VMA$GET_ADD_RECORD ENTRY (4) ALTRET;
      313     9232    1   DCL VMD$DEL_ENCL ENTRY(9) ALTRET;
      314     9233        /***** Mail structures *****/
      315     9234         %VM_HEADER;
      316     9363        %VM_KEYTYPES;
      317     9384        %VM_ADD_HEAD (NAME=VM_ENCL_HEAD,STCLASS="BASED(VM_ENCLLIST$)");
      318     9413        %VM_ENCLOS (STCLASS="BASED(ENCL$)");
      319     9444        /***** Local variables *****/
      320     9445    1   DCL I SBIN WORD STATIC;
      321     9446    1   DCL ENCL$ PTR;
      322     9447    1   DCL ENCL_NUM UBIN WORD STATIC;
      323     9448    1   DCL PAGESIZE SBIN WORD STATIC INIT(4096);
      324     9449        %EJECT;
PL6.E3A0      #002=VMM$DELETE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                  WED 08/20/97 15:17 Page:54   
      325     9450        /*
      326     9451            ***** Move the header first ...
      327     9452        */
      328     9453    1       CALL VMD$GET_HEADER (MESSAGE_NUM,DCB#) ALTRET(E_DELETE);
      329     9454    1       IF VM_HEADER.TO$ ~= ADDR(NIL) THEN
      330     9455    1           CALL VMA$DEL_ADD_RECORD (%VM_TYPE_TO,VM_WORK_,DCB#,MESSAGE_NUM);
      331     9456    1       IF VM_HEADER.COPY$ ~= ADDR(NIL) THEN
      332     9457    1           CALL VMA$DEL_ADD_RECORD (%VM_TYPE_C,VM_WORK_,DCB#,MESSAGE_NUM);
      333     9458    1       IF VM_HEADER.BLIND$ ~= ADDR(NIL) THEN
      334     9459    1           CALL VMA$DEL_ADD_RECORD (%VM_TYPE_BC,VM_WORK_,DCB#,MESSAGE_NUM);
      335     9460    1       IF VM_HEADER.REPLY_TO$ ~= ADDR(NIL) THEN
      336     9461    1           CALL VMA$DEL_ADD_RECORD (%VM_TYPE_RTO,VM_WORK_,DCB#,MESSAGE_NUM);
      337     9462    1       CALL VMD$DEL_HEADER (MESSAGE_NUM,DCB#);
      338     9463        /*
      339     9464            ***** Move all body records ...
      340     9465        */
      341     9466    1       I = VM_HEADER.NUM_RECORDS - 1;
      342     9467    1       IF I >= 0 THEN CALL VMD$DEL_BODY (MESSAGE_NUM,DCB#,0,I);
      343     9468
      344     9469        /*
      345     9470             ***** Delete all trace records
      346     9471        */
      347     9472    1       I = VM_HEADER.NUM_TRACE_RECORDS - 1;
      348     9473    1       IF I >= 0 THEN CALL VMD$DEL_TRACE (MESSAGE_NUM,DCB#,0,I);
      349     9474
      350     9475        /*
      351     9476            ***** Delete all the enclosure records ...
      352     9477        */
      353     9478    2       IF VM_HEADER.STATUS.ENCL = %YES# THEN DO;
      354     9479
      355     9480            /*
      356     9481               Read the enclosure context record
      357     9482            */
      358     9483
      359     9484    2   READ_ENCL_CONTEXT:;
      360     9485    2           CALL VMA$GET_ADD_RECORD (%VM_TYPE_ENCL,VM_ENCLLIST_,DCB#,MESSAGE_NUM)
      361     9486    3           WHENALTRETURN DO;
PL6.E3A0      #002=VMM$DELETE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                  WED 08/20/97 15:17 Page:55   
      362     9487    4               IF B$TCB.ALT$->B$ALT.ERR.CODE = %E$LD THEN DO;
      363     9488    4                   VBOUND(VM_ENCLLIST_) = VBOUND(VM_ENCLLIST_) + PAGESIZE;
      364     9489    4                   GOTO READ_ENCL_CONTEXT;
      365     9490    4               END;
      366     9491    3               ELSE GOTO OLD_ENCL;
      367     9492    3           END;
      368     9493
      369     9494    2           ENCL$ = VM_ENCL_HEAD.HEAD$;
      370     9495    3           DO I = 0 TO VM_ENCL_HEAD.NUM_ENTRIES - 1;
      371     9496    3               ENCL_NUM = VM_ENCLOS.TYPE - %VM_TYPE_ENCL;
      372     9497    3               CALL VMD$DEL_ENCL (MESSAGE_NUM,DCB#,0,VM_ENCLOS.NRECS,,,,ENCL_NUM,
              9497                        VM_ENCLREC$);
      373     9498    3               ENCL$ = VM_ENCLOS.NEXT$;
      374     9499    3           END;
      375     9500    2           CALL VMA$DEL_ADD_RECORD (%VM_TYPE_ENCL,VM_ENCLLIST_,DCB#,MESSAGE_NUM) ALTRET
              9500                    (E_DELETE);
      376     9501    2       END;
      377     9502        /*
      378     9503             ***** Delete the unique-id record if it's there and appropriate.
      379     9504        */
      380     9505
      381     9506    1   OLD_ENCL:
      382     9507    1       IF VM_HEADER.UNIQUE_ID$ ~= ADDR(NIL)
      383     9508    2       THEN DO;
      384     9509    2           CALL VMD$GET_ID (VM_HEADER.UNIQUE_ID$ -> X$STRING, DCB#, I)
      385     9510    3           WHENRETURN DO;
      386     9511    3               IF I = MESSAGE_NUM
      387     9512    3               THEN
      388     9513    3                   CALL VMD$DEL_ID (VM_HEADER.UNIQUE_ID$ -> X$STRING, DCB#);
      389     9514    3           END;
      390     9515    2       END;
      391     9516
      392     9517    1       RETURN;
      393     9518        /**/
      394     9519    1   E_DELETE:
      395     9520    1       ALTRETURN;
      396     9521    1   END VMM$DELETE_MESSAGE;
PL6.E3A0      #002=VMM$DELETE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                  WED 08/20/97 15:17 Page:56   
      397     9522        %EOD;

PL6.E3A0      #002=VMM$DELETE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                  WED 08/20/97 15:17 Page:57   
--  Include file information  --

   B_ERRORS_C.:LIB_E05  is referenced.
   B_MACROS_C.:LIB_E05  is referenced.
   VM_DATA_R.:VMB6TOU  cannot be made into a system file and is referenced.
   VM_SUBS_C.:VMB6TOU  is referenced.
   VM_MACRO_C.:VMB6TOU  is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   CP_6_C.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure VMM$DELETE_MESSAGE.

   Procedure VMM$DELETE_MESSAGE requires 195 words for executable code.
   Procedure VMM$DELETE_MESSAGE requires 16 words of local(AUTO) storage.

PL6.E3A0      #002=VMM$DELETE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                  WED 08/20/97 15:17 Page:58   

 Object Unit name= VMM$DELETE_MESSAGE                         File name= VMM$MESSAGE.:VMB6TOU
 UTS= AUG 20 '97 15:17:19.28 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   DCB   even  none     0      0  M$MAIL_FILE
    2   DCB   even  none     0      0  M$MAIL_CENTRAL
    3   DCB   even  none     0      0  M$MAIL_GLOBAL
    4   DCB   even  none     0      0  M$WORK
    5   DCB   even  none     0      0  M$MAIL_COMGROUP
    6   DCB   even  none     0      0  M$DO
    7   DCB   even  none     0      0  M$LO
    8   DCB   even  none     0      0  M$ME
    9   DCB   even  none     0      0  M$NODE
   10   DCB   even  none     0      0  M$SI
   11   Data  even  none     3      3  VMM$DELETE_MESSAGE
   12   Proc  even  none   195    303  VMM$DELETE_MESSAGE
   13  RoData even  none    26     32  VMM$DELETE_MESSAGE

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
    12      0   yes    yes     yes      Std        2  VMM$DELETE_MESSAGE
PL6.E3A0      #002=VMM$DELETE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                  WED 08/20/97 15:17 Page:59   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       2 VMD$GET_HEADER
 yes     yes           Std       2 VMD$DEL_HEADER
 yes     yes           Std       4 VMA$GET_ADD_RECORD
 yes     yes           Std       7 VMD$DEL_TRACE
 yes     yes           Std       4 VMA$DEL_ADD_RECORD
 yes     yes           Std       3 VMD$GET_ID
 yes     yes           Std       7 VMD$DEL_BODY
 yes     yes           Std       9 VMD$DEL_ENCL
 yes     yes           Std       2 VMD$DEL_ID
                       nStd      0 X66_AUTO_2
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                             r    VM_HEADER$                       r    VM_PROFILE$
r    VM_ADDLIST$                      r    VM_ADDREC$                       r    VM_WORK$
r    VM_SELECT$                       r    VM_PARSEAREA$                    r    VM_INPUT$
r    VM_COPY$                              VM_ENCLLIST$                          VM_ENCLREC$
     VM_HEADER_                            VM_HEADER_INIT_                       VM_PROFILE_
     VM_ADDLIST_                           VM_ADDREC_                            VM_WORK_
     VM_SELECT_                            VM_PARSEAREA_                         VM_INPUT_
     VM_COPY_                              VM_ENCLLIST_                          VM_ENCLREC_
     M$MAIL_FILE                           M$MAIL_CENTRAL                        M$MAIL_GLOBAL
     M$WORK                                M$MAIL_COMGROUP                       M$DO
     M$LO                                  M$ME                                  M$NODE
     M$SI                                  M$MAIL_FILE_NUM                       M$MAIL_CENTRAL_NUM
     M$MAIL_GLOBAL_NUM                     M$WORK_NUM                            M$MAIL_COMGROUP_NUM
     M$DO_NUM                              M$ME_NUM                              M$LO_NUM
     M$SI_NUM                              M$NODE_NUM                       r    B$JIT$
PL6.E3A0      #002=VMM$DELETE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                  WED 08/20/97 15:17 Page:60   
r    B$TCB$                                VM_MAIL_ACCT                          VM_NAME_MAP_NAME
     ERRMSG_FID                            VM_SEND_FILE_NAME                     VM_FORWARD_FILE_NAME
     VM_FORWARD_ENCL_NAME                  VM_FORWARD_FILE_PASS                  VM_MAILCG_NAME
     VM_SITENAME                           VM_MAILCG_SETSTA

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     NULLSID                               ISSID
PL6.E3A0      #002=VMM$DELETE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                  WED 08/20/97 15:17 Page:61   


      270        1        /*T***********************************************************/
      271        2        /*T*                                                         */
      272        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      273        4        /*T*                                                         */
      274        5        /*T***********************************************************/
      275        6        /*X* DMC,PLM=4,IND=4,CTI=2,DTI=0,ENI=0,ECI=0,CSI=0,DCI=4 */
      276        7        /*P*
      277        8             NAME: VMM$DELETE_MESSAGE
      278        9             PURPOSE:
      279       10                  To delete specified messages.
      280       11             DESCRIPTION:
      281       12                  This routine has two parameters:
      282       13
      283       14                     MESSAGE_NUM   - number of the message to delete.
      284       15                     DCB#          - open to folder containing message to delete.
      285       16
      286       17                  This routine will delete the specified message in the folder
      287       18                  pointed to by DCB#.
      288       19        */
      289       20        VMM$DELETE_MESSAGE: PROC (MESSAGE_NUM, DCB#) ALTRET;

     20 12 000000   000000 700200 xent  VMM$DELETE_* TSX0  ! X66_AUTO_2
        12 000001   000020 000002                    ZERO    16,2

      290       21        /***** Include files *****/
      291       22         %INCLUDE CP_6;
      292     5581         %INCLUDE CP_6_SUBS;
      293     6121         %INCLUDE VM_MACRO_C;
      294     7389         %INCLUDE VM_SUBS_C;
      295     7649         %INCLUDE VM_DATA_R;
      296     8080        %INCLUDE B_ERRORS_C;
      297     9207
      298     9208        %B$TCB (STCLASS="BASED(B$TCB$)");
      299     9211        %B$ALT;
      300     9219
      301     9220        /***** Parameters *****/
PL6.E3A0      #002=VMM$DELETE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                  WED 08/20/97 15:17 Page:62   
      302     9221    1   DCL MESSAGE_NUM UBIN WORD;
      303     9222    1   DCL DCB# UBIN WORD;
      304     9223        /***** External routines *****/
      305     9224    1   DCL VMD$GET_HEADER ENTRY(2) ALTRET;
      306     9225    1   DCL VMD$DEL_HEADER ENTRY(2) ALTRET;
      307     9226    1   DCL VMD$DEL_BODY ENTRY (7) ALTRET;
      308     9227    1   DCL VMD$DEL_TRACE ENTRY (7) ALTRET;
      309     9228    1   DCL VMD$GET_ID ENTRY (3) ALTRET;
      310     9229    1   DCL VMD$DEL_ID ENTRY (2) ALTRET;
      311     9230    1   DCL VMA$DEL_ADD_RECORD ENTRY(4) ALTRET;
      312     9231    1   DCL VMA$GET_ADD_RECORD ENTRY (4) ALTRET;
      313     9232    1   DCL VMD$DEL_ENCL ENTRY(9) ALTRET;
      314     9233        /***** Mail structures *****/
      315     9234         %VM_HEADER;
      316     9363        %VM_KEYTYPES;
      317     9384        %VM_ADD_HEAD (NAME=VM_ENCL_HEAD,STCLASS="BASED(VM_ENCLLIST$)");
      318     9413        %VM_ENCLOS (STCLASS="BASED(ENCL$)");
      319     9444        /***** Local variables *****/
      320     9445    1   DCL I SBIN WORD STATIC;
      321     9446    1   DCL ENCL$ PTR;
      322     9447    1   DCL ENCL_NUM UBIN WORD STATIC;
      323     9448    1   DCL PAGESIZE SBIN WORD STATIC INIT(4096);
      324     9449        %EJECT;
PL6.E3A0      #002=VMM$DELETE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                  WED 08/20/97 15:17 Page:63   
      325     9450        /*
      326     9451            ***** Move the header first ...
      327     9452        */
      328     9453    1       CALL VMD$GET_HEADER (MESSAGE_NUM,DCB#) ALTRET(E_DELETE);

   9453 12 000002   200003 630500                    EPPR0   @MESSAGE_NUM,,AUTO
        12 000003   000000 631400 13                 EPPR1   0
        12 000004   000000 701000 xent               TSX1    VMD$GET_HEADER
        12 000005   000302 702000 12                 TSX2    E_DELETE

      329     9454    1       IF VM_HEADER.TO$ ~= ADDR(NIL) THEN

   9454 12 000006   000000 470400 xsym               LDP0    VM_HEADER$
        12 000007   000031 236100                    LDQ     25,,PR0
        12 000010   000001 116000 13                 CMPQ    1
        12 000011   000023 600000 12                 TZE     s:9456

      330     9455    1           CALL VMA$DEL_ADD_RECORD (%VM_TYPE_TO,VM_WORK_,DCB#,MESSAGE_NUM);

   9455 12 000012   200003 236100                    LDQ     @MESSAGE_NUM,,AUTO
        12 000013   200004 235100                    LDA     @DCB#,,AUTO
        12 000014   200010 757100                    STAQ    ENCL$+3,,AUTO
        12 000015   000004 237000 13                 LDAQ    4
        12 000016   200006 757100                    STAQ    ENCL$+1,,AUTO
        12 000017   200006 630500                    EPPR0   ENCL$+1,,AUTO
        12 000020   000002 631400 13                 EPPR1   2
        12 000021   000000 701000 xent               TSX1    VMA$DEL_ADD_RECORD
        12 000022   000000 011000                    NOP     0

      331     9456    1       IF VM_HEADER.COPY$ ~= ADDR(NIL) THEN

   9456 12 000023   000000 470400 xsym               LDP0    VM_HEADER$
        12 000024   000021 236100                    LDQ     17,,PR0
        12 000025   000001 116000 13                 CMPQ    1
        12 000026   000040 600000 12                 TZE     s:9458

      332     9457    1           CALL VMA$DEL_ADD_RECORD (%VM_TYPE_C,VM_WORK_,DCB#,MESSAGE_NUM);
PL6.E3A0      #002=VMM$DELETE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                  WED 08/20/97 15:17 Page:64   

   9457 12 000027   200003 236100                    LDQ     @MESSAGE_NUM,,AUTO
        12 000030   200004 235100                    LDA     @DCB#,,AUTO
        12 000031   200010 757100                    STAQ    ENCL$+3,,AUTO
        12 000032   000010 237000 13                 LDAQ    8
        12 000033   200006 757100                    STAQ    ENCL$+1,,AUTO
        12 000034   200006 630500                    EPPR0   ENCL$+1,,AUTO
        12 000035   000002 631400 13                 EPPR1   2
        12 000036   000000 701000 xent               TSX1    VMA$DEL_ADD_RECORD
        12 000037   000000 011000                    NOP     0

      333     9458    1       IF VM_HEADER.BLIND$ ~= ADDR(NIL) THEN

   9458 12 000040   000000 470400 xsym               LDP0    VM_HEADER$
        12 000041   000020 236100                    LDQ     16,,PR0
        12 000042   000001 116000 13                 CMPQ    1
        12 000043   000055 600000 12                 TZE     s:9460

      334     9459    1           CALL VMA$DEL_ADD_RECORD (%VM_TYPE_BC,VM_WORK_,DCB#,MESSAGE_NUM);

   9459 12 000044   200003 236100                    LDQ     @MESSAGE_NUM,,AUTO
        12 000045   200004 235100                    LDA     @DCB#,,AUTO
        12 000046   200010 757100                    STAQ    ENCL$+3,,AUTO
        12 000047   000012 237000 13                 LDAQ    10
        12 000050   200006 757100                    STAQ    ENCL$+1,,AUTO
        12 000051   200006 630500                    EPPR0   ENCL$+1,,AUTO
        12 000052   000002 631400 13                 EPPR1   2
        12 000053   000000 701000 xent               TSX1    VMA$DEL_ADD_RECORD
        12 000054   000000 011000                    NOP     0

      335     9460    1       IF VM_HEADER.REPLY_TO$ ~= ADDR(NIL) THEN

   9460 12 000055   000000 470400 xsym               LDP0    VM_HEADER$
        12 000056   000025 236100                    LDQ     21,,PR0
        12 000057   000001 116000 13                 CMPQ    1
        12 000060   000072 600000 12                 TZE     s:9462

PL6.E3A0      #002=VMM$DELETE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                  WED 08/20/97 15:17 Page:65   
      336     9461    1           CALL VMA$DEL_ADD_RECORD (%VM_TYPE_RTO,VM_WORK_,DCB#,MESSAGE_NUM);

   9461 12 000061   200003 236100                    LDQ     @MESSAGE_NUM,,AUTO
        12 000062   200004 235100                    LDA     @DCB#,,AUTO
        12 000063   200010 757100                    STAQ    ENCL$+3,,AUTO
        12 000064   000016 237000 13                 LDAQ    14
        12 000065   200006 757100                    STAQ    ENCL$+1,,AUTO
        12 000066   200006 630500                    EPPR0   ENCL$+1,,AUTO
        12 000067   000002 631400 13                 EPPR1   2
        12 000070   000000 701000 xent               TSX1    VMA$DEL_ADD_RECORD
        12 000071   000000 011000                    NOP     0

      337     9462    1       CALL VMD$DEL_HEADER (MESSAGE_NUM,DCB#);

   9462 12 000072   200003 630500                    EPPR0   @MESSAGE_NUM,,AUTO
        12 000073   000000 631400 13                 EPPR1   0
        12 000074   000000 701000 xent               TSX1    VMD$DEL_HEADER
        12 000075   000000 011000                    NOP     0

      338     9463        /*
      339     9464            ***** Move all body records ...
      340     9465        */
      341     9466    1       I = VM_HEADER.NUM_RECORDS - 1;

   9466 12 000076   000000 470400 xsym               LDP0    VM_HEADER$
        12 000077   000011 235100                    LDA     9,,PR0
        12 000100   000001 135007                    SBLA    1,DL
        12 000101   000000 755000 11                 STA     I

      342     9467    1       IF I >= 0 THEN CALL VMD$DEL_BODY (MESSAGE_NUM,DCB#,0,I);

   9467 12 000102   000114 604000 12                 TMI     s:9472

   9467 12 000103   000020 237000 13                 LDAQ    16
        12 000104   200010 757100                    STAQ    ENCL$+3,,AUTO
        12 000105   200004 236100                    LDQ     @DCB#,,AUTO
        12 000106   200003 235100                    LDA     @MESSAGE_NUM,,AUTO
PL6.E3A0      #002=VMM$DELETE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                  WED 08/20/97 15:17 Page:66   
        12 000107   200006 757100                    STAQ    ENCL$+1,,AUTO
        12 000110   200006 630500                    EPPR0   ENCL$+1,,AUTO
        12 000111   000002 631400 13                 EPPR1   2
        12 000112   000000 701000 xent               TSX1    VMD$DEL_BODY
        12 000113   000000 011000                    NOP     0

      343     9468
      344     9469        /*
      345     9470             ***** Delete all trace records
      346     9471        */
      347     9472    1       I = VM_HEADER.NUM_TRACE_RECORDS - 1;

   9472 12 000114   000000 470400 xsym               LDP0    VM_HEADER$
        12 000115   000034 235100                    LDA     28,,PR0
        12 000116   000001 135007                    SBLA    1,DL
        12 000117   000000 755000 11                 STA     I

      348     9473    1       IF I >= 0 THEN CALL VMD$DEL_TRACE (MESSAGE_NUM,DCB#,0,I);

   9473 12 000120   000132 604000 12                 TMI     s:9478

   9473 12 000121   000020 237000 13                 LDAQ    16
        12 000122   200010 757100                    STAQ    ENCL$+3,,AUTO
        12 000123   200004 236100                    LDQ     @DCB#,,AUTO
        12 000124   200003 235100                    LDA     @MESSAGE_NUM,,AUTO
        12 000125   200006 757100                    STAQ    ENCL$+1,,AUTO
        12 000126   200006 630500                    EPPR0   ENCL$+1,,AUTO
        12 000127   000002 631400 13                 EPPR1   2
        12 000130   000000 701000 xent               TSX1    VMD$DEL_TRACE
        12 000131   000000 011000                    NOP     0

      349     9474
      350     9475        /*
      351     9476            ***** Delete all the enclosure records ...
      352     9477        */
      353     9478    2       IF VM_HEADER.STATUS.ENCL = %YES# THEN DO;

PL6.E3A0      #002=VMM$DELETE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                  WED 08/20/97 15:17 Page:67   
   9478 12 000132   000000 470400 xsym               LDP0    VM_HEADER$
        12 000133   000012 236100                    LDQ     10,,PR0
        12 000134   004000 316007                    CANQ    2048,DL
        12 000135   000245 600000 12                 TZE     OLD_ENCL

   9473 12 000136                       READ_ENCL_C* null
      354     9479
      355     9480            /*
      356     9481               Read the enclosure context record
      357     9482            */
      358     9483
      359     9484    2   READ_ENCL_CONTEXT:;
      360     9485    2           CALL VMA$GET_ADD_RECORD (%VM_TYPE_ENCL,VM_ENCLLIST_,DCB#,MESSAGE_NUM)

   9485 12 000136   200003 236100                    LDQ     @MESSAGE_NUM,,AUTO
        12 000137   200004 235100                    LDA     @DCB#,,AUTO
        12 000140   200010 757100                    STAQ    ENCL$+3,,AUTO
        12 000141   000024 237000 13                 LDAQ    20
        12 000142   200006 757100                    STAQ    ENCL$+1,,AUTO
        12 000143   200006 630500                    EPPR0   ENCL$+1,,AUTO
        12 000144   000002 631400 13                 EPPR1   2
        12 000145   000000 701000 xent               TSX1    VMA$GET_ADD_RECORD
        12 000146   000150 702000 12                 TSX2    s:9487
        12 000147   000166 710000 12                 TRA     s:9494

      361     9486    3           WHENALTRETURN DO;

      362     9487    4               IF B$TCB.ALT$->B$ALT.ERR.CODE = %E$LD THEN DO;

   9487 12 000150   000000 470400 xsym               LDP0    B$TCB$
        12 000151   000000 471500                    LDP1    0,,PR0
        12 000152   100102 236100                    LDQ     66,,PR1
        12 000153   377770 376007                    ANQ     131064,DL
        12 000154   000070 116007                    CMPQ    56,DL
        12 000155   000245 601000 12                 TNZ     OLD_ENCL

      363     9488    4                   VBOUND(VM_ENCLLIST_) = VBOUND(VM_ENCLLIST_) + PAGESIZE;
PL6.E3A0      #002=VMM$DELETE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                  WED 08/20/97 15:17 Page:68   

   9488 12 000156   000000 236000 xsym               LDQ     VM_ENCLLIST_
        12 000157   000020 772000                    QRL     16
        12 000160   000002 036000 11                 ADLQ    PAGESIZE
        12 000161   000020 736000                    QLS     16
        12 000162   000000 676000 xsym               ERQ     VM_ENCLLIST_
        12 000163   000023 376000 13                 ANQ     19
        12 000164   000000 656000 xsym               ERSQ    VM_ENCLLIST_

      364     9489    4                   GOTO READ_ENCL_CONTEXT;

   9489 12 000165   000136 710000 12                 TRA     READ_ENCL_CONTEXT

      365     9490    4               END;
      366     9491    3               ELSE GOTO OLD_ENCL;
      367     9492    3           END;
      368     9493
      369     9494    2           ENCL$ = VM_ENCL_HEAD.HEAD$;

   9494 12 000166   000000 470400 xsym               LDP0    VM_ENCLLIST$
        12 000167   000003 236100                    LDQ     3,,PR0
        12 000170   200005 756100                    STQ     ENCL$,,AUTO

      370     9495    3           DO I = 0 TO VM_ENCL_HEAD.NUM_ENTRIES - 1;

   9495 12 000171   000000 450000 11                 STZ     I
        12 000172   000227 710000 12                 TRA     s:9499+1

      371     9496    3               ENCL_NUM = VM_ENCLOS.TYPE - %VM_TYPE_ENCL;

   9496 12 000173   200005 470500                    LDP0    ENCL$,,AUTO
        12 000174   000012 236100                    LDQ     10,,PR0
        12 000175   000033 772000                    QRL     27
        12 000176   000144 136007                    SBLQ    100,DL
        12 000177   000001 756000 11                 STQ     ENCL_NUM

      372     9497    3               CALL VMD$DEL_ENCL (MESSAGE_NUM,DCB#,0,VM_ENCLOS.NRECS,,,,ENCL_NUM,
PL6.E3A0      #002=VMM$DELETE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                  WED 08/20/97 15:17 Page:69   
              9497                        VM_ENCLREC$);

   9497 12 000200   000027 236000 13                 LDQ     23
        12 000201   200016 756100                    STQ     ENCL$+9,,AUTO
        12 000202   000030 236000 13                 LDQ     24
        12 000203   000001 235000 13                 LDA     1
        12 000204   200014 757100                    STAQ    ENCL$+7,,AUTO
        12 000205   000001 236000 13                 LDQ     1
        12 000206   000001 235000 13                 LDA     1
        12 000207   200012 757100                    STAQ    ENCL$+5,,AUTO
        12 000210   200005 236100                    LDQ     ENCL$,,AUTO
        12 000211   000011 036003                    ADLQ    9,DU
        12 000212   000020 235000 13                 LDA     16
        12 000213   200010 757100                    STAQ    ENCL$+3,,AUTO
        12 000214   200004 236100                    LDQ     @DCB#,,AUTO
        12 000215   200003 235100                    LDA     @MESSAGE_NUM,,AUTO
        12 000216   200006 757100                    STAQ    ENCL$+1,,AUTO
        12 000217   200006 630500                    EPPR0   ENCL$+1,,AUTO
        12 000220   000026 631400 13                 EPPR1   22
        12 000221   000000 701000 xent               TSX1    VMD$DEL_ENCL
        12 000222   000000 011000                    NOP     0

      373     9498    3               ENCL$ = VM_ENCLOS.NEXT$;

   9498 12 000223   200005 470500                    LDP0    ENCL$,,AUTO
        12 000224   000000 236100                    LDQ     0,,PR0
        12 000225   200005 756100                    STQ     ENCL$,,AUTO

      374     9499    3           END;

   9499 12 000226   000000 054000 11                 AOS     I
        12 000227   000000 470400 xsym               LDP0    VM_ENCLLIST$
        12 000230   000000 236000 11                 LDQ     I
        12 000231   000173 604000 12                 TMI     s:9496
        12 000232   000001 116100                    CMPQ    1,,PR0
        12 000233   000173 602000 12                 TNC     s:9496

PL6.E3A0      #002=VMM$DELETE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                  WED 08/20/97 15:17 Page:70   
      375     9500    2          CALL VMA$DEL_ADD_RECORD (%VM_TYPE_ENCL,VM_ENCLLIST_,DCB#,MESSAGE_NUM) ALTRET
              9500                    (E_DELETE);

   9500 12 000234   200003 236100                    LDQ     @MESSAGE_NUM,,AUTO
        12 000235   200004 235100                    LDA     @DCB#,,AUTO
        12 000236   200010 757100                    STAQ    ENCL$+3,,AUTO
        12 000237   000024 237000 13                 LDAQ    20
        12 000240   200006 757100                    STAQ    ENCL$+1,,AUTO
        12 000241   200006 630500                    EPPR0   ENCL$+1,,AUTO
        12 000242   000002 631400 13                 EPPR1   2
        12 000243   000000 701000 xent               TSX1    VMA$DEL_ADD_RECORD
        12 000244   000302 702000 12                 TSX2    E_DELETE

      376     9501    2       END;

      377     9502        /*
      378     9503             ***** Delete the unique-id record if it's there and appropriate.
      379     9504        */
      380     9505
      381     9506    1   OLD_ENCL:
      382     9507    1       IF VM_HEADER.UNIQUE_ID$ ~= ADDR(NIL)

   9507 12 000245   000000 470400 xsym  OLD_ENCL     LDP0    VM_HEADER$
        12 000246   000032 236100                    LDQ     26,,PR0
        12 000247   000001 116000 13                 CMPQ    1
        12 000250   000301 600000 12                 TZE     s:9517

      383     9508    2       THEN DO;

      384     9509    2           CALL VMD$GET_ID (VM_HEADER.UNIQUE_ID$ -> X$STRING, DCB#, I)

   9509 12 000251   000032 471500                    LDP1    26,,PR0
        12 000252   000021 236000 13                 LDQ     17
        12 000253   200010 756100                    STQ     ENCL$+3,,AUTO
        12 000254   200004 236100                    LDQ     @DCB#,,AUTO
        12 000255   200007 756100                    STQ     ENCL$+2,,AUTO
        12 000256   200006 451500                    STP1    ENCL$+1,,AUTO
PL6.E3A0      #002=VMM$DELETE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                  WED 08/20/97 15:17 Page:71   
        12 000257   200006 630500                    EPPR0   ENCL$+1,,AUTO
        12 000260   000031 631400 13                 EPPR1   25
        12 000261   000000 701000 xent               TSX1    VMD$GET_ID
        12 000262   000301 702000 12                 TSX2    s:9517

      385     9510    3           WHENRETURN DO;

      386     9511    3               IF I = MESSAGE_NUM

   9511 12 000263   200003 470500                    LDP0    @MESSAGE_NUM,,AUTO
        12 000264   000000 236000 11                 LDQ     I
        12 000265   000301 604000 12                 TMI     s:9517
        12 000266   000000 116100                    CMPQ    0,,PR0
        12 000267   000301 601000 12                 TNZ     s:9517

      387     9512    3               THEN
      388     9513    3                   CALL VMD$DEL_ID (VM_HEADER.UNIQUE_ID$ -> X$STRING, DCB#);

   9513 12 000270   000000 471400 xsym               LDP1    VM_HEADER$
        12 000271   100032 473500                    LDP3    26,,PR1
        12 000272   200004 236100                    LDQ     @DCB#,,AUTO
        12 000273   200007 756100                    STQ     ENCL$+2,,AUTO
        12 000274   200006 453500                    STP3    ENCL$+1,,AUTO
        12 000275   200006 630500                    EPPR0   ENCL$+1,,AUTO
        12 000276   000000 631400 13                 EPPR1   0
        12 000277   000000 701000 xent               TSX1    VMD$DEL_ID
        12 000300   000000 011000                    NOP     0

      389     9514    3           END;

      390     9515    2       END;

      391     9516
      392     9517    1       RETURN;

   9517 12 000301   000000 702200 xent               TSX2  ! X66_ARET

PL6.E3A0      #002=VMM$DELETE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                  WED 08/20/97 15:17 Page:72   
      393     9518        /**/
      394     9519    1   E_DELETE:
      395     9520    1       ALTRETURN;

   9520 12 000302   000000 702200 xent  E_DELETE     TSX2  ! X66_AALT

PAGESIZE
 Sect OctLoc
  11     002   000000 010000                                                    ....

(unnamed)
 Sect OctLoc
  13     000   000002 000000   000000 006014   000004 000000   000000 000020    ................
  13     004   000003 006000   000000 006000   000000 000030   000000 000040    ...............
  13     010   000006 006000   000000 006000   000007 006000   000000 006000    ................
  13     014   000000 000044   000000 000000   000014 006000   000000 006000    ...$............
  13     020   000015 006000   000000 006000   000000 000144   777777 600000    ...........d....
  13     024   000022 006000   000000 006000   000011 000000   000000 006000    ................
  13     030   000001 006000   000003 000000                                    ........
      396     9521    1   END VMM$DELETE_MESSAGE;
      397     9522        %EOD;

PL6.E3A0      #002=VMM$DELETE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                  WED 08/20/97 15:17 Page:73   
--  Include file information  --

   B_ERRORS_C.:LIB_E05  is referenced.
   B_MACROS_C.:LIB_E05  is referenced.
   VM_DATA_R.:VMB6TOU  cannot be made into a system file and is referenced.
   VM_SUBS_C.:VMB6TOU  is referenced.
   VM_MACRO_C.:VMB6TOU  is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   CP_6_C.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure VMM$DELETE_MESSAGE.
PL6.E3A0      #002=VMM$DELETE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                  WED 08/20/97 15:17 Page:74   

 **** Variables and constants ****

  ****  Section 011  Data  VMM$DELETE_MESSAGE

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     1-0-0/w UBIN        r     1 ENCL_NUM                   0-0-0/w SBIN        r     1 I
     2-0-0/w SBIN        r     1 PAGESIZE

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @DCB#                      3-0-0/w PTR         r     1 @MESSAGE_NUM
    *0-0-0/w UBIN        r     1 DCB#                       5-0-0/w PTR         r     1 ENCL$
    *0-0-0/w UBIN        r     1 MESSAGE_NUM

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR               1 B$JIT$                     0-0-0/w PTR         r     1 B$TCB$
     0-0-0/c ASTR(9)     r     1 ERRMSG_FID                 0-0-0/w UBIN              1 M$DO_NUM
     0-0-0/w UBIN              1 M$LO_NUM                   0-0-0/w UBIN              1 M$MAIL_CENTRAL_NUM
     0-0-0/w UBIN              1 M$MAIL_COMGROUP_NUM        0-0-0/w UBIN              1 M$MAIL_FILE_NUM
     0-0-0/w UBIN              1 M$MAIL_GLOBAL_NUM          0-0-0/w UBIN              1 M$ME_NUM
     0-0-0/w UBIN              1 M$NODE_NUM                 0-0-0/w UBIN              1 M$SI_NUM
     0-0-0/w UBIN              1 M$WORK_NUM                 0-0-0/w PTR               1 VM_ADDLIST$
     0-0-0/d VECT              1 VM_ADDLIST_                0-0-0/w PTR               1 VM_ADDREC$
     0-0-0/d VECT              1 VM_ADDREC_                 0-0-0/w PTR               1 VM_COPY$
     0-0-0/d VECT              1 VM_COPY_                   0-0-0/w PTR         r     1 VM_ENCLLIST$
     0-0-0/d VECT        r     1 VM_ENCLLIST_               0-0-0/w PTR         r     1 VM_ENCLREC$
     0-0-0/d VECT              1 VM_ENCLREC_                0-0-0/c STRC(270)         1 VM_FORWARD_ENCL_NAME
     0-0-0/c STRC(270)         1 VM_FORWARD_FILE_NAME       0-0-0/c STRC(72)          1 VM_FORWARD_FILE_PASS
PL6.E3A0      #002=VMM$DELETE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                  WED 08/20/97 15:17 Page:75   
     0-0-0/w PTR         r     1 VM_HEADER$                 0-0-0/d VECT              1 VM_HEADER_
     0-0-0/d VECT              1 VM_HEADER_INIT_            0-0-0/w PTR               1 VM_INPUT$
     0-0-0/d VECT              1 VM_INPUT_                  0-0-0/c STRC(72)          1 VM_MAILCG_NAME
     0-0-0/w STRC(432)         1 VM_MAILCG_SETSTA           0-0-0/c STRC(72)          1 VM_MAIL_ACCT
     0-0-0/c STRC(54)          1 VM_NAME_MAP_NAME           0-0-0/w PTR               1 VM_PARSEAREA$
     0-0-0/d VECT              1 VM_PARSEAREA_              0-0-0/w PTR               1 VM_PROFILE$
     0-0-0/d VECT              1 VM_PROFILE_                0-0-0/w PTR               1 VM_SELECT$
     0-0-0/d VECT              1 VM_SELECT_                 0-0-0/c STRC(288)         1 VM_SEND_FILE_NAME
     0-0-0/c CHAR(8)           1 VM_SITENAME                0-0-0/w PTR               1 VM_WORK$
     0-0-0/d VECT        r     1 VM_WORK_

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(2448)  r     1 B$ALT                      0-0-0/w STRC(144)   r     1 B$TCB
     0-0-0N  NULL        r     1 M$DO                       0-0-0N  NULL        r     1 M$LO
     0-0-0N  NULL        r     1 M$MAIL_CENTRAL             0-0-0N  NULL        r     1 M$MAIL_COMGROUP
     0-0-0N  NULL        r     1 M$MAIL_FILE                0-0-0N  NULL        r     1 M$MAIL_GLOBAL
     0-0-0N  NULL        r     1 M$ME                       0-0-0N  NULL        r     1 M$NODE
     0-0-0N  NULL        r     1 M$SI                       0-0-0N  NULL        r     1 M$UC
     0-0-0N  NULL        r     1 M$WORK                     0-0-0/w STRC(432)   r     1 VM_ENCLOS
     0-0-0/w STRC(252)   r     1 VM_ENCL_HEAD               0-0-0/w STRC(1332)  r     1 VM_HEADER
     0-0-0/c ASTR(9)     r     1 X$STRING


   Procedure VMM$DELETE_MESSAGE requires 195 words for executable code.
   Procedure VMM$DELETE_MESSAGE requires 16 words of local(AUTO) storage.
PL6.E3A0      #002=VMM$DELETE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                  WED 08/20/97 15:17 Page:76   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=VMM$DELETE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                  WED 08/20/97 15:17 Page:77   
          MINI XREF LISTING

B$ALT.CODE
      9213**DCL      9213--REDEF    9214--REDEF    9214--REDEF
B$ALT.ERR.CODE
      9215**DCL      9487>>IF
B$ALT.ERR.ERR#
      9215**DCL      9215--REDEF
B$ALT.EVID
      9214**DCL      9214--REDEF    9214--REDEF
B$TCB.ALT$
      9209**DCL      9487>>IF
B$TCB$
      7857**DCL      9209--IMP-PTR  9487>>IF
DCB#
      9222**DCL        20--PROC     9453<>CALL     9455<>CALL     9457<>CALL     9459<>CALL     9461<>CALL
      9462<>CALL     9467<>CALL     9473<>CALL     9485<>CALL     9497<>CALL     9500<>CALL     9509<>CALL
      9513<>CALL
ENCL$
      9446**DCL      9423--IMP-PTR  9494<<ASSIGN   9496>>ASSIGN   9497>>CALL     9498<<ASSIGN   9498>>ASSIGN
ENCL_NUM
      9447**DCL      9496<<ASSIGN   9497<>CALL
ERRMSG_FID.L#
      7925**DCL      7925--IMP-SIZ
E_DELETE
      9520**LABEL    9453--CALLALT  9500--CALLALT
I
      9445**DCL      9466<<ASSIGN   9467>>IF       9467<>CALL     9472<<ASSIGN   9473>>IF       9473<>CALL
      9495<<DOINDEX  9509<>CALL     9511>>IF
MESSAGE_NUM
      9221**DCL        20--PROC     9453<>CALL     9455<>CALL     9457<>CALL     9459<>CALL     9461<>CALL
      9462<>CALL     9467<>CALL     9473<>CALL     9485<>CALL     9497<>CALL     9500<>CALL     9511>>IF
OLD_ENCL
      9507**LABEL    9491--GOTO
PL6.E3A0      #002=VMM$DELETE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                  WED 08/20/97 15:17 Page:78   
PAGESIZE
      9448**DCL      9488>>ASSIGN
READ_ENCL_CONTEXT
      9473**LABEL    9489--GOTO
VMA$DEL_ADD_RECORD
      9230**DCL-ENT  9455--CALL     9457--CALL     9459--CALL     9461--CALL     9500--CALL
VMA$GET_ADD_RECORD
      9231**DCL-ENT  9485--CALL
VMD$DEL_BODY
      9226**DCL-ENT  9467--CALL
VMD$DEL_ENCL
      9232**DCL-ENT  9497--CALL
VMD$DEL_HEADER
      9225**DCL-ENT  9462--CALL
VMD$DEL_ID
      9229**DCL-ENT  9513--CALL
VMD$DEL_TRACE
      9227**DCL-ENT  9473--CALL
VMD$GET_HEADER
      9224**DCL-ENT  9453--CALL
VMD$GET_ID
      9228**DCL-ENT  9509--CALL
VM_ENCLLIST$
      7794**DCL      9394--IMP-PTR  9494>>ASSIGN   9495>>DOINDEX
VM_ENCLLIST_
      7810**DCL      9485<>CALL     9488<<ASSIGN   9488>>ASSIGN   9500<>CALL
VM_ENCLOS.NEXT$
      9424**DCL      9498>>ASSIGN
VM_ENCLOS.NRECS
      9437**DCL      9497<>CALL
VM_ENCLOS.TYPE
      9439**DCL      9496>>ASSIGN
VM_ENCLREC$
      7796**DCL      9497<>CALL
VM_ENCL_HEAD.HEAD$
      9404**DCL      9494>>ASSIGN
PL6.E3A0      #002=VMM$DELETE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                  WED 08/20/97 15:17 Page:79   
VM_ENCL_HEAD.NUM_ENTRIES
      9397**DCL      9495>>DOINDEX
VM_HEADER.BLIND$
      9330**DCL      9458>>IF
VM_HEADER.COPY$
      9332**DCL      9456>>IF
VM_HEADER.NUM_RECORDS
      9255**DCL      9466>>ASSIGN
VM_HEADER.NUM_TRACE_RECORDS
      9354**DCL      9472>>ASSIGN
VM_HEADER.REPLY_TO$
      9340**DCL      9460>>IF
VM_HEADER.STATUS.ENCL
      9309**DCL      9478>>IF
VM_HEADER.TO$
      9348**DCL      9454>>IF
VM_HEADER.UNIQUE_ID$
      9350**DCL      9507>>IF       9509>>CALL     9509>>CALL     9513>>CALL     9513>>CALL
VM_HEADER$
      7775**DCL      9244--IMP-PTR  9454>>IF       9456>>IF       9458>>IF       9460>>IF       9466>>ASSIGN
      9472>>ASSIGN   9478>>IF       9507>>IF       9509>>CALL     9509>>CALL     9513>>CALL     9513>>CALL
VM_WORK_
      7805**DCL      9455<>CALL     9457<>CALL     9459<>CALL     9461<>CALL
X$STRING
      7770**DCL      9509<>CALL     9513<>CALL
X$STRING.SIZ
      7771**DCL      7772--IMP-SIZ  9509>>CALL     9513>>CALL

PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:80   
      398        1        /*T***********************************************************/
      399        2        /*T*                                                         */
      400        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      401        4        /*T*                                                         */
      402        5        /*T***********************************************************/
      403        6        /*X* DMC,PLM=4,IND=4,CTI=2,DTI=0,ENI=0,ECI=0,CSI=0,DCI=4 */
      404        7        /*P*
      405        8                NAME: VMM$EDIT_MESSAGE_OUT
      406        9                PURPOSE:
      407       10                      To copy the SEND fields and/or the contents of a message body
      408       11                      to an EDIT-type file.
      409       12                DESCRIPTION:
      410       13                      This routine will copy the specified message body to a
      411       14                      work file which the user can then EDIT. A file, named
      412       15                     '*BODY', is created. Optionally, all SEND fields can also be
      413       16                     copied to the *BODY file. The message must be contained in
      414       17                     the folder to which the DCB# is currently open.
      415       18
      416       19                      This routine has 4 parameters.
      417       20
      418       21                         MESSAGE_NUMBER - number of the message to process.
      419       22                         SEED - seed used to decrypt the message body.
      420       23                         DCB# - number of DCB open to folder containing message.
      421       24                         ALL_FIELDS - all fields to be written to *BODY.
      422       25        */
      423       26        VMM$EDIT_MESSAGE_OUT: proc(MESSAGE_NUMBER,SEED,DCB#,ALL_FIELDS,NOT_ANSWER_OPT)
                26            altret;
      424       27        /***** Include files *****/
      425       28         %INCLUDE B$JIT;
      426      631          %INCLUDE CP_6;
      427     6190          %INCLUDE CP_6_SUBS;
      428     6730          %INCLUDE VM_MACRO_C;
      429     7998          %INCLUDE VM_SUBS_C;
      430     8258          %INCLUDE VM_DATA_R;
      431     8689          %INCLUDE VM_PERR_C;
      432     8984        /***** Parameters *****/
      433     8985    1   DCL MESSAGE_NUMBER SBIN WORD;
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:81   
      434     8986    1   DCL SEED UBIN WORD;
      435     8987    1   DCL DCB# UBIN WORD;
      436     8988    1   DCL ALL_FIELDS BIT(1) ALIGNED;
      437     8989    1   DCL NOT_ANSWER_OPT BIT(1) ALIGNED;
      438     8990        /***** External routines *****/
      439     8991    1   DCL VMD$GET_TRACE ENTRY (7) ALTRET;
      440     8992    1   DCL VMD$GET_BODY ENTRY (9) ALTRET;
      441     8993    1   DCL VMD$PUT_BODY ENTRY (7) ALTRET;
      442     8994    1   DCL VMD$DEL_BODY ENTRY (7) ALTRET;
      443     8995        %INIT_STR(DODCL=YES);
      444     9018        /***** Mail structures *****/
      445     9019            %VM_BODYTYPES;
      446     9025            %VM_BODYREC (STCLASS=AUTO,VARYLEN=NO);
      447     9057          %VM_HEADER;
      448     9186        /***** Dcbs *****/
      449     9187    1   DCL M$EDIT DCB;
      450     9188        /***** Fpts *****/
      451     9189          %FPT_OPEN (FPTN=OPEN_EDIT_FILE_CONST,
      452     9190                     STCLASS=CONSTANT,
      453     9191                     ACS=DIRECT,
      454     9192                     ASN=FILE,
      455     9193                     DCB=M$EDIT,
      456     9194                     NAME=EDIT_NAME,
      457     9195                     ORG=KEYED,
      458     9196                     SCRUB=YES,
      459     9197                     SHARE=NONE);
      460     9306
      461     9307          %FPT_OPEN( FPTN=OPEN_EDIT_FILE,
      462     9308                     STCLASS="");
      463     9417
      464     9418
      465     9419          %FPT_CLOSE (FPTN=CLOSE_EDIT_CONST,
      466     9420                      DCB=M$EDIT);
      467     9462
      468     9463          %FPT_CLOSE( FPTN=CLOSE_EDIT,
      469     9464                      STCLASS="");
      470     9506
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:82   
      471     9507
      472     9508             %VLP_NAME (FPTN=EDIT_NAME,NAME='*BODY',STCLASS=CONSTANT);
      473     9535
      474     9536          %FPT_READ (FPTN=READ_EDIT_REC_CONST,
      475     9537                     DCB=M$EDIT,
      476     9538                     KEY=EDIT_KEY,
      477     9539                     KEYR=YES,
      478     9540                     KEYS=NO);
      479     9579
      480     9580          %FPT_READ( FPTN=READ_EDIT_REC,
      481     9581                     STCLASS="");
      482     9620
      483     9621          %FPT_WRITE (FPTN=WRITE_EDIT_REC_CONST,
      484     9622                      DCB=M$EDIT,
      485     9623                      KEY=EDIT_KEY,
      486     9624                      ONEWKEY=YES);
      487     9655
      488     9656          %FPT_WRITE( FPTN=WRITE_EDIT_REC,
      489     9657                      STCLASS="");
      490     9688
      491     9689
      492     9690        %FPT_TIME (FPTN=DEFER_TIME,
      493     9691                   STCLASS=CONSTANT,
      494     9692                       SOURCE=UTS,
      495     9693                       DEST=LOCAL,
      496     9694                       DATE=WORK_DATE,
      497     9695                       TIME=WORK_TIME,
      498     9696                       TSTAMP=WORK_UTS);
      499     9715
      500     9716    1   DCL 1 WORK_DATE STATIC,
      501     9717    1         2 MONTH CHAR (2) CALIGNED,
      502     9718    1         2 * CHAR(1) CALIGNED INIT('/'),
      503     9719    1         2 DAY CHAR(2) CALIGNED,
      504     9720    1         2 * CHAR(1) CALIGNED INIT('/'),
      505     9721    1         2 YEAR CHAR(2) CALIGNED;
      506     9722    1   DCL WORK_DATER REDEF WORK_DATE CHAR(8);
      507     9723    1   DCL 1 WORK_TIME STATIC,
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:83   
      508     9724    1         2 HOUR CHAR(2) CALIGNED,
      509     9725    1         2 * CHAR(1) CALIGNED INIT(':'),
      510     9726    1         2 MINUTE CHAR(2) CALIGNED,
      511     9727    1         2 * CHAR(1) CALIGNED,
      512     9728    1         2 SECOND CHAR(2) CALIGNED,
      513     9729    1         2 * CHAR(1) CALIGNED,
      514     9730    1         2 FRACTION CHAR(2) CALIGNED;
      515     9731    1   DCL WORK_TIMER REDEF WORK_TIME CHAR(11);
      516     9732        %VLP_NAME (FPTN=TEMP_BUF,STCLASS=AUTO,LEN=512);
      517     9759    1   DCL 1 EDIT_KEY STATIC,
      518     9760    1         2 COUNT UBIN BYTE UNAL,
      519     9761    1         2 KEY UBIN (27) UNAL;
      520     9762          %F$DCB;
      521     9819        /***** Local variables *****/
      522     9820    1   DCL INDX1 SBIN WORD AUTO;
      523     9821    1   DCL INDX2 SBIN WORD AUTO;
      524     9822    1   DCL TRACE_BUF CHAR (512) AUTO;
      525     9823    1   DCL COUNT SBIN WORD AUTO;
      526     9824    1   DCL WORK_UTS UBIN WORD STATIC;
      527     9825    1   DCL FILE$ PTR STATIC;
      528     9826        %VLP_NAME( FPTN=VN_TO_,        LEN=23, L=23, NAME=' ',STCLASS="STATIC SYMDEF");
      529     9853        %VLP_NAME( FPTN=VN_REPLY_TO,   LEN=23, L=23, NAME=' ',STCLASS="STATIC SYMDEF");
      530     9880        %VLP_NAME( FPTN=VN_SUBJECT,    LEN=23, L=23, NAME=' ',STCLASS="STATIC SYMDEF");
      531     9907        %VLP_NAME( FPTN=VN_REFERENCE,  LEN=23, L=23, NAME=' ',STCLASS="STATIC SYMDEF");
      532     9934        %VLP_NAME( FPTN=VN_COPY,       LEN=23, L=23, NAME=' ',STCLASS="STATIC SYMDEF");
      533     9961        %VLP_NAME( FPTN=VN_BLIND_COPY, LEN=23, L=23, NAME=' ',STCLASS="STATIC SYMDEF");
      534     9988        %VLP_NAME( FPTN=VN_FCOPY,      LEN=23, L=23, NAME=' ',STCLASS="STATIC SYMDEF");
      535    10015        %VLP_NAME( FPTN=VN_RR,         LEN=23, L=23, NAME=' ',STCLASS="STATIC SYMDEF");
      536    10042        %VLP_NAME( FPTN=VN_DEFER,      LEN=23, L=23, NAME=' ',STCLASS="STATIC SYMDEF");
      537    10069        %VLP_NAME( FPTN=VN_SIGNED,     LEN=23, L=23, NAME=' ',STCLASS="STATIC SYMDEF");
      538    10096        %VLP_NAME( FPTN=VN_BROADCAST,  LEN=23, L=23, NAME=' ',STCLASS="STATIC SYMDEF");
      539    10123        %VLP_NAME( FPTN=VN_DR,         LEN=23, L=23, NAME=' ',STCLASS="STATIC SYMDEF");
      540    10150        %VLP_NAME( FPTN=VN_YES_CHAR,   LEN=1,  L=1,  NAME=' ',STCLASS="STATIC SYMDEF");
      541    10177        %VLP_NAME( FPTN=VN_NO_CHAR,    LEN=1,  L=1,  NAME=' ',STCLASS="STATIC SYMDEF");
      542    10204
      543    10205        %VLP_ERRCODE( FPTN=E_CMD_TO_PROMPT, FCG="VN",MID=S, STCLASS="CONSTANT SYMDEF",
      544    10206                      ERR#=%E$CMD_TO_PROMPT   );
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:84   
      545    10251        /*E* ERROR:   VNS-E$CMD_TO_PROMPT-0
      546    10252             MESSAGE:To:
      547    10253        */
      548    10254              %VLP_ERRCODE( FPTN=E_CMD_SUBJECT_PROMPT,FCG="VN",MID=S, STCLASS=
             10254                  "CONSTANT SYMDEF",
      549    10255              ERR#=%E$CMD_SUBJECT_PROMPT   );
      550    10300        /*E* ERROR:   VNS-E$CMD_SUBJECT_PROMPT-0
      551    10301             MESSAGE:Subject:
      552    10302        */
      553    10303              %VLP_ERRCODE( FPTN=E_CMD_RTO_PROMPT, FCG="VN",MID=S, STCLASS="CONSTANT SYMDEF"
             10303                  ,
      554    10304              ERR#=%E$CMD_RTO_PROMPT   );
      555    10349        /*E* ERROR:   VNS-E$CMD_RTO_PROMPT-0
      556    10350             MESSAGE:Reply to:
      557    10351        */
      558    10352              %VLP_ERRCODE( FPTN=E_CMD_COPY_PROMPT, FCG="VN",MID=S, STCLASS=
             10352                  "CONSTANT SYMDEF",
      559    10353              ERR#=%E$CMD_COPY_PROMPT   );
      560    10398        /*E* ERROR:   VNS-E$CMD_COPY_PROMPT-0
      561    10399             MESSAGE:Copy:
      562    10400        */
      563    10401              %VLP_ERRCODE( FPTN=E_CMD_BC_PROMPT, FCG="VN",MID=S, STCLASS="CONSTANT SYMDEF",
      564    10402              ERR#=%E$CMD_BC_PROMPT   );
      565    10447        /*E* ERROR:   VNS-E$CMD_BC_PROMPT-0
      566    10448             MESSAGE:Blind Copy:
      567    10449        */
      568    10450              %VLP_ERRCODE( FPTN=E_CMD_FILE_COPY_PROMPT,FCG="VN",MID=S, STCLASS=
             10450                  "CONSTANT SYMDEF",
      569    10451              ERR#=%E$CMD_FILE_COPY_PROMPT   );
      570    10496        /*E* ERROR:   VNS-E$CMD_FILE_COPY_PROMPT-0
      571    10497             MESSAGE:File Copy:
      572    10498        */
      573    10499              %VLP_ERRCODE( FPTN=E_RR_PROMPT,   FCG="VN",MID=S, STCLASS="CONSTANT SYMDEF",
      574    10500              ERR#=%E$RR_PROMPT            );
      575    10545        /*E* ERROR:   VNS-E$RR_PROMPT-0
      576    10546             MESSAGE:Return Receipt:
      577    10547        */
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:85   
      578    10548              %VLP_ERRCODE( FPTN=E_CMD_DEFER_PROMPT, FCG="VN",MID=S, STCLASS=
             10548                  "CONSTANT SYMDEF",
      579    10549              ERR#=%E$CMD_DEFER_PROMPT   );
      580    10594        /*E* ERROR:   VNS-E$CMD_DEFER_PROMPT-0
      581    10595             MESSAGE:Defer:
      582    10596        */
      583    10597              %VLP_ERRCODE( FPTN=E_CMD_SIGNED_PROMPT, FCG="VN",MID=S, STCLASS=
             10597                  "CONSTANT SYMDEF",
      584    10598              ERR#=%E$CMD_SIGNED_PROMPT   );
      585    10643        /*E* ERROR:   VNS-E$CMD_SIGNED_PROMPT-0
      586    10644             MESSAGE:Signed:
      587    10645        */
      588    10646              %VLP_ERRCODE( FPTN=E_BROADCAST_PROMPT, FCG="VN",MID=S, STCLASS=
             10646                  "CONSTANT SYMDEF",
      589    10647              ERR#=%E$BROADCAST_PROMPT   );
      590    10692        /*E* ERROR:   VNS-E$BROADCAST_PROMPT-0
      591    10693             MESSAGE:Broadcast:
      592    10694        */
      593    10695              %VLP_ERRCODE( FPTN=E_DR_PROMPT,   FCG="VN",MID=S, STCLASS="CONSTANT SYMDEF",
      594    10696              ERR#=%E$DR_PROMPT   );
      595    10741        /*E* ERROR:   VNS-E$DR_PROMPT-0
      596    10742             MESSAGE:Delivery Receipt:
      597    10743        */
      598    10744              %VLP_ERRCODE( FPTN=E_CMD_REF_PROMPT, FCG="VN",MID=S, STCLASS="CONSTANT SYMDEF"
             10744                  ,
      599    10745              ERR#=%E$CMD_REF_PROMPT  );
      600    10790        /*E* ERROR: VNS-E$CMD_REF_PROMPT-0
      601    10791             MESSAGE:Reference:
      602    10792        */
      603    10793              %VLP_ERRCODE( FPTN=E_NO_CHAR, FCG="VM",MID=M, STCLASS="CONSTANT SYMDEF",
      604    10794              ERR#=%E$NO_CHAR   );
      605    10839        /*E* ERROR:   VMM-E$NO_CHAR-0
      606    10840             MESSAGE:N
      607    10841        */
      608    10842              %VLP_ERRCODE( FPTN=E_YES_CHAR, FCG="VM",MID=M, STCLASS="CONSTANT SYMDEF",
      609    10843              ERR#=%E$YES_CHAR   );
      610    10888        /*E* ERROR:   VMM-E$YES_CHAR-0
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:86   
      611    10889             MESSAGE:Y
      612    10890        */
      613    10891
      614    10892    1   dcl  VM_NO_OR_YES$(0:1) ptr constant symdef init( addr(VN_NO_CHAR), addr(VN_YES_CHAR
             10892            ));
      615    10893
      616    10894
      617    10895        /**************************************************************/
      618    10896        /*                    P R O C E D U R E                       */
      619    10897        /**************************************************************/
      620    10898
      621    10899             %INIT_STR( STR=VN_YES_CHAR, CODE=E_YES_CHAR, TEST=YES );
      622    10922            %INIT_STR( STR=VN_NO_CHAR, CODE=E_NO_CHAR, TEST=YES );
      623    10945
      624    10946        /*
      625    10947             ***** Initialize our FPT's    *****
      626    10948        */
      627    10949    1       OPEN_EDIT_FILE      =  OPEN_EDIT_FILE_CONST;
      628    10950    1       OPEN_EDIT_FILE.V_   =  vector(OPEN_EDIT_FILE.V);
      629    10951
      630    10952    1       CLOSE_EDIT          =  CLOSE_EDIT_CONST;
      631    10953    1       CLOSE_EDIT.V_       =  vector(CLOSE_EDIT.V);
      632    10954
      633    10955    1       WRITE_EDIT_REC      =  WRITE_EDIT_REC_CONST;
      634    10956    1       WRITE_EDIT_REC.V_   =  vector(WRITE_EDIT_REC.V);
      635    10957        /*
      636    10958             ***** Create the edit file ...
      637    10959        */
      638    10960    1       OPEN_EDIT_FILE.V.EXIST# = %NEWFILE#;
      639    10961    1       OPEN_EDIT_FILE.V.FUN# = %CREATE#;
      640    10962    1       CALL M$OPEN (OPEN_EDIT_FILE) ALTRET(E_PMME);
      641    10963        /*
      642    10964             ***** Do it...
      643    10965        */
      644    10966    1       INDX1 = 0;
      645    10967    2       if ALL_FIELDS then do;
      646    10968    3           if VM_HEADER.TO$ ~= addr(nil) and NOT_ANSWER_OPT then do;
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:87   
      647    10969                    %INIT_STR( CODE=E_CMD_TO_PROMPT, STR=VN_TO_, TEST=YES );
      648    10992    3               call WRITE$BODY(VM_HEADER.TO$,VN_TO_,INDX1) altret(E_PMME);
      649    10993    3           end;
      650    10994    3           if VM_HEADER.SUBJECT$ ~= addr(nil) then do;
      651    10995                    %INIT_STR( STR=VN_SUBJECT, CODE=E_CMD_SUBJECT_PROMPT, TEST=YES );
      652    11018    3               call WRITE$BODY(VM_HEADER.SUBJECT$,VN_SUBJECT,INDX1) altret(E_PMME);
      653    11019    3           end;
      654    11020    3           if VM_HEADER.REPLY_TO$ ~= addr(nil) then do;
      655    11021                    %INIT_STR( STR=VN_REPLY_TO, CODE=E_CMD_RTO_PROMPT, TEST=YES );
      656    11044    3               call WRITE$BODY(VM_HEADER.REPLY_TO$,VN_REPLY_TO,INDX1) altret(E_PMME);
      657    11045    3           end;
      658    11046    3           if VM_HEADER.REFERENCE$ ~= addr(nil) then do;
      659    11047                    %INIT_STR( STR=VN_REFERENCE, CODE=E_CMD_REF_PROMPT, TEST=YES );
      660    11070    3               call WRITE$BODY(VM_HEADER.REFERENCE$,VN_REFERENCE,INDX1) altret(E_PMME);
      661    11071    3           end;
      662    11072    3           if VM_HEADER.COPY$ ~= addr(nil) and NOT_ANSWER_OPT then do;
      663    11073                    %INIT_STR( STR=VN_COPY, CODE=E_CMD_COPY_PROMPT, TEST=YES );
      664    11096    3               call WRITE$BODY(VM_HEADER.COPY$,VN_COPY,INDX1) altret(E_PMME);
      665    11097    3           end;
      666    11098    3           if VM_HEADER.BLIND$ ~= addr(nil) then do;
      667    11099                    %INIT_STR( STR=VN_BLIND_COPY, CODE=E_CMD_BC_PROMPT, TEST=YES );
      668    11122    3               call WRITE$BODY(VM_HEADER.BLIND$,VN_BLIND_COPY,INDX1) altret(E_PMME);
      669    11123    3           end;
      670    11124
      671    11125                %INIT_STR( STR=VN_FCOPY, CODE=E_CMD_FILE_COPY_PROMPT, TEST=YES );
      672    11148                %INIT_STR( STR=VN_DR, CODE=E_DR_PROMPT , TEST=YES );
      673    11171                %INIT_STR( STR=VN_RR, CODE=E_RR_PROMPT , TEST=YES );
      674    11194                %INIT_STR( STR=VN_BROADCAST, CODE=E_BROADCAST_PROMPT, TEST=YES );
      675    11217    2           call WRITE$BODY(VM_NO_OR_YES$(bitbin(VM_HEADER.STATUS.FCOPY)),VN_FCOPY,INDX1
             11217                    ) altret(E_PMME);
      676    11218    2           call WRITE$BODY(VM_NO_OR_YES$(bitbin(VM_HEADER.STATUS.DR)),VN_DR,INDX1)
             11218                    altret(E_PMME);
      677    11219    2           call WRITE$BODY(VM_NO_OR_YES$(bitbin(VM_HEADER.STATUS.RR)),VN_RR,INDX1);
      678    11220    2           call WRITE$BODY(VM_NO_OR_YES$(bitbin(VM_HEADER.STATUS.BROADCAST)),
             11220                    VN_BROADCAST,INDX1) altret(E_PMME);
      679    11221    2           IF VM_HEADER.DELIVERY_DATE > 0
      680    11222    3           THEN DO;
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:88   
      681    11223                    %INIT_STR( STR=VN_DEFER, CODE=E_CMD_DEFER_PROMPT, TEST=YES );
      682    11246    3               WORK_UTS = VM_HEADER.DELIVERY_DATE;
      683    11247    3               call M$TIME (DEFER_TIME) altret(E_PMME);
      684    11248    3               TEMP_BUF.L# = (sizec(WORK_TIMER) - 6) + sizec(WORK_DATER) + 1;
      685    11249    3               call concat(TEMP_BUF.NAME#,substr(WORK_TIMER,0,5),',',WORK_DATER);
      686    11250    3               call WRITE$BODY(ADDR(TEMP_BUF),VN_DEFER,INDX1) altret(E_PMME);
      687    11251    3           end;
      688    11252    3           if VM_HEADER.SIGNED$ ~= addr(nil) then do;
      689    11253                    %INIT_STR( STR=VN_SIGNED, CODE=E_CMD_SIGNED_PROMPT, TEST=YES );
      690    11276    3               call WRITE$BODY(VM_HEADER.SIGNED$,VN_SIGNED,INDX1) altret(E_PMME);
      691    11277    3           end;
      692    11278    2       END;
      693    11279    2       DO INDX2 = 0 TO VM_HEADER.NUM_TRACE_RECORDS - 1;
      694    11280    2           CALL VMD$GET_TRACE (MESSAGE_NUMBER,DCB#,INDX2,COUNT,
      695    11281    2             SEED,VM_BODYREC,WRITE_EDIT_REC.V.DVBYTE) ALTRET(E_PMME);
      696    11282    2           INDX1 = INDX1 + 2;
      697    11283    2           EDIT_KEY.KEY = INDX1;
      698    11284    2           EDIT_KEY.COUNT = 3;
      699    11285    3           if VM_BODYREC.TYPE ~= %VM_BODY_TEXT then do;
      700    11286                                                /* Future code */
      701    11287    3           END;
      702    11288    2           ELSE
      703    11289    3           DO;                    /* Normal text */
      704    11290    4               IF COUNT = 0 THEN DO; /* Unit rec. file can net count=0 */
      705    11291    4                   TRACE_BUF = 'Trace:';
      706    11292    4                   WRITE_EDIT_REC.BUF_ = VECTOR(SUBSTR(TRACE_BUF,0,5));
      707    11293    4               END;
      708    11294    4               ELSE DO;
      709    11295    4                   CALL CONCAT(TRACE_BUF, 'Trace:',SUBSTR(VM_BODYREC.VALUE.DATA,0,COUNT
             11295                            ));
      710    11296    4                   WRITE_EDIT_REC.BUF_ = VECTOR(SUBSTR(TRACE_BUF,0,COUNT+6));
      711    11297    4               END;
      712    11298    3               CALL M$WRITE (WRITE_EDIT_REC) ALTRET(E_PMME);
      713    11299    3           END;
      714    11300    2       END;                            /* Do INDX1 = ... end */
      715    11301    2       DO INDX1 = 0 TO VM_HEADER.NUM_RECORDS - 1;
      716    11302    2           CALL VMD$GET_BODY (MESSAGE_NUMBER,DCB#,INDX1,COUNT,
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:89   
      717    11303    2             SEED,VM_BODYREC,WRITE_EDIT_REC.V.DVBYTE) ALTRET(E_PMME);
      718    11304    2           EDIT_KEY.KEY = (INDX1 + 1) * 1000;
      719    11305    2           EDIT_KEY.COUNT = 3;
      720    11306    2           IF VM_BODYREC.TYPE ~= %VM_BODY_TEXT
      721    11307    2           THEN
      722    11308    3           DO;                    /* Error!!! */
      723    11309                                                /* Future code */
      724    11310    3           END;
      725    11311    2           ELSE
      726    11312    3           DO;                    /* Normal text */
      727    11313    3               IF COUNT = 0 THEN /* Unit rec. file can net count=0  */
      728    11314    3                   WRITE_EDIT_REC.BUF_ =VECTOR(NIL);
      729    11315    3               ELSE
      730    11316    3                   WRITE_EDIT_REC.BUF_ = VECTOR(SUBSTR(VM_BODYREC.VALUE.DATA,0,COUNT));
      731    11317    3               CALL M$WRITE (WRITE_EDIT_REC) ALTRET(E_PMME);
      732    11318    3           END;
      733    11319    2       END;                            /* Do INDX1 = ... end */
      734    11320        /*
      735    11321             ***** Close the edit file ...
      736    11322        */
      737    11323    1       CLOSE_EDIT.V.DISP# = %SAVE#;
      738    11324    1       CALL M$CLOSE (CLOSE_EDIT) ALTRET(E_PMME);
      739    11325    1       RETURN;
      740    11326        /**/
      741    11327    1   E_PMME:
      742    11328    1       IF FILE$ -> F$DCB.FCD#
      743    11329    1       THEN
      744    11330    1           CALL M$CLOSE (CLOSE_EDIT);
      745    11331    1       ALTRETURN;
      746    11332        %EJECT;
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:90   
      747    11333        /*F*
      748    11334                NAME: VMM$EDIT_MESSAGE_IN
      749    11335                PURPOSE:
      750    11336                      To replace the body of a message from an EDIT-type file.
      751    11337                DESCRIPTION:
      752    11338                       This routine will replace the body of the specified message
      753    11339                       with the contents of the EDIT_type file '*BODY'.  The
      754    11340                      message must be contained in the filder to which DCB#
      755    11341                      is currently open. '*EDIT' will be deleted.
      756    11342
      757    11343                      This routine has 4 parameters.
      758    11344
      759    11345                         MESSAGE_NUMBER - number of the message to process.
      760    11346                         SEED - seed used to encrypt the message body.
      761    11347                         DCB# - number of DCB which is open to folder containing message.
      762    11348                         ALL_FIELDS - unused
      763    11349        */
      764    11350    1   VMM$EDIT_MESSAGE_IN: ENTRY (MESSAGE_NUMBER,SEED,DCB#,ALL_FIELDS) ALTRET;
      765    11351        /*
      766    11352             ***** Initialize our FPT's    *****
      767    11353        */
      768    11354    1       OPEN_EDIT_FILE      =  OPEN_EDIT_FILE_CONST;
      769    11355    1       OPEN_EDIT_FILE.V_   =  vector(OPEN_EDIT_FILE.V);
      770    11356
      771    11357    1       CLOSE_EDIT          =  CLOSE_EDIT_CONST;
      772    11358    1       CLOSE_EDIT.V_       =  vector(CLOSE_EDIT.V);
      773    11359
      774    11360    1       READ_EDIT_REC       =  READ_EDIT_REC_CONST;
      775    11361    1       READ_EDIT_REC.V_    =  vector(READ_EDIT_REC.V);
      776    11362        /*
      777    11363             ***** Open the edit file ...
      778    11364        */
      779    11365    1       OPEN_EDIT_FILE.V.EXIST# = %OLDFILE#;
      780    11366    1       OPEN_EDIT_FILE.V.FUN# = %IN#;
      781    11367    1       CALL M$OPEN (OPEN_EDIT_FILE) ALTRET(E_PMME);
      782    11368    1       FILE$=DCBADDR(DCBNUM(M$EDIT));
      783    11369        /*
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:91   
      784    11370             ***** Do it...
      785    11371        */
      786    11372    1       EDIT_KEY.KEY = 0;
      787    11373    1       EDIT_KEY.COUNT = 3;
      788    11374    1       VM_BODYREC.TYPE = %VM_BODY_TEXT;
      789    11375    1       READ_EDIT_REC.BUF_ = VECTOR(VM_BODYREC.VALUE.DATA);
      790    11376    1       INDX1 = 0;
      791    11377    2       DO FOREVER;
      792    11378    2           CALL M$READ (READ_EDIT_REC) ALTRET(END_LOOP);
      793    11379    2           COUNT = FILE$ -> F$DCB.ARS#;
      794    11380    2           VM_BODYREC.VALUE.COUNT = COUNT;
      795    11381    2           CALL VMD$PUT_BODY (MESSAGE_NUMBER,DCB#,INDX1,COUNT,SEED,VM_BODYREC,FILE$->
             11381                    F$DCB.DVBYTE) ALTRET(E_PMME);
      796    11382    2           INDX1 = INDX1 + 1;
      797    11383    2       END;                            /* Do forever ... end */
      798    11384        /**/
      799    11385    1   END_LOOP:
      800    11386    1       IF VM_HEADER.NUM_RECORDS  > INDX1
      801    11387    1       THEN                  /* More records in original message than now */
      802    11388    2       DO;                          /* Delete the extra records */
      803    11389    2           INDX2 = VM_HEADER.NUM_RECORDS - 1;
      804    11390    2           CALL VMD$DEL_BODY (MESSAGE_NUMBER,DCB#,INDX1,INDX2) ALTRET(E_PMME);
      805    11391    2       END;                       /* Do ... end */
      806    11392    1       VM_HEADER.NUM_RECORDS = INDX1;
      807    11393        /*
      808    11394             ***** Close the edit file ...
      809    11395        */
      810    11396    1       CLOSE_EDIT.V.DISP# = %SCRATCH#;
      811    11397    1       CALL M$CLOSE (CLOSE_EDIT) ALTRET(E_PMME);
      812    11398    1       RETURN;
      813    11399        %EJECT;
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:92   
      814    11400        /********************************************************************/
      815    11401        /*I*
      816    11402             NAME: WRITE$BODY
      817    11403             PURPOSE: To write the To,Reply_To,Subject,Reference,Copy,Blind Copy,
      818    11404                   Defer, and Signed fields to *BODY.
      819    11405        */
      820    11406        /********************************************************************/
      821    11407
      822    11408    1   WRITE$BODY: proc(FIELD$, FIELD_NAME, INDX)  altret;
      823    11409    2   dcl FIELD$ ptr;                 /* Pointer to textc field in header */
      824    11410    2   dcl 1  FIELD_NAME        aligned,
      825    11411    2         2 SIZ           ubin(9) caligned,
      826    11412    2         2 TEXT          char(FIELD_NAME.SIZ) caligned;
      827    11413
      828    11414    2   dcl INDX ubin;
      829    11415    2   dcl TEMP_BUF char(512);
      830    11416
      831    11417
      832    11418    2       COUNT   = FIELD_NAME.SIZ;
      833    11419    2       substr(TEMP_BUF,,COUNT) = substr(FIELD_NAME.TEXT,,COUNT);
      834    11420
      835    11421    2       INDX          = INDX + 5;
      836    11422    2       EDIT_KEY.KEY  = INDX;
      837    11423    2       EDIT_KEY.COUNT = 3;
      838    11424
      839    11425    2       substr(TEMP_BUF,COUNT) = substr(FIELD$->X$STRING.TEXT,,FIELD$->X$STRING.SIZ);
      840    11426    2       COUNT = COUNT + FIELD$->X$STRING.SIZ;
      841    11427    2       WRITE_EDIT_REC.BUF_ = vector( substr(TEMP_BUF,,COUNT) );
      842    11428    2       call M$WRITE(WRITE_EDIT_REC) altret(E_WRITE$BODY);
      843    11429    2       return;
      844    11430
      845    11431    2   E_WRITE$BODY:
      846    11432    2       altreturn;
      847    11433    2   end WRITE$BODY;
      848    11434    1   end VMM$EDIT_MESSAGE_OUT;
      849    11435        %EOD;

PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:93   
--  Include file information  --

   VM_PERR_C.:VMB6TOU  is referenced.
   B_MACROS_C.:LIB_E05  is referenced.
   VM_DATA_R.:VMB6TOU  cannot be made into a system file and is referenced.
   VM_SUBS_C.:VMB6TOU  is referenced.
   VM_MACRO_C.:VMB6TOU  is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   CP_6_C.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
   B$JIT_C.:LIB_E05  is referenced.
   B$JIT.:LIB_E05  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure VMM$EDIT_MESSAGE_OUT.

   Procedure VMM$EDIT_MESSAGE_OUT requires 632 words for executable code.
   Procedure VMM$EDIT_MESSAGE_OUT requires 600 words of local(AUTO) storage.

PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:94   

 Object Unit name= VMM$EDIT_MESSAGE_OUT                       File name= VMM$MESSAGE.:VMB6TOU
 UTS= AUG 20 '97 15:17:40.72 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   DCB   even  none     0      0  M$MAIL_FILE
    2   DCB   even  none     0      0  M$MAIL_CENTRAL
    3   DCB   even  none     0      0  M$MAIL_GLOBAL
    4   DCB   even  none     0      0  M$WORK
    5   DCB   even  none     0      0  M$MAIL_COMGROUP
    6   DCB   even  none     0      0  M$DO
    7   DCB   even  none     0      0  M$LO
    8   DCB   even  none     0      0  M$ME
    9   DCB   even  none     0      0  M$NODE
   10   DCB   even  none     0      0  M$SI
   11   DCB   even  none     0      0  M$EDIT
   12  RoData even  UTS     90    132  VMM$EDIT_MESSAGE_OUT
   13   Data  even  none   138    212  VMM$EDIT_MESSAGE_OUT
   14   Proc  even  none   632   1170  VMM$EDIT_MESSAGE_OUT
   15  RoData even  none    43     53  VMM$EDIT_MESSAGE_OUT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
    14      0   yes    yes     yes      Std        5  VMM$EDIT_MESSAGE_OUT
    14    720          yes     yes      Std        4  VMM$EDIT_MESSAGE_IN
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:95   

  ****  Data defs  ****

 Sect OctLoc  Name                           Sect OctLoc  Name
   13    100  VN_TO_                            13    106  VN_REPLY_TO
   13    114  VN_SUBJECT                        13    122  VN_REFERENCE
   13    130  VN_COPY                           13    136  VN_BLIND_COPY
   13    144  VN_FCOPY                          13    152  VN_RR
   13    160  VN_DEFER                          13    166  VN_SIGNED
   13    174  VN_BROADCAST                      13    202  VN_DR
   13    210  VN_YES_CHAR                       13    211  VN_NO_CHAR
   12    110  E_CMD_TO_PROMPT                   12    111  E_CMD_SUBJECT_PROMPT
   12    112  E_CMD_RTO_PROMPT                  12    113  E_CMD_COPY_PROMPT
   12    114  E_CMD_BC_PROMPT                   12    115  E_CMD_FILE_COPY_PROMPT
   12    116  E_RR_PROMPT                       12    117  E_CMD_DEFER_PROMPT
   12    120  E_CMD_SIGNED_PROMPT               12    121  E_BROADCAST_PROMPT
   12    122  E_DR_PROMPT                       12    123  E_CMD_REF_PROMPT
   12    124  E_NO_CHAR                         12    125  E_YES_CHAR
   12    126  VM_NO_OR_YES$

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       3 VMD$ERRMSG
 yes     yes           Std       7 VMD$PUT_BODY
 yes     yes           Std       7 VMD$GET_TRACE
 yes     yes           Std       9 VMD$GET_BODY
 yes     yes           Std       7 VMD$DEL_BODY
                       nStd      0 X66_AUTO_5
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:96   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                             r    VM_HEADER$                       r    VM_PROFILE$
r    VM_ADDLIST$                      r    VM_ADDREC$                       r    VM_WORK$
r    VM_SELECT$                       r    VM_PARSEAREA$                    r    VM_INPUT$
r    VM_COPY$                              VM_ENCLLIST$                          VM_ENCLREC$
     VM_HEADER_                            VM_HEADER_INIT_                       VM_PROFILE_
     VM_ADDLIST_                           VM_ADDREC_                            VM_WORK_
     VM_SELECT_                            VM_PARSEAREA_                         VM_INPUT_
     VM_COPY_                              VM_ENCLLIST_                          VM_ENCLREC_
     M$MAIL_FILE                           M$MAIL_CENTRAL                        M$MAIL_GLOBAL
     M$WORK                                M$MAIL_COMGROUP                       M$DO
     M$LO                                  M$ME                                  M$NODE
     M$SI                                  M$MAIL_FILE_NUM                       M$MAIL_CENTRAL_NUM
     M$MAIL_GLOBAL_NUM                     M$WORK_NUM                            M$MAIL_COMGROUP_NUM
     M$DO_NUM                              M$ME_NUM                              M$LO_NUM
     M$SI_NUM                              M$NODE_NUM                       r    B$JIT$
r    B$TCB$                                VM_MAIL_ACCT                          VM_NAME_MAP_NAME
     ERRMSG_FID                            VM_SEND_FILE_NAME                     VM_FORWARD_FILE_NAME
     VM_FORWARD_ENCL_NAME                  VM_FORWARD_FILE_PASS                  VM_MAILCG_NAME
     VM_SITENAME                           VM_MAILCG_SETSTA                      M$EDIT

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID                               ROSID
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:97   


      398        1        /*T***********************************************************/
      399        2        /*T*                                                         */
      400        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      401        4        /*T*                                                         */
      402        5        /*T***********************************************************/
      403        6        /*X* DMC,PLM=4,IND=4,CTI=2,DTI=0,ENI=0,ECI=0,CSI=0,DCI=4 */
      404        7        /*P*
      405        8                NAME: VMM$EDIT_MESSAGE_OUT
      406        9                PURPOSE:
      407       10                      To copy the SEND fields and/or the contents of a message body
      408       11                      to an EDIT-type file.
      409       12                DESCRIPTION:
      410       13                      This routine will copy the specified message body to a
      411       14                      work file which the user can then EDIT. A file, named
      412       15                     '*BODY', is created. Optionally, all SEND fields can also be
      413       16                     copied to the *BODY file. The message must be contained in
      414       17                     the folder to which the DCB# is currently open.
      415       18
      416       19                      This routine has 4 parameters.
      417       20
      418       21                         MESSAGE_NUMBER - number of the message to process.
      419       22                         SEED - seed used to decrypt the message body.
      420       23                         DCB# - number of DCB open to folder containing message.
      421       24                         ALL_FIELDS - all fields to be written to *BODY.
      422       25        */
      423       26        VMM$EDIT_MESSAGE_OUT: proc(MESSAGE_NUMBER,SEED,DCB#,ALL_FIELDS,NOT_ANSWER_OPT)
                26            altret;

     26 14 000000   000000 700200 xent  VMM$EDIT_ME* TSX0  ! X66_AUTO_5
        14 000001   001130 000005                    ZERO    600,5

      424       27        /***** Include files *****/
      425       28         %INCLUDE B$JIT;
      426      631          %INCLUDE CP_6;
      427     6190          %INCLUDE CP_6_SUBS;
      428     6730          %INCLUDE VM_MACRO_C;
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:98   
      429     7998          %INCLUDE VM_SUBS_C;
      430     8258          %INCLUDE VM_DATA_R;
      431     8689          %INCLUDE VM_PERR_C;
      432     8984        /***** Parameters *****/
      433     8985    1   DCL MESSAGE_NUMBER SBIN WORD;
      434     8986    1   DCL SEED UBIN WORD;
      435     8987    1   DCL DCB# UBIN WORD;
      436     8988    1   DCL ALL_FIELDS BIT(1) ALIGNED;
      437     8989    1   DCL NOT_ANSWER_OPT BIT(1) ALIGNED;
      438     8990        /***** External routines *****/
      439     8991    1   DCL VMD$GET_TRACE ENTRY (7) ALTRET;
      440     8992    1   DCL VMD$GET_BODY ENTRY (9) ALTRET;
      441     8993    1   DCL VMD$PUT_BODY ENTRY (7) ALTRET;
      442     8994    1   DCL VMD$DEL_BODY ENTRY (7) ALTRET;
      443     8995        %INIT_STR(DODCL=YES);
      444     9018        /***** Mail structures *****/
      445     9019            %VM_BODYTYPES;
      446     9025            %VM_BODYREC (STCLASS=AUTO,VARYLEN=NO);
      447     9057          %VM_HEADER;
      448     9186        /***** Dcbs *****/
      449     9187    1   DCL M$EDIT DCB;
      450     9188        /***** Fpts *****/
      451     9189          %FPT_OPEN (FPTN=OPEN_EDIT_FILE_CONST,
      452     9190                     STCLASS=CONSTANT,
      453     9191                     ACS=DIRECT,
      454     9192                     ASN=FILE,
      455     9193                     DCB=M$EDIT,
      456     9194                     NAME=EDIT_NAME,
      457     9195                     ORG=KEYED,
      458     9196                     SCRUB=YES,
      459     9197                     SHARE=NONE);
      460     9306
      461     9307          %FPT_OPEN( FPTN=OPEN_EDIT_FILE,
      462     9308                     STCLASS="");
      463     9417
      464     9418
      465     9419          %FPT_CLOSE (FPTN=CLOSE_EDIT_CONST,
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:99   
      466     9420                      DCB=M$EDIT);
      467     9462
      468     9463          %FPT_CLOSE( FPTN=CLOSE_EDIT,
      469     9464                      STCLASS="");
      470     9506
      471     9507
      472     9508             %VLP_NAME (FPTN=EDIT_NAME,NAME='*BODY',STCLASS=CONSTANT);
      473     9535
      474     9536          %FPT_READ (FPTN=READ_EDIT_REC_CONST,
      475     9537                     DCB=M$EDIT,
      476     9538                     KEY=EDIT_KEY,
      477     9539                     KEYR=YES,
      478     9540                     KEYS=NO);
      479     9579
      480     9580          %FPT_READ( FPTN=READ_EDIT_REC,
      481     9581                     STCLASS="");
      482     9620
      483     9621          %FPT_WRITE (FPTN=WRITE_EDIT_REC_CONST,
      484     9622                      DCB=M$EDIT,
      485     9623                      KEY=EDIT_KEY,
      486     9624                      ONEWKEY=YES);
      487     9655
      488     9656          %FPT_WRITE( FPTN=WRITE_EDIT_REC,
      489     9657                      STCLASS="");
      490     9688
      491     9689
      492     9690        %FPT_TIME (FPTN=DEFER_TIME,
      493     9691                   STCLASS=CONSTANT,
      494     9692                       SOURCE=UTS,
      495     9693                       DEST=LOCAL,
      496     9694                       DATE=WORK_DATE,
      497     9695                       TIME=WORK_TIME,
      498     9696                       TSTAMP=WORK_UTS);
      499     9715
      500     9716    1   DCL 1 WORK_DATE STATIC,
      501     9717    1         2 MONTH CHAR (2) CALIGNED,
      502     9718    1         2 * CHAR(1) CALIGNED INIT('/'),
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:100  
      503     9719    1         2 DAY CHAR(2) CALIGNED,
      504     9720    1         2 * CHAR(1) CALIGNED INIT('/'),
      505     9721    1         2 YEAR CHAR(2) CALIGNED;
      506     9722    1   DCL WORK_DATER REDEF WORK_DATE CHAR(8);
      507     9723    1   DCL 1 WORK_TIME STATIC,
      508     9724    1         2 HOUR CHAR(2) CALIGNED,
      509     9725    1         2 * CHAR(1) CALIGNED INIT(':'),
      510     9726    1         2 MINUTE CHAR(2) CALIGNED,
      511     9727    1         2 * CHAR(1) CALIGNED,
      512     9728    1         2 SECOND CHAR(2) CALIGNED,
      513     9729    1         2 * CHAR(1) CALIGNED,
      514     9730    1         2 FRACTION CHAR(2) CALIGNED;
      515     9731    1   DCL WORK_TIMER REDEF WORK_TIME CHAR(11);
      516     9732        %VLP_NAME (FPTN=TEMP_BUF,STCLASS=AUTO,LEN=512);
      517     9759    1   DCL 1 EDIT_KEY STATIC,
      518     9760    1         2 COUNT UBIN BYTE UNAL,
      519     9761    1         2 KEY UBIN (27) UNAL;
      520     9762          %F$DCB;
      521     9819        /***** Local variables *****/
      522     9820    1   DCL INDX1 SBIN WORD AUTO;
      523     9821    1   DCL INDX2 SBIN WORD AUTO;
      524     9822    1   DCL TRACE_BUF CHAR (512) AUTO;
      525     9823    1   DCL COUNT SBIN WORD AUTO;
      526     9824    1   DCL WORK_UTS UBIN WORD STATIC;
      527     9825    1   DCL FILE$ PTR STATIC;
      528     9826        %VLP_NAME( FPTN=VN_TO_,        LEN=23, L=23, NAME=' ',STCLASS="STATIC SYMDEF");
      529     9853        %VLP_NAME( FPTN=VN_REPLY_TO,   LEN=23, L=23, NAME=' ',STCLASS="STATIC SYMDEF");
      530     9880        %VLP_NAME( FPTN=VN_SUBJECT,    LEN=23, L=23, NAME=' ',STCLASS="STATIC SYMDEF");
      531     9907        %VLP_NAME( FPTN=VN_REFERENCE,  LEN=23, L=23, NAME=' ',STCLASS="STATIC SYMDEF");
      532     9934        %VLP_NAME( FPTN=VN_COPY,       LEN=23, L=23, NAME=' ',STCLASS="STATIC SYMDEF");
      533     9961        %VLP_NAME( FPTN=VN_BLIND_COPY, LEN=23, L=23, NAME=' ',STCLASS="STATIC SYMDEF");
      534     9988        %VLP_NAME( FPTN=VN_FCOPY,      LEN=23, L=23, NAME=' ',STCLASS="STATIC SYMDEF");
      535    10015        %VLP_NAME( FPTN=VN_RR,         LEN=23, L=23, NAME=' ',STCLASS="STATIC SYMDEF");
      536    10042        %VLP_NAME( FPTN=VN_DEFER,      LEN=23, L=23, NAME=' ',STCLASS="STATIC SYMDEF");
      537    10069        %VLP_NAME( FPTN=VN_SIGNED,     LEN=23, L=23, NAME=' ',STCLASS="STATIC SYMDEF");
      538    10096        %VLP_NAME( FPTN=VN_BROADCAST,  LEN=23, L=23, NAME=' ',STCLASS="STATIC SYMDEF");
      539    10123        %VLP_NAME( FPTN=VN_DR,         LEN=23, L=23, NAME=' ',STCLASS="STATIC SYMDEF");
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:101  
      540    10150        %VLP_NAME( FPTN=VN_YES_CHAR,   LEN=1,  L=1,  NAME=' ',STCLASS="STATIC SYMDEF");
      541    10177        %VLP_NAME( FPTN=VN_NO_CHAR,    LEN=1,  L=1,  NAME=' ',STCLASS="STATIC SYMDEF");
      542    10204
      543    10205        %VLP_ERRCODE( FPTN=E_CMD_TO_PROMPT, FCG="VN",MID=S, STCLASS="CONSTANT SYMDEF",
      544    10206                      ERR#=%E$CMD_TO_PROMPT   );
      545    10251        /*E* ERROR:   VNS-E$CMD_TO_PROMPT-0
      546    10252             MESSAGE:To:
      547    10253        */
      548    10254              %VLP_ERRCODE( FPTN=E_CMD_SUBJECT_PROMPT,FCG="VN",MID=S, STCLASS=
             10254                  "CONSTANT SYMDEF",
      549    10255              ERR#=%E$CMD_SUBJECT_PROMPT   );
      550    10300        /*E* ERROR:   VNS-E$CMD_SUBJECT_PROMPT-0
      551    10301             MESSAGE:Subject:
      552    10302        */
      553    10303             %VLP_ERRCODE( FPTN=E_CMD_RTO_PROMPT, FCG="VN",MID=S, STCLASS="CONSTANT SYMDEF"
             10303                  ,
      554    10304              ERR#=%E$CMD_RTO_PROMPT   );
      555    10349        /*E* ERROR:   VNS-E$CMD_RTO_PROMPT-0
      556    10350             MESSAGE:Reply to:
      557    10351        */
      558    10352              %VLP_ERRCODE( FPTN=E_CMD_COPY_PROMPT, FCG="VN",MID=S, STCLASS=
             10352                  "CONSTANT SYMDEF",
      559    10353              ERR#=%E$CMD_COPY_PROMPT   );
      560    10398        /*E* ERROR:   VNS-E$CMD_COPY_PROMPT-0
      561    10399             MESSAGE:Copy:
      562    10400        */
      563    10401             %VLP_ERRCODE( FPTN=E_CMD_BC_PROMPT, FCG="VN",MID=S, STCLASS="CONSTANT SYMDEF",
      564    10402              ERR#=%E$CMD_BC_PROMPT   );
      565    10447        /*E* ERROR:   VNS-E$CMD_BC_PROMPT-0
      566    10448             MESSAGE:Blind Copy:
      567    10449        */
      568    10450              %VLP_ERRCODE( FPTN=E_CMD_FILE_COPY_PROMPT,FCG="VN",MID=S, STCLASS=
             10450                  "CONSTANT SYMDEF",
      569    10451              ERR#=%E$CMD_FILE_COPY_PROMPT   );
      570    10496        /*E* ERROR:   VNS-E$CMD_FILE_COPY_PROMPT-0
      571    10497             MESSAGE:File Copy:
      572    10498        */
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:102  
      573    10499              %VLP_ERRCODE( FPTN=E_RR_PROMPT,   FCG="VN",MID=S, STCLASS="CONSTANT SYMDEF",
      574    10500              ERR#=%E$RR_PROMPT            );
      575    10545        /*E* ERROR:   VNS-E$RR_PROMPT-0
      576    10546             MESSAGE:Return Receipt:
      577    10547        */
      578    10548              %VLP_ERRCODE( FPTN=E_CMD_DEFER_PROMPT, FCG="VN",MID=S, STCLASS=
             10548                  "CONSTANT SYMDEF",
      579    10549              ERR#=%E$CMD_DEFER_PROMPT   );
      580    10594        /*E* ERROR:   VNS-E$CMD_DEFER_PROMPT-0
      581    10595             MESSAGE:Defer:
      582    10596        */
      583    10597              %VLP_ERRCODE( FPTN=E_CMD_SIGNED_PROMPT, FCG="VN",MID=S, STCLASS=
             10597                  "CONSTANT SYMDEF",
      584    10598              ERR#=%E$CMD_SIGNED_PROMPT   );
      585    10643        /*E* ERROR:   VNS-E$CMD_SIGNED_PROMPT-0
      586    10644             MESSAGE:Signed:
      587    10645        */
      588    10646              %VLP_ERRCODE( FPTN=E_BROADCAST_PROMPT, FCG="VN",MID=S, STCLASS=
             10646                  "CONSTANT SYMDEF",
      589    10647              ERR#=%E$BROADCAST_PROMPT   );
      590    10692        /*E* ERROR:   VNS-E$BROADCAST_PROMPT-0
      591    10693             MESSAGE:Broadcast:
      592    10694        */
      593    10695              %VLP_ERRCODE( FPTN=E_DR_PROMPT,   FCG="VN",MID=S, STCLASS="CONSTANT SYMDEF",
      594    10696              ERR#=%E$DR_PROMPT   );
      595    10741        /*E* ERROR:   VNS-E$DR_PROMPT-0
      596    10742             MESSAGE:Delivery Receipt:
      597    10743        */
      598    10744             %VLP_ERRCODE( FPTN=E_CMD_REF_PROMPT, FCG="VN",MID=S, STCLASS="CONSTANT SYMDEF"
             10744                  ,
      599    10745              ERR#=%E$CMD_REF_PROMPT  );
      600    10790        /*E* ERROR: VNS-E$CMD_REF_PROMPT-0
      601    10791             MESSAGE:Reference:
      602    10792        */
      603    10793              %VLP_ERRCODE( FPTN=E_NO_CHAR, FCG="VM",MID=M, STCLASS="CONSTANT SYMDEF",
      604    10794              ERR#=%E$NO_CHAR   );
      605    10839        /*E* ERROR:   VMM-E$NO_CHAR-0
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:103  
      606    10840             MESSAGE:N
      607    10841        */
      608    10842              %VLP_ERRCODE( FPTN=E_YES_CHAR, FCG="VM",MID=M, STCLASS="CONSTANT SYMDEF",
      609    10843              ERR#=%E$YES_CHAR   );
      610    10888        /*E* ERROR:   VMM-E$YES_CHAR-0
      611    10889             MESSAGE:Y
      612    10890        */
      613    10891
      614    10892    1   dcl VM_NO_OR_YES$(0:1) ptr constant symdef init( addr(VN_NO_CHAR), addr(VN_YES_CHAR
             10892            ));
      615    10893
      616    10894
      617    10895        /**************************************************************/
      618    10896        /*                    P R O C E D U R E                       */
      619    10897        /**************************************************************/
      620    10898
      621    10899             %INIT_STR( STR=VN_YES_CHAR, CODE=E_YES_CHAR, TEST=YES );

  10906 14 000002   000210 236000 13                 LDQ     VN_YES_CHAR
        14 000003   000777 376003                    ANQ     511,DU
        14 000004   000040 116003                    CMPQ    32,DU
        14 000005   000012 601000 14                 TNZ     s:10929

  10908 14 000006   000001 630400 15                 EPPR0   1
        14 000007   000000 631400 15                 EPPR1   0
        14 000010   000000 701000 xent               TSX1    VMD$ERRMSG
        14 000011   000000 011000                    NOP     0

      622    10922            %INIT_STR( STR=VN_NO_CHAR, CODE=E_NO_CHAR, TEST=YES );

  10929 14 000012   000211 236000 13                 LDQ     VN_NO_CHAR
        14 000013   000777 376003                    ANQ     511,DU
        14 000014   000040 116003                    CMPQ    32,DU
        14 000015   000022 601000 14                 TNZ     s:10949

  10931 14 000016   000003 630400 15                 EPPR0   3
        14 000017   000000 631400 15                 EPPR1   0
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:104  
        14 000020   000000 701000 xent               TSX1    VMD$ERRMSG
        14 000021   000000 011000                    NOP     0

      623    10945
      624    10946        /*
      625    10947             ***** Initialize our FPT's    *****
      626    10948        */
      627    10949    1       OPEN_EDIT_FILE      =  OPEN_EDIT_FILE_CONST;

  10949 14 000022   000100 100400                    MLR     fill='000'O
        14 000023   000000 000350 12                 ADSC9   OPEN_EDIT_FILE_CONST     cn=0,n=232
        14 000024   200126 000350                    ADSC9   OPEN_EDIT_FILE,,AUTO     cn=0,n=232

      628    10950    1       OPEN_EDIT_FILE.V_   =  vector(OPEN_EDIT_FILE.V);

  10950 14 000025   000005 235000 15                 LDA     5
        14 000026   201120 452500                    STP2    TEMP_BUF+128,,AUTO
        14 000027   201120 236100                    LDQ     TEMP_BUF+128,,AUTO
        14 000030   000172 036003                    ADLQ    122,DU
        14 000031   200126 757100                    STAQ    OPEN_EDIT_FILE,,AUTO

      629    10951
      630    10952    1       CLOSE_EDIT          =  CLOSE_EDIT_CONST;

  10952 14 000032   000100 100400                    MLR     fill='000'O
        14 000033   000000 000170 13                 ADSC9   CLOSE_EDIT_CONST         cn=0,n=120
        14 000034   200220 000170                    ADSC9   CLOSE_EDIT,,AUTO         cn=0,n=120

      631    10953    1       CLOSE_EDIT.V_       =  vector(CLOSE_EDIT.V);

  10953 14 000035   000006 235000 15                 LDA     6
        14 000036   201120 452500                    STP2    TEMP_BUF+128,,AUTO
        14 000037   201120 236100                    LDQ     TEMP_BUF+128,,AUTO
        14 000040   000252 036003                    ADLQ    170,DU
        14 000041   200220 757100                    STAQ    CLOSE_EDIT,,AUTO

      632    10954
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:105  
      633    10955    1       WRITE_EDIT_REC      =  WRITE_EDIT_REC_CONST;

  10955 14 000042   000100 100400                    MLR     fill='000'O
        14 000043   000054 000060 13                 ADSC9   WRITE_EDIT_REC_CONST     cn=0,n=48
        14 000044   200274 000060                    ADSC9   WRITE_EDIT_REC,,AUTO     cn=0,n=48

      634    10956    1       WRITE_EDIT_REC.V_   =  vector(WRITE_EDIT_REC.V);

  10956 14 000045   000006 235000 15                 LDA     6
        14 000046   201120 452500                    STP2    TEMP_BUF+128,,AUTO
        14 000047   201120 236100                    LDQ     TEMP_BUF+128,,AUTO
        14 000050   000304 036003                    ADLQ    196,DU
        14 000051   200274 757100                    STAQ    WRITE_EDIT_REC,,AUTO

      635    10957        /*
      636    10958             ***** Create the edit file ...
      637    10959        */
      638    10960    1       OPEN_EDIT_FILE.V.EXIST# = %NEWFILE#;

  10960 14 000052   000600 236007                    LDQ     384,DL
        14 000053   200172 256100                    ORSQ    OPEN_EDIT_FILE+36,,AUTO

      639    10961    1       OPEN_EDIT_FILE.V.FUN# = %CREATE#;

  10961 14 000054   003000 236007                    LDQ     1536,DL
        14 000055   200173 552110                    STBQ    OPEN_EDIT_FILE+37,'10'O,AUTO

      640    10962    1       CALL M$OPEN (OPEN_EDIT_FILE) ALTRET(E_PMME);

  10962 14 000056   200126 630500                    EPPR0   OPEN_EDIT_FILE,,AUTO
        14 000057   450000 713400                    CLIMB   alt,open
        14 000060   410400 401760                    pmme    nvectors=18
        14 000061   000710 702000 14                 TSX2    E_PMME

      641    10963        /*
      642    10964             ***** Do it...
      643    10965        */
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:106  
      644    10966    1       INDX1 = 0;

  10966 14 000062   200511 450100                    STZ     INDX1,,AUTO

      645    10967    2       if ALL_FIELDS then do;

  10967 14 000063   200006 470500                    LDP0    @ALL_FIELDS,,AUTO
        14 000064   000000 234100                    SZN     0,,PR0
        14 000065   000515 605000 14                 TPL     s:11279

      646    10968    3           if VM_HEADER.TO$ ~= addr(nil) and NOT_ANSWER_OPT then do;

  10968 14 000066   000000 471400 xsym               LDP1    VM_HEADER$
        14 000067   100031 236100                    LDQ     25,,PR1
        14 000070   000007 116000 15                 CMPQ    7
        14 000071   000116 600000 14                 TZE     s:10994
        14 000072   200007 473500                    LDP3    @NOT_ANSWER_OPT,,AUTO
        14 000073   300000 234100                    SZN     0,,PR3
        14 000074   000116 605000 14                 TPL     s:10994

      647    10969                    %INIT_STR( CODE=E_CMD_TO_PROMPT, STR=VN_TO_, TEST=YES );

  10976 14 000075   040000 106400                    CMPC    fill='040'O
        14 000076   000100 200027 13                 ADSC9   VN_TO_                   cn=1,n=23
        14 000077   000010 000001 15                 ADSC9   8                        cn=0,n=1
        14 000100   000105 601000 14                 TNZ     s:10992

  10978 14 000101   000011 630400 15                 EPPR0   9
        14 000102   000000 631400 15                 EPPR1   0
        14 000103   000000 701000 xent               TSX1    VMD$ERRMSG
        14 000104   000000 011000                    NOP     0

      648    10992    3               call WRITE$BODY(VM_HEADER.TO$,VN_TO_,INDX1) altret(E_PMME);

  10992 14 000105   200511 630500                    EPPR0   INDX1,,AUTO
        14 000106   200717 450500                    STP0    @FIELD_NAME+1,,AUTO
        14 000107   000012 236000 15                 LDQ     10
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:107  
        14 000110   200716 756100                    STQ     @FIELD$+1,,AUTO
        14 000111   000000 236000 xsym               LDQ     VM_HEADER$
        14 000112   000031 036003                    ADLQ    25,DU
        14 000113   200715 756100                    STQ     COUNT+2,,AUTO
        14 000114   001075 701000 14                 TSX1    WRITE$BODY
        14 000115   000710 702000 14                 TSX2    E_PMME

      649    10993    3           end;

      650    10994    3           if VM_HEADER.SUBJECT$ ~= addr(nil) then do;

  10994 14 000116   000000 470400 xsym               LDP0    VM_HEADER$
        14 000117   000030 236100                    LDQ     24,,PR0
        14 000120   000007 116000 15                 CMPQ    7
        14 000121   000143 600000 14                 TZE     s:11020

      651    10995                    %INIT_STR( STR=VN_SUBJECT, CODE=E_CMD_SUBJECT_PROMPT, TEST=YES );

  11002 14 000122   040000 106400                    CMPC    fill='040'O
        14 000123   000114 200027 13                 ADSC9   VN_SUBJECT               cn=1,n=23
        14 000124   000010 000001 15                 ADSC9   8                        cn=0,n=1
        14 000125   000132 601000 14                 TNZ     s:11018

  11004 14 000126   000013 630400 15                 EPPR0   11
        14 000127   000000 631400 15                 EPPR1   0
        14 000130   000000 701000 xent               TSX1    VMD$ERRMSG
        14 000131   000000 011000                    NOP     0

      652    11018    3               call WRITE$BODY(VM_HEADER.SUBJECT$,VN_SUBJECT,INDX1) altret(E_PMME);

  11018 14 000132   200511 630500                    EPPR0   INDX1,,AUTO
        14 000133   200717 450500                    STP0    @FIELD_NAME+1,,AUTO
        14 000134   000014 236000 15                 LDQ     12
        14 000135   200716 756100                    STQ     @FIELD$+1,,AUTO
        14 000136   000000 236000 xsym               LDQ     VM_HEADER$
        14 000137   000030 036003                    ADLQ    24,DU
        14 000140   200715 756100                    STQ     COUNT+2,,AUTO
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:108  
        14 000141   001075 701000 14                 TSX1    WRITE$BODY
        14 000142   000710 702000 14                 TSX2    E_PMME

      653    11019    3           end;

      654    11020    3           if VM_HEADER.REPLY_TO$ ~= addr(nil) then do;

  11020 14 000143   000000 470400 xsym               LDP0    VM_HEADER$
        14 000144   000025 236100                    LDQ     21,,PR0
        14 000145   000007 116000 15                 CMPQ    7
        14 000146   000170 600000 14                 TZE     s:11046

      655    11021                    %INIT_STR( STR=VN_REPLY_TO, CODE=E_CMD_RTO_PROMPT, TEST=YES );

  11028 14 000147   040000 106400                    CMPC    fill='040'O
        14 000150   000106 200027 13                 ADSC9   VN_REPLY_TO              cn=1,n=23
        14 000151   000010 000001 15                 ADSC9   8                        cn=0,n=1
        14 000152   000157 601000 14                 TNZ     s:11044

  11030 14 000153   000015 630400 15                 EPPR0   13
        14 000154   000000 631400 15                 EPPR1   0
        14 000155   000000 701000 xent               TSX1    VMD$ERRMSG
        14 000156   000000 011000                    NOP     0

      656    11044    3               call WRITE$BODY(VM_HEADER.REPLY_TO$,VN_REPLY_TO,INDX1) altret(E_PMME);

  11044 14 000157   200511 630500                    EPPR0   INDX1,,AUTO
        14 000160   200717 450500                    STP0    @FIELD_NAME+1,,AUTO
        14 000161   000016 236000 15                 LDQ     14
        14 000162   200716 756100                    STQ     @FIELD$+1,,AUTO
        14 000163   000000 236000 xsym               LDQ     VM_HEADER$
        14 000164   000025 036003                    ADLQ    21,DU
        14 000165   200715 756100                    STQ     COUNT+2,,AUTO
        14 000166   001075 701000 14                 TSX1    WRITE$BODY
        14 000167   000710 702000 14                 TSX2    E_PMME

      657    11045    3           end;
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:109  

      658    11046    3           if VM_HEADER.REFERENCE$ ~= addr(nil) then do;

  11046 14 000170   000000 470400 xsym               LDP0    VM_HEADER$
        14 000171   000024 236100                    LDQ     20,,PR0
        14 000172   000007 116000 15                 CMPQ    7
        14 000173   000215 600000 14                 TZE     s:11072

      659    11047                    %INIT_STR( STR=VN_REFERENCE, CODE=E_CMD_REF_PROMPT, TEST=YES );

  11054 14 000174   040000 106400                    CMPC    fill='040'O
        14 000175   000122 200027 13                 ADSC9   VN_REFERENCE             cn=1,n=23
        14 000176   000010 000001 15                 ADSC9   8                        cn=0,n=1
        14 000177   000204 601000 14                 TNZ     s:11070

  11056 14 000200   000017 630400 15                 EPPR0   15
        14 000201   000000 631400 15                 EPPR1   0
        14 000202   000000 701000 xent               TSX1    VMD$ERRMSG
        14 000203   000000 011000                    NOP     0

      660    11070    3              call WRITE$BODY(VM_HEADER.REFERENCE$,VN_REFERENCE,INDX1) altret(E_PMME);

  11070 14 000204   200511 630500                    EPPR0   INDX1,,AUTO
        14 000205   200717 450500                    STP0    @FIELD_NAME+1,,AUTO
        14 000206   000020 236000 15                 LDQ     16
        14 000207   200716 756100                    STQ     @FIELD$+1,,AUTO
        14 000210   000000 236000 xsym               LDQ     VM_HEADER$
        14 000211   000024 036003                    ADLQ    20,DU
        14 000212   200715 756100                    STQ     COUNT+2,,AUTO
        14 000213   001075 701000 14                 TSX1    WRITE$BODY
        14 000214   000710 702000 14                 TSX2    E_PMME

      661    11071    3           end;

      662    11072    3           if VM_HEADER.COPY$ ~= addr(nil) and NOT_ANSWER_OPT then do;

  11072 14 000215   000000 470400 xsym               LDP0    VM_HEADER$
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:110  
        14 000216   000021 236100                    LDQ     17,,PR0
        14 000217   000007 116000 15                 CMPQ    7
        14 000220   000245 600000 14                 TZE     s:11098
        14 000221   200007 471500                    LDP1    @NOT_ANSWER_OPT,,AUTO
        14 000222   100000 234100                    SZN     0,,PR1
        14 000223   000245 605000 14                 TPL     s:11098

      663    11073                    %INIT_STR( STR=VN_COPY, CODE=E_CMD_COPY_PROMPT, TEST=YES );

  11080 14 000224   040000 106400                    CMPC    fill='040'O
        14 000225   000130 200027 13                 ADSC9   VN_COPY                  cn=1,n=23
        14 000226   000010 000001 15                 ADSC9   8                        cn=0,n=1
        14 000227   000234 601000 14                 TNZ     s:11096

  11082 14 000230   000021 630400 15                 EPPR0   17
        14 000231   000000 631400 15                 EPPR1   0
        14 000232   000000 701000 xent               TSX1    VMD$ERRMSG
        14 000233   000000 011000                    NOP     0

      664    11096    3               call WRITE$BODY(VM_HEADER.COPY$,VN_COPY,INDX1) altret(E_PMME);

  11096 14 000234   200511 630500                    EPPR0   INDX1,,AUTO
        14 000235   200717 450500                    STP0    @FIELD_NAME+1,,AUTO
        14 000236   000022 236000 15                 LDQ     18
        14 000237   200716 756100                    STQ     @FIELD$+1,,AUTO
        14 000240   000000 236000 xsym               LDQ     VM_HEADER$
        14 000241   000021 036003                    ADLQ    17,DU
        14 000242   200715 756100                    STQ     COUNT+2,,AUTO
        14 000243   001075 701000 14                 TSX1    WRITE$BODY
        14 000244   000710 702000 14                 TSX2    E_PMME

      665    11097    3           end;

      666    11098    3           if VM_HEADER.BLIND$ ~= addr(nil) then do;

  11098 14 000245   000000 470400 xsym               LDP0    VM_HEADER$
        14 000246   000020 236100                    LDQ     16,,PR0
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:111  
        14 000247   000007 116000 15                 CMPQ    7
        14 000250   000272 600000 14                 TZE     s:11132

      667    11099                    %INIT_STR( STR=VN_BLIND_COPY, CODE=E_CMD_BC_PROMPT, TEST=YES );

  11106 14 000251   040000 106400                    CMPC    fill='040'O
        14 000252   000136 200027 13                 ADSC9   VN_BLIND_COPY            cn=1,n=23
        14 000253   000010 000001 15                 ADSC9   8                        cn=0,n=1
        14 000254   000261 601000 14                 TNZ     s:11122

  11108 14 000255   000023 630400 15                 EPPR0   19
        14 000256   000000 631400 15                 EPPR1   0
        14 000257   000000 701000 xent               TSX1    VMD$ERRMSG
        14 000260   000000 011000                    NOP     0

      668    11122    3               call WRITE$BODY(VM_HEADER.BLIND$,VN_BLIND_COPY,INDX1) altret(E_PMME);

  11122 14 000261   200511 630500                    EPPR0   INDX1,,AUTO
        14 000262   200717 450500                    STP0    @FIELD_NAME+1,,AUTO
        14 000263   000024 236000 15                 LDQ     20
        14 000264   200716 756100                    STQ     @FIELD$+1,,AUTO
        14 000265   000000 236000 xsym               LDQ     VM_HEADER$
        14 000266   000020 036003                    ADLQ    16,DU
        14 000267   200715 756100                    STQ     COUNT+2,,AUTO
        14 000270   001075 701000 14                 TSX1    WRITE$BODY
        14 000271   000710 702000 14                 TSX2    E_PMME

      669    11123    3           end;

      670    11124
      671    11125                %INIT_STR( STR=VN_FCOPY, CODE=E_CMD_FILE_COPY_PROMPT, TEST=YES );

  11132 14 000272   040000 106400                    CMPC    fill='040'O
        14 000273   000144 200027 13                 ADSC9   VN_FCOPY                 cn=1,n=23
        14 000274   000010 000001 15                 ADSC9   8                        cn=0,n=1
        14 000275   000302 601000 14                 TNZ     s:11155

PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:112  
  11134 14 000276   000025 630400 15                 EPPR0   21
        14 000277   000000 631400 15                 EPPR1   0
        14 000300   000000 701000 xent               TSX1    VMD$ERRMSG
        14 000301   000000 011000                    NOP     0

      672    11148                %INIT_STR( STR=VN_DR, CODE=E_DR_PROMPT , TEST=YES );

  11155 14 000302   040000 106400                    CMPC    fill='040'O
        14 000303   000202 200027 13                 ADSC9   VN_DR                    cn=1,n=23
        14 000304   000010 000001 15                 ADSC9   8                        cn=0,n=1
        14 000305   000312 601000 14                 TNZ     s:11178

  11157 14 000306   000027 630400 15                 EPPR0   23
        14 000307   000000 631400 15                 EPPR1   0
        14 000310   000000 701000 xent               TSX1    VMD$ERRMSG
        14 000311   000000 011000                    NOP     0

      673    11171                %INIT_STR( STR=VN_RR, CODE=E_RR_PROMPT , TEST=YES );

  11178 14 000312   040000 106400                    CMPC    fill='040'O
        14 000313   000152 200027 13                 ADSC9   VN_RR                    cn=1,n=23
        14 000314   000010 000001 15                 ADSC9   8                        cn=0,n=1
        14 000315   000322 601000 14                 TNZ     s:11201

  11180 14 000316   000031 630400 15                 EPPR0   25
        14 000317   000000 631400 15                 EPPR1   0
        14 000320   000000 701000 xent               TSX1    VMD$ERRMSG
        14 000321   000000 011000                    NOP     0

      674    11194                %INIT_STR( STR=VN_BROADCAST, CODE=E_BROADCAST_PROMPT, TEST=YES );

  11201 14 000322   040000 106400                    CMPC    fill='040'O
        14 000323   000174 200027 13                 ADSC9   VN_BROADCAST             cn=1,n=23
        14 000324   000010 000001 15                 ADSC9   8                        cn=0,n=1
        14 000325   000332 601000 14                 TNZ     s:11217

  11203 14 000326   000033 630400 15                 EPPR0   27
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:113  
        14 000327   000000 631400 15                 EPPR1   0
        14 000330   000000 701000 xent               TSX1    VMD$ERRMSG
        14 000331   000000 011000                    NOP     0

      675    11217    2          call WRITE$BODY(VM_NO_OR_YES$(bitbin(VM_HEADER.STATUS.FCOPY)),VN_FCOPY,INDX1
             11217                    ) altret(E_PMME);

  11217 14 000332   000000 470400 xsym               LDP0    VM_HEADER$
        14 000333   000012 236100                    LDQ     10,,PR0
        14 000334   000031 772000                    QRL     25
        14 000335   000001 376007                    ANQ     1,DL
        14 000336   200511 631500                    EPPR1   INDX1,,AUTO
        14 000337   200717 451500                    STP1    @FIELD_NAME+1,,AUTO
        14 000340   201120 756100                    STQ     TEMP_BUF+128,,AUTO
        14 000341   000026 236000 15                 LDQ     22
        14 000342   200716 756100                    STQ     @FIELD$+1,,AUTO
        14 000343   201120 720100                    LXL0    TEMP_BUF+128,,AUTO
        14 000344   000126 633410 12                 EPPR3   VM_NO_OR_YES$,X0
        14 000345   200715 453500                    STP3    COUNT+2,,AUTO
        14 000346   001075 701000 14                 TSX1    WRITE$BODY
        14 000347   000710 702000 14                 TSX2    E_PMME

      676    11218    2           call WRITE$BODY(VM_NO_OR_YES$(bitbin(VM_HEADER.STATUS.DR)),VN_DR,INDX1)
             11218                    altret(E_PMME);

  11218 14 000350   000000 470400 xsym               LDP0    VM_HEADER$
        14 000351   000012 236100                    LDQ     10,,PR0
        14 000352   000024 772000                    QRL     20
        14 000353   000001 376007                    ANQ     1,DL
        14 000354   200511 631500                    EPPR1   INDX1,,AUTO
        14 000355   200717 451500                    STP1    @FIELD_NAME+1,,AUTO
        14 000356   201120 756100                    STQ     TEMP_BUF+128,,AUTO
        14 000357   000030 236000 15                 LDQ     24
        14 000360   200716 756100                    STQ     @FIELD$+1,,AUTO
        14 000361   201120 720100                    LXL0    TEMP_BUF+128,,AUTO
        14 000362   000126 633410 12                 EPPR3   VM_NO_OR_YES$,X0
        14 000363   200715 453500                    STP3    COUNT+2,,AUTO
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:114  
        14 000364   001075 701000 14                 TSX1    WRITE$BODY
        14 000365   000710 702000 14                 TSX2    E_PMME

      677    11219    2           call WRITE$BODY(VM_NO_OR_YES$(bitbin(VM_HEADER.STATUS.RR)),VN_RR,INDX1);

  11219 14 000366   000000 470400 xsym               LDP0    VM_HEADER$
        14 000367   000012 236100                    LDQ     10,,PR0
        14 000370   000037 772000                    QRL     31
        14 000371   000001 376007                    ANQ     1,DL
        14 000372   200511 631500                    EPPR1   INDX1,,AUTO
        14 000373   200717 451500                    STP1    @FIELD_NAME+1,,AUTO
        14 000374   201120 756100                    STQ     TEMP_BUF+128,,AUTO
        14 000375   000032 236000 15                 LDQ     26
        14 000376   200716 756100                    STQ     @FIELD$+1,,AUTO
        14 000377   201120 720100                    LXL0    TEMP_BUF+128,,AUTO
        14 000400   000126 633410 12                 EPPR3   VM_NO_OR_YES$,X0
        14 000401   200715 453500                    STP3    COUNT+2,,AUTO
        14 000402   001075 701000 14                 TSX1    WRITE$BODY
        14 000403   000000 011000                    NOP     0

      678    11220    2           call WRITE$BODY(VM_NO_OR_YES$(bitbin(VM_HEADER.STATUS.BROADCAST)),
             11220                    VN_BROADCAST,INDX1) altret(E_PMME);

  11220 14 000404   000000 470400 xsym               LDP0    VM_HEADER$
        14 000405   000012 236100                    LDQ     10,,PR0
        14 000406   000022 772000                    QRL     18
        14 000407   000001 376007                    ANQ     1,DL
        14 000410   200511 631500                    EPPR1   INDX1,,AUTO
        14 000411   200717 451500                    STP1    @FIELD_NAME+1,,AUTO
        14 000412   201120 756100                    STQ     TEMP_BUF+128,,AUTO
        14 000413   000034 236000 15                 LDQ     28
        14 000414   200716 756100                    STQ     @FIELD$+1,,AUTO
        14 000415   201120 720100                    LXL0    TEMP_BUF+128,,AUTO
        14 000416   000126 633410 12                 EPPR3   VM_NO_OR_YES$,X0
        14 000417   200715 453500                    STP3    COUNT+2,,AUTO
        14 000420   001075 701000 14                 TSX1    WRITE$BODY
        14 000421   000710 702000 14                 TSX2    E_PMME
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:115  

      679    11221    2           IF VM_HEADER.DELIVERY_DATE > 0

  11221 14 000422   000000 470400 xsym               LDP0    VM_HEADER$
        14 000423   000002 235100                    LDA     2,,PR0
        14 000424   000470 600000 14                 TZE     s:11252

      680    11222    3           THEN DO;

      681    11223                    %INIT_STR( STR=VN_DEFER, CODE=E_CMD_DEFER_PROMPT, TEST=YES );

  11230 14 000425   040000 106400                    CMPC    fill='040'O
        14 000426   000160 200027 13                 ADSC9   VN_DEFER                 cn=1,n=23
        14 000427   000010 000001 15                 ADSC9   8                        cn=0,n=1
        14 000430   000435 601000 14                 TNZ     s:11246

  11232 14 000431   000035 630400 15                 EPPR0   29
        14 000432   000000 631400 15                 EPPR1   0
        14 000433   000000 701000 xent               TSX1    VMD$ERRMSG
        14 000434   000000 011000                    NOP     0

      682    11246    3               WORK_UTS = VM_HEADER.DELIVERY_DATE;

  11246 14 000435   000000 470400 xsym               LDP0    VM_HEADER$
        14 000436   000002 235100                    LDA     2,,PR0
        14 000437   000076 755000 13                 STA     WORK_UTS

      683    11247    3               call M$TIME (DEFER_TIME) altret(E_PMME);

  11247 14 000440   000074 630400 12                 EPPR0   DEFER_TIME
        14 000441   420004 713400                    CLIMB   alt,+8196
        14 000442   402000 401760                    pmme    nvectors=5
        14 000443   000710 702000 14                 TSX2    E_PMME

      684    11248    3               TEMP_BUF.L# = (sizec(WORK_TIMER) - 6) + sizec(WORK_DATER) + 1;

  11248 14 000444   016000 236003                    LDQ     7168,DU
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:116  
        14 000445   200310 552140                    STBQ    TEMP_BUF,'40'O,AUTO

      685    11249    3               call concat(TEMP_BUF.NAME#,substr(WORK_TIMER,0,5),',',WORK_DATER);

  11249 14 000446   040100 100400                    MLR     fill='040'O
        14 000447   000072 000005 13                 ADSC9   WORK_TIME                cn=0,n=5
        14 000450   200310 200005                    ADSC9   TEMP_BUF,,AUTO           cn=1,n=5
        14 000451   054000 236007                    LDQ     22528,DL
        14 000452   200311 552110                    STBQ    TEMP_BUF+1,'10'O,AUTO
        14 000453   040100 100400                    MLR     fill='040'O
        14 000454   000070 000010 13                 ADSC9   WORK_DATE                cn=0,n=8
        14 000455   200311 600772                    ADSC9   TEMP_BUF+1,,AUTO         cn=3,n=506

      686    11250    3               call WRITE$BODY(ADDR(TEMP_BUF),VN_DEFER,INDX1) altret(E_PMME);

  11250 14 000456   200310 630500                    EPPR0   TEMP_BUF,,AUTO
        14 000457   201127 450500                    STP0    TEMP_BUF+135,,AUTO
        14 000460   200511 631500                    EPPR1   INDX1,,AUTO
        14 000461   200717 451500                    STP1    @FIELD_NAME+1,,AUTO
        14 000462   000036 236000 15                 LDQ     30
        14 000463   200716 756100                    STQ     @FIELD$+1,,AUTO
        14 000464   201127 633500                    EPPR3   TEMP_BUF+135,,AUTO
        14 000465   200715 453500                    STP3    COUNT+2,,AUTO
        14 000466   001075 701000 14                 TSX1    WRITE$BODY
        14 000467   000710 702000 14                 TSX2    E_PMME

      687    11251    3           end;

      688    11252    3           if VM_HEADER.SIGNED$ ~= addr(nil) then do;

  11252 14 000470   000000 470400 xsym               LDP0    VM_HEADER$
        14 000471   000027 236100                    LDQ     23,,PR0
        14 000472   000007 116000 15                 CMPQ    7
        14 000473   000515 600000 14                 TZE     s:11279

      689    11253                    %INIT_STR( STR=VN_SIGNED, CODE=E_CMD_SIGNED_PROMPT, TEST=YES );

PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:117  
  11260 14 000474   040000 106400                    CMPC    fill='040'O
        14 000475   000166 200027 13                 ADSC9   VN_SIGNED                cn=1,n=23
        14 000476   000010 000001 15                 ADSC9   8                        cn=0,n=1
        14 000477   000504 601000 14                 TNZ     s:11276

  11262 14 000500   000037 630400 15                 EPPR0   31
        14 000501   000000 631400 15                 EPPR1   0
        14 000502   000000 701000 xent               TSX1    VMD$ERRMSG
        14 000503   000000 011000                    NOP     0

      690    11276    3               call WRITE$BODY(VM_HEADER.SIGNED$,VN_SIGNED,INDX1) altret(E_PMME);

  11276 14 000504   200511 630500                    EPPR0   INDX1,,AUTO
        14 000505   200717 450500                    STP0    @FIELD_NAME+1,,AUTO
        14 000506   000040 236000 15                 LDQ     32
        14 000507   200716 756100                    STQ     @FIELD$+1,,AUTO
        14 000510   000000 236000 xsym               LDQ     VM_HEADER$
        14 000511   000027 036003                    ADLQ    23,DU
        14 000512   200715 756100                    STQ     COUNT+2,,AUTO
        14 000513   001075 701000 14                 TSX1    WRITE$BODY
        14 000514   000710 702000 14                 TSX2    E_PMME

      691    11277    3           end;

      692    11278    2       END;

      693    11279    2       DO INDX2 = 0 TO VM_HEADER.NUM_TRACE_RECORDS - 1;

  11279 14 000515   200512 450100                    STZ     INDX2,,AUTO
        14 000516   000611 710000 14                 TRA     s:11300+1

      694    11280    2           CALL VMD$GET_TRACE (MESSAGE_NUMBER,DCB#,INDX2,COUNT,

  11280 14 000517   200307 630500                    EPPR0   WRITE_EDIT_REC+11,,AUTO
        14 000520   201126 450500                    STP0    TEMP_BUF+134,,AUTO
        14 000521   200010 631500                    EPPR1   VM_BODYREC,,AUTO
        14 000522   201125 451500                    STP1    TEMP_BUF+133,,AUTO
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:118  
        14 000523   200004 236100                    LDQ     @SEED,,AUTO
        14 000524   201124 756100                    STQ     TEMP_BUF+132,,AUTO
        14 000525   200713 633500                    EPPR3   COUNT,,AUTO
        14 000526   201123 453500                    STP3    TEMP_BUF+131,,AUTO
        14 000527   200512 634500                    EPPR4   INDX2,,AUTO
        14 000530   201122 454500                    STP4    TEMP_BUF+130,,AUTO
        14 000531   200005 236100                    LDQ     @DCB#,,AUTO
        14 000532   200003 235100                    LDA     @MESSAGE_NUMBER,,AUTO
        14 000533   201120 757100                    STAQ    TEMP_BUF+128,,AUTO
        14 000534   201120 630500                    EPPR0   TEMP_BUF+128,,AUTO
        14 000535   000041 631400 15                 EPPR1   33
        14 000536   000000 701000 xent               TSX1    VMD$GET_TRACE
        14 000537   000710 702000 14                 TSX2    E_PMME

      695    11281    2             SEED,VM_BODYREC,WRITE_EDIT_REC.V.DVBYTE) ALTRET(E_PMME);
      696    11282    2           INDX1 = INDX1 + 2;

  11282 14 000540   000002 236007                    LDQ     2,DL
        14 000541   200511 056100                    ASQ     INDX1,,AUTO

      697    11283    2           EDIT_KEY.KEY = INDX1;

  11283 14 000542   200511 236100                    LDQ     INDX1,,AUTO
        14 000543   000075 552034 13                 STBQ    EDIT_KEY,'34'O

      698    11284    2           EDIT_KEY.COUNT = 3;

  11284 14 000544   003000 236003                    LDQ     1536,DU
        14 000545   000075 552040 13                 STBQ    EDIT_KEY,'40'O

      699    11285    3           if VM_BODYREC.TYPE ~= %VM_BODY_TEXT then do;

  11285 14 000546   200010 236100                    LDQ     VM_BODYREC,,AUTO
        14 000547   777000 376003                    ANQ     -512,DU
        14 000550   001000 116003                    CMPQ    512,DU
        14 000551   000553 600000 14                 TZE     s:11290

PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:119  
      700    11286                                                /* Future code */
      701    11287    3           END;

  11287 14 000552   000610 710000 14                 TRA     s:11300

      702    11288    2           ELSE
      703    11289    3           DO;                    /* Normal text */

      704    11290    4               IF COUNT = 0 THEN DO; /* Unit rec. file can net count=0 */

  11290 14 000553   200713 235100                    LDA     COUNT,,AUTO
        14 000554   000566 601000 14                 TNZ     s:11295

      705    11291    4                   TRACE_BUF = 'Trace:';

  11291 14 000555   040100 100400                    MLR     fill='040'O
        14 000556   000130 000006 12                 ADSC9   VM_NO_OR_YES$+2          cn=0,n=6
        14 000557   200513 001000                    ADSC9   TRACE_BUF,,AUTO          cn=0,n=512

      706    11292    4                   WRITE_EDIT_REC.BUF_ = VECTOR(SUBSTR(TRACE_BUF,0,5));

  11292 14 000560   000042 235000 15                 LDA     34
        14 000561   201120 452500                    STP2    TEMP_BUF+128,,AUTO
        14 000562   201120 236100                    LDQ     TEMP_BUF+128,,AUTO
        14 000563   000513 036003                    ADLQ    331,DU
        14 000564   200300 757100                    STAQ    WRITE_EDIT_REC+4,,AUTO

      707    11293    4               END;

  11293 14 000565   000604 710000 14                 TRA     s:11298

      708    11294    4               ELSE DO;

      709    11295    4                  CALL CONCAT(TRACE_BUF, 'Trace:',SUBSTR(VM_BODYREC.VALUE.DATA,0,COUNT
             11295                            ));

  11295 14 000566   040100 100400                    MLR     fill='040'O
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:120  
        14 000567   000130 000006 12                 ADSC9   VM_NO_OR_YES$+2          cn=0,n=6
        14 000570   200513 000006                    ADSC9   TRACE_BUF,,AUTO          cn=0,n=6
        14 000571   000000 620005                    EAX0    0,AL
        14 000572   040100 100540                    MLR     fill='040'O
        14 000573   200012 000010                    ADSC9   VM_BODYREC+2,,AUTO       cn=0,n=*X0
        14 000574   200514 400772                    ADSC9   TRACE_BUF+1,,AUTO        cn=2,n=506

      710    11296    4                   WRITE_EDIT_REC.BUF_ = VECTOR(SUBSTR(TRACE_BUF,0,COUNT+6));

  11296 14 000575   200713 235100                    LDA     COUNT,,AUTO
        14 000576   000020 735000                    ALS     16
        14 000577   000043 035000 15                 ADLA    35
        14 000600   201120 452500                    STP2    TEMP_BUF+128,,AUTO
        14 000601   201120 236100                    LDQ     TEMP_BUF+128,,AUTO
        14 000602   000513 036003                    ADLQ    331,DU
        14 000603   200300 757100                    STAQ    WRITE_EDIT_REC+4,,AUTO

      711    11297    4               END;

      712    11298    3               CALL M$WRITE (WRITE_EDIT_REC) ALTRET(E_PMME);

  11298 14 000604   200274 630500                    EPPR0   WRITE_EDIT_REC,,AUTO
        14 000605   440001 713400                    CLIMB   alt,write
        14 000606   401400 401760                    pmme    nvectors=4
        14 000607   000710 702000 14                 TSX2    E_PMME

      713    11299    3           END;

      714    11300    2       END;                            /* Do INDX1 = ... end */

  11300 14 000610   200512 054100                    AOS     INDX2,,AUTO
        14 000611   000000 470400 xsym               LDP0    VM_HEADER$
        14 000612   200512 236100                    LDQ     INDX2,,AUTO
        14 000613   000517 604000 14                 TMI     s:11280
        14 000614   000034 116100                    CMPQ    28,,PR0
        14 000615   000517 602000 14                 TNC     s:11280

PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:121  
      715    11301    2       DO INDX1 = 0 TO VM_HEADER.NUM_RECORDS - 1;

  11301 14 000616   200511 450100                    STZ     INDX1,,AUTO
        14 000617   000674 710000 14                 TRA     s:11319+1

      716    11302    2           CALL VMD$GET_BODY (MESSAGE_NUMBER,DCB#,INDX1,COUNT,

  11302 14 000620   200307 630500                    EPPR0   WRITE_EDIT_REC+11,,AUTO
        14 000621   201126 450500                    STP0    TEMP_BUF+134,,AUTO
        14 000622   200010 631500                    EPPR1   VM_BODYREC,,AUTO
        14 000623   201125 451500                    STP1    TEMP_BUF+133,,AUTO
        14 000624   200004 236100                    LDQ     @SEED,,AUTO
        14 000625   201124 756100                    STQ     TEMP_BUF+132,,AUTO
        14 000626   200713 633500                    EPPR3   COUNT,,AUTO
        14 000627   201123 453500                    STP3    TEMP_BUF+131,,AUTO
        14 000630   200511 634500                    EPPR4   INDX1,,AUTO
        14 000631   201122 454500                    STP4    TEMP_BUF+130,,AUTO
        14 000632   200005 236100                    LDQ     @DCB#,,AUTO
        14 000633   200003 235100                    LDA     @MESSAGE_NUMBER,,AUTO
        14 000634   201120 757100                    STAQ    TEMP_BUF+128,,AUTO
        14 000635   201120 630500                    EPPR0   TEMP_BUF+128,,AUTO
        14 000636   000041 631400 15                 EPPR1   33
        14 000637   000000 701000 xent               TSX1    VMD$GET_BODY
        14 000640   000710 702000 14                 TSX2    E_PMME

      717    11303    2             SEED,VM_BODYREC,WRITE_EDIT_REC.V.DVBYTE) ALTRET(E_PMME);
      718    11304    2           EDIT_KEY.KEY = (INDX1 + 1) * 1000;

  11304 14 000641   200511 236100                    LDQ     INDX1,,AUTO
        14 000642   001750 402007                    MPY     1000,DL
        14 000643   001750 036007                    ADLQ    1000,DL
        14 000644   000075 552034 13                 STBQ    EDIT_KEY,'34'O

      719    11305    2           EDIT_KEY.COUNT = 3;

  11305 14 000645   003000 236003                    LDQ     1536,DU
        14 000646   000075 552040 13                 STBQ    EDIT_KEY,'40'O
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:122  

      720    11306    2           IF VM_BODYREC.TYPE ~= %VM_BODY_TEXT

  11306 14 000647   200010 236100                    LDQ     VM_BODYREC,,AUTO
        14 000650   777000 376003                    ANQ     -512,DU
        14 000651   001000 116003                    CMPQ    512,DU
        14 000652   000654 600000 14                 TZE     s:11313

      721    11307    2           THEN
      722    11308    3           DO;                    /* Error!!! */

      723    11309                                                /* Future code */
      724    11310    3           END;

  11310 14 000653   000673 710000 14                 TRA     s:11319

      725    11311    2           ELSE
      726    11312    3           DO;                    /* Normal text */

      727    11313    3               IF COUNT = 0 THEN /* Unit rec. file can net count=0  */

  11313 14 000654   200713 235100                    LDA     COUNT,,AUTO
        14 000655   000661 601000 14                 TNZ     s:11316

      728    11314    3                   WRITE_EDIT_REC.BUF_ =VECTOR(NIL);

  11314 14 000656   000044 237000 15                 LDAQ    36
        14 000657   200300 757100                    STAQ    WRITE_EDIT_REC+4,,AUTO
        14 000660   000667 710000 14                 TRA     s:11317

      729    11315    3               ELSE
      730    11316    3                  WRITE_EDIT_REC.BUF_ = VECTOR(SUBSTR(VM_BODYREC.VALUE.DATA,0,COUNT));

  11316 14 000661   000020 735000                    ALS     16
        14 000662   000140 135007                    SBLA    96,DL
        14 000663   201120 452500                    STP2    TEMP_BUF+128,,AUTO
        14 000664   201120 236100                    LDQ     TEMP_BUF+128,,AUTO
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:123  
        14 000665   000012 036003                    ADLQ    10,DU
        14 000666   200300 757100                    STAQ    WRITE_EDIT_REC+4,,AUTO

      731    11317    3               CALL M$WRITE (WRITE_EDIT_REC) ALTRET(E_PMME);

  11317 14 000667   200274 630500                    EPPR0   WRITE_EDIT_REC,,AUTO
        14 000670   440001 713400                    CLIMB   alt,write
        14 000671   401400 401760                    pmme    nvectors=4
        14 000672   000710 702000 14                 TSX2    E_PMME

      732    11318    3           END;

      733    11319    2       END;                            /* Do INDX1 = ... end */

  11319 14 000673   200511 054100                    AOS     INDX1,,AUTO
        14 000674   000000 470400 xsym               LDP0    VM_HEADER$
        14 000675   200511 236100                    LDQ     INDX1,,AUTO
        14 000676   000620 604000 14                 TMI     s:11302
        14 000677   000011 116100                    CMPQ    9,,PR0
        14 000700   000620 602000 14                 TNC     s:11302

      734    11320        /*
      735    11321             ***** Close the edit file ...
      736    11322        */
      737    11323    1       CLOSE_EDIT.V.DISP# = %SAVE#;

  11323 14 000701   000002 236007                    LDQ     2,DL
        14 000702   200252 552104                    STBQ    CLOSE_EDIT+26,'04'O,AUTO

      738    11324    1       CALL M$CLOSE (CLOSE_EDIT) ALTRET(E_PMME);

  11324 14 000703   200220 630500                    EPPR0   CLOSE_EDIT,,AUTO
        14 000704   450001 713400                    CLIMB   alt,close
        14 000705   406000 401760                    pmme    nvectors=13
        14 000706   000710 702000 14                 TSX2    E_PMME

      739    11325    1       RETURN;
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:124  

  11325 14 000707   000000 702200 xent               TSX2  ! X66_ARET

      740    11326        /**/
      741    11327    1   E_PMME:
      742    11328    1       IF FILE$ -> F$DCB.FCD#

  11328 14 000710   000077 470400 13    E_PMME       LDP0    FILE$
        14 000711   000031 236100                    LDQ     25,,PR0
        14 000712   020000 316007                    CANQ    8192,DL
        14 000713   000717 600000 14                 TZE     s:11331

      743    11329    1       THEN
      744    11330    1           CALL M$CLOSE (CLOSE_EDIT);

  11330 14 000714   200220 630500                    EPPR0   CLOSE_EDIT,,AUTO
        14 000715   050001 713400                    CLIMB   close
        14 000716   406000 401760                    pmme    nvectors=13

      745    11331    1       ALTRETURN;

  11331 14 000717   000000 702200 xent               TSX2  ! X66_AALT

      746    11332        %EJECT;
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:125  
      747    11333        /*F*
      748    11334                NAME: VMM$EDIT_MESSAGE_IN
      749    11335                PURPOSE:
      750    11336                      To replace the body of a message from an EDIT-type file.
      751    11337                DESCRIPTION:
      752    11338                       This routine will replace the body of the specified message
      753    11339                       with the contents of the EDIT_type file '*BODY'.  The
      754    11340                      message must be contained in the filder to which DCB#
      755    11341                      is currently open. '*EDIT' will be deleted.
      756    11342
      757    11343                      This routine has 4 parameters.
      758    11344
      759    11345                         MESSAGE_NUMBER - number of the message to process.
      760    11346                         SEED - seed used to encrypt the message body.
      761    11347                         DCB# - number of DCB which is open to folder containing message.
      762    11348                         ALL_FIELDS - unused
      763    11349        */
      764    11350    1   VMM$EDIT_MESSAGE_IN: ENTRY (MESSAGE_NUMBER,SEED,DCB#,ALL_FIELDS) ALTRET;

  11350 14 000720   000000 700200 xent  VMM$EDIT_ME* TSX0  ! X66_AUTO_5
        14 000721   001130 000005                    ZERO    600,5

      765    11351        /*
      766    11352             ***** Initialize our FPT's    *****
      767    11353        */
      768    11354    1       OPEN_EDIT_FILE      =  OPEN_EDIT_FILE_CONST;

  11354 14 000722   000100 100400                    MLR     fill='000'O
        14 000723   000000 000350 12                 ADSC9   OPEN_EDIT_FILE_CONST     cn=0,n=232
        14 000724   200126 000350                    ADSC9   OPEN_EDIT_FILE,,AUTO     cn=0,n=232

      769    11355    1       OPEN_EDIT_FILE.V_   =  vector(OPEN_EDIT_FILE.V);

  11355 14 000725   000005 235000 15                 LDA     5
        14 000726   201120 452500                    STP2    TEMP_BUF+128,,AUTO
        14 000727   201120 236100                    LDQ     TEMP_BUF+128,,AUTO
        14 000730   000172 036003                    ADLQ    122,DU
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:126  
        14 000731   200126 757100                    STAQ    OPEN_EDIT_FILE,,AUTO

      770    11356
      771    11357    1       CLOSE_EDIT          =  CLOSE_EDIT_CONST;

  11357 14 000732   000100 100400                    MLR     fill='000'O
        14 000733   000000 000170 13                 ADSC9   CLOSE_EDIT_CONST         cn=0,n=120
        14 000734   200220 000170                    ADSC9   CLOSE_EDIT,,AUTO         cn=0,n=120

      772    11358    1       CLOSE_EDIT.V_       =  vector(CLOSE_EDIT.V);

  11358 14 000735   000006 235000 15                 LDA     6
        14 000736   201120 452500                    STP2    TEMP_BUF+128,,AUTO
        14 000737   201120 236100                    LDQ     TEMP_BUF+128,,AUTO
        14 000740   000252 036003                    ADLQ    170,DU
        14 000741   200220 757100                    STAQ    CLOSE_EDIT,,AUTO

      773    11359
      774    11360    1       READ_EDIT_REC       =  READ_EDIT_REC_CONST;

  11360 14 000742   000100 100400                    MLR     fill='000'O
        14 000743   000036 000070 13                 ADSC9   READ_EDIT_REC_CONST      cn=0,n=56
        14 000744   200256 000070                    ADSC9   READ_EDIT_REC,,AUTO      cn=0,n=56

      775    11361    1       READ_EDIT_REC.V_    =  vector(READ_EDIT_REC.V);

  11361 14 000745   000046 235000 15                 LDA     38
        14 000746   201120 452500                    STP2    TEMP_BUF+128,,AUTO
        14 000747   201120 236100                    LDQ     TEMP_BUF+128,,AUTO
        14 000750   000266 036003                    ADLQ    182,DU
        14 000751   200256 757100                    STAQ    READ_EDIT_REC,,AUTO

      776    11362        /*
      777    11363             ***** Open the edit file ...
      778    11364        */
      779    11365    1       OPEN_EDIT_FILE.V.EXIST# = %OLDFILE#;

PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:127  
  11365 14 000752   200172 236100                    LDQ     OPEN_EDIT_FILE+36,,AUTO
        14 000753   000047 376000 15                 ANQ     39
        14 000754   000400 276007                    ORQ     256,DL
        14 000755   200172 756100                    STQ     OPEN_EDIT_FILE+36,,AUTO

      780    11366    1       OPEN_EDIT_FILE.V.FUN# = %IN#;

  11366 14 000756   002000 236007                    LDQ     1024,DL
        14 000757   200173 552110                    STBQ    OPEN_EDIT_FILE+37,'10'O,AUTO

      781    11367    1       CALL M$OPEN (OPEN_EDIT_FILE) ALTRET(E_PMME);

  11367 14 000760   200126 630500                    EPPR0   OPEN_EDIT_FILE,,AUTO
        14 000761   450000 713400                    CLIMB   alt,open
        14 000762   410400 401760                    pmme    nvectors=18
        14 000763   000710 702000 14                 TSX2    E_PMME

      782    11368    1       FILE$=DCBADDR(DCBNUM(M$EDIT));

  11368 14 000764   000000 236007 xsym               LDQ     M$EDIT,DL
        14 000765   000050 470400 15                 LDP0    40
        14 000766   000000 471500                    LDP1    0,,PR0
        14 000767   100000 236106                    LDQ     0,QL,PR1
        14 000770   000077 756000 13                 STQ     FILE$

      783    11369        /*
      784    11370             ***** Do it...
      785    11371        */
      786    11372    1       EDIT_KEY.KEY = 0;

  11372 14 000771   000000 236003                    LDQ     0,DU
        14 000772   000075 552034 13                 STBQ    EDIT_KEY,'34'O

      787    11373    1       EDIT_KEY.COUNT = 3;

  11373 14 000773   003000 236003                    LDQ     1536,DU
        14 000774   000075 552040 13                 STBQ    EDIT_KEY,'40'O
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:128  

      788    11374    1       VM_BODYREC.TYPE = %VM_BODY_TEXT;

  11374 14 000775   001000 236003                    LDQ     512,DU
        14 000776   200010 552140                    STBQ    VM_BODYREC,'40'O,AUTO

      789    11375    1       READ_EDIT_REC.BUF_ = VECTOR(VM_BODYREC.VALUE.DATA);

  11375 14 000777   000051 235000 15                 LDA     41
        14 001000   201120 452500                    STP2    TEMP_BUF+128,,AUTO
        14 001001   201120 236100                    LDQ     TEMP_BUF+128,,AUTO
        14 001002   000012 036003                    ADLQ    10,DU
        14 001003   200262 757100                    STAQ    READ_EDIT_REC+4,,AUTO

      790    11376    1       INDX1 = 0;

  11376 14 001004   200511 450100                    STZ     INDX1,,AUTO

      791    11377    2       DO FOREVER;

      792    11378    2           CALL M$READ (READ_EDIT_REC) ALTRET(END_LOOP);

  11378 14 001005   200256 630500                    EPPR0   READ_EDIT_REC,,AUTO
        14 001006   440000 713400                    CLIMB   alt,read
        14 001007   401400 401760                    pmme    nvectors=4
        14 001010   001041 702000 14                 TSX2    END_LOOP

      793    11379    2           COUNT = FILE$ -> F$DCB.ARS#;

  11379 14 001011   000077 470400 13                 LDP0    FILE$
        14 001012   000000 235100                    LDA     0,,PR0
        14 001013   200713 755100                    STA     COUNT,,AUTO

      794    11380    2           VM_BODYREC.VALUE.COUNT = COUNT;

  11380 14 001014   200011 755100                    STA     VM_BODYREC+1,,AUTO

PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:129  
      795    11381    2           CALL VMD$PUT_BODY (MESSAGE_NUMBER,DCB#,INDX1,COUNT,SEED,VM_BODYREC,FILE$->
             11381                    F$DCB.DVBYTE) ALTRET(E_PMME);

  11381 14 001015   000077 236000 13                 LDQ     FILE$
        14 001016   000003 036003                    ADLQ    3,DU
        14 001017   201126 756100                    STQ     TEMP_BUF+134,,AUTO
        14 001020   200010 631500                    EPPR1   VM_BODYREC,,AUTO
        14 001021   201125 451500                    STP1    TEMP_BUF+133,,AUTO
        14 001022   200004 236100                    LDQ     @SEED,,AUTO
        14 001023   201124 756100                    STQ     TEMP_BUF+132,,AUTO
        14 001024   200713 633500                    EPPR3   COUNT,,AUTO
        14 001025   201123 453500                    STP3    TEMP_BUF+131,,AUTO
        14 001026   200511 634500                    EPPR4   INDX1,,AUTO
        14 001027   201122 454500                    STP4    TEMP_BUF+130,,AUTO
        14 001030   200005 236100                    LDQ     @DCB#,,AUTO
        14 001031   200003 235100                    LDA     @MESSAGE_NUMBER,,AUTO
        14 001032   201120 757100                    STAQ    TEMP_BUF+128,,AUTO
        14 001033   201120 630500                    EPPR0   TEMP_BUF+128,,AUTO
        14 001034   000041 631400 15                 EPPR1   33
        14 001035   000000 701000 xent               TSX1    VMD$PUT_BODY
        14 001036   000710 702000 14                 TSX2    E_PMME

      796    11382    2           INDX1 = INDX1 + 1;

  11382 14 001037   200511 054100                    AOS     INDX1,,AUTO

      797    11383    2       END;                            /* Do forever ... end */

  11383 14 001040   001005 710000 14                 TRA     s:11378

      798    11384        /**/
      799    11385    1   END_LOOP:
      800    11386    1       IF VM_HEADER.NUM_RECORDS  > INDX1

  11386 14 001041   000000 470400 xsym  END_LOOP     LDP0    VM_HEADER$
        14 001042   000011 236100                    LDQ     9,,PR0
        14 001043   001046 604000 14                 TMI     s:11389
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:130  
        14 001044   200511 116100                    CMPQ    INDX1,,AUTO
        14 001045   001063 604400 14                 TMOZ    s:11392

      801    11387    1       THEN                  /* More records in original message than now */
      802    11388    2       DO;                          /* Delete the extra records */

      803    11389    2           INDX2 = VM_HEADER.NUM_RECORDS - 1;

  11389 14 001046   000001 136007                    SBLQ    1,DL
        14 001047   200512 756100                    STQ     INDX2,,AUTO

      804    11390    2           CALL VMD$DEL_BODY (MESSAGE_NUMBER,DCB#,INDX1,INDX2) ALTRET(E_PMME);

  11390 14 001050   200512 631500                    EPPR1   INDX2,,AUTO
        14 001051   201123 451500                    STP1    TEMP_BUF+131,,AUTO
        14 001052   200511 633500                    EPPR3   INDX1,,AUTO
        14 001053   201122 453500                    STP3    TEMP_BUF+130,,AUTO
        14 001054   200005 236100                    LDQ     @DCB#,,AUTO
        14 001055   200003 235100                    LDA     @MESSAGE_NUMBER,,AUTO
        14 001056   201120 757100                    STAQ    TEMP_BUF+128,,AUTO
        14 001057   201120 630500                    EPPR0   TEMP_BUF+128,,AUTO
        14 001060   000052 631400 15                 EPPR1   42
        14 001061   000000 701000 xent               TSX1    VMD$DEL_BODY
        14 001062   000710 702000 14                 TSX2    E_PMME

      805    11391    2       END;                       /* Do ... end */

      806    11392    1       VM_HEADER.NUM_RECORDS = INDX1;

  11392 14 001063   200511 235100                    LDA     INDX1,,AUTO
        14 001064   000000 470400 xsym               LDP0    VM_HEADER$
        14 001065   000011 755100                    STA     9,,PR0

      807    11393        /*
      808    11394             ***** Close the edit file ...
      809    11395        */
      810    11396    1       CLOSE_EDIT.V.DISP# = %SCRATCH#;
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:131  

  11396 14 001066   000001 236007                    LDQ     1,DL
        14 001067   200252 552104                    STBQ    CLOSE_EDIT+26,'04'O,AUTO

      811    11397    1       CALL M$CLOSE (CLOSE_EDIT) ALTRET(E_PMME);

  11397 14 001070   200220 630500                    EPPR0   CLOSE_EDIT,,AUTO
        14 001071   450001 713400                    CLIMB   alt,close
        14 001072   406000 401760                    pmme    nvectors=13
        14 001073   000710 702000 14                 TSX2    E_PMME

      812    11398    1       RETURN;

  11398 14 001074   000000 702200 xent               TSX2  ! X66_ARET

      813    11399        %EJECT;
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:132  
      814    11400        /********************************************************************/
      815    11401        /*I*
      816    11402             NAME: WRITE$BODY
      817    11403             PURPOSE: To write the To,Reply_To,Subject,Reference,Copy,Blind Copy,
      818    11404                   Defer, and Signed fields to *BODY.
      819    11405        */
      820    11406        /********************************************************************/
      821    11407
      822    11408    1   WRITE$BODY: proc(FIELD$, FIELD_NAME, INDX)  altret;

  11408 14 001075   200714 741300       WRITE$BODY   STX1  ! COUNT+1,,AUTO

      823    11409    2   dcl FIELD$ ptr;                 /* Pointer to textc field in header */
      824    11410    2   dcl 1  FIELD_NAME        aligned,
      825    11411    2         2 SIZ           ubin(9) caligned,
      826    11412    2         2 TEXT          char(FIELD_NAME.SIZ) caligned;
      827    11413
      828    11414    2   dcl INDX ubin;
      829    11415    2   dcl TEMP_BUF char(512);
      830    11416
      831    11417
      832    11418    2       COUNT   = FIELD_NAME.SIZ;

  11418 14 001076   200716 470500                    LDP0    @FIELD_NAME,,AUTO
        14 001077   000000 236100                    LDQ     0,,PR0
        14 001100   000033 772000                    QRL     27
        14 001101   200713 756100                    STQ     COUNT,,AUTO

      833    11419    2       substr(TEMP_BUF,,COUNT) = substr(FIELD_NAME.TEXT,,COUNT);

  11419 14 001102   000000 236100                    LDQ     0,,PR0
        14 001103   000033 772000                    QRL     27
        14 001104   200713 720100                    LXL0    COUNT,,AUTO
        14 001105   040140 100540                    MLR     fill='040'O
        14 001106   000000 200010                    ADSC9   0,,PR0                   cn=1,n=*X0
        14 001107   200720 000010                    ADSC9   TEMP_BUF,,AUTO           cn=0,n=*X0

PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:133  
      834    11420
      835    11421    2       INDX          = INDX + 5;

  11421 14 001110   200717 471500                    LDP1    @INDX,,AUTO
        14 001111   100000 235100                    LDA     0,,PR1
        14 001112   000005 035007                    ADLA    5,DL
        14 001113   100000 755100                    STA     0,,PR1

      836    11422    2       EDIT_KEY.KEY  = INDX;

  11422 14 001114   100000 236100                    LDQ     0,,PR1
        14 001115   000075 552034 13                 STBQ    EDIT_KEY,'34'O

      837    11423    2       EDIT_KEY.COUNT = 3;

  11423 14 001116   003000 236003                    LDQ     1536,DU
        14 001117   000075 552040 13                 STBQ    EDIT_KEY,'40'O

      838    11424
      839    11425    2       substr(TEMP_BUF,COUNT) = substr(FIELD$->X$STRING.TEXT,,FIELD$->X$STRING.SIZ);

  11425 14 001120   200715 473500                    LDP3    @FIELD$,,AUTO
        14 001121   300000 474500                    LDP4    0,,PR3
        14 001122   000100 101500                    MRL     fill='000'O
        14 001123   400000 000001                    ADSC9   0,,PR4                   cn=0,n=1
        14 001124   201120 000002                    ADSC9   TEMP_BUF+128,,AUTO       cn=0,n=2
        14 001125   201120 220100                    LDX0    TEMP_BUF+128,,AUTO
        14 001126   300000 475500                    LDP5    0,,PR3
        14 001127   000100 101500                    MRL     fill='000'O
        14 001130   500000 000001                    ADSC9   0,,PR5                   cn=0,n=1
        14 001131   201121 000002                    ADSC9   TEMP_BUF+129,,AUTO       cn=0,n=2
        14 001132   201121 221100                    LDX1    TEMP_BUF+129,,AUTO
        14 001133   200713 722100                    LXL2    COUNT,,AUTO
        14 001134   776777 622012                    EAX2    -513,X2
        14 001135   777777 662003                    ERX2    -1,DU
        14 001136   200713 235100                    LDA     COUNT,,AUTO
        14 001137   040145 100540                    MLR     fill='040'O
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:134  
        14 001140   400000 200011                    ADSC9   0,,PR4                   cn=1,n=*X1
        14 001141   200720 000012                    ADSC9   TEMP_BUF,A,AUTO          cn=0,n=*X2

      840    11426    2       COUNT = COUNT + FIELD$->X$STRING.SIZ;

  11426 14 001142   300000 474500                    LDP4    0,,PR3
        14 001143   000100 101500                    MRL     fill='000'O
        14 001144   400000 000001                    ADSC9   0,,PR4                   cn=0,n=1
        14 001145   201120 000004                    ADSC9   TEMP_BUF+128,,AUTO       cn=0,n=4
        14 001146   201120 236100                    LDQ     TEMP_BUF+128,,AUTO
        14 001147   200713 036100                    ADLQ    COUNT,,AUTO
        14 001150   200713 756100                    STQ     COUNT,,AUTO

      841    11427    2       WRITE_EDIT_REC.BUF_ = vector( substr(TEMP_BUF,,COUNT) );

  11427 14 001151   200713 235100                    LDA     COUNT,,AUTO
        14 001152   000020 735000                    ALS     16
        14 001153   000140 135007                    SBLA    96,DL
        14 001154   201120 452500                    STP2    TEMP_BUF+128,,AUTO
        14 001155   201120 236100                    LDQ     TEMP_BUF+128,,AUTO
        14 001156   000720 036003                    ADLQ    464,DU
        14 001157   200300 757100                    STAQ    WRITE_EDIT_REC+4,,AUTO

      842    11428    2       call M$WRITE(WRITE_EDIT_REC) altret(E_WRITE$BODY);

  11428 14 001160   200274 630500                    EPPR0   WRITE_EDIT_REC,,AUTO
        14 001161   440001 713400                    CLIMB   alt,write
        14 001162   401400 401760                    pmme    nvectors=4
        14 001163   001166 702000 14                 TSX2    E_WRITE$BODY

      843    11429    2       return;

  11429 14 001164   200714 221300                    LDX1  ! COUNT+1,,AUTO
        14 001165   000001 702211                    TSX2  ! 1,X1

      844    11430
      845    11431    2   E_WRITE$BODY:
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:135  
      846    11432    2       altreturn;

  11432 14 001166   200714 221300       E_WRITE$BODY LDX1  ! COUNT+1,,AUTO
        14 001167   000000 702211                    TSX2  ! 0,X1

OPEN_EDIT_FILE_CONST
 Sect OctLoc
  12     000   000025 777640   000044 006000   000000 177640   000000 006014    .....$..........
  12     004   000000 177640   000000 006014   000001 377640   000072 006000    .............:..
  12     010   000000 177640   000000 006014   000000 177640   000000 006014    ................
  12     044*  000000 400072   000000 000001   252525 002002   000040 252520    ...:......... ..
  12     050   000040 040040   000000 000000   000000 777777   000000 000000    .   ............
  12     054   000000 000000   000000 000000   000000 000000   000000 000000    ................
  12     060   251000 622000   000000 000000   000000 000000   111250 000000    ............I...
  12     064   040040 040040   000000 000000   000000 000000   000000 000000        ............
  12     070   000000 000000   ****** ******                                    ........

EDIT_NAME
 Sect OctLoc
  12     072   005052 102117   104131 ******                                    .*BODY..

DEFER_TIME
 Sect OctLoc
  12     074   000001 777640   000106 006000   000001 777640   000070 006000    .....F.......8..
  12     100   000002 577640   000072 006000   000000 177640   000000 006014    .....:..........
  12     104   000000 777640   000076 006000   004003 000000   ****** ******    .....>..........

E_CMD_TO_PROMPT
 Sect OctLoc
  12     110   261623 016060                                                    ...0

E_CMD_SUBJECT_PROMPT
 Sect OctLoc
  12     111   261623 016070                                                    ...8

E_CMD_RTO_PROMPT
 Sect OctLoc
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:136  
  12     112   261623 016110                                                    ...H

E_CMD_COPY_PROMPT
 Sect OctLoc
  12     113   261623 016130                                                    ...X

E_CMD_BC_PROMPT
 Sect OctLoc
  12     114   261623 016140                                                    ...`

E_CMD_FILE_COPY_PROMPT
 Sect OctLoc
  12     115   261623 016160                                                    ...p

E_RR_PROMPT
 Sect OctLoc
  12     116   261623 024240                                                    ....

E_CMD_DEFER_PROMPT
 Sect OctLoc
  12     117   261623 016150                                                    ...h

E_CMD_SIGNED_PROMPT
 Sect OctLoc
  12     120   261623 016170                                                    ...x

E_BROADCAST_PROMPT
 Sect OctLoc
  12     121   261623 024260                                                    ....

E_DR_PROMPT
 Sect OctLoc
  12     122   261623 024250                                                    ....

E_CMD_REF_PROMPT
 Sect OctLoc
  12     123   261623 016120                                                    ...P
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:137  

E_NO_CHAR
 Sect OctLoc
  12     124   261515 024300                                                    ....

E_YES_CHAR
 Sect OctLoc
  12     125   261515 024270                                                    ....

VM_NO_OR_YES$
 Sect OctLoc
  12     126   000211 006000   000210 006000                                    ........

(unnamed)
 Sect OctLoc
  12     130   124162 141143   145072 040040                                    Trace:

CLOSE_EDIT_CONST
 Sect OctLoc
  13     000   000003 777640   000032 006000   000000 177640   000000 006014    ................
  13     004   000000 177640   000000 006014   000000 177640   000000 006014    ................
  13     030*  000000 177640   000000 006014   000000 000000   000000 000040    ...............
  13     034   000220 000000   000000 000000                                    ........

READ_EDIT_REC_CONST
 Sect OctLoc
  13     036   000005 777640   000046 006000   000000 777640   000075 006000    .....&.......=..
  13     042   000000 177640   000000 006014   000000 177640   000000 006014    ................
  13     046   000000 500000   000000 000000   000000 000000   000000 000000    ................
  13     052   000000 000000   000000 000000                                    ........

WRITE_EDIT_REC_CONST
 Sect OctLoc
  13     054   000003 777640   000064 006000   000000 777640   000075 006000    .....4.......=..
  13     060   000000 177640   000000 006014   000000 177640   000000 006014    ................
  13     064   000000 400400   000000 000000   000000 000000   000000 000000    ................

PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:138  
WORK_DATE
 Sect OctLoc
  13     070   ****** 057***   ***057 ******                                    ../../..

WORK_TIME
 Sect OctLoc
  13     072   ****** 072***   ****** ******   ****** ******                    ..:.........

VN_TO_
 Sect OctLoc
  13     100   027040 040040   040040 040040   040040 040040   040040 040040    .
  13     104   040040 040040   040040 040040

VN_REPLY_TO
 Sect OctLoc
  13     106   027040 040040   040040 040040   040040 040040   040040 040040    .
  13     112   040040 040040   040040 040040

VN_SUBJECT
 Sect OctLoc
  13     114   027040 040040   040040 040040   040040 040040   040040 040040    .
  13     120   040040 040040   040040 040040

VN_REFERENCE
 Sect OctLoc
  13     122   027040 040040   040040 040040   040040 040040   040040 040040    .
  13     126   040040 040040   040040 040040

VN_COPY
 Sect OctLoc
  13     130   027040 040040   040040 040040   040040 040040   040040 040040    .
  13     134   040040 040040   040040 040040

VN_BLIND_COPY
 Sect OctLoc
  13     136   027040 040040   040040 040040   040040 040040   040040 040040    .
  13     142   040040 040040   040040 040040
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:139  

VN_FCOPY
 Sect OctLoc
  13     144   027040 040040   040040 040040   040040 040040   040040 040040    .
  13     150   040040 040040   040040 040040

VN_RR
 Sect OctLoc
  13     152   027040 040040   040040 040040   040040 040040   040040 040040    .
  13     156   040040 040040   040040 040040

VN_DEFER
 Sect OctLoc
  13     160   027040 040040   040040 040040   040040 040040   040040 040040    .
  13     164   040040 040040   040040 040040

VN_SIGNED
 Sect OctLoc
  13     166   027040 040040   040040 040040   040040 040040   040040 040040    .
  13     172   040040 040040   040040 040040

VN_BROADCAST
 Sect OctLoc
  13     174   027040 040040   040040 040040   040040 040040   040040 040040    .
  13     200   040040 040040   040040 040040

VN_DR
 Sect OctLoc
  13     202   027040 040040   040040 040040   040040 040040   040040 040040    .
  13     206   040040 040040   040040 040040

VN_YES_CHAR
 Sect OctLoc
  13     210   001040 ******                                                    . ..

VN_NO_CHAR
 Sect OctLoc
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:140  
  13     211   001040 ******                                                    . ..

(unnamed)
 Sect OctLoc
  15     000   000002 000000   000125 006000   000210 006000   000124 006000    .....U.......T..
  15     004   000211 006000   000025 777640   000003 777640   000000 006014    ................
  15     010   040040 040040   000110 006000   000100 006000   000111 006000        .H...@...I..
  15     014   000114 006000   000112 006000   000106 006000   000123 006000    .L...J...F...S..
  15     020   000122 006000   000113 006000   000130 006000   000114 006000    .R...K...X...L..
  15     024   000136 006000   000115 006000   000144 006000   000122 006000    .^...M...d...R..
  15     030   000202 006000   000116 006000   000152 006000   000121 006000    .....N...j...Q..
  15     034   000174 006000   000117 006000   000160 006000   000120 006000    .|...O...p...P..
  15     040   000166 006000   000007 000000   000001 177640   000001 377640    .v..............
  15     044   000000 177640   000000 006014   000005 777640   777777 777177    ................
  15     050   000000 006003   000112 777640   000004 000000                    .....J......
      847    11433    2   end WRITE$BODY;
      848    11434    1   end VMM$EDIT_MESSAGE_OUT;
      849    11435        %EOD;

PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:141  
--  Include file information  --

   VM_PERR_C.:VMB6TOU  is referenced.
   B_MACROS_C.:LIB_E05  is referenced.
   VM_DATA_R.:VMB6TOU  cannot be made into a system file and is referenced.
   VM_SUBS_C.:VMB6TOU  is referenced.
   VM_MACRO_C.:VMB6TOU  is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   CP_6_C.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
   B$JIT_C.:LIB_E05  is referenced.
   B$JIT.:LIB_E05  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure VMM$EDIT_MESSAGE_OUT.
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:142  

 **** Variables and constants ****

  ****  Section 012 RoData VMM$EDIT_MESSAGE_OUT

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    74-0-0/d STRC(432)   r     1 DEFER_TIME                72-0-0/c STRC(54)    r     1 EDIT_NAME
   121-0-0/w STRC        r     1 E_BROADCAST_PROMPT       114-0-0/w STRC        r     1 E_CMD_BC_PROMPT
   113-0-0/w STRC        r     1 E_CMD_COPY_PROMPT        117-0-0/w STRC        r     1 E_CMD_DEFER_PROMPT
   115-0-0/w STRC        r     1 E_CMD_FILE_COPY_PROMPT
   123-0-0/w STRC        r     1 E_CMD_REF_PROMPT         112-0-0/w STRC        r     1 E_CMD_RTO_PROMPT
   120-0-0/w STRC        r     1 E_CMD_SIGNED_PROMPT      111-0-0/w STRC        r     1 E_CMD_SUBJECT_PROMPT
   110-0-0/w STRC        r     1 E_CMD_TO_PROMPT          122-0-0/w STRC        r     1 E_DR_PROMPT
   124-0-0/w STRC        r     1 E_NO_CHAR                116-0-0/w STRC        r     1 E_RR_PROMPT
   125-0-0/w STRC        r     1 E_YES_CHAR                 0-0-0/d STRC(2088)  r     1 OPEN_EDIT_FILE_CONST
   126-0-0/w PTR         r     1 VM_NO_OR_YES$(0:1)

  ****  Section 013  Data  VMM$EDIT_MESSAGE_OUT

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(1080)  r     1 CLOSE_EDIT_CONST          75-0-0/b STRC        r     1 EDIT_KEY
    77-0-0/w PTR         r     1 FILE$                     36-0-0/d STRC(504)   r     1 READ_EDIT_REC_CONST
   136-0-0/c STRC(216)   r     1 VN_BLIND_COPY            174-0-0/c STRC(216)   r     1 VN_BROADCAST
   130-0-0/c STRC(216)   r     1 VN_COPY                  160-0-0/c STRC(216)   r     1 VN_DEFER
   202-0-0/c STRC(216)   r     1 VN_DR                    144-0-0/c STRC(216)   r     1 VN_FCOPY
   211-0-0/c STRC(18)    r     1 VN_NO_CHAR               122-0-0/c STRC(216)   r     1 VN_REFERENCE
   106-0-0/c STRC(216)   r     1 VN_REPLY_TO              152-0-0/c STRC(216)   r     1 VN_RR
   166-0-0/c STRC(216)   r     1 VN_SIGNED                114-0-0/c STRC(216)   r     1 VN_SUBJECT
   100-0-0/c STRC(216)   r     1 VN_TO_                   210-0-0/c STRC(18)    r     1 VN_YES_CHAR
    70-0-0/c STRC(72)    r     1 WORK_DATE                 70-0-0/c CHAR(8)     r     1 WORK_DATER
    72-0-0/c STRC(99)    r     1 WORK_TIME                 72-0-0/c CHAR(11)    r     1 WORK_TIMER
    76-0-0/w UBIN        r     1 WORK_UTS                  54-0-0/d STRC(432)   r     1 WRITE_EDIT_REC_CONST

  ****  Auto variables  ****
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:143  

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     6-0-0/w PTR         r     1 @ALL_FIELDS                5-0-0/w PTR         r     1 @DCB#
   715-0-0/w PTR         r     1 @FIELD$                  716-0-0/w PTR         r     1 @FIELD_NAME
   717-0-0/w PTR         r     1 @INDX                      3-0-0/w PTR         r     1 @MESSAGE_NUMBER
     7-0-0/w PTR         r     1 @NOT_ANSWER_OPT            4-0-0/w PTR         r     1 @SEED
    *0-0-0/w BIT         r     1 ALL_FIELDS               220-0-0/d STRC(1080)  r     1 CLOSE_EDIT
   713-0-0/w SBIN        r     1 COUNT                     *0-0-0/w UBIN        r     1 DCB#
    *0-0-0/w PTR         r     1 FIELD$                    *0-0-0/w ASTR(9)     r     1 FIELD_NAME
    *0-0-0/w UBIN        r     1 INDX                     511-0-0/w SBIN        r     1 INDX1
   512-0-0/w SBIN        r     1 INDX2                     *0-0-0/w SBIN        r     1 MESSAGE_NUMBER
    *0-0-0/w BIT         r     1 NOT_ANSWER_OPT           126-0-0/d STRC(2088)  r     1 OPEN_EDIT_FILE
   256-0-0/d STRC(504)   r     1 READ_EDIT_REC             *0-0-0/w UBIN        r     1 SEED
   310-0-0/c STRC(4617)  r     1 TEMP_BUF                 720-0-0/c CHAR(512)   r     1 TEMP_BUF
   513-0-0/c CHAR(512)   r     1 TRACE_BUF                 10-0-0/w STRC(2772)  r     1 VM_BODYREC
   274-0-0/d STRC(432)   r     1 WRITE_EDIT_REC

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR               1 B$TCB$
     0-0-0/c ASTR(9)     r     1 ERRMSG_FID                 0-0-0/w UBIN              1 M$DO_NUM
     0-0-0/w UBIN              1 M$LO_NUM                   0-0-0/w UBIN              1 M$MAIL_CENTRAL_NUM
     0-0-0/w UBIN              1 M$MAIL_COMGROUP_NUM        0-0-0/w UBIN              1 M$MAIL_FILE_NUM
     0-0-0/w UBIN              1 M$MAIL_GLOBAL_NUM          0-0-0/w UBIN              1 M$ME_NUM
     0-0-0/w UBIN              1 M$NODE_NUM                 0-0-0/w UBIN              1 M$SI_NUM
     0-0-0/w UBIN              1 M$WORK_NUM                 0-0-0/w PTR               1 VM_ADDLIST$
     0-0-0/d VECT              1 VM_ADDLIST_                0-0-0/w PTR               1 VM_ADDREC$
     0-0-0/d VECT              1 VM_ADDREC_                 0-0-0/w PTR               1 VM_COPY$
     0-0-0/d VECT              1 VM_COPY_                   0-0-0/w PTR               1 VM_ENCLLIST$
     0-0-0/d VECT              1 VM_ENCLLIST_               0-0-0/w PTR               1 VM_ENCLREC$
     0-0-0/d VECT              1 VM_ENCLREC_                0-0-0/c STRC(270)         1 VM_FORWARD_ENCL_NAME
     0-0-0/c STRC(270)         1 VM_FORWARD_FILE_NAME       0-0-0/c STRC(72)          1 VM_FORWARD_FILE_PASS
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:144  
     0-0-0/w PTR         r     1 VM_HEADER$                 0-0-0/d VECT              1 VM_HEADER_
     0-0-0/d VECT              1 VM_HEADER_INIT_            0-0-0/w PTR               1 VM_INPUT$
     0-0-0/d VECT              1 VM_INPUT_                  0-0-0/c STRC(72)          1 VM_MAILCG_NAME
     0-0-0/w STRC(432)         1 VM_MAILCG_SETSTA           0-0-0/c STRC(72)          1 VM_MAIL_ACCT
     0-0-0/c STRC(54)          1 VM_NAME_MAP_NAME           0-0-0/w PTR               1 VM_PARSEAREA$
     0-0-0/d VECT              1 VM_PARSEAREA_              0-0-0/w PTR               1 VM_PROFILE$
     0-0-0/d VECT              1 VM_PROFILE_                0-0-0/w PTR               1 VM_SELECT$
     0-0-0/d VECT              1 VM_SELECT_                 0-0-0/c STRC(288)         1 VM_SEND_FILE_NAME
     0-0-0/c CHAR(8)           1 VM_SITENAME                0-0-0/w PTR               1 VM_WORK$
     0-0-0/d VECT              1 VM_WORK_

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)        1 B$JIT                      0-0-0/d ASTR(3528)  r     1 F$DCB
     0-0-0N  NULL        r     1 M$DO                       0-0-0N  NULL        r     1 M$EDIT
     0-0-0N  NULL        r     1 M$LO                       0-0-0N  NULL        r     1 M$MAIL_CENTRAL
     0-0-0N  NULL        r     1 M$MAIL_COMGROUP            0-0-0N  NULL        r     1 M$MAIL_FILE
     0-0-0N  NULL        r     1 M$MAIL_GLOBAL              0-0-0N  NULL        r     1 M$ME
     0-0-0N  NULL        r     1 M$NODE                     0-0-0N  NULL        r     1 M$SI
     0-0-0N  NULL        r     1 M$UC                       0-0-0N  NULL        r     1 M$WORK
     0-0-0/w STRC(1332)  r     1 VM_HEADER                  0-0-0/c ASTR(9)     r     1 X$STRING


   Procedure VMM$EDIT_MESSAGE_OUT requires 632 words for executable code.
   Procedure VMM$EDIT_MESSAGE_OUT requires 600 words of local(AUTO) storage.
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:145  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:146  
          MINI XREF LISTING

ALL_FIELDS
      8988**DCL        26--PROC    10967>>IF      11350--ENTRY
B$JIT.CPFLAGS1.SLEAZE
       449**DCL       449--REDEF
B$JIT.ERR.MID
       356**DCL       356--REDEF
B$JIT.JRESPEAK
       517**DCL       518--REDEF
B$JIT.ORIGINATOR_PORT.FROM_CR
       626**DCL       626--REDEF     627--REDEF
B$JIT.PNR
       530**DCL       530--REDEF
B$JIT.TSLINE
       624**DCL       625--REDEF
B$JIT$
      8465**DCL       350--IMP-PTR
CLOSE_EDIT
      9487**DCL     10952<<ASSIGN  11324<>CALL    11330<>CALL    11357<<ASSIGN  11397<>CALL
CLOSE_EDIT.SN_
      9487**DCL      9487--REDEF
CLOSE_EDIT.UTL_
      9488**DCL      9488--REDEF
CLOSE_EDIT.V
      9492**DCL     10953--ASSIGN  11358--ASSIGN
CLOSE_EDIT.V.DISP#
      9496**DCL     11323<<ASSIGN  11396<<ASSIGN
CLOSE_EDIT.V.EXPIRE#
      9502**DCL      9502--REDEF
CLOSE_EDIT.V.TYPE#
      9500**DCL      9500--REDEF
CLOSE_EDIT.V.XTNSIZE#
      9497**DCL      9497--REDEF    9499--REDEF
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:147  
CLOSE_EDIT.V_
      9487**DCL     10953<<ASSIGN  11358<<ASSIGN
CLOSE_EDIT_CONST
      9443**DCL     10952>>ASSIGN  11357>>ASSIGN
CLOSE_EDIT_CONST.SN_
      9443**DCL      9443--REDEF
CLOSE_EDIT_CONST.UTL_
      9444**DCL      9444--REDEF
CLOSE_EDIT_CONST.V
      9448**DCL      9443--DCLINIT
CLOSE_EDIT_CONST.V.EXPIRE#
      9458**DCL      9458--REDEF
CLOSE_EDIT_CONST.V.TYPE#
      9456**DCL      9456--REDEF
CLOSE_EDIT_CONST.V.XTNSIZE#
      9453**DCL      9453--REDEF    9455--REDEF
COUNT
      9823**DCL     11280<>CALL    11290>>IF      11295>>CALLBLT 11296>>ASSIGN  11302<>CALL    11313>>IF
     11316>>ASSIGN  11379<<ASSIGN  11380>>ASSIGN  11381<>CALL    11418<<ASSIGN  11419>>ASSIGN  11419>>ASSIGN
     11425>>ASSIGN  11426<<ASSIGN  11426>>ASSIGN  11427>>ASSIGN
DCB#
      8987**DCL        26--PROC    11280<>CALL    11302<>CALL    11350--ENTRY   11381<>CALL    11390<>CALL
DEFER_TIME
      9707**DCL     11247<>CALL
DEFER_TIME.V
      9711**DCL      9707--DCLINIT
EDIT_KEY
      9759**DCL      9557--DCLINIT  9558--DCLINIT  9641--DCLINIT
EDIT_KEY.COUNT
      9760**DCL     11284<<ASSIGN  11305<<ASSIGN  11373<<ASSIGN  11423<<ASSIGN
EDIT_KEY.KEY
      9761**DCL     11283<<ASSIGN  11304<<ASSIGN  11372<<ASSIGN  11422<<ASSIGN
EDIT_NAME
      9533**DCL      9263--DCLINIT
END_LOOP
     11386**LABEL   11378--CALLALT
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:148  
ERRMSG_FID.L#
      8534**DCL      8534--IMP-SIZ
E_BROADCAST_PROMPT
     10659**DCL     11203<>CALL
E_CMD_BC_PROMPT
     10414**DCL     11108<>CALL
E_CMD_COPY_PROMPT
     10365**DCL     11082<>CALL
E_CMD_DEFER_PROMPT
     10561**DCL     11232<>CALL
E_CMD_FILE_COPY_PROMPT
     10463**DCL     11134<>CALL
E_CMD_REF_PROMPT
     10757**DCL     11056<>CALL
E_CMD_RTO_PROMPT
     10316**DCL     11030<>CALL
E_CMD_SIGNED_PROMPT
     10610**DCL     11262<>CALL
E_CMD_SUBJECT_PROMPT
     10267**DCL     11004<>CALL
E_CMD_TO_PROMPT
     10218**DCL     10978<>CALL
E_DR_PROMPT
     10708**DCL     11157<>CALL
E_NO_CHAR
     10806**DCL     10931<>CALL
E_PMME
     11328**LABEL   10962--CALLALT 10992--CALLALT 11018--CALLALT 11044--CALLALT 11070--CALLALT 11096--CALLALT
     11122--CALLALT 11217--CALLALT 11218--CALLALT 11220--CALLALT 11247--CALLALT 11250--CALLALT 11276--CALLALT
     11280--CALLALT 11298--CALLALT 11302--CALLALT 11317--CALLALT 11324--CALLALT 11367--CALLALT 11381--CALLALT
     11390--CALLALT 11397--CALLALT
E_RR_PROMPT
     10512**DCL     11180<>CALL
E_WRITE$BODY IN PROCEDURE WRITE$BODY
     11432**LABEL   11428--CALLALT
E_YES_CHAR
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:149  
     10855**DCL     10908<>CALL
F$DCB.ACTPOS
      9795**DCL      9795--REDEF
F$DCB.ARS#
      9769**DCL      9769--REDEF   11379>>ASSIGN
F$DCB.ATTR
      9788**DCL      9789--REDEF
F$DCB.BORROW
      9803**DCL      9803--REDEF    9803--REDEF    9803--REDEF
F$DCB.DCBNAME.L
      9817**DCL      9817--IMP-SIZ
F$DCB.DVBYTE
      9772**DCL     11381<>CALL
F$DCB.EOMCHAR#
      9773**DCL      9773--REDEF
F$DCB.FCD#
      9782**DCL     11328>>IF
F$DCB.FLDID
      9798**DCL      9798--REDEF
F$DCB.FORM$
      9792**DCL      9792--REDEF
F$DCB.FSECT
      9808**DCL      9808--REDEF
F$DCB.FSN#
      9785**DCL      9785--REDEF    9785--REDEF    9786--REDEF
F$DCB.HEADER$
      9791**DCL      9791--REDEF
F$DCB.IXTNSIZE#
      9789**DCL      9789--REDEF
F$DCB.LASTSTA$
      9778**DCL      9778--REDEF
F$DCB.LVL
      9804**DCL      9804--REDEF
F$DCB.NAME#.C
      9779**DCL      9779--REDEF
F$DCB.NOEOF
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:150  
      9801**DCL      9801--REDEF
F$DCB.NRECS#
      9790**DCL      9790--REDEF
F$DCB.NRECX
      9809**DCL      9809--REDEF
F$DCB.OHDR
      9801**DCL      9801--REDEF
F$DCB.ORG#
      9784**DCL      9784--REDEF
F$DCB.PRECNO
      9807**DCL      9807--REDEF
F$DCB.RCSZ
      9813**DCL      9813--REDEF
F$DCB.RES#
      9780**DCL      9780--REDEF
F$DCB.SETX
      9792**DCL      9792--REDEF
F$DCB.TAB$
      9792**DCL      9792--REDEF
F$DCB.TDA
      9806**DCL      9807--REDEF
F$DCB.WSN#
      9780**DCL      9780--REDEF
FIELD$ IN PROCEDURE WRITE$BODY
     11409**DCL     11408--PROC    11425>>ASSIGN  11425>>ASSIGN  11425>>ASSIGN  11426>>ASSIGN
FIELD_NAME IN PROCEDURE WRITE$BODY
     11410**DCL     11408--PROC
FIELD_NAME.SIZ IN PROCEDURE WRITE$BODY
     11411**DCL     11412--IMP-SIZ 11418>>ASSIGN  11419>>ASSIGN
FIELD_NAME.TEXT IN PROCEDURE WRITE$BODY
     11412**DCL     11419>>ASSIGN
FILE$
      9825**DCL     11328>>IF      11368<<ASSIGN  11379>>ASSIGN  11381>>CALL
INDX IN PROCEDURE WRITE$BODY
     11414**DCL     11408--PROC    11421<<ASSIGN  11421>>ASSIGN  11422>>ASSIGN
INDX1
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:151  
      9820**DCL     10966<<ASSIGN  10992<>CALL    11018<>CALL    11044<>CALL    11070<>CALL    11096<>CALL
     11122<>CALL    11217<>CALL    11218<>CALL    11219<>CALL    11220<>CALL    11250<>CALL    11276<>CALL
     11282<<ASSIGN  11282>>ASSIGN  11283>>ASSIGN  11301<<DOINDEX 11302<>CALL    11304>>ASSIGN  11376<<ASSIGN
     11381<>CALL    11382<<ASSIGN  11382>>ASSIGN  11386>>IF      11390<>CALL    11392>>ASSIGN
INDX2
      9821**DCL     11279<<DOINDEX 11280<>CALL    11389<<ASSIGN  11390<>CALL
M$CLOSE
      6118**DCL-ENT 11324--CALL    11330--CALL    11397--CALL
M$EDIT
      9187**DCL     11368--ASSIGN
M$OPEN
      6118**DCL-ENT 10962--CALL    11367--CALL
M$READ
      6119**DCL-ENT 11378--CALL
M$TIME
      6185**DCL-ENT 11247--CALL
M$WRITE
      6119**DCL-ENT 11298--CALL    11317--CALL    11428--CALL
MESSAGE_NUMBER
      8985**DCL        26--PROC    11280<>CALL    11302<>CALL    11350--ENTRY   11381<>CALL    11390<>CALL
NOT_ANSWER_OPT
      8989**DCL        26--PROC    10968>>IF      11072>>IF
OPEN_EDIT_FILE
      9373**DCL     10949<<ASSIGN  10962<>CALL    11354<<ASSIGN  11367<>CALL
OPEN_EDIT_FILE.ACSVEH_
      9375**DCL      9376--REDEF
OPEN_EDIT_FILE.ALTKEYS_
      9381**DCL      9382--REDEF    9382--REDEF
OPEN_EDIT_FILE.HDR_
      9380**DCL      9381--REDEF
OPEN_EDIT_FILE.TAB_
      9379**DCL      9380--REDEF
OPEN_EDIT_FILE.UHL_
      9373**DCL      9374--REDEF    9374--REDEF
OPEN_EDIT_FILE.V
      9382**DCL     10950--ASSIGN  11355--ASSIGN
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:152  
OPEN_EDIT_FILE.V.EXIST#
      9386**DCL     10960<<ASSIGN  11365<<ASSIGN
OPEN_EDIT_FILE.V.FSN#
      9413**DCL      9413--REDEF    9413--REDEF
OPEN_EDIT_FILE.V.FUN#
      9392**DCL     10961<<ASSIGN  11366<<ASSIGN
OPEN_EDIT_FILE.V_
      9373**DCL     10950<<ASSIGN  11355<<ASSIGN
OPEN_EDIT_FILE.WSN_
      9379**DCL      9379--REDEF
OPEN_EDIT_FILE_CONST
      9262**DCL     10949>>ASSIGN  11354>>ASSIGN
OPEN_EDIT_FILE_CONST.ACSVEH_
      9264**DCL      9265--REDEF
OPEN_EDIT_FILE_CONST.ALTKEYS_
      9270**DCL      9271--REDEF    9271--REDEF
OPEN_EDIT_FILE_CONST.HDR_
      9269**DCL      9270--REDEF
OPEN_EDIT_FILE_CONST.TAB_
      9268**DCL      9269--REDEF
OPEN_EDIT_FILE_CONST.UHL_
      9262**DCL      9263--REDEF    9263--REDEF
OPEN_EDIT_FILE_CONST.V
      9271**DCL      9262--DCLINIT
OPEN_EDIT_FILE_CONST.V.FSN#
      9302**DCL      9302--REDEF    9302--REDEF
OPEN_EDIT_FILE_CONST.WSN_
      9268**DCL      9268--REDEF
READ_EDIT_REC
      9598**DCL     11360<<ASSIGN  11378<>CALL
READ_EDIT_REC.BUF_
      9600**DCL     11375<<ASSIGN
READ_EDIT_REC.STATION_
      9601**DCL      9602--REDEF
READ_EDIT_REC.V
      9602**DCL     11361--ASSIGN
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:153  
READ_EDIT_REC.V.DVBYTE.REREAD#
      9613**DCL      9613--REDEF
READ_EDIT_REC.V.INDX#
      9611**DCL      9611--REDEF
READ_EDIT_REC.V_
      9598**DCL     11361<<ASSIGN
READ_EDIT_REC_CONST
      9557**DCL     11360>>ASSIGN
READ_EDIT_REC_CONST.STATION_
      9560**DCL      9561--REDEF
READ_EDIT_REC_CONST.V
      9561**DCL      9557--DCLINIT
READ_EDIT_REC_CONST.V.DVBYTE.REREAD#
      9572**DCL      9572--REDEF
READ_EDIT_REC_CONST.V.INDX#
      9570**DCL      9570--REDEF
SEED
      8986**DCL        26--PROC    11280<>CALL    11302<>CALL    11350--ENTRY   11381<>CALL
TEMP_BUF
      9757**DCL     11250--CALL
TEMP_BUF.L#
      9757**DCL     11248<<ASSIGN
TEMP_BUF.NAME#
      9757**DCL     11249<<CALLBLT
TEMP_BUF IN PROCEDURE WRITE$BODY
     11415**DCL     11419<<ASSIGN  11425<<ASSIGN  11427--ASSIGN
TRACE_BUF
      9822**DCL     11291<<ASSIGN  11292--ASSIGN  11295<<CALLBLT 11296--ASSIGN
VMD$DEL_BODY
      8994**DCL-ENT 11390--CALL
VMD$ERRMSG
      8998**DCL-ENT 10908--CALL    10931--CALL    10978--CALL    11004--CALL    11030--CALL    11056--CALL
     11082--CALL    11108--CALL    11134--CALL    11157--CALL    11180--CALL    11203--CALL    11232--CALL
     11262--CALL
VMD$GET_BODY
      8992**DCL-ENT 11302--CALL
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:154  
VMD$GET_TRACE
      8991**DCL-ENT 11280--CALL
VMD$PUT_BODY
      8993**DCL-ENT 11381--CALL
VM_BODYREC
      9035**DCL     11280<>CALL    11302<>CALL    11381<>CALL
VM_BODYREC.TYPE
      9036**DCL     11285>>IF      11306>>IF      11374<<ASSIGN
VM_BODYREC.VALUE.COUNT
      9041**DCL     11380<<ASSIGN
VM_BODYREC.VALUE.DATA
      9053**DCL     11295>>CALLBLT 11316--ASSIGN  11375--ASSIGN
VM_HEADER.BLIND$
      9153**DCL     11098>>IF      11122<>CALL
VM_HEADER.COPY$
      9155**DCL     11072>>IF      11096<>CALL
VM_HEADER.DELIVERY_DATE
      9072**DCL     11221>>IF      11246>>ASSIGN
VM_HEADER.NUM_RECORDS
      9078**DCL     11301>>DOINDEX 11386>>IF      11389>>ASSIGN  11392<<ASSIGN
VM_HEADER.NUM_TRACE_RECORDS
      9177**DCL     11279>>DOINDEX
VM_HEADER.REFERENCE$
      9161**DCL     11046>>IF      11070<>CALL
VM_HEADER.REPLY_TO$
      9163**DCL     11020>>IF      11044<>CALL
VM_HEADER.SIGNED$
      9167**DCL     11252>>IF      11276<>CALL
VM_HEADER.STATUS.BROADCAST
      9118**DCL     11220>>CALL
VM_HEADER.STATUS.DR
      9114**DCL     11218>>CALL
VM_HEADER.STATUS.FCOPY
      9104**DCL     11217>>CALL
VM_HEADER.STATUS.RR
      9090**DCL     11219>>CALL
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:155  
VM_HEADER.SUBJECT$
      9169**DCL     10994>>IF      11018<>CALL
VM_HEADER.TO$
      9171**DCL     10968>>IF      10992<>CALL
VM_HEADER$
      8384**DCL      9067--IMP-PTR 10968>>IF      10992>>CALL    10994>>IF      11018>>CALL    11020>>IF
     11044>>CALL    11046>>IF      11070>>CALL    11072>>IF      11096>>CALL    11098>>IF      11122>>CALL
     11217>>CALL    11218>>CALL    11219>>CALL    11220>>CALL    11221>>IF      11246>>ASSIGN  11252>>IF
     11276>>CALL    11279>>DOINDEX 11301>>DOINDEX 11386>>IF      11389>>ASSIGN  11392>>ASSIGN
VM_NO_OR_YES$
     10892**DCL     11217<>CALL    11218<>CALL    11219<>CALL    11220<>CALL
VN_BLIND_COPY
      9986**DCL     11108<>CALL    11122<>CALL
VN_BLIND_COPY.NAME#
      9986**DCL     11106>>IF
VN_BROADCAST
     10121**DCL     11203<>CALL    11220<>CALL
VN_BROADCAST.NAME#
     10121**DCL     11201>>IF
VN_COPY
      9959**DCL     11082<>CALL    11096<>CALL
VN_COPY.NAME#
      9959**DCL     11080>>IF
VN_DEFER
     10067**DCL     11232<>CALL    11250<>CALL
VN_DEFER.NAME#
     10067**DCL     11230>>IF
VN_DR
     10148**DCL     11157<>CALL    11218<>CALL
VN_DR.NAME#
     10148**DCL     11155>>IF
VN_FCOPY
     10013**DCL     11134<>CALL    11217<>CALL
VN_FCOPY.NAME#
     10013**DCL     11132>>IF
VN_NO_CHAR
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:156  
     10202**DCL     10892--DCLINIT 10931<>CALL
VN_NO_CHAR.NAME#
     10202**DCL     10929>>IF
VN_REFERENCE
      9932**DCL     11056<>CALL    11070<>CALL
VN_REFERENCE.NAME#
      9932**DCL     11054>>IF
VN_REPLY_TO
      9878**DCL     11030<>CALL    11044<>CALL
VN_REPLY_TO.NAME#
      9878**DCL     11028>>IF
VN_RR
     10040**DCL     11180<>CALL    11219<>CALL
VN_RR.NAME#
     10040**DCL     11178>>IF
VN_SIGNED
     10094**DCL     11262<>CALL    11276<>CALL
VN_SIGNED.NAME#
     10094**DCL     11260>>IF
VN_SUBJECT
      9905**DCL     11004<>CALL    11018<>CALL
VN_SUBJECT.NAME#
      9905**DCL     11002>>IF
VN_TO_
      9851**DCL     10978<>CALL    10992<>CALL
VN_TO_.NAME#
      9851**DCL     10976>>IF
VN_YES_CHAR
     10175**DCL     10892--DCLINIT 10908<>CALL
VN_YES_CHAR.NAME#
     10175**DCL     10906>>IF
WORK_DATE
      9716**DCL      9707--DCLINIT  9708--DCLINIT  9722--REDEF
WORK_DATER
      9722**DCL     11248--ASSIGN  11249>>CALLBLT
WORK_TIME
PL6.E3A0      #003=VMM$EDIT_MESSAGE_OUT File=VMM$MESSAGE.:VMB6TSI                WED 08/20/97 15:17 Page:157  
      9723**DCL      9709--DCLINIT  9710--DCLINIT  9731--REDEF
WORK_TIMER
      9731**DCL     11248--ASSIGN  11249>>CALLBLT
WORK_UTS
      9824**DCL      9711--DCLINIT 11246<<ASSIGN
WRITE$BODY
     11408**PROC    10992--CALL    11018--CALL    11044--CALL    11070--CALL    11096--CALL    11122--CALL
     11217--CALL    11218--CALL    11219--CALL    11220--CALL    11250--CALL    11276--CALL
WRITE_EDIT_REC
      9674**DCL     10955<<ASSIGN  11298<>CALL    11317<>CALL    11428<>CALL
WRITE_EDIT_REC.BUF_
      9674**DCL     11292<<ASSIGN  11296<<ASSIGN  11314<<ASSIGN  11316<<ASSIGN  11427<<ASSIGN
WRITE_EDIT_REC.STATION_
      9676**DCL      9676--REDEF
WRITE_EDIT_REC.V
      9677**DCL     10956--ASSIGN
WRITE_EDIT_REC.V.DVBYTE
      9682**DCL     11280<>CALL    11302<>CALL
WRITE_EDIT_REC.V.DVBYTE.VFC#
      9683**DCL      9683--REDEF
WRITE_EDIT_REC.V_
      9674**DCL     10956<<ASSIGN
WRITE_EDIT_REC_CONST
      9641**DCL     10955>>ASSIGN
WRITE_EDIT_REC_CONST.STATION_
      9643**DCL      9643--REDEF
WRITE_EDIT_REC_CONST.V
      9644**DCL      9641--DCLINIT
WRITE_EDIT_REC_CONST.V.DVBYTE.VFC#
      9650**DCL      9650--REDEF
X$STRING.SIZ
      8380**DCL      8381--IMP-SIZ 11425>>ASSIGN  11425>>ASSIGN  11426>>ASSIGN
X$STRING.TEXT
      8381**DCL     11425>>ASSIGN

PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:158  
      850        1        /*T***********************************************************/
      851        2        /*T*                                                         */
      852        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      853        4        /*T*                                                         */
      854        5        /*T***********************************************************/
      855        6        /*X* DMC,PLM=4,IND=4,CTI=2,DTI=0,ENI=0,ECI=0,CSI=0,DCI=4 */
      856        7        VMM$COMBINE_MESSAGE: PROC (DCB_IN, MSG_NUMBER_IN, DCB_OUT) ALTRET;
      857        8        /*P*  NAME: VMM$COMBINE_MESSAGE
      858        9              PURPOSE: Combines error and response information with an existing
      859       10                       mailgram.
      860       11              DESCRIPTION:
      861       12                    This routine is called from MAILMAN during message delivery,
      862       13                    and from MAIL during MOVE MESSAGE and COPY MESSAGE.  It attempts
      863       14                    to insert information from an ERR, ACK, ANS, or DELIVERY mailgram
      864       15                    into the trace record area of the original mailgram from which
      865       16                    the ERR etc. was spawned.
      866       17              INPUT:   VM_HEADER contains the header of the new mailgram to be
      867       18                                combined;
      868       19                       VM_PROFILE contains the profile of the mailbox into which this
      869       20                                mailgram is being inserted.
      870       21              OUTPUT:  Normal return:  the input mailgram has been combined with its
      871       22                                originator in this folder.
      872       23                       Alternate return:  the input mailgram has not been combined.
      873       24                       Both:  VM_HEADER has probably been trashed, and must be reread.
      874       25        */
      875       26
      876       27    1   DCL DCB_IN UBIN;
      877       28    1   DCL MSG_NUMBER_IN UBIN;
      878       29    1   DCL DCB_OUT UBIN;
      879       30    1   DCL MSG_NUMBER_OUT UBIN;
      880       31
      881       32        %INCLUDE CP_6;
      882     5591        %INCLUDE CP_6_SUBS;
      883     6131        %INCLUDE VM_DATA_R;
      884     6562        %INCLUDE VM_MACRO_C;
      885     7830        %INCLUDE VM_PERR_C;
      886     8125
PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:159  
      887     8126    1   DCL COUNT UBIN;
      888     8127    1   DCL COUNT1 UBIN;
      889     8128    1   DCL MESSAGE_NUMBER UBIN;
      890     8129    1   DCL NUM_RECORDS UBIN;
      891     8130    1   DCL I UBIN;
      892     8131    1   DCL J UBIN;
      893     8132    1   DCL ID CHAR (255);
      894     8133    1   DCL 1 ANSWER_ID,
      895     8134    1         2 COUNT UBIN BYTE CALIGNED,
      896     8135    1         2 TEXT CHAR (511);
      897     8136    1   DCL 1 SENDER,
      898     8137    1         2 COUNT UBIN BYTE CALIGNED,
      899     8138    1         2 TEXT CHAR (511);
      900     8139    1   DCL 1 BAD_ADDRESS,
      901     8140    1         2 COUNT UBIN BYTE CALIGNED,
      902     8141    1         2 TEXT CHAR (511);
      903     8142
      904     8143        %VLP_ERRCODE (FPTN=E_ACKED,FCG="VO",MID="M",
      905     8144                      ERR#=%E$ACKED,STCLASS=CONSTANT);
      906     8189
      907     8190              %VLP_ERRCODE (FPTN=E_RRACKED,FCG="VO",MID="M",
      908     8191              ERR#=%E$RRACKED,STCLASS=CONSTANT);
      909     8236
      910     8237              %VLP_ERRCODE (FPTN=E_ANSWERED,FCG="VO",MID="M",
      911     8238              ERR#=%E$ANSWERED,STCLASS=CONSTANT);
      912     8283
      913     8284              %FPT_ENQ (FPTN=ENQ_HEADER,
      914     8285              SHARE=NONE,
      915     8286              WAIT=YES,
      916     8287              RNAME=VM_HEADRES);
      917     8305
      918     8306        %FPT_DEQ (FPTN=DEQ_HEADER,
      919     8307                  RNAME=VM_HEADRES);
      920     8324
      921     8325        %VM_HEADRES (STCLASS=STATIC);
      922     8339
      923     8340        %VM_BODYTYPES;
PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:160  
      924     8346        %VM_KEYTYPES;
      925     8367        %VM_PROFILE;
      926     8454        %VM_HEADER;
      927     8583        %VM_HEADER (NAME=SAVED_HEADER, STCLASS=AUTO);
      928     8712        %VM_BODYREC (NAME=VM_BODYREC_ENCODED, STCLASS=AUTO, ERR_FORMAT=YES);
      929     8744        %VM_BODYREC (NAME=OLD_BODYREC_ENCODED, STCLASS=AUTO, ERR_FORMAT=YES);
      930     8776        %VM_BODYREC (NAME=VM$BODYREC_ENCODED, STCLASS=BASED, VARYLEN=YES,
      931     8777                             ERR_FORMAT=YES);
      932     8809        %VM_BODYREC (NAME=INIT_BODYREC_ENCODED, STCLASS=CONSTANT,
      933     8810                             TYP=%VM_BODY_ENCODED_ERR, ERR_FORMAT=YES);
      934     8842
      935     8843    1   DCL VMD$GET_HEADER ENTRY (2) ALTRET;
      936     8844    1   DCL VMD$PUT_HEADER ENTRY (2) ALTRET;
      937     8845    1   DCL VMD$GET_BODY ENTRY (9) ALTRET;
      938     8846    1   DCL VMD$GET_TRACE ENTRY (7) ALTRET;
      939     8847    1   DCL VMD$PUT_TRACE ENTRY (7) ALTRET;
      940     8848    1   DCL VMD$GET_ID ENTRY (3) ALTRET;
      941     8849
      942     8850        %EJECT;
PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:161  
      943     8851    1       IF (NOT VM_HEADER.STATUS.ERR AND NOT VM_HEADER.STATUS.ACK
      944     8852    1         AND NOT VM_HEADER.STATUS.RRACK
      945     8853    1         AND NOT VM_HEADER.STATUS.ANSWER AND NOT VM_HEADER.STATUS.DELIVERY)
      946     8854    1         OR VM_HEADER.REFERS_TO_ID$ = ADDR(NIL)
      947     8855    1       THEN
      948     8856    1           ALTRETURN;
      949     8857
      950     8858    1       CALL VMD$GET_ID (VM_HEADER.REFERS_TO_ID$ -> X$STRING, DCB_OUT,
      951     8859    1         MESSAGE_NUMBER)
      952     8860    2       WHENALTRETURN DO;
      953     8861    2           ALTRETURN;
      954     8862    2       END;
      955     8863
      956     8864    1       SAVED_HEADER = VM_HEADER;
      957     8865
      958     8866    1       IF VM_HEADER.UNIQUE_ID$ = ADDR(NIL)
      959     8867    1       THEN
      960     8868    1           ANSWER_ID = '0'B;
      961     8869    1       ELSE
      962     8870    1           ANSWER_ID = VM_HEADER.UNIQUE_ID$ -> X$STRING;
      963     8871
      964     8872    1       ID = VM_HEADER.REFERS_TO_ID$ -> X$STRING.TEXT;
      965     8873
      966     8874    1       IF VM_HEADER.FROM$ = ADDR(NIL)
      967     8875    1       THEN
      968     8876    1           SENDER.COUNT = 0;
      969     8877    1       ELSE
      970     8878    1           SENDER = VM_HEADER.FROM$ -> X$STRING;
      971     8879
      972     8880    1       IF VM_HEADER.BAD_ADDRESS$ = ADDR(NIL)
      973     8881    1       THEN
      974     8882    1           BAD_ADDRESS.COUNT = 0;
      975     8883    1       ELSE
      976     8884    1           BAD_ADDRESS = VM_HEADER.BAD_ADDRESS$ -> X$STRING;
      977     8885
      978     8886    1       VM_HEADRES.RES# = MESSAGE_NUMBER;
      979     8887    1       ENQ_HEADER.V.DCB# = DCB_OUT;
PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:162  
      980     8888    1       DEQ_HEADER.V.DCB# = DCB_OUT;
      981     8889
      982     8890    1       CALL M$ENQ (ENQ_HEADER)
      983     8891    2       WHENALTRETURN DO;
      984     8892    2           CALL M$ERR;
      985     8893    2       END;
      986     8894
      987     8895    1       CALL VMD$GET_HEADER (MESSAGE_NUMBER, DCB_OUT) ALTRET (BAILOUT);
      988     8896
      989     8897    1       IF VM_HEADER.UNIQUE_ID$ = ADDR(NIL)
      990     8898    1         OR VM_HEADER.UNIQUE_ID$ -> X$STRING.TEXT ~= ID
      991     8899    1       THEN
      992     8900    1           GOTO BAILOUT;
      993     8901
      994     8902    1       IF SAVED_HEADER.STATUS.DELIVERY
      995     8903    1         OR (SAVED_HEADER.STATUS.ERR AND SAVED_HEADER.ERROR = '0'B)
      996     8904    2       THEN DO;
      997     8905
      998     8906    2           NUM_RECORDS = VM_HEADER.NUM_TRACE_RECORDS;
      999     8907
     1000     8908    3           DO I = 0 TO SAVED_HEADER.NUM_RECORDS - 1;
     1001     8909
     1002     8910    3               VM_BODYREC_ENCODED = '0'B;
     1003     8911
     1004     8912    3               CALL VMD$GET_BODY (0, DCB_IN, I, COUNT, ,
     1005     8913    3                 VM_BODYREC_ENCODED) ALTRET (DONE_DELIVERY);
     1006     8914
     1007     8915    4   ADD_IF_UNIQUE: DO;
     1008     8916
     1009     8917    5                   DO J = 0 TO NUM_RECORDS - 1;
     1010     8918
     1011     8919    5                       OLD_BODYREC_ENCODED = '0'B;
     1012     8920
     1013     8921    5                       CALL VMD$GET_TRACE (MESSAGE_NUMBER, DCB_OUT, J,
     1014     8922    5                         COUNT1, , OLD_BODYREC_ENCODED)
     1015     8923    6                       WHENRETURN DO;
     1016     8924    6                           IF VM_BODYREC_ENCODED = OLD_BODYREC_ENCODED
PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:163  
     1017     8925    6                           THEN
     1018     8926    6                               EXIT ADD_IF_UNIQUE;
     1019     8927    6                       END;
     1020     8928
     1021     8929    5                   END;
     1022     8930
     1023     8931    4                   CALL VMD$PUT_TRACE (MESSAGE_NUMBER, DCB_OUT,
     1024     8932    4                     VM_HEADER.NUM_TRACE_RECORDS, COUNT, , VM_BODYREC_ENCODED);
     1025     8933
     1026     8934    4                   VM_HEADER.NUM_TRACE_RECORDS = VM_HEADER.NUM_TRACE_RECORDS + 1;
     1027     8935
     1028     8936    4               END ADD_IF_UNIQUE;
     1029     8937
     1030     8938    3           END;
     1031     8939
     1032     8940    2   DONE_DELIVERY:
     1033     8941
     1034     8942    2           CALL VMD$PUT_HEADER (MESSAGE_NUMBER, DCB_OUT) ALTRET (BAILOUT);
     1035     8943
     1036     8944    3           CALL M$DEQ (DEQ_HEADER) WHENALTRETURN DO; END;
     1037     8945
     1038     8946    2           RETURN;
     1039     8947    2       END;
     1040     8948
     1041     8949    1       VM_BODYREC_ENCODED = INIT_BODYREC_ENCODED;
     1042     8950    1       VM_BODYREC_ENCODED.VALUE.DATA.STUFF = '0'B;
     1043     8951    1       VM_BODYREC_ENCODED.VALUE.DATA.UTS = SAVED_HEADER.CREATION_DATE;
     1044     8952
     1045     8953    1       IF SAVED_HEADER.STATUS.RRACK
     1046     8954    2       THEN DO;
     1047     8955
     1048     8956    2           VM_BODYREC_ENCODED.VALUE.DATA.ERR = E_RRACKED;
     1049     8957    2           CALL PACK (VM_BODYREC_ENCODED.VALUE.DATA.STUFF, COUNT, SENDER);
     1050     8958
     1051     8959    2       END;
     1052     8960
     1053     8961    1       IF SAVED_HEADER.STATUS.ACK
PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:164  
     1054     8962    2       THEN DO;
     1055     8963
     1056     8964    2           VM_BODYREC_ENCODED.VALUE.DATA.ERR = E_ACKED;
     1057     8965    2           CALL PACK (VM_BODYREC_ENCODED.VALUE.DATA.STUFF, COUNT, SENDER);
     1058     8966
     1059     8967    2       END;
     1060     8968
     1061     8969    1       IF SAVED_HEADER.STATUS.ANSWER
     1062     8970    2       THEN DO;
     1063     8971
     1064     8972    2           VM_BODYREC_ENCODED.VALUE.DATA.ERR = E_ANSWERED;
     1065     8973    2           CALL PACK (VM_BODYREC_ENCODED.VALUE.DATA.STUFF, COUNT, SENDER, ANSWER_ID);
     1066     8974
     1067     8975    2       END;
     1068     8976
     1069     8977    1       IF SAVED_HEADER.STATUS.ERR
     1070     8978    2       THEN DO;
     1071     8979
     1072     8980    2           VM_BODYREC_ENCODED.VALUE.DATA.ERR = SAVED_HEADER.ERROR;
     1073     8981    2           CALL PACK (VM_BODYREC_ENCODED.VALUE.DATA.STUFF, COUNT, BAD_ADDRESS);
     1074     8982
     1075     8983    2       END;
     1076     8984
     1077     8985    1       COUNT = COUNT + LENGTHC(VM_BODYREC_ENCODED) - LENGTHC(VM_BODYREC_ENCODED.VALUE.
              8985                DATA.STUFF);
     1078     8986    1       VM_BODYREC_ENCODED.VALUE.COUNT = COUNT;
     1079     8987
     1080     8988    2       DO I = 0 TO VM_HEADER.NUM_TRACE_RECORDS - 1;
     1081     8989
     1082     8990    2           OLD_BODYREC_ENCODED = '0'B;
     1083     8991
     1084     8992    2           CALL VMD$GET_TRACE (MESSAGE_NUMBER, DCB_OUT, I, J, , OLD_BODYREC_ENCODED)
     1085     8993    3           WHENRETURN DO;
     1086     8994
     1087     8995    3               IF VM_BODYREC_ENCODED = OLD_BODYREC_ENCODED
     1088     8996    3               THEN
     1089     8997    3                   IF SAVED_HEADER.STATUS.ANSWER
PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:165  
     1090     8998    3                   THEN /* don't discard reply messsage for ANS */
     1091     8999    3                       GOTO BAILOUT;
     1092     9000    3                   ELSE
     1093     9001    3                       GOTO DONE;
     1094     9002
     1095     9003    3           END;
     1096     9004
     1097     9005    2       END;
     1098     9006
     1099     9007    1       CALL VMD$PUT_TRACE (MESSAGE_NUMBER, DCB_OUT,
     1100     9008    1         VM_HEADER.NUM_TRACE_RECORDS, COUNT, , VM_BODYREC_ENCODED) ALTRET (BAILOUT);
     1101     9009
     1102     9010    1       VM_HEADER.NUM_TRACE_RECORDS = VM_HEADER.NUM_TRACE_RECORDS + 1;
     1103     9011
     1104     9012    1       CALL VMD$PUT_HEADER (MESSAGE_NUMBER, DCB_OUT) ALTRET (BAILOUT);
     1105     9013    1   DONE: ;
     1106     9014    2       CALL M$DEQ (DEQ_HEADER) WHENALTRETURN DO; END;
     1107     9015
     1108     9016    1       RETURN;
     1109     9017
     1110     9018    1   BAILOUT:
     1111     9019    2       CALL M$DEQ (DEQ_HEADER) WHENALTRETURN DO; END;
     1112     9020
     1113     9021    1       ALTRETURN;
     1114     9022
     1115     9023        %EJECT;
PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:166  
     1116     9024    1   PACK: PROC (BUFFER, COUNT, T1, T2);
     1117     9025
     1118     9026    2   DCL BUFFER (0:504) UBIN BYTE CALIGNED;
     1119     9027    2   DCL COUNT UBIN;
     1120     9028    2   DCL 1 T1,
     1121     9029    2         2 COUNT UBIN BYTE CALIGNED,
     1122     9030    2         2 TEXT CHAR (T1.COUNT);
     1123     9031    2   DCL 1 T2,
     1124     9032    2         2 COUNT UBIN BYTE CALIGNED,
     1125     9033    2         2 TEXT CHAR (T1.COUNT);
     1126     9034    2   DCL TSTRING CHAR (TSIZ) BASED;
     1127     9035    2   DCL TSIZ UBIN;
     1128     9036
     1129     9037    2       IF ADDR(T1) = ADDR(NIL) OR T1.COUNT = 0
     1130     9038    3       THEN DO;
     1131     9039    3           BUFFER(0) = 0;
     1132     9040    3           COUNT = 1;
     1133     9041    3       END;
     1134     9042    3       ELSE DO;
     1135     9043    3           TSIZ = T1.COUNT + 1;
     1136     9044    3           ADDR(BUFFER(0)) -> TSTRING = ADDR(T1) -> TSTRING;
     1137     9045    3           COUNT = TSIZ;
     1138     9046    3       END;
     1139     9047
     1140     9048    2       IF ADDR(T2) = ADDR(NIL) OR T2.COUNT = 0
     1141     9049    3       THEN DO;
     1142     9050    3           BUFFER(COUNT) = 0;
     1143     9051    3           COUNT = COUNT + 1;
     1144     9052    3       END;
     1145     9053    3       ELSE DO;
     1146     9054    3           TSIZ = T2.COUNT + 1;
     1147     9055    3           ADDR(BUFFER(COUNT)) -> TSTRING = ADDR(T2) -> TSTRING;
     1148     9056    3           COUNT = COUNT + TSIZ;
     1149     9057    3       END;
     1150     9058
     1151     9059    2       BUFFER(COUNT) = 0;
     1152     9060    2       COUNT = COUNT + 1;
PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:167  
     1153     9061
     1154     9062    2       RETURN;
     1155     9063
     1156     9064    2   END PACK;
     1157     9065
     1158     9066    1   END VMM$COMBINE_MESSAGE;

PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:168  
--  Include file information  --

   VM_PERR_C.:VMB6TOU  is referenced.
   VM_MACRO_C.:VMB6TOU  is referenced.
   B_MACROS_C.:LIB_E05  is referenced.
   VM_DATA_R.:VMB6TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   CP_6_C.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure VMM$COMBINE_MESSAGE.

   Procedure VMM$COMBINE_MESSAGE requires 454 words for executable code.
   Procedure VMM$COMBINE_MESSAGE requires 664 words of local(AUTO) storage.

    No errors detected in file VMM$MESSAGE.:VMB6TSI    .

PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:169  

 Object Unit name= VMM$COMBINE_MESSAGE                        File name= VMM$MESSAGE.:VMB6TOU
 UTS= AUG 20 '97 15:18:31.92 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   DCB   even  none     0      0  M$MAIL_FILE
    2   DCB   even  none     0      0  M$MAIL_CENTRAL
    3   DCB   even  none     0      0  M$MAIL_GLOBAL
    4   DCB   even  none     0      0  M$WORK
    5   DCB   even  none     0      0  M$MAIL_COMGROUP
    6   DCB   even  none     0      0  M$DO
    7   DCB   even  none     0      0  M$LO
    8   DCB   even  none     0      0  M$ME
    9   DCB   even  none     0      0  M$NODE
   10   DCB   even  none     0      0  M$SI
   11  RoData even  UTS     80    120  VMM$COMBINE_MESSAGE
   12   Data  even  none    20     24  VMM$COMBINE_MESSAGE
   13   Proc  even  none   454    706  VMM$COMBINE_MESSAGE
   14  RoData even  none     6      6  VMM$COMBINE_MESSAGE

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
    13      0   yes    yes     yes      Std        3  VMM$COMBINE_MESSAGE
PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:170  

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       3 VMD$GET_ID
 yes     yes           Std       2 VMD$GET_HEADER
 yes     yes           Std       2 VMD$PUT_HEADER
 yes     yes           Std       9 VMD$GET_BODY
 yes     yes           Std       7 VMD$GET_TRACE
 yes     yes           Std       7 VMD$PUT_TRACE
                       nStd      0 X66_AUTO_3
                       nStd      0 X66_AALT
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                             r    VM_HEADER$                       r    VM_PROFILE$
r    VM_ADDLIST$                      r    VM_ADDREC$                       r    VM_WORK$
r    VM_SELECT$                       r    VM_PARSEAREA$                    r    VM_INPUT$
r    VM_COPY$                              VM_ENCLLIST$                          VM_ENCLREC$
     VM_HEADER_                            VM_HEADER_INIT_                       VM_PROFILE_
     VM_ADDLIST_                           VM_ADDREC_                            VM_WORK_
     VM_SELECT_                            VM_PARSEAREA_                         VM_INPUT_
     VM_COPY_                              VM_ENCLLIST_                          VM_ENCLREC_
     M$MAIL_FILE                           M$MAIL_CENTRAL                        M$MAIL_GLOBAL
     M$WORK                                M$MAIL_COMGROUP                       M$DO
     M$LO                                  M$ME                                  M$NODE
     M$SI                                  M$MAIL_FILE_NUM                       M$MAIL_CENTRAL_NUM
     M$MAIL_GLOBAL_NUM                     M$WORK_NUM                            M$MAIL_COMGROUP_NUM
     M$DO_NUM                              M$ME_NUM                              M$LO_NUM
     M$SI_NUM                              M$NODE_NUM                       r    B$JIT$
r    B$TCB$                                VM_MAIL_ACCT                          VM_NAME_MAP_NAME
     ERRMSG_FID                            VM_SEND_FILE_NAME                     VM_FORWARD_FILE_NAME
     VM_FORWARD_ENCL_NAME                  VM_FORWARD_FILE_PASS                  VM_MAILCG_NAME
PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:171  
     VM_SITENAME                           VM_MAILCG_SETSTA

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID
PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:172  


      850        1        /*T***********************************************************/
      851        2        /*T*                                                         */
      852        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      853        4        /*T*                                                         */
      854        5        /*T***********************************************************/
      855        6        /*X* DMC,PLM=4,IND=4,CTI=2,DTI=0,ENI=0,ECI=0,CSI=0,DCI=4 */
      856        7        VMM$COMBINE_MESSAGE: PROC (DCB_IN, MSG_NUMBER_IN, DCB_OUT) ALTRET;

      7 13 000000   000000 700200 xent  VMM$COMBINE* TSX0  ! X66_AUTO_3
        13 000001   001230 000003                    ZERO    664,3

      857        8        /*P*  NAME: VMM$COMBINE_MESSAGE
      858        9              PURPOSE: Combines error and response information with an existing
      859       10                       mailgram.
      860       11              DESCRIPTION:
      861       12                    This routine is called from MAILMAN during message delivery,
      862       13                    and from MAIL during MOVE MESSAGE and COPY MESSAGE.  It attempts
      863       14                    to insert information from an ERR, ACK, ANS, or DELIVERY mailgram
      864       15                    into the trace record area of the original mailgram from which
      865       16                    the ERR etc. was spawned.
      866       17              INPUT:   VM_HEADER contains the header of the new mailgram to be
      867       18                                combined;
      868       19                       VM_PROFILE contains the profile of the mailbox into which this
      869       20                                mailgram is being inserted.
      870       21              OUTPUT:  Normal return:  the input mailgram has been combined with its
      871       22                                originator in this folder.
      872       23                       Alternate return:  the input mailgram has not been combined.
      873       24                       Both:  VM_HEADER has probably been trashed, and must be reread.
      874       25        */
      875       26
      876       27    1   DCL DCB_IN UBIN;
      877       28    1   DCL MSG_NUMBER_IN UBIN;
      878       29    1   DCL DCB_OUT UBIN;
      879       30    1   DCL MSG_NUMBER_OUT UBIN;
      880       31
      881       32        %INCLUDE CP_6;
PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:173  
      882     5591        %INCLUDE CP_6_SUBS;
      883     6131        %INCLUDE VM_DATA_R;
      884     6562        %INCLUDE VM_MACRO_C;
      885     7830        %INCLUDE VM_PERR_C;
      886     8125
      887     8126    1   DCL COUNT UBIN;
      888     8127    1   DCL COUNT1 UBIN;
      889     8128    1   DCL MESSAGE_NUMBER UBIN;
      890     8129    1   DCL NUM_RECORDS UBIN;
      891     8130    1   DCL I UBIN;
      892     8131    1   DCL J UBIN;
      893     8132    1   DCL ID CHAR (255);
      894     8133    1   DCL 1 ANSWER_ID,
      895     8134    1         2 COUNT UBIN BYTE CALIGNED,
      896     8135    1         2 TEXT CHAR (511);
      897     8136    1   DCL 1 SENDER,
      898     8137    1         2 COUNT UBIN BYTE CALIGNED,
      899     8138    1         2 TEXT CHAR (511);
      900     8139    1   DCL 1 BAD_ADDRESS,
      901     8140    1         2 COUNT UBIN BYTE CALIGNED,
      902     8141    1         2 TEXT CHAR (511);
      903     8142
      904     8143        %VLP_ERRCODE (FPTN=E_ACKED,FCG="VO",MID="M",
      905     8144                      ERR#=%E$ACKED,STCLASS=CONSTANT);
      906     8189
      907     8190              %VLP_ERRCODE (FPTN=E_RRACKED,FCG="VO",MID="M",
      908     8191              ERR#=%E$RRACKED,STCLASS=CONSTANT);
      909     8236
      910     8237              %VLP_ERRCODE (FPTN=E_ANSWERED,FCG="VO",MID="M",
      911     8238              ERR#=%E$ANSWERED,STCLASS=CONSTANT);
      912     8283
      913     8284              %FPT_ENQ (FPTN=ENQ_HEADER,
      914     8285              SHARE=NONE,
      915     8286              WAIT=YES,
      916     8287              RNAME=VM_HEADRES);
      917     8305
      918     8306        %FPT_DEQ (FPTN=DEQ_HEADER,
PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:174  
      919     8307                  RNAME=VM_HEADRES);
      920     8324
      921     8325        %VM_HEADRES (STCLASS=STATIC);
      922     8339
      923     8340        %VM_BODYTYPES;
      924     8346        %VM_KEYTYPES;
      925     8367        %VM_PROFILE;
      926     8454        %VM_HEADER;
      927     8583        %VM_HEADER (NAME=SAVED_HEADER, STCLASS=AUTO);
      928     8712        %VM_BODYREC (NAME=VM_BODYREC_ENCODED, STCLASS=AUTO, ERR_FORMAT=YES);
      929     8744        %VM_BODYREC (NAME=OLD_BODYREC_ENCODED, STCLASS=AUTO, ERR_FORMAT=YES);
      930     8776        %VM_BODYREC (NAME=VM$BODYREC_ENCODED, STCLASS=BASED, VARYLEN=YES,
      931     8777                             ERR_FORMAT=YES);
      932     8809        %VM_BODYREC (NAME=INIT_BODYREC_ENCODED, STCLASS=CONSTANT,
      933     8810                             TYP=%VM_BODY_ENCODED_ERR, ERR_FORMAT=YES);
      934     8842
      935     8843    1   DCL VMD$GET_HEADER ENTRY (2) ALTRET;
      936     8844    1   DCL VMD$PUT_HEADER ENTRY (2) ALTRET;
      937     8845    1   DCL VMD$GET_BODY ENTRY (9) ALTRET;
      938     8846    1   DCL VMD$GET_TRACE ENTRY (7) ALTRET;
      939     8847    1   DCL VMD$PUT_TRACE ENTRY (7) ALTRET;
      940     8848    1   DCL VMD$GET_ID ENTRY (3) ALTRET;
      941     8849
      942     8850        %EJECT;
PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:175  
      943     8851    1       IF (NOT VM_HEADER.STATUS.ERR AND NOT VM_HEADER.STATUS.ACK

   8851 13 000002   000000 470400 xsym               LDP0    VM_HEADER$
        13 000003   000012 234100                    SZN     10,,PR0
        13 000004   000016 604000 13                 TMI     s:8851+12
        13 000005   000012 236100                    LDQ     10,,PR0
        13 000006   100000 316003                    CANQ    32768,DU
        13 000007   000016 601000 13                 TNZ     s:8851+12
        13 000010   020000 316007                    CANQ    8192,DL
        13 000011   000016 601000 13                 TNZ     s:8851+12
        13 000012   200000 316003                    CANQ    65536,DU
        13 000013   000016 601000 13                 TNZ     s:8851+12
        13 000014   000002 316003                    CANQ    2,DU
        13 000015   000021 600000 13                 TZE     s:8856
        13 000016   000033 236100                    LDQ     27,,PR0
        13 000017   000000 116000 14                 CMPQ    0
        13 000020   000022 601000 13                 TNZ     s:8858

      944     8852    1         AND NOT VM_HEADER.STATUS.RRACK
      945     8853    1         AND NOT VM_HEADER.STATUS.ANSWER AND NOT VM_HEADER.STATUS.DELIVERY)
      946     8854    1         OR VM_HEADER.REFERS_TO_ID$ = ADDR(NIL)
      947     8855    1       THEN
      948     8856    1           ALTRETURN;

   8856 13 000021   000000 702200 xent               TSX2  ! X66_AALT

      949     8857
      950     8858    1       CALL VMD$GET_ID (VM_HEADER.REFERS_TO_ID$ -> X$STRING, DCB_OUT,

   8858 13 000022   000033 471500                    LDP1    27,,PR0
        13 000023   200011 633500                    EPPR3   MESSAGE_NUMBER,,AUTO
        13 000024   201224 453500                    STP3    TSIZ+3,,AUTO
        13 000025   200005 236100                    LDQ     @DCB_OUT,,AUTO
        13 000026   201223 756100                    STQ     TSIZ+2,,AUTO
        13 000027   201222 451500                    STP1    TSIZ+1,,AUTO
        13 000030   201222 630500                    EPPR0   TSIZ+1,,AUTO
        13 000031   000001 631400 14                 EPPR1   1
PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:176  
        13 000032   000000 701000 xent               TSX1    VMD$GET_ID
        13 000033   000035 702000 13                 TSX2    s:8861
        13 000034   000036 710000 13                 TRA     s:8864

      951     8859    1         MESSAGE_NUMBER)
      952     8860    2       WHENALTRETURN DO;

      953     8861    2           ALTRETURN;

   8861 13 000035   000000 702200 xent               TSX2  ! X66_AALT

      954     8862    2       END;
      955     8863
      956     8864    1       SAVED_HEADER = VM_HEADER;

   8864 13 000036   000000 470400 xsym               LDP0    VM_HEADER$
        13 000037   000100 100500                    MLR     fill='000'O
        13 000040   000000 000224                    ADSC9   0,,PR0                   cn=0,n=148
        13 000041   200715 000224                    ADSC9   SAVED_HEADER,,AUTO       cn=0,n=148

      957     8865
      958     8866    1       IF VM_HEADER.UNIQUE_ID$ = ADDR(NIL)

   8866 13 000042   000032 236100                    LDQ     26,,PR0
        13 000043   000000 116000 14                 CMPQ    0
        13 000044   000051 601000 13                 TNZ     s:8870

      959     8867    1       THEN
      960     8868    1           ANSWER_ID = '0'B;

   8868 13 000045   000100 100400                    MLR     fill='000'O
        13 000046   000002 000001 14                 ADSC9   2                        cn=0,n=1
        13 000047   200115 001000                    ADSC9   ANSWER_ID,,AUTO          cn=0,n=512
        13 000050   000062 710000 13                 TRA     s:8872

      961     8869    1       ELSE
      962     8870    1           ANSWER_ID = VM_HEADER.UNIQUE_ID$ -> X$STRING;
PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:177  

   8870 13 000051   000032 471500                    LDP1    26,,PR0
        13 000052   000100 101500                    MRL     fill='000'O
        13 000053   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        13 000054   201222 000002                    ADSC9   TSIZ+1,,AUTO             cn=0,n=2
        13 000055   201222 220100                    LDX0    TSIZ+1,,AUTO
        13 000056   000001 621010                    EAX1    1,X0
        13 000057   000100 100540                    MLR     fill='000'O
        13 000060   100000 000011                    ADSC9   0,,PR1                   cn=0,n=*X1
        13 000061   200115 001000                    ADSC9   ANSWER_ID,,AUTO          cn=0,n=512

      963     8871
      964     8872    1       ID = VM_HEADER.REFERS_TO_ID$ -> X$STRING.TEXT;

   8872 13 000062   000033 471500                    LDP1    27,,PR0
        13 000063   000100 101500                    MRL     fill='000'O
        13 000064   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        13 000065   201222 000002                    ADSC9   TSIZ+1,,AUTO             cn=0,n=2
        13 000066   201222 220100                    LDX0    TSIZ+1,,AUTO
        13 000067   040100 100540                    MLR     fill='040'O
        13 000070   100000 200010                    ADSC9   0,,PR1                   cn=1,n=*X0
        13 000071   200015 000377                    ADSC9   ID,,AUTO                 cn=0,n=255

      965     8873
      966     8874    1       IF VM_HEADER.FROM$ = ADDR(NIL)

   8874 13 000072   000023 236100                    LDQ     19,,PR0
        13 000073   000000 116000 14                 CMPQ    0
        13 000074   000100 601000 13                 TNZ     s:8878

      967     8875    1       THEN
      968     8876    1           SENDER.COUNT = 0;

   8876 13 000075   000000 236003                    LDQ     0,DU
        13 000076   200315 552140                    STBQ    SENDER,'40'O,AUTO
        13 000077   000111 710000 13                 TRA     s:8880

PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:178  
      969     8877    1       ELSE
      970     8878    1           SENDER = VM_HEADER.FROM$ -> X$STRING;

   8878 13 000100   000023 471500                    LDP1    19,,PR0
        13 000101   000100 101500                    MRL     fill='000'O
        13 000102   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        13 000103   201222 000002                    ADSC9   TSIZ+1,,AUTO             cn=0,n=2
        13 000104   201222 220100                    LDX0    TSIZ+1,,AUTO
        13 000105   000001 621010                    EAX1    1,X0
        13 000106   000100 100540                    MLR     fill='000'O
        13 000107   100000 000011                    ADSC9   0,,PR1                   cn=0,n=*X1
        13 000110   200315 001000                    ADSC9   SENDER,,AUTO             cn=0,n=512

      971     8879
      972     8880    1       IF VM_HEADER.BAD_ADDRESS$ = ADDR(NIL)

   8880 13 000111   000017 236100                    LDQ     15,,PR0
        13 000112   000000 116000 14                 CMPQ    0
        13 000113   000117 601000 13                 TNZ     s:8884

      973     8881    1       THEN
      974     8882    1           BAD_ADDRESS.COUNT = 0;

   8882 13 000114   000000 236003                    LDQ     0,DU
        13 000115   200515 552140                    STBQ    BAD_ADDRESS,'40'O,AUTO
        13 000116   000130 710000 13                 TRA     s:8886

      975     8883    1       ELSE
      976     8884    1           BAD_ADDRESS = VM_HEADER.BAD_ADDRESS$ -> X$STRING;

   8884 13 000117   000017 471500                    LDP1    15,,PR0
        13 000120   000100 101500                    MRL     fill='000'O
        13 000121   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        13 000122   201222 000002                    ADSC9   TSIZ+1,,AUTO             cn=0,n=2
        13 000123   201222 220100                    LDX0    TSIZ+1,,AUTO
        13 000124   000001 621010                    EAX1    1,X0
        13 000125   000100 100540                    MLR     fill='000'O
PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:179  
        13 000126   100000 000011                    ADSC9   0,,PR1                   cn=0,n=*X1
        13 000127   200515 001000                    ADSC9   BAD_ADDRESS,,AUTO        cn=0,n=512

      977     8885
      978     8886    1       VM_HEADRES.RES# = MESSAGE_NUMBER;

   8886 13 000130   000000 100500                    MLR     fill='000'O
        13 000131   200011 000004                    ADSC9   MESSAGE_NUMBER,,AUTO     cn=0,n=4
        13 000132   000022 200004 12                 ADSC9   VM_HEADRES               cn=1,n=4

      979     8887    1       ENQ_HEADER.V.DCB# = DCB_OUT;

   8887 13 000133   200005 471500                    LDP1    @DCB_OUT,,AUTO
        13 000134   100000 720100                    LXL0    0,,PR1
        13 000135   000006 740000 12                 STX0    ENQ_HEADER+6

      980     8888    1       DEQ_HEADER.V.DCB# = DCB_OUT;

   8888 13 000136   100000 721100                    LXL1    0,,PR1
        13 000137   000020 741000 12                 STX1    DEQ_HEADER+6

      981     8889
      982     8890    1       CALL M$ENQ (ENQ_HEADER)

   8890 13 000140   000000 630400 12                 EPPR0   ENQ_HEADER
        13 000141   420002 713400                    CLIMB   alt,+8194
        13 000142   401000 401760                    pmme    nvectors=3
        13 000143   000145 702000 13                 TSX2    s:8892
        13 000144   000147 710000 13                 TRA     s:8895

      983     8891    2       WHENALTRETURN DO;

      984     8892    2           CALL M$ERR;

   8892 13 000145   000002 713400                    CLIMB   err
        13 000146   000000 401760                    pmme    nvectors=0

PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:180  
      985     8893    2       END;

      986     8894
      987     8895    1       CALL VMD$GET_HEADER (MESSAGE_NUMBER, DCB_OUT) ALTRET (BAILOUT);

   8895 13 000147   200005 236100                    LDQ     @DCB_OUT,,AUTO
        13 000150   201223 756100                    STQ     TSIZ+2,,AUTO
        13 000151   200011 630500                    EPPR0   MESSAGE_NUMBER,,AUTO
        13 000152   201222 450500                    STP0    TSIZ+1,,AUTO
        13 000153   201222 630500                    EPPR0   TSIZ+1,,AUTO
        13 000154   000003 631400 14                 EPPR1   3
        13 000155   000000 701000 xent               TSX1    VMD$GET_HEADER
        13 000156   000556 702000 13                 TSX2    BAILOUT

      988     8896
      989     8897    1       IF VM_HEADER.UNIQUE_ID$ = ADDR(NIL)

   8897 13 000157   000000 470400 xsym               LDP0    VM_HEADER$
        13 000160   000032 236100                    LDQ     26,,PR0
        13 000161   000000 116000 14                 CMPQ    0
        13 000162   000556 600000 13                 TZE     BAILOUT
        13 000163   000032 471500                    LDP1    26,,PR0
        13 000164   000100 101500                    MRL     fill='000'O
        13 000165   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
        13 000166   201222 000002                    ADSC9   TSIZ+1,,AUTO             cn=0,n=2
        13 000167   201222 220100                    LDX0    TSIZ+1,,AUTO
        13 000170   040100 106540                    CMPC    fill='040'O
        13 000171   100000 200010                    ADSC9   0,,PR1                   cn=1,n=*X0
        13 000172   200015 000377                    ADSC9   ID,,AUTO                 cn=0,n=255
        13 000173   000556 601000 13                 TNZ     BAILOUT

      990     8898    1         OR VM_HEADER.UNIQUE_ID$ -> X$STRING.TEXT ~= ID
      991     8899    1       THEN
      992     8900    1           GOTO BAILOUT;
      993     8901
      994     8902    1       IF SAVED_HEADER.STATUS.DELIVERY

PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:181  
   8902 13 000174   200727 236100                    LDQ     SAVED_HEADER+10,,AUTO
        13 000175   000002 316003                    CANQ    2,DU
        13 000176   000203 601000 13                 TNZ     s:8906
        13 000177   200727 234100                    SZN     SAVED_HEADER+10,,AUTO
        13 000200   000341 605000 13                 TPL     s:8949
        13 000201   200731 235100                    LDA     SAVED_HEADER+12,,AUTO
        13 000202   000341 601000 13                 TNZ     s:8949

      995     8903    1         OR (SAVED_HEADER.STATUS.ERR AND SAVED_HEADER.ERROR = '0'B)
      996     8904    2       THEN DO;

      997     8905
      998     8906    2           NUM_RECORDS = VM_HEADER.NUM_TRACE_RECORDS;

   8906 13 000203   000034 235100                    LDA     28,,PR0
        13 000204   200012 755100                    STA     NUM_RECORDS,,AUTO

      999     8907
     1000     8908    3           DO I = 0 TO SAVED_HEADER.NUM_RECORDS - 1;

   8908 13 000205   200013 450100                    STZ     I,,AUTO
        13 000206   000320 710000 13                 TRA     s:8938+3

     1001     8909
     1002     8910    3               VM_BODYREC_ENCODED = '0'B;

   8910 13 000207   000100 100400                    MLR     fill='000'O
        13 000210   000002 000001 14                 ADSC9   2                        cn=0,n=1
        13 000211   200762 000464                    ADSC9   VM_BODYREC_ENCODED,,AUTO cn=0,n=308

     1003     8911
     1004     8912    3               CALL VMD$GET_BODY (0, DCB_IN, I, COUNT, ,

   8912 13 000212   200762 630500                    EPPR0   VM_BODYREC_ENCODED,,AUTO
        13 000213   201227 450500                    STP0    TSIZ+6,,AUTO
        13 000214   000000 236000 14                 LDQ     0
        13 000215   201226 756100                    STQ     TSIZ+5,,AUTO
PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:182  
        13 000216   200007 631500                    EPPR1   COUNT,,AUTO
        13 000217   201225 451500                    STP1    TSIZ+4,,AUTO
        13 000220   200013 633500                    EPPR3   I,,AUTO
        13 000221   201224 453500                    STP3    TSIZ+3,,AUTO
        13 000222   200003 236100                    LDQ     @DCB_IN,,AUTO
        13 000223   000005 235000 14                 LDA     5
        13 000224   201222 757100                    STAQ    TSIZ+1,,AUTO
        13 000225   201222 630500                    EPPR0   TSIZ+1,,AUTO
        13 000226   000004 631400 14                 EPPR1   4
        13 000227   000000 701000 xent               TSX1    VMD$GET_BODY
        13 000230   000323 702000 13                 TSX2    DONE_DELIVERY

     1005     8913    3                 VM_BODYREC_ENCODED) ALTRET (DONE_DELIVERY);
     1006     8914
     1007     8915    4   ADD_IF_UNIQUE: DO;

   8915 13 000231                       ADD_IF_UNIQ* null
     1008     8916
     1009     8917    5                   DO J = 0 TO NUM_RECORDS - 1;

   8917 13 000231   200014 450100                    STZ     J,,AUTO
        13 000232   000265 710000 13                 TRA     s:8929+3

     1010     8918
     1011     8919    5                       OLD_BODYREC_ENCODED = '0'B;

   8919 13 000233   000100 100400                    MLR     fill='000'O
        13 000234   000002 000001 14                 ADSC9   2                        cn=0,n=1
        13 000235   201077 000464                    ADSC9   OLD_BODYREC_ENCODED,,AUTO cn=0,n=308

     1012     8920
     1013     8921    5                       CALL VMD$GET_TRACE (MESSAGE_NUMBER, DCB_OUT, J,

   8921 13 000236   201077 630500                    EPPR0   OLD_BODYREC_ENCODED,,AUTO
        13 000237   201227 450500                    STP0    TSIZ+6,,AUTO
        13 000240   000000 236000 14                 LDQ     0
        13 000241   201226 756100                    STQ     TSIZ+5,,AUTO
PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:183  
        13 000242   200010 631500                    EPPR1   COUNT1,,AUTO
        13 000243   201225 451500                    STP1    TSIZ+4,,AUTO
        13 000244   200014 633500                    EPPR3   J,,AUTO
        13 000245   201224 453500                    STP3    TSIZ+3,,AUTO
        13 000246   200005 236100                    LDQ     @DCB_OUT,,AUTO
        13 000247   201223 756100                    STQ     TSIZ+2,,AUTO
        13 000250   200011 634500                    EPPR4   MESSAGE_NUMBER,,AUTO
        13 000251   201222 454500                    STP4    TSIZ+1,,AUTO
        13 000252   201222 630500                    EPPR0   TSIZ+1,,AUTO
        13 000253   000004 631400 14                 EPPR1   4
        13 000254   000000 701000 xent               TSX1    VMD$GET_TRACE
        13 000255   000262 702000 13                 TSX2    s:8929

     1014     8922    5                         COUNT1, , OLD_BODYREC_ENCODED)
     1015     8923    6                       WHENRETURN DO;

     1016     8924    6                           IF VM_BODYREC_ENCODED = OLD_BODYREC_ENCODED

   8924 13 000256   000100 106500                    CMPC    fill='000'O
        13 000257   200762 000464                    ADSC9   VM_BODYREC_ENCODED,,AUTO cn=0,n=308
        13 000260   201077 000464                    ADSC9   OLD_BODYREC_ENCODED,,AUTO cn=0,n=308
        13 000261   000315 600000 13                 TZE     s:8938

     1017     8925    6                           THEN
     1018     8926    6                               EXIT ADD_IF_UNIQUE;
     1019     8927    6                       END;

     1020     8928
     1021     8929    5                   END;

   8929 13 000262   200014 235100                    LDA     J,,AUTO
        13 000263   000001 035007                    ADLA    1,DL
        13 000264   200014 755100                    STA     J,,AUTO
        13 000265   200014 236100                    LDQ     J,,AUTO
        13 000266   200012 116100                    CMPQ    NUM_RECORDS,,AUTO
        13 000267   000233 602000 13                 TNC     s:8919

PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:184  
     1022     8930
     1023     8931    4                   CALL VMD$PUT_TRACE (MESSAGE_NUMBER, DCB_OUT,

   8931 13 000270   200762 630500                    EPPR0   VM_BODYREC_ENCODED,,AUTO
        13 000271   201227 450500                    STP0    TSIZ+6,,AUTO
        13 000272   000000 236000 14                 LDQ     0
        13 000273   201226 756100                    STQ     TSIZ+5,,AUTO
        13 000274   200007 631500                    EPPR1   COUNT,,AUTO
        13 000275   201225 451500                    STP1    TSIZ+4,,AUTO
        13 000276   000000 236000 xsym               LDQ     VM_HEADER$
        13 000277   000034 036003                    ADLQ    28,DU
        13 000300   201224 756100                    STQ     TSIZ+3,,AUTO
        13 000301   200005 236100                    LDQ     @DCB_OUT,,AUTO
        13 000302   201223 756100                    STQ     TSIZ+2,,AUTO
        13 000303   200011 633500                    EPPR3   MESSAGE_NUMBER,,AUTO
        13 000304   201222 453500                    STP3    TSIZ+1,,AUTO
        13 000305   201222 630500                    EPPR0   TSIZ+1,,AUTO
        13 000306   000004 631400 14                 EPPR1   4
        13 000307   000000 701000 xent               TSX1    VMD$PUT_TRACE
        13 000310   000000 011000                    NOP     0

     1024     8932    4                     VM_HEADER.NUM_TRACE_RECORDS, COUNT, , VM_BODYREC_ENCODED);
     1025     8933
     1026     8934    4                   VM_HEADER.NUM_TRACE_RECORDS = VM_HEADER.NUM_TRACE_RECORDS + 1;

   8934 13 000311   000000 470400 xsym               LDP0    VM_HEADER$
        13 000312   000034 235100                    LDA     28,,PR0
        13 000313   000001 035007                    ADLA    1,DL
        13 000314   000034 755100                    STA     28,,PR0

     1027     8935
     1028     8936    4               END ADD_IF_UNIQUE;

     1029     8937
     1030     8938    3           END;

   8938 13 000315   200013 235100                    LDA     I,,AUTO
PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:185  
        13 000316   000001 035007                    ADLA    1,DL
        13 000317   200013 755100                    STA     I,,AUTO
        13 000320   200013 236100                    LDQ     I,,AUTO
        13 000321   200726 116100                    CMPQ    SAVED_HEADER+9,,AUTO
        13 000322   000207 602000 13                 TNC     s:8910

     1031     8939
     1032     8940    2   DONE_DELIVERY:
     1033     8941
     1034     8942    2           CALL VMD$PUT_HEADER (MESSAGE_NUMBER, DCB_OUT) ALTRET (BAILOUT);

   8942 13 000323   200005 236100       DONE_DELIVE* LDQ     @DCB_OUT,,AUTO
        13 000324   201223 756100                    STQ     TSIZ+2,,AUTO
        13 000325   200011 630500                    EPPR0   MESSAGE_NUMBER,,AUTO
        13 000326   201222 450500                    STP0    TSIZ+1,,AUTO
        13 000327   201222 630500                    EPPR0   TSIZ+1,,AUTO
        13 000330   000003 631400 14                 EPPR1   3
        13 000331   000000 701000 xent               TSX1    VMD$PUT_HEADER
        13 000332   000556 702000 13                 TSX2    BAILOUT

     1035     8943
     1036     8944    3           CALL M$DEQ (DEQ_HEADER) WHENALTRETURN DO; END;

   8944 13 000333   000012 630400 12                 EPPR0   DEQ_HEADER
        13 000334   420003 713400                    CLIMB   alt,+8195
        13 000335   401000 401760                    pmme    nvectors=3
        13 000336   000340 702000 13                 TSX2    s:8946
        13 000337   000340 710000 13                 TRA     s:8946

     1037     8945
     1038     8946    2           RETURN;

   8946 13 000340   000000 702200 xent               TSX2  ! X66_ARET

     1039     8947    2       END;
     1040     8948
     1041     8949    1       VM_BODYREC_ENCODED = INIT_BODYREC_ENCODED;
PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:186  

   8949 13 000341   000100 100400                    MLR     fill='000'O
        13 000342   000003 000464 11                 ADSC9   INIT_BODYREC_ENCODED     cn=0,n=308
        13 000343   200762 000464                    ADSC9   VM_BODYREC_ENCODED,,AUTO cn=0,n=308

     1042     8950    1       VM_BODYREC_ENCODED.VALUE.DATA.STUFF = '0'B;

   8950 13 000344   000100 100400                    MLR     fill='000'O
        13 000345   000002 000001 14                 ADSC9   2                        cn=0,n=1
        13 000346   200766 000444                    ADSC9   VM_BODYREC_ENCODED+4,,AUTO cn=0,n=292

     1043     8951    1       VM_BODYREC_ENCODED.VALUE.DATA.UTS = SAVED_HEADER.CREATION_DATE;

   8951 13 000347   200716 235100                    LDA     SAVED_HEADER+1,,AUTO
        13 000350   200765 755100                    STA     VM_BODYREC_ENCODED+3,,AUTO

     1044     8952
     1045     8953    1       IF SAVED_HEADER.STATUS.RRACK

   8953 13 000351   020000 316007                    CANQ    8192,DL
        13 000352   000367 600000 13                 TZE     s:8961

     1046     8954    2       THEN DO;

     1047     8955
     1048     8956    2           VM_BODYREC_ENCODED.VALUE.DATA.ERR = E_RRACKED;

   8956 13 000353   000001 236000 11                 LDQ     E_RRACKED
        13 000354   200764 756100                    STQ     VM_BODYREC_ENCODED+2,,AUTO

     1049     8957    2           CALL PACK (VM_BODYREC_ENCODED.VALUE.DATA.STUFF, COUNT, SENDER);

   8957 13 000355   000000 236000 14                 LDQ     0
        13 000356   201220 756100                    STQ     @T1+1,,AUTO
        13 000357   200315 631500                    EPPR1   SENDER,,AUTO
        13 000360   201217 451500                    STP1    @COUNT+1,,AUTO
        13 000361   200007 633500                    EPPR3   COUNT,,AUTO
PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:187  
        13 000362   201216 453500                    STP3    @BUFFER+1,,AUTO
        13 000363   200766 634500                    EPPR4   VM_BODYREC_ENCODED+4,,AUTO
        13 000364   201215 454500                    STP4    OLD_BODYREC_ENCODED+78,,AUTO
        13 000365   000564 701000 13                 TSX1    PACK
        13 000366   000000 011000                    NOP     0

     1050     8958
     1051     8959    2       END;

     1052     8960
     1053     8961    1       IF SAVED_HEADER.STATUS.ACK

   8961 13 000367   200727 236100                    LDQ     SAVED_HEADER+10,,AUTO
        13 000370   100000 316003                    CANQ    32768,DU
        13 000371   000406 600000 13                 TZE     s:8969

     1054     8962    2       THEN DO;

     1055     8963
     1056     8964    2           VM_BODYREC_ENCODED.VALUE.DATA.ERR = E_ACKED;

   8964 13 000372   000000 236000 11                 LDQ     E_ACKED
        13 000373   200764 756100                    STQ     VM_BODYREC_ENCODED+2,,AUTO

     1057     8965    2           CALL PACK (VM_BODYREC_ENCODED.VALUE.DATA.STUFF, COUNT, SENDER);

   8965 13 000374   000000 236000 14                 LDQ     0
        13 000375   201220 756100                    STQ     @T1+1,,AUTO
        13 000376   200315 630500                    EPPR0   SENDER,,AUTO
        13 000377   201217 450500                    STP0    @COUNT+1,,AUTO
        13 000400   200007 631500                    EPPR1   COUNT,,AUTO
        13 000401   201216 451500                    STP1    @BUFFER+1,,AUTO
        13 000402   200766 633500                    EPPR3   VM_BODYREC_ENCODED+4,,AUTO
        13 000403   201215 453500                    STP3    OLD_BODYREC_ENCODED+78,,AUTO
        13 000404   000564 701000 13                 TSX1    PACK
        13 000405   000000 011000                    NOP     0

PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:188  
     1058     8966
     1059     8967    2       END;

     1060     8968
     1061     8969    1       IF SAVED_HEADER.STATUS.ANSWER

   8969 13 000406   200727 236100                    LDQ     SAVED_HEADER+10,,AUTO
        13 000407   200000 316003                    CANQ    65536,DU
        13 000410   000425 600000 13                 TZE     s:8977

     1062     8970    2       THEN DO;

     1063     8971
     1064     8972    2           VM_BODYREC_ENCODED.VALUE.DATA.ERR = E_ANSWERED;

   8972 13 000411   000002 236000 11                 LDQ     E_ANSWERED
        13 000412   200764 756100                    STQ     VM_BODYREC_ENCODED+2,,AUTO

     1065     8973    2           CALL PACK (VM_BODYREC_ENCODED.VALUE.DATA.STUFF, COUNT, SENDER, ANSWER_ID);

   8973 13 000413   200115 630500                    EPPR0   ANSWER_ID,,AUTO
        13 000414   201220 450500                    STP0    @T1+1,,AUTO
        13 000415   200315 631500                    EPPR1   SENDER,,AUTO
        13 000416   201217 451500                    STP1    @COUNT+1,,AUTO
        13 000417   200007 633500                    EPPR3   COUNT,,AUTO
        13 000420   201216 453500                    STP3    @BUFFER+1,,AUTO
        13 000421   200766 634500                    EPPR4   VM_BODYREC_ENCODED+4,,AUTO
        13 000422   201215 454500                    STP4    OLD_BODYREC_ENCODED+78,,AUTO
        13 000423   000564 701000 13                 TSX1    PACK
        13 000424   000000 011000                    NOP     0

     1066     8974
     1067     8975    2       END;

     1068     8976
     1069     8977    1       IF SAVED_HEADER.STATUS.ERR

PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:189  
   8977 13 000425   200727 234100                    SZN     SAVED_HEADER+10,,AUTO
        13 000426   000443 605000 13                 TPL     s:8985

     1070     8978    2       THEN DO;

     1071     8979
     1072     8980    2           VM_BODYREC_ENCODED.VALUE.DATA.ERR = SAVED_HEADER.ERROR;

   8980 13 000427   200731 236100                    LDQ     SAVED_HEADER+12,,AUTO
        13 000430   200764 756100                    STQ     VM_BODYREC_ENCODED+2,,AUTO

     1073     8981    2           CALL PACK (VM_BODYREC_ENCODED.VALUE.DATA.STUFF, COUNT, BAD_ADDRESS);

   8981 13 000431   000000 236000 14                 LDQ     0
        13 000432   201220 756100                    STQ     @T1+1,,AUTO
        13 000433   200515 630500                    EPPR0   BAD_ADDRESS,,AUTO
        13 000434   201217 450500                    STP0    @COUNT+1,,AUTO
        13 000435   200007 631500                    EPPR1   COUNT,,AUTO
        13 000436   201216 451500                    STP1    @BUFFER+1,,AUTO
        13 000437   200766 633500                    EPPR3   VM_BODYREC_ENCODED+4,,AUTO
        13 000440   201215 453500                    STP3    OLD_BODYREC_ENCODED+78,,AUTO
        13 000441   000564 701000 13                 TSX1    PACK
        13 000442   000000 011000                    NOP     0

     1074     8982
     1075     8983    2       END;

     1076     8984
     1077     8985    1       COUNT = COUNT + LENGTHC(VM_BODYREC_ENCODED) - LENGTHC(VM_BODYREC_ENCODED.VALUE.
              8985                DATA.STUFF);

   8985 13 000443   200007 235100                    LDA     COUNT,,AUTO
        13 000444   000020 035007                    ADLA    16,DL
        13 000445   200007 755100                    STA     COUNT,,AUTO

     1078     8986    1       VM_BODYREC_ENCODED.VALUE.COUNT = COUNT;

PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:190  
   8986 13 000446   200763 755100                    STA     VM_BODYREC_ENCODED+1,,AUTO

     1079     8987
     1080     8988    2       DO I = 0 TO VM_HEADER.NUM_TRACE_RECORDS - 1;

   8988 13 000447   200013 450100                    STZ     I,,AUTO
        13 000450   000507 710000 13                 TRA     s:9005+3

     1081     8989
     1082     8990    2           OLD_BODYREC_ENCODED = '0'B;

   8990 13 000451   000100 100400                    MLR     fill='000'O
        13 000452   000002 000001 14                 ADSC9   2                        cn=0,n=1
        13 000453   201077 000464                    ADSC9   OLD_BODYREC_ENCODED,,AUTO cn=0,n=308

     1083     8991
     1084     8992    2           CALL VMD$GET_TRACE (MESSAGE_NUMBER, DCB_OUT, I, J, , OLD_BODYREC_ENCODED)

   8992 13 000454   201077 630500                    EPPR0   OLD_BODYREC_ENCODED,,AUTO
        13 000455   201227 450500                    STP0    TSIZ+6,,AUTO
        13 000456   000000 236000 14                 LDQ     0
        13 000457   201226 756100                    STQ     TSIZ+5,,AUTO
        13 000460   200014 631500                    EPPR1   J,,AUTO
        13 000461   201225 451500                    STP1    TSIZ+4,,AUTO
        13 000462   200013 633500                    EPPR3   I,,AUTO
        13 000463   201224 453500                    STP3    TSIZ+3,,AUTO
        13 000464   200005 236100                    LDQ     @DCB_OUT,,AUTO
        13 000465   201223 756100                    STQ     TSIZ+2,,AUTO
        13 000466   200011 634500                    EPPR4   MESSAGE_NUMBER,,AUTO
        13 000467   201222 454500                    STP4    TSIZ+1,,AUTO
        13 000470   201222 630500                    EPPR0   TSIZ+1,,AUTO
        13 000471   000004 631400 14                 EPPR1   4
        13 000472   000000 701000 xent               TSX1    VMD$GET_TRACE
        13 000473   000504 702000 13                 TSX2    s:9005

     1085     8993    3           WHENRETURN DO;

PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:191  
     1086     8994
     1087     8995    3               IF VM_BODYREC_ENCODED = OLD_BODYREC_ENCODED

   8995 13 000474   000100 106500                    CMPC    fill='000'O
        13 000475   200762 000464                    ADSC9   VM_BODYREC_ENCODED,,AUTO cn=0,n=308
        13 000476   201077 000464                    ADSC9   OLD_BODYREC_ENCODED,,AUTO cn=0,n=308
        13 000477   000504 601000 13                 TNZ     s:9005

     1088     8996    3               THEN
     1089     8997    3                   IF SAVED_HEADER.STATUS.ANSWER

   8997 13 000500   200727 236100                    LDQ     SAVED_HEADER+10,,AUTO
        13 000501   200000 316003                    CANQ    65536,DU
        13 000502   000556 601000 13                 TNZ     BAILOUT

     1090     8998    3                   THEN /* don't discard reply messsage for ANS */
     1091     8999    3                       GOTO BAILOUT;
     1092     9000    3                   ELSE
     1093     9001    3                       GOTO DONE;

   9001 13 000503   000550 710000 13                 TRA     DONE

     1094     9002
     1095     9003    3           END;
     1096     9004
     1097     9005    2       END;

   9005 13 000504   200013 235100                    LDA     I,,AUTO
        13 000505   000001 035007                    ADLA    1,DL
        13 000506   200013 755100                    STA     I,,AUTO
        13 000507   000000 470400 xsym               LDP0    VM_HEADER$
        13 000510   200013 236100                    LDQ     I,,AUTO
        13 000511   000034 116100                    CMPQ    28,,PR0
        13 000512   000451 602000 13                 TNC     s:8990

     1098     9006
     1099     9007    1       CALL VMD$PUT_TRACE (MESSAGE_NUMBER, DCB_OUT,
PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:192  

   9007 13 000513   200762 631500                    EPPR1   VM_BODYREC_ENCODED,,AUTO
        13 000514   201227 451500                    STP1    TSIZ+6,,AUTO
        13 000515   000000 236000 14                 LDQ     0
        13 000516   201226 756100                    STQ     TSIZ+5,,AUTO
        13 000517   200007 633500                    EPPR3   COUNT,,AUTO
        13 000520   201225 453500                    STP3    TSIZ+4,,AUTO
        13 000521   000000 236000 xsym               LDQ     VM_HEADER$
        13 000522   000034 036003                    ADLQ    28,DU
        13 000523   201224 756100                    STQ     TSIZ+3,,AUTO
        13 000524   200005 236100                    LDQ     @DCB_OUT,,AUTO
        13 000525   201223 756100                    STQ     TSIZ+2,,AUTO
        13 000526   200011 634500                    EPPR4   MESSAGE_NUMBER,,AUTO
        13 000527   201222 454500                    STP4    TSIZ+1,,AUTO
        13 000530   201222 630500                    EPPR0   TSIZ+1,,AUTO
        13 000531   000004 631400 14                 EPPR1   4
        13 000532   000000 701000 xent               TSX1    VMD$PUT_TRACE
        13 000533   000556 702000 13                 TSX2    BAILOUT

     1100     9008    1         VM_HEADER.NUM_TRACE_RECORDS, COUNT, , VM_BODYREC_ENCODED) ALTRET (BAILOUT);
     1101     9009
     1102     9010    1       VM_HEADER.NUM_TRACE_RECORDS = VM_HEADER.NUM_TRACE_RECORDS + 1;

   9010 13 000534   000000 470400 xsym               LDP0    VM_HEADER$
        13 000535   000034 235100                    LDA     28,,PR0
        13 000536   000001 035007                    ADLA    1,DL
        13 000537   000034 755100                    STA     28,,PR0

     1103     9011
     1104     9012    1       CALL VMD$PUT_HEADER (MESSAGE_NUMBER, DCB_OUT) ALTRET (BAILOUT);

   9012 13 000540   200005 236100                    LDQ     @DCB_OUT,,AUTO
        13 000541   201223 756100                    STQ     TSIZ+2,,AUTO
        13 000542   200011 631500                    EPPR1   MESSAGE_NUMBER,,AUTO
        13 000543   201222 451500                    STP1    TSIZ+1,,AUTO
        13 000544   201222 630500                    EPPR0   TSIZ+1,,AUTO
        13 000545   000003 631400 14                 EPPR1   3
PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:193  
        13 000546   000000 701000 xent               TSX1    VMD$PUT_HEADER
        13 000547   000556 702000 13                 TSX2    BAILOUT

   9010 13 000550                       DONE         null
     1105     9013    1   DONE: ;
     1106     9014    2       CALL M$DEQ (DEQ_HEADER) WHENALTRETURN DO; END;

   9014 13 000550   000012 630400 12                 EPPR0   DEQ_HEADER
        13 000551   420003 713400                    CLIMB   alt,+8195
        13 000552   401000 401760                    pmme    nvectors=3
        13 000553   000555 702000 13                 TSX2    s:9016
        13 000554   000555 710000 13                 TRA     s:9016

     1107     9015
     1108     9016    1       RETURN;

   9016 13 000555   000000 702200 xent               TSX2  ! X66_ARET

     1109     9017
     1110     9018    1   BAILOUT:
     1111     9019    2       CALL M$DEQ (DEQ_HEADER) WHENALTRETURN DO; END;

   9019 13 000556   000012 630400 12    BAILOUT      EPPR0   DEQ_HEADER
        13 000557   420003 713400                    CLIMB   alt,+8195
        13 000560   401000 401760                    pmme    nvectors=3
        13 000561   000563 702000 13                 TSX2    s:9021
        13 000562   000563 710000 13                 TRA     s:9021

     1112     9020
     1113     9021    1       ALTRETURN;

   9021 13 000563   000000 702200 xent               TSX2  ! X66_AALT

     1114     9022
     1115     9023        %EJECT;
PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:194  
     1116     9024    1   PACK: PROC (BUFFER, COUNT, T1, T2);

   9024 13 000564   201214 741300       PACK         STX1  ! OLD_BODYREC_ENCODED+77,,AUTO

     1117     9025
     1118     9026    2   DCL BUFFER (0:504) UBIN BYTE CALIGNED;
     1119     9027    2   DCL COUNT UBIN;
     1120     9028    2   DCL 1 T1,
     1121     9029    2         2 COUNT UBIN BYTE CALIGNED,
     1122     9030    2         2 TEXT CHAR (T1.COUNT);
     1123     9031    2   DCL 1 T2,
     1124     9032    2         2 COUNT UBIN BYTE CALIGNED,
     1125     9033    2         2 TEXT CHAR (T1.COUNT);
     1126     9034    2   DCL TSTRING CHAR (TSIZ) BASED;
     1127     9035    2   DCL TSIZ UBIN;
     1128     9036
     1129     9037    2       IF ADDR(T1) = ADDR(NIL) OR T1.COUNT = 0

   9037 13 000565   201217 236100                    LDQ     @T1,,AUTO
        13 000566   000000 116000 14                 CMPQ    0
        13 000567   000577 600000 13                 TZE     s:9039
        13 000570   201217 470500                    LDP0    @T1,,AUTO
        13 000571   000100 101500                    MRL     fill='000'O
        13 000572   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
        13 000573   201222 000004                    ADSC9   TSIZ+1,,AUTO             cn=0,n=4
        13 000574   201222 236100                    LDQ     TSIZ+1,,AUTO
        13 000575   000000 116003                    CMPQ    0,DU
        13 000576   000607 601000 13                 TNZ     s:9043

     1130     9038    3       THEN DO;

     1131     9039    3           BUFFER(0) = 0;

   9039 13 000577   201215 470500                    LDP0    @BUFFER,,AUTO
        13 000600   000100 101400                    MRL     fill='000'O
        13 000601   000002 000004 14                 ADSC9   2                        cn=0,n=4
        13 000602   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:195  

     1132     9040    3           COUNT = 1;

   9040 13 000603   000001 235007                    LDA     1,DL
        13 000604   201216 471500                    LDP1    @COUNT,,AUTO
        13 000605   100000 755100                    STA     0,,PR1

     1133     9041    3       END;

   9041 13 000606   000626 710000 13                 TRA     s:9048

     1134     9042    3       ELSE DO;

     1135     9043    3           TSIZ = T1.COUNT + 1;

   9043 13 000607   000100 101500                    MRL     fill='000'O
        13 000610   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
        13 000611   201222 000004                    ADSC9   TSIZ+1,,AUTO             cn=0,n=4
        13 000612   201222 236100                    LDQ     TSIZ+1,,AUTO
        13 000613   000001 036007                    ADLQ    1,DL
        13 000614   201221 756100                    STQ     TSIZ,,AUTO

     1136     9044    3           ADDR(BUFFER(0)) -> TSTRING = ADDR(T1) -> TSTRING;

   9044 13 000615   000000 620006                    EAX0    0,QL
        13 000616   201215 471500                    LDP1    @BUFFER,,AUTO
        13 000617   201221 722100                    LXL2    TSIZ,,AUTO
        13 000620   040140 100540                    MLR     fill='040'O
        13 000621   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0
        13 000622   100000 000012                    ADSC9   0,,PR1                   cn=0,n=*X2

     1137     9045    3           COUNT = TSIZ;

   9045 13 000623   201216 473500                    LDP3    @COUNT,,AUTO
        13 000624   201221 235100                    LDA     TSIZ,,AUTO
        13 000625   300000 755100                    STA     0,,PR3

PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:196  
     1138     9046    3       END;

     1139     9047
     1140     9048    2       IF ADDR(T2) = ADDR(NIL) OR T2.COUNT = 0

   9048 13 000626   201220 236100                    LDQ     @T2,,AUTO
        13 000627   000000 116000 14                 CMPQ    0
        13 000630   000640 600000 13                 TZE     s:9050
        13 000631   201220 470500                    LDP0    @T2,,AUTO
        13 000632   000100 101500                    MRL     fill='000'O
        13 000633   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
        13 000634   201222 000004                    ADSC9   TSIZ+1,,AUTO             cn=0,n=4
        13 000635   201222 236100                    LDQ     TSIZ+1,,AUTO
        13 000636   000000 116003                    CMPQ    0,DU
        13 000637   000652 601000 13                 TNZ     s:9054

     1141     9049    3       THEN DO;

     1142     9050    3           BUFFER(COUNT) = 0;

   9050 13 000640   201216 470500                    LDP0    @COUNT,,AUTO
        13 000641   000000 235100                    LDA     0,,PR0
        13 000642   201215 471500                    LDP1    @BUFFER,,AUTO
        13 000643   000105 101400                    MRL     fill='000'O
        13 000644   000002 000004 14                 ADSC9   2                        cn=0,n=4
        13 000645   100000 000001                    ADSC9   0,A,PR1                  cn=0,n=1

     1143     9051    3           COUNT = COUNT + 1;

   9051 13 000646   000000 235100                    LDA     0,,PR0
        13 000647   000001 035007                    ADLA    1,DL
        13 000650   000000 755100                    STA     0,,PR0

     1144     9052    3       END;

   9052 13 000651   000673 710000 13                 TRA     s:9059

PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:197  
     1145     9053    3       ELSE DO;

     1146     9054    3           TSIZ = T2.COUNT + 1;

   9054 13 000652   000100 101500                    MRL     fill='000'O
        13 000653   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
        13 000654   201222 000004                    ADSC9   TSIZ+1,,AUTO             cn=0,n=4
        13 000655   201222 236100                    LDQ     TSIZ+1,,AUTO
        13 000656   000001 036007                    ADLQ    1,DL
        13 000657   201221 756100                    STQ     TSIZ,,AUTO

     1147     9055    3           ADDR(BUFFER(COUNT)) -> TSTRING = ADDR(T2) -> TSTRING;

   9055 13 000660   201216 471500                    LDP1    @COUNT,,AUTO
        13 000661   100000 235100                    LDA     0,,PR1
        13 000662   000000 620006                    EAX0    0,QL
        13 000663   201215 473500                    LDP3    @BUFFER,,AUTO
        13 000664   201221 721100                    LXL1    TSIZ,,AUTO
        13 000665   040145 100540                    MLR     fill='040'O
        13 000666   000000 000010                    ADSC9   0,,PR0                   cn=0,n=*X0
        13 000667   300000 000011                    ADSC9   0,A,PR3                  cn=0,n=*X1

     1148     9056    3           COUNT = COUNT + TSIZ;

   9056 13 000670   100000 236100                    LDQ     0,,PR1
        13 000671   201221 036100                    ADLQ    TSIZ,,AUTO
        13 000672   100000 756100                    STQ     0,,PR1

     1149     9057    3       END;

     1150     9058
     1151     9059    2       BUFFER(COUNT) = 0;

   9059 13 000673   201216 470500                    LDP0    @COUNT,,AUTO
        13 000674   000000 235100                    LDA     0,,PR0
        13 000675   201215 471500                    LDP1    @BUFFER,,AUTO
        13 000676   000105 101400                    MRL     fill='000'O
PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:198  
        13 000677   000002 000004 14                 ADSC9   2                        cn=0,n=4
        13 000700   100000 000001                    ADSC9   0,A,PR1                  cn=0,n=1

     1152     9060    2       COUNT = COUNT + 1;

   9060 13 000701   000000 235100                    LDA     0,,PR0
        13 000702   000001 035007                    ADLA    1,DL
        13 000703   000000 755100                    STA     0,,PR0

     1153     9061
     1154     9062    2       RETURN;

   9062 13 000704   201214 221300                    LDX1  ! OLD_BODYREC_ENCODED+77,,AUTO
        13 000705   000001 702211                    TSX2  ! 1,X1

E_ACKED
 Sect OctLoc
  11     000   261715 013070                                                    ...8

E_RRACKED
 Sect OctLoc
  11     001   261715 013110                                                    ...H

E_ANSWERED
 Sect OctLoc
  11     002   261715 013100                                                    ...@

INIT_BODYREC_ENCODED
 Sect OctLoc
  11     003   003000 000000   ****** ******   ****** ******   ****** ******    ................
  11     117*  ****** ******                                                    ....

ENQ_HEADER
 Sect OctLoc
  12     000   000003 777640   000006 006000   000001 177640   000022 006000    ................
  12     004   000000 177640   000000 006014   000000 540000   777777 777777    ................
  12     010   000000 000000   000000 000000                                    ........
PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:199  

DEQ_HEADER
 Sect OctLoc
  12     012   000001 777640   000020 006000   000001 177640   000022 006000    ................
  12     016   000000 177640   000000 006014   000000 400000   000000 000000    ................

VM_HEADRES
 Sect OctLoc
  12     022   004000 000000   000*** ******                                    ........

(unnamed)
 Sect OctLoc
  14     000   000000 006014   000003 000000   000000 000000   000002 000000    ................
  14     004   000006 000000   000002 006000                                    ........
     1155     9063
     1156     9064    2   END PACK;
     1157     9065
     1158     9066    1   END VMM$COMBINE_MESSAGE;

PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:200  
--  Include file information  --

   VM_PERR_C.:VMB6TOU  is referenced.
   VM_MACRO_C.:VMB6TOU  is referenced.
   B_MACROS_C.:LIB_E05  is referenced.
   VM_DATA_R.:VMB6TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:LIB_E05  is referenced.
   CP_6_C.:LIB_E05  is referenced.
   CP_6.:LIB_E05  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure VMM$COMBINE_MESSAGE.
PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:201  

 **** Variables and constants ****

  ****  Section 011 RoData VMM$COMBINE_MESSAGE

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC        r     1 E_ACKED                    2-0-0/w STRC        r     1 E_ANSWERED
     1-0-0/w STRC        r     1 E_RRACKED                  3-0-0/w STRC(2772)  r     1 INIT_BODYREC_ENCODED

  ****  Section 012  Data  VMM$COMBINE_MESSAGE

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    12-0-0/d STRC(288)   r     1 DEQ_HEADER                 0-0-0/d STRC(360)   r     1 ENQ_HEADER
    22-0-0/c STRC(45)    r     1 VM_HEADRES

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

  1215-0-0/w PTR         r     1 @BUFFER                 1216-0-0/w PTR         r     1 @COUNT
     3-0-0/w PTR         r     1 @DCB_IN                    5-0-0/w PTR         r     1 @DCB_OUT
     4-0-0/w PTR         r     1 @MSG_NUMBER_IN          1217-0-0/w PTR         r     1 @T1
  1220-0-0/w PTR         r     1 @T2                      115-0-0/c STRC(4608)  r     1 ANSWER_ID
   515-0-0/c STRC(4608)  r     1 BAD_ADDRESS               *0-0-0/c UBIN(9)     r     1 BUFFER(0:504)
     7-0-0/w UBIN        r     1 COUNT                     *0-0-0/w UBIN        r     1 COUNT
    10-0-0/w UBIN        r     1 COUNT1                    *0-0-0/w UBIN        r     1 DCB_IN
    *0-0-0/w UBIN        r     1 DCB_OUT                   13-0-0/w UBIN        r     1 I
    15-0-0/c CHAR(255)   r     1 ID                        14-0-0/w UBIN        r     1 J
    11-0-0/w UBIN        r     1 MESSAGE_NUMBER            *0-0-0/w UBIN        r     1 MSG_NUMBER_IN
     6-0-0/w UBIN              1 MSG_NUMBER_OUT            12-0-0/w UBIN        r     1 NUM_RECORDS
  1077-0-0/w STRC(2772)  r     1 OLD_BODYREC_ENCODED      715-0-0/w STRC(1332)  r     1 SAVED_HEADER
   315-0-0/c STRC(4608)  r     1 SENDER                    *0-0-0/c ASTR(9)     r     1 T1
    *0-0-0/c ASTR(9)     r     1 T2                      1221-0-0/w UBIN        r     1 TSIZ
PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:202  
   762-0-0/w STRC(2772)  r     1 VM_BODYREC_ENCODED

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR               1 B$JIT$                     0-0-0/w PTR               1 B$TCB$
     0-0-0/c ASTR(9)     r     1 ERRMSG_FID                 0-0-0/w UBIN              1 M$DO_NUM
     0-0-0/w UBIN              1 M$LO_NUM                   0-0-0/w UBIN              1 M$MAIL_CENTRAL_NUM
     0-0-0/w UBIN              1 M$MAIL_COMGROUP_NUM        0-0-0/w UBIN              1 M$MAIL_FILE_NUM
     0-0-0/w UBIN              1 M$MAIL_GLOBAL_NUM          0-0-0/w UBIN              1 M$ME_NUM
     0-0-0/w UBIN              1 M$NODE_NUM                 0-0-0/w UBIN              1 M$SI_NUM
     0-0-0/w UBIN              1 M$WORK_NUM                 0-0-0/w PTR               1 VM_ADDLIST$
     0-0-0/d VECT              1 VM_ADDLIST_                0-0-0/w PTR               1 VM_ADDREC$
     0-0-0/d VECT              1 VM_ADDREC_                 0-0-0/w PTR               1 VM_COPY$
     0-0-0/d VECT              1 VM_COPY_                   0-0-0/w PTR               1 VM_ENCLLIST$
     0-0-0/d VECT              1 VM_ENCLLIST_               0-0-0/w PTR               1 VM_ENCLREC$
     0-0-0/d VECT              1 VM_ENCLREC_                0-0-0/c STRC(270)         1 VM_FORWARD_ENCL_NAME
     0-0-0/c STRC(270)         1 VM_FORWARD_FILE_NAME       0-0-0/c STRC(72)          1 VM_FORWARD_FILE_PASS
     0-0-0/w PTR         r     1 VM_HEADER$                 0-0-0/d VECT              1 VM_HEADER_
     0-0-0/d VECT              1 VM_HEADER_INIT_            0-0-0/w PTR               1 VM_INPUT$
     0-0-0/d VECT              1 VM_INPUT_                  0-0-0/c STRC(72)          1 VM_MAILCG_NAME
     0-0-0/w STRC(432)         1 VM_MAILCG_SETSTA           0-0-0/c STRC(72)          1 VM_MAIL_ACCT
     0-0-0/c STRC(54)          1 VM_NAME_MAP_NAME           0-0-0/w PTR               1 VM_PARSEAREA$
     0-0-0/d VECT              1 VM_PARSEAREA_              0-0-0/w PTR         r     1 VM_PROFILE$
     0-0-0/d VECT              1 VM_PROFILE_                0-0-0/w PTR               1 VM_SELECT$
     0-0-0/d VECT              1 VM_SELECT_                 0-0-0/c STRC(288)         1 VM_SEND_FILE_NAME
     0-0-0/c CHAR(8)           1 VM_SITENAME                0-0-0/w PTR               1 VM_WORK$
     0-0-0/d VECT              1 VM_WORK_

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0N  NULL        r     1 M$DO                       0-0-0N  NULL        r     1 M$LO
PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:203  
     0-0-0N  NULL        r     1 M$MAIL_CENTRAL             0-0-0N  NULL        r     1 M$MAIL_COMGROUP
     0-0-0N  NULL        r     1 M$MAIL_FILE                0-0-0N  NULL        r     1 M$MAIL_GLOBAL
     0-0-0N  NULL        r     1 M$ME                       0-0-0N  NULL        r     1 M$NODE
     0-0-0N  NULL        r     1 M$SI                       0-0-0N  NULL        r     1 M$UC
     0-0-0N  NULL        r     1 M$WORK                     0-0-0/c ACHR        r     1 TSTRING
     0-0-0/w STRC(2772)        1 VM$BODYREC_ENCODED         0-0-0/w STRC(1332)  r     1 VM_HEADER
     0-0-0/w STRC(4068)        1 VM_PROFILE                 0-0-0/c ASTR(9)     r     1 X$STRING


   Procedure VMM$COMBINE_MESSAGE requires 454 words for executable code.
   Procedure VMM$COMBINE_MESSAGE requires 664 words of local(AUTO) storage.

    No errors detected in file VMM$MESSAGE.:VMB6TSI    .
PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:204  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:205  
          MINI XREF LISTING

ADD_IF_UNIQUE
      8915**LABEL    8926--EXIT
ANSWER_ID
      8133**DCL      8868<<ASSIGN   8870<<ASSIGN   8973<>CALL
BAD_ADDRESS
      8139**DCL      8884<<ASSIGN   8981<>CALL
BAD_ADDRESS.COUNT
      8140**DCL      8882<<ASSIGN
BAILOUT
      9019**LABEL    8895--CALLALT  8900--GOTO     8942--CALLALT  8999--GOTO     9007--CALLALT  9012--CALLALT
BUFFER IN PROCEDURE PACK
      9026**DCL      9024--PROC     9039<<ASSIGN   9044--ASSIGN   9050<<ASSIGN   9055--ASSIGN   9059<<ASSIGN
COUNT
      8126**DCL      8912<>CALL     8931<>CALL     8957<>CALL     8965<>CALL     8973<>CALL     8981<>CALL
      8985<<ASSIGN   8985>>ASSIGN   8986>>ASSIGN   9007<>CALL
COUNT IN PROCEDURE PACK
      9027**DCL      9024--PROC     9040<<ASSIGN   9045<<ASSIGN   9050>>ASSIGN   9051<<ASSIGN   9051>>ASSIGN
      9055>>ASSIGN   9056<<ASSIGN   9056>>ASSIGN   9059>>ASSIGN   9060<<ASSIGN   9060>>ASSIGN
COUNT1
      8127**DCL      8921<>CALL
DCB_IN
        27**DCL         7--PROC     8912<>CALL
DCB_OUT
        29**DCL         7--PROC     8858<>CALL     8887>>ASSIGN   8888>>ASSIGN   8895<>CALL     8921<>CALL
      8931<>CALL     8942<>CALL     8992<>CALL     9007<>CALL     9012<>CALL
DEQ_HEADER
      8318**DCL      8944<>CALL     9014<>CALL     9019<>CALL
DEQ_HEADER.V
      8319**DCL      8318--DCLINIT
DEQ_HEADER.V.DCB#
      8319**DCL      8888<<ASSIGN
DONE
PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:206  
      9010**LABEL    9001--GOTO
DONE_DELIVERY
      8942**LABEL    8912--CALLALT
ENQ_HEADER
      8298**DCL      8890<>CALL
ENQ_HEADER.V
      8299**DCL      8298--DCLINIT
ENQ_HEADER.V.DCB#
      8299**DCL      8887<<ASSIGN
ERRMSG_FID.L#
      6407**DCL      6407--IMP-SIZ
E_ACKED
      8156**DCL      8964>>ASSIGN
E_ANSWERED
      8250**DCL      8972>>ASSIGN
E_RRACKED
      8203**DCL      8956>>ASSIGN
I
      8130**DCL      8908<<DOINDEX  8912<>CALL     8988<<DOINDEX  8992<>CALL
ID
      8132**DCL      8872<<ASSIGN   8897>>IF
INIT_BODYREC_ENCODED
      8820**DCL      8949>>ASSIGN
J
      8131**DCL      8917<<DOINDEX  8921<>CALL     8992<>CALL
M$DEQ
      5586**DCL-ENT  8944--CALL     9014--CALL     9019--CALL
M$ENQ
      5585**DCL-ENT  8890--CALL
M$ERR
      5531**DCL-ENT  8892--CALL
MESSAGE_NUMBER
      8128**DCL      8858<>CALL     8886>>ASSIGN   8895<>CALL     8921<>CALL     8931<>CALL     8942<>CALL
      8992<>CALL     9007<>CALL     9012<>CALL
MSG_NUMBER_IN
        28**DCL         7--PROC
PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:207  
NUM_RECORDS
      8129**DCL      8906<<ASSIGN   8917>>DOINDEX
OLD_BODYREC_ENCODED
      8754**DCL      8919<<ASSIGN   8921<>CALL     8924>>IF       8990<<ASSIGN   8992<>CALL     8995>>IF
PACK
      9024**PROC     8957--CALL     8965--CALL     8973--CALL     8981--CALL
SAVED_HEADER
      8593**DCL      8864<<ASSIGN
SAVED_HEADER.CREATION_DATE
      8596**DCL      8951>>ASSIGN
SAVED_HEADER.ERROR
      8666**DCL      8902>>IF       8980>>ASSIGN
SAVED_HEADER.NUM_RECORDS
      8604**DCL      8908>>DOINDEX
SAVED_HEADER.STATUS.ACK
      8612**DCL      8961>>IF
SAVED_HEADER.STATUS.ANSWER
      8610**DCL      8969>>IF       8997>>IF
SAVED_HEADER.STATUS.DELIVERY
      8642**DCL      8902>>IF
SAVED_HEADER.STATUS.ERR
      8607**DCL      8902>>IF       8977>>IF
SAVED_HEADER.STATUS.RRACK
      8654**DCL      8953>>IF
SENDER
      8136**DCL      8878<<ASSIGN   8957<>CALL     8965<>CALL     8973<>CALL
SENDER.COUNT
      8137**DCL      8876<<ASSIGN
T1 IN PROCEDURE PACK
      9028**DCL      9024--PROC     9037--IF       9044--ASSIGN
T1.COUNT IN PROCEDURE PACK
      9029**DCL      9030--IMP-SIZ  9033--IMP-SIZ  9037>>IF       9043>>ASSIGN
T2 IN PROCEDURE PACK
      9031**DCL      9024--PROC     9048--IF       9055--ASSIGN
T2.COUNT IN PROCEDURE PACK
      9032**DCL      9048>>IF       9054>>ASSIGN
PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:208  
TSIZ IN PROCEDURE PACK
      9035**DCL      9034--IMP-SIZ  9043<<ASSIGN   9044>>ASSIGN   9044>>ASSIGN   9045>>ASSIGN   9054<<ASSIGN
      9055>>ASSIGN   9055>>ASSIGN   9056>>ASSIGN
TSTRING IN PROCEDURE PACK
      9034**DCL      9044<<ASSIGN   9044>>ASSIGN   9055<<ASSIGN   9055>>ASSIGN
VMD$GET_BODY
      8845**DCL-ENT  8912--CALL
VMD$GET_HEADER
      8843**DCL-ENT  8895--CALL
VMD$GET_ID
      8848**DCL-ENT  8858--CALL
VMD$GET_TRACE
      8846**DCL-ENT  8921--CALL     8992--CALL
VMD$PUT_HEADER
      8844**DCL-ENT  8942--CALL     9012--CALL
VMD$PUT_TRACE
      8847**DCL-ENT  8931--CALL     9007--CALL
VM_BODYREC_ENCODED
      8722**DCL      8910<<ASSIGN   8912<>CALL     8924>>IF       8931<>CALL     8949<<ASSIGN   8985--ASSIGN
      8995>>IF       9007<>CALL
VM_BODYREC_ENCODED.VALUE.COUNT
      8728**DCL      8986<<ASSIGN
VM_BODYREC_ENCODED.VALUE.DATA.ERR
      8732**DCL      8956<<ASSIGN   8964<<ASSIGN   8972<<ASSIGN   8980<<ASSIGN
VM_BODYREC_ENCODED.VALUE.DATA.STUFF
      8734**DCL      8950<<ASSIGN   8957<>CALL     8965<>CALL     8973<>CALL     8981<>CALL     8985--ASSIGN
VM_BODYREC_ENCODED.VALUE.DATA.UTS
      8733**DCL      8951<<ASSIGN
VM_HEADER
      8464**DCL      8864>>ASSIGN
VM_HEADER.BAD_ADDRESS$
      8548**DCL      8880>>IF       8884>>ASSIGN   8884>>ASSIGN
VM_HEADER.FROM$
      8556**DCL      8874>>IF       8878>>ASSIGN   8878>>ASSIGN
VM_HEADER.NUM_TRACE_RECORDS
      8574**DCL      8906>>ASSIGN   8931<>CALL     8934<<ASSIGN   8934>>ASSIGN   8988>>DOINDEX  9007<>CALL
PL6.E3A0      #004=VMM$COMBINE_MESSAGE File=VMM$MESSAGE.:VMB6TSI                 WED 08/20/97 15:18 Page:209  
      9010<<ASSIGN   9010>>ASSIGN
VM_HEADER.REFERS_TO_ID$
      8572**DCL      8851>>IF       8858>>CALL     8858>>CALL     8872>>ASSIGN   8872>>ASSIGN
VM_HEADER.STATUS.ACK
      8483**DCL      8851>>IF
VM_HEADER.STATUS.ANSWER
      8481**DCL      8851>>IF
VM_HEADER.STATUS.DELIVERY
      8513**DCL      8851>>IF
VM_HEADER.STATUS.ERR
      8478**DCL      8851>>IF
VM_HEADER.STATUS.RRACK
      8525**DCL      8851>>IF
VM_HEADER.UNIQUE_ID$
      8570**DCL      8866>>IF       8870>>ASSIGN   8870>>ASSIGN   8897>>IF       8897>>IF       8897>>IF
VM_HEADER$
      6257**DCL      8464--IMP-PTR  8851>>IF       8851>>IF       8851>>IF       8851>>IF       8851>>IF
      8851>>IF       8858>>CALL     8858>>CALL     8864>>ASSIGN   8866>>IF       8870>>ASSIGN   8870>>ASSIGN
      8872>>ASSIGN   8872>>ASSIGN   8874>>IF       8878>>ASSIGN   8878>>ASSIGN   8880>>IF       8884>>ASSIGN
      8884>>ASSIGN   8897>>IF       8897>>IF       8897>>IF       8906>>ASSIGN   8931>>CALL     8934>>ASSIGN
      8934>>ASSIGN   8988>>DOINDEX  9007>>CALL     9010>>ASSIGN   9010>>ASSIGN
VM_HEADRES
      8335**DCL      8298--DCLINIT  8318--DCLINIT
VM_HEADRES.RES#
      8337**DCL      8886<<ASSIGN
VM_PROFILE$
      6259**DCL      8377--IMP-PTR
X$STRING
      6252**DCL      8858<>CALL     8870>>ASSIGN   8878>>ASSIGN   8884>>ASSIGN
X$STRING.SIZ
      6253**DCL      6254--IMP-SIZ  8858>>CALL     8870>>ASSIGN   8872>>ASSIGN   8878>>ASSIGN   8884>>ASSIGN
      8897>>IF
X$STRING.TEXT
      6254**DCL      8872>>ASSIGN   8897>>IF
