VERSION E05

PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:1    
        1        1        /*M* KIF$FPRG - Handle M$SETFP PMME */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* PLM=3,IND=5,ENU=0,ECU=0,CRM=70   */
        8        8
        9        9
       10       10        KIF$FPRG: PROC (DOLIST$) ALTRET;
       11       11
       12       12
       13       13        %INCLUDE CP_6;
       14       94        %INCLUDE F$DCB;
       15      143        %INCLUDE B$JIT;
       16      433        %INCLUDE B$OBJECT_C;
       17     3863        %INCLUDE B_MAGIC_C;
       18     3981        %INCLUDE B_STRINGS_C;
       19     4110        %INCLUDE B$USER;
       20     4326        %INCLUDE B$SS;
       21     4505        %INCLUDE NK$LDCT;
       22     4607        %INCLUDE FM$SET;
       23     4634        %INCLUDE CP_6_SUBS;
       24     5174        %INCLUDE NK_SUBS;
       25     5199        %INCLUDE FM$GRAN;
       26     5268        %INCLUDE FM$FIT;
       27     5489        %INCLUDE NK_LDCT_R;
       28     5498        %INCLUDE HF_LOCK_C;
       29     5512        %INCLUDE GJ_MSG_M;
       30     5825        %INCLUDE F_FPTCODE_C;
       31     5861        %INCLUDE KL_SUPER_C;
       32     8763        %INCLUDE KV_PRMID_E;
       33     8937        %KV_PRMID_E;
       34     9093
       35     9094        %FM$GRAN;
       36     9098        %CODE04;
       37     9106        %NK$LDCT (STCLASS="BASED(LDCT$)");
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:2    
       38     9152        %FM$SET;
       39     9157        %B$HEAD (NAME=B$HEAD,STCLASS="BASED(BF$)");
       40     9357        %RU_FLAVORS;
       41     9363        %VLP_FPRG (FPTN=VLP$FPRG,STCLASS=BASED);
       42     9384        %GJ_LDTRC_MSG(FPTN=LDTRCMSG,STCLASS="BASED(BF2$)");
       43     9435        %GJ_SETFP_MSG (FPTN=SETMSG,STCLASS="BASED(BF2$)");
       44     9599        %GJ_PROFILE_MSG (FPTN=PROMSG,STCLASS="BASED(BF2$)");
       45     9639    1   DCL CHAR$1 CHAR(1) BASED;
       46     9640        %GJ_FCN#;
       47     9666
       48     9667
       49     9668        %FPT_READ (FPTN=KIF_FPT_READ,STCLASS="CONSTANT SYMDEF",KEYS=YES);
       50     9707        %VLP_NAME (FPTN=KIF_HDKEY,STCLASS="CONSTANT SYMDEF",NAME='HEAD',LEN=7);
       51     9734
       52     9735        %SUB_EXC;
       53     9782        %SUB MONBIT#='000000400000'O;
       54     9783        %SUB KIF#='131106'O;                    /* FCG-MID FOR KIF          */
       55     9784        %SUB KI# ='1311'O;
       56     9785        %SUB F#  ='06'O;
       57     9786
       58     9787
       59     9788        /* Local variables */
       60     9789    1   DCL CG BIT(1);
       61     9790    1   DCL DEBUG BIT(1);
       62     9791    1   DCL CONTDSC BIT(1) ALIGNED;
       63     9792    1   DCL SYSFLAG BIT(1) ALIGNED;
       64     9793    1   DCL LDTRC BIT(1) ALIGNED;               /* Set if this is KIF$LDTRC */
       65     9794    1   DCL DONE BIT(1) ALIGNED;
       66     9795    1   DCL DID_SETFP BIT(1);
       67     9796    1   DCL OPNDEV BIT(1);
       68     9797    1   DCL DOLIST$ PTR;
       69     9798    1   DCL CCBUFL SBIN;
       70     9799    1   DCL DCB$ PTR;
       71     9800    1   DCL MEDDCB$ PTR;
       72     9801    1   DCL STARDCB$ PTR;
       73     9802    1   DCL LMDCB$ PTR;
       74     9803    1   DCL LMDCB# UBIN;
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:3    
       75     9804    1   DCL LDCT$ PTR;
       76     9805    1   DCL LDCT$U REDEF LDCT$ UBIN WORD;
       77     9806    1   DCL CG$ PTR;
       78     9807    1   DCL TEMP SBIN WORD;
       79     9808    1   DCL TEMPB REDEF TEMP BIT(36);
       80     9809    1   DCL TEMPA(0:1) REDEF TEMP UBIN HALF UNAL;
       81     9810    1   DCL SAVE_ACCT CHAR(8);
       82     9811    1   DCL WRITE_BYSZ SBIN;
       83     9812    1   DCL TOTAL_BYSZ SBIN;
       84     9813    1   DCL RECORD_BYSZ SBIN;
       85     9814    1   DCL N_READS SBIN;
       86     9815    1   DCL DUSER UBIN BYTE;
       87     9816    1   DCL TPTR$ PTR;
       88     9817    1   DCL 1 MYERR ALIGNED,
       89     9818    1         2 FCGM BIT(18),
       90     9819    1         2 M BIT(1),
       91     9820    1         2 CODE UBIN(14) UNAL,
       92     9821    1         2 SEV UBIN(3) UNAL;
       93     9822    1   DCL BF$ PTR;
       94     9823    1   DCL BF2$ PTR;
       95     9824    1   DCL STATION CHAR(8);
       96     9825
       97     9826        %VLP_FPRG (FPTN=VLP_FPRG,STCLASS=AUTO);
       98     9847        %GJ_FCN_MSG(FPTN=FCNMSG,STCLASS=AUTO);
       99     9872        %GJ_PROGKEY_MSG (STCLASS=AUTO);
      100     9927        %FPT_GETDCB (STCLASS=AUTO);
      101     9942        %FPT_READ (FPTN=FPT_READ,STCLASS=AUTO);
      102     9981        %B$FEP_RUKEY (NAME=ADKEY,STCLASS=AUTO);
      103    10005        %B$FPRG (NAME=FPRGEV,STCLASS=AUTO,PARONLY=1);
      104    10034        %VLP_FPRG (FPTN=CCBUF_FPRG, STCLASS=AUTO, LAST=NO);
      105    10055        %VLR_MODTIME (FPTN=MODTIME, LVL=2,STCLASS=AUTO);
      106    10073
      107    10074        /* Symrefs */
      108    10075        %B_MPT (FPTN=B_MPT,STCLASS=SYMREF);
      109    10168    1   DCL F$CFU$ PTR SYMREF READONLY;
      110    10169    1   DCL B$PS1$ PTR SYMREF READONLY;
      111    10170    1   DCL B$PS2$ PTR SYMREF READONLY;
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:4    
      112    10171    1   DCL B$PS3$ PTR SYMREF READONLY;
      113    10172    1   DCL B$JIT$ PTR SYMREF READONLY;
      114    10173    1   DCL B$USRT$ PTR SYMREF READONLY;
      115    10174    1   DCL B$ROSEG$ PTR SYMREF READONLY;
      116    10175    1   DCL B$M$LM$ PTR SYMREF READONLY;
      117    10176    1   DCL B$M$STAR$ PTR SYMREF READONLY;
      118    10177    1   DCL S$CU$ PTR SYMREF;
      119    10178    1   DCL S_CUN UBIN SYMREF;
      120    10179
      121    10180        /* Entry references */
      122    10181    1   DCL KCD$CDSCTRM ENTRY(1);
      123    10182    1   DCL KCI$CKSTAT ENTRY(3) ALTRET;
      124    10183    1   DCL KIA$UCIOND ENTRY(7) ALTRET;
      125    10184    1   DCL KIF$FPRGEVNT ENTRY(3);
      126    10185    1   DCL KIF$READ ENTRY(3) ALTRET;
      127    10186    1   DCL KIF$WRITE ENTRY(3) ALTRET;
      128    10187    1   DCL KIF$SEND ENTRY(3) ALTRET;
      129    10188    1   DCL FMP$CLSJ ENTRY;
      130    10189    1   DCL FMM$SCRUB ENTRY(1);
      131    10190    1   DCL FMM$DFLOPN ENTRY;
      132    10191    1   DCL FMM$DFLOPNP ENTRY;
      133    10192    1   DCL HFF$DSIZ ENTRY(2);
      134    10193    1   DCL HFF$NILERASE ENTRY(1) ALTRET;
      135    10194    1   DCL FMF$TYC ENTRY(2);
      136    10195    1   DCL FMD$GBUF ENTRY(1);
      137    10196    1   DCL FMD$RBUF ENTRY(1);
      138    10197    1   DCL FSA$GSP ENTRY(2) ALTRET;
      139    10198    1   DCL M$MFID ENTRY(1) ALTRET;
      140    10199    1   DCL M$MREAD ENTRY(1) ALTRET;
      141    10200    1   DCL M$MGETDCB ENTRY(1) ALTRET;
      142    10201    1   DCL FMM$RELDCBI ENTRY;
      143    10202    1   DCL KIA$8TO9 ENTRY(3);
      144    10203    1   DCL KIA$9TO8 ENTRY(3);
      145    10204    1   DCL KIA$UCIO ENTRY(6) ALTRET;
      146    10205    1   DCL UMT$IDT2 ENTRY(3) ALTRET;
      147    10206    1   DCL SSS$UTS_L6 ENTRY(2) ALTRET;
      148    10207    1   DCL EMR$FEP2HOST ENTRY(2);
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:5    
      149    10208    1   DCL EMR$HOST2FEP ENTRY(2);
      150    10209    1   DCL SSV$EVENT ENTRY(7);
      151    10210    1   DCL SC_FPRG ENTRY CONV(2,0);            /* SNAP                     */
      152    10211
      153    10212
      154    10213        %INCLUDE UD_SEV_C;
      155    10227        %INCLUDE B_ERRORS_C;
      156    11354
      157    11355    1   DCL 1 NOTFP CONSTANT ALIGNED,
      158    11356    1         2 FCG BIT(18) UNAL INIT(KIF#),
      159    11357    1         2 ERR UBIN(15) UNAL INIT(%E$NOTFP),
      160    11358    1         2 SEV UBIN(3) UNAL INIT(SEV_ERROR#);
      161    11359    1   DCL 1 REST CONSTANT ALIGNED,
      162    11360    1         2 FCG BIT(18) UNAL INIT(KIF#),
      163    11361    1         2 ERR UBIN(15) UNAL INIT(%E$RESTRICTED),
      164    11362    1         2 SEV UBIN(3) UNAL INIT(SEV_ERROR#);
      165    11363    1   DCL 1 NOSHRLIB CONSTANT ALIGNED,
      166    11364    1         2 FCG BIT(18) UNAL INIT(KIF#),
      167    11365    1         2 ERR UBIN(15) UNAL INIT(%E$NOSHRLIB),
      168    11366    1         2 SEV UBIN(3) UNAL INIT(SEV_ERROR#);
      169    11367    1   DCL 1 NPFPRG CONSTANT ALIGNED,
      170    11368    1         2 FCG BIT(18) UNAL INIT(KIF#),
      171    11369    1         2 ERR UBIN(15) UNAL INIT(%E$NPFPRG),
      172    11370    1         2 SEV UBIN(3) UNAL INIT(SEV_ERROR#);
      173    11371    1   DCL 1 FPFID CONSTANT ALIGNED,
      174    11372    1         2 FCG BIT(18) UNAL INIT(KIF#),
      175    11373    1         2 ERR UBIN(15) UNAL INIT(%E$FPFID),
      176    11374    1         2 SEV UBIN(3) UNAL INIT(SEV_ERROR#);
      177    11375    1   DCL 1 LIBSIZE CONSTANT ALIGNED,
      178    11376    1         2 FCG BIT(18) UNAL INIT(KIF#),
      179    11377    1         2 ERR UBIN(15) UNAL INIT(%E$LIBSIZE),
      180    11378    1         2 SEV UBIN(3) UNAL INIT(SEV_ERROR#);
      181    11379    1   DCL 1 KIF_BADHEAD CONSTANT SYMDEF ALIGNED,
      182    11380    1         2 FCG BIT(18) UNAL INIT(KIF#),
      183    11381    1         2 ERR UBIN(15) UNAL INIT(%E$BADHEAD),
      184    11382    1         2 SEV UBIN(3) UNAL INIT(SEV_ERROR#);
      185    11383    1   DCL 1 FPDBSY CONSTANT ALIGNED,
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:6    
      186    11384    1         2 FCG BIT(18) UNAL INIT(KIF#),
      187    11385    1         2 ERR UBIN(15) UNAL INIT(%E$FPDBSY),
      188    11386    1         2 SEV UBIN(3) UNAL INIT(SEV_ERROR#);
      189    11387    1   DCL 1 KIF_NONFP CONSTANT SYMDEF ALIGNED,
      190    11388    1         2 FCG BIT(18) UNAL INIT(KIF#),
      191    11389    1         2 ERR UBIN(15) UNAL INIT(%E$NONFP),
      192    11390    1         2 SEV UBIN(3) UNAL INIT(SEV_ERROR#);
      193    11391    1   DCL 1 NFPRQ CONSTANT ALIGNED,
      194    11392    1         2 FCG BIT(18) UNAL INIT(KIF#),
      195    11393    1         2 ERR UBIN(15) UNAL INIT(%E$NFPRQ),
      196    11394    1         2 SEV UBIN(3) UNAL INIT(SEV_ERROR#);
      197    11395    1   DCL 1 NFPRM CONSTANT ALIGNED,
      198    11396    1         2 FCG BIT(18) UNAL INIT(KIF#),
      199    11397    1         2 ERR UBIN(15) UNAL INIT(%E$NFPRM),
      200    11398    1         2 SEV UBIN(3) UNAL INIT(SEV_ERROR#);
      201    11399    1   DCL 1 NOTIMP CONSTANT ALIGNED,
      202    11400    1         2 FCG BIT(18) UNAL INIT(KIF#),
      203    11401    1         2 ERR UBIN(15) UNAL INIT(%E$NOTIMPLEMENTED),
      204    11402    1         2 SEV UBIN(3) UNAL INIT(SEV_ERROR#);
      205    11403    1   DCL 1 CCGT256 CONSTANT ALIGNED,
      206    11404    1         2 FCG BIT(18) UNAL INIT(KIF#),
      207    11405    1         2 ERR UBIN(15) UNAL INIT(%E$CCGT256),
      208    11406    1         2 SEV UBIN(3) UNAL INIT(SEV_ERROR#);
      209    11407    1   DCL 1 KIF_UNEXPT CONSTANT SYMDEF ALIGNED,
      210    11408    1         2 FCG BIT(18) UNAL INIT(KIF#),
      211    11409    1         2 ERR UBIN(15) UNAL INIT(%E$IOERR),
      212    11410    1         2 SEV UBIN(3) UNAL INIT(SEV_ERROR#);
      213    11411
      214    11412        %EJECT;
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:7    
      215    11413        /* The KIF$FPRG entry is called from UDA$PMMENT for M$SETFP.
      216    11414        */
      217    11415    1      VLP_FPRG=B$PS2$->VLP$FPRG;
      218    11416    1      CALL HFF$NILERASE(B$PS3$)
      219    11417    2      WHENRETURN DO;
      220    11418    2           CALL HFF$DSIZ(B$PS3$,CCBUFL);
      221    11419    2           IF CCBUFL > 256
      222    11420    3           THEN DO;
      223    11421    3                B$JIT.ERR=CCGT256;
      224    11422    3                RETURN;
      225    11423    3                END;
      226    11424    2           END;
      227    11425        /*E*  ERROR: KIF-E$CCGT256-E
      228    11426            MESSAGE: M$SETFP specified a CCBUF greater than 256 characters
      229    11427        */
      230    11428    2      WHENALTRETURN DO;
      231    11429    2           CCBUFL=0;
      232    11430    2           END;
      233    11431    1      OPNDEV = '0'B;
      234    11432    1      GOTO SETUP1;
      235    11433
      236    11434        /* The KIF$FPRGR entry is called from FSN$OPNDEV with a possible
      237    11435           VLP_FPRG at offset F$DCB.FPRGX in the read-only segment.
      238    11436        */
      239    11437    1   KIF$FPRGR: ENTRY ALTRET;
      240    11438
      241    11439    1      IF B$JIT.DCB$->F$DCB.FPRGX=0 THEN RETURN;
      242    11440    1      VLP_FPRG=PINCRW(B$ROSEG$,B$JIT.DCB$->F$DCB.FPRGX)->VLP$FPRG;
      243    11441    1      CCBUFL=0;
      244    11442    1      OPNDEV = '1'B;
      245    11443
      246    11444        %EJECT;
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:8    
      247    11445    1   SETUP1: ;
      248    11446    1      CALL SETUP;
      249    11447    1      LDTRC='0'B;
      250    11448    1      DCB$=B$JIT.DCB$;
      251    11449
      252    11450    1      IF DCB$->F$DCB.FCD='0'B
      253    11451    1        OR (DCB$->F$DCB.ASN~=%COMGROUP#
      254    11452    1        AND (DCB$->F$DCB.ORG~=%FPRG# AND DCB$->F$DCB.ORG~=%HANDLER#))
      255    11453    2      THEN DO;
      256    11454    2           B$JIT.ERR=NOTFP;
      257    11455    2           RETURN;
      258    11456    2           END;
      259    11457        /*E*  ERROR:    KIF-E$NOTFP-E
      260    11458               MESSAGE: M$SETFP is illegal on that DCB% (%DC)%
      261    11459              MESSAGE1: The M$SETFP service is only available on ORG=FPRG or
      262    11460                        ORG=HANDLER, ASN=DEVICE DCBs and COMGROUP DCBs. Either
      263    11461                        your DCB% (%DC)% is not so assigned, or it is not open.
      264    11462              DESCRIPTION:  FCD, ASN, AND ORG are checked.
      265    11463        */
      266    11464
      267    11465    1      IF DCB$->F$DCB.FCN
      268    11466    2      THEN DO;
      269    11467    2           B$JIT.ERR=FPDBSY;
      270    11468    2           RETURN;
      271    11469    2           END;
      272    11470        /*E*  ERROR:    KIF-E$FPDBSY-E
      273    11471               MESSAGE: Attempt to use M$SETFP on a busy DCB% (%DC)%.
      274    11472              MESSAGE1: M$SETFP may not be issued on a DCB% ,like %DC,% which
      275    11473                        has no-wait I/O in progress.
      276    11474              DESCRIPTION:  This is a good time to catch a DCB with a pending
      277    11475                            read which would cause no end of trouble later.
      278    11476        */
      279    11477
      280    11478    1      IF DCB$->F$DCB.ASN = %COMGROUP#
      281    11479    2      THEN DO;
      282    11480    2           CG = '1'B;                 /* Accessing a comgroup station  */
      283    11481    2           CALL KCI$CKSTAT(TPTR$,CG$,STATION) ALTRET(RTN);
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:9    
      284    11482    2           LDCT$ = TPTR$;
      285    11483    2           END;
      286    11484    2      ELSE DO;
      287    11485    2           CG = '0'B;
      288    11486    2           IF DCB$->F$DCB.IASN = %STREAM#
      289    11487    2           THEN MEDDCB$ = DCB$->F$DCB.CFU$; /* Pointer to stream dcb   */
      290    11488    2           ELSE MEDDCB$ = DCB$;
      291    11489    2           LDCT$=NK$LDCT$(MEDDCB$->F$DCB.LDCTX);
      292    11490    2           END;
      293    11491
      294    11492           %LOCK (G=LDCT$->LDCT.LOCK);
      295    11495    1      IF NOT LDCT$->LDCT.LKFLG.FPSTEP
      296    11496    2      THEN DO;
      297    11497                %UNLOCK (G=LDCT$->LDCT.LOCK);
      298    11500    2   NFP:    ;
      299    11501    2           B$JIT.ERR=NFPRQ;
      300    11502    2           RETURN;
      301    11503    2           END;
      302    11504        /*E*  ERROR:    KIF-E$NFPRQ-E
      303    11505               MESSAGE: That destination doesn't need a form!
      304    11506              MESSAGE1: The M$SETFP service may only be performed on a destination
      305    11507                        which has a forms program at job step.
      306    11508              DESCRIPTION: ~LDCT.LKFLG.FPSTEP
      307    11509        */
      308    11510
      309    11511    1      LDCT$->LDCT.LKFLG.FPPM = '1'B;
      310    11512    1      IF LDCT$->LDCT.LKFLG.ABORTED
      311    11513    2      THEN DO;         /* Send a rundown message to front-end job step */
      312    11514    2           LDCT$->LDCT.LKFLG.ABORTED='0'B;
      313    11515                %UNLOCK (G=LDCT$->LDCT.LOCK);
      314    11518    2           FCNMSG='0'B;
      315    11519    2           FCNMSG.FCN=%GJ_RUND#;
      316    11520    2           CALL KIF$WRITE(LDCT,FCNMSG,LENGTHC(FCNMSG)) ALTRET(JITERR);
      317    11521    2           END;
      318    11522    2      ELSE DO;
      319    11523                %UNLOCK (G=LDCT$->LDCT.LOCK);
      320    11526    2           END;
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:10   
      321    11527
      322    11528    1      GOTO CMN;
      323    11529        %EJECT;
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:11   
      324    11530
      325    11531
      326    11532        /* The KIF$LDTRC entry is used by SSQ$QEND and SSR$RUE.
      327    11533        */
      328    11534    1   KIF$LDTRC: ENTRY(DOLIST$) ALTRET;
      329    11535
      330    11536    1      CALL SETUP;
      331    11537    1      CCBUFL=0;
      332    11538    1      OPNDEV = '0'B;
      333    11539    1      LDTRC='1'B;
      334    11540    1      LDCT$U=DOLIST$->B$DO.EVID;           /* Get LDCT$                */
      335    11541
      336    11542    1      IF LDCT$->LDCT.RESCOD=NK_CGFPRG
      337    11543    2      THEN DO;
      338    11544    2           CG='1'B;
      339    11545    2           END;
      340    11546    2      ELSE DO;
      341    11547    2           CG='0'B;
      342    11548    2           MEDDCB$=DCBADDR(LDCT$->NK$LDCT.DCBNO);
      343    11549    2           END;
      344    11550
      345    11551    1      GOTO CMN;
      346    11552        %EJECT;
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:12   
      347    11553    1   CMN: ;
      348    11554
      349    11555        /* Get a buffer to be used for the head record and the setmsg */
      350    11556    1      CALL FMD$GBUF (TPTR$);
      351    11557    1      BF$ = TPTR$;
      352    11558    1      DID_SETFP = '0'B;
      353    11559    1      BF2$ = PINCRW(BF$,512);
      354    11560
      355    11561    1      IF NOT CG
      356    11562    1      THEN IF MEDDCB$->F$DCB.FPRGX=0
      357    11563    2           THEN DO;                   /* Get roseg space for VLP_FPRG  */
      358    11564    2                CALL FSA$GSP(SIZEW(VLP$FPRG),TPTR$)
      359    11565    3                WHENALTRETURN DO;
      360    11566    3                     B$JIT.ERR.FCG=KI#;
      361    11567    3                     B$JIT.ERR.MID=F#;
      362    11568    3   JITERR:           MYERR=B$JIT.ERR;
      363    11569    3                     GOTO XIT;
      364    11570    3                     END;
      365    11571    2                MEDDCB$->F$DCB.FPRGX=POFFW(TPTR$,B$ROSEG$);
      366    11572    2                END;
      367    11573    1      LDCT$->LDCT.USER=S_CUN;
      368    11574
      369    11575        /* We must get a DCB for the rununit */
      370    11576    1      FPT_GETDCB.V_ = VECTOR(FPT_GETDCB.V);
      371    11577    1      FPT_GETDCB.V = '0'B;
      372    11578    1      FPT_GETDCB.DCBNAME_ = VECTOR(NIL);
      373    11579    1      FPT_GETDCB.DCBNUM_ = VECTOR(LMDCB#);
      374    11580    1      CALL M$MGETDCB (FPT_GETDCB) ALTRET(JITERR);
      375    11581    1      LMDCB$ = DCBADDR(LMDCB#);
      376    11582    1      B$JIT.DCB$=LMDCB$;
      377    11583    1      CALL FMM$SCRUB(B$JIT.DCB$);
      378    11584    1      LMDCB$->F$DCB.DCB# = LMDCB#;
      379    11585
      380    11586
      381    11587        /* Get LDTRC info if this is a FEP-issued M$LDTRC                            */
      382    11588    1      IF LDTRC
      383    11589    2      THEN DO;
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:13   
      384    11590    2           CALL KIF$READ(LDCT,LDTRCMSG,LENGTHC(LDTRCMSG)) ALTRET(JITERR);
      385    11591    2           VLP_FPRG='0'B;
      386    11592    2           VLP_FPRG.NAME=LDTRCMSG.NAME;
      387    11593    2           VLP_FPRG.ACCT#=LDTRCMSG.ACCT;
      388    11594    2           VLP_FPRG.PASS#=LDTRCMSG.PASS;
      389    11595    2           VLP_FPRG.PSN#=LDTRCMSG.PSN;
      390    11596    2           END;
      391    11597
      392    11598        /* Get profile name from the FEP if this is LOAD BY PRO.    */
      393    11599    2      ELSE DO;
      394    11600    2           IF VLP_FPRG.LDBYPRO#~=0 AND LDTRC='0'B
      395    11601    2           THEN CALL GETPROFPRG ALTRET(XIT);
      396    11602    2           END;
      397    11603
      398    11604        /* Now fill in SETMSG */
      399    11605    1   FILL_SETFP_MSG:
      400    11606    1      SETMSG='0'B;
      401    11607    1      SETMSG.FCN=%GJ_SETFP#;
      402    11608    1      SETMSG.NAME = VLP_FPRG.NAME;
      403    11609    1      SETMSG.PASS = VLP_FPRG.PASS#;
      404    11610    1      SETMSG.PSN = VLP_FPRG.PSN#;
      405    11611    1      SETMSG.ACCT = VLP_FPRG.ACCT#;
      406    11612    1      SYSFLAG=(SETMSG.ACCT=':SYS');        /* System rununit           */
      407    11613        %EJECT;
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:14   
      408    11614        /* Now open the rununit file */
      409    11615    1      LMDCB$->F$DCB.NAME.L=SETMSG.NAME.L;
      410    11616    1      LMDCB$->F$DCB.NAME.C=SETMSG.NAME.TEXT;
      411    11617    1      LMDCB$->F$DCB.ACCT=SETMSG.ACCT;
      412    11618    1      LMDCB$->F$DCB.PASS =SETMSG.PASS;
      413    11619    1      LMDCB$->F$DCB.PSN=SETMSG.PSN;
      414    11620    1      LMDCB$->F$DCB.ASN=%FILE#;
      415    11621    1      LMDCB$->F$DCB.FUN=%IN#;
      416    11622    1      LMDCB$->F$DCB.ACS=%DIRECT#;
      417    11623
      418    11624        /* Change to the logon account so we can get the access controls right */
      419    11625    1      SAVE_ACCT = B$JIT.ACCN;
      420    11626    1      IF LDCT$->LDCT.LOGON_ACCT ~= ' '
      421    11627    1      THEN B$JIT.ACCN = LDCT$->LDCT.LOGON_ACCT;
      422    11628    1      LMDCB$->F$DCB.WSR=0;                 /* Pretend that we are STEP */
      423    11629    1   ONE_MORE_TIME:;
      424    11630    1      B$JIT.ERR='0'B;
      425    11631    1      CALL FMM$DFLOPN;
      426    11632
      427    11633        /* If STEP couldn't run it, see if the running program has better luck.
      428    11634        */
      429    11635    1      IF B$JIT.ERR~='0'B AND LMDCB$->F$DCB.WSR=0
      430    11636    2      THEN DO;
      431    11637    2           LMDCB$->F$DCB.WSR=B_MPT.SS$->B$SS.ISR.WSR;
      432    11638    2           GOTO ONE_MORE_TIME;
      433    11639    2           END;
      434    11640
      435    11641        /* Restore the JIT.ACCN */
      436    11642    1      B$JIT.ACCN = SAVE_ACCT;
      437    11643
      438    11644    1      IF B$JIT.ERR~='0'B
      439    11645    2      THEN DO;
      440    11646    2           MYERR=B$JIT.ERR;
      441    11647    2           MYERR.FCGM=KIF#;
      442    11648    2           GOTO XIT;
      443    11649    2           END;
      444    11650
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:15   
      445    11651        /*E*  ERROR:    KIF-E$FILEBUSY-E
      446    11652              MESSAGE:  Can't access FEP program - file is busy
      447    11653        */
      448    11654        /*E*  ERROR:    KIF-E$NOFILE-E
      449    11655              MESSAGE:  That FEP program does not exist.
      450    11656        */
      451    11657        /*E*  ERROR:    KIF-E$NOACCESS-E
      452    11658              MESSAGE:  You don't have access to that FEP program.
      453    11659        */
      454    11660    1      TEMP = LMDCB$->F$DCB.EXPIRE;
      455    11661    1      CALL SSS$UTS_L6(TEMP,TEMP);
      456    11662    1      CALL KIA$9TO8(TEMP, SETMSG.MODTIME, 4);
      457    11663
      458    11664    1      SETMSG.ACCT=LMDCB$->F$DCB.ACCT;
      459    11665    1      SETMSG.PSN=F$CFU$->FM$SET.PSN(LMDCB$->F$DCB.SETX);
      460    11666    1      SETMSG.FLAGS.XEQ_ONLY=LMDCB$->F$DCB.FFLG.EXEC;
      461    11667
      462    11668    1      IF (SETMSG.FLAGS.XEQ_ONLY='0'B) AND (LDTRC='0'B)
      463    11669    1        AND (B_MPT.SS$->B$SS.ISR.WSR = %USERWSR)
      464    11670    2      THEN DO;
      465    11671    2           IF CG='1'B
      466    11672    2           THEN IF VLP_FPRG.FLGS.DEBUG#='1'B
      467    11673    2                THEN SETMSG.FLAGS.DEBUG = '1'B;
      468    11674    2                ELSE ;
      469    11675    2           ELSE IF (S$CU$->B$U.FLG & %U_DELA)
      470    11676    2                THEN SETMSG.FLAGS.DEBUG = '1'B;
      471    11677    2                ELSE ;
      472    11678    2           END;
      473    11679    1      DEBUG = SETMSG.FLAGS.DEBUG;
      474    11680
      475    11681        /* Read the FPRG Head Record.
      476    11682        */
      477    11683    1      FPT_READ=KIF_FPT_READ;
      478    11684    1      FPT_READ.V_=VECTOR(FPT_READ.V);
      479    11685    1      FPT_READ.BUF_.BOUND=4095;
      480    11686    1      FPT_READ.V.DCB# = LMDCB#;
      481    11687    1      FPT_READ.BUF_.BUF$=BF$;
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:16   
      482    11688    1      FPT_READ.KEY_=VECTOR(KIF_HDKEY);
      483    11689    1      CALL M$MREAD (FPT_READ) ALTRET(BAD_HEAD);
      484    11690
      485    11691    1      IF LMDCB$->F$DCB.ARS ~= LENGTHC(B$HEAD)
      486    11692    2      THEN DO;
      487    11693    2   BAD_HEAD: ;
      488    11694    2           MYERR=KIF_BADHEAD;
      489    11695    2           GOTO XIT;
      490    11696    2           END;
      491    11697        /*E* ERROR: KIF-%E$BADHEAD-E
      492    11698             MESSAGE: The head record does not exist or is not the proper size.
      493    11699        */
      494    11700
      495    11701        /* Make sure the rununit is the proper flavor */
      496    11702    1      IF B$HEAD.FLAVOR~=%FEP_RU
      497    11703    2      THEN DO;
      498    11704    2           MYERR=KIF_NONFP;
      499    11705    2           GOTO XIT;
      500    11706    2           END;
      501    11707        /*E*  ERROR:    KIF-E$NONFP-E
      502    11708              MESSAGE:  That is no FEP program!
      503    11709              MESSAGE1: The file described on an M$SETFP service must be a FEP run unit.
      504    11710        */
      505    11711
      506    11712        /* Check if the lock matches */
      507    11713    1      IF B$HEAD.RESTPROC
      508    11714    1      THEN IF (B$HEAD.STRONG_LOCK
      509    11715    1             AND ((B$HEAD.LOCK&B$JIT.LOCK)~=B$HEAD.LOCK))
      510    11716    1             OR NOT (B$HEAD.LOCK & B$JIT.LOCK)
      511    11717    2           THEN DO;
      512    11718    2                MYERR=REST;
      513    11719    2                GOTO XIT;
      514    11720    2                END;
      515    11721        /*E* ERROR: KIF-%E$RESTRICTED-E
      516    11722             MESSAGE: The FEP run unit is restricted.
      517    11723             DESCRIPTION: The locks do not match for the rununit and the user.
      518    11724         */
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:17   
      519    11725
      520    11726        /* If this is an M$LDTRC to a uFPL run-unit, bypass sending run-unit
      521    11727           info to the fep and jump into the logic to switch to TPFP.:SYS
      522    11728        */
      523    11729    1      IF LDTRC AND LDTRCMSG.F1
      524    11730    1      THEN GOTO ITS_MICROFPL;
      525    11731
      526    11732        /* Fill HEAD record info into SETMSG and write SETMSG to the FEP
      527    11733        */
      528    11734    1      SETMSG.LIB_NAME = B$HEAD.LIBNAME;
      529    11735    1      SETMSG.PSEUDO_TEXT = B$HEAD.PSEUDO_TEXT;
      530    11736    1      SETMSG.PSEUDO_COUNT = B$HEAD.PSEUDO_COUNT;
      531    11737    1      SETMSG.VERSION = B$HEAD.VERSION#;
      532    11738    1      IF SYSFLAG
      533    11739    2      THEN DO;
      534    11740    2           SETMSG.PRIV = (B$HEAD.PRIV & %PR_LCP6#);
      535    11741    2           IF (B$HEAD.PRIV & %PR_EXPM#)
      536    11742    2           THEN SETMSG.PRIV = (SETMSG.PRIV | %PR_FEXPM#);
      537    11743    2           IF (B$HEAD.PRIV & %PR_GPP#)
      538    11744    2           THEN SETMSG.PRIV = (SETMSG.PRIV | %PR_FGPP#);
      539    11745    2           SETMSG.FLAGS.PROCACC = B$HEAD.PROCACC;
      540    11746    2           SETMSG.FLAGS.PROCSURCHG=B$HEAD.PROCSURCHG;
      541    11747    2           SETMSG.FLAGS.NOCHRPMEM = B$HEAD.NOCHGPMEM;
      542    11748    2           END;
      543    11749    1      SETMSG.FLAGS.S = B$HEAD.S;
      544    11750    1      SETMSG.FLAGS.LIB = B$HEAD.LIB;
      545    11751    1      SETMSG.FLAGS.CMDPROC=B$HEAD.CMDPROC;
      546    11752    1      SETMSG.FLAGS.DEBUGGER=B$HEAD.DEBUGGER;
      547    11753    1      SETMSG.FLAGS.LAUTO=B$HEAD.LAUTO;
      548    11754    1      IF CCBUFL ~= 0
      549    11755    1      THEN SETMSG.FLAGS.CCBUF = '1'B;
      550    11756    1      CALL KIA$9TO8(B$HEAD.UDCBNUM,SETMSG.UDCBNUM,2);
      551    11757    1      CALL KIA$9TO8(B$HEAD.DCBRES,SETMSG.DCBRES,2);
      552    11758    1      CALL KIA$9TO8(B$HEAD.TCBSIZE,SETMSG.TCBSIZE,2);
      553    11759    1      TEMP=B$HEAD.START;
      554    11760    1      CALL KIA$9TO8(TEMP,SETMSG.START,4);
      555    11761    1      TEMP=B$HEAD.VPPGS;
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:18   
      556    11762    1      CALL KIA$9TO8(TEMPA(1),SETMSG.VPPGS,2);
      557    11763    1      TEMP=B$HEAD.VDPGS;
      558    11764    1      CALL KIA$9TO8(TEMPA(1),SETMSG.VDPGS,2);
      559    11765    1      TEMP=B$HEAD.ROSIZE;
      560    11766    1      CALL KIA$9TO8(TEMPA(1),SETMSG.ROS_SZ,2);
      561    11767    1      TEMP=B$HEAD.RDATA;
      562    11768    1      CALL KIA$9TO8(TEMP,SETMSG.DATA_SZ,4);
      563    11769    1      TEMP=B$HEAD.RPROC;
      564    11770    1      CALL KIA$9TO8(TEMP,SETMSG.PROC_SZ,4);
      565    11771    1      TEMP=B$HEAD.BIAS;
      566    11772    1      CALL KIA$9TO8(TEMP,SETMSG.DATA_BIAS,4);
      567    11773    1      DID_SETFP = '1'B;
      568    11774
      569    11775    1      CALL KIF$WRITE(LDCT,SETMSG,LENGTHC(SETMSG))
      570    11776    2      WHENALTRETURN DO;
      571    11777    2           MYERR = B$JIT.ERR;
      572    11778    2           GOTO XIT;
      573    11779    2           END;
      574    11780
      575    11781        /*E*  ERROR:    KIF-E$LDSC-E
      576    11782              MESSAGE:  M$SETFP aborted - station disconnected
      577    11783              DESCRIPTION: The station the FPRG was being attached to
      578    11784                           disconnected during the PMME                              */
      579    11785        /*E*  ERROR:    KIF-E$DACTR-E
      580    11786              MESSAGE:  M$SETFP aborted - you are deactivated
      581    11787              DESCRIPTION: The AU deactivated him during the pmme or he
      582    11788                           was already deactivated when he did it.                   */
      583    11789        /*E*  ERROR:    KIF-E$CGKEYV-E
      584    11790              MESSAGE:  M$SETFP aborted - station not defined
      585    11791              DESCRIPTION: XSTALGL = 0 and this station isn't defined.
      586    11792                           See VLP_CGSTAL.                                           */
      587    11793        /*E*  ERROR:    KIF-E$CGFULL-E
      588    11794              MESSAGE:  M$SETFP aborted - comgroup queue full
      589    11795              DESCRIPTION: Comgroup is out of space                                  */
      590    11796        /*E*  ERROR:    KIF-E$CGCRCW-E
      591    11797              MESSAGE:  M$SETFP aborted - latch violation
      592    11798              DESCRIPTION: An attempt to read without completing the
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:19   
      593    11799                           the continued Latched write.                              */
      594    11800        /*E* ERROR: KIF-E$BYDR-E
      595    11801             MESSAGE: M$SETFP interrupted by asynchronous event.
      596    11802             DESCRIPTION: A comgroup read was interrupted by break or ctl Y.         */
      597    11803        %EJECT;
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:20   
      598    11804        /* Sit here continually reading the front end for a message
      599    11805             and respond to it */
      600    11806
      601    11807    1      DONE='0'B;
      602    11808    2      DO WHILE (NOT DONE);
      603    11809    2           CALL KIF$READ(LDCT,GJ_PROGKEY_MSG,LENGTHC(GJ_PROGKEY_MSG)) ALTRET(JITERR);
      604    11810    3           DO CASE (GJ_PROGKEY_MSG.FCN);
      605    11811    3            CASE (%GJ_GETPROG#);           /* Get record from rununit  */
      606    11812
      607    11813    3              FPT_READ.V.DCB#=LMDCB#;
      608    11814    3              FPT_READ.KEY_ = VECTOR(ADKEY);
      609    11815    3              ADKEY = '0'B;
      610    11816    3              ADKEY.KEYSIZ = GJ_PROGKEY_MSG.RU_KEY.KEYSIZ;
      611    11817    3              ADKEY.TYPE = GJ_PROGKEY_MSG.RU_KEY.TYPE;
      612    11818    3              CALL KIA$8TO9(GJ_PROGKEY_MSG.RU_KEY.PAGE,TEMP,4);
      613    11819    3              ADKEY.PAGE=TEMP;
      614    11820    3              CALL KIA$8TO9(GJ_PROGKEY_MSG.READ_BYSZ,WRITE_BYSZ,4);
      615    11821    3              CALL KIA$8TO9(GJ_PROGKEY_MSG.SECT_BYSZ,TOTAL_BYSZ,4);
      616    11822    3              N_READS = (TOTAL_BYSZ +4096 -1) / 4096;
      617    11823
      618    11824    4              DO TEMP = 1 TO N_READS;
      619    11825    4                   CALL M$MREAD (FPT_READ)
      620    11826    5                   WHENALTRETURN DO;
      621    11827    5                        MYERR = B$JIT.ERR;
      622    11828    5                        END;
      623    11829    4                   BF2$ = BF$;
      624    11830    4                   RECORD_BYSZ = MINIMUM(TOTAL_BYSZ,4096);
      625    11831    4                   TOTAL_BYSZ = TOTAL_BYSZ - RECORD_BYSZ;
      626    11832
      627    11833    5                   DO WHILE RECORD_BYSZ > 0;
      628    11834    5                        IF WRITE_BYSZ > RECORD_BYSZ THEN WRITE_BYSZ = RECORD_BYSZ;
      629    11835    5                        CALL KIF$WRITE(LDCT,BF2$->CHAR$1,WRITE_BYSZ)
      630    11836    6                        WHENALTRETURN DO;
      631    11837    6                             MYERR = B$JIT.ERR;
      632    11838    6                             END;
      633    11839
      634    11840    5                        BF2$ = PINCRW(BF2$,WRITE_BYSZ/4);
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:21   
      635    11841    5                        RECORD_BYSZ = RECORD_BYSZ - WRITE_BYSZ;
      636    11842    5                        END;
      637    11843    4                   ADKEY.PAGE = ADKEY.PAGE + 2048;
      638    11844    4                   END;
      639    11845
      640    11846    3            CASE (%GJ_LIB_DATA#);          /* Get library data         */
      641    11847    3              CALL KIF$SEND(LDCT,SETMSG.LIB_NAME,%GJ_LIB_DATA#)
      642    11848    4              WHENALTRETURN DO;
      643    11849    4                   MYERR = B$JIT.ERR;
      644    11850    4                   GOTO XIT;
      645    11851    4                   END;
      646    11852
      647    11853    3            CASE (%GJ_MICROFPL#);          /* Switch to TPFP.:SYS      */
      648    11854    3   ITS_MICROFPL:
      649    11855    3              CCBUF_FPRG = VLP_FPRG;
      650    11856    3              CALL UMT$IDT2(LMDCB$->F$DCB.EXPIRE,
      651    11857    3                CCBUF_FPRG.MODTIME.DATE,
      652    11858    3                CCBUF_FPRG.MODTIME.TIME);
      653    11859
      654    11860    3              B$JIT.DCB$=LMDCB$;
      655    11861    3              CALL FMP$CLSJ;
      656    11862    3              B$JIT.DCBNO = LMDCB$->F$DCB.DCB#;
      657    11863    3              CALL FMM$SCRUB(B$JIT.DCB$);
      658    11864    3              LMDCB$->F$DCB.DCB# = LMDCB#;
      659    11865
      660    11866    3              VLP_FPRG = '0'B;
      661    11867    3              VLP_FPRG.NAME.L# = 4;
      662    11868    3              VLP_FPRG.NAME.C# = 'TPFP';
      663    11869    3              VLP_FPRG.ACCT# = ':SYS    ';
      664    11870    3              VLP_FPRG.PASS# = '        ';
      665    11871    3              VLP_FPRG.PSN#  = '      ';
      666    11872
      667    11873    3              CCBUFL= -1;
      668    11874    3              GOTO FILL_SETFP_MSG;
      669    11875
      670    11876    3            CASE (%GJ_GETCCBUF#);          /* Get the CCBUF contents   */
      671    11877    3              IF CCBUFL < 0
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:22   
      672    11878    4              THEN DO;
      673    11879    4                   CCBUFL = SIZEC(CCBUF_FPRG);
      674    11880    4                   CALL KIF$WRITE(LDCT,CCBUF_FPRG,CCBUFL);
      675    11881    4                   END;
      676    11882    3              ELSE CALL KIF$WRITE(LDCT,B$PS3$->CHAR$1,CCBUFL) ALTRET(JITERR);
      677    11883
      678    11884    3            CASE (%GJ_NAK#,%GJ_PROG_ABRT#);
      679    11885    3              TEMPB = GJ_PROGKEY_MSG.ERR;
      680    11886    3              CALL EMR$FEP2HOST (TEMPB,MYERR);
      681    11887    3              GOTO XIT;
      682    11888
      683    11889    3            CASE (%GJ_GETDONE#);           /* Fetch complete           */
      684    11890    3              IF MYERR ~= '0'B
      685    11891    3              THEN GOTO XIT;
      686    11892
      687    11893    3              CALL KIF$WRITE(LDCT,GJ_PROGKEY_MSG,LENGTHC(FCNMSG));
      688    11894
      689    11895                   %LOCK (G=LDCT$->LDCT.LOCK);
      690    11898    3              LDCT$->LDCT.LKFLG.FPSTEP='0'B;
      691    11899    3              LDCT$->LDCT.LKFLG.FPPM='0'B;
      692    11900    3              IF LDCT$->LDCT.RESCOD = NK_CGFPRG
      693    11901    3              THEN LDCT$->LDCT.LKFLG.OBLK='1'B;
      694    11902        /* Only for a comgroup is it possible that data is already available for
      695    11903           this newly started FPRG, so setting OBLK may be right in that case.
      696    11904           If it's wrong, the comgroup code will fix it up.  If it is set for a
      697    11905           non-comgroup FPRG, a read with NODAT from the FPRG will get the wrong
      698    11906           answer.  So, we only arbitrarily set it now for comgroups. */
      699    11907    3              LDCT$->LDCT.LKFLG.ABORTED='0'B;
      700    11908    3              IF CG AND LDCT$->LDCT.DFLG.OLDSC
      701    11909    3              THEN CONTDSC='1'B;
      702    11910    3              ELSE CONTDSC='0'B;
      703    11911                   %UNLOCK (G=LDCT$->LDCT.LOCK);
      704    11914
      705    11915        /* Now that we've cleaned up the LDCT, turn this DONE
      706    11916           around so that the FPRG may run.
      707    11917        */
      708    11918    3              DONE='1'B;
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:23   
      709    11919
      710    11920
      711    11921    3            CASE (ELSE);                   /* Should never happen      */
      712    11922    3              CALL SC_FPRG;
      713    11923    3              MYERR=KIF_UNEXPT;
      714    11924    3              GOTO XIT;
      715    11925
      716    11926    3              END;                         /* End cases                */
      717    11927    2           END;                            /* End do while(not done)*/
      718    11928
      719    11929        /*S* SCREECH_CODE: KIF-S$FPRG
      720    11930             TYPE:         SNAP
      721    11931             MESSAGE:      Unexpected condition in loading FPRG
      722    11932        */
      723    11933
      724    11934        /*E*   ERROR: KIF-E$IOERR-E
      725    11935             MESSAGE: Unexpected condition encountered in loading FPRG
      726    11936        */
      727    11937        %EJECT;
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:24   
      728    11938    2      DO WHILE('0'B);
      729    11939    2   XIT:    ;
      730    11940                %LOCK (G=LDCT$->LDCT.LOCK);
      731    11943    2           LDCT$->LDCT.LKFLG.FPPM='0'B;
      732    11944    2           IF CG AND LDCT$->LDCT.DFLG.OLDSC
      733    11945    2           THEN CONTDSC='1'B;
      734    11946    2           ELSE CONTDSC='0'B;
      735    11947                %UNLOCK (G=LDCT$->LDCT.LOCK);
      736    11950    2           END;
      737    11951
      738    11952    1      IF BF$ ~= ADDR(NIL)
      739    11953    2      THEN DO;
      740    11954    2           TPTR$ = BF$;
      741    11955    2           CALL FMD$RBUF(TPTR$);
      742    11956    2           END;
      743    11957
      744    11958    1      IF B$M$STAR$->F$DCB.FCD
      745    11959    2      THEN DO;
      746    11960    2           B$JIT.DCB$=B$M$STAR$;
      747    11961    2           CALL FMP$CLSJ;
      748    11962    2           END;
      749    11963
      750    11964    1      IF (CG OR MYERR) AND LMDCB$~=ADDR(NIL)
      751    11965    2      THEN DO;
      752    11966    2           B$JIT.DCB$=LMDCB$;
      753    11967    2           CALL FMP$CLSJ;
      754    11968    2           B$JIT.DCBNO = LMDCB$->F$DCB.DCB#;
      755    11969    2           CALL FMM$RELDCBI;
      756    11970    2           END;
      757    11971
      758    11972    1      IF MYERR
      759    11973    2      THEN DO;
      760    11974    2           MYERR = (MYERR | MONBIT#);
      761    11975    2           IF LDCT$->LDCT.DFLG.OLDSC THEN EXIT;
      762    11976    2           IF DID_SETFP OR LDTRC OR OPNDEV
      763    11977    3           THEN DO;
      764    11978    3                FCNMSG='0'B;
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:25   
      765    11979    3                FCNMSG.FCN=%GJ_NAK#;
      766    11980    3                CALL EMR$HOST2FEP(TEMPB,MYERR);
      767    11981    3                FCNMSG.ERR=TEMPB;          /* For alignment purposes   */
      768    11982    3                CALL KIF$WRITE(LDCT,FCNMSG,LENGTHC(FCNMSG)); /* Can't do anything */
      769    11983    3                END;
      770    11984                                                /* about an ALTRET here.    */
      771    11985    2           END;
      772    11986
      773    11987    1      ELSE IF NOT CG
      774    11988    2           THEN DO;
      775    11989    2                B$JIT.DCB$=MEDDCB$->F$DCB.CFU$;
      776    11990    2                MEDDCB$->F$DCB.CFU$=LMDCB$;
      777    11991    2                PINCRW(B$ROSEG$,MEDDCB$->F$DCB.FPRGX)->VLP$FPRG=VLP_FPRG;
      778    11992    2                IF B$JIT.DCB$~=ADDR(NIL)
      779    11993    3                THEN DO;
      780    11994    3                     CALL FMP$CLSJ;
      781    11995    3                     B$JIT.DCBNO = B$JIT.DCB$->F$DCB.DCB#;
      782    11996    3                     CALL FMM$RELDCBI;
      783    11997    3                     END;
      784    11998    2                IF LDTRC='0'B AND DEBUG='1'B AND CG='0'B
      785    11999    2                  AND B_MPT.SS$->B$SS.ISR.WSR~=%DBWSR
      786    12000    3                THEN DO; /* Event DELTA telling it about this new FPRG */
      787    12001    3                     FPRGEV='0'B;
      788    12002    3                     FPRGEV.P#=SIZEW(FPRGEV)-SIZEW(FPRGEV.FPRG)-SIZEW(FPRGEV.P#);
      789    12003    3                     FPRGEV.SUBC2=%SUBC2_AFD#;
      790    12004    3                     FPRGEV.DCBNO=LDCT$->LDCT.UDCBNO;
      791    12005    3                     DUSER=S_CUN;
      792    12006    3                     CALL SSV$EVENT(DUSER,%DBWSR,%SUBC_FPRG#,0,0,ADDR(FPRGEV));
      793    12007    3                     END;
      794    12008    2                END;
      795    12009
      796    12010    1      IF CONTDSC
      797    12011    1      THEN CALL KCD$CDSCTRM(LDCT$->LDCT);
      798    12012
      799    12013    1      B$JIT.ERR=MYERR;
      800    12014    1      B$JIT.DCB$=DCB$;
      801    12015    1   RTN: ;
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:26   
      802    12016    1      IF LDTRC
      803    12017    2      THEN DO;
      804    12018    2           IF NOT MYERR
      805    12019    2           THEN CALL KIF$FPRGEVNT(LDCT$->LDCT,%GJ_PROG_LDTRC#,VLP_FPRG);
      806    12020    2           ALTRETURN;
      807    12021    2           END;
      808    12022    1      ELSE RETURN;
      809    12023        %EJECT;
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:27   
      810    12024        /*I*    NAME: SETUP
      811    12025                PUROPOSE: Common setup routine for all entry points.
      812    12026        */
      813    12027
      814    12028    1   SETUP: PROC;
      815    12029
      816    12030    2      MYERR='0'B;
      817    12031    2      BF$=ADDR(NIL);
      818    12032    2      LMDCB$=ADDR(NIL);
      819    12033    2      MEDDCB$=ADDR(NIL);
      820    12034    2      DCB$=ADDR(NIL);
      821    12035    2      RETURN;
      822    12036    2   END SETUP;
      823    12037        %EJECT;
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:28   
      824    12038
      825    12039        /*I* NAME:        GETPROFPRG
      826    12040             PURPOSE:     To get the device's PROFILE's default FPRG
      827    12041             DESCRIPTION: The device's PROFILE record is obtained from which
      828    12042                          the default FPRG info is obtained and copied into
      829    12043                          VLP_FPRG. If any problems occur such as no default
      830    12044                          FPRG specified, this procedure will ALTRETURN.             */
      831    12045
      832    12046    1   GETPROFPRG: PROC  ALTRET;
      833    12047
      834    12048        %VLP_LINEATTR (FPTN=VLP_LINEATTR,STCLASS="BASED(BF$)");
      835    12070        %KL_PHDR (NAME=PHDR,STCLASS="BASED(BF$)");
      836    12111        %FPT_FID (FPTN=FPT_FIDC,STCLASS=CONSTANT);
      837    12134        %FPT_FID (FPTN=FPT_FID,STCLASS="BASED(BF2$)");
      838    12157        %VLP_SN (FPTN=VLP_SN,STCLASS=AUTO);
      839    12170    2   DCL ASN UBIN BYTE;
      840    12171    2   DCL DUMMY UBIN;
      841    12172    2   DCL DLDCT$ PTR;
      842    12173
      843    12174        /*N*  IF CG
      844    12175              THEN DLDCT$=LDCT$->LDCT.CLNK$;
      845    12176    2   ELSE */ DLDCT$=LDCT$;
      846    12177    2      PROMSG = '0'B;
      847    12178    2      PROMSG.FCN = %GJ_PROFILE#;
      848    12179    2      CALL KIF$WRITE(LDCT,PROMSG,LENGTHC(FCNMSG)) ALTRET(PROFILE_ERR);
      849    12180
      850    12181    2      CALL KIF$READ(LDCT,PROMSG,LENGTHC(PROMSG))
      851    12182    3      WHENALTRETURN DO;
      852    12183    3   PROFILE_ERR: ;
      853    12184    3           MYERR=B$JIT.ERR;
      854    12185    3           ALTRETURN;
      855    12186    3           END;
      856    12187
      857    12188    2      STARDCB$ = B$M$STAR$;
      858    12189    2      B$JIT.DCB$ = STARDCB$;
      859    12190    2      CALL FMM$SCRUB(B$JIT.DCB$);
      860    12191    2      STARDCB$->F$DCB.NAME.L=4;
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:29   
      861    12192    2      STARDCB$->F$DCB.NAME.C=':PRO';
      862    12193    2      STARDCB$->F$DCB.ACCT=':SYS';
      863    12194    2      STARDCB$->F$DCB.ASN=%FILE#;
      864    12195    2      STARDCB$->F$DCB.FUN=%IN#;
      865    12196    2      STARDCB$->F$DCB.ACS=%DIRECT#;
      866    12197    2      STARDCB$->F$DCB.SHARE = %ALL#;
      867    12198    2      B$JIT.ERR='0'B;
      868    12199    2      CALL FMM$DFLOPNP;
      869    12200
      870    12201    2      IF B$JIT.ERR~='0'B
      871    12202    3      THEN DO;
      872    12203    3   SNAP:   CALL SC_FPRG;
      873    12204    3           MYERR=KIF_UNEXPT;
      874    12205    3           ALTRETURN;
      875    12206    3           END;
      876    12207
      877    12208    2      VLP_FPRG.PROFILE# = PROMSG.PROFILE;
      878    12209    2      FPT_READ=KIF_FPT_READ;
      879    12210    2      FPT_READ.V_=VECTOR(FPT_READ.V);
      880    12211    2      FPT_READ.BUF_=VECTOR(PHDR);
      881    12212    2      FPT_READ.V.DCB#=%M$STAR#;
      882    12213    2      FPT_READ.KEY_=VECTOR(PROMSG.PROFILE);
      883    12214    2      CALL M$MREAD(FPT_READ)
      884    12215    3      WHENALTRETURN DO;
      885    12216    3           IF B$JIT.ERR.CODE~=%E$LD THEN GOTO SNAP;
      886    12217    3           END;
      887    12218
      888    12219    2      IF PHDR.GR_FPRG = ' '
      889    12220    3      THEN DO;
      890    12221    3           MYERR=NPFPRG;
      891    12222    3           ALTRETURN;
      892    12223    3           END;
      893    12224        /*E* ERROR:    KIF-E$NPFPRG-E
      894    12225             MESSAGE:  That PROFILE has no default FPRG specified
      895    12226             MESSAGE1: On a load-by-profile type of M$SETFP, the PROFILE
      896    12227                       record currently in use by your device must
      897    12228                       specify an FPRG FID. Yours did not.
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:30   
      898    12229        */
      899    12230
      900    12231    2      FPT_FID=FPT_FIDC;
      901    12232    2      FPT_FID.V_=VECTOR(FPT_FID.V);
      902    12233    2      FPT_FID.TEXTFID_=VECTOR(PHDR.GR_FPRG);
      903    12234    2      FPT_FID.NAME_=VECTOR(VLP_FPRG.NAME);
      904    12235    2      FPT_FID.ACCT_=VECTOR(VLP_FPRG.ACCT#);
      905    12236    2      FPT_FID.PASS_=VECTOR(VLP_FPRG.PASS#);
      906    12237    2      FPT_FID.SN_=VECTOR(VLP_SN);
      907    12238    2      FPT_FID.ASN_=VECTOR(ASN);
      908    12239    2      FPT_FID.RES_=VECTOR(DUMMY);
      909    12240    2      CALL M$MFID(FPT_FID)
      910    12241    3      WHENALTRETURN DO;
      911    12242    3   FPFIDE: MYERR=FPFID;
      912    12243    3           ALTRETURN;
      913    12244    3           END;
      914    12245        /*E* ERROR:    KIF-E$FPFID-E
      915    12246             MESSAGE:  That PROFILE-specified FPRG is not a valid fid
      916    12247             MESSAGE1: For a load-by-profile type of M$SETFP, the FPRG
      917    12248                       FID found in the PROFILE record must be for a
      918    12249                       disk file and be an otherwise valid FID. Yours
      919    12250                       did not pass.
      920    12251        */
      921    12252
      922    12253    2      IF VLP_SN.NUM#>1 OR ASN~=%FILE# THEN GOTO FPFIDE;
      923    12254    2      IF VLP_SN.NUM#=1
      924    12255    2      THEN VLP_FPRG.PSN#=VLP_SN.SN#(0);
      925    12256    2      ELSE VLP_FPRG.PSN#=' ';
      926    12257    2      B$JIT.DCB$ = LMDCB$;       /*restore for normal SETFP processing */
      927    12258    2      RETURN;
      928    12259    2   END GETPROFPRG;
      929    12260    1   END KIF$FPRG;
      930    12261        %EOD;

PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:31   
--  Include file information  --

   B_ERRORS_C.:E05TOU  is referenced.
   UD_SEV_C.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  is referenced.
   KL_SUPER_C.:E05TOU  is referenced.
   F_FPTCODE_C.:E05TOU  is referenced.
   GJ_MSG_M.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   FM$FIT.:E05TOU  is referenced.
   FM$GRAN.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   FM$SET.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   B$SS.:E05TOU  cannot be made into a system file and is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   B_MAGIC_C.:E05TOU  is referenced.
   B$OBJECT_C.:E05TOU  is referenced.
   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure KIF$FPRG.

   Procedure KIF$FPRG requires 1519 words for executable code.
   Procedure KIF$FPRG requires 144 words of local(AUTO) storage.

PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:32   

 Object Unit name= KIF$FPRG                                   File name= KIF$FPRG.:E05TOU
 UTS= JUL 30 '97 00:32:01.64 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1  RoData even  UTS     65    101  KIF$FPRG
    2   Proc  even  none  1519   2757  KIF$FPRG
    3  RoData even  none    48     60  KIF$FPRG

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     2      0   yes    yes     yes      Std        1  KIF$FPRG
     2     35          yes     yes      Std        0  KIF$FPRGR
     2    245          yes     yes      Std        1  KIF$LDTRC

  ****  Data defs  ****

 Sect OctLoc  Name                           Sect OctLoc  Name
    1      0  KIF_FPT_READ                       1     16  KIF_HDKEY
    1     26  KIF_BADHEAD                        1     30  KIF_NONFP
    1     35  KIF_UNEXPT
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:33   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 HFF$NILERASE
 yes     yes           Std       3 KCI$CKSTAT
         yes           Std       1 HFC$UNLOCK
 yes     yes           Std       3 KIF$READ
         yes           Std       2 HFF$DSIZ
 yes     yes           Std       3 KIF$SEND
         yes           Std       1 HFC$LOCK
 yes     yes           Std       3 KIF$WRITE
 yes     yes           Std       2 FSA$GSP
 yes     yes           Std       2 SSS$UTS_L6
         yes           Std       3 KIF$FPRGEVNT
         yes           Std       1 KCD$CDSCTRM
 yes     yes           Std       1 M$MGETDCB
         yes           Std       1 FMM$SCRUB
         yes           Std       3 KIA$9TO8
         yes           Std       3 KIA$8TO9
         yes           Std       7 SSV$EVENT
         yes           Std       0 FMP$CLSJ
 yes     yes           Std       1 M$MREAD
         yes           Std       1 FMD$RBUF
         yes           Std       1 FMD$GBUF
         yes           Std       0 FMM$DFLOPN
         yes           Std       2 EMR$FEP2HOST
         yes           Std       2 EMR$HOST2FEP
 yes     yes           Std       3 UMT$IDT2
         yes           Std       0 FMM$RELDCBI
         yes           Std       0 FMM$DFLOPNP
 yes     yes           Std       1 M$MFID
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AUTO_1
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:34   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_FPRG                               M$UC                                  N$DCT$$
     B_MPT                            r    F$CFU$                           r    B$PS2$
r    B$PS3$                           r    B$JIT$                           r    B$ROSEG$
r    B$M$STAR$                             S$CU$                                 S_CUN
     B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID                               ROSID
     ASLENTSID
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:35   


        1        1        /*M* KIF$FPRG - Handle M$SETFP PMME */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* PLM=3,IND=5,ENU=0,ECU=0,CRM=70   */
        8        8
        9        9
       10       10        KIF$FPRG: PROC (DOLIST$) ALTRET;

     10  2 000000   000000 700200 xent  KIF$FPRG     TSX0  ! X66_AUTO_1
         2 000001   000220 000001                    ZERO    144,1

       11       11
       12       12
       13       13        %INCLUDE CP_6;
       14       94        %INCLUDE F$DCB;
       15      143        %INCLUDE B$JIT;
       16      433        %INCLUDE B$OBJECT_C;
       17     3863        %INCLUDE B_MAGIC_C;
       18     3981        %INCLUDE B_STRINGS_C;
       19     4110        %INCLUDE B$USER;
       20     4326        %INCLUDE B$SS;
       21     4505        %INCLUDE NK$LDCT;
       22     4607        %INCLUDE FM$SET;
       23     4634        %INCLUDE CP_6_SUBS;
       24     5174        %INCLUDE NK_SUBS;
       25     5199        %INCLUDE FM$GRAN;
       26     5268        %INCLUDE FM$FIT;
       27     5489        %INCLUDE NK_LDCT_R;
       28     5498        %INCLUDE HF_LOCK_C;
       29     5512        %INCLUDE GJ_MSG_M;
       30     5825        %INCLUDE F_FPTCODE_C;
       31     5861        %INCLUDE KL_SUPER_C;
       32     8763        %INCLUDE KV_PRMID_E;
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:36   
       33     8937        %KV_PRMID_E;
       34     9093
       35     9094        %FM$GRAN;
       36     9098        %CODE04;
       37     9106        %NK$LDCT (STCLASS="BASED(LDCT$)");
       38     9152        %FM$SET;
       39     9157        %B$HEAD (NAME=B$HEAD,STCLASS="BASED(BF$)");
       40     9357        %RU_FLAVORS;
       41     9363        %VLP_FPRG (FPTN=VLP$FPRG,STCLASS=BASED);
       42     9384        %GJ_LDTRC_MSG(FPTN=LDTRCMSG,STCLASS="BASED(BF2$)");
       43     9435        %GJ_SETFP_MSG (FPTN=SETMSG,STCLASS="BASED(BF2$)");
       44     9599        %GJ_PROFILE_MSG (FPTN=PROMSG,STCLASS="BASED(BF2$)");
       45     9639    1   DCL CHAR$1 CHAR(1) BASED;
       46     9640        %GJ_FCN#;
       47     9666
       48     9667
       49     9668        %FPT_READ (FPTN=KIF_FPT_READ,STCLASS="CONSTANT SYMDEF",KEYS=YES);
       50     9707        %VLP_NAME (FPTN=KIF_HDKEY,STCLASS="CONSTANT SYMDEF",NAME='HEAD',LEN=7);
       51     9734
       52     9735        %SUB_EXC;
       53     9782        %SUB MONBIT#='000000400000'O;
       54     9783        %SUB KIF#='131106'O;                    /* FCG-MID FOR KIF          */
       55     9784        %SUB KI# ='1311'O;
       56     9785        %SUB F#  ='06'O;
       57     9786
       58     9787
       59     9788        /* Local variables */
       60     9789    1   DCL CG BIT(1);
       61     9790    1   DCL DEBUG BIT(1);
       62     9791    1   DCL CONTDSC BIT(1) ALIGNED;
       63     9792    1   DCL SYSFLAG BIT(1) ALIGNED;
       64     9793    1   DCL LDTRC BIT(1) ALIGNED;               /* Set if this is KIF$LDTRC */
       65     9794    1   DCL DONE BIT(1) ALIGNED;
       66     9795    1   DCL DID_SETFP BIT(1);
       67     9796    1   DCL OPNDEV BIT(1);
       68     9797    1   DCL DOLIST$ PTR;
       69     9798    1   DCL CCBUFL SBIN;
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:37   
       70     9799    1   DCL DCB$ PTR;
       71     9800    1   DCL MEDDCB$ PTR;
       72     9801    1   DCL STARDCB$ PTR;
       73     9802    1   DCL LMDCB$ PTR;
       74     9803    1   DCL LMDCB# UBIN;
       75     9804    1   DCL LDCT$ PTR;
       76     9805    1   DCL LDCT$U REDEF LDCT$ UBIN WORD;
       77     9806    1   DCL CG$ PTR;
       78     9807    1   DCL TEMP SBIN WORD;
       79     9808    1   DCL TEMPB REDEF TEMP BIT(36);
       80     9809    1   DCL TEMPA(0:1) REDEF TEMP UBIN HALF UNAL;
       81     9810    1   DCL SAVE_ACCT CHAR(8);
       82     9811    1   DCL WRITE_BYSZ SBIN;
       83     9812    1   DCL TOTAL_BYSZ SBIN;
       84     9813    1   DCL RECORD_BYSZ SBIN;
       85     9814    1   DCL N_READS SBIN;
       86     9815    1   DCL DUSER UBIN BYTE;
       87     9816    1   DCL TPTR$ PTR;
       88     9817    1   DCL 1 MYERR ALIGNED,
       89     9818    1         2 FCGM BIT(18),
       90     9819    1         2 M BIT(1),
       91     9820    1         2 CODE UBIN(14) UNAL,
       92     9821    1         2 SEV UBIN(3) UNAL;
       93     9822    1   DCL BF$ PTR;
       94     9823    1   DCL BF2$ PTR;
       95     9824    1   DCL STATION CHAR(8);
       96     9825
       97     9826        %VLP_FPRG (FPTN=VLP_FPRG,STCLASS=AUTO);
       98     9847        %GJ_FCN_MSG(FPTN=FCNMSG,STCLASS=AUTO);
       99     9872        %GJ_PROGKEY_MSG (STCLASS=AUTO);
      100     9927        %FPT_GETDCB (STCLASS=AUTO);
      101     9942        %FPT_READ (FPTN=FPT_READ,STCLASS=AUTO);
      102     9981        %B$FEP_RUKEY (NAME=ADKEY,STCLASS=AUTO);
      103    10005        %B$FPRG (NAME=FPRGEV,STCLASS=AUTO,PARONLY=1);
      104    10034        %VLP_FPRG (FPTN=CCBUF_FPRG, STCLASS=AUTO, LAST=NO);
      105    10055        %VLR_MODTIME (FPTN=MODTIME, LVL=2,STCLASS=AUTO);
      106    10073
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:38   
      107    10074        /* Symrefs */
      108    10075        %B_MPT (FPTN=B_MPT,STCLASS=SYMREF);
      109    10168    1   DCL F$CFU$ PTR SYMREF READONLY;
      110    10169    1   DCL B$PS1$ PTR SYMREF READONLY;
      111    10170    1   DCL B$PS2$ PTR SYMREF READONLY;
      112    10171    1   DCL B$PS3$ PTR SYMREF READONLY;
      113    10172    1   DCL B$JIT$ PTR SYMREF READONLY;
      114    10173    1   DCL B$USRT$ PTR SYMREF READONLY;
      115    10174    1   DCL B$ROSEG$ PTR SYMREF READONLY;
      116    10175    1   DCL B$M$LM$ PTR SYMREF READONLY;
      117    10176    1   DCL B$M$STAR$ PTR SYMREF READONLY;
      118    10177    1   DCL S$CU$ PTR SYMREF;
      119    10178    1   DCL S_CUN UBIN SYMREF;
      120    10179
      121    10180        /* Entry references */
      122    10181    1   DCL KCD$CDSCTRM ENTRY(1);
      123    10182    1   DCL KCI$CKSTAT ENTRY(3) ALTRET;
      124    10183    1   DCL KIA$UCIOND ENTRY(7) ALTRET;
      125    10184    1   DCL KIF$FPRGEVNT ENTRY(3);
      126    10185    1   DCL KIF$READ ENTRY(3) ALTRET;
      127    10186    1   DCL KIF$WRITE ENTRY(3) ALTRET;
      128    10187    1   DCL KIF$SEND ENTRY(3) ALTRET;
      129    10188    1   DCL FMP$CLSJ ENTRY;
      130    10189    1   DCL FMM$SCRUB ENTRY(1);
      131    10190    1   DCL FMM$DFLOPN ENTRY;
      132    10191    1   DCL FMM$DFLOPNP ENTRY;
      133    10192    1   DCL HFF$DSIZ ENTRY(2);
      134    10193    1   DCL HFF$NILERASE ENTRY(1) ALTRET;
      135    10194    1   DCL FMF$TYC ENTRY(2);
      136    10195    1   DCL FMD$GBUF ENTRY(1);
      137    10196    1   DCL FMD$RBUF ENTRY(1);
      138    10197    1   DCL FSA$GSP ENTRY(2) ALTRET;
      139    10198    1   DCL M$MFID ENTRY(1) ALTRET;
      140    10199    1   DCL M$MREAD ENTRY(1) ALTRET;
      141    10200    1   DCL M$MGETDCB ENTRY(1) ALTRET;
      142    10201    1   DCL FMM$RELDCBI ENTRY;
      143    10202    1   DCL KIA$8TO9 ENTRY(3);
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:39   
      144    10203    1   DCL KIA$9TO8 ENTRY(3);
      145    10204    1   DCL KIA$UCIO ENTRY(6) ALTRET;
      146    10205    1   DCL UMT$IDT2 ENTRY(3) ALTRET;
      147    10206    1   DCL SSS$UTS_L6 ENTRY(2) ALTRET;
      148    10207    1   DCL EMR$FEP2HOST ENTRY(2);
      149    10208    1   DCL EMR$HOST2FEP ENTRY(2);
      150    10209    1   DCL SSV$EVENT ENTRY(7);
      151    10210    1   DCL SC_FPRG ENTRY CONV(2,0);            /* SNAP                     */
      152    10211
      153    10212
      154    10213        %INCLUDE UD_SEV_C;
      155    10227        %INCLUDE B_ERRORS_C;
      156    11354
      157    11355    1   DCL 1 NOTFP CONSTANT ALIGNED,
      158    11356    1         2 FCG BIT(18) UNAL INIT(KIF#),
      159    11357    1         2 ERR UBIN(15) UNAL INIT(%E$NOTFP),
      160    11358    1         2 SEV UBIN(3) UNAL INIT(SEV_ERROR#);
      161    11359    1   DCL 1 REST CONSTANT ALIGNED,
      162    11360    1         2 FCG BIT(18) UNAL INIT(KIF#),
      163    11361    1         2 ERR UBIN(15) UNAL INIT(%E$RESTRICTED),
      164    11362    1         2 SEV UBIN(3) UNAL INIT(SEV_ERROR#);
      165    11363    1   DCL 1 NOSHRLIB CONSTANT ALIGNED,
      166    11364    1         2 FCG BIT(18) UNAL INIT(KIF#),
      167    11365    1         2 ERR UBIN(15) UNAL INIT(%E$NOSHRLIB),
      168    11366    1         2 SEV UBIN(3) UNAL INIT(SEV_ERROR#);
      169    11367    1   DCL 1 NPFPRG CONSTANT ALIGNED,
      170    11368    1         2 FCG BIT(18) UNAL INIT(KIF#),
      171    11369    1         2 ERR UBIN(15) UNAL INIT(%E$NPFPRG),
      172    11370    1         2 SEV UBIN(3) UNAL INIT(SEV_ERROR#);
      173    11371    1   DCL 1 FPFID CONSTANT ALIGNED,
      174    11372    1         2 FCG BIT(18) UNAL INIT(KIF#),
      175    11373    1         2 ERR UBIN(15) UNAL INIT(%E$FPFID),
      176    11374    1         2 SEV UBIN(3) UNAL INIT(SEV_ERROR#);
      177    11375    1   DCL 1 LIBSIZE CONSTANT ALIGNED,
      178    11376    1         2 FCG BIT(18) UNAL INIT(KIF#),
      179    11377    1         2 ERR UBIN(15) UNAL INIT(%E$LIBSIZE),
      180    11378    1         2 SEV UBIN(3) UNAL INIT(SEV_ERROR#);
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:40   
      181    11379    1   DCL 1 KIF_BADHEAD CONSTANT SYMDEF ALIGNED,
      182    11380    1         2 FCG BIT(18) UNAL INIT(KIF#),
      183    11381    1         2 ERR UBIN(15) UNAL INIT(%E$BADHEAD),
      184    11382    1         2 SEV UBIN(3) UNAL INIT(SEV_ERROR#);
      185    11383    1   DCL 1 FPDBSY CONSTANT ALIGNED,
      186    11384    1         2 FCG BIT(18) UNAL INIT(KIF#),
      187    11385    1         2 ERR UBIN(15) UNAL INIT(%E$FPDBSY),
      188    11386    1         2 SEV UBIN(3) UNAL INIT(SEV_ERROR#);
      189    11387    1   DCL 1 KIF_NONFP CONSTANT SYMDEF ALIGNED,
      190    11388    1         2 FCG BIT(18) UNAL INIT(KIF#),
      191    11389    1         2 ERR UBIN(15) UNAL INIT(%E$NONFP),
      192    11390    1         2 SEV UBIN(3) UNAL INIT(SEV_ERROR#);
      193    11391    1   DCL 1 NFPRQ CONSTANT ALIGNED,
      194    11392    1         2 FCG BIT(18) UNAL INIT(KIF#),
      195    11393    1         2 ERR UBIN(15) UNAL INIT(%E$NFPRQ),
      196    11394    1         2 SEV UBIN(3) UNAL INIT(SEV_ERROR#);
      197    11395    1   DCL 1 NFPRM CONSTANT ALIGNED,
      198    11396    1         2 FCG BIT(18) UNAL INIT(KIF#),
      199    11397    1         2 ERR UBIN(15) UNAL INIT(%E$NFPRM),
      200    11398    1         2 SEV UBIN(3) UNAL INIT(SEV_ERROR#);
      201    11399    1   DCL 1 NOTIMP CONSTANT ALIGNED,
      202    11400    1         2 FCG BIT(18) UNAL INIT(KIF#),
      203    11401    1         2 ERR UBIN(15) UNAL INIT(%E$NOTIMPLEMENTED),
      204    11402    1         2 SEV UBIN(3) UNAL INIT(SEV_ERROR#);
      205    11403    1   DCL 1 CCGT256 CONSTANT ALIGNED,
      206    11404    1         2 FCG BIT(18) UNAL INIT(KIF#),
      207    11405    1         2 ERR UBIN(15) UNAL INIT(%E$CCGT256),
      208    11406    1         2 SEV UBIN(3) UNAL INIT(SEV_ERROR#);
      209    11407    1   DCL 1 KIF_UNEXPT CONSTANT SYMDEF ALIGNED,
      210    11408    1         2 FCG BIT(18) UNAL INIT(KIF#),
      211    11409    1         2 ERR UBIN(15) UNAL INIT(%E$IOERR),
      212    11410    1         2 SEV UBIN(3) UNAL INIT(SEV_ERROR#);
      213    11411
      214    11412        %EJECT;
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:41   
      215    11413        /* The KIF$FPRG entry is called from UDA$PMMENT for M$SETFP.
      216    11414        */
      217    11415    1      VLP_FPRG=B$PS2$->VLP$FPRG;

  11415  2 000002   000000 470400 xsym               LDP0    B$PS2$
         2 000003   000100 100500                    MLR     fill='000'O
         2 000004   000000 000104                    ADSC9   0,,PR0                   cn=0,n=68
         2 000005   200042 000104                    ADSC9   VLP_FPRG,,AUTO           cn=0,n=68

      218    11416    1      CALL HFF$NILERASE(B$PS3$)

  11416  2 000006   000000 630400 3                  EPPR0   0
         2 000007   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000010   000000 701000 xent               TSX1    HFF$NILERASE
         2 000011   000032 702000 2                  TSX2    s:11429

      219    11417    2      WHENRETURN DO;

      220    11418    2           CALL HFF$DSIZ(B$PS3$,CCBUFL);

  11418  2 000012   200014 630500                    EPPR0   CCBUFL,,AUTO
         2 000013   200211 450500                    STP0    DLDCT$+3,,AUTO
         2 000014   000000 236000 3                  LDQ     0
         2 000015   200210 756100                    STQ     DLDCT$+2,,AUTO
         2 000016   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 000017   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000020   000000 701000 xent               TSX1    HFF$DSIZ
         2 000021   000000 011000                    NOP     0

      221    11419    2           IF CCBUFL > 256

  11419  2 000022   200014 235100                    LDA     CCBUFL,,AUTO
         2 000023   000400 115007                    CMPA    256,DL
         2 000024   000031 604400 2                  TMOZ    s:11422+1

      222    11420    3           THEN DO;

PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:42   
      223    11421    3                B$JIT.ERR=CCGT256;

  11421  2 000025   000034 236000 1                  LDQ     CCGT256
         2 000026   000000 470400 xsym               LDP0    B$JIT$
         2 000027   000012 756100                    STQ     10,,PR0

      224    11422    3                RETURN;

  11422  2 000030   000000 702200 xent               TSX2  ! X66_ARET
         2 000031   000033 710000 2                  TRA     s:11431

      225    11423    3                END;
      226    11424    2           END;
      227    11425        /*E*  ERROR: KIF-E$CCGT256-E
      228    11426            MESSAGE: M$SETFP specified a CCBUF greater than 256 characters
      229    11427        */
      230    11428    2      WHENALTRETURN DO;

      231    11429    2           CCBUFL=0;

  11429  2 000032   200014 450100                    STZ     CCBUFL,,AUTO

      232    11430    2           END;

      233    11431    1      OPNDEV = '0'B;

  11431  2 000033   200013 450100                    STZ     OPNDEV,,AUTO

      234    11432    1      GOTO SETUP1;

  11432  2 000034   000055 710000 2                  TRA     SETUP1

      235    11433
      236    11434        /* The KIF$FPRGR entry is called from FSN$OPNDEV with a possible
      237    11435           VLP_FPRG at offset F$DCB.FPRGX in the read-only segment.
      238    11436        */
      239    11437    1   KIF$FPRGR: ENTRY ALTRET;
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:43   

  11437  2 000035   000000 700200 xent  KIF$FPRGR    TSX0  ! X66_AUTO_1
         2 000036   000220 000001                    ZERO    144,1

      240    11438
      241    11439    1      IF B$JIT.DCB$->F$DCB.FPRGX=0 THEN RETURN;

  11439  2 000037   000000 470400 xsym               LDP0    B$JIT$
         2 000040   000232 471500                    LDP1    154,,PR0
         2 000041   100054 220100                    LDX0    44,,PR1
         2 000042   000044 601000 2                  TNZ     s:11440

  11439  2 000043   000000 702200 xent               TSX2  ! X66_ARET

      242    11440    1      VLP_FPRG=PINCRW(B$ROSEG$,B$JIT.DCB$->F$DCB.FPRGX)->VLP$FPRG;

  11440  2 000044   000000 635010                    EAA     0,X0
         2 000045   000020 771000                    ARL     16
         2 000046   000000 473400 xsym               LDP3    B$ROSEG$
         2 000047   000100 100505                    MLR     fill='000'O
         2 000050   300000 000104                    ADSC9   0,A,PR3                  cn=0,n=68
         2 000051   200042 000104                    ADSC9   VLP_FPRG,,AUTO           cn=0,n=68

      243    11441    1      CCBUFL=0;

  11441  2 000052   200014 450100                    STZ     CCBUFL,,AUTO

      244    11442    1      OPNDEV = '1'B;

  11442  2 000053   400000 236003                    LDQ     -131072,DU
         2 000054   200013 756100                    STQ     OPNDEV,,AUTO

  11442  2 000055                       SETUP1       null
      245    11443
      246    11444        %EJECT;
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:44   
      247    11445    1   SETUP1: ;
      248    11446    1      CALL SETUP;

  11446  2 000055   002450 701000 2                  TSX1    SETUP
         2 000056   000000 011000                    NOP     0

      249    11447    1      LDTRC='0'B;

  11447  2 000057   200010 450100                    STZ     LDTRC,,AUTO

      250    11448    1      DCB$=B$JIT.DCB$;

  11448  2 000060   000000 470400 xsym               LDP0    B$JIT$
         2 000061   000232 236100                    LDQ     154,,PR0
         2 000062   200015 756100                    STQ     DCB$,,AUTO

      251    11449
      252    11450    1      IF DCB$->F$DCB.FCD='0'B

  11450  2 000063   200015 471500                    LDP1    DCB$,,AUTO
         2 000064   100031 236100                    LDQ     25,,PR1
         2 000065   020000 316007                    CANQ    8192,DL
         2 000066   000101 600000 2                  TZE     s:11454
         2 000067   100032 236100                    LDQ     26,,PR1
         2 000070   777000 376007                    ANQ     -512,DL
         2 000071   004000 116007                    CMPQ    2048,DL
         2 000072   000104 600000 2                  TZE     s:11465
         2 000073   100032 236100                    LDQ     26,,PR1
         2 000074   777000 376003                    ANQ     -512,DU
         2 000075   012000 116003                    CMPQ    5120,DU
         2 000076   000104 600000 2                  TZE     s:11465
         2 000077   014000 116003                    CMPQ    6144,DU
         2 000100   000104 600000 2                  TZE     s:11465

      253    11451    1        OR (DCB$->F$DCB.ASN~=%COMGROUP#
      254    11452    1        AND (DCB$->F$DCB.ORG~=%FPRG# AND DCB$->F$DCB.ORG~=%HANDLER#))
      255    11453    2      THEN DO;
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:45   

      256    11454    2           B$JIT.ERR=NOTFP;

  11454  2 000101   000020 236000 1                  LDQ     NOTFP
         2 000102   000012 756100                    STQ     10,,PR0

      257    11455    2           RETURN;

  11455  2 000103   000000 702200 xent               TSX2  ! X66_ARET

      258    11456    2           END;
      259    11457        /*E*  ERROR:    KIF-E$NOTFP-E
      260    11458               MESSAGE: M$SETFP is illegal on that DCB% (%DC)%
      261    11459              MESSAGE1: The M$SETFP service is only available on ORG=FPRG or
      262    11460                        ORG=HANDLER, ASN=DEVICE DCBs and COMGROUP DCBs. Either
      263    11461                        your DCB% (%DC)% is not so assigned, or it is not open.
      264    11462              DESCRIPTION:  FCD, ASN, AND ORG are checked.
      265    11463        */
      266    11464
      267    11465    1      IF DCB$->F$DCB.FCN

  11465  2 000104   100074 220100                    LDX0    60,,PR1
         2 000105   000111 600000 2                  TZE     s:11478

      268    11466    2      THEN DO;

      269    11467    2           B$JIT.ERR=FPDBSY;

  11467  2 000106   000027 236000 1                  LDQ     FPDBSY
         2 000107   000012 756100                    STQ     10,,PR0

      270    11468    2           RETURN;

  11468  2 000110   000000 702200 xent               TSX2  ! X66_ARET

      271    11469    2           END;
      272    11470        /*E*  ERROR:    KIF-E$FPDBSY-E
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:46   
      273    11471               MESSAGE: Attempt to use M$SETFP on a busy DCB% (%DC)%.
      274    11472              MESSAGE1: M$SETFP may not be issued on a DCB% ,like %DC,% which
      275    11473                        has no-wait I/O in progress.
      276    11474              DESCRIPTION:  This is a good time to catch a DCB with a pending
      277    11475                            read which would cause no end of trouble later.
      278    11476        */
      279    11477
      280    11478    1      IF DCB$->F$DCB.ASN = %COMGROUP#

  11478  2 000111   100032 236100                    LDQ     26,,PR1
         2 000112   777000 376007                    ANQ     -512,DL
         2 000113   004000 116007                    CMPQ    2048,DL
         2 000114   000134 601000 2                  TNZ     s:11485

      281    11479    2      THEN DO;

      282    11480    2           CG = '1'B;                 /* Accessing a comgroup station  */

  11480  2 000115   400000 236003                    LDQ     -131072,DU
         2 000116   200004 756100                    STQ     CG,,AUTO

      283    11481    2           CALL KCI$CKSTAT(TPTR$,CG$,STATION) ALTRET(RTN);

  11481  2 000117   200040 633500                    EPPR3   STATION,,AUTO
         2 000120   200212 453500                    STP3    DLDCT$+4,,AUTO
         2 000121   200023 634500                    EPPR4   CG$,,AUTO
         2 000122   200211 454500                    STP4    DLDCT$+3,,AUTO
         2 000123   200034 635500                    EPPR5   TPTR$,,AUTO
         2 000124   200210 455500                    STP5    DLDCT$+2,,AUTO
         2 000125   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 000126   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000127   000000 701000 xent               TSX1    KCI$CKSTAT
         2 000130   002431 702000 2                  TSX2    RTN

      284    11482    2           LDCT$ = TPTR$;

  11482  2 000131   200034 236100                    LDQ     TPTR$,,AUTO
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:47   
         2 000132   200022 756100                    STQ     LDCT$,,AUTO

      285    11483    2           END;

  11483  2 000133   000153 710000 2                  TRA     s:11493

      286    11484    2      ELSE DO;

      287    11485    2           CG = '0'B;

  11485  2 000134   200004 450100                    STZ     CG,,AUTO

      288    11486    2           IF DCB$->F$DCB.IASN = %STREAM#

  11486  2 000135   100103 236100                    LDQ     67,,PR1
         2 000136   000777 376007                    ANQ     511,DL
         2 000137   000005 116007                    CMPQ    5,DL
         2 000140   000144 601000 2                  TNZ     s:11488

      289    11487    2           THEN MEDDCB$ = DCB$->F$DCB.CFU$; /* Pointer to stream dcb   */

  11487  2 000141   100066 236100                    LDQ     54,,PR1
         2 000142   200016 756100                    STQ     MEDDCB$,,AUTO
         2 000143   000146 710000 2                  TRA     s:11489

      290    11488    2           ELSE MEDDCB$ = DCB$;

  11488  2 000144   200015 236100                    LDQ     DCB$,,AUTO
         2 000145   200016 756100                    STQ     MEDDCB$,,AUTO

      291    11489    2           LDCT$=NK$LDCT$(MEDDCB$->F$DCB.LDCTX);

  11489  2 000146   200016 473500                    LDP3    MEDDCB$,,AUTO
         2 000147   300051 221100                    LDX1    41,,PR3
         2 000150   000000 474400 xsym               LDP4    N$DCT$$
         2 000151   400000 236111                    LDQ     0,X1,PR4
         2 000152   200022 756100                    STQ     LDCT$,,AUTO
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:48   

      292    11490    2           END;

      293    11491
      294    11492           %LOCK (G=LDCT$->LDCT.LOCK);

  11493  2 000153   000020 036003                    ADLQ    16,DU
         2 000154   200210 756100                    STQ     DLDCT$+2,,AUTO
         2 000155   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 000156   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000157   000000 701000 xent               TSX1    HFC$LOCK
         2 000160   000000 011000                    NOP     0

      295    11495    1      IF NOT LDCT$->LDCT.LKFLG.FPSTEP

  11495  2 000161   200022 470500                    LDP0    LDCT$,,AUTO
         2 000162   000011 236100                    LDQ     9,,PR0
         2 000163   000010 316003                    CANQ    8,DU
         2 000164   000200 601000 2                  TNZ     s:11511

      296    11496    2      THEN DO;

      297    11497                %UNLOCK (G=LDCT$->LDCT.LOCK);

  11498  2 000165   200022 236100                    LDQ     LDCT$,,AUTO
         2 000166   000020 036003                    ADLQ    16,DU
         2 000167   200210 756100                    STQ     DLDCT$+2,,AUTO
         2 000170   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 000171   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000172   000000 701000 xent               TSX1    HFC$UNLOCK
         2 000173   000000 011000                    NOP     0

  11498  2 000174                       NFP          null
      298    11500    2   NFP:    ;
      299    11501    2           B$JIT.ERR=NFPRQ;

  11501  2 000174   000031 236000 1                  LDQ     NFPRQ
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:49   
         2 000175   000000 470400 xsym               LDP0    B$JIT$
         2 000176   000012 756100                    STQ     10,,PR0

      300    11502    2           RETURN;

  11502  2 000177   000000 702200 xent               TSX2  ! X66_ARET

      301    11503    2           END;
      302    11504        /*E*  ERROR:    KIF-E$NFPRQ-E
      303    11505               MESSAGE: That destination doesn't need a form!
      304    11506              MESSAGE1: The M$SETFP service may only be performed on a destination
      305    11507                        which has a forms program at job step.
      306    11508              DESCRIPTION: ~LDCT.LKFLG.FPSTEP
      307    11509        */
      308    11510
      309    11511    1      LDCT$->LDCT.LKFLG.FPPM = '1'B;

  11511  2 000200   000004 236003                    LDQ     4,DU
         2 000201   000011 256100                    ORSQ    9,,PR0

      310    11512    1      IF LDCT$->LDCT.LKFLG.ABORTED

  11512  2 000202   000011 236100                    LDQ     9,,PR0
         2 000203   100000 316003                    CANQ    32768,DU
         2 000204   000235 600000 2                  TZE     s:11524

      311    11513    2      THEN DO;         /* Send a rundown message to front-end job step */

      312    11514    2           LDCT$->LDCT.LKFLG.ABORTED='0'B;

  11514  2 000205   000001 236000 3                  LDQ     1
         2 000206   000011 356100                    ANSQ    9,,PR0

      313    11515                %UNLOCK (G=LDCT$->LDCT.LOCK);

  11516  2 000207   200022 236100                    LDQ     LDCT$,,AUTO
         2 000210   000020 036003                    ADLQ    16,DU
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:50   
         2 000211   200210 756100                    STQ     DLDCT$+2,,AUTO
         2 000212   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 000213   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000214   000000 701000 xent               TSX1    HFC$UNLOCK
         2 000215   000000 011000                    NOP     0

      314    11518    2           FCNMSG='0'B;

  11518  2 000216   200064 450100                    STZ     FCNMSG,,AUTO
         2 000217   200065 450100                    STZ     FCNMSG+1,,AUTO

      315    11519    2           FCNMSG.FCN=%GJ_RUND#;

  11519  2 000220   022000 236003                    LDQ     9216,DU
         2 000221   200064 552140                    STBQ    FCNMSG,'40'O,AUTO

      316    11520    2           CALL KIF$WRITE(LDCT,FCNMSG,LENGTHC(FCNMSG)) ALTRET(JITERR);

  11520  2 000222   000002 236000 3                  LDQ     2
         2 000223   200212 756100                    STQ     DLDCT$+4,,AUTO
         2 000224   200064 630500                    EPPR0   FCNMSG,,AUTO
         2 000225   200211 450500                    STP0    DLDCT$+3,,AUTO
         2 000226   200022 236100                    LDQ     LDCT$,,AUTO
         2 000227   200210 756100                    STQ     DLDCT$+2,,AUTO
         2 000230   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 000231   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000232   000000 701000 xent               TSX1    KIF$WRITE
         2 000233   000340 702000 2                  TSX2    JITERR

      317    11521    2           END;

  11521  2 000234   000244 710000 2                  TRA     s:11528

      318    11522    2      ELSE DO;

      319    11523                %UNLOCK (G=LDCT$->LDCT.LOCK);

PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:51   
  11524  2 000235   200022 236100                    LDQ     LDCT$,,AUTO
         2 000236   000020 036003                    ADLQ    16,DU
         2 000237   200210 756100                    STQ     DLDCT$+2,,AUTO
         2 000240   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 000241   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000242   000000 701000 xent               TSX1    HFC$UNLOCK
         2 000243   000000 011000                    NOP     0

      320    11526    2           END;

      321    11527
      322    11528    1      GOTO CMN;

  11528  2 000244   000302 710000 2                  TRA     CMN

      323    11529        %EJECT;
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:52   
      324    11530
      325    11531
      326    11532        /* The KIF$LDTRC entry is used by SSQ$QEND and SSR$RUE.
      327    11533        */
      328    11534    1   KIF$LDTRC: ENTRY(DOLIST$) ALTRET;

  11534  2 000245   000000 700200 xent  KIF$LDTRC    TSX0  ! X66_AUTO_1
         2 000246   000220 000001                    ZERO    144,1

      329    11535
      330    11536    1      CALL SETUP;

  11536  2 000247   002450 701000 2                  TSX1    SETUP
         2 000250   000000 011000                    NOP     0

      331    11537    1      CCBUFL=0;

  11537  2 000251   200014 450100                    STZ     CCBUFL,,AUTO

      332    11538    1      OPNDEV = '0'B;

  11538  2 000252   200013 450100                    STZ     OPNDEV,,AUTO

      333    11539    1      LDTRC='1'B;

  11539  2 000253   400000 236003                    LDQ     -131072,DU
         2 000254   200010 756100                    STQ     LDTRC,,AUTO

      334    11540    1      LDCT$U=DOLIST$->B$DO.EVID;           /* Get LDCT$                */

  11540  2 000255   200003 470500                    LDP0    @DOLIST$,,AUTO
         2 000256   000000 471500                    LDP1    0,,PR0
         2 000257   100003 235100                    LDA     3,,PR1
         2 000260   200022 755100                    STA     LDCT$,,AUTO

      335    11541
      336    11542    1      IF LDCT$->LDCT.RESCOD=NK_CGFPRG
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:53   

  11542  2 000261   200022 473500                    LDP3    LDCT$,,AUTO
         2 000262   300006 236100                    LDQ     6,,PR3
         2 000263   000017 376007                    ANQ     15,DL
         2 000264   000011 116007                    CMPQ    9,DL
         2 000265   000271 601000 2                  TNZ     s:11547

      337    11543    2      THEN DO;

      338    11544    2           CG='1'B;

  11544  2 000266   400000 236003                    LDQ     -131072,DU
         2 000267   200004 756100                    STQ     CG,,AUTO

      339    11545    2           END;

  11545  2 000270   000301 710000 2                  TRA     s:11551

      340    11546    2      ELSE DO;

      341    11547    2           CG='0'B;

  11547  2 000271   200004 450100                    STZ     CG,,AUTO

      342    11548    2           MEDDCB$=DCBADDR(LDCT$->NK$LDCT.DCBNO);

  11548  2 000272   000003 474400 3                  LDP4    3
         2 000273   400000 475500                    LDP5    0,,PR4
         2 000274   300014 236100                    LDQ     12,,PR3
         2 000275   000033 736000                    QLS     27
         2 000276   000033 732000                    QRS     27
         2 000277   500000 236106                    LDQ     0,QL,PR5
         2 000300   200016 756100                    STQ     MEDDCB$,,AUTO

      343    11549    2           END;

      344    11550
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:54   
      345    11551    1      GOTO CMN;

  11551  2 000301   000302 710000 2                  TRA     CMN

  11542  2 000302                       CMN          null
      346    11552        %EJECT;
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:55   
      347    11553    1   CMN: ;
      348    11554
      349    11555        /* Get a buffer to be used for the head record and the setmsg */
      350    11556    1      CALL FMD$GBUF (TPTR$);

  11556  2 000302   200034 630500                    EPPR0   TPTR$,,AUTO
         2 000303   200210 450500                    STP0    DLDCT$+2,,AUTO
         2 000304   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 000305   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000306   000000 701000 xent               TSX1    FMD$GBUF
         2 000307   000000 011000                    NOP     0

      351    11557    1      BF$ = TPTR$;

  11557  2 000310   200034 236100                    LDQ     TPTR$,,AUTO
         2 000311   200036 756100                    STQ     BF$,,AUTO

      352    11558    1      DID_SETFP = '0'B;

  11558  2 000312   200012 450100                    STZ     DID_SETFP,,AUTO

      353    11559    1      BF2$ = PINCRW(BF$,512);

  11559  2 000313   001000 036003                    ADLQ    512,DU
         2 000314   200037 756100                    STQ     BF2$,,AUTO

      354    11560
      355    11561    1      IF NOT CG

  11561  2 000315   200004 234100                    SZN     CG,,AUTO
         2 000316   000355 604000 2                  TMI     s:11573

      356    11562    1      THEN IF MEDDCB$->F$DCB.FPRGX=0

  11562  2 000317   200016 470500                    LDP0    MEDDCB$,,AUTO
         2 000320   000054 220100                    LDX0    44,,PR0
         2 000321   000355 601000 2                  TNZ     s:11573
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:56   

      357    11563    2           THEN DO;                   /* Get roseg space for VLP_FPRG  */

      358    11564    2                CALL FSA$GSP(SIZEW(VLP$FPRG),TPTR$)

  11564  2 000322   200034 631500                    EPPR1   TPTR$,,AUTO
         2 000323   200211 451500                    STP1    DLDCT$+3,,AUTO
         2 000324   000005 236000 3                  LDQ     5
         2 000325   200210 756100                    STQ     DLDCT$+2,,AUTO
         2 000326   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 000327   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000330   000000 701000 xent               TSX1    FSA$GSP
         2 000331   000333 702000 2                  TSX2    s:11566
         2 000332   000344 710000 2                  TRA     s:11571

      359    11565    3                WHENALTRETURN DO;

      360    11566    3                     B$JIT.ERR.FCG=KI#;

  11566  2 000333   000000 470400 xsym               LDP0    B$JIT$
         2 000334   131100 236003                    LDQ     45632,DU
         2 000335   000012 752160                    STCQ    10,'60'O,PR0

      361    11567    3                     B$JIT.ERR.MID=F#;

  11567  2 000336   000006 236003                    LDQ     6,DU
         2 000337   000012 752110                    STCQ    10,'10'O,PR0

      362    11568    3   JITERR:           MYERR=B$JIT.ERR;

  11568  2 000340   000000 470400 xsym  JITERR       LDP0    B$JIT$
         2 000341   000012 236100                    LDQ     10,,PR0
         2 000342   200035 756100                    STQ     MYERR,,AUTO

      363    11569    3                     GOTO XIT;

  11569  2 000343   002134 710000 2                  TRA     XIT
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:57   

      364    11570    3                     END;
      365    11571    2                MEDDCB$->F$DCB.FPRGX=POFFW(TPTR$,B$ROSEG$);

  11571  2 000344   000000 235000 xsym               LDA     B$ROSEG$
         2 000345   000022 771000                    ARL     18
         2 000346   200210 755100                    STA     DLDCT$+2,,AUTO
         2 000347   200034 236100                    LDQ     TPTR$,,AUTO
         2 000350   000022 772000                    QRL     18
         2 000351   200210 136100                    SBLQ    DLDCT$+2,,AUTO
         2 000352   000000 620006                    EAX0    0,QL
         2 000353   200016 470500                    LDP0    MEDDCB$,,AUTO
         2 000354   000054 740100                    STX0    44,,PR0

      366    11572    2                END;

      367    11573    1      LDCT$->LDCT.USER=S_CUN;

  11573  2 000355   200022 470500                    LDP0    LDCT$,,AUTO
         2 000356   000000 236000 xsym               LDQ     S_CUN
         2 000357   000022 736000                    QLS     18
         2 000360   000007 552120                    STBQ    7,'20'O,PR0

      368    11574
      369    11575        /* We must get a DCB for the rununit */
      370    11576    1      FPT_GETDCB.V_ = VECTOR(FPT_GETDCB.V);

  11576  2 000361   000006 235000 3                  LDA     6
         2 000362   200210 452500                    STP2    DLDCT$+2,,AUTO
         2 000363   200210 236100                    LDQ     DLDCT$+2,,AUTO
         2 000364   000102 036003                    ADLQ    66,DU
         2 000365   200074 757100                    STAQ    FPT_GETDCB,,AUTO

      371    11577    1      FPT_GETDCB.V = '0'B;

  11577  2 000366   000000 235003                    LDA     0,DU
         2 000367   000000 236003                    LDQ     0,DU
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:58   
         2 000370   200102 757100                    STAQ    FPT_GETDCB+6,,AUTO

      372    11578    1      FPT_GETDCB.DCBNAME_ = VECTOR(NIL);

  11578  2 000371   000010 237000 3                  LDAQ    8
         2 000372   200076 757100                    STAQ    FPT_GETDCB+2,,AUTO

      373    11579    1      FPT_GETDCB.DCBNUM_ = VECTOR(LMDCB#);

  11579  2 000373   777640 235007                    LDA     -96,DL
         2 000374   200210 452500                    STP2    DLDCT$+2,,AUTO
         2 000375   200210 236100                    LDQ     DLDCT$+2,,AUTO
         2 000376   000021 036003                    ADLQ    17,DU
         2 000377   200100 757100                    STAQ    FPT_GETDCB+4,,AUTO

      374    11580    1      CALL M$MGETDCB (FPT_GETDCB) ALTRET(JITERR);

  11580  2 000400   200074 631500                    EPPR1   FPT_GETDCB,,AUTO
         2 000401   200210 451500                    STP1    DLDCT$+2,,AUTO
         2 000402   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 000403   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000404   000000 701000 xent               TSX1    M$MGETDCB
         2 000405   000340 702000 2                  TSX2    JITERR

      375    11581    1      LMDCB$ = DCBADDR(LMDCB#);

  11581  2 000406   000003 470400 3                  LDP0    3
         2 000407   000000 471500                    LDP1    0,,PR0
         2 000410   200021 720100                    LXL0    LMDCB#,,AUTO
         2 000411   100000 236110                    LDQ     0,X0,PR1
         2 000412   200020 756100                    STQ     LMDCB$,,AUTO

      376    11582    1      B$JIT.DCB$=LMDCB$;

  11582  2 000413   000000 473400 xsym               LDP3    B$JIT$
         2 000414   300232 756100                    STQ     154,,PR3

PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:59   
      377    11583    1      CALL FMM$SCRUB(B$JIT.DCB$);

  11583  2 000415   000000 236000 xsym               LDQ     B$JIT$
         2 000416   000232 036003                    ADLQ    154,DU
         2 000417   200210 756100                    STQ     DLDCT$+2,,AUTO
         2 000420   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 000421   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000422   000000 701000 xent               TSX1    FMM$SCRUB
         2 000423   000000 011000                    NOP     0

      378    11584    1      LMDCB$->F$DCB.DCB# = LMDCB#;

  11584  2 000424   200020 470500                    LDP0    LMDCB$,,AUTO
         2 000425   200021 236100                    LDQ     LMDCB#,,AUTO
         2 000426   000033 736000                    QLS     27
         2 000427   000060 552140                    STBQ    48,'40'O,PR0

      379    11585
      380    11586
      381    11587        /* Get LDTRC info if this is a FEP-issued M$LDTRC                            */
      382    11588    1      IF LDTRC

  11588  2 000430   200010 234100                    SZN     LDTRC,,AUTO
         2 000431   000464 605000 2                  TPL     s:11600

      383    11589    2      THEN DO;

      384    11590    2           CALL KIF$READ(LDCT,LDTRCMSG,LENGTHC(LDTRCMSG)) ALTRET(JITERR);

  11590  2 000432   000012 236000 3                  LDQ     10
         2 000433   200212 756100                    STQ     DLDCT$+4,,AUTO
         2 000434   200037 236100                    LDQ     BF2$,,AUTO
         2 000435   200022 235100                    LDA     LDCT$,,AUTO
         2 000436   200210 757100                    STAQ    DLDCT$+2,,AUTO
         2 000437   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 000440   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000441   000000 701000 xent               TSX1    KIF$READ
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:60   
         2 000442   000340 702000 2                  TSX2    JITERR

      385    11591    2           VLP_FPRG='0'B;

  11591  2 000443   000100 100400                    MLR     fill='000'O
         2 000444   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         2 000445   200042 000104                    ADSC9   VLP_FPRG,,AUTO           cn=0,n=68

      386    11592    2           VLP_FPRG.NAME=LDTRCMSG.NAME;

  11592  2 000446   200037 470500                    LDP0    BF2$,,AUTO
         2 000447   000100 100500                    MLR     fill='000'O
         2 000450   000001 400040                    ADSC9   1,,PR0                   cn=2,n=32
         2 000451   200044 000040                    ADSC9   VLP_FPRG+2,,AUTO         cn=0,n=32

      387    11593    2           VLP_FPRG.ACCT#=LDTRCMSG.ACCT;

  11593  2 000452   040100 100500                    MLR     fill='040'O
         2 000453   000011 400010                    ADSC9   9,,PR0                   cn=2,n=8
         2 000454   200054 000010                    ADSC9   VLP_FPRG+10,,AUTO        cn=0,n=8

      388    11594    2           VLP_FPRG.PASS#=LDTRCMSG.PASS;

  11594  2 000455   040100 100500                    MLR     fill='040'O
         2 000456   000013 400010                    ADSC9   11,,PR0                  cn=2,n=8
         2 000457   200056 000010                    ADSC9   VLP_FPRG+12,,AUTO        cn=0,n=8

      389    11595    2           VLP_FPRG.PSN#=LDTRCMSG.PSN;

  11595  2 000460   040100 100500                    MLR     fill='040'O
         2 000461   000015 400006                    ADSC9   13,,PR0                  cn=2,n=6
         2 000462   200042 400006                    ADSC9   VLP_FPRG,,AUTO           cn=2,n=6

      390    11596    2           END;

  11596  2 000463   000473 710000 2                  TRA     FILL_SETFP_MSG

PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:61   
      391    11597
      392    11598        /* Get profile name from the FEP if this is LOAD BY PRO.    */
      393    11599    2      ELSE DO;

      394    11600    2           IF VLP_FPRG.LDBYPRO#~=0 AND LDTRC='0'B

  11600  2 000464   200042 236100                    LDQ     VLP_FPRG,,AUTO
         2 000465   777000 316003                    CANQ    -512,DU
         2 000466   000473 600000 2                  TZE     FILL_SETFP_MSG
         2 000467   200010 234100                    SZN     LDTRC,,AUTO
         2 000470   000473 604000 2                  TMI     FILL_SETFP_MSG

      395    11601    2           THEN CALL GETPROFPRG ALTRET(XIT);

  11601  2 000471   002460 701000 2                  TSX1    GETPROFPRG
         2 000472   002134 702000 2                  TSX2    XIT

      396    11602    2           END;

      397    11603
      398    11604        /* Now fill in SETMSG */
      399    11605    1   FILL_SETFP_MSG:
      400    11606    1      SETMSG='0'B;

  11606  2 000473   200037 470500       FILL_SETFP_* LDP0    BF2$,,AUTO
         2 000474   000100 100400                    MLR     fill='000'O
         2 000475   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         2 000476   000000 000214                    ADSC9   0,,PR0                   cn=0,n=140

      401    11607    1      SETMSG.FCN=%GJ_SETFP#;

  11607  2 000477   000000 236003                    LDQ     0,DU
         2 000500   000000 552140                    STBQ    0,'40'O,PR0

      402    11608    1      SETMSG.NAME = VLP_FPRG.NAME;

  11608  2 000501   000100 100500                    MLR     fill='000'O
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:62   
         2 000502   200044 000040                    ADSC9   VLP_FPRG+2,,AUTO         cn=0,n=32
         2 000503   000001 400040                    ADSC9   1,,PR0                   cn=2,n=32

      403    11609    1      SETMSG.PASS = VLP_FPRG.PASS#;

  11609  2 000504   040100 100500                    MLR     fill='040'O
         2 000505   200056 000010                    ADSC9   VLP_FPRG+12,,AUTO        cn=0,n=8
         2 000506   000013 400010                    ADSC9   11,,PR0                  cn=2,n=8

      404    11610    1      SETMSG.PSN = VLP_FPRG.PSN#;

  11610  2 000507   040100 100500                    MLR     fill='040'O
         2 000510   200042 400006                    ADSC9   VLP_FPRG,,AUTO           cn=2,n=6
         2 000511   000015 400006                    ADSC9   13,,PR0                  cn=2,n=6

      405    11611    1      SETMSG.ACCT = VLP_FPRG.ACCT#;

  11611  2 000512   040100 100500                    MLR     fill='040'O
         2 000513   200054 000010                    ADSC9   VLP_FPRG+10,,AUTO        cn=0,n=8
         2 000514   000011 400010                    ADSC9   9,,PR0                   cn=2,n=8

      406    11612    1      SYSFLAG=(SETMSG.ACCT=':SYS');        /* System rununit           */

  11612  2 000515   400000 220003                    LDX0    -131072,DU
         2 000516   040000 106500                    CMPC    fill='040'O
         2 000517   000011 400010                    ADSC9   9,,PR0                   cn=2,n=8
         2 000520   000066 000004 1                  ADSC9   FPT_FIDC+24              cn=0,n=4
         2 000521   000523 600000 2                  TZE     s:11612+6
         2 000522   000000 220003                    LDX0    0,DU
         2 000523   000000 636010                    EAQ     0,X0
         2 000524   200007 756100                    STQ     SYSFLAG,,AUTO

      407    11613        %EJECT;
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:63   
      408    11614        /* Now open the rununit file */
      409    11615    1      LMDCB$->F$DCB.NAME.L=SETMSG.NAME.L;

  11615  2 000525   200020 471500                    LDP1    LMDCB$,,AUTO
         2 000526   000001 236100                    LDQ     1,,PR0
         2 000527   000022 736000                    QLS     18
         2 000530   100010 552140                    STBQ    8,'40'O,PR1

      410    11616    1      LMDCB$->F$DCB.NAME.C=SETMSG.NAME.TEXT;

  11616  2 000531   040100 100500                    MLR     fill='040'O
         2 000532   000001 600037                    ADSC9   1,,PR0                   cn=3,n=31
         2 000533   100010 200037                    ADSC9   8,,PR1                   cn=1,n=31

      411    11617    1      LMDCB$->F$DCB.ACCT=SETMSG.ACCT;

  11617  2 000534   040100 100500                    MLR     fill='040'O
         2 000535   000011 400010                    ADSC9   9,,PR0                   cn=2,n=8
         2 000536   100020 000010                    ADSC9   16,,PR1                  cn=0,n=8

      412    11618    1      LMDCB$->F$DCB.PASS =SETMSG.PASS;

  11618  2 000537   040100 100500                    MLR     fill='040'O
         2 000540   000013 400010                    ADSC9   11,,PR0                  cn=2,n=8
         2 000541   100022 000010                    ADSC9   18,,PR1                  cn=0,n=8

      413    11619    1      LMDCB$->F$DCB.PSN=SETMSG.PSN;

  11619  2 000542   040100 100500                    MLR     fill='040'O
         2 000543   000015 400006                    ADSC9   13,,PR0                  cn=2,n=6
         2 000544   100024 000006                    ADSC9   20,,PR1                  cn=0,n=6

      414    11620    1      LMDCB$->F$DCB.ASN=%FILE#;

  11620  2 000545   001000 236007                    LDQ     512,DL
         2 000546   100032 552110                    STBQ    26,'10'O,PR1

PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:64   
      415    11621    1      LMDCB$->F$DCB.FUN=%IN#;

  11621  2 000547   000002 236003                    LDQ     2,DU
         2 000550   100032 552120                    STBQ    26,'20'O,PR1

      416    11622    1      LMDCB$->F$DCB.ACS=%DIRECT#;

  11622  2 000551   000002 236007                    LDQ     2,DL
         2 000552   100036 552104                    STBQ    30,'04'O,PR1

      417    11623
      418    11624        /* Change to the logon account so we can get the access controls right */
      419    11625    1      SAVE_ACCT = B$JIT.ACCN;

  11625  2 000553   000000 473400 xsym               LDP3    B$JIT$
         2 000554   040100 100500                    MLR     fill='040'O
         2 000555   300001 000010                    ADSC9   1,,PR3                   cn=0,n=8
         2 000556   200025 000010                    ADSC9   SAVE_ACCT,,AUTO          cn=0,n=8

      420    11626    1      IF LDCT$->LDCT.LOGON_ACCT ~= ' '

  11626  2 000557   200022 474500                    LDP4    LDCT$,,AUTO
         2 000560   400024 237100                    LDAQ    20,,PR4
         2 000561   000014 117000 3                  CMPAQ   12
         2 000562   000566 600000 2                  TZE     s:11628

      421    11627    1      THEN B$JIT.ACCN = LDCT$->LDCT.LOGON_ACCT;

  11627  2 000563   400024 237100                    LDAQ    20,,PR4
         2 000564   300001 755100                    STA     1,,PR3
         2 000565   300002 756100                    STQ     2,,PR3

      422    11628    1      LMDCB$->F$DCB.WSR=0;                 /* Pretend that we are STEP */

  11628  2 000566   000000 236003                    LDQ     0,DU
         2 000567   100040 552120                    STBQ    32,'20'O,PR1

PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:65   
  11628  2 000570                       ONE_MORE_TI* null
      423    11629    1   ONE_MORE_TIME:;
      424    11630    1      B$JIT.ERR='0'B;

  11630  2 000570   000000 470400 xsym               LDP0    B$JIT$
         2 000571   000012 450100                    STZ     10,,PR0

      425    11631    1      CALL FMM$DFLOPN;

  11631  2 000572   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000573   000000 701000 xent               TSX1    FMM$DFLOPN
         2 000574   000000 011000                    NOP     0

      426    11632
      427    11633        /* If STEP couldn't run it, see if the running program has better luck.
      428    11634        */
      429    11635    1      IF B$JIT.ERR~='0'B AND LMDCB$->F$DCB.WSR=0

  11635  2 000575   000000 470400 xsym               LDP0    B$JIT$
         2 000576   000012 235100                    LDA     10,,PR0
         2 000577   000612 600000 2                  TZE     s:11642
         2 000600   200020 471500                    LDP1    LMDCB$,,AUTO
         2 000601   100040 236100                    LDQ     32,,PR1
         2 000602   000777 316003                    CANQ    511,DU
         2 000603   000612 601000 2                  TNZ     s:11642

      430    11636    2      THEN DO;

      431    11637    2           LMDCB$->F$DCB.WSR=B_MPT.SS$->B$SS.ISR.WSR;

  11637  2 000604   000000 473400 xsym               LDP3    B_MPT
         2 000605   300010 236100                    LDQ     8,,PR3
         2 000606   000160 376007                    ANQ     112,DL
         2 000607   000016 736000                    QLS     14
         2 000610   100040 552120                    STBQ    32,'20'O,PR1

      432    11638    2           GOTO ONE_MORE_TIME;
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:66   

  11638  2 000611   000570 710000 2                  TRA     ONE_MORE_TIME

      433    11639    2           END;
      434    11640
      435    11641        /* Restore the JIT.ACCN */
      436    11642    1      B$JIT.ACCN = SAVE_ACCT;

  11642  2 000612   040100 100500                    MLR     fill='040'O
         2 000613   200025 000010                    ADSC9   SAVE_ACCT,,AUTO          cn=0,n=8
         2 000614   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8

      437    11643
      438    11644    1      IF B$JIT.ERR~='0'B

  11644  2 000615   000000 115003                    CMPA    0,DU
         2 000616   000624 600000 2                  TZE     s:11660

      439    11645    2      THEN DO;

      440    11646    2           MYERR=B$JIT.ERR;

  11646  2 000617   000012 236100                    LDQ     10,,PR0
         2 000620   200035 756100                    STQ     MYERR,,AUTO

      441    11647    2           MYERR.FCGM=KIF#;

  11647  2 000621   131106 220003                    LDX0    45638,DU
         2 000622   200035 740100                    STX0    MYERR,,AUTO

      442    11648    2           GOTO XIT;

  11648  2 000623   002134 710000 2                  TRA     XIT

      443    11649    2           END;
      444    11650
      445    11651        /*E*  ERROR:    KIF-E$FILEBUSY-E
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:67   
      446    11652              MESSAGE:  Can't access FEP program - file is busy
      447    11653        */
      448    11654        /*E*  ERROR:    KIF-E$NOFILE-E
      449    11655              MESSAGE:  That FEP program does not exist.
      450    11656        */
      451    11657        /*E*  ERROR:    KIF-E$NOACCESS-E
      452    11658              MESSAGE:  You don't have access to that FEP program.
      453    11659        */
      454    11660    1      TEMP = LMDCB$->F$DCB.EXPIRE;

  11660  2 000624   200020 471500                    LDP1    LMDCB$,,AUTO
         2 000625   100035 235100                    LDA     29,,PR1
         2 000626   200024 755100                    STA     TEMP,,AUTO

      455    11661    1      CALL SSS$UTS_L6(TEMP,TEMP);

  11661  2 000627   200024 633500                    EPPR3   TEMP,,AUTO
         2 000630   200211 453500                    STP3    DLDCT$+3,,AUTO
         2 000631   200024 634500                    EPPR4   TEMP,,AUTO
         2 000632   200210 454500                    STP4    DLDCT$+2,,AUTO
         2 000633   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 000634   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000635   000000 701000 xent               TSX1    SSS$UTS_L6
         2 000636   000000 011000                    NOP     0

      456    11662    1      CALL KIA$9TO8(TEMP, SETMSG.MODTIME, 4);

  11662  2 000637   000016 236000 3                  LDQ     14
         2 000640   200212 756100                    STQ     DLDCT$+4,,AUTO
         2 000641   200037 236100                    LDQ     BF2$,,AUTO
         2 000642   000017 036003                    ADLQ    15,DU
         2 000643   200211 756100                    STQ     DLDCT$+3,,AUTO
         2 000644   200024 630500                    EPPR0   TEMP,,AUTO
         2 000645   200210 450500                    STP0    DLDCT$+2,,AUTO
         2 000646   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 000647   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000650   000000 701000 xent               TSX1    KIA$9TO8
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:68   
         2 000651   000000 011000                    NOP     0

      457    11663
      458    11664    1      SETMSG.ACCT=LMDCB$->F$DCB.ACCT;

  11664  2 000652   200020 470500                    LDP0    LMDCB$,,AUTO
         2 000653   200037 471500                    LDP1    BF2$,,AUTO
         2 000654   040100 100500                    MLR     fill='040'O
         2 000655   000020 000010                    ADSC9   16,,PR0                  cn=0,n=8
         2 000656   100011 400010                    ADSC9   9,,PR1                   cn=2,n=8

      459    11665    1      SETMSG.PSN=F$CFU$->FM$SET.PSN(LMDCB$->F$DCB.SETX);

  11665  2 000657   000051 236100                    LDQ     41,,PR0
         2 000660   000003 736000                    QLS     3
         2 000661   000017 376000 3                  ANQ     15
         2 000662   000002 736000                    QLS     2
         2 000663   000000 473400 xsym               LDP3    F$CFU$
         2 000664   040100 100506                    MLR     fill='040'O
         2 000665   300000 400006                    ADSC9   0,Q,PR3                  cn=2,n=6
         2 000666   100015 400006                    ADSC9   13,,PR1                  cn=2,n=6

      460    11666    1      SETMSG.FLAGS.XEQ_ONLY=LMDCB$->F$DCB.FFLG.EXEC;

  11666  2 000667   000004 236100                    LDQ     4,,PR0
         2 000670   000004 736000                    QLS     4
         2 000671   100022 676100                    ERQ     18,,PR1
         2 000672   040000 376003                    ANQ     16384,DU
         2 000673   100022 656100                    ERSQ    18,,PR1

      461    11667
      462    11668    1      IF (SETMSG.FLAGS.XEQ_ONLY='0'B) AND (LDTRC='0'B)

  11668  2 000674   100022 236100                    LDQ     18,,PR1
         2 000675   040000 316003                    CANQ    16384,DU
         2 000676   000724 601000 2                  TNZ     s:11679
         2 000677   200010 234100                    SZN     LDTRC,,AUTO
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:69   
         2 000700   000724 604000 2                  TMI     s:11679
         2 000701   000000 474400 xsym               LDP4    B_MPT
         2 000702   400010 236100                    LDQ     8,,PR4
         2 000703   000160 376007                    ANQ     112,DL
         2 000704   000160 116007                    CMPQ    112,DL
         2 000705   000724 601000 2                  TNZ     s:11679

      463    11669    1        AND (B_MPT.SS$->B$SS.ISR.WSR = %USERWSR)
      464    11670    2      THEN DO;

      465    11671    2           IF CG='1'B

  11671  2 000706   200004 234100                    SZN     CG,,AUTO
         2 000707   000716 605000 2                  TPL     s:11675

      466    11672    2           THEN IF VLP_FPRG.FLGS.DEBUG#='1'B

  11672  2 000710   200042 236100                    LDQ     VLP_FPRG,,AUTO
         2 000711   000400 316003                    CANQ    256,DU
         2 000712   000724 600000 2                  TZE     s:11679

      467    11673    2                THEN SETMSG.FLAGS.DEBUG = '1'B;

  11673  2 000713   000001 236003                    LDQ     1,DU
         2 000714   100022 256100                    ORSQ    18,,PR1
         2 000715   000724 710000 2                  TRA     s:11679

      468    11674    2                ELSE ;
      469    11675    2           ELSE IF (S$CU$->B$U.FLG & %U_DELA)

  11675  2 000716   000000 475400 xsym               LDP5    S$CU$
         2 000717   500000 236100                    LDQ     0,,PR5
         2 000720   000067 376000 1                  ANQ     FPT_FIDC+25
         2 000721   000724 600000 2                  TZE     s:11679

      470    11676    2                THEN SETMSG.FLAGS.DEBUG = '1'B;

PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:70   
  11676  2 000722   000001 236003                    LDQ     1,DU
         2 000723   100022 256100                    ORSQ    18,,PR1

      471    11677    2                ELSE ;
      472    11678    2           END;

      473    11679    1      DEBUG = SETMSG.FLAGS.DEBUG;

  11679  2 000724   100022 236100                    LDQ     18,,PR1
         2 000725   000021 736000                    QLS     17
         2 000726   400000 376003                    ANQ     -131072,DU
         2 000727   200005 756100                    STQ     DEBUG,,AUTO

      474    11680
      475    11681        /* Read the FPRG Head Record.
      476    11682        */
      477    11683    1      FPT_READ=KIF_FPT_READ;

  11683  2 000730   000100 100400                    MLR     fill='000'O
         2 000731   000000 000070 1                  ADSC9   KIF_FPT_READ             cn=0,n=56
         2 000732   200104 000070                    ADSC9   FPT_READ,,AUTO           cn=0,n=56

      478    11684    1      FPT_READ.V_=VECTOR(FPT_READ.V);

  11684  2 000733   000020 235000 3                  LDA     16
         2 000734   200210 452500                    STP2    DLDCT$+2,,AUTO
         2 000735   200210 236100                    LDQ     DLDCT$+2,,AUTO
         2 000736   000114 036003                    ADLQ    76,DU
         2 000737   200104 757100                    STAQ    FPT_READ,,AUTO

      479    11685    1      FPT_READ.BUF_.BOUND=4095;

  11685  2 000740   200110 236100                    LDQ     FPT_READ+4,,AUTO
         2 000741   177777 376007                    ANQ     65535,DL
         2 000742   000021 276000 3                  ORQ     17
         2 000743   200110 756100                    STQ     FPT_READ+4,,AUTO

PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:71   
      480    11686    1      FPT_READ.V.DCB# = LMDCB#;

  11686  2 000744   200021 720100                    LXL0    LMDCB#,,AUTO
         2 000745   200114 740100                    STX0    FPT_READ+8,,AUTO

      481    11687    1      FPT_READ.BUF_.BUF$=BF$;

  11687  2 000746   200036 236100                    LDQ     BF$,,AUTO
         2 000747   200111 756100                    STQ     FPT_READ+5,,AUTO

      482    11688    1      FPT_READ.KEY_=VECTOR(KIF_HDKEY);

  11688  2 000750   000022 237000 3                  LDAQ    18
         2 000751   200106 757100                    STAQ    FPT_READ+2,,AUTO

      483    11689    1      CALL M$MREAD (FPT_READ) ALTRET(BAD_HEAD);

  11689  2 000752   200104 634500                    EPPR4   FPT_READ,,AUTO
         2 000753   200210 454500                    STP4    DLDCT$+2,,AUTO
         2 000754   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 000755   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000756   000000 701000 xent               TSX1    M$MREAD
         2 000757   000764 702000 2                  TSX2    BAD_HEAD

      484    11690
      485    11691    1      IF LMDCB$->F$DCB.ARS ~= LENGTHC(B$HEAD)

  11691  2 000760   200020 470500                    LDP0    LMDCB$,,AUTO
         2 000761   000000 235100                    LDA     0,,PR0
         2 000762   000240 115007                    CMPA    160,DL
         2 000763   000767 600000 2                  TZE     s:11702

      486    11692    2      THEN DO;

  11688  2 000764                       BAD_HEAD     null
      487    11693    2   BAD_HEAD: ;
      488    11694    2           MYERR=KIF_BADHEAD;
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:72   

  11694  2 000764   000026 236000 1                  LDQ     KIF_BADHEAD
         2 000765   200035 756100                    STQ     MYERR,,AUTO

      489    11695    2           GOTO XIT;

  11695  2 000766   002134 710000 2                  TRA     XIT

      490    11696    2           END;
      491    11697        /*E* ERROR: KIF-%E$BADHEAD-E
      492    11698             MESSAGE: The head record does not exist or is not the proper size.
      493    11699        */
      494    11700
      495    11701        /* Make sure the rununit is the proper flavor */
      496    11702    1      IF B$HEAD.FLAVOR~=%FEP_RU

  11702  2 000767   200036 471500                    LDP1    BF$,,AUTO
         2 000770   100022 236100                    LDQ     18,,PR1
         2 000771   777000 376003                    ANQ     -512,DU
         2 000772   002000 116003                    CMPQ    1024,DU
         2 000773   000777 600000 2                  TZE     s:11713

      497    11703    2      THEN DO;

      498    11704    2           MYERR=KIF_NONFP;

  11704  2 000774   000030 236000 1                  LDQ     KIF_NONFP
         2 000775   200035 756100                    STQ     MYERR,,AUTO

      499    11705    2           GOTO XIT;

  11705  2 000776   002134 710000 2                  TRA     XIT

      500    11706    2           END;
      501    11707        /*E*  ERROR:    KIF-E$NONFP-E
      502    11708              MESSAGE:  That is no FEP program!
      503    11709              MESSAGE1: The file described on an M$SETFP service must be a FEP run unit.
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:73   
      504    11710        */
      505    11711
      506    11712        /* Check if the lock matches */
      507    11713    1      IF B$HEAD.RESTPROC

  11713  2 000777   100022 236100                    LDQ     18,,PR1
         2 001000   400000 316007                    CANQ    -131072,DL
         2 001001   001031 600000 2                  TZE     s:11729

      508    11714    1      THEN IF (B$HEAD.STRONG_LOCK

  11714  2 001002   200000 316007                    CANQ    65536,DL
         2 001003   001017 600000 2                  TZE     s:11714+13
         2 001004   000000 473400 xsym               LDP3    B$JIT$
         2 001005   000100 100500                    MLR     fill='000'O
         2 001006   100020 000010                    ADSC9   16,,PR1                  cn=0,n=8
         2 001007   200210 000010                    ADSC9   DLDCT$+2,,AUTO           cn=0,n=8
         2 001010   200210 237100                    LDAQ    DLDCT$+2,,AUTO
         2 001011   300154 377100                    ANAQ    108,,PR3
         2 001012   200212 757100                    STAQ    DLDCT$+4,,AUTO
         2 001013   000100 106500                    CMPC    fill='000'O
         2 001014   200212 000010                    ADSC9   DLDCT$+4,,AUTO           cn=0,n=8
         2 001015   100020 000010                    ADSC9   16,,PR1                  cn=0,n=8
         2 001016   001026 601000 2                  TNZ     s:11718
         2 001017   000000 473400 xsym               LDP3    B$JIT$
         2 001020   000100 100500                    MLR     fill='000'O
         2 001021   100020 000010                    ADSC9   16,,PR1                  cn=0,n=8
         2 001022   200214 000010                    ADSC9   DLDCT$+6,,AUTO           cn=0,n=8
         2 001023   200214 237100                    LDAQ    DLDCT$+6,,AUTO
         2 001024   300154 377100                    ANAQ    108,,PR3
         2 001025   001031 601000 2                  TNZ     s:11729

      509    11715    1             AND ((B$HEAD.LOCK&B$JIT.LOCK)~=B$HEAD.LOCK))
      510    11716    1             OR NOT (B$HEAD.LOCK & B$JIT.LOCK)
      511    11717    2           THEN DO;

      512    11718    2                MYERR=REST;
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:74   

  11718  2 001026   000021 236000 1                  LDQ     REST
         2 001027   200035 756100                    STQ     MYERR,,AUTO

      513    11719    2                GOTO XIT;

  11719  2 001030   002134 710000 2                  TRA     XIT

      514    11720    2                END;
      515    11721        /*E* ERROR: KIF-%E$RESTRICTED-E
      516    11722             MESSAGE: The FEP run unit is restricted.
      517    11723             DESCRIPTION: The locks do not match for the rununit and the user.
      518    11724         */
      519    11725
      520    11726        /* If this is an M$LDTRC to a uFPL run-unit, bypass sending run-unit
      521    11727           info to the fep and jump into the logic to switch to TPFP.:SYS
      522    11728        */
      523    11729    1      IF LDTRC AND LDTRCMSG.F1

  11729  2 001031   200010 234100                    SZN     LDTRC,,AUTO
         2 001032   001037 605000 2                  TPL     s:11734
         2 001033   200037 473500                    LDP3    BF2$,,AUTO
         2 001034   300000 236100                    LDQ     0,,PR3
         2 001035   000200 316003                    CANQ    128,DU
         2 001036   001702 601000 2                  TNZ     ITS_MICROFPL

      524    11730    1      THEN GOTO ITS_MICROFPL;
      525    11731
      526    11732        /* Fill HEAD record info into SETMSG and write SETMSG to the FEP
      527    11733        */
      528    11734    1      SETMSG.LIB_NAME = B$HEAD.LIBNAME;

  11734  2 001037   200037 473500                    LDP3    BF2$,,AUTO
         2 001040   000100 100500                    MLR     fill='000'O
         2 001041   100030 000040                    ADSC9   24,,PR1                  cn=0,n=32
         2 001042   300033 000040                    ADSC9   27,,PR3                  cn=0,n=32

PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:75   
      529    11735    1      SETMSG.PSEUDO_TEXT = B$HEAD.PSEUDO_TEXT;

  11735  2 001043   040100 100500                    MLR     fill='040'O
         2 001044   100024 000010                    ADSC9   20,,PR1                  cn=0,n=8
         2 001045   300023 000010                    ADSC9   19,,PR3                  cn=0,n=8

      530    11736    1      SETMSG.PSEUDO_COUNT = B$HEAD.PSEUDO_COUNT;

  11736  2 001046   100023 236100                    LDQ     19,,PR1
         2 001047   000022 772000                    QRL     18
         2 001050   300022 552110                    STBQ    18,'10'O,PR3

      531    11737    1      SETMSG.VERSION = B$HEAD.VERSION#;

  11737  2 001051   100011 236100                    LDQ     9,,PR1
         2 001052   000033 772000                    QRL     27
         2 001053   300022 552104                    STBQ    18,'04'O,PR3

      532    11738    1      IF SYSFLAG

  11738  2 001054   200007 234100                    SZN     SYSFLAG,,AUTO
         2 001055   001114 605000 2                  TPL     s:11749

      533    11739    2      THEN DO;

      534    11740    2           SETMSG.PRIV = (B$HEAD.PRIV & %PR_LCP6#);

  11740  2 001056   100000 236100                    LDQ     0,,PR1
         2 001057   000070 376000 1                  ANQ     FPT_FIDC+26
         2 001060   300021 756100                    STQ     17,,PR3

      535    11741    2           IF (B$HEAD.PRIV & %PR_EXPM#)

  11741  2 001061   100000 236100                    LDQ     0,,PR1
         2 001062   000071 376000 1                  ANQ     FPT_FIDC+27
         2 001063   001067 600000 2                  TZE     s:11743

PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:76   
      536    11742    2           THEN SETMSG.PRIV = (SETMSG.PRIV | %PR_FEXPM#);

  11742  2 001064   300021 236100                    LDQ     17,,PR3
         2 001065   000017 276000 xsym               ORQ     B_VECTNIL+15
         2 001066   300021 756100                    STQ     17,,PR3

      537    11743    2           IF (B$HEAD.PRIV & %PR_GPP#)

  11743  2 001067   100000 236100                    LDQ     0,,PR1
         2 001070   000072 376000 1                  ANQ     FPT_FIDC+28
         2 001071   001075 600000 2                  TZE     s:11745

      538    11744    2           THEN SETMSG.PRIV = (SETMSG.PRIV | %PR_FGPP#);

  11744  2 001072   300021 236100                    LDQ     17,,PR3
         2 001073   000020 276000 xsym               ORQ     B_VECTNIL+16
         2 001074   300021 756100                    STQ     17,,PR3

      539    11745    2           SETMSG.FLAGS.PROCACC = B$HEAD.PROCACC;

  11745  2 001075   100022 236100                    LDQ     18,,PR1
         2 001076   000011 736000                    QLS     9
         2 001077   300022 676100                    ERQ     18,,PR3
         2 001100   004000 376003                    ANQ     2048,DU
         2 001101   300022 656100                    ERSQ    18,,PR3

      540    11746    2           SETMSG.FLAGS.PROCSURCHG=B$HEAD.PROCSURCHG;

  11746  2 001102   100022 236100                    LDQ     18,,PR1
         2 001103   000011 736000                    QLS     9
         2 001104   300022 676100                    ERQ     18,,PR3
         2 001105   001000 376003                    ANQ     512,DU
         2 001106   300022 656100                    ERSQ    18,,PR3

      541    11747    2           SETMSG.FLAGS.NOCHRPMEM = B$HEAD.NOCHGPMEM;

  11747  2 001107   100022 236100                    LDQ     18,,PR1
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:77   
         2 001110   000011 736000                    QLS     9
         2 001111   300022 676100                    ERQ     18,,PR3
         2 001112   002000 376003                    ANQ     1024,DU
         2 001113   300022 656100                    ERSQ    18,,PR3

      542    11748    2           END;

      543    11749    1      SETMSG.FLAGS.S = B$HEAD.S;

  11749  2 001114   100022 236100                    LDQ     18,,PR1
         2 001115   000010 736000                    QLS     8
         2 001116   300022 676100                    ERQ     18,,PR3
         2 001117   200000 376003                    ANQ     65536,DU
         2 001120   300022 656100                    ERSQ    18,,PR3

      544    11750    1      SETMSG.FLAGS.LIB = B$HEAD.LIB;

  11750  2 001121   100022 236100                    LDQ     18,,PR1
         2 001122   000010 736000                    QLS     8
         2 001123   300022 676100                    ERQ     18,,PR3
         2 001124   100000 376003                    ANQ     32768,DU
         2 001125   300022 656100                    ERSQ    18,,PR3

      545    11751    1      SETMSG.FLAGS.CMDPROC=B$HEAD.CMDPROC;

  11751  2 001126   100022 236100                    LDQ     18,,PR1
         2 001127   000010 736000                    QLS     8
         2 001130   300022 676100                    ERQ     18,,PR3
         2 001131   020000 376003                    ANQ     8192,DU
         2 001132   300022 656100                    ERSQ    18,,PR3

      546    11752    1      SETMSG.FLAGS.DEBUGGER=B$HEAD.DEBUGGER;

  11752  2 001133   100022 236100                    LDQ     18,,PR1
         2 001134   000010 736000                    QLS     8
         2 001135   300022 676100                    ERQ     18,,PR3
         2 001136   010000 376003                    ANQ     4096,DU
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:78   
         2 001137   300022 656100                    ERSQ    18,,PR3

      547    11753    1      SETMSG.FLAGS.LAUTO=B$HEAD.LAUTO;

  11753  2 001140   100011 236100                    LDQ     9,,PR1
         2 001141   000022 736000                    QLS     18
         2 001142   300022 676100                    ERQ     18,,PR3
         2 001143   000004 376003                    ANQ     4,DU
         2 001144   300022 656100                    ERSQ    18,,PR3

      548    11754    1      IF CCBUFL ~= 0

  11754  2 001145   200014 235100                    LDA     CCBUFL,,AUTO
         2 001146   001151 600000 2                  TZE     s:11756

      549    11755    1      THEN SETMSG.FLAGS.CCBUF = '1'B;

  11755  2 001147   000002 236003                    LDQ     2,DU
         2 001150   300022 256100                    ORSQ    18,,PR3

      550    11756    1      CALL KIA$9TO8(B$HEAD.UDCBNUM,SETMSG.UDCBNUM,2);

  11756  2 001151   000024 236000 3                  LDQ     20
         2 001152   200212 756100                    STQ     DLDCT$+4,,AUTO
         2 001153   200037 236100                    LDQ     BF2$,,AUTO
         2 001154   000025 036003                    ADLQ    21,DU
         2 001155   200211 756100                    STQ     DLDCT$+3,,AUTO
         2 001156   200036 236100                    LDQ     BF$,,AUTO
         2 001157   000004 036003                    ADLQ    4,DU
         2 001160   200210 756100                    STQ     DLDCT$+2,,AUTO
         2 001161   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 001162   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 001163   000000 701000 xent               TSX1    KIA$9TO8
         2 001164   000000 011000                    NOP     0

      551    11757    1      CALL KIA$9TO8(B$HEAD.DCBRES,SETMSG.DCBRES,2);

PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:79   
  11757  2 001165   000024 236000 3                  LDQ     20
         2 001166   200212 756100                    STQ     DLDCT$+4,,AUTO
         2 001167   200037 236100                    LDQ     BF2$,,AUTO
         2 001170   000025 036000 3                  ADLQ    21
         2 001171   200211 756100                    STQ     DLDCT$+3,,AUTO
         2 001172   200036 236100                    LDQ     BF$,,AUTO
         2 001173   000026 036000 3                  ADLQ    22
         2 001174   200210 756100                    STQ     DLDCT$+2,,AUTO
         2 001175   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 001176   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 001177   000000 701000 xent               TSX1    KIA$9TO8
         2 001200   000000 011000                    NOP     0

      552    11758    1      CALL KIA$9TO8(B$HEAD.TCBSIZE,SETMSG.TCBSIZE,2);

  11758  2 001201   000024 236000 3                  LDQ     20
         2 001202   200212 756100                    STQ     DLDCT$+4,,AUTO
         2 001203   200037 236100                    LDQ     BF2$,,AUTO
         2 001204   000026 036003                    ADLQ    22,DU
         2 001205   200211 756100                    STQ     DLDCT$+3,,AUTO
         2 001206   200036 236100                    LDQ     BF$,,AUTO
         2 001207   000027 036000 3                  ADLQ    23
         2 001210   200210 756100                    STQ     DLDCT$+2,,AUTO
         2 001211   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 001212   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 001213   000000 701000 xent               TSX1    KIA$9TO8
         2 001214   000000 011000                    NOP     0

      553    11759    1      TEMP=B$HEAD.START;

  11759  2 001215   200036 470500                    LDP0    BF$,,AUTO
         2 001216   000003 236100                    LDQ     3,,PR0
         2 001217   000030 376000 3                  ANQ     24
         2 001220   200024 756100                    STQ     TEMP,,AUTO

      554    11760    1      CALL KIA$9TO8(TEMP,SETMSG.START,4);

PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:80   
  11760  2 001221   000016 236000 3                  LDQ     14
         2 001222   200212 756100                    STQ     DLDCT$+4,,AUTO
         2 001223   200037 236100                    LDQ     BF2$,,AUTO
         2 001224   000020 036003                    ADLQ    16,DU
         2 001225   200211 756100                    STQ     DLDCT$+3,,AUTO
         2 001226   200024 631500                    EPPR1   TEMP,,AUTO
         2 001227   200210 451500                    STP1    DLDCT$+2,,AUTO
         2 001230   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 001231   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 001232   000000 701000 xent               TSX1    KIA$9TO8
         2 001233   000000 011000                    NOP     0

      555    11761    1      TEMP=B$HEAD.VPPGS;

  11761  2 001234   200036 470500                    LDP0    BF$,,AUTO
         2 001235   000001 236100                    LDQ     1,,PR0
         2 001236   000026 772000                    QRL     22
         2 001237   200024 756100                    STQ     TEMP,,AUTO

      556    11762    1      CALL KIA$9TO8(TEMPA(1),SETMSG.VPPGS,2);

  11762  2 001240   000024 236000 3                  LDQ     20
         2 001241   200212 756100                    STQ     DLDCT$+4,,AUTO
         2 001242   200037 236100                    LDQ     BF2$,,AUTO
         2 001243   000031 036000 3                  ADLQ    25
         2 001244   200211 756100                    STQ     DLDCT$+3,,AUTO
         2 001245   200213 452500                    STP2    DLDCT$+5,,AUTO
         2 001246   200213 236100                    LDQ     DLDCT$+5,,AUTO
         2 001247   000032 036000 3                  ADLQ    26
         2 001250   200210 756100                    STQ     DLDCT$+2,,AUTO
         2 001251   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 001252   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 001253   000000 701000 xent               TSX1    KIA$9TO8
         2 001254   000000 011000                    NOP     0

      557    11763    1      TEMP=B$HEAD.VDPGS;

PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:81   
  11763  2 001255   200036 470500                    LDP0    BF$,,AUTO
         2 001256   000002 236100                    LDQ     2,,PR0
         2 001257   000026 772000                    QRL     22
         2 001260   200024 756100                    STQ     TEMP,,AUTO

      558    11764    1      CALL KIA$9TO8(TEMPA(1),SETMSG.VDPGS,2);

  11764  2 001261   000024 236000 3                  LDQ     20
         2 001262   200212 756100                    STQ     DLDCT$+4,,AUTO
         2 001263   200037 236100                    LDQ     BF2$,,AUTO
         2 001264   000027 036003                    ADLQ    23,DU
         2 001265   200211 756100                    STQ     DLDCT$+3,,AUTO
         2 001266   200213 452500                    STP2    DLDCT$+5,,AUTO
         2 001267   200213 236100                    LDQ     DLDCT$+5,,AUTO
         2 001270   000032 036000 3                  ADLQ    26
         2 001271   200210 756100                    STQ     DLDCT$+2,,AUTO
         2 001272   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 001273   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 001274   000000 701000 xent               TSX1    KIA$9TO8
         2 001275   000000 011000                    NOP     0

      559    11765    1      TEMP=B$HEAD.ROSIZE;

  11765  2 001276   200036 470500                    LDP0    BF$,,AUTO
         2 001277   000010 236100                    LDQ     8,,PR0
         2 001300   777777 376007                    ANQ     -1,DL
         2 001301   200024 756100                    STQ     TEMP,,AUTO

      560    11766    1      CALL KIA$9TO8(TEMPA(1),SETMSG.ROS_SZ,2);

  11766  2 001302   000024 236000 3                  LDQ     20
         2 001303   200212 756100                    STQ     DLDCT$+4,,AUTO
         2 001304   200037 236100                    LDQ     BF2$,,AUTO
         2 001305   000033 036000 3                  ADLQ    27
         2 001306   200211 756100                    STQ     DLDCT$+3,,AUTO
         2 001307   200213 452500                    STP2    DLDCT$+5,,AUTO
         2 001310   200213 236100                    LDQ     DLDCT$+5,,AUTO
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:82   
         2 001311   000032 036000 3                  ADLQ    26
         2 001312   200210 756100                    STQ     DLDCT$+2,,AUTO
         2 001313   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 001314   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 001315   000000 701000 xent               TSX1    KIA$9TO8
         2 001316   000000 011000                    NOP     0

      561    11767    1      TEMP=B$HEAD.RDATA;

  11767  2 001317   200036 470500                    LDP0    BF$,,AUTO
         2 001320   000002 236100                    LDQ     2,,PR0
         2 001321   000030 376000 3                  ANQ     24
         2 001322   200024 756100                    STQ     TEMP,,AUTO

      562    11768    1      CALL KIA$9TO8(TEMP,SETMSG.DATA_SZ,4);

  11768  2 001323   000016 236000 3                  LDQ     14
         2 001324   200212 756100                    STQ     DLDCT$+4,,AUTO
         2 001325   200037 236100                    LDQ     BF2$,,AUTO
         2 001326   000030 036003                    ADLQ    24,DU
         2 001327   200211 756100                    STQ     DLDCT$+3,,AUTO
         2 001330   200024 631500                    EPPR1   TEMP,,AUTO
         2 001331   200210 451500                    STP1    DLDCT$+2,,AUTO
         2 001332   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 001333   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 001334   000000 701000 xent               TSX1    KIA$9TO8
         2 001335   000000 011000                    NOP     0

      563    11769    1      TEMP=B$HEAD.RPROC;

  11769  2 001336   200036 470500                    LDP0    BF$,,AUTO
         2 001337   000001 236100                    LDQ     1,,PR0
         2 001340   000030 376000 3                  ANQ     24
         2 001341   200024 756100                    STQ     TEMP,,AUTO

      564    11770    1      CALL KIA$9TO8(TEMP,SETMSG.PROC_SZ,4);

PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:83   
  11770  2 001342   000016 236000 3                  LDQ     14
         2 001343   200212 756100                    STQ     DLDCT$+4,,AUTO
         2 001344   200037 236100                    LDQ     BF2$,,AUTO
         2 001345   000031 036003                    ADLQ    25,DU
         2 001346   200211 756100                    STQ     DLDCT$+3,,AUTO
         2 001347   200024 631500                    EPPR1   TEMP,,AUTO
         2 001350   200210 451500                    STP1    DLDCT$+2,,AUTO
         2 001351   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 001352   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 001353   000000 701000 xent               TSX1    KIA$9TO8
         2 001354   000000 011000                    NOP     0

      565    11771    1      TEMP=B$HEAD.BIAS;

  11771  2 001355   200036 470500                    LDP0    BF$,,AUTO
         2 001356   000023 236100                    LDQ     19,,PR0
         2 001357   000030 376000 3                  ANQ     24
         2 001360   200024 756100                    STQ     TEMP,,AUTO

      566    11772    1      CALL KIA$9TO8(TEMP,SETMSG.DATA_BIAS,4);

  11772  2 001361   000016 236000 3                  LDQ     14
         2 001362   200212 756100                    STQ     DLDCT$+4,,AUTO
         2 001363   200037 236100                    LDQ     BF2$,,AUTO
         2 001364   000032 036003                    ADLQ    26,DU
         2 001365   200211 756100                    STQ     DLDCT$+3,,AUTO
         2 001366   200024 631500                    EPPR1   TEMP,,AUTO
         2 001367   200210 451500                    STP1    DLDCT$+2,,AUTO
         2 001370   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 001371   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 001372   000000 701000 xent               TSX1    KIA$9TO8
         2 001373   000000 011000                    NOP     0

      567    11773    1      DID_SETFP = '1'B;

  11773  2 001374   400000 236003                    LDQ     -131072,DU
         2 001375   200012 756100                    STQ     DID_SETFP,,AUTO
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:84   

      568    11774
      569    11775    1      CALL KIF$WRITE(LDCT,SETMSG,LENGTHC(SETMSG))

  11775  2 001376   000035 236000 3                  LDQ     29
         2 001377   200212 756100                    STQ     DLDCT$+4,,AUTO
         2 001400   200037 236100                    LDQ     BF2$,,AUTO
         2 001401   200022 235100                    LDA     LDCT$,,AUTO
         2 001402   200210 757100                    STAQ    DLDCT$+2,,AUTO
         2 001403   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 001404   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 001405   000000 701000 xent               TSX1    KIF$WRITE
         2 001406   001410 702000 2                  TSX2    s:11777
         2 001407   001414 710000 2                  TRA     s:11807

      570    11776    2      WHENALTRETURN DO;

      571    11777    2           MYERR = B$JIT.ERR;

  11777  2 001410   000000 470400 xsym               LDP0    B$JIT$
         2 001411   000012 236100                    LDQ     10,,PR0
         2 001412   200035 756100                    STQ     MYERR,,AUTO

      572    11778    2           GOTO XIT;

  11778  2 001413   002134 710000 2                  TRA     XIT

      573    11779    2           END;
      574    11780
      575    11781        /*E*  ERROR:    KIF-E$LDSC-E
      576    11782              MESSAGE:  M$SETFP aborted - station disconnected
      577    11783              DESCRIPTION: The station the FPRG was being attached to
      578    11784                           disconnected during the PMME                              */
      579    11785        /*E*  ERROR:    KIF-E$DACTR-E
      580    11786              MESSAGE:  M$SETFP aborted - you are deactivated
      581    11787              DESCRIPTION: The AU deactivated him during the pmme or he
      582    11788                           was already deactivated when he did it.                   */
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:85   
      583    11789        /*E*  ERROR:    KIF-E$CGKEYV-E
      584    11790              MESSAGE:  M$SETFP aborted - station not defined
      585    11791              DESCRIPTION: XSTALGL = 0 and this station isn't defined.
      586    11792                           See VLP_CGSTAL.                                           */
      587    11793        /*E*  ERROR:    KIF-E$CGFULL-E
      588    11794              MESSAGE:  M$SETFP aborted - comgroup queue full
      589    11795              DESCRIPTION: Comgroup is out of space                                  */
      590    11796        /*E*  ERROR:    KIF-E$CGCRCW-E
      591    11797              MESSAGE:  M$SETFP aborted - latch violation
      592    11798              DESCRIPTION: An attempt to read without completing the
      593    11799                           the continued Latched write.                              */
      594    11800        /*E* ERROR: KIF-E$BYDR-E
      595    11801             MESSAGE: M$SETFP interrupted by asynchronous event.
      596    11802             DESCRIPTION: A comgroup read was interrupted by break or ctl Y.         */
      597    11803        %EJECT;
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:86   
      598    11804        /* Sit here continually reading the front end for a message
      599    11805             and respond to it */
      600    11806
      601    11807    1      DONE='0'B;

  11807  2 001414   200011 450100                    STZ     DONE,,AUTO

      602    11808    2      DO WHILE (NOT DONE);

  11808  2 001415   002131 710000 2                  TRA     s:11927

      603    11809    2           CALL KIF$READ(LDCT,GJ_PROGKEY_MSG,LENGTHC(GJ_PROGKEY_MSG)) ALTRET(JITERR);

  11809  2 001416   000037 236000 3                  LDQ     31
         2 001417   200212 756100                    STQ     DLDCT$+4,,AUTO
         2 001420   200066 630500                    EPPR0   GJ_PROGKEY_MSG,,AUTO
         2 001421   200211 450500                    STP0    DLDCT$+3,,AUTO
         2 001422   200022 236100                    LDQ     LDCT$,,AUTO
         2 001423   200210 756100                    STQ     DLDCT$+2,,AUTO
         2 001424   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 001425   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 001426   000000 701000 xent               TSX1    KIF$READ
         2 001427   000340 702000 2                  TSX2    JITERR

      604    11810    3           DO CASE (GJ_PROGKEY_MSG.FCN);

  11810  2 001430   200066 236100                    LDQ     GJ_PROGKEY_MSG,,AUTO
         2 001431   000033 772000                    QRL     27
         2 001432   000036 116007                    CMPQ    30,DL
         2 001433   001435 602006 2                  TNC     s:11810+5,QL
         2 001434   002124 710000 2                  TRA     s:11922
         2 001435   002124 710000 2                  TRA     s:11922
         2 001436   001473 710000 2                  TRA     s:11813
         2 001437   002124 710000 2                  TRA     s:11922
         2 001440   002124 710000 2                  TRA     s:11922
         2 001441   002124 710000 2                  TRA     s:11922
         2 001442   002041 710000 2                  TRA     s:11890
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:87   
         2 001443   002124 710000 2                  TRA     s:11922
         2 001444   002023 710000 2                  TRA     s:11885
         2 001445   002124 710000 2                  TRA     s:11922
         2 001446   002124 710000 2                  TRA     s:11922
         2 001447   001772 710000 2                  TRA     s:11877
         2 001450   001662 710000 2                  TRA     s:11847
         2 001451   002124 710000 2                  TRA     s:11922
         2 001452   002124 710000 2                  TRA     s:11922
         2 001453   002124 710000 2                  TRA     s:11922
         2 001454   002124 710000 2                  TRA     s:11922
         2 001455   002124 710000 2                  TRA     s:11922
         2 001456   002124 710000 2                  TRA     s:11922
         2 001457   002124 710000 2                  TRA     s:11922
         2 001460   002124 710000 2                  TRA     s:11922
         2 001461   002124 710000 2                  TRA     s:11922
         2 001462   001702 710000 2                  TRA     ITS_MICROFPL
         2 001463   002124 710000 2                  TRA     s:11922
         2 001464   002124 710000 2                  TRA     s:11922
         2 001465   002124 710000 2                  TRA     s:11922
         2 001466   002124 710000 2                  TRA     s:11922
         2 001467   002124 710000 2                  TRA     s:11922
         2 001470   002124 710000 2                  TRA     s:11922
         2 001471   002124 710000 2                  TRA     s:11922
         2 001472   002023 710000 2                  TRA     s:11885

      605    11811    3            CASE (%GJ_GETPROG#);           /* Get record from rununit  */

      606    11812
      607    11813    3              FPT_READ.V.DCB#=LMDCB#;

  11813  2 001473   200021 720100                    LXL0    LMDCB#,,AUTO
         2 001474   200114 740100                    STX0    FPT_READ+8,,AUTO

      608    11814    3              FPT_READ.KEY_ = VECTOR(ADKEY);

  11814  2 001475   000006 235000 3                  LDA     6
         2 001476   200210 452500                    STP2    DLDCT$+2,,AUTO
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:88   
         2 001477   200210 236100                    LDQ     DLDCT$+2,,AUTO
         2 001500   000122 036003                    ADLQ    82,DU
         2 001501   200106 757100                    STAQ    FPT_READ+2,,AUTO

      609    11815    3              ADKEY = '0'B;

  11815  2 001502   200122 450100                    STZ     ADKEY,,AUTO
         2 001503   200123 450100                    STZ     ADKEY+1,,AUTO

      610    11816    3              ADKEY.KEYSIZ = GJ_PROGKEY_MSG.RU_KEY.KEYSIZ;

  11816  2 001504   200067 236100                    LDQ     GJ_PROGKEY_MSG+1,,AUTO
         2 001505   000022 736000                    QLS     18
         2 001506   200122 552140                    STBQ    ADKEY,'40'O,AUTO

      611    11817    3              ADKEY.TYPE = GJ_PROGKEY_MSG.RU_KEY.TYPE;

  11817  2 001507   200067 236100                    LDQ     GJ_PROGKEY_MSG+1,,AUTO
         2 001510   000022 736000                    QLS     18
         2 001511   200122 552120                    STBQ    ADKEY,'20'O,AUTO

      612    11818    3              CALL KIA$8TO9(GJ_PROGKEY_MSG.RU_KEY.PAGE,TEMP,4);

  11818  2 001512   000016 236000 3                  LDQ     14
         2 001513   200212 756100                    STQ     DLDCT$+4,,AUTO
         2 001514   200024 630500                    EPPR0   TEMP,,AUTO
         2 001515   200211 450500                    STP0    DLDCT$+3,,AUTO
         2 001516   200070 631500                    EPPR1   GJ_PROGKEY_MSG+2,,AUTO
         2 001517   200210 451500                    STP1    DLDCT$+2,,AUTO
         2 001520   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 001521   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 001522   000000 701000 xent               TSX1    KIA$8TO9
         2 001523   000000 011000                    NOP     0

      613    11819    3              ADKEY.PAGE=TEMP;

  11819  2 001524   003100 061500                    CSR     bolr='003'O
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:89   
         2 001525   200024 000044                    BDSC    TEMP,,AUTO               by=0,bit=0,n=36
         2 001526   200122 670024                    BDSC    ADKEY,,AUTO              by=3,bit=7,n=20

      614    11820    3              CALL KIA$8TO9(GJ_PROGKEY_MSG.READ_BYSZ,WRITE_BYSZ,4);

  11820  2 001527   000016 236000 3                  LDQ     14
         2 001530   200212 756100                    STQ     DLDCT$+4,,AUTO
         2 001531   200027 630500                    EPPR0   WRITE_BYSZ,,AUTO
         2 001532   200211 450500                    STP0    DLDCT$+3,,AUTO
         2 001533   200071 631500                    EPPR1   GJ_PROGKEY_MSG+3,,AUTO
         2 001534   200210 451500                    STP1    DLDCT$+2,,AUTO
         2 001535   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 001536   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 001537   000000 701000 xent               TSX1    KIA$8TO9
         2 001540   000000 011000                    NOP     0

      615    11821    3              CALL KIA$8TO9(GJ_PROGKEY_MSG.SECT_BYSZ,TOTAL_BYSZ,4);

  11821  2 001541   000016 236000 3                  LDQ     14
         2 001542   200212 756100                    STQ     DLDCT$+4,,AUTO
         2 001543   200030 630500                    EPPR0   TOTAL_BYSZ,,AUTO
         2 001544   200211 450500                    STP0    DLDCT$+3,,AUTO
         2 001545   200072 631500                    EPPR1   GJ_PROGKEY_MSG+4,,AUTO
         2 001546   200210 451500                    STP1    DLDCT$+2,,AUTO
         2 001547   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 001550   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 001551   000000 701000 xent               TSX1    KIA$8TO9
         2 001552   000000 011000                    NOP     0

      616    11822    3              N_READS = (TOTAL_BYSZ +4096 -1) / 4096;

  11822  2 001553   200030 236100                    LDQ     TOTAL_BYSZ,,AUTO
         2 001554   007777 036007                    ADLQ    4095,DL
         2 001555   010000 506007                    DIV     4096,DL
         2 001556   200032 756100                    STQ     N_READS,,AUTO

      617    11823
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:90   
      618    11824    4              DO TEMP = 1 TO N_READS;

  11824  2 001557   000001 235007                    LDA     1,DL
         2 001560   200024 755100                    STA     TEMP,,AUTO
         2 001561   001656 710000 2                  TRA     s:11844+1

      619    11825    4                   CALL M$MREAD (FPT_READ)

  11825  2 001562   200104 630500                    EPPR0   FPT_READ,,AUTO
         2 001563   200210 450500                    STP0    DLDCT$+2,,AUTO
         2 001564   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 001565   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001566   000000 701000 xent               TSX1    M$MREAD
         2 001567   001571 702000 2                  TSX2    s:11827
         2 001570   001574 710000 2                  TRA     s:11829

      620    11826    5                   WHENALTRETURN DO;

      621    11827    5                        MYERR = B$JIT.ERR;

  11827  2 001571   000000 470400 xsym               LDP0    B$JIT$
         2 001572   000012 236100                    LDQ     10,,PR0
         2 001573   200035 756100                    STQ     MYERR,,AUTO

      622    11828    5                        END;

      623    11829    4                   BF2$ = BF$;

  11829  2 001574   200036 236100                    LDQ     BF$,,AUTO
         2 001575   200037 756100                    STQ     BF2$,,AUTO

      624    11830    4                   RECORD_BYSZ = MINIMUM(TOTAL_BYSZ,4096);

  11830  2 001576   010000 236007                    LDQ     4096,DL
         2 001577   001602 604000 2                  TMI     s:11830+4
         2 001600   200030 116100                    CMPQ    TOTAL_BYSZ,,AUTO
         2 001601   001603 604400 2                  TMOZ    s:11830+5
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:91   
         2 001602   200030 236100                    LDQ     TOTAL_BYSZ,,AUTO
         2 001603   200031 756100                    STQ     RECORD_BYSZ,,AUTO

      625    11831    4                   TOTAL_BYSZ = TOTAL_BYSZ - RECORD_BYSZ;

  11831  2 001604   200030 236100                    LDQ     TOTAL_BYSZ,,AUTO
         2 001605   200031 136100                    SBLQ    RECORD_BYSZ,,AUTO
         2 001606   200030 756100                    STQ     TOTAL_BYSZ,,AUTO

      626    11832
      627    11833    5                   DO WHILE RECORD_BYSZ > 0;

  11833  2 001607   200031 235100                    LDA     RECORD_BYSZ,,AUTO
         2 001610   001644 604400 2                  TMOZ    s:11843

      628    11834    5                        IF WRITE_BYSZ > RECORD_BYSZ THEN WRITE_BYSZ = RECORD_BYSZ;

  11834  2 001611   200027 236100                    LDQ     WRITE_BYSZ,,AUTO
         2 001612   200031 116100                    CMPQ    RECORD_BYSZ,,AUTO
         2 001613   001616 604400 2                  TMOZ    s:11835

  11834  2 001614   200031 235100                    LDA     RECORD_BYSZ,,AUTO
         2 001615   200027 755100                    STA     WRITE_BYSZ,,AUTO

      629    11835    5                        CALL KIF$WRITE(LDCT,BF2$->CHAR$1,WRITE_BYSZ)

  11835  2 001616   200027 630500                    EPPR0   WRITE_BYSZ,,AUTO
         2 001617   200212 450500                    STP0    DLDCT$+4,,AUTO
         2 001620   200037 236100                    LDQ     BF2$,,AUTO
         2 001621   200022 235100                    LDA     LDCT$,,AUTO
         2 001622   200210 757100                    STAQ    DLDCT$+2,,AUTO
         2 001623   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 001624   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 001625   000000 701000 xent               TSX1    KIF$WRITE
         2 001626   001630 702000 2                  TSX2    s:11837
         2 001627   001633 710000 2                  TRA     s:11840

PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:92   
      630    11836    6                        WHENALTRETURN DO;

      631    11837    6                             MYERR = B$JIT.ERR;

  11837  2 001630   000000 470400 xsym               LDP0    B$JIT$
         2 001631   000012 236100                    LDQ     10,,PR0
         2 001632   200035 756100                    STQ     MYERR,,AUTO

      632    11838    6                             END;

      633    11839
      634    11840    5                        BF2$ = PINCRW(BF2$,WRITE_BYSZ/4);

  11840  2 001633   200027 236100                    LDQ     WRITE_BYSZ,,AUTO
         2 001634   000004 506007                    DIV     4,DL
         2 001635   000022 736000                    QLS     18
         2 001636   200037 036100                    ADLQ    BF2$,,AUTO
         2 001637   200037 756100                    STQ     BF2$,,AUTO

      635    11841    5                        RECORD_BYSZ = RECORD_BYSZ - WRITE_BYSZ;

  11841  2 001640   200031 236100                    LDQ     RECORD_BYSZ,,AUTO
         2 001641   200027 136100                    SBLQ    WRITE_BYSZ,,AUTO
         2 001642   200031 756100                    STQ     RECORD_BYSZ,,AUTO

      636    11842    5                        END;

  11842  2 001643   001611 605400 2                  TPNZ    s:11834

      637    11843    4                   ADKEY.PAGE = ADKEY.PAGE + 2048;

  11843  2 001644   200122 235100                    LDA     ADKEY,,AUTO
         2 001645   200123 236100                    LDQ     ADKEY+1,,AUTO
         2 001646   000022 773000                    LRL     18
         2 001647   000030 376000 3                  ANQ     24
         2 001650   004000 036007                    ADLQ    2048,DL
         2 001651   200210 756100                    STQ     DLDCT$+2,,AUTO
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:93   
         2 001652   003100 061500                    CSR     bolr='003'O
         2 001653   200210 000044                    BDSC    DLDCT$+2,,AUTO           by=0,bit=0,n=36
         2 001654   200122 670024                    BDSC    ADKEY,,AUTO              by=3,bit=7,n=20

      638    11844    4                   END;

  11844  2 001655   200024 054100                    AOS     TEMP,,AUTO
         2 001656   200024 236100                    LDQ     TEMP,,AUTO
         2 001657   200032 116100                    CMPQ    N_READS,,AUTO
         2 001660   001562 604400 2                  TMOZ    s:11825
         2 001661   002131 710000 2                  TRA     s:11927

      639    11845
      640    11846    3            CASE (%GJ_LIB_DATA#);          /* Get library data         */

      641    11847    3              CALL KIF$SEND(LDCT,SETMSG.LIB_NAME,%GJ_LIB_DATA#)

  11847  2 001662   000040 236000 3                  LDQ     32
         2 001663   200212 756100                    STQ     DLDCT$+4,,AUTO
         2 001664   200037 236100                    LDQ     BF2$,,AUTO
         2 001665   000033 036003                    ADLQ    27,DU
         2 001666   200022 235100                    LDA     LDCT$,,AUTO
         2 001667   200210 757100                    STAQ    DLDCT$+2,,AUTO
         2 001670   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 001671   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 001672   000000 701000 xent               TSX1    KIF$SEND
         2 001673   001675 702000 2                  TSX2    s:11849
         2 001674   001701 710000 2                  TRA     s:11850+1

      642    11848    4              WHENALTRETURN DO;

      643    11849    4                   MYERR = B$JIT.ERR;

  11849  2 001675   000000 470400 xsym               LDP0    B$JIT$
         2 001676   000012 236100                    LDQ     10,,PR0
         2 001677   200035 756100                    STQ     MYERR,,AUTO

PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:94   
      644    11850    4                   GOTO XIT;

  11850  2 001700   002134 710000 2                  TRA     XIT
         2 001701   002131 710000 2                  TRA     s:11927

      645    11851    4                   END;
      646    11852
      647    11853    3            CASE (%GJ_MICROFPL#);          /* Switch to TPFP.:SYS      */

      648    11854    3   ITS_MICROFPL:
      649    11855    3              CCBUF_FPRG = VLP_FPRG;

  11855  2 001702   000100 100500       ITS_MICROFPL MLR     fill='000'O
         2 001703   200042 000104                    ADSC9   VLP_FPRG,,AUTO           cn=0,n=68
         2 001704   200150 000124                    ADSC9   CCBUF_FPRG,,AUTO         cn=0,n=84

      650    11856    3              CALL UMT$IDT2(LMDCB$->F$DCB.EXPIRE,

  11856  2 001705   200171 630500                    EPPR0   CCBUF_FPRG+17,,AUTO
         2 001706   200212 450500                    STP0    DLDCT$+4,,AUTO
         2 001707   200213 452500                    STP2    DLDCT$+5,,AUTO
         2 001710   200213 236100                    LDQ     DLDCT$+5,,AUTO
         2 001711   000041 036000 3                  ADLQ    33
         2 001712   200211 756100                    STQ     DLDCT$+3,,AUTO
         2 001713   200020 236100                    LDQ     LMDCB$,,AUTO
         2 001714   000035 036003                    ADLQ    29,DU
         2 001715   200210 756100                    STQ     DLDCT$+2,,AUTO
         2 001716   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 001717   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 001720   000000 701000 xent               TSX1    UMT$IDT2
         2 001721   000000 011000                    NOP     0

      651    11857    3                CCBUF_FPRG.MODTIME.DATE,
      652    11858    3                CCBUF_FPRG.MODTIME.TIME);
      653    11859
      654    11860    3              B$JIT.DCB$=LMDCB$;

PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:95   
  11860  2 001722   200020 236100                    LDQ     LMDCB$,,AUTO
         2 001723   000000 470400 xsym               LDP0    B$JIT$
         2 001724   000232 756100                    STQ     154,,PR0

      655    11861    3              CALL FMP$CLSJ;

  11861  2 001725   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 001726   000000 701000 xent               TSX1    FMP$CLSJ
         2 001727   000000 011000                    NOP     0

      656    11862    3              B$JIT.DCBNO = LMDCB$->F$DCB.DCB#;

  11862  2 001730   200020 470500                    LDP0    LMDCB$,,AUTO
         2 001731   000000 471400 xsym               LDP1    B$JIT$
         2 001732   000060 236100                    LDQ     48,,PR0
         2 001733   000033 772000                    QRL     27
         2 001734   100022 552104                    STBQ    18,'04'O,PR1

      657    11863    3              CALL FMM$SCRUB(B$JIT.DCB$);

  11863  2 001735   000000 236000 xsym               LDQ     B$JIT$
         2 001736   000232 036003                    ADLQ    154,DU
         2 001737   200210 756100                    STQ     DLDCT$+2,,AUTO
         2 001740   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 001741   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001742   000000 701000 xent               TSX1    FMM$SCRUB
         2 001743   000000 011000                    NOP     0

      658    11864    3              LMDCB$->F$DCB.DCB# = LMDCB#;

  11864  2 001744   200020 470500                    LDP0    LMDCB$,,AUTO
         2 001745   200021 236100                    LDQ     LMDCB#,,AUTO
         2 001746   000033 736000                    QLS     27
         2 001747   000060 552140                    STBQ    48,'40'O,PR0

      659    11865
      660    11866    3              VLP_FPRG = '0'B;
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:96   

  11866  2 001750   000100 100400                    MLR     fill='000'O
         2 001751   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         2 001752   200042 000104                    ADSC9   VLP_FPRG,,AUTO           cn=0,n=68

      661    11867    3              VLP_FPRG.NAME.L# = 4;

  11867  2 001753   004000 236003                    LDQ     2048,DU
         2 001754   200044 552140                    STBQ    VLP_FPRG+2,'40'O,AUTO

      662    11868    3              VLP_FPRG.NAME.C# = 'TPFP';

  11868  2 001755   040100 100400                    MLR     fill='040'O
         2 001756   000073 000004 1                  ADSC9   FPT_FIDC+29              cn=0,n=4
         2 001757   200044 200037                    ADSC9   VLP_FPRG+2,,AUTO         cn=1,n=31

      663    11869    3              VLP_FPRG.ACCT# = ':SYS    ';

  11869  2 001760   000074 237000 1                  LDAQ    FPT_FIDC+30
         2 001761   200054 757100                    STAQ    VLP_FPRG+10,,AUTO

      664    11870    3              VLP_FPRG.PASS# = '        ';

  11870  2 001762   000076 237000 1                  LDAQ    FPT_FIDC+32
         2 001763   200056 757100                    STAQ    VLP_FPRG+12,,AUTO

      665    11871    3              VLP_FPRG.PSN#  = '      ';

  11871  2 001764   040100 100400                    MLR     fill='040'O
         2 001765   000075 000006 1                  ADSC9   FPT_FIDC+31              cn=0,n=6
         2 001766   200042 400006                    ADSC9   VLP_FPRG,,AUTO           cn=2,n=6

      666    11872
      667    11873    3              CCBUFL= -1;

  11873  2 001767   000001 335007                    LCA     1,DL
         2 001770   200014 755100                    STA     CCBUFL,,AUTO
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:97   

      668    11874    3              GOTO FILL_SETFP_MSG;

  11874  2 001771   000473 710000 2                  TRA     FILL_SETFP_MSG

      669    11875
      670    11876    3            CASE (%GJ_GETCCBUF#);          /* Get the CCBUF contents   */

      671    11877    3              IF CCBUFL < 0

  11877  2 001772   200014 235100                    LDA     CCBUFL,,AUTO
         2 001773   002011 605000 2                  TPL     s:11882

      672    11878    4              THEN DO;

      673    11879    4                   CCBUFL = SIZEC(CCBUF_FPRG);

  11879  2 001774   000130 235007                    LDA     88,DL
         2 001775   200014 755100                    STA     CCBUFL,,AUTO

      674    11880    4                   CALL KIF$WRITE(LDCT,CCBUF_FPRG,CCBUFL);

  11880  2 001776   200014 630500                    EPPR0   CCBUFL,,AUTO
         2 001777   200212 450500                    STP0    DLDCT$+4,,AUTO
         2 002000   200150 631500                    EPPR1   CCBUF_FPRG,,AUTO
         2 002001   200211 451500                    STP1    DLDCT$+3,,AUTO
         2 002002   200022 236100                    LDQ     LDCT$,,AUTO
         2 002003   200210 756100                    STQ     DLDCT$+2,,AUTO
         2 002004   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 002005   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 002006   000000 701000 xent               TSX1    KIF$WRITE
         2 002007   000000 011000                    NOP     0

      675    11881    4                   END;

  11881  2 002010   002131 710000 2                  TRA     s:11927

PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:98   
      676    11882    3              ELSE CALL KIF$WRITE(LDCT,B$PS3$->CHAR$1,CCBUFL) ALTRET(JITERR);

  11882  2 002011   200014 630500                    EPPR0   CCBUFL,,AUTO
         2 002012   200212 450500                    STP0    DLDCT$+4,,AUTO
         2 002013   000000 236000 xsym               LDQ     B$PS3$
         2 002014   200022 235100                    LDA     LDCT$,,AUTO
         2 002015   200210 757100                    STAQ    DLDCT$+2,,AUTO
         2 002016   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 002017   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 002020   000000 701000 xent               TSX1    KIF$WRITE
         2 002021   000340 702000 2                  TSX2    JITERR
         2 002022   002131 710000 2                  TRA     s:11927

      677    11883
      678    11884    3            CASE (%GJ_NAK#,%GJ_PROG_ABRT#);

      679    11885    3              TEMPB = GJ_PROGKEY_MSG.ERR;

  11885  2 002023   200066 235100                    LDA     GJ_PROGKEY_MSG,,AUTO
         2 002024   200067 236100                    LDQ     GJ_PROGKEY_MSG+1,,AUTO
         2 002025   000022 773000                    LRL     18
         2 002026   000027 376000 xsym               ANQ     B_VECTNIL+23
         2 002027   200024 756100                    STQ     TEMP,,AUTO

      680    11886    3              CALL EMR$FEP2HOST (TEMPB,MYERR);

  11886  2 002030   200035 630500                    EPPR0   MYERR,,AUTO
         2 002031   200211 450500                    STP0    DLDCT$+3,,AUTO
         2 002032   200024 631500                    EPPR1   TEMP,,AUTO
         2 002033   200210 451500                    STP1    DLDCT$+2,,AUTO
         2 002034   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 002035   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 002036   000000 701000 xent               TSX1    EMR$FEP2HOST
         2 002037   000000 011000                    NOP     0

      681    11887    3              GOTO XIT;

PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:99   
  11887  2 002040   002134 710000 2                  TRA     XIT

      682    11888
      683    11889    3            CASE (%GJ_GETDONE#);           /* Fetch complete           */

      684    11890    3              IF MYERR ~= '0'B

  11890  2 002041   200035 235100                    LDA     MYERR,,AUTO
         2 002042   002134 601000 2                  TNZ     XIT

      685    11891    3              THEN GOTO XIT;
      686    11892
      687    11893    3              CALL KIF$WRITE(LDCT,GJ_PROGKEY_MSG,LENGTHC(FCNMSG));

  11893  2 002043   000002 236000 3                  LDQ     2
         2 002044   200212 756100                    STQ     DLDCT$+4,,AUTO
         2 002045   200066 630500                    EPPR0   GJ_PROGKEY_MSG,,AUTO
         2 002046   200211 450500                    STP0    DLDCT$+3,,AUTO
         2 002047   200022 236100                    LDQ     LDCT$,,AUTO
         2 002050   200210 756100                    STQ     DLDCT$+2,,AUTO
         2 002051   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 002052   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 002053   000000 701000 xent               TSX1    KIF$WRITE
         2 002054   000000 011000                    NOP     0

      688    11894
      689    11895                   %LOCK (G=LDCT$->LDCT.LOCK);

  11896  2 002055   200022 236100                    LDQ     LDCT$,,AUTO
         2 002056   000020 036003                    ADLQ    16,DU
         2 002057   200210 756100                    STQ     DLDCT$+2,,AUTO
         2 002060   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 002061   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002062   000000 701000 xent               TSX1    HFC$LOCK
         2 002063   000000 011000                    NOP     0

      690    11898    3              LDCT$->LDCT.LKFLG.FPSTEP='0'B;
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:100  

  11898  2 002064   200022 470500                    LDP0    LDCT$,,AUTO
         2 002065   000042 236000 3                  LDQ     34
         2 002066   000011 356100                    ANSQ    9,,PR0

      691    11899    3              LDCT$->LDCT.LKFLG.FPPM='0'B;

  11899  2 002067   000043 236000 3                  LDQ     35
         2 002070   000011 356100                    ANSQ    9,,PR0

      692    11900    3              IF LDCT$->LDCT.RESCOD = NK_CGFPRG

  11900  2 002071   000006 236100                    LDQ     6,,PR0
         2 002072   000017 376007                    ANQ     15,DL
         2 002073   000011 116007                    CMPQ    9,DL
         2 002074   002077 601000 2                  TNZ     s:11907

      693    11901    3              THEN LDCT$->LDCT.LKFLG.OBLK='1'B;

  11901  2 002075   200000 236003                    LDQ     65536,DU
         2 002076   000011 256100                    ORSQ    9,,PR0

      694    11902        /* Only for a comgroup is it possible that data is already available for
      695    11903           this newly started FPRG, so setting OBLK may be right in that case.
      696    11904           If it's wrong, the comgroup code will fix it up.  If it is set for a
      697    11905           non-comgroup FPRG, a read with NODAT from the FPRG will get the wrong
      698    11906           answer.  So, we only arbitrarily set it now for comgroups. */
      699    11907    3              LDCT$->LDCT.LKFLG.ABORTED='0'B;

  11907  2 002077   000001 236000 3                  LDQ     1
         2 002100   000011 356100                    ANSQ    9,,PR0

      700    11908    3              IF CG AND LDCT$->LDCT.DFLG.OLDSC

  11908  2 002101   200004 234100                    SZN     CG,,AUTO
         2 002102   002111 605000 2                  TPL     s:11910
         2 002103   000006 236100                    LDQ     6,,PR0
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:101  
         2 002104   010000 316007                    CANQ    4096,DL
         2 002105   002111 600000 2                  TZE     s:11910

      701    11909    3              THEN CONTDSC='1'B;

  11909  2 002106   400000 236003                    LDQ     -131072,DU
         2 002107   200006 756100                    STQ     CONTDSC,,AUTO
         2 002110   002112 710000 2                  TRA     s:11912

      702    11910    3              ELSE CONTDSC='0'B;

  11910  2 002111   200006 450100                    STZ     CONTDSC,,AUTO

      703    11911                   %UNLOCK (G=LDCT$->LDCT.LOCK);

  11912  2 002112   200022 236100                    LDQ     LDCT$,,AUTO
         2 002113   000020 036003                    ADLQ    16,DU
         2 002114   200210 756100                    STQ     DLDCT$+2,,AUTO
         2 002115   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 002116   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002117   000000 701000 xent               TSX1    HFC$UNLOCK
         2 002120   000000 011000                    NOP     0

      704    11914
      705    11915        /* Now that we've cleaned up the LDCT, turn this DONE
      706    11916           around so that the FPRG may run.
      707    11917        */
      708    11918    3              DONE='1'B;

  11918  2 002121   400000 236003                    LDQ     -131072,DU
         2 002122   200011 756100                    STQ     DONE,,AUTO
         2 002123   002131 710000 2                  TRA     s:11927

      709    11919
      710    11920
      711    11921    3            CASE (ELSE);                   /* Should never happen      */

PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:102  
      712    11922    3              CALL SC_FPRG;

  11922  2 002124   000000 713400 xsym               CLIMB   SC_FPRG
         2 002125   000000 600000 xsid               climb   nvectors=         0

      713    11923    3              MYERR=KIF_UNEXPT;

  11923  2 002126   000035 236000 1                  LDQ     KIF_UNEXPT
         2 002127   200035 756100                    STQ     MYERR,,AUTO

      714    11924    3              GOTO XIT;

  11924  2 002130   002134 710000 2                  TRA     XIT

      715    11925
      716    11926    3              END;                         /* End cases                */

      717    11927    2           END;                            /* End do while(not done)*/

  11927  2 002131   200011 234100                    SZN     DONE,,AUTO
         2 002132   001416 605000 2                  TPL     s:11809

      718    11928
      719    11929        /*S* SCREECH_CODE: KIF-S$FPRG
      720    11930             TYPE:         SNAP
      721    11931             MESSAGE:      Unexpected condition in loading FPRG
      722    11932        */
      723    11933
      724    11934        /*E*   ERROR: KIF-E$IOERR-E
      725    11935             MESSAGE: Unexpected condition encountered in loading FPRG
      726    11936        */
      727    11937        %EJECT;
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:103  
      728    11938    2      DO WHILE('0'B);

  11938  2 002133   002166 710000 2                  TRA     s:11952

  11922  2 002134                       XIT          null
      729    11939    2   XIT:    ;
      730    11940                %LOCK (G=LDCT$->LDCT.LOCK);

  11941  2 002134   200022 236100                    LDQ     LDCT$,,AUTO
         2 002135   000020 036003                    ADLQ    16,DU
         2 002136   200210 756100                    STQ     DLDCT$+2,,AUTO
         2 002137   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 002140   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002141   000000 701000 xent               TSX1    HFC$LOCK
         2 002142   000000 011000                    NOP     0

      731    11943    2           LDCT$->LDCT.LKFLG.FPPM='0'B;

  11943  2 002143   200022 470500                    LDP0    LDCT$,,AUTO
         2 002144   000043 236000 3                  LDQ     35
         2 002145   000011 356100                    ANSQ    9,,PR0

      732    11944    2           IF CG AND LDCT$->LDCT.DFLG.OLDSC

  11944  2 002146   200004 234100                    SZN     CG,,AUTO
         2 002147   002156 605000 2                  TPL     s:11946
         2 002150   000006 236100                    LDQ     6,,PR0
         2 002151   010000 316007                    CANQ    4096,DL
         2 002152   002156 600000 2                  TZE     s:11946

      733    11945    2           THEN CONTDSC='1'B;

  11945  2 002153   400000 236003                    LDQ     -131072,DU
         2 002154   200006 756100                    STQ     CONTDSC,,AUTO
         2 002155   002157 710000 2                  TRA     s:11948

      734    11946    2           ELSE CONTDSC='0'B;
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:104  

  11946  2 002156   200006 450100                    STZ     CONTDSC,,AUTO

      735    11947                %UNLOCK (G=LDCT$->LDCT.LOCK);

  11948  2 002157   200022 236100                    LDQ     LDCT$,,AUTO
         2 002160   000020 036003                    ADLQ    16,DU
         2 002161   200210 756100                    STQ     DLDCT$+2,,AUTO
         2 002162   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 002163   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002164   000000 701000 xent               TSX1    HFC$UNLOCK
         2 002165   000000 011000                    NOP     0

      736    11950    2           END;

      737    11951
      738    11952    1      IF BF$ ~= ADDR(NIL)

  11952  2 002166   200036 236100                    LDQ     BF$,,AUTO
         2 002167   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 002170   002200 600000 2                  TZE     s:11958

      739    11953    2      THEN DO;

      740    11954    2           TPTR$ = BF$;

  11954  2 002171   200034 756100                    STQ     TPTR$,,AUTO

      741    11955    2           CALL FMD$RBUF(TPTR$);

  11955  2 002172   200034 630500                    EPPR0   TPTR$,,AUTO
         2 002173   200210 450500                    STP0    DLDCT$+2,,AUTO
         2 002174   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 002175   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002176   000000 701000 xent               TSX1    FMD$RBUF
         2 002177   000000 011000                    NOP     0

PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:105  
      742    11956    2           END;

      743    11957
      744    11958    1      IF B$M$STAR$->F$DCB.FCD

  11958  2 002200   000000 470400 xsym               LDP0    B$M$STAR$
         2 002201   000031 236100                    LDQ     25,,PR0
         2 002202   020000 316007                    CANQ    8192,DL
         2 002203   002212 600000 2                  TZE     s:11964

      745    11959    2      THEN DO;

      746    11960    2           B$JIT.DCB$=B$M$STAR$;

  11960  2 002204   000000 236000 xsym               LDQ     B$M$STAR$
         2 002205   000000 471400 xsym               LDP1    B$JIT$
         2 002206   100232 756100                    STQ     154,,PR1

      747    11961    2           CALL FMP$CLSJ;

  11961  2 002207   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 002210   000000 701000 xent               TSX1    FMP$CLSJ
         2 002211   000000 011000                    NOP     0

      748    11962    2           END;

      749    11963
      750    11964    1      IF (CG OR MYERR) AND LMDCB$~=ADDR(NIL)

  11964  2 002212   200004 234100                    SZN     CG,,AUTO
         2 002213   002216 604000 2                  TMI     s:11964+4
         2 002214   200035 235100                    LDA     MYERR,,AUTO
         2 002215   002236 600000 2                  TZE     s:11972
         2 002216   200020 236100                    LDQ     LMDCB$,,AUTO
         2 002217   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 002220   002236 600000 2                  TZE     s:11972

PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:106  
      751    11965    2      THEN DO;

      752    11966    2           B$JIT.DCB$=LMDCB$;

  11966  2 002221   000000 470400 xsym               LDP0    B$JIT$
         2 002222   000232 756100                    STQ     154,,PR0

      753    11967    2           CALL FMP$CLSJ;

  11967  2 002223   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 002224   000000 701000 xent               TSX1    FMP$CLSJ
         2 002225   000000 011000                    NOP     0

      754    11968    2           B$JIT.DCBNO = LMDCB$->F$DCB.DCB#;

  11968  2 002226   200020 470500                    LDP0    LMDCB$,,AUTO
         2 002227   000000 471400 xsym               LDP1    B$JIT$
         2 002230   000060 236100                    LDQ     48,,PR0
         2 002231   000033 772000                    QRL     27
         2 002232   100022 552104                    STBQ    18,'04'O,PR1

      755    11969    2           CALL FMM$RELDCBI;

  11969  2 002233   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 002234   000000 701000 xent               TSX1    FMM$RELDCBI
         2 002235   000000 011000                    NOP     0

      756    11970    2           END;

      757    11971
      758    11972    1      IF MYERR

  11972  2 002236   200035 235100                    LDA     MYERR,,AUTO
         2 002237   002307 600000 2                  TZE     s:11987

      759    11973    2      THEN DO;

PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:107  
      760    11974    2           MYERR = (MYERR | MONBIT#);

  11974  2 002240   200035 236100                    LDQ     MYERR,,AUTO
         2 002241   000072 276000 1                  ORQ     FPT_FIDC+28
         2 002242   200035 756100                    STQ     MYERR,,AUTO

      761    11975    2           IF LDCT$->LDCT.DFLG.OLDSC THEN EXIT;

  11975  2 002243   200022 470500                    LDP0    LDCT$,,AUTO
         2 002244   000006 236100                    LDQ     6,,PR0
         2 002245   010000 316007                    CANQ    4096,DL
         2 002246   002306 601000 2                  TNZ     s:11985

      762    11976    2           IF DID_SETFP OR LDTRC OR OPNDEV

  11976  2 002247   200012 234100                    SZN     DID_SETFP,,AUTO
         2 002250   002255 604000 2                  TMI     s:11978
         2 002251   200010 234100                    SZN     LDTRC,,AUTO
         2 002252   002255 604000 2                  TMI     s:11978
         2 002253   200013 234100                    SZN     OPNDEV,,AUTO
         2 002254   002416 605000 2                  TPL     s:12010

      763    11977    3           THEN DO;

      764    11978    3                FCNMSG='0'B;

  11978  2 002255   200064 450100                    STZ     FCNMSG,,AUTO
         2 002256   200065 450100                    STZ     FCNMSG+1,,AUTO

      765    11979    3                FCNMSG.FCN=%GJ_NAK#;

  11979  2 002257   035000 236003                    LDQ     14848,DU
         2 002260   200064 552140                    STBQ    FCNMSG,'40'O,AUTO

      766    11980    3                CALL EMR$HOST2FEP(TEMPB,MYERR);

  11980  2 002261   200035 631500                    EPPR1   MYERR,,AUTO
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:108  
         2 002262   200211 451500                    STP1    DLDCT$+3,,AUTO
         2 002263   200024 633500                    EPPR3   TEMP,,AUTO
         2 002264   200210 453500                    STP3    DLDCT$+2,,AUTO
         2 002265   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 002266   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 002267   000000 701000 xent               TSX1    EMR$HOST2FEP
         2 002270   000000 011000                    NOP     0

      767    11981    3                FCNMSG.ERR=TEMPB;          /* For alignment purposes   */

  11981  2 002271   000100 100500                    MLR     fill='000'O
         2 002272   200024 000004                    ADSC9   TEMP,,AUTO               cn=0,n=4
         2 002273   200064 400004                    ADSC9   FCNMSG,,AUTO             cn=2,n=4

      768    11982    3                CALL KIF$WRITE(LDCT,FCNMSG,LENGTHC(FCNMSG)); /* Can't do anything */

  11982  2 002274   000002 236000 3                  LDQ     2
         2 002275   200212 756100                    STQ     DLDCT$+4,,AUTO
         2 002276   200064 630500                    EPPR0   FCNMSG,,AUTO
         2 002277   200211 450500                    STP0    DLDCT$+3,,AUTO
         2 002300   200022 236100                    LDQ     LDCT$,,AUTO
         2 002301   200210 756100                    STQ     DLDCT$+2,,AUTO
         2 002302   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 002303   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 002304   000000 701000 xent               TSX1    KIF$WRITE
         2 002305   000000 011000                    NOP     0

      769    11983    3                END;

      770    11984                                                /* about an ALTRET here.    */
      771    11985    2           END;

  11985  2 002306   002416 710000 2                  TRA     s:12010

      772    11986
      773    11987    1      ELSE IF NOT CG

PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:109  
  11987  2 002307   200004 234100                    SZN     CG,,AUTO
         2 002310   002416 604000 2                  TMI     s:12010

      774    11988    2           THEN DO;

      775    11989    2                B$JIT.DCB$=MEDDCB$->F$DCB.CFU$;

  11989  2 002311   200016 470500                    LDP0    MEDDCB$,,AUTO
         2 002312   000066 236100                    LDQ     54,,PR0
         2 002313   000000 471400 xsym               LDP1    B$JIT$
         2 002314   100232 756100                    STQ     154,,PR1

      776    11990    2                MEDDCB$->F$DCB.CFU$=LMDCB$;

  11990  2 002315   200020 236100                    LDQ     LMDCB$,,AUTO
         2 002316   000066 756100                    STQ     54,,PR0

      777    11991    2                PINCRW(B$ROSEG$,MEDDCB$->F$DCB.FPRGX)->VLP$FPRG=VLP_FPRG;

  11991  2 002317   000054 220100                    LDX0    44,,PR0
         2 002320   000000 635010                    EAA     0,X0
         2 002321   000020 771000                    ARL     16
         2 002322   000000 473400 xsym               LDP3    B$ROSEG$
         2 002323   000105 100500                    MLR     fill='000'O
         2 002324   200042 000104                    ADSC9   VLP_FPRG,,AUTO           cn=0,n=68
         2 002325   300000 000104                    ADSC9   0,A,PR3                  cn=0,n=68

      778    11992    2                IF B$JIT.DCB$~=ADDR(NIL)

  11992  2 002326   100232 236100                    LDQ     154,,PR1
         2 002327   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 002330   002344 600000 2                  TZE     s:11998

      779    11993    3                THEN DO;

      780    11994    3                     CALL FMP$CLSJ;

PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:110  
  11994  2 002331   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 002332   000000 701000 xent               TSX1    FMP$CLSJ
         2 002333   000000 011000                    NOP     0

      781    11995    3                     B$JIT.DCBNO = B$JIT.DCB$->F$DCB.DCB#;

  11995  2 002334   000000 470400 xsym               LDP0    B$JIT$
         2 002335   000232 471500                    LDP1    154,,PR0
         2 002336   100060 236100                    LDQ     48,,PR1
         2 002337   000033 772000                    QRL     27
         2 002340   000022 552104                    STBQ    18,'04'O,PR0

      782    11996    3                     CALL FMM$RELDCBI;

  11996  2 002341   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 002342   000000 701000 xent               TSX1    FMM$RELDCBI
         2 002343   000000 011000                    NOP     0

      783    11997    3                     END;

      784    11998    2                IF LDTRC='0'B AND DEBUG='1'B AND CG='0'B

  11998  2 002344   200010 234100                    SZN     LDTRC,,AUTO
         2 002345   002416 604000 2                  TMI     s:12010
         2 002346   200005 234100                    SZN     DEBUG,,AUTO
         2 002347   002416 605000 2                  TPL     s:12010
         2 002350   200004 234100                    SZN     CG,,AUTO
         2 002351   002416 604000 2                  TMI     s:12010
         2 002352   000000 470400 xsym               LDP0    B_MPT
         2 002353   000010 236100                    LDQ     8,,PR0
         2 002354   000160 376007                    ANQ     112,DL
         2 002355   000120 116007                    CMPQ    80,DL
         2 002356   002416 600000 2                  TZE     s:12010

      785    11999    2                  AND B_MPT.SS$->B$SS.ISR.WSR~=%DBWSR
      786    12000    3                THEN DO; /* Event DELTA telling it about this new FPRG */

PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:111  
      787    12001    3                     FPRGEV='0'B;

  12001  2 002357   000100 100400                    MLR     fill='000'O
         2 002360   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         2 002361   200124 000114                    ADSC9   FPRGEV,,AUTO             cn=0,n=76

      788    12002    3                     FPRGEV.P#=SIZEW(FPRGEV)-SIZEW(FPRGEV.FPRG)-SIZEW(FPRGEV.P#);

  12002  2 002362   000001 235007                    LDA     1,DL
         2 002363   200124 755100                    STA     FPRGEV,,AUTO

      789    12003    3                     FPRGEV.SUBC2=%SUBC2_AFD#;

  12003  2 002364   000003 236007                    LDQ     3,DL
         2 002365   200125 552104                    STBQ    FPRGEV+1,'04'O,AUTO

      790    12004    3                     FPRGEV.DCBNO=LDCT$->LDCT.UDCBNO;

  12004  2 002366   200022 471500                    LDP1    LDCT$,,AUTO
         2 002367   100016 236100                    LDQ     14,,PR1
         2 002370   000033 772000                    QRL     27
         2 002371   000000 620006                    EAX0    0,QL
         2 002372   200125 740100                    STX0    FPRGEV+1,,AUTO

      791    12005    3                     DUSER=S_CUN;

  12005  2 002373   000000 236000 xsym               LDQ     S_CUN
         2 002374   000033 736000                    QLS     27
         2 002375   200033 756100                    STQ     DUSER,,AUTO

      792    12006    3                     CALL SSV$EVENT(DUSER,%DBWSR,%SUBC_FPRG#,0,0,ADDR(FPRGEV));

  12006  2 002376   200124 633500                    EPPR3   FPRGEV,,AUTO
         2 002377   200210 453500                    STP3    DLDCT$+2,,AUTO
         2 002400   200210 634500                    EPPR4   DLDCT$+2,,AUTO
         2 002401   200217 454500                    STP4    DLDCT$+9,,AUTO
         2 002402   000044 236000 3                  LDQ     36
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:112  
         2 002403   200216 756100                    STQ     DLDCT$+8,,AUTO
         2 002404   000046 237000 3                  LDAQ    38
         2 002405   200214 757100                    STAQ    DLDCT$+6,,AUTO
         2 002406   000046 236000 3                  LDQ     38
         2 002407   200213 756100                    STQ     DLDCT$+5,,AUTO
         2 002410   200033 635500                    EPPR5   DUSER,,AUTO
         2 002411   200212 455500                    STP5    DLDCT$+4,,AUTO
         2 002412   200212 630500                    EPPR0   DLDCT$+4,,AUTO
         2 002413   000024 631400 xsym               EPPR1   B_VECTNIL+20
         2 002414   000000 701000 xent               TSX1    SSV$EVENT
         2 002415   000000 011000                    NOP     0

      793    12007    3                     END;

      794    12008    2                END;

      795    12009
      796    12010    1      IF CONTDSC

  12010  2 002416   200006 234100                    SZN     CONTDSC,,AUTO
         2 002417   002424 605000 2                  TPL     s:12013

      797    12011    1      THEN CALL KCD$CDSCTRM(LDCT$->LDCT);

  12011  2 002420   200022 630500                    EPPR0   LDCT$,,AUTO
         2 002421   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002422   000000 701000 xent               TSX1    KCD$CDSCTRM
         2 002423   000000 011000                    NOP     0

      798    12012
      799    12013    1      B$JIT.ERR=MYERR;

  12013  2 002424   200035 236100                    LDQ     MYERR,,AUTO
         2 002425   000000 470400 xsym               LDP0    B$JIT$
         2 002426   000012 756100                    STQ     10,,PR0

      800    12014    1      B$JIT.DCB$=DCB$;
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:113  

  12014  2 002427   200015 236100                    LDQ     DCB$,,AUTO
         2 002430   000232 756100                    STQ     154,,PR0

  12014  2 002431                       RTN          null
      801    12015    1   RTN: ;
      802    12016    1      IF LDTRC

  12016  2 002431   200010 234100                    SZN     LDTRC,,AUTO
         2 002432   002447 605000 2                  TPL     s:12022

      803    12017    2      THEN DO;

      804    12018    2           IF NOT MYERR

  12018  2 002433   200035 235100                    LDA     MYERR,,AUTO
         2 002434   002446 601000 2                  TNZ     s:12020

      805    12019    2           THEN CALL KIF$FPRGEVNT(LDCT$->LDCT,%GJ_PROG_LDTRC#,VLP_FPRG);

  12019  2 002435   200042 630500                    EPPR0   VLP_FPRG,,AUTO
         2 002436   200212 450500                    STP0    DLDCT$+4,,AUTO
         2 002437   000050 236000 3                  LDQ     40
         2 002440   200022 235100                    LDA     LDCT$,,AUTO
         2 002441   200210 757100                    STAQ    DLDCT$+2,,AUTO
         2 002442   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 002443   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 002444   000000 701000 xent               TSX1    KIF$FPRGEVNT
         2 002445   000000 011000                    NOP     0

      806    12020    2           ALTRETURN;

  12020  2 002446   000000 702200 xent               TSX2  ! X66_AALT

      807    12021    2           END;
      808    12022    1      ELSE RETURN;

PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:114  
  12022  2 002447   000000 702200 xent               TSX2  ! X66_ARET

      809    12023        %EJECT;
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:115  
      810    12024        /*I*    NAME: SETUP
      811    12025                PUROPOSE: Common setup routine for all entry points.
      812    12026        */
      813    12027
      814    12028    1   SETUP: PROC;

  12028  2 002450   200176 741300       SETUP        STX1  ! CCBUF_FPRG+22,,AUTO

      815    12029
      816    12030    2      MYERR='0'B;

  12030  2 002451   200035 450100                    STZ     MYERR,,AUTO

      817    12031    2      BF$=ADDR(NIL);

  12031  2 002452   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 002453   200036 756100                    STQ     BF$,,AUTO

      818    12032    2      LMDCB$=ADDR(NIL);

  12032  2 002454   200020 756100                    STQ     LMDCB$,,AUTO

      819    12033    2      MEDDCB$=ADDR(NIL);

  12033  2 002455   200016 756100                    STQ     MEDDCB$,,AUTO

      820    12034    2      DCB$=ADDR(NIL);

  12034  2 002456   200015 756100                    STQ     DCB$,,AUTO

      821    12035    2      RETURN;

  12035  2 002457   000001 702211                    TSX2  ! 1,X1

      822    12036    2   END SETUP;
      823    12037        %EJECT;
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:116  
      824    12038
      825    12039        /*I* NAME:        GETPROFPRG
      826    12040             PURPOSE:     To get the device's PROFILE's default FPRG
      827    12041             DESCRIPTION: The device's PROFILE record is obtained from which
      828    12042                          the default FPRG info is obtained and copied into
      829    12043                          VLP_FPRG. If any problems occur such as no default
      830    12044                          FPRG specified, this procedure will ALTRETURN.             */
      831    12045
      832    12046    1   GETPROFPRG: PROC  ALTRET;

  12046  2 002460   200176 741300       GETPROFPRG   STX1  ! CCBUF_FPRG+22,,AUTO

      833    12047
      834    12048        %VLP_LINEATTR (FPTN=VLP_LINEATTR,STCLASS="BASED(BF$)");
      835    12070        %KL_PHDR (NAME=PHDR,STCLASS="BASED(BF$)");
      836    12111        %FPT_FID (FPTN=FPT_FIDC,STCLASS=CONSTANT);
      837    12134        %FPT_FID (FPTN=FPT_FID,STCLASS="BASED(BF2$)");
      838    12157        %VLP_SN (FPTN=VLP_SN,STCLASS=AUTO);
      839    12170    2   DCL ASN UBIN BYTE;
      840    12171    2   DCL DUMMY UBIN;
      841    12172    2   DCL DLDCT$ PTR;
      842    12173
      843    12174        /*N*  IF CG
      844    12175              THEN DLDCT$=LDCT$->LDCT.CLNK$;
      845    12176    2   ELSE */ DLDCT$=LDCT$;

  12176  2 002461   200022 236100                    LDQ     LDCT$,,AUTO
         2 002462   200206 756100                    STQ     DLDCT$,,AUTO

      846    12177    2      PROMSG = '0'B;

  12177  2 002463   200037 470500                    LDP0    BF2$,,AUTO
         2 002464   000100 100400                    MLR     fill='000'O
         2 002465   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         2 002466   000000 000022                    ADSC9   0,,PR0                   cn=0,n=18

      847    12178    2      PROMSG.FCN = %GJ_PROFILE#;
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:117  

  12178  2 002467   024000 236003                    LDQ     10240,DU
         2 002470   000000 552140                    STBQ    0,'40'O,PR0

      848    12179    2      CALL KIF$WRITE(LDCT,PROMSG,LENGTHC(FCNMSG)) ALTRET(PROFILE_ERR);

  12179  2 002471   000002 236000 3                  LDQ     2
         2 002472   200212 756100                    STQ     DLDCT$+4,,AUTO
         2 002473   200037 236100                    LDQ     BF2$,,AUTO
         2 002474   200022 235100                    LDA     LDCT$,,AUTO
         2 002475   200210 757100                    STAQ    DLDCT$+2,,AUTO
         2 002476   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 002477   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 002500   000000 701000 xent               TSX1    KIF$WRITE
         2 002501   002514 702000 2                  TSX2    PROFILE_ERR

      849    12180
      850    12181    2      CALL KIF$READ(LDCT,PROMSG,LENGTHC(PROMSG))

  12181  2 002502   000005 236000 3                  LDQ     5
         2 002503   200212 756100                    STQ     DLDCT$+4,,AUTO
         2 002504   200037 236100                    LDQ     BF2$,,AUTO
         2 002505   200022 235100                    LDA     LDCT$,,AUTO
         2 002506   200210 757100                    STAQ    DLDCT$+2,,AUTO
         2 002507   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 002510   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 002511   000000 701000 xent               TSX1    KIF$READ
         2 002512   002514 702000 2                  TSX2    PROFILE_ERR
         2 002513   002521 710000 2                  TRA     s:12188

      851    12182    3      WHENALTRETURN DO;

  12181  2 002514                       PROFILE_ERR  null
      852    12183    3   PROFILE_ERR: ;
      853    12184    3           MYERR=B$JIT.ERR;

  12184  2 002514   000000 470400 xsym               LDP0    B$JIT$
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:118  
         2 002515   000012 236100                    LDQ     10,,PR0
         2 002516   200035 756100                    STQ     MYERR,,AUTO

      854    12185    3           ALTRETURN;

  12185  2 002517   200176 221300                    LDX1  ! CCBUF_FPRG+22,,AUTO
         2 002520   000000 702211                    TSX2  ! 0,X1

      855    12186    3           END;
      856    12187
      857    12188    2      STARDCB$ = B$M$STAR$;

  12188  2 002521   000000 236000 xsym               LDQ     B$M$STAR$
         2 002522   200017 756100                    STQ     STARDCB$,,AUTO

      858    12189    2      B$JIT.DCB$ = STARDCB$;

  12189  2 002523   000000 470400 xsym               LDP0    B$JIT$
         2 002524   000232 756100                    STQ     154,,PR0

      859    12190    2      CALL FMM$SCRUB(B$JIT.DCB$);

  12190  2 002525   000000 236000 xsym               LDQ     B$JIT$
         2 002526   000232 036003                    ADLQ    154,DU
         2 002527   200210 756100                    STQ     DLDCT$+2,,AUTO
         2 002530   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 002531   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002532   000000 701000 xent               TSX1    FMM$SCRUB
         2 002533   000000 011000                    NOP     0

      860    12191    2      STARDCB$->F$DCB.NAME.L=4;

  12191  2 002534   200017 470500                    LDP0    STARDCB$,,AUTO
         2 002535   004000 236003                    LDQ     2048,DU
         2 002536   000010 552140                    STBQ    8,'40'O,PR0

      861    12192    2      STARDCB$->F$DCB.NAME.C=':PRO';
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:119  

  12192  2 002537   040100 100400                    MLR     fill='040'O
         2 002540   000100 000004 1                  ADSC9   FPT_FIDC+34              cn=0,n=4
         2 002541   000010 200037                    ADSC9   8,,PR0                   cn=1,n=31

      862    12193    2      STARDCB$->F$DCB.ACCT=':SYS';

  12193  2 002542   000066 235000 1                  LDA     FPT_FIDC+24
         2 002543   000035 236000 xsym               LDQ     B_VECTNIL+29
         2 002544   000020 757100                    STAQ    16,,PR0

      863    12194    2      STARDCB$->F$DCB.ASN=%FILE#;

  12194  2 002545   001000 236007                    LDQ     512,DL
         2 002546   000032 552110                    STBQ    26,'10'O,PR0

      864    12195    2      STARDCB$->F$DCB.FUN=%IN#;

  12195  2 002547   000002 236003                    LDQ     2,DU
         2 002550   000032 552120                    STBQ    26,'20'O,PR0

      865    12196    2      STARDCB$->F$DCB.ACS=%DIRECT#;

  12196  2 002551   000002 236007                    LDQ     2,DL
         2 002552   000036 552104                    STBQ    30,'04'O,PR0

      866    12197    2      STARDCB$->F$DCB.SHARE = %ALL#;

  12197  2 002553   000031 236100                    LDQ     25,,PR0
         2 002554   000051 376000 3                  ANQ     41
         2 002555   000200 276007                    ORQ     128,DL
         2 002556   000031 756100                    STQ     25,,PR0

      867    12198    2      B$JIT.ERR='0'B;

  12198  2 002557   000000 471400 xsym               LDP1    B$JIT$
         2 002560   100012 450100                    STZ     10,,PR1
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:120  

      868    12199    2      CALL FMM$DFLOPNP;

  12199  2 002561   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 002562   000000 701000 xent               TSX1    FMM$DFLOPNP
         2 002563   000000 011000                    NOP     0

      869    12200
      870    12201    2      IF B$JIT.ERR~='0'B

  12201  2 002564   000000 470400 xsym               LDP0    B$JIT$
         2 002565   000012 235100                    LDA     10,,PR0
         2 002566   002575 600000 2                  TZE     s:12208

      871    12202    3      THEN DO;

      872    12203    3   SNAP:   CALL SC_FPRG;

  12203  2 002567   000000 713400 xsym  SNAP         CLIMB   SC_FPRG
         2 002570   000000 600000 xsid               climb   nvectors=         0

      873    12204    3           MYERR=KIF_UNEXPT;

  12204  2 002571   000035 236000 1                  LDQ     KIF_UNEXPT
         2 002572   200035 756100                    STQ     MYERR,,AUTO

      874    12205    3           ALTRETURN;

  12205  2 002573   200176 221300                    LDX1  ! CCBUF_FPRG+22,,AUTO
         2 002574   000000 702211                    TSX2  ! 0,X1

      875    12206    3           END;
      876    12207
      877    12208    2      VLP_FPRG.PROFILE# = PROMSG.PROFILE;

  12208  2 002575   200037 471500                    LDP1    BF2$,,AUTO
         2 002576   000100 100500                    MLR     fill='000'O
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:121  
         2 002577   100001 400014                    ADSC9   1,,PR1                   cn=2,n=12
         2 002600   200060 000014                    ADSC9   VLP_FPRG+14,,AUTO        cn=0,n=12

      878    12209    2      FPT_READ=KIF_FPT_READ;

  12209  2 002601   000100 100400                    MLR     fill='000'O
         2 002602   000000 000070 1                  ADSC9   KIF_FPT_READ             cn=0,n=56
         2 002603   200104 000070                    ADSC9   FPT_READ,,AUTO           cn=0,n=56

      879    12210    2      FPT_READ.V_=VECTOR(FPT_READ.V);

  12210  2 002604   000020 235000 3                  LDA     16
         2 002605   200210 452500                    STP2    DLDCT$+2,,AUTO
         2 002606   200210 236100                    LDQ     DLDCT$+2,,AUTO
         2 002607   000114 036003                    ADLQ    76,DU
         2 002610   200104 757100                    STAQ    FPT_READ,,AUTO

      880    12211    2      FPT_READ.BUF_=VECTOR(PHDR);

  12211  2 002611   000052 235000 3                  LDA     42
         2 002612   200036 236100                    LDQ     BF$,,AUTO
         2 002613   200110 757100                    STAQ    FPT_READ+4,,AUTO

      881    12212    2      FPT_READ.V.DCB#=%M$STAR#;

  12212  2 002614   000001 220003                    LDX0    1,DU
         2 002615   200114 740100                    STX0    FPT_READ+8,,AUTO

      882    12213    2      FPT_READ.KEY_=VECTOR(PROMSG.PROFILE);

  12213  2 002616   000053 235000 3                  LDA     43
         2 002617   200037 236100                    LDQ     BF2$,,AUTO
         2 002620   000054 036000 3                  ADLQ    44
         2 002621   200106 757100                    STAQ    FPT_READ+2,,AUTO

      883    12214    2      CALL M$MREAD(FPT_READ)

PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:122  
  12214  2 002622   200104 633500                    EPPR3   FPT_READ,,AUTO
         2 002623   200210 453500                    STP3    DLDCT$+2,,AUTO
         2 002624   200210 630500                    EPPR0   DLDCT$+2,,AUTO
         2 002625   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002626   000000 701000 xent               TSX1    M$MREAD
         2 002627   002631 702000 2                  TSX2    s:12216
         2 002630   002636 710000 2                  TRA     s:12219

      884    12215    3      WHENALTRETURN DO;

      885    12216    3           IF B$JIT.ERR.CODE~=%E$LD THEN GOTO SNAP;

  12216  2 002631   000000 470400 xsym               LDP0    B$JIT$
         2 002632   000012 236100                    LDQ     10,,PR0
         2 002633   377770 376007                    ANQ     131064,DL
         2 002634   000070 116007                    CMPQ    56,DL
         2 002635   002567 601000 2                  TNZ     SNAP

      886    12217    3           END;

      887    12218
      888    12219    2      IF PHDR.GR_FPRG = ' '

  12219  2 002636   200036 470500                    LDP0    BF$,,AUTO
         2 002637   040000 106500                    CMPC    fill='040'O
         2 002640   000002 000100                    ADSC9   2,,PR0                   cn=0,n=64
         2 002641   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 002642   002647 601000 2                  TNZ     s:12231

      889    12220    3      THEN DO;

      890    12221    3           MYERR=NPFPRG;

  12221  2 002643   000023 236000 1                  LDQ     NPFPRG
         2 002644   200035 756100                    STQ     MYERR,,AUTO

      891    12222    3           ALTRETURN;
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:123  

  12222  2 002645   200176 221300                    LDX1  ! CCBUF_FPRG+22,,AUTO
         2 002646   000000 702211                    TSX2  ! 0,X1

      892    12223    3           END;
      893    12224        /*E* ERROR:    KIF-E$NPFPRG-E
      894    12225             MESSAGE:  That PROFILE has no default FPRG specified
      895    12226             MESSAGE1: On a load-by-profile type of M$SETFP, the PROFILE
      896    12227                       record currently in use by your device must
      897    12228                       specify an FPRG FID. Yours did not.
      898    12229        */
      899    12230
      900    12231    2      FPT_FID=FPT_FIDC;

  12231  2 002647   200037 471500                    LDP1    BF2$,,AUTO
         2 002650   000100 100400                    MLR     fill='000'O
         2 002651   000036 000140 1                  ADSC9   FPT_FIDC                 cn=0,n=96
         2 002652   100000 000140                    ADSC9   0,,PR1                   cn=0,n=96

      901    12232    2      FPT_FID.V_=VECTOR(FPT_FID.V);

  12232  2 002653   000055 235000 3                  LDA     45
         2 002654   200037 236100                    LDQ     BF2$,,AUTO
         2 002655   000024 036003                    ADLQ    20,DU
         2 002656   100000 757100                    STAQ    0,,PR1

      902    12233    2      FPT_FID.TEXTFID_=VECTOR(PHDR.GR_FPRG);

  12233  2 002657   000056 235000 3                  LDA     46
         2 002660   200036 236100                    LDQ     BF$,,AUTO
         2 002661   000002 036003                    ADLQ    2,DU
         2 002662   100002 757100                    STAQ    2,,PR1

      903    12234    2      FPT_FID.NAME_=VECTOR(VLP_FPRG.NAME);

  12234  2 002663   000057 235000 3                  LDA     47
         2 002664   200210 452500                    STP2    DLDCT$+2,,AUTO
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:124  
         2 002665   200210 236100                    LDQ     DLDCT$+2,,AUTO
         2 002666   000044 036003                    ADLQ    36,DU
         2 002667   100004 757100                    STAQ    4,,PR1

      904    12235    2      FPT_FID.ACCT_=VECTOR(VLP_FPRG.ACCT#);

  12235  2 002670   000006 235000 3                  LDA     6
         2 002671   200210 452500                    STP2    DLDCT$+2,,AUTO
         2 002672   200210 236100                    LDQ     DLDCT$+2,,AUTO
         2 002673   000054 036003                    ADLQ    44,DU
         2 002674   100006 757100                    STAQ    6,,PR1

      905    12236    2      FPT_FID.PASS_=VECTOR(VLP_FPRG.PASS#);

  12236  2 002675   000006 235000 3                  LDA     6
         2 002676   200210 452500                    STP2    DLDCT$+2,,AUTO
         2 002677   200210 236100                    LDQ     DLDCT$+2,,AUTO
         2 002700   000056 036003                    ADLQ    46,DU
         2 002701   100010 757100                    STAQ    8,,PR1

      906    12237    2      FPT_FID.SN_=VECTOR(VLP_SN);

  12237  2 002702   000055 235000 3                  LDA     45
         2 002703   200210 452500                    STP2    DLDCT$+2,,AUTO
         2 002704   200210 236100                    LDQ     DLDCT$+2,,AUTO
         2 002705   000200 036003                    ADLQ    128,DU
         2 002706   100012 757100                    STAQ    10,,PR1

      907    12238    2      FPT_FID.ASN_=VECTOR(ASN);

  12238  2 002707   777640 235007                    LDA     -96,DL
         2 002710   200210 452500                    STP2    DLDCT$+2,,AUTO
         2 002711   200210 236100                    LDQ     DLDCT$+2,,AUTO
         2 002712   000204 036003                    ADLQ    132,DU
         2 002713   100016 757100                    STAQ    14,,PR1

      908    12239    2      FPT_FID.RES_=VECTOR(DUMMY);
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:125  

  12239  2 002714   777640 235007                    LDA     -96,DL
         2 002715   200210 452500                    STP2    DLDCT$+2,,AUTO
         2 002716   200210 236100                    LDQ     DLDCT$+2,,AUTO
         2 002717   000205 036003                    ADLQ    133,DU
         2 002720   100020 757100                    STAQ    16,,PR1

      909    12240    2      CALL M$MFID(FPT_FID)

  12240  2 002721   200037 630500                    EPPR0   BF2$,,AUTO
         2 002722   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002723   000000 701000 xent               TSX1    M$MFID
         2 002724   002726 702000 2                  TSX2    FPFIDE
         2 002725   002732 710000 2                  TRA     s:12253

      910    12241    3      WHENALTRETURN DO;

      911    12242    3   FPFIDE: MYERR=FPFID;

  12242  2 002726   000024 236000 1     FPFIDE       LDQ     FPFID
         2 002727   200035 756100                    STQ     MYERR,,AUTO

      912    12243    3           ALTRETURN;

  12243  2 002730   200176 221300                    LDX1  ! CCBUF_FPRG+22,,AUTO
         2 002731   000000 702211                    TSX2  ! 0,X1

      913    12244    3           END;
      914    12245        /*E* ERROR:    KIF-E$FPFID-E
      915    12246             MESSAGE:  That PROFILE-specified FPRG is not a valid fid
      916    12247             MESSAGE1: For a load-by-profile type of M$SETFP, the FPRG
      917    12248                       FID found in the PROFILE record must be for a
      918    12249                       disk file and be an otherwise valid FID. Yours
      919    12250                       did not pass.
      920    12251        */
      921    12252
      922    12253    2      IF VLP_SN.NUM#>1 OR ASN~=%FILE# THEN GOTO FPFIDE;
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:126  

  12253  2 002732   200200 235100                    LDA     VLP_SN,,AUTO
         2 002733   000001 115007                    CMPA    1,DL
         2 002734   002726 605400 2                  TPNZ    FPFIDE
         2 002735   200204 236100                    LDQ     ASN,,AUTO
         2 002736   777000 376003                    ANQ     -512,DU
         2 002737   001000 116003                    CMPQ    512,DU
         2 002740   002726 601000 2                  TNZ     FPFIDE

      923    12254    2      IF VLP_SN.NUM#=1

  12254  2 002741   000001 115007                    CMPA    1,DL
         2 002742   002747 601000 2                  TNZ     s:12256

      924    12255    2      THEN VLP_FPRG.PSN#=VLP_SN.SN#(0);

  12255  2 002743   040100 100500                    MLR     fill='040'O
         2 002744   200201 000006                    ADSC9   VLP_SN+1,,AUTO           cn=0,n=6
         2 002745   200042 400006                    ADSC9   VLP_FPRG,,AUTO           cn=2,n=6
         2 002746   002752 710000 2                  TRA     s:12257

      925    12256    2      ELSE VLP_FPRG.PSN#=' ';

  12256  2 002747   040100 100400                    MLR     fill='040'O
         2 002750   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 002751   200042 400006                    ADSC9   VLP_FPRG,,AUTO           cn=2,n=6

      926    12257    2      B$JIT.DCB$ = LMDCB$;       /*restore for normal SETFP processing */

  12257  2 002752   200020 236100                    LDQ     LMDCB$,,AUTO
         2 002753   000000 470400 xsym               LDP0    B$JIT$
         2 002754   000232 756100                    STQ     154,,PR0

      927    12258    2      RETURN;

  12258  2 002755   200176 221300                    LDX1  ! CCBUF_FPRG+22,,AUTO
         2 002756   000001 702211                    TSX2  ! 1,X1
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:127  

KIF_FPT_READ
 Sect OctLoc
   1     000   000005 777640   000010 006000   000000 177640   000000 006014    ................
   1     004   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     010   000000 600000   000000 000000   000000 000000   000000 000000    ................
   1     014   000000 000000   000000 000000                                    ........

KIF_HDKEY
 Sect OctLoc
   1     016   004110 105101   104040 040040                                    .HEAD

NOTFP
 Sect OctLoc
   1     020   131106 020524                                                    YF..

REST
 Sect OctLoc
   1     021   131106 003544                                                    YF..

(unnamed)
 Sect OctLoc
   1     022   131106 003174                                                    YF.|

NPFPRG
 Sect OctLoc
   1     023   131106 020764                                                    YF..

FPFID
 Sect OctLoc
   1     024   131106 020774                                                    YF..

(unnamed)
 Sect OctLoc
   1     025   131106 003574                                                    YF..

KIF_BADHEAD
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:128  
 Sect OctLoc
   1     026   131106 003244                                                    YF..

FPDBSY
 Sect OctLoc
   1     027   131106 020574                                                    YF..

KIF_NONFP
 Sect OctLoc
   1     030   131106 020554                                                    YF..

NFPRQ
 Sect OctLoc
   1     031   131106 020544                                                    YF..

(unnamed)
 Sect OctLoc
   1     032   131106 020564   131106 013404                                    YF..YF..

CCGT256
 Sect OctLoc
   1     034   131106 021514                                                    YF..

KIF_UNEXPT
 Sect OctLoc
   1     035   131106 000104                                                    YF.D

FPT_FIDC
 Sect OctLoc
   1     036   000003 777640   000062 006000   000000 177640   000000 006014    .....2..........
   1     042   000000 177640   000000 006014   000000 177640   000000 006014    ................
   1     062*  777000 000000   000000 000000   000000 000000   ****** ******    ................

(unnamed)
 Sect OctLoc
   1     066   072123 131123   040000 000000   120060 114117   000000 000400    :SYS ...P0LO....
   1     072   000000 400000   124120 106120   072123 131123   040040 040040    ....TPFP:SYS
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:129  
   1     076   040040 040040   040040 040040   072120 122117                            :PRO

(unnamed)
 Sect OctLoc
   3     000   000000 006000   677777 777777   000010 006000   000000 006003    ................
   3     004   000000 000022   000004 006000   000001 777640   000000 000074    ...............<
   3     010   000000 177640   000000 006014   000007 006000   000000 000000    ................
   3     014   040040 040040   040040 040040   000006 006000   000007 777770            ........
   3     020   000005 777640   001777 600000   000001 777640   000016 006000    ................
   3     024   000004 006000   000025 400000   000004 400000   000005 400000    ................
   3     030   000003 777777   000026 400000   000024 400000   000027 400000    ................
   3     034   000000 000214   000034 006000   000000 000024   000036 006000    ................
   3     040   000015 006000   000172 400000   777767 777777   777773 777777    .....z..........
   3     044   000002 006000   000000 000000   000007 006000   000002 006000    ................
   3     050   000012 006000   777777 777177   000023 777640   000002 777640    ................
   3     054   000001 400000   000003 777640   000017 777640   000007 777640    ................
      928    12259    2   END GETPROFPRG;
      929    12260    1   END KIF$FPRG;
      930    12261        %EOD;

PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:130  
--  Include file information  --

   B_ERRORS_C.:E05TOU  is referenced.
   UD_SEV_C.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  is referenced.
   KL_SUPER_C.:E05TOU  is referenced.
   F_FPTCODE_C.:E05TOU  is referenced.
   GJ_MSG_M.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   FM$FIT.:E05TOU  is referenced.
   FM$GRAN.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   FM$SET.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   B$SS.:E05TOU  cannot be made into a system file and is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   B_MAGIC_C.:E05TOU  is referenced.
   B$OBJECT_C.:E05TOU  is referenced.
   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure KIF$FPRG.
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:131  

 **** Variables and constants ****

  ****  Section 001 RoData KIF$FPRG

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    34-0-0/w STRC        r     1 CCGT256                   27-0-0/w STRC        r     1 FPDBSY
    24-0-0/w STRC        r     1 FPFID                     36-0-0/d STRC(864)   r     1 FPT_FIDC
    26-0-0/w STRC        r     1 KIF_BADHEAD                0-0-0/d STRC(504)   r     1 KIF_FPT_READ
    16-0-0/c STRC(72)    r     1 KIF_HDKEY                 30-0-0/w STRC        r     1 KIF_NONFP
    35-0-0/w STRC        r     1 KIF_UNEXPT                31-0-0/w STRC        r     1 NFPRQ
    20-0-0/w STRC        r     1 NOTFP                     23-0-0/w STRC        r     1 NPFPRG
    21-0-0/w STRC        r     1 REST

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @DOLIST$                 122-0-0/w STRC(54)    r     1 ADKEY
   204-0-0/w UBIN(9)     r     1 ASN                       36-0-0/w PTR         r     1 BF$
    37-0-0/w PTR         r     1 BF2$                      14-0-0/w SBIN        r     1 CCBUFL
   150-0-0/d STRC(756)   r     1 CCBUF_FPRG                 4-0-0/b BIT         r     1 CG
    23-0-0/w PTR         r     1 CG$                        6-0-0/w BIT         r     1 CONTDSC
    15-0-0/w PTR         r     1 DCB$                       5-0-0/b BIT         r     1 DEBUG
    12-0-0/b BIT         r     1 DID_SETFP                206-0-0/w PTR         r     1 DLDCT$
    *0-0-0/w PTR         r     1 DOLIST$                   11-0-0/w BIT         r     1 DONE
   205-0-0/w UBIN        r     1 DUMMY                     33-0-0/w UBIN(9)     r     1 DUSER
    64-0-0/w STRC(54)    r     1 FCNMSG                   124-0-0/w STRC(684)   r     1 FPRGEV
    74-0-0/d STRC(288)   r     1 FPT_GETDCB               104-0-0/d STRC(504)   r     1 FPT_READ
    66-0-0/w STRC(180)   r     1 GJ_PROGKEY_MSG            22-0-0/w PTR         r     1 LDCT$
    22-0-0/w UBIN        r     1 LDCT$U                    10-0-0/w BIT         r     1 LDTRC
    21-0-0/w UBIN        r     1 LMDCB#                    20-0-0/w PTR         r     1 LMDCB$
    16-0-0/w PTR         r     1 MEDDCB$                   35-0-0/w STRC        r     1 MYERR
    32-0-0/w SBIN        r     1 N_READS                   13-0-0/b BIT         r     1 OPNDEV
    31-0-0/w SBIN        r     1 RECORD_BYSZ               25-0-0/c CHAR(8)     r     1 SAVE_ACCT
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:132  
    17-0-0/w PTR         r     1 STARDCB$                  40-0-0/c CHAR(8)     r     1 STATION
     7-0-0/w BIT         r     1 SYSFLAG                   24-0-0/w SBIN        r     1 TEMP
    24-0-0/w UBIN(18)    r     1 TEMPA(0:1)                24-0-0/w BIT         r     1 TEMPB
    30-0-0/w SBIN        r     1 TOTAL_BYSZ                34-0-0/w PTR         r     1 TPTR$
    42-0-0/d STRC(612)   r     1 VLP_FPRG                 200-0-0/d STRC(90)    r     1 VLP_SN
    27-0-0/w SBIN        r     1 WRITE_BYSZ

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$M$STAR$
     0-0-0/w PTR         r     1 B$PS2$                     0-0-0/w PTR         r     1 B$PS3$
     0-0-0/w PTR         r     1 B$ROSEG$                   0-0-0/d STRC(432)   r     1 B_MPT
     0-0-0/w PTR         r     1 F$CFU$                     0-0-0/w PTR         r     1 N$DCT$$
     0-0-0/w PTR         r     1 S$CU$                      0-0-0/w UBIN        r     1 S_CUN

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(396)   r     1 B$DO                       0-0-0/w STRC(1440)  r     1 B$HEAD
     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/d STRC(2304)  r     1 B$SS
     0-0-0/d STRC(576)   r     1 B$U                        0-0-0/c CHAR        r     1 CHAR$1
     0-0-0/d ASTR(3528)  r     1 F$DCB                      0-0-0/w STRC(288)   r     1 FM$SET(0:0)
     0-0-0/d STRC(864)   r     1 FPT_FID                    0-0-0/w STRC(540)   r     1 LDTRCMSG
     0-0-0/d STRC(864)   r     1 NK$LDCT
     0-0-0/w PTR         r     1 NK$LDCT$(0:0)
     0-0-0/c STRC(720)   r     1 PHDR                       0-0-0/w STRC(162)   r     1 PROMSG
     0-0-0/w STRC(1260)  r     1 SETMSG                     0-0-0/d STRC(612)   r     1 VLP$FPRG


   Procedure KIF$FPRG requires 1519 words for executable code.
   Procedure KIF$FPRG requires 144 words of local(AUTO) storage.
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:133  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:134  
          MINI XREF LISTING

ADKEY
      9994**DCL     11814--ASSIGN  11815<<ASSIGN
ADKEY.KEYSIZ
      9995**DCL     11816<<ASSIGN
ADKEY.PAGE
     10001**DCL     10003--REDEF   11819<<ASSIGN  11843<<ASSIGN  11843>>ASSIGN
ADKEY.TYPE
      9997**DCL     11817<<ASSIGN
ASN IN PROCEDURE GETPROFPRG
     12170**DCL     12238--ASSIGN  12253>>IF
B$DO.ECCINFO
      4261**DCL      4262--REDEF
B$DO.EVID
      4255**DCL     11540>>ASSIGN
B$HEAD
      9158**DCL     11691--IF
B$HEAD.BIAS
      9322**DCL     11771>>ASSIGN
B$HEAD.CMDPROC
      9293**DCL     11751>>ASSIGN
B$HEAD.DCBRES
      9209**DCL     11757<>CALL
B$HEAD.DEBUGGER
      9295**DCL     11752>>ASSIGN
B$HEAD.FLAVOR
      9283**DCL     11702>>IF
B$HEAD.LAUTO
      9267**DCL     11753>>ASSIGN
B$HEAD.LIB
      9288**DCL     11750>>ASSIGN
B$HEAD.LIBNAME
      9330**DCL     11734>>ASSIGN
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:135  
B$HEAD.LOCK
      9281**DCL     11714>>IF      11714>>IF      11714>>IF
B$HEAD.NOCHGPMEM
      9302**DCL     11747>>ASSIGN
B$HEAD.PRIV
      9159**DCL     11740>>ASSIGN  11741>>IF      11743>>IF
B$HEAD.PROCACC
      9299**DCL     11745>>ASSIGN
B$HEAD.PROCSURCHG
      9305**DCL     11746>>ASSIGN
B$HEAD.PSEUDO_COUNT
      9317**DCL     11736>>ASSIGN
B$HEAD.PSEUDO_TEXT
      9325**DCL     11735>>ASSIGN
B$HEAD.RDATA
      9177**DCL     11767>>ASSIGN
B$HEAD.RESTPROC
      9308**DCL     11713>>IF
B$HEAD.ROSIZE
      9236**DCL     11765>>ASSIGN
B$HEAD.RPROC
      9167**DCL     11769>>ASSIGN
B$HEAD.S
      9286**DCL     11749>>ASSIGN
B$HEAD.START
      9203**DCL     11759>>ASSIGN
B$HEAD.STRONG_LOCK
      9311**DCL     11714>>IF
B$HEAD.TCBSIZE
      9216**DCL     11758<>CALL
B$HEAD.UDCBNUM
      9206**DCL     11756<>CALL
B$HEAD.VDPGS
      9169**DCL     11763>>ASSIGN
B$HEAD.VERSION#
      9238**DCL     11737>>ASSIGN
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:136  
B$HEAD.VPPGS
      9161**DCL     11761>>ASSIGN
B$JIT.ACCN
       157**DCL     11625>>ASSIGN  11627<<ASSIGN  11642<<ASSIGN
B$JIT.CPFLAGS1.SLEAZE
       251**DCL       251--REDEF
B$JIT.DCB$
       325**DCL     11439>>IF      11440>>ASSIGN  11448>>ASSIGN  11582<<ASSIGN  11583<>CALL    11860<<ASSIGN
     11863<>CALL    11960<<ASSIGN  11966<<ASSIGN  11989<<ASSIGN  11992>>IF      11995>>ASSIGN  12014<<ASSIGN
     12189<<ASSIGN  12190<>CALL    12257<<ASSIGN
B$JIT.DCBNO
       238**DCL     11862<<ASSIGN  11968<<ASSIGN  11995<<ASSIGN
B$JIT.ERR
       157**DCL     11421<<ASSIGN  11454<<ASSIGN  11467<<ASSIGN  11501<<ASSIGN  11568>>ASSIGN  11630<<ASSIGN
     11635>>IF      11644>>IF      11646>>ASSIGN  11777>>ASSIGN  11827>>ASSIGN  11837>>ASSIGN  11849>>ASSIGN
     12013<<ASSIGN  12184>>ASSIGN  12198<<ASSIGN  12201>>IF
B$JIT.ERR.CODE
       158**DCL     12216>>IF
B$JIT.ERR.FCG
       157**DCL     11566<<ASSIGN
B$JIT.ERR.MID
       158**DCL       158--REDEF   11567<<ASSIGN
B$JIT.JRESPEAK
       319**DCL       320--REDEF
B$JIT.LOCK
       306**DCL     11714>>IF      11714>>IF
B$JIT.ORIGINATOR_PORT.FROM_CR
       428**DCL       428--REDEF     429--REDEF
B$JIT.PNR
       332**DCL       332--REDEF
B$JIT.TSLINE
       426**DCL       427--REDEF
B$JIT$
     10172**DCL       152--IMP-PTR 11421>>ASSIGN  11439>>IF      11440>>ASSIGN  11448>>ASSIGN  11454>>ASSIGN
     11467>>ASSIGN  11501>>ASSIGN  11566>>ASSIGN  11567>>ASSIGN  11568>>ASSIGN  11582>>ASSIGN  11583>>CALL
     11625>>ASSIGN  11627>>ASSIGN  11630>>ASSIGN  11635>>IF      11642>>ASSIGN  11644>>IF      11646>>ASSIGN
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:137  
     11714>>IF      11714>>IF      11777>>ASSIGN  11827>>ASSIGN  11837>>ASSIGN  11849>>ASSIGN  11860>>ASSIGN
     11862>>ASSIGN  11863>>CALL    11960>>ASSIGN  11966>>ASSIGN  11968>>ASSIGN  11989>>ASSIGN  11992>>IF
     11995>>ASSIGN  11995>>ASSIGN  12013>>ASSIGN  12014>>ASSIGN  12184>>ASSIGN  12189>>ASSIGN  12190>>CALL
     12198>>ASSIGN  12201>>IF      12216>>IF      12257>>ASSIGN
B$M$STAR$
     10176**DCL     11958>>IF      11960>>ASSIGN  12188>>ASSIGN
B$PS2$
     10170**DCL     11415>>ASSIGN
B$PS3$
     10171**DCL     11416<>CALL    11418<>CALL    11882>>CALL
B$ROSEG$
     10174**DCL     11440>>ASSIGN  11571>>ASSIGN  11991>>ASSIGN
B$SS.ISR.WSR
      4383**DCL     11637>>ASSIGN  11668>>IF      11998>>IF
B$SS.RVA
      4378**DCL      4379--REDEF
B$U.FLG
      4127**DCL     11675>>IF
B$U.MISC
      4240**DCL      4241--REDEF
B$USER.MISC
      4316**DCL      4317--REDEF
BAD_HEAD
     11688**LABEL   11689--CALLALT
BF$
      9822**DCL      9158--IMP-PTR 11557<<ASSIGN  11559>>ASSIGN  11687>>ASSIGN  11702>>IF      11713>>IF
     11714>>IF      11714>>IF      11714>>IF      11714>>IF      11734>>ASSIGN  11735>>ASSIGN  11736>>ASSIGN
     11737>>ASSIGN  11740>>ASSIGN  11741>>IF      11743>>IF      11745>>ASSIGN  11746>>ASSIGN  11747>>ASSIGN
     11749>>ASSIGN  11750>>ASSIGN  11751>>ASSIGN  11752>>ASSIGN  11753>>ASSIGN  11756>>CALL    11757>>CALL
     11758>>CALL    11759>>ASSIGN  11761>>ASSIGN  11763>>ASSIGN  11765>>ASSIGN  11767>>ASSIGN  11769>>ASSIGN
     11771>>ASSIGN  11829>>ASSIGN  11952>>IF      11954>>ASSIGN  12031<<ASSIGN  12064--IMP-PTR 12083--IMP-PTR
     12211>>ASSIGN  12219>>IF      12233>>ASSIGN
BF2$
      9823**DCL      9410--IMP-PTR  9461--IMP-PTR  9625--IMP-PTR 11559<<ASSIGN  11590>>CALL    11592>>ASSIGN
     11593>>ASSIGN  11594>>ASSIGN  11595>>ASSIGN  11606>>ASSIGN  11607>>ASSIGN  11608>>ASSIGN  11609>>ASSIGN
     11610>>ASSIGN  11611>>ASSIGN  11612>>ASSIGN  11615>>ASSIGN  11616>>ASSIGN  11617>>ASSIGN  11618>>ASSIGN
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:138  
     11619>>ASSIGN  11662>>CALL    11664>>ASSIGN  11665>>ASSIGN  11666>>ASSIGN  11668>>IF      11673>>ASSIGN
     11676>>ASSIGN  11679>>ASSIGN  11729>>IF      11734>>ASSIGN  11735>>ASSIGN  11736>>ASSIGN  11737>>ASSIGN
     11740>>ASSIGN  11742>>ASSIGN  11742>>ASSIGN  11744>>ASSIGN  11744>>ASSIGN  11745>>ASSIGN  11746>>ASSIGN
     11747>>ASSIGN  11749>>ASSIGN  11750>>ASSIGN  11751>>ASSIGN  11752>>ASSIGN  11753>>ASSIGN  11755>>ASSIGN
     11756>>CALL    11757>>CALL    11758>>CALL    11760>>CALL    11762>>CALL    11764>>CALL    11766>>CALL
     11768>>CALL    11770>>CALL    11772>>CALL    11775>>CALL    11829<<ASSIGN  11835>>CALL    11840<<ASSIGN
     11840>>ASSIGN  11847>>CALL    12145--IMP-PTR 12177>>ASSIGN  12178>>ASSIGN  12179>>CALL    12181>>CALL
     12208>>ASSIGN  12213>>ASSIGN  12231>>ASSIGN  12232>>ASSIGN  12232>>ASSIGN  12233>>ASSIGN  12234>>ASSIGN
     12235>>ASSIGN  12236>>ASSIGN  12237>>ASSIGN  12238>>ASSIGN  12239>>ASSIGN  12240>>CALL
B_MPT.AS
     10111**DCL     10114--REDEF
B_MPT.ASDESC
     10143**DCL     10147--REDEF
B_MPT.ECCB
     10126**DCL     10129--REDEF
B_MPT.ECCBDESC
     10161**DCL     10165--REDEF
B_MPT.LS
     10106**DCL     10109--REDEF
B_MPT.LSDESC
     10137**DCL     10141--REDEF
B_MPT.PS
     10116**DCL     10119--REDEF
B_MPT.PSDESC
     10149**DCL     10153--REDEF
B_MPT.SS
     10101**DCL     10104--REDEF
B_MPT.SS$
     10104**DCL     11637>>ASSIGN  11668>>IF      11998>>IF
B_MPT.SSDESC
     10131**DCL     10135--REDEF
B_MPT.TCB
     10121**DCL     10124--REDEF
B_MPT.TCBDESC
     10155**DCL     10159--REDEF
CCBUFL
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:139  
      9798**DCL     11418<>CALL    11419>>IF      11429<<ASSIGN  11441<<ASSIGN  11537<<ASSIGN  11754>>IF
     11873<<ASSIGN  11877>>IF      11879<<ASSIGN  11880<>CALL    11882<>CALL
CCBUF_FPRG
     10045**DCL     11855<<ASSIGN  11879--ASSIGN  11880<>CALL
CCBUF_FPRG.MODTIME.DATE
     10070**DCL     10070--REDEF   11856<>CALL
CCBUF_FPRG.MODTIME.TIME
     10069**DCL     10069--REDEF   11856<>CALL
CCGT256
     11403**DCL     11421>>ASSIGN
CG
      9789**DCL     11480<<ASSIGN  11485<<ASSIGN  11544<<ASSIGN  11547<<ASSIGN  11561>>IF      11671>>IF
     11908>>IF      11944>>IF      11964>>IF      11987>>IF      11998>>IF
CG$
      9806**DCL     11481<>CALL
CHAR$1
      9639**DCL     11835<>CALL    11882<>CALL
CMN
     11542**LABEL   11528--GOTO    11551--GOTO
CONTDSC
      9791**DCL     11909<<ASSIGN  11910<<ASSIGN  11945<<ASSIGN  11946<<ASSIGN  12010>>IF
DCB$
      9799**DCL     11448<<ASSIGN  11450>>IF      11450>>IF      11450>>IF      11450>>IF      11465>>IF
     11478>>IF      11486>>IF      11487>>ASSIGN  11488>>ASSIGN  12014>>ASSIGN  12034<<ASSIGN
DEBUG
      9790**DCL     11679<<ASSIGN  11998>>IF
DID_SETFP
      9795**DCL     11558<<ASSIGN  11773<<ASSIGN  11976>>IF
DLDCT$ IN PROCEDURE GETPROFPRG
     12172**DCL     12176<<ASSIGN
DOLIST$
      9797**DCL        10--PROC    11534--ENTRY   11540>>ASSIGN
DONE
      9794**DCL     11807<<ASSIGN  11808>>DOWHILE 11918<<ASSIGN
DUMMY IN PROCEDURE GETPROFPRG
     12171**DCL     12239--ASSIGN
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:140  
DUSER
      9815**DCL     12005<<ASSIGN  12006<>CALL
EMR$FEP2HOST
     10207**DCL-ENT 11886--CALL
EMR$HOST2FEP
     10208**DCL-ENT 11980--CALL
F$CFU$
     10168**DCL     11665>>ASSIGN
F$DCB.ACCT
       105**DCL     11617<<ASSIGN  11664>>ASSIGN  12193<<ASSIGN
F$DCB.ACS
       112**DCL     11622<<ASSIGN  12196<<ASSIGN
F$DCB.ACTPOS
       120**DCL       120--REDEF
F$DCB.ARS
        95**DCL        95--REDEF   11691>>IF
F$DCB.ASN
       110**DCL     11450>>IF      11478>>IF      11620<<ASSIGN  12194<<ASSIGN
F$DCB.ATTR
       113**DCL       114--REDEF
F$DCB.BORROW
       128**DCL       128--REDEF     128--REDEF     128--REDEF
F$DCB.CFU$
       129**DCL     11487>>ASSIGN  11989>>ASSIGN  11990<<ASSIGN
F$DCB.DCB#
       122**DCL     11584<<ASSIGN  11862>>ASSIGN  11864<<ASSIGN  11968>>ASSIGN  11995>>ASSIGN
F$DCB.DCBNAME.L
       142**DCL       142--IMP-SIZ
F$DCB.EOMCHAR
        99**DCL        99--REDEF
F$DCB.EXPIRE
       111**DCL     11660>>ASSIGN  11856<>CALL
F$DCB.FCD
       108**DCL     11450>>IF      11958>>IF
F$DCB.FCN
       132**DCL     11465>>IF
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:141  
F$DCB.FFLG.EXEC
       100**DCL     11666>>ASSIGN
F$DCB.FLDID
       123**DCL       123--REDEF
F$DCB.FORM$
       117**DCL       117--REDEF
F$DCB.FPRGX
       119**DCL     11439>>IF      11440>>ASSIGN  11562>>IF      11571<<ASSIGN  11991>>ASSIGN
F$DCB.FSECT
       133**DCL       133--REDEF
F$DCB.FSN
       110**DCL       110--REDEF     110--REDEF     111--REDEF
F$DCB.FUN
       109**DCL     11621<<ASSIGN  12195<<ASSIGN
F$DCB.HEADER$
       116**DCL       116--REDEF
F$DCB.IASN
       136**DCL     11486>>IF
F$DCB.IXTNSIZE
       114**DCL       114--REDEF
F$DCB.LASTSTA$
       104**DCL       104--REDEF
F$DCB.LDCTX
       117**DCL     11489>>ASSIGN
F$DCB.LVL
       129**DCL       129--REDEF
F$DCB.NAME.C
       104**DCL       104--REDEF   11616<<ASSIGN  12192<<ASSIGN
F$DCB.NAME.L
       104**DCL     11615<<ASSIGN  12191<<ASSIGN
F$DCB.NOEOF
       125**DCL       125--REDEF
F$DCB.NRECS
       115**DCL       115--REDEF
F$DCB.NRECX
       134**DCL       134--REDEF
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:142  
F$DCB.OHDR
       126**DCL       126--REDEF
F$DCB.ORG
       109**DCL       109--REDEF   11450>>IF      11450>>IF
F$DCB.PASS
       105**DCL     11618<<ASSIGN
F$DCB.PRECNO
       132**DCL       132--REDEF
F$DCB.PSN
       105**DCL     11619<<ASSIGN
F$DCB.RCSZ
       137**DCL       137--REDEF
F$DCB.RES
       105**DCL       105--REDEF
F$DCB.SETX
       117**DCL       117--REDEF   11665>>ASSIGN
F$DCB.SHARE
       108**DCL     12197<<ASSIGN
F$DCB.TAB$
       116**DCL       117--REDEF
F$DCB.TDA
       131**DCL       131--REDEF
F$DCB.WSN
       106**DCL       106--REDEF
F$DCB.WSR
       112**DCL     11628<<ASSIGN  11635>>IF      11637<<ASSIGN
FCNMSG
      9860**DCL     11518<<ASSIGN  11520<>CALL    11520--CALL    11893--CALL    11978<<ASSIGN  11982<>CALL
     11982--CALL    12179--CALL
FCNMSG.ERR
      9867**DCL     11981<<ASSIGN
FCNMSG.FCN
      9860**DCL     11519<<ASSIGN  11979<<ASSIGN
FILL_SETFP_MSG
     11606**LABEL   11874--GOTO
FM$SET.PSN
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:143  
      9153**DCL     11665>>ASSIGN
FM$SET.USERLIST
      9154**DCL      9154--REDEF
FMD$GBUF
     10195**DCL-ENT 11556--CALL
FMD$RBUF
     10196**DCL-ENT 11955--CALL
FMM$DFLOPN
     10190**DCL-ENT 11631--CALL
FMM$DFLOPNP
     10191**DCL-ENT 12199--CALL
FMM$RELDCBI
     10201**DCL-ENT 11969--CALL    11996--CALL
FMM$SCRUB
     10189**DCL-ENT 11583--CALL    11863--CALL    12190--CALL
FMP$CLSJ
     10188**DCL-ENT 11861--CALL    11961--CALL    11967--CALL    11994--CALL
FPDBSY
     11383**DCL     11467>>ASSIGN
FPFID
     11371**DCL     12242>>ASSIGN
FPFIDE IN PROCEDURE GETPROFPRG
     12242**LABEL   12253--GOTO
FPRGEV
     10009**DCL     12001<<ASSIGN  12002--ASSIGN  12006--CALL
FPRGEV.DCBNO
     10011**DCL     12004<<ASSIGN
FPRGEV.FPRG
     10025**DCL     12002--ASSIGN
FPRGEV.P#
     10011**DCL     12002<<ASSIGN  12002--ASSIGN
FPRGEV.SUBC2
     10011**DCL     12003<<ASSIGN
FPT_FID IN PROCEDURE GETPROFPRG
     12145**DCL     12231<<ASSIGN  12240<>CALL
FPT_FID.ACCT_ IN PROCEDURE GETPROFPRG
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:144  
     12146**DCL     12235<<ASSIGN
FPT_FID.ASN_ IN PROCEDURE GETPROFPRG
     12148**DCL     12238<<ASSIGN
FPT_FID.NAME_ IN PROCEDURE GETPROFPRG
     12146**DCL     12234<<ASSIGN
FPT_FID.PASS_ IN PROCEDURE GETPROFPRG
     12146**DCL     12236<<ASSIGN
FPT_FID.RES_ IN PROCEDURE GETPROFPRG
     12148**DCL     12239<<ASSIGN
FPT_FID.SN_ IN PROCEDURE GETPROFPRG
     12147**DCL     12237<<ASSIGN
FPT_FID.TEXTFID_ IN PROCEDURE GETPROFPRG
     12145**DCL     12233<<ASSIGN
FPT_FID.V IN PROCEDURE GETPROFPRG
     12149**DCL     12232--ASSIGN
FPT_FID.V_ IN PROCEDURE GETPROFPRG
     12145**DCL     12232<<ASSIGN
FPT_FIDC IN PROCEDURE GETPROFPRG
     12122**DCL     12231>>ASSIGN
FPT_FIDC.V IN PROCEDURE GETPROFPRG
     12126**DCL     12122--DCLINIT
FPT_GETDCB
      9938**DCL     11580<>CALL
FPT_GETDCB.DCBNAME_
      9938**DCL     11578<<ASSIGN
FPT_GETDCB.DCBNUM_
      9938**DCL     11579<<ASSIGN
FPT_GETDCB.V
      9939**DCL     11576--ASSIGN  11577<<ASSIGN
FPT_GETDCB.V_
      9938**DCL     11576<<ASSIGN
FPT_READ
      9959**DCL     11683<<ASSIGN  11689<>CALL    11825<>CALL    12209<<ASSIGN  12214<>CALL
FPT_READ.BUF_
      9961**DCL     12211<<ASSIGN
FPT_READ.BUF_.BOUND
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:145  
      9961**DCL     11685<<ASSIGN
FPT_READ.BUF_.BUF$
      9962**DCL     11687<<ASSIGN
FPT_READ.KEY_
      9959**DCL     11688<<ASSIGN  11814<<ASSIGN  12213<<ASSIGN
FPT_READ.STATION_
      9962**DCL      9963--REDEF
FPT_READ.V
      9963**DCL     11684--ASSIGN  12210--ASSIGN
FPT_READ.V.DCB#
      9963**DCL     11686<<ASSIGN  11813<<ASSIGN  12212<<ASSIGN
FPT_READ.V.DVBYTE.REREAD#
      9974**DCL      9974--REDEF
FPT_READ.V.INDX#
      9972**DCL      9972--REDEF
FPT_READ.V_
      9959**DCL     11684<<ASSIGN  12210<<ASSIGN
FSA$GSP
     10197**DCL-ENT 11564--CALL
GETPROFPRG
     12046**PROC    11601--CALL
GJ_PROGKEY_MSG
      9898**DCL     11809<>CALL    11809--CALL    11893<>CALL
GJ_PROGKEY_MSG.ERR
      9905**DCL     11885>>ASSIGN
GJ_PROGKEY_MSG.FCN
      9898**DCL     11810>>DOCASE
GJ_PROGKEY_MSG.READ_BYSZ
      9917**DCL     11820<>CALL
GJ_PROGKEY_MSG.RU_KEY.KEYSIZ
      9910**DCL     11816>>ASSIGN
GJ_PROGKEY_MSG.RU_KEY.PAGE
      9912**DCL     11818<>CALL
GJ_PROGKEY_MSG.RU_KEY.TYPE
      9910**DCL     11817>>ASSIGN
GJ_PROGKEY_MSG.SECT_BYSZ
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:146  
      9922**DCL     11821<>CALL
HFC$LOCK
      5511**DCL-ENT 11493--CALL    11896--CALL    11941--CALL
HFC$UNLOCK
      5511**DCL-ENT 11498--CALL    11516--CALL    11524--CALL    11912--CALL    11948--CALL
HFF$DSIZ
     10192**DCL-ENT 11418--CALL
HFF$NILERASE
     10193**DCL-ENT 11416--CALL
ITS_MICROFPL
     11855**LABEL   11730--GOTO
JITERR
     11568**LABEL   11520--CALLALT 11580--CALLALT 11590--CALLALT 11809--CALLALT 11882--CALLALT
KCD$CDSCTRM
     10181**DCL-ENT 12011--CALL
KCI$CKSTAT
     10182**DCL-ENT 11481--CALL
KIA$8TO9
     10202**DCL-ENT 11818--CALL    11820--CALL    11821--CALL
KIA$9TO8
     10203**DCL-ENT 11662--CALL    11756--CALL    11757--CALL    11758--CALL    11760--CALL    11762--CALL
     11764--CALL    11766--CALL    11768--CALL    11770--CALL    11772--CALL
KIF$FPRGEVNT
     10184**DCL-ENT 12019--CALL
KIF$READ
     10185**DCL-ENT 11590--CALL    11809--CALL    12181--CALL
KIF$SEND
     10187**DCL-ENT 11847--CALL
KIF$WRITE
     10186**DCL-ENT 11520--CALL    11775--CALL    11835--CALL    11880--CALL    11882--CALL    11893--CALL
     11982--CALL    12179--CALL
KIF_BADHEAD
     11379**DCL     11694>>ASSIGN
KIF_FPT_READ
      9685**DCL     11683>>ASSIGN  12209>>ASSIGN
KIF_FPT_READ.STATION_
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:147  
      9688**DCL      9689--REDEF
KIF_FPT_READ.V
      9689**DCL      9685--DCLINIT
KIF_FPT_READ.V.DVBYTE.REREAD#
      9700**DCL      9700--REDEF
KIF_FPT_READ.V.INDX#
      9698**DCL      9698--REDEF
KIF_HDKEY
      9732**DCL     11688--ASSIGN
KIF_NONFP
     11387**DCL     11704>>ASSIGN
KIF_UNEXPT
     11407**DCL     11923>>ASSIGN  12204>>ASSIGN
LDCT$
      9804**DCL      9119--IMP-PTR  9805--REDEF   11482<<ASSIGN  11489<<ASSIGN  11493>>CALL    11495>>IF
     11498>>CALL    11511>>ASSIGN  11512>>IF      11514>>ASSIGN  11516>>CALL    11520>>CALL    11524>>CALL
     11542>>IF      11548>>ASSIGN  11573>>ASSIGN  11590>>CALL    11626>>IF      11627>>ASSIGN  11775>>CALL
     11809>>CALL    11835>>CALL    11847>>CALL    11880>>CALL    11882>>CALL    11893>>CALL    11896>>CALL
     11898>>ASSIGN  11899>>ASSIGN  11900>>IF      11901>>ASSIGN  11907>>ASSIGN  11908>>IF      11912>>CALL
     11941>>CALL    11943>>ASSIGN  11944>>IF      11948>>CALL    11975>>IF      11982>>CALL    12004>>ASSIGN
     12011>>CALL    12019>>CALL    12176>>ASSIGN  12179>>CALL    12181>>CALL
LDCT$U
      9805**DCL     11540<<ASSIGN
LDTRC
      9793**DCL     11447<<ASSIGN  11539<<ASSIGN  11588>>IF      11600>>IF      11668>>IF      11729>>IF
     11976>>IF      11998>>IF      12016>>IF
LDTRCMSG
      9410**DCL     11590<>CALL    11590--CALL
LDTRCMSG.ACCT
      9422**DCL     11593>>ASSIGN
LDTRCMSG.F1
      9414**DCL     11729>>IF
LDTRCMSG.NAME
      9422**DCL     11592>>ASSIGN
LDTRCMSG.PASS
      9422**DCL     11594>>ASSIGN
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:148  
LDTRCMSG.PSN
      9425**DCL     11595>>ASSIGN
LMDCB#
      9803**DCL     11579--ASSIGN  11581--ASSIGN  11584>>ASSIGN  11686>>ASSIGN  11813>>ASSIGN  11864>>ASSIGN
LMDCB$
      9802**DCL     11581<<ASSIGN  11582>>ASSIGN  11584>>ASSIGN  11615>>ASSIGN  11616>>ASSIGN  11617>>ASSIGN
     11618>>ASSIGN  11619>>ASSIGN  11620>>ASSIGN  11621>>ASSIGN  11622>>ASSIGN  11628>>ASSIGN  11635>>IF
     11637>>ASSIGN  11660>>ASSIGN  11664>>ASSIGN  11665>>ASSIGN  11666>>ASSIGN  11691>>IF      11856>>CALL
     11860>>ASSIGN  11862>>ASSIGN  11864>>ASSIGN  11964>>IF      11966>>ASSIGN  11968>>ASSIGN  11990>>ASSIGN
     12032<<ASSIGN  12257>>ASSIGN
M$MFID
     10198**DCL-ENT 12240--CALL
M$MGETDCB
     10200**DCL-ENT 11580--CALL
M$MREAD
     10199**DCL-ENT 11689--CALL    11825--CALL    12214--CALL
MEDDCB$
      9800**DCL     11487<<ASSIGN  11488<<ASSIGN  11489>>ASSIGN  11548<<ASSIGN  11562>>IF      11571>>ASSIGN
     11989>>ASSIGN  11990>>ASSIGN  11991>>ASSIGN  12033<<ASSIGN
MYERR
      9817**DCL     11568<<ASSIGN  11646<<ASSIGN  11694<<ASSIGN  11704<<ASSIGN  11718<<ASSIGN  11777<<ASSIGN
     11827<<ASSIGN  11837<<ASSIGN  11849<<ASSIGN  11886<>CALL    11890>>IF      11923<<ASSIGN  11964>>IF
     11972>>IF      11974<<ASSIGN  11974>>ASSIGN  11980<>CALL    12013>>ASSIGN  12018>>IF      12030<<ASSIGN
     12184<<ASSIGN  12204<<ASSIGN  12221<<ASSIGN  12242<<ASSIGN
MYERR.FCGM
      9818**DCL     11647<<ASSIGN
N$DCT$$
      5496**DCL      5496--IMP-PTR 11489>>ASSIGN
NFPRQ
     11391**DCL     11501>>ASSIGN
NK$LDCT
      9119**DCL     11520<>CALL    11590<>CALL    11775<>CALL    11809<>CALL    11835<>CALL    11847<>CALL
     11880<>CALL    11882<>CALL    11893<>CALL    11982<>CALL    12011<>CALL    12019<>CALL    12179<>CALL
     12181<>CALL
NK$LDCT.DCBNO
      9143**DCL     11548--ASSIGN
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:149  
NK$LDCT.DDT$
      9121**DCL      9121--REDEF
NK$LDCT.DFLG.OLDSC
      9124**DCL     11908>>IF      11944>>IF      11975>>IF
NK$LDCT.IOQ$
      9120**DCL      9121--REDEF
NK$LDCT.LDCTX
      9122**DCL      9122--REDEF
NK$LDCT.LKFLG.ABORTED
      9134**DCL      9135--REDEF   11512>>IF      11514<<ASSIGN  11907<<ASSIGN
NK$LDCT.LKFLG.FPPM
      9139**DCL     11511<<ASSIGN  11899<<ASSIGN  11943<<ASSIGN
NK$LDCT.LKFLG.FPSTEP
      9139**DCL     11495>>IF      11898<<ASSIGN
NK$LDCT.LKFLG.OBLK
      9134**DCL     11901<<ASSIGN
NK$LDCT.LOCK
      9147**DCL     11493<>CALL    11498<>CALL    11516<>CALL    11524<>CALL    11896<>CALL    11912<>CALL
     11941<>CALL    11948<>CALL
NK$LDCT.LOGON_ACCT
      9149**DCL     11626>>IF      11627>>ASSIGN
NK$LDCT.RESCOD
      9127**DCL     11542>>IF      11900>>IF
NK$LDCT.RLCID.LDCTX
      9144**DCL      9144--REDEF
NK$LDCT.STA$
      9140**DCL      9141--REDEF
NK$LDCT.SYMB$
      9119**DCL      9119--REDEF    9119--REDEF    9120--REDEF
NK$LDCT.UDCBNO
      9144**DCL     12004>>ASSIGN
NK$LDCT.USER
      9129**DCL     11573<<ASSIGN
NK$LDCT$
      5496**DCL     11489>>ASSIGN
NOTFP
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:150  
     11355**DCL     11454>>ASSIGN
NPFPRG
     11367**DCL     12221>>ASSIGN
N_READS
      9814**DCL     11822<<ASSIGN  11824>>DOINDEX
ONE_MORE_TIME
     11628**LABEL   11638--GOTO
OPNDEV
      9796**DCL     11431<<ASSIGN  11442<<ASSIGN  11538<<ASSIGN  11976>>IF
PHDR IN PROCEDURE GETPROFPRG
     12083**DCL     12211--ASSIGN
PHDR.GR_FPRG IN PROCEDURE GETPROFPRG
     12108**DCL     12219>>IF      12233--ASSIGN
PROFILE_ERR IN PROCEDURE GETPROFPRG
     12181**LABEL   12179--CALLALT
PROMSG
      9625**DCL     12177<<ASSIGN  12179<>CALL    12181<>CALL    12181--CALL
PROMSG.FCN
      9625**DCL     12178<<ASSIGN
PROMSG.PROFILE
      9637**DCL     12208>>ASSIGN  12213--ASSIGN
RECORD_BYSZ
      9813**DCL     11830<<ASSIGN  11831>>ASSIGN  11833>>DOWHILE 11834>>IF      11834>>ASSIGN  11841<<ASSIGN
     11841>>ASSIGN
REST
     11359**DCL     11718>>ASSIGN
RTN
     12014**LABEL   11481--CALLALT
S$CU$
     10177**DCL     11675>>IF
SAVE_ACCT
      9810**DCL     11625<<ASSIGN  11642>>ASSIGN
SC_FPRG
     10210**DCL-ENT 11922--CALL    12203--CALL
SETMSG
      9461**DCL     11606<<ASSIGN  11775<>CALL    11775--CALL
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:151  
SETMSG.ACCT
      9473**DCL     11611<<ASSIGN  11612>>ASSIGN  11617>>ASSIGN  11664<<ASSIGN
SETMSG.DATA_BIAS
      9543**DCL     11772<>CALL
SETMSG.DATA_SZ
      9533**DCL     11768<>CALL
SETMSG.DCBRES
      9508**DCL     11757<>CALL
SETMSG.FCN
      9461**DCL     11607<<ASSIGN
SETMSG.FLAGS.CCBUF
      9500**DCL     11755<<ASSIGN
SETMSG.FLAGS.CMDPROC
      9494**DCL     11751<<ASSIGN
SETMSG.FLAGS.DEBUG
      9500**DCL     11673<<ASSIGN  11676<<ASSIGN  11679>>ASSIGN
SETMSG.FLAGS.DEBUGGER
      9494**DCL     11752<<ASSIGN
SETMSG.FLAGS.LAUTO
      9500**DCL     11753<<ASSIGN
SETMSG.FLAGS.LIB
      9494**DCL     11750<<ASSIGN
SETMSG.FLAGS.NOCHRPMEM
      9495**DCL     11747<<ASSIGN
SETMSG.FLAGS.PROCACC
      9495**DCL     11745<<ASSIGN
SETMSG.FLAGS.PROCSURCHG
      9495**DCL     11746<<ASSIGN
SETMSG.FLAGS.S
      9494**DCL     11749<<ASSIGN
SETMSG.FLAGS.XEQ_ONLY
      9494**DCL     11666<<ASSIGN  11668>>IF
SETMSG.LIB_NAME
      9547**DCL     11734<<ASSIGN  11847<>CALL
SETMSG.MODTIME
      9476**DCL     11662<>CALL
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:152  
SETMSG.NAME
      9473**DCL     11608<<ASSIGN
SETMSG.NAME.L
      9473**DCL     11615>>ASSIGN
SETMSG.NAME.TEXT
      9473**DCL     11616>>ASSIGN
SETMSG.PASS
      9473**DCL     11609<<ASSIGN  11618>>ASSIGN
SETMSG.PRIV
      9486**DCL     11740<<ASSIGN  11742<<ASSIGN  11742>>ASSIGN  11744<<ASSIGN  11744>>ASSIGN
SETMSG.PROC_SZ
      9538**DCL     11770<>CALL
SETMSG.PSEUDO_COUNT
      9500**DCL     11736<<ASSIGN
SETMSG.PSEUDO_TEXT
      9501**DCL     11735<<ASSIGN
SETMSG.PSN
      9474**DCL     11610<<ASSIGN  11619>>ASSIGN  11665<<ASSIGN
SETMSG.ROS_SZ
      9528**DCL     11766<>CALL
SETMSG.START
      9481**DCL     11760<>CALL
SETMSG.TCBSIZE
      9513**DCL     11758<>CALL
SETMSG.UDCBNUM
      9503**DCL     11756<>CALL
SETMSG.VDPGS
      9523**DCL     11764<>CALL
SETMSG.VERSION
      9501**DCL     11737<<ASSIGN
SETMSG.VPPGS
      9518**DCL     11762<>CALL
SETUP
     12028**PROC    11446--CALL    11536--CALL
SETUP1
     11442**LABEL   11432--GOTO
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:153  
SNAP IN PROCEDURE GETPROFPRG
     12203**LABEL   12216--GOTO
SSS$UTS_L6
     10206**DCL-ENT 11661--CALL
SSV$EVENT
     10209**DCL-ENT 12006--CALL
STARDCB$
      9801**DCL     12188<<ASSIGN  12189>>ASSIGN  12191>>ASSIGN  12192>>ASSIGN  12193>>ASSIGN  12194>>ASSIGN
     12195>>ASSIGN  12196>>ASSIGN  12197>>ASSIGN
STATION
      9824**DCL     11481<>CALL
SYSFLAG
      9792**DCL     11612<<ASSIGN  11738>>IF
S_CUN
     10178**DCL     11573>>ASSIGN  12005>>ASSIGN
TEMP
      9807**DCL      9808--REDEF    9809--REDEF   11660<<ASSIGN  11661<>CALL    11661<>CALL    11662<>CALL
     11759<<ASSIGN  11760<>CALL    11761<<ASSIGN  11763<<ASSIGN  11765<<ASSIGN  11767<<ASSIGN  11768<>CALL
     11769<<ASSIGN  11770<>CALL    11771<<ASSIGN  11772<>CALL    11818<>CALL    11819>>ASSIGN  11824<<DOINDEX
TEMPA
      9809**DCL     11762<>CALL    11764<>CALL    11766<>CALL
TEMPB
      9808**DCL     11885<<ASSIGN  11886<>CALL    11980<>CALL    11981>>ASSIGN
TOTAL_BYSZ
      9812**DCL     11821<>CALL    11822>>ASSIGN  11830>>ASSIGN  11831<<ASSIGN  11831>>ASSIGN
TPTR$
      9816**DCL     11481<>CALL    11482>>ASSIGN  11556<>CALL    11557>>ASSIGN  11564<>CALL    11571>>ASSIGN
     11954<<ASSIGN  11955<>CALL
UMT$IDT2
     10205**DCL-ENT 11856--CALL
VLP$FPRG
      9374**DCL     11415>>ASSIGN  11440>>ASSIGN  11564--CALL    11991<<ASSIGN
VLP_FPRG
      9837**DCL     11415<<ASSIGN  11440<<ASSIGN  11591<<ASSIGN  11855>>ASSIGN  11866<<ASSIGN  11991>>ASSIGN
     12019<>CALL
VLP_FPRG.ACCT#
PL6.E3A0      #001=KIF$FPRG File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:32 Page:154  
      9843**DCL     11593<<ASSIGN  11611>>ASSIGN  11869<<ASSIGN  12235--ASSIGN
VLP_FPRG.FLGS.DEBUG#
      9841**DCL     11672>>IF
VLP_FPRG.LDBYPRO#
      9841**DCL     11600>>IF
VLP_FPRG.NAME
      9842**DCL     11592<<ASSIGN  11608>>ASSIGN  12234--ASSIGN
VLP_FPRG.NAME.C#
      9843**DCL     11868<<ASSIGN
VLP_FPRG.NAME.L#
      9842**DCL     11867<<ASSIGN
VLP_FPRG.PASS#
      9844**DCL     11594<<ASSIGN  11609>>ASSIGN  11870<<ASSIGN  12236--ASSIGN
VLP_FPRG.PROFILE#
      9844**DCL     12208<<ASSIGN
VLP_FPRG.PSN#
      9842**DCL     11595<<ASSIGN  11610>>ASSIGN  11871<<ASSIGN  12255<<ASSIGN  12256<<ASSIGN
VLP_LINEATTR.PROFILE# IN PROCEDURE GETPROFPRG
     12066**DCL     12066--REDEF
VLP_SN IN PROCEDURE GETPROFPRG
     12168**DCL     12237--ASSIGN
VLP_SN.NUM# IN PROCEDURE GETPROFPRG
     12168**DCL     12253>>IF      12254>>IF
VLP_SN.SN# IN PROCEDURE GETPROFPRG
     12168**DCL     12255>>ASSIGN
WRITE_BYSZ
      9811**DCL     11820<>CALL    11834>>IF      11834<<ASSIGN  11835<>CALL    11840>>ASSIGN  11841>>ASSIGN
XIT
     11922**LABEL   11569--GOTO    11601--CALLALT 11648--GOTO    11695--GOTO    11705--GOTO    11719--GOTO
     11778--GOTO    11850--GOTO    11887--GOTO    11891--GOTO    11924--GOTO

PL6.E3A0      #002=KIF$FPRGEVNT File=KIF$FPRG.:E05TSI                            WED 07/30/97 00:33 Page:155  
      931        1        /*T***********************************************************/
      932        2        /*T*                                                         */
      933        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      934        4        /*T*                                                         */
      935        5        /*T***********************************************************/
      936        6        /*D* NAME:        KIF$FPRGEVNT
      937        7             PURPOSE:     To report FPRG events to the appropriate user
      938        8             CALL:        CALL KIF$FPRGEVNT (NK$LDCT,EVNT,ERR);
      939        9             INPUT:       NK$LDCT - The FPRG's HOST LDCT
      940       10                          EVNT    - The FPRG event to report. This is either
      941       11                                    GJ_PROG_EXIT, GJ_PROG_ABORT or GJ_PROG_LDTRC.
      942       12                          ERR     - The LCP6 error code causing the abort. This
      943       13                                    is only used for the GJ_PROG_ABORT case.
      944       14             OUTPUT:      For CG-connected FPRGs, an AU event message describing
      945       15                          the event.
      946       16                          For DCB-connected FRPGs, a call to SSV$EVENT for the
      947       17                          DCB owner's M$EVENT-specified routine to process. If
      948       18                          the DCB owner did not ask for FPRG events by specifying
      949       19                          EVENT on the DCB's open, no output will result.
      950       20             DESCRIPTION: KIF$FPRGEVNT creates an AU event for CG-connected FPRGs
      951       21                          or makes a call to SSV$EVENT for DCB-connected FPRGs
      952       22                          whenever KIF$FPRGEVNT is called at any FPRG state
      953       23                          change. These state changes are EXIT, ABORT and LDTRC.
      954       24                          KIF$FPRGEVNT does not ALTRET.
      955       25        */
      956       26
      957       27        KIF$FPRGEVNT: PROC(NK$LDCT,EVNT,ERR);
      958       28        %INCLUDE B_STRINGS_C;
      959      157        %INCLUDE GJ_MSG_M;
      960      470        %INCLUDE HF_LOCK_C;
      961      484        %INCLUDE CP_6;
      962      565        %INCLUDE NK$LDCT;
      963      667        %INCLUDE NK_SUBS;
      964      692        %INCLUDE FOM_SUBS_C;
      965      755
      966      756        /* Parameters */
      967      757
PL6.E3A0      #002=KIF$FPRGEVNT File=KIF$FPRG.:E05TSI                            WED 07/30/97 00:33 Page:156  
      968      758        %NK$LDCT(STCLASS="");
      969      804    1   DCL EVNT UBIN;
      970      805    1   DCL ERR UBIN;
      971      806
      972      807        /* AUTO variables */
      973      808
      974      809    1   DCL ERROR UBIN;
      975      810    1   DCL EVENT UBIN;
      976      811        %B$FPRG(NAME=FPRGEV,STCLASS=AUTO,PARONLY=1);
      977      840    1   DCL DMN UBIN;
      978      841
      979      842        /* BASED structures */
      980      843
      981      844        %VLP_FPRG(FPTN=VLP$FPRG,STCLASS=BASED);
      982      865
      983      866        /* EQUs */
      984      867
      985      868        %GJ_FCN#;
      986      894        %SUB_EXC;
      987      941
      988      942        /* External procedures */
      989      943
      990      944    1   DCL KIA$GETEVNT ENTRY(3);
      991      945    1   DCL KQP$FPABORT ENTRY(2) ALTRET;
      992      946    1   DCL KQP$FPEXIT ENTRY(2) ALTRET;
      993      947    1   DCL KQP$FPLDTRC ENTRY(2) ALTRET;
      994      948    1   DCL SSV$EVENT ENTRY(7);
      995      949    1   DCL FOM$SYMBIN ENTRY(3) ALTRET;
      996      950
      997      951        %EJECT;
PL6.E3A0      #002=KIF$FPRGEVNT File=KIF$FPRG.:E05TSI                            WED 07/30/97 00:33 Page:157  
      998      952        /* KIF$FPRGEVNT is called from KIA$FPRGIN and KIF$FPRG.
      999      953        */
     1000      954
     1001      955    2      DO CASE(NK$LDCT.RESCOD);
     1002      956    2       CASE(NK_CGFPRG);
     1003      957    2         IF NK$LDCT.DFLG.SYMBIONT
     1004      958    3         THEN DO;
     1005      959    3              CALL FOM$SYMBIN ( NK$LDCT,,FOMI_FNC_FPRG_ABORT# );
     1006      960    3              END;
     1007      961    3         ELSE DO;
     1008      962    4              DO CASE(EVNT);
     1009      963    4               CASE(%GJ_PROG_EXIT#);
     1010      964    4                 CALL KQP$FPEXIT(NK$LDCT,ERR);
     1011      965    4               CASE(%GJ_PROG_ABRT#);
     1012      966    4                 CALL KQP$FPABORT(NK$LDCT,ERR);
     1013      967    4               CASE(%GJ_PROG_LDTRC#);
     1014      968    4                 CALL KQP$FPLDTRC(NK$LDCT,ERR);
     1015      969                                      /* Note that ERR is really a VLP_FPRG */
     1016      970    4                 END/*do case*/;
     1017      971    3              END/*do if not symbiont*/;
     1018      972    2       CASE(NK_TSFPRG);
     1019      973    2         CALL KIA$GETEVNT(NK$LDCT,EVENT,DMN);
     1020      974    2         IF EVENT~=0                  /* User requested FPRG events    */
     1021      975    3         THEN DO;
     1022      976    3              FPRGEV='0'B;
     1023      977    3              FPRGEV.DCBNO = NK$LDCT.UDCBNO;
     1024      978    4              DO CASE(EVNT);
     1025      979    4               CASE(%GJ_PROG_EXIT#);
     1026      980    4                 FPRGEV.SUBC2=%SUBC2_FPEXIT#;
     1027      981    4                 FPRGEV.P#=SIZEW(FPRGEV)-SIZEW(FPRGEV.FPRG)-SIZEW(FPRGEV.P#);
     1028      982    4                 ERROR=0;
     1029      983    4               CASE(%GJ_PROG_ABRT#);
     1030      984    4                 FPRGEV.SUBC2=%SUBC2_FPABORT#;
     1031      985    4                 FPRGEV.P#=SIZEW(FPRGEV)-SIZEW(FPRGEV.FPRG)-SIZEW(FPRGEV.P#);
     1032      986    4                 ERROR = ERR;
     1033      987    4               CASE(%GJ_PROG_LDTRC#);
     1034      988    4                 FPRGEV.SUBC2=%SUBC2_FPLDTRC#;
PL6.E3A0      #002=KIF$FPRGEVNT File=KIF$FPRG.:E05TSI                            WED 07/30/97 00:33 Page:158  
     1035      989    4                 FPRGEV.FPRG=ADDR(ERR)->VLP$FPRG;
     1036      990    4                 FPRGEV.P#=SIZEW(FPRGEV)-SIZEW(FPRGEV.P#);
     1037      991    4                 ERROR=0;
     1038      992    4                 END;
     1039      993    3              CALL SSV$EVENT(NK$LDCT.USER,DMN,%SUBC_FPRG#,EVENT,ERROR,ADDR(FPRGEV));
     1040      994    3              END;
     1041      995    2         END;                              /* CASE(NK$LDCT.RESCOD)     */
     1042      996    1   END KIF$FPRGEVNT;
     1043      997        %EOD;

PL6.E3A0      #002=KIF$FPRGEVNT File=KIF$FPRG.:E05TSI                            WED 07/30/97 00:33 Page:159  
--  Include file information  --

   FOM_SUBS_C.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   GJ_MSG_M.:E05TOU  is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure KIF$FPRGEVNT.

   Procedure KIF$FPRGEVNT requires 129 words for executable code.
   Procedure KIF$FPRGEVNT requires 36 words of local(AUTO) storage.

PL6.E3A0      #002=KIF$FPRGEVNT File=KIF$FPRG.:E05TSI                            WED 07/30/97 00:33 Page:160  

 Object Unit name= KIF$FPRGEVNT                               File name= KIF$FPRG.:E05TOU
 UTS= JUL 30 '97 00:33:57.56 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   Proc  even  none   129    201  KIF$FPRGEVNT
    2  RoData even  none     3      3  KIF$FPRGEVNT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        3  KIF$FPRGEVNT

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       3 FOM$SYMBIN
 yes     yes           Std       2 KQP$FPEXIT
 yes     yes           Std       2 KQP$FPLDTRC
         yes           Std       3 KIA$GETEVNT
         yes           Std       7 SSV$EVENT
 yes     yes           Std       2 KQP$FPABORT
                       nStd      0 X66_AUTO_3
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
PL6.E3A0      #002=KIF$FPRGEVNT File=KIF$FPRG.:E05TSI                            WED 07/30/97 00:33 Page:161  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #002=KIF$FPRGEVNT File=KIF$FPRG.:E05TSI                            WED 07/30/97 00:33 Page:162  


      931        1        /*T***********************************************************/
      932        2        /*T*                                                         */
      933        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      934        4        /*T*                                                         */
      935        5        /*T***********************************************************/
      936        6        /*D* NAME:        KIF$FPRGEVNT
      937        7             PURPOSE:     To report FPRG events to the appropriate user
      938        8             CALL:        CALL KIF$FPRGEVNT (NK$LDCT,EVNT,ERR);
      939        9             INPUT:       NK$LDCT - The FPRG's HOST LDCT
      940       10                          EVNT    - The FPRG event to report. This is either
      941       11                                    GJ_PROG_EXIT, GJ_PROG_ABORT or GJ_PROG_LDTRC.
      942       12                          ERR     - The LCP6 error code causing the abort. This
      943       13                                    is only used for the GJ_PROG_ABORT case.
      944       14             OUTPUT:      For CG-connected FPRGs, an AU event message describing
      945       15                          the event.
      946       16                          For DCB-connected FRPGs, a call to SSV$EVENT for the
      947       17                          DCB owner's M$EVENT-specified routine to process. If
      948       18                          the DCB owner did not ask for FPRG events by specifying
      949       19                          EVENT on the DCB's open, no output will result.
      950       20             DESCRIPTION: KIF$FPRGEVNT creates an AU event for CG-connected FPRGs
      951       21                          or makes a call to SSV$EVENT for DCB-connected FPRGs
      952       22                          whenever KIF$FPRGEVNT is called at any FPRG state
      953       23                          change. These state changes are EXIT, ABORT and LDTRC.
      954       24                          KIF$FPRGEVNT does not ALTRET.
      955       25        */
      956       26
      957       27        KIF$FPRGEVNT: PROC(NK$LDCT,EVNT,ERR);

     27  1 000000   000000 700200 xent  KIF$FPRGEVNT TSX0  ! X66_AUTO_3
         1 000001   000044 000003                    ZERO    36,3

      958       28        %INCLUDE B_STRINGS_C;
      959      157        %INCLUDE GJ_MSG_M;
      960      470        %INCLUDE HF_LOCK_C;
      961      484        %INCLUDE CP_6;
      962      565        %INCLUDE NK$LDCT;
PL6.E3A0      #002=KIF$FPRGEVNT File=KIF$FPRG.:E05TSI                            WED 07/30/97 00:33 Page:163  
      963      667        %INCLUDE NK_SUBS;
      964      692        %INCLUDE FOM_SUBS_C;
      965      755
      966      756        /* Parameters */
      967      757
      968      758        %NK$LDCT(STCLASS="");
      969      804    1   DCL EVNT UBIN;
      970      805    1   DCL ERR UBIN;
      971      806
      972      807        /* AUTO variables */
      973      808
      974      809    1   DCL ERROR UBIN;
      975      810    1   DCL EVENT UBIN;
      976      811        %B$FPRG(NAME=FPRGEV,STCLASS=AUTO,PARONLY=1);
      977      840    1   DCL DMN UBIN;
      978      841
      979      842        /* BASED structures */
      980      843
      981      844        %VLP_FPRG(FPTN=VLP$FPRG,STCLASS=BASED);
      982      865
      983      866        /* EQUs */
      984      867
      985      868        %GJ_FCN#;
      986      894        %SUB_EXC;
      987      941
      988      942        /* External procedures */
      989      943
      990      944    1   DCL KIA$GETEVNT ENTRY(3);
      991      945    1   DCL KQP$FPABORT ENTRY(2) ALTRET;
      992      946    1   DCL KQP$FPEXIT ENTRY(2) ALTRET;
      993      947    1   DCL KQP$FPLDTRC ENTRY(2) ALTRET;
      994      948    1   DCL SSV$EVENT ENTRY(7);
      995      949    1   DCL FOM$SYMBIN ENTRY(3) ALTRET;
      996      950
      997      951        %EJECT;
PL6.E3A0      #002=KIF$FPRGEVNT File=KIF$FPRG.:E05TSI                            WED 07/30/97 00:33 Page:164  
      998      952        /* KIF$FPRGEVNT is called from KIA$FPRGIN and KIF$FPRG.
      999      953        */
     1000      954
     1001      955    2      DO CASE(NK$LDCT.RESCOD);

    955  1 000002   200003 470500                    LDP0    @NK$LDCT,,AUTO
         1 000003   000006 236100                    LDQ     6,,PR0
         1 000004   000017 376007                    ANQ     15,DL
         1 000005   000010 136007                    SBLQ    8,DL
         1 000006   000002 116007                    CMPQ    2,DL
         1 000007   000011 602006 1                  TNC     s:955+7,QL
         1 000010   000200 710000 1                  TRA     s:996
         1 000011   000071 710000 1                  TRA     s:973
         1 000012   000013 710000 1                  TRA     s:957

     1002      956    2       CASE(NK_CGFPRG);

     1003      957    2         IF NK$LDCT.DFLG.SYMBIONT

    957  1 000013   000006 236100                    LDQ     6,,PR0
         1 000014   020000 316007                    CANQ    8192,DL
         1 000015   000030 600000 1                  TZE     s:962

     1004      958    3         THEN DO;

     1005      959    3              CALL FOM$SYMBIN ( NK$LDCT,,FOMI_FNC_FPRG_ABORT# );

    959  1 000016   000000 236000 2                  LDQ     0
         1 000017   200036 756100                    STQ     DMN+3,,AUTO
         1 000020   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000021   200003 235100                    LDA     @NK$LDCT,,AUTO
         1 000022   200034 757100                    STAQ    DMN+1,,AUTO
         1 000023   200034 630500                    EPPR0   DMN+1,,AUTO
         1 000024   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000025   000000 701000 xent               TSX1    FOM$SYMBIN
         1 000026   000000 011000                    NOP     0

PL6.E3A0      #002=KIF$FPRGEVNT File=KIF$FPRG.:E05TSI                            WED 07/30/97 00:33 Page:165  
     1006      960    3              END;

    960  1 000027   000200 710000 1                  TRA     s:996

     1007      961    3         ELSE DO;

     1008      962    4              DO CASE(EVNT);

    962  1 000030   200004 471500                    LDP1    @EVNT,,AUTO
         1 000031   100000 235100                    LDA     0,,PR1
         1 000032   000006 135007                    SBLA    6,DL
         1 000033   000003 115007                    CMPA    3,DL
         1 000034   000036 602005 1                  TNC     s:962+6,AL
         1 000035   000200 710000 1                  TRA     s:996
         1 000036   000041 710000 1                  TRA     s:964
         1 000037   000051 710000 1                  TRA     s:966
         1 000040   000061 710000 1                  TRA     s:968

     1009      963    4               CASE(%GJ_PROG_EXIT#);

     1010      964    4                 CALL KQP$FPEXIT(NK$LDCT,ERR);

    964  1 000041   200005 236100                    LDQ     @ERR,,AUTO
         1 000042   200003 235100                    LDA     @NK$LDCT,,AUTO
         1 000043   200034 757100                    STAQ    DMN+1,,AUTO
         1 000044   200034 630500                    EPPR0   DMN+1,,AUTO
         1 000045   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000046   000000 701000 xent               TSX1    KQP$FPEXIT
         1 000047   000000 011000                    NOP     0
         1 000050   000200 710000 1                  TRA     s:996

     1011      965    4               CASE(%GJ_PROG_ABRT#);

     1012      966    4                 CALL KQP$FPABORT(NK$LDCT,ERR);

    966  1 000051   200005 236100                    LDQ     @ERR,,AUTO
         1 000052   200003 235100                    LDA     @NK$LDCT,,AUTO
PL6.E3A0      #002=KIF$FPRGEVNT File=KIF$FPRG.:E05TSI                            WED 07/30/97 00:33 Page:166  
         1 000053   200034 757100                    STAQ    DMN+1,,AUTO
         1 000054   200034 630500                    EPPR0   DMN+1,,AUTO
         1 000055   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000056   000000 701000 xent               TSX1    KQP$FPABORT
         1 000057   000000 011000                    NOP     0
         1 000060   000200 710000 1                  TRA     s:996

     1013      967    4               CASE(%GJ_PROG_LDTRC#);

     1014      968    4                 CALL KQP$FPLDTRC(NK$LDCT,ERR);

    968  1 000061   200005 236100                    LDQ     @ERR,,AUTO
         1 000062   200003 235100                    LDA     @NK$LDCT,,AUTO
         1 000063   200034 757100                    STAQ    DMN+1,,AUTO
         1 000064   200034 630500                    EPPR0   DMN+1,,AUTO
         1 000065   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000066   000000 701000 xent               TSX1    KQP$FPLDTRC
         1 000067   000000 011000                    NOP     0

     1015      969                                      /* Note that ERR is really a VLP_FPRG */
     1016      970    4                 END/*do case*/;

     1017      971    3              END/*do if not symbiont*/;

    971  1 000070   000200 710000 1                  TRA     s:996

     1018      972    2       CASE(NK_TSFPRG);

     1019      973    2         CALL KIA$GETEVNT(NK$LDCT,EVENT,DMN);

    973  1 000071   200033 631500                    EPPR1   DMN,,AUTO
         1 000072   200036 451500                    STP1    DMN+3,,AUTO
         1 000073   200007 633500                    EPPR3   EVENT,,AUTO
         1 000074   200035 453500                    STP3    DMN+2,,AUTO
         1 000075   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000076   200034 756100                    STQ     DMN+1,,AUTO
         1 000077   200034 630500                    EPPR0   DMN+1,,AUTO
PL6.E3A0      #002=KIF$FPRGEVNT File=KIF$FPRG.:E05TSI                            WED 07/30/97 00:33 Page:167  
         1 000100   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000101   000000 701000 xent               TSX1    KIA$GETEVNT
         1 000102   000000 011000                    NOP     0

     1020      974    2         IF EVENT~=0                  /* User requested FPRG events    */

    974  1 000103   200007 235100                    LDA     EVENT,,AUTO
         1 000104   000200 600000 1                  TZE     s:996

     1021      975    3         THEN DO;

     1022      976    3              FPRGEV='0'B;

    976  1 000105   000100 100400                    MLR     fill='000'O
         1 000106   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         1 000107   200010 000114                    ADSC9   FPRGEV,,AUTO             cn=0,n=76

     1023      977    3              FPRGEV.DCBNO = NK$LDCT.UDCBNO;

    977  1 000110   200003 470500                    LDP0    @NK$LDCT,,AUTO
         1 000111   000016 236100                    LDQ     14,,PR0
         1 000112   000033 772000                    QRL     27
         1 000113   000000 620006                    EAX0    0,QL
         1 000114   200011 740100                    STX0    FPRGEV+1,,AUTO

     1024      978    4              DO CASE(EVNT);

    978  1 000115   200004 471500                    LDP1    @EVNT,,AUTO
         1 000116   100000 235100                    LDA     0,,PR1
         1 000117   000006 135007                    SBLA    6,DL
         1 000120   000003 115007                    CMPA    3,DL
         1 000121   000123 602005 1                  TNC     s:978+6,AL
         1 000122   000155 710000 1                  TRA     s:993
         1 000123   000126 710000 1                  TRA     s:980
         1 000124   000134 710000 1                  TRA     s:984
         1 000125   000144 710000 1                  TRA     s:988

PL6.E3A0      #002=KIF$FPRGEVNT File=KIF$FPRG.:E05TSI                            WED 07/30/97 00:33 Page:168  
     1025      979    4               CASE(%GJ_PROG_EXIT#);

     1026      980    4                 FPRGEV.SUBC2=%SUBC2_FPEXIT#;

    980  1 000126   000000 236003                    LDQ     0,DU
         1 000127   200011 552104                    STBQ    FPRGEV+1,'04'O,AUTO

     1027      981    4                 FPRGEV.P#=SIZEW(FPRGEV)-SIZEW(FPRGEV.FPRG)-SIZEW(FPRGEV.P#);

    981  1 000130   000001 235007                    LDA     1,DL
         1 000131   200010 755100                    STA     FPRGEV,,AUTO

     1028      982    4                 ERROR=0;

    982  1 000132   200006 450100                    STZ     ERROR,,AUTO
         1 000133   000155 710000 1                  TRA     s:993

     1029      983    4               CASE(%GJ_PROG_ABRT#);

     1030      984    4                 FPRGEV.SUBC2=%SUBC2_FPABORT#;

    984  1 000134   000001 236007                    LDQ     1,DL
         1 000135   200011 552104                    STBQ    FPRGEV+1,'04'O,AUTO

     1031      985    4                 FPRGEV.P#=SIZEW(FPRGEV)-SIZEW(FPRGEV.FPRG)-SIZEW(FPRGEV.P#);

    985  1 000136   000001 235007                    LDA     1,DL
         1 000137   200010 755100                    STA     FPRGEV,,AUTO

     1032      986    4                 ERROR = ERR;

    986  1 000140   200005 473500                    LDP3    @ERR,,AUTO
         1 000141   300000 235100                    LDA     0,,PR3
         1 000142   200006 755100                    STA     ERROR,,AUTO
         1 000143   000155 710000 1                  TRA     s:993

     1033      987    4               CASE(%GJ_PROG_LDTRC#);
PL6.E3A0      #002=KIF$FPRGEVNT File=KIF$FPRG.:E05TSI                            WED 07/30/97 00:33 Page:169  

     1034      988    4                 FPRGEV.SUBC2=%SUBC2_FPLDTRC#;

    988  1 000144   000002 236007                    LDQ     2,DL
         1 000145   200011 552104                    STBQ    FPRGEV+1,'04'O,AUTO

     1035      989    4                 FPRGEV.FPRG=ADDR(ERR)->VLP$FPRG;

    989  1 000146   200005 473500                    LDP3    @ERR,,AUTO
         1 000147   000100 100500                    MLR     fill='000'O
         1 000150   300000 000104                    ADSC9   0,,PR3                   cn=0,n=68
         1 000151   200012 000104                    ADSC9   FPRGEV+2,,AUTO           cn=0,n=68

     1036      990    4                 FPRGEV.P#=SIZEW(FPRGEV)-SIZEW(FPRGEV.P#);

    990  1 000152   000022 235007                    LDA     18,DL
         1 000153   200010 755100                    STA     FPRGEV,,AUTO

     1037      991    4                 ERROR=0;

    991  1 000154   200006 450100                    STZ     ERROR,,AUTO

     1038      992    4                 END;

     1039      993    3              CALL SSV$EVENT(NK$LDCT.USER,DMN,%SUBC_FPRG#,EVENT,ERROR,ADDR(FPRGEV));

    993  1 000155   200010 633500                    EPPR3   FPRGEV,,AUTO
         1 000156   200034 453500                    STP3    DMN+1,,AUTO
         1 000157   200034 634500                    EPPR4   DMN+1,,AUTO
         1 000160   200043 454500                    STP4    DMN+8,,AUTO
         1 000161   200006 635500                    EPPR5   ERROR,,AUTO
         1 000162   200042 455500                    STP5    DMN+7,,AUTO
         1 000163   200007 636500                    EPPR6   EVENT,,AUTO
         1 000164   200041 456500                    STP6    DMN+6,,AUTO
         1 000165   000001 236000 2                  LDQ     1
         1 000166   200040 756100                    STQ     DMN+5,,AUTO
         1 000167   200033 637500                    EPPR7   DMN,,AUTO
PL6.E3A0      #002=KIF$FPRGEVNT File=KIF$FPRG.:E05TSI                            WED 07/30/97 00:33 Page:170  
         1 000170   200037 457500                    STP7    DMN+4,,AUTO
         1 000171   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000172   000002 036000 2                  ADLQ    2
         1 000173   200036 756100                    STQ     DMN+3,,AUTO
         1 000174   200036 630500                    EPPR0   DMN+3,,AUTO
         1 000175   000024 631400 xsym               EPPR1   B_VECTNIL+20
         1 000176   000000 701000 xent               TSX1    SSV$EVENT
         1 000177   000000 011000                    NOP     0

     1040      994    3              END;

     1041      995    2         END;                              /* CASE(NK$LDCT.RESCOD)     */

     1042      996    1   END KIF$FPRGEVNT;

    996  1 000200   000000 702200 xent               TSX2  ! X66_ARET

(unnamed)
 Sect OctLoc
   2     000   000006 006000   000007 006000   000007 200000                    ............
     1043      997        %EOD;

PL6.E3A0      #002=KIF$FPRGEVNT File=KIF$FPRG.:E05TSI                            WED 07/30/97 00:33 Page:171  
--  Include file information  --

   FOM_SUBS_C.:E05TOU  is referenced.
   NK_SUBS.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   GJ_MSG_M.:E05TOU  is referenced.
   B_STRINGS_C.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure KIF$FPRGEVNT.
PL6.E3A0      #002=KIF$FPRGEVNT File=KIF$FPRG.:E05TSI                            WED 07/30/97 00:33 Page:172  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     5-0-0/w PTR         r     1 @ERR                       4-0-0/w PTR         r     1 @EVNT
     3-0-0/w PTR         r     1 @NK$LDCT                  33-0-0/w UBIN        r     1 DMN
    *0-0-0/w UBIN        r     1 ERR                        6-0-0/w UBIN        r     1 ERROR
     7-0-0/w UBIN        r     1 EVENT                     *0-0-0/w UBIN        r     1 EVNT
    10-0-0/w STRC(684)   r     1 FPRGEV                    *0-0-0/d STRC(864)   r     1 NK$LDCT

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(612)   r     1 VLP$FPRG


   Procedure KIF$FPRGEVNT requires 129 words for executable code.
   Procedure KIF$FPRGEVNT requires 36 words of local(AUTO) storage.
PL6.E3A0      #002=KIF$FPRGEVNT File=KIF$FPRG.:E05TSI                            WED 07/30/97 00:33 Page:173  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=KIF$FPRGEVNT File=KIF$FPRG.:E05TSI                            WED 07/30/97 00:33 Page:174  
          MINI XREF LISTING

DMN
       840**DCL       973<>CALL      993<>CALL
ERR
       805**DCL        27--PROC      964<>CALL      966<>CALL      968<>CALL      986>>ASSIGN    989--ASSIGN
ERROR
       809**DCL       982<<ASSIGN    986<<ASSIGN    991<<ASSIGN    993<>CALL
EVENT
       810**DCL       973<>CALL      974>>IF        993<>CALL
EVNT
       804**DCL        27--PROC      962>>DOCASE    978>>DOCASE
FOM$SYMBIN
       949**DCL-ENT   959--CALL
FPRGEV
       815**DCL       976<<ASSIGN    981--ASSIGN    985--ASSIGN    990--ASSIGN    993--CALL
FPRGEV.DCBNO
       817**DCL       977<<ASSIGN
FPRGEV.FPRG
       831**DCL       981--ASSIGN    985--ASSIGN    989<<ASSIGN
FPRGEV.P#
       817**DCL       981<<ASSIGN    981--ASSIGN    985<<ASSIGN    985--ASSIGN    990<<ASSIGN    990--ASSIGN
FPRGEV.SUBC2
       817**DCL       980<<ASSIGN    984<<ASSIGN    988<<ASSIGN
KIA$GETEVNT
       944**DCL-ENT   973--CALL
KQP$FPABORT
       945**DCL-ENT   966--CALL
KQP$FPEXIT
       946**DCL-ENT   964--CALL
KQP$FPLDTRC
       947**DCL-ENT   968--CALL
NK$LDCT
       771**DCL        27--PROC      959<>CALL      964<>CALL      966<>CALL      968<>CALL      973<>CALL
PL6.E3A0      #002=KIF$FPRGEVNT File=KIF$FPRG.:E05TSI                            WED 07/30/97 00:33 Page:175  
NK$LDCT.DDT$
       773**DCL       773--REDEF
NK$LDCT.DFLG.SYMBIONT
       776**DCL       957>>IF
NK$LDCT.IOQ$
       772**DCL       773--REDEF
NK$LDCT.LDCTX
       774**DCL       774--REDEF
NK$LDCT.LKFLG.ABORTED
       786**DCL       787--REDEF
NK$LDCT.RESCOD
       779**DCL       955>>DOCASE
NK$LDCT.RLCID.LDCTX
       796**DCL       796--REDEF
NK$LDCT.STA$
       792**DCL       793--REDEF
NK$LDCT.SYMB$
       771**DCL       771--REDEF     771--REDEF     772--REDEF
NK$LDCT.UDCBNO
       796**DCL       977>>ASSIGN
NK$LDCT.USER
       781**DCL       993<>CALL
SSV$EVENT
       948**DCL-ENT   993--CALL
VLP$FPRG
       855**DCL       989>>ASSIGN

PL6.E3A0      #003=KIF$WRITE File=KIF$FPRG.:E05TSI                               WED 07/30/97 00:34 Page:176  
     1044        1        /*T***********************************************************/
     1045        2        /*T*                                                         */
     1046        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1047        4        /*T*                                                         */
     1048        5        /*T***********************************************************/
     1049        6        /*D* NAME:        KIF$WRITE
     1050        7             PURPOSE:     To write a message through an LDCT for FPRGs
     1051        8             CALL:        CALL KIF$WRITE(LDCT,BUF,BUFLEN) ALTRET(LBL);
     1052        9             INPUT:       LDCT - The LDCT to write through
     1053       10                          BUF - The buffer to write
     1054       11                          BUFLEN - The byte length of BUF
     1055       12             OUTPUT:      B$JIT.ERR is set if an error occurs
     1056       13             DESCRIPTION: KIF$WRITE writes BUF of byte length, BUFLEN, through
     1057       14                          LDCT. If an error occurs, then B$JIT.ERR
     1058       15                          will be filled in and KIF$WRITE will ALTRET;
     1059       16                          otherwise, KIF$WRITE will RETURN.
     1060       17        */
     1061       18
     1062       19        KIF$WRITE: PROC(LDCT,BUF,BUFLEN)  ALTRET;
     1063       20
     1064       21
     1065       22        /* INCLUDES */
     1066       23
     1067       24        %INCLUDE B$JIT;
     1068      314        %INCLUDE CP_6_SUBS;
     1069      854        %INCLUDE F_FPTCODE_C;
     1070      890        %INCLUDE F$DCB;
     1071      939        %INCLUDE NK$LDCT;
     1072     1041
     1073     1042        /* PARAMETERS */
     1074     1043
     1075     1044    1   DCL LDCT UBIN /* dummy DCL - only its address is ever used here */;
     1076     1045    1   DCL BUF CHAR(1);
     1077     1046    1   DCL BUFLEN UBIN;
     1078     1047
     1079     1048        /* AUTO */
     1080     1049
PL6.E3A0      #003=KIF$WRITE File=KIF$FPRG.:E05TSI                               WED 07/30/97 00:34 Page:177  
     1081     1050    1   DCL FCN UBIN WORD;
     1082     1051    1   DCL DVBYTE BIT(9) CALIGNED;
     1083     1052    1   DCL VFCCHAR CHAR(1);
     1084     1053    1   DCL UB$ PTR;
     1085     1054    1   DCL LEN UBIN;
     1086     1055    1   DCL EVNT UBIN;
     1087     1056    1   DCL TYC REDEF EVNT BIT(36);
     1088     1057
     1089     1058        /* SUBs */
     1090     1059
     1091     1060        %SUB KI#='1311'O;
     1092     1061        %SUB F#='06'O;
     1093     1062
     1094     1063        /* SYMREFs */
     1095     1064
     1096     1065    1   DCL B$JIT$ PTR SYMREF;
     1097     1066
     1098     1067        /* ENTDEFs */
     1099     1068    1   DCL KIA$UCIOND ENTRY(7) ALTRET;
     1100     1069
     1101     1070        /* BASED */
     1102     1071        %NK$LDCT;
     1103     1117        %EJECT;
PL6.E3A0      #003=KIF$WRITE File=KIF$FPRG.:E05TSI                               WED 07/30/97 00:34 Page:178  
     1104     1118        /* KIF$WRITE
     1105     1119        */
     1106     1120    1      FCN=MFC_WRITE;
     1107     1121    1   IO: ;
     1108     1122    1      DVBYTE=%DVBYTE_BP#;
     1109     1123    1      VFCCHAR=' ';
     1110     1124    1      EVNT=0;
     1111     1125    1      UB$=ADDR(BUF);
     1112     1126    1      LEN=BUFLEN;
     1113     1127    1      B$JIT.ERR='0'B;
     1114     1128    1      CALL KIA$UCIOND (FCN,DVBYTE,VFCCHAR,EVNT,UB$,LEN,LDCT)
     1115     1129    2      WHENALTRETURN DO;
     1116     1130    2           B$JIT.ERR.FCG=KI#;
     1117     1131    2           B$JIT.ERR.MID=F#;
     1118     1132    2           ALTRETURN;
     1119     1133    2           END;
     1120     1134    1      RETURN;
     1121     1135
     1122     1136        /*D* NAME:        KIF$READ
     1123     1137             PURPOSE:     To read BUF through LDCT
     1124     1138             DESCRIPTION: Same as KIF$WRITE except KIF$READ reads instead of
     1125     1139                          writes
     1126     1140        */
     1127     1141
     1128     1142
     1129     1143    1   KIF$READ: ENTRY(LDCT,BUF,BUFLEN) ALTRET;
     1130     1144
     1131     1145    1      FCN=MFC_READ;
     1132     1146    1      ADDR(LDCT)->NK$LDCT.RDSOUT = 0;
     1133     1147    1      GOTO IO;
     1134     1148        /*D* NAME:        KIF$WRITE_IMD
     1135     1149             PURPOSE:     To write BUF through LDCT
     1136     1150             DESCRIPTION: Same as KIF$WRITE except no throttling is used.
     1137     1151        */
     1138     1152
     1139     1153
     1140     1154    1   KIF$WRITE_IMD: ENTRY(LDCT,BUF,BUFLEN) ALTRET;
PL6.E3A0      #003=KIF$WRITE File=KIF$FPRG.:E05TSI                               WED 07/30/97 00:34 Page:179  
     1141     1155
     1142     1156    1      FCN=MFC_WRIMD;
     1143     1157    1      GOTO IO;
     1144     1158    1   END KIF$WRITE;
     1145     1159        %EOD;

PL6.E3A0      #003=KIF$WRITE File=KIF$FPRG.:E05TSI                               WED 07/30/97 00:34 Page:180  
--  Include file information  --

   NK$LDCT.:E05TOU  is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   F_FPTCODE_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure KIF$WRITE.

   Procedure KIF$WRITE requires 54 words for executable code.
   Procedure KIF$WRITE requires 20 words of local(AUTO) storage.

PL6.E3A0      #003=KIF$WRITE File=KIF$FPRG.:E05TSI                               WED 07/30/97 00:34 Page:181  

 Object Unit name= KIF$WRITE                                  File name= KIF$FPRG.:E05TOU
 UTS= JUL 30 '97 00:34:15.36 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none    54     66  KIF$WRITE

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes    yes     yes      Std        3  KIF$WRITE
     0     52          yes     yes      Std        3  KIF$READ
     0     61          yes     yes      Std        3  KIF$WRITE_IMD

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       7 KIA$UCIOND
                       nStd      0 X66_AUTO_3
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AALT
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     B$JIT$                                B_VECTNIL
PL6.E3A0      #003=KIF$WRITE File=KIF$FPRG.:E05TSI                               WED 07/30/97 00:34 Page:182  


     1044        1        /*T***********************************************************/
     1045        2        /*T*                                                         */
     1046        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1047        4        /*T*                                                         */
     1048        5        /*T***********************************************************/
     1049        6        /*D* NAME:        KIF$WRITE
     1050        7             PURPOSE:     To write a message through an LDCT for FPRGs
     1051        8             CALL:        CALL KIF$WRITE(LDCT,BUF,BUFLEN) ALTRET(LBL);
     1052        9             INPUT:       LDCT - The LDCT to write through
     1053       10                          BUF - The buffer to write
     1054       11                          BUFLEN - The byte length of BUF
     1055       12             OUTPUT:      B$JIT.ERR is set if an error occurs
     1056       13             DESCRIPTION: KIF$WRITE writes BUF of byte length, BUFLEN, through
     1057       14                          LDCT. If an error occurs, then B$JIT.ERR
     1058       15                          will be filled in and KIF$WRITE will ALTRET;
     1059       16                          otherwise, KIF$WRITE will RETURN.
     1060       17        */
     1061       18
     1062       19        KIF$WRITE: PROC(LDCT,BUF,BUFLEN)  ALTRET;

     19  0 000000   000000 700200 xent  KIF$WRITE    TSX0  ! X66_AUTO_3
         0 000001   000024 000003                    ZERO    20,3

     1063       20
     1064       21
     1065       22        /* INCLUDES */
     1066       23
     1067       24        %INCLUDE B$JIT;
     1068      314        %INCLUDE CP_6_SUBS;
     1069      854        %INCLUDE F_FPTCODE_C;
     1070      890        %INCLUDE F$DCB;
     1071      939        %INCLUDE NK$LDCT;
     1072     1041
     1073     1042        /* PARAMETERS */
     1074     1043
     1075     1044    1   DCL LDCT UBIN /* dummy DCL - only its address is ever used here */;
PL6.E3A0      #003=KIF$WRITE File=KIF$FPRG.:E05TSI                               WED 07/30/97 00:34 Page:183  
     1076     1045    1   DCL BUF CHAR(1);
     1077     1046    1   DCL BUFLEN UBIN;
     1078     1047
     1079     1048        /* AUTO */
     1080     1049
     1081     1050    1   DCL FCN UBIN WORD;
     1082     1051    1   DCL DVBYTE BIT(9) CALIGNED;
     1083     1052    1   DCL VFCCHAR CHAR(1);
     1084     1053    1   DCL UB$ PTR;
     1085     1054    1   DCL LEN UBIN;
     1086     1055    1   DCL EVNT UBIN;
     1087     1056    1   DCL TYC REDEF EVNT BIT(36);
     1088     1057
     1089     1058        /* SUBs */
     1090     1059
     1091     1060        %SUB KI#='1311'O;
     1092     1061        %SUB F#='06'O;
     1093     1062
     1094     1063        /* SYMREFs */
     1095     1064
     1096     1065    1   DCL B$JIT$ PTR SYMREF;
     1097     1066
     1098     1067        /* ENTDEFs */
     1099     1068    1   DCL KIA$UCIOND ENTRY(7) ALTRET;
     1100     1069
     1101     1070        /* BASED */
     1102     1071        %NK$LDCT;
     1103     1117        %EJECT;
PL6.E3A0      #003=KIF$WRITE File=KIF$FPRG.:E05TSI                               WED 07/30/97 00:34 Page:184  
     1104     1118        /* KIF$WRITE
     1105     1119        */
     1106     1120    1      FCN=MFC_WRITE;

   1120  0 000002   000001 235007                    LDA     1,DL
         0 000003   200006 755100                    STA     FCN,,AUTO

   1120  0 000004                       IO           null
     1107     1121    1   IO: ;
     1108     1122    1      DVBYTE=%DVBYTE_BP#;

   1122  0 000004   200000 236003                    LDQ     65536,DU
         0 000005   200007 756100                    STQ     DVBYTE,,AUTO

     1109     1123    1      VFCCHAR=' ';

   1123  0 000006   040000 236003                    LDQ     16384,DU
         0 000007   200010 756100                    STQ     VFCCHAR,,AUTO

     1110     1124    1      EVNT=0;

   1124  0 000010   200013 450100                    STZ     EVNT,,AUTO

     1111     1125    1      UB$=ADDR(BUF);

   1125  0 000011   200004 236100                    LDQ     @BUF,,AUTO
         0 000012   200011 756100                    STQ     UB$,,AUTO

     1112     1126    1      LEN=BUFLEN;

   1126  0 000013   200005 470500                    LDP0    @BUFLEN,,AUTO
         0 000014   000000 235100                    LDA     0,,PR0
         0 000015   200012 755100                    STA     LEN,,AUTO

     1113     1127    1      B$JIT.ERR='0'B;

   1127  0 000016   000000 471400 xsym               LDP1    B$JIT$
PL6.E3A0      #003=KIF$WRITE File=KIF$FPRG.:E05TSI                               WED 07/30/97 00:34 Page:185  
         0 000017   100012 450100                    STZ     10,,PR1

     1114     1128    1      CALL KIA$UCIOND (FCN,DVBYTE,VFCCHAR,EVNT,UB$,LEN,LDCT)

   1128  0 000020   200003 236100                    LDQ     @LDCT,,AUTO
         0 000021   200022 756100                    STQ     EVNT+7,,AUTO
         0 000022   200012 633500                    EPPR3   LEN,,AUTO
         0 000023   200021 453500                    STP3    EVNT+6,,AUTO
         0 000024   200011 634500                    EPPR4   UB$,,AUTO
         0 000025   200020 454500                    STP4    EVNT+5,,AUTO
         0 000026   200013 635500                    EPPR5   EVNT,,AUTO
         0 000027   200017 455500                    STP5    EVNT+4,,AUTO
         0 000030   200010 636500                    EPPR6   VFCCHAR,,AUTO
         0 000031   200016 456500                    STP6    EVNT+3,,AUTO
         0 000032   200007 637500                    EPPR7   DVBYTE,,AUTO
         0 000033   200015 457500                    STP7    EVNT+2,,AUTO
         0 000034   200006 630500                    EPPR0   FCN,,AUTO
         0 000035   200014 450500                    STP0    EVNT+1,,AUTO
         0 000036   200014 630500                    EPPR0   EVNT+1,,AUTO
         0 000037   000025 631400 xsym               EPPR1   B_VECTNIL+21
         0 000040   000000 701000 xent               TSX1    KIA$UCIOND
         0 000041   000043 702000 0                  TSX2    s:1130
         0 000042   000051 710000 0                  TRA     s:1134

     1115     1129    2      WHENALTRETURN DO;

     1116     1130    2           B$JIT.ERR.FCG=KI#;

   1130  0 000043   000000 470400 xsym               LDP0    B$JIT$
         0 000044   131100 236003                    LDQ     45632,DU
         0 000045   000012 752160                    STCQ    10,'60'O,PR0

     1117     1131    2           B$JIT.ERR.MID=F#;

   1131  0 000046   000006 236003                    LDQ     6,DU
         0 000047   000012 752110                    STCQ    10,'10'O,PR0

PL6.E3A0      #003=KIF$WRITE File=KIF$FPRG.:E05TSI                               WED 07/30/97 00:34 Page:186  
     1118     1132    2           ALTRETURN;

   1132  0 000050   000000 702200 xent               TSX2  ! X66_AALT

     1119     1133    2           END;
     1120     1134    1      RETURN;

   1134  0 000051   000000 702200 xent               TSX2  ! X66_ARET

     1121     1135
     1122     1136        /*D* NAME:        KIF$READ
     1123     1137             PURPOSE:     To read BUF through LDCT
     1124     1138             DESCRIPTION: Same as KIF$WRITE except KIF$READ reads instead of
     1125     1139                          writes
     1126     1140        */
     1127     1141
     1128     1142
     1129     1143    1   KIF$READ: ENTRY(LDCT,BUF,BUFLEN) ALTRET;

   1143  0 000052   000000 700200 xent  KIF$READ     TSX0  ! X66_AUTO_3
         0 000053   000024 000003                    ZERO    20,3

     1130     1144
     1131     1145    1      FCN=MFC_READ;

   1145  0 000054   200006 450100                    STZ     FCN,,AUTO

     1132     1146    1      ADDR(LDCT)->NK$LDCT.RDSOUT = 0;

   1146  0 000055   200003 470500                    LDP0    @LDCT,,AUTO
         0 000056   000000 236003                    LDQ     0,DU
         0 000057   000007 752140                    STCQ    7,'40'O,PR0

     1133     1147    1      GOTO IO;

   1147  0 000060   000004 710000 0                  TRA     IO

PL6.E3A0      #003=KIF$WRITE File=KIF$FPRG.:E05TSI                               WED 07/30/97 00:34 Page:187  
     1134     1148        /*D* NAME:        KIF$WRITE_IMD
     1135     1149             PURPOSE:     To write BUF through LDCT
     1136     1150             DESCRIPTION: Same as KIF$WRITE except no throttling is used.
     1137     1151        */
     1138     1152
     1139     1153
     1140     1154    1   KIF$WRITE_IMD: ENTRY(LDCT,BUF,BUFLEN) ALTRET;

   1154  0 000061   000000 700200 xent  KIF$WRITE_I* TSX0  ! X66_AUTO_3
         0 000062   000024 000003                    ZERO    20,3

     1141     1155
     1142     1156    1      FCN=MFC_WRIMD;

   1156  0 000063   000016 235007                    LDA     14,DL
         0 000064   200006 755100                    STA     FCN,,AUTO

     1143     1157    1      GOTO IO;

   1157  0 000065   000004 710000 0                  TRA     IO
     1144     1158    1   END KIF$WRITE;
     1145     1159        %EOD;

PL6.E3A0      #003=KIF$WRITE File=KIF$FPRG.:E05TSI                               WED 07/30/97 00:34 Page:188  
--  Include file information  --

   NK$LDCT.:E05TOU  is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   F_FPTCODE_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure KIF$WRITE.
PL6.E3A0      #003=KIF$WRITE File=KIF$FPRG.:E05TSI                               WED 07/30/97 00:34 Page:189  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @BUF                       5-0-0/w PTR         r     1 @BUFLEN
     3-0-0/w PTR         r     1 @LDCT                     *0-0-0/c CHAR        r     1 BUF
    *0-0-0/w UBIN        r     1 BUFLEN                     7-0-0/c BIT (9)     r     1 DVBYTE
    13-0-0/w UBIN        r     1 EVNT                       6-0-0/w UBIN        r     1 FCN
    *0-0-0/w UBIN        r     1 LDCT                      12-0-0/w UBIN        r     1 LEN
    11-0-0/w PTR         r     1 UB$                       10-0-0/c CHAR        r     1 VFCCHAR

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/d ASTR(3528)  r     1 F$DCB
     0-0-0/d STRC(864)   r     1 NK$LDCT


   Procedure KIF$WRITE requires 54 words for executable code.
   Procedure KIF$WRITE requires 20 words of local(AUTO) storage.
PL6.E3A0      #003=KIF$WRITE File=KIF$FPRG.:E05TSI                               WED 07/30/97 00:34 Page:190  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=KIF$WRITE File=KIF$FPRG.:E05TSI                               WED 07/30/97 00:34 Page:191  
          MINI XREF LISTING

B$JIT.CPFLAGS1.SLEAZE
       132**DCL       132--REDEF
B$JIT.ERR
        38**DCL      1127<<ASSIGN
B$JIT.ERR.FCG
        38**DCL      1130<<ASSIGN
B$JIT.ERR.MID
        39**DCL        39--REDEF    1131<<ASSIGN
B$JIT.JRESPEAK
       200**DCL       201--REDEF
B$JIT.ORIGINATOR_PORT.FROM_CR
       309**DCL       309--REDEF     310--REDEF
B$JIT.PNR
       213**DCL       213--REDEF
B$JIT.TSLINE
       307**DCL       308--REDEF
B$JIT$
      1065**DCL        33--IMP-PTR  1127>>ASSIGN   1130>>ASSIGN   1131>>ASSIGN
BUF
      1045**DCL        19--PROC     1125--ASSIGN   1143--ENTRY    1154--ENTRY
BUFLEN
      1046**DCL        19--PROC     1126>>ASSIGN   1143--ENTRY    1154--ENTRY
DVBYTE
      1051**DCL      1122<<ASSIGN   1128<>CALL
EVNT
      1055**DCL      1056--REDEF    1124<<ASSIGN   1128<>CALL
F$DCB.ACTPOS
       916**DCL       916--REDEF
F$DCB.ARS
       891**DCL       891--REDEF
F$DCB.ATTR
       909**DCL       910--REDEF
PL6.E3A0      #003=KIF$WRITE File=KIF$FPRG.:E05TSI                               WED 07/30/97 00:34 Page:192  
F$DCB.BORROW
       924**DCL       924--REDEF     924--REDEF     924--REDEF
F$DCB.DCBNAME.L
       938**DCL       938--IMP-SIZ
F$DCB.EOMCHAR
       895**DCL       895--REDEF
F$DCB.FLDID
       919**DCL       919--REDEF
F$DCB.FORM$
       913**DCL       913--REDEF
F$DCB.FSECT
       929**DCL       929--REDEF
F$DCB.FSN
       906**DCL       906--REDEF     906--REDEF     907--REDEF
F$DCB.HEADER$
       912**DCL       912--REDEF
F$DCB.IXTNSIZE
       910**DCL       910--REDEF
F$DCB.LASTSTA$
       900**DCL       900--REDEF
F$DCB.LVL
       925**DCL       925--REDEF
F$DCB.NAME.C
       900**DCL       900--REDEF
F$DCB.NOEOF
       921**DCL       921--REDEF
F$DCB.NRECS
       911**DCL       911--REDEF
F$DCB.NRECX
       930**DCL       930--REDEF
F$DCB.OHDR
       922**DCL       922--REDEF
F$DCB.ORG
       905**DCL       905--REDEF
F$DCB.PRECNO
       928**DCL       928--REDEF
PL6.E3A0      #003=KIF$WRITE File=KIF$FPRG.:E05TSI                               WED 07/30/97 00:34 Page:193  
F$DCB.RCSZ
       933**DCL       933--REDEF
F$DCB.RES
       901**DCL       901--REDEF
F$DCB.SETX
       913**DCL       913--REDEF
F$DCB.TAB$
       912**DCL       913--REDEF
F$DCB.TDA
       927**DCL       927--REDEF
F$DCB.WSN
       902**DCL       902--REDEF
FCN
      1050**DCL      1120<<ASSIGN   1128<>CALL     1145<<ASSIGN   1156<<ASSIGN
IO
      1120**LABEL    1147--GOTO     1157--GOTO
KIA$UCIOND
      1068**DCL-ENT  1128--CALL
LDCT
      1044**DCL        19--PROC     1128<>CALL     1143--ENTRY    1146--ASSIGN   1154--ENTRY
LEN
      1054**DCL      1126<<ASSIGN   1128<>CALL
NK$LDCT.DDT$
      1086**DCL      1086--REDEF
NK$LDCT.IOQ$
      1085**DCL      1086--REDEF
NK$LDCT.LDCTX
      1087**DCL      1087--REDEF
NK$LDCT.LKFLG.ABORTED
      1099**DCL      1100--REDEF
NK$LDCT.RDSOUT
      1093**DCL      1146<<ASSIGN
NK$LDCT.RLCID.LDCTX
      1109**DCL      1109--REDEF
NK$LDCT.STA$
      1105**DCL      1106--REDEF
PL6.E3A0      #003=KIF$WRITE File=KIF$FPRG.:E05TSI                               WED 07/30/97 00:34 Page:194  
NK$LDCT.SYMB$
      1084**DCL      1084--REDEF    1084--REDEF    1085--REDEF
UB$
      1053**DCL      1125<<ASSIGN   1128<>CALL
VFCCHAR
      1052**DCL      1123<<ASSIGN   1128<>CALL

PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:195  
     1146        1        /*T***********************************************************/
     1147        2        /*T*                                                         */
     1148        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1149        4        /*T*                                                         */
     1150        5        /*T***********************************************************/
     1151        6        /*D* NAME:        KIF$SEND
     1152        7             PURPOSE:     To send a library, debugger or command processor to the FEP
     1153        8             CALL:        CALL KIF$SEND(LDCT$,VLP_NAME,RUTYPE) ALTRET(LBL);
     1154        9             INPUT:       LDCT - The LDCT to send through
     1155       10                          VLP_NAME - The name of the run unit to send
     1156       11                          RUTYPE -  The type of run unit to send. This is one
     1157       12                                    of %GJ_LIB_DATA# or %GJ_DB_DATA# for
     1158       13                                    library or debugger respectively.
     1159       14             DESCRIPTION: KIF$SEND opens M$STAR (if it is closed) to VLP_NAME.:SYS
     1160       15                          and checks to see that the file exists, has a head
     1161       16                          record of the proper size, is FEP-flavored and is
     1162       17                          the correct type, either library or debugger. If
     1163       18                          all is well, KIF$SEND responds with a GJ_ALIB_DATA
     1164       19                          message. KIF$SEND then converses by reading and
     1165       20                          responding until a %GJ_NAK# or a %GJ_GETxx_DONE#
     1166       21                          is read. The response is to send the requested record
     1167       22                          from the run unit.
     1168       23                          If any problems occur, KIF$SEND will ALTRET with the
     1169       24                          error in B$JIT.ERR.
     1170       25        */
     1171       26
     1172       27
     1173       28        KIF$SEND: PROC(LDCT,VLP_NAME,RUTYPE) ALTRET;
     1174       29
     1175       30
     1176       31                                                /* INCLUDE Files            */
     1177       32        %INCLUDE B$JIT;
     1178      322        %INCLUDE B$OBJECT_C;
     1179     3752        %INCLUDE CP_6_SUBS;
     1180     4292        %INCLUDE CP_6;
     1181     4373        %INCLUDE F$DCB;
     1182     4422        %INCLUDE GJ_MSG_M;
PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:196  
     1183     4735        %GJ_FCN#;
     1184     4761                                                /* AUTO Storage             */
     1185     4762    1   DCL LDCT UBIN /* dummy DCL - only its address is ever used here */;
     1186     4763        %VLP_NAME(FPTN=VLP_NAME,LEN=31,STCLASS="");
     1187     4790    1   DCL RUTYPE UBIN;
     1188     4791    1   DCL STARDCB$ PTR;
     1189     4792    1   DCL MYERR BIT(36);
     1190     4793    1   DCL TEMP UBIN;
     1191     4794    1   DCL TEMPB REDEF TEMP BIT(36);
     1192     4795    1   DCL WRITE_BYSZ SBIN;
     1193     4796    1   DCL TOTAL_BYSZ SBIN;
     1194     4797    1   DCL RECORD_BYSZ SBIN;
     1195     4798    1   DCL N_READS SBIN;
     1196     4799    1   DCL BF2$ PTR;
     1197     4800        %B$FEP_RUKEY (NAME=ADKEY,STCLASS=AUTO);
     1198     4824        %RU_FLAVORS;
     1199     4830        %GJ_ALIB_DATA(FPTN=DATAMSG,STCLASS=AUTO);
     1200     4879        %GJ_PROGKEY_MSG (STCLASS=AUTO);
     1201     4934        %FPT_READ(FPTN=FPT_READ,STCLASS=AUTO);
     1202     4973                                                /* BASED Structures         */
     1203     4974        %GJ_FCN_MSG (FPTN=FCNMSG,STCLASS=BASED);
     1204     4999    1   DCL CHAR$1 CHAR(1) BASED;
     1205     5000        %B$HEAD(NAME=B$HEAD,STCLASS="BASED(FPT_READ.BUF_.BUF$)");
     1206     5200                                                /* SYMREFs                  */
     1207     5201        %FPT_READ(FPTN=KIF_FPT_READ,STCLASS=SYMREF);
     1208     5240        %VLP_NAME (FPTN=KIF_HDKEY,STCLASS=SYMREF,NAME='HEAD',LEN=7);
     1209     5267    1   DCL KIF_BADHEAD BIT(36) SYMREF;
     1210     5268    1   DCL KIF_NONFP BIT(36) SYMREF;
     1211     5269    1   DCL KIF_UNEXPT BIT(36) SYMREF;
     1212     5270    1   DCL B$JIT$ PTR SYMREF READONLY;
     1213     5271    1   DCL B$M$STAR$ PTR SYMREF READONLY;
     1214     5272
     1215     5273        %SUB MONBIT#='000000400000'O;
     1216     5274
     1217     5275                                                /* External Procedures      */
     1218     5276    1   DCL EMR$FEP2HOST ENTRY(2);
     1219     5277    1   DCL EMR$HOST2FEP ENTRY(2);
PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:197  
     1220     5278    1   DCL FMM$SCRUB ENTRY(1);
     1221     5279    1   DCL FMP$CLSJ ENTRY;
     1222     5280    1   DCL FMM$DFLOPN ENTRY;
     1223     5281    1   DCL FMD$GBUF ENTRY(1);
     1224     5282    1   DCL FMD$RBUF ENTRY(1);
     1225     5283    1   DCL SC_FPRG ENTRY CONV(2,0);            /* SNAP                     */
     1226     5284    1   DCL M$MREAD ENTRY(1) ALTRET;
     1227     5285    1   DCL KIA$8TO9 ENTRY(3);
     1228     5286    1   DCL KIA$9TO8 ENTRY(3);
     1229     5287    1   DCL KIF$READ ENTRY(3) ALTRET;
     1230     5288    1   DCL KIF$WRITE ENTRY(3) ALTRET;
     1231     5289
     1232     5290        %EJECT;
PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:198  
     1233     5291        /* KIF$SEND
     1234     5292        */
     1235     5293    1      MYERR='0'B;
     1236     5294    1      FPT_READ=KIF_FPT_READ;
     1237     5295    1      CALL FMD$GBUF(FPT_READ.BUF_.BUF$);
     1238     5296    1      FPT_READ.V_=VECTOR(FPT_READ.V);
     1239     5297    1      FPT_READ.BUF_.BOUND=4095;
     1240     5298    1      STARDCB$=B$M$STAR$;
     1241     5299    1      B$JIT.DCB$=STARDCB$;
     1242     5300
     1243     5301    1      IF STARDCB$->F$DCB.FCD
     1244     5302    2      THEN DO;
     1245     5303    2           CALL SC_FPRG;
     1246     5304    2           CALL FMP$CLSJ;
     1247     5305    2           END;
     1248     5306    1      CALL FMM$SCRUB(B$JIT.DCB$);
     1249     5307    1      STARDCB$->F$DCB.NAME=VLP_NAME;
     1250     5308    1      STARDCB$->F$DCB.ACCT=':SYS';
     1251     5309    1      STARDCB$->F$DCB.ASN=%FILE#;
     1252     5310    1      STARDCB$->F$DCB.FUN=%IN#;
     1253     5311    1      STARDCB$->F$DCB.ACS=%DIRECT#;
     1254     5312    1      B$JIT.ERR='0'B;
     1255     5313    1      STARDCB$->F$DCB.WSR=0;               /* Pretend that we are STEP */
     1256     5314    1      CALL FMM$DFLOPN;
     1257     5315
     1258     5316    1      IF B$JIT.ERR~='0'B
     1259     5317    2      THEN DO;
     1260     5318    2   JITERR: MYERR=B$JIT.ERR;
     1261     5319    2   SETERR: MYERR = (MYERR | MONBIT#);
     1262     5320    2           CALL EMR$HOST2FEP(TEMPB,MYERR);
     1263     5321    2           DATAMSG.FCN = %GJ_NAK#;
     1264     5322    2           DATAMSG.ERR = TEMPB;
     1265     5323    2           CALL KIF$WRITE(LDCT,DATAMSG,LENGTHC(FCNMSG));
     1266     5324    2           GOTO READ_FEP/*fep will return a nak*/;
     1267     5325    2           END;
     1268     5326
     1269     5327        /* Now read in the file's HEAD record. */
PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:199  
     1270     5328    1      FPT_READ.V.DCB#=%M$STAR#;
     1271     5329    1      FPT_READ.KEY_=VECTOR(KIF_HDKEY);
     1272     5330    1      CALL M$MREAD (FPT_READ)
     1273     5331    2      WHENALTRETURN DO;
     1274     5332    2           MYERR = B$JIT.ERR;
     1275     5333    2           GOTO SETERR;
     1276     5334    2           END;
     1277     5335
     1278     5336    1      IF STARDCB$->F$DCB.ARS ~= LENGTHC(B$HEAD)
     1279     5337    2      THEN DO;
     1280     5338    2           MYERR=KIF_BADHEAD;
     1281     5339    2           GOTO SETERR;
     1282     5340    2           END;
     1283     5341        /* Make sure the file is the proper flavor and is appropriately a library or */
     1284     5342        /* a debugger                                                                */
     1285     5343    1      IF B$HEAD.FLAVOR~=%FEP_RU
     1286     5344    1        OR (RUTYPE=%GJ_LIB_DATA# AND B$HEAD.LIB~='1'B)
     1287     5345    1        OR (RUTYPE=%GJ_DB_DATA# AND B$HEAD.DEBUGGER~='1'B)
     1288     5346    2      THEN DO;
     1289     5347    2           MYERR=KIF_NONFP;
     1290     5348    2           GOTO SETERR;
     1291     5349    2           END;
     1292     5350        %EJECT;
PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:200  
     1293     5351
     1294     5352    1   SEND_DATAMSG: ;
     1295     5353    1      DATAMSG='0'B;
     1296     5354    1      DATAMSG.FCN=RUTYPE;
     1297     5355    1      TEMP = B$HEAD.RDATA;
     1298     5356    1      CALL KIA$9TO8(TEMP,DATAMSG.DATA_SZ,4);
     1299     5357    1      TEMP = B$HEAD.RPROC;
     1300     5358    1      CALL KIA$9TO8(TEMP,DATAMSG.PROC_SZ,4);
     1301     5359    1      CALL EMR$HOST2FEP(TEMPB,MYERR);
     1302     5360    1      DATAMSG.ERR = TEMPB;
     1303     5361    1      CALL KIF$WRITE(LDCT,DATAMSG,LENGTHC(DATAMSG))
     1304     5362    2      WHENALTRETURN DO;
     1305     5363    2           MYERR= (B$JIT.ERR | MONBIT#);
     1306     5364    2           END;
     1307     5365    1      IF MYERR ~= '0'B
     1308     5366    1      THEN GOTO XIT;
     1309     5367
     1310     5368        %EJECT;
PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:201  
     1311     5369        /* Now continually read for key requests and write responses until           */
     1312     5370        /* we receive a %GJ_GETxx_DONE# or a %GJ_NAK#                                */
     1313     5371    1   READ_FEP: ;
     1314     5372    1      FPT_READ.KEY_=VECTOR(ADKEY);
     1315     5373    2      DO WHILE ('1'B);
     1316     5374    2           CALL KIF$READ(LDCT,GJ_PROGKEY_MSG,LENGTHC(GJ_PROGKEY_MSG)) ALTRET(XIT);
     1317     5375    3           DO CASE (GJ_PROGKEY_MSG.FCN);
     1318     5376    3            CASE (%GJ_GETLIB#,%GJ_GETDB#); /* Get record from rununit  */
     1319     5377
     1320     5378    3              ADKEY = '0'B;
     1321     5379    3              ADKEY.KEYSIZ = GJ_PROGKEY_MSG.RU_KEY.KEYSIZ;
     1322     5380    3              ADKEY.TYPE = GJ_PROGKEY_MSG.RU_KEY.TYPE;
     1323     5381    3              CALL KIA$8TO9(GJ_PROGKEY_MSG.RU_KEY.PAGE,TEMP,4);
     1324     5382    3              ADKEY.PAGE=TEMP;
     1325     5383    3              CALL KIA$8TO9(GJ_PROGKEY_MSG.READ_BYSZ,WRITE_BYSZ,4);
     1326     5384    3              CALL KIA$8TO9(GJ_PROGKEY_MSG.SECT_BYSZ,TOTAL_BYSZ,4);
     1327     5385    3              N_READS = (TOTAL_BYSZ +4096 -1) / 4096;
     1328     5386
     1329     5387    4              DO TEMP = 1 TO N_READS;
     1330     5388    4                   CALL M$MREAD (FPT_READ)
     1331     5389    5                   WHENALTRETURN DO;
     1332     5390    5                        MYERR = B$JIT.ERR;
     1333     5391    5                        END;
     1334     5392    4                   BF2$ = FPT_READ.BUF_.BUF$;
     1335     5393    4                   RECORD_BYSZ = MINIMUM(TOTAL_BYSZ,4096);
     1336     5394    4                   TOTAL_BYSZ = TOTAL_BYSZ - RECORD_BYSZ;
     1337     5395
     1338     5396    5                   DO WHILE RECORD_BYSZ > 0;
     1339     5397    5                        IF WRITE_BYSZ > RECORD_BYSZ THEN WRITE_BYSZ = RECORD_BYSZ;
     1340     5398    5                        CALL KIF$WRITE(LDCT,BF2$->CHAR$1,WRITE_BYSZ)
     1341     5399    6                        WHENALTRETURN DO;
     1342     5400    6                             MYERR = B$JIT.ERR;
     1343     5401    6                             END;
     1344     5402
     1345     5403    5                        BF2$ = PINCRW(BF2$,WRITE_BYSZ/4);
     1346     5404    5                        RECORD_BYSZ = RECORD_BYSZ - WRITE_BYSZ;
     1347     5405    5                        END;
PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:202  
     1348     5406    4                   ADKEY.PAGE = ADKEY.PAGE + 2048;
     1349     5407    4                   END;
     1350     5408
     1351     5409    3            CASE (%GJ_NAK#,%GJ_PROG_ABRT#);
     1352     5410
     1353     5411    3              TEMPB = GJ_PROGKEY_MSG.ERR;
     1354     5412    3              CALL EMR$FEP2HOST (TEMPB,MYERR);
     1355     5413    3              GOTO XIT;
     1356     5414
     1357     5415    3            CASE (%GJ_GETLIB_DONE#,%GJ_GETDB_DONE#); /* Fetch complete */
     1358     5416    3              IF MYERR ~= '0'B
     1359     5417    3              THEN MYERR = (MYERR | MONBIT#);
     1360     5418    3              CALL EMR$HOST2FEP(TEMPB,MYERR);
     1361     5419    3              DATAMSG = '0'B;
     1362     5420    3              DATAMSG.ERR = TEMPB;
     1363     5421    3              CALL KIF$WRITE(LDCT,DATAMSG,LENGTHC(FCNMSG));
     1364     5422    3              GOTO XIT;
     1365     5423
     1366     5424    3            CASE (ELSE);                   /* Should never happen      */
     1367     5425
     1368     5426    3              CALL SC_FPRG;
     1369     5427    3              MYERR=KIF_UNEXPT;
     1370     5428    3              GOTO XIT;
     1371     5429
     1372     5430    3              END;                         /* End cases                */
     1373     5431    2           END;                            /* End do forever           */
     1374     5432        %EJECT;
PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:203  
     1375     5433    1   XIT: CALL FMP$CLSJ;
     1376     5434    1      IF FPT_READ.BUF_.BUF$~=ADDR(NIL)
     1377     5435    1      THEN CALL FMD$RBUF(FPT_READ.BUF_.BUF$);
     1378     5436
     1379     5437    1      IF MYERR~='0'B
     1380     5438    2      THEN DO;
     1381     5439    2           B$JIT.ERR=MYERR;
     1382     5440    2           ALTRETURN;
     1383     5441    2           END;
     1384     5442    1      RETURN;
     1385     5443    1   END KIF$SEND;

PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:204  
--  Include file information  --

   GJ_MSG_M.:E05TOU  is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   B$OBJECT_C.:E05TOU  is referenced.
   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure KIF$SEND.

   Procedure KIF$SEND requires 434 words for executable code.
   Procedure KIF$SEND requires 44 words of local(AUTO) storage.

    No errors detected in file KIF$FPRG.:E05TSI    .

PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:205  

 Object Unit name= KIF$SEND                                   File name= KIF$FPRG.:E05TOU
 UTS= JUL 30 '97 00:34:33.20 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1  RoData even  UTS      2      2  KIF$SEND
    2   Proc  even  none   434    662  KIF$SEND
    3  RoData even  none    14     16  KIF$SEND

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     2      0   yes    yes     yes      Std        3  KIF$SEND
PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:206  

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 FMD$GBUF
         yes           Std       0 FMP$CLSJ
         yes           Std       1 FMM$SCRUB
         yes           Std       3 KIA$9TO8
 yes     yes           Std       3 KIF$READ
         yes           Std       3 KIA$8TO9
 yes     yes           Std       3 KIF$WRITE
 yes     yes           Std       1 M$MREAD
         yes           Std       1 FMD$RBUF
         yes           Std       0 FMM$DFLOPN
         yes           Std       2 EMR$HOST2FEP
         yes           Std       2 EMR$FEP2HOST
                       nStd      0 X66_AUTO_3
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AALT
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_FPRG                               M$UC                                  KIF_FPT_READ
     KIF_HDKEY                             KIF_BADHEAD                           KIF_NONFP
     KIF_UNEXPT                       r    B$JIT$                           r    B$M$STAR$
     B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ASLENTSID                             ISSID
PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:207  


     1146        1        /*T***********************************************************/
     1147        2        /*T*                                                         */
     1148        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1149        4        /*T*                                                         */
     1150        5        /*T***********************************************************/
     1151        6        /*D* NAME:        KIF$SEND
     1152        7             PURPOSE:     To send a library, debugger or command processor to the FEP
     1153        8             CALL:        CALL KIF$SEND(LDCT$,VLP_NAME,RUTYPE) ALTRET(LBL);
     1154        9             INPUT:       LDCT - The LDCT to send through
     1155       10                          VLP_NAME - The name of the run unit to send
     1156       11                          RUTYPE -  The type of run unit to send. This is one
     1157       12                                    of %GJ_LIB_DATA# or %GJ_DB_DATA# for
     1158       13                                    library or debugger respectively.
     1159       14             DESCRIPTION: KIF$SEND opens M$STAR (if it is closed) to VLP_NAME.:SYS
     1160       15                          and checks to see that the file exists, has a head
     1161       16                          record of the proper size, is FEP-flavored and is
     1162       17                          the correct type, either library or debugger. If
     1163       18                          all is well, KIF$SEND responds with a GJ_ALIB_DATA
     1164       19                          message. KIF$SEND then converses by reading and
     1165       20                          responding until a %GJ_NAK# or a %GJ_GETxx_DONE#
     1166       21                          is read. The response is to send the requested record
     1167       22                          from the run unit.
     1168       23                          If any problems occur, KIF$SEND will ALTRET with the
     1169       24                          error in B$JIT.ERR.
     1170       25        */
     1171       26
     1172       27
     1173       28        KIF$SEND: PROC(LDCT,VLP_NAME,RUTYPE) ALTRET;

     28  2 000000   000000 700200 xent  KIF$SEND     TSX0  ! X66_AUTO_3
         2 000001   000054 000003                    ZERO    44,3

     1174       29
     1175       30
     1176       31                                                /* INCLUDE Files            */
     1177       32        %INCLUDE B$JIT;
PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:208  
     1178      322        %INCLUDE B$OBJECT_C;
     1179     3752        %INCLUDE CP_6_SUBS;
     1180     4292        %INCLUDE CP_6;
     1181     4373        %INCLUDE F$DCB;
     1182     4422        %INCLUDE GJ_MSG_M;
     1183     4735        %GJ_FCN#;
     1184     4761                                                /* AUTO Storage             */
     1185     4762    1   DCL LDCT UBIN /* dummy DCL - only its address is ever used here */;
     1186     4763        %VLP_NAME(FPTN=VLP_NAME,LEN=31,STCLASS="");
     1187     4790    1   DCL RUTYPE UBIN;
     1188     4791    1   DCL STARDCB$ PTR;
     1189     4792    1   DCL MYERR BIT(36);
     1190     4793    1   DCL TEMP UBIN;
     1191     4794    1   DCL TEMPB REDEF TEMP BIT(36);
     1192     4795    1   DCL WRITE_BYSZ SBIN;
     1193     4796    1   DCL TOTAL_BYSZ SBIN;
     1194     4797    1   DCL RECORD_BYSZ SBIN;
     1195     4798    1   DCL N_READS SBIN;
     1196     4799    1   DCL BF2$ PTR;
     1197     4800        %B$FEP_RUKEY (NAME=ADKEY,STCLASS=AUTO);
     1198     4824        %RU_FLAVORS;
     1199     4830        %GJ_ALIB_DATA(FPTN=DATAMSG,STCLASS=AUTO);
     1200     4879        %GJ_PROGKEY_MSG (STCLASS=AUTO);
     1201     4934        %FPT_READ(FPTN=FPT_READ,STCLASS=AUTO);
     1202     4973                                                /* BASED Structures         */
     1203     4974        %GJ_FCN_MSG (FPTN=FCNMSG,STCLASS=BASED);
     1204     4999    1   DCL CHAR$1 CHAR(1) BASED;
     1205     5000        %B$HEAD(NAME=B$HEAD,STCLASS="BASED(FPT_READ.BUF_.BUF$)");
     1206     5200                                                /* SYMREFs                  */
     1207     5201        %FPT_READ(FPTN=KIF_FPT_READ,STCLASS=SYMREF);
     1208     5240        %VLP_NAME (FPTN=KIF_HDKEY,STCLASS=SYMREF,NAME='HEAD',LEN=7);
     1209     5267    1   DCL KIF_BADHEAD BIT(36) SYMREF;
     1210     5268    1   DCL KIF_NONFP BIT(36) SYMREF;
     1211     5269    1   DCL KIF_UNEXPT BIT(36) SYMREF;
     1212     5270    1   DCL B$JIT$ PTR SYMREF READONLY;
     1213     5271    1   DCL B$M$STAR$ PTR SYMREF READONLY;
     1214     5272
PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:209  
     1215     5273        %SUB MONBIT#='000000400000'O;
     1216     5274
     1217     5275                                                /* External Procedures      */
     1218     5276    1   DCL EMR$FEP2HOST ENTRY(2);
     1219     5277    1   DCL EMR$HOST2FEP ENTRY(2);
     1220     5278    1   DCL FMM$SCRUB ENTRY(1);
     1221     5279    1   DCL FMP$CLSJ ENTRY;
     1222     5280    1   DCL FMM$DFLOPN ENTRY;
     1223     5281    1   DCL FMD$GBUF ENTRY(1);
     1224     5282    1   DCL FMD$RBUF ENTRY(1);
     1225     5283    1   DCL SC_FPRG ENTRY CONV(2,0);            /* SNAP                     */
     1226     5284    1   DCL M$MREAD ENTRY(1) ALTRET;
     1227     5285    1   DCL KIA$8TO9 ENTRY(3);
     1228     5286    1   DCL KIA$9TO8 ENTRY(3);
     1229     5287    1   DCL KIF$READ ENTRY(3) ALTRET;
     1230     5288    1   DCL KIF$WRITE ENTRY(3) ALTRET;
     1231     5289
     1232     5290        %EJECT;
PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:210  
     1233     5291        /* KIF$SEND
     1234     5292        */
     1235     5293    1      MYERR='0'B;

   5293  2 000002   200007 450100                    STZ     MYERR,,AUTO

     1236     5294    1      FPT_READ=KIF_FPT_READ;

   5294  2 000003   000100 100400                    MLR     fill='000'O
         2 000004   000000 000070 xsym               ADSC9   KIF_FPT_READ             cn=0,n=56
         2 000005   200032 000070                    ADSC9   FPT_READ,,AUTO           cn=0,n=56

     1237     5295    1      CALL FMD$GBUF(FPT_READ.BUF_.BUF$);

   5295  2 000006   200037 630500                    EPPR0   FPT_READ+5,,AUTO
         2 000007   200050 450500                    STP0    FPT_READ+14,,AUTO
         2 000010   200050 630500                    EPPR0   FPT_READ+14,,AUTO
         2 000011   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000012   000000 701000 xent               TSX1    FMD$GBUF
         2 000013   000000 011000                    NOP     0

     1238     5296    1      FPT_READ.V_=VECTOR(FPT_READ.V);

   5296  2 000014   000000 235000 3                  LDA     0
         2 000015   200050 452500                    STP2    FPT_READ+14,,AUTO
         2 000016   200050 236100                    LDQ     FPT_READ+14,,AUTO
         2 000017   000042 036003                    ADLQ    34,DU
         2 000020   200032 757100                    STAQ    FPT_READ,,AUTO

     1239     5297    1      FPT_READ.BUF_.BOUND=4095;

   5297  2 000021   200036 236100                    LDQ     FPT_READ+4,,AUTO
         2 000022   177777 376007                    ANQ     65535,DL
         2 000023   000001 276000 3                  ORQ     1
         2 000024   200036 756100                    STQ     FPT_READ+4,,AUTO

     1240     5298    1      STARDCB$=B$M$STAR$;
PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:211  

   5298  2 000025   000000 236000 xsym               LDQ     B$M$STAR$
         2 000026   200006 756100                    STQ     STARDCB$,,AUTO

     1241     5299    1      B$JIT.DCB$=STARDCB$;

   5299  2 000027   000000 470400 xsym               LDP0    B$JIT$
         2 000030   000232 756100                    STQ     154,,PR0

     1242     5300
     1243     5301    1      IF STARDCB$->F$DCB.FCD

   5301  2 000031   200006 471500                    LDP1    STARDCB$,,AUTO
         2 000032   100031 236100                    LDQ     25,,PR1
         2 000033   020000 316007                    CANQ    8192,DL
         2 000034   000042 600000 2                  TZE     s:5306

     1244     5302    2      THEN DO;

     1245     5303    2           CALL SC_FPRG;

   5303  2 000035   000000 713400 xsym               CLIMB   SC_FPRG
         2 000036   000000 600000 xsid               climb   nvectors=         0

     1246     5304    2           CALL FMP$CLSJ;

   5304  2 000037   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000040   000000 701000 xent               TSX1    FMP$CLSJ
         2 000041   000000 011000                    NOP     0

     1247     5305    2           END;

     1248     5306    1      CALL FMM$SCRUB(B$JIT.DCB$);

   5306  2 000042   000000 236000 xsym               LDQ     B$JIT$
         2 000043   000232 036003                    ADLQ    154,DU
         2 000044   200050 756100                    STQ     FPT_READ+14,,AUTO
PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:212  
         2 000045   200050 630500                    EPPR0   FPT_READ+14,,AUTO
         2 000046   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000047   000000 701000 xent               TSX1    FMM$SCRUB
         2 000050   000000 011000                    NOP     0

     1249     5307    1      STARDCB$->F$DCB.NAME=VLP_NAME;

   5307  2 000051   200004 470500                    LDP0    @VLP_NAME,,AUTO
         2 000052   200006 471500                    LDP1    STARDCB$,,AUTO
         2 000053   000100 100500                    MLR     fill='000'O
         2 000054   000000 000040                    ADSC9   0,,PR0                   cn=0,n=32
         2 000055   100010 000040                    ADSC9   8,,PR1                   cn=0,n=32

     1250     5308    1      STARDCB$->F$DCB.ACCT=':SYS';

   5308  2 000056   000000 235000 1                  LDA     0
         2 000057   000035 236000 xsym               LDQ     B_VECTNIL+29
         2 000060   100020 757100                    STAQ    16,,PR1

     1251     5309    1      STARDCB$->F$DCB.ASN=%FILE#;

   5309  2 000061   001000 236007                    LDQ     512,DL
         2 000062   100032 552110                    STBQ    26,'10'O,PR1

     1252     5310    1      STARDCB$->F$DCB.FUN=%IN#;

   5310  2 000063   000002 236003                    LDQ     2,DU
         2 000064   100032 552120                    STBQ    26,'20'O,PR1

     1253     5311    1      STARDCB$->F$DCB.ACS=%DIRECT#;

   5311  2 000065   000002 236007                    LDQ     2,DL
         2 000066   100036 552104                    STBQ    30,'04'O,PR1

     1254     5312    1      B$JIT.ERR='0'B;

   5312  2 000067   000000 473400 xsym               LDP3    B$JIT$
PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:213  
         2 000070   300012 450100                    STZ     10,,PR3

     1255     5313    1      STARDCB$->F$DCB.WSR=0;               /* Pretend that we are STEP */

   5313  2 000071   000000 236003                    LDQ     0,DU
         2 000072   100040 552120                    STBQ    32,'20'O,PR1

     1256     5314    1      CALL FMM$DFLOPN;

   5314  2 000073   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000074   000000 701000 xent               TSX1    FMM$DFLOPN
         2 000075   000000 011000                    NOP     0

     1257     5315
     1258     5316    1      IF B$JIT.ERR~='0'B

   5316  2 000076   000000 470400 xsym               LDP0    B$JIT$
         2 000077   000012 235100                    LDA     10,,PR0
         2 000100   000136 600000 2                  TZE     s:5328

     1259     5317    2      THEN DO;

     1260     5318    2   JITERR: MYERR=B$JIT.ERR;

   5318  2 000101   000012 236100       JITERR       LDQ     10,,PR0
         2 000102   200007 756100                    STQ     MYERR,,AUTO

     1261     5319    2   SETERR: MYERR = (MYERR | MONBIT#);

   5319  2 000103   200007 236100       SETERR       LDQ     MYERR,,AUTO
         2 000104   000001 276000 1                  ORQ     1
         2 000105   200007 756100                    STQ     MYERR,,AUTO

     1262     5320    2           CALL EMR$HOST2FEP(TEMPB,MYERR);

   5320  2 000106   200007 630500                    EPPR0   MYERR,,AUTO
         2 000107   200051 450500                    STP0    FPT_READ+15,,AUTO
PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:214  
         2 000110   200010 631500                    EPPR1   TEMP,,AUTO
         2 000111   200050 451500                    STP1    FPT_READ+14,,AUTO
         2 000112   200050 630500                    EPPR0   FPT_READ+14,,AUTO
         2 000113   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000114   000000 701000 xent               TSX1    EMR$HOST2FEP
         2 000115   000000 011000                    NOP     0

     1263     5321    2           DATAMSG.FCN = %GJ_NAK#;

   5321  2 000116   035000 236003                    LDQ     14848,DU
         2 000117   200020 552140                    STBQ    DATAMSG,'40'O,AUTO

     1264     5322    2           DATAMSG.ERR = TEMPB;

   5322  2 000120   000100 100500                    MLR     fill='000'O
         2 000121   200010 000004                    ADSC9   TEMP,,AUTO               cn=0,n=4
         2 000122   200020 400004                    ADSC9   DATAMSG,,AUTO            cn=2,n=4

     1265     5323    2           CALL KIF$WRITE(LDCT,DATAMSG,LENGTHC(FCNMSG));

   5323  2 000123   000002 236000 3                  LDQ     2
         2 000124   200052 756100                    STQ     FPT_READ+16,,AUTO
         2 000125   200020 630500                    EPPR0   DATAMSG,,AUTO
         2 000126   200051 450500                    STP0    FPT_READ+15,,AUTO
         2 000127   200003 236100                    LDQ     @LDCT,,AUTO
         2 000130   200050 756100                    STQ     FPT_READ+14,,AUTO
         2 000131   200050 630500                    EPPR0   FPT_READ+14,,AUTO
         2 000132   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000133   000000 701000 xent               TSX1    KIF$WRITE
         2 000134   000000 011000                    NOP     0

     1266     5324    2           GOTO READ_FEP/*fep will return a nak*/;

   5324  2 000135   000311 710000 2                  TRA     READ_FEP

     1267     5325    2           END;
     1268     5326
PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:215  
     1269     5327        /* Now read in the file's HEAD record. */
     1270     5328    1      FPT_READ.V.DCB#=%M$STAR#;

   5328  2 000136   000001 220003                    LDX0    1,DU
         2 000137   200042 740100                    STX0    FPT_READ+8,,AUTO

     1271     5329    1      FPT_READ.KEY_=VECTOR(KIF_HDKEY);

   5329  2 000140   000004 237000 3                  LDAQ    4
         2 000141   200034 757100                    STAQ    FPT_READ+2,,AUTO

     1272     5330    1      CALL M$MREAD (FPT_READ)

   5330  2 000142   200032 631500                    EPPR1   FPT_READ,,AUTO
         2 000143   200050 451500                    STP1    FPT_READ+14,,AUTO
         2 000144   200050 630500                    EPPR0   FPT_READ+14,,AUTO
         2 000145   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000146   000000 701000 xent               TSX1    M$MREAD
         2 000147   000151 702000 2                  TSX2    s:5332
         2 000150   000155 710000 2                  TRA     s:5336

     1273     5331    2      WHENALTRETURN DO;

     1274     5332    2           MYERR = B$JIT.ERR;

   5332  2 000151   000000 470400 xsym               LDP0    B$JIT$
         2 000152   000012 236100                    LDQ     10,,PR0
         2 000153   200007 756100                    STQ     MYERR,,AUTO

     1275     5333    2           GOTO SETERR;

   5333  2 000154   000103 710000 2                  TRA     SETERR

     1276     5334    2           END;
     1277     5335
     1278     5336    1      IF STARDCB$->F$DCB.ARS ~= LENGTHC(B$HEAD)

PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:216  
   5336  2 000155   200006 470500                    LDP0    STARDCB$,,AUTO
         2 000156   000000 235100                    LDA     0,,PR0
         2 000157   000240 115007                    CMPA    160,DL
         2 000160   000164 600000 2                  TZE     s:5343

     1279     5337    2      THEN DO;

     1280     5338    2           MYERR=KIF_BADHEAD;

   5338  2 000161   000000 236000 xsym               LDQ     KIF_BADHEAD
         2 000162   200007 756100                    STQ     MYERR,,AUTO

     1281     5339    2           GOTO SETERR;

   5339  2 000163   000103 710000 2                  TRA     SETERR

     1282     5340    2           END;
     1283     5341        /* Make sure the file is the proper flavor and is appropriately a library or */
     1284     5342        /* a debugger                                                                */
     1285     5343    1      IF B$HEAD.FLAVOR~=%FEP_RU

   5343  2 000164   200037 471500                    LDP1    FPT_READ+5,,AUTO
         2 000165   100022 236100                    LDQ     18,,PR1
         2 000166   777000 376003                    ANQ     -512,DU
         2 000167   002000 116003                    CMPQ    1024,DU
         2 000170   000205 601000 2                  TNZ     s:5347
         2 000171   200005 473500                    LDP3    @RUTYPE,,AUTO
         2 000172   300000 235100                    LDA     0,,PR3
         2 000173   000013 115007                    CMPA    11,DL
         2 000174   000200 601000 2                  TNZ     s:5343+12
         2 000175   100022 236100                    LDQ     18,,PR1
         2 000176   000200 316003                    CANQ    128,DU
         2 000177   000205 600000 2                  TZE     s:5347
         2 000200   000014 115007                    CMPA    12,DL
         2 000201   000210 601000 2                  TNZ     SEND_DATAMSG
         2 000202   100022 236100                    LDQ     18,,PR1
         2 000203   000020 316003                    CANQ    16,DU
PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:217  
         2 000204   000210 601000 2                  TNZ     SEND_DATAMSG

     1286     5344    1        OR (RUTYPE=%GJ_LIB_DATA# AND B$HEAD.LIB~='1'B)
     1287     5345    1        OR (RUTYPE=%GJ_DB_DATA# AND B$HEAD.DEBUGGER~='1'B)
     1288     5346    2      THEN DO;

     1289     5347    2           MYERR=KIF_NONFP;

   5347  2 000205   000000 236000 xsym               LDQ     KIF_NONFP
         2 000206   200007 756100                    STQ     MYERR,,AUTO

     1290     5348    2           GOTO SETERR;

   5348  2 000207   000103 710000 2                  TRA     SETERR

   5343  2 000210                       SEND_DATAMSG null
     1291     5349    2           END;
     1292     5350        %EJECT;
PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:218  
     1293     5351
     1294     5352    1   SEND_DATAMSG: ;
     1295     5353    1      DATAMSG='0'B;

   5353  2 000210   000100 100400                    MLR     fill='000'O
         2 000211   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         2 000212   200020 000016                    ADSC9   DATAMSG,,AUTO            cn=0,n=14

     1296     5354    1      DATAMSG.FCN=RUTYPE;

   5354  2 000213   300000 236100                    LDQ     0,,PR3
         2 000214   000033 736000                    QLS     27
         2 000215   200020 552140                    STBQ    DATAMSG,'40'O,AUTO

     1297     5355    1      TEMP = B$HEAD.RDATA;

   5355  2 000216   100002 236100                    LDQ     2,,PR1
         2 000217   000006 376000 3                  ANQ     6
         2 000220   200010 756100                    STQ     TEMP,,AUTO

     1298     5356    1      CALL KIA$9TO8(TEMP,DATAMSG.DATA_SZ,4);

   5356  2 000221   000007 236000 3                  LDQ     7
         2 000222   200052 756100                    STQ     FPT_READ+16,,AUTO
         2 000223   200053 452500                    STP2    FPT_READ+17,,AUTO
         2 000224   200053 236100                    LDQ     FPT_READ+17,,AUTO
         2 000225   000010 036000 3                  ADLQ    8
         2 000226   200051 756100                    STQ     FPT_READ+15,,AUTO
         2 000227   200010 634500                    EPPR4   TEMP,,AUTO
         2 000230   200050 454500                    STP4    FPT_READ+14,,AUTO
         2 000231   200050 630500                    EPPR0   FPT_READ+14,,AUTO
         2 000232   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000233   000000 701000 xent               TSX1    KIA$9TO8
         2 000234   000000 011000                    NOP     0

     1299     5357    1      TEMP = B$HEAD.RPROC;

PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:219  
   5357  2 000235   200037 470500                    LDP0    FPT_READ+5,,AUTO
         2 000236   000001 236100                    LDQ     1,,PR0
         2 000237   000006 376000 3                  ANQ     6
         2 000240   200010 756100                    STQ     TEMP,,AUTO

     1300     5358    1      CALL KIA$9TO8(TEMP,DATAMSG.PROC_SZ,4);

   5358  2 000241   000007 236000 3                  LDQ     7
         2 000242   200052 756100                    STQ     FPT_READ+16,,AUTO
         2 000243   200053 452500                    STP2    FPT_READ+17,,AUTO
         2 000244   200053 236100                    LDQ     FPT_READ+17,,AUTO
         2 000245   000011 036000 3                  ADLQ    9
         2 000246   200051 756100                    STQ     FPT_READ+15,,AUTO
         2 000247   200010 631500                    EPPR1   TEMP,,AUTO
         2 000250   200050 451500                    STP1    FPT_READ+14,,AUTO
         2 000251   200050 630500                    EPPR0   FPT_READ+14,,AUTO
         2 000252   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000253   000000 701000 xent               TSX1    KIA$9TO8
         2 000254   000000 011000                    NOP     0

     1301     5359    1      CALL EMR$HOST2FEP(TEMPB,MYERR);

   5359  2 000255   200007 630500                    EPPR0   MYERR,,AUTO
         2 000256   200051 450500                    STP0    FPT_READ+15,,AUTO
         2 000257   200010 631500                    EPPR1   TEMP,,AUTO
         2 000260   200050 451500                    STP1    FPT_READ+14,,AUTO
         2 000261   200050 630500                    EPPR0   FPT_READ+14,,AUTO
         2 000262   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000263   000000 701000 xent               TSX1    EMR$HOST2FEP
         2 000264   000000 011000                    NOP     0

     1302     5360    1      DATAMSG.ERR = TEMPB;

   5360  2 000265   000100 100500                    MLR     fill='000'O
         2 000266   200010 000004                    ADSC9   TEMP,,AUTO               cn=0,n=4
         2 000267   200020 400004                    ADSC9   DATAMSG,,AUTO            cn=2,n=4

PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:220  
     1303     5361    1      CALL KIF$WRITE(LDCT,DATAMSG,LENGTHC(DATAMSG))

   5361  2 000270   000013 236000 3                  LDQ     11
         2 000271   200052 756100                    STQ     FPT_READ+16,,AUTO
         2 000272   200020 630500                    EPPR0   DATAMSG,,AUTO
         2 000273   200051 450500                    STP0    FPT_READ+15,,AUTO
         2 000274   200003 236100                    LDQ     @LDCT,,AUTO
         2 000275   200050 756100                    STQ     FPT_READ+14,,AUTO
         2 000276   200050 630500                    EPPR0   FPT_READ+14,,AUTO
         2 000277   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000300   000000 701000 xent               TSX1    KIF$WRITE
         2 000301   000303 702000 2                  TSX2    s:5363
         2 000302   000307 710000 2                  TRA     s:5365

     1304     5362    2      WHENALTRETURN DO;

     1305     5363    2           MYERR= (B$JIT.ERR | MONBIT#);

   5363  2 000303   000000 470400 xsym               LDP0    B$JIT$
         2 000304   000012 236100                    LDQ     10,,PR0
         2 000305   000001 276000 1                  ORQ     1
         2 000306   200007 756100                    STQ     MYERR,,AUTO

     1306     5364    2           END;

     1307     5365    1      IF MYERR ~= '0'B

   5365  2 000307   200007 235100                    LDA     MYERR,,AUTO
         2 000310   000637 601000 2                  TNZ     XIT

   5365  2 000311                       READ_FEP     null
     1308     5366    1      THEN GOTO XIT;
     1309     5367
     1310     5368        %EJECT;
PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:221  
     1311     5369        /* Now continually read for key requests and write responses until           */
     1312     5370        /* we receive a %GJ_GETxx_DONE# or a %GJ_NAK#                                */
     1313     5371    1   READ_FEP: ;
     1314     5372    1      FPT_READ.KEY_=VECTOR(ADKEY);

   5372  2 000311   000004 235000 3                  LDA     4
         2 000312   200050 452500                    STP2    FPT_READ+14,,AUTO
         2 000313   200050 236100                    LDQ     FPT_READ+14,,AUTO
         2 000314   000016 036003                    ADLQ    14,DU
         2 000315   200034 757100                    STAQ    FPT_READ+2,,AUTO

     1315     5373    2      DO WHILE ('1'B);

     1316     5374    2           CALL KIF$READ(LDCT,GJ_PROGKEY_MSG,LENGTHC(GJ_PROGKEY_MSG)) ALTRET(XIT);

   5374  2 000316   000015 236000 3                  LDQ     13
         2 000317   200052 756100                    STQ     FPT_READ+16,,AUTO
         2 000320   200024 630500                    EPPR0   GJ_PROGKEY_MSG,,AUTO
         2 000321   200051 450500                    STP0    FPT_READ+15,,AUTO
         2 000322   200003 236100                    LDQ     @LDCT,,AUTO
         2 000323   200050 756100                    STQ     FPT_READ+14,,AUTO
         2 000324   200050 630500                    EPPR0   FPT_READ+14,,AUTO
         2 000325   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000326   000000 701000 xent               TSX1    KIF$READ
         2 000327   000637 702000 2                  TSX2    XIT

     1317     5375    3           DO CASE (GJ_PROGKEY_MSG.FCN);

   5375  2 000330   200024 236100                    LDQ     GJ_PROGKEY_MSG,,AUTO
         2 000331   000033 772000                    QRL     27
         2 000332   000036 116007                    CMPQ    30,DL
         2 000333   000335 602006 2                  TNC     s:5375+5,QL
         2 000334   000632 710000 2                  TRA     s:5426
         2 000335   000632 710000 2                  TRA     s:5426
         2 000336   000632 710000 2                  TRA     s:5426
         2 000337   000373 710000 2                  TRA     s:5378
         2 000340   000373 710000 2                  TRA     s:5378
PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:222  
         2 000341   000632 710000 2                  TRA     s:5426
         2 000342   000632 710000 2                  TRA     s:5426
         2 000343   000632 710000 2                  TRA     s:5426
         2 000344   000556 710000 2                  TRA     s:5411
         2 000345   000632 710000 2                  TRA     s:5426
         2 000346   000632 710000 2                  TRA     s:5426
         2 000347   000632 710000 2                  TRA     s:5426
         2 000350   000632 710000 2                  TRA     s:5426
         2 000351   000632 710000 2                  TRA     s:5426
         2 000352   000632 710000 2                  TRA     s:5426
         2 000353   000574 710000 2                  TRA     s:5416
         2 000354   000574 710000 2                  TRA     s:5416
         2 000355   000632 710000 2                  TRA     s:5426
         2 000356   000632 710000 2                  TRA     s:5426
         2 000357   000632 710000 2                  TRA     s:5426
         2 000360   000632 710000 2                  TRA     s:5426
         2 000361   000632 710000 2                  TRA     s:5426
         2 000362   000632 710000 2                  TRA     s:5426
         2 000363   000632 710000 2                  TRA     s:5426
         2 000364   000632 710000 2                  TRA     s:5426
         2 000365   000632 710000 2                  TRA     s:5426
         2 000366   000632 710000 2                  TRA     s:5426
         2 000367   000632 710000 2                  TRA     s:5426
         2 000370   000632 710000 2                  TRA     s:5426
         2 000371   000632 710000 2                  TRA     s:5426
         2 000372   000556 710000 2                  TRA     s:5411

     1318     5376    3            CASE (%GJ_GETLIB#,%GJ_GETDB#); /* Get record from rununit  */

     1319     5377
     1320     5378    3              ADKEY = '0'B;

   5378  2 000373   200016 450100                    STZ     ADKEY,,AUTO
         2 000374   200017 450100                    STZ     ADKEY+1,,AUTO

     1321     5379    3              ADKEY.KEYSIZ = GJ_PROGKEY_MSG.RU_KEY.KEYSIZ;

PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:223  
   5379  2 000375   200025 236100                    LDQ     GJ_PROGKEY_MSG+1,,AUTO
         2 000376   000022 736000                    QLS     18
         2 000377   200016 552140                    STBQ    ADKEY,'40'O,AUTO

     1322     5380    3              ADKEY.TYPE = GJ_PROGKEY_MSG.RU_KEY.TYPE;

   5380  2 000400   200025 236100                    LDQ     GJ_PROGKEY_MSG+1,,AUTO
         2 000401   000022 736000                    QLS     18
         2 000402   200016 552120                    STBQ    ADKEY,'20'O,AUTO

     1323     5381    3              CALL KIA$8TO9(GJ_PROGKEY_MSG.RU_KEY.PAGE,TEMP,4);

   5381  2 000403   000007 236000 3                  LDQ     7
         2 000404   200052 756100                    STQ     FPT_READ+16,,AUTO
         2 000405   200010 630500                    EPPR0   TEMP,,AUTO
         2 000406   200051 450500                    STP0    FPT_READ+15,,AUTO
         2 000407   200026 631500                    EPPR1   GJ_PROGKEY_MSG+2,,AUTO
         2 000410   200050 451500                    STP1    FPT_READ+14,,AUTO
         2 000411   200050 630500                    EPPR0   FPT_READ+14,,AUTO
         2 000412   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000413   000000 701000 xent               TSX1    KIA$8TO9
         2 000414   000000 011000                    NOP     0

     1324     5382    3              ADKEY.PAGE=TEMP;

   5382  2 000415   003100 061500                    CSR     bolr='003'O
         2 000416   200010 000044                    BDSC    TEMP,,AUTO               by=0,bit=0,n=36
         2 000417   200016 670024                    BDSC    ADKEY,,AUTO              by=3,bit=7,n=20

     1325     5383    3              CALL KIA$8TO9(GJ_PROGKEY_MSG.READ_BYSZ,WRITE_BYSZ,4);

   5383  2 000420   000007 236000 3                  LDQ     7
         2 000421   200052 756100                    STQ     FPT_READ+16,,AUTO
         2 000422   200011 630500                    EPPR0   WRITE_BYSZ,,AUTO
         2 000423   200051 450500                    STP0    FPT_READ+15,,AUTO
         2 000424   200027 631500                    EPPR1   GJ_PROGKEY_MSG+3,,AUTO
         2 000425   200050 451500                    STP1    FPT_READ+14,,AUTO
PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:224  
         2 000426   200050 630500                    EPPR0   FPT_READ+14,,AUTO
         2 000427   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000430   000000 701000 xent               TSX1    KIA$8TO9
         2 000431   000000 011000                    NOP     0

     1326     5384    3              CALL KIA$8TO9(GJ_PROGKEY_MSG.SECT_BYSZ,TOTAL_BYSZ,4);

   5384  2 000432   000007 236000 3                  LDQ     7
         2 000433   200052 756100                    STQ     FPT_READ+16,,AUTO
         2 000434   200012 630500                    EPPR0   TOTAL_BYSZ,,AUTO
         2 000435   200051 450500                    STP0    FPT_READ+15,,AUTO
         2 000436   200030 631500                    EPPR1   GJ_PROGKEY_MSG+4,,AUTO
         2 000437   200050 451500                    STP1    FPT_READ+14,,AUTO
         2 000440   200050 630500                    EPPR0   FPT_READ+14,,AUTO
         2 000441   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000442   000000 701000 xent               TSX1    KIA$8TO9
         2 000443   000000 011000                    NOP     0

     1327     5385    3              N_READS = (TOTAL_BYSZ +4096 -1) / 4096;

   5385  2 000444   200012 236100                    LDQ     TOTAL_BYSZ,,AUTO
         2 000445   007777 036007                    ADLQ    4095,DL
         2 000446   010000 506007                    DIV     4096,DL
         2 000447   200014 756100                    STQ     N_READS,,AUTO

     1328     5386
     1329     5387    4              DO TEMP = 1 TO N_READS;

   5387  2 000450   000001 235007                    LDA     1,DL
         2 000451   200010 755100                    STA     TEMP,,AUTO
         2 000452   000551 710000 2                  TRA     s:5407+3

     1330     5388    4                   CALL M$MREAD (FPT_READ)

   5388  2 000453   200032 630500                    EPPR0   FPT_READ,,AUTO
         2 000454   200050 450500                    STP0    FPT_READ+14,,AUTO
         2 000455   200050 630500                    EPPR0   FPT_READ+14,,AUTO
PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:225  
         2 000456   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000457   000000 701000 xent               TSX1    M$MREAD
         2 000460   000462 702000 2                  TSX2    s:5390
         2 000461   000465 710000 2                  TRA     s:5392

     1331     5389    5                   WHENALTRETURN DO;

     1332     5390    5                        MYERR = B$JIT.ERR;

   5390  2 000462   000000 470400 xsym               LDP0    B$JIT$
         2 000463   000012 236100                    LDQ     10,,PR0
         2 000464   200007 756100                    STQ     MYERR,,AUTO

     1333     5391    5                        END;

     1334     5392    4                   BF2$ = FPT_READ.BUF_.BUF$;

   5392  2 000465   200037 236100                    LDQ     FPT_READ+5,,AUTO
         2 000466   200015 756100                    STQ     BF2$,,AUTO

     1335     5393    4                   RECORD_BYSZ = MINIMUM(TOTAL_BYSZ,4096);

   5393  2 000467   010000 236007                    LDQ     4096,DL
         2 000470   000473 604000 2                  TMI     s:5393+4
         2 000471   200012 116100                    CMPQ    TOTAL_BYSZ,,AUTO
         2 000472   000474 604400 2                  TMOZ    s:5393+5
         2 000473   200012 236100                    LDQ     TOTAL_BYSZ,,AUTO
         2 000474   200013 756100                    STQ     RECORD_BYSZ,,AUTO

     1336     5394    4                   TOTAL_BYSZ = TOTAL_BYSZ - RECORD_BYSZ;

   5394  2 000475   200012 236100                    LDQ     TOTAL_BYSZ,,AUTO
         2 000476   200013 136100                    SBLQ    RECORD_BYSZ,,AUTO
         2 000477   200012 756100                    STQ     TOTAL_BYSZ,,AUTO

     1337     5395
     1338     5396    5                   DO WHILE RECORD_BYSZ > 0;
PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:226  

   5396  2 000500   200013 235100                    LDA     RECORD_BYSZ,,AUTO
         2 000501   000535 604400 2                  TMOZ    s:5406

     1339     5397    5                        IF WRITE_BYSZ > RECORD_BYSZ THEN WRITE_BYSZ = RECORD_BYSZ;

   5397  2 000502   200011 236100                    LDQ     WRITE_BYSZ,,AUTO
         2 000503   200013 116100                    CMPQ    RECORD_BYSZ,,AUTO
         2 000504   000507 604400 2                  TMOZ    s:5398

   5397  2 000505   200013 235100                    LDA     RECORD_BYSZ,,AUTO
         2 000506   200011 755100                    STA     WRITE_BYSZ,,AUTO

     1340     5398    5                        CALL KIF$WRITE(LDCT,BF2$->CHAR$1,WRITE_BYSZ)

   5398  2 000507   200011 630500                    EPPR0   WRITE_BYSZ,,AUTO
         2 000510   200052 450500                    STP0    FPT_READ+16,,AUTO
         2 000511   200015 236100                    LDQ     BF2$,,AUTO
         2 000512   200003 235100                    LDA     @LDCT,,AUTO
         2 000513   200050 757100                    STAQ    FPT_READ+14,,AUTO
         2 000514   200050 630500                    EPPR0   FPT_READ+14,,AUTO
         2 000515   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000516   000000 701000 xent               TSX1    KIF$WRITE
         2 000517   000521 702000 2                  TSX2    s:5400
         2 000520   000524 710000 2                  TRA     s:5403

     1341     5399    6                        WHENALTRETURN DO;

     1342     5400    6                             MYERR = B$JIT.ERR;

   5400  2 000521   000000 470400 xsym               LDP0    B$JIT$
         2 000522   000012 236100                    LDQ     10,,PR0
         2 000523   200007 756100                    STQ     MYERR,,AUTO

     1343     5401    6                             END;

     1344     5402
PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:227  
     1345     5403    5                        BF2$ = PINCRW(BF2$,WRITE_BYSZ/4);

   5403  2 000524   200011 236100                    LDQ     WRITE_BYSZ,,AUTO
         2 000525   000004 506007                    DIV     4,DL
         2 000526   000022 736000                    QLS     18
         2 000527   200015 036100                    ADLQ    BF2$,,AUTO
         2 000530   200015 756100                    STQ     BF2$,,AUTO

     1346     5404    5                        RECORD_BYSZ = RECORD_BYSZ - WRITE_BYSZ;

   5404  2 000531   200013 236100                    LDQ     RECORD_BYSZ,,AUTO
         2 000532   200011 136100                    SBLQ    WRITE_BYSZ,,AUTO
         2 000533   200013 756100                    STQ     RECORD_BYSZ,,AUTO

     1347     5405    5                        END;

   5405  2 000534   000502 605400 2                  TPNZ    s:5397

     1348     5406    4                   ADKEY.PAGE = ADKEY.PAGE + 2048;

   5406  2 000535   200016 235100                    LDA     ADKEY,,AUTO
         2 000536   200017 236100                    LDQ     ADKEY+1,,AUTO
         2 000537   000022 773000                    LRL     18
         2 000540   000006 376000 3                  ANQ     6
         2 000541   004000 036007                    ADLQ    2048,DL
         2 000542   200050 756100                    STQ     FPT_READ+14,,AUTO
         2 000543   003100 061500                    CSR     bolr='003'O
         2 000544   200050 000044                    BDSC    FPT_READ+14,,AUTO        by=0,bit=0,n=36
         2 000545   200016 670024                    BDSC    ADKEY,,AUTO              by=3,bit=7,n=20

     1349     5407    4                   END;

   5407  2 000546   200010 235100                    LDA     TEMP,,AUTO
         2 000547   000001 035007                    ADLA    1,DL
         2 000550   200010 755100                    STA     TEMP,,AUTO
         2 000551   200010 236100                    LDQ     TEMP,,AUTO
         2 000552   000555 604000 2                  TMI     s:5407+7
PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:228  
         2 000553   200014 116100                    CMPQ    N_READS,,AUTO
         2 000554   000453 604400 2                  TMOZ    s:5388
         2 000555   000316 710000 2                  TRA     s:5374

     1350     5408
     1351     5409    3            CASE (%GJ_NAK#,%GJ_PROG_ABRT#);

     1352     5410
     1353     5411    3              TEMPB = GJ_PROGKEY_MSG.ERR;

   5411  2 000556   200024 235100                    LDA     GJ_PROGKEY_MSG,,AUTO
         2 000557   200025 236100                    LDQ     GJ_PROGKEY_MSG+1,,AUTO
         2 000560   000022 773000                    LRL     18
         2 000561   000027 376000 xsym               ANQ     B_VECTNIL+23
         2 000562   200010 756100                    STQ     TEMP,,AUTO

     1354     5412    3              CALL EMR$FEP2HOST (TEMPB,MYERR);

   5412  2 000563   200007 630500                    EPPR0   MYERR,,AUTO
         2 000564   200051 450500                    STP0    FPT_READ+15,,AUTO
         2 000565   200010 631500                    EPPR1   TEMP,,AUTO
         2 000566   200050 451500                    STP1    FPT_READ+14,,AUTO
         2 000567   200050 630500                    EPPR0   FPT_READ+14,,AUTO
         2 000570   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000571   000000 701000 xent               TSX1    EMR$FEP2HOST
         2 000572   000000 011000                    NOP     0

     1355     5413    3              GOTO XIT;

   5413  2 000573   000637 710000 2                  TRA     XIT

     1356     5414
     1357     5415    3            CASE (%GJ_GETLIB_DONE#,%GJ_GETDB_DONE#); /* Fetch complete */

     1358     5416    3              IF MYERR ~= '0'B

   5416  2 000574   200007 235100                    LDA     MYERR,,AUTO
PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:229  
         2 000575   000601 600000 2                  TZE     s:5418

     1359     5417    3              THEN MYERR = (MYERR | MONBIT#);

   5417  2 000576   200007 236100                    LDQ     MYERR,,AUTO
         2 000577   000001 276000 1                  ORQ     1
         2 000600   200007 756100                    STQ     MYERR,,AUTO

     1360     5418    3              CALL EMR$HOST2FEP(TEMPB,MYERR);

   5418  2 000601   200007 630500                    EPPR0   MYERR,,AUTO
         2 000602   200051 450500                    STP0    FPT_READ+15,,AUTO
         2 000603   200010 631500                    EPPR1   TEMP,,AUTO
         2 000604   200050 451500                    STP1    FPT_READ+14,,AUTO
         2 000605   200050 630500                    EPPR0   FPT_READ+14,,AUTO
         2 000606   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000607   000000 701000 xent               TSX1    EMR$HOST2FEP
         2 000610   000000 011000                    NOP     0

     1361     5419    3              DATAMSG = '0'B;

   5419  2 000611   000100 100400                    MLR     fill='000'O
         2 000612   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         2 000613   200020 000016                    ADSC9   DATAMSG,,AUTO            cn=0,n=14

     1362     5420    3              DATAMSG.ERR = TEMPB;

   5420  2 000614   000100 100500                    MLR     fill='000'O
         2 000615   200010 000004                    ADSC9   TEMP,,AUTO               cn=0,n=4
         2 000616   200020 400004                    ADSC9   DATAMSG,,AUTO            cn=2,n=4

     1363     5421    3              CALL KIF$WRITE(LDCT,DATAMSG,LENGTHC(FCNMSG));

   5421  2 000617   000002 236000 3                  LDQ     2
         2 000620   200052 756100                    STQ     FPT_READ+16,,AUTO
         2 000621   200020 630500                    EPPR0   DATAMSG,,AUTO
         2 000622   200051 450500                    STP0    FPT_READ+15,,AUTO
PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:230  
         2 000623   200003 236100                    LDQ     @LDCT,,AUTO
         2 000624   200050 756100                    STQ     FPT_READ+14,,AUTO
         2 000625   200050 630500                    EPPR0   FPT_READ+14,,AUTO
         2 000626   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 000627   000000 701000 xent               TSX1    KIF$WRITE
         2 000630   000000 011000                    NOP     0

     1364     5422    3              GOTO XIT;

   5422  2 000631   000637 710000 2                  TRA     XIT

     1365     5423
     1366     5424    3            CASE (ELSE);                   /* Should never happen      */

     1367     5425
     1368     5426    3              CALL SC_FPRG;

   5426  2 000632   000000 713400 xsym               CLIMB   SC_FPRG
         2 000633   000000 600000 xsid               climb   nvectors=         0

     1369     5427    3              MYERR=KIF_UNEXPT;

   5427  2 000634   000000 236000 xsym               LDQ     KIF_UNEXPT
         2 000635   200007 756100                    STQ     MYERR,,AUTO

     1370     5428    3              GOTO XIT;

   5428  2 000636   000637 710000 2                  TRA     XIT

     1371     5429
     1372     5430    3              END;                         /* End cases                */

     1373     5431    2           END;                            /* End do forever           */

     1374     5432        %EJECT;
PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:231  
     1375     5433    1   XIT: CALL FMP$CLSJ;

   5433  2 000637   000002 631400 xsym  XIT          EPPR1   B_VECTNIL+2
         2 000640   000000 701000 xent               TSX1    FMP$CLSJ
         2 000641   000000 011000                    NOP     0

     1376     5434    1      IF FPT_READ.BUF_.BUF$~=ADDR(NIL)

   5434  2 000642   200037 236100                    LDQ     FPT_READ+5,,AUTO
         2 000643   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 000644   000653 600000 2                  TZE     s:5437

     1377     5435    1      THEN CALL FMD$RBUF(FPT_READ.BUF_.BUF$);

   5435  2 000645   200037 630500                    EPPR0   FPT_READ+5,,AUTO
         2 000646   200050 450500                    STP0    FPT_READ+14,,AUTO
         2 000647   200050 630500                    EPPR0   FPT_READ+14,,AUTO
         2 000650   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000651   000000 701000 xent               TSX1    FMD$RBUF
         2 000652   000000 011000                    NOP     0

     1378     5436
     1379     5437    1      IF MYERR~='0'B

   5437  2 000653   200007 235100                    LDA     MYERR,,AUTO
         2 000654   000661 600000 2                  TZE     s:5442

     1380     5438    2      THEN DO;

     1381     5439    2           B$JIT.ERR=MYERR;

   5439  2 000655   200007 236100                    LDQ     MYERR,,AUTO
         2 000656   000000 470400 xsym               LDP0    B$JIT$
         2 000657   000012 756100                    STQ     10,,PR0

     1382     5440    2           ALTRETURN;

PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:232  
   5440  2 000660   000000 702200 xent               TSX2  ! X66_AALT

     1383     5441    2           END;
     1384     5442    1      RETURN;

   5442  2 000661   000000 702200 xent               TSX2  ! X66_ARET

(unnamed)
 Sect OctLoc
   1     000   072123 131123   000000 400000                                    :SYS....

(unnamed)
 Sect OctLoc
   3     000   000005 777640   001777 600000   000010 006000   000000 000000    ................
   3     004   000001 777640   000000 006000   000003 777777   000006 006000    ................
   3     010   000022 400000   000021 400000   000000 000016   000012 006000    ................
   3     014   000000 000024   000014 006000                                    ........
     1385     5443    1   END KIF$SEND;

PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:233  
--  Include file information  --

   GJ_MSG_M.:E05TOU  is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   B$OBJECT_C.:E05TOU  is referenced.
   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure KIF$SEND.
PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:234  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @LDCT                      5-0-0/w PTR         r     1 @RUTYPE
     4-0-0/w PTR         r     1 @VLP_NAME                 16-0-0/w STRC(54)    r     1 ADKEY
    15-0-0/w PTR         r     1 BF2$                      20-0-0/w STRC(126)   r     1 DATAMSG
    32-0-0/d STRC(504)   r     1 FPT_READ                  24-0-0/w STRC(180)   r     1 GJ_PROGKEY_MSG
    *0-0-0/w UBIN        r     1 LDCT                       7-0-0/b BIT         r     1 MYERR
    14-0-0/w SBIN        r     1 N_READS                   13-0-0/w SBIN        r     1 RECORD_BYSZ
    *0-0-0/w UBIN        r     1 RUTYPE                     6-0-0/w PTR         r     1 STARDCB$
    10-0-0/w UBIN        r     1 TEMP                      10-0-0/w BIT         r     1 TEMPB
    12-0-0/w SBIN        r     1 TOTAL_BYSZ                *0-0-0/c STRC(288)   r     1 VLP_NAME
    11-0-0/w SBIN        r     1 WRITE_BYSZ

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$M$STAR$
     0-0-0/b BIT         r     1 KIF_BADHEAD                0-0-0/d STRC(504)   r     1 KIF_FPT_READ
     0-0-0/c STRC(72)    r     1 KIF_HDKEY                  0-0-0/b BIT         r     1 KIF_NONFP
     0-0-0/b BIT         r     1 KIF_UNEXPT

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(1440)  r     1 B$HEAD                     0-0-0/d STRC(8856)  r     1 B$JIT
     0-0-0/c CHAR        r     1 CHAR$1                     0-0-0/d ASTR(3528)  r     1 F$DCB
     0-0-0/w STRC(54)    r     1 FCNMSG

PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:235  

   Procedure KIF$SEND requires 434 words for executable code.
   Procedure KIF$SEND requires 44 words of local(AUTO) storage.

    No errors detected in file KIF$FPRG.:E05TSI    .
PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:236  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:237  
          MINI XREF LISTING

ADKEY
      4813**DCL      5372--ASSIGN   5378<<ASSIGN
ADKEY.KEYSIZ
      4814**DCL      5379<<ASSIGN
ADKEY.PAGE
      4820**DCL      4822--REDEF    5382<<ASSIGN   5406<<ASSIGN   5406>>ASSIGN
ADKEY.TYPE
      4816**DCL      5380<<ASSIGN
B$HEAD
      5001**DCL      5336--IF
B$HEAD.DEBUGGER
      5138**DCL      5343>>IF
B$HEAD.FLAVOR
      5126**DCL      5343>>IF
B$HEAD.LIB
      5131**DCL      5343>>IF
B$HEAD.RDATA
      5020**DCL      5355>>ASSIGN
B$HEAD.RPROC
      5010**DCL      5357>>ASSIGN
B$JIT.CPFLAGS1.SLEAZE
       140**DCL       140--REDEF
B$JIT.DCB$
       214**DCL      5299<<ASSIGN   5306<>CALL
B$JIT.ERR
        46**DCL      5312<<ASSIGN   5316>>IF       5318>>ASSIGN   5332>>ASSIGN   5363>>ASSIGN   5390>>ASSIGN
      5400>>ASSIGN   5439<<ASSIGN
B$JIT.ERR.MID
        47**DCL        47--REDEF
B$JIT.JRESPEAK
       208**DCL       209--REDEF
B$JIT.ORIGINATOR_PORT.FROM_CR
PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:238  
       317**DCL       317--REDEF     318--REDEF
B$JIT.PNR
       221**DCL       221--REDEF
B$JIT.TSLINE
       315**DCL       316--REDEF
B$JIT$
      5270**DCL        41--IMP-PTR  5299>>ASSIGN   5306>>CALL     5312>>ASSIGN   5316>>IF       5318>>ASSIGN
      5332>>ASSIGN   5363>>ASSIGN   5390>>ASSIGN   5400>>ASSIGN   5439>>ASSIGN
B$M$STAR$
      5271**DCL      5298>>ASSIGN
BF2$
      4799**DCL      5392<<ASSIGN   5398>>CALL     5403<<ASSIGN   5403>>ASSIGN
CHAR$1
      4999**DCL      5398<>CALL
DATAMSG
      4856**DCL      5323<>CALL     5353<<ASSIGN   5361<>CALL     5361--CALL     5419<<ASSIGN   5421<>CALL
DATAMSG.DATA_SZ
      4874**DCL      5356<>CALL
DATAMSG.ERR
      4863**DCL      5322<<ASSIGN   5360<<ASSIGN   5420<<ASSIGN
DATAMSG.FCN
      4856**DCL      5321<<ASSIGN   5354<<ASSIGN
DATAMSG.PROC_SZ
      4869**DCL      5358<>CALL
EMR$FEP2HOST
      5276**DCL-ENT  5412--CALL
EMR$HOST2FEP
      5277**DCL-ENT  5320--CALL     5359--CALL     5418--CALL
F$DCB.ACCT
      4384**DCL      5308<<ASSIGN
F$DCB.ACS
      4391**DCL      5311<<ASSIGN
F$DCB.ACTPOS
      4399**DCL      4399--REDEF
F$DCB.ARS
      4374**DCL      4374--REDEF    5336>>IF
PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:239  
F$DCB.ASN
      4389**DCL      5309<<ASSIGN
F$DCB.ATTR
      4392**DCL      4393--REDEF
F$DCB.BORROW
      4407**DCL      4407--REDEF    4407--REDEF    4407--REDEF
F$DCB.DCBNAME.L
      4421**DCL      4421--IMP-SIZ
F$DCB.EOMCHAR
      4378**DCL      4378--REDEF
F$DCB.FCD
      4387**DCL      5301>>IF
F$DCB.FLDID
      4402**DCL      4402--REDEF
F$DCB.FORM$
      4396**DCL      4396--REDEF
F$DCB.FSECT
      4412**DCL      4412--REDEF
F$DCB.FSN
      4389**DCL      4389--REDEF    4389--REDEF    4390--REDEF
F$DCB.FUN
      4388**DCL      5310<<ASSIGN
F$DCB.HEADER$
      4395**DCL      4395--REDEF
F$DCB.IXTNSIZE
      4393**DCL      4393--REDEF
F$DCB.LASTSTA$
      4383**DCL      4383--REDEF
F$DCB.LVL
      4408**DCL      4408--REDEF
F$DCB.NAME
      4383**DCL      5307<<ASSIGN
F$DCB.NAME.C
      4383**DCL      4383--REDEF
F$DCB.NOEOF
      4404**DCL      4404--REDEF
PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:240  
F$DCB.NRECS
      4394**DCL      4394--REDEF
F$DCB.NRECX
      4413**DCL      4413--REDEF
F$DCB.OHDR
      4405**DCL      4405--REDEF
F$DCB.ORG
      4388**DCL      4388--REDEF
F$DCB.PRECNO
      4411**DCL      4411--REDEF
F$DCB.RCSZ
      4416**DCL      4416--REDEF
F$DCB.RES
      4384**DCL      4384--REDEF
F$DCB.SETX
      4396**DCL      4396--REDEF
F$DCB.TAB$
      4395**DCL      4396--REDEF
F$DCB.TDA
      4410**DCL      4410--REDEF
F$DCB.WSN
      4385**DCL      4385--REDEF
F$DCB.WSR
      4391**DCL      5313<<ASSIGN
FCNMSG
      4987**DCL      5323--CALL     5421--CALL
FMD$GBUF
      5281**DCL-ENT  5295--CALL
FMD$RBUF
      5282**DCL-ENT  5435--CALL
FMM$DFLOPN
      5280**DCL-ENT  5314--CALL
FMM$SCRUB
      5278**DCL-ENT  5306--CALL
FMP$CLSJ
      5279**DCL-ENT  5304--CALL     5433--CALL
PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:241  
FPT_READ
      4951**DCL      5294<<ASSIGN   5330<>CALL     5388<>CALL
FPT_READ.BUF_.BOUND
      4953**DCL      5297<<ASSIGN
FPT_READ.BUF_.BUF$
      4954**DCL      5001--IMP-PTR  5295<>CALL     5343>>IF       5343>>IF       5343>>IF       5355>>ASSIGN
      5357>>ASSIGN   5392>>ASSIGN   5434>>IF       5435<>CALL
FPT_READ.KEY_
      4951**DCL      5329<<ASSIGN   5372<<ASSIGN
FPT_READ.STATION_
      4954**DCL      4955--REDEF
FPT_READ.V
      4955**DCL      5296--ASSIGN
FPT_READ.V.DCB#
      4955**DCL      5328<<ASSIGN
FPT_READ.V.DVBYTE.REREAD#
      4966**DCL      4966--REDEF
FPT_READ.V.INDX#
      4964**DCL      4964--REDEF
FPT_READ.V_
      4951**DCL      5296<<ASSIGN
GJ_PROGKEY_MSG
      4905**DCL      5374<>CALL     5374--CALL
GJ_PROGKEY_MSG.ERR
      4912**DCL      5411>>ASSIGN
GJ_PROGKEY_MSG.FCN
      4905**DCL      5375>>DOCASE
GJ_PROGKEY_MSG.READ_BYSZ
      4924**DCL      5383<>CALL
GJ_PROGKEY_MSG.RU_KEY.KEYSIZ
      4917**DCL      5379>>ASSIGN
GJ_PROGKEY_MSG.RU_KEY.PAGE
      4919**DCL      5381<>CALL
GJ_PROGKEY_MSG.RU_KEY.TYPE
      4917**DCL      5380>>ASSIGN
GJ_PROGKEY_MSG.SECT_BYSZ
PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:242  
      4929**DCL      5384<>CALL
KIA$8TO9
      5285**DCL-ENT  5381--CALL     5383--CALL     5384--CALL
KIA$9TO8
      5286**DCL-ENT  5356--CALL     5358--CALL
KIF$READ
      5287**DCL-ENT  5374--CALL
KIF$WRITE
      5288**DCL-ENT  5323--CALL     5361--CALL     5398--CALL     5421--CALL
KIF_BADHEAD
      5267**DCL      5338>>ASSIGN
KIF_FPT_READ
      5218**DCL      5294>>ASSIGN
KIF_FPT_READ.STATION_
      5221**DCL      5222--REDEF
KIF_FPT_READ.V.DVBYTE.REREAD#
      5233**DCL      5233--REDEF
KIF_FPT_READ.V.INDX#
      5231**DCL      5231--REDEF
KIF_HDKEY
      5265**DCL      5329--ASSIGN
KIF_NONFP
      5268**DCL      5347>>ASSIGN
KIF_UNEXPT
      5269**DCL      5427>>ASSIGN
LDCT
      4762**DCL        28--PROC     5323<>CALL     5361<>CALL     5374<>CALL     5398<>CALL     5421<>CALL
M$MREAD
      5284**DCL-ENT  5330--CALL     5388--CALL
MYERR
      4792**DCL      5293<<ASSIGN   5318<<ASSIGN   5319<<ASSIGN   5319>>ASSIGN   5320<>CALL     5332<<ASSIGN
      5338<<ASSIGN   5347<<ASSIGN   5359<>CALL     5363<<ASSIGN   5365>>IF       5390<<ASSIGN   5400<<ASSIGN
      5412<>CALL     5416>>IF       5417<<ASSIGN   5417>>ASSIGN   5418<>CALL     5427<<ASSIGN   5437>>IF
      5439>>ASSIGN
N_READS
      4798**DCL      5385<<ASSIGN   5387>>DOINDEX
PL6.E3A0      #004=KIF$SEND File=KIF$FPRG.:E05TSI                                WED 07/30/97 00:34 Page:243  
READ_FEP
      5365**LABEL    5324--GOTO
RECORD_BYSZ
      4797**DCL      5393<<ASSIGN   5394>>ASSIGN   5396>>DOWHILE  5397>>IF       5397>>ASSIGN   5404<<ASSIGN
      5404>>ASSIGN
RUTYPE
      4790**DCL        28--PROC     5343>>IF       5343>>IF       5354>>ASSIGN
SC_FPRG
      5283**DCL-ENT  5303--CALL     5426--CALL
SETERR
      5319**LABEL    5333--GOTO     5339--GOTO     5348--GOTO
STARDCB$
      4791**DCL      5298<<ASSIGN   5299>>ASSIGN   5301>>IF       5307>>ASSIGN   5308>>ASSIGN   5309>>ASSIGN
      5310>>ASSIGN   5311>>ASSIGN   5313>>ASSIGN   5336>>IF
TEMP
      4793**DCL      4794--REDEF    5355<<ASSIGN   5356<>CALL     5357<<ASSIGN   5358<>CALL     5381<>CALL
      5382>>ASSIGN   5387<<DOINDEX
TEMPB
      4794**DCL      5320<>CALL     5322>>ASSIGN   5359<>CALL     5360>>ASSIGN   5411<<ASSIGN   5412<>CALL
      5418<>CALL     5420>>ASSIGN
TOTAL_BYSZ
      4796**DCL      5384<>CALL     5385>>ASSIGN   5393>>ASSIGN   5394<<ASSIGN   5394>>ASSIGN
VLP_NAME
      4788**DCL        28--PROC     5307>>ASSIGN
WRITE_BYSZ
      4795**DCL      5383<>CALL     5397>>IF       5397<<ASSIGN   5398<>CALL     5403>>ASSIGN   5404>>ASSIGN
XIT
      5433**LABEL    5366--GOTO     5374--CALLALT  5413--GOTO     5422--GOTO     5428--GOTO
