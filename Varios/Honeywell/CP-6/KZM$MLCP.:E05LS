VERSION E05

Elsie.D00  OU Name=KZM$MLCP                File=KZM$MLCP.:E05TSI                WED JUL 30 '97 02:55 Page:1
        1                     *M* KZM$MLCP - Sync MLCP code.
        2                     *T***********************************************************
        3                     *T*                                                         *
        4                     *T* Copyright (c) Bull HN Information Systems Inc., 1997    *
        5                     *T*                                                         *
        6                     *T***********************************************************
        7                     *  TABS 9,16,30
        8     1                       OUNAME KZM$MLCP
        9     2                   BIAS      START='200'X,END='BFF'X  Leave room for COLTS, DEBUG, etc.
       10     3                       SECT    DATA          Data (vs procedure) section for relocation
       11     4                       INCLUDE  KW_LCT_E    General LCT byte definitions.
       12   311                       INCLUDE  KW_SLCT_E   Synchronous LCT/Linereg definitions
       13   450                       INCLUDE  KZ_MLCP_C   EQUs for MLCP orders and statuses
       14   500                       INCLUDE  KZ_PERR_C   EQUs for KZM-?-? error logs
       15   553               A       LCTS
       16   554                       LCT     LOC=2,VALUE='C0'X
       17   555                       ADDR    LOC=6,REF=RCV
       18   556                       LCT     LOC=8,VALUE='80'X
       19   557                       LCT     LOC=15,VALUE='80'X
       20   558                       ADDR    LOC=27,REF=BLKEND
       21   559                       ADDR    LOC=30,REF=PARSE
       22   560                       LCT     LOC=34,VALUE='C0'X
       23   561                       ADDR    LOC=38,REF=TRN
       24   562                       LCT     LOC=47,VALUE='40'X
       25   563                       LCT     LOC=59,VALUE='18'X
       26   564                       ADDR    LOC=61,REF=OTPORD
       27   565                       ENDLCTS
                 000 0000C000 000003B6 80000000 00000080
                 010 00000000 00000000 00000003 76000276
                 020 0000C000 00000637 00000000 00000040
                 030 00000000 00000000 00000018 00026400
                 040 00000000 00000000 00000000 00000000
                 050 00000000 00000000 00000000 00000000
                 060 00000000 00000000 00000000 00000000
                 070 00000000 00000000 00000000 00000000
                 080 00000000 00000000 00000000 00000000
Elsie.D00  OU Name=KZM$MLCP                File=KZM$MLCP.:E05TSI                WED JUL 30 '97 02:55 Page:2
                 090 00000000 00000000 00000000 00000000
                 0A0 00000000 00000000 00000000 00000000
                 0B0 00000000 00000000 00000000 00000000
                 0C0 00000000 00000000 00000000 00000000
                 0D0 00000000 00000000 00000000 00000000
                 0E0 00000000 00000000 00000000 00000000
                 0F0 00000000 00000000 00000000 00000000

Elsie.D00  OU Name=KZM$MLCP                File=KZM$MLCP.:E05TSI                WED JUL 30 '97 02:55 Page:3
       29                     *
       30                     * Reserve 100 byte patch area filled with NOPs.
       31                     *
       32   567  200          PAT TABLE     SIZE=100,DTRANSLATE=0
       33   568               PAT ENDTABLE
                 200 00000000 00000000 00000000 00000000
                 210 00000000 00000000 00000000 00000000
                 220 00000000 00000000 00000000 00000000
                 230 00000000 00000000 00000000 00000000
                 240 00000000 00000000 00000000 00000000
                 250 00000000 00000000 00000000 00000000
                 260 00000000

Elsie.D00  OTPORD - Output order table                                          WED JUL 30 '97 02:55 Page:4
       35   570  264          OTPORD  TABLE   NODEFAULT,SIZE=KZ#MAX_ORDER+1,TLU=OOTLU
       36   571                       TRANSFER   IN=0,TARGET=SEND_0
       37   572                       TRANSFER   IN=KZ#SEND_BLOCK,TARGET=SEND_BLOCK
       38   573                       TRANSFER   IN=KZ#SEND_TEXT,TARGET=SEND_TEXT
       39   574                       TRANSFER   IN=KZ#SEND_TBLOCK,TARGET=SEND_TBLOCK
       40   575                       TRANSFER   IN=KZ#SEND_TTD,TARGET=SEND_TTD
       41   576                       TRANSFER   IN=KZ#SEND_WACK,TARGET=SEND_WACK
       42   577                       TRANSFER   IN=KZ#SEND_NAK,TARGET=SEND_NAK
       43   578                       TRANSFER   IN=KZ#SEND_DLE_EOT,TARGET=SEND_DLE_EOT
       44   579                       TRANSFER   IN=KZ#SEND_SOH_ENQ,TARGET=SEND_SOH_ENQ
       45   580                       TRANSFER   IN=KZ#SEND_EOT,TARGET=SEND_EOT
       46   581                       TRANSFER   IN=KZ#SEND_ACK0,TARGET=SEND_ACK0
       47   582                       TRANSFER   IN=KZ#SEND_ACK1,TARGET=SEND_ACK1
       48   583                       TRANSFER   IN=KZ#SEND_NOTHING,TARGET=SEND_NOTHING
       49   584                       TRANSFER   IN=KZ#SEND_ENQ,TARGET=SEND_ENQ
       50   585                       TRANSFER   IN=KZ#SEND_GEPOLL,TARGET=SEND_GEPOLL
       51   586                       TRANSFER   IN=KZ#SEND_SEPOLL,TARGET=SEND_SEPOLL
       52   587                       TRANSFER   IN=KZ#SEND_HDRDATA,TARGET=SEND_HDRDATA
       53   588                       TRANSFER   IN=17,TARGET=SEND_TTEXT
       54   589               OTPORD  ENDTABLE
                 264 8082868A 8E93999C A0A5A8AE B4B6B9BB
                 274 BDBF

Elsie.D00  PARSE - Leading control character parse table                        WED JUL 30 '97 02:55 Page:5
       56   591  276          PARSE   TABLE   SIZE=256,TLU=INTLU,DTRANSFER=R$BR0
       57   592                       TRANSFER   IN='10'X,TARGET=R$BR1
       58   593                       TRANSFER   IN='3D'X,TARGET=R$BR2
       59   594                       TRANSFER   IN='01'X,TARGET=R$BR3
       60   595                       TRANSFER   IN='2D'X,TARGET=R$BR4
       61   596                       TRANSFER   IN='02'X,TARGET=R$BR5
       62   597                       TRANSFER   IN='37'X,TARGET=R$BR6
       63   598                       TRANSFER   IN='70'X,TARGET=R$BR7
       64   599                       TRANSFER   IN='61'X,TARGET=R$BR8
       65   600                       TRANSFER   IN='6B'X,TARGET=R$BR9
       66   601                       TRANSFER   IN='7C'X,TARGET=R$BR10
       67   602                       TRANSFER   IN='32'X,TARGET=R$BR11
       68   603               PARSE   ENDTABLE
                 276 80868A80 80808080 80808080 80808080
                 286 82808080 80808080 80808080 80808080
                 296 80808080 80808080 80808080 80888080
                 2A6 80809680 8080808C 80808080 80848080
                 2B6 80808080 80808080 80808080 80808080
                 2C6 80808080 80808080 80808080 80808080
                 2D6 80908080 80808080 80808092 80808080
                 2E6 8E808080 80808080 80808080 94808080
                 2F6 80808080 80808080 80808080 80808080
                 306 80808080 80808080 80808080 80808080
                 316 80808080 80808080 80808080 80808080
                 326 80808080 80808080 80808080 80808080
                 336 80808080 80808080 80808080 80808080
                 346 80808080 80808080 80808080 80808080
                 356 80808080 80808080 80808080 80808080
                 366 80808080 80808080 80808080 80808080

Elsie.D00  BLKEND - Non-transparent block parse table                           WED JUL 30 '97 02:55 Page:6
       70   605  376          BLKEND   TABLE     SIZE=64,TLU=DATTLU,DTRANSFER=R$DAT4
       71   606                        TRANSFER  IN='26'X,TARGET=R$DAT0
       72   607                        TRANSFER  IN='03'X,TARGET=R$DAT0
       73   608                        TRANSFER  IN='1F'X,TARGET=R$DAT0
       74   609                        TRANSFER  IN='19'X,TARGET=R$DAT1
       75   610                        TRANSFER  IN='2D'X,TARGET=R$DAT2
       76   611                        TRANSFER  IN='32'X,TARGET=R$DAT3
       77   612               BLKEND   ENDTABLE
                 376 84848480 84848484 84848484 84848484
                 386 84848484 84848484 84818484 84848480
                 396 84848484 84848084 84848484 84828484
                 3A6 84848384 84848484 84848484 84848484

Elsie.D00  RCV - EBCDIC BSC receive CCP                                         WED JUL 30 '97 02:55 Page:7
       79   614                       SYMDEF KZM$CCP
       80   615  3B6          KZM$CCP CCP
       81   616  3B6 5002     RCV     LD      02
       82   617  3B8 36               OUT    6
       83   618  3B9 9032             LD     ='32'X
       84   619  3BB 34               OUT    4
       85   620  3BC 90805414         SET    KW#CLACTR,=KW#CLACTR_DTR@S
                     5114
       86   621  3C2 32               OUT    2
       87   622  3C3 90105408         SET    KW#RCVSCN,=KW#RCVSCN_STRCCP@S
                     5108
       88   623  3C9 25               IN     5
       89   624  3CA 9380             AND    =0128
       90   625  3CC F202             BZF     L0542
       91   626  3CE 01               WAIT
       92   627  3CF 90EF5308 L0542   RESET  KW#RCVSCN,=KW#RCVSCN_STRCCP@S
                     5108
       93   628  3D5 08               INTR
       94                     *
       95                     *   Here's where KZM$RCVRST goes...
       96                     *
       97                     * ASC Receiver comes back to here sometimes.
       98   629                       SYMDEF KZM$RCVRST
       99   630                       SYMDEF KZM$RCVRST
      100   631  3D6          KZM$RCVRST LABEL
      101   632  3D6 90FD5314         RESET  KW#CLACTR,=KW#CLACTR_RCVON@S
                     5114
      102   633  3DC 32               OUT    2
      103   634  3DD 5002     L0564   LD      2
      104   635  3DF 9306             AND    ='06'X
      105   636  3E1 E204             BZT     EBCRCV
      106   637  3E3 E604AB           JUMP    ASCRCV
      107   638  3E6 20       EBCRCV  IN      0                      L/adapter type if MLC-16
      108   639  3E7 9248             C       ='48'X                 MLC-16 broadband adapter type
      109   640  3E9 E118             BET    L0579
      110   641  3EB 9268             C     ='68'X
Elsie.D00  RCV - EBCDIC BSC receive CCP                                         WED JUL 30 '97 02:55 Page:8
      111   642  3ED E109             BET    CHKONESYN
      112   643  3EF 9278             C      ='78'X                  2nd MLC-16 adapter type
      113   644  3F1 E105             BET CHKONESYN
      114   645  3F3 E50201A0         RECV WAIT,BROADBAND
      115   646  3F7 E50201A0 CHKONESYN RECV WAIT,BROADBAND
      116   647  3FB 9232             C      ='32'X
      117   648  3FD E104             BET    L0579
      118   649  3FF 03       RESYN   SFS
      119   650  400 E0E5             B       EBCRCV
      120   651  402 E50201A0 L0579   RECV     WAIT,BROADBAND
      121   652  406 5118             ST      24
      122   653  408 9000             LD      =0
      123   654  40A 5119             ST      25
      124   655  40C 511A             ST      26
      125   656  40E 5103             ST      3
      126   657  410 5104             ST      4
      127   658  412 5018             LD      24
      128   659  414 00               NOP
      129   660  415 00               NOP
      130   661  416 00               NOP
      131   662  417 00               NOP
      132   663  418 561E     INTLU   TLU     30
      133   664  41A 09               INZ
      134   665  41B 00               NOP
      135   666  41C          R$BR0   TARGET  INTLU
      136   667  41C E6002C           JUMP    POLL_RECEIVED          Any non-ctl char
      137   668  420          R$BR1   TARGET  INTLU
      138   669  420 E600C3           JUMP    L0822                  DLE - X'10'
      139   670  424          R$BR2   TARGET  INTLU
      140   671  424 E600B2           JUMP    L0809                  NAK - X'3D'
      141   672  428          R$BR3   TARGET  INTLU
      142   673  428 E60052           JUMP    L0690                  SOH - X'01'
      143   674  42C          R$BR4   TARGET  INTLU
      144   675  42C E600AF           JUMP    L0814                  ENQ - X'2D'
      145   676  430          R$BR5   TARGET  INTLU
      146   677  430 E60115           JUMP    L0903                  STX - X'02'
Elsie.D00  RCV - EBCDIC BSC receive CCP                                         WED JUL 30 '97 02:55 Page:9
      147   678  434          R$BR6   TARGET  INTLU
      148   679  434 E60092           JUMP    L0766                  EOT - X'37'
      149   680  438          R$BR7   TARGET  INTLU
      150   681  438 E60010           JUMP    POLL_RECEIVED          Any non-ctl char
      151   682  43C          R$BR8   TARGET  INTLU
      152   683  43C E60037           JUMP    L0683                  ACK1 - X'61'
      153   684  440          R$BR9   TARGET  INTLU
      154   685  440 E60008           JUMP    POLL_RECEIVED          WACK - X'6B'
      155   686  444          R$BR10  TARGET  INTLU
      156   687  444 E60004           JUMP    POLL_RECEIVED          RVI - X'7C'
      157   688  448          R$BR11  TARGET  INTLU
      158   689  448 E0B9             B       L0579                  SYN - X'32'
      159   690  44A 5018     POLL_RECEIVED    LD 24
      160   691  44C 9200                   C =0000
      161   692  44E E1B0                   BET RESYN
      162   693  450 9005                   LD     =0005
      163   694  452 513F             ST      63
      164   695  454 5018             LD      24
      165   696  456 5118     L0650   ST      24
      166   697  458 503F             LD      63
      167   698  45A 05               DEC
      168   699  45B E219             BZT     L0683
      169   700  45D 513F             ST      63
      170   701  45F 5018             LD      24
      171   702  461 F713             BVBF    L0683
      172   703  463 11               ST
      173   704  464 E50201A0         RECV   WAIT,BROADBAND
      174   705  468 922D             C      ='2D'X
      175   706  46A E105             BET     L0678
      176   707  46C F3E9             BLCF    L0650
      177   708  46E E006             B       L0683
      178   709  470 900D     L0678   LD     =KZ#MLCP_POLL
      179   710  472 E601B9           JUMP    L1157
      180   711  475 9001     L0683   LD     =E$ILGCTLSEQ            Illegal control sequence (rcv)
      181   712  477 5119             ST      25
      182                     *
Elsie.D00  RCV - EBCDIC BSC receive CCP                                         WED JUL 30 '97 02:55 Page:10
      183                     *E*        ERROR: KZM-E$ILGCTLSEQ
      184                     *E*      MESSAGE: Illegal control sequence in received data
      185                     *E*  DESCRIPTION: The MLCP program did not find a legal leading
      186                     *E*               control character sequence in the received data.
      187                     *
      188   713  479 E601AB           JUMP    L1150
      189   714  47C E50201A0 L0690   RECV   WAIT,BROADBAND
      190   715  480 9232             C      ='32'X
      191   716  482 E1F9             BET     L0690
      192   717  484 5118             ST      24
      193   718  486 922D             C      ='2D'X
      194   719  488 E14A             BET     L0804
      195   720  48A 9202             C      ='02'X
      196   721  48C E11D             BET     L0736
      197   722  48E 04               CCH
      198   723  48F 926C             C      ='6C'X
      199   724  491 F12F             BEF     L0759
      200   725  493 E50201A0 L0713   RECV   WAIT,BROADBAND
      201   726  497 9232             C      ='32'X
      202   727  499 E1F9             BET     L0713
      203   728  49B 04               CCH
      204   729  49C 92D9             C      ='D9'X
      205   730  49E F10E             BEF     L0739
      206   731  4A0 900B             LD     =KZ#MLCP_STATUS_MESSAGE
      207   732  4A2 511A             ST      26
      208   733  4A4 E6000F           JUMP    L0747
      209   734  4A7 E6009E   L0733   JUMP    L0903
      210   735  4AA E600A3   L0736   JUMP    L0914
      211   736  4AD 9261     L0739   C      ='61'X
      212   737  4AF F111             BEF     L0759
      213   738  4B1 900C             LD     =KZ#MLCP_TEST_REQUEST
      214   739  4B3 511A             ST      26
      215   740  4B5 E50201A0 L0747   RECV   WAIT,BROADBAND
      216   741  4B9 9232             C      ='32'X
      217   742  4BB E1F9             BET     L0747
      218   743  4BD 9202             C      ='02'X
Elsie.D00  RCV - EBCDIC BSC receive CCP                                         WED JUL 30 '97 02:55 Page:11
      219   744  4BF E1EA             BET     L0736
      220   745  4C1 9002     L0759   LD     =E$BADHDR               Illegal characters in header (rcv)
      221   746  4C3 5119             ST      25
      222                     *
      223                     *E*        ERROR: KZM-E$BADHDR
      224                     *E*      MESSAGE: Illegal characters in header
      225                     *E*  DESCRIPTION: The MLCP program found a header that appeared to
      226                     *E*               be something other than SOH-STX..., SOH-%-/-STX...
      227                     *E*               or SOH-%-R-STX.
      228                     *
      229   747  4C5 E6015F           JUMP    L1150
      230   748  4C8 501D     L0766   LD      29
      231   749  4CA 9201             C      =KZ#RCV_SLV3270
      232   750  4CC E115             BET     L0819
      233   751  4CE 9001     L0799   LD     =KZ#MLCP_EOT
      234   752  4D0 E6015B           JUMP    L1157
      235   753  4D3 9005     L0804   LD     =KZ#MLCP_SOH_ENQ
      236   754  4D5 E60156           JUMP    L1157
      237   755  4D8 9006     L0809   LD     =KZ#MLCP_NAK
      238   756  4DA E60151           JUMP    L1157
      239   757  4DD 9004     L0814   LD     =KZ#MLCP_ENQ
      240   758  4DF E6014C           JUMP    L1157
      241   759  4E2 E6FF1B   L0819   JUMP    RESYN
      242   760  4E5 E50201A0 L0822   RECV   WAIT,BROADBAND
      243   761  4E9 5118             ST      24
      244   762  4EB 561E     DLETLU  TLU     30
      245   763  4ED 09               INZ
      246   764  4EE 00               NOP
      247   765  4EF          NULL    TARGET  DLETLU
      248   766  4EF E6004F           JUMP    TRNCTLERR              Any non-ctl char
      249   767  4F3          NULL1   TARGET  DLETLU
      250   768  4F3 E6004B           JUMP    TRNCTLERR              DLE-DLE - illegal
      251   769  4F7          NULL2   TARGET  DLETLU
      252   770  4F7 E60047           JUMP    TRNCTLERR              DLE-NAK - illegal
      253   771  4FB          NULL3   TARGET  DLETLU
      254   772  4FB E60043           JUMP    TRNCTLERR              DLE-SOH - illegal for CP6
Elsie.D00  RCV - EBCDIC BSC receive CCP                                         WED JUL 30 '97 02:55 Page:12
      255   773  4FF          NULL4   TARGET  DLETLU
      256   774  4FF E6003F           JUMP    TRNCTLERR              DLE-ENQ - illegal
      257   775  503          NULL5   TARGET  DLETLU
      258   776  503 E600C8           JUMP    L1060                  DLE-STX - begin trsp block
      259   777  507          NULL6   TARGET  DLETLU
      260   778  507 E60028           JUMP    DLEEOT                 DLE-EOT - hang-up
      261   779  50B          NULL7   TARGET  DLETLU
      262   780  50B E60010           JUMP    ACK0                   ACK-0
      263   781  50F          NULL8   TARGET  DLETLU
      264   782  50F E60015           JUMP    ACK1                   ACK-1
      265   783  513          NULL9   TARGET  DLETLU
      266   784  513 E60021           JUMP    WACK                   WACK - X'106B'
      267   785  517          NULL10  TARGET  DLETLU
      268   786  517 E60022           JUMP    RVI                    RVI - X'107C'
      269   787  51B          NULL11  TARGET  DLETLU
      270   788  51B E0C9             B       L0822                  SYN - keep looking
      271   789  51D 5010     ACK0    LD      16
      272   790  51F 93F9             AND    =0249
      273   791  521 5110             ST      16
      274   792  523 E600F5           JUMP    L1138
      275   793  526 5010     ACK1    LD      16
      276   794  528 93F9             AND    =0249
      277   795  52A 9402             OR     =0002
      278   796  52C 5110             ST      16
      279   797  52E E600EA           JUMP    L1138
      280   798  531 9002     DLEEOT  LD     =KZ#MLCP_DLE_EOT
      281   799  533 E600F8           JUMP    L1157
      282   800  536 9007     WACK    LD     =KZ#MLCP_WACK
      283   801  538 E600F3           JUMP    L1157
      284   802  53B 9003     RVI     LD     =KZ#MLCP_RVI
      285   803  53D E600EE           JUMP    L1157
      286   804  540 9003     TRNCTLERR       LD     =E$BADDLESEQ    Illegal DLE control sequence (rcv)
      287   805  542 5119             ST      25
      288                     *
      289                     *E*        ERROR: KZM-E$BADDLESEQ
      290                     *E*      MESSAGE: Illegal DLE control sequence
Elsie.D00  RCV - EBCDIC BSC receive CCP                                         WED JUL 30 '97 02:55 Page:13
      291                     *E*  DESCRIPTION: The MLCP found a character following an initial
      292                     *E*               DLE character which forms an illegal control
      293                     *E*               sequence.
      294                     *
      295   806  544 E600E0           JUMP    L1150
      296   807  547 9000     L0903   LD     =0000
      297   808  549 5103             ST      03
      298   809  54B 5104             ST      04
      299   810  54D E002             B       L0919
      300   811  54F 04       L0914   CCH
      301   812  550 E50201A0 L0919   RECV   WAIT,BROADBAND
      302   813  554 5118             ST      24
      303   814  556 93C0             AND    ='C0'X
      304   815  558 F20F             BZF     DATCHR
      305   816  55A 5018             LD      24
      306   817  55C 561B     DATTLU  TLU     27
      307   818  55E 09               INZ
      308   819  55F 00               NOP
      309   820  560          R$DAT0  TARGET  DATTLU
      310   821  560 E020             B       L0972             ETB, ETX, IRS
      311   822  562          R$DAT1  TARGET  DATTLU
      312   823  562 E01B             B       L0969             EM
      313   824  564          R$DAT2  TARGET  DATTLU
      314   825  564 E063             B       L1055             ENQ
      315   826  566          R$DAT3  TARGET  DATTLU
      316   827  566 E0E9             B       L0919             SYN
      317   828  568          R$DAT4  TARGET  DATTLU
      318   829  568 5018     DATCHR  LD      24
      319   830  56A 04               CCH
      320   831  56B E708     L0950   BVBT    L0959
      321   832  56D 9004             LD     =E$BLKEND               Can't store block-end character (rcv)
      322   833  56F 5119             ST      25
      323                     *
      324                     *E*        ERROR: KZM-E$BLKEND
      325                     *E*      MESSAGE: Can't store block-end character into FEP
      326                     *E*  DESCRIPTION: The MLCP has run out of room to store a block
Elsie.D00  RCV - EBCDIC BSC receive CCP                                         WED JUL 30 '97 02:55 Page:14
      327                     *E*               terminating character into FEP memory because the
      328                     *E*               value of BLKBYTES in the line profile is one
      329                     *E*               byte too small.
      330                     *
      331   834  571 E600B8           JUMP    L1155
      332   835  574 11       L0959   ST
      333   836  575 F3DA             BLCF    L0919
      334   837  577 9005     L0962   LD     =E$LSTDAT               Data block truncated (rcv)
      335   838  579 5119             ST      25
      336                     *
      337                     *E*        ERROR: KZM-E$LSTDAT
      338                     *E*      MESSAGE: Data block truncated
      339                     *E*  DESCRIPTION: Received data has been lost because the value of
      340                     *E*               BLKBYTES in the line profile is too small, i.e.
      341                     *E*               no more input buffer space is available.
      342                     *
      343   839  57B E600A9           JUMP    L1150
      344   840  57E 04       L0969   CCH
      345   841  57F E0D0             B       L0919
      346   842  581 04       L0972   CCH
      347   843  582 F02D             BS      L1021
      348   844  584 5018             LD      24
      349   845  586 921F             C      ='1F'X
      350   846  588 E10C             BET     L0994
      351   847  58A 11               ST
      352   848  58B 501A             LD      26
      353   849  58D F204             BZF     L0991
      354   850  58F E60081           JUMP    L1130
      355   851  592 E60099   L0991   JUMP    L1157
      356   852  595 901E     L0994   LD     ='1E'X
      357   853  597 11               ST
      358   854  598 E3DE             BLCT    L0962
      359   855  59A 00               NOP
      360   856  59B 9000             LD     =0000
      361   857  59D 5103             ST      03
      362   858  59F 5104             ST      04
Elsie.D00  RCV - EBCDIC BSC receive CCP                                         WED JUL 30 '97 02:55 Page:15
      363   859  5A1 E50201A0 L1006   RECV   WAIT,BROADBAND
      364   860  5A5 9232             C      ='32'X
      365   861  5A7 E1F9             BET     L1006
      366   862  5A9 04               CCH
      367   863  5AA 9202             C      ='02'X
      368   864  5AC E1A3             BET     L0919
      369   865  5AE E0BC             B       L0950
      370   866  5B0 E50201A0 L1021   RECV   WAIT,BROADBAND
      371   867  5B4 5203             C       3
      372   868  5B6 F10A             BEF     L1048
      373   869  5B8 E50201A0         RECV   WAIT,BROADBAND
      374   870  5BC 5204             C       4
      375   871  5BE F102             BEF     L1048
      376   872  5C0 06               RET
      377   873  5C1 9006     L1048   LD     =E$CRCERR               CRC error in input data (rcv)
      378   874  5C3 5119             ST      25
      379                     *
      380                     *E*        ERROR: KZM-E$CRCERR
      381                     *E*      MESSAGE: CRC error in input data
      382                     *E*  DESCRIPTION: The MLCPs computed CRC value does not match the
      383                     *E*               value in the received data block.
      384                     *
      385   875  5C5 E6005F           JUMP    L1150
      386   876  5C8 900A     L1055   LD     =KZ#MLCP_STX_ENQ
      387   877  5CA E60061           JUMP    L1157
      388   878  5CD 9000     L1060   LD     =0000
      389   879  5CF 5103             ST      03
      390   880  5D1 5104             ST      04
      391   881  5D3 E50201A0 L1072   RECV   WAIT,BROADBAND
      392   882  5D7 5118             ST      24
      393   883  5D9 9210             C      ='10'X
      394   884  5DB F11E             BEF     L1107
      395   885  5DD E50201A0         RECV   WAIT,BROADBAND
      396   886  5E1 5118             ST      24
      397   887  5E3 9232             C      ='32'X
      398   888  5E5 E1ED             BET     L1072
Elsie.D00  RCV - EBCDIC BSC receive CCP                                         WED JUL 30 '97 02:55 Page:16
      399   889  5E7 9226             C      ='26'X
      400   890  5E9 E124             BET     L1127
      401   891  5EB 9203             C      ='03'X
      402   892  5ED E120             BET    L1127
      403   893  5EF 9210             C      ='10'X
      404   894  5F1 E108             BET     L1107
      405   895  5F3 9007             LD     =E$BADTRNDLE            Illegal DLE in transparent block (rcv)
      406   896  5F5 5119             ST      25
      407                     *
      408                     *E*        ERROR: KZM-E$BADTRNDLE
      409                     *E*      MESSAGE: Illegal DLE sequence in transparent block
      410                     *E*  DESCRIPTION: A DLE sequence other that DLE-DLE, DLE-SYN or
      411                     *E*               DLE-ETB has been encountered in a transparent data
      412                     *E*               block.
      413                     *
      414   897  5F7 E6002D           JUMP    L1150
      415   898  5FA 04       L1107   CCH
      416   899  5FB E708             BVBT    L1117
      417   900  5FD 9008             LD     =E$TRNBLKEND            Can't store trans-block-end char (rcv)
      418                     *
      419                     *E*        ERROR: KZM-E$TRNBLKEND
      420                     *E*      MESSAGE: Can't store transparent-block-end character into FEP
      421                     *E*  DESCRIPTION: The MLCP has run out of room to store a transparent block
      422                     *E*               terminating character into FEP memory because the
      423                     *E*               value of BLKBYTES in the line profile is one
      424                     *E*               byte too small.
      425                     *
      426   901  5FF 5119             ST      25
      427   902  601 E60028           JUMP    L1155
      428   903  604 11       L1117   ST
      429   904  605 F3CD             BLCF    L1072
      430   905  607 9009             LD     =E$LSTTRNDAT            Trans data block truncated (rcv)
      431                     *
      432                     *E*        ERROR: KZM-E$LSTTRNDAT
      433                     *E*      MESSAGE: Transparent data block truncated
      434                     *E*  DESCRIPTION: Received transparent data has been lost because the
Elsie.D00  RCV - EBCDIC BSC receive CCP                                         WED JUL 30 '97 02:55 Page:17
      435                     *E*               value of BLKBYTES in the line profile is too small, i.e.,
      436                     *E*               no more input buffer space is available.
      437                     *
      438   906  609 5119             ST      25
      439   907  60B E60019           JUMP    L1150
      440   908  60E 11       L1127   ST
      441   909  60F 04               CCH
      442   910  610 F09F             BS      L1021
      443                     * ASC Receiver comes back to here sometimes.
      444   911  612 5010     L1130   LD      16
      445   912  614 93F9             AND    =0249
      446   913  616 9404             OR     =0004
      447   914  618 5110             ST      16
      448   915  61A 90FD5314 L1138   RESET  KW#CLACTR,=KW#CLACTR_RCVON@S
                     5114
      449   916  620 32               OUT    2
      450   917  621 02               GNB
      451   918  622 08               INTR
      452   919  623 E6FDB8           JUMP    L0564
      453                     * ASC Receiver comes back to here sometimes.
      454   920  626 9008     L1150   LD     =E$MLCP_RECOVERABLE_ERROR
      455   921  628 E60003           JUMP    L1157
      456   922  62B 9009     L1155   LD     =E$MLCP_UNRECOVERABLE_ERROR
      457   923  62D 511A     L1157   ST      26
      458   924  62F 5010             LD      16
      459   925  631 9406             OR     =0006
      460   926  633 5110             ST      16
      461   927  635 E0E4             B       L1138

Elsie.D00  TRN - EBCDIC BSC transmit CCP                                        WED JUL 30 '97 02:55 Page:18
      463                     * ASC Transmit comes back to here sometimes.
      464   929  637 5002     TRN     LD      02
      465   930  639 36               OUT    6
      466   931  63A 9032             LD     ='32'X
      467   932  63C 34               OUT    4
      468   933  63D 9045             LD     =KW#TRNSTT_CTS@S|KW#TRNSTT_UNDRUN@S|KW#TRNSTT_FIFO_NOTEMP@S
      469   934  63F E503             BART    BBS
      470   935  641 9040             LD     ='40'X
      471   936  643 512F     BBS     ST      47
      472   937  645 5038     L1169   LD      56
      473   938  647 920C             C      =KZ#SEND_NOTHING
      474   939  649 F115             BEF     L1192
      475   940  64B 90025414         SET    KW#CLACTR,=KW#CLACTR_RCVON@S
                     5114
      476   941  651 32               OUT    2
      477                     *
      478                     *    Because of added code to set 'SYNC' byte in RCVR, the
      479                     *    receive CCP is still sitting on a wait.  Kick the rcv
      480                     *    CCP off the wait with the following code:
      481                     *
      482   942  652 907F530E         RESET  KW#RCVSTT,=KW#RCVSTT_DSR@S
                     510E
      483   943  658 5002             LD      2
      484   944  65A 36               OUT    6
      485   945  65B 08               INTR
      486   946  65C 01               WAIT
      487   947  65D E0E7             B       L1169
      488   948  65F 90405414 L1192   SET    KW#CLACTR,=KW#CLACTR_RTS@S
                     5114
      489   949  665 32               OUT    2
      490   950  666 9000512E         ASSIGN KW#TRNSTT,=0
      491   951  66A 90905128         ASSIGN KW#TRNSCN,=KW#TRNSCN_SCNCTR@S|KW#TRNSCN_STRCCP@S
      492   952  66E 01       L1195   WAIT                 Wait for CTS before turning TRN on
      493   953  66F 502E9340         BRESET KW#TRNSTT,=KW#TRNSTT_CTS@S,L1195  B/CTS down
                     E2FA
      494   954  675 90805128 L1198   ASSIGN KW#TRNSCN,='80'X  Don't start CCP on scan change
Elsie.D00  TRN - EBCDIC BSC transmit CCP                                        WED JUL 30 '97 02:55 Page:19
      495   955  679 90015414         SET    KW#CLACTR,=KW#CLACTR_TRNON@S
                     5114
      496   956  67F 32               OUT    2
      497   957  680 5002             LD      2
      498   958  682 36               OUT    6
      499   959  683 503B             LD      59
      500   960  685 F203             BZF     L1246
      501   961  687 9001             LD     =0001
      502   962  689 513C     L1246   ST      60
      503   963  68B 9055             LD     ='55'X
      504   964  68D 31               OUT    1
      505   965  68E E502             BART    L1254
      506   966  690 01               WAIT
      507   967  691 503C     L1254   LD      60
      508   968  693 05               DEC
      509   969  694 F2F4             BZF     L1246
      510   970  696 5002             LD      2
      511   971  698 9306             AND    ='06'X
      512   972  69A E204             BZT     EBCTRN
      513   973  69C E60318           JUMP    ASCTRN
      514   974  69F 9032     EBCTRN  LD     ='32'X
      515   975  6A1 60E50201         SEND   WAIT,BROADBAND
      516   976  6A5 60E50201         SEND   WAIT,BROADBAND
      517   977  6A9 60E50201         SEND   WAIT,BROADBAND
      518   978  6AD 60E50201         SEND   WAIT,BROADBAND
      519   979  6B1 5038             LD      56
      520   980  6B3 563D     OOTLU   TLU     61
      521   981  6B5 E001             B       L1280
      522   982  6B7          SEND_0   TARGET  OOTLU
      523   983  6B7 E60083   L1280   JUMP    L1329
      524   984  6BB          SEND_BLOCK TARGET  OOTLU
      525   985  6BB 9026             LD     ='26'X        * Order 1   ETB block
      526   986  6BD 513A             ST      58
      527   987  6BF E6010B           JUMP    L1578
      528   988  6C3          SEND_TEXT TARGET  OOTLU
      529   989  6C3 9003             LD     ='03'X        * Order 2   ETX block
Elsie.D00  TRN - EBCDIC BSC transmit CCP                                        WED JUL 30 '97 02:55 Page:20
      530   990  6C5 513A             ST      58
      531   991  6C7 E60103           JUMP    L1578
      532   992  6CB          SEND_TBLOCK TARGET  OOTLU
      533   993  6CB 9026             LD     ='26'X        * Order 3   ETB block transparent
      534   994  6CD 513A             ST      58
      535   995  6CF E600D1           JUMP   L1530
      536   996  6D3          SEND_TTD TARGET  OOTLU
      537   997  6D3 9002             LD     ='02'X        * Order 4   STX-ENQ
      538   998  6D5 60E50201         SEND   WAIT,BROADBAND
      539   999  6D9 E60048           JUMP    L1427
      540  1000  6DD          SEND_WACK TARGET  OOTLU
      541  1001  6DD 9010             LD     ='10'X        * Order 5   DLE-WACK
      542  1002  6DF 60E50201         SEND   WAIT,BROADBAND
      543  1003  6E3 906B             LD     ='6B'X
      544  1004  6E5 E60114           JUMP    L1621
      545  1005  6E9          SEND_NAK TARGET  OOTLU
      546  1006  6E9 903D             LD     ='3D'X        * Order 6   NAK
      547  1007  6EB E6010E           JUMP    L1621
      548  1008  6EF          SEND_DLE_EOT TARGET  OOTLU
      549  1009  6EF 9010             LD     ='10'X        * Order 7   DLE-EOT
      550  1010  6F1 60E50201         SEND   WAIT,BROADBAND
      551  1011  6F5 E00B             B       L1350
      552  1012  6F7          SEND_SOH_ENQ TARGET  OOTLU
      553  1013  6F7 9001             LD     ='01'X        * Order 8   SOH-ENQ
      554  1014  6F9 60E50201         SEND   WAIT,BROADBAND
      555  1015  6FD E60024           JUMP    L1427
      556  1016  701          SEND_EOT TARGET  OOTLU
      557  1017  701 9037     L1350   LD     ='37'X        * Order 9   EOT
      558  1018  703 E600F6           JUMP    L1621
      559  1019  707          SEND_ACK0 TARGET  OOTLU
      560  1020  707 9010             LD     ='10'X        * Order 10  DLE-ACK0
      561  1021  709 60E50201         SEND   WAIT,BROADBAND
      562  1022  70D 9070             LD     ='70'X
      563  1023  70F E600EA           JUMP    L1621
      564  1024  713          SEND_ACK1 TARGET  OOTLU
      565  1025  713 9010             LD     ='10'X        * Order 11  DLE-ACK1
Elsie.D00  TRN - EBCDIC BSC transmit CCP                                        WED JUL 30 '97 02:55 Page:21
      566  1026  715 60E50201         SEND   WAIT,BROADBAND
      567  1027  719 9061             LD     ='61'X
      568  1028  71B E600DE           JUMP    L1621
      569  1029  71F          SEND_NOTHING TARGET  OOTLU
      570  1030  71F E600DE           JUMP    L1625        Order 12
      571  1031  723          SEND_ENQ TARGET  OOTLU
      572  1032  723 902D     L1427   LD     ='2D'X        * Order 13  ENQ
      573  1033  725 E600D4           JUMP    L1621
      574  1034  729          SEND_GEPOLL TARGET  OOTLU
      575  1035  729 E6001B           JUMP    L1433        Order 14
      576  1036  72D          SEND_SEPOLL TARGET  OOTLU
      577  1037  72D E60034           JUMP    L1470        Order 15
      578  1038  731          SEND_HDRDATA TARGET  OOTLU
      579  1039  731 E6013E           JUMP    L1696        Order 16
      580  1040  735          SEND_TTEXT TARGET  OOTLU
      581  1041  735 9003             LD     ='03'X        * Order 17  ETX block transparent
      582  1042  737 513A             ST     58
      583  1043  739 E60067           JUMP   L1530
      584                     * ASC Transmit comes back to here sometimes.
      585  1044  73C 900A     L1329   LD     =E$BADTRNORD            Unknown transmit order (xmit)
      586  1045  73E 5139             ST      57
      587                     *
      588                     *E*        ERROR: KZM-E$BADTRNORD
      589                     *E*      MESSAGE: Unknown transmit order
      590                     *E*  DESCRIPTION: The MLCP has detected a bad value in LCT 56.  This
      591                     *E*               LCT is stored into by the main FEP memory program
      592                     *E*               with a transmit order code.
      593                     *
      594  1046  740 E60101           JUMP    WINDUP
      595  1047  743 E60087           JUMP    L1578
      596  1048  746 10       L1433   LD                   /* Order 14  EOT-p-p-7F-7F-ENQ */
      597  1049  747 513C             ST      60
      598  1050  749 F301             BLCF    L1446
      599  1051  74B F02F     L1446   BS      L1494
      600  1052  74D 503C             LD      60
      601  1053  74F 60E50201         SEND   WAIT,BROADBAND
Elsie.D00  TRN - EBCDIC BSC transmit CCP                                        WED JUL 30 '97 02:55 Page:22
      602  1054  753 60E50201         SEND   WAIT,BROADBAND
      603  1055  757 907F             LD     ='7F'X
      604  1056  759 60E50201         SEND   WAIT,BROADBAND
      605  1057  75D 60E50201         SEND   WAIT,BROADBAND
      606  1058  761 E0C1             B       L1427
      607  1059  763 F017     L1470   BS      L1494        * Order 15  EOT-s-s-s-s-ENQ
      608  1060  765 10               LD
      609  1061  766 60E50201         SEND   WAIT,BROADBAND
      610  1062  76A 60E50201         SEND   WAIT,BROADBAND
      611  1063  76E E302             BLCT    L1484
      612  1064  770 10               LD
      613  1065  771 60E50201 L1484   SEND   WAIT,BROADBAND
      614  1066  775 60E50201         SEND   WAIT,BROADBAND
      615  1067  779 E0A9             B       L1427
      616  1068  77B 9037     L1494   LD     ='37'X
      617  1069  77D 60E50201         SEND   WAIT,BROADBAND
      618  1070  781 90FF             LD     ='FF'X
      619  1071  783 60E50201         SEND   WAIT,BROADBAND
      620  1072  787 60E50201         SEND   WAIT,BROADBAND
      621  1073  78B 60E50201         SEND   WAIT,BROADBAND
      622  1074  78F 9032             LD     ='32'X
      623  1075  791 60E50201         SEND   WAIT,BROADBAND
      624  1076  795 60E50201         SEND   WAIT,BROADBAND
      625  1077  799 60E50201         SEND   WAIT,BROADBAND
      626  1078  79D 60E50201         SEND   WAIT,BROADBAND
      627  1079  7A1 06               RET
      628  1080  7A2 9010     L1530   LD     ='10'X        * Order 3,17 ETB,ETX block transparent
      629  1081  7A4 60E50201         SEND   WAIT,BROADBAND
      630  1082  7A8 9002             LD     ='02'X
      631  1083  7AA 60E50201         SEND   WAIT,BROADBAND
      632  1084  7AE 9000             LD     =0000
      633  1085  7B0 5123             ST      35
      634  1086  7B2 5124             ST      36
      635  1087  7B4 10       L1545   LD
      636  1088  7B5 9210             C      ='10'X
      637  1089  7B7 F105             BEF     L1552
Elsie.D00  TRN - EBCDIC BSC transmit CCP                                        WED JUL 30 '97 02:55 Page:23
      638  1090  7B9 60E50201         SEND   WAIT,BROADBAND
      639  1091  7BD 61E50201 L1552   SEND    CRC,WAIT,BROADBAND
      640  1092  7C1 F3F2             BLCF    L1545
      641  1093  7C3 9010             LD     ='10'X
      642  1094  7C5 60E50201         SEND   WAIT,BROADBAND
      643  1095  7C9 E60022           JUMP    L1607
      644  1096  7CC 9002     L1578   LD     ='02'X        * Order 1,2 ETB,ETX block non-transparent
      645  1097  7CE 60E50201         SEND   WAIT,BROADBAND
      646  1098  7D2 9000             LD     =0000
      647  1099  7D4 5123             ST      35
      648  1100  7D6 5124             ST      36
      649  1101  7D8 10       L1592   LD
      650  1102  7D9 9232             C      ='32'X
      651  1103  7DB F107             BEF    L1598
      652  1104  7DD 60E50201         SEND   WAIT,BROADBAND
      653  1105  7E1 E009             B      L1605
      654  1106  7E3 61E50201 L1598   SEND   CRC,WAIT,BROADBAND
      655  1107  7E7 921F             C      ='1F'X
      656  1108  7E9 E166             BET     L1664
      657  1109  7EB F3EC     L1605   BLCF    L1592
      658  1110  7ED 503A     L1607   LD      58
      659  1111  7EF 61E50201         SEND    CRC,WAIT,BROADBAND
      660  1112  7F3 5023             LD      35
      661  1113  7F5 60E50201         SEND   WAIT,BROADBAND
      662  1114  7F9 5024             LD      36
      663  1115  7FB 60E50201 L1621   SEND   WAIT,BROADBAND
      664  1116  7FF 90025414 L1625   SET    KW#CLACTR,=KW#CLACTR_RCVON@S
                     5114
      665  1117  805 32               OUT    2
      666  1118  806 5002             LD      2
      667  1119  808 36               OUT    6
      668  1120  809 90FF             LD     ='FF'X
      669  1121  80B 60E50201         SEND   WAIT,BROADBAND
      670  1122  80F 60E50201         SEND   WAIT,BROADBAND
      671  1123  813 60E50201         SEND   WAIT,BROADBAND
      672                     * ASC Transmit comes back to here sometimes.
Elsie.D00  TRN - EBCDIC BSC transmit CCP                                        WED JUL 30 '97 02:55 Page:24
      673  1124  817 502F     CHKBBS  LD      47           See if we're speaking BBS
      674  1125  819 9301             AND    ='01'X
      675  1126  81B E227             BZT     WINDUP
      676                     *
      677                     *   Turn on SCNCTR for data set status change, turn off transmitter
      678                     *   and wait for interrupt before proceding to windup code.
      679                     *
      680  1127  81D 9090             LD     ='90'X        SCNCTR on, STRCCP on
      681  1128  81F 5128             ST      40
      682  1129  821 5014             LD      20
      683  1130  823 93FE             AND    ='FE'X
      684  1131  825 5114             ST      20           TRANSMIT off
      685  1132  827 32               OUT     2
      686  1133  828 25               IN      5            Get LR5 and LCT .2E (status) in sync
      687  1134  829 512E             ST      KW#TRNSTT
      688  1135  82B E002             B       NOTEMP1
      689  1136  82D 01       NOTEMP  WAIT
      690  1137  82E 502E9301 NOTEMP1 BSET    KW#TRNSTT_UNDRUN,;
                     F20C
      691                                    =KW#TRNSTT_UNDRUN@S,Y$BBSDON  B/UNDER-RUN - DONE
      692  1138  834 20               IN      0            L/adapter type if MLC-16
      693  1139  835 9248             C       ='48'X       MLC-16 broadband adapter
      694  1140  837 F1F5             BNE     NOTEMP       B/not MLC-16
      695  1141  839 502E9304         BSET    KW#TRNSTT_FIFO_NOTEMP,;
                     F2EF
      696                                    =KW#TRNSTT_FIFO_NOTEMP@S,NOTEMP  B/FIFO NOT EMPTY - NOT DONE
      697  1142  83F 9080     Y$BBSDON ;
      698                             LD     ='80'X
      699  1143  841 5128             ST      40           SCNCTR off, STRCCP off
      700  1144  843 90BE5314 WINDUP  RESET  KW#CLACTR,=KW#CLACTR_RTS@S|KW#CLACTR_TRNON@S
                     5114
      701  1145  849 32               OUT    2
      702  1146  84A 02               GNB
      703  1147  84B 08               INTR
      704  1148  84C 01               WAIT
      705  1149  84D E6FDF6           JUMP    L1169
Elsie.D00  TRN - EBCDIC BSC transmit CCP                                        WED JUL 30 '97 02:55 Page:25
      706                     *
      707                     *  Sending a non-transparent IUS, must follow with checksum,
      708                     *  clear checksum, and send checksummed STX.
      709                     *
      710  1150  850 5023     L1664   LD      35
      711  1151  852 60E50201         SEND   WAIT,BROADBAND
      712  1152  856 5024             LD      36
      713  1153  858 60E50201         SEND   WAIT,BROADBAND
      714  1154  85C 9032             LD     ='32'X
      715  1155  85E 60E50201         SEND   WAIT,BROADBAND
      716  1156  862 60E50201         SEND   WAIT,BROADBAND
      717  1157  866 9000             LD     =0000         Start with fresh CRC after IUS.
      718  1158  868 5123             ST      35
      719  1159  86A 5124             ST      36
      720  1160  86C 9002             LD    ='02'X
      721  1161  86E E6FF73           JUMP    L1598
      722  1162  871 10       L1696   LD
      723  1163  872 513F             ST      63
      724  1164  874 9001             LD     ='01'X EBCDIC_SOH_CHAR
      725  1165  876 60E50201         SEND   WAIT,BROADBAND
      726  1166  87A 10       L1705   LD
      727  1167  87B 60E50201         SEND   WAIT,BROADBAND
      728  1168  87F 503F             LD      63
      729  1169  881 05               DEC
      730  1170  882 E205             BZT     L1719
      731  1171  884 513F             ST      63
      732  1172  886 E0F3             B       L1705
      733  1173  888 9003     L1719   LD     ='03'X
      734  1174  88A 513A             ST      58
      735  1175  88C E6FF3E           JUMP    L1578
      736  1176  88F 00               NOP

Elsie.D00  ASCRCV - Polled VIP stuff for the receiver                           WED JUL 30 '97 02:55 Page:26
      738  1178  890          ASCRCV  LABEL
      739  1179  890 25               IN      5
      740  1180  891 510E             ST      14                  Copy data set status
      741  1181  893 5008             LD      8
      742  1182  895 9410             OR     ='10'X
      743  1183  897 5108             ST      8                   Wakeup if data set status change
      744  1184  899 01               WAIT
      745  1185  89A 5008             LD      8
      746  1186  89C 93EF             AND    ='EF'X
      747  1187  89E 5108             ST      8                   Handshaking is complete
      748  1188  8A0 5014             LD      20
      749  1189  8A2 93FD             AND    ='FD'X
      750  1190  8A4 5114             ST      20
      751  1191  8A6 32               OUT     2                   Receiver off
      752  1192  8A7 9016             LD     ='16'X
      753  1193  8A9 34               OUT     4                   ASCII SYN
      754  1194  8AA 5002             LD      2
      755  1195  8AC 36               OUT     6
      756  1196  8AD 5014             LD      20
      757  1197  8AF 9402             OR     ='02'X
      758  1198  8B1 5114             ST      20
      759  1199  8B3 32               OUT     2                   Receiver on
      760  1200  8B4 01       WAIT_FOR_SYNC ;
      761                             WAIT
      762  1201  8B5 A0               RECV
      763  1202  8B6 01               WAIT
      764  1203  8B7 A0               RECV
      765  1204  8B8 9216             C      ='16'X
      766  1205  8BA E104             BET     ASCII_SYNS_DETECT
      767  1206  8BC 03       GET_SYNCED_RETRY ;
      768                             SFS
      769  1207  8BD E0F6             B       WAIT_FOR_SYNC
      770  1208  8BF 9003     ASCII_SYNS_DETECT ;
      771                             LD     ='03'X
      772  1209  8C1 5117             ST      23
      773  1210  8C3 9000             LD     =0
Elsie.D00  ASCRCV - Polled VIP stuff for the receiver                           WED JUL 30 '97 02:55 Page:27
      774  1211  8C5 5119             ST      25
      775  1212  8C7 511A             ST      26
      776  1213  8C9 01       HIP_CONTROL_CHAR ;
      777                             WAIT
      778  1214  8CA A0               RECV
      779  1215  8CB 9216             C      ='16'X
      780  1216  8CD E1FB             BET     HIP_CONTROL_CHAR
      781  1217  8CF 5118             ST      24                  Save in LATEST_RECEIVED_CHAR
      782  1218  8D1 9204             C      ='04'X               ASCII EOT?
      783  1219  8D3 E123             BET     ASCII_NULL_MSG
      784  1220  8D5 9201             C      ='01'X               ASCII SOH?
      785  1221  8D7 E13C             BET     ASC_HEAD_SOH_RCVD
      786                     *
      787                     *       Error: Message did not begin with SOH
      788                     *
      789                     *       Store a small, empty message into memory,
      790                     *       then go back and get resynced.
      791                     *
      792  1222  8D9 9080             LD     ='80'X
      793  1223  8DB F06F             BS      ASCII_STORE
      794  1224  8DD F06D             BS      ASCII_STORE
      795  1225  8DF F06B             BS      ASCII_STORE
      796  1226  8E1 F069             BS      ASCII_STORE
      797  1227  8E3 9002     STORE_STX_ERR ;
      798                             LD     ='02'X
      799  1228  8E5 F065             BS      ASCII_STORE
      800  1229  8E7 9083             LD     ='83'X
      801  1230  8E9 F061             BS      ASCII_STORE
      802  1231  8EB 90FF             LD     ='FF'X
      803  1232  8ED F05D             BS      ASCII_STORE
      804  1233  8EF 9040             LD     ='40'X               CRC/PARITY error
      805  1234  8F1 5411             OR      17
      806  1235  8F3 5111             ST      17
      807  1236  8F5 E0C6             B       GET_SYNCED_RETRY
      808  1237  8F7 503F     ASCII_NULL_MSG ;
      809                             LD      63
Elsie.D00  ASCRCV - Polled VIP stuff for the receiver                           WED JUL 30 '97 02:55 Page:28
      810  1238  8F9 F204             BZF     KICK_XMIT
      811  1239  8FB E600A5           JUMP    ASCII_MSG_END
      812  1240  8FE 9000     KICK_XMIT ;
      813                             LD     =0000
      814  1241  900 5124             ST      36
      815  1242  902 5028             LD      40
      816  1243  904 9490             OR     ='90'X
      817  1244  906 5128             ST      40                  Fix things so the CTS starts XMIT
      818  1245  908 5014             LD      20
      819  1246  90A 93FD             AND    ='FD'X               Receiver off
      820  1247  90C 9440             OR     ='40'X               RTS up
      821  1248  90E 5114             ST      20
      822  1249  910 32               OUT     2
      823  1250  911 E6FAC3           JUMP    KZM$RCVRST
      824                     *
      825                     *       SYN,SOH - Parse rest of block
      826                     *
      827  1251  914 F02C     ASC_HEAD_SOH_RCVD ;
      828                             BS      HIPIN
      829  1252  916 9204             C      ='04'X
      830  1253  918 E1DE             BET     ASCII_NULL_MSG
      831  1254  91A 9000     NEW_HIP_FRAG ;
      832                             LD     =0000
      833  1255  91C 5103             ST      3
      834  1256  91E 5104             ST      4
      835  1257  920 5018             LD      24
      836  1258  922 04               CCH
      837  1259  923 F027             BS      ASCII_STORE         Adr byte
      838  1260  925 F01B             BS      HIPIN
      839  1261  927 F023             BS      ASCII_STORE         Sta byte
      840  1262  929 F017             BS      HIPIN
      841  1263  92B 9202             C      ='02'X
      842  1264  92D E128             BET     STORE_2_$80
      843  1265  92F F01B             BS      ASCII_STORE         FC1 char
      844  1266  931 F00F             BS      HIPIN
      845  1267  933 9202             C      ='02'X
Elsie.D00  ASCRCV - Polled VIP stuff for the receiver                           WED JUL 30 '97 02:55 Page:29
      846  1268  935 E124             BET     STORE_1_$80
      847  1269  937 F013             BS      ASCII_STORE         FC2 char
      848  1270  939 F007             BS      HIPIN
      849  1271  93B 9202             C      ='02'X
      850  1272  93D E120             BET     PUT_ASCII_CHR
      851  1273  93F E0A3             B       STORE_STX_ERR
      852                     *
      853                     *       HIPIN - Read character(with parity), ignore SYN, CRC
      854                     *
      855  1274  941 01       HIPIN   WAIT
      856  1275  942 A2               RECV    PARITY
      857  1276  943 9216             C       ='16'X
      858  1277  945 E1FB             BET     HIPIN
      859  1278  947 5118             ST      24
      860  1279  949 04               CCH
      861  1280  94A 06               RET
      862                     *
      863                     *       ASCII_STORE - Store character with check on parity
      864                     *
      865  1281  94B 11       ASCII_STORE ;
      866                             ST
      867  1282  94B          ASCII_STORE_NP ;
      868                             EQU     ASCII_STORE
      869  1283  94C F308             BLCF    HIP_BLOCK_CONTINUES
      870  1284  94E 900B             LD     =E$ASCRCV11             Undocumented (VIP rcv)
      871  1285  950 5119             ST      25
      872  1286  952 E6FCD2           JUMP    L1150
      873  1287  955 06       HIP_BLOCK_CONTINUES ;
      874                             RET
      875  1288  956 9080     STORE_2_$80 ;
      876                             LD     ='80'X
      877  1289  958 F0F2             BS      ASCII_STORE
      878  1290  95A 9080     STORE_1_$80 ;
      879                             LD     ='80'X
      880  1291  95C F0EE             BS      ASCII_STORE
      881  1292  95E 5018     PUT_ASCII_CHR ;
Elsie.D00  ASCRCV - Polled VIP stuff for the receiver                           WED JUL 30 '97 02:55 Page:30
      882                             LD      24
      883  1293  960 F0EA             BS      ASCII_STORE
      884  1294  962 F0DE             BS      HIPIN
      885  1295  964 9283             C      ='83'X
      886  1296  966 E105             BET     ETX_OR_ETB_END
      887  1297  968 9297             C      ='97'X
      888  1298  96A F1F3             BEF     PUT_ASCII_CHR
      889  1299  96C F0DE     ETX_OR_ETB_END ;
      890                             BS      ASCII_STORE
      891  1300  96E 01               WAIT
      892  1301  96F A2               RECV    PARITY
      893  1302  970 937F             AND    ='7F'X
      894  1303  972 5118             ST      24
      895  1304  974 5003             LD      3
      896  1305  976 937F             AND    ='7F'X
      897  1306  978 5218             C       24
      898  1307  97A E109             BET     NO_ASCII_CRC_ERR
      899  1308  97C 9040             LD     ='40'X
      900  1309  97E 5411             OR      17
      901  1310  980 5111             ST      17
      902  1311  982 5119             ST      25
      903  1312  984 5011     NO_ASCII_CRC_ERR ;
      904                             LD      17
      905  1313  986 F0C4             BS      ASCII_STORE_NP
      906  1314  988 9000             LD     =0
      907  1315  98A 5119             ST      25
      908  1316  98C F0B4             BS      HIPIN
      909  1317  98E 5118             ST      24
      910  1318  990 9204             C      ='04'X
      911  1319  992 E10F             BET     ASCII_MSG_END
      912  1320  994 9201             C      ='01'X
      913  1321  996 F104             BEF     MALFORM_FRAG
      914  1322  998 E6FF7A           JUMP    ASC_HEAD_SOH_RCVD
      915                     *
      916                     *   Message fragment didn't begin with SOH, error
      917                     *
Elsie.D00  ASCRCV - Polled VIP stuff for the receiver                           WED JUL 30 '97 02:55 Page:31
      918  1323  99B 900C     MALFORM_FRAG ;
      919                             LD     =E$BADFRAG              Message didn't begin with SOH (VIP rcv)
      920  1324  99D 5119             ST      25
      921                     *
      922                     *E*        ERROR: KZM-E$BADFRAG
      923                     *E*      MESSAGE: Incoming msg fragment did not begin with SOH
      924                     *E*  DESCRIPTION: Incoming message fragments must begin with SOH.
      925                     *
      926  1325  99F E6FC85           JUMP    L1150
      927                     *
      928  1326  9A2 9004     ASCII_MSG_END ;
      929                             LD     ='04'X
      930  1327  9A4 F0A6             BS      ASCII_STORE
      931  1328  9A6 5011             LD      17
      932  1329  9A8 9340             AND    ='40'X
      933  1330  9AA F204             BZF     PARITY_ERROR_IN_BLOCK
      934  1331  9AC E6FC64           JUMP    L1130
      935  1332  9AF 900D     PARITY_ERROR_IN_BLOCK ;
      936                             LD     =E$ASCRCV13             Something about parity errors (VIP rcv)
      937  1333  9B1 5119             ST      25
      938  1334  9B3 E6FC71           JUMP    L1150

Elsie.D00  ASCTRN - Polled VIP stuff for the transmitter                        WED JUL 30 '97 02:55 Page:32
      940  1336  9B6          ASCTRN  LABEL
      941  1337  9B6 5028             LD      40
      942  1338  9B8 93EF             AND    ='EF'X
      943  1339  9BA 5128             ST      40
      944  1340  9BC 9016             LD     ='16'X
      945  1341  9BE 34               OUT     4
      946  1342  9BF 9000             LD     =0
      947  1343  9C1 513F             ST      63
      948  1344  9C3 5038             LD      56
      949  1345  9C5 9201             C      =KZ#SEND_BLOCK
      950  1346  9C7 E127             BET     ASCII_BLOCK_OUT
      951  1347  9C9 920F             C      =KZ#SEND_SEPOLL
      952  1348  9CB E10E             BET     JASCPOLL
      953  1349  9CD 9206             C      =KZ#SEND_NAK
      954  1350  9CF E119             BET     JASCNAK
      955  1351  9D1 920E             C      =KZ#SEND_GEPOLL
      956  1352  9D3 F118             BEF     JBADORD
      957  1353  9D5 900F             LD     =KZ#SEND_SEPOLL
      958  1354  9D7 5138             ST      56                  Make new transmit order code
      959  1355  9D9 08               INTR
      960  1356  9DA E6008E   JASCPOLL ;
      961                             JUMP    ASCII_POLL_LIST
      962  1357  9DD 00               NOP
      963  1358  9DE 00               NOP
      964  1359  9DF 00               NOP
      965  1360  9E0 00               NOP
      966  1361  9E1 00               NOP
      967  1362  9E2 00               NOP
      968  1363  9E3 00               NOP
      969  1364  9E4 00               NOP
      970  1365  9E5 00               NOP
      971  1366  9E6 00               NOP
      972  1367  9E7 00               NOP
      973  1368  9E8 00               NOP
      974  1369  9E9 E600C5   JASCNAK JUMP    ASCII_SEND_NAK
      975  1370  9EC E6FD4E   JBADORD JUMP    L1329
Elsie.D00  ASCTRN - Polled VIP stuff for the transmitter                        WED JUL 30 '97 02:55 Page:33
      976  1371  9EF 9016     ASCII_BLOCK_OUT ;
      977                             LD     ='16'X
      978  1372  9F1 60               SEND
      979  1373  9F2 01               WAIT
      980  1374  9F3 60               SEND
      981  1375  9F4 01               WAIT
      982  1376  9F5 60               SEND
      983  1377  9F6 01               WAIT
      984  1378  9F7 60               SEND
      985  1379  9F8 01               WAIT
      986  1380  9F9 9001             LD     ='01'X
      987  1381  9FB 60               SEND
      988  1382  9FC 01               WAIT
      989  1383  9FD 9000             LD     =0
      990  1384  9FF 5123             ST      35
      991  1385  A01 5124             ST      36
      992  1386  A03 F71B     ASCII_NEXTCH_OUT ;
      993                             BVBF    NO_ASCII_CCB
      994  1387  A05 10               LD
      995  1388  A06 937F             AND    ='7F'X
      996  1389  A08 63               SEND    PARITY,CRC
      997  1390  A09 01               WAIT
      998  1391  A0A 9203             C      ='03'X
      999  1392  A0C F1F6             BEF     ASCII_NEXTCH_OUT
     1000  1393  A0E 5023             LD      35
     1001  1394  A10 937F             AND    ='7F'X
     1002  1395  A12 62               SEND    PARITY
     1003  1396  A13 01               WAIT
     1004  1397  A14 E320             BLCT    ASCII_TURNOVER_WITH_INT
     1005  1398  A16 E0D8             B       ASCII_BLOCK_OUT
     1006                     *
     1007  1399  A18 900E     NO_ASCII_ETX_TRAIL ;
     1008                             LD     =E$NOHIPETX             Block didn't end with ETX (VIP xmit)
     1009  1400  A1A 5139             ST      57
     1010                     *
     1011                     *E*        ERROR: KZM-E$NOHIPETX
Elsie.D00  ASCTRN - Polled VIP stuff for the transmitter                        WED JUL 30 '97 02:55 Page:34
     1012                     *E*      MESSAGE: Block did not end with ETX character
     1013                     *E*  DESCRIPTION: Message blocks must consist
     1014                     *E*               of message fragments followed by an ASCII ETX.
     1015                     *E*               The last message fragment was not terminated by an
     1016                     *E*               ETX character.
     1017                     *
     1018  1401  A1C E6FDF9           JUMP    CHKBBS
     1019                     *
     1020  1402  A1F 900F     NO_ASCII_CCB ;
     1021                             LD     =E$NOHIPCCB             No valid CCB (VIP xmit)
     1022  1403  A21 5139             ST      57
     1023                     *
     1024                     *E*        ERROR: KZM-E$NOHIPCCB
     1025                     *E*      MESSAGE: There is no valid CCB framing a msg to send
     1026                     *E*  DESCRIPTION: The mlcp must send blocks of memory from the L6 consisting
     1027                     *E*               of message fragments followed by an ASCII ETX.
     1028                     *E*               The last message fragment was not terminated by an
     1029                     *E*               ETX character.
     1030                     *
     1031  1404  A23 E6FDF2           JUMP    CHKBBS
     1032                     *
     1033  1405  A26 10       LAST_ASCII_BLOCK_CHAR ;
     1034                             LD
     1035  1406  A27 937F             AND    ='7F'X
     1036  1407  A29 9203             C      ='03'X
     1037  1408  A2B F1EC             BEF     NO_ASCII_ETX_TRAIL
     1038  1409  A2D 62               SEND    PARITY
     1039  1410  A2E 01               WAIT
     1040  1411  A2F 5023             LD      35
     1041  1412  A31 937F             AND    ='7F'X
     1042  1413  A33 62               SEND    PARITY
     1043  1414  A34 01               WAIT
     1044  1415  A35 9000     ASCII_TURNOVER_WITH_INT ;
     1045                             LD     =0
     1046  1416  A37 5139             ST      57
     1047  1417  A39 08               INT
Elsie.D00  ASCTRN - Polled VIP stuff for the transmitter                        WED JUL 30 '97 02:55 Page:35
     1048                     *
     1049                     *   Turnover - Send EOT, 4 pads, turn off TRN, turn on RCV, wait.
     1050                     *
     1051  1418  A3A 9016     ASCII_TURNOVER ;
     1052                             LD     ='16'X
     1053  1419  A3C 60               SEND
     1054  1420  A3D 01               WAIT
     1055  1421  A3E 60               SEND
     1056  1422  A3F 01               WAIT
     1057  1423  A40 60               SEND
     1058  1424  A41 01               WAIT
     1059  1425  A42 60               SEND
     1060  1426  A43 01               WAIT
     1061  1427  A44 9004             LD     ='04'X
     1062  1428  A46 60               SEND
     1063  1429  A47 01               WAIT
     1064  1430  A48 5014             LD      20
     1065  1431  A4A 9402             OR     ='02'X
     1066  1432  A4C 5114             ST      20
     1067  1433  A4E 32               OUT     2
     1068  1434  A4F 90FF             LD     ='FF'X
     1069  1435  A51 60               SEND
     1070  1436  A52 01               WAIT
     1071  1437  A53 60               SEND
     1072  1438  A54 01               WAIT
     1073  1439  A55 60               SEND
     1074  1440  A56 01               WAIT
     1075  1441  A57 60               SEND
     1076  1442  A58 01               WAIT
     1077  1443  A59 5014             LD      20
     1078  1444  A5B 93BE             AND    ='BE'X
     1079  1445  A5D 5114             ST      20
     1080  1446  A5F 32               OUT     2
     1081                     *
     1082                     *   Because of added code to set the SYN char in the RCV CCP, the
     1083                     *   RCV CCP is sitting on a wait.  Kick the RCV CCP off the wait with
Elsie.D00  ASCTRN - Polled VIP stuff for the transmitter                        WED JUL 30 '97 02:55 Page:36
     1084                     *   the following code:
     1085                     *
     1086  1447  A60 500E             LD      14
     1087  1448  A62 937F             AND    ='7F'X
     1088  1449  A64 510E             ST      14
     1089                     *
     1090                     *   Have the TRN CCP fall off the wait when RTS is turned on.
     1091                     *
     1092  1450  A66 01               WAIT
     1093  1451  A67 E6FBCE           JUMP    TRN
     1094                     *
     1095                     *       The CCB's frame a circular poll No.  Pluck out an address byte
     1096                     *       frame and send a poll, RCV CCP will wake me up if null
     1097                     *       response.  RCVR will interrupt L6 if non-null response.
     1098                     *
     1099  1452  A6A F7B4     ASCII_POLL_LIST ;
     1100                             BVBF    NO_ASCII_CCB
     1101  1453  A6C 9000             LD     =0
     1102  1454  A6E 513F             ST      63
     1103  1455  A70 10               LD
     1104  1456  A71 931F             AND    ='1F'X
     1105  1457  A73 9420             OR     ='20'X
     1106  1458  A75 513C             ST      60
     1107  1459  A77 E305             BLCT    POLL_CONT_3
     1108  1460  A79 9001             LD     ='01'X
     1109  1461  A7B 513F             ST      63
     1110  1462  A7D F003     POLL_CONT_3 ;
     1111                             BS      ASCII_MSG_WITH_NUL
     1112  1463  A7F E0BA             B       ASCII_TURNOVER
     1113  1464  A81 9080     ASCII_MSG_WITH_NUL ;
     1114                             LD     ='80'X
     1115  1465  A83 5139             ST      57
     1116  1466  A85 9016     ASCII_MSG_OUT ;
     1117                             LD     ='16'X
     1118  1467  A87 60               SEND
     1119  1468  A88 01               WAIT
Elsie.D00  ASCTRN - Polled VIP stuff for the transmitter                        WED JUL 30 '97 02:55 Page:37
     1120  1469  A89 60               SEND
     1121  1470  A8A 01               WAIT
     1122  1471  A8B 60               SEND
     1123  1472  A8C 01               WAIT
     1124  1473  A8D 60               SEND
     1125  1474  A8E 01               WAIT
     1126  1475  A8F 9001             LD     ='01'X
     1127  1476  A91 60               SEND
     1128  1477  A92 01               WAIT
     1129  1478  A93 9000             LD     =0000
     1130  1479  A95 5123             ST      35
     1131  1480  A97 5124             ST      36
     1132  1481  A99 503C             LD      60
     1133  1482  A9B 63               SEND    PARITY,CRC
     1134  1483  A9C 01               WAIT
     1135  1484  A9D 5039             LD      57
     1136  1485  A9F 63               SEND    PARITY,CRC
     1137  1486  AA0 01               WAIT
     1138  1487  AA1 9002             LD     ='02'X
     1139  1488  AA3 63               SEND    PARITY,CRC
     1140  1489  AA4 01               WAIT
     1141  1490  AA5 9083             LD     ='83'X
     1142  1491  AA7 63               SEND    PARITY,CRC
     1143  1492  AA8 01               WAIT
     1144  1493  AA9 5023             LD      35
     1145  1494  AAB 937F             AND    ='7F'X
     1146  1495  AAD 62               SEND    PARITY
     1147  1496  AAE 01               WAIT
     1148  1497  AAF 06               RET
     1149                     *
     1150                     *   A NAK is to be sent.
     1151                     *
     1152                     *   The single byte framed by the CCB forms the SELECT/POLL address.
     1153                     *
     1154  1498  AB0 10       ASCII_SEND_NAK ;
     1155                             LD
Elsie.D00  ASCTRN - Polled VIP stuff for the transmitter                        WED JUL 30 '97 02:55 Page:38
     1156  1499  AB1 931F             AND    ='1F'X
     1157  1500  AB3 9440             OR     ='40'X
     1158  1501  AB5 513C             ST      60
     1159  1502  AB7 9015             LD     ='15'X
     1160  1503  AB9 5139             ST      57
     1161  1504  ABB F0C9             BS      ASCII_MSG_OUT
     1162  1505  ABD 503C             LD      60
     1163  1506  ABF 931F             AND    ='1F'X
     1164  1507  AC1 9420             OR     ='20'X
     1165  1508  AC3 513C             ST      60
     1166  1509  AC5 F0BB             BS      ASCII_MSG_WITH_NUL
     1167  1510  AC7 E6FF6C           JUMP    ASCII_TURNOVER_WITH_INT
     1168  1511  ACA 9000             LD     =0
     1169  1512  ACC 5139             ST      57
     1170  1513                       END
 LC0-00001-0              No Errors in this assembly.
