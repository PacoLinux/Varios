VERSION E05

PL6.E3A0      #001=KIN$SEND File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:33 Page:1    
        1        1        /*M* KIN$NETWORK - Network procedures on the host            */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* PLM=3,IND=5,ENU=0,ECU=0  */
        8        8
        9        9        /*F* NAME: Host_Network_Services
       10       10
       11       11        KIN$NETWORK contains the network functions for the Host. It
       12       12        interfaces to KIQ (Host to Frontend Interface), KIS (Session),
       13       13        and KIT (Transport).
       14       14
       15       15        The KIN$NETWORK file contains the following modules:
       16       16
       17       17        .fif
       18       18        }  KIN$SEND - forward message to local fep
       19       19        }  KIN$RECV - entered from KIQ$ISCAN to forward message to user
       20       20        }           - also entered from KIQ$FEINT and KIQ$FEABT for network
       21       21        }             management functions.
       22       22        }  KIN$NODECHG - entered from KUB$EA to process a KL_SETNODE message.
       23       23        }  KIN$CONV_NODENAME - Misc routines for accessing data in the route table
       24       24        .fin
       25       25        */
       26       26
       27       27        %EJECT;
PL6.E3A0      #001=KIN$SEND File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:33 Page:2    
       28       28        /*F* NAME: KIN$SEND Outbound Messages
       29       29
       30       30        This routine is called from KIS$SEND or KIT$SEND.
       31       31        It is called with the single parameter K$RWPARM.
       32       32
       33       33        KIN$SEND simply builds a network header setting the source address to
       34       34        K_NODE# +1, and setting the the destination address to the value passed
       35       35        in K$RWPARM.FEX +1.
       36       36
       37       37        The network header address and size in K$RWPARM are updated to
       38       38        reference this header, and KIN$SEND calls KIQ$QLINK.
       39       39        The function passed to KIQ$QLINK is from K$RWPARM.FUNCTION.
       40       40        */
       41       41
       42       42        KIN$SEND: PROC (K$RWPARM) ALTRET;
       43       43
       44       44        %INCLUDE K$RWPARM;
       45      430        %INCLUDE K_QDPHDRS_M;
       46     1312        %INCLUDE KI_MACROS_C;
       47     1920        %INCLUDE NK$LDCT;
       48     2022        %INCLUDE KI_DATA_R;
       49     2048        %INCLUDE K_ADDRESS_M;
       50     2551        %INCLUDE KNN_NETWORK_M;
       51     2914        %INCLUDE K_SUBS_C;
       52     2947        %INCLUDE KI_ERRORS_C;                   /* because now we do errors too*/
       53     3032        %INCLUDE K_INTERFACE_M;
       54     3441        %INCLUDE CP_6;
       55     9000
       56     9001                                                /* Parameters                         */
       57     9002        %K$RWPARM (NAME=K$RWPARM);
       58     9318                                                /* Entry references                   */
       59     9319    1   DCL KIQ$LINK ENTRY(2) ALTRET;
       60     9320                                                /* Auto                               */
       61     9321        %K$NQDP_HDR (NAME=NWK_HDR, STCLASS=AUTO);
       62     9398    1   DCL FEI# UBIN;
       63     9399    1   DCL FEI$ PTR;
       64     9400    1   DCL ROUTE$ PTR;
PL6.E3A0      #001=KIN$SEND File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:33 Page:3    
       65     9401    1   DCL NHDRINDX UBIN;
       66     9402    1   DCL NBUFFER CHAR(255);                  /* buffer for the network header      */
       67     9403    1   DCL NHDR$ PTR;
       68     9404    1   DCL FOUNDONE BIT(1);
       69     9405    1   DCL I UBIN;
       70     9406    1   DCL J UBIN;
       71     9407    1   DCL L UBIN;
       72     9408    1   DCL INX UBIN;
       73     9409    1   DCL INDX(0:16) UBIN;
       74     9410    1   DCL OSI$ PTR;
       75     9411    1   DCL NQOS UBIN;
       76     9412    1   DCL CQOS UBIN;
       77     9413    1   DCL SVINDX SBIN;
       78     9414    1   DCL SIZE UBIN;
       79     9415                                                /* External Data                      */
       80     9416    1   DCL K_NODE# UBIN SYMREF;
       81     9417                                                /* Internal Data                      */
       82     9418        %K$NQDP_HDR (NAME=INIT_NWK_HDR, STCLASS=CONSTANT, MSGTYPE=CP6_CL4);
       83     9495
       84     9496                                                /* Based structures                   */
       85     9497    1   DCL KI$ROUTE$(0:0) PTR BASED(KI_ROUTE$$);
       86     9498        %KI$ROUTE (STCLASS="BASED(ROUTE$)");
       87     9552        %NK$LDCT;
       88     9598        %KNN$OSIROUTE(FPTN=KI$OSIROUTE,STCLASS="BASED(OSI$)");
       89     9815    1   DCL KI$OSIROUTE$(0:0) PTR BASED(KI_OSIROUTE$$);
       90     9816        %KI$FEI(STCLASS="BASED(FEI$)");
       91     9900        %K$NQDP_HDR(NAME=NHDR,MSGTYPE=OSI_INIT,STCLASS="BASED(NHDR$)",ADRTYP=NET);
       92    10245        %K$NSAP(FPTN=DST,STCLASS="BASED(K$RWPARM.DST_ADDR$)",ADRTYP=NET);
       93    10297        %K$NSAP(FPTN=SRC,STCLASS="BASED(K$RWPARM.SRC_ADDR$)",ADRTYP=NET);
             10297            /* probably nil but here for completenesss*/
       94    10349        %K$FPT_CONNECT_OSI (NAME=B$TR_OPTIONS, STCLASS=BASED, FULL=NO);
       95    10516    1   DCL ADDRESS CHAR(SIZE) BASED CALIGNED;
       96    10517    1   DCL CHR(0:3) CHAR(1) BASED CALIGNED;
       97    10518        /**/
       98    10519        %VLP_ERRCODE (FPTN=ERR_BADRNSAP,FCG=KI,MID=N,MON='1'B,ERR#=%E$BADRNSAP,SEV=0,STCLASS
             10519            =CONSTANT);
       99    10564        /*E*  ERROR:         KIA-E$BADRNSAP-A
PL6.E3A0      #001=KIN$SEND File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:33 Page:4    
      100    10565            MESSAGE: The remote NSAP specified is currently not defined in the system tables
      101    10566              DESCRIPTION: This usually means that either the nsap specified was not
      102    10567                           really a rnsap(ie a lnsap) or it was ill defined (ie bad afi)*/
      103    10568
      104    10569        %VLP_ERRCODE (FPTN=ERR_BADLNSAP,FCG=KI,MID=N,MON='1'B,ERR#=%E$BADLNSAP,SEV=0,STCLASS
             10569            =CONSTANT);
      105    10614        /*E*  ERROR:         KIA-E$BADLNSAP-A
      106    10615             MESSAGE: The local NSAP specified is currently not defined in the system tables
      107    10616              DESCRIPTION: This usually means that either the nsap specified was not
      108    10617                           really a lnsap(ie a rnsap) or it was ill defined (ie bad afi)*/
      109    10618
      110    10619        %VLP_ERRCODE (FPTN=ERR_NOROUTE,FCG=KI,MID=N,MON='1'B,ERR#=%E$NOROUTE,SEV=0,STCLASS=
             10619            CONSTANT);
      111    10664        /*E*  ERROR:         KIA-E$NOROUTE-A
      112    10665              MESSAGE: The NSAP requires a path which is currently unavailable.
      113    10666              DESCRIPTION: Either the local fep or the remote fep to which this network
      114    10667                           address is connected is not running. */
      115    10668
      116    10669        %EJECT;
PL6.E3A0      #001=KIN$SEND File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:33 Page:5    
      117    10670
      118    10671    1      K$RWPARM.NHDRSZ=LENGTHC(INIT_NWK_HDR);
      119    10672    1      K$RWPARM.NHDR$ = ADDR(NWK_HDR);
      120    10673
      121    10674    1      NWK_HDR = INIT_NWK_HDR;
      122    10675    1      NWK_HDR.SOURCE_NODE = K_NODE# + 1;
      123    10676    1      NWK_HDR.DEST_NODE = K$RWPARM.FEX + 1;
      124    10677
      125    10678    1      IF K$RWPARM.LDCT$ ~= ADDR(NIL)
      126    10679    2      THEN DO;
      127    10680    2           IF K$RWPARM.LDCT$->NK$LDCT.LKFLG.QDPPATH
      128    10681    2           THEN NWK_HDR.MSGTYP = %K_MSGTYP_CP6_QDP#;
      129    10682    2           ELSE NWK_HDR.MSGTYP = %K_MSGTYP_CP6_CL4#;
      130    10683    2           END;
      131    10684
      132    10685    2      IF K$RWPARM.FUNCTION = %K_NDATA THEN DO;
      133    10686             /*
      134    10687               This data message is for a class 0/4 connection which is currently running.
      135    10688               Use the OSI_DATA header.
      136    10689               k$rwparm.fex is set to fei# by transport, so get fep# out of ki$fei.
      137    10690              */
      138    10691
      139    10692    2           IF K$RWPARM.FEX > KI_NODES
      140    10693    3             OR KI$ROUTE$(K$RWPARM.FEX)->KI$ROUTE.FEI# = 0 THEN DO;
      141    10694                /*
      142    10695                   an fei# of 0 is not legal.
      143    10696                */
      144    10697    3                K$RWPARM.ERR = %K$USER_ERR;
      145    10698    3                K$RWPARM.MSG_ERRCODE = ERR_NOROUTE;
      146    10699    3                ALTRETURN;
      147    10700    3                END;
      148    10701
      149    10702    2           NWK_HDR.MSGTYP = %K_MSGTYP_OSI_DATA#;
      150    10703    2           NWK_HDR.DEST_NODE = K$RWPARM.FEX + 1;
      151    10704    2           K$RWPARM.FEX = KI$ROUTE$(K$RWPARM.FEX)->KI$ROUTE.FEI#;
      152    10705    2           K$RWPARM.FUNCTION = %K_WRITE;
      153    10706    2           CALL KIQ$LINK(K$RWPARM) ALTRET(ERROR);
PL6.E3A0      #001=KIN$SEND File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:33 Page:6    
      154    10707    2           RETURN;
      155    10708    2           END;
      156    10709
      157    10710    2      IF K$RWPARM.FUNCTION = %K_NCONNECT_REQ THEN DO;
      158    10711                /*
      159    10712                   this is a class 4/0 connection in the initialization stages.
      160    10713                   Use the OSI_INIT header.  Return the fei# to transport in k$rwparm.
      161    10714                   fex.  fep transport will remember the addresses on the fep for
      162    10715                   any subsequent messages.
      163    10716                */
      164    10717
      165    10718    3           IF K$RWPARM.DST_ADDR$ ~= ADDR(NIL) THEN DO; /* OSI connetion          */
      166    10719    3                NHDR$ = ADDR(NBUFFER);
      167    10720    3                NHDRINDX = 0;
      168    10721    3                NHDR.MSGTYP = %K_MSGTYP_OSI_INIT#;
      169    10722
      170    10723        /*
      171    10724         determine if the dest nsap is available
      172    10725        */
      173    10726
      174    10727    3                FOUNDONE = '0'B;
      175    10728    4   OSIRTE:      DO I = 0 TO KI_OSIMAX# - 1;
      176    10729    4                     OSI$ = KI$OSIROUTE$(I);
      177    10730    4                     IF SUBSTR(ADDR(DST)->ADDRESS,0,DST.LEN+1) =
      178    10731    5                       SUBSTR(ADDR(KI$OSIROUTE.NSAP)->ADDRESS,0,KI$OSIROUTE.NSAP.LEN+1)
             10731                                THEN DO;
      179    10732    5                          FOUNDONE = '1'B;
      180    10733    5                          J = 0;
      181    10734    5                          INX = 0;
      182    10735    6                          DO WHILE J < KI_MXFE;
      183    10736    7                               IF KI$OSIROUTE.LINK.ACTIVE(J) THEN DO;
      184    10737    7                                    INDX(INX) = J;
      185    10738    7                                    INX = INX + 1;
      186    10739    7                                    END;
      187    10740    6                               J = J + 1;
      188    10741    6                               END;
      189    10742    6                          IF INX > 0 THEN DO; /* one or more routes available    */
PL6.E3A0      #001=KIN$SEND File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:33 Page:7    
      190    10743    6                               CQOS = 255;
      191    10744    6                               SVINDX = -1;
      192    10745    7                               DO J = 0 TO INX-1;
      193    10746    7                                    L = INDX(J);
      194    10747    7                                    IF KI$OSIROUTE.LINK.FEP#(L) < KI_NODES AND
      195    10748    7                                      KI$ROUTE$(KI$OSIROUTE.LINK.FEP#(L))->KI$ROUTE.
             10748                                               FEI# ~= 0 THEN
      196    10749    7                                         NQOS = KI$ROUTE$(KI$OSIROUTE.LINK.FEP#(L))->
             10749                                                  KI$ROUTE.CURRENT_QOS;
      197    10750    8                                    IF NQOS < CQOS THEN DO;
      198    10751    8                                         SVINDX = J;
      199    10752    8                                         CQOS = NQOS;
      200    10753    8                                         END;
      201    10754    7                                    END;
      202    10755    7                               IF SVINDX = -1 THEN DO;
      203    10756    7                                    K$RWPARM.ERR = %K$USER_ERR;
      204    10757    7                                    K$RWPARM.MSG_ERRCODE = ERR_NOROUTE;
      205    10758    7                                    ALTRETURN;
      206    10759    7                                    END;
      207    10760    7                               ELSE DO;
      208    10761    7                                    ROUTE$ = KI$ROUTE$(KI$OSIROUTE.LINK.FEP#(SVINDX));
      209    10762    7                                    K$RWPARM.FEX = KI$ROUTE.FEI#;
      210    10763    7                                    EXIT OSIRTE;
      211    10764    7                                    END;
      212    10765    6                               END;
      213    10766    6                          ELSE DO;
      214    10767    6                               K$RWPARM.FEX = 0;
      215    10768    6                               K$RWPARM.ERR = %K$USER_ERR;
      216    10769    6                               K$RWPARM.MSG_ERRCODE = ERR_NOROUTE;
      217    10770    6                               ALTRETURN;
      218    10771    6                               END;
      219    10772    5                          END;             /* IF INX > 0                         */
      220    10773    4                     END;                  /* DO I = 0 TO KNN_OSIMAX#-1*/
      221    10774    4                IF NOT FOUNDONE THEN DO;
      222    10775    4                     K$RWPARM.FEX = 0;
      223    10776    4                     K$RWPARM.ERR = %K$USER_ERR;
      224    10777    4                     K$RWPARM.MSG_ERRCODE = ERR_BADRNSAP;
PL6.E3A0      #001=KIN$SEND File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:33 Page:8    
      225    10778    4                     ALTRETURN;
      226    10779    4                     END;
      227    10780
      228    10781    4                IF K$RWPARM.FEX = 0 THEN DO;
      229    10782    4                     K$RWPARM.ERR = %K$USER_ERR;
      230    10783    4                     K$RWPARM.MSG_ERRCODE = ERR_NOROUTE;
      231    10784    4                     ALTRETURN;
      232    10785    4                     END;
      233    10786         /*
      234    10787             if we got here then a route must be available.  move our source and the
      235    10788             destination addresses into the qdp header.
      236    10789        */
      237    10790
      238    10791    3                NHDR.SOURCE_NODE = K_NODE# + 1;
      239    10792    3                NHDR.DEST_NODE = KI$OSIROUTE.LINK.FEP#(SVINDX)+1;
      240    10793    3                K$RWPARM.FUNCTION = %K_WRITE;
      241    10794    3                NHDR.DST_NSAP = KI$OSIROUTE.NSAP;
      242    10795    3                NHDR.SRC_NSAP = KI$OSIROUTE.LNSAP;
      243    10796
      244    10797    3                NHDR.TR_OPTIONS = K$RWPARM.FPT$->B$TR_OPTIONS;
      245    10798    3                K$RWPARM.FPT$ = ADDR(NIL);
      246    10799
      247    10800
      248    10801    4                IF KI$OSIROUTE.LNSAP.LEN=0 OR KI$OSIROUTE.LNSAP.AFI = 0 THEN DO;
      249    10802    4                     K$RWPARM.ERR = %K$USER_ERR;
      250    10803    4                     K$RWPARM.MSG_ERRCODE = ERR_BADLNSAP;
      251    10804    4                     ALTRETURN;
      252    10805    4                     END;
      253    10806        /*
      254    10807              fill in network header with info from osiroute.
      255    10808        */
      256    10809    3                K$RWPARM.NHDRSZ = LENGTHC(NHDR);
      257    10810    3                K$RWPARM.NHDR$ = NHDR$;
      258    10811    3                CALL KIQ$LINK(K$RWPARM) ALTRET(ERROR);
      259    10812        /*
      260    10813              return to local fep number to transport for future reference.
      261    10814        */
PL6.E3A0      #001=KIN$SEND File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:33 Page:9    
      262    10815    3                K$RWPARM.LOCAL_FEP = KI$FEI$(K$RWPARM.FEX)->KI$FEI.FEP#;
      263    10816    3                K$RWPARM.FEX = KI$FEI$(K$RWPARM.FEX)->KI$FEI.FEP#;
      264    10817    3                RETURN;
      265    10818    3                END;
      266    10819    3           ELSE DO;                        /* DST_ADDR$ = NIL                    */
      267    10820                  /* this is an error NCONNECT, but the destination
      268    10821                      address was not specified.*/
      269    10822    3                K$RWPARM.ERR = %K$USER_ERR;
      270    10823    3                K$RWPARM.MSG_ERRCODE = ERR_BADRNSAP;
      271    10824    3                ALTRETURN;
      272    10825    3                END;
      273    10826    2           END;                            /* end else if NCONNECT               */
      274    10827    2      ELSE DO; /* must be either QDP or CP6_CL4 and k$rwparm.function = k_write*/
      275    10828    2           ROUTE$ = KI$ROUTE$(K$RWPARM.FEX);
      276    10829    3           IF KI$ROUTE.FEI# = 0 THEN DO;
      277    10830    3                K$RWPARM.ERR = %K$USER_ERR;/* doubtful that we will ever get here */
      278    10831    3                K$RWPARM.MSG_ERRCODE = ERR_NOROUTE;
      279    10832    3                ALTRETURN;
      280    10833    3                END;
      281    10834    2           K$RWPARM.FEX = KI$ROUTE.FEI#;
      282    10835    2           CALL KIQ$LINK(K$RWPARM) ALTRET(ERROR);
      283    10836    2           RETURN;
      284    10837    2           END;
      285    10838
      286    10839    1   ERROR:;
      287    10840    1      ALTRETURN;
      288    10841
      289    10842    1   END KIN$SEND;
      290    10843        %EOD;

PL6.E3A0      #001=KIN$SEND File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:33 Page:10   
--  Include file information  --

   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   K_INTERFACE_M.:E05TOU  is referenced.
   KI_ERRORS_C.:E05TOU  is referenced.
   K_SUBS_C.:E05TOU  is referenced.
   KNN_NETWORK_M.:E05TOU  is referenced.
   K_ADDRESS_M.:E05TOU  is referenced.
   KI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NK$LDCT.:E05TOU  is referenced.
   KI_MACROS_C.:E05TOU  is referenced.
   K_QDPHDRS_M.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
      No diagnostics issued in procedure KIN$SEND.

   Procedure KIN$SEND requires 318 words for executable code.
   Procedure KIN$SEND requires 104 words of local(AUTO) storage.

PL6.E3A0      #001=KIN$SEND File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:33 Page:11   

 Object Unit name= KIN$SEND                                   File name= KIN$NETWORK.:E05TOU
 UTS= JUL 30 '97 00:33:08.72 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1  RoData even  UTS      4      4  KIN$SEND
    2   Proc  even  none   318    476  KIN$SEND

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     2      0   yes    yes     yes      Std        1  KIN$SEND

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       2 KIQ$LINK
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AALT
                       nStd      0 X66_ARET
PL6.E3A0      #001=KIN$SEND File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:33 Page:12   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KI_FEI$$                              KI_ROUTE$$                            KI_OSIMAX#
     KI_OSIROUTE$$                         KI_NODES                              KI_MXFE
     M$UC                                  K_NODE#                               B_VECTNIL
PL6.E3A0      #001=KIN$SEND File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:33 Page:13   


        1        1        /*M* KIN$NETWORK - Network procedures on the host            */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* PLM=3,IND=5,ENU=0,ECU=0  */
        8        8
        9        9        /*F* NAME: Host_Network_Services
       10       10
       11       11        KIN$NETWORK contains the network functions for the Host. It
       12       12        interfaces to KIQ (Host to Frontend Interface), KIS (Session),
       13       13        and KIT (Transport).
       14       14
       15       15        The KIN$NETWORK file contains the following modules:
       16       16
       17       17        .fif
       18       18        }  KIN$SEND - forward message to local fep
       19       19        }  KIN$RECV - entered from KIQ$ISCAN to forward message to user
       20       20        }           - also entered from KIQ$FEINT and KIQ$FEABT for network
       21       21        }             management functions.
       22       22        }  KIN$NODECHG - entered from KUB$EA to process a KL_SETNODE message.
       23       23        }  KIN$CONV_NODENAME - Misc routines for accessing data in the route table
       24       24        .fin
       25       25        */
       26       26
       27       27        %EJECT;
PL6.E3A0      #001=KIN$SEND File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:33 Page:14   
       28       28        /*F* NAME: KIN$SEND Outbound Messages
       29       29
       30       30        This routine is called from KIS$SEND or KIT$SEND.
       31       31        It is called with the single parameter K$RWPARM.
       32       32
       33       33        KIN$SEND simply builds a network header setting the source address to
       34       34        K_NODE# +1, and setting the the destination address to the value passed
       35       35        in K$RWPARM.FEX +1.
       36       36
       37       37        The network header address and size in K$RWPARM are updated to
       38       38        reference this header, and KIN$SEND calls KIQ$QLINK.
       39       39        The function passed to KIQ$QLINK is from K$RWPARM.FUNCTION.
       40       40        */
       41       41
       42       42        KIN$SEND: PROC (K$RWPARM) ALTRET;

     42  2 000000   000000 700200 xent  KIN$SEND     TSX0  ! X66_AUTO_1
         2 000001   000150 000001                    ZERO    104,1

       43       43
       44       44        %INCLUDE K$RWPARM;
       45      430        %INCLUDE K_QDPHDRS_M;
       46     1312        %INCLUDE KI_MACROS_C;
       47     1920        %INCLUDE NK$LDCT;
       48     2022        %INCLUDE KI_DATA_R;
       49     2048        %INCLUDE K_ADDRESS_M;
       50     2551        %INCLUDE KNN_NETWORK_M;
       51     2914        %INCLUDE K_SUBS_C;
       52     2947        %INCLUDE KI_ERRORS_C;                   /* because now we do errors too*/
       53     3032        %INCLUDE K_INTERFACE_M;
       54     3441        %INCLUDE CP_6;
       55     9000
       56     9001                                                /* Parameters                         */
       57     9002        %K$RWPARM (NAME=K$RWPARM);
       58     9318                                                /* Entry references                   */
       59     9319    1   DCL KIQ$LINK ENTRY(2) ALTRET;
       60     9320                                                /* Auto                               */
PL6.E3A0      #001=KIN$SEND File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:33 Page:15   
       61     9321        %K$NQDP_HDR (NAME=NWK_HDR, STCLASS=AUTO);
       62     9398    1   DCL FEI# UBIN;
       63     9399    1   DCL FEI$ PTR;
       64     9400    1   DCL ROUTE$ PTR;
       65     9401    1   DCL NHDRINDX UBIN;
       66     9402    1   DCL NBUFFER CHAR(255);                  /* buffer for the network header      */
       67     9403    1   DCL NHDR$ PTR;
       68     9404    1   DCL FOUNDONE BIT(1);
       69     9405    1   DCL I UBIN;
       70     9406    1   DCL J UBIN;
       71     9407    1   DCL L UBIN;
       72     9408    1   DCL INX UBIN;
       73     9409    1   DCL INDX(0:16) UBIN;
       74     9410    1   DCL OSI$ PTR;
       75     9411    1   DCL NQOS UBIN;
       76     9412    1   DCL CQOS UBIN;
       77     9413    1   DCL SVINDX SBIN;
       78     9414    1   DCL SIZE UBIN;
       79     9415                                                /* External Data                      */
       80     9416    1   DCL K_NODE# UBIN SYMREF;
       81     9417                                                /* Internal Data                      */
       82     9418        %K$NQDP_HDR (NAME=INIT_NWK_HDR, STCLASS=CONSTANT, MSGTYPE=CP6_CL4);
       83     9495
       84     9496                                                /* Based structures                   */
       85     9497    1   DCL KI$ROUTE$(0:0) PTR BASED(KI_ROUTE$$);
       86     9498        %KI$ROUTE (STCLASS="BASED(ROUTE$)");
       87     9552        %NK$LDCT;
       88     9598        %KNN$OSIROUTE(FPTN=KI$OSIROUTE,STCLASS="BASED(OSI$)");
       89     9815    1   DCL KI$OSIROUTE$(0:0) PTR BASED(KI_OSIROUTE$$);
       90     9816        %KI$FEI(STCLASS="BASED(FEI$)");
       91     9900        %K$NQDP_HDR(NAME=NHDR,MSGTYPE=OSI_INIT,STCLASS="BASED(NHDR$)",ADRTYP=NET);
       92    10245        %K$NSAP(FPTN=DST,STCLASS="BASED(K$RWPARM.DST_ADDR$)",ADRTYP=NET);
       93    10297        %K$NSAP(FPTN=SRC,STCLASS="BASED(K$RWPARM.SRC_ADDR$)",ADRTYP=NET);
             10297            /* probably nil but here for completenesss*/
       94    10349        %K$FPT_CONNECT_OSI (NAME=B$TR_OPTIONS, STCLASS=BASED, FULL=NO);
       95    10516    1   DCL ADDRESS CHAR(SIZE) BASED CALIGNED;
       96    10517    1   DCL CHR(0:3) CHAR(1) BASED CALIGNED;
PL6.E3A0      #001=KIN$SEND File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:33 Page:16   
       97    10518        /**/
       98    10519       %VLP_ERRCODE (FPTN=ERR_BADRNSAP,FCG=KI,MID=N,MON='1'B,ERR#=%E$BADRNSAP,SEV=0,STCLASS
             10519            =CONSTANT);
       99    10564        /*E*  ERROR:         KIA-E$BADRNSAP-A
      100    10565           MESSAGE: The remote NSAP specified is currently not defined in the system tables
      101    10566              DESCRIPTION: This usually means that either the nsap specified was not
      102    10567                           really a rnsap(ie a lnsap) or it was ill defined (ie bad afi)*/
      103    10568
      104    10569       %VLP_ERRCODE (FPTN=ERR_BADLNSAP,FCG=KI,MID=N,MON='1'B,ERR#=%E$BADLNSAP,SEV=0,STCLASS
             10569            =CONSTANT);
      105    10614        /*E*  ERROR:         KIA-E$BADLNSAP-A
      106    10615            MESSAGE: The local NSAP specified is currently not defined in the system tables
      107    10616              DESCRIPTION: This usually means that either the nsap specified was not
      108    10617                           really a lnsap(ie a rnsap) or it was ill defined (ie bad afi)*/
      109    10618
      110    10619        %VLP_ERRCODE (FPTN=ERR_NOROUTE,FCG=KI,MID=N,MON='1'B,ERR#=%E$NOROUTE,SEV=0,STCLASS=
             10619            CONSTANT);
      111    10664        /*E*  ERROR:         KIA-E$NOROUTE-A
      112    10665              MESSAGE: The NSAP requires a path which is currently unavailable.
      113    10666              DESCRIPTION: Either the local fep or the remote fep to which this network
      114    10667                           address is connected is not running. */
      115    10668
      116    10669        %EJECT;
PL6.E3A0      #001=KIN$SEND File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:33 Page:17   
      117    10670
      118    10671    1      K$RWPARM.NHDRSZ=LENGTHC(INIT_NWK_HDR);

  10671  2 000002   000004 235007                    LDA     4,DL
         2 000003   200003 470500                    LDP0    @K$RWPARM,,AUTO
         2 000004   000027 755100                    STA     23,,PR0

      119    10672    1      K$RWPARM.NHDR$ = ADDR(NWK_HDR);

  10672  2 000005   200004 631500                    EPPR1   NWK_HDR,,AUTO
         2 000006   000026 451500                    STP1    22,,PR0

      120    10673
      121    10674    1      NWK_HDR = INIT_NWK_HDR;

  10674  2 000007   000000 236000 1                  LDQ     INIT_NWK_HDR
         2 000010   200004 756100                    STQ     NWK_HDR,,AUTO

      122    10675    1      NWK_HDR.SOURCE_NODE = K_NODE# + 1;

  10675  2 000011   000000 236000 xsym               LDQ     K_NODE#
         2 000012   000001 036007                    ADLQ    1,DL
         2 000013   200004 552104                    STBQ    NWK_HDR,'04'O,AUTO

      123    10676    1      NWK_HDR.DEST_NODE = K$RWPARM.FEX + 1;

  10676  2 000014   000021 236100                    LDQ     17,,PR0
         2 000015   000001 036007                    ADLQ    1,DL
         2 000016   000011 736000                    QLS     9
         2 000017   200004 552110                    STBQ    NWK_HDR,'10'O,AUTO

      124    10677
      125    10678    1      IF K$RWPARM.LDCT$ ~= ADDR(NIL)

  10678  2 000020   000016 236100                    LDQ     14,,PR0
         2 000021   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 000022   000034 600000 2                  TZE     s:10685
PL6.E3A0      #001=KIN$SEND File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:33 Page:18   

      126    10679    2      THEN DO;

      127    10680    2           IF K$RWPARM.LDCT$->NK$LDCT.LKFLG.QDPPATH

  10680  2 000023   000016 473500                    LDP3    14,,PR0
         2 000024   300011 236100                    LDQ     9,,PR3
         2 000025   002000 316003                    CANQ    1024,DU
         2 000026   000032 600000 2                  TZE     s:10682

      128    10681    2           THEN NWK_HDR.MSGTYP = %K_MSGTYP_CP6_QDP#;

  10681  2 000027   376000 236003                    LDQ     130048,DU
         2 000030   200004 552140                    STBQ    NWK_HDR,'40'O,AUTO
         2 000031   000034 710000 2                  TRA     s:10685

      129    10682    2           ELSE NWK_HDR.MSGTYP = %K_MSGTYP_CP6_CL4#;

  10682  2 000032   375000 236003                    LDQ     129536,DU
         2 000033   200004 552140                    STBQ    NWK_HDR,'40'O,AUTO

      130    10683    2           END;

      131    10684
      132    10685    2      IF K$RWPARM.FUNCTION = %K_NDATA THEN DO;

  10685  2 000034   000020 235100                    LDA     16,,PR0
         2 000035   000041 115007                    CMPA    33,DL
         2 000036   000100 601000 2                  TNZ     s:10710

      133    10686             /*
      134    10687               This data message is for a class 0/4 connection which is currently running.
      135    10688               Use the OSI_DATA header.
      136    10689               k$rwparm.fex is set to fei# by transport, so get fep# out of ki$fei.
      137    10690              */
      138    10691
      139    10692    2           IF K$RWPARM.FEX > KI_NODES
PL6.E3A0      #001=KIN$SEND File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:33 Page:19   

  10692  2 000037   000000 236000 xsym               LDQ     KI_NODES
         2 000040   000043 604000 2                  TMI     s:10692+4
         2 000041   000021 116100                    CMPQ    17,,PR0
         2 000042   000051 604000 2                  TMI     s:10697
         2 000043   000021 720100                    LXL0    17,,PR0
         2 000044   000000 473400 xsym               LDP3    KI_ROUTE$$
         2 000045   300000 474510                    LDP4    0,X0,PR3
         2 000046   400002 236100                    LDQ     2,,PR4
         2 000047   777000 316003                    CANQ    -512,DU
         2 000050   000056 601000 2                  TNZ     s:10702

      140    10693    3             OR KI$ROUTE$(K$RWPARM.FEX)->KI$ROUTE.FEI# = 0 THEN DO;

      141    10694                /*
      142    10695                   an fei# of 0 is not legal.
      143    10696                */
      144    10697    3                K$RWPARM.ERR = %K$USER_ERR;

  10697  2 000051   000010 236007                    LDQ     8,DL
         2 000052   000013 756100                    STQ     11,,PR0

      145    10698    3                K$RWPARM.MSG_ERRCODE = ERR_NOROUTE;

  10698  2 000053   000003 236000 1                  LDQ     ERR_NOROUTE
         2 000054   000037 756100                    STQ     31,,PR0

      146    10699    3                ALTRETURN;

  10699  2 000055   000000 702200 xent               TSX2  ! X66_AALT

      147    10700    3                END;
      148    10701
      149    10702    2           NWK_HDR.MSGTYP = %K_MSGTYP_OSI_DATA#;

  10702  2 000056   374000 236003                    LDQ     129024,DU
         2 000057   200004 552140                    STBQ    NWK_HDR,'40'O,AUTO
PL6.E3A0      #001=KIN$SEND File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:33 Page:20   

      150    10703    2           NWK_HDR.DEST_NODE = K$RWPARM.FEX + 1;

  10703  2 000060   000021 236100                    LDQ     17,,PR0
         2 000061   000001 036007                    ADLQ    1,DL
         2 000062   000011 736000                    QLS     9
         2 000063   200004 552110                    STBQ    NWK_HDR,'10'O,AUTO

      151    10704    2           K$RWPARM.FEX = KI$ROUTE$(K$RWPARM.FEX)->KI$ROUTE.FEI#;

  10704  2 000064   000021 720100                    LXL0    17,,PR0
         2 000065   300000 474510                    LDP4    0,X0,PR3
         2 000066   400002 236100                    LDQ     2,,PR4
         2 000067   000033 772000                    QRL     27
         2 000070   000021 756100                    STQ     17,,PR0

      152    10705    2           K$RWPARM.FUNCTION = %K_WRITE;

  10705  2 000071   000001 235007                    LDA     1,DL
         2 000072   000020 755100                    STA     16,,PR0

      153    10706    2           CALL KIQ$LINK(K$RWPARM) ALTRET(ERROR);

  10706  2 000073   200003 630500                    EPPR0   @K$RWPARM,,AUTO
         2 000074   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000075   000000 701000 xent               TSX1    KIQ$LINK
         2 000076   000475 702000 2                  TSX2    ERROR

      154    10707    2           RETURN;

  10707  2 000077   000000 702200 xent               TSX2  ! X66_ARET

      155    10708    2           END;
      156    10709
      157    10710    2      IF K$RWPARM.FUNCTION = %K_NCONNECT_REQ THEN DO;

  10710  2 000100   000037 115007                    CMPA    31,DL
PL6.E3A0      #001=KIN$SEND File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:33 Page:21   
         2 000101   000450 601000 2                  TNZ     s:10828

      158    10711                /*
      159    10712                   this is a class 4/0 connection in the initialization stages.
      160    10713                   Use the OSI_INIT header.  Return the fei# to transport in k$rwparm.
      161    10714                   fex.  fep transport will remember the addresses on the fep for
      162    10715                   any subsequent messages.
      163    10716                */
      164    10717
      165    10718    3           IF K$RWPARM.DST_ADDR$ ~= ADDR(NIL) THEN DO; /* OSI connetion          */

  10718  2 000102   000035 236100                    LDQ     29,,PR0
         2 000103   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 000104   000443 600000 2                  TZE     s:10822

      166    10719    3                NHDR$ = ADDR(NBUFFER);

  10719  2 000105   200011 633500                    EPPR3   NBUFFER,,AUTO
         2 000106   200111 453500                    STP3    NHDR$,,AUTO

      167    10720    3                NHDRINDX = 0;

  10720  2 000107   200010 450100                    STZ     NHDRINDX,,AUTO

      168    10721    3                NHDR.MSGTYP = %K_MSGTYP_OSI_INIT#;

  10721  2 000110   373000 236003                    LDQ     128512,DU
         2 000111   300000 552140                    STBQ    0,'40'O,PR3

      169    10722
      170    10723        /*
      171    10724         determine if the dest nsap is available
      172    10725        */
      173    10726
      174    10727    3                FOUNDONE = '0'B;

  10727  2 000112   200112 450100                    STZ     FOUNDONE,,AUTO
PL6.E3A0      #001=KIN$SEND File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:33 Page:22   

      175    10728    4   OSIRTE:      DO I = 0 TO KI_OSIMAX# - 1;

  10728  2 000113   200113 450100       OSIRTE       STZ     I,,AUTO
         2 000114   000323 710000 2                  TRA     s:10773+3

      176    10729    4                     OSI$ = KI$OSIROUTE$(I);

  10729  2 000115   000000 470400 xsym               LDP0    KI_OSIROUTE$$
         2 000116   200113 720100                    LXL0    I,,AUTO
         2 000117   000000 236110                    LDQ     0,X0,PR0
         2 000120   200140 756100                    STQ     OSI$,,AUTO

      177    10730    4                     IF SUBSTR(ADDR(DST)->ADDRESS,0,DST.LEN+1) =

  10730  2 000121   200003 471500                    LDP1    @K$RWPARM,,AUTO
         2 000122   100035 473500                    LDP3    29,,PR1
         2 000123   000100 101500                    MRL     fill='000'O
         2 000124   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
         2 000125   200146 000002                    ADSC9   SIZE+2,,AUTO             cn=0,n=2
         2 000126   200146 221100                    LDX1    SIZE+2,,AUTO
         2 000127   000001 622011                    EAX2    1,X1
         2 000130   200140 474500                    LDP4    OSI$,,AUTO
         2 000131   400000 236100                    LDQ     0,,PR4
         2 000132   000033 772000                    QRL     27
         2 000133   000001 623006                    EAX3    1,QL
         2 000134   040140 106540                    CMPC    fill='040'O
         2 000135   300000 000012                    ADSC9   0,,PR3                   cn=0,n=*X2
         2 000136   400000 000013                    ADSC9   0,,PR4                   cn=0,n=*X3
         2 000137   000320 601000 2                  TNZ     s:10773

      178    10731    5                      SUBSTR(ADDR(KI$OSIROUTE.NSAP)->ADDRESS,0,KI$OSIROUTE.NSAP.LEN+1)
             10731                                THEN DO;

      179    10732    5                          FOUNDONE = '1'B;

  10732  2 000140   400000 236003                    LDQ     -131072,DU
PL6.E3A0      #001=KIN$SEND File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:33 Page:23   
         2 000141   200112 756100                    STQ     FOUNDONE,,AUTO

      180    10733    5                          J = 0;

  10733  2 000142   200114 450100                    STZ     J,,AUTO

      181    10734    5                          INX = 0;

  10734  2 000143   200116 450100                    STZ     INX,,AUTO

      182    10735    6                          DO WHILE J < KI_MXFE;

  10735  2 000144   200114 236100                    LDQ     J,,AUTO
         2 000145   000000 116000 xsym               CMPQ    KI_MXFE
         2 000146   000172 603000 2                  TRC     s:10742

      183    10736    7                               IF KI$OSIROUTE.LINK.ACTIVE(J) THEN DO;

  10736  2 000147   200114 236100                    LDQ     J,,AUTO
         2 000150   000207 402007                    MPY     135,DL
         2 000151   200140 470500                    LDP0    OSI$,,AUTO
         2 000152   000000 066506                    CMPB    filb='0'B
         2 000153   000015 210001                    BDSC    13,Q,PR0                 by=1,bit=1,n=1
         2 000154   000002 000022 xsym               BDSC    B_VECTNIL+2              by=0,bit=0,n=18
         2 000155   000164 600000 2                  TZE     s:10740

      184    10737    7                                    INDX(INX) = J;

  10737  2 000156   200116 720100                    LXL0    INX,,AUTO
         2 000157   200114 235100                    LDA     J,,AUTO
         2 000160   200117 755110                    STA     INDX,X0,AUTO

      185    10738    7                                    INX = INX + 1;

  10738  2 000161   200116 235100                    LDA     INX,,AUTO
         2 000162   000001 035007                    ADLA    1,DL
         2 000163   200116 755100                    STA     INX,,AUTO
PL6.E3A0      #001=KIN$SEND File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:33 Page:24   

      186    10739    7                                    END;

      187    10740    6                               J = J + 1;

  10740  2 000164   200114 235100                    LDA     J,,AUTO
         2 000165   000001 035007                    ADLA    1,DL
         2 000166   200114 755100                    STA     J,,AUTO

      188    10741    6                               END;

  10741  2 000167   200114 236100                    LDQ     J,,AUTO
         2 000170   000000 116000 xsym               CMPQ    KI_MXFE
         2 000171   000147 602000 2                  TNC     s:10736

      189    10742    6                          IF INX > 0 THEN DO; /* one or more routes available    */

  10742  2 000172   200116 235100                    LDA     INX,,AUTO
         2 000173   000311 600000 2                  TZE     s:10767

      190    10743    6                               CQOS = 255;

  10743  2 000174   000377 235007                    LDA     255,DL
         2 000175   200142 755100                    STA     CQOS,,AUTO

      191    10744    6                               SVINDX = -1;

  10744  2 000176   000001 335007                    LCA     1,DL
         2 000177   200143 755100                    STA     SVINDX,,AUTO

      192    10745    7                               DO J = 0 TO INX-1;

  10745  2 000200   200114 450100                    STZ     J,,AUTO
         2 000201   000255 710000 2                  TRA     s:10754+3

      193    10746    7                                    L = INDX(J);

PL6.E3A0      #001=KIN$SEND File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:33 Page:25   
  10746  2 000202   200114 720100                    LXL0    J,,AUTO
         2 000203   200117 235110                    LDA     INDX,X0,AUTO
         2 000204   200115 755100                    STA     L,,AUTO

      194    10747    7                                    IF KI$OSIROUTE.LINK.FEP#(L) < KI_NODES AND

  10747  2 000205   200115 236100                    LDQ     L,,AUTO
         2 000206   000017 402007                    MPY     15,DL
         2 000207   200140 470500                    LDP0    OSI$,,AUTO
         2 000210   000100 101506                    MRL     fill='000'O
         2 000211   000015 400001                    ADSC9   13,Q,PR0                 cn=2,n=1
         2 000212   200146 000004                    ADSC9   SIZE+2,,AUTO             cn=0,n=4
         2 000213   200146 236100                    LDQ     SIZE+2,,AUTO
         2 000214   000000 116000 xsym               CMPQ    KI_NODES
         2 000215   000244 603000 2                  TRC     s:10750
         2 000216   200115 236100                    LDQ     L,,AUTO
         2 000217   000017 402007                    MPY     15,DL
         2 000220   000100 101506                    MRL     fill='000'O
         2 000221   000015 400001                    ADSC9   13,Q,PR0                 cn=2,n=1
         2 000222   200147 000002                    ADSC9   SIZE+3,,AUTO             cn=0,n=2
         2 000223   200147 221100                    LDX1    SIZE+3,,AUTO
         2 000224   000000 471400 xsym               LDP1    KI_ROUTE$$
         2 000225   100000 473511                    LDP3    0,X1,PR1
         2 000226   300002 236100                    LDQ     2,,PR3
         2 000227   777000 316003                    CANQ    -512,DU
         2 000230   000244 600000 2                  TZE     s:10750

      195    10748    7                                      KI$ROUTE$(KI$OSIROUTE.LINK.FEP#(L))->KI$ROUTE.
             10748                                               FEI# ~= 0 THEN
      196    10749    7                                         NQOS = KI$ROUTE$(KI$OSIROUTE.LINK.FEP#(L))->
             10749                                                  KI$ROUTE.CURRENT_QOS;

  10749  2 000231   200115 236100                    LDQ     L,,AUTO
         2 000232   000017 402007                    MPY     15,DL
         2 000233   000100 101506                    MRL     fill='000'O
         2 000234   000015 400001                    ADSC9   13,Q,PR0                 cn=2,n=1
         2 000235   200146 000002                    ADSC9   SIZE+2,,AUTO             cn=0,n=2
PL6.E3A0      #001=KIN$SEND File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:33 Page:26   
         2 000236   200146 221100                    LDX1    SIZE+2,,AUTO
         2 000237   100000 473511                    LDP3    0,X1,PR1
         2 000240   300002 236100                    LDQ     2,,PR3
         2 000241   000022 772000                    QRL     18
         2 000242   000777 376007                    ANQ     511,DL
         2 000243   200141 756100                    STQ     NQOS,,AUTO

      197    10750    8                                    IF NQOS < CQOS THEN DO;

  10750  2 000244   200141 236100                    LDQ     NQOS,,AUTO
         2 000245   200142 116100                    CMPQ    CQOS,,AUTO
         2 000246   000252 603000 2                  TRC     s:10754

      198    10751    8                                         SVINDX = J;

  10751  2 000247   200114 235100                    LDA     J,,AUTO
         2 000250   200143 755100                    STA     SVINDX,,AUTO

      199    10752    8                                         CQOS = NQOS;

  10752  2 000251   200142 756100                    STQ     CQOS,,AUTO

      200    10753    8                                         END;

      201    10754    7                                    END;

  10754  2 000252   200114 235100                    LDA     J,,AUTO
         2 000253   000001 035007                    ADLA    1,DL
         2 000254   200114 755100                    STA     J,,AUTO
         2 000255   200114 236100                    LDQ     J,,AUTO
         2 000256   200116 116100                    CMPQ    INX,,AUTO
         2 000257   000202 602000 2                  TNC     s:10746

      202    10755    7                               IF SVINDX = -1 THEN DO;

  10755  2 000260   200143 235100                    LDA     SVINDX,,AUTO
         2 000261   000027 115000 xsym               CMPA    B_VECTNIL+23
PL6.E3A0      #001=KIN$SEND File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:33 Page:27   
         2 000262   000271 601000 2                  TNZ     s:10761

      203    10756    7                                    K$RWPARM.ERR = %K$USER_ERR;

  10756  2 000263   000010 235007                    LDA     8,DL
         2 000264   200003 470500                    LDP0    @K$RWPARM,,AUTO
         2 000265   000013 755100                    STA     11,,PR0

      204    10757    7                                    K$RWPARM.MSG_ERRCODE = ERR_NOROUTE;

  10757  2 000266   000003 236000 1                  LDQ     ERR_NOROUTE
         2 000267   000037 756100                    STQ     31,,PR0

      205    10758    7                                    ALTRETURN;

  10758  2 000270   000000 702200 xent               TSX2  ! X66_AALT

      206    10759    7                                    END;
      207    10760    7                               ELSE DO;

      208    10761    7                                    ROUTE$ = KI$ROUTE$(KI$OSIROUTE.LINK.FEP#(SVINDX));

  10761  2 000271   200143 236100                    LDQ     SVINDX,,AUTO
         2 000272   000017 402007                    MPY     15,DL
         2 000273   200140 470500                    LDP0    OSI$,,AUTO
         2 000274   000100 101506                    MRL     fill='000'O
         2 000275   000015 400001                    ADSC9   13,Q,PR0                 cn=2,n=1
         2 000276   200146 000002                    ADSC9   SIZE+2,,AUTO             cn=0,n=2
         2 000277   200146 220100                    LDX0    SIZE+2,,AUTO
         2 000300   000000 471400 xsym               LDP1    KI_ROUTE$$
         2 000301   100000 236110                    LDQ     0,X0,PR1
         2 000302   200007 756100                    STQ     ROUTE$,,AUTO

      209    10762    7                                    K$RWPARM.FEX = KI$ROUTE.FEI#;

  10762  2 000303   200007 473500                    LDP3    ROUTE$,,AUTO
         2 000304   300002 236100                    LDQ     2,,PR3
PL6.E3A0      #001=KIN$SEND File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:33 Page:28   
         2 000305   000033 772000                    QRL     27
         2 000306   200003 474500                    LDP4    @K$RWPARM,,AUTO
         2 000307   400021 756100                    STQ     17,,PR4

      210    10763    7                                    EXIT OSIRTE;

  10763  2 000310   000326 710000 2                  TRA     s:10774

      211    10764    7                                    END;
      212    10765    6                               END;
      213    10766    6                          ELSE DO;

      214    10767    6                               K$RWPARM.FEX = 0;

  10767  2 000311   200003 470500                    LDP0    @K$RWPARM,,AUTO
         2 000312   000021 450100                    STZ     17,,PR0

      215    10768    6                               K$RWPARM.ERR = %K$USER_ERR;

  10768  2 000313   000010 235007                    LDA     8,DL
         2 000314   000013 755100                    STA     11,,PR0

      216    10769    6                               K$RWPARM.MSG_ERRCODE = ERR_NOROUTE;

  10769  2 000315   000003 236000 1                  LDQ     ERR_NOROUTE
         2 000316   000037 756100                    STQ     31,,PR0

      217    10770    6                               ALTRETURN;

  10770  2 000317   000000 702200 xent               TSX2  ! X66_AALT

      218    10771    6                               END;
      219    10772    5                          END;             /* IF INX > 0                         */
      220    10773    4                     END;                  /* DO I = 0 TO KNN_OSIMAX#-1*/

  10773  2 000320   200113 235100                    LDA     I,,AUTO
         2 000321   000001 035007                    ADLA    1,DL
PL6.E3A0      #001=KIN$SEND File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:33 Page:29   
         2 000322   200113 755100                    STA     I,,AUTO
         2 000323   200113 236100                    LDQ     I,,AUTO
         2 000324   000000 116000 xsym               CMPQ    KI_OSIMAX#
         2 000325   000115 602000 2                  TNC     s:10729

      221    10774    4                IF NOT FOUNDONE THEN DO;

  10774  2 000326   200112 234100                    SZN     FOUNDONE,,AUTO
         2 000327   000337 604000 2                  TMI     s:10781

      222    10775    4                     K$RWPARM.FEX = 0;

  10775  2 000330   200003 470500                    LDP0    @K$RWPARM,,AUTO
         2 000331   000021 450100                    STZ     17,,PR0

      223    10776    4                     K$RWPARM.ERR = %K$USER_ERR;

  10776  2 000332   000010 235007                    LDA     8,DL
         2 000333   000013 755100                    STA     11,,PR0

      224    10777    4                     K$RWPARM.MSG_ERRCODE = ERR_BADRNSAP;

  10777  2 000334   000001 236000 1                  LDQ     ERR_BADRNSAP
         2 000335   000037 756100                    STQ     31,,PR0

      225    10778    4                     ALTRETURN;

  10778  2 000336   000000 702200 xent               TSX2  ! X66_AALT

      226    10779    4                     END;
      227    10780
      228    10781    4                IF K$RWPARM.FEX = 0 THEN DO;

  10781  2 000337   200003 470500                    LDP0    @K$RWPARM,,AUTO
         2 000340   000021 235100                    LDA     17,,PR0
         2 000341   000347 601000 2                  TNZ     s:10791

PL6.E3A0      #001=KIN$SEND File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:33 Page:30   
      229    10782    4                     K$RWPARM.ERR = %K$USER_ERR;

  10782  2 000342   000010 236007                    LDQ     8,DL
         2 000343   000013 756100                    STQ     11,,PR0

      230    10783    4                     K$RWPARM.MSG_ERRCODE = ERR_NOROUTE;

  10783  2 000344   000003 236000 1                  LDQ     ERR_NOROUTE
         2 000345   000037 756100                    STQ     31,,PR0

      231    10784    4                     ALTRETURN;

  10784  2 000346   000000 702200 xent               TSX2  ! X66_AALT

      232    10785    4                     END;
      233    10786         /*
      234    10787             if we got here then a route must be available.  move our source and the
      235    10788             destination addresses into the qdp header.
      236    10789        */
      237    10790
      238    10791    3                NHDR.SOURCE_NODE = K_NODE# + 1;

  10791  2 000347   200111 471500                    LDP1    NHDR$,,AUTO
         2 000350   000000 236000 xsym               LDQ     K_NODE#
         2 000351   000001 036007                    ADLQ    1,DL
         2 000352   100000 552104                    STBQ    0,'04'O,PR1

      239    10792    3                NHDR.DEST_NODE = KI$OSIROUTE.LINK.FEP#(SVINDX)+1;

  10792  2 000353   200143 236100                    LDQ     SVINDX,,AUTO
         2 000354   000017 402007                    MPY     15,DL
         2 000355   200140 473500                    LDP3    OSI$,,AUTO
         2 000356   000100 101506                    MRL     fill='000'O
         2 000357   300015 400001                    ADSC9   13,Q,PR3                 cn=2,n=1
         2 000360   200146 000004                    ADSC9   SIZE+2,,AUTO             cn=0,n=4
         2 000361   200146 236100                    LDQ     SIZE+2,,AUTO
         2 000362   000001 036007                    ADLQ    1,DL
PL6.E3A0      #001=KIN$SEND File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:33 Page:31   
         2 000363   000011 736000                    QLS     9
         2 000364   100000 552110                    STBQ    0,'10'O,PR1

      240    10793    3                K$RWPARM.FUNCTION = %K_WRITE;

  10793  2 000365   000001 235007                    LDA     1,DL
         2 000366   000020 755100                    STA     16,,PR0

      241    10794    3                NHDR.DST_NSAP = KI$OSIROUTE.NSAP;

  10794  2 000367   000100 100500                    MLR     fill='000'O
         2 000370   300000 000026                    ADSC9   0,,PR3                   cn=0,n=22
         2 000371   100001 000026                    ADSC9   1,,PR1                   cn=0,n=22

      242    10795    3                NHDR.SRC_NSAP = KI$OSIROUTE.LNSAP;

  10795  2 000372   000100 100500                    MLR     fill='000'O
         2 000373   300007 400026                    ADSC9   7,,PR3                   cn=2,n=22
         2 000374   100006 400026                    ADSC9   6,,PR1                   cn=2,n=22

      243    10796
      244    10797    3                NHDR.TR_OPTIONS = K$RWPARM.FPT$->B$TR_OPTIONS;

  10797  2 000375   000017 474500                    LDP4    15,,PR0
         2 000376   000100 100500                    MLR     fill='000'O
         2 000377   400000 000024                    ADSC9   0,,PR4                   cn=0,n=20
         2 000400   100014 000024                    ADSC9   12,,PR1                  cn=0,n=20

      245    10798    3                K$RWPARM.FPT$ = ADDR(NIL);

  10798  2 000401   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 000402   000017 756100                    STQ     15,,PR0

      246    10799
      247    10800
      248    10801    4                IF KI$OSIROUTE.LNSAP.LEN=0 OR KI$OSIROUTE.LNSAP.AFI = 0 THEN DO;

PL6.E3A0      #001=KIN$SEND File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:33 Page:32   
  10801  2 000403   300007 236100                    LDQ     7,,PR3
         2 000404   777000 316007                    CANQ    -512,DL
         2 000405   000410 600000 2                  TZE     s:10802
         2 000406   000777 316007                    CANQ    511,DL
         2 000407   000415 601000 2                  TNZ     s:10809

      249    10802    4                     K$RWPARM.ERR = %K$USER_ERR;

  10802  2 000410   000010 235007                    LDA     8,DL
         2 000411   000013 755100                    STA     11,,PR0

      250    10803    4                     K$RWPARM.MSG_ERRCODE = ERR_BADLNSAP;

  10803  2 000412   000002 236000 1                  LDQ     ERR_BADLNSAP
         2 000413   000037 756100                    STQ     31,,PR0

      251    10804    4                     ALTRETURN;

  10804  2 000414   000000 702200 xent               TSX2  ! X66_AALT

      252    10805    4                     END;
      253    10806        /*
      254    10807              fill in network header with info from osiroute.
      255    10808        */
      256    10809    3                K$RWPARM.NHDRSZ = LENGTHC(NHDR);

  10809  2 000415   000104 235007                    LDA     68,DL
         2 000416   000027 755100                    STA     23,,PR0

      257    10810    3                K$RWPARM.NHDR$ = NHDR$;

  10810  2 000417   200111 236100                    LDQ     NHDR$,,AUTO
         2 000420   000026 756100                    STQ     22,,PR0

      258    10811    3                CALL KIQ$LINK(K$RWPARM) ALTRET(ERROR);

  10811  2 000421   200003 630500                    EPPR0   @K$RWPARM,,AUTO
PL6.E3A0      #001=KIN$SEND File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:33 Page:33   
         2 000422   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000423   000000 701000 xent               TSX1    KIQ$LINK
         2 000424   000475 702000 2                  TSX2    ERROR

      259    10812        /*
      260    10813              return to local fep number to transport for future reference.
      261    10814        */
      262    10815    3                K$RWPARM.LOCAL_FEP = KI$FEI$(K$RWPARM.FEX)->KI$FEI.FEP#;

  10815  2 000425   200003 470500                    LDP0    @K$RWPARM,,AUTO
         2 000426   000021 720100                    LXL0    17,,PR0
         2 000427   000000 471400 xsym               LDP1    KI_FEI$$
         2 000430   100000 473510                    LDP3    0,X0,PR1
         2 000431   300012 236100                    LDQ     10,,PR3
         2 000432   000011 772000                    QRL     9
         2 000433   000032 552104                    STBQ    26,'04'O,PR0

      263    10816    3                K$RWPARM.FEX = KI$FEI$(K$RWPARM.FEX)->KI$FEI.FEP#;

  10816  2 000434   000021 720100                    LXL0    17,,PR0
         2 000435   100000 473510                    LDP3    0,X0,PR1
         2 000436   300012 236100                    LDQ     10,,PR3
         2 000437   000011 772000                    QRL     9
         2 000440   000777 376007                    ANQ     511,DL
         2 000441   000021 756100                    STQ     17,,PR0

      264    10817    3                RETURN;

  10817  2 000442   000000 702200 xent               TSX2  ! X66_ARET

      265    10818    3                END;
      266    10819    3           ELSE DO;                        /* DST_ADDR$ = NIL                    */

      267    10820                  /* this is an error NCONNECT, but the destination
      268    10821                      address was not specified.*/
      269    10822    3                K$RWPARM.ERR = %K$USER_ERR;

PL6.E3A0      #001=KIN$SEND File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:33 Page:34   
  10822  2 000443   000010 235007                    LDA     8,DL
         2 000444   000013 755100                    STA     11,,PR0

      270    10823    3                K$RWPARM.MSG_ERRCODE = ERR_BADRNSAP;

  10823  2 000445   000001 236000 1                  LDQ     ERR_BADRNSAP
         2 000446   000037 756100                    STQ     31,,PR0

      271    10824    3                ALTRETURN;

  10824  2 000447   000000 702200 xent               TSX2  ! X66_AALT

      272    10825    3                END;
      273    10826    2           END;                            /* end else if NCONNECT               */
      274    10827    2      ELSE DO; /* must be either QDP or CP6_CL4 and k$rwparm.function = k_write*/

      275    10828    2           ROUTE$ = KI$ROUTE$(K$RWPARM.FEX);

  10828  2 000450   000021 720100                    LXL0    17,,PR0
         2 000451   000000 473400 xsym               LDP3    KI_ROUTE$$
         2 000452   300000 236110                    LDQ     0,X0,PR3
         2 000453   200007 756100                    STQ     ROUTE$,,AUTO

      276    10829    3           IF KI$ROUTE.FEI# = 0 THEN DO;

  10829  2 000454   200007 474500                    LDP4    ROUTE$,,AUTO
         2 000455   400002 236100                    LDQ     2,,PR4
         2 000456   777000 316003                    CANQ    -512,DU
         2 000457   000465 601000 2                  TNZ     s:10834

      277    10830    3                K$RWPARM.ERR = %K$USER_ERR;/* doubtful that we will ever get here */

  10830  2 000460   000010 235007                    LDA     8,DL
         2 000461   000013 755100                    STA     11,,PR0

      278    10831    3                K$RWPARM.MSG_ERRCODE = ERR_NOROUTE;

PL6.E3A0      #001=KIN$SEND File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:33 Page:35   
  10831  2 000462   000003 236000 1                  LDQ     ERR_NOROUTE
         2 000463   000037 756100                    STQ     31,,PR0

      279    10832    3                ALTRETURN;

  10832  2 000464   000000 702200 xent               TSX2  ! X66_AALT

      280    10833    3                END;
      281    10834    2           K$RWPARM.FEX = KI$ROUTE.FEI#;

  10834  2 000465   400002 236100                    LDQ     2,,PR4
         2 000466   000033 772000                    QRL     27
         2 000467   000021 756100                    STQ     17,,PR0

      282    10835    2           CALL KIQ$LINK(K$RWPARM) ALTRET(ERROR);

  10835  2 000470   200003 630500                    EPPR0   @K$RWPARM,,AUTO
         2 000471   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000472   000000 701000 xent               TSX1    KIQ$LINK
         2 000473   000475 702000 2                  TSX2    ERROR

      283    10836    2           RETURN;

  10836  2 000474   000000 702200 xent               TSX2  ! X66_ARET

  10834  2 000475                       ERROR        null
      284    10837    2           END;
      285    10838
      286    10839    1   ERROR:;
      287    10840    1      ALTRETURN;

  10840  2 000475   000000 702200 xent               TSX2  ! X66_AALT

INIT_NWK_HDR
 Sect OctLoc
   1     000   375000 001001                                                    ....

PL6.E3A0      #001=KIN$SEND File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:33 Page:36   
ERR_BADRNSAP
 Sect OctLoc
   1     001   131116 431630                                                    YN..

ERR_BADLNSAP
 Sect OctLoc
   1     002   131116 431640                                                    YN..

ERR_NOROUTE
 Sect OctLoc
   1     003   131116 431650                                                    YN..
      288    10841
      289    10842    1   END KIN$SEND;
      290    10843        %EOD;

PL6.E3A0      #001=KIN$SEND File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:33 Page:37   
--  Include file information  --

   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   K_INTERFACE_M.:E05TOU  is referenced.
   KI_ERRORS_C.:E05TOU  is referenced.
   K_SUBS_C.:E05TOU  is referenced.
   KNN_NETWORK_M.:E05TOU  is referenced.
   K_ADDRESS_M.:E05TOU  is referenced.
   KI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NK$LDCT.:E05TOU  is referenced.
   KI_MACROS_C.:E05TOU  is referenced.
   K_QDPHDRS_M.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
      No diagnostics issued in procedure KIN$SEND.
PL6.E3A0      #001=KIN$SEND File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:33 Page:38   

 **** Variables and constants ****

  ****  Section 001 RoData KIN$SEND

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     2-0-0/w STRC        r     1 ERR_BADLNSAP               1-0-0/w STRC        r     1 ERR_BADRNSAP
     3-0-0/w STRC        r     1 ERR_NOROUTE                0-0-0/w STRC        r     1 INIT_NWK_HDR

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @K$RWPARM                142-0-0/w UBIN        r     1 CQOS
     6-0-0/w PTR         r     1 FEI$                     112-0-0/b BIT         r     1 FOUNDONE
   113-0-0/w UBIN        r     1 I                        117-0-0/w UBIN        r     1 INDX(0:16)
   116-0-0/w UBIN        r     1 INX                      114-0-0/w UBIN        r     1 J
    *0-0-0/d STRC(1404)  r     1 K$RWPARM                 115-0-0/w UBIN        r     1 L
    11-0-0/c CHAR(255)   r     1 NBUFFER                  111-0-0/w PTR         r     1 NHDR$
    10-0-0/w UBIN        r     1 NHDRINDX                 141-0-0/w UBIN        r     1 NQOS
     4-0-0/w STRC        r     1 NWK_HDR                  140-0-0/w PTR         r     1 OSI$
     7-0-0/w PTR         r     1 ROUTE$                   144-0-0/w UBIN        r     1 SIZE
   143-0-0/w SBIN        r     1 SVINDX

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 KI_FEI$$                   0-0-0/w UBIN        r     1 KI_MXFE
     0-0-0/w UBIN        r     1 KI_NODES                   0-0-0/w UBIN        r     1 KI_OSIMAX#
     0-0-0/w PTR         r     1 KI_OSIROUTE$$              0-0-0/w PTR         r     1 KI_ROUTE$$
     0-0-0/w UBIN        r     1 K_NODE#

  ****  BASED and DCB variables  ****
PL6.E3A0      #001=KIN$SEND File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:33 Page:39   

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c ACHR        r     1 ADDRESS                    0-0-0/w STRC(180)   r     1 B$TR_OPTIONS
     0-0-0/c STRC(198)   r     1 DST                        0-0-0/w STRC(612)   r     1 KI$FEI
     0-0-0/w PTR         r     1 KI$FEI$(0:0)
     0-0-0/w STRC(612)   r     1 KI$OSIROUTE
     0-0-0/w PTR         r     1 KI$OSIROUTE$(0:0)
     0-0-0/w STRC(216)   r     1 KI$ROUTE
     0-0-0/w PTR         r     1 KI$ROUTE$(0:0)
     0-0-0/w STRC(612)   r     1 NHDR                       0-0-0/d STRC(864)   r     1 NK$LDCT


   Procedure KIN$SEND requires 318 words for executable code.
   Procedure KIN$SEND requires 104 words of local(AUTO) storage.
PL6.E3A0      #001=KIN$SEND File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:33 Page:40   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=KIN$SEND File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:33 Page:41   
          MINI XREF LISTING

ADDRESS
     10516**DCL     10730>>IF      10730>>IF
B$TR_OPTIONS
     10366**DCL     10797>>ASSIGN
B$TR_OPTIONS.TPDUSIZE
     10375**DCL     10376--REDEF
CQOS
      9412**DCL     10743<<ASSIGN  10750>>IF      10752<<ASSIGN
DST
     10261**DCL     10730--IF
DST.ADDRESS_N
     10293**DCL     10294--REDEF
DST.LEN
     10265**DCL     10730>>IF
ERROR
     10834**LABEL   10706--CALLALT 10811--CALLALT 10835--CALLALT
ERR_BADLNSAP
     10581**DCL     10803>>ASSIGN
ERR_BADRNSAP
     10531**DCL     10777>>ASSIGN  10823>>ASSIGN
ERR_NOROUTE
     10631**DCL     10698>>ASSIGN  10757>>ASSIGN  10769>>ASSIGN  10783>>ASSIGN  10831>>ASSIGN
FEI$
      9399**DCL      9829--IMP-PTR
FOUNDONE
      9404**DCL     10727<<ASSIGN  10732<<ASSIGN  10774>>IF
I
      9405**DCL     10728<<DOINDEX 10729>>ASSIGN
INDX
      9409**DCL     10737<<ASSIGN  10746>>ASSIGN
INIT_NWK_HDR
      9439**DCL     10671--ASSIGN  10674>>ASSIGN
PL6.E3A0      #001=KIN$SEND File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:33 Page:42   
INX
      9408**DCL     10734<<ASSIGN  10737>>ASSIGN  10738<<ASSIGN  10738>>ASSIGN  10742>>IF      10745>>DOINDEX
J
      9406**DCL     10733<<ASSIGN  10735>>DOWHILE 10736>>IF      10737>>ASSIGN  10740<<ASSIGN  10740>>ASSIGN
     10745<<DOINDEX 10746>>ASSIGN  10751>>ASSIGN
K$RWPARM
      9023**DCL        42--PROC    10706<>CALL    10811<>CALL    10835<>CALL
K$RWPARM.BLKREC
      9049**DCL      9074--REDEF
K$RWPARM.BLKREC.BLKU#
      9050**DCL      9052--REDEF
K$RWPARM.BLKREC.RECU#
      9062**DCL      9064--REDEF
K$RWPARM.DST_ADDR$
      9274**DCL     10261--IMP-PTR 10718>>IF      10730>>IF      10730>>IF
K$RWPARM.DVE.DVBYTE.VFC
      9089**DCL      9090--REDEF
K$RWPARM.DVE.EOMCHAR
      9097**DCL      9101--REDEF
K$RWPARM.ERR
      9161**DCL      9166--REDEF   10697<<ASSIGN  10756<<ASSIGN  10768<<ASSIGN  10776<<ASSIGN  10782<<ASSIGN
     10802<<ASSIGN  10822<<ASSIGN  10830<<ASSIGN
K$RWPARM.FC
      9125**DCL      9126--REDEF
K$RWPARM.FEX
      9207**DCL     10676>>ASSIGN  10692>>IF      10692>>IF      10703>>ASSIGN  10704<<ASSIGN  10704>>ASSIGN
     10762<<ASSIGN  10767<<ASSIGN  10775<<ASSIGN  10781>>IF      10815>>ASSIGN  10816<<ASSIGN  10816>>ASSIGN
     10828>>ASSIGN  10834<<ASSIGN
K$RWPARM.FLDID
      9307**DCL      9308--REDEF
K$RWPARM.FPT$
      9188**DCL      9195--REDEF   10797>>ASSIGN  10798<<ASSIGN
K$RWPARM.FUNCTION
      9202**DCL     10685>>IF      10705<<ASSIGN  10710>>IF      10793<<ASSIGN
K$RWPARM.KEYTYPE
      9314**DCL      9315--REDEF
PL6.E3A0      #001=KIN$SEND File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:33 Page:43   
K$RWPARM.LDCT$
      9184**DCL     10678>>IF      10680>>IF
K$RWPARM.LOCAL_FEP
      9254**DCL     10815<<ASSIGN
K$RWPARM.MSG$
      9024**DCL      9030--REDEF
K$RWPARM.MSGID
      9136**DCL      9141--REDEF
K$RWPARM.MSGIDXT
      9149**DCL      9153--REDEF
K$RWPARM.MSG_ERRCODE
      9284**DCL     10698<<ASSIGN  10757<<ASSIGN  10769<<ASSIGN  10777<<ASSIGN  10783<<ASSIGN  10803<<ASSIGN
     10823<<ASSIGN  10831<<ASSIGN
K$RWPARM.NHDR$
      9239**DCL     10672<<ASSIGN  10810<<ASSIGN
K$RWPARM.NHDRSZ
      9243**DCL     10671<<ASSIGN  10809<<ASSIGN
K$RWPARM.ORG
      9285**DCL      9286--REDEF
K$RWPARM.SRC_ADDR$
      9269**DCL     10313--IMP-PTR
K$RWPARM.THDRSZ
      9229**DCL      9233--REDEF
K$RWPARM.VDOFLGS
      9287**DCL      9298--REDEF
KI$FEI.BD$
      9864**DCL      9865--REDEF
KI$FEI.BDAD.WADDR
      9866**DCL      9867--REDEF
KI$FEI.FEP#
      9874**DCL     10815>>ASSIGN  10816>>ASSIGN
KI$FEI.RCVPB
      9880**DCL      9881--REDEF
KI$FEI$
      2034**DCL     10815>>ASSIGN  10816>>ASSIGN
KI$OSIROUTE.LINK.ACTIVE
PL6.E3A0      #001=KIN$SEND File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:33 Page:44   
      9786**DCL     10736>>IF
KI$OSIROUTE.LINK.FEP#
      9791**DCL     10747>>IF      10747>>IF      10749>>ASSIGN  10761>>ASSIGN  10792>>ASSIGN
KI$OSIROUTE.LNSAP
      9726**DCL     10795>>ASSIGN
KI$OSIROUTE.LNSAP.ADDRESS_N
      9756**DCL      9757--REDEF
KI$OSIROUTE.LNSAP.AFI
      9733**DCL     10801>>IF
KI$OSIROUTE.LNSAP.LEN
      9728**DCL     10801>>IF
KI$OSIROUTE.NSAP
      9636**DCL     10730--IF      10794>>ASSIGN
KI$OSIROUTE.NSAP.ADDRESS_N
      9666**DCL      9667--REDEF
KI$OSIROUTE.NSAP.LEN
      9638**DCL     10730>>IF
KI$OSIROUTE$
      9815**DCL     10729>>ASSIGN
KI$ROUTE.CURRENT_QOS
      9515**DCL     10749>>ASSIGN
KI$ROUTE.FEI#
      9510**DCL     10692>>IF      10704>>ASSIGN  10747>>IF      10762>>ASSIGN  10829>>IF      10834>>ASSIGN
KI$ROUTE$
      9497**DCL     10692>>IF      10704>>ASSIGN  10747>>IF      10749>>ASSIGN  10761>>ASSIGN  10828>>ASSIGN
KIQ$LINK
      9319**DCL-ENT 10706--CALL    10811--CALL    10835--CALL
KI_FEI$$
      2033**DCL      2034--IMP-PTR 10815>>ASSIGN  10816>>ASSIGN
KI_MXFE
      2042**DCL     10735>>DOWHILE
KI_NODES
      2041**DCL     10692>>IF      10747>>IF
KI_OSIMAX#
      2036**DCL     10728>>DOINDEX
KI_OSIROUTE$$
PL6.E3A0      #001=KIN$SEND File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:33 Page:45   
      2037**DCL      9815--IMP-PTR 10729>>ASSIGN
KI_ROUTE$$
      2035**DCL      9497--IMP-PTR 10692>>IF      10704>>ASSIGN  10747>>IF      10749>>ASSIGN  10761>>ASSIGN
     10828>>ASSIGN
K_NODE#
      9416**DCL     10675>>ASSIGN  10791>>ASSIGN
L
      9407**DCL     10746<<ASSIGN  10747>>IF      10747>>IF      10749>>ASSIGN
NBUFFER
      9402**DCL     10719--ASSIGN
NHDR
      9921**DCL     10809--ASSIGN
NHDR.DEST_NODE
      9942**DCL     10792<<ASSIGN
NHDR.DST_NSAP
      9973**DCL     10794<<ASSIGN
NHDR.DST_NSAP.ADDRESS_N
     10003**DCL     10004--REDEF
NHDR.MSGTYP
      9922**DCL     10721<<ASSIGN
NHDR.SOURCE_NODE
      9950**DCL     10791<<ASSIGN
NHDR.SRC_NSAP
     10031**DCL     10795<<ASSIGN
NHDR.SRC_NSAP.ADDRESS_N
     10061**DCL     10062--REDEF
NHDR.TR_OPTIONS
     10090**DCL     10797<<ASSIGN
NHDR.TR_OPTIONS.TPDUSIZE
     10097**DCL     10098--REDEF
NHDR$
      9403**DCL      9921--IMP-PTR 10719<<ASSIGN  10721>>ASSIGN  10791>>ASSIGN  10792>>ASSIGN  10794>>ASSIGN
     10795>>ASSIGN  10797>>ASSIGN  10810>>ASSIGN
NHDRINDX
      9401**DCL     10720<<ASSIGN
NK$LDCT.DDT$
PL6.E3A0      #001=KIN$SEND File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:33 Page:46   
      9567**DCL      9567--REDEF
NK$LDCT.IOQ$
      9566**DCL      9567--REDEF
NK$LDCT.LDCTX
      9568**DCL      9568--REDEF
NK$LDCT.LKFLG.ABORTED
      9580**DCL      9581--REDEF
NK$LDCT.LKFLG.QDPPATH
      9582**DCL     10680>>IF
NK$LDCT.RLCID.LDCTX
      9590**DCL      9590--REDEF
NK$LDCT.STA$
      9586**DCL      9587--REDEF
NK$LDCT.SYMB$
      9565**DCL      9565--REDEF    9565--REDEF    9566--REDEF
NQOS
      9411**DCL     10749<<ASSIGN  10750>>IF      10752>>ASSIGN
NWK_HDR
      9342**DCL     10672--ASSIGN  10674<<ASSIGN
NWK_HDR.DEST_NODE
      9363**DCL     10676<<ASSIGN  10703<<ASSIGN
NWK_HDR.MSGTYP
      9343**DCL     10681<<ASSIGN  10682<<ASSIGN  10702<<ASSIGN
NWK_HDR.SOURCE_NODE
      9369**DCL     10675<<ASSIGN
OSI$
      9410**DCL      9614--IMP-PTR 10729<<ASSIGN  10730>>IF      10730>>IF      10736>>IF      10747>>IF
     10747>>IF      10749>>ASSIGN  10761>>ASSIGN  10792>>ASSIGN  10794>>ASSIGN  10795>>ASSIGN  10801>>IF
     10801>>IF
OSIRTE
     10728**LABEL   10763--EXIT
ROUTE$
      9400**DCL      9499--IMP-PTR 10761<<ASSIGN  10762>>ASSIGN  10828<<ASSIGN  10829>>IF      10834>>ASSIGN
SIZE
      9414**DCL     10516--IMP-SIZ 10730>>IF      10730>>IF
SRC.ADDRESS_N
PL6.E3A0      #001=KIN$SEND File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:33 Page:47   
     10345**DCL     10346--REDEF
SVINDX
      9413**DCL     10744<<ASSIGN  10751<<ASSIGN  10755>>IF      10761>>ASSIGN  10792>>ASSIGN

PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:48   
      291        1        /*T***********************************************************/
      292        2        /*T*                                                         */
      293        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      294        4        /*T*                                                         */
      295        5        /*T***********************************************************/
      296        6        /*F* NAME: KIN$RECV Inbound Messages
      297        7
      298        8        KIN$RECV is the interface for the lower layers to pass
      299        9        the incoming messages up to the user through the network layer.
      300       10        This routine is called form KIQ$ISCAN with the following parameters:
      301       11
      302       12        .fif
      303       13        }    K$RWPARM.FUNCTION
      304       14        }            - The function to be performed.  This will be one of the
      305       15        }              folowing EQUed values from the file K_SUBS_C:
      306       16        }                  K_RECV
      307       17        }                  K_CONNECT
      308       18        }                  K_REPDISC
      309       19        }
      310       20        }
      311       21        }    K$RWPARM    -
      312       22        }               .FEX contains the index into the FEI context table
      313       23        }               .IP$ contains the address of the message in the queue
      314       24        }               .NHDR$ contains the address of the message network header
      315       25        }               .NHDRSZ contains the byte size of the message network header
      316       26        }
      317       27        .fin
      318       28        The action to be taken is dependent on the function code.
      319       29        */
      320       30        %EJECT;
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:49   
      321       31
      322       32        KIN$RECV: PROC (K$RWPARM) ALTRET;
      323       33
      324       34        %INCLUDE K_QDPHDRS_M;
      325      916        %INCLUDE KI_MACROS_C;
      326     1524        %INCLUDE K_SUBS_C;
      327     1557        %INCLUDE K$RWPARM;
      328     1943        %INCLUDE NK$LDCT;
      329     2045        %INCLUDE K_ADDRESS_M;
      330     2548        %INCLUDE K_NETWORK_M;
      331     2817        %INCLUDE K_NETWORK_E;
      332     2906        %INCLUDE KL_MACRO_C;
      333     6258        %INCLUDE KNN_NETWORK_M;
      334     6621        %INCLUDE K_INTERFACE_M;
      335     7030
      336     7031        /* Parameters                         */
      337     7032        %K$RWPARM (NAME=K$RWPARM);
      338     7348
      339     7349                                                /* Entry references                   */
      340     7350    1   DCL KIN$UPDATE_ROUTE ENTRY ALTRET;
      341     7351    1   DCL KIS$RECV ENTRY(1) ALTRET;
      342     7352    1   DCL KIT$RECV ENTRY(1) ALTRET;
      343     7353    1   DCL KIQ$LINK ENTRY(2) ALTRET;
      344     7354    1   DCL SC_PRTCL_SNAP ENTRY CONV(2,0);
      345     7355
      346     7356                                                /* Auto                               */
      347     7357    1   DCL FUNCTION UBIN;                      /* k$rwparam.paramer.function         */
      348     7358    1   DCL FEI UBIN;                           /* k$rwparam.paramer.fex              */
      349     7359    1   DCL FEI# UBIN;
      350     7360    1   DCL I SBIN;
      351     7361    1   DCL J SBIN;
      352     7362    1   DCL NODE# SBIN;
      353     7363    1   DCL TEMP UBIN;
      354     7364    1   DCL FEI$ PTR;
      355     7365    1   DCL OSI$ PTR;
      356     7366    1   DCL ROUTE$ PTR;
      357     7367    1   DCL SIZE UBIN;
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:50   
      358     7368    1   DCL LI SBIN;
      359     7369    1   DCL SEGLENGTH UBIN(18);
      360     7370    1   DCL DATASIZE UBIN(18);
      361     7371    1   DCL CURINDX UBIN;
      362     7372    1   DCL FIXEDSIZ UBIN;
      363     7373    1   DCL DSTINDX UBIN;
      364     7374    1   DCL SRCINDX UBIN;
      365     7375    1   DCL D$ PTR;
      366     7376    1   DCL OPTSZ UBIN;
      367     7377    1   DCL CODE UBIN;
      368     7378    1   DCL OPTVAL UBIN;
      369     7379        %K$NPDU_SEGMENT(NAME=SEGMENT,STCLASS=AUTO);
      370     7431        %KL_UPDOSI(FPTN=ROUTE,STCLASS=AUTO);
      371     7640                                                /* Based structures                   */
      372     7641
      373     7642    1   DCL KI$ROUTE$(0:0) PTR BASED(KI_ROUTE$$);
      374     7643    1   DCL KI$OSIROUTE$(0:0) PTR BASED(KI_OSIROUTE$$);
      375     7644        %KI$FEI (STCLASS="BASED(FEI$)");
      376     7728        %KI$ROUTE (STCLASS="BASED(ROUTE$)");
      377     7782        %KNN$OSIROUTE(FPTN=KI$OSIROUTE,STCLASS="BASED(OSI$)");
      378     7999
      379     8000        %K$NQDP_HDR (NAME=B$QDP_NHDR, STCLASS="BASED(K$RWPARM.NHDR$)", ALGN=ALIGNED);
      380     8077        %K$NQDP_HDR (NAME=B$QDP_NOSIHDR, MSGTYPE = OSI_INIT,STCLASS="BASED(K$RWPARM.NHDR$)",
              8077            ALGN=ALIGNED,ADRTYP=NET);
      381     8422        %K$NPDU_FIXED(STCLASS="BASED(K$RWPARM.NHDR$)");
      382     8479        %K$NPDU_SEGMENT;
      383     8531        %K$NSAP(FPTN=DST,STCLASS="BASED(K$RWPARM.DST_ADDR$)",ADRTYP=NET);
      384     8583        %K$NSAP(FPTN=SRC,STCLASS="BASED(K$RWPARM.SRC_ADDR$)",ADRTYP=NET);
      385     8635        %NK$LDCT;
      386     8681    1   DCL NK$LDCT$(0:0) PTR BASED(N$DCT$$);
      387     8682    1   DCL KI$FEI$(0:0) PTR BASED(KI_FEI$$);
      388     8683    1   DCL CHR(0:3) CHAR(1) BASED;
      389     8684    1   DCL ADDRESS CHAR(SIZE) BASED CALIGNED;
      390     8685    1   DCL 1 BSDHLFWRD BASED HALIGNED,
      391     8686    1         2 * BIT(2) UNAL,
      392     8687    1         2 BITS2TO9 UBIN(8) UNAL,
      393     8688    1         2 BITS10TO17 UBIN(8) UNAL;
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:51   
      394     8689                                                /* External Data                      */
      395     8690    1   DCL K_NODE# UBIN SYMREF;
      396     8691    1   DCL N$DCT$$ PTR SYMREF;
      397     8692    1   DCL KI_FEI$$ PTR SYMREF;
      398     8693    1   DCL KI_ROUTE$$ PTR SYMREF;
      399     8694    1   DCL KI_NODES UBIN SYMREF;
      400     8695    1   DCL KI_LIFETIME UBIN(18) SYMREF;
      401     8696    1   DCL KI_DATAID UBIN BYTE SYMREF;
      402     8697    1   DCL KI_OSIROUTE$$ PTR SYMREF;
      403     8698    1   DCL KI_OSIMAX# UBIN SYMREF;
      404     8699    1   DCL KI_MXFE UBIN SYMREF;
      405     8700
      406     8701        %EJECT;
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:52   
      407     8702        /*F* NAME: KIN$RECV - Data Received Function
      408     8703
      409     8704        KIN$RECV is called with FUNCTION set to K_RECV from KIQ$ISCAN
      410     8705        when the scan routine has found a message in the queue with function
      411     8706        of KJ_FCN_DATA.
      412     8707
      413     8708        If the destination of the message is not on this host, KIN$RECV
      414     8709        simply bumps the hop count in the network header of the message,
      415     8710        increments the messages in and messages out counters in the route
      416     8711        tables and forwards the message by calling KIQ$LINK.
      417     8712
      418     8713        When the message does belong to a user on this host, this routine
      419     8714        updates the session/transport header address and size values in K$RWPARM
      420     8715        to reflect the stripping off of the network header and passess
      421     8716        the message on up the layers by calling KIS$RECV for QDP type messages
      422     8717        or by calling KIT$RECV for OSI type messages.
      423     8718        */
      424     8719    1      FEI = K$RWPARM.FEX;
      425     8720    1      FEI$ = KI$FEI$(FEI);
      426     8721
      427     8722    1      IF K$RWPARM.FUNCTION = %K_RECV
      428     8723    2      THEN DO;
      429     8724
      430     8725    2           IF B$QDP_NHDR.MSGTYP = %K_MSGTYP_OSI_INIT# OR
      431     8726    3             B$QDP_NHDR.MSGTYP = %K_MSGTYP_OSI_DATA# THEN DO;
      432     8727    3                IF B$QDP_NHDR.DEST_NODE ~= K_NODE#+1 THEN /* not for this node*/
      433     8728    3                     RETURN;               /* just dump the message for now      */
      434     8729
      435     8730
      436     8731    3                K$RWPARM.FUNCTION = %K_NDATA;
      437     8732    3                IF B$QDP_NHDR.MSGTYP = %K_MSGTYP_OSI_INIT#
      438     8733    4                THEN DO;
      439     8734    4                     K$RWPARM.DST_ADDR$ = ADDR(B$QDP_NOSIHDR.DST_NSAP);
      440     8735    4                     K$RWPARM.SRC_ADDR$ = ADDR(B$QDP_NOSIHDR.SRC_NSAP);
      441     8736    4                     K$RWPARM.THDRSZ = K$RWPARM.NHDRSZ - LENGTHC(B$QDP_NOSIHDR);
      442     8737    4                     K$RWPARM.THDR$ = PINCRC(K$RWPARM.NHDR$,K$RWPARM.NHDRSZ -
      443     8738    4                       K$RWPARM.THDRSZ);
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:53   
      444     8739    4                     END;
      445     8740    4                ELSE DO;
      446     8741    4                     K$RWPARM.DST_ADDR$ = ADDR(NIL);
      447     8742    4                     K$RWPARM.SRC_ADDR$ = ADDR(NIL);
      448     8743    4                     K$RWPARM.THDRSZ = K$RWPARM.NHDRSZ - LENGTHC(B$QDP_NHDR);
      449     8744    4                     K$RWPARM.THDR$ = PINCRC(K$RWPARM.NHDR$,LENGTHC(B$QDP_NHDR));
      450     8745    4                     END;
      451     8746        /*
      452     8747             tell transport the local fep number this message hailed from
      453     8748        */
      454     8749    3                K$RWPARM.FEX = KI$FEI.FEP#;
      455     8750    3                K$RWPARM.LOCAL_FEP = KI$FEI.FEP#;
      456     8751    3                CALL KIT$RECV(K$RWPARM) ALTRET (DO_ALTRET);
      457     8752    3                RETURN;
      458     8753    3                END;                       /* if osi_data or osi_init            */
      459     8754
      460     8755    3           IF B$QDP_NHDR.MSGTYP = %K_MSGTYP_OSI# THEN DO; /* true osi connectionless */
      461     8756        /*
      462     8757             this type of message is just being routed thru this node.
      463     8758        */
      464     8759
      465     8760    3                SIZE = K$RWPARM.NHDRSZ;
      466     8761
      467     8762    3                IF SIZE < LENGTHC(K$NPDU_FIXED) THEN
      468     8763    3                     RETURN;
      469     8764
      470     8765    3                LI = K$NPDU_FIXED.LENGTH;
      471     8766    3                IF LI > SIZE THEN
      472     8767    3                     RETURN;
      473     8768
      474     8769    3                SEGLENGTH = K$NPDU_FIXED.SEGLENX*256 + K$NPDU_FIXED.SEGLENY;
      475     8770    3                IF SIZE ~= SEGLENGTH THEN
      476     8771    3                     RETURN;
      477     8772
      478     8773    3                DATASIZE = SEGLENGTH - LI;
      479     8774    3                LI = LI - LENGTHC(K$NPDU_FIXED);
      480     8775    3                FIXEDSIZ = LENGTHC(K$NPDU_FIXED);
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:54   
      481     8776    3                CURINDX = FIXEDSIZ;
      482     8777
      483     8778    3                ADDR(DST.LEN)->CHR(0) = SUBSTR(ADDR(K$NPDU_FIXED)->ADDRESS,CURINDX,1);
      484     8779    3                IF DST.LEN > LI THEN
      485     8780    3                     RETURN;
      486     8781
      487     8782    3                D$ = ADDR(DST);
      488     8783    3                DSTINDX = CURINDX + 1; /* save the start of the destination address */
      489     8784    4                DO I = 1 TO DST.LEN;
      490     8785    4                     SUBSTR(D$->ADDRESS,I,1) = SUBSTR(ADDR(K$NPDU_FIXED)->ADDRESS,
              8785                              CURINDX+I,1);
      491     8786    4                     END;
      492     8787    3                CURINDX = CURINDX + I;
      493     8788
      494     8789    3                LI = LI - (DST.LEN+1);
      495     8790
      496     8791    3                ADDR(SRC.LEN)->CHR(0) = SUBSTR(ADDR(K$NPDU_FIXED)->ADDRESS,CURINDX,1);
      497     8792    3                SRCINDX = CURINDX+1;  /* save the start of the source address    */
      498     8793
      499     8794    3                IF SRC.LEN > LI THEN
      500     8795    3                     RETURN;
      501     8796
      502     8797    3                D$ = ADDR(SRC);
      503     8798    4                DO I = 1 TO SRC.LEN;
      504     8799    4                     SUBSTR(D$->ADDRESS,I,1) = SUBSTR(ADDR(K$NPDU_FIXED)->ADDRESS,
              8799                              CURINDX+I,1);
      505     8800    4                     END;
      506     8801
      507     8802    3                CURINDX = CURINDX + I;
      508     8803
      509     8804    3                LI = LI - (SRC.LEN+1);
      510     8805
      511     8806        /*
      512     8807             The address are now ready to use.  From now on we can send error pdus
      513     8808             set up netparm to send errcode.
      514     8809        */
      515     8810
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:55   
      516     8811    3                K$RWPARM.DST_ADDR$ = ADDR(DST);
      517     8812    3                K$RWPARM.SRC_ADDR$ = ADDR(SRC);
      518     8813
      519     8814    3                IF K$NPDU_FIXED.PROTOCOLID ~= %K_PRTCL_ID OR
      520     8815    4                  K$NPDU_FIXED.VERSION ~= %K_PRTCL_ID_EXT THEN DO;
      521     8816    4                     K$RWPARM.ERR = %K_DSCRD_HDRSNTX;
      522     8817    4                     K$RWPARM.RECTYPE = LENGTHC(K$NPDU_FIXED);
      523     8818    4                     CALL SENDERR(K$RWPARM);
      524     8819    4                     RETURN;
      525     8820    4                     END;
      526     8821
      527     8822
      528     8823    4                IF K$NPDU_FIXED.MS AND K$NPDU_FIXED.SP = '0'B THEN DO;
      529     8824    4                     K$RWPARM.ERR = %K_DSCRD_CANTSEG;
      530     8825    4                     K$RWPARM.RECTYPE = LENGTHC(K$NPDU_FIXED);
      531     8826    4                     CALL SENDERR(K$RWPARM);
      532     8827    4                     RETURN;
      533     8828    4                     END;
      534     8829
      535     8830    4                IF K$NPDU_FIXED.SP = '0'B THEN DO;
      536     8831    4                     SEGMENT.TOTLEN.BYT(0) = ADDR(SEGLENGTH)->BSDHLFWRD.BITS2TO9;
      537     8832    4                     SEGMENT.TOTLEN.BYT(1) = ADDR(SEGLENGTH)->BSDHLFWRD.BITS10TO17;
      538     8833    4                     SEGMENT.DATAID = '0'B;
      539     8834    4                     SEGMENT.OFFSET = '0'B;
      540     8835    4                     END;
      541     8836    4                ELSE DO;
      542     8837    5                     IF LI < LENGTHC(K$NPDU_SEGMENT) THEN DO;
      543     8838    5                          K$RWPARM.ERR = %K_DSCRD_HDRSNTX;
      544     8839    5                          K$RWPARM.RECTYPE = LENGTHC(K$NPDU_FIXED);
      545     8840    5                          CALL SENDERR(K$RWPARM);
      546     8841    5                          RETURN;
      547     8842    5                          END;
      548     8843        /*
      549     8844             segment part at this point has got to be present.  otherwise we would have
      550     8845             returned.
      551     8846        */
      552     8847    5                     DO I = 0 TO LENGTHC(K$NPDU_SEGMENT)-1;
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:56   
      553     8848    5                          SUBSTR(ADDR(SEGMENT.DATAID)->ADDRESS,I,1) =
      554     8849    5                            SUBSTR(ADDR(K$NPDU_FIXED)->ADDRESS,CURINDX+I,1);
      555     8850    5                          END;
      556     8851
      557     8852    4                     CURINDX = LENGTHC(K$NPDU_SEGMENT);
      558     8853    4                     LI = LI - LENGTHC(SEGMENT);
      559     8854    4                     END;
      560     8855
      561     8856    4                IF K$NPDU_FIXED.LIFETIME = 0 THEN DO;
      562     8857    4                     K$RWPARM.ERR = %K_DSCRD_LIFEEXPTRAN;
      563     8858    4                     K$RWPARM.RECTYPE = LENGTHC(K$NPDU_FIXED);
      564     8859    4                     CALL SENDERR(K$RWPARM);
      565     8860    4                     RETURN;
      566     8861    4                     END;
      567     8862
      568     8863        /*
      569     8864             parse the options.
      570     8865        */
      571     8866
      572     8867
      573     8868    4                DO WHILE LI > 2;
      574     8869    4                     ADDR(CODE)->CHR(0) = SUBSTR(ADDR(K$NPDU_FIXED)->ADDRESS,CURINDX,1)
              8869                              ;
      575     8870    4                     CURINDX = CURINDX + 1;
      576     8871    4                     ADDR(OPTSZ)->CHR(0) = SUBSTR(ADDR(K$NPDU_FIXED)->ADDRESS,CURINDX,1
              8871                              );
      577     8872    4                     CURINDX = CURINDX + 1;
      578     8873    4                     LI = LI-2-OPTSZ;
      579     8874    5                     IF LI < 0 THEN DO;
      580     8875    5                          K$RWPARM.ERR = %K_DSCRD_HDRSNTX;
      581     8876    5                          K$RWPARM.RECTYPE = LENGTHC(K$NPDU_FIXED);
      582     8877    5                          CALL SENDERR(K$RWPARM);
      583     8878    5                          RETURN;
      584     8879    5                          END;
      585     8880
      586     8881    5                     DO CASE(CODE);
      587     8882
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:57   
      588     8883    5                      CASE(%K_NPRM_PAD);
              8883                               /* pad characters to get header to a byte boundry*/
      589     8884
      590     8885    5                      CASE(%K_NPRM_SEC);   /* security                           */
      591     8886    5                        K$RWPARM.ERR = %K_DSCRD_OPTSEC;
      592     8887    5                        K$RWPARM.RECTYPE = LENGTHC(K$NPDU_FIXED);
      593     8888    5                        CALL SENDERR(K$RWPARM);
      594     8889    5                        RETURN;
      595     8890
      596     8891    5                      CASE(%K_NPRM_SRCRTE); /* source routing                    */
      597     8892    5                        ADDR(OPTVAL)->CHR(0) = SUBSTR(ADDR(K$NPDU_FIXED)->ADDRESS,
              8892                                 CURINDX,1);
      598     8893        /*
      599     8894                partial source routing options are accepted but not implemented.
      600     8895                complete source routing pdus are discarded.
      601     8896        */
      602     8897    6                        IF OPTVAL ~= %K_NPRM_SRCRTE_PSR THEN DO;
      603     8898    6                             K$RWPARM.ERR = %K_DSCRD_OPTSRCRTE;
      604     8899    6                             K$RWPARM.RECTYPE = LENGTHC(K$NPDU_FIXED);
      605     8900    6                             CALL SENDERR(K$RWPARM);
      606     8901    6                             RETURN;
      607     8902    6                             END;
      608     8903
      609     8904    5                      CASE(%K_NPRM_RECRTE); /* record route                      */
      610     8905    5                        ADDR(OPTVAL)->CHR(0) = SUBSTR(ADDR(K$NPDU_FIXED)->ADDRESS,
              8905                                 CURINDX,1);
      611     8906    6                        IF OPTVAL ~= %K_NPRM_RECRTE_PRR THEN DO;
      612     8907    6                             K$RWPARM.ERR = %K_DSCRD_OPTRECRTE;
      613     8908    6                             K$RWPARM.RECTYPE = LENGTHC(K$NPDU_FIXED);
      614     8909    6                             CALL SENDERR(K$RWPARM);
      615     8910    6                             RETURN;
      616     8911    6                             END;
      617     8912
      618     8913    5                      CASE(%K_NPRM_QOS);
      619     8914
      620     8915    5                      CASE(%K_NPRM_PRIO);
      621     8916
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:58   
      622     8917    5                      CASE(ELSE);
      623     8918    5                        K$RWPARM.ERR = %K_DSCRD_OPTNON;
      624     8919    5                        K$RWPARM.RECTYPE = LENGTHC(K$NPDU_FIXED);
      625     8920    5                        CALL SENDERR(K$RWPARM);
      626     8921    5                        RETURN;
      627     8922
      628     8923    5                        END;               /* case                               */
      629     8924    4                     CURINDX = CURINDX + OPTSZ;
      630     8925    4                     END;                  /* do while                           */
      631     8926
      632     8927    3                CALL DECODE_ADDR(DST,ROUTE);
      633     8928
      634     8929    4                IF ROUTE.QOS = 255 THEN DO; /* no route available                */
      635     8930    4                     K$RWPARM.ERR = %K_DSCRD_DSTUNREACH;
      636     8931    4                     K$RWPARM.RECTYPE = LENGTHC(K$NPDU_FIXED)+DST.LEN;
      637     8932    4                     CALL SENDERR(K$RWPARM);
      638     8933    4                     RETURN;
      639     8934    4                     END;
      640     8935          /*
      641     8936             if a route exists then forward the message to that node.
      642     8937          */
      643     8938    4                IF ROUTE.NODE# > KI_NODES THEN DO;
      644     8939    4                     K$RWPARM.ERR = %K_DSCRD_DSTUNKNWN;
      645     8940    4                     K$RWPARM.RECTYPE = LENGTHC(K$NPDU_FIXED)+DST.LEN;
              8940                              /* offset to err*/
      646     8941    4                     CALL SENDERR(K$RWPARM);
      647     8942    4                     RETURN;
      648     8943    4                     END;
      649     8944
      650     8945    3                ROUTE$ = KI$ROUTE$(ROUTE.NODE#);
      651     8946    4                IF KI$ROUTE.FEI# = 0 THEN DO;
      652     8947    4                     K$RWPARM.ERR = %K_DSCRD_DSTUNREACH;
      653     8948    4                     K$RWPARM.RECTYPE = LENGTHC(K$NPDU_FIXED)+DST.LEN;
      654     8949    4                     CALL SENDERR(K$RWPARM);
      655     8950    4                     RETURN;
      656     8951    4                     END;
      657     8952
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:59   
      658     8953    3                K$RWPARM.FEX = KI$ROUTE.FEI#;
      659     8954
      660     8955    3                K$RWPARM.FUNCTION = %K_WRITE;
      661     8956    3                K$RWPARM.UHDRSZ = 0;
      662     8957    3                K$RWPARM.SHDRSZ = 0;
      663     8958    3                K$RWPARM.THDRSZ = 0;
      664     8959    3                K$RWPARM.MSGSZ = 0;
      665     8960    3                CALL KIQ$LINK(K$RWPARM) ALTRET(DO_ALTRET);
      666     8961    3                KI$ROUTE.LINK.MSGS_IN(FEI) = KI$ROUTE.LINK.MSGS_IN(FEI) + 1;
      667     8962    3                KI$ROUTE.LINK.MSGS_OUT(KI$ROUTE.FEI#) = KI$ROUTE.LINK.MSGS_OUT(KI$ROUTE
              8962                         .FEI#) + 1;
      668     8963    3                RETURN;
      669     8964    3                END;                       /* if                                 */
      670     8965    2           IF B$QDP_NHDR.MSGTYP ~= %K_MSGTYP_CP6_CL4# AND
      671     8966    3             B$QDP_NHDR.MSGTYP ~= %K_MSGTYP_CP6_QDP# THEN DO;
      672     8967    3                CALL SC_PRTCL_SNAP;
      673     8968    3                RETURN;
      674     8969    3                END;
      675     8970    2           K$RWPARM.SHDRSZ = K$RWPARM.NHDRSZ - LENGTHC(B$QDP_NHDR);
      676     8971    2           IF K$RWPARM.SHDRSZ <= 0 THEN RETURN; /* ??                            */
      677     8972
      678     8973    2           NODE# = B$QDP_NHDR.SOURCE_NODE -1;
      679     8974    2           ROUTE$ = KI$ROUTE$(B$QDP_NHDR.DEST_NODE - 1);
      680     8975
      681     8976    2           IF B$QDP_NHDR.DEST_NODE - K_NODE# ~= 1
      682     8977    3           THEN DO;
      683     8978    3                FEI# = KI$ROUTE.FEI#;
      684     8979    3                IF FEI# = 0                /* No route associated                */
      685     8980    3                THEN RETURN;
      686     8981
      687     8982    3                IF B$QDP_NHDR.HOP_COUNT = 15
      688     8983    3                THEN RETURN;
      689     8984
      690     8985    3                B$QDP_NHDR.HOP_COUNT = B$QDP_NHDR.HOP_COUNT + 1;
      691     8986    3                K$RWPARM.UHDRSZ = 0;
      692     8987    3                K$RWPARM.SHDRSZ = 0;
      693     8988    3                K$RWPARM.THDRSZ = 0;
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:60   
      694     8989    3                K$RWPARM.MSGSZ = 0;
      695     8990
      696     8991    3                K$RWPARM.FUNCTION = %K_WRITE;
      697     8992    3                K$RWPARM.FEX = FEI#;
      698     8993    3                CALL KIQ$LINK (K$RWPARM) ALTRET(DO_ALTRET);
      699     8994
      700     8995    3                KI$ROUTE.LINK.MSGS_IN(FEI) = KI$ROUTE.LINK.MSGS_IN(FEI) + 1;
      701     8996    3                KI$ROUTE.LINK.MSGS_OUT(FEI#) = KI$ROUTE.LINK.MSGS_OUT(FEI#) + 1;
      702     8997    3                RETURN;
      703     8998    3                END/*do if not this node*/;
      704     8999
      705     9000        /* Its for this host node.
      706     9001        */
      707     9002    2           K$RWPARM.SHDR$ = PINCRC(K$RWPARM.NHDR$,LENGTHC(B$QDP_NHDR));
      708     9003    2           K$RWPARM.FEX = NODE#;
      709     9004
      710     9005    2           IF KI$ROUTE$(NODE#)->KI$ROUTE.FEI# = 0
      711     9006    3           THEN DO;
      712     9007    3                KI$ROUTE$(NODE#)->KI$ROUTE.LINK.QOS(FEI) = 254;
      713     9008    3                CALL KIN$UPDATE_ROUTE ALTRET(DO_ALTRET);
      714     9009    3                END;
      715     9010
      716     9011        /* Pass the message on up to qdp type session or to transport.
      717     9012        */
      718     9013    2           IF B$QDP_NHDR.MSGTYP = %K_MSGTYP_CP6_QDP#
      719     9014    3           THEN DO;
      720     9015    3                K$RWPARM.THDR$ = ADDR(NIL);
      721     9016    3                K$RWPARM.THDRSZ = 0;
      722     9017    3                CALL KIS$RECV(K$RWPARM) ALTRET(CHECK_ERR);
      723     9018    3                END;
      724     9019
      725     9020    3           ELSE DO;
      726     9021    3                K$RWPARM.LOCAL_FEP = KI$FEI.FEP#;
      727     9022    3                K$RWPARM.THDR$ = K$RWPARM.SHDR$;
      728     9023    3                K$RWPARM.THDRSZ = K$RWPARM.SHDRSZ;
      729     9024    3                CALL KIT$RECV(K$RWPARM)
      730     9025    4                WHENALTRETURN DO;
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:61   
      731     9026    4   CHECK_ERR:        ;
      732     9027    4                     IF K$RWPARM.ERR = %K$WAIT_READ
      733     9028    4                     THEN KI$ROUTE.LINK.MSGS_IN(FEI) = KI$ROUTE.LINK.MSGS_IN(FEI) + 1;
      734     9029    4                     ALTRETURN;
      735     9030    4                     END;
      736     9031    3                END/*do if not qdp*/;
      737     9032
      738     9033    2           KI$ROUTE.LINK.MSGS_IN(FEI) = KI$ROUTE.LINK.MSGS_IN(FEI) + 1;
      739     9034
      740     9035    2           RETURN;
      741     9036    2           END/*do if k_recv*/;
      742     9037
      743     9038
      744     9039        %EJECT;
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:62   
      745     9040        /*F* NAME: KIN$RECV - Report Disconnect
      746     9041
      747     9042        KIN$RECV is called with FUNCTION set to K_REPDISC from KIQ$FEABT.
      748     9043
      749     9044        The LINK_CONNECTED bit in the Route Table entry for this node is reset
      750     9045        and the QOS for the link entry in each route table is set to 255.
      751     9046
      752     9047        A call is made to update_route to recalculate the network routing.
      753     9048        */
      754     9049
      755     9050
      756     9051    1      IF K$RWPARM.FUNCTION = %K_REPDISC
      757     9052    2      THEN DO;
      758     9053    2           KI$ROUTE$(KI$FEI.FEP#)->KI$ROUTE.LINK_CONNECTED = '0'B;
      759     9054
      760     9055    3           DO I = 0 TO KI_NODES;
      761     9056    3                KI$ROUTE$(I)->KI$ROUTE.LINK.QOS(FEI) = 255;
      762     9057    3                END;
      763     9058
      764     9059    2           CALL KIN$UPDATE_ROUTE ALTRET(DO_ALTRET);
      765     9060    2           RETURN;
      766     9061    2           END;
      767     9062
      768     9063        %EJECT;
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:63   
      769     9064        /*F* NAME: KIN$RECV - Connection Request
      770     9065
      771     9066        KIN$RECV is called with FUNCTION set to K_CONNECT from KIQ$FEINT.
      772     9067
      773     9068        The LINK_CONNECTED bit in the Route Table entry for this node is
      774     9069        turned on.
      775     9070
      776     9071        A call is made to update_route to recalculate the network routing.
      777     9072
      778     9073        */
      779     9074
      780     9075    1      IF K$RWPARM.FUNCTION = %K_CONNECT
      781     9076    2      THEN DO;
      782     9077    3           DO I = 0 TO KI_NODES;
      783     9078    3                IF I = KI$FEI.FEP#         /* Going to same node                 */
      784     9079    4                THEN DO;
      785     9080    4                     KI$ROUTE$(I)->KI$ROUTE.LINK.QOS(FEI) = KI$FEI.QOS;
      786     9081    4                     KI$ROUTE$(I)->KI$ROUTE.LINK_CONNECTED = '1'B;
      787     9082    4                     END;
      788     9083    3                ELSE KI$ROUTE$(I)->KI$ROUTE.LINK.QOS(FEI)= 255;
      789     9084
      790     9085    3                KI$ROUTE$(I)->KI$ROUTE.LINK.MSGS_IN(FEI) = 0;
      791     9086    3                KI$ROUTE$(I)->KI$ROUTE.LINK.MSGS_OUT(FEI) = 0;
      792     9087
      793     9088    3                END/*do 0 to ki_nodes*/;
      794     9089
      795     9090    2           CALL KIN$UPDATE_ROUTE ALTRET(DO_ALTRET);
      796     9091    2           RETURN;
      797     9092    2           END/*do if k_connect*/;
      798     9093
      799     9094
      800     9095    1   DO_ALTRET: ;
      801     9096    1      ALTRETURN;
      802     9097        %EJECT;
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:64   
      803     9098    1   SENDERR: PROC(K$RWPARM) ALTRET;
      804     9099
      805     9100        %K$RWPARM(NAME=K$RWPARM,STCLASS="");
      806     9416
      807     9417
      808     9418        %KL_UPDOSI(FPTN=ROUTE,STCLASS=AUTO);
      809     9627        %K$NPDU_FIXED(NAME=FIXED,STCLASS=AUTO);
      810     9684    2   DCL SIZE UBIN BYTE;
      811     9685    2   DCL TSIZE UBIN BYTE;
      812     9686
      813     9687    2   DCL ADDRESS CHAR(SIZE) BASED ALIGNED;
      814     9688
      815     9689
      816     9690
      817     9691        %EJECT;
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:65   
      818     9692
      819     9693
      820     9694    2      IF K$NPDU_FIXED.TYPE = %K_ER_PDU OR NOT K$NPDU_FIXED.ER THEN
      821     9695    2           RETURN;
              9695                    /* dont generate errors if they dont want them.  dont generate errors
      822     9696                      on errors */
      823     9697
      824     9698    2      CURINDX = LENGTHC(K$NPDU_FIXED);
      825     9699
      826     9700    2      SIZE = K$RWPARM.RECTYPE;   /* a sleaze, really contains offset to error    */
      827     9701    2      FIXED.PROTOCOLID = %K_PRTCL_ID;
      828     9702    2      FIXED.VERSION = %K_PRTCL_ID_EXT;
      829     9703    2      FIXED.SP = '1'B;
      830     9704    2      FIXED.ER = '0'B;
      831     9705    2      FIXED.MS = '0'B;
      832     9706    2      FIXED.MS = '0'B;
      833     9707    2      FIXED.CHECKSUMX = 0;
      834     9708    2      FIXED.CHECKSUMY = 0;
      835     9709    2      FIXED.LIFETIME = KI_LIFETIME;
      836     9710    2      FIXED.LENGTH = LENGTHC(K$NPDU_FIXED)+SRC.LEN+DST.LEN+LENGTHC(SEGMENT)+6;
              9710               /*  for options*/
      837     9711
      838     9712    2      TSIZE = FIXED.LENGTH + SIZE;
      839     9713    2      FIXED.SEGLENX = TSIZE/256;
      840     9714    2      FIXED.SEGLENY = BITBIN(BINBIT(TSIZE,16)& 'FF'X);
      841     9715
      842     9716    2      SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,DST.LEN+1) = SUBSTR(ADDR(SRC)->ADDRESS,0,SRC.
              9716               LEN+1);
      843     9717    2      CURINDX = SRC.LEN + 1;
      844     9718
      845     9719    2      SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,SRC.LEN+1) = SUBSTR(ADDR(DST)->ADDRESS,0,DST.
              9719               LEN+1);
      846     9720    2      CURINDX = DST.LEN + 1;
      847     9721
      848     9722    2      KI_DATAID = KI_DATAID + 1;
      849     9723
      850     9724    2      SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,1) = SUBSTR(ADDR(KI_DATAID)->ADDRESS,0,1);
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:66   
      851     9725    2      CURINDX = CURINDX + 1;
      852     9726    2      SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,1) = SUBSTR(ADDR(KI_DATAID)->ADDRESS,1,1);
      853     9727    2      CURINDX = CURINDX + 1;
      854     9728
      855     9729    2      SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,1) = %BITASC('0'B);
      856     9730    2      CURINDX = CURINDX + 1;
      857     9731
      858     9732    2      SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,1) = %BITASC('0'B);
      859     9733    2      CURINDX = CURINDX + 1;
      860     9734
      861     9735    2      SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,1) = SUBSTR(ADDR(TSIZE)->ADDRESS,0,1);
      862     9736    2      CURINDX = CURINDX + 1;
      863     9737
      864     9738    2      SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,1) = SUBSTR(ADDR(TSIZE)->ADDRESS,1,1);
      865     9739    2      CURINDX = CURINDX + 1;
      866     9740
      867     9741        /* reason is in right half of errcode field */
      868     9742    2      SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,1) = %BINASC(%K_NPRM_REASON);
      869     9743    2      CURINDX = CURINDX + 1;
      870     9744
      871     9745    2      SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,1) = %BITASC('2'X); /* size of parameter */
      872     9746    2      CURINDX = CURINDX + 1;
      873     9747
      874     9748        /*
      875     9749             byte 3 of err contains the value of the error being returned in the
      876     9750             error pdu
      877     9751        */
      878     9752    2      SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,1) = SUBSTR(ADDR(K$RWPARM.ERR)->ADDRESS,3,1);
      879     9753    2      CURINDX = CURINDX + 1;
      880     9754
      881     9755        /* use the right half of size to determine the size of the data being returned */
      882     9756
      883     9757    3      IF SIZE > 254 THEN DO;
      884     9758    3           SIZE = 0;
      885     9759    3           SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,1) = %BITASC('0'B);
      886     9760    3           END;
      887     9761    2      ELSE
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:67   
      888     9762    2           SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,1) = SUBSTR(ADDR(SIZE)->ADDRESS,1,1);
      889     9763
      890     9764    2      CURINDX = CURINDX + 1;
      891     9765
      892     9766    2      SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,SIZE) = SUBSTR(K$RWPARM.NHDR$->ADDRESS,0,SIZE
              9766               );
      893     9767    2      CURINDX = CURINDX + SIZE;
      894     9768
      895     9769    2      IF SIZE + FIXED.LENGTH > LENGTHC(FIXED) THEN
      896     9770    2           SIZE = LENGTHC(FIXED);
      897     9771    2      ELSE
      898     9772    2           SIZE = SIZE + FIXED.LENGTH;
      899     9773
      900     9774
      901     9775    2      CALL DECODE_ADDR(DST,ROUTE);
      902     9776    2      IF ROUTE.QOS = 255 THEN RETURN;
              9776               /* no route to return error pdu, dump the message*/
      903     9777
      904     9778    2      K$RWPARM.FEX = KI$ROUTE$(ROUTE.NODE#)->KI$ROUTE.FEI#;
      905     9779    2      K$RWPARM.UHDRSZ = 0;
      906     9780    2      K$RWPARM.SHDRSZ = 0;
      907     9781    2      K$RWPARM.THDRSZ = 0;
      908     9782    2      K$RWPARM.MSGSZ = 0;
      909     9783    2      K$RWPARM.FUNCTION = %K_WRITE;
      910     9784    2      CALL KIQ$LINK(K$RWPARM) ALTRET(DO_ALTRET);
      911     9785
      912     9786    2      RETURN;
      913     9787
      914     9788    2   DO_ALTRET:
      915     9789    2      ALTRETURN;
      916     9790    2   END SENDERR;
      917     9791        %EJECT;
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:68   
      918     9792    1   DECODE_ADDR: PROC(DST,ROUTE) ALTRET;
      919     9793        /*
      920     9794             DST - address to be decoded.  Decoded in terms of determining whether
      921     9795                   the addresses exists in the osi route table.
      922     9796             ROUTE - an kl_updosi macro, only the first part is used to convey the
      923     9797                      node#, link# and qos of nsap address.
      924     9798        */
      925     9799
      926     9800
      927     9801        %KL_UPDOSI(FPTN=ROUTE,STCLASS="");
      928    10010        %K$NSAP(FPTN=DST,STCLASS="");
      929    10062
      930    10063    2   DCL FOUNDONE BIT(1);
      931    10064    2   DCL I UBIN;
      932    10065    2   DCL INX UBIN;
      933    10066    2   DCL CQOS UBIN;
      934    10067    2   DCL NQOS UBIN;
      935    10068    2   DCL INDX(0:15) UBIN;
      936    10069    2   DCL SVINDX SBIN;
      937    10070    2   DCL L UBIN;
      938    10071    2      FOUNDONE = '0'B;
      939    10072    3   OSIRTE: DO I = 0 TO KI_OSIMAX# - 1;
      940    10073    3           OSI$ = KI$OSIROUTE$(I);
      941    10074    3           IF KI$OSIROUTE.NS_TYPE = %K_TYPE_RNSAP AND
      942    10075    3             SUBSTR(ADDR(DST)->ADDRESS,0,DST.LEN+1) =
      943    10076    4             SUBSTR(ADDR(KI$OSIROUTE.NSAP)->ADDRESS,0,KI$OSIROUTE.NSAP.LEN+1) THEN DO;
      944    10077    4                FOUNDONE = '1'B;
      945    10078    4                J = 0;
      946    10079    4                INX = 0;
      947    10080    5                DO WHILE J < KI_MXFE;
      948    10081    6                     IF KI$OSIROUTE.LINK.ACTIVE(J) THEN DO;
      949    10082    6                          INDX(INX) = J;
      950    10083    6                          INX = INX + 1;
      951    10084    6                          END;
      952    10085    5                     J = J + 1;
      953    10086    5                     END;
      954    10087    5                IF INX > 0 THEN DO;        /* one or more routes available       */
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:69   
      955    10088    5                     CQOS = 255;
      956    10089    5                     SVINDX = -1;
      957    10090    6                     DO J = 0 TO INX-1;
      958    10091    6                          L = INDX(J);
      959    10092    6                          IF KI$OSIROUTE.LINK.FEP#(L) < KI_NODES AND
      960    10093    6                            KI$ROUTE$(KI$OSIROUTE.LINK.FEP#(L))->KI$ROUTE.FEI# ~= 0
             10093                                     THEN
      961    10094    6                               NQOS = KI$ROUTE$(KI$OSIROUTE.LINK.FEP#(L))->KI$ROUTE.
             10094                                        CURRENT_QOS;
      962    10095    7                          IF NQOS < CQOS THEN DO;
      963    10096    7                               SVINDX = J;
      964    10097    7                               CQOS = NQOS;
      965    10098    7                               END;
      966    10099    6                          END;
      967    10100    6                     IF SVINDX = -1 THEN DO;
      968    10101    6                          ROUTE.QOS = 255;
      969    10102    6                          ALTRETURN;
      970    10103    6                          END;
      971    10104    6                     ELSE DO;
      972    10105    6                          ROUTE.NODE# = KI$OSIROUTE.LINK.FEP#(SVINDX);
      973    10106    6                          EXIT OSIRTE;
      974    10107    6                          END;
      975    10108    5                     END;
      976    10109    5                ELSE DO;
      977    10110    5                     ROUTE.QOS = 255;
      978    10111    5                     ALTRETURN;
      979    10112    5                     END;
      980    10113    4                END;                       /* IF INX > 0                         */
      981    10114    3           END;                            /* DO I = 0 TO KNN_OSIMAX#-1*/
      982    10115    2      IF NOT FOUNDONE THEN ALTRETURN;
      983    10116    2   END DECODE_ADDR;
      984    10117    1   END KIN$RECV;
      985    10118        %EOD;

PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:70   
--  Include file information  --

   K_INTERFACE_M.:E05TOU  is referenced.
   KNN_NETWORK_M.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   K_NETWORK_E.:E05TOU  is referenced.
   K_NETWORK_M.:E05TOU  is referenced.
   K_ADDRESS_M.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_SUBS_C.:E05TOU  is referenced.
   KI_MACROS_C.:E05TOU  is referenced.
   K_QDPHDRS_M.:E05TOU  is referenced.
      No diagnostics issued in procedure KIN$RECV.

   Procedure KIN$RECV requires 1131 words for executable code.
   Procedure KIN$RECV requires 94 words of local(AUTO) storage.

PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:71   

 Object Unit name= KIN$RECV                                   File name= KIN$NETWORK.:E05TOU
 UTS= JUL 30 '97 00:34:17.00 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none  1131   2153  KIN$RECV
    1  RoData even  none     7      7  KIN$RECV

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes    yes     yes      Std        1  KIN$RECV

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 KIT$RECV
 yes     yes           Std       2 KIQ$LINK
 yes     yes           Std       1 KIS$RECV
 yes     yes           Std       0 KIN$UPDATE_ROUTE
                       nStd      0 X66_AUTO_1
                       nStd      0 X66_ARET
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AALT
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:72   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_PRTCL_SNAP                         K_NODE#                               N$DCT$$
     KI_FEI$$                              KI_ROUTE$$                            KI_NODES
     KI_LIFETIME                           KI_DATAID                             KI_OSIROUTE$$
     KI_OSIMAX#                            KI_MXFE                               B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ASLENTSID
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:73   


      291        1        /*T***********************************************************/
      292        2        /*T*                                                         */
      293        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      294        4        /*T*                                                         */
      295        5        /*T***********************************************************/
      296        6        /*F* NAME: KIN$RECV Inbound Messages
      297        7
      298        8        KIN$RECV is the interface for the lower layers to pass
      299        9        the incoming messages up to the user through the network layer.
      300       10        This routine is called form KIQ$ISCAN with the following parameters:
      301       11
      302       12        .fif
      303       13        }    K$RWPARM.FUNCTION
      304       14        }            - The function to be performed.  This will be one of the
      305       15        }              folowing EQUed values from the file K_SUBS_C:
      306       16        }                  K_RECV
      307       17        }                  K_CONNECT
      308       18        }                  K_REPDISC
      309       19        }
      310       20        }
      311       21        }    K$RWPARM    -
      312       22        }               .FEX contains the index into the FEI context table
      313       23        }               .IP$ contains the address of the message in the queue
      314       24        }               .NHDR$ contains the address of the message network header
      315       25        }               .NHDRSZ contains the byte size of the message network header
      316       26        }
      317       27        .fin
      318       28        The action to be taken is dependent on the function code.
      319       29        */
      320       30        %EJECT;
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:74   
      321       31
      322       32        KIN$RECV: PROC (K$RWPARM) ALTRET;

     32  0 000000   000000 700200 xent  KIN$RECV     TSX0  ! X66_AUTO_1
         0 000001   000136 000001                    ZERO    94,1

      323       33
      324       34        %INCLUDE K_QDPHDRS_M;
      325      916        %INCLUDE KI_MACROS_C;
      326     1524        %INCLUDE K_SUBS_C;
      327     1557        %INCLUDE K$RWPARM;
      328     1943        %INCLUDE NK$LDCT;
      329     2045        %INCLUDE K_ADDRESS_M;
      330     2548        %INCLUDE K_NETWORK_M;
      331     2817        %INCLUDE K_NETWORK_E;
      332     2906        %INCLUDE KL_MACRO_C;
      333     6258        %INCLUDE KNN_NETWORK_M;
      334     6621        %INCLUDE K_INTERFACE_M;
      335     7030
      336     7031        /* Parameters                         */
      337     7032        %K$RWPARM (NAME=K$RWPARM);
      338     7348
      339     7349                                                /* Entry references                   */
      340     7350    1   DCL KIN$UPDATE_ROUTE ENTRY ALTRET;
      341     7351    1   DCL KIS$RECV ENTRY(1) ALTRET;
      342     7352    1   DCL KIT$RECV ENTRY(1) ALTRET;
      343     7353    1   DCL KIQ$LINK ENTRY(2) ALTRET;
      344     7354    1   DCL SC_PRTCL_SNAP ENTRY CONV(2,0);
      345     7355
      346     7356                                                /* Auto                               */
      347     7357    1   DCL FUNCTION UBIN;                      /* k$rwparam.paramer.function         */
      348     7358    1   DCL FEI UBIN;                           /* k$rwparam.paramer.fex              */
      349     7359    1   DCL FEI# UBIN;
      350     7360    1   DCL I SBIN;
      351     7361    1   DCL J SBIN;
      352     7362    1   DCL NODE# SBIN;
      353     7363    1   DCL TEMP UBIN;
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:75   
      354     7364    1   DCL FEI$ PTR;
      355     7365    1   DCL OSI$ PTR;
      356     7366    1   DCL ROUTE$ PTR;
      357     7367    1   DCL SIZE UBIN;
      358     7368    1   DCL LI SBIN;
      359     7369    1   DCL SEGLENGTH UBIN(18);
      360     7370    1   DCL DATASIZE UBIN(18);
      361     7371    1   DCL CURINDX UBIN;
      362     7372    1   DCL FIXEDSIZ UBIN;
      363     7373    1   DCL DSTINDX UBIN;
      364     7374    1   DCL SRCINDX UBIN;
      365     7375    1   DCL D$ PTR;
      366     7376    1   DCL OPTSZ UBIN;
      367     7377    1   DCL CODE UBIN;
      368     7378    1   DCL OPTVAL UBIN;
      369     7379        %K$NPDU_SEGMENT(NAME=SEGMENT,STCLASS=AUTO);
      370     7431        %KL_UPDOSI(FPTN=ROUTE,STCLASS=AUTO);
      371     7640                                                /* Based structures                   */
      372     7641
      373     7642    1   DCL KI$ROUTE$(0:0) PTR BASED(KI_ROUTE$$);
      374     7643    1   DCL KI$OSIROUTE$(0:0) PTR BASED(KI_OSIROUTE$$);
      375     7644        %KI$FEI (STCLASS="BASED(FEI$)");
      376     7728        %KI$ROUTE (STCLASS="BASED(ROUTE$)");
      377     7782        %KNN$OSIROUTE(FPTN=KI$OSIROUTE,STCLASS="BASED(OSI$)");
      378     7999
      379     8000        %K$NQDP_HDR (NAME=B$QDP_NHDR, STCLASS="BASED(K$RWPARM.NHDR$)", ALGN=ALIGNED);
      380     8077       %K$NQDP_HDR (NAME=B$QDP_NOSIHDR, MSGTYPE = OSI_INIT,STCLASS="BASED(K$RWPARM.NHDR$)",
              8077            ALGN=ALIGNED,ADRTYP=NET);
      381     8422        %K$NPDU_FIXED(STCLASS="BASED(K$RWPARM.NHDR$)");
      382     8479        %K$NPDU_SEGMENT;
      383     8531        %K$NSAP(FPTN=DST,STCLASS="BASED(K$RWPARM.DST_ADDR$)",ADRTYP=NET);
      384     8583        %K$NSAP(FPTN=SRC,STCLASS="BASED(K$RWPARM.SRC_ADDR$)",ADRTYP=NET);
      385     8635        %NK$LDCT;
      386     8681    1   DCL NK$LDCT$(0:0) PTR BASED(N$DCT$$);
      387     8682    1   DCL KI$FEI$(0:0) PTR BASED(KI_FEI$$);
      388     8683    1   DCL CHR(0:3) CHAR(1) BASED;
      389     8684    1   DCL ADDRESS CHAR(SIZE) BASED CALIGNED;
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:76   
      390     8685    1   DCL 1 BSDHLFWRD BASED HALIGNED,
      391     8686    1         2 * BIT(2) UNAL,
      392     8687    1         2 BITS2TO9 UBIN(8) UNAL,
      393     8688    1         2 BITS10TO17 UBIN(8) UNAL;
      394     8689                                                /* External Data                      */
      395     8690    1   DCL K_NODE# UBIN SYMREF;
      396     8691    1   DCL N$DCT$$ PTR SYMREF;
      397     8692    1   DCL KI_FEI$$ PTR SYMREF;
      398     8693    1   DCL KI_ROUTE$$ PTR SYMREF;
      399     8694    1   DCL KI_NODES UBIN SYMREF;
      400     8695    1   DCL KI_LIFETIME UBIN(18) SYMREF;
      401     8696    1   DCL KI_DATAID UBIN BYTE SYMREF;
      402     8697    1   DCL KI_OSIROUTE$$ PTR SYMREF;
      403     8698    1   DCL KI_OSIMAX# UBIN SYMREF;
      404     8699    1   DCL KI_MXFE UBIN SYMREF;
      405     8700
      406     8701        %EJECT;
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:77   
      407     8702        /*F* NAME: KIN$RECV - Data Received Function
      408     8703
      409     8704        KIN$RECV is called with FUNCTION set to K_RECV from KIQ$ISCAN
      410     8705        when the scan routine has found a message in the queue with function
      411     8706        of KJ_FCN_DATA.
      412     8707
      413     8708        If the destination of the message is not on this host, KIN$RECV
      414     8709        simply bumps the hop count in the network header of the message,
      415     8710        increments the messages in and messages out counters in the route
      416     8711        tables and forwards the message by calling KIQ$LINK.
      417     8712
      418     8713        When the message does belong to a user on this host, this routine
      419     8714        updates the session/transport header address and size values in K$RWPARM
      420     8715        to reflect the stripping off of the network header and passess
      421     8716        the message on up the layers by calling KIS$RECV for QDP type messages
      422     8717        or by calling KIT$RECV for OSI type messages.
      423     8718        */
      424     8719    1      FEI = K$RWPARM.FEX;

   8719  0 000002   200003 470500                    LDP0    @K$RWPARM,,AUTO
         0 000003   000021 235100                    LDA     17,,PR0
         0 000004   200005 755100                    STA     FEI,,AUTO

      425     8720    1      FEI$ = KI$FEI$(FEI);

   8720  0 000005   000000 471400 xsym               LDP1    KI_FEI$$
         0 000006   100000 236105                    LDQ     0,AL,PR1
         0 000007   200013 756100                    STQ     FEI$,,AUTO

      426     8721
      427     8722    1      IF K$RWPARM.FUNCTION = %K_RECV

   8722  0 000010   000020 235100                    LDA     16,,PR0
         0 000011   000005 115007                    CMPA    5,DL
         0 000012   001174 601000 0                  TNZ     s:9051

      428     8723    2      THEN DO;
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:78   

      429     8724
      430     8725    2           IF B$QDP_NHDR.MSGTYP = %K_MSGTYP_OSI_INIT# OR

   8725  0 000013   000026 473500                    LDP3    22,,PR0
         0 000014   300000 236100                    LDQ     0,,PR3
         0 000015   777000 376003                    ANQ     -512,DU
         0 000016   373000 116003                    CMPQ    128512,DU
         0 000017   000022 600000 0                  TZE     s:8727
         0 000020   374000 116003                    CMPQ    129024,DU
         0 000021   000113 601000 0                  TNZ     s:8755

      431     8726    3             B$QDP_NHDR.MSGTYP = %K_MSGTYP_OSI_DATA# THEN DO;

      432     8727    3                IF B$QDP_NHDR.DEST_NODE ~= K_NODE#+1 THEN /* not for this node*/

   8727  0 000022   000000 235000 xsym               LDA     K_NODE#
         0 000023   000001 035007                    ADLA    1,DL
         0 000024   200134 755100                    STA     L+1,,AUTO
         0 000025   300000 236100                    LDQ     0,,PR3
         0 000026   000011 772000                    QRL     9
         0 000027   000777 376007                    ANQ     511,DL
         0 000030   200134 116100                    CMPQ    L+1,,AUTO
         0 000031   000033 600000 0                  TZE     s:8731

      433     8728    3                     RETURN;               /* just dump the message for now      */

   8728  0 000032   000000 702200 xent               TSX2  ! X66_ARET

      434     8729
      435     8730
      436     8731    3                K$RWPARM.FUNCTION = %K_NDATA;

   8731  0 000033   000041 236007                    LDQ     33,DL
         0 000034   000020 756100                    STQ     16,,PR0

      437     8732    3                IF B$QDP_NHDR.MSGTYP = %K_MSGTYP_OSI_INIT#
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:79   

   8732  0 000035   000026 473500                    LDP3    22,,PR0
         0 000036   300000 236100                    LDQ     0,,PR3
         0 000037   777000 376003                    ANQ     -512,DU
         0 000040   373000 116003                    CMPQ    128512,DU
         0 000041   000065 601000 0                  TNZ     s:8741

      438     8733    4                THEN DO;

      439     8734    4                     K$RWPARM.DST_ADDR$ = ADDR(B$QDP_NOSIHDR.DST_NSAP);

   8734  0 000042   300001 634500                    EPPR4   1,,PR3
         0 000043   000035 454500                    STP4    29,,PR0

      440     8735    4                     K$RWPARM.SRC_ADDR$ = ADDR(B$QDP_NOSIHDR.SRC_NSAP);

   8735  0 000044   200134 453500                    STP3    L+1,,AUTO
         0 000045   200134 236100                    LDQ     L+1,,AUTO
         0 000046   000000 036000 1                  ADLQ    0
         0 000047   000034 756100                    STQ     28,,PR0

      441     8736    4                     K$RWPARM.THDRSZ = K$RWPARM.NHDRSZ - LENGTHC(B$QDP_NOSIHDR);

   8736  0 000050   000027 235100                    LDA     23,,PR0
         0 000051   000104 135007                    SBLA    68,DL
         0 000052   000025 755100                    STA     21,,PR0

      442     8737    4                     K$RWPARM.THDR$ = PINCRC(K$RWPARM.NHDR$,K$RWPARM.NHDRSZ -

   8737  0 000053   000027 236100                    LDQ     23,,PR0
         0 000054   000025 136100                    SBLQ    21,,PR0
         0 000055   000026 473500                    LDP3    22,,PR0
         0 000056   000011 402007                    MPY     9,DL
         0 000057   000000 116003                    CMPQ    0,DU
         0 000060   000062 605000 0                  TPL     s:8737+7
         0 000061   000044 036003                    ADLQ    36,DU
         0 000062   300000 503506                    ABD     0,QL,PR3
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:80   
         0 000063   000024 453500                    STP3    20,,PR0

      443     8738    4                       K$RWPARM.THDRSZ);
      444     8739    4                     END;

   8739  0 000064   000076 710000 0                  TRA     s:8749

      445     8740    4                ELSE DO;

      446     8741    4                     K$RWPARM.DST_ADDR$ = ADDR(NIL);

   8741  0 000065   000001 236000 xsym               LDQ     B_VECTNIL+1
         0 000066   000035 756100                    STQ     29,,PR0

      447     8742    4                     K$RWPARM.SRC_ADDR$ = ADDR(NIL);

   8742  0 000067   000034 756100                    STQ     28,,PR0

      448     8743    4                     K$RWPARM.THDRSZ = K$RWPARM.NHDRSZ - LENGTHC(B$QDP_NHDR);

   8743  0 000070   000027 235100                    LDA     23,,PR0
         0 000071   000004 135007                    SBLA    4,DL
         0 000072   000025 755100                    STA     21,,PR0

      449     8744    4                     K$RWPARM.THDR$ = PINCRC(K$RWPARM.NHDR$,LENGTHC(B$QDP_NHDR));

   8744  0 000073   000026 236100                    LDQ     22,,PR0
         0 000074   000001 036003                    ADLQ    1,DU
         0 000075   000024 756100                    STQ     20,,PR0

      450     8745    4                     END;

      451     8746        /*
      452     8747             tell transport the local fep number this message hailed from
      453     8748        */
      454     8749    3                K$RWPARM.FEX = KI$FEI.FEP#;

PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:81   
   8749  0 000076   200013 473500                    LDP3    FEI$,,AUTO
         0 000077   300012 236100                    LDQ     10,,PR3
         0 000100   000011 772000                    QRL     9
         0 000101   000777 376007                    ANQ     511,DL
         0 000102   000021 756100                    STQ     17,,PR0

      455     8750    3                K$RWPARM.LOCAL_FEP = KI$FEI.FEP#;

   8750  0 000103   300012 236100                    LDQ     10,,PR3
         0 000104   000011 772000                    QRL     9
         0 000105   000032 552104                    STBQ    26,'04'O,PR0

      456     8751    3                CALL KIT$RECV(K$RWPARM) ALTRET (DO_ALTRET);

   8751  0 000106   200003 630500                    EPPR0   @K$RWPARM,,AUTO
         0 000107   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000110   000000 701000 xent               TSX1    KIT$RECV
         0 000111   001316 702000 0                  TSX2    DO_ALTRET

      457     8752    3                RETURN;

   8752  0 000112   000000 702200 xent               TSX2  ! X66_ARET

      458     8753    3                END;                       /* if osi_data or osi_init            */
      459     8754
      460     8755    3          IF B$QDP_NHDR.MSGTYP = %K_MSGTYP_OSI# THEN DO; /* true osi connectionless */

   8755  0 000113   201000 116003                    CMPQ    66048,DU
         0 000114   000770 601000 0                  TNZ     s:8965

      461     8756        /*
      462     8757             this type of message is just being routed thru this node.
      463     8758        */
      464     8759
      465     8760    3                SIZE = K$RWPARM.NHDRSZ;

   8760  0 000115   000027 235100                    LDA     23,,PR0
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:82   
         0 000116   200016 755100                    STA     SIZE,,AUTO

      466     8761
      467     8762    3                IF SIZE < LENGTHC(K$NPDU_FIXED) THEN

   8762  0 000117   000011 115007                    CMPA    9,DL
         0 000120   000122 603000 0                  TRC     s:8765

      468     8763    3                     RETURN;

   8763  0 000121   000000 702200 xent               TSX2  ! X66_ARET

      469     8764
      470     8765    3                LI = K$NPDU_FIXED.LENGTH;

   8765  0 000122   300000 236100                    LDQ     0,,PR3
         0 000123   000022 772000                    QRL     18
         0 000124   000777 376007                    ANQ     511,DL
         0 000125   200017 756100                    STQ     LI,,AUTO

      471     8766    3                IF LI > SIZE THEN

   8766  0 000126   000133 604000 0                  TMI     s:8769
         0 000127   200016 116100                    CMPQ    SIZE,,AUTO
         0 000130   000133 602000 0                  TNC     s:8769
         0 000131   000133 600000 0                  TZE     s:8769

      472     8767    3                     RETURN;

   8767  0 000132   000000 702200 xent               TSX2  ! X66_ARET

      473     8768
      474     8769    3                SEGLENGTH = K$NPDU_FIXED.SEGLENX*256 + K$NPDU_FIXED.SEGLENY;

   8769  0 000133   300001 236100                    LDQ     1,,PR3
         0 000134   000011 772000                    QRL     9
         0 000135   000777 376007                    ANQ     511,DL
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:83   
         0 000136   200134 756100                    STQ     L+1,,AUTO
         0 000137   300001 236100                    LDQ     1,,PR3
         0 000140   000012 772000                    QRL     10
         0 000141   377400 376007                    ANQ     130816,DL
         0 000142   200134 036100                    ADLQ    L+1,,AUTO
         0 000143   000000 620006                    EAX0    0,QL
         0 000144   200020 740100                    STX0    SEGLENGTH,,AUTO

      475     8770    3                IF SIZE ~= SEGLENGTH THEN

   8770  0 000145   200020 236100                    LDQ     SEGLENGTH,,AUTO
         0 000146   000022 772000                    QRL     18
         0 000147   200016 116100                    CMPQ    SIZE,,AUTO
         0 000150   000152 600000 0                  TZE     s:8773

      476     8771    3                     RETURN;

   8771  0 000151   000000 702200 xent               TSX2  ! X66_ARET

      477     8772
      478     8773    3                DATASIZE = SEGLENGTH - LI;

   8773  0 000152   200017 136100                    SBLQ    LI,,AUTO
         0 000153   000000 621006                    EAX1    0,QL
         0 000154   200021 741100                    STX1    DATASIZE,,AUTO

      479     8774    3                LI = LI - LENGTHC(K$NPDU_FIXED);

   8774  0 000155   000011 336007                    LCQ     9,DL
         0 000156   200017 056100                    ASQ     LI,,AUTO

      480     8775    3                FIXEDSIZ = LENGTHC(K$NPDU_FIXED);

   8775  0 000157   000011 235007                    LDA     9,DL
         0 000160   200023 755100                    STA     FIXEDSIZ,,AUTO

      481     8776    3                CURINDX = FIXEDSIZ;
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:84   

   8776  0 000161   200022 755100                    STA     CURINDX,,AUTO

      482     8777
      483     8778    3                ADDR(DST.LEN)->CHR(0) = SUBSTR(ADDR(K$NPDU_FIXED)->ADDRESS,CURINDX,1);

   8778  0 000162   000035 473500                    LDP3    29,,PR0
         0 000163   000026 474500                    LDP4    22,,PR0
         0 000164   040100 100505                    MLR     fill='040'O
         0 000165   400000 000001                    ADSC9   0,A,PR4                  cn=0,n=1
         0 000166   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1

      484     8779    3                IF DST.LEN > LI THEN

   8779  0 000167   000035 471500                    LDP1    29,,PR0
         0 000170   000100 101500                    MRL     fill='000'O
         0 000171   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
         0 000172   200134 000004                    ADSC9   L+1,,AUTO                cn=0,n=4
         0 000173   200134 236100                    LDQ     L+1,,AUTO
         0 000174   200017 116100                    CMPQ    LI,,AUTO
         0 000175   000177 604400 0                  TMOZ    s:8782

      485     8780    3                     RETURN;

   8780  0 000176   000000 702200 xent               TSX2  ! X66_ARET

      486     8781
      487     8782    3                D$ = ADDR(DST);

   8782  0 000177   000035 471500                    LDP1    29,,PR0
         0 000200   200026 451500                    STP1    D$,,AUTO

      488     8783    3                DSTINDX = CURINDX + 1; /* save the start of the destination address */

   8783  0 000201   000001 035007                    ADLA    1,DL
         0 000202   200024 755100                    STA     DSTINDX,,AUTO

PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:85   
      489     8784    4                DO I = 1 TO DST.LEN;

   8784  0 000203   000001 235007                    LDA     1,DL
         0 000204   200007 755100                    STA     I,,AUTO
         0 000205   000220 710000 0                  TRA     s:8786+1

      490     8785    4                     SUBSTR(D$->ADDRESS,I,1) = SUBSTR(ADDR(K$NPDU_FIXED)->ADDRESS,
              8785                              CURINDX+I,1);

   8785  0 000206   200003 470500                    LDP0    @K$RWPARM,,AUTO
         0 000207   000026 471500                    LDP1    22,,PR0
         0 000210   200022 236100                    LDQ     CURINDX,,AUTO
         0 000211   200007 036100                    ADLQ    I,,AUTO
         0 000212   200026 473500                    LDP3    D$,,AUTO
         0 000213   200007 235100                    LDA     I,,AUTO
         0 000214   040105 100506                    MLR     fill='040'O
         0 000215   100000 000001                    ADSC9   0,Q,PR1                  cn=0,n=1
         0 000216   300000 000001                    ADSC9   0,A,PR3                  cn=0,n=1

      491     8786    4                     END;

   8786  0 000217   200007 054100                    AOS     I,,AUTO
         0 000220   000035 471500                    LDP1    29,,PR0
         0 000221   000100 101500                    MRL     fill='000'O
         0 000222   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
         0 000223   200134 000004                    ADSC9   L+1,,AUTO                cn=0,n=4
         0 000224   200134 236100                    LDQ     L+1,,AUTO
         0 000225   200007 116100                    CMPQ    I,,AUTO
         0 000226   000206 605000 0                  TPL     s:8785

      492     8787    3                CURINDX = CURINDX + I;

   8787  0 000227   200022 236100                    LDQ     CURINDX,,AUTO
         0 000230   200007 036100                    ADLQ    I,,AUTO
         0 000231   200022 756100                    STQ     CURINDX,,AUTO

      493     8788
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:86   
      494     8789    3                LI = LI - (DST.LEN+1);

   8789  0 000232   000035 471500                    LDP1    29,,PR0
         0 000233   000100 101500                    MRL     fill='000'O
         0 000234   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
         0 000235   200134 000004                    ADSC9   L+1,,AUTO                cn=0,n=4
         0 000236   200017 236100                    LDQ     LI,,AUTO
         0 000237   200134 136100                    SBLQ    L+1,,AUTO
         0 000240   000001 136007                    SBLQ    1,DL
         0 000241   200017 756100                    STQ     LI,,AUTO

      495     8790
      496     8791    3                ADDR(SRC.LEN)->CHR(0) = SUBSTR(ADDR(K$NPDU_FIXED)->ADDRESS,CURINDX,1);

   8791  0 000242   000034 471500                    LDP1    28,,PR0
         0 000243   000026 473500                    LDP3    22,,PR0
         0 000244   200022 235100                    LDA     CURINDX,,AUTO
         0 000245   040100 100505                    MLR     fill='040'O
         0 000246   300000 000001                    ADSC9   0,A,PR3                  cn=0,n=1
         0 000247   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1

      497     8792    3                SRCINDX = CURINDX+1;  /* save the start of the source address    */

   8792  0 000250   000001 035007                    ADLA    1,DL
         0 000251   200025 755100                    STA     SRCINDX,,AUTO

      498     8793
      499     8794    3                IF SRC.LEN > LI THEN

   8794  0 000252   000034 471500                    LDP1    28,,PR0
         0 000253   000100 101500                    MRL     fill='000'O
         0 000254   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
         0 000255   200134 000004                    ADSC9   L+1,,AUTO                cn=0,n=4
         0 000256   200134 236100                    LDQ     L+1,,AUTO
         0 000257   200017 116100                    CMPQ    LI,,AUTO
         0 000260   000262 604400 0                  TMOZ    s:8797

PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:87   
      500     8795    3                     RETURN;

   8795  0 000261   000000 702200 xent               TSX2  ! X66_ARET

      501     8796
      502     8797    3                D$ = ADDR(SRC);

   8797  0 000262   000034 471500                    LDP1    28,,PR0
         0 000263   200026 451500                    STP1    D$,,AUTO

      503     8798    4                DO I = 1 TO SRC.LEN;

   8798  0 000264   000001 235007                    LDA     1,DL
         0 000265   200007 755100                    STA     I,,AUTO
         0 000266   000301 710000 0                  TRA     s:8800+1

      504     8799    4                     SUBSTR(D$->ADDRESS,I,1) = SUBSTR(ADDR(K$NPDU_FIXED)->ADDRESS,
              8799                              CURINDX+I,1);

   8799  0 000267   200003 470500                    LDP0    @K$RWPARM,,AUTO
         0 000270   000026 471500                    LDP1    22,,PR0
         0 000271   200022 236100                    LDQ     CURINDX,,AUTO
         0 000272   200007 036100                    ADLQ    I,,AUTO
         0 000273   200026 473500                    LDP3    D$,,AUTO
         0 000274   200007 235100                    LDA     I,,AUTO
         0 000275   040105 100506                    MLR     fill='040'O
         0 000276   100000 000001                    ADSC9   0,Q,PR1                  cn=0,n=1
         0 000277   300000 000001                    ADSC9   0,A,PR3                  cn=0,n=1

      505     8800    4                     END;

   8800  0 000300   200007 054100                    AOS     I,,AUTO
         0 000301   000034 471500                    LDP1    28,,PR0
         0 000302   000100 101500                    MRL     fill='000'O
         0 000303   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
         0 000304   200134 000004                    ADSC9   L+1,,AUTO                cn=0,n=4
         0 000305   200134 236100                    LDQ     L+1,,AUTO
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:88   
         0 000306   200007 116100                    CMPQ    I,,AUTO
         0 000307   000267 605000 0                  TPL     s:8799

      506     8801
      507     8802    3                CURINDX = CURINDX + I;

   8802  0 000310   200022 236100                    LDQ     CURINDX,,AUTO
         0 000311   200007 036100                    ADLQ    I,,AUTO
         0 000312   200022 756100                    STQ     CURINDX,,AUTO

      508     8803
      509     8804    3                LI = LI - (SRC.LEN+1);

   8804  0 000313   000034 471500                    LDP1    28,,PR0
         0 000314   000100 101500                    MRL     fill='000'O
         0 000315   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
         0 000316   200134 000004                    ADSC9   L+1,,AUTO                cn=0,n=4
         0 000317   200017 236100                    LDQ     LI,,AUTO
         0 000320   200134 136100                    SBLQ    L+1,,AUTO
         0 000321   000001 136007                    SBLQ    1,DL
         0 000322   200017 756100                    STQ     LI,,AUTO

      510     8805
      511     8806        /*
      512     8807             The address are now ready to use.  From now on we can send error pdus
      513     8808             set up netparm to send errcode.
      514     8809        */
      515     8810
      516     8811    3                K$RWPARM.DST_ADDR$ = ADDR(DST);

   8811  0 000323   000035 471500                    LDP1    29,,PR0
         0 000324   000035 451500                    STP1    29,,PR0

      517     8812    3                K$RWPARM.SRC_ADDR$ = ADDR(SRC);

   8812  0 000325   000034 473500                    LDP3    28,,PR0
         0 000326   000034 453500                    STP3    28,,PR0
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:89   

      518     8813
      519     8814    3                IF K$NPDU_FIXED.PROTOCOLID ~= %K_PRTCL_ID OR

   8814  0 000327   000026 474500                    LDP4    22,,PR0
         0 000330   400000 236100                    LDQ     0,,PR4
         0 000331   777000 376003                    ANQ     -512,DU
         0 000332   201000 116003                    CMPQ    66048,DU
         0 000333   000340 601000 0                  TNZ     s:8816
         0 000334   400000 236100                    LDQ     0,,PR4
         0 000335   777000 376007                    ANQ     -512,DL
         0 000336   001000 116007                    CMPQ    512,DL
         0 000337   000351 600000 0                  TZE     s:8823

      520     8815    4                  K$NPDU_FIXED.VERSION ~= %K_PRTCL_ID_EXT THEN DO;

      521     8816    4                     K$RWPARM.ERR = %K_DSCRD_HDRSNTX;

   8816  0 000340   000004 235007                    LDA     4,DL
         0 000341   000013 755100                    STA     11,,PR0

      522     8817    4                     K$RWPARM.RECTYPE = LENGTHC(K$NPDU_FIXED);

   8817  0 000342   000011 236007                    LDQ     9,DL
         0 000343   000030 756100                    STQ     24,,PR0

      523     8818    4                     CALL SENDERR(K$RWPARM);

   8818  0 000344   200003 236100                    LDQ     @K$RWPARM,,AUTO
         0 000345   200055 756100                    STQ     ROUTE+17,,AUTO
         0 000346   001317 701000 0                  TSX1    SENDERR
         0 000347   000000 011000                    NOP     0

      524     8819    4                     RETURN;

   8819  0 000350   000000 702200 xent               TSX2  ! X66_ARET

PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:90   
      525     8820    4                     END;
      526     8821
      527     8822
      528     8823    4                IF K$NPDU_FIXED.MS AND K$NPDU_FIXED.SP = '0'B THEN DO;

   8823  0 000351   400001 236100                    LDQ     1,,PR4
         0 000352   100000 316003                    CANQ    32768,DU
         0 000353   000367 600000 0                  TZE     s:8830
         0 000354   200000 316003                    CANQ    65536,DU
         0 000355   000367 601000 0                  TNZ     s:8830

      529     8824    4                     K$RWPARM.ERR = %K_DSCRD_CANTSEG;

   8824  0 000356   000005 235007                    LDA     5,DL
         0 000357   000013 755100                    STA     11,,PR0

      530     8825    4                     K$RWPARM.RECTYPE = LENGTHC(K$NPDU_FIXED);

   8825  0 000360   000011 236007                    LDQ     9,DL
         0 000361   000030 756100                    STQ     24,,PR0

      531     8826    4                     CALL SENDERR(K$RWPARM);

   8826  0 000362   200003 236100                    LDQ     @K$RWPARM,,AUTO
         0 000363   200055 756100                    STQ     ROUTE+17,,AUTO
         0 000364   001317 701000 0                  TSX1    SENDERR
         0 000365   000000 011000                    NOP     0

      532     8827    4                     RETURN;

   8827  0 000366   000000 702200 xent               TSX2  ! X66_ARET

      533     8828    4                     END;
      534     8829
      535     8830    4                IF K$NPDU_FIXED.SP = '0'B THEN DO;

   8830  0 000367   200000 316003                    CANQ    65536,DU
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:91   
         0 000370   000406 601000 0                  TNZ     s:8837

      536     8831    4                     SEGMENT.TOTLEN.BYT(0) = ADDR(SEGLENGTH)->BSDHLFWRD.BITS2TO9;

   8831  0 000371   200020 236100                    LDQ     SEGLENGTH,,AUTO
         0 000372   000001 736000                    QLS     1
         0 000373   200033 676100                    ERQ     SEGMENT+1,,AUTO
         0 000374   377000 376003                    ANQ     130560,DU
         0 000375   200033 656100                    ERSQ    SEGMENT+1,,AUTO

      537     8832    4                     SEGMENT.TOTLEN.BYT(1) = ADDR(SEGLENGTH)->BSDHLFWRD.BITS10TO17;

   8832  0 000376   200020 236100                    LDQ     SEGLENGTH,,AUTO
         0 000377   200033 676100                    ERQ     SEGMENT+1,,AUTO
         0 000400   000377 376003                    ANQ     255,DU
         0 000401   200033 656100                    ERSQ    SEGMENT+1,,AUTO

      538     8833    4                     SEGMENT.DATAID = '0'B;

   8833  0 000402   000000 220003                    LDX0    0,DU
         0 000403   200032 740100                    STX0    SEGMENT,,AUTO

      539     8834    4                     SEGMENT.OFFSET = '0'B;

   8834  0 000404   200032 440100                    SXL0    SEGMENT,,AUTO

      540     8835    4                     END;

   8835  0 000405   000444 710000 0                  TRA     s:8856

      541     8836    4                ELSE DO;

      542     8837    5                     IF LI < LENGTHC(K$NPDU_SEGMENT) THEN DO;

   8837  0 000406   200017 235100                    LDA     LI,,AUTO
         0 000407   000006 115007                    CMPA    6,DL
         0 000410   000422 605000 0                  TPL     s:8847
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:92   

      543     8838    5                          K$RWPARM.ERR = %K_DSCRD_HDRSNTX;

   8838  0 000411   000004 235007                    LDA     4,DL
         0 000412   000013 755100                    STA     11,,PR0

      544     8839    5                          K$RWPARM.RECTYPE = LENGTHC(K$NPDU_FIXED);

   8839  0 000413   000011 236007                    LDQ     9,DL
         0 000414   000030 756100                    STQ     24,,PR0

      545     8840    5                          CALL SENDERR(K$RWPARM);

   8840  0 000415   200003 236100                    LDQ     @K$RWPARM,,AUTO
         0 000416   200055 756100                    STQ     ROUTE+17,,AUTO
         0 000417   001317 701000 0                  TSX1    SENDERR
         0 000420   000000 011000                    NOP     0

      546     8841    5                          RETURN;

   8841  0 000421   000000 702200 xent               TSX2  ! X66_ARET

      547     8842    5                          END;
      548     8843        /*
      549     8844             segment part at this point has got to be present.  otherwise we would have
      550     8845             returned.
      551     8846        */
      552     8847    5                     DO I = 0 TO LENGTHC(K$NPDU_SEGMENT)-1;

   8847  0 000422   200007 450100                    STZ     I,,AUTO
         0 000423   000435 710000 0                  TRA     s:8850+1

      553     8848    5                          SUBSTR(ADDR(SEGMENT.DATAID)->ADDRESS,I,1) =

   8848  0 000424   200003 470500                    LDP0    @K$RWPARM,,AUTO
         0 000425   000026 471500                    LDP1    22,,PR0
         0 000426   200022 236100                    LDQ     CURINDX,,AUTO
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:93   
         0 000427   200007 036100                    ADLQ    I,,AUTO
         0 000430   200007 235100                    LDA     I,,AUTO
         0 000431   040105 100506                    MLR     fill='040'O
         0 000432   100000 000001                    ADSC9   0,Q,PR1                  cn=0,n=1
         0 000433   200032 000001                    ADSC9   SEGMENT,A,AUTO           cn=0,n=1

      554     8849    5                            SUBSTR(ADDR(K$NPDU_FIXED)->ADDRESS,CURINDX+I,1);
      555     8850    5                          END;

   8850  0 000434   200007 054100                    AOS     I,,AUTO
         0 000435   200007 235100                    LDA     I,,AUTO
         0 000436   000005 115007                    CMPA    5,DL
         0 000437   000424 604400 0                  TMOZ    s:8848

      556     8851
      557     8852    4                     CURINDX = LENGTHC(K$NPDU_SEGMENT);

   8852  0 000440   000006 236007                    LDQ     6,DL
         0 000441   200022 756100                    STQ     CURINDX,,AUTO

      558     8853    4                     LI = LI - LENGTHC(SEGMENT);

   8853  0 000442   000006 336007                    LCQ     6,DL
         0 000443   200017 056100                    ASQ     LI,,AUTO

      559     8854    4                     END;

      560     8855
      561     8856    4                IF K$NPDU_FIXED.LIFETIME = 0 THEN DO;

   8856  0 000444   000026 471500                    LDP1    22,,PR0
         0 000445   100000 236100                    LDQ     0,,PR1
         0 000446   000777 316007                    CANQ    511,DL
         0 000447   000461 601000 0                  TNZ     s:8868

      562     8857    4                     K$RWPARM.ERR = %K_DSCRD_LIFEEXPTRAN;

PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:94   
   8857  0 000450   000240 235007                    LDA     160,DL
         0 000451   000013 755100                    STA     11,,PR0

      563     8858    4                     K$RWPARM.RECTYPE = LENGTHC(K$NPDU_FIXED);

   8858  0 000452   000011 236007                    LDQ     9,DL
         0 000453   000030 756100                    STQ     24,,PR0

      564     8859    4                     CALL SENDERR(K$RWPARM);

   8859  0 000454   200003 236100                    LDQ     @K$RWPARM,,AUTO
         0 000455   200055 756100                    STQ     ROUTE+17,,AUTO
         0 000456   001317 701000 0                  TSX1    SENDERR
         0 000457   000000 011000                    NOP     0

      565     8860    4                     RETURN;

   8860  0 000460   000000 702200 xent               TSX2  ! X66_ARET

      566     8861    4                     END;
      567     8862
      568     8863        /*
      569     8864             parse the options.
      570     8865        */
      571     8866
      572     8867
      573     8868    4                DO WHILE LI > 2;

   8868  0 000461   200017 235100                    LDA     LI,,AUTO
         0 000462   000002 115007                    CMPA    2,DL
         0 000463   000630 604400 0                  TMOZ    s:8927

      574     8869    4                    ADDR(CODE)->CHR(0) = SUBSTR(ADDR(K$NPDU_FIXED)->ADDRESS,CURINDX,1)
              8869                              ;

   8869  0 000464   200003 470500                    LDP0    @K$RWPARM,,AUTO
         0 000465   000026 471500                    LDP1    22,,PR0
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:95   
         0 000466   200022 235100                    LDA     CURINDX,,AUTO
         0 000467   040100 100505                    MLR     fill='040'O
         0 000470   100000 000001                    ADSC9   0,A,PR1                  cn=0,n=1
         0 000471   200030 000001                    ADSC9   CODE,,AUTO               cn=0,n=1

      575     8870    4                     CURINDX = CURINDX + 1;

   8870  0 000472   000001 035007                    ADLA    1,DL
         0 000473   200022 755100                    STA     CURINDX,,AUTO

      576     8871    4                    ADDR(OPTSZ)->CHR(0) = SUBSTR(ADDR(K$NPDU_FIXED)->ADDRESS,CURINDX,1
              8871                              );

   8871  0 000474   000026 471500                    LDP1    22,,PR0
         0 000475   040100 100505                    MLR     fill='040'O
         0 000476   100000 000001                    ADSC9   0,A,PR1                  cn=0,n=1
         0 000477   200027 000001                    ADSC9   OPTSZ,,AUTO              cn=0,n=1

      577     8872    4                     CURINDX = CURINDX + 1;

   8872  0 000500   000001 035007                    ADLA    1,DL
         0 000501   200022 755100                    STA     CURINDX,,AUTO

      578     8873    4                     LI = LI-2-OPTSZ;

   8873  0 000502   200017 236100                    LDQ     LI,,AUTO
         0 000503   200027 136100                    SBLQ    OPTSZ,,AUTO
         0 000504   000002 136007                    SBLQ    2,DL
         0 000505   200017 756100                    STQ     LI,,AUTO

      579     8874    5                     IF LI < 0 THEN DO;

   8874  0 000506   000520 605000 0                  TPL     s:8881

      580     8875    5                          K$RWPARM.ERR = %K_DSCRD_HDRSNTX;

   8875  0 000507   000004 235007                    LDA     4,DL
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:96   
         0 000510   000013 755100                    STA     11,,PR0

      581     8876    5                          K$RWPARM.RECTYPE = LENGTHC(K$NPDU_FIXED);

   8876  0 000511   000011 235007                    LDA     9,DL
         0 000512   000030 755100                    STA     24,,PR0

      582     8877    5                          CALL SENDERR(K$RWPARM);

   8877  0 000513   200003 236100                    LDQ     @K$RWPARM,,AUTO
         0 000514   200055 756100                    STQ     ROUTE+17,,AUTO
         0 000515   001317 701000 0                  TSX1    SENDERR
         0 000516   000000 011000                    NOP     0

      583     8878    5                          RETURN;

   8878  0 000517   000000 702200 xent               TSX2  ! X66_ARET

      584     8879    5                          END;
      585     8880
      586     8881    5                     DO CASE(CODE);

   8881  0 000520   200030 235100                    LDA     CODE,,AUTO
         0 000521   000303 135007                    SBLA    195,DL
         0 000522   000013 115007                    CMPA    11,DL
         0 000523   000525 602005 0                  TNC     s:8881+5,AL
         0 000524   000611 710000 0                  TRA     s:8918
         0 000525   000622 710000 0                  TRA     s:8924
         0 000526   000611 710000 0                  TRA     s:8918
         0 000527   000540 710000 0                  TRA     s:8886
         0 000530   000611 710000 0                  TRA     s:8918
         0 000531   000611 710000 0                  TRA     s:8918
         0 000532   000551 710000 0                  TRA     s:8892
         0 000533   000611 710000 0                  TRA     s:8918
         0 000534   000611 710000 0                  TRA     s:8918
         0 000535   000571 710000 0                  TRA     s:8905
         0 000536   000622 710000 0                  TRA     s:8924
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:97   
         0 000537   000622 710000 0                  TRA     s:8924

      587     8882
      588     8883    5                      CASE(%K_NPRM_PAD);
              8883                               /* pad characters to get header to a byte boundry*/

      589     8884
      590     8885    5                      CASE(%K_NPRM_SEC);   /* security                           */

      591     8886    5                        K$RWPARM.ERR = %K_DSCRD_OPTSEC;

   8886  0 000540   000262 235007                    LDA     178,DL
         0 000541   000013 755100                    STA     11,,PR0

      592     8887    5                        K$RWPARM.RECTYPE = LENGTHC(K$NPDU_FIXED);

   8887  0 000542   000011 235007                    LDA     9,DL
         0 000543   000030 755100                    STA     24,,PR0

      593     8888    5                        CALL SENDERR(K$RWPARM);

   8888  0 000544   200003 236100                    LDQ     @K$RWPARM,,AUTO
         0 000545   200055 756100                    STQ     ROUTE+17,,AUTO
         0 000546   001317 701000 0                  TSX1    SENDERR
         0 000547   000000 011000                    NOP     0

      594     8889    5                        RETURN;

   8889  0 000550   000000 702200 xent               TSX2  ! X66_ARET

      595     8890
      596     8891    5                      CASE(%K_NPRM_SRCRTE); /* source routing                    */

      597     8892    5                        ADDR(OPTVAL)->CHR(0) = SUBSTR(ADDR(K$NPDU_FIXED)->ADDRESS,
              8892                                 CURINDX,1);

   8892  0 000551   000026 471500                    LDP1    22,,PR0
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:98   
         0 000552   200022 235100                    LDA     CURINDX,,AUTO
         0 000553   040100 100505                    MLR     fill='040'O
         0 000554   100000 000001                    ADSC9   0,A,PR1                  cn=0,n=1
         0 000555   200031 000001                    ADSC9   OPTVAL,,AUTO             cn=0,n=1

      598     8893        /*
      599     8894                partial source routing options are accepted but not implemented.
      600     8895                complete source routing pdus are discarded.
      601     8896        */
      602     8897    6                        IF OPTVAL ~= %K_NPRM_SRCRTE_PSR THEN DO;

   8897  0 000556   200031 235100                    LDA     OPTVAL,,AUTO
         0 000557   000622 600000 0                  TZE     s:8924

      603     8898    6                             K$RWPARM.ERR = %K_DSCRD_OPTSRCRTE;

   8898  0 000560   000263 235007                    LDA     179,DL
         0 000561   000013 755100                    STA     11,,PR0

      604     8899    6                             K$RWPARM.RECTYPE = LENGTHC(K$NPDU_FIXED);

   8899  0 000562   000011 235007                    LDA     9,DL
         0 000563   000030 755100                    STA     24,,PR0

      605     8900    6                             CALL SENDERR(K$RWPARM);

   8900  0 000564   200003 236100                    LDQ     @K$RWPARM,,AUTO
         0 000565   200055 756100                    STQ     ROUTE+17,,AUTO
         0 000566   001317 701000 0                  TSX1    SENDERR
         0 000567   000000 011000                    NOP     0

      606     8901    6                             RETURN;

   8901  0 000570   000000 702200 xent               TSX2  ! X66_ARET

      607     8902    6                             END;
      608     8903
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:99   
      609     8904    5                      CASE(%K_NPRM_RECRTE); /* record route                      */

      610     8905    5                        ADDR(OPTVAL)->CHR(0) = SUBSTR(ADDR(K$NPDU_FIXED)->ADDRESS,
              8905                                 CURINDX,1);

   8905  0 000571   000026 471500                    LDP1    22,,PR0
         0 000572   200022 235100                    LDA     CURINDX,,AUTO
         0 000573   040100 100505                    MLR     fill='040'O
         0 000574   100000 000001                    ADSC9   0,A,PR1                  cn=0,n=1
         0 000575   200031 000001                    ADSC9   OPTVAL,,AUTO             cn=0,n=1

      611     8906    6                        IF OPTVAL ~= %K_NPRM_RECRTE_PRR THEN DO;

   8906  0 000576   200031 235100                    LDA     OPTVAL,,AUTO
         0 000577   000622 600000 0                  TZE     s:8924

      612     8907    6                             K$RWPARM.ERR = %K_DSCRD_OPTRECRTE;

   8907  0 000600   000264 235007                    LDA     180,DL
         0 000601   000013 755100                    STA     11,,PR0

      613     8908    6                             K$RWPARM.RECTYPE = LENGTHC(K$NPDU_FIXED);

   8908  0 000602   000011 235007                    LDA     9,DL
         0 000603   000030 755100                    STA     24,,PR0

      614     8909    6                             CALL SENDERR(K$RWPARM);

   8909  0 000604   200003 236100                    LDQ     @K$RWPARM,,AUTO
         0 000605   200055 756100                    STQ     ROUTE+17,,AUTO
         0 000606   001317 701000 0                  TSX1    SENDERR
         0 000607   000000 011000                    NOP     0

      615     8910    6                             RETURN;

   8910  0 000610   000000 702200 xent               TSX2  ! X66_ARET

PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:100  
      616     8911    6                             END;
      617     8912
      618     8913    5                      CASE(%K_NPRM_QOS);

      619     8914
      620     8915    5                      CASE(%K_NPRM_PRIO);

      621     8916
      622     8917    5                      CASE(ELSE);

      623     8918    5                        K$RWPARM.ERR = %K_DSCRD_OPTNON;

   8918  0 000611   000260 235007                    LDA     176,DL
         0 000612   000013 755100                    STA     11,,PR0

      624     8919    5                        K$RWPARM.RECTYPE = LENGTHC(K$NPDU_FIXED);

   8919  0 000613   000011 235007                    LDA     9,DL
         0 000614   000030 755100                    STA     24,,PR0

      625     8920    5                        CALL SENDERR(K$RWPARM);

   8920  0 000615   200003 236100                    LDQ     @K$RWPARM,,AUTO
         0 000616   200055 756100                    STQ     ROUTE+17,,AUTO
         0 000617   001317 701000 0                  TSX1    SENDERR
         0 000620   000000 011000                    NOP     0

      626     8921    5                        RETURN;

   8921  0 000621   000000 702200 xent               TSX2  ! X66_ARET

      627     8922
      628     8923    5                        END;               /* case                               */

      629     8924    4                     CURINDX = CURINDX + OPTSZ;

   8924  0 000622   200022 236100                    LDQ     CURINDX,,AUTO
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:101  
         0 000623   200027 036100                    ADLQ    OPTSZ,,AUTO
         0 000624   200022 756100                    STQ     CURINDX,,AUTO

      630     8925    4                     END;                  /* do while                           */

   8925  0 000625   200017 235100                    LDA     LI,,AUTO
         0 000626   000002 115007                    CMPA    2,DL
         0 000627   000464 605400 0                  TPNZ    s:8869

      631     8926
      632     8927    3                CALL DECODE_ADDR(DST,ROUTE);

   8927  0 000630   000035 471500                    LDP1    29,,PR0
         0 000631   200034 633500                    EPPR3   ROUTE,,AUTO
         0 000632   200104 453500                    STP3    @DST+1,,AUTO
         0 000633   200103 451500                    STP1    TSIZE+2,,AUTO
         0 000634   001736 701000 0                  TSX1    DECODE_ADDR
         0 000635   000000 011000                    NOP     0

      633     8928
      634     8929    4                IF ROUTE.QOS = 255 THEN DO; /* no route available                */

   8929  0 000636   200035 236100                    LDQ     ROUTE+1,,AUTO
         0 000637   000777 376003                    ANQ     511,DU
         0 000640   000377 116003                    CMPQ    255,DU
         0 000641   000661 601000 0                  TNZ     s:8938

      635     8930    4                     K$RWPARM.ERR = %K_DSCRD_DSTUNREACH;

   8930  0 000642   000200 235007                    LDA     128,DL
         0 000643   200003 470500                    LDP0    @K$RWPARM,,AUTO
         0 000644   000013 755100                    STA     11,,PR0

      636     8931    4                     K$RWPARM.RECTYPE = LENGTHC(K$NPDU_FIXED)+DST.LEN;

   8931  0 000645   000035 471500                    LDP1    29,,PR0
         0 000646   000100 101500                    MRL     fill='000'O
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:102  
         0 000647   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
         0 000650   200134 000004                    ADSC9   L+1,,AUTO                cn=0,n=4
         0 000651   200134 236100                    LDQ     L+1,,AUTO
         0 000652   000011 036007                    ADLQ    9,DL
         0 000653   000030 756100                    STQ     24,,PR0

      637     8932    4                     CALL SENDERR(K$RWPARM);

   8932  0 000654   200003 236100                    LDQ     @K$RWPARM,,AUTO
         0 000655   200055 756100                    STQ     ROUTE+17,,AUTO
         0 000656   001317 701000 0                  TSX1    SENDERR
         0 000657   000000 011000                    NOP     0

      638     8933    4                     RETURN;

   8933  0 000660   000000 702200 xent               TSX2  ! X66_ARET

      639     8934    4                     END;
      640     8935          /*
      641     8936             if a route exists then forward the message to that node.
      642     8937          */
      643     8938    4                IF ROUTE.NODE# > KI_NODES THEN DO;

   8938  0 000661   200034 236100                    LDQ     ROUTE,,AUTO
         0 000662   000777 376007                    ANQ     511,DL
         0 000663   000000 116000 xsym               CMPQ    KI_NODES
         0 000664   000705 602000 0                  TNC     s:8945
         0 000665   000705 600000 0                  TZE     s:8945

      644     8939    4                     K$RWPARM.ERR = %K_DSCRD_DSTUNKNWN;

   8939  0 000666   000201 235007                    LDA     129,DL
         0 000667   200003 470500                    LDP0    @K$RWPARM,,AUTO
         0 000670   000013 755100                    STA     11,,PR0

      645     8940    4                     K$RWPARM.RECTYPE = LENGTHC(K$NPDU_FIXED)+DST.LEN;
              8940                              /* offset to err*/
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:103  

   8940  0 000671   000035 471500                    LDP1    29,,PR0
         0 000672   000100 101500                    MRL     fill='000'O
         0 000673   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
         0 000674   200134 000004                    ADSC9   L+1,,AUTO                cn=0,n=4
         0 000675   200134 236100                    LDQ     L+1,,AUTO
         0 000676   000011 036007                    ADLQ    9,DL
         0 000677   000030 756100                    STQ     24,,PR0

      646     8941    4                     CALL SENDERR(K$RWPARM);

   8941  0 000700   200003 236100                    LDQ     @K$RWPARM,,AUTO
         0 000701   200055 756100                    STQ     ROUTE+17,,AUTO
         0 000702   001317 701000 0                  TSX1    SENDERR
         0 000703   000000 011000                    NOP     0

      647     8942    4                     RETURN;

   8942  0 000704   000000 702200 xent               TSX2  ! X66_ARET

      648     8943    4                     END;
      649     8944
      650     8945    3                ROUTE$ = KI$ROUTE$(ROUTE.NODE#);

   8945  0 000705   200034 720100                    LXL0    ROUTE,,AUTO
         0 000706   000777 360003                    ANX0    511,DU
         0 000707   000000 470400 xsym               LDP0    KI_ROUTE$$
         0 000710   000000 236110                    LDQ     0,X0,PR0
         0 000711   200015 756100                    STQ     ROUTE$,,AUTO

      651     8946    4                IF KI$ROUTE.FEI# = 0 THEN DO;

   8946  0 000712   200015 471500                    LDP1    ROUTE$,,AUTO
         0 000713   100002 236100                    LDQ     2,,PR1
         0 000714   777000 316003                    CANQ    -512,DU
         0 000715   000735 601000 0                  TNZ     s:8953

PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:104  
      652     8947    4                     K$RWPARM.ERR = %K_DSCRD_DSTUNREACH;

   8947  0 000716   000200 235007                    LDA     128,DL
         0 000717   200003 473500                    LDP3    @K$RWPARM,,AUTO
         0 000720   300013 755100                    STA     11,,PR3

      653     8948    4                     K$RWPARM.RECTYPE = LENGTHC(K$NPDU_FIXED)+DST.LEN;

   8948  0 000721   300035 474500                    LDP4    29,,PR3
         0 000722   000100 101500                    MRL     fill='000'O
         0 000723   400000 000001                    ADSC9   0,,PR4                   cn=0,n=1
         0 000724   200134 000004                    ADSC9   L+1,,AUTO                cn=0,n=4
         0 000725   200134 236100                    LDQ     L+1,,AUTO
         0 000726   000011 036007                    ADLQ    9,DL
         0 000727   300030 756100                    STQ     24,,PR3

      654     8949    4                     CALL SENDERR(K$RWPARM);

   8949  0 000730   200003 236100                    LDQ     @K$RWPARM,,AUTO
         0 000731   200055 756100                    STQ     ROUTE+17,,AUTO
         0 000732   001317 701000 0                  TSX1    SENDERR
         0 000733   000000 011000                    NOP     0

      655     8950    4                     RETURN;

   8950  0 000734   000000 702200 xent               TSX2  ! X66_ARET

      656     8951    4                     END;
      657     8952
      658     8953    3                K$RWPARM.FEX = KI$ROUTE.FEI#;

   8953  0 000735   100002 236100                    LDQ     2,,PR1
         0 000736   000033 772000                    QRL     27
         0 000737   200003 473500                    LDP3    @K$RWPARM,,AUTO
         0 000740   300021 756100                    STQ     17,,PR3

      659     8954
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:105  
      660     8955    3                K$RWPARM.FUNCTION = %K_WRITE;

   8955  0 000741   000001 235007                    LDA     1,DL
         0 000742   300020 755100                    STA     16,,PR3

      661     8956    3                K$RWPARM.UHDRSZ = 0;

   8956  0 000743   300015 450100                    STZ     13,,PR3

      662     8957    3                K$RWPARM.SHDRSZ = 0;

   8957  0 000744   300023 450100                    STZ     19,,PR3

      663     8958    3                K$RWPARM.THDRSZ = 0;

   8958  0 000745   300025 450100                    STZ     21,,PR3

      664     8959    3                K$RWPARM.MSGSZ = 0;

   8959  0 000746   300001 450100                    STZ     1,,PR3

      665     8960    3                CALL KIQ$LINK(K$RWPARM) ALTRET(DO_ALTRET);

   8960  0 000747   200003 630500                    EPPR0   @K$RWPARM,,AUTO
         0 000750   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000751   000000 701000 xent               TSX1    KIQ$LINK
         0 000752   001316 702000 0                  TSX2    DO_ALTRET

      666     8961    3                KI$ROUTE.LINK.MSGS_IN(FEI) = KI$ROUTE.LINK.MSGS_IN(FEI) + 1;

   8961  0 000753   200005 236100                    LDQ     FEI,,AUTO
         0 000754   000003 402007                    MPY     3,DL
         0 000755   200015 470500                    LDP0    ROUTE$,,AUTO
         0 000756   000004 235106                    LDA     4,QL,PR0
         0 000757   000001 035007                    ADLA    1,DL
         0 000760   000004 755106                    STA     4,QL,PR0

PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:106  
      667     8962    3               KI$ROUTE.LINK.MSGS_OUT(KI$ROUTE.FEI#) = KI$ROUTE.LINK.MSGS_OUT(KI$ROUTE
              8962                         .FEI#) + 1;

   8962  0 000761   000002 236100                    LDQ     2,,PR0
         0 000762   000033 772000                    QRL     27
         0 000763   000003 402007                    MPY     3,DL
         0 000764   000005 235106                    LDA     5,QL,PR0
         0 000765   000001 035007                    ADLA    1,DL
         0 000766   000005 755106                    STA     5,QL,PR0

      668     8963    3                RETURN;

   8963  0 000767   000000 702200 xent               TSX2  ! X66_ARET

      669     8964    3                END;                       /* if                                 */
      670     8965    2           IF B$QDP_NHDR.MSGTYP ~= %K_MSGTYP_CP6_CL4# AND

   8965  0 000770   375000 116003                    CMPQ    129536,DU
         0 000771   000777 600000 0                  TZE     s:8970
         0 000772   376000 116003                    CMPQ    130048,DU
         0 000773   000777 600000 0                  TZE     s:8970

      671     8966    3             B$QDP_NHDR.MSGTYP ~= %K_MSGTYP_CP6_QDP# THEN DO;

      672     8967    3                CALL SC_PRTCL_SNAP;

   8967  0 000774   000000 713400 xsym               CLIMB   SC_PRTCL_SNAP
         0 000775   000000 600000 xsid               climb   nvectors=         0

      673     8968    3                RETURN;

   8968  0 000776   000000 702200 xent               TSX2  ! X66_ARET

      674     8969    3                END;
      675     8970    2           K$RWPARM.SHDRSZ = K$RWPARM.NHDRSZ - LENGTHC(B$QDP_NHDR);

   8970  0 000777   000027 235100                    LDA     23,,PR0
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:107  
         0 001000   000004 135007                    SBLA    4,DL
         0 001001   000023 755100                    STA     19,,PR0

      676     8971    2           IF K$RWPARM.SHDRSZ <= 0 THEN RETURN; /* ??                            */

   8971  0 001002   001004 601000 0                  TNZ     s:8973

   8971  0 001003   000000 702200 xent               TSX2  ! X66_ARET

      677     8972
      678     8973    2           NODE# = B$QDP_NHDR.SOURCE_NODE -1;

   8973  0 001004   300000 236100                    LDQ     0,,PR3
         0 001005   000777 376007                    ANQ     511,DL
         0 001006   000001 136007                    SBLQ    1,DL
         0 001007   200011 756100                    STQ     NODE#,,AUTO

      679     8974    2           ROUTE$ = KI$ROUTE$(B$QDP_NHDR.DEST_NODE - 1);

   8974  0 001010   300000 236100                    LDQ     0,,PR3
         0 001011   000011 772000                    QRL     9
         0 001012   000777 376007                    ANQ     511,DL
         0 001013   000000 474400 xsym               LDP4    KI_ROUTE$$
         0 001014   477777 236106                    LDQ     -1,QL,PR4
         0 001015   200015 756100                    STQ     ROUTE$,,AUTO

      680     8975
      681     8976    2           IF B$QDP_NHDR.DEST_NODE - K_NODE# ~= 1

   8976  0 001016   300000 236100                    LDQ     0,,PR3
         0 001017   000011 772000                    QRL     9
         0 001020   000777 376007                    ANQ     511,DL
         0 001021   000000 136000 xsym               SBLQ    K_NODE#
         0 001022   000001 116007                    CMPQ    1,DL
         0 001023   001072 600000 0                  TZE     s:9002

      682     8977    3           THEN DO;
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:108  

      683     8978    3                FEI# = KI$ROUTE.FEI#;

   8978  0 001024   200015 475500                    LDP5    ROUTE$,,AUTO
         0 001025   500002 236100                    LDQ     2,,PR5
         0 001026   000033 772000                    QRL     27
         0 001027   200006 756100                    STQ     FEI#,,AUTO

      684     8979    3                IF FEI# = 0                /* No route associated                */

   8979  0 001030   001032 601000 0                  TNZ     s:8982

      685     8980    3                THEN RETURN;

   8980  0 001031   000000 702200 xent               TSX2  ! X66_ARET

      686     8981
      687     8982    3                IF B$QDP_NHDR.HOP_COUNT = 15

   8982  0 001032   300000 236100                    LDQ     0,,PR3
         0 001033   000777 376003                    ANQ     511,DU
         0 001034   000017 116003                    CMPQ    15,DU
         0 001035   001037 601000 0                  TNZ     s:8985

      688     8983    3                THEN RETURN;

   8983  0 001036   000000 702200 xent               TSX2  ! X66_ARET

      689     8984
      690     8985    3                B$QDP_NHDR.HOP_COUNT = B$QDP_NHDR.HOP_COUNT + 1;

   8985  0 001037   300000 236100                    LDQ     0,,PR3
         0 001040   000001 036003                    ADLQ    1,DU
         0 001041   300000 552120                    STBQ    0,'20'O,PR3

      691     8986    3                K$RWPARM.UHDRSZ = 0;

PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:109  
   8986  0 001042   000015 450100                    STZ     13,,PR0

      692     8987    3                K$RWPARM.SHDRSZ = 0;

   8987  0 001043   000023 450100                    STZ     19,,PR0

      693     8988    3                K$RWPARM.THDRSZ = 0;

   8988  0 001044   000025 450100                    STZ     21,,PR0

      694     8989    3                K$RWPARM.MSGSZ = 0;

   8989  0 001045   000001 450100                    STZ     1,,PR0

      695     8990
      696     8991    3                K$RWPARM.FUNCTION = %K_WRITE;

   8991  0 001046   000001 235007                    LDA     1,DL
         0 001047   000020 755100                    STA     16,,PR0

      697     8992    3                K$RWPARM.FEX = FEI#;

   8992  0 001050   200006 236100                    LDQ     FEI#,,AUTO
         0 001051   000021 756100                    STQ     17,,PR0

      698     8993    3                CALL KIQ$LINK (K$RWPARM) ALTRET(DO_ALTRET);

   8993  0 001052   200003 630500                    EPPR0   @K$RWPARM,,AUTO
         0 001053   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 001054   000000 701000 xent               TSX1    KIQ$LINK
         0 001055   001316 702000 0                  TSX2    DO_ALTRET

      699     8994
      700     8995    3                KI$ROUTE.LINK.MSGS_IN(FEI) = KI$ROUTE.LINK.MSGS_IN(FEI) + 1;

   8995  0 001056   200005 236100                    LDQ     FEI,,AUTO
         0 001057   000003 402007                    MPY     3,DL
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:110  
         0 001060   200015 470500                    LDP0    ROUTE$,,AUTO
         0 001061   000004 235106                    LDA     4,QL,PR0
         0 001062   000001 035007                    ADLA    1,DL
         0 001063   000004 755106                    STA     4,QL,PR0

      701     8996    3                KI$ROUTE.LINK.MSGS_OUT(FEI#) = KI$ROUTE.LINK.MSGS_OUT(FEI#) + 1;

   8996  0 001064   200006 236100                    LDQ     FEI#,,AUTO
         0 001065   000003 402007                    MPY     3,DL
         0 001066   000005 235106                    LDA     5,QL,PR0
         0 001067   000001 035007                    ADLA    1,DL
         0 001070   000005 755106                    STA     5,QL,PR0

      702     8997    3                RETURN;

   8997  0 001071   000000 702200 xent               TSX2  ! X66_ARET

      703     8998    3                END/*do if not this node*/;
      704     8999
      705     9000        /* Its for this host node.
      706     9001        */
      707     9002    2           K$RWPARM.SHDR$ = PINCRC(K$RWPARM.NHDR$,LENGTHC(B$QDP_NHDR));

   9002  0 001072   000026 236100                    LDQ     22,,PR0
         0 001073   000001 036003                    ADLQ    1,DU
         0 001074   000022 756100                    STQ     18,,PR0

      708     9003    2           K$RWPARM.FEX = NODE#;

   9003  0 001075   200011 235100                    LDA     NODE#,,AUTO
         0 001076   000021 755100                    STA     17,,PR0

      709     9004
      710     9005    2           IF KI$ROUTE$(NODE#)->KI$ROUTE.FEI# = 0

   9005  0 001077   400000 475505                    LDP5    0,AL,PR4
         0 001100   500002 236100                    LDQ     2,,PR5
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:111  
         0 001101   777000 316003                    CANQ    -512,DU
         0 001102   001117 601000 0                  TNZ     s:9013

      711     9006    3           THEN DO;

      712     9007    3                KI$ROUTE$(NODE#)->KI$ROUTE.LINK.QOS(FEI) = 254;

   9007  0 001103   200011 720100                    LXL0    NODE#,,AUTO
         0 001104   400000 475510                    LDP5    0,X0,PR4
         0 001105   200005 236100                    LDQ     FEI,,AUTO
         0 001106   000003 402007                    MPY     3,DL
         0 001107   000000 621006                    EAX1    0,QL
         0 001110   500003 236106                    LDQ     3,QL,PR5
         0 001111   000032 376000 xsym               ANQ     B_VECTNIL+26
         0 001112   376000 276003                    ORQ     130048,DU
         0 001113   500003 756111                    STQ     3,X1,PR5

      713     9008    3                CALL KIN$UPDATE_ROUTE ALTRET(DO_ALTRET);

   9008  0 001114   000002 631400 xsym               EPPR1   B_VECTNIL+2
         0 001115   000000 701000 xent               TSX1    KIN$UPDATE_ROUTE
         0 001116   001316 702000 0                  TSX2    DO_ALTRET

      714     9009    3                END;

      715     9010
      716     9011        /* Pass the message on up to qdp type session or to transport.
      717     9012        */
      718     9013    2           IF B$QDP_NHDR.MSGTYP = %K_MSGTYP_CP6_QDP#

   9013  0 001117   200003 470500                    LDP0    @K$RWPARM,,AUTO
         0 001120   000026 471500                    LDP1    22,,PR0
         0 001121   100000 236100                    LDQ     0,,PR1
         0 001122   777000 376003                    ANQ     -512,DU
         0 001123   376000 116003                    CMPQ    130048,DU
         0 001124   001135 601000 0                  TNZ     s:9021

PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:112  
      719     9014    3           THEN DO;

      720     9015    3                K$RWPARM.THDR$ = ADDR(NIL);

   9015  0 001125   000001 236000 xsym               LDQ     B_VECTNIL+1
         0 001126   000024 756100                    STQ     20,,PR0

      721     9016    3                K$RWPARM.THDRSZ = 0;

   9016  0 001127   000025 450100                    STZ     21,,PR0

      722     9017    3                CALL KIS$RECV(K$RWPARM) ALTRET(CHECK_ERR);

   9017  0 001130   200003 630500                    EPPR0   @K$RWPARM,,AUTO
         0 001131   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 001132   000000 701000 xent               TSX1    KIS$RECV
         0 001133   001152 702000 0                  TSX2    CHECK_ERR

      723     9018    3                END;

   9018  0 001134   001165 710000 0                  TRA     s:9033

      724     9019
      725     9020    3           ELSE DO;

      726     9021    3                K$RWPARM.LOCAL_FEP = KI$FEI.FEP#;

   9021  0 001135   200013 473500                    LDP3    FEI$,,AUTO
         0 001136   300012 236100                    LDQ     10,,PR3
         0 001137   000011 772000                    QRL     9
         0 001140   000032 552104                    STBQ    26,'04'O,PR0

      727     9022    3                K$RWPARM.THDR$ = K$RWPARM.SHDR$;

   9022  0 001141   000022 236100                    LDQ     18,,PR0
         0 001142   000024 756100                    STQ     20,,PR0

PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:113  
      728     9023    3                K$RWPARM.THDRSZ = K$RWPARM.SHDRSZ;

   9023  0 001143   000023 235100                    LDA     19,,PR0
         0 001144   000025 755100                    STA     21,,PR0

      729     9024    3                CALL KIT$RECV(K$RWPARM)

   9024  0 001145   200003 630500                    EPPR0   @K$RWPARM,,AUTO
         0 001146   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 001147   000000 701000 xent               TSX1    KIT$RECV
         0 001150   001152 702000 0                  TSX2    CHECK_ERR
         0 001151   001165 710000 0                  TRA     s:9033

      730     9025    4                WHENALTRETURN DO;

   9022  0 001152                       CHECK_ERR    null
      731     9026    4   CHECK_ERR:        ;
      732     9027    4                     IF K$RWPARM.ERR = %K$WAIT_READ

   9027  0 001152   200003 470500                    LDP0    @K$RWPARM,,AUTO
         0 001153   000013 235100                    LDA     11,,PR0
         0 001154   000006 115007                    CMPA    6,DL
         0 001155   001164 601000 0                  TNZ     s:9029

      733     9028    4                     THEN KI$ROUTE.LINK.MSGS_IN(FEI) = KI$ROUTE.LINK.MSGS_IN(FEI) + 1;

   9028  0 001156   200005 236100                    LDQ     FEI,,AUTO
         0 001157   000003 402007                    MPY     3,DL
         0 001160   200015 471500                    LDP1    ROUTE$,,AUTO
         0 001161   100004 235106                    LDA     4,QL,PR1
         0 001162   000001 035007                    ADLA    1,DL
         0 001163   100004 755106                    STA     4,QL,PR1

      734     9029    4                     ALTRETURN;

   9029  0 001164   000000 702200 xent               TSX2  ! X66_AALT

PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:114  
      735     9030    4                     END;
      736     9031    3                END/*do if not qdp*/;

      737     9032
      738     9033    2           KI$ROUTE.LINK.MSGS_IN(FEI) = KI$ROUTE.LINK.MSGS_IN(FEI) + 1;

   9033  0 001165   200005 236100                    LDQ     FEI,,AUTO
         0 001166   000003 402007                    MPY     3,DL
         0 001167   200015 470500                    LDP0    ROUTE$,,AUTO
         0 001170   000004 235106                    LDA     4,QL,PR0
         0 001171   000001 035007                    ADLA    1,DL
         0 001172   000004 755106                    STA     4,QL,PR0

      739     9034
      740     9035    2           RETURN;

   9035  0 001173   000000 702200 xent               TSX2  ! X66_ARET

      741     9036    2           END/*do if k_recv*/;
      742     9037
      743     9038
      744     9039        %EJECT;
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:115  
      745     9040        /*F* NAME: KIN$RECV - Report Disconnect
      746     9041
      747     9042        KIN$RECV is called with FUNCTION set to K_REPDISC from KIQ$FEABT.
      748     9043
      749     9044        The LINK_CONNECTED bit in the Route Table entry for this node is reset
      750     9045        and the QOS for the link entry in each route table is set to 255.
      751     9046
      752     9047        A call is made to update_route to recalculate the network routing.
      753     9048        */
      754     9049
      755     9050
      756     9051    1      IF K$RWPARM.FUNCTION = %K_REPDISC

   9051  0 001174   000007 115007                    CMPA    7,DL
         0 001175   001233 601000 0                  TNZ     s:9075

      757     9052    2      THEN DO;

      758     9053    2           KI$ROUTE$(KI$FEI.FEP#)->KI$ROUTE.LINK_CONNECTED = '0'B;

   9053  0 001176   200013 473500                    LDP3    FEI$,,AUTO
         0 001177   300012 236100                    LDQ     10,,PR3
         0 001200   000011 772000                    QRL     9
         0 001201   000777 376007                    ANQ     511,DL
         0 001202   000000 474400 xsym               LDP4    KI_ROUTE$$
         0 001203   400000 475506                    LDP5    0,QL,PR4
         0 001204   000001 236000 1                  LDQ     1
         0 001205   500002 356100                    ANSQ    2,,PR5

      759     9054
      760     9055    3           DO I = 0 TO KI_NODES;

   9055  0 001206   200007 450100                    STZ     I,,AUTO
         0 001207   001223 710000 0                  TRA     s:9057+1

      761     9056    3                KI$ROUTE$(I)->KI$ROUTE.LINK.QOS(FEI) = 255;

PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:116  
   9056  0 001210   000000 470400 xsym               LDP0    KI_ROUTE$$
         0 001211   200007 720100                    LXL0    I,,AUTO
         0 001212   000000 471510                    LDP1    0,X0,PR0
         0 001213   200005 236100                    LDQ     FEI,,AUTO
         0 001214   000003 402007                    MPY     3,DL
         0 001215   000000 621006                    EAX1    0,QL
         0 001216   100003 236106                    LDQ     3,QL,PR1
         0 001217   000032 376000 xsym               ANQ     B_VECTNIL+26
         0 001220   377000 276003                    ORQ     130560,DU
         0 001221   100003 756111                    STQ     3,X1,PR1

      762     9057    3                END;

   9057  0 001222   200007 054100                    AOS     I,,AUTO
         0 001223   000000 236000 xsym               LDQ     KI_NODES
         0 001224   001210 604000 0                  TMI     s:9056
         0 001225   200007 116100                    CMPQ    I,,AUTO
         0 001226   001210 605000 0                  TPL     s:9056

      763     9058
      764     9059    2           CALL KIN$UPDATE_ROUTE ALTRET(DO_ALTRET);

   9059  0 001227   000002 631400 xsym               EPPR1   B_VECTNIL+2
         0 001230   000000 701000 xent               TSX1    KIN$UPDATE_ROUTE
         0 001231   001316 702000 0                  TSX2    DO_ALTRET

      765     9060    2           RETURN;

   9060  0 001232   000000 702200 xent               TSX2  ! X66_ARET

      766     9061    2           END;
      767     9062
      768     9063        %EJECT;
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:117  
      769     9064        /*F* NAME: KIN$RECV - Connection Request
      770     9065
      771     9066        KIN$RECV is called with FUNCTION set to K_CONNECT from KIQ$FEINT.
      772     9067
      773     9068        The LINK_CONNECTED bit in the Route Table entry for this node is
      774     9069        turned on.
      775     9070
      776     9071        A call is made to update_route to recalculate the network routing.
      777     9072
      778     9073        */
      779     9074
      780     9075    1      IF K$RWPARM.FUNCTION = %K_CONNECT

   9075  0 001233   000003 115007                    CMPA    3,DL
         0 001234   001316 601000 0                  TNZ     DO_ALTRET

      781     9076    2      THEN DO;

      782     9077    3           DO I = 0 TO KI_NODES;

   9077  0 001235   200007 450100                    STZ     I,,AUTO
         0 001236   001306 710000 0                  TRA     s:9088+1

      783     9078    3                IF I = KI$FEI.FEP#         /* Going to same node                 */

   9078  0 001237   200013 470500                    LDP0    FEI$,,AUTO
         0 001240   000012 236100                    LDQ     10,,PR0
         0 001241   000011 772000                    QRL     9
         0 001242   000777 376007                    ANQ     511,DL
         0 001243   200007 116100                    CMPQ    I,,AUTO
         0 001244   001265 601000 0                  TNZ     s:9083

      784     9079    4                THEN DO;

      785     9080    4                     KI$ROUTE$(I)->KI$ROUTE.LINK.QOS(FEI) = KI$FEI.QOS;

   9080  0 001245   000000 471400 xsym               LDP1    KI_ROUTE$$
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:118  
         0 001246   200007 720100                    LXL0    I,,AUTO
         0 001247   100000 473510                    LDP3    0,X0,PR1
         0 001250   200005 236100                    LDQ     FEI,,AUTO
         0 001251   000003 402007                    MPY     3,DL
         0 001252   000000 621006                    EAX1    0,QL
         0 001253   000012 236100                    LDQ     10,,PR0
         0 001254   000033 736000                    QLS     27
         0 001255   300003 676111                    ERQ     3,X1,PR3
         0 001256   777000 376003                    ANQ     -512,DU
         0 001257   300003 656111                    ERSQ    3,X1,PR3

      786     9081    4                     KI$ROUTE$(I)->KI$ROUTE.LINK_CONNECTED = '1'B;

   9081  0 001260   000000 471400 xsym               LDP1    KI_ROUTE$$
         0 001261   100000 473510                    LDP3    0,X0,PR1
         0 001262   000200 236007                    LDQ     128,DL
         0 001263   300002 256100                    ORSQ    2,,PR3

      787     9082    4                     END;

   9082  0 001264   001277 710000 0                  TRA     s:9085

      788     9083    3                ELSE KI$ROUTE$(I)->KI$ROUTE.LINK.QOS(FEI)= 255;

   9083  0 001265   000000 471400 xsym               LDP1    KI_ROUTE$$
         0 001266   200007 720100                    LXL0    I,,AUTO
         0 001267   100000 473510                    LDP3    0,X0,PR1
         0 001270   200005 236100                    LDQ     FEI,,AUTO
         0 001271   000003 402007                    MPY     3,DL
         0 001272   000000 621006                    EAX1    0,QL
         0 001273   300003 236106                    LDQ     3,QL,PR3
         0 001274   000032 376000 xsym               ANQ     B_VECTNIL+26
         0 001275   377000 276003                    ORQ     130560,DU
         0 001276   300003 756111                    STQ     3,X1,PR3

      789     9084
      790     9085    3                KI$ROUTE$(I)->KI$ROUTE.LINK.MSGS_IN(FEI) = 0;
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:119  

   9085  0 001277   000000 471400 xsym               LDP1    KI_ROUTE$$
         0 001300   100000 473510                    LDP3    0,X0,PR1
         0 001301   300004 450111                    STZ     4,X1,PR3

      791     9086    3                KI$ROUTE$(I)->KI$ROUTE.LINK.MSGS_OUT(FEI) = 0;

   9086  0 001302   000000 471400 xsym               LDP1    KI_ROUTE$$
         0 001303   100000 473510                    LDP3    0,X0,PR1
         0 001304   300005 450111                    STZ     5,X1,PR3

      792     9087
      793     9088    3                END/*do 0 to ki_nodes*/;

   9088  0 001305   200007 054100                    AOS     I,,AUTO
         0 001306   000000 236000 xsym               LDQ     KI_NODES
         0 001307   001237 604000 0                  TMI     s:9078
         0 001310   200007 116100                    CMPQ    I,,AUTO
         0 001311   001237 605000 0                  TPL     s:9078

      794     9089
      795     9090    2           CALL KIN$UPDATE_ROUTE ALTRET(DO_ALTRET);

   9090  0 001312   000002 631400 xsym               EPPR1   B_VECTNIL+2
         0 001313   000000 701000 xent               TSX1    KIN$UPDATE_ROUTE
         0 001314   001316 702000 0                  TSX2    DO_ALTRET

      796     9091    2           RETURN;

   9091  0 001315   000000 702200 xent               TSX2  ! X66_ARET

   9086  0 001316                       DO_ALTRET    null
      797     9092    2           END/*do if k_connect*/;
      798     9093
      799     9094
      800     9095    1   DO_ALTRET: ;
      801     9096    1      ALTRETURN;
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:120  

   9096  0 001316   000000 702200 xent               TSX2  ! X66_AALT

      802     9097        %EJECT;
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:121  
      803     9098    1   SENDERR: PROC(K$RWPARM) ALTRET;

   9098  0 001317   200054 741300       SENDERR      STX1  ! ROUTE+16,,AUTO

      804     9099
      805     9100        %K$RWPARM(NAME=K$RWPARM,STCLASS="");
      806     9416
      807     9417
      808     9418        %KL_UPDOSI(FPTN=ROUTE,STCLASS=AUTO);
      809     9627        %K$NPDU_FIXED(NAME=FIXED,STCLASS=AUTO);
      810     9684    2   DCL SIZE UBIN BYTE;
      811     9685    2   DCL TSIZE UBIN BYTE;
      812     9686
      813     9687    2   DCL ADDRESS CHAR(SIZE) BASED ALIGNED;
      814     9688
      815     9689
      816     9690
      817     9691        %EJECT;
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:122  
      818     9692
      819     9693
      820     9694    2      IF K$NPDU_FIXED.TYPE = %K_ER_PDU OR NOT K$NPDU_FIXED.ER THEN

   9694  0 001320   200003 470500                    LDP0    @K$RWPARM,,AUTO
         0 001321   000026 471500                    LDP1    22,,PR0
         0 001322   100001 236100                    LDQ     1,,PR1
         0 001323   037000 376003                    ANQ     15872,DU
         0 001324   001000 116003                    CMPQ    512,DU
         0 001325   001331 600000 0                  TZE     s:9695
         0 001326   100001 236100                    LDQ     1,,PR1
         0 001327   040000 316003                    CANQ    16384,DU
         0 001330   001332 601000 0                  TNZ     s:9698

      821     9695    2           RETURN;
              9695                    /* dont generate errors if they dont want them.  dont generate errors

   9695  0 001331   000001 702211                    TSX2  ! 1,X1

      822     9696                      on errors */
      823     9697
      824     9698    2      CURINDX = LENGTHC(K$NPDU_FIXED);

   9698  0 001332   000011 235007                    LDA     9,DL
         0 001333   200022 755100                    STA     CURINDX,,AUTO

      825     9699
      826     9700    2      SIZE = K$RWPARM.RECTYPE;   /* a sleaze, really contains offset to error    */

   9700  0 001334   200055 473500                    LDP3    @K$RWPARM,,AUTO
         0 001335   300030 235100                    LDA     24,,PR3
         0 001336   000033 735000                    ALS     27
         0 001337   200100 755100                    STA     SIZE,,AUTO

      827     9701    2      FIXED.PROTOCOLID = %K_PRTCL_ID;

   9701  0 001340   201000 236003                    LDQ     66048,DU
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:123  
         0 001341   200075 552140                    STBQ    FIXED,'40'O,AUTO

      828     9702    2      FIXED.VERSION = %K_PRTCL_ID_EXT;

   9702  0 001342   001000 236007                    LDQ     512,DL
         0 001343   200075 552110                    STBQ    FIXED,'10'O,AUTO

      829     9703    2      FIXED.SP = '1'B;

   9703  0 001344   200000 236003                    LDQ     65536,DU
         0 001345   200076 256100                    ORSQ    FIXED+1,,AUTO

      830     9704    2      FIXED.ER = '0'B;

   9704  0 001346   000002 236000 1                  LDQ     2
         0 001347   200076 356100                    ANSQ    FIXED+1,,AUTO

      831     9705    2      FIXED.MS = '0'B;

   9705  0 001350   000003 236000 1                  LDQ     3
         0 001351   200076 356100                    ANSQ    FIXED+1,,AUTO

      832     9706    2      FIXED.MS = '0'B;

   9706  0 001352   200076 356100                    ANSQ    FIXED+1,,AUTO

      833     9707    2      FIXED.CHECKSUMX = 0;

   9707  0 001353   000000 236003                    LDQ     0,DU
         0 001354   200076 552104                    STBQ    FIXED+1,'04'O,AUTO

      834     9708    2      FIXED.CHECKSUMY = 0;

   9708  0 001355   200077 450100                    STZ     FIXED+2,,AUTO

      835     9709    2      FIXED.LIFETIME = KI_LIFETIME;

PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:124  
   9709  0 001356   000000 236000 xsym               LDQ     KI_LIFETIME
         0 001357   000022 772000                    QRL     18
         0 001360   200075 552104                    STBQ    FIXED,'04'O,AUTO

      836     9710    2      FIXED.LENGTH = LENGTHC(K$NPDU_FIXED)+SRC.LEN+DST.LEN+LENGTHC(SEGMENT)+6;
              9710               /*  for options*/

   9710  0 001361   000034 471500                    LDP1    28,,PR0
         0 001362   000035 474500                    LDP4    29,,PR0
         0 001363   000100 101500                    MRL     fill='000'O
         0 001364   400000 000001                    ADSC9   0,,PR4                   cn=0,n=1
         0 001365   200134 000004                    ADSC9   L+1,,AUTO                cn=0,n=4
         0 001366   000100 101500                    MRL     fill='000'O
         0 001367   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
         0 001370   200135 000004                    ADSC9   L+2,,AUTO                cn=0,n=4
         0 001371   200135 236100                    LDQ     L+2,,AUTO
         0 001372   200134 036100                    ADLQ    L+1,,AUTO
         0 001373   000025 036007                    ADLQ    21,DL
         0 001374   000022 736000                    QLS     18
         0 001375   200075 552120                    STBQ    FIXED,'20'O,AUTO

      837     9711
      838     9712    2      TSIZE = FIXED.LENGTH + SIZE;

   9712  0 001376   200100 236100                    LDQ     SIZE,,AUTO
         0 001377   000033 772000                    QRL     27
         0 001400   200134 756100                    STQ     L+1,,AUTO
         0 001401   200075 236100                    LDQ     FIXED,,AUTO
         0 001402   000022 772000                    QRL     18
         0 001403   000777 376007                    ANQ     511,DL
         0 001404   200134 036100                    ADLQ    L+1,,AUTO
         0 001405   000033 736000                    QLS     27
         0 001406   200101 756100                    STQ     TSIZE,,AUTO

      839     9713    2      FIXED.SEGLENX = TSIZE/256;

   9713  0 001407   200101 236100                    LDQ     TSIZE,,AUTO
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:125  
         0 001410   000033 772000                    QRL     27
         0 001411   000010 772000                    QRL     8
         0 001412   000022 736000                    QLS     18
         0 001413   200076 552120                    STBQ    FIXED+1,'20'O,AUTO

      840     9714    2      FIXED.SEGLENY = BITBIN(BINBIT(TSIZE,16)& 'FF'X);

   9714  0 001414   200101 236100                    LDQ     TSIZE,,AUTO
         0 001415   000033 772000                    QRL     27
         0 001416   000024 736000                    QLS     20
         0 001417   000022 772000                    QRL     18
         0 001420   000000 620006                    EAX0    0,QL
         0 001421   776000 360003                    ANX0    -1024,DU
         0 001422   000000 636010                    EAQ     0,X0
         0 001423   000024 772000                    QRL     20
         0 001424   000011 736000                    QLS     9
         0 001425   200076 552110                    STBQ    FIXED+1,'10'O,AUTO

      841     9715
      842     9716    2     SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,DST.LEN+1) = SUBSTR(ADDR(SRC)->ADDRESS,0,SRC.
              9716               LEN+1);

   9716  0 001426   200100 236100                    LDQ     SIZE,,AUTO
         0 001427   000033 772000                    QRL     27
         0 001430   000035 471500                    LDP1    29,,PR0
         0 001431   000100 101500                    MRL     fill='000'O
         0 001432   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
         0 001433   200134 000002                    ADSC9   L+1,,AUTO                cn=0,n=2
         0 001434   200134 220100                    LDX0    L+1,,AUTO
         0 001435   000001 622010                    EAX2    1,X0
         0 001436   000034 471500                    LDP1    28,,PR0
         0 001437   100000 236100                    LDQ     0,,PR1
         0 001440   000033 772000                    QRL     27
         0 001441   000001 623006                    EAX3    1,QL
         0 001442   200022 235100                    LDA     CURINDX,,AUTO
         0 001443   040145 100540                    MLR     fill='040'O
         0 001444   100000 000013                    ADSC9   0,,PR1                   cn=0,n=*X3
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:126  
         0 001445   200075 000012                    ADSC9   FIXED,A,AUTO             cn=0,n=*X2

      843     9717    2      CURINDX = SRC.LEN + 1;

   9717  0 001446   000034 471500                    LDP1    28,,PR0
         0 001447   000100 101500                    MRL     fill='000'O
         0 001450   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
         0 001451   200134 000004                    ADSC9   L+1,,AUTO                cn=0,n=4
         0 001452   200134 236100                    LDQ     L+1,,AUTO
         0 001453   000001 036007                    ADLQ    1,DL
         0 001454   200022 756100                    STQ     CURINDX,,AUTO

      844     9718
      845     9719    2     SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,SRC.LEN+1) = SUBSTR(ADDR(DST)->ADDRESS,0,DST.
              9719               LEN+1);

   9719  0 001455   200100 236100                    LDQ     SIZE,,AUTO
         0 001456   000033 772000                    QRL     27
         0 001457   000034 471500                    LDP1    28,,PR0
         0 001460   000100 101500                    MRL     fill='000'O
         0 001461   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
         0 001462   200134 000002                    ADSC9   L+1,,AUTO                cn=0,n=2
         0 001463   200134 220100                    LDX0    L+1,,AUTO
         0 001464   000001 621010                    EAX1    1,X0
         0 001465   000035 471500                    LDP1    29,,PR0
         0 001466   100000 236100                    LDQ     0,,PR1
         0 001467   000033 772000                    QRL     27
         0 001470   000001 622006                    EAX2    1,QL
         0 001471   200022 235100                    LDA     CURINDX,,AUTO
         0 001472   040145 100540                    MLR     fill='040'O
         0 001473   100000 000012                    ADSC9   0,,PR1                   cn=0,n=*X2
         0 001474   200075 000011                    ADSC9   FIXED,A,AUTO             cn=0,n=*X1

      846     9720    2      CURINDX = DST.LEN + 1;

   9720  0 001475   000035 471500                    LDP1    29,,PR0
         0 001476   000100 101500                    MRL     fill='000'O
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:127  
         0 001477   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
         0 001500   200134 000004                    ADSC9   L+1,,AUTO                cn=0,n=4
         0 001501   200134 236100                    LDQ     L+1,,AUTO
         0 001502   000001 036007                    ADLQ    1,DL
         0 001503   200022 756100                    STQ     CURINDX,,AUTO

      847     9721
      848     9722    2      KI_DATAID = KI_DATAID + 1;

   9722  0 001504   000000 236000 xsym               LDQ     KI_DATAID
         0 001505   001000 036003                    ADLQ    512,DU
         0 001506   000000 552040 xsym               STBQ    KI_DATAID,'40'O

      849     9723
      850     9724    2      SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,1) = SUBSTR(ADDR(KI_DATAID)->ADDRESS,0,1);

   9724  0 001507   200100 236100                    LDQ     SIZE,,AUTO
         0 001510   000033 772000                    QRL     27
         0 001511   200022 235100                    LDA     CURINDX,,AUTO
         0 001512   040105 100400                    MLR     fill='040'O
         0 001513   000000 000001 xsym               ADSC9   KI_DATAID                cn=0,n=1
         0 001514   200075 000001                    ADSC9   FIXED,A,AUTO             cn=0,n=1

      851     9725    2      CURINDX = CURINDX + 1;

   9725  0 001515   000001 035007                    ADLA    1,DL
         0 001516   200022 755100                    STA     CURINDX,,AUTO

      852     9726    2      SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,1) = SUBSTR(ADDR(KI_DATAID)->ADDRESS,1,1);

   9726  0 001517   200100 236100                    LDQ     SIZE,,AUTO
         0 001520   000033 772000                    QRL     27
         0 001521   040105 100400                    MLR     fill='040'O
         0 001522   000000 200001 xsym               ADSC9   KI_DATAID                cn=1,n=1
         0 001523   200075 000001                    ADSC9   FIXED,A,AUTO             cn=0,n=1

      853     9727    2      CURINDX = CURINDX + 1;
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:128  

   9727  0 001524   000001 035007                    ADLA    1,DL
         0 001525   200022 755100                    STA     CURINDX,,AUTO

      854     9728
      855     9729    2      SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,1) = %BITASC('0'B);

   9729  0 001526   200100 236100                    LDQ     SIZE,,AUTO
         0 001527   000033 772000                    QRL     27
         0 001530   040105 100400                    MLR     fill='040'O
         0 001531   000004 000001 1                  ADSC9   4                        cn=0,n=1
         0 001532   200075 000001                    ADSC9   FIXED,A,AUTO             cn=0,n=1

      856     9730    2      CURINDX = CURINDX + 1;

   9730  0 001533   000001 035007                    ADLA    1,DL
         0 001534   200022 755100                    STA     CURINDX,,AUTO

      857     9731
      858     9732    2      SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,1) = %BITASC('0'B);

   9732  0 001535   200100 236100                    LDQ     SIZE,,AUTO
         0 001536   000033 772000                    QRL     27
         0 001537   040105 100400                    MLR     fill='040'O
         0 001540   000004 000001 1                  ADSC9   4                        cn=0,n=1
         0 001541   200075 000001                    ADSC9   FIXED,A,AUTO             cn=0,n=1

      859     9733    2      CURINDX = CURINDX + 1;

   9733  0 001542   000001 035007                    ADLA    1,DL
         0 001543   200022 755100                    STA     CURINDX,,AUTO

      860     9734
      861     9735    2      SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,1) = SUBSTR(ADDR(TSIZE)->ADDRESS,0,1);

   9735  0 001544   200100 236100                    LDQ     SIZE,,AUTO
         0 001545   000033 772000                    QRL     27
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:129  
         0 001546   040105 100500                    MLR     fill='040'O
         0 001547   200101 000001                    ADSC9   TSIZE,,AUTO              cn=0,n=1
         0 001550   200075 000001                    ADSC9   FIXED,A,AUTO             cn=0,n=1

      862     9736    2      CURINDX = CURINDX + 1;

   9736  0 001551   000001 035007                    ADLA    1,DL
         0 001552   200022 755100                    STA     CURINDX,,AUTO

      863     9737
      864     9738    2      SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,1) = SUBSTR(ADDR(TSIZE)->ADDRESS,1,1);

   9738  0 001553   200100 236100                    LDQ     SIZE,,AUTO
         0 001554   000033 772000                    QRL     27
         0 001555   040105 100500                    MLR     fill='040'O
         0 001556   200101 200001                    ADSC9   TSIZE,,AUTO              cn=1,n=1
         0 001557   200075 000001                    ADSC9   FIXED,A,AUTO             cn=0,n=1

      865     9739    2      CURINDX = CURINDX + 1;

   9739  0 001560   000001 035007                    ADLA    1,DL
         0 001561   200022 755100                    STA     CURINDX,,AUTO

      866     9740
      867     9741        /* reason is in right half of errcode field */
      868     9742    2      SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,1) = %BINASC(%K_NPRM_REASON);

   9742  0 001562   200100 236100                    LDQ     SIZE,,AUTO
         0 001563   000033 772000                    QRL     27
         0 001564   040105 100400                    MLR     fill='040'O
         0 001565   000005 000001 1                  ADSC9   5                        cn=0,n=1
         0 001566   200075 000001                    ADSC9   FIXED,A,AUTO             cn=0,n=1

      869     9743    2      CURINDX = CURINDX + 1;

   9743  0 001567   000001 035007                    ADLA    1,DL
         0 001570   200022 755100                    STA     CURINDX,,AUTO
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:130  

      870     9744
      871     9745    2      SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,1) = %BITASC('2'X); /* size of parameter */

   9745  0 001571   200100 236100                    LDQ     SIZE,,AUTO
         0 001572   000033 772000                    QRL     27
         0 001573   040105 100400                    MLR     fill='040'O
         0 001574   000006 000001 1                  ADSC9   6                        cn=0,n=1
         0 001575   200075 000001                    ADSC9   FIXED,A,AUTO             cn=0,n=1

      872     9746    2      CURINDX = CURINDX + 1;

   9746  0 001576   000001 035007                    ADLA    1,DL
         0 001577   200022 755100                    STA     CURINDX,,AUTO

      873     9747
      874     9748        /*
      875     9749             byte 3 of err contains the value of the error being returned in the
      876     9750             error pdu
      877     9751        */
      878     9752    2     SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,1) = SUBSTR(ADDR(K$RWPARM.ERR)->ADDRESS,3,1);

   9752  0 001600   200100 236100                    LDQ     SIZE,,AUTO
         0 001601   000033 772000                    QRL     27
         0 001602   040105 100500                    MLR     fill='040'O
         0 001603   300013 600001                    ADSC9   11,,PR3                  cn=3,n=1
         0 001604   200075 000001                    ADSC9   FIXED,A,AUTO             cn=0,n=1

      879     9753    2      CURINDX = CURINDX + 1;

   9753  0 001605   000001 035007                    ADLA    1,DL
         0 001606   200022 755100                    STA     CURINDX,,AUTO

      880     9754
      881     9755        /* use the right half of size to determine the size of the data being returned */
      882     9756
      883     9757    3      IF SIZE > 254 THEN DO;
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:131  

   9757  0 001607   200100 236100                    LDQ     SIZE,,AUTO
         0 001610   777000 376003                    ANQ     -512,DU
         0 001611   377000 116003                    CMPQ    130560,DU
         0 001612   001622 602000 0                  TNC     s:9762

      884     9758    3           SIZE = 0;

   9758  0 001613   200100 450100                    STZ     SIZE,,AUTO

      885     9759    3           SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,1) = %BITASC('0'B);

   9759  0 001614   200100 236100                    LDQ     SIZE,,AUTO
         0 001615   000033 772000                    QRL     27
         0 001616   040105 100400                    MLR     fill='040'O
         0 001617   000004 000001 1                  ADSC9   4                        cn=0,n=1
         0 001620   200075 000001                    ADSC9   FIXED,A,AUTO             cn=0,n=1

      886     9760    3           END;

   9760  0 001621   001627 710000 0                  TRA     s:9764

      887     9761    2      ELSE
      888     9762    2           SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,1) = SUBSTR(ADDR(SIZE)->ADDRESS,1,1);

   9762  0 001622   200100 236100                    LDQ     SIZE,,AUTO
         0 001623   000033 772000                    QRL     27
         0 001624   040105 100500                    MLR     fill='040'O
         0 001625   200100 200001                    ADSC9   SIZE,,AUTO               cn=1,n=1
         0 001626   200075 000001                    ADSC9   FIXED,A,AUTO             cn=0,n=1

      889     9763
      890     9764    2      CURINDX = CURINDX + 1;

   9764  0 001627   000001 035007                    ADLA    1,DL
         0 001630   200022 755100                    STA     CURINDX,,AUTO

PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:132  
      891     9765
      892     9766    2     SUBSTR(ADDR(FIXED)->ADDRESS,CURINDX,SIZE) = SUBSTR(K$RWPARM.NHDR$->ADDRESS,0,SIZE
              9766               );

   9766  0 001631   200100 236100                    LDQ     SIZE,,AUTO
         0 001632   000033 772000                    QRL     27
         0 001633   300026 471500                    LDP1    22,,PR3
         0 001634   000000 620006                    EAX0    0,QL
         0 001635   200100 236100                    LDQ     SIZE,,AUTO
         0 001636   000033 772000                    QRL     27
         0 001637   000000 621006                    EAX1    0,QL
         0 001640   040145 100540                    MLR     fill='040'O
         0 001641   100000 000011                    ADSC9   0,,PR1                   cn=0,n=*X1
         0 001642   200075 000010                    ADSC9   FIXED,A,AUTO             cn=0,n=*X0

      893     9767    2      CURINDX = CURINDX + SIZE;

   9767  0 001643   200100 236100                    LDQ     SIZE,,AUTO
         0 001644   000033 772000                    QRL     27
         0 001645   200022 036100                    ADLQ    CURINDX,,AUTO
         0 001646   200022 756100                    STQ     CURINDX,,AUTO

      894     9768
      895     9769    2      IF SIZE + FIXED.LENGTH > LENGTHC(FIXED) THEN

   9769  0 001647   200075 236100                    LDQ     FIXED,,AUTO
         0 001650   000022 772000                    QRL     18
         0 001651   000777 376007                    ANQ     511,DL
         0 001652   200134 756100                    STQ     L+1,,AUTO
         0 001653   200100 236100                    LDQ     SIZE,,AUTO
         0 001654   000033 772000                    QRL     27
         0 001655   200134 036100                    ADLQ    L+1,,AUTO
         0 001656   000012 116007                    CMPQ    10,DL
         0 001657   001663 602000 0                  TNC     s:9772

      896     9770    2           SIZE = LENGTHC(FIXED);

PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:133  
   9770  0 001660   011000 236003                    LDQ     4608,DU
         0 001661   200100 756100                    STQ     SIZE,,AUTO
         0 001662   001674 710000 0                  TRA     s:9775

      897     9771    2      ELSE
      898     9772    2           SIZE = SIZE + FIXED.LENGTH;

   9772  0 001663   200075 236100                    LDQ     FIXED,,AUTO
         0 001664   000022 772000                    QRL     18
         0 001665   000777 376007                    ANQ     511,DL
         0 001666   200134 756100                    STQ     L+1,,AUTO
         0 001667   200100 236100                    LDQ     SIZE,,AUTO
         0 001670   000033 772000                    QRL     27
         0 001671   200134 036100                    ADLQ    L+1,,AUTO
         0 001672   000033 736000                    QLS     27
         0 001673   200100 756100                    STQ     SIZE,,AUTO

      899     9773
      900     9774
      901     9775    2      CALL DECODE_ADDR(DST,ROUTE);

   9775  0 001674   000035 471500                    LDP1    29,,PR0
         0 001675   200056 634500                    EPPR4   ROUTE,,AUTO
         0 001676   200104 454500                    STP4    @DST+1,,AUTO
         0 001677   200103 451500                    STP1    TSIZE+2,,AUTO
         0 001700   001736 701000 0                  TSX1    DECODE_ADDR
         0 001701   000000 011000                    NOP     0

      902     9776    2      IF ROUTE.QOS = 255 THEN RETURN;
              9776               /* no route to return error pdu, dump the message*/

   9776  0 001702   200057 236100                    LDQ     ROUTE+1,,AUTO
         0 001703   000777 376003                    ANQ     511,DU
         0 001704   000377 116003                    CMPQ    255,DU
         0 001705   001710 601000 0                  TNZ     s:9778

   9776  0 001706   200054 221300                    LDX1  ! ROUTE+16,,AUTO
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:134  
         0 001707   000001 702211                    TSX2  ! 1,X1

      903     9777
      904     9778    2      K$RWPARM.FEX = KI$ROUTE$(ROUTE.NODE#)->KI$ROUTE.FEI#;

   9778  0 001710   200056 720100                    LXL0    ROUTE,,AUTO
         0 001711   000777 360003                    ANX0    511,DU
         0 001712   000000 470400 xsym               LDP0    KI_ROUTE$$
         0 001713   000000 471510                    LDP1    0,X0,PR0
         0 001714   100002 236100                    LDQ     2,,PR1
         0 001715   000033 772000                    QRL     27
         0 001716   200055 473500                    LDP3    @K$RWPARM,,AUTO
         0 001717   300021 756100                    STQ     17,,PR3

      905     9779    2      K$RWPARM.UHDRSZ = 0;

   9779  0 001720   300015 450100                    STZ     13,,PR3

      906     9780    2      K$RWPARM.SHDRSZ = 0;

   9780  0 001721   300023 450100                    STZ     19,,PR3

      907     9781    2      K$RWPARM.THDRSZ = 0;

   9781  0 001722   300025 450100                    STZ     21,,PR3

      908     9782    2      K$RWPARM.MSGSZ = 0;

   9782  0 001723   300001 450100                    STZ     1,,PR3

      909     9783    2      K$RWPARM.FUNCTION = %K_WRITE;

   9783  0 001724   000001 235007                    LDA     1,DL
         0 001725   300020 755100                    STA     16,,PR3

      910     9784    2      CALL KIQ$LINK(K$RWPARM) ALTRET(DO_ALTRET);

PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:135  
   9784  0 001726   200055 630500                    EPPR0   @K$RWPARM,,AUTO
         0 001727   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 001730   000000 701000 xent               TSX1    KIQ$LINK
         0 001731   001734 702000 0                  TSX2    DO_ALTRET

      911     9785
      912     9786    2      RETURN;

   9786  0 001732   200054 221300                    LDX1  ! ROUTE+16,,AUTO
         0 001733   000001 702211                    TSX2  ! 1,X1

      913     9787
      914     9788    2   DO_ALTRET:
      915     9789    2      ALTRETURN;

   9789  0 001734   200054 221300       DO_ALTRET    LDX1  ! ROUTE+16,,AUTO
         0 001735   000000 702211                    TSX2  ! 0,X1

      916     9790    2   END SENDERR;
      917     9791        %EJECT;
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:136  
      918     9792    1   DECODE_ADDR: PROC(DST,ROUTE) ALTRET;

   9792  0 001736   200102 741300       DECODE_ADDR  STX1  ! TSIZE+1,,AUTO

      919     9793        /*
      920     9794             DST - address to be decoded.  Decoded in terms of determining whether
      921     9795                   the addresses exists in the osi route table.
      922     9796             ROUTE - an kl_updosi macro, only the first part is used to convey the
      923     9797                      node#, link# and qos of nsap address.
      924     9798        */
      925     9799
      926     9800
      927     9801        %KL_UPDOSI(FPTN=ROUTE,STCLASS="");
      928    10010        %K$NSAP(FPTN=DST,STCLASS="");
      929    10062
      930    10063    2   DCL FOUNDONE BIT(1);
      931    10064    2   DCL I UBIN;
      932    10065    2   DCL INX UBIN;
      933    10066    2   DCL CQOS UBIN;
      934    10067    2   DCL NQOS UBIN;
      935    10068    2   DCL INDX(0:15) UBIN;
      936    10069    2   DCL SVINDX SBIN;
      937    10070    2   DCL L UBIN;
      938    10071    2      FOUNDONE = '0'B;

  10071  0 001737   200105 450100                    STZ     FOUNDONE,,AUTO

      939    10072    3   OSIRTE: DO I = 0 TO KI_OSIMAX# - 1;

  10072  0 001740   200106 450100       OSIRTE       STZ     I,,AUTO
         0 001741   002142 710000 0                  TRA     s:10114+3

      940    10073    3           OSI$ = KI$OSIROUTE$(I);

  10073  0 001742   000000 470400 xsym               LDP0    KI_OSIROUTE$$
         0 001743   200106 720100                    LXL0    I,,AUTO
         0 001744   000000 236110                    LDQ     0,X0,PR0
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:137  
         0 001745   200014 756100                    STQ     OSI$,,AUTO

      941    10074    3           IF KI$OSIROUTE.NS_TYPE = %K_TYPE_RNSAP AND

  10074  0 001746   200014 471500                    LDP1    OSI$,,AUTO
         0 001747   100015 236100                    LDQ     13,,PR1
         0 001750   360000 376003                    ANQ     122880,DU
         0 001751   040000 116003                    CMPQ    16384,DU
         0 001752   002137 601000 0                  TNZ     s:10114
         0 001753   200103 473500                    LDP3    @DST,,AUTO
         0 001754   000100 101500                    MRL     fill='000'O
         0 001755   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
         0 001756   200134 000002                    ADSC9   L+1,,AUTO                cn=0,n=2
         0 001757   200134 221100                    LDX1    L+1,,AUTO
         0 001760   000001 622011                    EAX2    1,X1
         0 001761   100000 236100                    LDQ     0,,PR1
         0 001762   000033 772000                    QRL     27
         0 001763   000001 623006                    EAX3    1,QL
         0 001764   040140 106540                    CMPC    fill='040'O
         0 001765   300000 000012                    ADSC9   0,,PR3                   cn=0,n=*X2
         0 001766   100000 000013                    ADSC9   0,,PR1                   cn=0,n=*X3
         0 001767   002137 601000 0                  TNZ     s:10114

      942    10075    3             SUBSTR(ADDR(DST)->ADDRESS,0,DST.LEN+1) =
      943    10076    4             SUBSTR(ADDR(KI$OSIROUTE.NSAP)->ADDRESS,0,KI$OSIROUTE.NSAP.LEN+1) THEN DO;

      944    10077    4                FOUNDONE = '1'B;

  10077  0 001770   400000 236003                    LDQ     -131072,DU
         0 001771   200105 756100                    STQ     FOUNDONE,,AUTO

      945    10078    4                J = 0;

  10078  0 001772   200010 450100                    STZ     J,,AUTO

      946    10079    4                INX = 0;

PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:138  
  10079  0 001773   200107 450100                    STZ     INX,,AUTO

      947    10080    5                DO WHILE J < KI_MXFE;

  10080  0 001774   200010 236100                    LDQ     J,,AUTO
         0 001775   002000 604000 0                  TMI     s:10081
         0 001776   000000 116000 xsym               CMPQ    KI_MXFE
         0 001777   002025 603000 0                  TRC     s:10087

      948    10081    6                     IF KI$OSIROUTE.LINK.ACTIVE(J) THEN DO;

  10081  0 002000   200010 236100                    LDQ     J,,AUTO
         0 002001   000207 402007                    MPY     135,DL
         0 002002   000000 116003                    CMPQ    0,DU
         0 002003   002005 605000 0                  TPL     s:10081+5
         0 002004   000044 036003                    ADLQ    36,DU
         0 002005   200014 470500                    LDP0    OSI$,,AUTO
         0 002006   000000 066506                    CMPB    filb='0'B
         0 002007   000015 210001                    BDSC    13,Q,PR0                 by=1,bit=1,n=1
         0 002010   000002 000022 xsym               BDSC    B_VECTNIL+2              by=0,bit=0,n=18
         0 002011   002020 600000 0                  TZE     s:10085

      949    10082    6                          INDX(INX) = J;

  10082  0 002012   200010 235100                    LDA     J,,AUTO
         0 002013   200107 720100                    LXL0    INX,,AUTO
         0 002014   200112 755110                    STA     INDX,X0,AUTO

      950    10083    6                          INX = INX + 1;

  10083  0 002015   200107 236100                    LDQ     INX,,AUTO
         0 002016   000001 036007                    ADLQ    1,DL
         0 002017   200107 756100                    STQ     INX,,AUTO

      951    10084    6                          END;

      952    10085    5                     J = J + 1;
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:139  

  10085  0 002020   200010 054100                    AOS     J,,AUTO

      953    10086    5                     END;

  10086  0 002021   200010 236100                    LDQ     J,,AUTO
         0 002022   002000 604000 0                  TMI     s:10081
         0 002023   000000 116000 xsym               CMPQ    KI_MXFE
         0 002024   002000 602000 0                  TNC     s:10081

      954    10087    5                IF INX > 0 THEN DO;        /* one or more routes available       */

  10087  0 002025   200107 235100                    LDA     INX,,AUTO
         0 002026   002132 600000 0                  TZE     s:10110

      955    10088    5                     CQOS = 255;

  10088  0 002027   000377 235007                    LDA     255,DL
         0 002030   200110 755100                    STA     CQOS,,AUTO

      956    10089    5                     SVINDX = -1;

  10089  0 002031   000001 335007                    LCA     1,DL
         0 002032   200132 755100                    STA     SVINDX,,AUTO

      957    10090    6                     DO J = 0 TO INX-1;

  10090  0 002033   200010 450100                    STZ     J,,AUTO
         0 002034   002106 710000 0                  TRA     s:10099+1

      958    10091    6                          L = INDX(J);

  10091  0 002035   200010 720100                    LXL0    J,,AUTO
         0 002036   200112 235110                    LDA     INDX,X0,AUTO
         0 002037   200133 755100                    STA     L,,AUTO

      959    10092    6                          IF KI$OSIROUTE.LINK.FEP#(L) < KI_NODES AND
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:140  

  10092  0 002040   200133 236100                    LDQ     L,,AUTO
         0 002041   000017 402007                    MPY     15,DL
         0 002042   200014 470500                    LDP0    OSI$,,AUTO
         0 002043   000100 101506                    MRL     fill='000'O
         0 002044   000015 400001                    ADSC9   13,Q,PR0                 cn=2,n=1
         0 002045   200134 000004                    ADSC9   L+1,,AUTO                cn=0,n=4
         0 002046   200134 236100                    LDQ     L+1,,AUTO
         0 002047   000000 116000 xsym               CMPQ    KI_NODES
         0 002050   002077 603000 0                  TRC     s:10095
         0 002051   200133 236100                    LDQ     L,,AUTO
         0 002052   000017 402007                    MPY     15,DL
         0 002053   000100 101506                    MRL     fill='000'O
         0 002054   000015 400001                    ADSC9   13,Q,PR0                 cn=2,n=1
         0 002055   200135 000002                    ADSC9   L+2,,AUTO                cn=0,n=2
         0 002056   200135 221100                    LDX1    L+2,,AUTO
         0 002057   000000 471400 xsym               LDP1    KI_ROUTE$$
         0 002060   100000 473511                    LDP3    0,X1,PR1
         0 002061   300002 236100                    LDQ     2,,PR3
         0 002062   777000 316003                    CANQ    -512,DU
         0 002063   002077 600000 0                  TZE     s:10095

      960    10093    6                            KI$ROUTE$(KI$OSIROUTE.LINK.FEP#(L))->KI$ROUTE.FEI# ~= 0
             10093                                     THEN
      961    10094    6                               NQOS = KI$ROUTE$(KI$OSIROUTE.LINK.FEP#(L))->KI$ROUTE.
             10094                                        CURRENT_QOS;

  10094  0 002064   200133 236100                    LDQ     L,,AUTO
         0 002065   000017 402007                    MPY     15,DL
         0 002066   000100 101506                    MRL     fill='000'O
         0 002067   000015 400001                    ADSC9   13,Q,PR0                 cn=2,n=1
         0 002070   200134 000002                    ADSC9   L+1,,AUTO                cn=0,n=2
         0 002071   200134 221100                    LDX1    L+1,,AUTO
         0 002072   100000 473511                    LDP3    0,X1,PR1
         0 002073   300002 236100                    LDQ     2,,PR3
         0 002074   000022 772000                    QRL     18
         0 002075   000777 376007                    ANQ     511,DL
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:141  
         0 002076   200111 756100                    STQ     NQOS,,AUTO

      962    10095    7                          IF NQOS < CQOS THEN DO;

  10095  0 002077   200111 236100                    LDQ     NQOS,,AUTO
         0 002100   200110 116100                    CMPQ    CQOS,,AUTO
         0 002101   002105 603000 0                  TRC     s:10099

      963    10096    7                               SVINDX = J;

  10096  0 002102   200010 235100                    LDA     J,,AUTO
         0 002103   200132 755100                    STA     SVINDX,,AUTO

      964    10097    7                               CQOS = NQOS;

  10097  0 002104   200110 756100                    STQ     CQOS,,AUTO

      965    10098    7                               END;

      966    10099    6                          END;

  10099  0 002105   200010 054100                    AOS     J,,AUTO
         0 002106   200010 236100                    LDQ     J,,AUTO
         0 002107   002035 604000 0                  TMI     s:10091
         0 002110   200107 116100                    CMPQ    INX,,AUTO
         0 002111   002035 602000 0                  TNC     s:10091

      967    10100    6                     IF SVINDX = -1 THEN DO;

  10100  0 002112   200132 235100                    LDA     SVINDX,,AUTO
         0 002113   000027 115000 xsym               CMPA    B_VECTNIL+23
         0 002114   002122 601000 0                  TNZ     s:10105

      968    10101    6                          ROUTE.QOS = 255;

  10101  0 002115   200104 470500                    LDP0    @ROUTE,,AUTO
         0 002116   000377 236003                    LDQ     255,DU
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:142  
         0 002117   000001 552120                    STBQ    1,'20'O,PR0

      969    10102    6                          ALTRETURN;

  10102  0 002120   200102 221300                    LDX1  ! TSIZE+1,,AUTO
         0 002121   000000 702211                    TSX2  ! 0,X1

      970    10103    6                          END;
      971    10104    6                     ELSE DO;

      972    10105    6                          ROUTE.NODE# = KI$OSIROUTE.LINK.FEP#(SVINDX);

  10105  0 002122   200132 236100                    LDQ     SVINDX,,AUTO
         0 002123   000017 402007                    MPY     15,DL
         0 002124   200014 470500                    LDP0    OSI$,,AUTO
         0 002125   200104 471500                    LDP1    @ROUTE,,AUTO
         0 002126   000100 100506                    MLR     fill='000'O
         0 002127   000015 400001                    ADSC9   13,Q,PR0                 cn=2,n=1
         0 002130   100000 600001                    ADSC9   0,,PR1                   cn=3,n=1

      973    10106    6                          EXIT OSIRTE;

  10106  0 002131   002145 710000 0                  TRA     s:10115

      974    10107    6                          END;
      975    10108    5                     END;
      976    10109    5                ELSE DO;

      977    10110    5                     ROUTE.QOS = 255;

  10110  0 002132   200104 470500                    LDP0    @ROUTE,,AUTO
         0 002133   000377 236003                    LDQ     255,DU
         0 002134   000001 552120                    STBQ    1,'20'O,PR0

      978    10111    5                     ALTRETURN;

  10111  0 002135   200102 221300                    LDX1  ! TSIZE+1,,AUTO
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:143  
         0 002136   000000 702211                    TSX2  ! 0,X1

      979    10112    5                     END;
      980    10113    4                END;                       /* IF INX > 0                         */
      981    10114    3           END;                            /* DO I = 0 TO KNN_OSIMAX#-1*/

  10114  0 002137   200106 235100                    LDA     I,,AUTO
         0 002140   000001 035007                    ADLA    1,DL
         0 002141   200106 755100                    STA     I,,AUTO
         0 002142   200106 236100                    LDQ     I,,AUTO
         0 002143   000000 116000 xsym               CMPQ    KI_OSIMAX#
         0 002144   001742 602000 0                  TNC     s:10073

      982    10115    2      IF NOT FOUNDONE THEN ALTRETURN;

  10115  0 002145   200105 234100                    SZN     FOUNDONE,,AUTO
         0 002146   002151 604000 0                  TMI     s:10116

  10115  0 002147   200102 221300                    LDX1  ! TSIZE+1,,AUTO
         0 002150   000000 702211                    TSX2  ! 0,X1

      983    10116    2   END DECODE_ADDR;

  10116  0 002151   200102 221300                    LDX1  ! TSIZE+1,,AUTO
         0 002152   000001 702211                    TSX2  ! 1,X1

(unnamed)
 Sect OctLoc
   1     000   000006 400000   777777 777577   737777 777777   677777 777777    ................
   1     004   000040 040040   301040 040040   002040 040040                    .   .   .
      984    10117    1   END KIN$RECV;
      985    10118        %EOD;

PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:144  
--  Include file information  --

   K_INTERFACE_M.:E05TOU  is referenced.
   KNN_NETWORK_M.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   K_NETWORK_E.:E05TOU  is referenced.
   K_NETWORK_M.:E05TOU  is referenced.
   K_ADDRESS_M.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_SUBS_C.:E05TOU  is referenced.
   KI_MACROS_C.:E05TOU  is referenced.
   K_QDPHDRS_M.:E05TOU  is referenced.
      No diagnostics issued in procedure KIN$RECV.
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:145  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

   103-0-0/w PTR         r     1 @DST                       3-0-0/w PTR         r     1 @K$RWPARM
    55-0-0/w PTR         r     1 @K$RWPARM                104-0-0/w PTR         r     1 @ROUTE
    30-0-0/w UBIN        r     1 CODE                     110-0-0/w UBIN        r     1 CQOS
    22-0-0/w UBIN        r     1 CURINDX                   26-0-0/w PTR         r     1 D$
    21-0-0/w UBIN(18)    r     1 DATASIZE                  *0-0-0/c STRC(198)   r     1 DST
    24-0-0/w UBIN        r     1 DSTINDX                    5-0-0/w UBIN        r     1 FEI
     6-0-0/w UBIN        r     1 FEI#                      13-0-0/w PTR         r     1 FEI$
    75-0-0/w STRC(81)    r     1 FIXED                     23-0-0/w UBIN        r     1 FIXEDSIZ
   105-0-0/b BIT         r     1 FOUNDONE                   7-0-0/w SBIN        r     1 I
   106-0-0/w UBIN        r     1 I                        112-0-0/w UBIN        r     1 INDX(0:15)
   107-0-0/w UBIN        r     1 INX                       10-0-0/w SBIN        r     1 J
    *0-0-0/d STRC(1404)  r     1 K$RWPARM                  *0-0-0/d STRC(1404)  r     1 K$RWPARM
   133-0-0/w UBIN        r     1 L                         17-0-0/w SBIN        r     1 LI
    11-0-0/w SBIN        r     1 NODE#                    111-0-0/w UBIN        r     1 NQOS
    27-0-0/w UBIN        r     1 OPTSZ                     31-0-0/w UBIN        r     1 OPTVAL
    14-0-0/w PTR         r     1 OSI$                      34-0-0/w STRC(540)   r     1 ROUTE
    56-0-0/w STRC(540)   r     1 ROUTE                     *0-0-0/w STRC(540)   r     1 ROUTE
    15-0-0/w PTR         r     1 ROUTE$                    20-0-0/w UBIN(18)    r     1 SEGLENGTH
    32-0-0/w STRC(54)    r     1 SEGMENT                   16-0-0/w UBIN        r     1 SIZE
   100-0-0/w UBIN(9)     r     1 SIZE                      25-0-0/w UBIN        r     1 SRCINDX
   132-0-0/w SBIN        r     1 SVINDX                   101-0-0/w UBIN(9)     r     1 TSIZE

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN(9)     r     1 KI_DATAID                  0-0-0/w PTR         r     1 KI_FEI$$
     0-0-0/w UBIN(18)    r     1 KI_LIFETIME                0-0-0/w UBIN        r     1 KI_MXFE
     0-0-0/w UBIN        r     1 KI_NODES                   0-0-0/w UBIN        r     1 KI_OSIMAX#
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:146  
     0-0-0/w PTR         r     1 KI_OSIROUTE$$              0-0-0/w PTR         r     1 KI_ROUTE$$
     0-0-0/w UBIN        r     1 K_NODE#                    0-0-0/w PTR         r     1 N$DCT$$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c ACHR        r     1 ADDRESS                    0-0-0/w ACHR        r     1 ADDRESS
     0-0-0/w STRC        r     1 B$QDP_NHDR                 0-0-0/w STRC(612)   r     1 B$QDP_NOSIHDR
     0-0-0/h STRC(18)    r     1 BSDHLFWRD                  0-0-0/c CHAR        r     1 CHR(0:3)
     0-0-0/c STRC(198)   r     1 DST                        0-0-0/w STRC(81)    r     1 K$NPDU_FIXED
     0-0-0/w STRC(54)    r     1 K$NPDU_SEGMENT             0-0-0/w STRC(612)   r     1 KI$FEI
     0-0-0/w PTR         r     1 KI$FEI$(0:0)
     0-0-0/w STRC(612)   r     1 KI$OSIROUTE
     0-0-0/w PTR         r     1 KI$OSIROUTE$(0:0)
     0-0-0/w STRC(216)   r     1 KI$ROUTE
     0-0-0/w PTR         r     1 KI$ROUTE$(0:0)
     0-0-0/c STRC(198)   r     1 SRC


   Procedure KIN$RECV requires 1131 words for executable code.
   Procedure KIN$RECV requires 94 words of local(AUTO) storage.
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:147  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:148  
          MINI XREF LISTING

ADDRESS
      8684**DCL      8778>>ASSIGN   8785<<ASSIGN   8785>>ASSIGN   8791>>ASSIGN   8799<<ASSIGN   8799>>ASSIGN
      8848<<ASSIGN   8848>>ASSIGN   8869>>ASSIGN   8871>>ASSIGN   8892>>ASSIGN   8905>>ASSIGN  10074>>IF
     10074>>IF
ADDRESS IN PROCEDURE SENDERR
      9687**DCL      9716<<ASSIGN   9716>>ASSIGN   9719<<ASSIGN   9719>>ASSIGN   9724<<ASSIGN   9724>>ASSIGN
      9726<<ASSIGN   9726>>ASSIGN   9729<<ASSIGN   9732<<ASSIGN   9735<<ASSIGN   9735>>ASSIGN   9738<<ASSIGN
      9738>>ASSIGN   9742<<ASSIGN   9745<<ASSIGN   9752<<ASSIGN   9752>>ASSIGN   9759<<ASSIGN   9762<<ASSIGN
      9762>>ASSIGN   9766<<ASSIGN   9766>>ASSIGN
B$QDP_NHDR
      8021**DCL      8743--ASSIGN   8744--ASSIGN   8970--ASSIGN   9002--ASSIGN
B$QDP_NHDR.DEST_NODE
      8042**DCL      8727>>IF       8974>>ASSIGN   8976>>IF
B$QDP_NHDR.HOP_COUNT
      8037**DCL      8982>>IF       8985<<ASSIGN   8985>>ASSIGN
B$QDP_NHDR.MSGTYP
      8022**DCL      8725>>IF       8725>>IF       8732>>IF       8755>>IF       8965>>IF       8965>>IF
      9013>>IF
B$QDP_NHDR.SOURCE_NODE
      8048**DCL      8973>>ASSIGN
B$QDP_NOSIHDR
      8098**DCL      8736--ASSIGN
B$QDP_NOSIHDR.DST_NSAP
      8150**DCL      8734--ASSIGN
B$QDP_NOSIHDR.DST_NSAP.ADDRESS_N
      8180**DCL      8181--REDEF
B$QDP_NOSIHDR.SRC_NSAP
      8208**DCL      8735--ASSIGN
B$QDP_NOSIHDR.SRC_NSAP.ADDRESS_N
      8238**DCL      8239--REDEF
B$QDP_NOSIHDR.TR_OPTIONS.TPDUSIZE
      8274**DCL      8275--REDEF
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:149  
BSDHLFWRD.BITS10TO17
      8688**DCL      8832>>ASSIGN
BSDHLFWRD.BITS2TO9
      8687**DCL      8831>>ASSIGN
CHECK_ERR
      9022**LABEL    9017--CALLALT
CHR
      8683**DCL      8778<<ASSIGN   8791<<ASSIGN   8869<<ASSIGN   8871<<ASSIGN   8892<<ASSIGN   8905<<ASSIGN
CODE
      7377**DCL      8869--ASSIGN   8881>>DOCASE
CQOS IN PROCEDURE DECODE_ADDR
     10066**DCL     10088<<ASSIGN  10095>>IF      10097<<ASSIGN
CURINDX
      7371**DCL      8776<<ASSIGN   8778>>ASSIGN   8783>>ASSIGN   8785>>ASSIGN   8787<<ASSIGN   8787>>ASSIGN
      8791>>ASSIGN   8792>>ASSIGN   8799>>ASSIGN   8802<<ASSIGN   8802>>ASSIGN   8848>>ASSIGN   8852<<ASSIGN
      8869>>ASSIGN   8870<<ASSIGN   8870>>ASSIGN   8871>>ASSIGN   8872<<ASSIGN   8872>>ASSIGN   8892>>ASSIGN
      8905>>ASSIGN   8924<<ASSIGN   8924>>ASSIGN   9698<<ASSIGN   9716>>ASSIGN   9717<<ASSIGN   9719>>ASSIGN
      9720<<ASSIGN   9724>>ASSIGN   9725<<ASSIGN   9725>>ASSIGN   9726>>ASSIGN   9727<<ASSIGN   9727>>ASSIGN
      9729>>ASSIGN   9730<<ASSIGN   9730>>ASSIGN   9732>>ASSIGN   9733<<ASSIGN   9733>>ASSIGN   9735>>ASSIGN
      9736<<ASSIGN   9736>>ASSIGN   9738>>ASSIGN   9739<<ASSIGN   9739>>ASSIGN   9742>>ASSIGN   9743<<ASSIGN
      9743>>ASSIGN   9745>>ASSIGN   9746<<ASSIGN   9746>>ASSIGN   9752>>ASSIGN   9753<<ASSIGN   9753>>ASSIGN
      9759>>ASSIGN   9762>>ASSIGN   9764<<ASSIGN   9764>>ASSIGN   9766>>ASSIGN   9767<<ASSIGN   9767>>ASSIGN
D$
      7375**DCL      8782<<ASSIGN   8785>>ASSIGN   8797<<ASSIGN   8799>>ASSIGN
DATASIZE
      7370**DCL      8773<<ASSIGN
DECODE_ADDR
      9792**PROC     8927--CALL     9775--CALL
DO_ALTRET
      9086**LABEL    8751--CALLALT  8960--CALLALT  8993--CALLALT  9008--CALLALT  9059--CALLALT  9090--CALLALT
DO_ALTRET IN PROCEDURE SENDERR
      9789**LABEL    9784--CALLALT
DST
      8547**DCL      8782--ASSIGN   8811--ASSIGN   8927<>CALL     9719--ASSIGN   9775<>CALL
DST.ADDRESS_N
      8579**DCL      8580--REDEF
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:150  
DST.LEN
      8551**DCL      8778--ASSIGN   8779>>IF       8784>>DOINDEX  8789>>ASSIGN   8931>>ASSIGN   8940>>ASSIGN
      8948>>ASSIGN   9710>>ASSIGN   9716>>ASSIGN   9719>>ASSIGN   9720>>ASSIGN
DST IN PROCEDURE DECODE_ADDR
     10026**DCL      9792--PROC    10074--IF
DST.ADDRESS_N IN PROCEDURE DECODE_ADDR
     10058**DCL     10059--REDEF
DST.LEN IN PROCEDURE DECODE_ADDR
     10030**DCL     10074>>IF
DSTINDX
      7373**DCL      8783<<ASSIGN
FEI
      7358**DCL      8719<<ASSIGN   8720>>ASSIGN   8961>>ASSIGN   8961>>ASSIGN   8995>>ASSIGN   8995>>ASSIGN
      9007>>ASSIGN   9028>>ASSIGN   9028>>ASSIGN   9033>>ASSIGN   9033>>ASSIGN   9056>>ASSIGN   9080>>ASSIGN
      9083>>ASSIGN   9085>>ASSIGN   9086>>ASSIGN
FEI#
      7359**DCL      8978<<ASSIGN   8979>>IF       8992>>ASSIGN   8996>>ASSIGN   8996>>ASSIGN
FEI$
      7364**DCL      7657--IMP-PTR  8720<<ASSIGN   8749>>ASSIGN   8750>>ASSIGN   9021>>ASSIGN   9053>>ASSIGN
      9078>>IF       9080>>ASSIGN
FIXED IN PROCEDURE SENDERR
      9643**DCL      9716--ASSIGN   9719--ASSIGN   9724--ASSIGN   9726--ASSIGN   9729--ASSIGN   9732--ASSIGN
      9735--ASSIGN   9738--ASSIGN   9742--ASSIGN   9745--ASSIGN   9752--ASSIGN   9759--ASSIGN   9762--ASSIGN
      9766--ASSIGN   9769--IF       9770--ASSIGN
FIXED.CHECKSUMX IN PROCEDURE SENDERR
      9679**DCL      9707<<ASSIGN
FIXED.CHECKSUMY IN PROCEDURE SENDERR
      9682**DCL      9708<<ASSIGN
FIXED.ER IN PROCEDURE SENDERR
      9665**DCL      9704<<ASSIGN
FIXED.LENGTH IN PROCEDURE SENDERR
      9649**DCL      9710<<ASSIGN   9712>>ASSIGN   9769>>IF       9772>>ASSIGN
FIXED.LIFETIME IN PROCEDURE SENDERR
      9653**DCL      9709<<ASSIGN
FIXED.MS IN PROCEDURE SENDERR
      9661**DCL      9705<<ASSIGN   9706<<ASSIGN
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:151  
FIXED.PROTOCOLID IN PROCEDURE SENDERR
      9647**DCL      9701<<ASSIGN
FIXED.SEGLENX IN PROCEDURE SENDERR
      9671**DCL      9713<<ASSIGN
FIXED.SEGLENY IN PROCEDURE SENDERR
      9675**DCL      9714<<ASSIGN
FIXED.SP IN PROCEDURE SENDERR
      9658**DCL      9703<<ASSIGN
FIXED.VERSION IN PROCEDURE SENDERR
      9651**DCL      9702<<ASSIGN
FIXEDSIZ
      7372**DCL      8775<<ASSIGN   8776>>ASSIGN
FOUNDONE IN PROCEDURE DECODE_ADDR
     10063**DCL     10071<<ASSIGN  10077<<ASSIGN  10115>>IF
I
      7360**DCL      8784<<DOINDEX  8785>>ASSIGN   8785>>ASSIGN   8787>>ASSIGN   8798<<DOINDEX  8799>>ASSIGN
      8799>>ASSIGN   8802>>ASSIGN   8847<<DOINDEX  8848>>ASSIGN   8848>>ASSIGN   9055<<DOINDEX  9056>>ASSIGN
      9077<<DOINDEX  9078>>IF       9080>>ASSIGN   9081>>ASSIGN   9083>>ASSIGN   9085>>ASSIGN   9086>>ASSIGN
I IN PROCEDURE DECODE_ADDR
     10064**DCL     10072<<DOINDEX 10073>>ASSIGN
INDX IN PROCEDURE DECODE_ADDR
     10068**DCL     10082<<ASSIGN  10091>>ASSIGN
INX IN PROCEDURE DECODE_ADDR
     10065**DCL     10079<<ASSIGN  10082>>ASSIGN  10083<<ASSIGN  10083>>ASSIGN  10087>>IF      10090>>DOINDEX
J
      7361**DCL     10078<<ASSIGN  10080>>DOWHILE 10081>>IF      10082>>ASSIGN  10085<<ASSIGN  10085>>ASSIGN
     10090<<DOINDEX 10091>>ASSIGN  10096>>ASSIGN
K$NPDU_FIXED
      8438**DCL      8762--IF       8774--ASSIGN   8775--ASSIGN   8778--ASSIGN   8785--ASSIGN   8791--ASSIGN
      8799--ASSIGN   8817--ASSIGN   8825--ASSIGN   8839--ASSIGN   8848--ASSIGN   8858--ASSIGN   8869--ASSIGN
      8871--ASSIGN   8876--ASSIGN   8887--ASSIGN   8892--ASSIGN   8899--ASSIGN   8905--ASSIGN   8908--ASSIGN
      8919--ASSIGN   8931--ASSIGN   8940--ASSIGN   8948--ASSIGN   9698--ASSIGN   9710--ASSIGN
K$NPDU_FIXED.ER
      8460**DCL      9694>>IF
K$NPDU_FIXED.LENGTH
      8444**DCL      8765>>ASSIGN
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:152  
K$NPDU_FIXED.LIFETIME
      8448**DCL      8856>>IF
K$NPDU_FIXED.MS
      8456**DCL      8823>>IF
K$NPDU_FIXED.PROTOCOLID
      8442**DCL      8814>>IF
K$NPDU_FIXED.SEGLENX
      8466**DCL      8769>>ASSIGN
K$NPDU_FIXED.SEGLENY
      8470**DCL      8769>>ASSIGN
K$NPDU_FIXED.SP
      8453**DCL      8823>>IF       8830>>IF
K$NPDU_FIXED.TYPE
      8464**DCL      9694>>IF
K$NPDU_FIXED.VERSION
      8446**DCL      8814>>IF
K$NPDU_SEGMENT
      8495**DCL      8837--IF       8847--DOINDEX  8852--ASSIGN
K$RWPARM
      7053**DCL        32--PROC     8751<>CALL     8818<>CALL     8826<>CALL     8840<>CALL     8859<>CALL
      8877<>CALL     8888<>CALL     8900<>CALL     8909<>CALL     8920<>CALL     8932<>CALL     8941<>CALL
      8949<>CALL     8960<>CALL     8993<>CALL     9017<>CALL     9024<>CALL
K$RWPARM.BLKREC
      7079**DCL      7104--REDEF
K$RWPARM.BLKREC.BLKU#
      7080**DCL      7082--REDEF
K$RWPARM.BLKREC.RECU#
      7092**DCL      7094--REDEF
K$RWPARM.DST_ADDR$
      7304**DCL      8547--IMP-PTR  8734<<ASSIGN   8741<<ASSIGN   8778>>ASSIGN   8779>>IF       8782>>ASSIGN
      8784>>DOINDEX  8789>>ASSIGN   8811<<ASSIGN   8811>>ASSIGN   8927>>CALL     8931>>ASSIGN   8940>>ASSIGN
      8948>>ASSIGN   9710>>ASSIGN   9716>>ASSIGN   9719>>ASSIGN   9719>>ASSIGN   9720>>ASSIGN   9775>>CALL
K$RWPARM.DVE.DVBYTE.VFC
      7119**DCL      7120--REDEF
K$RWPARM.DVE.EOMCHAR
      7127**DCL      7131--REDEF
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:153  
K$RWPARM.ERR
      7191**DCL      7196--REDEF    8816<<ASSIGN   8824<<ASSIGN   8838<<ASSIGN   8857<<ASSIGN   8875<<ASSIGN
      8886<<ASSIGN   8898<<ASSIGN   8907<<ASSIGN   8918<<ASSIGN   8930<<ASSIGN   8939<<ASSIGN   8947<<ASSIGN
      9027>>IF
K$RWPARM.FC
      7155**DCL      7156--REDEF
K$RWPARM.FEX
      7237**DCL      8719>>ASSIGN   8749<<ASSIGN   8953<<ASSIGN   8992<<ASSIGN   9003<<ASSIGN
K$RWPARM.FLDID
      7337**DCL      7338--REDEF
K$RWPARM.FPT$
      7218**DCL      7225--REDEF
K$RWPARM.FUNCTION
      7232**DCL      8722>>IF       8731<<ASSIGN   8955<<ASSIGN   8991<<ASSIGN   9051>>IF       9075>>IF
K$RWPARM.KEYTYPE
      7344**DCL      7345--REDEF
K$RWPARM.LOCAL_FEP
      7284**DCL      8750<<ASSIGN   9021<<ASSIGN
K$RWPARM.MSG$
      7054**DCL      7060--REDEF
K$RWPARM.MSGID
      7166**DCL      7171--REDEF
K$RWPARM.MSGIDXT
      7179**DCL      7183--REDEF
K$RWPARM.MSGSZ
      7061**DCL      8959<<ASSIGN   8989<<ASSIGN
K$RWPARM.NHDR$
      7269**DCL      8021--IMP-PTR  8098--IMP-PTR  8438--IMP-PTR  8725>>IF       8725>>IF       8727>>IF
      8732>>IF       8734>>ASSIGN   8735>>ASSIGN   8737>>ASSIGN   8744>>ASSIGN   8755>>IF       8765>>ASSIGN
      8769>>ASSIGN   8769>>ASSIGN   8778>>ASSIGN   8785>>ASSIGN   8791>>ASSIGN   8799>>ASSIGN   8814>>IF
      8814>>IF       8823>>IF       8823>>IF       8830>>IF       8848>>ASSIGN   8856>>IF       8869>>ASSIGN
      8871>>ASSIGN   8892>>ASSIGN   8905>>ASSIGN   8965>>IF       8965>>IF       8973>>ASSIGN   8974>>ASSIGN
      8976>>IF       8982>>IF       8985>>ASSIGN   8985>>ASSIGN   9002>>ASSIGN   9013>>IF       9694>>IF
      9694>>IF
K$RWPARM.NHDRSZ
      7273**DCL      8736>>ASSIGN   8737>>ASSIGN   8743>>ASSIGN   8760>>ASSIGN   8970>>ASSIGN
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:154  
K$RWPARM.ORG
      7315**DCL      7316--REDEF
K$RWPARM.RECTYPE
      7277**DCL      8817<<ASSIGN   8825<<ASSIGN   8839<<ASSIGN   8858<<ASSIGN   8876<<ASSIGN   8887<<ASSIGN
      8899<<ASSIGN   8908<<ASSIGN   8919<<ASSIGN   8931<<ASSIGN   8940<<ASSIGN   8948<<ASSIGN
K$RWPARM.SHDR$
      7247**DCL      9002<<ASSIGN   9022>>ASSIGN
K$RWPARM.SHDRSZ
      7251**DCL      8957<<ASSIGN   8970<<ASSIGN   8971>>IF       8987<<ASSIGN   9023>>ASSIGN
K$RWPARM.SRC_ADDR$
      7299**DCL      8599--IMP-PTR  8735<<ASSIGN   8742<<ASSIGN   8791>>ASSIGN   8794>>IF       8797>>ASSIGN
      8798>>DOINDEX  8804>>ASSIGN   8812<<ASSIGN   8812>>ASSIGN   9710>>ASSIGN   9716>>ASSIGN   9716>>ASSIGN
      9717>>ASSIGN   9719>>ASSIGN
K$RWPARM.THDR$
      7255**DCL      8737<<ASSIGN   8744<<ASSIGN   9015<<ASSIGN   9022<<ASSIGN
K$RWPARM.THDRSZ
      7259**DCL      7263--REDEF    8736<<ASSIGN   8737>>ASSIGN   8743<<ASSIGN   8958<<ASSIGN   8988<<ASSIGN
      9016<<ASSIGN   9023<<ASSIGN
K$RWPARM.UHDRSZ
      7209**DCL      8956<<ASSIGN   8986<<ASSIGN
K$RWPARM.VDOFLGS
      7317**DCL      7328--REDEF
K$RWPARM IN PROCEDURE SENDERR
      9121**DCL      9098--PROC     9784<>CALL
K$RWPARM.BLKREC IN PROCEDURE SENDERR
      9147**DCL      9172--REDEF
K$RWPARM.BLKREC.BLKU# IN PROCEDURE SENDERR
      9148**DCL      9150--REDEF
K$RWPARM.BLKREC.RECU# IN PROCEDURE SENDERR
      9160**DCL      9162--REDEF
K$RWPARM.DVE.DVBYTE.VFC IN PROCEDURE SENDERR
      9187**DCL      9188--REDEF
K$RWPARM.DVE.EOMCHAR IN PROCEDURE SENDERR
      9195**DCL      9199--REDEF
K$RWPARM.ERR IN PROCEDURE SENDERR
      9259**DCL      9264--REDEF    9752--ASSIGN
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:155  
K$RWPARM.FC IN PROCEDURE SENDERR
      9223**DCL      9224--REDEF
K$RWPARM.FEX IN PROCEDURE SENDERR
      9305**DCL      9778<<ASSIGN
K$RWPARM.FLDID IN PROCEDURE SENDERR
      9405**DCL      9406--REDEF
K$RWPARM.FPT$ IN PROCEDURE SENDERR
      9286**DCL      9293--REDEF
K$RWPARM.FUNCTION IN PROCEDURE SENDERR
      9300**DCL      9783<<ASSIGN
K$RWPARM.KEYTYPE IN PROCEDURE SENDERR
      9412**DCL      9413--REDEF
K$RWPARM.MSG$ IN PROCEDURE SENDERR
      9122**DCL      9128--REDEF
K$RWPARM.MSGID IN PROCEDURE SENDERR
      9234**DCL      9239--REDEF
K$RWPARM.MSGIDXT IN PROCEDURE SENDERR
      9247**DCL      9251--REDEF
K$RWPARM.MSGSZ IN PROCEDURE SENDERR
      9129**DCL      9782<<ASSIGN
K$RWPARM.NHDR$ IN PROCEDURE SENDERR
      9337**DCL      9766>>ASSIGN
K$RWPARM.ORG IN PROCEDURE SENDERR
      9383**DCL      9384--REDEF
K$RWPARM.RECTYPE IN PROCEDURE SENDERR
      9345**DCL      9700>>ASSIGN
K$RWPARM.SHDRSZ IN PROCEDURE SENDERR
      9319**DCL      9780<<ASSIGN
K$RWPARM.THDRSZ IN PROCEDURE SENDERR
      9327**DCL      9331--REDEF    9781<<ASSIGN
K$RWPARM.UHDRSZ IN PROCEDURE SENDERR
      9277**DCL      9779<<ASSIGN
K$RWPARM.VDOFLGS IN PROCEDURE SENDERR
      9385**DCL      9396--REDEF
KI$FEI.BD$
      7692**DCL      7693--REDEF
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:156  
KI$FEI.BDAD.WADDR
      7694**DCL      7695--REDEF
KI$FEI.FEP#
      7702**DCL      8749>>ASSIGN   8750>>ASSIGN   9021>>ASSIGN   9053>>ASSIGN   9078>>IF
KI$FEI.QOS
      7703**DCL      9080>>ASSIGN
KI$FEI.RCVPB
      7708**DCL      7709--REDEF
KI$FEI$
      8682**DCL      8720>>ASSIGN
KI$OSIROUTE.LINK.ACTIVE
      7970**DCL     10081>>IF
KI$OSIROUTE.LINK.FEP#
      7975**DCL     10092>>IF      10092>>IF      10094>>ASSIGN  10105>>ASSIGN
KI$OSIROUTE.LNSAP.ADDRESS_N
      7940**DCL      7941--REDEF
KI$OSIROUTE.NSAP
      7820**DCL     10074--IF
KI$OSIROUTE.NSAP.ADDRESS_N
      7850**DCL      7851--REDEF
KI$OSIROUTE.NSAP.LEN
      7822**DCL     10074>>IF
KI$OSIROUTE.NS_TYPE
      7951**DCL     10074>>IF
KI$OSIROUTE$
      7643**DCL     10073>>ASSIGN
KI$ROUTE.CURRENT_QOS
      7745**DCL     10094>>ASSIGN
KI$ROUTE.FEI#
      7740**DCL      8946>>IF       8953>>ASSIGN   8962>>ASSIGN   8962>>ASSIGN   8978>>ASSIGN   9005>>IF
      9778>>ASSIGN  10092>>IF
KI$ROUTE.LINK.MSGS_IN
      7771**DCL      8961<<ASSIGN   8961>>ASSIGN   8995<<ASSIGN   8995>>ASSIGN   9028<<ASSIGN   9028>>ASSIGN
      9033<<ASSIGN   9033>>ASSIGN   9085<<ASSIGN
KI$ROUTE.LINK.MSGS_OUT
      7776**DCL      8962<<ASSIGN   8962>>ASSIGN   8996<<ASSIGN   8996>>ASSIGN   9086<<ASSIGN
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:157  
KI$ROUTE.LINK.QOS
      7767**DCL      9007<<ASSIGN   9056<<ASSIGN   9080<<ASSIGN   9083<<ASSIGN
KI$ROUTE.LINK_CONNECTED
      7751**DCL      9053<<ASSIGN   9081<<ASSIGN
KI$ROUTE$
      7642**DCL      8945>>ASSIGN   8974>>ASSIGN   9005>>IF       9007>>ASSIGN   9053>>ASSIGN   9056>>ASSIGN
      9080>>ASSIGN   9081>>ASSIGN   9083>>ASSIGN   9085>>ASSIGN   9086>>ASSIGN   9778>>ASSIGN  10092>>IF
     10094>>ASSIGN
KIN$UPDATE_ROUTE
      7350**DCL-ENT  9008--CALL     9059--CALL     9090--CALL
KIQ$LINK
      7353**DCL-ENT  8960--CALL     8993--CALL     9784--CALL
KIS$RECV
      7351**DCL-ENT  9017--CALL
KIT$RECV
      7352**DCL-ENT  8751--CALL     9024--CALL
KI_DATAID
      8696**DCL      9722<<ASSIGN   9722>>ASSIGN   9724--ASSIGN   9726--ASSIGN
KI_FEI$$
      8692**DCL      8682--IMP-PTR  8720>>ASSIGN
KI_LIFETIME
      8695**DCL      9709>>ASSIGN
KI_MXFE
      8699**DCL     10080>>DOWHILE
KI_NODES
      8694**DCL      8938>>IF       9055>>DOINDEX  9077>>DOINDEX 10092>>IF
KI_OSIMAX#
      8698**DCL     10072>>DOINDEX
KI_OSIROUTE$$
      8697**DCL      7643--IMP-PTR 10073>>ASSIGN
KI_ROUTE$$
      8693**DCL      7642--IMP-PTR  8945>>ASSIGN   8974>>ASSIGN   9005>>IF       9007>>ASSIGN   9053>>ASSIGN
      9056>>ASSIGN   9080>>ASSIGN   9081>>ASSIGN   9083>>ASSIGN   9085>>ASSIGN   9086>>ASSIGN   9778>>ASSIGN
     10092>>IF      10094>>ASSIGN
K_NODE#
      8690**DCL      8727>>IF       8976>>IF
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:158  
L IN PROCEDURE DECODE_ADDR
     10070**DCL     10091<<ASSIGN  10092>>IF      10092>>IF      10094>>ASSIGN
LI
      7368**DCL      8765<<ASSIGN   8766>>IF       8773>>ASSIGN   8774<<ASSIGN   8774>>ASSIGN   8779>>IF
      8789<<ASSIGN   8789>>ASSIGN   8794>>IF       8804<<ASSIGN   8804>>ASSIGN   8837>>IF       8853<<ASSIGN
      8853>>ASSIGN   8868>>DOWHILE  8873<<ASSIGN   8873>>ASSIGN   8874>>IF
N$DCT$$
      8691**DCL      8681--IMP-PTR
NK$LDCT.DDT$
      8650**DCL      8650--REDEF
NK$LDCT.IOQ$
      8649**DCL      8650--REDEF
NK$LDCT.LDCTX
      8651**DCL      8651--REDEF
NK$LDCT.LKFLG.ABORTED
      8663**DCL      8664--REDEF
NK$LDCT.RLCID.LDCTX
      8673**DCL      8673--REDEF
NK$LDCT.STA$
      8669**DCL      8670--REDEF
NK$LDCT.SYMB$
      8648**DCL      8648--REDEF    8648--REDEF    8649--REDEF
NODE#
      7362**DCL      8973<<ASSIGN   9003>>ASSIGN   9005>>IF       9007>>ASSIGN
NQOS IN PROCEDURE DECODE_ADDR
     10067**DCL     10094<<ASSIGN  10095>>IF      10097>>ASSIGN
OPTSZ
      7376**DCL      8871--ASSIGN   8873>>ASSIGN   8924>>ASSIGN
OPTVAL
      7378**DCL      8892--ASSIGN   8897>>IF       8905--ASSIGN   8906>>IF
OSI$
      7365**DCL      7798--IMP-PTR 10073<<ASSIGN  10074>>IF      10074>>IF      10074>>IF      10081>>IF
     10092>>IF      10092>>IF      10094>>ASSIGN  10105>>ASSIGN
OSIRTE IN PROCEDURE DECODE_ADDR
     10072**LABEL   10106--EXIT
ROUTE
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:159  
      7448**DCL      8927<>CALL
ROUTE.LNSAP.ADDRESS_N
      7602**DCL      7603--REDEF
ROUTE.MYNODE#
      7483**DCL      7485--REDEF
ROUTE.NODE#
      7486**DCL      7488--REDEF    8938>>IF       8945>>ASSIGN
ROUTE.NSAP.ADDRESS_N
      7546**DCL      7547--REDEF
ROUTE.QOS
      7491**DCL      8929>>IF
ROUTE IN PROCEDURE DECODE_ADDR
      9818**DCL      9792--PROC
ROUTE.LNSAP.ADDRESS_N IN PROCEDURE DECODE_ADDR
      9972**DCL      9973--REDEF
ROUTE.MYNODE# IN PROCEDURE DECODE_ADDR
      9853**DCL      9855--REDEF
ROUTE.NODE# IN PROCEDURE DECODE_ADDR
      9856**DCL      9858--REDEF   10105<<ASSIGN
ROUTE.NSAP.ADDRESS_N IN PROCEDURE DECODE_ADDR
      9916**DCL      9917--REDEF
ROUTE.QOS IN PROCEDURE DECODE_ADDR
      9861**DCL     10101<<ASSIGN  10110<<ASSIGN
ROUTE IN PROCEDURE SENDERR
      9435**DCL      9775<>CALL
ROUTE.LNSAP.ADDRESS_N IN PROCEDURE SENDERR
      9589**DCL      9590--REDEF
ROUTE.MYNODE# IN PROCEDURE SENDERR
      9470**DCL      9472--REDEF
ROUTE.NODE# IN PROCEDURE SENDERR
      9473**DCL      9475--REDEF    9778>>ASSIGN
ROUTE.NSAP.ADDRESS_N IN PROCEDURE SENDERR
      9533**DCL      9534--REDEF
ROUTE.QOS IN PROCEDURE SENDERR
      9478**DCL      9776>>IF
ROUTE$
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:160  
      7366**DCL      7729--IMP-PTR  8945<<ASSIGN   8946>>IF       8953>>ASSIGN   8961>>ASSIGN   8961>>ASSIGN
      8962>>ASSIGN   8962>>ASSIGN   8962>>ASSIGN   8962>>ASSIGN   8974<<ASSIGN   8978>>ASSIGN   8995>>ASSIGN
      8995>>ASSIGN   8996>>ASSIGN   8996>>ASSIGN   9028>>ASSIGN   9028>>ASSIGN   9033>>ASSIGN   9033>>ASSIGN
SC_PRTCL_SNAP
      7354**DCL-ENT  8967--CALL
SEGLENGTH
      7369**DCL      8769<<ASSIGN   8770>>IF       8773>>ASSIGN   8831--ASSIGN   8832--ASSIGN
SEGMENT
      7395**DCL      8853--ASSIGN   9710--ASSIGN
SEGMENT.DATAID
      7400**DCL      8833<<ASSIGN   8848--ASSIGN
SEGMENT.OFFSET
      7409**DCL      8834<<ASSIGN
SEGMENT.TOTLEN.BYT
      7424**DCL      8831<<ASSIGN   8832<<ASSIGN
SENDERR
      9098**PROC     8818--CALL     8826--CALL     8840--CALL     8859--CALL     8877--CALL     8888--CALL
      8900--CALL     8909--CALL     8920--CALL     8932--CALL     8941--CALL     8949--CALL
SIZE
      7367**DCL      8684--IMP-SIZ  8760<<ASSIGN   8762>>IF       8766>>IF       8770>>IF       8778>>ASSIGN
      8785>>ASSIGN   8785>>ASSIGN   8791>>ASSIGN   8799>>ASSIGN   8799>>ASSIGN   8848>>ASSIGN   8848>>ASSIGN
      8869>>ASSIGN   8871>>ASSIGN   8892>>ASSIGN   8905>>ASSIGN  10074>>IF      10074>>IF
SIZE IN PROCEDURE SENDERR
      9684**DCL      9687--IMP-SIZ  9700<<ASSIGN   9712>>ASSIGN   9716>>ASSIGN   9716>>ASSIGN   9719>>ASSIGN
      9719>>ASSIGN   9724>>ASSIGN   9724>>ASSIGN   9726>>ASSIGN   9726>>ASSIGN   9729>>ASSIGN   9732>>ASSIGN
      9735>>ASSIGN   9735>>ASSIGN   9738>>ASSIGN   9738>>ASSIGN   9742>>ASSIGN   9745>>ASSIGN   9752>>ASSIGN
      9752>>ASSIGN   9757>>IF       9758<<ASSIGN   9759>>ASSIGN   9762>>ASSIGN   9762--ASSIGN   9762>>ASSIGN
      9766>>ASSIGN   9766>>ASSIGN   9766>>ASSIGN   9766>>ASSIGN   9767>>ASSIGN   9769>>IF       9770<<ASSIGN
      9772<<ASSIGN   9772>>ASSIGN
SRC
      8599**DCL      8797--ASSIGN   8812--ASSIGN   9716--ASSIGN
SRC.ADDRESS_N
      8631**DCL      8632--REDEF
SRC.LEN
      8603**DCL      8791--ASSIGN   8794>>IF       8798>>DOINDEX  8804>>ASSIGN   9710>>ASSIGN   9716>>ASSIGN
      9717>>ASSIGN   9719>>ASSIGN
PL6.E3A0      #002=KIN$RECV File=KIN$NETWORK.:E05TSI                             WED 07/30/97 00:34 Page:161  
SRCINDX
      7374**DCL      8792<<ASSIGN
SVINDX IN PROCEDURE DECODE_ADDR
     10069**DCL     10089<<ASSIGN  10096<<ASSIGN  10100>>IF      10105>>ASSIGN
TSIZE IN PROCEDURE SENDERR
      9685**DCL      9712<<ASSIGN   9713>>ASSIGN   9714>>ASSIGN   9735--ASSIGN   9738--ASSIGN

PL6.E3A0      #003=KIN$OSICHG File=KIN$NETWORK.:E05TSI                           WED 07/30/97 00:35 Page:162  
      986        1        /*T***********************************************************/
      987        2        /*T*                                                         */
      988        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      989        4        /*T*                                                         */
      990        5        /*T***********************************************************/
      991        6        %EJECT;
PL6.E3A0      #003=KIN$OSICHG File=KIN$NETWORK.:E05TSI                           WED 07/30/97 00:35 Page:163  
      992        7        KIN$OSICHG: PROC(PARM) ALTRET;
      993        8
      994        9        %INCLUDE KNN_NETWORK_M;
      995      372        %INCLUDE KL_MACRO_C;
      996     3724        %INCLUDE K_ADDRESS_M;
      997     4227        %INCLUDE K_NETWORK_E;
      998     4316        %INCLUDE HF_LOCK_C;
      999     4330        %INCLUDE KL_AFCN_C;
     1000     4431        %INCLUDE CP_6;
     1001     9990
     1002     9991    1   DCL PARM UBIN;
     1003     9992        %KL_UPDOSI(FPTN=KL$UPDOSI,STCLASS="BASED(PARM$)");
     1004    10201        %KL_OSILINKCHG(FPTN=KL$OSILINKCHG,STCLASS="BASED(PARM$)");
     1005    10324
     1006    10325    1   DCL KI_OSIROUTE$$ PTR SYMREF;
     1007    10326    1   DCL KI_OSIMAX# UBIN SYMREF;
     1008    10327    1   DCL KI_MXFE UBIN SYMREF;
     1009    10328    1   DCL KI_LOCK BIT(72) SYMREF;
     1010    10329
     1011    10330        %KNN$OSIROUTE(FPTN=KI$OSIROUTE,STCLASS="BASED(OSI$)");
     1012    10547    1   DCL KI_OSIROUTE$(0:0) PTR BASED(KI_OSIROUTE$$);
     1013    10548    1   DCL 1 ADDRTMPLT ALIGNED BASED(UPDOSI$),
     1014    10549    1         2 BYT(0:50),
     1015    10550    1           3 * BIT(1) UNAL,
     1016    10551    1           3 HIGH BIT(4) UNAL,
     1017    10552    1           3 LOW  BIT(4) UNAL;
     1018    10553
     1019    10554    1   DCL 1 ADDRTMPLT1 ALIGNED BASED(OSIROUTE$),
     1020    10555    1         2 BYT(0:50),
     1021    10556    1           3 * BIT(1) UNAL,
     1022    10557    1           3 HIGH BIT(4) UNAL,
     1023    10558    1           3 LOW BIT(4)  UNAL;
     1024    10559
     1025    10560    1   DCL ADDRESS CHAR(LEN) BASED CALIGNED;
     1026    10561    1   DCL PARM$ PTR;
     1027    10562    1   DCL OSIROUTE$ PTR;
     1028    10563    1   DCL UPDOSI$ PTR;
PL6.E3A0      #003=KIN$OSICHG File=KIN$NETWORK.:E05TSI                           WED 07/30/97 00:35 Page:164  
     1029    10564    1   DCL OSI$ PTR;
     1030    10565    1   DCL I UBIN;
     1031    10566    1   DCL LEN SBIN;
     1032    10567    1   DCL K SBIN;
     1033    10568    1   DCL L SBIN;
     1034    10569    1   DCL FOUNDONE BIT(1);
     1035    10570
     1036    10571    1      PARM$ = ADDR(PARM);
     1037    10572    1      FOUNDONE = '0'B;
     1038    10573    2      DO I = 0 TO KI_OSIMAX# - 1;
     1039    10574    2           OSI$ = KI_OSIROUTE$(I);
     1040    10575
     1041    10576    2           IF KI$OSIROUTE.NS_TYPE = KL$UPDOSI.NS_TYPE
     1042    10577    2             AND KI$OSIROUTE.NSAP.AFI = KL$UPDOSI.NSAP.AFI
     1043    10578    2             AND KI$OSIROUTE.NSAP.LEN = KL$UPDOSI.NSAP.LEN THEN
     1044    10579    3   NXTI:   DO;
     1045    10580    3                LEN = KI$OSIROUTE.NSAP.LEN;
     1046    10581    3                UPDOSI$ = ADDR(KL$UPDOSI.NSAP.AFI);
     1047    10582    3                OSIROUTE$ = ADDR(KI$OSIROUTE.NSAP.AFI);
     1048    10583    3                IF SUBSTR(UPDOSI$->ADDRESS,1,LEN-1) ~= SUBSTR(OSIROUTE$->ADDRESS,1,LEN-
             10583                         1) THEN
     1049    10584    3                     EXIT NXTI;       /*  compare the address, but dont do afi*/
     1050    10585        /*
     1051    10586             found a match, but now is this a separate incarnation of the same
     1052    10587             entity or a new connection.
     1053    10588        */
     1054    10589    4                DO K = 0 TO KI_MXFE - 1;
     1055    10590    4                     IF KI$OSIROUTE.LINK.FEP#(K) = KL$UPDOSI.FEP# THEN
             10590                              /* same connection*/
     1056    10591    5                     DO;
     1057    10592                               %LOCK(G=KI_LOCK);
     1058    10595    6                          IF KL$UPDOSI.FCN = IGA_DELOSI THEN DO;
     1059    10596    6                               KI$OSIROUTE.NSAP.AFI = 0;
     1060    10597    6                               END;
     1061    10598    6                          ELSE DO;
     1062    10599    6                               KI$OSIROUTE.LNSAP = KL$UPDOSI.LNSAP;
     1063    10600    6                               KI$OSIROUTE.LINK.HOST#(K) = KL$UPDOSI.HOST#;
PL6.E3A0      #003=KIN$OSICHG File=KIN$NETWORK.:E05TSI                           WED 07/30/97 00:35 Page:165  
     1064    10601    6                               KI$OSIROUTE.SNPA = KL$UPDOSI.SNPA;
     1065    10602    6                               KI$OSIROUTE.LINK.QOS(K) = KL$UPDOSI.QOS;
     1066    10603    6                               END;
     1067    10604                               %UNLOCK(G=KI_LOCK);
     1068    10607    5                          RETURN;
     1069    10608    5                          END;             /* node# = fep#                       */
     1070    10609    4                     END;                  /* do k                               */
     1071    10610    3                IF KL$UPDOSI.FCN = IGA_DELOSI THEN
     1072    10611                  /*could not find the nsap the user was referring to.  just return   */
     1073    10612    3                     RETURN;
     1074    10613
     1075    10614        /*
     1076    10615             otherwise look for the first available slot and install the new info.
     1077    10616        */
     1078    10617    4                DO K = 0 TO KI_MXFE - 1;
     1079    10618    4                     IF NOT KI$OSIROUTE.LINK.ACTIVE(K) THEN
     1080    10619    5                     DO;
     1081    10620                               %LOCK(G=KI_LOCK);
     1082    10623    5                          KI$OSIROUTE.LNSAP = KL$UPDOSI.LNSAP;
     1083    10624    5                          KI$OSIROUTE.LINK.HOST#(K) = KL$UPDOSI.HOST#;
     1084    10625    5                          KI$OSIROUTE.SNPA = KL$UPDOSI.SNPA;
     1085    10626    5                          KI$OSIROUTE.LINK.FEP#(K) = KL$UPDOSI.FEP#;
     1086    10627    5                          KI$OSIROUTE.LINK.QOS(K) = KL$UPDOSI.QOS;
     1087    10628    5                          KI$OSIROUTE.LINK.ACTIVE(K) = '1'B;
     1088    10629                               %UNLOCK(G=KI_LOCK);
     1089    10632    5                          RETURN;
     1090    10633    5                          END;             /* not active                         */
     1091    10634    4                     END;                  /* do k                               */
     1092    10635    3                RETURN;                    /* no more space in current nsap      */
     1093    10636    3                END;                  /* type = type and afi=afi and len = len   */
     1094    10637    2           END;                            /* do i                               */
     1095    10638        /*
     1096    10639          couldn't find anyone who wanted us up there, lets make our own space.
     1097    10640        */
     1098    10641    2      DO I = 0 TO KI_OSIMAX# - 1;
     1099    10642    2           OSI$ = KI_OSIROUTE$(I);
     1100    10643    2           IF KI$OSIROUTE.NSAP.AFI = 0 THEN
PL6.E3A0      #003=KIN$OSICHG File=KIN$NETWORK.:E05TSI                           WED 07/30/97 00:35 Page:166  
     1101    10644    3           DO;
     1102    10645                     %LOCK(G=KI_LOCK);
     1103    10648    3                KI$OSIROUTE = '0'B;
     1104    10649    3                KI$OSIROUTE.NS_TYPE = KL$UPDOSI.NS_TYPE;
     1105    10650    3                KI$OSIROUTE.NSAP = KL$UPDOSI.NSAP;
     1106    10651    3                KI$OSIROUTE.LNSAP = KL$UPDOSI.LNSAP;
     1107    10652    3                KI$OSIROUTE.LINK.HOST#(0) = KL$UPDOSI.HOST#;
     1108    10653    3                KI$OSIROUTE.SNPA = KL$UPDOSI.SNPA;
     1109    10654    3                KI$OSIROUTE.LINK.FEP#(0) = KL$UPDOSI.FEP#;
     1110    10655    3                KI$OSIROUTE.LINK.QOS(0) = KL$UPDOSI.QOS;
     1111    10656    3                KI$OSIROUTE.LINK.ACTIVE(0) = '1'B;
     1112    10657                     %UNLOCK(G=KI_LOCK);
     1113    10660    3                RETURN;
     1114    10661    3                END;                       /* route table entry not in use       */
     1115    10662    2           END;                            /* do i                               */
     1116    10663    1      RETURN;
     1117    10664
     1118    10665
     1119    10666
     1120    10667    1   KIN$OSILINKCHG: ENTRY(PARM) ALTRET;
     1121    10668
     1122    10669
     1123    10670    1      PARM$ = ADDR(PARM);
     1124    10671    2      DO I = 0 TO KI_OSIMAX#-1;
     1125    10672    2           OSI$ = KI_OSIROUTE$(I);
     1126    10673    3           IF KI$OSIROUTE.SNPA.LEN >= KL$OSILINKCHG.SNPA.LEN THEN DO;
     1127    10674    3                IF MOD(KL$OSILINKCHG.SNPA.LEN,2) ~= 0 THEN
     1128    10675    3                     LEN = KL$OSILINKCHG.SNPA.LEN - 1;
     1129    10676    3                ELSE
     1130    10677    3                     LEN = KL$OSILINKCHG.SNPA.LEN;
     1131    10678
     1132    10679    3                UPDOSI$ = ADDR(KL$OSILINKCHG.SNPA.ADDRESS);
     1133    10680    3                OSIROUTE$ = ADDR(KI$OSIROUTE.SNPA.ADDRESS);
     1134    10681    3                L = 0;
     1135    10682    4                DO K = 0 TO LEN - 1 BY 2;
     1136    10683    4                     IF ADDRTMPLT.BYT.HIGH(L) ~= ADDRTMPLT1.BYT.HIGH(L)
     1137    10684    4                       OR ADDRTMPLT.BYT.LOW(L) ~= ADDRTMPLT1.BYT.LOW(L) THEN
PL6.E3A0      #003=KIN$OSICHG File=KIN$NETWORK.:E05TSI                           WED 07/30/97 00:35 Page:167  
     1138    10685    4                          GOTO SNPALOOP;
     1139    10686    4                     L = L + 1;
     1140    10687    4                     END;                  /* do k                               */
     1141    10688
     1142    10689    4                IF LEN ~= KL$OSILINKCHG.SNPA.LEN THEN DO;
     1143    10690    4                     IF ADDRTMPLT.BYT.HIGH(L) ~= ADDRTMPLT1.BYT.HIGH(L) THEN
     1144    10691    4                          GOTO SNPALOOP;
     1145    10692    4                     END;
     1146    10693    4                DO K = 0 TO KI_MXFE-1;
     1147    10694    5                     IF KL$OSILINKCHG.NODE# = KI$OSIROUTE.LINK.FEP#(K) THEN DO;
     1148    10695                               %LOCK(G=KI_LOCK);
     1149    10698    5                          IF KL$OSILINKCHG.TYPE = IGA_OSILINKUP THEN
     1150    10699    5                               KI$OSIROUTE.LINK.ACTIVE(K) = '1'B;
     1151    10700    5                          ELSE
     1152    10701    5                               KI$OSIROUTE.LINK.ACTIVE(K) = '0'B;
     1153    10702                               %UNLOCK(G=KI_LOCK);
     1154    10705    5                          GOTO SNPALOOP;   /* only one entry per node necessary  */
     1155    10706    5                          END;             /* node# = fep#                       */
     1156    10707    4                     END;                  /* do k = 1 to mxfe                   */
     1157    10708
     1158    10709                      /* didn't find an entry for this node in the list.
     1159    10710                         if it is a link up search for the first inactive and
     1160    10711                         set it to active.*/
     1161    10712    3                IF KL$OSILINKCHG.TYPE = IGA_OSILINKUP THEN
     1162    10713    4                DO K = 0 TO KI_MXFE-1;
     1163    10714    5                     IF NOT KI$OSIROUTE.LINK.ACTIVE(K) THEN DO;
     1164    10715                               %LOCK(G=KI_LOCK);
     1165    10718    5                          KI$OSIROUTE.LINK(K) = '0'B;
     1166    10719    5                          KI$OSIROUTE.LINK.ACTIVE(K) = '1'B;
     1167    10720    5                          KI$OSIROUTE.LINK.QOS(K) = KL$OSILINKCHG.QOS;
     1168    10721    5                          KI$OSIROUTE.LINK.FEP#(K) = KL$OSILINKCHG.NODE#;
     1169    10722                               %UNLOCK(G=KI_LOCK);
     1170    10725    5                          GOTO SNPALOOP;   /* one's enough                       */
     1171    10726    5                          END;             /* no link in use                     */
     1172    10727    4                     END;                  /* do k                               */
     1173    10728    3                END;                       /* route.snpa.len > linkchg.snpa.len  */
     1174    10729    2   SNPALOOP:;
PL6.E3A0      #003=KIN$OSICHG File=KIN$NETWORK.:E05TSI                           WED 07/30/97 00:35 Page:168  
     1175    10730    2           END;                            /* do i                               */
     1176    10731    1   END KIN$OSICHG;
     1177    10732        %EOD;

PL6.E3A0      #003=KIN$OSICHG File=KIN$NETWORK.:E05TSI                           WED 07/30/97 00:35 Page:169  
--  Include file information  --

   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   K_NETWORK_E.:E05TOU  is referenced.
   K_ADDRESS_M.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   KNN_NETWORK_M.:E05TOU  is referenced.
      No diagnostics issued in procedure KIN$OSICHG.

   Procedure KIN$OSICHG requires 438 words for executable code.
   Procedure KIN$OSICHG requires 16 words of local(AUTO) storage.

PL6.E3A0      #003=KIN$OSICHG File=KIN$NETWORK.:E05TSI                           WED 07/30/97 00:35 Page:170  

 Object Unit name= KIN$OSICHG                                 File name= KIN$NETWORK.:E05TOU
 UTS= JUL 30 '97 00:35:36.28 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   Proc  even  none   438    666  KIN$OSICHG
    2  RoData even  none     3      3  KIN$OSICHG

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        1  KIN$OSICHG
     1    336          yes     yes      Std        1  KIN$OSILINKCHG

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 HFC$LOCK
         yes           Std       1 HFC$UNLOCK
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
PL6.E3A0      #003=KIN$OSICHG File=KIN$NETWORK.:E05TSI                           WED 07/30/97 00:35 Page:171  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  KI_OSIROUTE$$                         KI_OSIMAX#
     KI_MXFE                               KI_LOCK                               B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #003=KIN$OSICHG File=KIN$NETWORK.:E05TSI                           WED 07/30/97 00:35 Page:172  


      986        1        /*T***********************************************************/
      987        2        /*T*                                                         */
      988        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      989        4        /*T*                                                         */
      990        5        /*T***********************************************************/
      991        6        %EJECT;
PL6.E3A0      #003=KIN$OSICHG File=KIN$NETWORK.:E05TSI                           WED 07/30/97 00:35 Page:173  
      992        7        KIN$OSICHG: PROC(PARM) ALTRET;

      7  1 000000   000000 700200 xent  KIN$OSICHG   TSX0  ! X66_AUTO_1
         1 000001   000020 000001                    ZERO    16,1

      993        8
      994        9        %INCLUDE KNN_NETWORK_M;
      995      372        %INCLUDE KL_MACRO_C;
      996     3724        %INCLUDE K_ADDRESS_M;
      997     4227        %INCLUDE K_NETWORK_E;
      998     4316        %INCLUDE HF_LOCK_C;
      999     4330        %INCLUDE KL_AFCN_C;
     1000     4431        %INCLUDE CP_6;
     1001     9990
     1002     9991    1   DCL PARM UBIN;
     1003     9992        %KL_UPDOSI(FPTN=KL$UPDOSI,STCLASS="BASED(PARM$)");
     1004    10201        %KL_OSILINKCHG(FPTN=KL$OSILINKCHG,STCLASS="BASED(PARM$)");
     1005    10324
     1006    10325    1   DCL KI_OSIROUTE$$ PTR SYMREF;
     1007    10326    1   DCL KI_OSIMAX# UBIN SYMREF;
     1008    10327    1   DCL KI_MXFE UBIN SYMREF;
     1009    10328    1   DCL KI_LOCK BIT(72) SYMREF;
     1010    10329
     1011    10330        %KNN$OSIROUTE(FPTN=KI$OSIROUTE,STCLASS="BASED(OSI$)");
     1012    10547    1   DCL KI_OSIROUTE$(0:0) PTR BASED(KI_OSIROUTE$$);
     1013    10548    1   DCL 1 ADDRTMPLT ALIGNED BASED(UPDOSI$),
     1014    10549    1         2 BYT(0:50),
     1015    10550    1           3 * BIT(1) UNAL,
     1016    10551    1           3 HIGH BIT(4) UNAL,
     1017    10552    1           3 LOW  BIT(4) UNAL;
     1018    10553
     1019    10554    1   DCL 1 ADDRTMPLT1 ALIGNED BASED(OSIROUTE$),
     1020    10555    1         2 BYT(0:50),
     1021    10556    1           3 * BIT(1) UNAL,
     1022    10557    1           3 HIGH BIT(4) UNAL,
     1023    10558    1           3 LOW BIT(4)  UNAL;
     1024    10559
PL6.E3A0      #003=KIN$OSICHG File=KIN$NETWORK.:E05TSI                           WED 07/30/97 00:35 Page:174  
     1025    10560    1   DCL ADDRESS CHAR(LEN) BASED CALIGNED;
     1026    10561    1   DCL PARM$ PTR;
     1027    10562    1   DCL OSIROUTE$ PTR;
     1028    10563    1   DCL UPDOSI$ PTR;
     1029    10564    1   DCL OSI$ PTR;
     1030    10565    1   DCL I UBIN;
     1031    10566    1   DCL LEN SBIN;
     1032    10567    1   DCL K SBIN;
     1033    10568    1   DCL L SBIN;
     1034    10569    1   DCL FOUNDONE BIT(1);
     1035    10570
     1036    10571    1      PARM$ = ADDR(PARM);

  10571  1 000002   200003 236100                    LDQ     @PARM,,AUTO
         1 000003   200004 756100                    STQ     PARM$,,AUTO

     1037    10572    1      FOUNDONE = '0'B;

  10572  1 000004   200014 450100                    STZ     FOUNDONE,,AUTO

     1038    10573    2      DO I = 0 TO KI_OSIMAX# - 1;

  10573  1 000005   200010 450100                    STZ     I,,AUTO
         1 000006   000243 710000 1                  TRA     s:10637+3

     1039    10574    2           OSI$ = KI_OSIROUTE$(I);

  10574  1 000007   000000 470400 xsym               LDP0    KI_OSIROUTE$$
         1 000010   200010 720100                    LXL0    I,,AUTO
         1 000011   000000 236110                    LDQ     0,X0,PR0
         1 000012   200007 756100                    STQ     OSI$,,AUTO

     1040    10575
     1041    10576    2           IF KI$OSIROUTE.NS_TYPE = KL$UPDOSI.NS_TYPE

  10576  1 000013   200004 471500                    LDP1    PARM$,,AUTO
         1 000014   100000 236100                    LDQ     0,,PR1
PL6.E3A0      #003=KIN$OSICHG File=KIN$NETWORK.:E05TSI                           WED 07/30/97 00:35 Page:175  
         1 000015   000026 772000                    QRL     22
         1 000016   000017 376007                    ANQ     15,DL
         1 000017   200016 756100                    STQ     FOUNDONE+2,,AUTO
         1 000020   200007 473500                    LDP3    OSI$,,AUTO
         1 000021   300015 236100                    LDQ     13,,PR3
         1 000022   000037 772000                    QRL     31
         1 000023   000017 376007                    ANQ     15,DL
         1 000024   200016 116100                    CMPQ    FOUNDONE+2,,AUTO
         1 000025   000240 601000 1                  TNZ     s:10637
         1 000026   300000 236100                    LDQ     0,,PR3
         1 000027   100002 676100                    ERQ     2,,PR1
         1 000030   000777 376003                    ANQ     511,DU
         1 000031   000240 601000 1                  TNZ     s:10637
         1 000032   300000 236100                    LDQ     0,,PR3
         1 000033   100002 676100                    ERQ     2,,PR1
         1 000034   777000 376003                    ANQ     -512,DU
         1 000035   000240 601000 1                  TNZ     s:10637

     1042    10577    2             AND KI$OSIROUTE.NSAP.AFI = KL$UPDOSI.NSAP.AFI
     1043    10578    2             AND KI$OSIROUTE.NSAP.LEN = KL$UPDOSI.NSAP.LEN THEN
     1044    10579    3   NXTI:   DO;

  10579  1 000036                       NXTI         null
     1045    10580    3                LEN = KI$OSIROUTE.NSAP.LEN;

  10580  1 000036   300000 236100                    LDQ     0,,PR3
         1 000037   000033 772000                    QRL     27
         1 000040   200011 756100                    STQ     LEN,,AUTO

     1046    10581    3                UPDOSI$ = ADDR(KL$UPDOSI.NSAP.AFI);

  10581  1 000041   200004 236100                    LDQ     PARM$,,AUTO
         1 000042   000000 036000 2                  ADLQ    0
         1 000043   200006 756100                    STQ     UPDOSI$,,AUTO

     1047    10582    3                OSIROUTE$ = ADDR(KI$OSIROUTE.NSAP.AFI);

PL6.E3A0      #003=KIN$OSICHG File=KIN$NETWORK.:E05TSI                           WED 07/30/97 00:35 Page:176  
  10582  1 000044   200007 236100                    LDQ     OSI$,,AUTO
         1 000045   200000 036007                    ADLQ    65536,DL
         1 000046   200005 756100                    STQ     OSIROUTE$,,AUTO

     1048    10583    3               IF SUBSTR(UPDOSI$->ADDRESS,1,LEN-1) ~= SUBSTR(OSIROUTE$->ADDRESS,1,LEN-
             10583                         1) THEN

  10583  1 000047   200011 721100                    LXL1    LEN,,AUTO
         1 000050   777777 622011                    EAX2    -1,X1
         1 000051   200006 474500                    LDP4    UPDOSI$,,AUTO
         1 000052   200005 475500                    LDP5    OSIROUTE$,,AUTO
         1 000053   040140 106540                    CMPC    fill='040'O
         1 000054   400000 200012                    ADSC9   0,,PR4                   cn=1,n=*X2
         1 000055   500000 200012                    ADSC9   0,,PR5                   cn=1,n=*X2
         1 000056   000240 601000 1                  TNZ     s:10637

     1049    10584    3                     EXIT NXTI;       /*  compare the address, but dont do afi*/
     1050    10585        /*
     1051    10586             found a match, but now is this a separate incarnation of the same
     1052    10587             entity or a new connection.
     1053    10588        */
     1054    10589    4                DO K = 0 TO KI_MXFE - 1;

  10589  1 000057   200012 450100                    STZ     K,,AUTO
         1 000060   000140 710000 1                  TRA     s:10609+1

     1055    10590    4                     IF KI$OSIROUTE.LINK.FEP#(K) = KL$UPDOSI.FEP# THEN
             10590                              /* same connection*/

  10590  1 000061   200004 470500                    LDP0    PARM$,,AUTO
         1 000062   000000 236100                    LDQ     0,,PR0
         1 000063   000777 376007                    ANQ     511,DL
         1 000064   200016 756100                    STQ     FOUNDONE+2,,AUTO
         1 000065   200012 236100                    LDQ     K,,AUTO
         1 000066   000017 402007                    MPY     15,DL
         1 000067   200007 471500                    LDP1    OSI$,,AUTO
         1 000070   000100 101506                    MRL     fill='000'O
PL6.E3A0      #003=KIN$OSICHG File=KIN$NETWORK.:E05TSI                           WED 07/30/97 00:35 Page:177  
         1 000071   100015 400001                    ADSC9   13,Q,PR1                 cn=2,n=1
         1 000072   200017 000004                    ADSC9   FOUNDONE+3,,AUTO         cn=0,n=4
         1 000073   200017 236100                    LDQ     FOUNDONE+3,,AUTO
         1 000074   200016 116100                    CMPQ    FOUNDONE+2,,AUTO
         1 000075   000137 601000 1                  TNZ     s:10609

     1056    10591    5                     DO;

     1057    10592                               %LOCK(G=KI_LOCK);

  10593  1 000076   000001 630400 2                  EPPR0   1
         1 000077   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000100   000000 701000 xent               TSX1    HFC$LOCK
         1 000101   000000 011000                    NOP     0

     1058    10595    6                          IF KL$UPDOSI.FCN = IGA_DELOSI THEN DO;

  10595  1 000102   200004 470500                    LDP0    PARM$,,AUTO
         1 000103   000000 236100                    LDQ     0,,PR0
         1 000104   777000 376003                    ANQ     -512,DU
         1 000105   127000 116003                    CMPQ    44544,DU
         1 000106   000113 601000 1                  TNZ     s:10599

     1059    10596    6                               KI$OSIROUTE.NSAP.AFI = 0;

  10596  1 000107   200007 471500                    LDP1    OSI$,,AUTO
         1 000110   000000 236003                    LDQ     0,DU
         1 000111   100000 552120                    STBQ    0,'20'O,PR1

     1060    10597    6                               END;

  10597  1 000112   000132 710000 1                  TRA     s:10605

     1061    10598    6                          ELSE DO;

     1062    10599    6                               KI$OSIROUTE.LNSAP = KL$UPDOSI.LNSAP;

PL6.E3A0      #003=KIN$OSICHG File=KIN$NETWORK.:E05TSI                           WED 07/30/97 00:35 Page:178  
  10599  1 000113   200007 471500                    LDP1    OSI$,,AUTO
         1 000114   000100 100500                    MLR     fill='000'O
         1 000115   000007 400026                    ADSC9   7,,PR0                   cn=2,n=22
         1 000116   100007 400026                    ADSC9   7,,PR1                   cn=2,n=22

     1063    10600    6                               KI$OSIROUTE.LINK.HOST#(K) = KL$UPDOSI.HOST#;

  10600  1 000117   200012 236100                    LDQ     K,,AUTO
         1 000120   000017 402007                    MPY     15,DL
         1 000121   000106 100500                    MLR     fill='000'O
         1 000122   000000 400001                    ADSC9   0,,PR0                   cn=2,n=1
         1 000123   100015 600001                    ADSC9   13,Q,PR1                 cn=3,n=1

     1064    10601    6                               KI$OSIROUTE.SNPA = KL$UPDOSI.SNPA;

  10601  1 000124   000100 100500                    MLR     fill='000'O
         1 000125   000015 000010                    ADSC9   13,,PR0                  cn=0,n=8
         1 000126   100005 400010                    ADSC9   5,,PR1                   cn=2,n=8

     1065    10602    6                               KI$OSIROUTE.LINK.QOS(K) = KL$UPDOSI.QOS;

  10602  1 000127   000106 100500                    MLR     fill='000'O
         1 000130   000001 200001                    ADSC9   1,,PR0                   cn=1,n=1
         1 000131   100016 000001                    ADSC9   14,Q,PR1                 cn=0,n=1

     1066    10603    6                               END;

     1067    10604                               %UNLOCK(G=KI_LOCK);

  10605  1 000132   000001 630400 2                  EPPR0   1
         1 000133   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000134   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000135   000000 011000                    NOP     0

     1068    10607    5                          RETURN;

  10607  1 000136   000000 702200 xent               TSX2  ! X66_ARET
PL6.E3A0      #003=KIN$OSICHG File=KIN$NETWORK.:E05TSI                           WED 07/30/97 00:35 Page:179  

     1069    10608    5                          END;             /* node# = fep#                       */
     1070    10609    4                     END;                  /* do k                               */

  10609  1 000137   200012 054100                    AOS     K,,AUTO
         1 000140   200012 236100                    LDQ     K,,AUTO
         1 000141   000061 604000 1                  TMI     s:10590
         1 000142   000000 116000 xsym               CMPQ    KI_MXFE
         1 000143   000061 602000 1                  TNC     s:10590

     1071    10610    3                IF KL$UPDOSI.FCN = IGA_DELOSI THEN

  10610  1 000144   200004 470500                    LDP0    PARM$,,AUTO
         1 000145   000000 236100                    LDQ     0,,PR0
         1 000146   777000 376003                    ANQ     -512,DU
         1 000147   127000 116003                    CMPQ    44544,DU
         1 000150   000152 601000 1                  TNZ     s:10617

     1072    10611                  /*could not find the nsap the user was referring to.  just return   */
     1073    10612    3                     RETURN;

  10612  1 000151   000000 702200 xent               TSX2  ! X66_ARET

     1074    10613
     1075    10614        /*
     1076    10615             otherwise look for the first available slot and install the new info.
     1077    10616        */
     1078    10617    4                DO K = 0 TO KI_MXFE - 1;

  10617  1 000152   200012 450100                    STZ     K,,AUTO
         1 000153   000233 710000 1                  TRA     s:10634+1

     1079    10618    4                     IF NOT KI$OSIROUTE.LINK.ACTIVE(K) THEN

  10618  1 000154   200012 236100                    LDQ     K,,AUTO
         1 000155   000207 402007                    MPY     135,DL
         1 000156   000000 116003                    CMPQ    0,DU
PL6.E3A0      #003=KIN$OSICHG File=KIN$NETWORK.:E05TSI                           WED 07/30/97 00:35 Page:180  
         1 000157   000161 605000 1                  TPL     s:10618+5
         1 000160   000044 036003                    ADLQ    36,DU
         1 000161   200007 470500                    LDP0    OSI$,,AUTO
         1 000162   000000 066506                    CMPB    filb='0'B
         1 000163   000015 210001                    BDSC    13,Q,PR0                 by=1,bit=1,n=1
         1 000164   000002 000022 xsym               BDSC    B_VECTNIL+2              by=0,bit=0,n=18
         1 000165   000232 601000 1                  TNZ     s:10634

     1080    10619    5                     DO;

     1081    10620                               %LOCK(G=KI_LOCK);

  10621  1 000166   000001 630400 2                  EPPR0   1
         1 000167   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000170   000000 701000 xent               TSX1    HFC$LOCK
         1 000171   000000 011000                    NOP     0

     1082    10623    5                          KI$OSIROUTE.LNSAP = KL$UPDOSI.LNSAP;

  10623  1 000172   200004 470500                    LDP0    PARM$,,AUTO
         1 000173   200007 471500                    LDP1    OSI$,,AUTO
         1 000174   000100 100500                    MLR     fill='000'O
         1 000175   000007 400026                    ADSC9   7,,PR0                   cn=2,n=22
         1 000176   100007 400026                    ADSC9   7,,PR1                   cn=2,n=22

     1083    10624    5                          KI$OSIROUTE.LINK.HOST#(K) = KL$UPDOSI.HOST#;

  10624  1 000177   200012 236100                    LDQ     K,,AUTO
         1 000200   000017 402007                    MPY     15,DL
         1 000201   000106 100500                    MLR     fill='000'O
         1 000202   000000 400001                    ADSC9   0,,PR0                   cn=2,n=1
         1 000203   100015 600001                    ADSC9   13,Q,PR1                 cn=3,n=1

     1084    10625    5                          KI$OSIROUTE.SNPA = KL$UPDOSI.SNPA;

  10625  1 000204   000100 100500                    MLR     fill='000'O
         1 000205   000015 000010                    ADSC9   13,,PR0                  cn=0,n=8
PL6.E3A0      #003=KIN$OSICHG File=KIN$NETWORK.:E05TSI                           WED 07/30/97 00:35 Page:181  
         1 000206   100005 400010                    ADSC9   5,,PR1                   cn=2,n=8

     1085    10626    5                          KI$OSIROUTE.LINK.FEP#(K) = KL$UPDOSI.FEP#;

  10626  1 000207   000106 100500                    MLR     fill='000'O
         1 000210   000000 600001                    ADSC9   0,,PR0                   cn=3,n=1
         1 000211   100015 400001                    ADSC9   13,Q,PR1                 cn=2,n=1

     1086    10627    5                          KI$OSIROUTE.LINK.QOS(K) = KL$UPDOSI.QOS;

  10627  1 000212   000106 100500                    MLR     fill='000'O
         1 000213   000001 200001                    ADSC9   1,,PR0                   cn=1,n=1
         1 000214   100016 000001                    ADSC9   14,Q,PR1                 cn=0,n=1

     1087    10628    5                          KI$OSIROUTE.LINK.ACTIVE(K) = '1'B;

  10628  1 000215   200012 236100                    LDQ     K,,AUTO
         1 000216   000207 402007                    MPY     135,DL
         1 000217   000000 116003                    CMPQ    0,DU
         1 000220   000222 605000 1                  TPL     s:10628+5
         1 000221   000044 036003                    ADLQ    36,DU
         1 000222   003106 060400                    CSL     bolr='003'O
         1 000223   000030 000001 xsym               BDSC    B_VECTNIL+24             by=0,bit=0,n=1
         1 000224   100015 210001                    BDSC    13,Q,PR1                 by=1,bit=1,n=1

     1088    10629                               %UNLOCK(G=KI_LOCK);

  10630  1 000225   000001 630400 2                  EPPR0   1
         1 000226   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000227   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000230   000000 011000                    NOP     0

     1089    10632    5                          RETURN;

  10632  1 000231   000000 702200 xent               TSX2  ! X66_ARET

     1090    10633    5                          END;             /* not active                         */
PL6.E3A0      #003=KIN$OSICHG File=KIN$NETWORK.:E05TSI                           WED 07/30/97 00:35 Page:182  
     1091    10634    4                     END;                  /* do k                               */

  10634  1 000232   200012 054100                    AOS     K,,AUTO
         1 000233   200012 236100                    LDQ     K,,AUTO
         1 000234   000154 604000 1                  TMI     s:10618
         1 000235   000000 116000 xsym               CMPQ    KI_MXFE
         1 000236   000154 602000 1                  TNC     s:10618

     1092    10635    3                RETURN;                    /* no more space in current nsap      */

  10635  1 000237   000000 702200 xent               TSX2  ! X66_ARET

     1093    10636    3                END;                  /* type = type and afi=afi and len = len   */
     1094    10637    2           END;                            /* do i                               */

  10637  1 000240   200010 235100                    LDA     I,,AUTO
         1 000241   000001 035007                    ADLA    1,DL
         1 000242   200010 755100                    STA     I,,AUTO
         1 000243   200010 236100                    LDQ     I,,AUTO
         1 000244   000000 116000 xsym               CMPQ    KI_OSIMAX#
         1 000245   000007 602000 1                  TNC     s:10574

     1095    10638        /*
     1096    10639          couldn't find anyone who wanted us up there, lets make our own space.
     1097    10640        */
     1098    10641    2      DO I = 0 TO KI_OSIMAX# - 1;

  10641  1 000246   200010 450100                    STZ     I,,AUTO
         1 000247   000332 710000 1                  TRA     s:10662+3

     1099    10642    2           OSI$ = KI_OSIROUTE$(I);

  10642  1 000250   000000 470400 xsym               LDP0    KI_OSIROUTE$$
         1 000251   200010 720100                    LXL0    I,,AUTO
         1 000252   000000 236110                    LDQ     0,X0,PR0
         1 000253   200007 756100                    STQ     OSI$,,AUTO

PL6.E3A0      #003=KIN$OSICHG File=KIN$NETWORK.:E05TSI                           WED 07/30/97 00:35 Page:183  
     1100    10643    2           IF KI$OSIROUTE.NSAP.AFI = 0 THEN

  10643  1 000254   200007 471500                    LDP1    OSI$,,AUTO
         1 000255   100000 236100                    LDQ     0,,PR1
         1 000256   000777 316003                    CANQ    511,DU
         1 000257   000327 601000 1                  TNZ     s:10662

     1101    10644    3           DO;

     1102    10645                     %LOCK(G=KI_LOCK);

  10646  1 000260   000001 630400 2                  EPPR0   1
         1 000261   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000262   000000 701000 xent               TSX1    HFC$LOCK
         1 000263   000000 011000                    NOP     0

     1103    10648    3                KI$OSIROUTE = '0'B;

  10648  1 000264   200007 470500                    LDP0    OSI$,,AUTO
         1 000265   000100 100400                    MLR     fill='000'O
         1 000266   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         1 000267   000000 000104                    ADSC9   0,,PR0                   cn=0,n=68

     1104    10649    3                KI$OSIROUTE.NS_TYPE = KL$UPDOSI.NS_TYPE;

  10649  1 000270   200004 471500                    LDP1    PARM$,,AUTO
         1 000271   100000 236100                    LDQ     0,,PR1
         1 000272   000011 736000                    QLS     9
         1 000273   000015 676100                    ERQ     13,,PR0
         1 000274   360000 376003                    ANQ     122880,DU
         1 000275   000015 656100                    ERSQ    13,,PR0

     1105    10650    3                KI$OSIROUTE.NSAP = KL$UPDOSI.NSAP;

  10650  1 000276   000100 100500                    MLR     fill='000'O
         1 000277   100002 000026                    ADSC9   2,,PR1                   cn=0,n=22
         1 000300   000000 000026                    ADSC9   0,,PR0                   cn=0,n=22
PL6.E3A0      #003=KIN$OSICHG File=KIN$NETWORK.:E05TSI                           WED 07/30/97 00:35 Page:184  

     1106    10651    3                KI$OSIROUTE.LNSAP = KL$UPDOSI.LNSAP;

  10651  1 000301   000100 100500                    MLR     fill='000'O
         1 000302   100007 400026                    ADSC9   7,,PR1                   cn=2,n=22
         1 000303   000007 400026                    ADSC9   7,,PR0                   cn=2,n=22

     1107    10652    3                KI$OSIROUTE.LINK.HOST#(0) = KL$UPDOSI.HOST#;

  10652  1 000304   100000 236100                    LDQ     0,,PR1
         1 000305   000011 772000                    QRL     9
         1 000306   000015 552104                    STBQ    13,'04'O,PR0

     1108    10653    3                KI$OSIROUTE.SNPA = KL$UPDOSI.SNPA;

  10653  1 000307   000100 100500                    MLR     fill='000'O
         1 000310   100015 000010                    ADSC9   13,,PR1                  cn=0,n=8
         1 000311   000005 400010                    ADSC9   5,,PR0                   cn=2,n=8

     1109    10654    3                KI$OSIROUTE.LINK.FEP#(0) = KL$UPDOSI.FEP#;

  10654  1 000312   100000 236100                    LDQ     0,,PR1
         1 000313   000011 736000                    QLS     9
         1 000314   000015 552110                    STBQ    13,'10'O,PR0

     1110    10655    3                KI$OSIROUTE.LINK.QOS(0) = KL$UPDOSI.QOS;

  10655  1 000315   100001 236100                    LDQ     1,,PR1
         1 000316   000011 736000                    QLS     9
         1 000317   000016 552140                    STBQ    14,'40'O,PR0

     1111    10656    3                KI$OSIROUTE.LINK.ACTIVE(0) = '1'B;

  10656  1 000320   000200 236003                    LDQ     128,DU
         1 000321   000015 256100                    ORSQ    13,,PR0

     1112    10657                     %UNLOCK(G=KI_LOCK);
PL6.E3A0      #003=KIN$OSICHG File=KIN$NETWORK.:E05TSI                           WED 07/30/97 00:35 Page:185  

  10658  1 000322   000001 630400 2                  EPPR0   1
         1 000323   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000324   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000325   000000 011000                    NOP     0

     1113    10660    3                RETURN;

  10660  1 000326   000000 702200 xent               TSX2  ! X66_ARET

     1114    10661    3                END;                       /* route table entry not in use       */
     1115    10662    2           END;                            /* do i                               */

  10662  1 000327   200010 235100                    LDA     I,,AUTO
         1 000330   000001 035007                    ADLA    1,DL
         1 000331   200010 755100                    STA     I,,AUTO
         1 000332   200010 236100                    LDQ     I,,AUTO
         1 000333   000000 116000 xsym               CMPQ    KI_OSIMAX#
         1 000334   000250 602000 1                  TNC     s:10642

     1116    10663    1      RETURN;

  10663  1 000335   000000 702200 xent               TSX2  ! X66_ARET

     1117    10664
     1118    10665
     1119    10666
     1120    10667    1   KIN$OSILINKCHG: ENTRY(PARM) ALTRET;

  10667  1 000336   000000 700200 xent  KIN$OSILINK* TSX0  ! X66_AUTO_1
         1 000337   000020 000001                    ZERO    16,1

     1121    10668
     1122    10669
     1123    10670    1      PARM$ = ADDR(PARM);

  10670  1 000340   200003 236100                    LDQ     @PARM,,AUTO
PL6.E3A0      #003=KIN$OSICHG File=KIN$NETWORK.:E05TSI                           WED 07/30/97 00:35 Page:186  
         1 000341   200004 756100                    STQ     PARM$,,AUTO

     1124    10671    2      DO I = 0 TO KI_OSIMAX#-1;

  10671  1 000342   200010 450100                    STZ     I,,AUTO
         1 000343   000662 710000 1                  TRA     SNPALOOP+3

     1125    10672    2           OSI$ = KI_OSIROUTE$(I);

  10672  1 000344   000000 470400 xsym               LDP0    KI_OSIROUTE$$
         1 000345   200010 720100                    LXL0    I,,AUTO
         1 000346   000000 236110                    LDQ     0,X0,PR0
         1 000347   200007 756100                    STQ     OSI$,,AUTO

     1126    10673    3           IF KI$OSIROUTE.SNPA.LEN >= KL$OSILINKCHG.SNPA.LEN THEN DO;

  10673  1 000350   200004 471500                    LDP1    PARM$,,AUTO
         1 000351   100002 236100                    LDQ     2,,PR1
         1 000352   000033 772000                    QRL     27
         1 000353   200016 756100                    STQ     FOUNDONE+2,,AUTO
         1 000354   200007 473500                    LDP3    OSI$,,AUTO
         1 000355   300005 236100                    LDQ     5,,PR3
         1 000356   000011 772000                    QRL     9
         1 000357   000777 376007                    ANQ     511,DL
         1 000360   200016 116100                    CMPQ    FOUNDONE+2,,AUTO
         1 000361   000657 604000 1                  TMI     SNPALOOP

     1127    10674    3                IF MOD(KL$OSILINKCHG.SNPA.LEN,2) ~= 0 THEN

  10674  1 000362   100002 236100                    LDQ     2,,PR1
         1 000363   000033 772000                    QRL     27
         1 000364   000001 376007                    ANQ     1,DL
         1 000365   000373 600000 1                  TZE     s:10677

     1128    10675    3                     LEN = KL$OSILINKCHG.SNPA.LEN - 1;

  10675  1 000366   100002 236100                    LDQ     2,,PR1
PL6.E3A0      #003=KIN$OSICHG File=KIN$NETWORK.:E05TSI                           WED 07/30/97 00:35 Page:187  
         1 000367   000033 772000                    QRL     27
         1 000370   000001 136007                    SBLQ    1,DL
         1 000371   200011 756100                    STQ     LEN,,AUTO
         1 000372   000376 710000 1                  TRA     s:10679

     1129    10676    3                ELSE
     1130    10677    3                     LEN = KL$OSILINKCHG.SNPA.LEN;

  10677  1 000373   100002 236100                    LDQ     2,,PR1
         1 000374   000033 772000                    QRL     27
         1 000375   200011 756100                    STQ     LEN,,AUTO

     1131    10678
     1132    10679    3                UPDOSI$ = ADDR(KL$OSILINKCHG.SNPA.ADDRESS);

  10679  1 000376   200004 236100                    LDQ     PARM$,,AUTO
         1 000377   000000 036000 2                  ADLQ    0
         1 000400   200006 756100                    STQ     UPDOSI$,,AUTO

     1133    10680    3                OSIROUTE$ = ADDR(KI$OSIROUTE.SNPA.ADDRESS);

  10680  1 000401   200007 236100                    LDQ     OSI$,,AUTO
         1 000402   000002 036000 2                  ADLQ    2
         1 000403   200005 756100                    STQ     OSIROUTE$,,AUTO

     1134    10681    3                L = 0;

  10681  1 000404   200013 450100                    STZ     L,,AUTO

     1135    10682    4                DO K = 0 TO LEN - 1 BY 2;

  10682  1 000405   200012 450100                    STZ     K,,AUTO
         1 000406   000454 710000 1                  TRA     s:10687+2

     1136    10683    4                     IF ADDRTMPLT.BYT.HIGH(L) ~= ADDRTMPLT1.BYT.HIGH(L)

  10683  1 000407   200013 236100                    LDQ     L,,AUTO
PL6.E3A0      #003=KIN$OSICHG File=KIN$NETWORK.:E05TSI                           WED 07/30/97 00:35 Page:188  
         1 000410   000011 402007                    MPY     9,DL
         1 000411   000000 116003                    CMPQ    0,DU
         1 000412   000414 605000 1                  TPL     s:10683+5
         1 000413   000044 036003                    ADLQ    36,DU
         1 000414   200016 756100                    STQ     FOUNDONE+2,,AUTO
         1 000415   200013 236100                    LDQ     L,,AUTO
         1 000416   000011 402007                    MPY     9,DL
         1 000417   000000 116003                    CMPQ    0,DU
         1 000420   000422 605000 1                  TPL     s:10683+11
         1 000421   000044 036003                    ADLQ    36,DU
         1 000422   200006 470500                    LDP0    UPDOSI$,,AUTO
         1 000423   200016 235100                    LDA     FOUNDONE+2,,AUTO
         1 000424   200005 471500                    LDP1    OSIROUTE$,,AUTO
         1 000425   000106 066505                    CMPB    filb='0'B
         1 000426   000000 010004                    BDSC    0,A,PR0                  by=0,bit=1,n=4
         1 000427   100000 010004                    BDSC    0,Q,PR1                  by=0,bit=1,n=4
         1 000430   000657 601000 1                  TNZ     SNPALOOP
         1 000431   200013 236100                    LDQ     L,,AUTO
         1 000432   000011 402007                    MPY     9,DL
         1 000433   000000 116003                    CMPQ    0,DU
         1 000434   000436 605000 1                  TPL     s:10683+23
         1 000435   000044 036003                    ADLQ    36,DU
         1 000436   200017 756100                    STQ     FOUNDONE+3,,AUTO
         1 000437   200013 236100                    LDQ     L,,AUTO
         1 000440   000011 402007                    MPY     9,DL
         1 000441   000000 116003                    CMPQ    0,DU
         1 000442   000444 605000 1                  TPL     s:10683+29
         1 000443   000044 036003                    ADLQ    36,DU
         1 000444   200017 235100                    LDA     FOUNDONE+3,,AUTO
         1 000445   000106 066505                    CMPB    filb='0'B
         1 000446   000000 050004                    BDSC    0,A,PR0                  by=0,bit=5,n=4
         1 000447   100000 050004                    BDSC    0,Q,PR1                  by=0,bit=5,n=4
         1 000450   000657 601000 1                  TNZ     SNPALOOP

     1137    10684    4                       OR ADDRTMPLT.BYT.LOW(L) ~= ADDRTMPLT1.BYT.LOW(L) THEN
     1138    10685    4                          GOTO SNPALOOP;
     1139    10686    4                     L = L + 1;
PL6.E3A0      #003=KIN$OSICHG File=KIN$NETWORK.:E05TSI                           WED 07/30/97 00:35 Page:189  

  10686  1 000451   200013 054100                    AOS     L,,AUTO

     1140    10687    4                     END;                  /* do k                               */

  10687  1 000452   000002 236007                    LDQ     2,DL
         1 000453   200012 056100                    ASQ     K,,AUTO
         1 000454   200012 236100                    LDQ     K,,AUTO
         1 000455   200011 116100                    CMPQ    LEN,,AUTO
         1 000456   000407 604000 1                  TMI     s:10683

     1141    10688
     1142    10689    4                IF LEN ~= KL$OSILINKCHG.SNPA.LEN THEN DO;

  10689  1 000457   200004 470500                    LDP0    PARM$,,AUTO
         1 000460   000002 236100                    LDQ     2,,PR0
         1 000461   000033 772000                    QRL     27
         1 000462   200011 116100                    CMPQ    LEN,,AUTO
         1 000463   000506 600000 1                  TZE     s:10693

     1143    10690    4                     IF ADDRTMPLT.BYT.HIGH(L) ~= ADDRTMPLT1.BYT.HIGH(L) THEN

  10690  1 000464   200013 236100                    LDQ     L,,AUTO
         1 000465   000011 402007                    MPY     9,DL
         1 000466   000000 116003                    CMPQ    0,DU
         1 000467   000471 605000 1                  TPL     s:10690+5
         1 000470   000044 036003                    ADLQ    36,DU
         1 000471   200016 756100                    STQ     FOUNDONE+2,,AUTO
         1 000472   200013 236100                    LDQ     L,,AUTO
         1 000473   000011 402007                    MPY     9,DL
         1 000474   000000 116003                    CMPQ    0,DU
         1 000475   000477 605000 1                  TPL     s:10690+11
         1 000476   000044 036003                    ADLQ    36,DU
         1 000477   200006 471500                    LDP1    UPDOSI$,,AUTO
         1 000500   200016 235100                    LDA     FOUNDONE+2,,AUTO
         1 000501   200005 473500                    LDP3    OSIROUTE$,,AUTO
         1 000502   000106 066505                    CMPB    filb='0'B
PL6.E3A0      #003=KIN$OSICHG File=KIN$NETWORK.:E05TSI                           WED 07/30/97 00:35 Page:190  
         1 000503   100000 010004                    BDSC    0,A,PR1                  by=0,bit=1,n=4
         1 000504   300000 010004                    BDSC    0,Q,PR3                  by=0,bit=1,n=4
         1 000505   000657 601000 1                  TNZ     SNPALOOP

     1144    10691    4                          GOTO SNPALOOP;
     1145    10692    4                     END;

     1146    10693    4                DO K = 0 TO KI_MXFE-1;

  10693  1 000506   200012 450100                    STZ     K,,AUTO
         1 000507   000565 710000 1                  TRA     s:10707+1

     1147    10694    5                     IF KL$OSILINKCHG.NODE# = KI$OSIROUTE.LINK.FEP#(K) THEN DO;

  10694  1 000510   200012 236100                    LDQ     K,,AUTO
         1 000511   000017 402007                    MPY     15,DL
         1 000512   200007 470500                    LDP0    OSI$,,AUTO
         1 000513   000100 101506                    MRL     fill='000'O
         1 000514   000015 400001                    ADSC9   13,Q,PR0                 cn=2,n=1
         1 000515   200016 000004                    ADSC9   FOUNDONE+2,,AUTO         cn=0,n=4
         1 000516   200004 471500                    LDP1    PARM$,,AUTO
         1 000517   100000 236100                    LDQ     0,,PR1
         1 000520   000777 376007                    ANQ     511,DL
         1 000521   200016 116100                    CMPQ    FOUNDONE+2,,AUTO
         1 000522   000564 601000 1                  TNZ     s:10707

     1148    10695                               %LOCK(G=KI_LOCK);

  10696  1 000523   000001 630400 2                  EPPR0   1
         1 000524   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000525   000000 701000 xent               TSX1    HFC$LOCK
         1 000526   000000 011000                    NOP     0

     1149    10698    5                          IF KL$OSILINKCHG.TYPE = IGA_OSILINKUP THEN

  10698  1 000527   200004 470500                    LDP0    PARM$,,AUTO
         1 000530   000000 236100                    LDQ     0,,PR0
PL6.E3A0      #003=KIN$OSICHG File=KIN$NETWORK.:E05TSI                           WED 07/30/97 00:35 Page:191  
         1 000531   000777 376003                    ANQ     511,DU
         1 000532   000130 116003                    CMPQ    88,DU
         1 000533   000546 601000 1                  TNZ     s:10701

     1150    10699    5                               KI$OSIROUTE.LINK.ACTIVE(K) = '1'B;

  10699  1 000534   200012 236100                    LDQ     K,,AUTO
         1 000535   000207 402007                    MPY     135,DL
         1 000536   000000 116003                    CMPQ    0,DU
         1 000537   000541 605000 1                  TPL     s:10699+5
         1 000540   000044 036003                    ADLQ    36,DU
         1 000541   200007 471500                    LDP1    OSI$,,AUTO
         1 000542   003106 060400                    CSL     bolr='003'O
         1 000543   000030 000001 xsym               BDSC    B_VECTNIL+24             by=0,bit=0,n=1
         1 000544   100015 210001                    BDSC    13,Q,PR1                 by=1,bit=1,n=1
         1 000545   000557 710000 1                  TRA     s:10703

     1151    10700    5                          ELSE
     1152    10701    5                               KI$OSIROUTE.LINK.ACTIVE(K) = '0'B;

  10701  1 000546   200012 236100                    LDQ     K,,AUTO
         1 000547   000207 402007                    MPY     135,DL
         1 000550   000000 116003                    CMPQ    0,DU
         1 000551   000553 605000 1                  TPL     s:10701+5
         1 000552   000044 036003                    ADLQ    36,DU
         1 000553   200007 471500                    LDP1    OSI$,,AUTO
         1 000554   003106 060400                    CSL     bolr='003'O
         1 000555   000002 000001 xsym               BDSC    B_VECTNIL+2              by=0,bit=0,n=1
         1 000556   100015 210001                    BDSC    13,Q,PR1                 by=1,bit=1,n=1

     1153    10702                               %UNLOCK(G=KI_LOCK);

  10703  1 000557   000001 630400 2                  EPPR0   1
         1 000560   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000561   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000562   000000 011000                    NOP     0

PL6.E3A0      #003=KIN$OSICHG File=KIN$NETWORK.:E05TSI                           WED 07/30/97 00:35 Page:192  
     1154    10705    5                          GOTO SNPALOOP;   /* only one entry per node necessary  */

  10705  1 000563   000657 710000 1                  TRA     SNPALOOP

     1155    10706    5                          END;             /* node# = fep#                       */
     1156    10707    4                     END;                  /* do k = 1 to mxfe                   */

  10707  1 000564   200012 054100                    AOS     K,,AUTO
         1 000565   200012 236100                    LDQ     K,,AUTO
         1 000566   000510 604000 1                  TMI     s:10694
         1 000567   000000 116000 xsym               CMPQ    KI_MXFE
         1 000570   000510 602000 1                  TNC     s:10694

     1157    10708
     1158    10709                      /* didn't find an entry for this node in the list.
     1159    10710                         if it is a link up search for the first inactive and
     1160    10711                         set it to active.*/
     1161    10712    3                IF KL$OSILINKCHG.TYPE = IGA_OSILINKUP THEN

  10712  1 000571   200004 470500                    LDP0    PARM$,,AUTO
         1 000572   000000 236100                    LDQ     0,,PR0
         1 000573   000777 376003                    ANQ     511,DU
         1 000574   000130 116003                    CMPQ    88,DU
         1 000575   000657 601000 1                  TNZ     SNPALOOP

     1162    10713    4                DO K = 0 TO KI_MXFE-1;

  10713  1 000576   200012 450100                    STZ     K,,AUTO
         1 000577   000653 710000 1                  TRA     s:10727+1

     1163    10714    5                     IF NOT KI$OSIROUTE.LINK.ACTIVE(K) THEN DO;

  10714  1 000600   200012 236100                    LDQ     K,,AUTO
         1 000601   000207 402007                    MPY     135,DL
         1 000602   000000 116003                    CMPQ    0,DU
         1 000603   000605 605000 1                  TPL     s:10714+5
         1 000604   000044 036003                    ADLQ    36,DU
PL6.E3A0      #003=KIN$OSICHG File=KIN$NETWORK.:E05TSI                           WED 07/30/97 00:35 Page:193  
         1 000605   200007 470500                    LDP0    OSI$,,AUTO
         1 000606   000000 066506                    CMPB    filb='0'B
         1 000607   000015 210001                    BDSC    13,Q,PR0                 by=1,bit=1,n=1
         1 000610   000002 000022 xsym               BDSC    B_VECTNIL+2              by=0,bit=0,n=18
         1 000611   000652 601000 1                  TNZ     s:10727

     1164    10715                               %LOCK(G=KI_LOCK);

  10716  1 000612   000001 630400 2                  EPPR0   1
         1 000613   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000614   000000 701000 xent               TSX1    HFC$LOCK
         1 000615   000000 011000                    NOP     0

     1165    10718    5                          KI$OSIROUTE.LINK(K) = '0'B;

  10718  1 000616   200012 236100                    LDQ     K,,AUTO
         1 000617   000017 402007                    MPY     15,DL
         1 000620   200007 470500                    LDP0    OSI$,,AUTO
         1 000621   000106 100400                    MLR     fill='000'O
         1 000622   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         1 000623   000015 200017                    ADSC9   13,Q,PR0                 cn=1,n=15

     1166    10719    5                          KI$OSIROUTE.LINK.ACTIVE(K) = '1'B;

  10719  1 000624   200012 236100                    LDQ     K,,AUTO
         1 000625   000207 402007                    MPY     135,DL
         1 000626   000000 116003                    CMPQ    0,DU
         1 000627   000631 605000 1                  TPL     s:10719+5
         1 000630   000044 036003                    ADLQ    36,DU
         1 000631   003106 060400                    CSL     bolr='003'O
         1 000632   000030 000001 xsym               BDSC    B_VECTNIL+24             by=0,bit=0,n=1
         1 000633   000015 210001                    BDSC    13,Q,PR0                 by=1,bit=1,n=1

     1167    10720    5                          KI$OSIROUTE.LINK.QOS(K) = KL$OSILINKCHG.QOS;

  10720  1 000634   200012 236100                    LDQ     K,,AUTO
         1 000635   000017 402007                    MPY     15,DL
PL6.E3A0      #003=KIN$OSICHG File=KIN$NETWORK.:E05TSI                           WED 07/30/97 00:35 Page:194  
         1 000636   200004 471500                    LDP1    PARM$,,AUTO
         1 000637   000106 100500                    MLR     fill='000'O
         1 000640   100001 000001                    ADSC9   1,,PR1                   cn=0,n=1
         1 000641   000016 000001                    ADSC9   14,Q,PR0                 cn=0,n=1

     1168    10721    5                          KI$OSIROUTE.LINK.FEP#(K) = KL$OSILINKCHG.NODE#;

  10721  1 000642   000106 100500                    MLR     fill='000'O
         1 000643   100000 600001                    ADSC9   0,,PR1                   cn=3,n=1
         1 000644   000015 400001                    ADSC9   13,Q,PR0                 cn=2,n=1

     1169    10722                               %UNLOCK(G=KI_LOCK);

  10723  1 000645   000001 630400 2                  EPPR0   1
         1 000646   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000647   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000650   000000 011000                    NOP     0

     1170    10725    5                          GOTO SNPALOOP;   /* one's enough                       */

  10725  1 000651   000657 710000 1                  TRA     SNPALOOP

     1171    10726    5                          END;             /* no link in use                     */
     1172    10727    4                     END;                  /* do k                               */

  10727  1 000652   200012 054100                    AOS     K,,AUTO
         1 000653   200012 236100                    LDQ     K,,AUTO
         1 000654   000600 604000 1                  TMI     s:10714
         1 000655   000000 116000 xsym               CMPQ    KI_MXFE
         1 000656   000600 602000 1                  TNC     s:10714

     1173    10728    3                END;                       /* route.snpa.len > linkchg.snpa.len  */

  10720  1 000657                       SNPALOOP     null
     1174    10729    2   SNPALOOP:;
     1175    10730    2           END;                            /* do i                               */

PL6.E3A0      #003=KIN$OSICHG File=KIN$NETWORK.:E05TSI                           WED 07/30/97 00:35 Page:195  
  10730  1 000657   200010 235100                    LDA     I,,AUTO
         1 000660   000001 035007                    ADLA    1,DL
         1 000661   200010 755100                    STA     I,,AUTO
         1 000662   200010 236100                    LDQ     I,,AUTO
         1 000663   000000 116000 xsym               CMPQ    KI_OSIMAX#
         1 000664   000344 602000 1                  TNC     s:10672

     1176    10731    1   END KIN$OSICHG;

  10731  1 000665   000000 702200 xent               TSX2  ! X66_ARET

(unnamed)
 Sect OctLoc
   2     000   000002 200000   000000 006000   000005 600000                    ............
     1177    10732        %EOD;

PL6.E3A0      #003=KIN$OSICHG File=KIN$NETWORK.:E05TSI                           WED 07/30/97 00:35 Page:196  
--  Include file information  --

   CP_6_C.:E05TOU  is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   K_NETWORK_E.:E05TOU  is referenced.
   K_ADDRESS_M.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   KNN_NETWORK_M.:E05TOU  is referenced.
      No diagnostics issued in procedure KIN$OSICHG.
PL6.E3A0      #003=KIN$OSICHG File=KIN$NETWORK.:E05TSI                           WED 07/30/97 00:35 Page:197  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @PARM                     14-0-0/b BIT         r     1 FOUNDONE
    10-0-0/w UBIN        r     1 I                         12-0-0/w SBIN        r     1 K
    13-0-0/w SBIN        r     1 L                         11-0-0/w SBIN        r     1 LEN
     7-0-0/w PTR         r     1 OSI$                       5-0-0/w PTR         r     1 OSIROUTE$
    *0-0-0/w UBIN        r     1 PARM                       4-0-0/w PTR         r     1 PARM$
     6-0-0/w PTR         r     1 UPDOSI$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/b BIT (72)    r     1 KI_LOCK                    0-0-0/w UBIN        r     1 KI_MXFE
     0-0-0/w UBIN        r     1 KI_OSIMAX#                 0-0-0/w PTR         r     1 KI_OSIROUTE$$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c ACHR        r     1 ADDRESS                    0-0-0/w STRC(459)   r     1 ADDRTMPLT
     0-0-0/w STRC(459)   r     1 ADDRTMPLT1                 0-0-0/w STRC(612)   r     1 KI$OSIROUTE
     0-0-0/w PTR         r     1 KI_OSIROUTE$(0:0)
     0-0-0/w STRC(288)   r     1 KL$OSILINKCHG              0-0-0/w STRC(540)   r     1 KL$UPDOSI


   Procedure KIN$OSICHG requires 438 words for executable code.
   Procedure KIN$OSICHG requires 16 words of local(AUTO) storage.
PL6.E3A0      #003=KIN$OSICHG File=KIN$NETWORK.:E05TSI                           WED 07/30/97 00:35 Page:198  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=KIN$OSICHG File=KIN$NETWORK.:E05TSI                           WED 07/30/97 00:35 Page:199  
          MINI XREF LISTING

ADDRESS
     10560**DCL     10583>>IF      10583>>IF
ADDRTMPLT.BYT.HIGH
     10551**DCL     10683>>IF      10690>>IF
ADDRTMPLT.BYT.LOW
     10552**DCL     10683>>IF
ADDRTMPLT1.BYT.HIGH
     10557**DCL     10683>>IF      10690>>IF
ADDRTMPLT1.BYT.LOW
     10558**DCL     10683>>IF
FOUNDONE
     10569**DCL     10572<<ASSIGN
HFC$LOCK
      4329**DCL-ENT 10593--CALL    10621--CALL    10646--CALL    10696--CALL    10716--CALL
HFC$UNLOCK
      4329**DCL-ENT 10605--CALL    10630--CALL    10658--CALL    10703--CALL    10723--CALL
I
     10565**DCL     10573<<DOINDEX 10574>>ASSIGN  10641<<DOINDEX 10642>>ASSIGN  10671<<DOINDEX 10672>>ASSIGN
K
     10567**DCL     10589<<DOINDEX 10590>>IF      10600>>ASSIGN  10602>>ASSIGN  10617<<DOINDEX 10618>>IF
     10624>>ASSIGN  10626>>ASSIGN  10627>>ASSIGN  10628>>ASSIGN  10682<<DOINDEX 10693<<DOINDEX 10694>>IF
     10699>>ASSIGN  10701>>ASSIGN  10713<<DOINDEX 10714>>IF      10718>>ASSIGN  10719>>ASSIGN  10720>>ASSIGN
     10721>>ASSIGN
KI$OSIROUTE
     10346**DCL     10648<<ASSIGN
KI$OSIROUTE.LINK
     10511**DCL     10718<<ASSIGN
KI$OSIROUTE.LINK.ACTIVE
     10518**DCL     10618>>IF      10628<<ASSIGN  10656<<ASSIGN  10699<<ASSIGN  10701<<ASSIGN  10714>>IF
     10719<<ASSIGN
KI$OSIROUTE.LINK.FEP#
     10523**DCL     10590>>IF      10626<<ASSIGN  10654<<ASSIGN  10694>>IF      10721<<ASSIGN
PL6.E3A0      #003=KIN$OSICHG File=KIN$NETWORK.:E05TSI                           WED 07/30/97 00:35 Page:200  
KI$OSIROUTE.LINK.HOST#
     10530**DCL     10600<<ASSIGN  10624<<ASSIGN  10652<<ASSIGN
KI$OSIROUTE.LINK.QOS
     10534**DCL     10602<<ASSIGN  10627<<ASSIGN  10655<<ASSIGN  10720<<ASSIGN
KI$OSIROUTE.LNSAP
     10458**DCL     10599<<ASSIGN  10623<<ASSIGN  10651<<ASSIGN
KI$OSIROUTE.LNSAP.ADDRESS_N
     10488**DCL     10489--REDEF
KI$OSIROUTE.NSAP
     10368**DCL     10650<<ASSIGN
KI$OSIROUTE.NSAP.ADDRESS_N
     10398**DCL     10399--REDEF
KI$OSIROUTE.NSAP.AFI
     10375**DCL     10576>>IF      10582--ASSIGN  10596<<ASSIGN  10643>>IF
KI$OSIROUTE.NSAP.LEN
     10370**DCL     10576>>IF      10580>>ASSIGN
KI$OSIROUTE.NS_TYPE
     10499**DCL     10576>>IF      10649<<ASSIGN
KI$OSIROUTE.SNPA
     10425**DCL     10601<<ASSIGN  10625<<ASSIGN  10653<<ASSIGN
KI$OSIROUTE.SNPA.ADDRESS
     10432**DCL     10680--ASSIGN
KI$OSIROUTE.SNPA.LEN
     10427**DCL     10673>>IF
KI_LOCK
     10328**DCL     10593<>CALL    10605<>CALL    10621<>CALL    10630<>CALL    10646<>CALL    10658<>CALL
     10696<>CALL    10703<>CALL    10716<>CALL    10723<>CALL
KI_MXFE
     10327**DCL     10589>>DOINDEX 10617>>DOINDEX 10693>>DOINDEX 10713>>DOINDEX
KI_OSIMAX#
     10326**DCL     10573>>DOINDEX 10641>>DOINDEX 10671>>DOINDEX
KI_OSIROUTE$
     10547**DCL     10574>>ASSIGN  10642>>ASSIGN  10672>>ASSIGN
KI_OSIROUTE$$
     10325**DCL     10547--IMP-PTR 10574>>ASSIGN  10642>>ASSIGN  10672>>ASSIGN
KL$OSILINKCHG.NODE#
PL6.E3A0      #003=KIN$OSICHG File=KIN$NETWORK.:E05TSI                           WED 07/30/97 00:35 Page:201  
     10251**DCL     10694>>IF      10721>>ASSIGN
KL$OSILINKCHG.QOS
     10253**DCL     10720>>ASSIGN
KL$OSILINKCHG.SNPA.ADDRESS
     10286**DCL     10679--ASSIGN
KL$OSILINKCHG.SNPA.LEN
     10281**DCL     10673>>IF      10674>>IF      10675>>ASSIGN  10677>>ASSIGN  10689>>IF
KL$OSILINKCHG.TERMID.TERM
     10310**DCL     10319--REDEF
KL$OSILINKCHG.TYPE
     10240**DCL     10698>>IF      10712>>IF
KL$UPDOSI.FCN
     10020**DCL     10595>>IF      10610>>IF
KL$UPDOSI.FEP#
     10049**DCL     10590>>IF      10626>>ASSIGN  10654>>ASSIGN
KL$UPDOSI.HOST#
     10046**DCL     10600>>ASSIGN  10624>>ASSIGN  10652>>ASSIGN
KL$UPDOSI.LNSAP
     10133**DCL     10599>>ASSIGN  10623>>ASSIGN  10651>>ASSIGN
KL$UPDOSI.LNSAP.ADDRESS_N
     10163**DCL     10164--REDEF
KL$UPDOSI.MYNODE#
     10044**DCL     10046--REDEF
KL$UPDOSI.NODE#
     10047**DCL     10049--REDEF
KL$UPDOSI.NSAP
     10077**DCL     10650>>ASSIGN
KL$UPDOSI.NSAP.ADDRESS_N
     10107**DCL     10108--REDEF
KL$UPDOSI.NSAP.AFI
     10084**DCL     10576>>IF      10581--ASSIGN
KL$UPDOSI.NSAP.LEN
     10079**DCL     10576>>IF
KL$UPDOSI.NS_TYPE
     10032**DCL     10576>>IF      10649>>ASSIGN
KL$UPDOSI.QOS
PL6.E3A0      #003=KIN$OSICHG File=KIN$NETWORK.:E05TSI                           WED 07/30/97 00:35 Page:202  
     10052**DCL     10602>>ASSIGN  10627>>ASSIGN  10655>>ASSIGN
KL$UPDOSI.SNPA
     10187**DCL     10601>>ASSIGN  10625>>ASSIGN  10653>>ASSIGN
L
     10568**DCL     10681<<ASSIGN  10683>>IF      10683>>IF      10683>>IF      10683>>IF      10686<<ASSIGN
     10686>>ASSIGN  10690>>IF      10690>>IF
LEN
     10566**DCL     10560--IMP-SIZ 10580<<ASSIGN  10583>>IF      10583>>IF      10583>>IF      10583>>IF
     10675<<ASSIGN  10677<<ASSIGN  10682>>DOINDEX 10689>>IF
NXTI
     10579**LABEL   10584--EXIT
OSI$
     10564**DCL     10346--IMP-PTR 10574<<ASSIGN  10576>>IF      10576>>IF      10576>>IF      10580>>ASSIGN
     10582>>ASSIGN  10590>>IF      10596>>ASSIGN  10599>>ASSIGN  10600>>ASSIGN  10601>>ASSIGN  10602>>ASSIGN
     10618>>IF      10623>>ASSIGN  10624>>ASSIGN  10625>>ASSIGN  10626>>ASSIGN  10627>>ASSIGN  10628>>ASSIGN
     10642<<ASSIGN  10643>>IF      10648>>ASSIGN  10649>>ASSIGN  10650>>ASSIGN  10651>>ASSIGN  10652>>ASSIGN
     10653>>ASSIGN  10654>>ASSIGN  10655>>ASSIGN  10656>>ASSIGN  10672<<ASSIGN  10673>>IF      10680>>ASSIGN
     10694>>IF      10699>>ASSIGN  10701>>ASSIGN  10714>>IF      10718>>ASSIGN  10719>>ASSIGN  10720>>ASSIGN
     10721>>ASSIGN
OSIROUTE$
     10562**DCL     10554--IMP-PTR 10582<<ASSIGN  10583>>IF      10680<<ASSIGN  10683>>IF      10683>>IF
     10690>>IF
PARM
      9991**DCL         7--PROC    10571--ASSIGN  10667--ENTRY   10670--ASSIGN
PARM$
     10561**DCL     10009--IMP-PTR 10218--IMP-PTR 10571<<ASSIGN  10576>>IF      10576>>IF      10576>>IF
     10581>>ASSIGN  10590>>IF      10595>>IF      10599>>ASSIGN  10600>>ASSIGN  10601>>ASSIGN  10602>>ASSIGN
     10610>>IF      10623>>ASSIGN  10624>>ASSIGN  10625>>ASSIGN  10626>>ASSIGN  10627>>ASSIGN  10649>>ASSIGN
     10650>>ASSIGN  10651>>ASSIGN  10652>>ASSIGN  10653>>ASSIGN  10654>>ASSIGN  10655>>ASSIGN  10670<<ASSIGN
     10673>>IF      10674>>IF      10675>>ASSIGN  10677>>ASSIGN  10679>>ASSIGN  10689>>IF      10694>>IF
     10698>>IF      10712>>IF      10720>>ASSIGN  10721>>ASSIGN
SNPALOOP
     10720**LABEL   10685--GOTO    10691--GOTO    10705--GOTO    10725--GOTO
UPDOSI$
     10563**DCL     10548--IMP-PTR 10581<<ASSIGN  10583>>IF      10679<<ASSIGN  10683>>IF      10683>>IF
     10690>>IF

PL6.E3A0      #004=KIN$NODECHG File=KIN$NETWORK.:E05TSI                          WED 07/30/97 00:36 Page:203  
     1178        1        /*T***********************************************************/
     1179        2        /*T*                                                         */
     1180        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1181        4        /*T*                                                         */
     1182        5        /*T***********************************************************/
     1183        6        %EJECT;
PL6.E3A0      #004=KIN$NODECHG File=KIN$NETWORK.:E05TSI                          WED 07/30/97 00:36 Page:204  
     1184        7        KIN$NODECHG: PROC (NODE#,LNKNODE,QOS) ALTRET;
     1185        8
     1186        9
     1187       10        %INCLUDE EL$TABLES;
     1188      333        %INCLUDE EL_SUBS_C;
     1189      417        %INCLUDE HF_LOCK_C;
     1190      431        %INCLUDE KI_MACROS_C;
     1191     1039        %INCLUDE KI_SUBS_C;
     1192     1175        %INCLUDE KL_MACRO_C;
     1193     4527        %INCLUDE KL_AFCN_C;
     1194     4628        %INCLUDE KL_SUBS_C;
     1195     4682        %INCLUDE KNN_NETWORK_M;
     1196     5045        %INCLUDE K_ADDRESS_M;
     1197     5548
     1198     5549                                                /* Parameters                         */
     1199     5550    1   DCL NODE# SBIN;
     1200     5551    1   DCL LNKNODE UBIN;
     1201     5552    1   DCL QOS UBIN;
     1202     5553
     1203     5554                                                /* Entry references                   */
     1204     5555    1   DCL ELA$SYSLOG ENTRY(6) ALTRET;
     1205     5556    1   DCL KIT$REPDISC ENTRY(1);
     1206     5557    1   DCL KIQ$LGFEDN ENTRY(1);
     1207     5558    1   DCL KUB$WRITE ENTRY(3) ALTRET;
     1208     5559    1   DCL KIS$REP_DISC ENTRY(1);
     1209     5560
     1210     5561                                                /* Auto                               */
     1211     5562    1   DCL FEI# UBIN;
     1212     5563    1   DCL I SBIN;
     1213     5564    1   DCL J SBIN;
     1214     5565    1   DCL K SBIN;
     1215     5566        %EL$FECRASH (STCLASS=AUTO);
     1216     5571        %KL_ACCTNG (STCLASS=AUTO);
     1217     5585    1   DCL TEMP UBIN;
     1218     5586        %KL_FEPST (FPTN=FEPST,STCLASS=AUTO);
     1219     5621    1   DCL FEI$ PTR;
     1220     5622    1   DCL ROUTE$ PTR;
PL6.E3A0      #004=KIN$NODECHG File=KIN$NETWORK.:E05TSI                          WED 07/30/97 00:36 Page:205  
     1221     5623    1   DCL OSI$ PTR;
     1222     5624
     1223     5625                                                /* Based structures                   */
     1224     5626
     1225     5627    1   DCL KI$ROUTE$(0:0) PTR BASED(KI_ROUTE$$);
     1226     5628        %KI$FEI (STCLASS="BASED(FEI$)");
     1227     5712        %KI$ROUTE (STCLASS="BASED(ROUTE$)");
     1228     5766        %KNN$OSIROUTE(FPTN=KI$OSIROUTE,STCLASS="BASED(OSI$)");
     1229     5983    1   DCL KI$FEI$(0:0) PTR BASED(KI_FEI$$);
     1230     5984    1   DCL KI_OSIROUTE$(0:0) PTR BASED(KI_OSIROUTE$$);
     1231     5985                                                /* External Data                      */
     1232     5986    1   DCL K_NODE# UBIN SYMREF;
     1233     5987    1   DCL N$DCT$$ PTR SYMREF;
     1234     5988    1   DCL KI_FEI$$ PTR SYMREF;
     1235     5989    1   DCL KI_ROUTE$$ PTR SYMREF;
     1236     5990    1   DCL KI_LOCK BIT(72) SYMREF;
     1237     5991    1   DCL KI_NODES UBIN SYMREF;
     1238     5992    1   DCL KI_MXFE  UBIN SYMREF;
     1239     5993    1   DCL KI_OSIROUTE$$ PTR SYMREF;
     1240     5994    1   DCL KI_OSIMAX# UBIN SYMREF;
     1241     5995
     1242     5996        /* If the link specified is not active return.
     1243     5997        */
     1244     5998    1      IF NOT KI$ROUTE$(LNKNODE)-> KI$ROUTE.LINK_CONNECTED
     1245     5999    1        OR KI$ROUTE$(NODE#)-> KI$ROUTE.LINK_CONNECTED
     1246     6000    1      THEN RETURN;
     1247     6001
     1248     6002           %LOCK (G=KI_LOCK);
     1249     6005    2      DO I = 1 TO KI_MXFE;
     1250     6006    2           FEI$ = KI$FEI$(I);
     1251     6007    2           IF KI$FEI.FEP# = LNKNODE
     1252     6008    3           THEN DO;
     1253     6009    3                ROUTE$ = KI$ROUTE$(NODE#);
     1254     6010    3                KI$ROUTE.LINK.QOS(I) = MINIMUM(QOS +
     1255     6011    3                  KI$ROUTE$(LNKNODE)->KI$ROUTE.CURRENT_QOS, 255);
     1256     6012                     %UNLOCK (G=KI_LOCK);
     1257     6015
PL6.E3A0      #004=KIN$NODECHG File=KIN$NETWORK.:E05TSI                          WED 07/30/97 00:36 Page:206  
     1258     6016    3                CALL UPDATE_ROUTE ALTRET(DO_ALTRET);
     1259     6017    3                RETURN;
     1260     6018    3                END;
     1261     6019    2           END;
     1262     6020           %UNLOCK (G=KI_LOCK);
     1263     6023    1      RETURN;
     1264     6024
     1265     6025    1   DO_ALTRET: ;
     1266     6026    1      ALTRETURN;
     1267     6027
     1268     6028        %EJECT;
PL6.E3A0      #004=KIN$NODECHG File=KIN$NETWORK.:E05TSI                          WED 07/30/97 00:36 Page:207  
     1269     6029    1   KIN$UPDATE_ROUTE: ENTRY ALTRET;
     1270     6030
     1271     6031    1      CALL UPDATE_ROUTE
     1272     6032    2      WHENALTRETURN DO; ALTRETURN; END;
     1273     6033
     1274     6034        %EJECT;
PL6.E3A0      #004=KIN$NODECHG File=KIN$NETWORK.:E05TSI                          WED 07/30/97 00:36 Page:208  
     1275     6035    1   UPDATE_ROUTE: PROC ALTRET;
     1276     6036
     1277     6037    2   DCL SVLINK SBIN;
     1278     6038    2   DCL BESTQOS UBIN;
     1279     6039    2   DCL ALTQOS UBIN;
     1280     6040
     1281     6041    3      DO I = 0 TO KI_NODES;
     1282     6042    3           SVLINK = 0;
     1283     6043    3           BESTQOS = 255;
     1284     6044    3           ALTQOS = 255;
     1285     6045    3           ROUTE$ = KI$ROUTE$(I);
     1286     6046
     1287     6047                                                /* Go through every link              */
     1288     6048    4           DO J = 1 TO KI_MXFE;
     1289     6049    4                IF BESTQOS > KI$ROUTE.LINK.QOS(J)
     1290     6050    5                THEN DO;
     1291     6051    5                     BESTQOS = KI$ROUTE.LINK.QOS(J);
     1292     6052
     1293     6053    5                     SVLINK = J;
     1294     6054    5                     END;
     1295     6055
     1296     6056    4                END;
     1297     6057
     1298     6058        /* If the status has change tell SLUG.
     1299     6059        */
     1300     6060    3           IF KI$ROUTE.FEI# ~= SVLINK OR KI$ROUTE.CURRENT_QOS ~= BESTQOS
     1301     6061    4           THEN DO;
     1302     6062    4                FEPST.FCN = IGA_FEPST;
     1303     6063    4                FEPST.FEP = I;
     1304     6064    4                FEPST.QOS = BESTQOS;
     1305     6065    4                FEPST.PROB = KIER_QOSCHG;
     1306     6066
     1307     6067    4                IF SVLINK ~= 0
     1308     6068    4                THEN FEPST.LNK_NODE = KI$FEI$(SVLINK)->KI$FEI.FEP#;
     1309     6069    4                ELSE FEPST.LNK_NODE = 0;
     1310     6070
     1311     6071    4                FEPST.ALT_QOS = 255;
PL6.E3A0      #004=KIN$NODECHG File=KIN$NETWORK.:E05TSI                          WED 07/30/97 00:36 Page:209  
     1312     6072    4                CALL KUB$WRITE(FEPST,SIZEC(FEPST),'HLPADMIN')
     1313     6073    5                WHENALTRETURN DO;
     1314     6074    5                     ALTRETURN;
     1315     6075    5                     END;
     1316     6076    4                END;
     1317     6077
     1318     6078    3           IF SVLINK = 0                   /* No link available                  */
     1319     6079    4           THEN DO;
     1320     6080    4                IF KI$ROUTE.FEI# ~= 0
     1321     6081    5                THEN DO;
     1322     6082    5                     CALL KIT$REPDISC (I);
     1323     6083
     1324     6084    5                     IF KI$FEI$(KI$ROUTE.FEI#)->KI$FEI.FEP# ~= I /* Not a local  */
     1325     6085    6                     THEN DO;
     1326     6086    6                          EL$FECRASH.FENM.PROBLEM=KIER_QOSCHG;
     1327     6087    6                          EL$FECRASH.FENM.STATE=KIST_RUN;
     1328     6088    6                          EL$FECRASH.FENM.FEP#=I;
     1329     6089    6                          EL$FECRASH.FENM.DEVADDR='0'B;
     1330     6090    6                          EL$FECRASH.FENM.NODENAME = KI$ROUTE.NODE_NAME;
     1331     6091    6                          EL$FECRASH.FENM.CRASH# = KI$ROUTE.SEQ;
     1332     6092    6                          KI$ROUTE.SEQ = KI$ROUTE.SEQ + 1;
     1333     6093    6                          EL$FECRASH.FENM.LINK_NODE = 511;
     1334     6094    6                          EL$FECRASH.FENM.QOS = 255;
     1335     6095    6                          EL$FECRASH.FENM.ALT_QOS = 255;
     1336     6096    6                          CALL ELA$SYSLOG (EL_FEPCRASH,EL$FECRASH,SIZEW(EL$FECRASH),
              6096                                   '0'B,1,TEMP);
     1337     6097    6                          KL_ACCTNG.FEX=I;
     1338     6098    6                          KL_ACCTNG.REASON=%KLDR_QOSCHG;
     1339     6099    6                          CALL KIQ$LGFEDN(KL_ACCTNG);
     1340     6100    6                          END;
     1341     6101    5                     ELSE        /* rep disconnect on all of the qdp sessions    */
     1342     6102    5                          CALL KIS$REP_DISC(I);
     1343     6103    5                     END;
     1344     6104                      /*
     1345     6105                         update the ositable when a node disconnects.
     1346     6106                      */
     1347     6107    4                KI$ROUTE.FEI# = 0;;
PL6.E3A0      #004=KIN$NODECHG File=KIN$NETWORK.:E05TSI                          WED 07/30/97 00:36 Page:210  
     1348     6108    4                KI$ROUTE.CURRENT_QOS = 255;
     1349     6109    4                KI$ROUTE.ALT_QOS = 255;
     1350     6110    5                DO J = 0 TO KI_OSIMAX#-1;
     1351     6111    5                     OSI$ = KI_OSIROUTE$(J);
     1352     6112    5                     IF KI$OSIROUTE.NS_TYPE = %K_TYPE_RNSAP THEN
     1353     6113    6                     DO K = 0 TO KI_MXFE-1;
     1354     6114    6                          IF KI$OSIROUTE.LINK.FEP#(K) = I THEN
     1355     6115    6                               KI$OSIROUTE.LINK.ACTIVE(K) = '0'B;
     1356     6116    6                          END;             /* do k                               */
     1357     6117    5                     END;                  /* do j                               */
     1358     6118    4                END;
     1359     6119
     1360     6120    4           ELSE DO;
     1361     6121    4                IF KI$FEI$(SVLINK)->KI$FEI.FEP# ~= I /* Not a local              */
     1362     6122    4                  AND SVLINK ~= KI$ROUTE.FEI#
     1363     6123    5                THEN DO;
     1364     6124    5                     EL$FECRASH.FENM.PROBLEM=KIER_QOSCHG;
     1365     6125    5                     EL$FECRASH.FENM.STATE=KIST_DN;
     1366     6126    5                     EL$FECRASH.FENM.FEP#=I;
     1367     6127    5                     EL$FECRASH.FENM.DEVADDR='0'B;
     1368     6128    5                     EL$FECRASH.FENM.NODENAME = KI$ROUTE.NODE_NAME;
     1369     6129    5                     EL$FECRASH.FENM.CRASH# = KI$ROUTE.SEQ;
     1370     6130    5                     EL$FECRASH.FENM.QOS = BESTQOS;
     1371     6131    5                     EL$FECRASH.FENM.ALT_QOS = ALTQOS;
     1372     6132    5                     EL$FECRASH.FENM.LINK_NODE = KI$FEI$(SVLINK)->KI$FEI.FEP#;
     1373     6133    5                     KI$ROUTE.SEQ = KI$ROUTE.SEQ + 1;
     1374     6134    5                     CALL ELA$SYSLOG (EL_FEPCRASH,EL$FECRASH,SIZEW(EL$FECRASH),'0'B,1,
              6134                              TEMP);
     1375     6135    5                     END;
     1376     6136    4                KI$ROUTE.FEI# = SVLINK;
     1377     6137    4                KI$ROUTE.CURRENT_QOS = BESTQOS;
     1378     6138    4                KI$ROUTE.ALT_QOS = ALTQOS;
     1379     6139    4                END;
     1380     6140
     1381     6141    3           END;
     1382     6142    2      RETURN;
     1383     6143    2   END UPDATE_ROUTE;
PL6.E3A0      #004=KIN$NODECHG File=KIN$NETWORK.:E05TSI                          WED 07/30/97 00:36 Page:211  
     1384     6144    1   END KIN$NODECHG;
     1385     6145        %EOD;

PL6.E3A0      #004=KIN$NODECHG File=KIN$NETWORK.:E05TSI                          WED 07/30/97 00:36 Page:212  
--  Include file information  --

   K_ADDRESS_M.:E05TOU  is referenced.
   KNN_NETWORK_M.:E05TOU  is referenced.
   KL_SUBS_C.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   KI_SUBS_C.:E05TOU  is referenced.
   KI_MACROS_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   EL_SUBS_C.:E05TOU  is referenced.
   EL$TABLES.:E05TOU  is referenced.
      No diagnostics issued in procedure KIN$NODECHG.

   Procedure KIN$NODECHG requires 366 words for executable code.
   Procedure KIN$NODECHG requires 40 words of local(AUTO) storage.

PL6.E3A0      #004=KIN$NODECHG File=KIN$NETWORK.:E05TSI                          WED 07/30/97 00:36 Page:213  

 Object Unit name= KIN$NODECHG                                File name= KIN$NETWORK.:E05TOU
 UTS= JUL 30 '97 00:36:28.60 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      2      2  KIN$NODECHG
    1   Proc  even  none   366    556  KIN$NODECHG
    2  RoData even  none     9     11  KIN$NODECHG

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        3  KIN$NODECHG
     1    114          yes     yes      Std        0  KIN$UPDATE_ROUTE

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 HFC$LOCK
         yes           Std       1 HFC$UNLOCK
 yes     yes           Std       3 KUB$WRITE
         yes           Std       1 KIT$REPDISC
         yes           Std       1 KIQ$LGFEDN
 yes     yes           Std       6 ELA$SYSLOG
         yes           Std       1 KIS$REP_DISC
                       nStd      0 X66_AUTO_3
                       nStd      0 X66_ARET
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AALT
PL6.E3A0      #004=KIN$NODECHG File=KIN$NETWORK.:E05TSI                          WED 07/30/97 00:36 Page:214  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KI_FEI$$                              KI_ROUTE$$                            KI_LOCK
     KI_NODES                              KI_MXFE                               KI_OSIROUTE$$
     KI_OSIMAX#                            B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #004=KIN$NODECHG File=KIN$NETWORK.:E05TSI                          WED 07/30/97 00:36 Page:215  


     1178        1        /*T***********************************************************/
     1179        2        /*T*                                                         */
     1180        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1181        4        /*T*                                                         */
     1182        5        /*T***********************************************************/
     1183        6        %EJECT;
PL6.E3A0      #004=KIN$NODECHG File=KIN$NETWORK.:E05TSI                          WED 07/30/97 00:36 Page:216  
     1184        7        KIN$NODECHG: PROC (NODE#,LNKNODE,QOS) ALTRET;

      7  1 000000   000000 700200 xent  KIN$NODECHG  TSX0  ! X66_AUTO_3
         1 000001   000050 000003                    ZERO    40,3

     1185        8
     1186        9
     1187       10        %INCLUDE EL$TABLES;
     1188      333        %INCLUDE EL_SUBS_C;
     1189      417        %INCLUDE HF_LOCK_C;
     1190      431        %INCLUDE KI_MACROS_C;
     1191     1039        %INCLUDE KI_SUBS_C;
     1192     1175        %INCLUDE KL_MACRO_C;
     1193     4527        %INCLUDE KL_AFCN_C;
     1194     4628        %INCLUDE KL_SUBS_C;
     1195     4682        %INCLUDE KNN_NETWORK_M;
     1196     5045        %INCLUDE K_ADDRESS_M;
     1197     5548
     1198     5549                                                /* Parameters                         */
     1199     5550    1   DCL NODE# SBIN;
     1200     5551    1   DCL LNKNODE UBIN;
     1201     5552    1   DCL QOS UBIN;
     1202     5553
     1203     5554                                                /* Entry references                   */
     1204     5555    1   DCL ELA$SYSLOG ENTRY(6) ALTRET;
     1205     5556    1   DCL KIT$REPDISC ENTRY(1);
     1206     5557    1   DCL KIQ$LGFEDN ENTRY(1);
     1207     5558    1   DCL KUB$WRITE ENTRY(3) ALTRET;
     1208     5559    1   DCL KIS$REP_DISC ENTRY(1);
     1209     5560
     1210     5561                                                /* Auto                               */
     1211     5562    1   DCL FEI# UBIN;
     1212     5563    1   DCL I SBIN;
     1213     5564    1   DCL J SBIN;
     1214     5565    1   DCL K SBIN;
     1215     5566        %EL$FECRASH (STCLASS=AUTO);
     1216     5571        %KL_ACCTNG (STCLASS=AUTO);
PL6.E3A0      #004=KIN$NODECHG File=KIN$NETWORK.:E05TSI                          WED 07/30/97 00:36 Page:217  
     1217     5585    1   DCL TEMP UBIN;
     1218     5586        %KL_FEPST (FPTN=FEPST,STCLASS=AUTO);
     1219     5621    1   DCL FEI$ PTR;
     1220     5622    1   DCL ROUTE$ PTR;
     1221     5623    1   DCL OSI$ PTR;
     1222     5624
     1223     5625                                                /* Based structures                   */
     1224     5626
     1225     5627    1   DCL KI$ROUTE$(0:0) PTR BASED(KI_ROUTE$$);
     1226     5628        %KI$FEI (STCLASS="BASED(FEI$)");
     1227     5712        %KI$ROUTE (STCLASS="BASED(ROUTE$)");
     1228     5766        %KNN$OSIROUTE(FPTN=KI$OSIROUTE,STCLASS="BASED(OSI$)");
     1229     5983    1   DCL KI$FEI$(0:0) PTR BASED(KI_FEI$$);
     1230     5984    1   DCL KI_OSIROUTE$(0:0) PTR BASED(KI_OSIROUTE$$);
     1231     5985                                                /* External Data                      */
     1232     5986    1   DCL K_NODE# UBIN SYMREF;
     1233     5987    1   DCL N$DCT$$ PTR SYMREF;
     1234     5988    1   DCL KI_FEI$$ PTR SYMREF;
     1235     5989    1   DCL KI_ROUTE$$ PTR SYMREF;
     1236     5990    1   DCL KI_LOCK BIT(72) SYMREF;
     1237     5991    1   DCL KI_NODES UBIN SYMREF;
     1238     5992    1   DCL KI_MXFE  UBIN SYMREF;
     1239     5993    1   DCL KI_OSIROUTE$$ PTR SYMREF;
     1240     5994    1   DCL KI_OSIMAX# UBIN SYMREF;
     1241     5995
     1242     5996        /* If the link specified is not active return.
     1243     5997        */
     1244     5998    1      IF NOT KI$ROUTE$(LNKNODE)-> KI$ROUTE.LINK_CONNECTED

   5998  1 000002   200004 470500                    LDP0    @LNKNODE,,AUTO
         1 000003   000000 720100                    LXL0    0,,PR0
         1 000004   000000 471400 xsym               LDP1    KI_ROUTE$$
         1 000005   100000 473510                    LDP3    0,X0,PR1
         1 000006   300002 236100                    LDQ     2,,PR3
         1 000007   000200 316007                    CANQ    128,DL
         1 000010   000017 600000 1                  TZE     s:6000
         1 000011   200003 474500                    LDP4    @NODE#,,AUTO
PL6.E3A0      #004=KIN$NODECHG File=KIN$NETWORK.:E05TSI                          WED 07/30/97 00:36 Page:218  
         1 000012   400000 721100                    LXL1    0,,PR4
         1 000013   100000 475511                    LDP5    0,X1,PR1
         1 000014   500002 236100                    LDQ     2,,PR5
         1 000015   000200 316007                    CANQ    128,DL
         1 000016   000020 600000 1                  TZE     s:6003

     1245     5999    1        OR KI$ROUTE$(NODE#)-> KI$ROUTE.LINK_CONNECTED
     1246     6000    1      THEN RETURN;

   6000  1 000017   000000 702200 xent               TSX2  ! X66_ARET

     1247     6001
     1248     6002           %LOCK (G=KI_LOCK);

   6003  1 000020   000000 630400 2                  EPPR0   0
         1 000021   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000022   000000 701000 xent               TSX1    HFC$LOCK
         1 000023   000000 011000                    NOP     0

     1249     6005    2      DO I = 1 TO KI_MXFE;

   6005  1 000024   000001 235007                    LDA     1,DL
         1 000025   200007 755100                    STA     I,,AUTO
         1 000026   000102 710000 1                  TRA     s:6019+1

     1250     6006    2           FEI$ = KI$FEI$(I);

   6006  1 000027   000000 470400 xsym               LDP0    KI_FEI$$
         1 000030   200007 720100                    LXL0    I,,AUTO
         1 000031   000000 236110                    LDQ     0,X0,PR0
         1 000032   200033 756100                    STQ     FEI$,,AUTO

     1251     6007    2           IF KI$FEI.FEP# = LNKNODE

   6007  1 000033   200004 471500                    LDP1    @LNKNODE,,AUTO
         1 000034   200033 473500                    LDP3    FEI$,,AUTO
         1 000035   300012 236100                    LDQ     10,,PR3
PL6.E3A0      #004=KIN$NODECHG File=KIN$NETWORK.:E05TSI                          WED 07/30/97 00:36 Page:219  
         1 000036   000011 772000                    QRL     9
         1 000037   000777 376007                    ANQ     511,DL
         1 000040   100000 116100                    CMPQ    0,,PR1
         1 000041   000101 601000 1                  TNZ     s:6019

     1252     6008    3           THEN DO;

     1253     6009    3                ROUTE$ = KI$ROUTE$(NODE#);

   6009  1 000042   200003 474500                    LDP4    @NODE#,,AUTO
         1 000043   400000 721100                    LXL1    0,,PR4
         1 000044   000000 475400 xsym               LDP5    KI_ROUTE$$
         1 000045   500000 236111                    LDQ     0,X1,PR5
         1 000046   200034 756100                    STQ     ROUTE$,,AUTO

     1254     6010    3                KI$ROUTE.LINK.QOS(I) = MINIMUM(QOS +

   6010  1 000047   200007 236100                    LDQ     I,,AUTO
         1 000050   000003 402007                    MPY     3,DL
         1 000051   100000 721100                    LXL1    0,,PR1
         1 000052   500000 476511                    LDP6    0,X1,PR5
         1 000053   200005 477500                    LDP7    @QOS,,AUTO
         1 000054   000000 622006                    EAX2    0,QL
         1 000055   600002 236100                    LDQ     2,,PR6
         1 000056   000022 772000                    QRL     18
         1 000057   000777 376007                    ANQ     511,DL
         1 000060   700000 036100                    ADLQ    0,,PR7
         1 000061   000377 116007                    CMPQ    255,DL
         1 000062   000065 602000 1                  TNC     s:6010+14
         1 000063   000065 600000 1                  TZE     s:6010+14
         1 000064   000377 236007                    LDQ     255,DL
         1 000065   200034 470500                    LDP0    ROUTE$,,AUTO
         1 000066   000033 736000                    QLS     27
         1 000067   000003 676112                    ERQ     3,X2,PR0
         1 000070   777000 376003                    ANQ     -512,DU
         1 000071   000003 656112                    ERSQ    3,X2,PR0

PL6.E3A0      #004=KIN$NODECHG File=KIN$NETWORK.:E05TSI                          WED 07/30/97 00:36 Page:220  
     1255     6011    3                  KI$ROUTE$(LNKNODE)->KI$ROUTE.CURRENT_QOS, 255);
     1256     6012                     %UNLOCK (G=KI_LOCK);

   6013  1 000072   000000 630400 2                  EPPR0   0
         1 000073   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000074   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000075   000000 011000                    NOP     0

     1257     6015
     1258     6016    3                CALL UPDATE_ROUTE ALTRET(DO_ALTRET);

   6016  1 000076   000123 701000 1                  TSX1    UPDATE_ROUTE
         1 000077   000113 702000 1                  TSX2    DO_ALTRET

     1259     6017    3                RETURN;

   6017  1 000100   000000 702200 xent               TSX2  ! X66_ARET

     1260     6018    3                END;
     1261     6019    2           END;

   6019  1 000101   200007 054100                    AOS     I,,AUTO
         1 000102   000000 236000 xsym               LDQ     KI_MXFE
         1 000103   000027 604000 1                  TMI     s:6006
         1 000104   200007 116100                    CMPQ    I,,AUTO
         1 000105   000027 605000 1                  TPL     s:6006

     1262     6020           %UNLOCK (G=KI_LOCK);

   6021  1 000106   000000 630400 2                  EPPR0   0
         1 000107   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000110   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000111   000000 011000                    NOP     0

     1263     6023    1      RETURN;

   6023  1 000112   000000 702200 xent               TSX2  ! X66_ARET
PL6.E3A0      #004=KIN$NODECHG File=KIN$NETWORK.:E05TSI                          WED 07/30/97 00:36 Page:221  

   6013  1 000113                       DO_ALTRET    null
     1264     6024
     1265     6025    1   DO_ALTRET: ;
     1266     6026    1      ALTRETURN;

   6026  1 000113   000000 702200 xent               TSX2  ! X66_AALT

     1267     6027
     1268     6028        %EJECT;
PL6.E3A0      #004=KIN$NODECHG File=KIN$NETWORK.:E05TSI                          WED 07/30/97 00:36 Page:222  
     1269     6029    1   KIN$UPDATE_ROUTE: ENTRY ALTRET;

   6029  1 000114   000000 700200 xent  KIN$UPDATE_* TSX0  ! X66_AUTO_3
         1 000115   000050 000003                    ZERO    40,3

     1270     6030
     1271     6031    1      CALL UPDATE_ROUTE

   6031  1 000116   000123 701000 1                  TSX1    UPDATE_ROUTE
         1 000117   000121 702000 1                  TSX2    s:6032
         1 000120   000122 710000 1                  TRA     s:6032+1

     1272     6032    2      WHENALTRETURN DO; ALTRETURN; END;

   6032  1 000121   000000 702200 xent               TSX2  ! X66_AALT
         1 000122   000555 710000 1                  TRA     s:6144

     1273     6033
     1274     6034        %EJECT;
PL6.E3A0      #004=KIN$NODECHG File=KIN$NETWORK.:E05TSI                          WED 07/30/97 00:36 Page:223  
     1275     6035    1   UPDATE_ROUTE: PROC ALTRET;

   6035  1 000123   200036 741300       UPDATE_ROUTE STX1  ! OSI$+1,,AUTO

     1276     6036
     1277     6037    2   DCL SVLINK SBIN;
     1278     6038    2   DCL BESTQOS UBIN;
     1279     6039    2   DCL ALTQOS UBIN;
     1280     6040
     1281     6041    3      DO I = 0 TO KI_NODES;

   6041  1 000124   200007 450100                    STZ     I,,AUTO
         1 000125   000547 710000 1                  TRA     s:6141+1

     1282     6042    3           SVLINK = 0;

   6042  1 000126   200037 450100                    STZ     SVLINK,,AUTO

     1283     6043    3           BESTQOS = 255;

   6043  1 000127   000377 235007                    LDA     255,DL
         1 000130   200040 755100                    STA     BESTQOS,,AUTO

     1284     6044    3           ALTQOS = 255;

   6044  1 000131   200041 755100                    STA     ALTQOS,,AUTO

     1285     6045    3           ROUTE$ = KI$ROUTE$(I);

   6045  1 000132   000000 470400 xsym               LDP0    KI_ROUTE$$
         1 000133   200007 720100                    LXL0    I,,AUTO
         1 000134   000000 236110                    LDQ     0,X0,PR0
         1 000135   200034 756100                    STQ     ROUTE$,,AUTO

     1286     6046
     1287     6047                                                /* Go through every link              */
     1288     6048    4           DO J = 1 TO KI_MXFE;
PL6.E3A0      #004=KIN$NODECHG File=KIN$NETWORK.:E05TSI                          WED 07/30/97 00:36 Page:224  

   6048  1 000136   000001 235007                    LDA     1,DL
         1 000137   200010 755100                    STA     J,,AUTO
         1 000140   000160 710000 1                  TRA     s:6056+1

     1289     6049    4                IF BESTQOS > KI$ROUTE.LINK.QOS(J)

   6049  1 000141   200010 236100                    LDQ     J,,AUTO
         1 000142   000003 402007                    MPY     3,DL
         1 000143   200034 470500                    LDP0    ROUTE$,,AUTO
         1 000144   000003 236106                    LDQ     3,QL,PR0
         1 000145   000033 772000                    QRL     27
         1 000146   200040 116100                    CMPQ    BESTQOS,,AUTO
         1 000147   000157 603000 1                  TRC     s:6056

     1290     6050    5                THEN DO;

     1291     6051    5                     BESTQOS = KI$ROUTE.LINK.QOS(J);

   6051  1 000150   200010 236100                    LDQ     J,,AUTO
         1 000151   000003 402007                    MPY     3,DL
         1 000152   000003 236106                    LDQ     3,QL,PR0
         1 000153   000033 772000                    QRL     27
         1 000154   200040 756100                    STQ     BESTQOS,,AUTO

     1292     6052
     1293     6053    5                     SVLINK = J;

   6053  1 000155   200010 235100                    LDA     J,,AUTO
         1 000156   200037 755100                    STA     SVLINK,,AUTO

     1294     6054    5                     END;

     1295     6055
     1296     6056    4                END;

   6056  1 000157   200010 054100                    AOS     J,,AUTO
PL6.E3A0      #004=KIN$NODECHG File=KIN$NETWORK.:E05TSI                          WED 07/30/97 00:36 Page:225  
         1 000160   000000 236000 xsym               LDQ     KI_MXFE
         1 000161   000141 604000 1                  TMI     s:6049
         1 000162   200010 116100                    CMPQ    J,,AUTO
         1 000163   000141 605000 1                  TPL     s:6049

     1297     6057
     1298     6058        /* If the status has change tell SLUG.
     1299     6059        */
     1300     6060    3           IF KI$ROUTE.FEI# ~= SVLINK OR KI$ROUTE.CURRENT_QOS ~= BESTQOS

   6060  1 000164   200034 470500                    LDP0    ROUTE$,,AUTO
         1 000165   000002 236100                    LDQ     2,,PR0
         1 000166   000033 772000                    QRL     27
         1 000167   200037 116100                    CMPQ    SVLINK,,AUTO
         1 000170   000176 601000 1                  TNZ     s:6062
         1 000171   000002 236100                    LDQ     2,,PR0
         1 000172   000022 772000                    QRL     18
         1 000173   000777 376007                    ANQ     511,DL
         1 000174   200040 116100                    CMPQ    BESTQOS,,AUTO
         1 000175   000242 600000 1                  TZE     s:6078

     1301     6061    4           THEN DO;

     1302     6062    4                FEPST.FCN = IGA_FEPST;

   6062  1 000176   040000 236003                    LDQ     16384,DU
         1 000177   200027 552140                    STBQ    FEPST,'40'O,AUTO

     1303     6063    4                FEPST.FEP = I;

   6063  1 000200   200007 236100                    LDQ     I,,AUTO
         1 000201   000022 736000                    QLS     18
         1 000202   200027 552120                    STBQ    FEPST,'20'O,AUTO

     1304     6064    4                FEPST.QOS = BESTQOS;

   6064  1 000203   200040 720100                    LXL0    BESTQOS,,AUTO
PL6.E3A0      #004=KIN$NODECHG File=KIN$NETWORK.:E05TSI                          WED 07/30/97 00:36 Page:226  
         1 000204   200030 440100                    SXL0    FEPST+1,,AUTO

     1305     6065    4                FEPST.PROB = KIER_QOSCHG;

   6065  1 000205   000023 221003                    LDX1    19,DU
         1 000206   200027 441100                    SXL1    FEPST,,AUTO

     1306     6066
     1307     6067    4                IF SVLINK ~= 0

   6067  1 000207   200037 235100                    LDA     SVLINK,,AUTO
         1 000210   000221 600000 1                  TZE     s:6069

     1308     6068    4                THEN FEPST.LNK_NODE = KI$FEI$(SVLINK)->KI$FEI.FEP#;

   6068  1 000211   000000 471400 xsym               LDP1    KI_FEI$$
         1 000212   100000 473505                    LDP3    0,AL,PR1
         1 000213   300012 236100                    LDQ     10,,PR3
         1 000214   000011 772000                    QRL     9
         1 000215   000777 376007                    ANQ     511,DL
         1 000216   000000 622006                    EAX2    0,QL
         1 000217   200031 742100                    STX2    FEPST+2,,AUTO
         1 000220   000223 710000 1                  TRA     s:6071

     1309     6069    4                ELSE FEPST.LNK_NODE = 0;

   6069  1 000221   000000 222003                    LDX2    0,DU
         1 000222   200031 742100                    STX2    FEPST+2,,AUTO

     1310     6070
     1311     6071    4                FEPST.ALT_QOS = 255;

   6071  1 000223   000377 223003                    LDX3    255,DU
         1 000224   200031 443100                    SXL3    FEPST+2,,AUTO

     1312     6072    4                CALL KUB$WRITE(FEPST,SIZEC(FEPST),'HLPADMIN')

PL6.E3A0      #004=KIN$NODECHG File=KIN$NETWORK.:E05TSI                          WED 07/30/97 00:36 Page:227  
   6072  1 000225   000002 236000 2                  LDQ     2
         1 000226   200044 756100                    STQ     ALTQOS+3,,AUTO
         1 000227   000003 236000 2                  LDQ     3
         1 000230   200043 756100                    STQ     ALTQOS+2,,AUTO
         1 000231   200027 631500                    EPPR1   FEPST,,AUTO
         1 000232   200042 451500                    STP1    ALTQOS+1,,AUTO
         1 000233   200042 630500                    EPPR0   ALTQOS+1,,AUTO
         1 000234   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000235   000000 701000 xent               TSX1    KUB$WRITE
         1 000236   000240 702000 1                  TSX2    s:6074
         1 000237   000242 710000 1                  TRA     s:6078

     1313     6073    5                WHENALTRETURN DO;

     1314     6074    5                     ALTRETURN;

   6074  1 000240   200036 221300                    LDX1  ! OSI$+1,,AUTO
         1 000241   000000 702211                    TSX2  ! 0,X1

     1315     6075    5                     END;
     1316     6076    4                END;

     1317     6077
     1318     6078    3           IF SVLINK = 0                   /* No link available                  */

   6078  1 000242   200037 235100                    LDA     SVLINK,,AUTO
         1 000243   000443 601000 1                  TNZ     s:6121

     1319     6079    4           THEN DO;

     1320     6080    4                IF KI$ROUTE.FEI# ~= 0

   6080  1 000244   200034 470500                    LDP0    ROUTE$,,AUTO
         1 000245   000002 236100                    LDQ     2,,PR0
         1 000246   777000 316003                    CANQ    -512,DU
         1 000247   000363 600000 1                  TZE     s:6107

PL6.E3A0      #004=KIN$NODECHG File=KIN$NETWORK.:E05TSI                          WED 07/30/97 00:36 Page:228  
     1321     6081    5                THEN DO;

     1322     6082    5                     CALL KIT$REPDISC (I);

   6082  1 000250   200007 631500                    EPPR1   I,,AUTO
         1 000251   200042 451500                    STP1    ALTQOS+1,,AUTO
         1 000252   200042 630500                    EPPR0   ALTQOS+1,,AUTO
         1 000253   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000254   000000 701000 xent               TSX1    KIT$REPDISC
         1 000255   000000 011000                    NOP     0

     1323     6083
     1324     6084    5                     IF KI$FEI$(KI$ROUTE.FEI#)->KI$FEI.FEP# ~= I /* Not a local  */

   6084  1 000256   200034 470500                    LDP0    ROUTE$,,AUTO
         1 000257   000002 236100                    LDQ     2,,PR0
         1 000260   000033 772000                    QRL     27
         1 000261   000000 471400 xsym               LDP1    KI_FEI$$
         1 000262   100000 473506                    LDP3    0,QL,PR1
         1 000263   300012 236100                    LDQ     10,,PR3
         1 000264   000011 772000                    QRL     9
         1 000265   000777 376007                    ANQ     511,DL
         1 000266   200007 116100                    CMPQ    I,,AUTO
         1 000267   000355 600000 1                  TZE     s:6102

     1325     6085    6                     THEN DO;

     1326     6086    6                          EL$FECRASH.FENM.PROBLEM=KIER_QOSCHG;

   6086  1 000270   023000 236007                    LDQ     9728,DL
         1 000271   200012 552110                    STBQ    EL$FECRASH,'10'O,AUTO

     1327     6087    6                          EL$FECRASH.FENM.STATE=KIST_RUN;

   6087  1 000272   000002 236007                    LDQ     2,DL
         1 000273   200012 552104                    STBQ    EL$FECRASH,'04'O,AUTO

PL6.E3A0      #004=KIN$NODECHG File=KIN$NETWORK.:E05TSI                          WED 07/30/97 00:36 Page:229  
     1328     6088    6                          EL$FECRASH.FENM.FEP#=I;

   6088  1 000274   200007 235100                    LDA     I,,AUTO
         1 000275   200013 755100                    STA     EL$FECRASH+1,,AUTO

     1329     6089    6                          EL$FECRASH.FENM.DEVADDR='0'B;

   6089  1 000276   000000 236003                    LDQ     0,DU
         1 000277   200012 552140                    STBQ    EL$FECRASH,'40'O,AUTO

     1330     6090    6                          EL$FECRASH.FENM.NODENAME = KI$ROUTE.NODE_NAME;

   6090  1 000300   040100 100500                    MLR     fill='040'O
         1 000301   000000 000010                    ADSC9   0,,PR0                   cn=0,n=8
         1 000302   200014 000010                    ADSC9   EL$FECRASH+2,,AUTO       cn=0,n=8

     1331     6091    6                          EL$FECRASH.FENM.CRASH# = KI$ROUTE.SEQ;

   6091  1 000303   000002 236100                    LDQ     2,,PR0
         1 000304   000177 376007                    ANQ     127,DL
         1 000305   000022 736000                    QLS     18
         1 000306   200012 552120                    STBQ    EL$FECRASH,'20'O,AUTO

     1332     6092    6                          KI$ROUTE.SEQ = KI$ROUTE.SEQ + 1;

   6092  1 000307   000002 236100                    LDQ     2,,PR0
         1 000310   000177 376007                    ANQ     127,DL
         1 000311   000001 036007                    ADLQ    1,DL
         1 000312   000002 676100                    ERQ     2,,PR0
         1 000313   000177 376007                    ANQ     127,DL
         1 000314   000002 656100                    ERSQ    2,,PR0

     1333     6093    6                          EL$FECRASH.FENM.LINK_NODE = 511;

   6093  1 000315   777000 236003                    LDQ     -512,DU
         1 000316   200016 552140                    STBQ    EL$FECRASH+4,'40'O,AUTO

PL6.E3A0      #004=KIN$NODECHG File=KIN$NETWORK.:E05TSI                          WED 07/30/97 00:36 Page:230  
     1334     6094    6                          EL$FECRASH.FENM.QOS = 255;

   6094  1 000317   000377 236003                    LDQ     255,DU
         1 000320   200016 552120                    STBQ    EL$FECRASH+4,'20'O,AUTO

     1335     6095    6                          EL$FECRASH.FENM.ALT_QOS = 255;

   6095  1 000321   377000 236007                    LDQ     130560,DL
         1 000322   200016 552110                    STBQ    EL$FECRASH+4,'10'O,AUTO

     1336     6096    6                          CALL ELA$SYSLOG (EL_FEPCRASH,EL$FECRASH,SIZEW(EL$FECRASH),
              6096                                   '0'B,1,TEMP);

   6096  1 000323   200026 633500                    EPPR3   TEMP,,AUTO
         1 000324   200047 453500                    STP3    ALTQOS+6,,AUTO
         1 000325   000005 236000 2                  LDQ     5
         1 000326   200046 756100                    STQ     ALTQOS+5,,AUTO
         1 000327   000006 237000 2                  LDAQ    6
         1 000330   200044 757100                    STAQ    ALTQOS+3,,AUTO
         1 000331   200012 634500                    EPPR4   EL$FECRASH,,AUTO
         1 000332   200043 454500                    STP4    ALTQOS+2,,AUTO
         1 000333   000010 236000 2                  LDQ     8
         1 000334   200042 756100                    STQ     ALTQOS+1,,AUTO
         1 000335   200042 630500                    EPPR0   ALTQOS+1,,AUTO
         1 000336   000024 631400 xsym               EPPR1   B_VECTNIL+20
         1 000337   000000 701000 xent               TSX1    ELA$SYSLOG
         1 000340   000000 011000                    NOP     0

     1337     6097    6                          KL_ACCTNG.FEX=I;

   6097  1 000341   200007 236100                    LDQ     I,,AUTO
         1 000342   000033 736000                    QLS     27
         1 000343   200017 552140                    STBQ    KL_ACCTNG,'40'O,AUTO

     1338     6098    6                          KL_ACCTNG.REASON=%KLDR_QOSCHG;

   6098  1 000344   000013 236003                    LDQ     11,DU
PL6.E3A0      #004=KIN$NODECHG File=KIN$NETWORK.:E05TSI                          WED 07/30/97 00:36 Page:231  
         1 000345   200017 552120                    STBQ    KL_ACCTNG,'20'O,AUTO

     1339     6099    6                          CALL KIQ$LGFEDN(KL_ACCTNG);

   6099  1 000346   200017 630500                    EPPR0   KL_ACCTNG,,AUTO
         1 000347   200042 450500                    STP0    ALTQOS+1,,AUTO
         1 000350   200042 630500                    EPPR0   ALTQOS+1,,AUTO
         1 000351   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000352   000000 701000 xent               TSX1    KIQ$LGFEDN
         1 000353   000000 011000                    NOP     0

     1340     6100    6                          END;

   6100  1 000354   000363 710000 1                  TRA     s:6107

     1341     6101    5                     ELSE        /* rep disconnect on all of the qdp sessions    */
     1342     6102    5                          CALL KIS$REP_DISC(I);

   6102  1 000355   200007 633500                    EPPR3   I,,AUTO
         1 000356   200042 453500                    STP3    ALTQOS+1,,AUTO
         1 000357   200042 630500                    EPPR0   ALTQOS+1,,AUTO
         1 000360   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000361   000000 701000 xent               TSX1    KIS$REP_DISC
         1 000362   000000 011000                    NOP     0

     1343     6103    5                     END;

     1344     6104                      /*
     1345     6105                         update the ositable when a node disconnects.
     1346     6106                      */
     1347     6107    4                KI$ROUTE.FEI# = 0;;

   6107  1 000363   200034 470500                    LDP0    ROUTE$,,AUTO
         1 000364   000000 236003                    LDQ     0,DU
         1 000365   000002 552140                    STBQ    2,'40'O,PR0

     1348     6108    4                KI$ROUTE.CURRENT_QOS = 255;
PL6.E3A0      #004=KIN$NODECHG File=KIN$NETWORK.:E05TSI                          WED 07/30/97 00:36 Page:232  

   6108  1 000366   000377 236003                    LDQ     255,DU
         1 000367   000002 552120                    STBQ    2,'20'O,PR0

     1349     6109    4                KI$ROUTE.ALT_QOS = 255;

   6109  1 000370   377000 236007                    LDQ     130560,DL
         1 000371   000002 552110                    STBQ    2,'10'O,PR0

     1350     6110    5                DO J = 0 TO KI_OSIMAX#-1;

   6110  1 000372   200010 450100                    STZ     J,,AUTO
         1 000373   000436 710000 1                  TRA     s:6117+1

     1351     6111    5                     OSI$ = KI_OSIROUTE$(J);

   6111  1 000374   000000 470400 xsym               LDP0    KI_OSIROUTE$$
         1 000375   200010 720100                    LXL0    J,,AUTO
         1 000376   000000 236110                    LDQ     0,X0,PR0
         1 000377   200035 756100                    STQ     OSI$,,AUTO

     1352     6112    5                     IF KI$OSIROUTE.NS_TYPE = %K_TYPE_RNSAP THEN

   6112  1 000400   200035 471500                    LDP1    OSI$,,AUTO
         1 000401   100015 236100                    LDQ     13,,PR1
         1 000402   360000 376003                    ANQ     122880,DU
         1 000403   040000 116003                    CMPQ    16384,DU
         1 000404   000435 601000 1                  TNZ     s:6117

     1353     6113    6                     DO K = 0 TO KI_MXFE-1;

   6113  1 000405   200011 450100                    STZ     K,,AUTO
         1 000406   000431 710000 1                  TRA     s:6116+1

     1354     6114    6                          IF KI$OSIROUTE.LINK.FEP#(K) = I THEN

   6114  1 000407   200011 236100                    LDQ     K,,AUTO
PL6.E3A0      #004=KIN$NODECHG File=KIN$NETWORK.:E05TSI                          WED 07/30/97 00:36 Page:233  
         1 000410   000017 402007                    MPY     15,DL
         1 000411   200035 470500                    LDP0    OSI$,,AUTO
         1 000412   000100 101506                    MRL     fill='000'O
         1 000413   000015 400001                    ADSC9   13,Q,PR0                 cn=2,n=1
         1 000414   200042 000004                    ADSC9   ALTQOS+1,,AUTO           cn=0,n=4
         1 000415   200042 236100                    LDQ     ALTQOS+1,,AUTO
         1 000416   200007 116100                    CMPQ    I,,AUTO
         1 000417   000430 601000 1                  TNZ     s:6116

     1355     6115    6                               KI$OSIROUTE.LINK.ACTIVE(K) = '0'B;

   6115  1 000420   200011 236100                    LDQ     K,,AUTO
         1 000421   000207 402007                    MPY     135,DL
         1 000422   000000 116003                    CMPQ    0,DU
         1 000423   000425 605000 1                  TPL     s:6115+5
         1 000424   000044 036003                    ADLQ    36,DU
         1 000425   003106 060400                    CSL     bolr='003'O
         1 000426   000002 000001 xsym               BDSC    B_VECTNIL+2              by=0,bit=0,n=1
         1 000427   000015 210001                    BDSC    13,Q,PR0                 by=1,bit=1,n=1

     1356     6116    6                          END;             /* do k                               */

   6116  1 000430   200011 054100                    AOS     K,,AUTO
         1 000431   200011 236100                    LDQ     K,,AUTO
         1 000432   000407 604000 1                  TMI     s:6114
         1 000433   000000 116000 xsym               CMPQ    KI_MXFE
         1 000434   000407 602000 1                  TNC     s:6114

     1357     6117    5                     END;                  /* do j                               */

   6117  1 000435   200010 054100                    AOS     J,,AUTO
         1 000436   200010 236100                    LDQ     J,,AUTO
         1 000437   000374 604000 1                  TMI     s:6111
         1 000440   000000 116000 xsym               CMPQ    KI_OSIMAX#
         1 000441   000374 602000 1                  TNC     s:6111

     1358     6118    4                END;
PL6.E3A0      #004=KIN$NODECHG File=KIN$NETWORK.:E05TSI                          WED 07/30/97 00:36 Page:234  

   6118  1 000442   000546 710000 1                  TRA     s:6141

     1359     6119
     1360     6120    4           ELSE DO;

     1361     6121    4                IF KI$FEI$(SVLINK)->KI$FEI.FEP# ~= I /* Not a local              */

   6121  1 000443   000000 470400 xsym               LDP0    KI_FEI$$
         1 000444   000000 471505                    LDP1    0,AL,PR0
         1 000445   100012 236100                    LDQ     10,,PR1
         1 000446   000011 772000                    QRL     9
         1 000447   000777 376007                    ANQ     511,DL
         1 000450   200007 116100                    CMPQ    I,,AUTO
         1 000451   000534 600000 1                  TZE     s:6136
         1 000452   200034 471500                    LDP1    ROUTE$,,AUTO
         1 000453   100002 236100                    LDQ     2,,PR1
         1 000454   000033 772000                    QRL     27
         1 000455   200037 116100                    CMPQ    SVLINK,,AUTO
         1 000456   000534 600000 1                  TZE     s:6136

     1362     6122    4                  AND SVLINK ~= KI$ROUTE.FEI#
     1363     6123    5                THEN DO;

     1364     6124    5                     EL$FECRASH.FENM.PROBLEM=KIER_QOSCHG;

   6124  1 000457   023000 236007                    LDQ     9728,DL
         1 000460   200012 552110                    STBQ    EL$FECRASH,'10'O,AUTO

     1365     6125    5                     EL$FECRASH.FENM.STATE=KIST_DN;

   6125  1 000461   000000 236003                    LDQ     0,DU
         1 000462   200012 552104                    STBQ    EL$FECRASH,'04'O,AUTO

     1366     6126    5                     EL$FECRASH.FENM.FEP#=I;

   6126  1 000463   200007 235100                    LDA     I,,AUTO
PL6.E3A0      #004=KIN$NODECHG File=KIN$NETWORK.:E05TSI                          WED 07/30/97 00:36 Page:235  
         1 000464   200013 755100                    STA     EL$FECRASH+1,,AUTO

     1367     6127    5                     EL$FECRASH.FENM.DEVADDR='0'B;

   6127  1 000465   200012 552140                    STBQ    EL$FECRASH,'40'O,AUTO

     1368     6128    5                     EL$FECRASH.FENM.NODENAME = KI$ROUTE.NODE_NAME;

   6128  1 000466   040100 100500                    MLR     fill='040'O
         1 000467   100000 000010                    ADSC9   0,,PR1                   cn=0,n=8
         1 000470   200014 000010                    ADSC9   EL$FECRASH+2,,AUTO       cn=0,n=8

     1369     6129    5                     EL$FECRASH.FENM.CRASH# = KI$ROUTE.SEQ;

   6129  1 000471   100002 236100                    LDQ     2,,PR1
         1 000472   000177 376007                    ANQ     127,DL
         1 000473   000022 736000                    QLS     18
         1 000474   200012 552120                    STBQ    EL$FECRASH,'20'O,AUTO

     1370     6130    5                     EL$FECRASH.FENM.QOS = BESTQOS;

   6130  1 000475   200040 236100                    LDQ     BESTQOS,,AUTO
         1 000476   000022 736000                    QLS     18
         1 000477   200016 552120                    STBQ    EL$FECRASH+4,'20'O,AUTO

     1371     6131    5                     EL$FECRASH.FENM.ALT_QOS = ALTQOS;

   6131  1 000500   200041 236100                    LDQ     ALTQOS,,AUTO
         1 000501   000011 736000                    QLS     9
         1 000502   200016 552110                    STBQ    EL$FECRASH+4,'10'O,AUTO

     1372     6132    5                     EL$FECRASH.FENM.LINK_NODE = KI$FEI$(SVLINK)->KI$FEI.FEP#;

   6132  1 000503   200037 720100                    LXL0    SVLINK,,AUTO
         1 000504   000000 473510                    LDP3    0,X0,PR0
         1 000505   300012 236100                    LDQ     10,,PR3
         1 000506   000022 736000                    QLS     18
PL6.E3A0      #004=KIN$NODECHG File=KIN$NETWORK.:E05TSI                          WED 07/30/97 00:36 Page:236  
         1 000507   200016 552140                    STBQ    EL$FECRASH+4,'40'O,AUTO

     1373     6133    5                     KI$ROUTE.SEQ = KI$ROUTE.SEQ + 1;

   6133  1 000510   100002 236100                    LDQ     2,,PR1
         1 000511   000177 376007                    ANQ     127,DL
         1 000512   000001 036007                    ADLQ    1,DL
         1 000513   100002 676100                    ERQ     2,,PR1
         1 000514   000177 376007                    ANQ     127,DL
         1 000515   100002 656100                    ERSQ    2,,PR1

     1374     6134    5                     CALL ELA$SYSLOG (EL_FEPCRASH,EL$FECRASH,SIZEW(EL$FECRASH),'0'B,1,
              6134                              TEMP);

   6134  1 000516   200026 633500                    EPPR3   TEMP,,AUTO
         1 000517   200047 453500                    STP3    ALTQOS+6,,AUTO
         1 000520   000005 236000 2                  LDQ     5
         1 000521   200046 756100                    STQ     ALTQOS+5,,AUTO
         1 000522   000006 237000 2                  LDAQ    6
         1 000523   200044 757100                    STAQ    ALTQOS+3,,AUTO
         1 000524   200012 634500                    EPPR4   EL$FECRASH,,AUTO
         1 000525   200043 454500                    STP4    ALTQOS+2,,AUTO
         1 000526   000010 236000 2                  LDQ     8
         1 000527   200042 756100                    STQ     ALTQOS+1,,AUTO
         1 000530   200042 630500                    EPPR0   ALTQOS+1,,AUTO
         1 000531   000024 631400 xsym               EPPR1   B_VECTNIL+20
         1 000532   000000 701000 xent               TSX1    ELA$SYSLOG
         1 000533   000000 011000                    NOP     0

     1375     6135    5                     END;

     1376     6136    4                KI$ROUTE.FEI# = SVLINK;

   6136  1 000534   200034 470500                    LDP0    ROUTE$,,AUTO
         1 000535   200037 236100                    LDQ     SVLINK,,AUTO
         1 000536   000033 736000                    QLS     27
         1 000537   000002 552140                    STBQ    2,'40'O,PR0
PL6.E3A0      #004=KIN$NODECHG File=KIN$NETWORK.:E05TSI                          WED 07/30/97 00:36 Page:237  

     1377     6137    4                KI$ROUTE.CURRENT_QOS = BESTQOS;

   6137  1 000540   200040 236100                    LDQ     BESTQOS,,AUTO
         1 000541   000022 736000                    QLS     18
         1 000542   000002 552120                    STBQ    2,'20'O,PR0

     1378     6138    4                KI$ROUTE.ALT_QOS = ALTQOS;

   6138  1 000543   200041 236100                    LDQ     ALTQOS,,AUTO
         1 000544   000011 736000                    QLS     9
         1 000545   000002 552110                    STBQ    2,'10'O,PR0

     1379     6139    4                END;

     1380     6140
     1381     6141    3           END;

   6141  1 000546   200007 054100                    AOS     I,,AUTO
         1 000547   000000 236000 xsym               LDQ     KI_NODES
         1 000550   000126 604000 1                  TMI     s:6042
         1 000551   200007 116100                    CMPQ    I,,AUTO
         1 000552   000126 605000 1                  TPL     s:6042

     1382     6142    2      RETURN;

   6142  1 000553   200036 221300                    LDX1  ! OSI$+1,,AUTO
         1 000554   000001 702211                    TSX2  ! 1,X1

     1383     6143    2   END UPDATE_ROUTE;
     1384     6144    1   END KIN$NODECHG;

   6144  1 000555   000000 702200 xent               TSX2  ! X66_ARET

(unnamed)
 Sect OctLoc
   0     000   110114 120101   104115 111116                                    HLPADMIN
PL6.E3A0      #004=KIN$NODECHG File=KIN$NETWORK.:E05TSI                          WED 07/30/97 00:36 Page:238  

(unnamed)
 Sect OctLoc
   2     000   000000 006000   000000 000020   000000 006000   000001 006000    ................
   2     004   000000 000460   000003 006000   000007 006000   000002 006000    ................
   2     010   000004 006000                                                    ....
     1385     6145        %EOD;

PL6.E3A0      #004=KIN$NODECHG File=KIN$NETWORK.:E05TSI                          WED 07/30/97 00:36 Page:239  
--  Include file information  --

   K_ADDRESS_M.:E05TOU  is referenced.
   KNN_NETWORK_M.:E05TOU  is referenced.
   KL_SUBS_C.:E05TOU  is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   KI_SUBS_C.:E05TOU  is referenced.
   KI_MACROS_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   EL_SUBS_C.:E05TOU  is referenced.
   EL$TABLES.:E05TOU  is referenced.
      No diagnostics issued in procedure KIN$NODECHG.
PL6.E3A0      #004=KIN$NODECHG File=KIN$NETWORK.:E05TSI                          WED 07/30/97 00:36 Page:240  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @LNKNODE                   3-0-0/w PTR         r     1 @NODE#
     5-0-0/w PTR         r     1 @QOS                      41-0-0/w UBIN        r     1 ALTQOS
    40-0-0/w UBIN        r     1 BESTQOS                   12-0-0/w STRC(180)   r     1 EL$FECRASH
    33-0-0/w PTR         r     1 FEI$                      27-0-0/w STRC(126)   r     1 FEPST
     7-0-0/w SBIN        r     1 I                         10-0-0/w SBIN        r     1 J
    11-0-0/w SBIN        r     1 K                         17-0-0/w STRC(252)   r     1 KL_ACCTNG
    *0-0-0/w UBIN        r     1 LNKNODE                   *0-0-0/w SBIN        r     1 NODE#
    35-0-0/w PTR         r     1 OSI$                      *0-0-0/w UBIN        r     1 QOS
    34-0-0/w PTR         r     1 ROUTE$                    37-0-0/w SBIN        r     1 SVLINK
    26-0-0/w UBIN        r     1 TEMP

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 KI_FEI$$                   0-0-0/b BIT (72)    r     1 KI_LOCK
     0-0-0/w UBIN        r     1 KI_MXFE                    0-0-0/w UBIN        r     1 KI_NODES
     0-0-0/w UBIN        r     1 KI_OSIMAX#                 0-0-0/w PTR         r     1 KI_OSIROUTE$$
     0-0-0/w PTR         r     1 KI_ROUTE$$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(612)   r     1 KI$FEI
     0-0-0/w PTR         r     1 KI$FEI$(0:0)
     0-0-0/w STRC(612)   r     1 KI$OSIROUTE                0-0-0/w STRC(216)   r     1 KI$ROUTE
     0-0-0/w PTR         r     1 KI$ROUTE$(0:0)
PL6.E3A0      #004=KIN$NODECHG File=KIN$NETWORK.:E05TSI                          WED 07/30/97 00:36 Page:241  
     0-0-0/w PTR         r     1 KI_OSIROUTE$(0:0)


   Procedure KIN$NODECHG requires 366 words for executable code.
   Procedure KIN$NODECHG requires 40 words of local(AUTO) storage.
PL6.E3A0      #004=KIN$NODECHG File=KIN$NETWORK.:E05TSI                          WED 07/30/97 00:36 Page:242  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #004=KIN$NODECHG File=KIN$NETWORK.:E05TSI                          WED 07/30/97 00:36 Page:243  
          MINI XREF LISTING

ALTQOS IN PROCEDURE UPDATE_ROUTE
      6039**DCL      6044<<ASSIGN   6131>>ASSIGN   6138>>ASSIGN
BESTQOS IN PROCEDURE UPDATE_ROUTE
      6038**DCL      6043<<ASSIGN   6049>>IF       6051<<ASSIGN   6060>>IF       6064>>ASSIGN   6130>>ASSIGN
      6137>>ASSIGN
DO_ALTRET
      6013**LABEL    6016--CALLALT
EL$FECRASH
      5567**DCL      6096<>CALL     6096--CALL     6134<>CALL     6134--CALL
EL$FECRASH.FENM.ALT_QOS
      5568**DCL      6095<<ASSIGN   6131<<ASSIGN
EL$FECRASH.FENM.CRASH#
      5567**DCL      6091<<ASSIGN   6129<<ASSIGN
EL$FECRASH.FENM.DEVADDR
      5567**DCL      6089<<ASSIGN   6127<<ASSIGN
EL$FECRASH.FENM.FEP#
      5568**DCL      6088<<ASSIGN   6126<<ASSIGN
EL$FECRASH.FENM.LINK_NODE
      5568**DCL      6093<<ASSIGN   6132<<ASSIGN
EL$FECRASH.FENM.NODENAME
      5568**DCL      6090<<ASSIGN   6128<<ASSIGN
EL$FECRASH.FENM.PROBLEM
      5567**DCL      6086<<ASSIGN   6124<<ASSIGN
EL$FECRASH.FENM.QOS
      5568**DCL      6094<<ASSIGN   6130<<ASSIGN
EL$FECRASH.FENM.STATE
      5567**DCL      6087<<ASSIGN   6125<<ASSIGN
ELA$SYSLOG
      5555**DCL-ENT  6096--CALL     6134--CALL
FEI$
      5621**DCL      5641--IMP-PTR  6006<<ASSIGN   6007>>IF
FEPST
PL6.E3A0      #004=KIN$NODECHG File=KIN$NETWORK.:E05TSI                          WED 07/30/97 00:36 Page:244  
      5599**DCL      6072<>CALL     6072--CALL
FEPST.ALT_QOS
      5617**DCL      6071<<ASSIGN
FEPST.FCN
      5600**DCL      6062<<ASSIGN
FEPST.FEP
      5602**DCL      6063<<ASSIGN
FEPST.LNK_NODE
      5616**DCL      6068<<ASSIGN   6069<<ASSIGN
FEPST.PROB
      5613**DCL      6065<<ASSIGN
FEPST.QOS
      5615**DCL      6064<<ASSIGN
HFC$LOCK
       430**DCL-ENT  6003--CALL
HFC$UNLOCK
       430**DCL-ENT  6013--CALL     6021--CALL
I
      5563**DCL      6005<<DOINDEX  6006>>ASSIGN   6010>>ASSIGN   6041<<DOINDEX  6045>>ASSIGN   6063>>ASSIGN
      6082<>CALL     6084>>IF       6088>>ASSIGN   6097>>ASSIGN   6102<>CALL     6114>>IF       6121>>IF
      6126>>ASSIGN
J
      5564**DCL      6048<<DOINDEX  6049>>IF       6051>>ASSIGN   6053>>ASSIGN   6110<<DOINDEX  6111>>ASSIGN
K
      5565**DCL      6113<<DOINDEX  6114>>IF       6115>>ASSIGN
KI$FEI.BD$
      5676**DCL      5677--REDEF
KI$FEI.BDAD.WADDR
      5678**DCL      5679--REDEF
KI$FEI.FEP#
      5686**DCL      6007>>IF       6068>>ASSIGN   6084>>IF       6121>>IF       6132>>ASSIGN
KI$FEI.RCVPB
      5692**DCL      5693--REDEF
KI$FEI$
      5983**DCL      6006>>ASSIGN   6068>>ASSIGN   6084>>IF       6121>>IF       6132>>ASSIGN
KI$OSIROUTE.LINK.ACTIVE
PL6.E3A0      #004=KIN$NODECHG File=KIN$NETWORK.:E05TSI                          WED 07/30/97 00:36 Page:245  
      5954**DCL      6115<<ASSIGN
KI$OSIROUTE.LINK.FEP#
      5959**DCL      6114>>IF
KI$OSIROUTE.LNSAP.ADDRESS_N
      5924**DCL      5925--REDEF
KI$OSIROUTE.NSAP.ADDRESS_N
      5834**DCL      5835--REDEF
KI$OSIROUTE.NS_TYPE
      5935**DCL      6112>>IF
KI$ROUTE.ALT_QOS
      5730**DCL      6109<<ASSIGN   6138<<ASSIGN
KI$ROUTE.CURRENT_QOS
      5729**DCL      6010>>ASSIGN   6060>>IF       6108<<ASSIGN   6137<<ASSIGN
KI$ROUTE.FEI#
      5724**DCL      6060>>IF       6080>>IF       6084>>IF       6107<<ASSIGN   6121>>IF       6136<<ASSIGN
KI$ROUTE.LINK.QOS
      5751**DCL      6010<<ASSIGN   6049>>IF       6051>>ASSIGN
KI$ROUTE.LINK_CONNECTED
      5735**DCL      5998>>IF       5998>>IF
KI$ROUTE.NODE_NAME
      5714**DCL      6090>>ASSIGN   6128>>ASSIGN
KI$ROUTE.SEQ
      5741**DCL      6091>>ASSIGN   6092<<ASSIGN   6092>>ASSIGN   6129>>ASSIGN   6133<<ASSIGN   6133>>ASSIGN
KI$ROUTE$
      5627**DCL      5998>>IF       5998>>IF       6009>>ASSIGN   6010>>ASSIGN   6045>>ASSIGN
KIQ$LGFEDN
      5557**DCL-ENT  6099--CALL
KIS$REP_DISC
      5559**DCL-ENT  6102--CALL
KIT$REPDISC
      5556**DCL-ENT  6082--CALL
KI_FEI$$
      5988**DCL      5983--IMP-PTR  6006>>ASSIGN   6068>>ASSIGN   6084>>IF       6121>>IF       6132>>ASSIGN
KI_LOCK
      5990**DCL      6003<>CALL     6013<>CALL     6021<>CALL
KI_MXFE
PL6.E3A0      #004=KIN$NODECHG File=KIN$NETWORK.:E05TSI                          WED 07/30/97 00:36 Page:246  
      5992**DCL      6005>>DOINDEX  6048>>DOINDEX  6113>>DOINDEX
KI_NODES
      5991**DCL      6041>>DOINDEX
KI_OSIMAX#
      5994**DCL      6110>>DOINDEX
KI_OSIROUTE$
      5984**DCL      6111>>ASSIGN
KI_OSIROUTE$$
      5993**DCL      5984--IMP-PTR  6111>>ASSIGN
KI_ROUTE$$
      5989**DCL      5627--IMP-PTR  5998>>IF       5998>>IF       6009>>ASSIGN   6010>>ASSIGN   6045>>ASSIGN
KL_ACCTNG
      5572**DCL      6099<>CALL
KL_ACCTNG.DEVNM
      5576**DCL      5577--REDEF
KL_ACCTNG.FEX
      5573**DCL      6097<<ASSIGN
KL_ACCTNG.REASON
      5574**DCL      6098<<ASSIGN
KUB$WRITE
      5558**DCL-ENT  6072--CALL
LNKNODE
      5551**DCL         7--PROC     5998>>IF       6007>>IF       6010>>ASSIGN
NODE#
      5550**DCL         7--PROC     5998>>IF       6009>>ASSIGN
OSI$
      5623**DCL      5782--IMP-PTR  6111<<ASSIGN   6112>>IF       6114>>IF       6115>>ASSIGN
QOS
      5552**DCL         7--PROC     6010>>ASSIGN
ROUTE$
      5622**DCL      5713--IMP-PTR  6009<<ASSIGN   6010>>ASSIGN   6045<<ASSIGN   6049>>IF       6051>>ASSIGN
      6060>>IF       6060>>IF       6080>>IF       6084>>IF       6090>>ASSIGN   6091>>ASSIGN   6092>>ASSIGN
      6092>>ASSIGN   6107>>ASSIGN   6108>>ASSIGN   6109>>ASSIGN   6121>>IF       6128>>ASSIGN   6129>>ASSIGN
      6133>>ASSIGN   6133>>ASSIGN   6136>>ASSIGN   6137>>ASSIGN   6138>>ASSIGN
SVLINK IN PROCEDURE UPDATE_ROUTE
      6037**DCL      6042<<ASSIGN   6053<<ASSIGN   6060>>IF       6067>>IF       6068>>ASSIGN   6078>>IF
PL6.E3A0      #004=KIN$NODECHG File=KIN$NETWORK.:E05TSI                          WED 07/30/97 00:36 Page:247  
      6121>>IF       6121>>IF       6132>>ASSIGN   6136>>ASSIGN
TEMP
      5585**DCL      6096<>CALL     6134<>CALL
UPDATE_ROUTE
      6035**PROC     6016--CALL     6031--CALL

PL6.E3A0      #005=KIN$CONV_NODENAME File=KIN$NETWORK.:E05TSI                    WED 07/30/97 00:37 Page:248  
     1386        1        /*T***********************************************************/
     1387        2        /*T*                                                         */
     1388        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1389        4        /*T*                                                         */
     1390        5        /*T***********************************************************/
     1391        6
     1392        7        /*F* NAME: KIN$CONV_NODENAME
     1393        8
     1394        9        KIN$CONV_NODE returns NODE# and HOSTNODE from the route table
     1395       10        for a specified NODENAME.
     1396       11        */
     1397       12
     1398       13
     1399       14        KIN$CONV_NODENAME: PROC(NODENAME,NODE#,HOSTNODE) ALTRET;
     1400       15
     1401       16        %INCLUDE KI_MACROS_C;
     1402      624                                                /* Parameters                         */
     1403      625    1   DCL NODENAME CHAR(8);
     1404      626    1   DCL NODE# UBIN;
     1405      627    1   DCL HOSTNODE BIT(1) UNAL;
     1406      628                                                /* Auto                               */
     1407      629    1   DCL I SBIN;
     1408      630                                                /* Based                              */
     1409      631        %KI$ROUTE (STCLASS=BASED);
     1410      685    1   DCL KI$ROUTE$(0:0) PTR BASED(KI_ROUTE$$);
     1411      686                                                /* External Data                      */
     1412      687    1   DCL KI_ROUTE$$ PTR SYMREF;
     1413      688    1   DCL KI_NODES UBIN SYMREF;
     1414      689
     1415      690    2      DO I = 0 TO KI_NODES;
     1416      691    2           IF KI$ROUTE$(I)->KI$ROUTE.NODE_NAME = NODENAME
     1417      692    2             AND KI$ROUTE$(I)->KI$ROUTE.NODE_NAME ~= ' '
     1418      693    3           THEN DO;
     1419      694    3                NODE# = I;
     1420      695    3                GOTO RETURN_HOST_BIT;
     1421      696    3                END;
     1422      697    2           END;
PL6.E3A0      #005=KIN$CONV_NODENAME File=KIN$NETWORK.:E05TSI                    WED 07/30/97 00:37 Page:249  
     1423      698
     1424      699    1      ALTRETURN;
     1425      700        %EJECT;
PL6.E3A0      #005=KIN$CONV_NODENAME File=KIN$NETWORK.:E05TSI                    WED 07/30/97 00:37 Page:250  
     1426      701        /*F* NAME: KIN$CONV_NODE
     1427      702
     1428      703        KIN$CONV_NODE returns NODENAME and HOSTNODE from the route table
     1429      704        for a specified NODE#.
     1430      705        */
     1431      706
     1432      707    1   KIN$CONV_NODE: ENTRY(NODENAME,NODE#,HOSTNODE) ALTRET;
     1433      708
     1434      709    1      IF NODE# > KI_NODES
     1435      710    1      THEN ALTRETURN;
     1436      711
     1437      712    1      NODENAME = KI$ROUTE$(NODE#)->KI$ROUTE.NODE_NAME;
     1438      713    1      IF NODENAME = ' '
     1439      714    1      THEN ALTRETURN;
     1440      715
     1441      716    1   RETURN_HOST_BIT:
     1442      717    1      IF ADDR(HOSTNODE)~=ADDR(NIL)
     1443      718    1      THEN HOSTNODE = KI$ROUTE$(NODE#)->KI$ROUTE.HOST;
     1444      719    1      RETURN;
     1445      720
     1446      721        %EJECT;
PL6.E3A0      #005=KIN$CONV_NODENAME File=KIN$NETWORK.:E05TSI                    WED 07/30/97 00:37 Page:251  
     1447      722        /*F* NAME: KIN$SET_NODE
     1448      723
     1449      724        KIN$SET_NODE is called when KUB$EA has received a KL$SETNODE message
     1450      725        from the HLPCG.
     1451      726
     1452      727        The new new nodename and HOSTNODE values are stored in the specified
     1453      728        route table.
     1454      729        */
     1455      730
     1456      731    1   KIN$SET_NODE: ENTRY(NODENAME,NODE#,HOSTNODE) ALTRET;
     1457      732
     1458      733    1      IF NODE# > KI_NODES
     1459      734    1      THEN ALTRETURN;
     1460      735    1      KI$ROUTE$(NODE#)->KI$ROUTE.NODE_NAME = NODENAME;
     1461      736    1      KI$ROUTE$(NODE#)->KI$ROUTE.HOST = HOSTNODE;
     1462      737    1      RETURN;
     1463      738
     1464      739    1   END KIN$CONV_NODENAME;

PL6.E3A0      #005=KIN$CONV_NODENAME File=KIN$NETWORK.:E05TSI                    WED 07/30/97 00:37 Page:252  
--  Include file information  --

   KI_MACROS_C.:E05TOU  is referenced.
      No diagnostics issued in procedure KIN$CONV_NODENAME.

   Procedure KIN$CONV_NODENAME requires 79 words for executable code.
   Procedure KIN$CONV_NODENAME requires 8 words of local(AUTO) storage.

    No errors detected in file KIN$NETWORK.:E05TSI    .

PL6.E3A0      #005=KIN$CONV_NODENAME File=KIN$NETWORK.:E05TSI                    WED 07/30/97 00:37 Page:253  

 Object Unit name= KIN$CONV_NODENAME                          File name= KIN$NETWORK.:E05TOU
 UTS= JUL 30 '97 00:37:06.28 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none    79    117  KIN$CONV_NODENAME

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes    yes     yes      Std        3  KIN$CONV_NODENAME
     0     32          yes     yes      Std        3  KIN$CONV_NODE
     0     71          yes     yes      Std        3  KIN$SET_NODE

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
                       nStd      0 X66_AUTO_3
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AALT
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KI_ROUTE$$                            KI_NODES                              B_VECTNIL
PL6.E3A0      #005=KIN$CONV_NODENAME File=KIN$NETWORK.:E05TSI                    WED 07/30/97 00:37 Page:254  


     1386        1        /*T***********************************************************/
     1387        2        /*T*                                                         */
     1388        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
     1389        4        /*T*                                                         */
     1390        5        /*T***********************************************************/
     1391        6
     1392        7        /*F* NAME: KIN$CONV_NODENAME
     1393        8
     1394        9        KIN$CONV_NODE returns NODE# and HOSTNODE from the route table
     1395       10        for a specified NODENAME.
     1396       11        */
     1397       12
     1398       13
     1399       14        KIN$CONV_NODENAME: PROC(NODENAME,NODE#,HOSTNODE) ALTRET;

     14  0 000000   000000 700200 xent  KIN$CONV_NO* TSX0  ! X66_AUTO_3
         0 000001   000010 000003                    ZERO    8,3

     1400       15
     1401       16        %INCLUDE KI_MACROS_C;
     1402      624                                                /* Parameters                         */
     1403      625    1   DCL NODENAME CHAR(8);
     1404      626    1   DCL NODE# UBIN;
     1405      627    1   DCL HOSTNODE BIT(1) UNAL;
     1406      628                                                /* Auto                               */
     1407      629    1   DCL I SBIN;
     1408      630                                                /* Based                              */
     1409      631        %KI$ROUTE (STCLASS=BASED);
     1410      685    1   DCL KI$ROUTE$(0:0) PTR BASED(KI_ROUTE$$);
     1411      686                                                /* External Data                      */
     1412      687    1   DCL KI_ROUTE$$ PTR SYMREF;
     1413      688    1   DCL KI_NODES UBIN SYMREF;
     1414      689
     1415      690    2      DO I = 0 TO KI_NODES;

    690  0 000002   200006 450100                    STZ     I,,AUTO
PL6.E3A0      #005=KIN$CONV_NODENAME File=KIN$NETWORK.:E05TSI                    WED 07/30/97 00:37 Page:255  
         0 000003   000025 710000 0                  TRA     s:697+1

     1416      691    2           IF KI$ROUTE$(I)->KI$ROUTE.NODE_NAME = NODENAME

    691  0 000004   000000 470400 xsym               LDP0    KI_ROUTE$$
         0 000005   200006 720100                    LXL0    I,,AUTO
         0 000006   000000 471510                    LDP1    0,X0,PR0
         0 000007   200003 473500                    LDP3    @NODENAME,,AUTO
         0 000010   040100 106500                    CMPC    fill='040'O
         0 000011   100000 000010                    ADSC9   0,,PR1                   cn=0,n=8
         0 000012   300000 000010                    ADSC9   0,,PR3                   cn=0,n=8
         0 000013   000024 601000 0                  TNZ     s:697
         0 000014   040000 106500                    CMPC    fill='040'O
         0 000015   100000 000010                    ADSC9   0,,PR1                   cn=0,n=8
         0 000016   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         0 000017   000024 600000 0                  TZE     s:697

     1417      692    2             AND KI$ROUTE$(I)->KI$ROUTE.NODE_NAME ~= ' '
     1418      693    3           THEN DO;

     1419      694    3                NODE# = I;

    694  0 000020   200006 235100                    LDA     I,,AUTO
         0 000021   200004 474500                    LDP4    @NODE#,,AUTO
         0 000022   400000 755100                    STA     0,,PR4

     1420      695    3                GOTO RETURN_HOST_BIT;

    695  0 000023   000055 710000 0                  TRA     RETURN_HOST_BIT

     1421      696    3                END;
     1422      697    2           END;

    697  0 000024   200006 054100                    AOS     I,,AUTO
         0 000025   000000 236000 xsym               LDQ     KI_NODES
         0 000026   000004 604000 0                  TMI     s:691
         0 000027   200006 116100                    CMPQ    I,,AUTO
PL6.E3A0      #005=KIN$CONV_NODENAME File=KIN$NETWORK.:E05TSI                    WED 07/30/97 00:37 Page:256  
         0 000030   000004 605000 0                  TPL     s:691

     1423      698
     1424      699    1      ALTRETURN;

    699  0 000031   000000 702200 xent               TSX2  ! X66_AALT

     1425      700        %EJECT;
PL6.E3A0      #005=KIN$CONV_NODENAME File=KIN$NETWORK.:E05TSI                    WED 07/30/97 00:37 Page:257  
     1426      701        /*F* NAME: KIN$CONV_NODE
     1427      702
     1428      703        KIN$CONV_NODE returns NODENAME and HOSTNODE from the route table
     1429      704        for a specified NODE#.
     1430      705        */
     1431      706
     1432      707    1   KIN$CONV_NODE: ENTRY(NODENAME,NODE#,HOSTNODE) ALTRET;

    707  0 000032   000000 700200 xent  KIN$CONV_NO* TSX0  ! X66_AUTO_3
         0 000033   000010 000003                    ZERO    8,3

     1433      708
     1434      709    1      IF NODE# > KI_NODES

    709  0 000034   200004 470500                    LDP0    @NODE#,,AUTO
         0 000035   000000 236000 xsym               LDQ     KI_NODES
         0 000036   000000 116100                    CMPQ    0,,PR0
         0 000037   000041 603000 0                  TRC     s:712

     1435      710    1      THEN ALTRETURN;

    710  0 000040   000000 702200 xent               TSX2  ! X66_AALT

     1436      711
     1437      712    1      NODENAME = KI$ROUTE$(NODE#)->KI$ROUTE.NODE_NAME;

    712  0 000041   000000 720100                    LXL0    0,,PR0
         0 000042   000000 471400 xsym               LDP1    KI_ROUTE$$
         0 000043   100000 473510                    LDP3    0,X0,PR1
         0 000044   200003 474500                    LDP4    @NODENAME,,AUTO
         0 000045   040100 100500                    MLR     fill='040'O
         0 000046   300000 000010                    ADSC9   0,,PR3                   cn=0,n=8
         0 000047   400000 000010                    ADSC9   0,,PR4                   cn=0,n=8

     1438      713    1      IF NODENAME = ' '

    713  0 000050   040000 106500                    CMPC    fill='040'O
PL6.E3A0      #005=KIN$CONV_NODENAME File=KIN$NETWORK.:E05TSI                    WED 07/30/97 00:37 Page:258  
         0 000051   400000 000010                    ADSC9   0,,PR4                   cn=0,n=8
         0 000052   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         0 000053   000055 601000 0                  TNZ     RETURN_HOST_BIT

     1439      714    1      THEN ALTRETURN;

    714  0 000054   000000 702200 xent               TSX2  ! X66_AALT

     1440      715
     1441      716    1   RETURN_HOST_BIT:
     1442      717    1      IF ADDR(HOSTNODE)~=ADDR(NIL)

    717  0 000055   200005 236100       RETURN_HOST* LDQ     @HOSTNODE,,AUTO
         0 000056   000001 116000 xsym               CMPQ    B_VECTNIL+1
         0 000057   000070 600000 0                  TZE     s:719

     1443      718    1      THEN HOSTNODE = KI$ROUTE$(NODE#)->KI$ROUTE.HOST;

    718  0 000060   200004 470500                    LDP0    @NODE#,,AUTO
         0 000061   000000 720100                    LXL0    0,,PR0
         0 000062   000000 471400 xsym               LDP1    KI_ROUTE$$
         0 000063   100000 473510                    LDP3    0,X0,PR1
         0 000064   200005 474500                    LDP4    @HOSTNODE,,AUTO
         0 000065   003100 060500                    CSL     bolr='003'O
         0 000066   300002 600001                    BDSC    2,,PR3                   by=3,bit=0,n=1
         0 000067   400000 000001                    BDSC    0,,PR4                   by=0,bit=0,n=1

     1444      719    1      RETURN;

    719  0 000070   000000 702200 xent               TSX2  ! X66_ARET

     1445      720
     1446      721        %EJECT;
PL6.E3A0      #005=KIN$CONV_NODENAME File=KIN$NETWORK.:E05TSI                    WED 07/30/97 00:37 Page:259  
     1447      722        /*F* NAME: KIN$SET_NODE
     1448      723
     1449      724        KIN$SET_NODE is called when KUB$EA has received a KL$SETNODE message
     1450      725        from the HLPCG.
     1451      726
     1452      727        The new new nodename and HOSTNODE values are stored in the specified
     1453      728        route table.
     1454      729        */
     1455      730
     1456      731    1   KIN$SET_NODE: ENTRY(NODENAME,NODE#,HOSTNODE) ALTRET;

    731  0 000071   000000 700200 xent  KIN$SET_NODE TSX0  ! X66_AUTO_3
         0 000072   000010 000003                    ZERO    8,3

     1457      732
     1458      733    1      IF NODE# > KI_NODES

    733  0 000073   200004 470500                    LDP0    @NODE#,,AUTO
         0 000074   000000 236000 xsym               LDQ     KI_NODES
         0 000075   000000 116100                    CMPQ    0,,PR0
         0 000076   000100 603000 0                  TRC     s:735

     1459      734    1      THEN ALTRETURN;

    734  0 000077   000000 702200 xent               TSX2  ! X66_AALT

     1460      735    1      KI$ROUTE$(NODE#)->KI$ROUTE.NODE_NAME = NODENAME;

    735  0 000100   000000 720100                    LXL0    0,,PR0
         0 000101   000000 471400 xsym               LDP1    KI_ROUTE$$
         0 000102   100000 473510                    LDP3    0,X0,PR1
         0 000103   200003 474500                    LDP4    @NODENAME,,AUTO
         0 000104   040100 100500                    MLR     fill='040'O
         0 000105   400000 000010                    ADSC9   0,,PR4                   cn=0,n=8
         0 000106   300000 000010                    ADSC9   0,,PR3                   cn=0,n=8

     1461      736    1      KI$ROUTE$(NODE#)->KI$ROUTE.HOST = HOSTNODE;
PL6.E3A0      #005=KIN$CONV_NODENAME File=KIN$NETWORK.:E05TSI                    WED 07/30/97 00:37 Page:260  

    736  0 000107   000000 720100                    LXL0    0,,PR0
         0 000110   000000 471400 xsym               LDP1    KI_ROUTE$$
         0 000111   100000 473510                    LDP3    0,X0,PR1
         0 000112   200005 475500                    LDP5    @HOSTNODE,,AUTO
         0 000113   003100 060500                    CSL     bolr='003'O
         0 000114   500000 000001                    BDSC    0,,PR5                   by=0,bit=0,n=1
         0 000115   300002 600001                    BDSC    2,,PR3                   by=3,bit=0,n=1

     1462      737    1      RETURN;

    737  0 000116   000000 702200 xent               TSX2  ! X66_ARET
     1463      738
     1464      739    1   END KIN$CONV_NODENAME;

PL6.E3A0      #005=KIN$CONV_NODENAME File=KIN$NETWORK.:E05TSI                    WED 07/30/97 00:37 Page:261  
--  Include file information  --

   KI_MACROS_C.:E05TOU  is referenced.
      No diagnostics issued in procedure KIN$CONV_NODENAME.
PL6.E3A0      #005=KIN$CONV_NODENAME File=KIN$NETWORK.:E05TSI                    WED 07/30/97 00:37 Page:262  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     5-0-0/w PTR         r     1 @HOSTNODE                  4-0-0/w PTR         r     1 @NODE#
     3-0-0/w PTR         r     1 @NODENAME                 *0-0-0/b BIT         r     1 HOSTNODE
     6-0-0/w SBIN        r     1 I                         *0-0-0/w UBIN        r     1 NODE#
    *0-0-0/c CHAR(8)     r     1 NODENAME

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN        r     1 KI_NODES                   0-0-0/w PTR         r     1 KI_ROUTE$$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(216)   r     1 KI$ROUTE
     0-0-0/w PTR         r     1 KI$ROUTE$(0:0)


   Procedure KIN$CONV_NODENAME requires 79 words for executable code.
   Procedure KIN$CONV_NODENAME requires 8 words of local(AUTO) storage.

    No errors detected in file KIN$NETWORK.:E05TSI    .
PL6.E3A0      #005=KIN$CONV_NODENAME File=KIN$NETWORK.:E05TSI                    WED 07/30/97 00:37 Page:263  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #005=KIN$CONV_NODENAME File=KIN$NETWORK.:E05TSI                    WED 07/30/97 00:37 Page:264  
          MINI XREF LISTING

HOSTNODE
       627**DCL        14--PROC      707--ENTRY     717--IF        718<<ASSIGN    731--ENTRY     736>>ASSIGN
I
       629**DCL       690<<DOINDEX   691>>IF        691>>IF        694>>ASSIGN
KI$ROUTE.HOST
       650**DCL       718>>ASSIGN    736<<ASSIGN
KI$ROUTE.NODE_NAME
       633**DCL       691>>IF        691>>IF        712>>ASSIGN    735<<ASSIGN
KI$ROUTE$
       685**DCL       691>>IF        691>>IF        712>>ASSIGN    718>>ASSIGN    735>>ASSIGN    736>>ASSIGN
KI_NODES
       688**DCL       690>>DOINDEX   709>>IF        733>>IF
KI_ROUTE$$
       687**DCL       685--IMP-PTR   691>>IF        691>>IF        712>>ASSIGN    718>>ASSIGN    735>>ASSIGN
       736>>ASSIGN
NODE#
       626**DCL        14--PROC      694<<ASSIGN    707--ENTRY     709>>IF        712>>ASSIGN    718>>ASSIGN
       731--ENTRY     733>>IF        735>>ASSIGN    736>>ASSIGN
NODENAME
       625**DCL        14--PROC      691>>IF        707--ENTRY     712<<ASSIGN    713>>IF        731--ENTRY
       735>>ASSIGN
RETURN_HOST_BIT
       717**LABEL     695--GOTO
