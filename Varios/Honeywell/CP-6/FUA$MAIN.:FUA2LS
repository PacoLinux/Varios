VERSION A02

PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:1    
        1        1        /*M* FUA$MAIN - nfsd (network file system daemon (ghost). */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* PLM=3 */
        8        8        /*P*  NAME: FUA$MAIN
        9        9              Purpose:
       10       10                    The main routine for the CP-6 nfs server.
       11       11        */
       12       12        /*F*  NAME: FUA$MAIN
       13       13              Purpose:
       14       14                    The main driver routine for the CP-6 nfs server.  Reads data
       15       15                    from the appropriate sockets, validates it, and calls other
       16       16                    routines to process the data.
       17       17        */
       18       18        /*D*  NAME: FUA$MAIN
       19       19              Algorithm:
       20       20                    Open up all of the appropriate sockets.  Then go into a loop
       21       21                    reading from the sockets.  If we get data, we perform the
       22       22                    appropriate action for that socket.  We then update the "global"
       23       23                    variables (DS stuff) - so that NFSU has something to read from.
       24       24                    Reloop.  We never exit - expect to run forever.
       25       25        */
       26       26
       27       27        FUA$MAIN: PROC MAIN;
       28       28        %INCLUDE CP_6;
       29      109            %F$DCB;
       30      166        %INCLUDE CP_6_SUBS;
       31      706        %INCLUDE B$TABLES_C;
       32      814            %B$XL_UPPER;
       33      818        %INCLUDE B$JIT;
       34     1108    1   DCL B$JIT$ PTR SYMREF READONLY;
       35     1109        %INCLUDE FU_NFSSUBS_C;
       36     1204        %INCLUDE FU_NFS_M;
       37     1719
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:2    
       38     1720            %M$DCB( DCBN=M$DS, ASN=FILE, NAME='nfsd:', ACCT=':SYS', FUN=CREATE,
       39     1721                    CTG=YES, EXIST=OLDFILE, SHARE=ALL, ACS=DS8, ORG=RANDOM);
       40     1795    1   DCL B$DS8 CONSTANT SYMDEF UBIN INIT(%(11+6*512));
       41     1796    1   DCL B$DS8$ REDEF B$DS8 PTR;
       42     1797            %FU$NFSDS( NAME=DS, STCLASS="BASED(B$DS8$)");
       43     1827            %FU$NFSDS( NAME=CDS, STCLASS=CONSTANT);
       44     1857    1   DCL M$DO DCB;
       45     1858    1   DCL M$LM DCB;
       46     1859            %FPT_EXTEND( DCB=M$DS, SIZ=1, STCLASS=CONSTANT SYMDEF);
       47     1873            %FPT_XCON( STCLASS=CONSTANT, UENTRY=FUA$XCON);
       48     1887            %FPT_MONINFO( STCLASS=CONSTANT);
       49     1902            %VLR_SITEINFO;
       50     1921            %FPT_TIME( TIME=S_TSTAMP.TIME, DATE=S_TSTAMP.DATE, DEST=LOCAL);
       51     1940            %FPT_WAIT( FPTN=WAIT_5_MINS, UNITS=5, UTYPE=MIN);
       52     1954            %FPT_TIME( FPTN=FU_FPT_TIME, STCLASS=CONSTANT SYMDEF,
       53     1955                       DEST=UTS, TSTAMP=FU_TIME);
       54     1974            %FPT_WRITE( DCB=M$DO, BUF=S_BUF);
       55     2005            %FPT_ERRMSG( OUTDCB1=M$DO, BUF=S_BUF, CODE=XSL_ERRNO,
       56     2006              SOURCE=ALTRET, INCLCODE=NO, FLAGLEV=3);
       57     2033            %FPT_RELDCB (FPTN=REL_F$NETWORKS,  DCB="DCBNUM( F$NETWORKS)");
       58     2047            %FPT_RELDCB (FPTN=REL_F$PROTOCOLS, DCB="DCBNUM( F$PROTOCOLS)");
       59     2061            %FPT_RELDCB (FPTN=REL_F$SERVICES,  DCB="DCBNUM( F$SERVICES)");
       60     2075            %FPT_RELDCB (FPTN=REL_F$ROUTES,    DCB="DCBNUM( F$ROUTES)");
       61     2089    1   DCL F$NETWORKS DCB;
       62     2090    1   DCL F$PROTOCOLS DCB;
       63     2091    1   DCL F$SERVICES DCB;
       64     2092    1   DCL F$ROUTES DCB;
       65     2093
       66     2094        %INCLUDE SS_SCHED_C;
       67     2327
       68     2328        %INCLUDE XSL_SOCKET_E;
       69     2586        %INCLUDE XSL_SOCKET_M;
       70     3334            %XSL$HOSTENT;
       71     3394            %XSL_SOCKINIT( FPTN=FUA_SOCKINIT, BUFSIZE=4096, MAXSOCK=3, NWSOCKS=2,
       72     3395                           STCLASS="CONSTANT SYMDEF");
       73     3518        %INCLUDE XSL_PERR_C;
       74     3573
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:3    
       75     3574    1   DCL FUA$GETCTX ENTRY;
       76     3575    1   DCL FUA$XCON ENTRY ASYNC;
       77     3576    1   DCL FUG$GARBCOL ENTRY(1);
       78     3577    1   DCL FUM$MOUNTRQS ENTRY(1);
       79     3578    1   DCL FUN$CLOSE ENTRY;
       80     3579    1   DCL FUN$NFSRQS ENTRY(1);
       81     3580    1   DCL FUP$PMAPINIT ENTRY(1);
       82     3581    1   DCL FUP$PMAPRQS ENTRY(1);
       83     3582    1   DCL FUS$LOOKUP ENTRY(1) ALTRET;
       84     3583
       85     3584    1   DCL XSL$GETHOSTBYNAME ENTRY(2) ALTRET;
       86     3585    1   DCL XSL$HTONL ENTRY(2);
       87     3586    1   DCL XSL$NTOHL ENTRY(2);
       88     3587    1   DCL XSL$HTONS ENTRY(2);
       89     3588    1   DCL XSL$NTOHS ENTRY(2);
       90     3589    1   DCL XSL$QBIND ENTRY(4) ALTRET;
       91     3590    1   DCL XSL$QCLOSE ENTRY(2) ALTRET;
       92     3591    1   DCL XSL$QGETSOCKNAME ENTRY(4) ALTRET;
       93     3592    1   DCL XSL$QRECVFROM ENTRY(7) ALTRET;
       94     3593    1   DCL XSL$QSELECT ENTRY(6) ALTRET;
       95     3594    1   DCL XSL$QSENDTO ENTRY(7) ALTRET;
       96     3595    1   DCL XSL$QSETSOCKOPT ENTRY(6) ALTRET;
       97     3596    1   DCL XSL$QSOCKET ENTRY(4) ALTRET;
       98     3597    1   DCL XSL$SOCKINIT ENTRY(1) ALTRET;
       99     3598
      100     3599    1   DCL XSL_ERRNO SBIN SYMREF;
      101     3600    1   DCL 1 XSL_ERR REDEF XSL_ERRNO, 2 FCG BIT(18), 2 * BIT(18);
      102     3601
      103     3602    1   DCL S_BUF CHAR(256) STATIC;
      104     3603    1   DCL 1 S_TSTAMP REDEF S_BUF,
      105     3604    1         2 LEAD CHAR(7),
      106     3605    1         2 DATE CHAR(9),
      107     3606    1         2 TIME CHAR(11),
      108     3607    1         2 T REDEF TIME,
      109     3608    1           3 TIME CHAR(5),
      110     3609    1           3 TRAIL CHAR(6),
      111     3610    1         2 * CHAR(229);
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:4    
      112     3611    1   DCL SELECT_MASK(0:35) STATIC BIT(1) INIT('0'B*0);
      113     3612
      114     3613    1   DCL FU_NFSSOCKET SBIN STATIC SYMDEF INIT(-1); /* These three items ...        */
      115     3614    1   DCL FU_SOCKET(0:0) REDEF FU_NFSSOCKET SBIN;
      116     3615    1   DCL FU_MOUNTSOCKET SBIN STATIC SYMDEF INIT(-1); /* are ordered to match ...   */
      117     3616    1   DCL FU_PMAPSOCKET SBIN STATIC SYMDEF INIT(-1); /* the arrays below.           */
      118     3617    1   DCL FU_PROGNAME(0:2) UBIN CONSTANT SYMDEF INIT(%(PROG_NFS+PROG_SPREAD),
      119     3618    1     %(PROG_MOUNT+PROG_SPREAD), %(PROG_PMAP+PROG_SPREAD));
      120     3619    1   DCL FU_PROGVERS(0:2) UBIN CONSTANT SYMDEF
      121     3620    1     INIT(%VERS_NFS,%VERS_MOUNT,%VERS_PMAP);
      122     3621    1   DCL MAXPROC(0:2) UBIN CONSTANT INIT(17,5,5);
      123     3622        /*%NFSPROC_STATFS, %MNTPROC_EXPORT, %PMAPPROC_CALLIT);*/
      124     3623    1   DCL FU_PORTNUM(0:2) UBIN STATIC SYMDEF INIT(%PORT_NFS,0,%PORT_PMAP);
      125     3624    1   DCL FUP_RQSSTT UBIN SYMREF;
      126     3625        %FU$FCTX( NAME=FU_FCTX, STCLASS=CONSTANT SYMDEF);
      127     3728        %FU$UCTX( NAME=FU_UCTX, STCLASS=CONSTANT SYMDEF);
      128     3781
      129     3782    1   DCL LOGGING BIT(1) STATIC INIT('1'B);
      130     3783    1   DCL MYSYSID UBIN STATIC INIT(0);
      131     3784    1   DCL FU_CTXHD$ STATIC SYMDEF PTR INIT(ADDR(NIL));
      132     3785    1   DCL FU_MAXCTX$ STATIC SYMDEF PTR INIT(ADDR(NIL));
      133     3786    1   DCL FU_HCTX$ STATIC SYMDEF PTR INIT(ADDR(NIL));
      134     3787    1   DCL FU_FCTX$ STATIC SYMDEF PTR INIT(ADDR(NIL));
      135     3788    1   DCL FU_PROC# STATIC SYMDEF UBIN INIT(0);
      136     3789    1   DCL FU_MSGCNT STATIC SYMDEF SBIN INIT(0);
      137     3790    1   DCL FU_TIME STATIC SYMDEF UBIN INIT(0);
      138     3791    1   DCL FU_MYACCN STATIC SYMDEF CHAR(8);
      139     3792    1   DCL FU_MYUNAME STATIC SYMDEF CHAR(12);
      140     3793    1   DCL FU_TIMEZONESECS STATIC SYMDEF SBIN INIT(0);
      141     3794    1   DCL FU_OPENLIM STATIC SYMDEF UBIN INIT(0);
      142     3795
      143     3796        %EJECT;
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:5    
      144     3797        /* AUTO */
      145     3798    1   DCL CTX$ PTR;
      146     3799    1   DCL DSCR_ DSCR DALIGNED;
      147     3800    1   DCL HCTX$ PTR;
      148     3801    1   DCL I UBIN;
      149     3802    1   DCL IS REDEF I SBIN;
      150     3803    1   DCL REOPENIN_PORTS BIT(1);
      151     3804    1   DCL SELECT_RESULT(0:35) BIT(1);
      152     3805    1   DCL LASTCLOSE UBIN;
      153     3806    1   DCL T$ PTR;                             /* OK to use in calls                 */
      154     3807        /* ! RQSCTX must be the last item in auto.  GARBCOL clobbers beyond it. ! */
      155     3808        %FU$RQSCTX( NAME=RQSCTX, STCLASS=AUTO, BODYLEN="%(8192+60)");
      156     3897         /* 8192 = max data on READRQS, 60 = sizeof (READRES + REPLYHDR - CALLHDR)    */
      157     3898
      158     3899        /* Based items */
      159     3900
      160     3901    1   DCL B$UBIN UBIN BASED ALIGNED;
      161     3902    1   DCL B$PTRA(0:0) PTR BASED ALIGNED;
      162     3903    1   DCL 1 TEXTW BASED ALIGNED,
      163     3904    1         2 L UBIN,
      164     3905    1         2 LC REDEF L,
      165     3906    1           3 * BIT(27),
      166     3907    1           3 C UBIN(9) UNAL,
      167     3908    1         2 T CHAR(TEXTW.L);
      168     3909        %FU$HCTX( NAME=HCTX, STCLASS="BASED(HCTX$)");
      169     3932        %FU$UCTX( NAME=UCTX, STCLASS="BASED(RQSCTX.UCTX$)");
      170     3985
      171     3986        %EJECT;
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:6    
      172     3987    1      IF NOT B$JIT.PRIV.ACTIVE.JIT
      173     3988    2      THEN DO;
      174     3989    2         S_BUF = 'JIT privilege required to run NFSD';
      175     3990    2         CALL M$WRITE( FPT_WRITE);
      176     3991    2         CALL M$XXX;
      177     3992    2         END;
      178     3993    1      CALL M$XCON( FPT_XCON);
      179     3994    1      CALL XSL$HTONL( MYSYSID, MOD(B$JIT.LOGONTIME/8192, 65536));
      180     3995    1      HCTX$ = ADDR( NIL);
      181     3996    1      FU_MYACCN = B$JIT.ACCN;
      182     3997    1      FU_MYUNAME = B$JIT.UNAME;
      183     3998    1      CALL M$MONINFO( FPT_MONINFO);
      184     3999    1      FU_TIMEZONESECS = VLR_SITEINFO.UTC_OFFSET#/100;
      185     4000    1      B$JIT.PRIV.ACTIVE = %PR_FMSEC#;
      186     4001    2      CALL M$REW( FPT_EXTEND) WHENALTRETURN DO;
      187     4002    2   MONABRT: CALL M$ERRMSG( FPT_ERRMSG);
      188     4003    2         CALL M$XXX;
      189     4004    2         END;
      190     4005
      191     4006    1      DSCR_ = PTRDSCR( B$DS8$);
      192     4007        /*N* put code in here to figure out if we"re a slave */
      193     4008    1      DS = CDS;
      194     4009    1      FU_MAXCTX$ = PINCRW( B$DS8$, DBOUND( DSCR_) / 4 + 1);
      195     4010    1      CALL TSTAMP;
      196     4011    1      DS.P.SYSID( FU_PROC#) = B$JIT.SYSID;
      197     4012    1      CALL M$TIME( FU_FPT_TIME);
      198     4013    1      LASTCLOSE = FU_TIME;
      199     4014    1      REOPENIN_PORTS = %NO#;
      200     4015    1      RQSCTX = '0'B;
      201     4016    1      CALL XSL$SOCKINIT( FUA_SOCKINIT) ALTRET( MONERR);
      202     4017
      203     4018        /* First open up the ports. */
      204     4019    1   OPEN_PORTS:;
      205     4020    1      SELECT_MASK = '0'B;
      206     4021    1      RQSCTX.FROMADDR.SA_FAMILY = %XSL_AF_INET;
      207     4022    2      DO I = 0 TO 2;
      208     4023    2         CALL XSL$HTONS( RQSCTX.FROMADDR.S_PORT, FU_PORTNUM( I));
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:7    
      209     4024    2         CALL XSL$QSOCKET( FU_SOCKET( I), %XSL_AF_INET, %XSL_SOCK_DGRAM,
      210     4025    2           %XSL_AF_INET) ALTRET (NO_SOCKET);
      211     4026    2         CALL XSL$QSETSOCKOPT( T$, FU_SOCKET( I), %XSL_SOL_SOCKET,
      212     4027    2           %XSL_SO_REUSEADDR, 262144, 2) ALTRET (NO_SETSOCKOPT);
      213     4028    2         IF I = 2 THEN B$JIT.PRIV.ACTIVE = %PR_MSYS#;
      214     4029    3         CALL XSL$QBIND( T$, FU_SOCKET( I), RQSCTX.FROMADDR, 12) WHENALTRETURN DO;
      215     4030    3            IF I<2 THEN GOTO NO_BIND;
      216     4031    3            RQSCTX.FROMADDR.S_PORT = 0;
      217     4032    3            CALL XSL$QBIND( T$, FU_SOCKET( I), RQSCTX.FROMADDR, 12) ALTRET( NO_BIND);
      218     4033    3            CALL FUP$PMAPINIT( RQSCTX);
      219     4034    3            CALL LOG;
      220     4035    3            END;
      221     4036
      222     4037    2         B$JIT.PRIV.ACTIVE = %(PR_FMSEC# | PR_FMDIAG#);
      223     4038    2         SELECT_MASK( FU_SOCKET( I)) = '1'B;
      224     4039    3         IF FU_PORTNUM( I) = 0 THEN DO;    /* Dynamic port - get the port number */
      225     4040    3            RQSCTX.LEN = 8;
      226     4041    3            CALL XSL$QGETSOCKNAME(
      227     4042    3              RQSCTX.LEN, FU_SOCKET( 1), RQSCTX.FROMADDR, RQSCTX.LEN);
      228     4043    3            CALL XSL$NTOHS( FU_PORTNUM( 1), RQSCTX.FROMADDR.S_PORT);
      229     4044    3            END;
      230     4045
      231     4046    3         DO WHILE '0'B;
      232     4047    3   NO_BIND: ;
      233     4048    3   NO_SETSOCKOPT:;
      234     4049    3   NO_SOCKET: ;
      235     4050    4            IF XSL_ERRNO > 0 THEN DO;
      236     4051    4               XSL_ERRNO = XSL_ERRNO*8;
      237     4052    4               XSL_ERR.FCG = '302314'O;
      238     4053    4               FPT_ERRMSG.V.SOURCE# = 0;
      239     4054    4               END;
      240     4055    3   MONERR:  ;
      241     4056    3            CALL M$ERRMSG( FPT_ERRMSG);
      242     4057    3            FPT_ERRMSG.V.SOURCE# = %SOURCE_ALTRET#;
      243     4058    3            END;
      244     4059    2         END;
      245     4060        /* CALL M$RELDCB( REL_F$NETWORKS);
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:8    
      246     4061           CALL M$RELDCB( REL_F$PROTOCOLS);
      247     4062           CALL M$RELDCB( REL_F$SERVICES);
      248     4063           CALL M$RELDCB( REL_F$ROUTES);    */
      249     4064
      250     4065    1      DS.MOUNTPORT = FU_PORTNUM( 1);
      251     4066
      252     4067
      253     4068        %EJECT;
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:9    
      254     4069    1   DO_SELECT:;
      255     4070    1      FU_OPENLIM = DS.OPENLIM * 25;        /* convert to UTS tics (after '93)    */
      256     4071    1      SELECT_RESULT = SELECT_MASK;
      257     4072    1      IF SELECT_RESULT = '0'B THEN GOTO REOPEN_PORTS;
      258     4073    1      IF LASTCLOSE > FU_TIME THEN I = 32767; /* Big wait if we closed all        */
      259     4074    1      ELSE I = DS.OPENLIM;
      260     4075    1      IF FUP_RQSSTT > 0 THEN I = 5;   /* Short wait if registering with pmap     */
      261     4076    1      CALL XSL$QSELECT( I, 3, SELECT_RESULT, , , I);
      262     4077    1      IF (IS<=0 AND SELECT_RESULT)         /* network must have gone away        */
      263     4078    2      THEN DO;
      264     4079    2   REOPEN_PORTS:
      265     4080    2         IF REOPENIN_PORTS THEN CALL M$WAIT( WAIT_5_MINS);
      266     4081    2         REOPENIN_PORTS = %YES#;
      267     4082    2         CALL XSL$QCLOSE( T$, FU_SOCKET( 0));
      268     4083    2         CALL XSL$QCLOSE( T$, FU_SOCKET( 1));
      269     4084    2         CALL XSL$QCLOSE( T$, FU_SOCKET( 2));
      270     4085    2         GOTO OPEN_PORTS;
      271     4086    2         END;
      272     4087
      273     4088    1      REOPENIN_PORTS = %NO#;
      274     4089
      275     4090    2      IF NOT SELECT_RESULT THEN DO;
      276     4091    2         CALL M$TIME( FU_FPT_TIME);
      277     4092    2         IF FUP_RQSSTT = 0 THEN EXIT;
      278     4093    2         RQSCTX.LEN = 0;                   /* Timeout - retry the last request   */
      279     4094    2         RQSCTX.PROC# = 0;
      280     4095    2         RQSCTX.CALLHDR.TYPE = %TYPE_REPLY;
      281     4096    2         CALL FUP$PMAPRQS( RQSCTX);
      282     4097    2         CALL LOG;
      283     4098    2         END;
      284     4099
      285     4100    2      CALL GETREQUEST( FU_NFSSOCKET) WHENRETURN DO;
      286     4101    2         CALL FUN$NFSRQS( RQSCTX);
      287     4102    2         CALL LOG;
      288     4103    2         END;
      289     4104
      290     4105    2      CALL GETREQUEST( FU_PMAPSOCKET) WHENRETURN DO;
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:10   
      291     4106    2         CALL FUP$PMAPRQS( RQSCTX);
      292     4107    2         CALL LOG;
      293     4108    2         IF FU_PMAPSOCKET <0 THEN SELECT_MASK( -FU_PMAPSOCKET) = '0'B;
      294     4109    2         END;
      295     4110
      296     4111    2      CALL GETREQUEST( FU_MOUNTSOCKET) WHENRETURN DO;
      297     4112    2         CALL FUM$MOUNTRQS( RQSCTX);
      298     4113    2         CALL LOG;
      299     4114    2         END;
      300     4115
      301     4116             /* request(s) done, update DS variables, and cleanup memory if needed    */
      302     4117    1      DS.HCTX$ = FU_HCTX$;
      303     4118    1      DS.FCTX$ = FU_FCTX$;
      304     4119    1      DS.P.PMMECNT( FU_PROC#) = B$JIT.CALCNT;
      305     4120    1      DS.P.DISKIOS( FU_PROC#) = B$JIT.ACCESS.PACKS;
      306     4121    1      DS.P.STIME( FU_PROC#) = B$JIT.TUSVT + B$JIT.TPSVT;
      307     4122    1      DS.P.XTIME( FU_PROC#) = B$JIT.TUEXT + B$JIT.TPEXT;
      308     4123    2      IF FU_TIME - LASTCLOSE > DS.OPENLIM THEN DO;
      309     4124    2         CALL FUN$CLOSE;
      310     4125    2         LASTCLOSE = FU_TIME;
      311     4126    2         IF NOT SELECT_RESULT THEN LASTCLOSE = LASTCLOSE + 1;
      312     4127    2         END;
      313     4128    1      IF DS.HCNT+DS.FCNT+DS.UCNT+DS.MCNT >= DS.CTXLIM THEN GOTO PURGE;
      314     4129    1      I = 0;
      315     4130    2      DO UNTIL DS.P.SYSID( I) = 0;
      316     4131    3         IF DS.P.FCNT( I) >= DS.DCBLIM OR DS.P.UCNT( I) >= DS.BUFLIM THEN DO;
      317     4132    3   PURGE:   CALL FUG$GARBCOL( RQSCTX);
      318     4133    3            FU_FCTX$ = DS.FCTX$;
      319     4134    3            FU_HCTX$ = DS.HCTX$;
      320     4135    3            RQSCTX = '0'B;
      321     4136    3            GOTO DO_SELECT;
      322     4137    3            END;
      323     4138    2         I = I + 1;
      324     4139    2         END;
      325     4140    1      GOTO DO_SELECT;
      326     4141        %EJECT;
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:11   
      327     4142        /*I*  NAME:    GETREQUEST
      328     4143              Purpose: To check that the input from requested socket is available, and
      329     4144                       is valid as far as we can tell.
      330     4145              Inputs:  SOCK - the socket to check on data from, and read from.
      331     4146              Algorithm: Read in the data (if available), and then do security checking
      332     4147                       to validate that this request is allowed.  If it is, then we
      333     4148                       want to check if the request looks valid.  If it is, then we do
      334     4149                       some initial setup so that the rest of NFS will be able to use
      335     4150                       this data.
      336     4151        */
      337     4152    1   GETREQUEST: PROC( SOCK) ALTRET;
      338     4153    2   DCL SOCK SBIN;
      339     4154
      340     4155    2      IF SOCK<0 THEN GOTO RETALT;
      341     4156    2      IF NOT SELECT_RESULT( SOCK) THEN GOTO RETALT;
      342     4157
      343     4158    2      I = SIZEC( RQSCTX.FROMADDR);
      344     4159    2      CALL XSL$QRECVFROM( RQSCTX.LEN, SOCK, RQSCTX.CALLHDR,
      345     4160    2        8192, 0, RQSCTX.FROMADDR, I) ALTRET( RETALT);
      346     4161
      347     4162                                      /* Got the message, check it for RPC validity   */
      348     4163    2      FU_MSGCNT = FU_MSGCNT + 1;
      349     4164    2      CALL M$TIME( FU_FPT_TIME);
      350     4165    2      DS.BYTESIN = DS.BYTESIN + RQSCTX.LEN;
      351     4166    2      CALL LOG;
      352     4167    2      DS.MSGCNT = FU_MSGCNT;     /* delayed update so LOG can detect incoming    */
      353     4168    2      HCTX$ = ADDR( NIL);
      354     4169    2      RQSCTX.PROC# = 0;     /* Make sure program can tell replies from calls     */
      355     4170    2      IF RQSCTX.CALLHDR.TYPE ~= %TYPE_CALL THEN RETURN; /* Let program decide    */
      356     4171    2      RQSCTX.CALLHDR.TYPE = %TYPE_REPLY;
      357     4172    3      IF RQSCTX.CALLHDR.RPCVERS ~= %VERS_RPC THEN DO; /* unexpected version      */
      358     4173    3         RQSCTX.REPLYHDR.REJECT_STAT = %RPC_MISMATCH;
      359     4174    3         RQSCTX.REPLYHDR.VERS_LOW = %VERS_RPC;
      360     4175    3         RQSCTX.REPLYHDR.VERS_HIGH = %VERS_RPC;
      361     4176    3         RQSCTX.LEN = 24;
      362     4177    3         GOTO DENY;
      363     4178    3         END;
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:12   
      364     4179
      365     4180    3      DO CASE( RQSCTX.CALLHDR.AUTH_CRED.FLAVOR);
      366     4181    3       CASE( %AUTH_SHORT);
      367     4182    3         I = RQSCTX.CALLHDR.AUTH_CRED.HID.HCTX;
      368     4183    3         CALL XSL$NTOHL( I, I);
      369     4184    3         HCTX$ = PINCRW( B$DS8$, I*4);
      370     4185    3         RQSCTX.BODY$ = ADDR( RQSCTX.BODY);
      371     4186    3         IF RQSCTX.CALLHDR.AUTH_CRED.LEN = 8
      372     4187    3           AND RQSCTX.CALLHDR.AUTH_VERF.FLAVOR = %AUTH_NULL
      373     4188    3           AND RQSCTX.CALLHDR.AUTH_VERF.LEN = 0
      374     4189    3           AND RQSCTX.CALLHDR.AUTH_CRED.HID.SYSID = MYSYSID
      375     4190    3           AND HCTX$ < FU_MAXCTX$
      376     4191    3           AND HCTX.S_ADDR = RQSCTX.FROMADDR.S_ADDR
      377     4192    3         THEN EXIT;                        /* expected header                    */
      378     4193    3         IF RQSCTX.CALLHDR.AUTH_CRED.HID.SYSID ~= MYSYSID
      379     4194    3         THEN RQSCTX.REPLYHDR.AUTH_STAT = %AUTH_REJECTEDCRED;
      380     4195    3         ELSE RQSCTX.REPLYHDR.AUTH_STAT = %AUTH_BADCRED;
      381     4196    3         GOTO AUTH_ERROR;
      382     4197
      383     4198    3       CASE( %AUTH_NULL);
      384     4199    3         IF ADDR( SOCK) ~= ADDR( FU_PMAPSOCKET) AND RQSCTX.CALLHDR.PROC# ~= 0
      385     4200    3         THEN GOTO AUTH_UNIX;
      386     4201                                           /* Ensure that both auth's are all zero    */
      387     4202    3         IF RQSCTX.CALLHDR.AUTH_CRED THEN GOTO TOO_WEAK;
      388     4203    3         RQSCTX.BODY$ = ADDR( RQSCTX.CALLHDR.AUTH_VERF);
      389     4204    3         GOTO PROGCHK;
      390     4205
      391     4206    3       CASE( %AUTH_UNIX);                  /* unix credential                    */
      392     4207    3   AUTH_UNIX:
      393     4208    3         T$ = PINCRC( ADDR(RQSCTX.CALLHDR.AUTH_UNIX.STAMP),
      394     4209    3           RQSCTX.CALLHDR.AUTH_UNIX.LEN);
      395     4210    3         IF T$ -> B$UBIN ~= %AUTH_NULL     /* Check AUTH_VERF for validity       */
      396     4211    3           OR PINCRW( T$, 1) -> B$UBIN ~= 0 THEN GOTO TOO_WEAK;
      397     4212    3         RQSCTX.BODY$ = PINCRW(T$,2);
      398     4213    3         HCTX$ = FU_HCTX$;
      399     4214    4         DO WHILE HCTX$ ~= ADDR(NIL);      /* then verify the hostname           */
      400     4215    4            IF HCTX.NAME.T = ADDR( RQSCTX.CALLHDR.AUTH_UNIX.NAME) -> TEXTW.T
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:13   
      401     4216    4              AND HCTX.S_ADDR = RQSCTX.FROMADDR.S_ADDR
      402     4217    4            THEN EXIT;
      403     4218    4            HCTX$ = HCTX.LNK$;
      404     4219    4            END;
      405     4220    4         IF HCTX$ = ADDR( NIL) THEN DO; /* current host not found in HCTX list   */
      406     4221    4            CALL XSL$GETHOSTBYNAME( T$, ADDR(RQSCTX.CALLHDR.AUTH_UNIX.NAME)->TEXTW.LC.C
              4221                     );
      407     4222    4            IF T$ = ADDR(NIL) THEN GOTO TOO_WEAK;
      408     4223    4            T$ = T$->XSL$HOSTENT.H_ADDR_LIST$;
      409     4224    4            IF T$->B$PTRA(0)->B$UBIN ~= RQSCTX.FROMADDR.S_ADDR
      410     4225    4            THEN IF T$->B$PTRA(1) = ADDR( NIL) THEN GOTO TOO_WEAK;
      411     4226    4               ELSE IF T$->B$PTRA(1)->B$UBIN ~= RQSCTX.FROMADDR.S_ADDR
      412     4227    4                  THEN IF T$->B$PTRA(2) = ADDR( NIL) THEN GOTO TOO_WEAK;
      413     4228    4                     ELSE IF T$->B$PTRA(2)->B$UBIN ~= RQSCTX.FROMADDR.S_ADDR
      414     4229    4                        THEN GOTO TOO_WEAK;
      415     4230    4            IF FU_CTXHD$ = ADDR( NIL) THEN CALL FUA$GETCTX;
      416     4231    4            DS.HCNT = DS.HCNT + 1;         /* Get a new HCTX block               */
      417     4232    4            HCTX$ = FU_CTXHD$;
      418     4233    4            FU_CTXHD$ = HCTX.LNK$;
      419     4234    4            HCTX.NAME.L = 0;
      420     4235    4            HCTX = '0'B;
      421     4236    4            HCTX.LNK$ = FU_HCTX$;
      422     4237    4            FU_HCTX$ = HCTX$;
      423     4238    4            HCTX.UCTX$ = ADDR( NIL);
      424     4239    4            HCTX.S_ADDR = RQSCTX.FROMADDR.S_ADDR;
      425     4240    4            HCTX.NAME.L = ADDR(RQSCTX.CALLHDR.AUTH_UNIX.NAME)->TEXTW.L;
      426     4241    4            HCTX.NAME.T = ADDR(RQSCTX.CALLHDR.AUTH_UNIX.NAME)->TEXTW.T;
      427     4242    4            END;
      428     4243
      429     4244                                           /* now rebuild AUTH_CRED in short form     */
      430     4245    3         T$ = PINCRW( ADDR(RQSCTX.CALLHDR.AUTH_UNIX.NAME),
      431     4246    3           SIZEW( ADDR(RQSCTX.CALLHDR.AUTH_UNIX.NAME)->TEXTW));
      432     4247    3         IF (T$-> B$UBIN > BITBIN('377377'O)
      433     4248    3           AND T$-> B$UBIN < BITBIN('377377377376'O))
      434     4249    3           OR (PINCRW( T$,1)-> B$UBIN > BITBIN('377377'O)
      435     4250    3           AND PINCRW( T$,1)-> B$UBIN < BITBIN('377377377376'O))
      436     4251    3         THEN GOTO TOO_WEAK;               /* We don't support UID or GID > 64K  */
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:14   
      437     4252    3         RQSCTX.CALLHDR.AUTH_CRED.U.UID = T$ -> B$UBIN;
      438     4253    3         RQSCTX.CALLHDR.AUTH_CRED.U.GID = PINCRW( T$, 1)-> B$UBIN;
      439     4254    3         RQSCTX.CALLHDR.AUTH_CRED.LEN = 8;
      440     4255    3         RQSCTX.CALLHDR.AUTH_CRED.FLAVOR = %AUTH_SHORT;
      441     4256    3         RQSCTX.CALLHDR.AUTH_CRED.HID.SYSID = MYSYSID;
      442     4257    3         CALL XSL$HTONL (I, POFFW( HCTX$, B$DS8$) / 4);
      443     4258    3         RQSCTX.CALLHDR.AUTH_CRED.HID.HCTX = I;
      444     4259
      445     4260    3       CASE( ELSE);
      446     4261    3         GOTO TOO_WEAK;
      447     4262
      448     4263    3       END;                      /* do case (RQSCTX.CALLHDR.AUTH_CRED.FLAVOR)    */
      449     4264
      450     4265    2      HCTX.MSGCNT = HCTX.MSGCNT + 1;
      451     4266    2      HCTX.BYTESIN = HCTX.BYTESIN + RQSCTX.LEN;
      452     4267    2      RQSCTX.UCTX$ = HCTX.UCTX$;
      453     4268    3      DO WHILE RQSCTX.UCTX$ ~= ADDR( NIL); /* look for a UCTX for this user      */
      454     4269    3         IF UCTX.USER.UID = RQSCTX.CALLHDR.AUTH_CRED.U.UID
      455     4270    3           AND UCTX.USER.GID = RQSCTX.CALLHDR.AUTH_CRED.U.GID THEN EXIT;
      456     4271    3         RQSCTX.UCTX$ = UCTX.HLNK$;
      457     4272    3         END;
      458     4273
      459     4274    3      IF RQSCTX.UCTX$ = ADDR( NIL) THEN DO; /* we need a new UCTX block          */
      460     4275    3         IF FU_CTXHD$ = ADDR( NIL) THEN CALL FUA$GETCTX;
      461     4276    3         DS.UCNT = DS.UCNT + 1;
      462     4277    3         RQSCTX.UCTX$ = FU_CTXHD$;
      463     4278    3         FU_CTXHD$ = UCTX.HLNK$;
      464     4279    3         UCTX = FU_UCTX;
      465     4280    3         UCTX.HCTX$ = HCTX$;
      466     4281    3         UCTX.HLNK$ = HCTX.UCTX$;
      467     4282    3         HCTX.UCTX$ = RQSCTX.UCTX$;
      468     4283    3         UCTX.USER.UID = RQSCTX.CALLHDR.AUTH_CRED.U.UID;
      469     4284    3         UCTX.USER.GID = RQSCTX.CALLHDR.AUTH_CRED.U.GID;
      470     4285    3         UCTX.FCTX$ = ADDR( NIL);
      471     4286    3         UCTX.FLNK$ = ADDR( NIL);
      472     4287    3         CALL FUS$LOOKUP( UCTX) ALTRET( TOO_WEAK);
      473     4288    3         END;
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:15   
      474     4289    2      ELSE IF UCTX.USER.REJECT THEN GOTO TOO_WEAK;
      475     4290
      476     4291    3      DO I = 0 TO SIZEW( HCTX.XIDS)-1;     /* see if we're retransmitting msg.   */
      477     4292    3         IF RQSCTX.CALLHDR.XID = HCTX.XIDS( I)
      478     4293    3         THEN RQSCTX.CALLHDR.REXMIT.F = '1'B;
      479     4294    3         END;
      480     4295    3      IF NOT RQSCTX.CALLHDR.REXMIT.F THEN DO;
      481     4296    3         HCTX.XIDS( HCTX.XIDX) = RQSCTX.CALLHDR.XID;
      482     4297    3         HCTX.XIDX = MOD( HCTX.XIDX+1, SIZEW( HCTX.XIDS));
      483     4298    3         END;
      484     4299    2      ELSE HCTX.REXMITS = HCTX.REXMITS + 1;
      485     4300
      486     4301    2   PROGCHK: ;
      487     4302    2      I = POFFW( ADDR(SOCK), ADDR( FU_NFSSOCKET));
      488     4303    3      IF RQSCTX.CALLHDR.PROG# ~= FU_PROGNAME( I) THEN DO;
      489     4304    3         RQSCTX.REPLYHDR.ACCEPT_STAT = %PROG_UNAVAIL;
      490     4305    3         RQSCTX.LEN = 32;
      491     4306    3         END;
      492     4307    3      ELSE IF RQSCTX.CALLHDR.VERS# ~= FU_PROGVERS( I) THEN DO;
      493     4308    3            RQSCTX.REPLYHDR.ACCEPT_STAT = %PROG_MISMATCH;
      494     4309    3            RQSCTX.REPLYHDR.PVERS_LOW = FU_PROGVERS( I);
      495     4310    3            RQSCTX.REPLYHDR.PVERS_HIGH = FU_PROGVERS( I);
      496     4311    3            RQSCTX.LEN = 40;
      497     4312    3            END;
      498     4313    3         ELSE IF RQSCTX.CALLHDR.PROC# > MAXPROC( I) THEN DO;
      499     4314    3               RQSCTX.REPLYHDR.ACCEPT_STAT = %PROC_UNAVAIL;
      500     4315    3               RQSCTX.LEN = 32;
      501     4316    3               END;
      502     4317    3            ELSE DO;
      503     4318    3               RQSCTX.REPLYHDR.ACCEPT_STAT = %SUCCESS;
      504     4319    3               RQSCTX.PROC# = RQSCTX.CALLHDR.PROC#;
      505     4320    3               IF RQSCTX.PROC# = 0
      506     4321    3               THEN RQSCTX.LEN = 32;
      507     4322    3               ELSE RQSCTX.LEN = RQSCTX.LEN - POFFC( RQSCTX.BODY$, ADDR( RQSCTX.CALLHDR
              4322                        ));
      508     4323    3               END;
      509     4324    2      RQSCTX.REPLYHDR.AUTH_VERF_FLAVOR = %AUTH_SHORT;
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:16   
      510     4325    2      RQSCTX.REPLYHDR.AUTH_VERF_LEN = 8;
      511     4326    2      RQSCTX.REPLYHDR.AUTH_VERF_U = RQSCTX.CALLHDR.AUTH_CRED.U;
      512     4327    2      RQSCTX.REPLYHDR.AUTH_VERF_HID = RQSCTX.CALLHDR.AUTH_CRED.HID;
      513     4328    2      RQSCTX.REPLYHDR.REPLY_STAT = %MSG_ACCEPTED;
      514     4329    2      IF RQSCTX.REPLYHDR.ACCEPT_STAT = %SUCCESS AND RQSCTX.PROC# ~= 0 THEN RETURN;
      515     4330    2      GOTO REPLY;
      516     4331
      517     4332    2   TOO_WEAK:
      518     4333    2      RQSCTX.REPLYHDR.AUTH_STAT = %AUTH_TOOWEAK;
      519     4334    2   AUTH_ERROR:
      520     4335    2      RQSCTX.REPLYHDR.REJECT_STAT = %AUTH_ERROR;
      521     4336    2      RQSCTX.LEN = 20;
      522     4337    2   DENY:
      523     4338    2      RQSCTX.REPLYHDR.REPLY_STAT = %MSG_DENIED;
      524     4339    2   REPLY:
      525     4340    2      CALL XSL$QSENDTO( I, SOCK, RQSCTX.REPLYHDR, RQSCTX.LEN, 0,
      526     4341    2        RQSCTX.FROMADDR, 8);
      527     4342    2      CALL LOG;
      528     4343    2      IF HCTX$ ~= ADDR( NIL) THEN HCTX.BYTESOUT = HCTX.BYTESOUT + RQSCTX.LEN;
      529     4344    2   RETALT:
      530     4345    2      ALTRETURN;
      531     4346
      532     4347    2   END GETREQUEST;
      533     4348
      534     4349        %EJECT;
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:17   
      535     4350        /*I*  NAME:    LOG
      536     4351              Purpose: To log an incoming event/message - update the byte/message
      537     4352                       counters, and if logging (debugging) set, then we write out the
      538     4353                       message to the file !SET to F$LOG.
      539     4354        */
      540     4355    1   LOG: PROC;
      541     4356        %M$DCB( DCBN=F$LOG, RES='CR', FUN=CREATE, CTG=YES);
      542     4430        %FPT_WRITE( FPTN=WRITELOG, DCB=F$LOG);
      543     4461    2   DCL BUF CHAR(RQSCTX.LEN) BASED;
      544     4462    2   DCL NETADDR CHAR(8) BASED;
      545     4463    2   DCL SBASED SBIN BASED;
      546     4464
      547     4465    3      IF DS.MSGCNT = FU_MSGCNT THEN DO;
      548     4466    3         DS.BYTESOUT = DS.BYTESOUT + RQSCTX.LEN;
      549     4467    3         DS.P.BYTESOUT( FU_PROC#) = DS.P.BYTESOUT( FU_PROC#) + RQSCTX.LEN;
      550     4468    3         DS.P.MSGCNT( FU_PROC#) = DS.P.MSGCNT( FU_PROC#) + 1;
      551     4469    3         IF HCTX$ ~= ADDR( NIL) THEN HCTX.BYTESOUT = HCTX.BYTESOUT + RQSCTX.LEN;
      552     4470    3         END;
      553     4471
      554     4472    3      IF LOGGING AND ADDR( RQSCTX.LEN)-> SBASED> 0 THEN DO;
      555     4473    3         WRITELOG.V.DVBYTE.CONT# = '1'B;   /* prefix with S_PORT & S_ADDR        */
      556     4474    3         WRITELOG.BUF_ = VECTOR( ADDR( RQSCTX.FROMADDR.S_PORT)-> NETADDR);
      557     4475    4         CALL M$WRITE( WRITELOG) WHENALTRETURN DO; END;
      558     4476    3         WRITELOG.V.DVBYTE.CONT# = '0'B;
      559     4477
      560     4478    3         WRITELOG.BUF_ = VECTOR( ADDR( RQSCTX.CALLHDR)-> BUF);
      561     4479    3   LOGIT: ;
      562     4480    4         CALL M$WRITE( WRITELOG) WHENALTRETURN DO;
      563     4481    4            LOGGING = '0'B;
      564     4482    4            END;
      565     4483    3         END;
      566     4484    2      RETURN;
      567     4485
      568     4486        /*I*  NAME:    LOGDO
      569     4487              Purpose: To write out the message just written to M$DO to F$LOG if
      570     4488                       logging is on.
      571     4489        */
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:18   
      572     4490    2   LOGDO: ENTRY;
      573     4491    2      WRITELOG.BUF_ = FPT_WRITE.BUF_;
      574     4492    2      IF LOGGING THEN GOTO LOGIT;
      575     4493    2   END LOG;
      576     4494
      577     4495        %EJECT;
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:19   
      578     4496        /*I*  NAME:    TSTAMP
      579     4497              Purpose: To print out the initial NFS header plus time to M$DO.
      580     4498        */
      581     4499    1   TSTAMP: PROC;
      582     4500    2      S_BUF = ' -*-*-';
      583     4501    2      CALL M$TIME( FPT_TIME);
      584     4502    2      S_TSTAMP.T.TRAIL = ' -*-*-';
      585     4503    2      FPT_WRITE.BUF_.BOUND = 26;
      586     4504    2      CALL M$WRITE( FPT_WRITE);
      587     4505    2      CALL LOGDO;
      588     4506    2   END TSTAMP;
      589     4507
      590     4508    1   END FUA$MAIN;
      591     4509        %EOD;

PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:20   
--  Include file information  --

   XSL_PERR_C.:LIBRARY  is referenced.
   XSL_SOCKET_M.:LIBRARY  is referenced.
   XSL_SOCKET_E.:LIBRARY  is referenced.
   SS_SCHED_C.:LIBRARY  is referenced.
   FU_NFS_M.:FUA2TOU  is referenced.
   FU_NFSSUBS_C.:FUA2TOU  is referenced.
   B$JIT.:LIBRARY  cannot be made into a system file and is referenced.
   B$TABLES_C.:LIBRARY  cannot be made into a system file and is referenced.
   CP_6_SUBS.:LIBRARY  is referenced.
   CP_6.:LIBRARY  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure FUA$MAIN.

   Procedure FUA$MAIN requires 1013 words for executable code.
   Procedure FUA$MAIN requires 2110 words of local(AUTO) storage.

PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:21   

 Object Unit name= FUA$MAIN                                   File name= FUA$MAIN.:FUA2TOU
 UTS= NOV 21 '97 11:31:21.80 FRI                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   DCB   even  none    98    142  M$DS
    2  RoData even  UTS    277    425  FUA$MAIN
    3   DCB   even  none     0      0  M$DO
    4   DCB   even  none     0      0  M$LM
    5   Data  even  none   234    352  FUA$MAIN
    6   DCB   even  none     0      0  F$NETWORKS
    7   DCB   even  none     0      0  F$PROTOCOLS
    8   DCB   even  none     0      0  F$SERVICES
    9   DCB   even  none     0      0  F$ROUTES
   10   DCB   even  none    98    142  F$LOG
   11   Proc  even  none  1013   1765  FUA$MAIN
   12  RoData even  none    24     30  FUA$MAIN

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
    11      0   yes            yes      Main       0  FUA$MAIN
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:22   

  ****  Data defs  ****

 Sect OctLoc  Name                           Sect OctLoc  Name
    2      0  B$DS8                              2    204  FPT_EXTEND
    2    232  FU_FPT_TIME                        2    246  FUA_SOCKINIT
    5    307  FU_NFSSOCKET                       5    310  FU_MOUNTSOCKET
    5    311  FU_PMAPSOCKET                      2    254  FU_PROGNAME
    2    257  FU_PROGVERS                        5    312  FU_PORTNUM
    2    265  FU_FCTX                            2    343  FU_UCTX
    5    317  FU_CTXHD$                          5    320  FU_MAXCTX$
    5    321  FU_HCTX$                           5    322  FU_FCTX$
    5    323  FU_PROC#                           5    324  FU_MSGCNT
    5    325  FU_TIME                            5    326  FU_MYACCN
    5    330  FU_MYUNAME                         5    333  FU_TIMEZONESECS
    5    334  FU_OPENLIM

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes          ~proc      0 B_POINTER
         yes          Async      0 FUA$XCON
         yes           Std       2 XSL$NTOHS
         yes           Std       1 FUM$MOUNTRQS
         yes           Std       2 XSL$HTONS
 yes     yes           Std       4 XSL$QSOCKET
 yes     yes           Std       2 XSL$QCLOSE
         yes           Std       1 FUG$GARBCOL
 yes     yes           Std       6 XSL$QSELECT
         yes           Std       1 FUN$NFSRQS
         yes           Std       2 XSL$HTONL
 yes     yes           Std       4 XSL$QGETSOCKNAME
         yes           Std       0 FUN$CLOSE
         yes           Std       1 FUP$PMAPINIT
 yes     yes           Std       1 XSL$SOCKINIT
 yes     yes           Std       6 XSL$QSETSOCKOPT
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:23   
 yes     yes           Std       4 XSL$QBIND
         yes           Std       1 FUP$PMAPRQS
 yes     yes           Std       7 XSL$QRECVFROM
 yes     yes           Std       1 FUS$LOOKUP
         yes           Std       2 XSL$NTOHL
         yes           Std       0 FUA$GETCTX
 yes     yes           Std       7 XSL$QSENDTO
 yes     yes           Std       2 XSL$GETHOSTBYNAME
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_MAUTO

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                             r    B$XL_UPPER$                      r    B$JIT$
     M$DS                                  M$DO                                  M$LM
     F$NETWORKS                            F$PROTOCOLS                           F$SERVICES
     F$ROUTES                              XSL_ERRNO                             FUP_RQSSTT
     F$LOG                                 B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     NULLSID                               ISSID
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:24   


        1        1        /*M* FUA$MAIN - nfsd (network file system daemon (ghost). */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* PLM=3 */
        8        8        /*P*  NAME: FUA$MAIN
        9        9              Purpose:
       10       10                    The main routine for the CP-6 nfs server.
       11       11        */
       12       12        /*F*  NAME: FUA$MAIN
       13       13              Purpose:
       14       14                    The main driver routine for the CP-6 nfs server.  Reads data
       15       15                    from the appropriate sockets, validates it, and calls other
       16       16                    routines to process the data.
       17       17        */
       18       18        /*D*  NAME: FUA$MAIN
       19       19              Algorithm:
       20       20                    Open up all of the appropriate sockets.  Then go into a loop
       21       21                    reading from the sockets.  If we get data, we perform the
       22       22                    appropriate action for that socket.  We then update the "global"
       23       23                    variables (DS stuff) - so that NFSU has something to read from.
       24       24                    Reloop.  We never exit - expect to run forever.
       25       25        */
       26       26
       27       27        FUA$MAIN: PROC MAIN;

     27 11 000000   000000 700200 xent  FUA$MAIN     TSX0  ! X66_MAUTO
        11 000001   004076 000000                    ZERO    2110,0

       28       28        %INCLUDE CP_6;
       29      109            %F$DCB;
       30      166        %INCLUDE CP_6_SUBS;
       31      706        %INCLUDE B$TABLES_C;
       32      814            %B$XL_UPPER;
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:25   
       33      818        %INCLUDE B$JIT;
       34     1108    1   DCL B$JIT$ PTR SYMREF READONLY;
       35     1109        %INCLUDE FU_NFSSUBS_C;
       36     1204        %INCLUDE FU_NFS_M;
       37     1719
       38     1720            %M$DCB( DCBN=M$DS, ASN=FILE, NAME='nfsd:', ACCT=':SYS', FUN=CREATE,
       39     1721                    CTG=YES, EXIST=OLDFILE, SHARE=ALL, ACS=DS8, ORG=RANDOM);
       40     1795    1   DCL B$DS8 CONSTANT SYMDEF UBIN INIT(%(11+6*512));
       41     1796    1   DCL B$DS8$ REDEF B$DS8 PTR;
       42     1797            %FU$NFSDS( NAME=DS, STCLASS="BASED(B$DS8$)");
       43     1827            %FU$NFSDS( NAME=CDS, STCLASS=CONSTANT);
       44     1857    1   DCL M$DO DCB;
       45     1858    1   DCL M$LM DCB;
       46     1859            %FPT_EXTEND( DCB=M$DS, SIZ=1, STCLASS=CONSTANT SYMDEF);
       47     1873            %FPT_XCON( STCLASS=CONSTANT, UENTRY=FUA$XCON);
       48     1887            %FPT_MONINFO( STCLASS=CONSTANT);
       49     1902            %VLR_SITEINFO;
       50     1921            %FPT_TIME( TIME=S_TSTAMP.TIME, DATE=S_TSTAMP.DATE, DEST=LOCAL);
       51     1940            %FPT_WAIT( FPTN=WAIT_5_MINS, UNITS=5, UTYPE=MIN);
       52     1954            %FPT_TIME( FPTN=FU_FPT_TIME, STCLASS=CONSTANT SYMDEF,
       53     1955                       DEST=UTS, TSTAMP=FU_TIME);
       54     1974            %FPT_WRITE( DCB=M$DO, BUF=S_BUF);
       55     2005            %FPT_ERRMSG( OUTDCB1=M$DO, BUF=S_BUF, CODE=XSL_ERRNO,
       56     2006              SOURCE=ALTRET, INCLCODE=NO, FLAGLEV=3);
       57     2033            %FPT_RELDCB (FPTN=REL_F$NETWORKS,  DCB="DCBNUM( F$NETWORKS)");
       58     2047            %FPT_RELDCB (FPTN=REL_F$PROTOCOLS, DCB="DCBNUM( F$PROTOCOLS)");
       59     2061            %FPT_RELDCB (FPTN=REL_F$SERVICES,  DCB="DCBNUM( F$SERVICES)");
       60     2075            %FPT_RELDCB (FPTN=REL_F$ROUTES,    DCB="DCBNUM( F$ROUTES)");
       61     2089    1   DCL F$NETWORKS DCB;
       62     2090    1   DCL F$PROTOCOLS DCB;
       63     2091    1   DCL F$SERVICES DCB;
       64     2092    1   DCL F$ROUTES DCB;
       65     2093
       66     2094        %INCLUDE SS_SCHED_C;
       67     2327
       68     2328        %INCLUDE XSL_SOCKET_E;
       69     2586        %INCLUDE XSL_SOCKET_M;
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:26   
       70     3334            %XSL$HOSTENT;
       71     3394            %XSL_SOCKINIT( FPTN=FUA_SOCKINIT, BUFSIZE=4096, MAXSOCK=3, NWSOCKS=2,
       72     3395                           STCLASS="CONSTANT SYMDEF");
       73     3518        %INCLUDE XSL_PERR_C;
       74     3573
       75     3574    1   DCL FUA$GETCTX ENTRY;
       76     3575    1   DCL FUA$XCON ENTRY ASYNC;
       77     3576    1   DCL FUG$GARBCOL ENTRY(1);
       78     3577    1   DCL FUM$MOUNTRQS ENTRY(1);
       79     3578    1   DCL FUN$CLOSE ENTRY;
       80     3579    1   DCL FUN$NFSRQS ENTRY(1);
       81     3580    1   DCL FUP$PMAPINIT ENTRY(1);
       82     3581    1   DCL FUP$PMAPRQS ENTRY(1);
       83     3582    1   DCL FUS$LOOKUP ENTRY(1) ALTRET;
       84     3583
       85     3584    1   DCL XSL$GETHOSTBYNAME ENTRY(2) ALTRET;
       86     3585    1   DCL XSL$HTONL ENTRY(2);
       87     3586    1   DCL XSL$NTOHL ENTRY(2);
       88     3587    1   DCL XSL$HTONS ENTRY(2);
       89     3588    1   DCL XSL$NTOHS ENTRY(2);
       90     3589    1   DCL XSL$QBIND ENTRY(4) ALTRET;
       91     3590    1   DCL XSL$QCLOSE ENTRY(2) ALTRET;
       92     3591    1   DCL XSL$QGETSOCKNAME ENTRY(4) ALTRET;
       93     3592    1   DCL XSL$QRECVFROM ENTRY(7) ALTRET;
       94     3593    1   DCL XSL$QSELECT ENTRY(6) ALTRET;
       95     3594    1   DCL XSL$QSENDTO ENTRY(7) ALTRET;
       96     3595    1   DCL XSL$QSETSOCKOPT ENTRY(6) ALTRET;
       97     3596    1   DCL XSL$QSOCKET ENTRY(4) ALTRET;
       98     3597    1   DCL XSL$SOCKINIT ENTRY(1) ALTRET;
       99     3598
      100     3599    1   DCL XSL_ERRNO SBIN SYMREF;
      101     3600    1   DCL 1 XSL_ERR REDEF XSL_ERRNO, 2 FCG BIT(18), 2 * BIT(18);
      102     3601
      103     3602    1   DCL S_BUF CHAR(256) STATIC;
      104     3603    1   DCL 1 S_TSTAMP REDEF S_BUF,
      105     3604    1         2 LEAD CHAR(7),
      106     3605    1         2 DATE CHAR(9),
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:27   
      107     3606    1         2 TIME CHAR(11),
      108     3607    1         2 T REDEF TIME,
      109     3608    1           3 TIME CHAR(5),
      110     3609    1           3 TRAIL CHAR(6),
      111     3610    1         2 * CHAR(229);
      112     3611    1   DCL SELECT_MASK(0:35) STATIC BIT(1) INIT('0'B*0);
      113     3612
      114     3613    1   DCL FU_NFSSOCKET SBIN STATIC SYMDEF INIT(-1); /* These three items ...        */
      115     3614    1   DCL FU_SOCKET(0:0) REDEF FU_NFSSOCKET SBIN;
      116     3615    1   DCL FU_MOUNTSOCKET SBIN STATIC SYMDEF INIT(-1); /* are ordered to match ...   */
      117     3616    1   DCL FU_PMAPSOCKET SBIN STATIC SYMDEF INIT(-1); /* the arrays below.           */
      118     3617    1   DCL FU_PROGNAME(0:2) UBIN CONSTANT SYMDEF INIT(%(PROG_NFS+PROG_SPREAD),
      119     3618    1     %(PROG_MOUNT+PROG_SPREAD), %(PROG_PMAP+PROG_SPREAD));
      120     3619    1   DCL FU_PROGVERS(0:2) UBIN CONSTANT SYMDEF
      121     3620    1     INIT(%VERS_NFS,%VERS_MOUNT,%VERS_PMAP);
      122     3621    1   DCL MAXPROC(0:2) UBIN CONSTANT INIT(17,5,5);
      123     3622        /*%NFSPROC_STATFS, %MNTPROC_EXPORT, %PMAPPROC_CALLIT);*/
      124     3623    1   DCL FU_PORTNUM(0:2) UBIN STATIC SYMDEF INIT(%PORT_NFS,0,%PORT_PMAP);
      125     3624    1   DCL FUP_RQSSTT UBIN SYMREF;
      126     3625        %FU$FCTX( NAME=FU_FCTX, STCLASS=CONSTANT SYMDEF);
      127     3728        %FU$UCTX( NAME=FU_UCTX, STCLASS=CONSTANT SYMDEF);
      128     3781
      129     3782    1   DCL LOGGING BIT(1) STATIC INIT('1'B);
      130     3783    1   DCL MYSYSID UBIN STATIC INIT(0);
      131     3784    1   DCL FU_CTXHD$ STATIC SYMDEF PTR INIT(ADDR(NIL));
      132     3785    1   DCL FU_MAXCTX$ STATIC SYMDEF PTR INIT(ADDR(NIL));
      133     3786    1   DCL FU_HCTX$ STATIC SYMDEF PTR INIT(ADDR(NIL));
      134     3787    1   DCL FU_FCTX$ STATIC SYMDEF PTR INIT(ADDR(NIL));
      135     3788    1   DCL FU_PROC# STATIC SYMDEF UBIN INIT(0);
      136     3789    1   DCL FU_MSGCNT STATIC SYMDEF SBIN INIT(0);
      137     3790    1   DCL FU_TIME STATIC SYMDEF UBIN INIT(0);
      138     3791    1   DCL FU_MYACCN STATIC SYMDEF CHAR(8);
      139     3792    1   DCL FU_MYUNAME STATIC SYMDEF CHAR(12);
      140     3793    1   DCL FU_TIMEZONESECS STATIC SYMDEF SBIN INIT(0);
      141     3794    1   DCL FU_OPENLIM STATIC SYMDEF UBIN INIT(0);
      142     3795
      143     3796        %EJECT;
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:28   
      144     3797        /* AUTO */
      145     3798    1   DCL CTX$ PTR;
      146     3799    1   DCL DSCR_ DSCR DALIGNED;
      147     3800    1   DCL HCTX$ PTR;
      148     3801    1   DCL I UBIN;
      149     3802    1   DCL IS REDEF I SBIN;
      150     3803    1   DCL REOPENIN_PORTS BIT(1);
      151     3804    1   DCL SELECT_RESULT(0:35) BIT(1);
      152     3805    1   DCL LASTCLOSE UBIN;
      153     3806    1   DCL T$ PTR;                             /* OK to use in calls                 */
      154     3807        /* ! RQSCTX must be the last item in auto.  GARBCOL clobbers beyond it. ! */
      155     3808        %FU$RQSCTX( NAME=RQSCTX, STCLASS=AUTO, BODYLEN="%(8192+60)");
      156     3897         /* 8192 = max data on READRQS, 60 = sizeof (READRES + REPLYHDR - CALLHDR)    */
      157     3898
      158     3899        /* Based items */
      159     3900
      160     3901    1   DCL B$UBIN UBIN BASED ALIGNED;
      161     3902    1   DCL B$PTRA(0:0) PTR BASED ALIGNED;
      162     3903    1   DCL 1 TEXTW BASED ALIGNED,
      163     3904    1         2 L UBIN,
      164     3905    1         2 LC REDEF L,
      165     3906    1           3 * BIT(27),
      166     3907    1           3 C UBIN(9) UNAL,
      167     3908    1         2 T CHAR(TEXTW.L);
      168     3909        %FU$HCTX( NAME=HCTX, STCLASS="BASED(HCTX$)");
      169     3932        %FU$UCTX( NAME=UCTX, STCLASS="BASED(RQSCTX.UCTX$)");
      170     3985
      171     3986        %EJECT;
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:29   
      172     3987    1      IF NOT B$JIT.PRIV.ACTIVE.JIT

   3987 11 000002   000000 470400 xsym               LDP0    B$JIT$
        11 000003   000013 236100                    LDQ     11,,PR0
        11 000004   000040 316007                    CANQ    32,DL
        11 000005   000016 601000 11                 TNZ     s:3993

      173     3988    2      THEN DO;

      174     3989    2         S_BUF = 'JIT privilege required to run NFSD';

   3989 11 000006   040000 100400                    MLR     fill='040'O
        11 000007   000407 000042 2                  ADSC9   FU_UCTX+36               cn=0,n=34
        11 000010   000206 000400 5                  ADSC9   S_BUF                    cn=0,n=256

      175     3990    2         CALL M$WRITE( FPT_WRITE);

   3990 11 000011   000120 630400 5                  EPPR0   FPT_WRITE
        11 000012   040001 713400                    CLIMB   write
        11 000013   401400 401760                    pmme    nvectors=4

      176     3991    2         CALL M$XXX;

   3991 11 000014   000003 713400                    CLIMB   3
        11 000015   000000 401760                    pmme    nvectors=0

      177     3992    2         END;

      178     3993    1      CALL M$XCON( FPT_XCON);

   3993 11 000016   000210 630400 2                  EPPR0   FPT_XCON
        11 000017   010003 713400                    CLIMB   4099
        11 000020   400400 401760                    pmme    nvectors=2

      179     3994    1      CALL XSL$HTONL( MYSYSID, MOD(B$JIT.LOGONTIME/8192, 65536));

   3994 11 000021   000000 470400 xsym               LDP0    B$JIT$
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:30   
        11 000022   000150 236100                    LDQ     104,,PR0
        11 000023   000015 772000                    QRL     13
        11 000024   177777 376007                    ANQ     65535,DL
        11 000025   204066 756100                    STQ     @SOCK+3,,AUTO
        11 000026   204066 631500                    EPPR1   @SOCK+3,,AUTO
        11 000027   204071 451500                    STP1    @SOCK+6,,AUTO
        11 000030   000000 236000 12                 LDQ     0
        11 000031   204070 756100                    STQ     @SOCK+5,,AUTO
        11 000032   204070 630500                    EPPR0   @SOCK+5,,AUTO
        11 000033   000020 631400 xsym               EPPR1   B_VECTNIL+16
        11 000034   000000 701000 xent               TSX1    XSL$HTONL
        11 000035   000000 011000                    NOP     0

      180     3995    1      HCTX$ = ADDR( NIL);

   3995 11 000036   000001 236000 xsym               LDQ     B_VECTNIL+1
        11 000037   200006 756100                    STQ     HCTX$,,AUTO

      181     3996    1      FU_MYACCN = B$JIT.ACCN;

   3996 11 000040   000000 470400 xsym               LDP0    B$JIT$
        11 000041   040000 100500                    MLR     fill='040'O
        11 000042   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8
        11 000043   000326 000010 5                  ADSC9   FU_MYACCN                cn=0,n=8

      182     3997    1      FU_MYUNAME = B$JIT.UNAME;

   3997 11 000044   040000 100500                    MLR     fill='040'O
        11 000045   000003 000014                    ADSC9   3,,PR0                   cn=0,n=12
        11 000046   000330 000014 5                  ADSC9   FU_MYUNAME               cn=0,n=12

      183     3998    1      CALL M$MONINFO( FPT_MONINFO);

   3998 11 000047   000216 630400 2                  EPPR0   FPT_MONINFO
        11 000050   020023 713400                    CLIMB   8211
        11 000051   402400 401760                    pmme    nvectors=6

PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:31   
      184     3999    1      FU_TIMEZONESECS = VLR_SITEINFO.UTC_OFFSET#/100;

   3999 11 000052   000072 236000 5                  LDQ     VLR_SITEINFO+58
        11 000053   000144 506007                    DIV     100,DL
        11 000054   000333 756000 5                  STQ     FU_TIMEZONESECS

      185     4000    1      B$JIT.PRIV.ACTIVE = %PR_FMSEC#;

   4000 11 000055   000420 236000 2                  LDQ     FU_UCTX+45
        11 000056   000000 470400 xsym               LDP0    B$JIT$
        11 000057   000013 756100                    STQ     11,,PR0

      186     4001    2      CALL M$REW( FPT_EXTEND) WHENALTRETURN DO;

   4001 11 000060   000204 630400 2                  EPPR0   FPT_EXTEND
        11 000061   440006 713400                    CLIMB   alt,+16390
        11 000062   400000 401760                    pmme    nvectors=1
        11 000063   000065 702000 11                 TSX2    MONABRT
        11 000064   000072 710000 11                 TRA     s:4006

      187     4002    2   MONABRT: CALL M$ERRMSG( FPT_ERRMSG);

   4002 11 000065   000134 630400 5     MONABRT      EPPR0   FPT_ERRMSG
        11 000066   020000 713400                    CLIMB   8192
        11 000067   405000 401760                    pmme    nvectors=11

      188     4003    2         CALL M$XXX;

   4003 11 000070   000003 713400                    CLIMB   3
        11 000071   000000 401760                    pmme    nvectors=0

      189     4004    2         END;

      190     4005
      191     4006    1      DSCR_ = PTRDSCR( B$DS8$);

   4006 11 000072   000000 470400 2                  LDP0    B$DS8
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:32   
        11 000073   200004 050500                    STD0    DSCR_,,AUTO

      192     4007        /*N* put code in here to figure out if we"re a slave */
      193     4008    1      DS = CDS;

   4008 11 000074   000000 470400 2                  LDP0    B$DS8
        11 000075   000100 100400                    MLR     fill='000'O
        11 000076   000001 001014 2                  ADSC9   CDS                      cn=0,n=524
        11 000077   000000 001014                    ADSC9   0,,PR0                   cn=0,n=524

      194     4009    1      FU_MAXCTX$ = PINCRW( B$DS8$, DBOUND( DSCR_) / 4 + 1);

   4009 11 000100   200004 236100                    LDQ     DSCR_,,AUTO
        11 000101   000020 772000                    QRL     16
        11 000102   000002 772000                    QRL     2
        11 000103   000022 736000                    QLS     18
        11 000104   000001 036003                    ADLQ    1,DU
        11 000105   000000 036000 2                  ADLQ    B$DS8
        11 000106   000320 756000 5                  STQ     FU_MAXCTX$

      195     4010    1      CALL TSTAMP;

   4010 11 000107   001740 701000 11                 TSX1    TSTAMP
        11 000110   000000 011000                    NOP     0

      196     4011    1      DS.P.SYSID( FU_PROC#) = B$JIT.SYSID;

   4011 11 000111   000323 235000 5                  LDA     FU_PROC#
        11 000112   000004 735000                    ALS     4
        11 000113   000000 470400 xsym               LDP0    B$JIT$
        11 000114   000000 720100                    LXL0    0,,PR0
        11 000115   000000 471400 2                  LDP1    B$DS8
        11 000116   100043 740105                    STX0    35,AL,PR1

      197     4012    1      CALL M$TIME( FU_FPT_TIME);

   4012 11 000117   000232 630400 2                  EPPR0   FU_FPT_TIME
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:33   
        11 000120   020004 713400                    CLIMB   8196
        11 000121   402000 401760                    pmme    nvectors=5

      198     4013    1      LASTCLOSE = FU_TIME;

   4013 11 000122   000325 235000 5                  LDA     FU_TIME
        11 000123   200012 755100                    STA     LASTCLOSE,,AUTO

      199     4014    1      REOPENIN_PORTS = %NO#;

   4014 11 000124   200010 450100                    STZ     REOPENIN_PORTS,,AUTO

      200     4015    1      RQSCTX = '0'B;

   4015 11 000125   020230 220003                    LDX0    8344,DU
        11 000126   000140 100400                    MLR     fill='000'O
        11 000127   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
        11 000130   200014 000010                    ADSC9   RQSCTX,,AUTO             cn=0,n=*X0

      201     4016    1      CALL XSL$SOCKINIT( FUA_SOCKINIT) ALTRET( MONERR);

   4016 11 000131   000001 630400 12                 EPPR0   1
        11 000132   000017 631400 xsym               EPPR1   B_VECTNIL+15
        11 000133   000000 701000 xent               TSX1    XSL$SOCKINIT
        11 000134   000330 702000 11                 TSX2    MONERR

   4015 11 000135                       OPEN_PORTS   null
      202     4017
      203     4018        /* First open up the ports. */
      204     4019    1   OPEN_PORTS:;
      205     4020    1      SELECT_MASK = '0'B;

   4020 11 000135   000306 450000 5                  STZ     SELECT_MASK

      206     4021    1      RQSCTX.FROMADDR.SA_FAMILY = %XSL_AF_INET;

   4021 11 000136   000002 235007                    LDA     2,DL
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:34   
        11 000137   200022 755100                    STA     RQSCTX+6,,AUTO

      207     4022    2      DO I = 0 TO 2;

   4022 11 000140   200007 450100                    STZ     I,,AUTO

      208     4023    2         CALL XSL$HTONS( RQSCTX.FROMADDR.S_PORT, FU_PORTNUM( I));

   4023 11 000141   200007 720100                    LXL0    I,,AUTO
        11 000142   000312 630410 5                  EPPR0   FU_PORTNUM,X0
        11 000143   204067 450500                    STP0    @SOCK+4,,AUTO
        11 000144   200023 631500                    EPPR1   RQSCTX+7,,AUTO
        11 000145   204066 451500                    STP1    @SOCK+3,,AUTO
        11 000146   204066 630500                    EPPR0   @SOCK+3,,AUTO
        11 000147   000020 631400 xsym               EPPR1   B_VECTNIL+16
        11 000150   000000 701000 xent               TSX1    XSL$HTONS
        11 000151   000000 011000                    NOP     0

      209     4024    2         CALL XSL$QSOCKET( FU_SOCKET( I), %XSL_AF_INET, %XSL_SOCK_DGRAM,

   4024 11 000152   000002 237000 12                 LDAQ    2
        11 000153   204070 757100                    STAQ    @SOCK+5,,AUTO
        11 000154   000002 236000 12                 LDQ     2
        11 000155   204067 756100                    STQ     @SOCK+4,,AUTO
        11 000156   200007 720100                    LXL0    I,,AUTO
        11 000157   000307 630410 5                  EPPR0   FU_NFSSOCKET,X0
        11 000160   204066 450500                    STP0    @SOCK+3,,AUTO
        11 000161   204066 630500                    EPPR0   @SOCK+3,,AUTO
        11 000162   000022 631400 xsym               EPPR1   B_VECTNIL+18
        11 000163   000000 701000 xent               TSX1    XSL$QSOCKET
        11 000164   000320 702000 11                 TSX2    NO_BIND

      210     4025    2           %XSL_AF_INET) ALTRET (NO_SOCKET);
      211     4026    2         CALL XSL$QSETSOCKOPT( T$, FU_SOCKET( I), %XSL_SOL_SOCKET,

   4026 11 000165   000004 237000 12                 LDAQ    4
        11 000166   204072 757100                    STAQ    @SOCK+7,,AUTO
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:35   
        11 000167   000006 237000 12                 LDAQ    6
        11 000170   204070 757100                    STAQ    @SOCK+5,,AUTO
        11 000171   200007 720100                    LXL0    I,,AUTO
        11 000172   000307 630410 5                  EPPR0   FU_NFSSOCKET,X0
        11 000173   204067 450500                    STP0    @SOCK+4,,AUTO
        11 000174   200013 631500                    EPPR1   T$,,AUTO
        11 000175   204066 451500                    STP1    @SOCK+3,,AUTO
        11 000176   204066 630500                    EPPR0   @SOCK+3,,AUTO
        11 000177   000024 631400 xsym               EPPR1   B_VECTNIL+20
        11 000200   000000 701000 xent               TSX1    XSL$QSETSOCKOPT
        11 000201   000320 702000 11                 TSX2    NO_BIND

      212     4027    2           %XSL_SO_REUSEADDR, 262144, 2) ALTRET (NO_SETSOCKOPT);
      213     4028    2         IF I = 2 THEN B$JIT.PRIV.ACTIVE = %PR_MSYS#;

   4028 11 000202   200007 235100                    LDA     I,,AUTO
        11 000203   000002 115007                    CMPA    2,DL
        11 000204   000210 601000 11                 TNZ     s:4029

   4028 11 000205   000012 236000 xsym               LDQ     B_VECTNIL+10
        11 000206   000000 470400 xsym               LDP0    B$JIT$
        11 000207   000013 756100                    STQ     11,,PR0

      214     4029    3         CALL XSL$QBIND( T$, FU_SOCKET( I), RQSCTX.FROMADDR, 12) WHENALTRETURN DO;

   4029 11 000210   000011 236000 12                 LDQ     9
        11 000211   204071 756100                    STQ     @SOCK+6,,AUTO
        11 000212   200022 630500                    EPPR0   RQSCTX+6,,AUTO
        11 000213   204070 450500                    STP0    @SOCK+5,,AUTO
        11 000214   000307 631405 5                  EPPR1   FU_NFSSOCKET,AL
        11 000215   204067 451500                    STP1    @SOCK+4,,AUTO
        11 000216   200013 633500                    EPPR3   T$,,AUTO
        11 000217   204066 453500                    STP3    @SOCK+3,,AUTO
        11 000220   204066 630500                    EPPR0   @SOCK+3,,AUTO
        11 000221   000022 631400 xsym               EPPR1   B_VECTNIL+18
        11 000222   000000 701000 xent               TSX1    XSL$QBIND
        11 000223   000225 702000 11                 TSX2    s:4030
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:36   
        11 000224   000255 710000 11                 TRA     s:4037

      215     4030    3            IF I<2 THEN GOTO NO_BIND;

   4030 11 000225   200007 235100                    LDA     I,,AUTO
        11 000226   000002 115007                    CMPA    2,DL
        11 000227   000320 602000 11                 TNC     NO_BIND

      216     4031    3            RQSCTX.FROMADDR.S_PORT = 0;

   4031 11 000230   200023 450100                    STZ     RQSCTX+7,,AUTO

      217     4032    3            CALL XSL$QBIND( T$, FU_SOCKET( I), RQSCTX.FROMADDR, 12) ALTRET( NO_BIND);

   4032 11 000231   000011 236000 12                 LDQ     9
        11 000232   204071 756100                    STQ     @SOCK+6,,AUTO
        11 000233   200022 630500                    EPPR0   RQSCTX+6,,AUTO
        11 000234   204070 450500                    STP0    @SOCK+5,,AUTO
        11 000235   000307 631405 5                  EPPR1   FU_NFSSOCKET,AL
        11 000236   204067 451500                    STP1    @SOCK+4,,AUTO
        11 000237   200013 633500                    EPPR3   T$,,AUTO
        11 000240   204066 453500                    STP3    @SOCK+3,,AUTO
        11 000241   204066 630500                    EPPR0   @SOCK+3,,AUTO
        11 000242   000022 631400 xsym               EPPR1   B_VECTNIL+18
        11 000243   000000 701000 xent               TSX1    XSL$QBIND
        11 000244   000320 702000 11                 TSX2    NO_BIND

      218     4033    3            CALL FUP$PMAPINIT( RQSCTX);

   4033 11 000245   200014 630500                    EPPR0   RQSCTX,,AUTO
        11 000246   204066 450500                    STP0    @SOCK+3,,AUTO
        11 000247   204066 630500                    EPPR0   @SOCK+3,,AUTO
        11 000250   000017 631400 xsym               EPPR1   B_VECTNIL+15
        11 000251   000000 701000 xent               TSX1    FUP$PMAPINIT
        11 000252   000000 011000                    NOP     0

      219     4034    3            CALL LOG;
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:37   

   4034 11 000253   001642 701000 11                 TSX1    LOG
        11 000254   000000 011000                    NOP     0

      220     4035    3            END;

      221     4036
      222     4037    2         B$JIT.PRIV.ACTIVE = %(PR_FMSEC# | PR_FMDIAG#);

   4037 11 000255   000421 236000 2                  LDQ     FU_UCTX+46
        11 000256   000000 470400 xsym               LDP0    B$JIT$
        11 000257   000013 756100                    STQ     11,,PR0

      223     4038    2         SELECT_MASK( FU_SOCKET( I)) = '1'B;

   4038 11 000260   200007 720100                    LXL0    I,,AUTO
        11 000261   000307 235010 5                  LDA     FU_NFSSOCKET,X0
        11 000262   000264 605000 11                 TPL     s:4038+4
        11 000263   000044 035003                    ADLA    36,DU
        11 000264   003005 060400                    CSL     bolr='003'O
        11 000265   000030 000001 xsym               BDSC    B_VECTNIL+24             by=0,bit=0,n=1
        11 000266   000306 000001 5                  BDSC    SELECT_MASK,A            by=0,bit=0,n=1

      224     4039    3         IF FU_PORTNUM( I) = 0 THEN DO;    /* Dynamic port - get the port number */

   4039 11 000267   000312 235010 5                  LDA     FU_PORTNUM,X0
        11 000270   000317 601000 11                 TNZ     s:4046

      225     4040    3            RQSCTX.LEN = 8;

   4040 11 000271   000010 235007                    LDA     8,DL
        11 000272   200016 755100                    STA     RQSCTX+2,,AUTO

      226     4041    3            CALL XSL$QGETSOCKNAME(

   4041 11 000273   200016 631500                    EPPR1   RQSCTX+2,,AUTO
        11 000274   204071 451500                    STP1    @SOCK+6,,AUTO
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:38   
        11 000275   200022 633500                    EPPR3   RQSCTX+6,,AUTO
        11 000276   204070 453500                    STP3    @SOCK+5,,AUTO
        11 000277   000012 236000 12                 LDQ     10
        11 000300   204067 756100                    STQ     @SOCK+4,,AUTO
        11 000301   200016 634500                    EPPR4   RQSCTX+2,,AUTO
        11 000302   204066 454500                    STP4    @SOCK+3,,AUTO
        11 000303   204066 630500                    EPPR0   @SOCK+3,,AUTO
        11 000304   000022 631400 xsym               EPPR1   B_VECTNIL+18
        11 000305   000000 701000 xent               TSX1    XSL$QGETSOCKNAME
        11 000306   000000 011000                    NOP     0

      227     4042    3              RQSCTX.LEN, FU_SOCKET( 1), RQSCTX.FROMADDR, RQSCTX.LEN);
      228     4043    3            CALL XSL$NTOHS( FU_PORTNUM( 1), RQSCTX.FROMADDR.S_PORT);

   4043 11 000307   200023 630500                    EPPR0   RQSCTX+7,,AUTO
        11 000310   204067 450500                    STP0    @SOCK+4,,AUTO
        11 000311   000013 236000 12                 LDQ     11
        11 000312   204066 756100                    STQ     @SOCK+3,,AUTO
        11 000313   204066 630500                    EPPR0   @SOCK+3,,AUTO
        11 000314   000020 631400 xsym               EPPR1   B_VECTNIL+16
        11 000315   000000 701000 xent               TSX1    XSL$NTOHS
        11 000316   000000 011000                    NOP     0

      229     4044    3            END;

      230     4045
      231     4046    3         DO WHILE '0'B;

   4046 11 000317   000337 710000 11                 TRA     s:4059

      232     4047    3   NO_BIND: ;

   4047 11 000320                       NO_BIND      null
   4046 11 000320                       NO_SETSOCKO* null
   4046 11 000320                       NO_SOCKET    null
      233     4048    3   NO_SETSOCKOPT:;
      234     4049    3   NO_SOCKET: ;
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:39   
      235     4050    4            IF XSL_ERRNO > 0 THEN DO;

   4050 11 000320   000000 235000 xsym               LDA     XSL_ERRNO
        11 000321   000330 604400 11                 TMOZ    MONERR

      236     4051    4               XSL_ERRNO = XSL_ERRNO*8;

   4051 11 000322   000003 735000                    ALS     3
        11 000323   000000 755000 xsym               STA     XSL_ERRNO

      237     4052    4               XSL_ERR.FCG = '302314'O;

   4052 11 000324   302314 220003                    LDX0    99532,DU
        11 000325   000000 740000 xsym               STX0    XSL_ERRNO

      238     4053    4               FPT_ERRMSG.V.SOURCE# = 0;

   4053 11 000326   000014 236000 12                 LDQ     12
        11 000327   000164 356000 5                  ANSQ    FPT_ERRMSG+24

      239     4054    4               END;

   4050 11 000330                       MONERR       null
      240     4055    3   MONERR:  ;
      241     4056    3            CALL M$ERRMSG( FPT_ERRMSG);

   4056 11 000330   000134 630400 5                  EPPR0   FPT_ERRMSG
        11 000331   020000 713400                    CLIMB   8192
        11 000332   405000 401760                    pmme    nvectors=11

      242     4057    3            FPT_ERRMSG.V.SOURCE# = %SOURCE_ALTRET#;

   4057 11 000333   000164 236000 5                  LDQ     FPT_ERRMSG+24
        11 000334   000014 376000 12                 ANQ     12
        11 000335   100000 276007                    ORQ     32768,DL
        11 000336   000164 756000 5                  STQ     FPT_ERRMSG+24

PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:40   
      243     4058    3            END;

      244     4059    2         END;

   4059 11 000337   200007 235100                    LDA     I,,AUTO
        11 000340   000001 035007                    ADLA    1,DL
        11 000341   200007 755100                    STA     I,,AUTO
        11 000342   000003 115007                    CMPA    3,DL
        11 000343   000141 602000 11                 TNC     s:4023

      245     4060        /* CALL M$RELDCB( REL_F$NETWORKS);
      246     4061           CALL M$RELDCB( REL_F$PROTOCOLS);
      247     4062           CALL M$RELDCB( REL_F$SERVICES);
      248     4063           CALL M$RELDCB( REL_F$ROUTES);    */
      249     4064
      250     4065    1      DS.MOUNTPORT = FU_PORTNUM( 1);

   4065 11 000344   000000 470400 2                  LDP0    B$DS8
        11 000345   000313 236000 5                  LDQ     FU_PORTNUM+1
        11 000346   000000 756100                    STQ     0,,PR0

   4065 11 000347                       DO_SELECT    null
      251     4066
      252     4067
      253     4068        %EJECT;
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:41   
      254     4069    1   DO_SELECT:;
      255     4070    1      FU_OPENLIM = DS.OPENLIM * 25;        /* convert to UTS tics (after '93)    */

   4070 11 000347   000000 470400 2                  LDP0    B$DS8
        11 000350   000015 236100                    LDQ     13,,PR0
        11 000351   000031 402007                    MPY     25,DL
        11 000352   000334 756000 5                  STQ     FU_OPENLIM

      256     4071    1      SELECT_RESULT = SELECT_MASK;

   4071 11 000353   000306 236000 5                  LDQ     SELECT_MASK
        11 000354   200011 756100                    STQ     SELECT_RESULT,,AUTO

      257     4072    1      IF SELECT_RESULT = '0'B THEN GOTO REOPEN_PORTS;

   4072 11 000355   000415 600000 11                 TZE     REOPEN_PORTS

      258     4073    1      IF LASTCLOSE > FU_TIME THEN I = 32767; /* Big wait if we closed all        */

   4073 11 000356   000325 236000 5                  LDQ     FU_TIME
        11 000357   200012 116100                    CMPQ    LASTCLOSE,,AUTO
        11 000360   000364 603000 11                 TRC     s:4074

   4073 11 000361   077777 235007                    LDA     32767,DL
        11 000362   200007 755100                    STA     I,,AUTO
        11 000363   000366 710000 11                 TRA     s:4075

      259     4074    1      ELSE I = DS.OPENLIM;

   4074 11 000364   000015 235100                    LDA     13,,PR0
        11 000365   200007 755100                    STA     I,,AUTO

      260     4075    1      IF FUP_RQSSTT > 0 THEN I = 5;   /* Short wait if registering with pmap     */

   4075 11 000366   000000 235000 xsym               LDA     FUP_RQSSTT
        11 000367   000372 600000 11                 TZE     s:4076

PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:42   
   4075 11 000370   000005 235007                    LDA     5,DL
        11 000371   200007 755100                    STA     I,,AUTO

      261     4076    1      CALL XSL$QSELECT( I, 3, SELECT_RESULT, , , I);

   4076 11 000372   200007 631500                    EPPR1   I,,AUTO
        11 000373   204073 451500                    STP1    @SOCK+8,,AUTO
        11 000374   000001 236000 xsym               LDQ     B_VECTNIL+1
        11 000375   204072 756100                    STQ     @SOCK+7,,AUTO
        11 000376   204071 756100                    STQ     @SOCK+6,,AUTO
        11 000377   200011 633500                    EPPR3   SELECT_RESULT,,AUTO
        11 000400   204070 453500                    STP3    @SOCK+5,,AUTO
        11 000401   000015 236000 12                 LDQ     13
        11 000402   204067 756100                    STQ     @SOCK+4,,AUTO
        11 000403   200007 634500                    EPPR4   I,,AUTO
        11 000404   204066 454500                    STP4    @SOCK+3,,AUTO
        11 000405   204066 630500                    EPPR0   @SOCK+3,,AUTO
        11 000406   000024 631400 xsym               EPPR1   B_VECTNIL+20
        11 000407   000000 701000 xent               TSX1    XSL$QSELECT
        11 000410   000000 011000                    NOP     0

      262     4077    1      IF (IS<=0 AND SELECT_RESULT)         /* network must have gone away        */

   4077 11 000411   200007 235100                    LDA     I,,AUTO
        11 000412   000455 605400 11                 TPNZ    s:4088
        11 000413   200011 236100                    LDQ     SELECT_RESULT,,AUTO
        11 000414   000455 600000 11                 TZE     s:4088

      263     4078    2      THEN DO;

      264     4079    2   REOPEN_PORTS:
      265     4080    2         IF REOPENIN_PORTS THEN CALL M$WAIT( WAIT_5_MINS);

   4080 11 000415   200010 234100       REOPEN_PORTS SZN     REOPENIN_PORTS,,AUTO
        11 000416   000422 605000 11                 TPL     s:4081

   4080 11 000417   000112 630400 5                  EPPR0   WAIT_5_MINS
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:43   
        11 000420   020006 713400                    CLIMB   8198
        11 000421   400400 401760                    pmme    nvectors=2

      266     4081    2         REOPENIN_PORTS = %YES#;

   4081 11 000422   400000 236003                    LDQ     -131072,DU
        11 000423   200010 756100                    STQ     REOPENIN_PORTS,,AUTO

      267     4082    2         CALL XSL$QCLOSE( T$, FU_SOCKET( 0));

   4082 11 000424   000016 236000 12                 LDQ     14
        11 000425   204067 756100                    STQ     @SOCK+4,,AUTO
        11 000426   200013 630500                    EPPR0   T$,,AUTO
        11 000427   204066 450500                    STP0    @SOCK+3,,AUTO
        11 000430   204066 630500                    EPPR0   @SOCK+3,,AUTO
        11 000431   000020 631400 xsym               EPPR1   B_VECTNIL+16
        11 000432   000000 701000 xent               TSX1    XSL$QCLOSE
        11 000433   000000 011000                    NOP     0

      268     4083    2         CALL XSL$QCLOSE( T$, FU_SOCKET( 1));

   4083 11 000434   000012 236000 12                 LDQ     10
        11 000435   204067 756100                    STQ     @SOCK+4,,AUTO
        11 000436   200013 630500                    EPPR0   T$,,AUTO
        11 000437   204066 450500                    STP0    @SOCK+3,,AUTO
        11 000440   204066 630500                    EPPR0   @SOCK+3,,AUTO
        11 000441   000020 631400 xsym               EPPR1   B_VECTNIL+16
        11 000442   000000 701000 xent               TSX1    XSL$QCLOSE
        11 000443   000000 011000                    NOP     0

      269     4084    2         CALL XSL$QCLOSE( T$, FU_SOCKET( 2));

   4084 11 000444   000017 236000 12                 LDQ     15
        11 000445   204067 756100                    STQ     @SOCK+4,,AUTO
        11 000446   200013 630500                    EPPR0   T$,,AUTO
        11 000447   204066 450500                    STP0    @SOCK+3,,AUTO
        11 000450   204066 630500                    EPPR0   @SOCK+3,,AUTO
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:44   
        11 000451   000020 631400 xsym               EPPR1   B_VECTNIL+16
        11 000452   000000 701000 xent               TSX1    XSL$QCLOSE
        11 000453   000000 011000                    NOP     0

      270     4085    2         GOTO OPEN_PORTS;

   4085 11 000454   000135 710000 11                 TRA     OPEN_PORTS

      271     4086    2         END;
      272     4087
      273     4088    1      REOPENIN_PORTS = %NO#;

   4088 11 000455   200010 450100                    STZ     REOPENIN_PORTS,,AUTO

      274     4089
      275     4090    2      IF NOT SELECT_RESULT THEN DO;

   4090 11 000456   200011 236100                    LDQ     SELECT_RESULT,,AUTO
        11 000457   000501 601000 11                 TNZ     s:4100

      276     4091    2         CALL M$TIME( FU_FPT_TIME);

   4091 11 000460   000232 630400 2                  EPPR0   FU_FPT_TIME
        11 000461   020004 713400                    CLIMB   8196
        11 000462   402000 401760                    pmme    nvectors=5

      277     4092    2         IF FUP_RQSSTT = 0 THEN EXIT;

   4092 11 000463   000000 235000 xsym               LDA     FUP_RQSSTT
        11 000464   000501 600000 11                 TZE     s:4100

      278     4093    2         RQSCTX.LEN = 0;                   /* Timeout - retry the last request   */

   4093 11 000465   200016 450100                    STZ     RQSCTX+2,,AUTO

      279     4094    2         RQSCTX.PROC# = 0;

PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:45   
   4094 11 000466   200021 450100                    STZ     RQSCTX+5,,AUTO

      280     4095    2         RQSCTX.CALLHDR.TYPE = %TYPE_REPLY;

   4095 11 000467   000001 236007                    LDQ     1,DL
        11 000470   200030 756100                    STQ     RQSCTX+12,,AUTO

      281     4096    2         CALL FUP$PMAPRQS( RQSCTX);

   4096 11 000471   200014 630500                    EPPR0   RQSCTX,,AUTO
        11 000472   204066 450500                    STP0    @SOCK+3,,AUTO
        11 000473   204066 630500                    EPPR0   @SOCK+3,,AUTO
        11 000474   000017 631400 xsym               EPPR1   B_VECTNIL+15
        11 000475   000000 701000 xent               TSX1    FUP$PMAPRQS
        11 000476   000000 011000                    NOP     0

      282     4097    2         CALL LOG;

   4097 11 000477   001642 701000 11                 TSX1    LOG
        11 000500   000000 011000                    NOP     0

      283     4098    2         END;

      284     4099
      285     4100    2      CALL GETREQUEST( FU_NFSSOCKET) WHENRETURN DO;

   4100 11 000501   000016 236000 12                 LDQ     14
        11 000502   204063 756100                    STQ     RQSCTX+2087,,AUTO
        11 000503   000674 701000 11                 TSX1    GETREQUEST
        11 000504   000515 702000 11                 TSX2    s:4105

      286     4101    2         CALL FUN$NFSRQS( RQSCTX);

   4101 11 000505   200014 630500                    EPPR0   RQSCTX,,AUTO
        11 000506   204066 450500                    STP0    @SOCK+3,,AUTO
        11 000507   204066 630500                    EPPR0   @SOCK+3,,AUTO
        11 000510   000017 631400 xsym               EPPR1   B_VECTNIL+15
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:46   
        11 000511   000000 701000 xent               TSX1    FUN$NFSRQS
        11 000512   000000 011000                    NOP     0

      287     4102    2         CALL LOG;

   4102 11 000513   001642 701000 11                 TSX1    LOG
        11 000514   000000 011000                    NOP     0

      288     4103    2         END;

      289     4104
      290     4105    2      CALL GETREQUEST( FU_PMAPSOCKET) WHENRETURN DO;

   4105 11 000515   000017 236000 12                 LDQ     15
        11 000516   204063 756100                    STQ     RQSCTX+2087,,AUTO
        11 000517   000674 701000 11                 TSX1    GETREQUEST
        11 000520   000541 702000 11                 TSX2    s:4111

      291     4106    2         CALL FUP$PMAPRQS( RQSCTX);

   4106 11 000521   200014 630500                    EPPR0   RQSCTX,,AUTO
        11 000522   204066 450500                    STP0    @SOCK+3,,AUTO
        11 000523   204066 630500                    EPPR0   @SOCK+3,,AUTO
        11 000524   000017 631400 xsym               EPPR1   B_VECTNIL+15
        11 000525   000000 701000 xent               TSX1    FUP$PMAPRQS
        11 000526   000000 011000                    NOP     0

      292     4107    2         CALL LOG;

   4107 11 000527   001642 701000 11                 TSX1    LOG
        11 000530   000000 011000                    NOP     0

      293     4108    2         IF FU_PMAPSOCKET <0 THEN SELECT_MASK( -FU_PMAPSOCKET) = '0'B;

   4108 11 000531   000311 235000 5                  LDA     FU_PMAPSOCKET
        11 000532   000541 605000 11                 TPL     s:4111

PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:47   
   4108 11 000533   000000 531000                    NEG     0
        11 000534   000536 605000 11                 TPL     s:4108+5
        11 000535   000044 035003                    ADLA    36,DU
        11 000536   003005 060400                    CSL     bolr='003'O
        11 000537   000002 000001 xsym               BDSC    B_VECTNIL+2              by=0,bit=0,n=1
        11 000540   000306 000001 5                  BDSC    SELECT_MASK,A            by=0,bit=0,n=1

      294     4109    2         END;

      295     4110
      296     4111    2      CALL GETREQUEST( FU_MOUNTSOCKET) WHENRETURN DO;

   4111 11 000541   000012 236000 12                 LDQ     10
        11 000542   204063 756100                    STQ     RQSCTX+2087,,AUTO
        11 000543   000674 701000 11                 TSX1    GETREQUEST
        11 000544   000555 702000 11                 TSX2    s:4117

      297     4112    2         CALL FUM$MOUNTRQS( RQSCTX);

   4112 11 000545   200014 630500                    EPPR0   RQSCTX,,AUTO
        11 000546   204066 450500                    STP0    @SOCK+3,,AUTO
        11 000547   204066 630500                    EPPR0   @SOCK+3,,AUTO
        11 000550   000017 631400 xsym               EPPR1   B_VECTNIL+15
        11 000551   000000 701000 xent               TSX1    FUM$MOUNTRQS
        11 000552   000000 011000                    NOP     0

      298     4113    2         CALL LOG;

   4113 11 000553   001642 701000 11                 TSX1    LOG
        11 000554   000000 011000                    NOP     0

      299     4114    2         END;

      300     4115
      301     4116             /* request(s) done, update DS variables, and cleanup memory if needed    */
      302     4117    1      DS.HCTX$ = FU_HCTX$;

PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:48   
   4117 11 000555   000321 236000 5                  LDQ     FU_HCTX$
        11 000556   000000 470400 2                  LDP0    B$DS8
        11 000557   000006 756100                    STQ     6,,PR0

      303     4118    1      DS.FCTX$ = FU_FCTX$;

   4118 11 000560   000322 236000 5                  LDQ     FU_FCTX$
        11 000561   000004 756100                    STQ     4,,PR0

      304     4119    1      DS.P.PMMECNT( FU_PROC#) = B$JIT.CALCNT;

   4119 11 000562   000323 235000 5                  LDA     FU_PROC#
        11 000563   000004 735000                    ALS     4
        11 000564   000000 471400 xsym               LDP1    B$JIT$
        11 000565   000000 620005                    EAX0    0,AL
        11 000566   100267 235100                    LDA     183,,PR1
        11 000567   000051 755110                    STA     41,X0,PR0

      305     4120    1      DS.P.DISKIOS( FU_PROC#) = B$JIT.ACCESS.PACKS;

   4120 11 000570   000323 235000 5                  LDA     FU_PROC#
        11 000571   000004 735000                    ALS     4
        11 000572   000000 620005                    EAX0    0,AL
        11 000573   100327 235100                    LDA     215,,PR1
        11 000574   000052 755110                    STA     42,X0,PR0

      306     4121    1      DS.P.STIME( FU_PROC#) = B$JIT.TUSVT + B$JIT.TPSVT;

   4121 11 000575   000323 235000 5                  LDA     FU_PROC#
        11 000576   000004 735000                    ALS     4
        11 000577   100274 236100                    LDQ     188,,PR1
        11 000600   100271 036100                    ADLQ    185,,PR1
        11 000601   000053 756105                    STQ     43,AL,PR0

      307     4122    1      DS.P.XTIME( FU_PROC#) = B$JIT.TUEXT + B$JIT.TPEXT;

   4122 11 000602   000323 235000 5                  LDA     FU_PROC#
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:49   
        11 000603   000004 735000                    ALS     4
        11 000604   100273 236100                    LDQ     187,,PR1
        11 000605   100270 036100                    ADLQ    184,,PR1
        11 000606   000054 756105                    STQ     44,AL,PR0

      308     4123    2      IF FU_TIME - LASTCLOSE > DS.OPENLIM THEN DO;

   4123 11 000607   000325 236000 5                  LDQ     FU_TIME
        11 000610   200012 136100                    SBLQ    LASTCLOSE,,AUTO
        11 000611   000015 116100                    CMPQ    13,,PR0
        11 000612   000624 604400 11                 TMOZ    s:4128

      309     4124    2         CALL FUN$CLOSE;

   4124 11 000613   000002 631400 xsym               EPPR1   B_VECTNIL+2
        11 000614   000000 701000 xent               TSX1    FUN$CLOSE
        11 000615   000000 011000                    NOP     0

      310     4125    2         LASTCLOSE = FU_TIME;

   4125 11 000616   000325 235000 5                  LDA     FU_TIME
        11 000617   200012 755100                    STA     LASTCLOSE,,AUTO

      311     4126    2         IF NOT SELECT_RESULT THEN LASTCLOSE = LASTCLOSE + 1;

   4126 11 000620   200011 236100                    LDQ     SELECT_RESULT,,AUTO
        11 000621   000624 601000 11                 TNZ     s:4128

   4126 11 000622   000001 035007                    ADLA    1,DL
        11 000623   200012 755100                    STA     LASTCLOSE,,AUTO

      312     4127    2         END;

      313     4128    1      IF DS.HCNT+DS.FCNT+DS.UCNT+DS.MCNT >= DS.CTXLIM THEN GOTO PURGE;

   4128 11 000624   000000 470400 2                  LDP0    B$DS8
        11 000625   000007 236100                    LDQ     7,,PR0
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:50   
        11 000626   000005 036100                    ADLQ    5,,PR0
        11 000627   000010 036100                    ADLQ    8,,PR0
        11 000630   000011 036100                    ADLQ    9,,PR0
        11 000631   000012 116100                    CMPQ    10,,PR0
        11 000632   000645 605000 11                 TPL     PURGE

      314     4129    1      I = 0;

   4129 11 000633   200007 450100                    STZ     I,,AUTO

      315     4130    2      DO UNTIL DS.P.SYSID( I) = 0;

      316     4131    3         IF DS.P.FCNT( I) >= DS.DCBLIM OR DS.P.UCNT( I) >= DS.BUFLIM THEN DO;

   4131 11 000634   000000 470400 2                  LDP0    B$DS8
        11 000635   200007 235100                    LDA     I,,AUTO
        11 000636   000004 735000                    ALS     4
        11 000637   000050 236105                    LDQ     40,AL,PR0
        11 000640   000013 116100                    CMPQ    11,,PR0
        11 000641   000645 605000 11                 TPL     PURGE
        11 000642   000047 236105                    LDQ     39,AL,PR0
        11 000643   000014 116100                    CMPQ    12,,PR0
        11 000644   000665 604000 11                 TMI     s:4138

      317     4132    3   PURGE:   CALL FUG$GARBCOL( RQSCTX);

   4132 11 000645   200014 631500       PURGE        EPPR1   RQSCTX,,AUTO
        11 000646   204066 451500                    STP1    @SOCK+3,,AUTO
        11 000647   204066 630500                    EPPR0   @SOCK+3,,AUTO
        11 000650   000017 631400 xsym               EPPR1   B_VECTNIL+15
        11 000651   000000 701000 xent               TSX1    FUG$GARBCOL
        11 000652   000000 011000                    NOP     0

      318     4133    3            FU_FCTX$ = DS.FCTX$;

   4133 11 000653   000000 470400 2                  LDP0    B$DS8
        11 000654   000004 236100                    LDQ     4,,PR0
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:51   
        11 000655   000322 756000 5                  STQ     FU_FCTX$

      319     4134    3            FU_HCTX$ = DS.HCTX$;

   4134 11 000656   000006 236100                    LDQ     6,,PR0
        11 000657   000321 756000 5                  STQ     FU_HCTX$

      320     4135    3            RQSCTX = '0'B;

   4135 11 000660   020230 220003                    LDX0    8344,DU
        11 000661   000140 100400                    MLR     fill='000'O
        11 000662   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
        11 000663   200014 000010                    ADSC9   RQSCTX,,AUTO             cn=0,n=*X0

      321     4136    3            GOTO DO_SELECT;

   4136 11 000664   000347 710000 11                 TRA     DO_SELECT

      322     4137    3            END;
      323     4138    2         I = I + 1;

   4138 11 000665   200007 235100                    LDA     I,,AUTO
        11 000666   000001 035007                    ADLA    1,DL
        11 000667   200007 755100                    STA     I,,AUTO

      324     4139    2         END;

   4139 11 000670   000004 735000                    ALS     4
        11 000671   000043 220105                    LDX0    35,AL,PR0
        11 000672   000634 601000 11                 TNZ     s:4131

      325     4140    1      GOTO DO_SELECT;

   4140 11 000673   000347 710000 11                 TRA     DO_SELECT

      326     4141        %EJECT;
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:52   
      327     4142        /*I*  NAME:    GETREQUEST
      328     4143              Purpose: To check that the input from requested socket is available, and
      329     4144                       is valid as far as we can tell.
      330     4145              Inputs:  SOCK - the socket to check on data from, and read from.
      331     4146              Algorithm: Read in the data (if available), and then do security checking
      332     4147                       to validate that this request is allowed.  If it is, then we
      333     4148                       want to check if the request looks valid.  If it is, then we do
      334     4149                       some initial setup so that the rest of NFS will be able to use
      335     4150                       this data.
      336     4151        */
      337     4152    1   GETREQUEST: PROC( SOCK) ALTRET;

   4152 11 000674   204062 741300       GETREQUEST   STX1  ! RQSCTX+2086,,AUTO

      338     4153    2   DCL SOCK SBIN;
      339     4154
      340     4155    2      IF SOCK<0 THEN GOTO RETALT;

   4155 11 000675   204063 470500                    LDP0    @SOCK,,AUTO
        11 000676   000000 235100                    LDA     0,,PR0
        11 000677   001640 604000 11                 TMI     RETALT

      341     4156    2      IF NOT SELECT_RESULT( SOCK) THEN GOTO RETALT;

   4156 11 000700   000702 605000 11                 TPL     s:4156+2
        11 000701   000044 035003                    ADLA    36,DU
        11 000702   000000 066505                    CMPB    filb='0'B
        11 000703   200011 000001                    BDSC    SELECT_RESULT,A,AUTO     by=0,bit=0,n=1
        11 000704   000002 000022 xsym               BDSC    B_VECTNIL+2              by=0,bit=0,n=18
        11 000705   001640 600000 11                 TZE     RETALT

      342     4157
      343     4158    2      I = SIZEC( RQSCTX.FROMADDR);

   4158 11 000706   000024 235007                    LDA     20,DL
        11 000707   200007 755100                    STA     I,,AUTO

PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:53   
      344     4159    2      CALL XSL$QRECVFROM( RQSCTX.LEN, SOCK, RQSCTX.CALLHDR,

   4159 11 000710   200007 631500                    EPPR1   I,,AUTO
        11 000711   204074 451500                    STP1    @SOCK+9,,AUTO
        11 000712   200022 633500                    EPPR3   RQSCTX+6,,AUTO
        11 000713   204073 453500                    STP3    @SOCK+8,,AUTO
        11 000714   000021 236000 12                 LDQ     17
        11 000715   204072 756100                    STQ     @SOCK+7,,AUTO
        11 000716   000022 236000 12                 LDQ     18
        11 000717   204071 756100                    STQ     @SOCK+6,,AUTO
        11 000720   200027 634500                    EPPR4   RQSCTX+11,,AUTO
        11 000721   204070 454500                    STP4    @SOCK+5,,AUTO
        11 000722   204063 236100                    LDQ     @SOCK,,AUTO
        11 000723   204067 756100                    STQ     @SOCK+4,,AUTO
        11 000724   200016 635500                    EPPR5   RQSCTX+2,,AUTO
        11 000725   204066 455500                    STP5    @SOCK+3,,AUTO
        11 000726   204066 630500                    EPPR0   @SOCK+3,,AUTO
        11 000727   000025 631400 xsym               EPPR1   B_VECTNIL+21
        11 000730   000000 701000 xent               TSX1    XSL$QRECVFROM
        11 000731   001640 702000 11                 TSX2    RETALT

      345     4160    2        8192, 0, RQSCTX.FROMADDR, I) ALTRET( RETALT);
      346     4161
      347     4162                                      /* Got the message, check it for RPC validity   */
      348     4163    2      FU_MSGCNT = FU_MSGCNT + 1;

   4163 11 000732   000324 054000 5                  AOS     FU_MSGCNT

      349     4164    2      CALL M$TIME( FU_FPT_TIME);

   4164 11 000733   000232 630400 2                  EPPR0   FU_FPT_TIME
        11 000734   020004 713400                    CLIMB   8196
        11 000735   402000 401760                    pmme    nvectors=5

      350     4165    2      DS.BYTESIN = DS.BYTESIN + RQSCTX.LEN;

   4165 11 000736   000000 470400 2                  LDP0    B$DS8
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:54   
        11 000737   000002 236100                    LDQ     2,,PR0
        11 000740   200016 036100                    ADLQ    RQSCTX+2,,AUTO
        11 000741   000002 756100                    STQ     2,,PR0

      351     4166    2      CALL LOG;

   4166 11 000742   001642 701000 11                 TSX1    LOG
        11 000743   000000 011000                    NOP     0

      352     4167    2      DS.MSGCNT = FU_MSGCNT;     /* delayed update so LOG can detect incoming    */

   4167 11 000744   000000 470400 2                  LDP0    B$DS8
        11 000745   000324 235000 5                  LDA     FU_MSGCNT
        11 000746   000001 755100                    STA     1,,PR0

      353     4168    2      HCTX$ = ADDR( NIL);

   4168 11 000747   000001 236000 xsym               LDQ     B_VECTNIL+1
        11 000750   200006 756100                    STQ     HCTX$,,AUTO

      354     4169    2      RQSCTX.PROC# = 0;     /* Make sure program can tell replies from calls     */

   4169 11 000751   200021 450100                    STZ     RQSCTX+5,,AUTO

      355     4170    2      IF RQSCTX.CALLHDR.TYPE ~= %TYPE_CALL THEN RETURN; /* Let program decide    */

   4170 11 000752   200030 235100                    LDA     RQSCTX+12,,AUTO
        11 000753   000756 600000 11                 TZE     s:4171

   4170 11 000754   204062 221300                    LDX1  ! RQSCTX+2086,,AUTO
        11 000755   000001 702211                    TSX2  ! 1,X1

      356     4171    2      RQSCTX.CALLHDR.TYPE = %TYPE_REPLY;

   4171 11 000756   000001 235007                    LDA     1,DL
        11 000757   200030 755100                    STA     RQSCTX+12,,AUTO

PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:55   
      357     4172    3      IF RQSCTX.CALLHDR.RPCVERS ~= %VERS_RPC THEN DO; /* unexpected version      */

   4172 11 000760   200031 235100                    LDA     RQSCTX+13,,AUTO
        11 000761   000002 115007                    CMPA    2,DL
        11 000762   000772 600000 11                 TZE     s:4180

      358     4173    3         RQSCTX.REPLYHDR.REJECT_STAT = %RPC_MISMATCH;

   4173 11 000763   200032 450100                    STZ     RQSCTX+14,,AUTO

      359     4174    3         RQSCTX.REPLYHDR.VERS_LOW = %VERS_RPC;

   4174 11 000764   000002 235007                    LDA     2,DL
        11 000765   200033 755100                    STA     RQSCTX+15,,AUTO

      360     4175    3         RQSCTX.REPLYHDR.VERS_HIGH = %VERS_RPC;

   4175 11 000766   200034 755100                    STA     RQSCTX+16,,AUTO

      361     4176    3         RQSCTX.LEN = 24;

   4176 11 000767   000030 235007                    LDA     24,DL
        11 000770   200016 755100                    STA     RQSCTX+2,,AUTO

      362     4177    3         GOTO DENY;

   4177 11 000771   001603 710000 11                 TRA     DENY

      363     4178    3         END;
      364     4179
      365     4180    3      DO CASE( RQSCTX.CALLHDR.AUTH_CRED.FLAVOR);

   4180 11 000772   200035 235100                    LDA     RQSCTX+17,,AUTO
        11 000773   000003 115007                    CMPA    3,DL
        11 000774   000776 602005 11                 TNC     s:4180+4,AL
        11 000775   001320 710000 11                 TRA     s:4261
        11 000776   001056 710000 11                 TRA     s:4199
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:56   
        11 000777   001072 710000 11                 TRA     AUTH_UNIX
        11 001000   001001 710000 11                 TRA     s:4182

      366     4181    3       CASE( %AUTH_SHORT);

      367     4182    3         I = RQSCTX.CALLHDR.AUTH_CRED.HID.HCTX;

   4182 11 001001   200040 235100                    LDA     RQSCTX+20,,AUTO
        11 001002   000022 771000                    ARL     18
        11 001003   200007 755100                    STA     I,,AUTO

      368     4183    3         CALL XSL$NTOHL( I, I);

   4183 11 001004   200007 631500                    EPPR1   I,,AUTO
        11 001005   204067 451500                    STP1    @SOCK+4,,AUTO
        11 001006   200007 633500                    EPPR3   I,,AUTO
        11 001007   204066 453500                    STP3    @SOCK+3,,AUTO
        11 001010   204066 630500                    EPPR0   @SOCK+3,,AUTO
        11 001011   000020 631400 xsym               EPPR1   B_VECTNIL+16
        11 001012   000000 701000 xent               TSX1    XSL$NTOHL
        11 001013   000000 011000                    NOP     0

      369     4184    3         HCTX$ = PINCRW( B$DS8$, I*4);

   4184 11 001014   200007 236100                    LDQ     I,,AUTO
        11 001015   000024 736000                    QLS     20
        11 001016   000000 036000 2                  ADLQ    B$DS8
        11 001017   200006 756100                    STQ     HCTX$,,AUTO

      370     4185    3         RQSCTX.BODY$ = ADDR( RQSCTX.BODY);

   4185 11 001020   200043 630500                    EPPR0   RQSCTX+23,,AUTO
        11 001021   200017 450500                    STP0    RQSCTX+3,,AUTO

      371     4186    3         IF RQSCTX.CALLHDR.AUTH_CRED.LEN = 8

   4186 11 001022   200036 235100                    LDA     RQSCTX+18,,AUTO
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:57   
        11 001023   000010 115007                    CMPA    8,DL
        11 001024   001044 601000 11                 TNZ     s:4193
        11 001025   200041 235100                    LDA     RQSCTX+21,,AUTO
        11 001026   001044 601000 11                 TNZ     s:4193
        11 001027   200042 235100                    LDA     RQSCTX+22,,AUTO
        11 001030   001044 601000 11                 TNZ     s:4193
        11 001031   200040 236100                    LDQ     RQSCTX+20,,AUTO
        11 001032   777777 376007                    ANQ     -1,DL
        11 001033   000316 116000 5                  CMPQ    MYSYSID
        11 001034   001044 601000 11                 TNZ     s:4193
        11 001035   200006 236100                    LDQ     HCTX$,,AUTO
        11 001036   000320 116000 5                  CMPQ    FU_MAXCTX$
        11 001037   001044 603000 11                 TRC     s:4193
        11 001040   200006 471500                    LDP1    HCTX$,,AUTO
        11 001041   100002 236100                    LDQ     2,,PR1
        11 001042   200024 116100                    CMPQ    RQSCTX+8,,AUTO
        11 001043   001321 600000 11                 TZE     s:4265

      372     4187    3           AND RQSCTX.CALLHDR.AUTH_VERF.FLAVOR = %AUTH_NULL
      373     4188    3           AND RQSCTX.CALLHDR.AUTH_VERF.LEN = 0
      374     4189    3           AND RQSCTX.CALLHDR.AUTH_CRED.HID.SYSID = MYSYSID
      375     4190    3           AND HCTX$ < FU_MAXCTX$
      376     4191    3           AND HCTX.S_ADDR = RQSCTX.FROMADDR.S_ADDR
      377     4192    3         THEN EXIT;                        /* expected header                    */
      378     4193    3         IF RQSCTX.CALLHDR.AUTH_CRED.HID.SYSID ~= MYSYSID

   4193 11 001044   200040 236100                    LDQ     RQSCTX+20,,AUTO
        11 001045   777777 376007                    ANQ     -1,DL
        11 001046   000316 116000 5                  CMPQ    MYSYSID
        11 001047   001053 600000 11                 TZE     s:4195

      379     4194    3         THEN RQSCTX.REPLYHDR.AUTH_STAT = %AUTH_REJECTEDCRED;

   4194 11 001050   000002 235007                    LDA     2,DL
        11 001051   200033 755100                    STA     RQSCTX+15,,AUTO
        11 001052   001055 710000 11                 TRA     s:4196

PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:58   
      380     4195    3         ELSE RQSCTX.REPLYHDR.AUTH_STAT = %AUTH_BADCRED;

   4195 11 001053   000001 235007                    LDA     1,DL
        11 001054   200033 755100                    STA     RQSCTX+15,,AUTO

      381     4196    3         GOTO AUTH_ERROR;

   4196 11 001055   001577 710000 11                 TRA     AUTH_ERROR

      382     4197
      383     4198    3       CASE( %AUTH_NULL);

      384     4199    3         IF ADDR( SOCK) ~= ADDR( FU_PMAPSOCKET) AND RQSCTX.CALLHDR.PROC# ~= 0

   4199 11 001056   000017 236000 12                 LDQ     15
        11 001057   204063 116100                    CMPQ    @SOCK,,AUTO
        11 001060   001063 600000 11                 TZE     s:4202
        11 001061   200034 235100                    LDA     RQSCTX+16,,AUTO
        11 001062   001072 601000 11                 TNZ     AUTH_UNIX

      385     4200    3         THEN GOTO AUTH_UNIX;
      386     4201                                           /* Ensure that both auth's are all zero    */
      387     4202    3         IF RQSCTX.CALLHDR.AUTH_CRED THEN GOTO TOO_WEAK;

   4202 11 001063   000000 106500                    CMPC    fill='000'O
        11 001064   200035 000020                    ADSC9   RQSCTX+17,,AUTO          cn=0,n=16
        11 001065   000002 000002 xsym               ADSC9   B_VECTNIL+2              cn=0,n=2
        11 001066   001575 601000 11                 TNZ     TOO_WEAK

      388     4203    3         RQSCTX.BODY$ = ADDR( RQSCTX.CALLHDR.AUTH_VERF);

   4203 11 001067   200041 631500                    EPPR1   RQSCTX+21,,AUTO
        11 001070   200017 451500                    STP1    RQSCTX+3,,AUTO

      389     4204    3         GOTO PROGCHK;

   4204 11 001071   001466 710000 11                 TRA     PROGCHK
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:59   

      390     4205
      391     4206    3       CASE( %AUTH_UNIX);                  /* unix credential                    */

      392     4207    3   AUTH_UNIX:
      393     4208    3         T$ = PINCRC( ADDR(RQSCTX.CALLHDR.AUTH_UNIX.STAMP),

   4208 11 001072   204066 452500       AUTH_UNIX    STP2    @SOCK+3,,AUTO
        11 001073   200036 236100                    LDQ     RQSCTX+18,,AUTO
        11 001074   000020 736000                    QLS     16
        11 001075   000037 036003                    ADLQ    31,DU
        11 001076   204066 036100                    ADLQ    @SOCK+3,,AUTO
        11 001077   200013 756100                    STQ     T$,,AUTO

      394     4209    3           RQSCTX.CALLHDR.AUTH_UNIX.LEN);
      395     4210    3         IF T$ -> B$UBIN ~= %AUTH_NULL     /* Check AUTH_VERF for validity       */

   4210 11 001100   200013 471500                    LDP1    T$,,AUTO
        11 001101   100000 235100                    LDA     0,,PR1
        11 001102   001575 601000 11                 TNZ     TOO_WEAK
        11 001103   100001 235100                    LDA     1,,PR1
        11 001104   001575 601000 11                 TNZ     TOO_WEAK

      396     4211    3           OR PINCRW( T$, 1) -> B$UBIN ~= 0 THEN GOTO TOO_WEAK;
      397     4212    3         RQSCTX.BODY$ = PINCRW(T$,2);

   4212 11 001105   000002 036003                    ADLQ    2,DU
        11 001106   200017 756100                    STQ     RQSCTX+3,,AUTO

      398     4213    3         HCTX$ = FU_HCTX$;

   4213 11 001107   000321 236000 5                  LDQ     FU_HCTX$
        11 001110   200006 756100                    STQ     HCTX$,,AUTO

      399     4214    4         DO WHILE HCTX$ ~= ADDR(NIL);      /* then verify the hostname           */

   4214 11 001111   001126 710000 11                 TRA     s:4219
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:60   

      400     4215    4            IF HCTX.NAME.T = ADDR( RQSCTX.CALLHDR.AUTH_UNIX.NAME) -> TEXTW.T

   4215 11 001112   200006 470500                    LDP0    HCTX$,,AUTO
        11 001113   000030 720100                    LXL0    24,,PR0
        11 001114   200040 721100                    LXL1    RQSCTX+20,,AUTO
        11 001115   040140 106540                    CMPC    fill='040'O
        11 001116   000031 000010                    ADSC9   25,,PR0                  cn=0,n=*X0
        11 001117   200041 000011                    ADSC9   RQSCTX+21,,AUTO          cn=0,n=*X1
        11 001120   001124 601000 11                 TNZ     s:4218
        11 001121   000002 236100                    LDQ     2,,PR0
        11 001122   200024 116100                    CMPQ    RQSCTX+8,,AUTO
        11 001123   001130 600000 11                 TZE     s:4220

      401     4216    4              AND HCTX.S_ADDR = RQSCTX.FROMADDR.S_ADDR
      402     4217    4            THEN EXIT;
      403     4218    4            HCTX$ = HCTX.LNK$;

   4218 11 001124   000000 236100                    LDQ     0,,PR0
        11 001125   200006 756100                    STQ     HCTX$,,AUTO

      404     4219    4            END;

   4219 11 001126   000001 116000 xsym               CMPQ    B_VECTNIL+1
        11 001127   001112 601000 11                 TNZ     s:4215

      405     4220    4         IF HCTX$ = ADDR( NIL) THEN DO; /* current host not found in HCTX list   */

   4220 11 001130   200006 236100                    LDQ     HCTX$,,AUTO
        11 001131   000001 116000 xsym               CMPQ    B_VECTNIL+1
        11 001132   001240 601000 11                 TNZ     s:4245

      406     4221    4           CALL XSL$GETHOSTBYNAME( T$, ADDR(RQSCTX.CALLHDR.AUTH_UNIX.NAME)->TEXTW.LC.C
              4221                     );

   4221 11 001133   204070 452500                    STP2    @SOCK+5,,AUTO
        11 001134   204070 236100                    LDQ     @SOCK+5,,AUTO
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:61   
        11 001135   000023 036000 12                 ADLQ    19
        11 001136   204067 756100                    STQ     @SOCK+4,,AUTO
        11 001137   200013 630500                    EPPR0   T$,,AUTO
        11 001140   204066 450500                    STP0    @SOCK+3,,AUTO
        11 001141   204066 630500                    EPPR0   @SOCK+3,,AUTO
        11 001142   000020 631400 xsym               EPPR1   B_VECTNIL+16
        11 001143   000000 701000 xent               TSX1    XSL$GETHOSTBYNAME
        11 001144   000000 011000                    NOP     0

      407     4222    4            IF T$ = ADDR(NIL) THEN GOTO TOO_WEAK;

   4222 11 001145   200013 236100                    LDQ     T$,,AUTO
        11 001146   000001 116000 xsym               CMPQ    B_VECTNIL+1
        11 001147   001575 600000 11                 TZE     TOO_WEAK

      408     4223    4            T$ = T$->XSL$HOSTENT.H_ADDR_LIST$;

   4223 11 001150   200013 470500                    LDP0    T$,,AUTO
        11 001151   000004 236100                    LDQ     4,,PR0
        11 001152   200013 756100                    STQ     T$,,AUTO

      409     4224    4            IF T$->B$PTRA(0)->B$UBIN ~= RQSCTX.FROMADDR.S_ADDR

   4224 11 001153   200013 470500                    LDP0    T$,,AUTO
        11 001154   000000 471500                    LDP1    0,,PR0
        11 001155   100000 236100                    LDQ     0,,PR1
        11 001156   200024 116100                    CMPQ    RQSCTX+8,,AUTO
        11 001157   001176 600000 11                 TZE     s:4230

      410     4225    4            THEN IF T$->B$PTRA(1) = ADDR( NIL) THEN GOTO TOO_WEAK;

   4225 11 001160   000001 236100                    LDQ     1,,PR0
        11 001161   000001 116000 xsym               CMPQ    B_VECTNIL+1
        11 001162   001575 600000 11                 TZE     TOO_WEAK

      411     4226    4               ELSE IF T$->B$PTRA(1)->B$UBIN ~= RQSCTX.FROMADDR.S_ADDR

PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:62   
   4226 11 001163   000001 473500                    LDP3    1,,PR0
        11 001164   300000 236100                    LDQ     0,,PR3
        11 001165   200024 116100                    CMPQ    RQSCTX+8,,AUTO
        11 001166   001176 600000 11                 TZE     s:4230

      412     4227    4                  THEN IF T$->B$PTRA(2) = ADDR( NIL) THEN GOTO TOO_WEAK;

   4227 11 001167   000002 236100                    LDQ     2,,PR0
        11 001170   000001 116000 xsym               CMPQ    B_VECTNIL+1
        11 001171   001575 600000 11                 TZE     TOO_WEAK

      413     4228    4                     ELSE IF T$->B$PTRA(2)->B$UBIN ~= RQSCTX.FROMADDR.S_ADDR

   4228 11 001172   000002 474500                    LDP4    2,,PR0
        11 001173   400000 236100                    LDQ     0,,PR4
        11 001174   200024 116100                    CMPQ    RQSCTX+8,,AUTO
        11 001175   001575 601000 11                 TNZ     TOO_WEAK

      414     4229    4                        THEN GOTO TOO_WEAK;
      415     4230    4            IF FU_CTXHD$ = ADDR( NIL) THEN CALL FUA$GETCTX;

   4230 11 001176   000317 236000 5                  LDQ     FU_CTXHD$
        11 001177   000001 116000 xsym               CMPQ    B_VECTNIL+1
        11 001200   001204 601000 11                 TNZ     s:4231

   4230 11 001201   000002 631400 xsym               EPPR1   B_VECTNIL+2
        11 001202   000000 701000 xent               TSX1    FUA$GETCTX
        11 001203   000000 011000                    NOP     0

      416     4231    4            DS.HCNT = DS.HCNT + 1;         /* Get a new HCTX block               */

   4231 11 001204   000000 470400 2                  LDP0    B$DS8
        11 001205   000007 054100                    AOS     7,,PR0

      417     4232    4            HCTX$ = FU_CTXHD$;

   4232 11 001206   000317 236000 5                  LDQ     FU_CTXHD$
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:63   
        11 001207   200006 756100                    STQ     HCTX$,,AUTO

      418     4233    4            FU_CTXHD$ = HCTX.LNK$;

   4233 11 001210   200006 471500                    LDP1    HCTX$,,AUTO
        11 001211   100000 236100                    LDQ     0,,PR1
        11 001212   000317 756000 5                  STQ     FU_CTXHD$

      419     4234    4            HCTX.NAME.L = 0;

   4234 11 001213   100030 450100                    STZ     24,,PR1

      420     4235    4            HCTX = '0'B;

   4235 11 001214   100030 720100                    LXL0    24,,PR1
        11 001215   000144 621010                    EAX1    100,X0
        11 001216   000140 100400                    MLR     fill='000'O
        11 001217   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
        11 001220   100000 000011                    ADSC9   0,,PR1                   cn=0,n=*X1

      421     4236    4            HCTX.LNK$ = FU_HCTX$;

   4236 11 001221   000321 236000 5                  LDQ     FU_HCTX$
        11 001222   100000 756100                    STQ     0,,PR1

      422     4237    4            FU_HCTX$ = HCTX$;

   4237 11 001223   200006 236100                    LDQ     HCTX$,,AUTO
        11 001224   000321 756000 5                  STQ     FU_HCTX$

      423     4238    4            HCTX.UCTX$ = ADDR( NIL);

   4238 11 001225   000001 236000 xsym               LDQ     B_VECTNIL+1
        11 001226   100001 756100                    STQ     1,,PR1

      424     4239    4            HCTX.S_ADDR = RQSCTX.FROMADDR.S_ADDR;

PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:64   
   4239 11 001227   200024 235100                    LDA     RQSCTX+8,,AUTO
        11 001230   100002 755100                    STA     2,,PR1

      425     4240    4            HCTX.NAME.L = ADDR(RQSCTX.CALLHDR.AUTH_UNIX.NAME)->TEXTW.L;

   4240 11 001231   200040 235100                    LDA     RQSCTX+20,,AUTO
        11 001232   100030 755100                    STA     24,,PR1

      426     4241    4            HCTX.NAME.T = ADDR(RQSCTX.CALLHDR.AUTH_UNIX.NAME)->TEXTW.T;

   4241 11 001233   100030 720100                    LXL0    24,,PR1
        11 001234   200040 721100                    LXL1    RQSCTX+20,,AUTO
        11 001235   040140 100540                    MLR     fill='040'O
        11 001236   200041 000011                    ADSC9   RQSCTX+21,,AUTO          cn=0,n=*X1
        11 001237   100031 000010                    ADSC9   25,,PR1                  cn=0,n=*X0

      427     4242    4            END;

      428     4243
      429     4244                                           /* now rebuild AUTH_CRED in short form     */
      430     4245    3         T$ = PINCRW( ADDR(RQSCTX.CALLHDR.AUTH_UNIX.NAME),

   4245 11 001240   200040 236100                    LDQ     RQSCTX+20,,AUTO
        11 001241   000011 402007                    MPY     9,DL
        11 001242   000107 036007                    ADLQ    71,DL
        11 001243   000001 772000                    QRL     1
        11 001244   000022 506007                    DIV     18,DL
        11 001245   200040 630506                    EPPR0   RQSCTX+20,QL,AUTO
        11 001246   200013 450500                    STP0    T$,,AUTO

      431     4246    3           SIZEW( ADDR(RQSCTX.CALLHDR.AUTH_UNIX.NAME)->TEXTW));
      432     4247    3         IF (T$-> B$UBIN > BITBIN('377377'O)

   4247 11 001247   000000 235100                    LDA     0,,PR0
        11 001250   377400 115007                    CMPA    130816,DL
        11 001251   001255 602000 11                 TNC     s:4247+6
        11 001252   000000 236100                    LDQ     0,,PR0
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:65   
        11 001253   000422 116000 2                  CMPQ    FU_UCTX+47
        11 001254   001575 602000 11                 TNC     TOO_WEAK
        11 001255   000001 235100                    LDA     1,,PR0
        11 001256   377400 115007                    CMPA    130816,DL
        11 001257   001263 602000 11                 TNC     s:4252
        11 001260   000001 236100                    LDQ     1,,PR0
        11 001261   000422 116000 2                  CMPQ    FU_UCTX+47
        11 001262   001575 602000 11                 TNC     TOO_WEAK

      433     4248    3           AND T$-> B$UBIN < BITBIN('377377377376'O))
      434     4249    3           OR (PINCRW( T$,1)-> B$UBIN > BITBIN('377377'O)
      435     4250    3           AND PINCRW( T$,1)-> B$UBIN < BITBIN('377377377376'O))
      436     4251    3         THEN GOTO TOO_WEAK;               /* We don't support UID or GID > 64K  */
      437     4252    3         RQSCTX.CALLHDR.AUTH_CRED.U.UID = T$ -> B$UBIN;

   4252 11 001263   000000 720100                    LXL0    0,,PR0
        11 001264   200037 740100                    STX0    RQSCTX+19,,AUTO

      438     4253    3         RQSCTX.CALLHDR.AUTH_CRED.U.GID = PINCRW( T$, 1)-> B$UBIN;

   4253 11 001265   000001 721100                    LXL1    1,,PR0
        11 001266   200037 441100                    SXL1    RQSCTX+19,,AUTO

      439     4254    3         RQSCTX.CALLHDR.AUTH_CRED.LEN = 8;

   4254 11 001267   000010 235007                    LDA     8,DL
        11 001270   200036 755100                    STA     RQSCTX+18,,AUTO

      440     4255    3         RQSCTX.CALLHDR.AUTH_CRED.FLAVOR = %AUTH_SHORT;

   4255 11 001271   000002 236007                    LDQ     2,DL
        11 001272   200035 756100                    STQ     RQSCTX+17,,AUTO

      441     4256    3         RQSCTX.CALLHDR.AUTH_CRED.HID.SYSID = MYSYSID;

   4256 11 001273   000316 722000 5                  LXL2    MYSYSID
        11 001274   200040 442100                    SXL2    RQSCTX+20,,AUTO
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:66   

      442     4257    3         CALL XSL$HTONL (I, POFFW( HCTX$, B$DS8$) / 4);

   4257 11 001275   000000 235000 2                  LDA     B$DS8
        11 001276   000022 771000                    ARL     18
        11 001277   204066 755100                    STA     @SOCK+3,,AUTO
        11 001300   200006 236100                    LDQ     HCTX$,,AUTO
        11 001301   000022 772000                    QRL     18
        11 001302   204066 136100                    SBLQ    @SOCK+3,,AUTO
        11 001303   000004 506007                    DIV     4,DL
        11 001304   204067 756100                    STQ     @SOCK+4,,AUTO
        11 001305   204067 631500                    EPPR1   @SOCK+4,,AUTO
        11 001306   204071 451500                    STP1    @SOCK+6,,AUTO
        11 001307   200007 633500                    EPPR3   I,,AUTO
        11 001310   204070 453500                    STP3    @SOCK+5,,AUTO
        11 001311   204070 630500                    EPPR0   @SOCK+5,,AUTO
        11 001312   000020 631400 xsym               EPPR1   B_VECTNIL+16
        11 001313   000000 701000 xent               TSX1    XSL$HTONL
        11 001314   000000 011000                    NOP     0

      443     4258    3         RQSCTX.CALLHDR.AUTH_CRED.HID.HCTX = I;

   4258 11 001315   200007 720100                    LXL0    I,,AUTO
        11 001316   200040 740100                    STX0    RQSCTX+20,,AUTO
        11 001317   001321 710000 11                 TRA     s:4265

      444     4259
      445     4260    3       CASE( ELSE);

      446     4261    3         GOTO TOO_WEAK;

   4261 11 001320   001575 710000 11                 TRA     TOO_WEAK

      447     4262
      448     4263    3       END;                      /* do case (RQSCTX.CALLHDR.AUTH_CRED.FLAVOR)    */

      449     4264
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:67   
      450     4265    2      HCTX.MSGCNT = HCTX.MSGCNT + 1;

   4265 11 001321   200006 470500                    LDP0    HCTX$,,AUTO
        11 001322   000003 054100                    AOS     3,,PR0

      451     4266    2      HCTX.BYTESIN = HCTX.BYTESIN + RQSCTX.LEN;

   4266 11 001323   000004 236100                    LDQ     4,,PR0
        11 001324   200016 036100                    ADLQ    RQSCTX+2,,AUTO
        11 001325   000004 756100                    STQ     4,,PR0

      452     4267    2      RQSCTX.UCTX$ = HCTX.UCTX$;

   4267 11 001326   000001 236100                    LDQ     1,,PR0
        11 001327   200020 756100                    STQ     RQSCTX+4,,AUTO

      453     4268    3      DO WHILE RQSCTX.UCTX$ ~= ADDR( NIL); /* look for a UCTX for this user      */

   4268 11 001330   001344 710000 11                 TRA     s:4272

      454     4269    3         IF UCTX.USER.UID = RQSCTX.CALLHDR.AUTH_CRED.U.UID

   4269 11 001331   200020 470500                    LDP0    RQSCTX+4,,AUTO
        11 001332   200037 236100                    LDQ     RQSCTX+19,,AUTO
        11 001333   000022 772000                    QRL     18
        11 001334   000004 116100                    CMPQ    4,,PR0
        11 001335   001342 601000 11                 TNZ     s:4271
        11 001336   200037 236100                    LDQ     RQSCTX+19,,AUTO
        11 001337   777777 376007                    ANQ     -1,DL
        11 001340   000005 116100                    CMPQ    5,,PR0
        11 001341   001346 600000 11                 TZE     s:4274

      455     4270    3           AND UCTX.USER.GID = RQSCTX.CALLHDR.AUTH_CRED.U.GID THEN EXIT;
      456     4271    3         RQSCTX.UCTX$ = UCTX.HLNK$;

   4271 11 001342   000000 236100                    LDQ     0,,PR0
        11 001343   200020 756100                    STQ     RQSCTX+4,,AUTO
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:68   

      457     4272    3         END;

   4272 11 001344   000001 116000 xsym               CMPQ    B_VECTNIL+1
        11 001345   001331 601000 11                 TNZ     s:4269

      458     4273
      459     4274    3      IF RQSCTX.UCTX$ = ADDR( NIL) THEN DO; /* we need a new UCTX block          */

   4274 11 001346   200020 236100                    LDQ     RQSCTX+4,,AUTO
        11 001347   000001 116000 xsym               CMPQ    B_VECTNIL+1
        11 001350   001424 601000 11                 TNZ     s:4289

      460     4275    3         IF FU_CTXHD$ = ADDR( NIL) THEN CALL FUA$GETCTX;

   4275 11 001351   000317 236000 5                  LDQ     FU_CTXHD$
        11 001352   000001 116000 xsym               CMPQ    B_VECTNIL+1
        11 001353   001357 601000 11                 TNZ     s:4276

   4275 11 001354   000002 631400 xsym               EPPR1   B_VECTNIL+2
        11 001355   000000 701000 xent               TSX1    FUA$GETCTX
        11 001356   000000 011000                    NOP     0

      461     4276    3         DS.UCNT = DS.UCNT + 1;

   4276 11 001357   000000 470400 2                  LDP0    B$DS8
        11 001360   000010 054100                    AOS     8,,PR0

      462     4277    3         RQSCTX.UCTX$ = FU_CTXHD$;

   4277 11 001361   000317 236000 5                  LDQ     FU_CTXHD$
        11 001362   200020 756100                    STQ     RQSCTX+4,,AUTO

      463     4278    3         FU_CTXHD$ = UCTX.HLNK$;

   4278 11 001363   200020 471500                    LDP1    RQSCTX+4,,AUTO
        11 001364   100000 236100                    LDQ     0,,PR1
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:69   
        11 001365   000317 756000 5                  STQ     FU_CTXHD$

      464     4279    3         UCTX = FU_UCTX;

   4279 11 001366   000100 100400                    MLR     fill='000'O
        11 001367   000343 000220 2                  ADSC9   FU_UCTX                  cn=0,n=144
        11 001370   100000 000220                    ADSC9   0,,PR1                   cn=0,n=144

      465     4280    3         UCTX.HCTX$ = HCTX$;

   4280 11 001371   200006 236100                    LDQ     HCTX$,,AUTO
        11 001372   200020 471500                    LDP1    RQSCTX+4,,AUTO
        11 001373   100001 756100                    STQ     1,,PR1

      466     4281    3         UCTX.HLNK$ = HCTX.UCTX$;

   4281 11 001374   200006 471500                    LDP1    HCTX$,,AUTO
        11 001375   100001 236100                    LDQ     1,,PR1
        11 001376   200020 473500                    LDP3    RQSCTX+4,,AUTO
        11 001377   300000 756100                    STQ     0,,PR3

      467     4282    3         HCTX.UCTX$ = RQSCTX.UCTX$;

   4282 11 001400   200020 236100                    LDQ     RQSCTX+4,,AUTO
        11 001401   100001 756100                    STQ     1,,PR1

      468     4283    3         UCTX.USER.UID = RQSCTX.CALLHDR.AUTH_CRED.U.UID;

   4283 11 001402   200037 235100                    LDA     RQSCTX+19,,AUTO
        11 001403   000022 771000                    ARL     18
        11 001404   200020 473500                    LDP3    RQSCTX+4,,AUTO
        11 001405   300004 755100                    STA     4,,PR3

      469     4284    3         UCTX.USER.GID = RQSCTX.CALLHDR.AUTH_CRED.U.GID;

   4284 11 001406   200037 236100                    LDQ     RQSCTX+19,,AUTO
        11 001407   777777 376007                    ANQ     -1,DL
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:70   
        11 001410   200020 473500                    LDP3    RQSCTX+4,,AUTO
        11 001411   300005 756100                    STQ     5,,PR3

      470     4285    3         UCTX.FCTX$ = ADDR( NIL);

   4285 11 001412   000001 236000 xsym               LDQ     B_VECTNIL+1
        11 001413   200020 473500                    LDP3    RQSCTX+4,,AUTO
        11 001414   300003 756100                    STQ     3,,PR3

      471     4286    3         UCTX.FLNK$ = ADDR( NIL);

   4286 11 001415   200020 473500                    LDP3    RQSCTX+4,,AUTO
        11 001416   300002 756100                    STQ     2,,PR3

      472     4287    3         CALL FUS$LOOKUP( UCTX) ALTRET( TOO_WEAK);

   4287 11 001417   200020 630500                    EPPR0   RQSCTX+4,,AUTO
        11 001420   000017 631400 xsym               EPPR1   B_VECTNIL+15
        11 001421   000000 701000 xent               TSX1    FUS$LOOKUP
        11 001422   001575 702000 11                 TSX2    TOO_WEAK

      473     4288    3         END;

   4288 11 001423   001430 710000 11                 TRA     s:4291

      474     4289    2      ELSE IF UCTX.USER.REJECT THEN GOTO TOO_WEAK;

   4289 11 001424   200020 470500                    LDP0    RQSCTX+4,,AUTO
        11 001425   000013 236100                    LDQ     11,,PR0
        11 001426   002000 316003                    CANQ    1024,DU
        11 001427   001575 601000 11                 TNZ     TOO_WEAK

      475     4290
      476     4291    3      DO I = 0 TO SIZEW( HCTX.XIDS)-1;     /* see if we're retransmitting msg.   */

   4291 11 001430   200007 450100                    STZ     I,,AUTO
        11 001431   001444 710000 11                 TRA     s:4294+3
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:71   

      477     4292    3         IF RQSCTX.CALLHDR.XID = HCTX.XIDS( I)

   4292 11 001432   200006 470500                    LDP0    HCTX$,,AUTO
        11 001433   200007 720100                    LXL0    I,,AUTO
        11 001434   200027 236100                    LDQ     RQSCTX+11,,AUTO
        11 001435   000010 116110                    CMPQ    8,X0,PR0
        11 001436   001441 601000 11                 TNZ     s:4294

      478     4293    3         THEN RQSCTX.CALLHDR.REXMIT.F = '1'B;

   4293 11 001437   400000 236003                    LDQ     -131072,DU
        11 001440   200027 256100                    ORSQ    RQSCTX+11,,AUTO

      479     4294    3         END;

   4294 11 001441   200007 235100                    LDA     I,,AUTO
        11 001442   000001 035007                    ADLA    1,DL
        11 001443   200007 755100                    STA     I,,AUTO
        11 001444   200007 235100                    LDA     I,,AUTO
        11 001445   000020 115007                    CMPA    16,DL
        11 001446   001432 602000 11                 TNC     s:4292

      480     4295    3      IF NOT RQSCTX.CALLHDR.REXMIT.F THEN DO;

   4295 11 001447   200027 234100                    SZN     RQSCTX+11,,AUTO
        11 001450   001462 604000 11                 TMI     s:4299

      481     4296    3         HCTX.XIDS( HCTX.XIDX) = RQSCTX.CALLHDR.XID;

   4296 11 001451   200006 470500                    LDP0    HCTX$,,AUTO
        11 001452   000007 720100                    LXL0    7,,PR0
        11 001453   200027 236100                    LDQ     RQSCTX+11,,AUTO
        11 001454   000010 756110                    STQ     8,X0,PR0

      482     4297    3         HCTX.XIDX = MOD( HCTX.XIDX+1, SIZEW( HCTX.XIDS));

PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:72   
   4297 11 001455   000007 236100                    LDQ     7,,PR0
        11 001456   000001 036007                    ADLQ    1,DL
        11 001457   000017 376007                    ANQ     15,DL
        11 001460   000007 756100                    STQ     7,,PR0

      483     4298    3         END;

   4298 11 001461   001466 710000 11                 TRA     PROGCHK

      484     4299    2      ELSE HCTX.REXMITS = HCTX.REXMITS + 1;

   4299 11 001462   200006 470500                    LDP0    HCTX$,,AUTO
        11 001463   000006 235100                    LDA     6,,PR0
        11 001464   000001 035007                    ADLA    1,DL
        11 001465   000006 755100                    STA     6,,PR0

   4299 11 001466                       PROGCHK      null
      485     4300
      486     4301    2   PROGCHK: ;
      487     4302    2      I = POFFW( ADDR(SOCK), ADDR( FU_NFSSOCKET));

   4302 11 001466   000016 236000 12                 LDQ     14
        11 001467   000022 772000                    QRL     18
        11 001470   204066 756100                    STQ     @SOCK+3,,AUTO
        11 001471   204063 236100                    LDQ     @SOCK,,AUTO
        11 001472   000022 772000                    QRL     18
        11 001473   204066 136100                    SBLQ    @SOCK+3,,AUTO
        11 001474   200007 756100                    STQ     I,,AUTO

      488     4303    3      IF RQSCTX.CALLHDR.PROG# ~= FU_PROGNAME( I) THEN DO;

   4303 11 001475   000000 620006                    EAX0    0,QL
        11 001476   200032 236100                    LDQ     RQSCTX+14,,AUTO
        11 001477   000254 116010 2                  CMPQ    FU_PROGNAME,X0
        11 001500   001506 600000 11                 TZE     s:4307

      489     4304    3         RQSCTX.REPLYHDR.ACCEPT_STAT = %PROG_UNAVAIL;
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:73   

   4304 11 001501   000001 235007                    LDA     1,DL
        11 001502   200036 755100                    STA     RQSCTX+18,,AUTO

      490     4305    3         RQSCTX.LEN = 32;

   4305 11 001503   000040 235007                    LDA     32,DL
        11 001504   200016 755100                    STA     RQSCTX+2,,AUTO

      491     4306    3         END;

   4306 11 001505   001555 710000 11                 TRA     s:4324

      492     4307    3      ELSE IF RQSCTX.CALLHDR.VERS# ~= FU_PROGVERS( I) THEN DO;

   4307 11 001506   200007 720100                    LXL0    I,,AUTO
        11 001507   200033 236100                    LDQ     RQSCTX+15,,AUTO
        11 001510   000257 116010 2                  CMPQ    FU_PROGVERS,X0
        11 001511   001522 600000 11                 TZE     s:4313

      493     4308    3            RQSCTX.REPLYHDR.ACCEPT_STAT = %PROG_MISMATCH;

   4308 11 001512   000002 235007                    LDA     2,DL
        11 001513   200036 755100                    STA     RQSCTX+18,,AUTO

      494     4309    3            RQSCTX.REPLYHDR.PVERS_LOW = FU_PROGVERS( I);

   4309 11 001514   000257 235010 2                  LDA     FU_PROGVERS,X0
        11 001515   200037 755100                    STA     RQSCTX+19,,AUTO

      495     4310    3            RQSCTX.REPLYHDR.PVERS_HIGH = FU_PROGVERS( I);

   4310 11 001516   200040 755100                    STA     RQSCTX+20,,AUTO

      496     4311    3            RQSCTX.LEN = 40;

   4311 11 001517   000050 235007                    LDA     40,DL
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:74   
        11 001520   200016 755100                    STA     RQSCTX+2,,AUTO

      497     4312    3            END;

   4312 11 001521   001555 710000 11                 TRA     s:4324

      498     4313    3         ELSE IF RQSCTX.CALLHDR.PROC# > MAXPROC( I) THEN DO;

   4313 11 001522   000262 236010 2                  LDQ     MAXPROC,X0
        11 001523   200034 116100                    CMPQ    RQSCTX+16,,AUTO
        11 001524   001532 603000 11                 TRC     s:4318

      499     4314    3               RQSCTX.REPLYHDR.ACCEPT_STAT = %PROC_UNAVAIL;

   4314 11 001525   000003 235007                    LDA     3,DL
        11 001526   200036 755100                    STA     RQSCTX+18,,AUTO

      500     4315    3               RQSCTX.LEN = 32;

   4315 11 001527   000040 235007                    LDA     32,DL
        11 001530   200016 755100                    STA     RQSCTX+2,,AUTO

      501     4316    3               END;

   4316 11 001531   001555 710000 11                 TRA     s:4324

      502     4317    3            ELSE DO;

      503     4318    3               RQSCTX.REPLYHDR.ACCEPT_STAT = %SUCCESS;

   4318 11 001532   200036 450100                    STZ     RQSCTX+18,,AUTO

      504     4319    3               RQSCTX.PROC# = RQSCTX.CALLHDR.PROC#;

   4319 11 001533   200034 235100                    LDA     RQSCTX+16,,AUTO
        11 001534   200021 755100                    STA     RQSCTX+5,,AUTO

PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:75   
      505     4320    3               IF RQSCTX.PROC# = 0

   4320 11 001535   001541 601000 11                 TNZ     s:4322

      506     4321    3               THEN RQSCTX.LEN = 32;

   4321 11 001536   000040 235007                    LDA     32,DL
        11 001537   200016 755100                    STA     RQSCTX+2,,AUTO
        11 001540   001555 710000 11                 TRA     s:4324

      507     4322    3              ELSE RQSCTX.LEN = RQSCTX.LEN - POFFC( RQSCTX.BODY$, ADDR( RQSCTX.CALLHDR
              4322                        ));

   4322 11 001541   204066 452500                    STP2    @SOCK+3,,AUTO
        11 001542   204066 236100                    LDQ     @SOCK+3,,AUTO
        11 001543   000027 036003                    ADLQ    23,DU
        11 001544   000020 772000                    QRL     16
        11 001545   204067 756100                    STQ     @SOCK+4,,AUTO
        11 001546   200017 236100                    LDQ     RQSCTX+3,,AUTO
        11 001547   000020 772000                    QRL     16
        11 001550   204067 136100                    SBLQ    @SOCK+4,,AUTO
        11 001551   204070 756100                    STQ     @SOCK+5,,AUTO
        11 001552   200016 236100                    LDQ     RQSCTX+2,,AUTO
        11 001553   204070 136100                    SBLQ    @SOCK+5,,AUTO
        11 001554   200016 756100                    STQ     RQSCTX+2,,AUTO

      508     4323    3               END;

      509     4324    2      RQSCTX.REPLYHDR.AUTH_VERF_FLAVOR = %AUTH_SHORT;

   4324 11 001555   000002 235007                    LDA     2,DL
        11 001556   200032 755100                    STA     RQSCTX+14,,AUTO

      510     4325    2      RQSCTX.REPLYHDR.AUTH_VERF_LEN = 8;

   4325 11 001557   000010 236007                    LDQ     8,DL
        11 001560   200033 756100                    STQ     RQSCTX+15,,AUTO
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:76   

      511     4326    2      RQSCTX.REPLYHDR.AUTH_VERF_U = RQSCTX.CALLHDR.AUTH_CRED.U;

   4326 11 001561   200037 236100                    LDQ     RQSCTX+19,,AUTO
        11 001562   200034 756100                    STQ     RQSCTX+16,,AUTO

      512     4327    2      RQSCTX.REPLYHDR.AUTH_VERF_HID = RQSCTX.CALLHDR.AUTH_CRED.HID;

   4327 11 001563   200040 236100                    LDQ     RQSCTX+20,,AUTO
        11 001564   200035 756100                    STQ     RQSCTX+17,,AUTO

      513     4328    2      RQSCTX.REPLYHDR.REPLY_STAT = %MSG_ACCEPTED;

   4328 11 001565   200031 450100                    STZ     RQSCTX+13,,AUTO

      514     4329    2      IF RQSCTX.REPLYHDR.ACCEPT_STAT = %SUCCESS AND RQSCTX.PROC# ~= 0 THEN RETURN;

   4329 11 001566   200036 235100                    LDA     RQSCTX+18,,AUTO
        11 001567   001574 601000 11                 TNZ     s:4330
        11 001570   200021 235100                    LDA     RQSCTX+5,,AUTO
        11 001571   001574 600000 11                 TZE     s:4330

   4329 11 001572   204062 221300                    LDX1  ! RQSCTX+2086,,AUTO
        11 001573   000001 702211                    TSX2  ! 1,X1

      515     4330    2      GOTO REPLY;

   4330 11 001574   001605 710000 11                 TRA     REPLY

      516     4331
      517     4332    2   TOO_WEAK:
      518     4333    2      RQSCTX.REPLYHDR.AUTH_STAT = %AUTH_TOOWEAK;

   4333 11 001575   000005 235007       TOO_WEAK     LDA     5,DL
        11 001576   200033 755100                    STA     RQSCTX+15,,AUTO

      519     4334    2   AUTH_ERROR:
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:77   
      520     4335    2      RQSCTX.REPLYHDR.REJECT_STAT = %AUTH_ERROR;

   4335 11 001577   000001 236007       AUTH_ERROR   LDQ     1,DL
        11 001600   200032 756100                    STQ     RQSCTX+14,,AUTO

      521     4336    2      RQSCTX.LEN = 20;

   4336 11 001601   000024 235007                    LDA     20,DL
        11 001602   200016 755100                    STA     RQSCTX+2,,AUTO

      522     4337    2   DENY:
      523     4338    2      RQSCTX.REPLYHDR.REPLY_STAT = %MSG_DENIED;

   4338 11 001603   000001 236007       DENY         LDQ     1,DL
        11 001604   200031 756100                    STQ     RQSCTX+13,,AUTO

      524     4339    2   REPLY:
      525     4340    2      CALL XSL$QSENDTO( I, SOCK, RQSCTX.REPLYHDR, RQSCTX.LEN, 0,

   4340 11 001605   000024 236000 12    REPLY        LDQ     20
        11 001606   204074 756100                    STQ     @SOCK+9,,AUTO
        11 001607   200022 630500                    EPPR0   RQSCTX+6,,AUTO
        11 001610   204073 450500                    STP0    @SOCK+8,,AUTO
        11 001611   000021 236000 12                 LDQ     17
        11 001612   204072 756100                    STQ     @SOCK+7,,AUTO
        11 001613   200016 631500                    EPPR1   RQSCTX+2,,AUTO
        11 001614   204071 451500                    STP1    @SOCK+6,,AUTO
        11 001615   200027 633500                    EPPR3   RQSCTX+11,,AUTO
        11 001616   204070 453500                    STP3    @SOCK+5,,AUTO
        11 001617   204063 236100                    LDQ     @SOCK,,AUTO
        11 001620   204067 756100                    STQ     @SOCK+4,,AUTO
        11 001621   200007 634500                    EPPR4   I,,AUTO
        11 001622   204066 454500                    STP4    @SOCK+3,,AUTO
        11 001623   204066 630500                    EPPR0   @SOCK+3,,AUTO
        11 001624   000025 631400 xsym               EPPR1   B_VECTNIL+21
        11 001625   000000 701000 xent               TSX1    XSL$QSENDTO
        11 001626   000000 011000                    NOP     0
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:78   

      526     4341    2        RQSCTX.FROMADDR, 8);
      527     4342    2      CALL LOG;

   4342 11 001627   001642 701000 11                 TSX1    LOG
        11 001630   000000 011000                    NOP     0

      528     4343    2      IF HCTX$ ~= ADDR( NIL) THEN HCTX.BYTESOUT = HCTX.BYTESOUT + RQSCTX.LEN;

   4343 11 001631   200006 236100                    LDQ     HCTX$,,AUTO
        11 001632   000001 116000 xsym               CMPQ    B_VECTNIL+1
        11 001633   001640 600000 11                 TZE     RETALT

   4343 11 001634   200006 470500                    LDP0    HCTX$,,AUTO
        11 001635   000005 236100                    LDQ     5,,PR0
        11 001636   200016 036100                    ADLQ    RQSCTX+2,,AUTO
        11 001637   000005 756100                    STQ     5,,PR0

      529     4344    2   RETALT:
      530     4345    2      ALTRETURN;

   4345 11 001640   204062 221300       RETALT       LDX1  ! RQSCTX+2086,,AUTO
        11 001641   000000 702211                    TSX2  ! 0,X1

      531     4346
      532     4347    2   END GETREQUEST;
      533     4348
      534     4349        %EJECT;
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:79   
      535     4350        /*I*  NAME:    LOG
      536     4351              Purpose: To log an incoming event/message - update the byte/message
      537     4352                       counters, and if logging (debugging) set, then we write out the
      538     4353                       message to the file !SET to F$LOG.
      539     4354        */
      540     4355    1   LOG: PROC;

   4355 11 001642   204064 741300       LOG          STX1  ! @SOCK+1,,AUTO

      541     4356        %M$DCB( DCBN=F$LOG, RES='CR', FUN=CREATE, CTG=YES);
      542     4430        %FPT_WRITE( FPTN=WRITELOG, DCB=F$LOG);
      543     4461    2   DCL BUF CHAR(RQSCTX.LEN) BASED;
      544     4462    2   DCL NETADDR CHAR(8) BASED;
      545     4463    2   DCL SBASED SBIN BASED;
      546     4464
      547     4465    3      IF DS.MSGCNT = FU_MSGCNT THEN DO;

   4465 11 001643   000000 470400 2                  LDP0    B$DS8
        11 001644   000001 236100                    LDQ     1,,PR0
        11 001645   000324 116000 5                  CMPQ    FU_MSGCNT
        11 001646   001671 601000 11                 TNZ     s:4472

      548     4466    3         DS.BYTESOUT = DS.BYTESOUT + RQSCTX.LEN;

   4466 11 001647   000003 236100                    LDQ     3,,PR0
        11 001650   200016 036100                    ADLQ    RQSCTX+2,,AUTO
        11 001651   000003 756100                    STQ     3,,PR0

      549     4467    3         DS.P.BYTESOUT( FU_PROC#) = DS.P.BYTESOUT( FU_PROC#) + RQSCTX.LEN;

   4467 11 001652   000323 235000 5                  LDA     FU_PROC#
        11 001653   000004 735000                    ALS     4
        11 001654   000046 236105                    LDQ     38,AL,PR0
        11 001655   200016 036100                    ADLQ    RQSCTX+2,,AUTO
        11 001656   000046 756105                    STQ     38,AL,PR0

      550     4468    3         DS.P.MSGCNT( FU_PROC#) = DS.P.MSGCNT( FU_PROC#) + 1;
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:80   

   4468 11 001657   000323 235000 5                  LDA     FU_PROC#
        11 001660   000004 735000                    ALS     4
        11 001661   000044 054105                    AOS     36,AL,PR0

      551     4469    3         IF HCTX$ ~= ADDR( NIL) THEN HCTX.BYTESOUT = HCTX.BYTESOUT + RQSCTX.LEN;

   4469 11 001662   200006 236100                    LDQ     HCTX$,,AUTO
        11 001663   000001 116000 xsym               CMPQ    B_VECTNIL+1
        11 001664   001671 600000 11                 TZE     s:4472

   4469 11 001665   200006 471500                    LDP1    HCTX$,,AUTO
        11 001666   100005 236100                    LDQ     5,,PR1
        11 001667   200016 036100                    ADLQ    RQSCTX+2,,AUTO
        11 001670   100005 756100                    STQ     5,,PR1

      552     4470    3         END;

      553     4471
      554     4472    3      IF LOGGING AND ADDR( RQSCTX.LEN)-> SBASED> 0 THEN DO;

   4472 11 001671   000315 234000 5                  SZN     LOGGING
        11 001672   001730 605000 11                 TPL     s:4484
        11 001673   200016 235100                    LDA     RQSCTX+2,,AUTO
        11 001674   001730 604400 11                 TMOZ    s:4484

      555     4473    3         WRITELOG.V.DVBYTE.CONT# = '1'B;   /* prefix with S_PORT & S_ADDR        */

   4473 11 001675   001000 236003                    LDQ     512,DU
        11 001676   000351 256000 5                  ORSQ    WRITELOG+11

      556     4474    3         WRITELOG.BUF_ = VECTOR( ADDR( RQSCTX.FROMADDR.S_PORT)-> NETADDR);

   4474 11 001677   000025 235000 12                 LDA     21
        11 001700   204066 452500                    STP2    @SOCK+3,,AUTO
        11 001701   204066 236100                    LDQ     @SOCK+3,,AUTO
        11 001702   000023 036003                    ADLQ    19,DU
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:81   
        11 001703   000342 757000 5                  STAQ    WRITELOG+4

      557     4475    4         CALL M$WRITE( WRITELOG) WHENALTRETURN DO; END;

   4475 11 001704   000336 630400 5                  EPPR0   WRITELOG
        11 001705   440001 713400                    CLIMB   alt,write
        11 001706   401400 401760                    pmme    nvectors=4
        11 001707   001711 702000 11                 TSX2    s:4476
        11 001710   001711 710000 11                 TRA     s:4476

      558     4476    3         WRITELOG.V.DVBYTE.CONT# = '0'B;

   4476 11 001711   000026 236000 12                 LDQ     22
        11 001712   000351 356000 5                  ANSQ    WRITELOG+11

      559     4477
      560     4478    3         WRITELOG.BUF_ = VECTOR( ADDR( RQSCTX.CALLHDR)-> BUF);

   4478 11 001713   200016 235100                    LDA     RQSCTX+2,,AUTO
        11 001714   000020 735000                    ALS     16
        11 001715   000140 135007                    SBLA    96,DL
        11 001716   204066 452500                    STP2    @SOCK+3,,AUTO
        11 001717   204066 236100                    LDQ     @SOCK+3,,AUTO
        11 001720   000027 036003                    ADLQ    23,DU
        11 001721   000342 757000 5                  STAQ    WRITELOG+4

   4478 11 001722                       LOGIT        null
      561     4479    3   LOGIT: ;
      562     4480    4         CALL M$WRITE( WRITELOG) WHENALTRETURN DO;

   4480 11 001722   000336 630400 5                  EPPR0   WRITELOG
        11 001723   440001 713400                    CLIMB   alt,write
        11 001724   401400 401760                    pmme    nvectors=4
        11 001725   001727 702000 11                 TSX2    s:4481
        11 001726   001730 710000 11                 TRA     s:4484

      563     4481    4            LOGGING = '0'B;
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:82   

   4481 11 001727   000315 450000 5                  STZ     LOGGING

      564     4482    4            END;

      565     4483    3         END;

      566     4484    2      RETURN;

   4484 11 001730   204064 221300                    LDX1  ! @SOCK+1,,AUTO
        11 001731   000001 702211                    TSX2  ! 1,X1

      567     4485
      568     4486        /*I*  NAME:    LOGDO
      569     4487              Purpose: To write out the message just written to M$DO to F$LOG if
      570     4488                       logging is on.
      571     4489        */
      572     4490    2   LOGDO: ENTRY;

   4490 11 001732   204064 741300       LOGDO        STX1  ! @SOCK+1,,AUTO

      573     4491    2      WRITELOG.BUF_ = FPT_WRITE.BUF_;

   4491 11 001733   000124 237000 5                  LDAQ    FPT_WRITE+4
        11 001734   000342 757000 5                  STAQ    WRITELOG+4

      574     4492    2      IF LOGGING THEN GOTO LOGIT;

   4492 11 001735   000315 234000 5                  SZN     LOGGING
        11 001736   001722 604000 11                 TMI     LOGIT

      575     4493    2   END LOG;

   4493 11 001737   000001 702211                    TSX2  ! 1,X1

      576     4494
      577     4495        %EJECT;
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:83   
      578     4496        /*I*  NAME:    TSTAMP
      579     4497              Purpose: To print out the initial NFS header plus time to M$DO.
      580     4498        */
      581     4499    1   TSTAMP: PROC;

   4499 11 001740   204062 741300       TSTAMP       STX1  ! RQSCTX+2086,,AUTO

      582     4500    2      S_BUF = ' -*-*-';

   4500 11 001741   040000 100400                    MLR     fill='040'O
        11 001742   000423 000006 2                  ADSC9   FU_UCTX+48               cn=0,n=6
        11 001743   000206 000400 5                  ADSC9   S_BUF                    cn=0,n=256

      583     4501    2      CALL M$TIME( FPT_TIME);

   4501 11 001744   000076 630400 5                  EPPR0   FPT_TIME
        11 001745   020004 713400                    CLIMB   8196
        11 001746   402000 401760                    pmme    nvectors=5

      584     4502    2      S_TSTAMP.T.TRAIL = ' -*-*-';

   4502 11 001747   040000 100400                    MLR     fill='040'O
        11 001750   000423 000006 2                  ADSC9   FU_UCTX+48               cn=0,n=6
        11 001751   000213 200006 5                  ADSC9   S_BUF+5                  cn=1,n=6

      585     4503    2      FPT_WRITE.BUF_.BOUND = 26;

   4503 11 001752   000124 236000 5                  LDQ     FPT_WRITE+4
        11 001753   177777 376007                    ANQ     65535,DL
        11 001754   000027 276000 12                 ORQ     23
        11 001755   000124 756000 5                  STQ     FPT_WRITE+4

      586     4504    2      CALL M$WRITE( FPT_WRITE);

   4504 11 001756   000120 630400 5                  EPPR0   FPT_WRITE
        11 001757   040001 713400                    CLIMB   write
        11 001760   401400 401760                    pmme    nvectors=4
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:84   

      587     4505    2      CALL LOGDO;

   4505 11 001761   001732 701000 11                 TSX1    LOGDO
        11 001762   000000 011000                    NOP     0

      588     4506    2   END TSTAMP;

   4506 11 001763   204062 221300                    LDX1  ! RQSCTX+2086,,AUTO
        11 001764   000001 702211                    TSX2  ! 1,X1
      589     4507
      590     4508    1   END FUA$MAIN;
      591     4509        %EOD;

PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:85   
--  Include file information  --

   XSL_PERR_C.:LIBRARY  is referenced.
   XSL_SOCKET_M.:LIBRARY  is referenced.
   XSL_SOCKET_E.:LIBRARY  is referenced.
   SS_SCHED_C.:LIBRARY  is referenced.
   FU_NFS_M.:FUA2TOU  is referenced.
   FU_NFSSUBS_C.:FUA2TOU  is referenced.
   B$JIT.:LIBRARY  cannot be made into a system file and is referenced.
   B$TABLES_C.:LIBRARY  cannot be made into a system file and is referenced.
   CP_6_SUBS.:LIBRARY  is referenced.
   CP_6.:LIBRARY  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure FUA$MAIN.
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:86   

 **** Variables and constants ****

  ****  Section 002 RoData FUA$MAIN

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN        r     1 B$DS8                      0-0-0/w PTR         r     1 B$DS8$
     1-0-0/w STRC(4716)  r     1 CDS                      204-0-0/d STRC(144)   r     1 FPT_EXTEND
   216-0-0/d STRC(432)   r     1 FPT_MONINFO              210-0-0/d STRC(216)   r     1 FPT_XCON
   246-0-0/w STRC(216)   r     1 FUA_SOCKINIT             232-0-0/d STRC(432)   r     1 FU_FPT_TIME
   254-0-0/w UBIN        r     1 FU_PROGNAME(0:2)
   257-0-0/w UBIN        r     1 FU_PROGVERS(0:2)
   343-0-0/w STRC(1296)  r     1 FU_UCTX
   262-0-0/w UBIN        r     1 MAXPROC(0:2)

  ****  Section 005  Data  FUA$MAIN

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

   134-0-0/d STRC(936)   r     1 FPT_ERRMSG                76-0-0/d STRC(432)   r     1 FPT_TIME
   120-0-0/d STRC(432)   r     1 FPT_WRITE                317-0-0/w PTR         r     1 FU_CTXHD$
   322-0-0/w PTR         r     1 FU_FCTX$                 321-0-0/w PTR         r     1 FU_HCTX$
   320-0-0/w PTR         r     1 FU_MAXCTX$               310-0-0/w SBIN        r     1 FU_MOUNTSOCKET
   324-0-0/w SBIN        r     1 FU_MSGCNT                326-0-0/c CHAR(8)     r     1 FU_MYACCN
   330-0-0/c CHAR(12)    r     1 FU_MYUNAME               307-0-0/w SBIN        r     1 FU_NFSSOCKET
   334-0-0/w UBIN        r     1 FU_OPENLIM               311-0-0/w SBIN        r     1 FU_PMAPSOCKET
   312-0-0/w UBIN        r     1 FU_PORTNUM(0:2)
   323-0-0/w UBIN        r     1 FU_PROC#
   307-0-0/w SBIN        r     1 FU_SOCKET(0:0)
   325-0-0/w UBIN        r     1 FU_TIME                  333-0-0/w SBIN        r     1 FU_TIMEZONESECS
   315-0-0/b BIT         r     1 LOGGING                  316-0-0/w UBIN        r     1 MYSYSID
   166-0-0/d STRC(144)   r     1 REL_F$NETWORKS           172-0-0/d STRC(144)   r     1 REL_F$PROTOCOLS
   202-0-0/d STRC(144)   r     1 REL_F$ROUTES             176-0-0/d STRC(144)   r     1 REL_F$SERVICES
   306-0-0/b BIT         r     1 SELECT_MASK(0:35)
   206-0-0/c CHAR(256)   r     1 S_BUF                    206-0-0/c STRC(2304)  r     1 S_TSTAMP
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:87   
     0-0-0/d STRC(2232)  r     1 VLR_SITEINFO             112-0-0/d STRC(216)   r     1 WAIT_5_MINS
   336-0-0/d STRC(432)   r     1 WRITELOG

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

  4063-0-0/w PTR         r     1 @SOCK                      4-0-0/d DSCR        r     1 DSCR_
     6-0-0/w PTR         r     1 HCTX$                      7-0-0/w UBIN        r     1 I
     7-0-0/w SBIN        r     1 IS                        12-0-0/w UBIN        r     1 LASTCLOSE
    10-0-0/b BIT         r     1 REOPENIN_PORTS            14-0-0/w STRC(75096) r     1 RQSCTX
    11-0-0/b BIT         r     1 SELECT_RESULT(0:35)
    *0-0-0/w SBIN        r     1 SOCK                      13-0-0/w PTR         r     1 T$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$XL_UPPER$
     0-0-0/w UBIN        r     1 FUP_RQSSTT                 0-0-0/w STRC        r     1 XSL_ERR
     0-0-0/w SBIN        r     1 XSL_ERRNO

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/w PTR         r     1 B$PTRA(0:0)
     0-0-0/w UBIN        r     1 B$UBIN                     0-0-0/c ACHR        r     1 BUF
     0-0-0/w STRC(4716)  r     1 DS                         0-0-0/d ASTR(3528)  r     1 F$DCB
     0-0-0/d ASTR(3528)  r     1 F$LOG                      0-0-0N  NULL        r     1 F$NETWORKS
     0-0-0N  NULL        r     1 F$PROTOCOLS                0-0-0N  NULL        r     1 F$ROUTES
     0-0-0N  NULL        r     1 F$SERVICES                 0-0-0/w ASTR(900)   r     1 HCTX
     0-0-0N  NULL        r     1 M$DO                       0-0-0/d ASTR(3528)  r     1 M$DS
     0-0-0/c CHAR(8)     r     1 NETADDR                    0-0-0/w SBIN        r     1 SBASED
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:88   
     0-0-0/w ASTR        r     1 TEXTW                      0-0-0/w STRC(1296)  r     1 UCTX
     0-0-0/w STRC(180)   r     1 XSL$HOSTENT


   Procedure FUA$MAIN requires 1013 words for executable code.
   Procedure FUA$MAIN requires 2110 words of local(AUTO) storage.
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:89   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:90   
          MINI XREF LISTING

AUTH_ERROR IN PROCEDURE GETREQUEST
      4335**LABEL    4196--GOTO
AUTH_UNIX IN PROCEDURE GETREQUEST
      4208**LABEL    4200--GOTO
B$DS8
      1795**DCL      1796--REDEF
B$DS8$
      1796**DCL      1811--IMP-PTR  4006>>ASSIGN   4008>>ASSIGN   4009>>ASSIGN   4011>>ASSIGN   4065>>ASSIGN
      4070>>ASSIGN   4074>>ASSIGN   4117>>ASSIGN   4118>>ASSIGN   4119>>ASSIGN   4120>>ASSIGN   4121>>ASSIGN
      4122>>ASSIGN   4123>>IF       4128>>IF       4128>>IF       4128>>IF       4128>>IF       4128>>IF
      4130>>DOUNTIL  4131>>IF       4131>>IF       4131>>IF       4131>>IF       4133>>ASSIGN   4134>>ASSIGN
      4165>>ASSIGN   4165>>ASSIGN   4167>>ASSIGN   4184>>ASSIGN   4231>>ASSIGN   4231>>ASSIGN   4257>>CALL
      4276>>ASSIGN   4276>>ASSIGN   4465>>IF       4466>>ASSIGN   4466>>ASSIGN   4467>>ASSIGN   4467>>ASSIGN
      4468>>ASSIGN   4468>>ASSIGN
B$JIT.ACCESS.PACKS
      1100**DCL      4120>>ASSIGN
B$JIT.ACCN
       832**DCL      3996>>ASSIGN
B$JIT.CALCNT
      1006**DCL      4119>>ASSIGN
B$JIT.CPFLAGS1.SLEAZE
       926**DCL       926--REDEF
B$JIT.ERR.MID
       833**DCL       833--REDEF
B$JIT.JRESPEAK
       994**DCL       995--REDEF
B$JIT.LOGONTIME
       969**DCL      3994>>CALL
B$JIT.ORIGINATOR_PORT.FROM_CR
      1103**DCL      1103--REDEF    1104--REDEF
B$JIT.PNR
      1007**DCL      1007--REDEF
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:91   
B$JIT.PRIV.ACTIVE
       833**DCL      4000<<ASSIGN   4028<<ASSIGN   4037<<ASSIGN
B$JIT.PRIV.ACTIVE.JIT
       837**DCL      3987>>IF
B$JIT.SYSID
       832**DCL      4011>>ASSIGN
B$JIT.TPEXT
      1006**DCL      4122>>ASSIGN
B$JIT.TPSVT
      1006**DCL      4121>>ASSIGN
B$JIT.TSLINE
      1101**DCL      1102--REDEF
B$JIT.TUEXT
      1006**DCL      4122>>ASSIGN
B$JIT.TUSVT
      1006**DCL      4121>>ASSIGN
B$JIT.UNAME
       832**DCL      3997>>ASSIGN
B$JIT$
      1108**DCL       827--IMP-PTR  3987>>IF       3994>>CALL     3996>>ASSIGN   3997>>ASSIGN   4000>>ASSIGN
      4011>>ASSIGN   4028>>ASSIGN   4037>>ASSIGN   4119>>ASSIGN   4120>>ASSIGN   4121>>ASSIGN   4121>>ASSIGN
      4122>>ASSIGN   4122>>ASSIGN
B$PTRA
      3902**DCL      4224>>IF       4225>>IF       4226>>IF       4227>>IF       4228>>IF
B$UBIN
      3901**DCL      4210>>IF       4210>>IF       4224>>IF       4226>>IF       4228>>IF       4247>>IF
      4247>>IF       4247>>IF       4247>>IF       4252>>ASSIGN   4253>>ASSIGN
B$XL_UPPER$
       815**DCL       816--IMP-PTR
BUF IN PROCEDURE LOG
      4461**DCL      4478--ASSIGN
CDS
      1841**DCL      4008>>ASSIGN
DENY IN PROCEDURE GETREQUEST
      4338**LABEL    4177--GOTO
DO_SELECT
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:92   
      4065**LABEL    4136--GOTO     4140--GOTO
DS
      1811**DCL      4008<<ASSIGN
DS.BUFLIM
      1818**DCL      4131>>IF
DS.BYTESIN
      1815**DCL      4165<<ASSIGN   4165>>ASSIGN
DS.BYTESOUT
      1815**DCL      4466<<ASSIGN   4466>>ASSIGN
DS.CTXLIM
      1817**DCL      4128>>IF
DS.DCBLIM
      1818**DCL      4131>>IF
DS.FCNT
      1816**DCL      4128>>IF
DS.FCTX$
      1816**DCL      4118<<ASSIGN   4133>>ASSIGN
DS.HCNT
      1817**DCL      4128>>IF       4231<<ASSIGN   4231>>ASSIGN
DS.HCTX$
      1816**DCL      4117<<ASSIGN   4134>>ASSIGN
DS.MCNT
      1817**DCL      4128>>IF
DS.MOUNTPORT
      1815**DCL      4065<<ASSIGN
DS.MSGCNT
      1815**DCL      4167<<ASSIGN   4465>>IF
DS.OPENLIM
      1818**DCL      4070>>ASSIGN   4074>>ASSIGN   4123>>IF
DS.P.BYTESOUT
      1821**DCL      4467<<ASSIGN   4467>>ASSIGN
DS.P.DISKIOS
      1823**DCL      4120<<ASSIGN
DS.P.FCNT
      1822**DCL      4131>>IF
DS.P.MSGCNT
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:93   
      1821**DCL      4468<<ASSIGN   4468>>ASSIGN
DS.P.PMMECNT
      1822**DCL      4119<<ASSIGN
DS.P.STIME
      1823**DCL      4121<<ASSIGN
DS.P.SYSID
      1820**DCL      4011<<ASSIGN   4130>>DOUNTIL
DS.P.UCNT
      1822**DCL      4131>>IF
DS.P.XTIME
      1823**DCL      4122<<ASSIGN
DS.UCNT
      1817**DCL      4128>>IF       4276<<ASSIGN   4276>>ASSIGN
DSCR_
      3799**DCL      4006<<ASSIGN   4009>>ASSIGN
F$DCB.ACTPOS
       142**DCL       142--REDEF
F$DCB.ARS#
       116**DCL       116--REDEF
F$DCB.ATTR
       135**DCL       136--REDEF
F$DCB.BORROW
       150**DCL       150--REDEF     150--REDEF     150--REDEF
F$DCB.DCBNAME.L
       164**DCL       164--IMP-SIZ
F$DCB.EOMCHAR#
       120**DCL       120--REDEF
F$DCB.FLDID
       145**DCL       145--REDEF
F$DCB.FORM$
       139**DCL       139--REDEF
F$DCB.FSECT
       155**DCL       155--REDEF
F$DCB.FSN#
       132**DCL       132--REDEF     132--REDEF     133--REDEF
F$DCB.HEADER$
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:94   
       138**DCL       138--REDEF
F$DCB.IXTNSIZE#
       136**DCL       136--REDEF
F$DCB.LASTSTA$
       125**DCL       125--REDEF
F$DCB.LVL
       151**DCL       151--REDEF
F$DCB.NAME#.C
       126**DCL       126--REDEF
F$DCB.NOEOF
       148**DCL       148--REDEF
F$DCB.NRECS#
       137**DCL       137--REDEF
F$DCB.NRECX
       156**DCL       156--REDEF
F$DCB.OHDR
       148**DCL       148--REDEF
F$DCB.ORG#
       131**DCL       131--REDEF
F$DCB.PRECNO
       154**DCL       154--REDEF
F$DCB.RCSZ
       160**DCL       160--REDEF
F$DCB.RES#
       127**DCL       127--REDEF
F$DCB.SETX
       139**DCL       139--REDEF
F$DCB.TAB$
       139**DCL       139--REDEF
F$DCB.TDA
       153**DCL       154--REDEF
F$DCB.WSN#
       127**DCL       127--REDEF
F$LOG.ACTPOS IN PROCEDURE LOG
      4398**DCL      4398--REDEF
F$LOG.ARS# IN PROCEDURE LOG
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:95   
      4357**DCL      4357--REDEF
F$LOG.ATTR# IN PROCEDURE LOG
      4387**DCL      4387--REDEF    4389--REDEF
F$LOG.BORROW IN PROCEDURE LOG
      4409**DCL      4409--REDEF    4409--REDEF    4409--REDEF
F$LOG.DCBNAME.L IN PROCEDURE LOG
      4428**DCL      4428--IMP-SIZ
F$LOG.EOMCHAR# IN PROCEDURE LOG
      4364**DCL      4365--REDEF
F$LOG.FLDID IN PROCEDURE LOG
      4401**DCL      4402--REDEF
F$LOG.FORM$ IN PROCEDURE LOG
      4393**DCL      4393--REDEF
F$LOG.FSECT IN PROCEDURE LOG
      4416**DCL      4416--REDEF
F$LOG.FSN# IN PROCEDURE LOG
      4383**DCL      4383--REDEF    4383--REDEF    4384--REDEF
F$LOG.HEADER$ IN PROCEDURE LOG
      4392**DCL      4393--REDEF
F$LOG.IXTNSIZE# IN PROCEDURE LOG
      4389**DCL      4390--REDEF
F$LOG.LASTSTA$ IN PROCEDURE LOG
      4373**DCL      4373--REDEF
F$LOG.LVL IN PROCEDURE LOG
      4410**DCL      4410--REDEF
F$LOG.NAME#.C IN PROCEDURE LOG
      4373**DCL      4374--REDEF
F$LOG.NOEOF IN PROCEDURE LOG
      4405**DCL      4405--REDEF
F$LOG.NRECS# IN PROCEDURE LOG
      4390**DCL      4390--REDEF
F$LOG.NRECX IN PROCEDURE LOG
      4417**DCL      4417--REDEF
F$LOG.OHDR IN PROCEDURE LOG
      4406**DCL      4406--REDEF
F$LOG.ORG# IN PROCEDURE LOG
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:96   
      4381**DCL      4382--REDEF
F$LOG.PRECNO IN PROCEDURE LOG
      4414**DCL      4414--REDEF
F$LOG.RCSZ IN PROCEDURE LOG
      4422**DCL      4422--REDEF
F$LOG.RES# IN PROCEDURE LOG
      4375**DCL      4375--REDEF
F$LOG.SETX IN PROCEDURE LOG
      4394**DCL      4394--REDEF
F$LOG.TAB$ IN PROCEDURE LOG
      4393**DCL      4393--REDEF
F$LOG.TDA IN PROCEDURE LOG
      4413**DCL      4414--REDEF
F$LOG.WSN# IN PROCEDURE LOG
      4375**DCL      4376--REDEF
FPT_ERRMSG
      2017**DCL      4002<>CALL     4056<>CALL
FPT_ERRMSG.V
      2021**DCL      2017--DCLINIT
FPT_ERRMSG.V.SOURCE#
      2028**DCL      4053<<ASSIGN   4057<<ASSIGN
FPT_EXTEND
      1870**DCL      4001<>CALL
FPT_EXTEND.V
      1870**DCL      1870--DCLINIT
FPT_MONINFO
      1898**DCL      3998<>CALL
FPT_TIME
      1932**DCL      4501<>CALL
FPT_TIME.V
      1936**DCL      1932--DCLINIT
FPT_WRITE
      1991**DCL      3990<>CALL     4504<>CALL
FPT_WRITE.BUF_
      1991**DCL      4491>>ASSIGN
FPT_WRITE.BUF_.BOUND
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:97   
      1991**DCL      4503<<ASSIGN
FPT_WRITE.STATION_
      1993**DCL      1993--REDEF
FPT_WRITE.V
      1994**DCL      1991--DCLINIT
FPT_WRITE.V.DVBYTE.VFC#
      2000**DCL      2000--REDEF
FPT_XCON
      1884**DCL      3993<>CALL
FPT_XCON.V
      1885**DCL      1884--DCLINIT
FUA$GETCTX
      3574**DCL-ENT  4230--CALL     4275--CALL
FUA$XCON
      3575**DCL-ENT  1885--DCLINIT
FUA_SOCKINIT
      3412**DCL      4016<>CALL
FUG$GARBCOL
      3576**DCL-ENT  4132--CALL
FUM$MOUNTRQS
      3577**DCL-ENT  4112--CALL
FUN$CLOSE
      3578**DCL-ENT  4124--CALL
FUN$NFSRQS
      3579**DCL-ENT  4101--CALL
FUP$PMAPINIT
      3580**DCL-ENT  4033--CALL
FUP$PMAPRQS
      3581**DCL-ENT  4096--CALL     4106--CALL
FUP_RQSSTT
      3624**DCL      4075>>IF       4092>>IF
FUS$LOOKUP
      3582**DCL-ENT  4287--CALL
FU_CTXHD$
      3784**DCL      4230>>IF       4232>>ASSIGN   4233<<ASSIGN   4275>>IF       4277>>ASSIGN   4278<<ASSIGN
FU_FCTX.FID.ASN
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:98   
      3717**DCL      3718--REDEF
FU_FCTX.FOFFSET
      3726**DCL      3726--REDEF
FU_FCTX$
      3787**DCL      4118>>ASSIGN   4133<<ASSIGN
FU_FPT_TIME
      1966**DCL      4012<>CALL     4091<>CALL     4164<>CALL
FU_FPT_TIME.V
      1970**DCL      1966--DCLINIT
FU_HCTX$
      3786**DCL      4117>>ASSIGN   4134<<ASSIGN   4213>>ASSIGN   4236>>ASSIGN   4237<<ASSIGN
FU_MAXCTX$
      3785**DCL      4009<<ASSIGN   4186>>IF
FU_MOUNTSOCKET
      3615**DCL      4111<>CALL
FU_MSGCNT
      3789**DCL      4163<<ASSIGN   4163>>ASSIGN   4167>>ASSIGN   4465>>IF
FU_MYACCN
      3791**DCL      3996<<ASSIGN
FU_MYUNAME
      3792**DCL      3997<<ASSIGN
FU_NFSSOCKET
      3613**DCL      3614--REDEF    4100<>CALL     4302--ASSIGN
FU_OPENLIM
      3794**DCL      4070<<ASSIGN
FU_PMAPSOCKET
      3616**DCL      4105<>CALL     4108>>IF       4108>>ASSIGN   4199--IF
FU_PORTNUM
      3623**DCL      4023<>CALL     4039>>IF       4043<>CALL     4065>>ASSIGN
FU_PROC#
      3788**DCL      4011>>ASSIGN   4119>>ASSIGN   4120>>ASSIGN   4121>>ASSIGN   4122>>ASSIGN   4467>>ASSIGN
      4467>>ASSIGN   4468>>ASSIGN   4468>>ASSIGN
FU_PROGNAME
      3617**DCL      4303>>IF
FU_PROGVERS
      3619**DCL      4307>>IF       4309>>ASSIGN   4310>>ASSIGN
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:99   
FU_SOCKET
      3614**DCL      4024<>CALL     4026<>CALL     4029<>CALL     4032<>CALL     4038>>ASSIGN   4041<>CALL
      4082<>CALL     4083<>CALL     4084<>CALL
FU_TIME
      3790**DCL      1970--DCLINIT  4013>>ASSIGN   4073>>IF       4123>>IF       4125>>ASSIGN
FU_TIMEZONESECS
      3793**DCL      3999<<ASSIGN
FU_UCTX
      3743**DCL      4279>>ASSIGN
FU_UCTX.FFLG#
      3773**DCL      3773--REDEF
FU_UCTX.FILEPOS
      3777**DCL      3778--REDEF
FU_UCTX.FILEPOS.FOFFSET
      3777**DCL      3778--REDEF
GETREQUEST
      4152**PROC     4100--CALL     4105--CALL     4111--CALL
HCTX
      3923**DCL      4235<<ASSIGN
HCTX.BYTESIN
      3928**DCL      4266<<ASSIGN   4266>>ASSIGN
HCTX.BYTESOUT
      3928**DCL      4343<<ASSIGN   4343>>ASSIGN   4469<<ASSIGN   4469>>ASSIGN
HCTX.LNK$
      3927**DCL      4218>>ASSIGN   4233>>ASSIGN   4236<<ASSIGN
HCTX.MSGCNT
      3927**DCL      4265<<ASSIGN   4265>>ASSIGN
HCTX.NAME.L
      3929**DCL      3930--IMP-SIZ  4215>>IF       4234<<ASSIGN   4235>>ASSIGN   4240<<ASSIGN   4241>>ASSIGN
HCTX.NAME.T
      3930**DCL      4215>>IF       4241<<ASSIGN
HCTX.REXMITS
      3928**DCL      4299<<ASSIGN   4299>>ASSIGN
HCTX.S_ADDR
      3927**DCL      4186>>IF       4215>>IF       4239<<ASSIGN
HCTX.UCTX$
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:100  
      3927**DCL      4238<<ASSIGN   4267>>ASSIGN   4281>>ASSIGN   4282<<ASSIGN
HCTX.XIDS
      3929**DCL      4291--DOINDEX  4292>>IF       4296<<ASSIGN   4297--ASSIGN
HCTX.XIDX
      3929**DCL      4296>>ASSIGN   4297<<ASSIGN   4297>>ASSIGN
HCTX$
      3800**DCL      3923--IMP-PTR  3995<<ASSIGN   4168<<ASSIGN   4184<<ASSIGN   4186>>IF       4186>>IF
      4213<<ASSIGN   4214>>DOWHILE  4215>>IF       4215>>IF       4215>>IF       4218<<ASSIGN   4218>>ASSIGN
      4220>>IF       4232<<ASSIGN   4233>>ASSIGN   4234>>ASSIGN   4235>>ASSIGN   4235>>ASSIGN   4236>>ASSIGN
      4237>>ASSIGN   4238>>ASSIGN   4239>>ASSIGN   4240>>ASSIGN   4241>>ASSIGN   4241>>ASSIGN   4257>>CALL
      4265>>ASSIGN   4265>>ASSIGN   4266>>ASSIGN   4266>>ASSIGN   4267>>ASSIGN   4280>>ASSIGN   4281>>ASSIGN
      4282>>ASSIGN   4292>>IF       4296>>ASSIGN   4296>>ASSIGN   4297>>ASSIGN   4297>>ASSIGN   4299>>ASSIGN
      4299>>ASSIGN   4343>>IF       4343>>ASSIGN   4343>>ASSIGN   4469>>IF       4469>>ASSIGN   4469>>ASSIGN
I
      3801**DCL      3802--REDEF    4022<<DOINDEX  4023>>CALL     4024>>CALL     4026>>CALL     4028>>IF
      4029>>CALL     4030>>IF       4032>>CALL     4038>>ASSIGN   4039>>IF       4073<<ASSIGN   4074<<ASSIGN
      4075<<ASSIGN   4076<>CALL     4076<>CALL     4129<<ASSIGN   4130>>DOUNTIL  4131>>IF       4131>>IF
      4138<<ASSIGN   4138>>ASSIGN   4158<<ASSIGN   4159<>CALL     4182<<ASSIGN   4183<>CALL     4183<>CALL
      4184>>ASSIGN   4257<>CALL     4258>>ASSIGN   4291<<DOINDEX  4292>>IF       4302<<ASSIGN   4303>>IF
      4307>>IF       4309>>ASSIGN   4310>>ASSIGN   4313>>IF       4340<>CALL
IS
      3802**DCL      4077>>IF
LASTCLOSE
      3805**DCL      4013<<ASSIGN   4073>>IF       4123>>IF       4125<<ASSIGN   4126<<ASSIGN   4126>>ASSIGN
LOG
      4355**PROC     4034--CALL     4097--CALL     4102--CALL     4107--CALL     4113--CALL     4166--CALL
      4342--CALL
LOGDO IN PROCEDURE LOG
      4490**ENTRY    4505--CALL
LOGGING
      3782**DCL      4472>>IF       4481<<ASSIGN   4492>>IF
LOGIT IN PROCEDURE LOG
      4478**LABEL    4492--GOTO
M$DS.ACTPOS
      1763**DCL      1763--REDEF
M$DS.ARS#
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:101  
      1722**DCL      1722--REDEF
M$DS.ATTR#
      1752**DCL      1752--REDEF    1754--REDEF
M$DS.BORROW
      1774**DCL      1774--REDEF    1774--REDEF    1774--REDEF
M$DS.DCBNAME.L
      1793**DCL      1793--IMP-SIZ
M$DS.EOMCHAR#
      1729**DCL      1730--REDEF
M$DS.FLDID
      1766**DCL      1767--REDEF
M$DS.FORM$
      1758**DCL      1758--REDEF
M$DS.FSECT
      1781**DCL      1781--REDEF
M$DS.FSN#
      1748**DCL      1748--REDEF    1748--REDEF    1749--REDEF
M$DS.HEADER$
      1757**DCL      1758--REDEF
M$DS.IXTNSIZE#
      1754**DCL      1755--REDEF
M$DS.LASTSTA$
      1738**DCL      1738--REDEF
M$DS.LVL
      1775**DCL      1775--REDEF
M$DS.NAME#.C
      1738**DCL      1739--REDEF
M$DS.NOEOF
      1770**DCL      1770--REDEF
M$DS.NRECS#
      1755**DCL      1755--REDEF
M$DS.NRECX
      1782**DCL      1782--REDEF
M$DS.OHDR
      1771**DCL      1771--REDEF
M$DS.ORG#
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:102  
      1746**DCL      1747--REDEF
M$DS.PRECNO
      1779**DCL      1779--REDEF
M$DS.RCSZ
      1787**DCL      1787--REDEF
M$DS.RES#
      1740**DCL      1740--REDEF
M$DS.SETX
      1759**DCL      1759--REDEF
M$DS.TAB$
      1758**DCL      1758--REDEF
M$DS.TDA
      1778**DCL      1779--REDEF
M$DS.WSN#
      1740**DCL      1741--REDEF
M$ERRMSG
       100**DCL-ENT  4002--CALL     4056--CALL
M$MONINFO
       105**DCL-ENT  3998--CALL
M$REW
        40**DCL-ENT  4001--CALL
M$TIME
       104**DCL-ENT  4012--CALL     4091--CALL     4164--CALL     4501--CALL
M$WAIT
        95**DCL-ENT  4080--CALL
M$WRITE
        38**DCL-ENT  3990--CALL     4475--CALL     4480--CALL     4504--CALL
M$XCON
        92**DCL-ENT  3993--CALL
M$XXX
        49**DCL-ENT  3991--CALL     4003--CALL
MAXPROC
      3621**DCL      4313>>IF
MONERR
      4050**LABEL    4016--CALLALT
MYSYSID
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:103  
      3783**DCL      3994<>CALL     4186>>IF       4193>>IF       4256>>ASSIGN
NETADDR IN PROCEDURE LOG
      4462**DCL      4474--ASSIGN
NO_BIND
      4047**LABEL    4030--GOTO     4032--CALLALT
NO_SETSOCKOPT
      4046**LABEL    4026--CALLALT
NO_SOCKET
      4046**LABEL    4024--CALLALT
OPEN_PORTS
      4015**LABEL    4085--GOTO
PROGCHK IN PROCEDURE GETREQUEST
      4299**LABEL    4204--GOTO
PURGE
      4132**LABEL    4128--GOTO
REL_F$NETWORKS.V
      2044**DCL      2044--DCLINIT
REL_F$PROTOCOLS.V
      2058**DCL      2058--DCLINIT
REL_F$ROUTES.V
      2086**DCL      2086--DCLINIT
REL_F$SERVICES.V
      2072**DCL      2072--DCLINIT
REOPENIN_PORTS
      3803**DCL      4014<<ASSIGN   4080>>IF       4081<<ASSIGN   4088<<ASSIGN
REOPEN_PORTS
      4080**LABEL    4072--GOTO
REPLY IN PROCEDURE GETREQUEST
      4340**LABEL    4330--GOTO
RETALT IN PROCEDURE GETREQUEST
      4345**LABEL    4155--GOTO     4156--GOTO     4159--CALLALT
RQSCTX
      3822**DCL      4015<<ASSIGN   4033<>CALL     4096<>CALL     4101<>CALL     4106<>CALL     4112<>CALL
      4132<>CALL     4135<<ASSIGN
RQSCTX.BODY
      3895**DCL      4185--ASSIGN
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:104  
RQSCTX.BODY$
      3826**DCL      4185<<ASSIGN   4203<<ASSIGN   4212<<ASSIGN   4322>>ASSIGN
RQSCTX.CALLHDR
      3883**DCL      3888--REDEF    4159<>CALL     4322--ASSIGN   4478--ASSIGN
RQSCTX.CALLHDR.AUTH_CRED
      3885**DCL      3887--REDEF    4202>>IF
RQSCTX.CALLHDR.AUTH_CRED.FLAVOR
      3885**DCL      4180>>DOCASE   4255<<ASSIGN
RQSCTX.CALLHDR.AUTH_CRED.HID
      3886**DCL      4327>>ASSIGN
RQSCTX.CALLHDR.AUTH_CRED.HID.HCTX
      3886**DCL      4182>>ASSIGN   4258<<ASSIGN
RQSCTX.CALLHDR.AUTH_CRED.HID.SYSID
      3886**DCL      4186>>IF       4193>>IF       4256<<ASSIGN
RQSCTX.CALLHDR.AUTH_CRED.LEN
      3885**DCL      4186>>IF       4254<<ASSIGN
RQSCTX.CALLHDR.AUTH_CRED.U
      3885**DCL      4326>>ASSIGN
RQSCTX.CALLHDR.AUTH_CRED.U.GID
      3886**DCL      4253<<ASSIGN   4269>>IF       4284>>ASSIGN
RQSCTX.CALLHDR.AUTH_CRED.U.UID
      3885**DCL      4252<<ASSIGN   4269>>IF       4283>>ASSIGN
RQSCTX.CALLHDR.AUTH_UNIX.LEN
      3887**DCL      4208>>ASSIGN
RQSCTX.CALLHDR.AUTH_UNIX.NAME
      3888**DCL      4215--IF       4215--IF       4221--CALL     4240--ASSIGN   4241--ASSIGN   4241--ASSIGN
      4245--ASSIGN   4245--ASSIGN   4245--ASSIGN
RQSCTX.CALLHDR.AUTH_UNIX.STAMP
      3887**DCL      4208--ASSIGN
RQSCTX.CALLHDR.AUTH_VERF
      3888**DCL      4203--ASSIGN
RQSCTX.CALLHDR.AUTH_VERF.FLAVOR
      3888**DCL      4186>>IF
RQSCTX.CALLHDR.AUTH_VERF.LEN
      3888**DCL      4186>>IF
RQSCTX.CALLHDR.PROC#
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:105  
      3884**DCL      4199>>IF       4313>>IF       4319>>ASSIGN
RQSCTX.CALLHDR.PROG#
      3884**DCL      4303>>IF
RQSCTX.CALLHDR.REXMIT.F
      3883**DCL      4293<<ASSIGN   4295>>IF
RQSCTX.CALLHDR.RPCVERS
      3884**DCL      4172>>IF
RQSCTX.CALLHDR.TYPE
      3883**DCL      4095<<ASSIGN   4170>>IF       4171<<ASSIGN
RQSCTX.CALLHDR.VERS#
      3884**DCL      4307>>IF
RQSCTX.CALLHDR.XID
      3883**DCL      3883--REDEF    4292>>IF       4296>>ASSIGN
RQSCTX.FROMADDR
      3848**DCL      4029<>CALL     4032<>CALL     4041<>CALL     4158--ASSIGN   4159<>CALL     4340<>CALL
RQSCTX.FROMADDR.SA_FAMILY
      3861**DCL      4021<<ASSIGN
RQSCTX.FROMADDR.S_ADDR
      3880**DCL      4186>>IF       4215>>IF       4224>>IF       4226>>IF       4228>>IF       4239>>ASSIGN
RQSCTX.FROMADDR.S_PORT
      3870**DCL      4023<>CALL     4031<<ASSIGN   4043<>CALL     4474--ASSIGN
RQSCTX.LEN
      3826**DCL      4040<<ASSIGN   4041<>CALL     4041<>CALL     4093<<ASSIGN   4159<>CALL     4165>>ASSIGN
      4176<<ASSIGN   4266>>ASSIGN   4305<<ASSIGN   4311<<ASSIGN   4315<<ASSIGN   4321<<ASSIGN   4322<<ASSIGN
      4322>>ASSIGN   4336<<ASSIGN   4340<>CALL     4343>>ASSIGN   4461--IMP-SIZ  4466>>ASSIGN   4467>>ASSIGN
      4469>>ASSIGN   4472--IF       4478>>ASSIGN
RQSCTX.PROC#
      3827**DCL      4094<<ASSIGN   4169<<ASSIGN   4319<<ASSIGN   4320>>IF       4329>>IF
RQSCTX.REPLYHDR
      3888**DCL      4340<>CALL
RQSCTX.REPLYHDR.ACCEPT_STAT
      3893**DCL      4304<<ASSIGN   4308<<ASSIGN   4314<<ASSIGN   4318<<ASSIGN   4329>>IF
RQSCTX.REPLYHDR.AUTH_STAT
      3890**DCL      4194<<ASSIGN   4195<<ASSIGN   4333<<ASSIGN
RQSCTX.REPLYHDR.AUTH_VERF_FLAVOR
      3890**DCL      4324<<ASSIGN
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:106  
RQSCTX.REPLYHDR.AUTH_VERF_HID
      3892**DCL      3892--REDEF    3892--REDEF    4327<<ASSIGN
RQSCTX.REPLYHDR.AUTH_VERF_LEN
      3891**DCL      4325<<ASSIGN
RQSCTX.REPLYHDR.AUTH_VERF_U
      3891**DCL      4326<<ASSIGN
RQSCTX.REPLYHDR.PVERS_HIGH
      3894**DCL      3894--REDEF    4310<<ASSIGN
RQSCTX.REPLYHDR.PVERS_LOW
      3893**DCL      3893--REDEF    3894--REDEF    4309<<ASSIGN
RQSCTX.REPLYHDR.REJECT_STAT
      3889**DCL      3889--REDEF    3890--REDEF    4173<<ASSIGN   4335<<ASSIGN
RQSCTX.REPLYHDR.REPLY_STAT
      3889**DCL      4328<<ASSIGN   4338<<ASSIGN
RQSCTX.REPLYHDR.VERS_HIGH
      3891**DCL      3891--REDEF    3891--REDEF    4175<<ASSIGN
RQSCTX.REPLYHDR.VERS_LOW
      3890**DCL      3890--REDEF    3891--REDEF    4174<<ASSIGN
RQSCTX.UCTX$
      3827**DCL      3947--IMP-PTR  4267<<ASSIGN   4268>>DOWHILE  4269>>IF       4269>>IF       4271<<ASSIGN
      4271>>ASSIGN   4274>>IF       4277<<ASSIGN   4278>>ASSIGN   4279>>ASSIGN   4280>>ASSIGN   4281>>ASSIGN
      4282>>ASSIGN   4283>>ASSIGN   4284>>ASSIGN   4285>>ASSIGN   4286>>ASSIGN   4287>>CALL     4289>>IF
SBASED IN PROCEDURE LOG
      4463**DCL      4472>>IF
SELECT_MASK
      3611**DCL      4020<<ASSIGN   4038<<ASSIGN   4071>>ASSIGN   4108<<ASSIGN
SELECT_RESULT
      3804**DCL      4071<<ASSIGN   4072>>IF       4076<>CALL     4077>>IF       4090>>IF       4126>>IF
      4156>>IF
SOCK IN PROCEDURE GETREQUEST
      4153**DCL      4152--PROC     4155>>IF       4156>>IF       4159<>CALL     4199--IF       4302--ASSIGN
      4340<>CALL
S_BUF
      3602**DCL      1992--DCLINIT  1993--DCLINIT  2018--DCLINIT  3603--REDEF    3989<<ASSIGN   4500<<ASSIGN
S_TSTAMP.DATE
      3605**DCL      1932--DCLINIT  1933--DCLINIT
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:107  
S_TSTAMP.T.TRAIL
      3609**DCL      4502<<ASSIGN
S_TSTAMP.TIME
      3606**DCL      1934--DCLINIT  1935--DCLINIT  3607--REDEF
T$
      3806**DCL      4026<>CALL     4029<>CALL     4032<>CALL     4082<>CALL     4083<>CALL     4084<>CALL
      4208<<ASSIGN   4210>>IF       4210>>IF       4212>>ASSIGN   4221<>CALL     4222>>IF       4223<<ASSIGN
      4223>>ASSIGN   4224>>IF       4225>>IF       4226>>IF       4227>>IF       4228>>IF       4245<<ASSIGN
      4247>>IF       4247>>IF       4247>>IF       4247>>IF       4252>>ASSIGN   4253>>ASSIGN
TEXTW
      3903**DCL      4245--ASSIGN
TEXTW.L
      3904**DCL      3905--REDEF    3908--IMP-SIZ  4215>>IF       4240>>ASSIGN   4241>>ASSIGN   4245>>ASSIGN
TEXTW.LC.C
      3907**DCL      4221<>CALL
TEXTW.T
      3908**DCL      4215>>IF       4241>>ASSIGN
TOO_WEAK IN PROCEDURE GETREQUEST
      4333**LABEL    4202--GOTO     4211--GOTO     4222--GOTO     4225--GOTO     4227--GOTO     4229--GOTO
      4251--GOTO     4261--GOTO     4287--CALLALT  4289--GOTO
TSTAMP
      4499**PROC     4010--CALL
UCTX
      3947**DCL      4279<<ASSIGN   4287<>CALL
UCTX.FCTX$
      3951**DCL      4285<<ASSIGN
UCTX.FFLG#
      3977**DCL      3977--REDEF
UCTX.FILEPOS
      3981**DCL      3982--REDEF
UCTX.FILEPOS.FOFFSET
      3981**DCL      3982--REDEF
UCTX.FLNK$
      3951**DCL      4286<<ASSIGN
UCTX.HCTX$
      3951**DCL      4280<<ASSIGN
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:108  
UCTX.HLNK$
      3951**DCL      4271>>ASSIGN   4278>>ASSIGN   4281<<ASSIGN
UCTX.USER.GID
      3972**DCL      4269>>IF       4284<<ASSIGN
UCTX.USER.REJECT
      3974**DCL      4289>>IF
UCTX.USER.UID
      3972**DCL      4269>>IF       4283<<ASSIGN
VLR_SITEINFO.UTC_OFFSET#
      1919**DCL      3999>>ASSIGN
WAIT_5_MINS
      1951**DCL      4080<>CALL
WAIT_5_MINS.V
      1952**DCL      1951--DCLINIT
WRITELOG IN PROCEDURE LOG
      4447**DCL      4475<>CALL     4480<>CALL
WRITELOG.BUF_ IN PROCEDURE LOG
      4447**DCL      4474<<ASSIGN   4478<<ASSIGN   4491<<ASSIGN
WRITELOG.STATION_ IN PROCEDURE LOG
      4449**DCL      4449--REDEF
WRITELOG.V IN PROCEDURE LOG
      4450**DCL      4447--DCLINIT
WRITELOG.V.DVBYTE.CONT# IN PROCEDURE LOG
      4458**DCL      4473<<ASSIGN   4476<<ASSIGN
WRITELOG.V.DVBYTE.VFC# IN PROCEDURE LOG
      4456**DCL      4456--REDEF
XSL$GETHOSTBYNAME
      3584**DCL-ENT  4221--CALL
XSL$HOSTENT.H_ADDR_LIST$
      3392**DCL      4223>>ASSIGN
XSL$HTONL
      3585**DCL-ENT  3994--CALL     4257--CALL
XSL$HTONS
      3587**DCL-ENT  4023--CALL
XSL$NTOHL
      3586**DCL-ENT  4183--CALL
PL6.E3A0      #001=FUA$MAIN File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:31 Page:109  
XSL$NTOHS
      3588**DCL-ENT  4043--CALL
XSL$QBIND
      3589**DCL-ENT  4029--CALL     4032--CALL
XSL$QCLOSE
      3590**DCL-ENT  4082--CALL     4083--CALL     4084--CALL
XSL$QGETSOCKNAME
      3591**DCL-ENT  4041--CALL
XSL$QRECVFROM
      3592**DCL-ENT  4159--CALL
XSL$QSELECT
      3593**DCL-ENT  4076--CALL
XSL$QSENDTO
      3594**DCL-ENT  4340--CALL
XSL$QSETSOCKOPT
      3595**DCL-ENT  4026--CALL
XSL$QSOCKET
      3596**DCL-ENT  4024--CALL
XSL$SOCKINIT
      3597**DCL-ENT  4016--CALL
XSL_ERR.FCG
      3600**DCL      4052<<ASSIGN
XSL_ERRNO
      3599**DCL      2017--DCLINIT  3600--REDEF    4050>>IF       4051<<ASSIGN   4051>>ASSIGN

PL6.E3A0      #002=FUA$GETCTX File=FUA$MAIN.:FUA2TSI                             FRI 11/21/97 11:32 Page:110  
      592        1        /*T***********************************************************/
      593        2        /*T*                                                         */
      594        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      595        4        /*T*                                                         */
      596        5        /*T***********************************************************/
      597        6        /*F*  NAME: FUA$GETCTX
      598        7              Purpose:
      599        8                    Extends or initializes the shared data segment.
      600        9        */
      601       10        FUA$GETCTX: PROC;
      602       11
      603       12        %INCLUDE CP_6;
      604       93        %FPT_EXTEND( STCLASS=SYMREF);
      605      107    1   DCL FU_CTXHD$ PTR SYMREF;
      606      108    1   DCL FU_MAXCTX$ PTR SYMREF;
      607      109    1   DCL 1 MAXCTX REDEF FU_MAXCTX$,
      608      110    1         2 * BIT(8),2 PAGEOFFSET BIT(10),2 * BIT(18);
      609      111    1   DCL B$DS8 PTR SYMREF;
      610      112        %EQU CTXSIZ = 64;
      611      113    1   DCL FU_OPENLIM UBIN SYMREF;
      612      114
      613      115    1   DCL LNK$ PTR BASED ALIGNED;
      614      116    1   DCL CTX$ PTR;
      615      117
      616      118    2      IF MAXCTX.PAGEOFFSET THEN CALL M$EXTEND( FPT_EXTEND) WHENRETURN DO;
      617      119    2            CTX$ = PINCRW( FU_MAXCTX$, %CTXSIZ);
      618      120    2            FU_MAXCTX$ = PINCRW( FU_MAXCTX$, 1024);
      619      121    2            END;
      620      122    2         WHENALTRETURN DO;
      621      123    2            CALL M$MERC;
      622      124    2            CALL M$XXX;
      623      125    2            RETURN;
      624      126    2            END;
      625      127    2      ELSE DO;
      626      128    2         CTX$ = PINCRW( B$DS8, %CTXSIZ);
      627      129    2         FU_MAXCTX$ = PINCRW( FU_MAXCTX$, -%CTXSIZ);
      628      130    2         END;
PL6.E3A0      #002=FUA$GETCTX File=FUA$MAIN.:FUA2TSI                             FRI 11/21/97 11:32 Page:111  
      629      131
      630      132    1      FU_CTXHD$ = CTX$;               /* allocate a linked list of free blocks   */
      631      133    2      DO UNTIL CTX$ = FU_MAXCTX$;
      632      134    2         CTX$ -> LNK$ = PINCRW( CTX$, %CTXSIZ);
      633      135    2         CTX$ = PINCRW( CTX$, %CTXSIZ);
      634      136    2         END;
      635      137    1      CTX$ -> LNK$ = ADDR( NIL);
      636      138    1      RETURN;
      637      139    1   END FUA$GETCTX;
      638      140        %EOD;

PL6.E3A0      #002=FUA$GETCTX File=FUA$MAIN.:FUA2TSI                             FRI 11/21/97 11:32 Page:112  
--  Include file information  --

   CP_6.:LIBRARY  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure FUA$GETCTX.

   Procedure FUA$GETCTX requires 41 words for executable code.
   Procedure FUA$GETCTX requires 4 words of local(AUTO) storage.

PL6.E3A0      #002=FUA$GETCTX File=FUA$MAIN.:FUA2TSI                             FRI 11/21/97 11:32 Page:113  

 Object Unit name= FUA$GETCTX                                 File name= FUA$MAIN.:FUA2TOU
 UTS= NOV 21 '97 11:32:36.28 FRI                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   Proc  even  none    41     51  FUA$GETCTX

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        0  FUA$GETCTX

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
                       nStd      0 X66_AUTO_0
                       nStd      0 X66_ARET
                       Std       0 B_CONSPOOL_D

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  FPT_EXTEND                            FU_CTXHD$
     FU_MAXCTX$                            B$DS8                                 B_VECTNIL
PL6.E3A0      #002=FUA$GETCTX File=FUA$MAIN.:FUA2TSI                             FRI 11/21/97 11:32 Page:114  


      592        1        /*T***********************************************************/
      593        2        /*T*                                                         */
      594        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      595        4        /*T*                                                         */
      596        5        /*T***********************************************************/
      597        6        /*F*  NAME: FUA$GETCTX
      598        7              Purpose:
      599        8                    Extends or initializes the shared data segment.
      600        9        */
      601       10        FUA$GETCTX: PROC;

     10  1 000000   000000 700200 xent  FUA$GETCTX   TSX0  ! X66_AUTO_0
         1 000001   000004 000000                    ZERO    4,0

      602       11
      603       12        %INCLUDE CP_6;
      604       93        %FPT_EXTEND( STCLASS=SYMREF);
      605      107    1   DCL FU_CTXHD$ PTR SYMREF;
      606      108    1   DCL FU_MAXCTX$ PTR SYMREF;
      607      109    1   DCL 1 MAXCTX REDEF FU_MAXCTX$,
      608      110    1         2 * BIT(8),2 PAGEOFFSET BIT(10),2 * BIT(18);
      609      111    1   DCL B$DS8 PTR SYMREF;
      610      112        %EQU CTXSIZ = 64;
      611      113    1   DCL FU_OPENLIM UBIN SYMREF;
      612      114
      613      115    1   DCL LNK$ PTR BASED ALIGNED;
      614      116    1   DCL CTX$ PTR;
      615      117
      616      118    2      IF MAXCTX.PAGEOFFSET THEN CALL M$EXTEND( FPT_EXTEND) WHENRETURN DO;

    118  1 000002   000000 236000 xsym               LDQ     FU_MAXCTX$
         1 000003   001777 316003                    CANQ    1023,DU
         1 000004   000026 600000 1                  TZE     s:128

    118  1 000005   000000 630400 xsym               EPPR0   FPT_EXTEND
         1 000006   440005 713400                    CLIMB   alt,+16389
PL6.E3A0      #002=FUA$GETCTX File=FUA$MAIN.:FUA2TSI                             FRI 11/21/97 11:32 Page:115  
         1 000007   400000 401760                    pmme    nvectors=1
         1 000010   000020 702000 1                  TSX2    s:123

      617      119    2            CTX$ = PINCRW( FU_MAXCTX$, %CTXSIZ);

    119  1 000011   000000 236000 xsym               LDQ     FU_MAXCTX$
         1 000012   000100 036003                    ADLQ    64,DU
         1 000013   200003 756100                    STQ     CTX$,,AUTO

      618      120    2            FU_MAXCTX$ = PINCRW( FU_MAXCTX$, 1024);

    120  1 000014   000000 236000 xsym               LDQ     FU_MAXCTX$
         1 000015   002000 036003                    ADLQ    1024,DU
         1 000016   000000 756000 xsym               STQ     FU_MAXCTX$

      619      121    2            END;

    121  1 000017   000025 710000 1                  TRA     s:125+1

      620      122    2         WHENALTRETURN DO;

      621      123    2            CALL M$MERC;

    123  1 000020   010007 713400                    CLIMB   4103
         1 000021   000000 401760                    pmme    nvectors=0

      622      124    2            CALL M$XXX;

    124  1 000022   000003 713400                    CLIMB   3
         1 000023   000000 401760                    pmme    nvectors=0

      623      125    2            RETURN;

    125  1 000024   000000 702200 xent               TSX2  ! X66_ARET
         1 000025   000034 710000 1                  TRA     s:132

      624      126    2            END;
PL6.E3A0      #002=FUA$GETCTX File=FUA$MAIN.:FUA2TSI                             FRI 11/21/97 11:32 Page:116  
      625      127    2      ELSE DO;

      626      128    2         CTX$ = PINCRW( B$DS8, %CTXSIZ);

    128  1 000026   000000 236000 xsym               LDQ     B$DS8
         1 000027   000100 036003                    ADLQ    64,DU
         1 000030   200003 756100                    STQ     CTX$,,AUTO

      627      129    2         FU_MAXCTX$ = PINCRW( FU_MAXCTX$, -%CTXSIZ);

    129  1 000031   000000 236000 xsym               LDQ     FU_MAXCTX$
         1 000032   777700 036003                    ADLQ    -64,DU
         1 000033   000000 756000 xsym               STQ     FU_MAXCTX$

      628      130    2         END;

      629      131
      630      132    1      FU_CTXHD$ = CTX$;               /* allocate a linked list of free blocks   */

    132  1 000034   200003 236100                    LDQ     CTX$,,AUTO
         1 000035   000000 756000 xsym               STQ     FU_CTXHD$

      631      133    2      DO UNTIL CTX$ = FU_MAXCTX$;

      632      134    2         CTX$ -> LNK$ = PINCRW( CTX$, %CTXSIZ);

    134  1 000036   200003 236100                    LDQ     CTX$,,AUTO
         1 000037   000100 036003                    ADLQ    64,DU
         1 000040   200003 470500                    LDP0    CTX$,,AUTO
         1 000041   000000 756100                    STQ     0,,PR0

      633      135    2         CTX$ = PINCRW( CTX$, %CTXSIZ);

    135  1 000042   200003 756100                    STQ     CTX$,,AUTO

      634      136    2         END;

PL6.E3A0      #002=FUA$GETCTX File=FUA$MAIN.:FUA2TSI                             FRI 11/21/97 11:32 Page:117  
    136  1 000043   000000 116000 xsym               CMPQ    FU_MAXCTX$
         1 000044   000036 601000 1                  TNZ     s:134

      635      137    1      CTX$ -> LNK$ = ADDR( NIL);

    137  1 000045   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000046   200003 470500                    LDP0    CTX$,,AUTO
         1 000047   000000 756100                    STQ     0,,PR0

      636      138    1      RETURN;

    138  1 000050   000000 702200 xent               TSX2  ! X66_ARET
      637      139    1   END FUA$GETCTX;
      638      140        %EOD;

PL6.E3A0      #002=FUA$GETCTX File=FUA$MAIN.:FUA2TSI                             FRI 11/21/97 11:32 Page:118  
--  Include file information  --

   CP_6.:LIBRARY  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is never referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure FUA$GETCTX.
PL6.E3A0      #002=FUA$GETCTX File=FUA$MAIN.:FUA2TSI                             FRI 11/21/97 11:32 Page:119  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 CTX$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$DS8                      0-0-0/d STRC(144)   r     1 FPT_EXTEND
     0-0-0/w PTR         r     1 FU_CTXHD$                  0-0-0/w PTR         r     1 FU_MAXCTX$
     0-0-0/w STRC        r     1 MAXCTX

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 LNK$


   Procedure FUA$GETCTX requires 41 words for executable code.
   Procedure FUA$GETCTX requires 4 words of local(AUTO) storage.
PL6.E3A0      #002=FUA$GETCTX File=FUA$MAIN.:FUA2TSI                             FRI 11/21/97 11:32 Page:120  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=FUA$GETCTX File=FUA$MAIN.:FUA2TSI                             FRI 11/21/97 11:32 Page:121  
          MINI XREF LISTING

B$DS8
       111**DCL       128>>ASSIGN
CTX$
       116**DCL       119<<ASSIGN    128<<ASSIGN    132>>ASSIGN    133>>DOUNTIL   134>>ASSIGN    134>>ASSIGN
       135<<ASSIGN    135>>ASSIGN    137>>ASSIGN
FPT_EXTEND
       104**DCL       118<>CALL
FU_CTXHD$
       107**DCL       132<<ASSIGN
FU_MAXCTX$
       108**DCL       109--REDEF     119>>ASSIGN    120<<ASSIGN    120>>ASSIGN    129<<ASSIGN    129>>ASSIGN
       133>>DOUNTIL
LNK$
       115**DCL       134<<ASSIGN    137<<ASSIGN
M$EXTEND
        25**DCL-ENT   118--CALL
M$MERC
        77**DCL-ENT   123--CALL
M$XXX
        33**DCL-ENT   124--CALL
MAXCTX.PAGEOFFSET
       110**DCL       118>>IF

PL6.E3A0      #003=FUA$XCON File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:32 Page:122  
      639        1        /*T***********************************************************/
      640        2        /*T*                                                         */
      641        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      642        4        /*T*                                                         */
      643        5        /*T***********************************************************/
      644        6        /*F*  NAME: FUA$XCON
      645        7              Purpose:
      646        8                    NFS exit control procedure - closes all DCBs.
      647        9        */
      648       10        FUA$XCON: PROC ASYNC;
      649       11
      650       12        %INCLUDE B$JIT;
      651      302        %INCLUDE CP_6;
      652      383        %INCLUDE FU_NFS_M;
      653      898    1   DCL B$JIT$ PTR SYMREF READONLY;
      654      899    1   DCL B$DS8 PTR SYMREF READONLY;
      655      900    1   DCL FU_TIME UBIN SYMREF;
      656      901        %FPT_XCON( STCLASS=CONSTANT, FPTN=NOXCON);
      657      915        %FU$NFSDS( NAME=DS, STCLASS="BASED(B$DS8)");
      658      945    1   DCL FU_OPENLIM UBIN SYMREF;
      659      946
      660      947    1   DCL FUN$CLOSE ENTRY;
      661      948
      662      949    1      FU_TIME = FU_TIME + FU_OPENLIM;
      663      950    1      CALL FUN$CLOSE;
      664      951    1      IF B$JIT.XCONF THEN CALL M$MERCS;
      665      952    1      CALL M$XCON( NOXCON);
      666      953    1   END FUA$XCON;

PL6.E3A0      #003=FUA$XCON File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:32 Page:123  
--  Include file information  --

   FU_NFS_M.:FUA2TOU  is referenced.
   CP_6.:LIBRARY  cannot be made into a system file and is referenced.
   B$JIT.:LIBRARY  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure FUA$XCON.

   Procedure FUA$XCON requires 18 words for executable code.
   Procedure FUA$XCON requires 4 words of local(AUTO) storage.

    No errors detected in file FUA$MAIN.:FUA2TSI    .

PL6.E3A0      #003=FUA$XCON File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:32 Page:124  

 Object Unit name= FUA$XCON                                   File name= FUA$MAIN.:FUA2TOU
 UTS= NOV 21 '97 11:32:41.52 FRI                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1  RoData even  UTS      6      6  FUA$XCON
    2   Proc  even  none    18     22  FUA$XCON

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     2      0   yes            yes     Async       0  FUA$XCON

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       0 FUN$CLOSE
                       nStd      0 X66_AAUTO
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                             r    B$JIT$                           r    B$DS8
     FU_TIME                               FU_OPENLIM                            B_VECTNIL
PL6.E3A0      #003=FUA$XCON File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:32 Page:125  

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID
PL6.E3A0      #003=FUA$XCON File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:32 Page:126  


      639        1        /*T***********************************************************/
      640        2        /*T*                                                         */
      641        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      642        4        /*T*                                                         */
      643        5        /*T***********************************************************/
      644        6        /*F*  NAME: FUA$XCON
      645        7              Purpose:
      646        8                    NFS exit control procedure - closes all DCBs.
      647        9        */
      648       10        FUA$XCON: PROC ASYNC;

     10  2 000000   000000 700200 xent  FUA$XCON     TSX0  ! X66_AAUTO
         2 000001   000004 000000                    ZERO    4,0

      649       11
      650       12        %INCLUDE B$JIT;
      651      302        %INCLUDE CP_6;
      652      383        %INCLUDE FU_NFS_M;
      653      898    1   DCL B$JIT$ PTR SYMREF READONLY;
      654      899    1   DCL B$DS8 PTR SYMREF READONLY;
      655      900    1   DCL FU_TIME UBIN SYMREF;
      656      901        %FPT_XCON( STCLASS=CONSTANT, FPTN=NOXCON);
      657      915        %FU$NFSDS( NAME=DS, STCLASS="BASED(B$DS8)");
      658      945    1   DCL FU_OPENLIM UBIN SYMREF;
      659      946
      660      947    1   DCL FUN$CLOSE ENTRY;
      661      948
      662      949    1      FU_TIME = FU_TIME + FU_OPENLIM;

    949  2 000002   000000 236000 xsym               LDQ     FU_TIME
         2 000003   000000 036000 xsym               ADLQ    FU_OPENLIM
         2 000004   000000 756000 xsym               STQ     FU_TIME

      663      950    1      CALL FUN$CLOSE;

    950  2 000005   000002 631400 xsym               EPPR1   B_VECTNIL+2
PL6.E3A0      #003=FUA$XCON File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:32 Page:127  
         2 000006   000000 701000 xent               TSX1    FUN$CLOSE
         2 000007   000000 011000                    NOP     0

      664      951    1      IF B$JIT.XCONF THEN CALL M$MERCS;

    951  2 000010   000000 470400 xsym               LDP0    B$JIT$
         2 000011   000316 236100                    LDQ     206,,PR0
         2 000012   777000 316003                    CANQ    -512,DU
         2 000013   000016 600000 2                  TZE     s:952

    951  2 000014   010014 713400                    CLIMB   4108
         2 000015   000000 401760                    pmme    nvectors=0

      665      952    1      CALL M$XCON( NOXCON);

    952  2 000016   000000 630400 1                  EPPR0   NOXCON
         2 000017   010003 713400                    CLIMB   4099
         2 000020   400400 401760                    pmme    nvectors=2

      666      953    1   END FUA$XCON;

    953  2 000021   000000 702200 xent               TSX2  ! X66_AARET

PL6.E3A0      #003=FUA$XCON File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:32 Page:128  
--  Include file information  --

   FU_NFS_M.:FUA2TOU  is referenced.
   CP_6.:LIBRARY  cannot be made into a system file and is referenced.
   B$JIT.:LIBRARY  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure FUA$XCON.
PL6.E3A0      #003=FUA$XCON File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:32 Page:129  

 **** Variables and constants ****

  ****  Section 001 RoData FUA$XCON

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(216)   r     1 NOXCON

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$DS8                      0-0-0/w PTR         r     1 B$JIT$
     0-0-0/w UBIN        r     1 FU_OPENLIM                 0-0-0/w UBIN        r     1 FU_TIME

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)  r     1 B$JIT


   Procedure FUA$XCON requires 18 words for executable code.
   Procedure FUA$XCON requires 4 words of local(AUTO) storage.

    No errors detected in file FUA$MAIN.:FUA2TSI    .
PL6.E3A0      #003=FUA$XCON File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:32 Page:130  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=FUA$XCON File=FUA$MAIN.:FUA2TSI                               FRI 11/21/97 11:32 Page:131  
          MINI XREF LISTING

B$DS8
       899**DCL       929--IMP-PTR
B$JIT.CPFLAGS1.SLEAZE
       120**DCL       120--REDEF
B$JIT.ERR.MID
        27**DCL        27--REDEF
B$JIT.JRESPEAK
       188**DCL       189--REDEF
B$JIT.ORIGINATOR_PORT.FROM_CR
       297**DCL       297--REDEF     298--REDEF
B$JIT.PNR
       201**DCL       201--REDEF
B$JIT.TSLINE
       295**DCL       296--REDEF
B$JIT.XCONF
       247**DCL       951>>IF
B$JIT$
       898**DCL        21--IMP-PTR   951>>IF
FUN$CLOSE
       947**DCL-ENT   950--CALL
FU_OPENLIM
       945**DCL       949>>ASSIGN
FU_TIME
       900**DCL       949<<ASSIGN    949>>ASSIGN
M$MERCS
       368**DCL-ENT   951--CALL
M$XCON
       366**DCL-ENT   952--CALL
NOXCON
       912**DCL       952<>CALL
NOXCON.V
       913**DCL       912--DCLINIT
