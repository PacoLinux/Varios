VERSION E05

PL6.E3A0      #001=KHI$DWNLODCCP File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:29 Page:1    
        1        1        /*M* KHI$CLCIO - Communications line controller IO routines */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IAD=3,IND=0 */
        8        8        /*P*
        9        9        NAME: KHI$CLCIO
       10       10        PURPOSE:  Do communications line controller IO.
       11       11        */
       12       12
       13       13        KHI$DWNLODCCP: PROC(KH$DWNLODCCP) ALTRET;
       14       14
       15       15        /*F* NAME: KHI$DWNLODCCP - Down Load CCPs into MLCPs
       16       16
       17       17        This routine does a block mode write to the
       18       18        specified channel to down-load the specified CCP.
       19       19        IOs yielding IO NAKs are re-tried, and errors are logged.
       20       20        If an irrecoverable IO error occurs, KH$CHN.DED (channel dead)
       21       21        will be set, and the ALTRET will be taken.
       22       22
       23       23        The form of the call for this service is:
       24       24
       25       25        .fif
       26       26           CALL KHI$DWMLODCCP(kh$dwnlodccp) ALTRET(error);
       27       27        .fin
       28       28
       29       29        where:
       30       30        */
       31       31
       32       32        /*K* kh$dwnlodccp -
       33       33        is the structure defined by the KH$DWNLODCCP macro,
       34       34        which is in file KH$IO.
       35       35        See the description of KH$DWNLODCCP for details.
       36       36        */
       37       37
PL6.E3A0      #001=KHI$DWNLODCCP File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:29 Page:2    
       38       38
       39       39        /* INCLUDEs */
       40       40
       41       41        %INCLUDE LCP_6;
       42      232        %INCLUDE GH_IOFNC_E;
       43      301        %INCLUDE KH$CHN;
       44      423        %INCLUDE KH_ERRORS_C;
       45      434        %INCLUDE KH$IO;
       46      681 S      %INCLUDE KV$GLB;
       47      682
       48      683        /* Declare external routines needed. */
       49      684
       50      685    1   DCL KHD$ERRLOG_SETTERMID_CHN ENTRY (2) OPTIONAL ALTRET;
       51      686    1   DCL KHI$IO_INP ENTRY(2) ALTRET;
       52      687    1   DCL KHI$IO_OTP ENTRY(2) ALTRET;
       53      688    1   DCL KHI$IOLD ENTRY(2) ALTRET;
       54      689    1   DCL KHI$IOLD_FNC ENTRY(2) ALTRET;
       55      690    1   DCL KHI$RLCCCPLCT ENTRY(1) ALTRET;
       56      691
       57      692        /* Declare parameters */
       58      693
       59      694        %KH$DWNLODCCP (NAME = KH$DWNLODCCP, STCLASS = );
       60      717
       61      718        /* Declare STATIC and CONSTANT data */
       62      719
       63      720        %FPT_WRSYSLOG (FPTN = FPT_WRSYSLOG_ERR_BADBLKWRT, STCLASS = CONSTANT, FCG = KH, MID
               720            = I, MON = '1'B, ERR = %E$ERR_BADBLKWRT, SEV = 3);
       64      815        %KH$IOLD (FPTN = KH_IOLD, STCLASS = CONSTANT, OTPCHN = YES);
       65      866        %KH$IO (FPTN = KH_IO_OTPCCBCTR, STCLASS = CONSTANT,
       66      867         FNC = %GH#IO_OTPCCBCTR, OTPCHN = YES);
       67      981        %KH$IO (FPTN = KH_IO_OTPINTCTR, STCLASS = CONSTANT,
       68      982         FNC = %GH#IO_OTPINTCTR, OTPCHN = YES);
       69     1096        %KH$IO (FPTN = KH_IO_OTPCHNCTR, STCLASS = CONSTANT,
       70     1097         FNC = %GH#IO_OTPCHNCTR, OTPCHN = YES, BLKWRT = YES);
       71     1211        %KH$IO (FPTN = KH_IO_INPNXTCCBSTT, STCLASS = CONSTANT,
       72     1212         FNC = %GH#IO_INPNXTCCBSTT, OTPCHN = YES);
       73     1326        %KH$IO (FPTN = KH_IO_INPCCBSTT, STCLASS = CONSTANT,
PL6.E3A0      #001=KHI$DWNLODCCP File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:29 Page:3    
       74     1327         FNC = %GH#IO_INPCCBSTT, OTPCHN = YES);
       75     1441        %KH$IO (FPTN = KH_IO_OTPRAMCTR, STCLASS = CONSTANT,
       76     1442         FNC = %GH#IO_OTPRAMCTR, OTPCHN = YES);
       77     1556        %KH$IO (FPTN = KH_IO_OTPCTR, STCLASS = CONSTANT,
       78     1557         FNC = %GH#IO_OTPCTR, OTPCHN = YES, RAMSLC = 1);
       79     1671        %KH$IO (FPTN = KH_IO_INPINTB_STT, STCLASS = CONSTANT,
       80     1672         FNC = %GH#IO_INPINTB_STT, OTPCHN = YES);
       81     1786        %KH$RLCCCPLCT (NAME = KH_RLCCCPLCT, STCLASS = CONSTANT SYMDEF);
       82     1808        %KH$IO (FPTN = KH_IO_OTPCHNCTR_CCBLSTRST, STCLASS = CONSTANT,
       83     1809         FNC = %GH#IO_OTPCHNCTR, CCBLSTRST = YES, OTPCHN=YES);
       84     1923        %KH$IO (FPTN = KH_IO_OTPCHNCTR_STPIO, STCLASS = CONSTANT,
       85     1924         FNC = %GH#IO_OTPCHNCTR, STPIO = YES, OTPCHN=YES);
       86     2038        %KH$IO (FPTN=KH_IO_STOP_SLCC, FNC=%GH#IO_OTPCTR, STCLASS=CONSTANT, STPIO=YES);
       87     2152        %KH$IO (FPTN=KH_IO_INPSLCSTT, FNC=%GH#IO_INPSTT, STCLASS=CONSTANT, OTPCHN=YES);
       88     2266
       89     2267        /* Declare based structures */
       90     2268
       91     2269        %KH$CCPLCT (NAME = KH$CCPLCT, STCLASS = "BASED(KH$DWNLODCCP.CCPLCT$)");
       92     2295        %KH$CHN (NAME = KH$CHN, STCLASS = "BASED(KH$DWNLODCCP.CHN$)");
       93     2419
       94     2420        /* Declare AUTO data */
       95     2421
       96     2422        %FPT_WRSYSLOG (FPTN = FPT@WRSYSLOG, STCLASS = AUTO);
       97     2517        %KH$IOLD (FPTN = KH@IOLD, STCLASS = AUTO, OTPCHN = YES);
       98     2568        %KH$IO (FPTN = KH@IO_OTPCCBCTR, STCLASS = AUTO,
       99     2569         FNC = %GH#IO_OTPCCBCTR, OTPCHN = YES);
      100     2683        %KH$IO (FPTN = KH@IO_INPCCBSTT, STCLASS = AUTO,
      101     2684         FNC = %GH#IO_INPCCBSTT, OTPCHN = YES);
      102     2798        %KH$IO (FPTN = KH@IO_INPNXTCCBSTT, STCLASS = AUTO,
      103     2799         FNC = %GH#IO_INPNXTCCBSTT, OTPCHN = YES);
      104     2913        %KH$IO (FPTN = KH@IO_OTPRAMCTR, STCLASS = AUTO,
      105     2914         FNC = %GH#IO_OTPRAMCTR, OTPCHN = YES);
      106     3028        %KH$IO (FPTN = KH@IO_INPINTB_STT, STCLASS = AUTO,
      107     3029         FNC = %GH#IO_INPINTB_STT, OTPCHN = YES);
      108     3143        %KH$RLCCCPLCT (NAME = KH@RLCCCPLCT, STCLASS = AUTO);
      109     3165        /*
      110     3166        Counter to control block mode write loops.  If we count this counter
PL6.E3A0      #001=KHI$DWNLODCCP File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:29 Page:4    
      111     3167        down, we decide the hardware is dead and give up on the download.
      112     3168        */
      113     3169    1   DCL Y@LOPCNT UBIN WORD AUTO;
      114     3170
      115     3171        /* Stop any IO on the MLCP */
      116     3172    1      Y@LOPCNT = 10000; /* Try the first IO a few times for SLCC initialization  */
      117     3173    1   Y$1ST_IO:;
      118     3174    1      IF KH$CHN.ATTR&%G_ATTR_CL_SLCC
      119     3175    1      THEN CALL KHI$IO_OTP (KH$CHN, KH_IO_STOP_SLCC) ALTRET (Y$RETRY_1ST);
      120     3176    2      ELSE CALL KHI$IO_OTP (KH$CHN, KH_IO_OTPCHNCTR_STPIO) WHENALTRETURN DO;
      121     3177    2   Y$RETRY_1ST: Y@LOPCNT = Y@LOPCNT-1;
      122     3178    2         IF Y@LOPCNT=0 THEN GOTO Y$IO_ERR;
      123     3179    2         ELSE GOTO Y$1ST_IO;
      124     3180    2      END;
      125     3181    1      KH$CHN.DED = '0'B;                   /* Got that thru - it's not dead yet. */
      126     3182
      127     3183        /* Reset the ccb list */
      128     3184    1      IF NOT KH$CHN.ATTR&%G_ATTR_CL_SLCC
      129     3185    1      THEN CALL KHI$IO_OTP(KH$CHN,KH_IO_OTPCHNCTR_CCBLSTRST) ALTRET (Y$IO_ERR);
      130     3186
      131     3187        /* Set up the L6 main memory address and size of the CCP. */
      132     3188
      133     3189    1      KH@IOLD = KH_IOLD;
      134     3190    1      KH@IOLD.BFR_.ADR$ = ADDR(KH$CCPLCT.CCP);
      135     3191    1      KH@IOLD.BFR_.BYTSIZ = KH$CCPLCT.CCPBYTSIZ;
      136     3192
      137     3193        /* Set up the MLCP RAM address of where the CCP is to be placed. */
      138     3194
      139     3195    1      IF (KH$DWNLODCCP.CCPLODBIS ~= 0)
      140     3196    2        AND (KH$DWNLODCCP.CCPLODBIS ~= KH$CCPLCT.CCPLODBIS) THEN DO;
      141     3197        /*
      142     3198        The load bias (RAM address) indicates we need to relocate the CCP and LCTs.
      143     3199        */
      144     3200    2         KH@RLCCCPLCT = KH_RLCCCPLCT;
      145     3201    2         KH@RLCCCPLCT.CCPLODBIS = KH$DWNLODCCP.CCPLODBIS;
      146     3202    2         KH@RLCCCPLCT.CCPLCT$ = ADDR(KH$CCPLCT);
      147     3203    2         CALL KHI$RLCCCPLCT(KH@RLCCCPLCT);
PL6.E3A0      #001=KHI$DWNLODCCP File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:29 Page:5    
      148     3204    2      END;                  /* END IF CCPLODBIS ~= 0 & CCPLODBIS ~= CCPLODBIS    */
      149     3205
      150     3206        /* Reset the return interrupt level so we don't get an interrupt. */
      151     3207
      152     3208    1      CALL KHI$IO_OTP(KH$CHN, KH_IO_OTPINTCTR) ALTRET(Y$IO_ERR);
      153     3209
      154     3210    1      Y@LOPCNT = 10000;
      155     3211    2      IF KH$CHN.DVCID = '2978'X THEN DO;
      156     3212        /*
      157     3213            MLC-16; use MLC-16-specific RAM data transfer to download.
      158     3214
      159     3215            Start the block-mode write.
      160     3216            The size must be even.  (The L6 byte address must also be even.)
      161     3217        */
      162     3218    2         KH@IOLD.BFR_.BYTSIZ = ((KH@IOLD.BFR_.BYTSIZ + 1) / 2) * 2;
      163     3219    2         CALL KHI$IOLD_FNC(KH$CHN, KH@IOLD) ALTRET(Y$IO_ERR);
      164     3220
      165     3221    2         KH@IO_OTPRAMCTR = KH_IO_OTPRAMCTR;
      166     3222    2         KH@IO_OTPRAMCTR.RAMADR = KH$CCPLCT.CCPLODBIS;
      167     3223    2         CALL KHI$IO_OTP(KH$CHN, KH@IO_OTPRAMCTR) ALTRET(Y$IO_ERR);
      168     3224
      169     3225    2         CALL KHI$IO_OTP(KH$CHN, KH_IO_OTPCTR) ALTRET(Y$IO_ERR);
      170     3226
      171     3227        /* Wait for the RAM data transfer to complete.  When complete,
      172     3228           check for IO errors. */
      173     3229
      174     3230    2         KH@IO_INPINTB_STT = KH_IO_INPINTB_STT;
      175     3231    3         DO UNTIL KH@IO_INPINTB_STT.INTB_STT.RAMDATTRNCMP;
      176     3232    3            CALL KHI$IO_INP(KH$CHN, KH@IO_INPINTB_STT) ALTRET(Y$IO_ERR);
      177     3233    3            Y@LOPCNT = Y@LOPCNT - 1;
      178     3234    3            IF Y@LOPCNT = 0 THEN GOTO Y$IO_ERR_BADBLKWRT_MLC16;
      179     3235    3         END;                              /* END DO UNTIL RAMDATTRNCMP          */
      180     3236    2         IF KH@IO_INPINTB_STT.INTB_STT.RAMPRTERR OR
      181     3237    2           KH@IO_INPINTB_STT.INTB_STT.INVMMRADR OR
      182     3238    2           KH@IO_INPINTB_STT.INTB_STT.BUSPRTERR OR
      183     3239    2           KH@IO_INPINTB_STT.INTB_STT.UN_CRCMMRERR
      184     3240    2         THEN GOTO Y$IO_ERR_BADBLKWRT_MLC16;
PL6.E3A0      #001=KHI$DWNLODCCP File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:29 Page:6    
      185     3241    2      END; ELSE IF KH$CHN.ATTR&%G_ATTR_CL_SLCC THEN DO;
      186     3242        /*
      187     3243            SLCC; use SLCC-specific RAM data transfer to download.
      188     3244
      189     3245            Start the block-mode write.
      190     3246            The size must be even.  (The L6 byte address must also be even.)
      191     3247        */
      192     3248    2         KH@IOLD.BFR_.BYTSIZ = ((KH@IOLD.BFR_.BYTSIZ + 1) / 2) * 2;
      193     3249    2         KH@IOLD.BFR_.ADR$ = PINCRW(ADDR(KH$CCPLCT.SLCSPM),KH$CCPLCT.SLCSPMWRDSIZ);
      194     3250    2         KH@IOLD.FNC = %GH#IO_IOLD_SLCRAMTRN;
      195     3251
      196     3252    2         KH@IO_OTPRAMCTR = KH_IO_OTPRAMCTR;
      197     3253    2         KH@IO_OTPRAMCTR.RAMADR = KH$CCPLCT.CCPLODBIS+32768;
      198     3254    2         CALL KHI$IO_OTP(KH$CHN, KH@IO_OTPRAMCTR) ALTRET(Y$IO_ERR);
      199     3255
      200     3256    2         CALL KHI$IOLD_FNC(KH$CHN, KH@IOLD) ALTRET(Y$IO_ERR);
      201     3257
      202     3258        /* Wait for the RAM data transfer to complete.  When complete,
      203     3259           check for IO errors. */
      204     3260
      205     3261    2         KH@IO_INPINTB_STT = KH_IO_INPSLCSTT;
      206     3262    3         DO UNTIL KH@IO_INPINTB_STT.INTB_STT.RAMDATTRNCMP;
      207     3263    3            Y@LOPCNT = Y@LOPCNT-1;
      208     3264    3            IF Y@LOPCNT=0 THEN GOTO Y$IO_ERR_BADBLKWRT_MLC16;
      209     3265    3            CALL KHI$IO_INP(KH$CHN, KH@IO_INPINTB_STT) ALTRET(Y$IO_ERR);
      210     3266    3         END;                              /* END DO UNTIL FNCCMP                */
      211     3267    2         IF KH@IO_INPINTB_STT.INTB_STT.RAMPRTERR OR
      212     3268    2           KH@IO_INPINTB_STT.INTB_STT.INVMMRADR OR
      213     3269    2           KH@IO_INPINTB_STT.INTB_STT.BUSPRTERR OR
      214     3270    2           KH@IO_INPINTB_STT.INTB_STT.UN_CRCMMRERR
      215     3271    2         THEN GOTO Y$IO_ERR_BADBLKWRT_MLC16;
      216     3272    2      END; ELSE DO;                        /* ELSE IF KH$CHN.DVCID = '2978'X     */
      217     3273
      218     3274        /* MLC-8 (MLCP); use MLCP download mode. */
      219     3275
      220     3276    2         CALL KHI$IOLD(KH$CHN, KH@IOLD) ALTRET(Y$IO_ERR);
      221     3277
PL6.E3A0      #001=KHI$DWNLODCCP File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:29 Page:7    
      222     3278    2         KH@IO_OTPCCBCTR = KH_IO_OTPCCBCTR;
      223     3279    2         KH@IO_OTPCCBCTR.CCBCTR_RAMADR = KH$CCPLCT.CCPLODBIS;
      224     3280    2         CALL KHI$IO_OTP(KH$CHN, KH@IO_OTPCCBCTR) ALTRET(Y$IO_ERR);
      225     3281
      226     3282        /* Start the block-mode write. */
      227     3283
      228     3284    2         CALL KHI$IO_OTP(KH$CHN, KH_IO_OTPCHNCTR) ALTRET(Y$IO_ERR);
      229     3285
      230     3286        /* Advance the status CCB pointer to the CCB we just used
      231     3287           (or are still using, if the IO hasn't completed). */
      232     3288
      233     3289    2         KH@IO_INPNXTCCBSTT = KH_IO_INPNXTCCBSTT;
      234     3290    2         CALL KHI$IO_INP(KH$CHN, KH@IO_INPNXTCCBSTT) ALTRET(Y$IO_ERR);
      235     3291
      236     3292        /* Wait for the block mode write to complete.  When complete,
      237     3293           check for IO errors. */
      238     3294
      239     3295    2         KH@IO_INPCCBSTT = KH_IO_INPCCBSTT;
      240     3296    3         DO UNTIL KH@IO_INPCCBSTT.CCBSTT.CCBSTTCMP;
      241     3297    3            CALL KHI$IO_INP(KH$CHN, KH@IO_INPCCBSTT) ALTRET(Y$IO_ERR);
      242     3298    3            Y@LOPCNT = Y@LOPCNT - 1;
      243     3299    3            IF Y@LOPCNT = 0 THEN GOTO Y$IO_ERR_BADBLKWRT_MLC8;
      244     3300    3         END;                              /* END DO UNTIL CCBSTTCMP             */
      245     3301    2         IF KH@IO_INPCCBSTT.CCBSTT.CCBSRVERR OR
      246     3302    2           KH@IO_INPCCBSTT.CCBSTT.DATCHKERR OR
      247     3303    2           KH@IO_INPCCBSTT.CCBSTT.INVMMRADR OR
      248     3304    2           KH@IO_INPCCBSTT.CCBSTT.BUSPRTERR OR
      249     3305    2           KH@IO_INPCCBSTT.CCBSTT.UN_CRCMMRERR
      250     3306    2         THEN GOTO Y$IO_ERR_BADBLKWRT_MLC8;
      251     3307    2      END; /* END IF KH$CHN.DVCID = '2978'X */
      252     3308
      253     3309        /* The IO was successful.  Take the normal return. */
      254     3310
      255     3311    1      RETURN;
      256     3312
      257     3313    1   Y$IO_ERR_BADBLKWRT_MLC16:
      258     3314        /*E* ERROR:         KHI-E$ERR_BADBLKWRT-0
PL6.E3A0      #001=KHI$DWNLODCCP File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:29 Page:8    
      259     3315        *    MESSAGE:       Hardware problem on block mode write to MLCP/MLC-16
      260     3316        *    DESCRIPTION:   We either never saw CCB-status-complete or we saw
      261     3317        *                   an error on a block mode write.
      262     3318        *                   The data in the error log entry is the KH$IO
      263     3319        *                   IO request the error was sensed on.
      264     3320        */
      265     3321    1      FPT@WRSYSLOG = FPT_WRSYSLOG_ERR_BADBLKWRT;
      266     3322    1      FPT@WRSYSLOG.BUF_ = VECTOR(KH@IO_INPINTB_STT);
      267     3323    1      GOTO Y$IO_ERR_BADBLKWRT20;
      268     3324    1   Y$IO_ERR_BADBLKWRT_MLC8:
      269     3325    1      FPT@WRSYSLOG = FPT_WRSYSLOG_ERR_BADBLKWRT;
      270     3326    1      FPT@WRSYSLOG.BUF_ = VECTOR(KH@IO_INPCCBSTT);
      271     3327    1   Y$IO_ERR_BADBLKWRT20:
      272     3328    1      FPT@WRSYSLOG.V.ERRCODE.ERR# = %E$ERR_BADBLKWRT;
      273     3329    1      IF ENTADDR(KHD$ERRLOG_SETTERMID_CHN) ~= ENTADDR(NIL) THEN
      274     3330        /*
      275     3331        KHD$ERRLOG_.. exists (we're not linked with the monitor),
      276     3332        so call it to make the error log entry.
      277     3333        */
      278     3334    1      CALL KHD$ERRLOG_SETTERMID_CHN (FPT@WRSYSLOG, KH$CHN);
      279     3335
      280     3336    1   Y$IO_ERR:
      281     3337
      282     3338        /* A fatal IO error occurred.  Set KH$CHN.DED, and ALTRET. */
      283     3339
      284     3340    1      KH$CHN.DED = '1'B;
      285     3341    1      ALTRETURN;
      286     3342    1   END KHI$DWNLODCCP;                      /* END PROC                           */
      287     3343        %EOD;

PL6.E3A0      #001=KHI$DWNLODCCP File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:29 Page:9    
--  Include file information  --

   KH$IO.:E05TOU  is referenced.
   KH_ERRORS_C.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   GH_IOFNC_E.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is never referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is never referenced.
   KV$USR.:E05TOU  was found in the system file and is never referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is never referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is never referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is referenced.
   KI_CP6.:E05TOU  was found in the system file and is referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure KHI$DWNLODCCP.

   Procedure KHI$DWNLODCCP requires 654 words for executable code.
   Procedure KHI$DWNLODCCP requires 50 words of local(AUTO) storage.

PL6.E3A0      #001=KHI$DWNLODCCP File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:29 Page:10   

 Object Unit name= KHI$DWNLODCCP                              File name= KHI$CLCIO.:E05TOU
 UTS= JUL 30 '97 00:29:32.04 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0  RoData even  UTS     53     35  KHI$DWNLODCCP
    1   Proc  even  none   654    28E  KHI$DWNLODCCP
    2  RoData even  none     2      2  KHI$DWNLODCCP

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        1  KHI$DWNLODCCP

  ****  Data defs  ****

 Sect HexLoc  Name                           Sect HexLoc  Name
    0     2A  KH_RLCCCPLCT
PL6.E3A0      #001=KHI$DWNLODCCP File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:29 Page:11   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       2 KHI$IO_OTP
 yes     yes           Std       1 KHI$RLCCCPLCT
 yes     yes           Std       2 KHI$IOLD_FNC
 yes     yes    yes    Std       2 KHD$ERRLOG_SETTERMID_CHN
 yes     yes           Std       2 KHI$IO_INP
 yes     yes           Std       2 KHI$IOLD
                       nStd      0 X6A_AUTO_1
                       nStd      0 X6A_ARET
                       nStd      0 X6A_AALT

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
r    G$ROS$
PL6.E3A0      #001=KHI$DWNLODCCP File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:29 Page:12   


        1        1        /*M* KHI$CLCIO - Communications line controller IO routines */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X*     NSO,PLM=3,SQB=Y,AND=Y,ENI=0,SDI=3,MCL=10,CSI=0,ECI=0,IAD=3,IND=0 */
        8        8        /*P*
        9        9        NAME: KHI$CLCIO
       10       10        PURPOSE:  Do communications line controller IO.
       11       11        */
       12       12
       13       13        KHI$DWNLODCCP: PROC(KH$DWNLODCCP) ALTRET;

     13   1 000000  D380 0000 0000  xent KHI$DWNLODCCP   LNJ,B5   X6A_AUTO_1
          1 000003       0032 0001                       DC       50,1

       14       14
       15       15        /*F* NAME: KHI$DWNLODCCP - Down Load CCPs into MLCPs
       16       16
       17       17        This routine does a block mode write to the
       18       18        specified channel to down-load the specified CCP.
       19       19        IOs yielding IO NAKs are re-tried, and errors are logged.
       20       20        If an irrecoverable IO error occurs, KH$CHN.DED (channel dead)
       21       21        will be set, and the ALTRET will be taken.
       22       22
       23       23        The form of the call for this service is:
       24       24
       25       25        .fif
       26       26           CALL KHI$DWMLODCCP(kh$dwnlodccp) ALTRET(error);
       27       27        .fin
       28       28
       29       29        where:
       30       30        */
       31       31
       32       32        /*K* kh$dwnlodccp -
PL6.E3A0      #001=KHI$DWNLODCCP File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:29 Page:13   
       33       33        is the structure defined by the KH$DWNLODCCP macro,
       34       34        which is in file KH$IO.
       35       35        See the description of KH$DWNLODCCP for details.
       36       36        */
       37       37
       38       38
       39       39        /* INCLUDEs */
       40       40
       41       41        %INCLUDE LCP_6;
       42      232        %INCLUDE GH_IOFNC_E;
       43      301        %INCLUDE KH$CHN;
       44      423        %INCLUDE KH_ERRORS_C;
       45      434        %INCLUDE KH$IO;
       46      681 S      %INCLUDE KV$GLB;
       47      682
       48      683        /* Declare external routines needed. */
       49      684
       50      685    1   DCL KHD$ERRLOG_SETTERMID_CHN ENTRY (2) OPTIONAL ALTRET;
       51      686    1   DCL KHI$IO_INP ENTRY(2) ALTRET;
       52      687    1   DCL KHI$IO_OTP ENTRY(2) ALTRET;
       53      688    1   DCL KHI$IOLD ENTRY(2) ALTRET;
       54      689    1   DCL KHI$IOLD_FNC ENTRY(2) ALTRET;
       55      690    1   DCL KHI$RLCCCPLCT ENTRY(1) ALTRET;
       56      691
       57      692        /* Declare parameters */
       58      693
       59      694        %KH$DWNLODCCP (NAME = KH$DWNLODCCP, STCLASS = );
       60      717
       61      718        /* Declare STATIC and CONSTANT data */
       62      719
       63      720        %FPT_WRSYSLOG (FPTN = FPT_WRSYSLOG_ERR_BADBLKWRT, STCLASS = CONSTANT, FCG = KH, MID
               720            = I, MON = '1'B, ERR = %E$ERR_BADBLKWRT, SEV = 3);
       64      815        %KH$IOLD (FPTN = KH_IOLD, STCLASS = CONSTANT, OTPCHN = YES);
       65      866        %KH$IO (FPTN = KH_IO_OTPCCBCTR, STCLASS = CONSTANT,
       66      867         FNC = %GH#IO_OTPCCBCTR, OTPCHN = YES);
       67      981        %KH$IO (FPTN = KH_IO_OTPINTCTR, STCLASS = CONSTANT,
       68      982         FNC = %GH#IO_OTPINTCTR, OTPCHN = YES);
PL6.E3A0      #001=KHI$DWNLODCCP File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:29 Page:14   
       69     1096        %KH$IO (FPTN = KH_IO_OTPCHNCTR, STCLASS = CONSTANT,
       70     1097         FNC = %GH#IO_OTPCHNCTR, OTPCHN = YES, BLKWRT = YES);
       71     1211        %KH$IO (FPTN = KH_IO_INPNXTCCBSTT, STCLASS = CONSTANT,
       72     1212         FNC = %GH#IO_INPNXTCCBSTT, OTPCHN = YES);
       73     1326        %KH$IO (FPTN = KH_IO_INPCCBSTT, STCLASS = CONSTANT,
       74     1327         FNC = %GH#IO_INPCCBSTT, OTPCHN = YES);
       75     1441        %KH$IO (FPTN = KH_IO_OTPRAMCTR, STCLASS = CONSTANT,
       76     1442         FNC = %GH#IO_OTPRAMCTR, OTPCHN = YES);
       77     1556        %KH$IO (FPTN = KH_IO_OTPCTR, STCLASS = CONSTANT,
       78     1557         FNC = %GH#IO_OTPCTR, OTPCHN = YES, RAMSLC = 1);
       79     1671        %KH$IO (FPTN = KH_IO_INPINTB_STT, STCLASS = CONSTANT,
       80     1672         FNC = %GH#IO_INPINTB_STT, OTPCHN = YES);
       81     1786        %KH$RLCCCPLCT (NAME = KH_RLCCCPLCT, STCLASS = CONSTANT SYMDEF);
       82     1808        %KH$IO (FPTN = KH_IO_OTPCHNCTR_CCBLSTRST, STCLASS = CONSTANT,
       83     1809         FNC = %GH#IO_OTPCHNCTR, CCBLSTRST = YES, OTPCHN=YES);
       84     1923        %KH$IO (FPTN = KH_IO_OTPCHNCTR_STPIO, STCLASS = CONSTANT,
       85     1924         FNC = %GH#IO_OTPCHNCTR, STPIO = YES, OTPCHN=YES);
       86     2038        %KH$IO (FPTN=KH_IO_STOP_SLCC, FNC=%GH#IO_OTPCTR, STCLASS=CONSTANT, STPIO=YES);
       87     2152        %KH$IO (FPTN=KH_IO_INPSLCSTT, FNC=%GH#IO_INPSTT, STCLASS=CONSTANT, OTPCHN=YES);
       88     2266
       89     2267        /* Declare based structures */
       90     2268
       91     2269        %KH$CCPLCT (NAME = KH$CCPLCT, STCLASS = "BASED(KH$DWNLODCCP.CCPLCT$)");
       92     2295        %KH$CHN (NAME = KH$CHN, STCLASS = "BASED(KH$DWNLODCCP.CHN$)");
       93     2419
       94     2420        /* Declare AUTO data */
       95     2421
       96     2422        %FPT_WRSYSLOG (FPTN = FPT@WRSYSLOG, STCLASS = AUTO);
       97     2517        %KH$IOLD (FPTN = KH@IOLD, STCLASS = AUTO, OTPCHN = YES);
       98     2568        %KH$IO (FPTN = KH@IO_OTPCCBCTR, STCLASS = AUTO,
       99     2569         FNC = %GH#IO_OTPCCBCTR, OTPCHN = YES);
      100     2683        %KH$IO (FPTN = KH@IO_INPCCBSTT, STCLASS = AUTO,
      101     2684         FNC = %GH#IO_INPCCBSTT, OTPCHN = YES);
      102     2798        %KH$IO (FPTN = KH@IO_INPNXTCCBSTT, STCLASS = AUTO,
      103     2799         FNC = %GH#IO_INPNXTCCBSTT, OTPCHN = YES);
      104     2913        %KH$IO (FPTN = KH@IO_OTPRAMCTR, STCLASS = AUTO,
      105     2914         FNC = %GH#IO_OTPRAMCTR, OTPCHN = YES);
PL6.E3A0      #001=KHI$DWNLODCCP File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:29 Page:15   
      106     3028        %KH$IO (FPTN = KH@IO_INPINTB_STT, STCLASS = AUTO,
      107     3029         FNC = %GH#IO_INPINTB_STT, OTPCHN = YES);
      108     3143        %KH$RLCCCPLCT (NAME = KH@RLCCCPLCT, STCLASS = AUTO);
      109     3165        /*
      110     3166        Counter to control block mode write loops.  If we count this counter
      111     3167        down, we decide the hardware is dead and give up on the download.
      112     3168        */
      113     3169    1   DCL Y@LOPCNT UBIN WORD AUTO;
      114     3170
      115     3171        /* Stop any IO on the MLCP */
      116     3172    1      Y@LOPCNT = 10000; /* Try the first IO a few times for SLCC initialization  */

   3172   1 000005  E870 2710                            LDR,R6   10000,IMO
          1 000007  EF47 002D                            STR,R6   Y@LOPCNT,AUTO

   3172   1                              Y$1ST_IO        null
      117     3173    1   Y$1ST_IO:;
      118     3174    1      IF KH$CHN.ATTR&%G_ATTR_CL_SLCC

   3174   1 000009  ECC7 0004            Y$1ST_IO        LDB,B6   @KH$DWNLODCCP,AUTO
          1 00000B  DC86                                 LDB,B5   ,B6
          1 00000C  E845 0005                            LDR,R6   5,B5
          1 00000E  E570 0200                            AND,R6   512,IMO
          1 000010  6901 0012                            BEZ,R6   s:3176,PREL

      119     3175    1      THEN CALL KHI$IO_OTP (KH$CHN, KH_IO_STOP_SLCC) ALTRET (Y$RETRY_1ST);

   3175   1 000012  CB80 0000 0031  00                   LAB,B4   KH_IO_STOP_SLCC
          1 000015  CFC7 0030                            STB,B4   Y@LOPCNT+3,AUTO
          1 000017  DFC7 002E                            STB,B5   Y@LOPCNT+1,AUTO
          1 000019  BBC7 002E                            LAB,B3   Y@LOPCNT+1,AUTO
          1 00001B  CBF0 0200                            LAB,B4   512,IMO
          1 00001D  E380 0000 0000  xent                 LNJ,B6   KHI$IO_OTP
          1 000020       0014                            DC       s:3177,PREL
          1 000021  0F81 0019                            B        s:3181,PREL

      120     3176    2      ELSE CALL KHI$IO_OTP (KH$CHN, KH_IO_OTPCHNCTR_STPIO) WHENALTRETURN DO;
PL6.E3A0      #001=KHI$DWNLODCCP File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:29 Page:16   

   3176   1 000023  CB80 0000 002F  00                   LAB,B4   KH_IO_OTPCHNCTR_STPIO
          1 000026  CFC7 0030                            STB,B4   Y@LOPCNT+3,AUTO
          1 000028  DFC7 002E                            STB,B5   Y@LOPCNT+1,AUTO
          1 00002A  BBC7 002E                            LAB,B3   Y@LOPCNT+1,AUTO
          1 00002C  CBF0 0200                            LAB,B4   512,IMO
          1 00002E  E380 0000 0000  xent                 LNJ,B6   KHI$IO_OTP
          1 000031       0003                            DC       s:3177,PREL
          1 000032  0F81 0008                            B        s:3181,PREL

      121     3177    2   Y$RETRY_1ST: Y@LOPCNT = Y@LOPCNT-1;

   3177   1 000034  88C7 002D            Y$RETRY_1ST     DEC      Y@LOPCNT,AUTO

      122     3178    2         IF Y@LOPCNT=0 THEN GOTO Y$IO_ERR;

   3178   1 000036  E847 002D                            LDR,R6   Y@LOPCNT,AUTO
          1 000038  6901 024C                            BEZ,R6   s:3340,PREL

      123     3179    2         ELSE GOTO Y$1ST_IO;

   3179   1 00003A  0FCF                                 B        s:3172,SPREL

      124     3180    2      END;
      125     3181    1      KH$CHN.DED = '0'B;                   /* Got that thru - it's not dead yet. */

   3181   1 00003B  ECC7 0004                            LDB,B6   @KH$DWNLODCCP,AUTO
          1 00003D  DC86                                 LDB,B5   ,B6
          1 00003E  8845 0009                            LBF,'0100'X       9,B5
          1 000040       0100

      126     3182
      127     3183        /* Reset the ccb list */
      128     3184    1      IF NOT KH$CHN.ATTR&%G_ATTR_CL_SLCC

   3184   1 000041  DC86                                 LDB,B5   ,B6
          1 000042  E845 0005                            LDR,R6   5,B5
PL6.E3A0      #001=KHI$DWNLODCCP File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:29 Page:17   
          1 000044  E570 0200                            AND,R6   512,IMO
          1 000046  6981 0010                            BNEZ,R6  s:3189,PREL

      129     3185    1      THEN CALL KHI$IO_OTP(KH$CHN,KH_IO_OTPCHNCTR_CCBLSTRST) ALTRET (Y$IO_ERR);

   3185   1 000048  CB80 0000 002D  00                   LAB,B4   KH_IO_OTPCHNCTR_CCBLSTRST
          1 00004B  CFC7 0030                            STB,B4   Y@LOPCNT+3,AUTO
          1 00004D  DFC7 002E                            STB,B5   Y@LOPCNT+1,AUTO
          1 00004F  BBC7 002E                            LAB,B3   Y@LOPCNT+1,AUTO
          1 000051  CBF0 0200                            LAB,B4   512,IMO
          1 000053  E380 0000 0000  xent                 LNJ,B6   KHI$IO_OTP
          1 000056       022F                            DC       s:3340,PREL

      130     3186
      131     3187        /* Set up the L6 main memory address and size of the CCP. */
      132     3188
      133     3189    1      KH@IOLD = KH_IOLD;

   3189   1 000057  AB80 0000 0000  00                   LAB,B2   FPT_WRSYSLOG_ERR_BADBLKWRT
          1 00005A  2C2A                                 LDV,R2   42
          1 00005B  6C0A                                 LDV,R6   10
          1 00005C  BB87                                 LAB,B3   ,AUTO
          1 00005D  3C36                                 LDV,R3   54
          1 00005E  0008                                 MMM

      134     3190    1      KH@IOLD.BFR_.ADR$ = ADDR(KH$CCPLCT.CCP);

   3190   1 00005F  ECC7 0004                            LDB,B6   @KH$DWNLODCCP,AUTO
          1 000061  DCC6 0002                            LDB,B5   2,B6
          1 000063  CBC5 0093                            LAB,B4   147,B5
          1 000065  CFC7 001C                            STB,B4   KH@IOLD+1,AUTO

      135     3191    1      KH@IOLD.BFR_.BYTSIZ = KH$CCPLCT.CCPBYTSIZ;

   3191   1 000067  DCC6 0002                            LDB,B5   2,B6
          1 000069  E845 0001                            LDR,R6   1,B5
          1 00006B  EF47 001F                            STR,R6   KH@IOLD+4,AUTO
PL6.E3A0      #001=KHI$DWNLODCCP File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:29 Page:18   

      136     3192
      137     3193        /* Set up the MLCP RAM address of where the CCP is to be placed. */
      138     3194
      139     3195    1      IF (KH$DWNLODCCP.CCPLODBIS ~= 0)

   3195   1 00006D  D846 0004                            LDR,R5   4,B6
          1 00006F  5901 0022                            BEZ,R5   s:3208,PREL
          1 000071  DCC6 0002                            LDB,B5   2,B6
          1 000073  D905                                 CMR,R5   ,B5
          1 000074  0901 001D                            BE       s:3208,PREL

      140     3196    2        AND (KH$DWNLODCCP.CCPLODBIS ~= KH$CCPLCT.CCPLODBIS) THEN DO;

      141     3197        /*
      142     3198        The load bias (RAM address) indicates we need to relocate the CCP and LCTs.
      143     3199        */
      144     3200    2         KH@RLCCCPLCT = KH_RLCCCPLCT;

   3200   1 000076  AB80 0000 0000  00                   LAB,B2   FPT_WRSYSLOG_ERR_BADBLKWRT
          1 000079  2C54                                 LDV,R2   84
          1 00007A  6C06                                 LDV,R6   6
          1 00007B  BB87                                 LAB,B3   ,AUTO
          1 00007C  3C54                                 LDV,R3   84
          1 00007D  0008                                 MMM

      145     3201    2         KH@RLCCCPLCT.CCPLODBIS = KH$DWNLODCCP.CCPLODBIS;

   3201   1 00007E  E846 0004                            LDR,R6   4,B6
          1 000080  EF47 002C                            STR,R6   KH@RLCCCPLCT+2,AUTO

      146     3202    2         KH@RLCCCPLCT.CCPLCT$ = ADDR(KH$CCPLCT);

   3202   1 000082  DCC6 0002                            LDB,B5   2,B6
          1 000084  DFC7 002A                            STB,B5   KH@RLCCCPLCT,AUTO

      147     3203    2         CALL KHI$RLCCCPLCT(KH@RLCCCPLCT);
PL6.E3A0      #001=KHI$DWNLODCCP File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:29 Page:19   

   3203   1 000086  CBC7 002A                            LAB,B4   KH@RLCCCPLCT,AUTO
          1 000088  CFC7 002E                            STB,B4   Y@LOPCNT+1,AUTO
          1 00008A  BBC7 002E                            LAB,B3   Y@LOPCNT+1,AUTO
          1 00008C  CBF0 0100                            LAB,B4   256,IMO
          1 00008E  E380 0000 0000  xent                 LNJ,B6   KHI$RLCCCPLCT
          1 000091       0001                            DC       s:3208,PREL

      148     3204    2      END;                  /* END IF CCPLODBIS ~= 0 & CCPLODBIS ~= CCPLODBIS    */

      149     3205
      150     3206        /* Reset the return interrupt level so we don't get an interrupt. */
      151     3207
      152     3208    1      CALL KHI$IO_OTP(KH$CHN, KH_IO_OTPINTCTR) ALTRET(Y$IO_ERR);

   3208   1 000092  ECC7 0004                            LDB,B6   @KH$DWNLODCCP,AUTO
          1 000094  DC86                                 LDB,B5   ,B6
          1 000095  CB80 0000 001C  00                   LAB,B4   KH_IO_OTPINTCTR
          1 000098  CFC7 0030                            STB,B4   Y@LOPCNT+3,AUTO
          1 00009A  DFC7 002E                            STB,B5   Y@LOPCNT+1,AUTO
          1 00009C  BBC7 002E                            LAB,B3   Y@LOPCNT+1,AUTO
          1 00009E  CBF0 0200                            LAB,B4   512,IMO
          1 0000A0  E380 0000 0000  xent                 LNJ,B6   KHI$IO_OTP
          1 0000A3       01E2                            DC       s:3340,PREL

      153     3209
      154     3210    1      Y@LOPCNT = 10000;

   3210   1 0000A4  E870 2710                            LDR,R6   10000,IMO
          1 0000A6  EF47 002D                            STR,R6   Y@LOPCNT,AUTO

      155     3211    2      IF KH$CHN.DVCID = '2978'X THEN DO;

   3211   1 0000A8  ECC7 0004                            LDB,B6   @KH$DWNLODCCP,AUTO
          1 0000AA  DC86                                 LDB,B5   ,B6
          1 0000AB  D845 0002                            LDR,R5   2,B5
          1 0000AD  D970 2978                            CMR,R5   10616,IMO
PL6.E3A0      #001=KHI$DWNLODCCP File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:29 Page:20   
          1 0000AF  0981 007A                            BNE      s:3241+2,PREL

      156     3212        /*
      157     3213            MLC-16; use MLC-16-specific RAM data transfer to download.
      158     3214
      159     3215            Start the block-mode write.
      160     3216            The size must be even.  (The L6 byte address must also be even.)
      161     3217        */
      162     3218    2         KH@IOLD.BFR_.BYTSIZ = ((KH@IOLD.BFR_.BYTSIZ + 1) / 2) * 2;

   3218   1 0000B1  C847 001F                            LDR,R4   KH@IOLD+4,AUTO
          1 0000B3  4E01                                 ADV,R4   1
          1 0000B4  4041                                 SOR,R4   1
          1 0000B5  4001                                 SOL,R4   1
          1 0000B6  CF47 001F                            STR,R4   KH@IOLD+4,AUTO

      163     3219    2         CALL KHI$IOLD_FNC(KH$CHN, KH@IOLD) ALTRET(Y$IO_ERR);

   3219   1 0000B8  DC86                                 LDB,B5   ,B6
          1 0000B9  CBC7 001B                            LAB,B4   KH@IOLD,AUTO
          1 0000BB  CFC7 0030                            STB,B4   Y@LOPCNT+3,AUTO
          1 0000BD  DFC7 002E                            STB,B5   Y@LOPCNT+1,AUTO
          1 0000BF  BBC7 002E                            LAB,B3   Y@LOPCNT+1,AUTO
          1 0000C1  CBF0 0200                            LAB,B4   512,IMO
          1 0000C3  E380 0000 0000  xent                 LNJ,B6   KHI$IOLD_FNC
          1 0000C6       01BF                            DC       s:3340,PREL

      164     3220
      165     3221    2         KH@IO_OTPRAMCTR = KH_IO_OTPRAMCTR;

   3221   1 0000C7  8C80 0000 0024  00                   LDI      KH_IO_OTPRAMCTR
          1 0000CA  8D47 0026                            SDI      KH@IO_OTPRAMCTR,AUTO

      166     3222    2         KH@IO_OTPRAMCTR.RAMADR = KH$CCPLCT.CCPLODBIS;

   3222   1 0000CC  ECC7 0004                            LDB,B6   @KH$DWNLODCCP,AUTO
          1 0000CE  DCC6 0002                            LDB,B5   2,B6
PL6.E3A0      #001=KHI$DWNLODCCP File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:29 Page:21   
          1 0000D0  D805                                 LDR,R5   ,B5
          1 0000D1  DF47 0027                            STR,R5   KH@IO_OTPRAMCTR+1,AUTO

      167     3223    2         CALL KHI$IO_OTP(KH$CHN, KH@IO_OTPRAMCTR) ALTRET(Y$IO_ERR);

   3223   1 0000D3  DC86                                 LDB,B5   ,B6
          1 0000D4  CBC7 0026                            LAB,B4   KH@IO_OTPRAMCTR,AUTO
          1 0000D6  CFC7 0030                            STB,B4   Y@LOPCNT+3,AUTO
          1 0000D8  DFC7 002E                            STB,B5   Y@LOPCNT+1,AUTO
          1 0000DA  BBC7 002E                            LAB,B3   Y@LOPCNT+1,AUTO
          1 0000DC  CBF0 0200                            LAB,B4   512,IMO
          1 0000DE  E380 0000 0000  xent                 LNJ,B6   KHI$IO_OTP
          1 0000E1       01A4                            DC       s:3340,PREL

      168     3224
      169     3225    2         CALL KHI$IO_OTP(KH$CHN, KH_IO_OTPCTR) ALTRET(Y$IO_ERR);

   3225   1 0000E2  ECC7 0004                            LDB,B6   @KH$DWNLODCCP,AUTO
          1 0000E4  DC86                                 LDB,B5   ,B6
          1 0000E5  CB80 0000 0026  00                   LAB,B4   KH_IO_OTPCTR
          1 0000E8  CFC7 0030                            STB,B4   Y@LOPCNT+3,AUTO
          1 0000EA  DFC7 002E                            STB,B5   Y@LOPCNT+1,AUTO
          1 0000EC  BBC7 002E                            LAB,B3   Y@LOPCNT+1,AUTO
          1 0000EE  CBF0 0200                            LAB,B4   512,IMO
          1 0000F0  E380 0000 0000  xent                 LNJ,B6   KHI$IO_OTP
          1 0000F3       0192                            DC       s:3340,PREL

      170     3226
      171     3227        /* Wait for the RAM data transfer to complete.  When complete,
      172     3228           check for IO errors. */
      173     3229
      174     3230    2         KH@IO_INPINTB_STT = KH_IO_INPINTB_STT;

   3230   1 0000F4  8C80 0000 0028  00                   LDI      KH_IO_INPINTB_STT
          1 0000F7  8D47 0028                            SDI      KH@IO_INPINTB_STT,AUTO

      175     3231    3         DO UNTIL KH@IO_INPINTB_STT.INTB_STT.RAMDATTRNCMP;
PL6.E3A0      #001=KHI$DWNLODCCP File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:29 Page:22   

      176     3232    3            CALL KHI$IO_INP(KH$CHN, KH@IO_INPINTB_STT) ALTRET(Y$IO_ERR);

   3232   1 0000F9  ECC7 0004                            LDB,B6   @KH$DWNLODCCP,AUTO
          1 0000FB  DC86                                 LDB,B5   ,B6
          1 0000FC  CBC7 0028                            LAB,B4   KH@IO_INPINTB_STT,AUTO
          1 0000FE  CFC7 0030                            STB,B4   Y@LOPCNT+3,AUTO
          1 000100  DFC7 002E                            STB,B5   Y@LOPCNT+1,AUTO
          1 000102  BBC7 002E                            LAB,B3   Y@LOPCNT+1,AUTO
          1 000104  CBF0 0200                            LAB,B4   512,IMO
          1 000106  E380 0000 0000  xent                 LNJ,B6   KHI$IO_INP
          1 000109       017C                            DC       s:3340,PREL

      177     3233    3            Y@LOPCNT = Y@LOPCNT - 1;

   3233   1 00010A  88C7 002D                            DEC      Y@LOPCNT,AUTO

      178     3234    3            IF Y@LOPCNT = 0 THEN GOTO Y$IO_ERR_BADBLKWRT_MLC16;

   3234   1 00010C  E847 002D                            LDR,R6   Y@LOPCNT,AUTO
          1 00010E  6901 012A                            BEZ,R6   s:3321,PREL

      179     3235    3         END;                              /* END DO UNTIL RAMDATTRNCMP          */

   3235   1 000110  82C7 0029                            LB,'0020'X        KH@IO_INPINTB_STT+1,AUTO
   3235   1 000112       0020
          1 000113  05E6                                 BBF      s:3232,SPREL

      180     3236    2         IF KH@IO_INPINTB_STT.INTB_STT.RAMPRTERR OR

   3236   1 000114  82C7 0029                            LB,'0040'X        KH@IO_INPINTB_STT+1,AUTO
   3236   1 000116       0040
          1 000117  0501 0121                            BBT      s:3321,PREL
          1 000119  82C7 0029                            LB,'0004'X        KH@IO_INPINTB_STT+1,AUTO
          1 00011B       0004
          1 00011C  0501 011C                            BBT      s:3321,PREL
          1 00011E  82C7 0029                            LB,'0002'X        KH@IO_INPINTB_STT+1,AUTO
PL6.E3A0      #001=KHI$DWNLODCCP File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:29 Page:23   
          1 000120       0002
          1 000121  0501 0117                            BBT      s:3321,PREL
          1 000123  82C7 0029                            LB,'0001'X        KH@IO_INPINTB_STT+1,AUTO
          1 000125       0001
          1 000126  0501 0112                            BBT      s:3321,PREL

      181     3237    2           KH@IO_INPINTB_STT.INTB_STT.INVMMRADR OR
      182     3238    2           KH@IO_INPINTB_STT.INTB_STT.BUSPRTERR OR
      183     3239    2           KH@IO_INPINTB_STT.INTB_STT.UN_CRCMMRERR
      184     3240    2         THEN GOTO Y$IO_ERR_BADBLKWRT_MLC16;
      185     3241    2      END; ELSE IF KH$CHN.ATTR&%G_ATTR_CL_SLCC THEN DO;

   3241   1 000128  0F81 010D                            B        s:3311,PREL

   3241   1 00012A  C845 0005                            LDR,R4   5,B5
          1 00012C  C570 0200                            AND,R4   512,IMO
          1 00012E  4901 007D                            BEZ,R4   s:3276,PREL

      186     3242        /*
      187     3243            SLCC; use SLCC-specific RAM data transfer to download.
      188     3244
      189     3245            Start the block-mode write.
      190     3246            The size must be even.  (The L6 byte address must also be even.)
      191     3247        */
      192     3248    2         KH@IOLD.BFR_.BYTSIZ = ((KH@IOLD.BFR_.BYTSIZ + 1) / 2) * 2;

   3248   1 000130  C847 001F                            LDR,R4   KH@IOLD+4,AUTO
          1 000132  4E01                                 ADV,R4   1
          1 000133  4041                                 SOR,R4   1
          1 000134  4001                                 SOL,R4   1
          1 000135  CF47 001F                            STR,R4   KH@IOLD+4,AUTO

      193     3249    2         KH@IOLD.BFR_.ADR$ = PINCRW(ADDR(KH$CCPLCT.SLCSPM),KH$CCPLCT.SLCSPMWRDSIZ);

   3249   1 000137  DCC6 0002                            LDB,B5   2,B6
          1 000139  B845 0002                            LDR,R3   2,B5
          1 00013B  DFC7 002E                            STB,B5   Y@LOPCNT+1,AUTO
PL6.E3A0      #001=KHI$DWNLODCCP File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:29 Page:24   
          1 00013D  E853                                 LDR,R6   R3
          1 00013E  70F0                                 DAR,R7   16
          1 00013F  8447 002E                            AID      Y@LOPCNT+1,AUTO
          1 000141  8470 0000 0003                       AID      3,IMO
          1 000144  8D47 001C                            SDI      KH@IOLD+1,AUTO

      194     3250    2         KH@IOLD.FNC = %GH#IO_IOLD_SLCRAMTRN;

   3250   1 000146  5C19                                 LDV,R5   25
          1 000147  DAC7 001B                            SRM,R5,'003F'X    KH@IOLD,AUTO
          1 000149       003F

      195     3251
      196     3252    2         KH@IO_OTPRAMCTR = KH_IO_OTPRAMCTR;

   3252   1 00014A  8C80 0000 0024  00                   LDI      KH_IO_OTPRAMCTR
          1 00014D  8D47 0026                            SDI      KH@IO_OTPRAMCTR,AUTO

      197     3253    2         KH@IO_OTPRAMCTR.RAMADR = KH$CCPLCT.CCPLODBIS+32768;

   3253   1 00014F  CCC6 0002                            LDB,B4   2,B6
          1 000151  B804                                 LDR,R3   ,B4
          1 000152  BA70 8000                            ADD,R3   -32768,IMO
          1 000154  BF47 0027                            STR,R3   KH@IO_OTPRAMCTR+1,AUTO

      198     3254    2         CALL KHI$IO_OTP(KH$CHN, KH@IO_OTPRAMCTR) ALTRET(Y$IO_ERR);

   3254   1 000156  CC86                                 LDB,B4   ,B6
          1 000157  BBC7 0026                            LAB,B3   KH@IO_OTPRAMCTR,AUTO
          1 000159  BFC7 0030                            STB,B3   Y@LOPCNT+3,AUTO
          1 00015B  CFC7 002E                            STB,B4   Y@LOPCNT+1,AUTO
          1 00015D  BBC7 002E                            LAB,B3   Y@LOPCNT+1,AUTO
          1 00015F  CBF0 0200                            LAB,B4   512,IMO
          1 000161  E380 0000 0000  xent                 LNJ,B6   KHI$IO_OTP
          1 000164       0121                            DC       s:3340,PREL

      199     3255
PL6.E3A0      #001=KHI$DWNLODCCP File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:29 Page:25   
      200     3256    2         CALL KHI$IOLD_FNC(KH$CHN, KH@IOLD) ALTRET(Y$IO_ERR);

   3256   1 000165  ECC7 0004                            LDB,B6   @KH$DWNLODCCP,AUTO
          1 000167  DC86                                 LDB,B5   ,B6
          1 000168  CBC7 001B                            LAB,B4   KH@IOLD,AUTO
          1 00016A  CFC7 0030                            STB,B4   Y@LOPCNT+3,AUTO
          1 00016C  DFC7 002E                            STB,B5   Y@LOPCNT+1,AUTO
          1 00016E  BBC7 002E                            LAB,B3   Y@LOPCNT+1,AUTO
          1 000170  CBF0 0200                            LAB,B4   512,IMO
          1 000172  E380 0000 0000  xent                 LNJ,B6   KHI$IOLD_FNC
          1 000175       0110                            DC       s:3340,PREL

      201     3257
      202     3258        /* Wait for the RAM data transfer to complete.  When complete,
      203     3259           check for IO errors. */
      204     3260
      205     3261    2         KH@IO_INPINTB_STT = KH_IO_INPSLCSTT;

   3261   1 000176  8C80 0000 0033  00                   LDI      KH_IO_INPSLCSTT
          1 000179  8D47 0028                            SDI      KH@IO_INPINTB_STT,AUTO

      206     3262    3         DO UNTIL KH@IO_INPINTB_STT.INTB_STT.RAMDATTRNCMP;

      207     3263    3            Y@LOPCNT = Y@LOPCNT-1;

   3263   1 00017B  88C7 002D                            DEC      Y@LOPCNT,AUTO

      208     3264    3            IF Y@LOPCNT=0 THEN GOTO Y$IO_ERR_BADBLKWRT_MLC16;

   3264   1 00017D  E847 002D                            LDR,R6   Y@LOPCNT,AUTO
          1 00017F  6901 00B9                            BEZ,R6   s:3321,PREL

      209     3265    3            CALL KHI$IO_INP(KH$CHN, KH@IO_INPINTB_STT) ALTRET(Y$IO_ERR);

   3265   1 000181  ECC7 0004                            LDB,B6   @KH$DWNLODCCP,AUTO
          1 000183  DC86                                 LDB,B5   ,B6
          1 000184  CBC7 0028                            LAB,B4   KH@IO_INPINTB_STT,AUTO
PL6.E3A0      #001=KHI$DWNLODCCP File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:29 Page:26   
          1 000186  CFC7 0030                            STB,B4   Y@LOPCNT+3,AUTO
          1 000188  DFC7 002E                            STB,B5   Y@LOPCNT+1,AUTO
          1 00018A  BBC7 002E                            LAB,B3   Y@LOPCNT+1,AUTO
          1 00018C  CBF0 0200                            LAB,B4   512,IMO
          1 00018E  E380 0000 0000  xent                 LNJ,B6   KHI$IO_INP
          1 000191       00F4                            DC       s:3340,PREL

      210     3266    3         END;                              /* END DO UNTIL FNCCMP                */

   3266   1 000192  82C7 0029                            LB,'0020'X        KH@IO_INPINTB_STT+1,AUTO
   3266   1 000194       0020
          1 000195  05E6                                 BBF      s:3263,SPREL

      211     3267    2         IF KH@IO_INPINTB_STT.INTB_STT.RAMPRTERR OR

   3267   1 000196  82C7 0029                            LB,'0040'X        KH@IO_INPINTB_STT+1,AUTO
   3267   1 000198       0040
          1 000199  0501 009F                            BBT      s:3321,PREL
          1 00019B  82C7 0029                            LB,'0004'X        KH@IO_INPINTB_STT+1,AUTO
          1 00019D       0004
          1 00019E  0501 009A                            BBT      s:3321,PREL
          1 0001A0  82C7 0029                            LB,'0002'X        KH@IO_INPINTB_STT+1,AUTO
          1 0001A2       0002
          1 0001A3  0501 0095                            BBT      s:3321,PREL
          1 0001A5  82C7 0029                            LB,'0001'X        KH@IO_INPINTB_STT+1,AUTO
          1 0001A7       0001
          1 0001A8  0501 0090                            BBT      s:3321,PREL

      212     3268    2           KH@IO_INPINTB_STT.INTB_STT.INVMMRADR OR
      213     3269    2           KH@IO_INPINTB_STT.INTB_STT.BUSPRTERR OR
      214     3270    2           KH@IO_INPINTB_STT.INTB_STT.UN_CRCMMRERR
      215     3271    2         THEN GOTO Y$IO_ERR_BADBLKWRT_MLC16;
      216     3272    2      END; ELSE DO;                        /* ELSE IF KH$CHN.DVCID = '2978'X     */

   3272   1 0001AA  0F81 008B                            B        s:3311,PREL

      217     3273
PL6.E3A0      #001=KHI$DWNLODCCP File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:29 Page:27   
      218     3274        /* MLC-8 (MLCP); use MLCP download mode. */
      219     3275
      220     3276    2         CALL KHI$IOLD(KH$CHN, KH@IOLD) ALTRET(Y$IO_ERR);

   3276   1 0001AC  CBC7 001B                            LAB,B4   KH@IOLD,AUTO
          1 0001AE  CFC7 0030                            STB,B4   Y@LOPCNT+3,AUTO
          1 0001B0  DFC7 002E                            STB,B5   Y@LOPCNT+1,AUTO
          1 0001B2  BBC7 002E                            LAB,B3   Y@LOPCNT+1,AUTO
          1 0001B4  CBF0 0200                            LAB,B4   512,IMO
          1 0001B6  E380 0000 0000  xent                 LNJ,B6   KHI$IOLD
          1 0001B9       00CC                            DC       s:3340,PREL

      221     3277
      222     3278    2         KH@IO_OTPCCBCTR = KH_IO_OTPCCBCTR;

   3278   1 0001BA  8C80 0000 001A  00                   LDI      KH_IO_OTPCCBCTR
          1 0001BD  8D47 0020                            SDI      KH@IO_OTPCCBCTR,AUTO

      223     3279    2         KH@IO_OTPCCBCTR.CCBCTR_RAMADR = KH$CCPLCT.CCPLODBIS;

   3279   1 0001BF  ECC7 0004                            LDB,B6   @KH$DWNLODCCP,AUTO
          1 0001C1  DCC6 0002                            LDB,B5   2,B6
          1 0001C3  D805                                 LDR,R5   ,B5
          1 0001C4  DF47 0021                            STR,R5   KH@IO_OTPCCBCTR+1,AUTO

      224     3280    2         CALL KHI$IO_OTP(KH$CHN, KH@IO_OTPCCBCTR) ALTRET(Y$IO_ERR);

   3280   1 0001C6  DC86                                 LDB,B5   ,B6
          1 0001C7  CBC7 0020                            LAB,B4   KH@IO_OTPCCBCTR,AUTO
          1 0001C9  CFC7 0030                            STB,B4   Y@LOPCNT+3,AUTO
          1 0001CB  DFC7 002E                            STB,B5   Y@LOPCNT+1,AUTO
          1 0001CD  BBC7 002E                            LAB,B3   Y@LOPCNT+1,AUTO
          1 0001CF  CBF0 0200                            LAB,B4   512,IMO
          1 0001D1  E380 0000 0000  xent                 LNJ,B6   KHI$IO_OTP
          1 0001D4       00B1                            DC       s:3340,PREL

      225     3281
PL6.E3A0      #001=KHI$DWNLODCCP File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:29 Page:28   
      226     3282        /* Start the block-mode write. */
      227     3283
      228     3284    2         CALL KHI$IO_OTP(KH$CHN, KH_IO_OTPCHNCTR) ALTRET(Y$IO_ERR);

   3284   1 0001D5  ECC7 0004                            LDB,B6   @KH$DWNLODCCP,AUTO
          1 0001D7  DC86                                 LDB,B5   ,B6
          1 0001D8  CB80 0000 001E  00                   LAB,B4   KH_IO_OTPCHNCTR
          1 0001DB  CFC7 0030                            STB,B4   Y@LOPCNT+3,AUTO
          1 0001DD  DFC7 002E                            STB,B5   Y@LOPCNT+1,AUTO
          1 0001DF  BBC7 002E                            LAB,B3   Y@LOPCNT+1,AUTO
          1 0001E1  CBF0 0200                            LAB,B4   512,IMO
          1 0001E3  E380 0000 0000  xent                 LNJ,B6   KHI$IO_OTP
          1 0001E6       009F                            DC       s:3340,PREL

      229     3285
      230     3286        /* Advance the status CCB pointer to the CCB we just used
      231     3287           (or are still using, if the IO hasn't completed). */
      232     3288
      233     3289    2         KH@IO_INPNXTCCBSTT = KH_IO_INPNXTCCBSTT;

   3289   1 0001E7  8C80 0000 0020  00                   LDI      KH_IO_INPNXTCCBSTT
          1 0001EA  8D47 0024                            SDI      KH@IO_INPNXTCCBSTT,AUTO

      234     3290    2         CALL KHI$IO_INP(KH$CHN, KH@IO_INPNXTCCBSTT) ALTRET(Y$IO_ERR);

   3290   1 0001EC  ECC7 0004                            LDB,B6   @KH$DWNLODCCP,AUTO
          1 0001EE  DC86                                 LDB,B5   ,B6
          1 0001EF  CBC7 0024                            LAB,B4   KH@IO_INPNXTCCBSTT,AUTO
          1 0001F1  CFC7 0030                            STB,B4   Y@LOPCNT+3,AUTO
          1 0001F3  DFC7 002E                            STB,B5   Y@LOPCNT+1,AUTO
          1 0001F5  BBC7 002E                            LAB,B3   Y@LOPCNT+1,AUTO
          1 0001F7  CBF0 0200                            LAB,B4   512,IMO
          1 0001F9  E380 0000 0000  xent                 LNJ,B6   KHI$IO_INP
          1 0001FC       0089                            DC       s:3340,PREL

      235     3291
      236     3292        /* Wait for the block mode write to complete.  When complete,
PL6.E3A0      #001=KHI$DWNLODCCP File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:29 Page:29   
      237     3293           check for IO errors. */
      238     3294
      239     3295    2         KH@IO_INPCCBSTT = KH_IO_INPCCBSTT;

   3295   1 0001FD  8C80 0000 0022  00                   LDI      KH_IO_INPCCBSTT
          1 000200  8D47 0022                            SDI      KH@IO_INPCCBSTT,AUTO

      240     3296    3         DO UNTIL KH@IO_INPCCBSTT.CCBSTT.CCBSTTCMP;

      241     3297    3            CALL KHI$IO_INP(KH$CHN, KH@IO_INPCCBSTT) ALTRET(Y$IO_ERR);

   3297   1 000202  ECC7 0004                            LDB,B6   @KH$DWNLODCCP,AUTO
          1 000204  DC86                                 LDB,B5   ,B6
          1 000205  CBC7 0022                            LAB,B4   KH@IO_INPCCBSTT,AUTO
          1 000207  CFC7 0030                            STB,B4   Y@LOPCNT+3,AUTO
          1 000209  DFC7 002E                            STB,B5   Y@LOPCNT+1,AUTO
          1 00020B  BBC7 002E                            LAB,B3   Y@LOPCNT+1,AUTO
          1 00020D  CBF0 0200                            LAB,B4   512,IMO
          1 00020F  E380 0000 0000  xent                 LNJ,B6   KHI$IO_INP
          1 000212       0073                            DC       s:3340,PREL

      242     3298    3            Y@LOPCNT = Y@LOPCNT - 1;

   3298   1 000213  88C7 002D                            DEC      Y@LOPCNT,AUTO

      243     3299    3            IF Y@LOPCNT = 0 THEN GOTO Y$IO_ERR_BADBLKWRT_MLC8;

   3299   1 000215  E847 002D                            LDR,R6   Y@LOPCNT,AUTO
          1 000217  6901 0039                            BEZ,R6   s:3325,PREL

      244     3300    3         END;                              /* END DO UNTIL CCBSTTCMP             */

   3300   1 000219  82C7 0023                            LB,'1000'X        KH@IO_INPCCBSTT+1,AUTO
   3300   1 00021B       1000
          1 00021C  05E6                                 BBF      s:3297,SPREL

      245     3301    2         IF KH@IO_INPCCBSTT.CCBSTT.CCBSRVERR OR
PL6.E3A0      #001=KHI$DWNLODCCP File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:29 Page:30   

   3301   1 00021D  82C7 0023                            LB,'0800'X        KH@IO_INPCCBSTT+1,AUTO
   3301   1 00021F       0800
          1 000220  0501 0030                            BBT      s:3325,PREL
          1 000222  82C7 0023                            LB,'0040'X        KH@IO_INPCCBSTT+1,AUTO
          1 000224       0040
          1 000225  0501 002B                            BBT      s:3325,PREL
          1 000227  82C7 0023                            LB,'0004'X        KH@IO_INPCCBSTT+1,AUTO
          1 000229       0004
          1 00022A  0501 0026                            BBT      s:3325,PREL
          1 00022C  82C7 0023                            LB,'0002'X        KH@IO_INPCCBSTT+1,AUTO
          1 00022E       0002
          1 00022F  0501 0021                            BBT      s:3325,PREL
          1 000231  82C7 0023                            LB,'0001'X        KH@IO_INPCCBSTT+1,AUTO
          1 000233       0001
          1 000234  0501 001C                            BBT      s:3325,PREL

      246     3302    2           KH@IO_INPCCBSTT.CCBSTT.DATCHKERR OR
      247     3303    2           KH@IO_INPCCBSTT.CCBSTT.INVMMRADR OR
      248     3304    2           KH@IO_INPCCBSTT.CCBSTT.BUSPRTERR OR
      249     3305    2           KH@IO_INPCCBSTT.CCBSTT.UN_CRCMMRERR
      250     3306    2         THEN GOTO Y$IO_ERR_BADBLKWRT_MLC8;
      251     3307    2      END; /* END IF KH$CHN.DVCID = '2978'X */

      252     3308
      253     3309        /* The IO was successful.  Take the normal return. */
      254     3310
      255     3311    1      RETURN;

   3311   1 000236  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      256     3312
      257     3313    1   Y$IO_ERR_BADBLKWRT_MLC16:
      258     3314        /*E* ERROR:         KHI-E$ERR_BADBLKWRT-0
      259     3315        *    MESSAGE:       Hardware problem on block mode write to MLCP/MLC-16
      260     3316        *    DESCRIPTION:   We either never saw CCB-status-complete or we saw
      261     3317        *                   an error on a block mode write.
PL6.E3A0      #001=KHI$DWNLODCCP File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:29 Page:31   
      262     3318        *                   The data in the error log entry is the KH$IO
      263     3319        *                   IO request the error was sensed on.
      264     3320        */
      265     3321    1      FPT@WRSYSLOG = FPT_WRSYSLOG_ERR_BADBLKWRT;

   3321   1 000239  AB80 0000 0000  00   Y$IO_ERR_BADBLK*LAB,B2   FPT_WRSYSLOG_ERR_BADBLKWRT
          1 00023C  2C00                                 LDV,R2   0
          1 00023D  6C2A                                 LDV,R6   42
          1 00023E  BB87                                 LAB,B3   ,AUTO
          1 00023F  3C0C                                 LDV,R3   12
          1 000240  0008                                 MMM

      266     3322    1      FPT@WRSYSLOG.BUF_ = VECTOR(KH@IO_INPINTB_STT);

   3322   1 000241  EBC7 0028                            LAB,B6   KH@IO_INPINTB_STT,AUTO
          1 000243  EFC7 002F                            STB,B6   Y@LOPCNT+2,AUTO
          1 000245  6C03                                 LDV,R6   3
          1 000246  EF47 002E                            STR,R6   Y@LOPCNT+1,AUTO
          1 000248  ABC7 002E                            LAB,B2   Y@LOPCNT+1,AUTO
          1 00024A  2C00                                 LDV,R2   0
          1 00024B  6C06                                 LDV,R6   6
          1 00024C  BB87                                 LAB,B3   ,AUTO
          1 00024D  3C12                                 LDV,R3   18
          1 00024E  0008                                 MMM

      267     3323    1      GOTO Y$IO_ERR_BADBLKWRT20;

   3323   1 00024F  0F81 0017                            B        s:3328,PREL

      268     3324    1   Y$IO_ERR_BADBLKWRT_MLC8:
      269     3325    1      FPT@WRSYSLOG = FPT_WRSYSLOG_ERR_BADBLKWRT;

   3325   1 000251  AB80 0000 0000  00   Y$IO_ERR_BADBLK*LAB,B2   FPT_WRSYSLOG_ERR_BADBLKWRT
          1 000254  2C00                                 LDV,R2   0
          1 000255  6C2A                                 LDV,R6   42
          1 000256  BB87                                 LAB,B3   ,AUTO
          1 000257  3C0C                                 LDV,R3   12
PL6.E3A0      #001=KHI$DWNLODCCP File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:29 Page:32   
          1 000258  0008                                 MMM

      270     3326    1      FPT@WRSYSLOG.BUF_ = VECTOR(KH@IO_INPCCBSTT);

   3326   1 000259  EBC7 0022                            LAB,B6   KH@IO_INPCCBSTT,AUTO
          1 00025B  EFC7 002F                            STB,B6   Y@LOPCNT+2,AUTO
          1 00025D  6C03                                 LDV,R6   3
          1 00025E  EF47 002E                            STR,R6   Y@LOPCNT+1,AUTO
          1 000260  ABC7 002E                            LAB,B2   Y@LOPCNT+1,AUTO
          1 000262  2C00                                 LDV,R2   0
          1 000263  6C06                                 LDV,R6   6
          1 000264  BB87                                 LAB,B3   ,AUTO
          1 000265  3C12                                 LDV,R3   18
          1 000266  0008                                 MMM

      271     3327    1   Y$IO_ERR_BADBLKWRT20:
      272     3328    1      FPT@WRSYSLOG.V.ERRCODE.ERR# = %E$ERR_BADBLKWRT;

   3328   1 000267  E870 3158            Y$IO_ERR_BADBLK*LDR,R6   12632,IMO
          1 000269  EAC7 000D                            SRM,R6,'FFF8'X    FPT@WRSYSLOG+7,AUTO
          1 00026B       FFF8

      273     3329    1      IF ENTADDR(KHD$ERRLOG_SETTERMID_CHN) ~= ENTADDR(NIL) THEN

   3329   1 00026C  EB80 0000 0000  xent                 LAB,B6   KHD$ERRLOG_SETTERMID_CHN
          1 00026F  ED80 0000 0000  02                   CMB,B6   0
          1 000272  0901 0012                            BE       s:3340,PREL

      274     3330        /*
      275     3331        KHD$ERRLOG_.. exists (we're not linked with the monitor),
      276     3332        so call it to make the error log entry.
      277     3333        */
      278     3334    1      CALL KHD$ERRLOG_SETTERMID_CHN (FPT@WRSYSLOG, KH$CHN);

   3334   1 000274  ECC7 0004                            LDB,B6   @KH$DWNLODCCP,AUTO
          1 000276  DC86                                 LDB,B5   ,B6
          1 000277  DFC7 0030                            STB,B5   Y@LOPCNT+3,AUTO
PL6.E3A0      #001=KHI$DWNLODCCP File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:29 Page:33   
          1 000279  CBC7 0006                            LAB,B4   FPT@WRSYSLOG,AUTO
          1 00027B  CFC7 002E                            STB,B4   Y@LOPCNT+1,AUTO
          1 00027D  BBC7 002E                            LAB,B3   Y@LOPCNT+1,AUTO
          1 00027F  CBF0 0200                            LAB,B4   512,IMO
          1 000281  E380 0000 0000  xent                 LNJ,B6   KHD$ERRLOG_SETTERMID_CHN
          1 000284       0001                            DC       s:3340,PREL

      279     3335
      280     3336    1   Y$IO_ERR:
      281     3337
      282     3338        /* A fatal IO error occurred.  Set KH$CHN.DED, and ALTRET. */
      283     3339
      284     3340    1      KH$CHN.DED = '1'B;

   3340   1 000285  ECC7 0004            Y$IO_ERR        LDB,B6   @KH$DWNLODCCP,AUTO
          1 000287  DC86                                 LDB,B5   ,B6
          1 000288  8945 0009                            LBT,'0100'X       9,B5
          1 00028A       0100

      285     3341    1      ALTRETURN;

   3341   1 00028B  C380 0000 0000  xent                 LNJ,B4   X6A_AALT
      286     3342    1   END KHI$DWNLODCCP;                      /* END PROC                           */
      287     3343        %EOD;

PL6.E3A0      #001=KHI$DWNLODCCP File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:29 Page:34   
--  Include file information  --

   KH$IO.:E05TOU  is referenced.
   KH_ERRORS_C.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   GH_IOFNC_E.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is never referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is never referenced.
   KV$USR.:E05TOU  was found in the system file and is never referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is never referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is never referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is referenced.
   KI_CP6.:E05TOU  was found in the system file and is referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure KHI$DWNLODCCP.
PL6.E3A0      #001=KHI$DWNLODCCP File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:29 Page:35   

 **** Variables and constants ****

  ****  Section 000 RoData KHI$DWNLODCCP

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(336)   r     1 FPT_WRSYSLOG_ERR_BADBLKWRT
    15-0-0/w STRC(80)    r     1 KH_IOLD                   22-0-0/w STRC(32)    r     1 KH_IO_INPCCBSTT
    28-0-0/w STRC(32)    r     1 KH_IO_INPINTB_STT         20-0-0/w STRC(32)    r     1 KH_IO_INPNXTCCBSTT
    33-0-0/w STRC(32)    r     1 KH_IO_INPSLCSTT           1A-0-0/w STRC(32)    r     1 KH_IO_OTPCCBCTR
    1E-0-0/w STRC(32)    r     1 KH_IO_OTPCHNCTR
    2D-0-0/w STRC(32)    r     1 KH_IO_OTPCHNCTR_CCBLSTRST
    2F-0-0/w STRC(32)    r     1 KH_IO_OTPCHNCTR_STPIO
    26-0-0/w STRC(32)    r     1 KH_IO_OTPCTR              1C-0-0/w STRC(32)    r     1 KH_IO_OTPINTCTR
    24-0-0/w STRC(32)    r     1 KH_IO_OTPRAMCTR           31-0-0/w STRC(32)    r     1 KH_IO_STOP_SLCC
    2A-0-0/w STRC(48)    r     1 KH_RLCCCPLCT

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @KH$DWNLODCCP              6-0-0/w STRC(336)   r     1 FPT@WRSYSLOG
    *0-0-0/w STRC(80)    r     1 KH$DWNLODCCP              1B-0-0/w STRC(80)    r     1 KH@IOLD
    22-0-0/w STRC(32)    r     1 KH@IO_INPCCBSTT           28-0-0/w STRC(32)    r     1 KH@IO_INPINTB_STT
    24-0-0/w STRC(32)    r     1 KH@IO_INPNXTCCBSTT        20-0-0/w STRC(32)    r     1 KH@IO_OTPCCBCTR
    26-0-0/w STRC(32)    r     1 KH@IO_OTPRAMCTR           2A-0-0/w STRC(48)    r     1 KH@RLCCCPLCT
    2D-0-0/w UBIN(16)    r     1 Y@LOPCNT

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(2360)  r     1 KH$CCPLCT                  0-0-0/w STRC(512)   r     1 KH$CHN

PL6.E3A0      #001=KHI$DWNLODCCP File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:29 Page:36   

   Procedure KHI$DWNLODCCP requires 654 words for executable code.
   Procedure KHI$DWNLODCCP requires 50 words of local(AUTO) storage.
PL6.E3A0      #001=KHI$DWNLODCCP File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:29 Page:37   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=KHI$DWNLODCCP File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:29 Page:38   
          MINI XREF LISTING

FPT@WRSYSLOG
      2435**DCL      3321<<ASSIGN   3325<<ASSIGN   3334<>CALL
FPT@WRSYSLOG.BUF_
      2437**DCL      3322<<ASSIGN   3326<<ASSIGN
FPT@WRSYSLOG.V.ERRCODE.ERR#
      2483**DCL      3328<<ASSIGN
FPT@WRSYSLOG.V.TERMID.TERM
      2504**DCL      2513--REDEF
FPT_WRSYSLOG_ERR_BADBLKWRT
       733**DCL      3321>>ASSIGN   3325>>ASSIGN
FPT_WRSYSLOG_ERR_BADBLKWRT.V
       737**DCL       735--DCLINIT
FPT_WRSYSLOG_ERR_BADBLKWRT.V.TERMID.TERM
       802**DCL       811--REDEF
KH$CCPLCT
      2283**DCL      3202--ASSIGN
KH$CCPLCT.CCP
      2293**DCL      3190--ASSIGN
KH$CCPLCT.CCPBYTSIZ
      2289**DCL      3191>>ASSIGN
KH$CCPLCT.CCPLODBIS
      2289**DCL      3195>>IF       3222>>ASSIGN   3253>>ASSIGN   3279>>ASSIGN
KH$CCPLCT.CCPRLCTBLWRDX
      2289**DCL      2289--REDEF
KH$CCPLCT.LCTBYT
      2290**DCL      2290--REDEF    2290--REDEF
KH$CCPLCT.LCTRLCTBL_BYT
      2292**DCL      2293--REDEF
KH$CCPLCT.SLCSPM
      2290**DCL      3249--ASSIGN
KH$CCPLCT.SLCSPMWRDSIZ
      2289**DCL      3249>>ASSIGN
PL6.E3A0      #001=KHI$DWNLODCCP File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:29 Page:39   
KH$CHN
      2310**DCL      3175<>CALL     3176<>CALL     3185<>CALL     3208<>CALL     3219<>CALL     3223<>CALL
      3225<>CALL     3232<>CALL     3254<>CALL     3256<>CALL     3265<>CALL     3276<>CALL     3280<>CALL
      3284<>CALL     3290<>CALL     3297<>CALL     3334<>CALL
KH$CHN.ATTR
      2343**DCL      3174>>IF       3184>>IF       3241>>IF
KH$CHN.DED
      2370**DCL      3181<<ASSIGN   3340<<ASSIGN
KH$CHN.DVCID
      2336**DCL      3211>>IF
KH$CHN.TERMID.TERM
      2406**DCL      2415--REDEF
KH$DWNLODCCP
       708**DCL        13--PROC
KH$DWNLODCCP.CCPLCT$
       714**DCL      2283--IMP-PTR  3190>>ASSIGN   3191>>ASSIGN   3195>>IF       3202>>ASSIGN   3222>>ASSIGN
      3249>>ASSIGN   3249>>ASSIGN   3253>>ASSIGN   3279>>ASSIGN
KH$DWNLODCCP.CCPLODBIS
       714**DCL      3195>>IF       3195>>IF       3201>>ASSIGN
KH$DWNLODCCP.CHN$
       714**DCL      2310--IMP-PTR  3174>>IF       3175>>CALL     3176>>CALL     3181>>ASSIGN   3184>>IF
      3185>>CALL     3208>>CALL     3211>>IF       3219>>CALL     3223>>CALL     3225>>CALL     3232>>CALL
      3241>>IF       3254>>CALL     3256>>CALL     3265>>CALL     3276>>CALL     3280>>CALL     3284>>CALL
      3290>>CALL     3297>>CALL     3334>>CALL     3340>>ASSIGN
KH@IOLD
      2531**DCL      3189<<ASSIGN   3219<>CALL     3256<>CALL     3276<>CALL
KH@IOLD.BFR_.ADR$
      2564**DCL      3190<<ASSIGN   3249<<ASSIGN
KH@IOLD.BFR_.BYTSIZ
      2564**DCL      3191<<ASSIGN   3218<<ASSIGN   3218>>ASSIGN   3248<<ASSIGN   3248>>ASSIGN
KH@IOLD.FNC
      2540**DCL      3250<<ASSIGN
KH@IO_INPCCBSTT
      2696**DCL      3295<<ASSIGN   3297<>CALL     3326--ASSIGN
KH@IO_INPCCBSTT.ASNSTT
      2705**DCL      2706--REDEF    2712--REDEF    2717--REDEF    2721--REDEF    2725--REDEF    2729--REDEF
PL6.E3A0      #001=KHI$DWNLODCCP File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:29 Page:40   
      2736--REDEF    2742--REDEF    2748--REDEF    2753--REDEF    2760--REDEF    2763--REDEF    2767--REDEF
      2774--REDEF    2778--REDEF    2782--REDEF    2786--REDEF    2791--REDEF    2795--REDEF
KH@IO_INPCCBSTT.CCBSTT.BUSPRTERR
      2769**DCL      3301>>IF
KH@IO_INPCCBSTT.CCBSTT.CCBSRVERR
      2768**DCL      3301>>IF
KH@IO_INPCCBSTT.CCBSTT.CCBSTTCMP
      2767**DCL      3296>>DOUNTIL
KH@IO_INPCCBSTT.CCBSTT.DATCHKERR
      2768**DCL      3301>>IF
KH@IO_INPCCBSTT.CCBSTT.INVMMRADR
      2769**DCL      3301>>IF
KH@IO_INPCCBSTT.CCBSTT.UN_CRCMMRERR
      2770**DCL      3301>>IF
KH@IO_INPINTB_STT
      3041**DCL      3230<<ASSIGN   3232<>CALL     3261<<ASSIGN   3265<>CALL     3322--ASSIGN
KH@IO_INPINTB_STT.ASNSTT
      3050**DCL      3051--REDEF    3057--REDEF    3062--REDEF    3066--REDEF    3070--REDEF    3074--REDEF
      3081--REDEF    3087--REDEF    3093--REDEF    3098--REDEF    3105--REDEF    3108--REDEF    3112--REDEF
      3119--REDEF    3123--REDEF    3127--REDEF    3131--REDEF    3136--REDEF    3140--REDEF
KH@IO_INPINTB_STT.INTB_STT.BUSPRTERR
      3088**DCL      3236>>IF       3267>>IF
KH@IO_INPINTB_STT.INTB_STT.INVMMRADR
      3088**DCL      3236>>IF       3267>>IF
KH@IO_INPINTB_STT.INTB_STT.RAMDATTRNCMP
      3088**DCL      3231>>DOUNTIL  3262>>DOUNTIL
KH@IO_INPINTB_STT.INTB_STT.RAMPRTERR
      3087**DCL      3236>>IF       3267>>IF
KH@IO_INPINTB_STT.INTB_STT.UN_CRCMMRERR
      3089**DCL      3236>>IF       3267>>IF
KH@IO_INPNXTCCBSTT
      2811**DCL      3289<<ASSIGN   3290<>CALL
KH@IO_INPNXTCCBSTT.ASNSTT
      2820**DCL      2821--REDEF    2827--REDEF    2832--REDEF    2836--REDEF    2840--REDEF    2844--REDEF
      2851--REDEF    2857--REDEF    2863--REDEF    2868--REDEF    2875--REDEF    2878--REDEF    2882--REDEF
      2889--REDEF    2893--REDEF    2897--REDEF    2901--REDEF    2906--REDEF    2910--REDEF
PL6.E3A0      #001=KHI$DWNLODCCP File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:29 Page:41   
KH@IO_OTPCCBCTR
      2581**DCL      3278<<ASSIGN   3280<>CALL
KH@IO_OTPCCBCTR.ASNSTT
      2590**DCL      2591--REDEF    2597--REDEF    2602--REDEF    2606--REDEF    2610--REDEF    2614--REDEF
      2621--REDEF    2627--REDEF    2633--REDEF    2638--REDEF    2645--REDEF    2648--REDEF    2652--REDEF
      2659--REDEF    2663--REDEF    2667--REDEF    2671--REDEF    2676--REDEF    2680--REDEF
KH@IO_OTPCCBCTR.CCBCTR_RAMADR
      2648**DCL      3279<<ASSIGN
KH@IO_OTPRAMCTR
      2926**DCL      3221<<ASSIGN   3223<>CALL     3252<<ASSIGN   3254<>CALL
KH@IO_OTPRAMCTR.ASNSTT
      2935**DCL      2936--REDEF    2942--REDEF    2947--REDEF    2951--REDEF    2955--REDEF    2959--REDEF
      2966--REDEF    2972--REDEF    2978--REDEF    2983--REDEF    2990--REDEF    2993--REDEF    2997--REDEF
      3004--REDEF    3008--REDEF    3012--REDEF    3016--REDEF    3021--REDEF    3025--REDEF
KH@IO_OTPRAMCTR.RAMADR
      3016**DCL      3222<<ASSIGN   3253<<ASSIGN
KH@RLCCCPLCT
      3157**DCL      3200<<ASSIGN   3203<>CALL
KH@RLCCCPLCT.CCPLCT$
      3163**DCL      3202<<ASSIGN
KH@RLCCCPLCT.CCPLODBIS
      3163**DCL      3201<<ASSIGN
KHD$ERRLOG_SETTERMID_CHN
       685**DCL-ENT  3329--IF       3334--CALL
KHI$IOLD
       688**DCL-ENT  3276--CALL
KHI$IOLD_FNC
       689**DCL-ENT  3219--CALL     3256--CALL
KHI$IO_INP
       686**DCL-ENT  3232--CALL     3265--CALL     3290--CALL     3297--CALL
KHI$IO_OTP
       687**DCL-ENT  3175--CALL     3176--CALL     3185--CALL     3208--CALL     3223--CALL     3225--CALL
      3254--CALL     3280--CALL     3284--CALL
KHI$RLCCCPLCT
       690**DCL-ENT  3203--CALL
KH_IOLD
PL6.E3A0      #001=KHI$DWNLODCCP File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:29 Page:42   
       829**DCL      3189>>ASSIGN
KH_IO_INPCCBSTT
      1339**DCL      3295>>ASSIGN
KH_IO_INPINTB_STT
      1684**DCL      3230>>ASSIGN
KH_IO_INPNXTCCBSTT
      1224**DCL      3289>>ASSIGN
KH_IO_INPSLCSTT
      2164**DCL      3261>>ASSIGN
KH_IO_OTPCCBCTR
       879**DCL      3278>>ASSIGN
KH_IO_OTPCCBCTR.CCBCTR
       943**DCL       946--REDEF
KH_IO_OTPCHNCTR
      1109**DCL      3284<>CALL
KH_IO_OTPCHNCTR_CCBLSTRST
      1821**DCL      3185<>CALL
KH_IO_OTPCHNCTR_STPIO
      1936**DCL      3176<>CALL
KH_IO_OTPCTR
      1569**DCL      3225<>CALL
KH_IO_OTPINTCTR
       994**DCL      3208<>CALL
KH_IO_OTPRAMCTR
      1454**DCL      3221>>ASSIGN   3252>>ASSIGN
KH_IO_STOP_SLCC
      2050**DCL      3175<>CALL
KH_RLCCCPLCT
      1800**DCL      3200>>ASSIGN
Y$1ST_IO
      3172**LABEL    3179--GOTO
Y$IO_ERR
      3340**LABEL    3178--GOTO     3185--CALLALT  3208--CALLALT  3219--CALLALT  3223--CALLALT  3225--CALLALT
      3232--CALLALT  3254--CALLALT  3256--CALLALT  3265--CALLALT  3276--CALLALT  3280--CALLALT  3284--CALLALT
      3290--CALLALT  3297--CALLALT
Y$IO_ERR_BADBLKWRT20
PL6.E3A0      #001=KHI$DWNLODCCP File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:29 Page:43   
      3328**LABEL    3323--GOTO
Y$IO_ERR_BADBLKWRT_MLC16
      3321**LABEL    3234--GOTO     3240--GOTO     3264--GOTO     3271--GOTO
Y$IO_ERR_BADBLKWRT_MLC8
      3325**LABEL    3299--GOTO     3306--GOTO
Y$RETRY_1ST
      3177**LABEL    3175--CALLALT
Y@LOPCNT
      3169**DCL      3172<<ASSIGN   3177<<ASSIGN   3177>>ASSIGN   3178>>IF       3210<<ASSIGN   3233<<ASSIGN
      3233>>ASSIGN   3234>>IF       3263<<ASSIGN   3263>>ASSIGN   3264>>IF       3298<<ASSIGN   3298>>ASSIGN
      3299>>IF

PL6.E3A0      #002=KHI$DWNLODLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:44   
      288        1        /*T***********************************************************/
      289        2        /*T*                                                         */
      290        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      291        4        /*T*                                                         */
      292        5        /*T***********************************************************/
      293        6        KHI$DWNLODLCT: PROC(KH$DWNLODLCT) ALTRET;
      294        7
      295        8        /*F* NAME: KHI$DWNLODLCT - Down Load LCT into MLCP.
      296        9
      297       10        This routine resets the MLCP for the specified line,
      298       11        and then down-loads the specified LCTs for that line.
      299       12        IOs yielding IO NAKs are re-tried, and errors are logged.
      300       13
      301       14        If an irrecoverable IO error occurs, KH$CHN.DED (channel dead)
      302       15        will be set, and the ALTRET will be taken.
      303       16
      304       17        The form of the call for this service is:
      305       18
      306       19        .fif
      307       20           CALL KHI$DWNLODLCT(kh$dwnlodlct) ALTRET(label);
      308       21        .fin
      309       22
      310       23        where:
      311       24        */
      312       25
      313       26        /*K* kh$dwnlodlct -
      314       27        is the structure defined by the KH$DWNLODLCT macro.
      315       28        This macro is in file KH$IO.  See the description of
      316       29        KH$DWNLODLCT below for details.
      317       30        */
      318       31
      319       32        /* INCLUDEs */
      320       33
      321       34        %INCLUDE LCP_6;
      322      225        %INCLUDE GH_IOFNC_E;
      323      294        %INCLUDE KH$CHN;
      324      416        %INCLUDE KH$IO;
PL6.E3A0      #002=KHI$DWNLODLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:45   
      325      663 S      %INCLUDE KV$GLB;
      326      664
      327      665        /* Declare external routines needed. */
      328      666
      329      667    1   DCL KHI$IOLD_FNC ENTRY(2) ALTRET;
      330      668    1   DCL KHI$IO_INP ENTRY(2) ALTRET;
      331      669    1   DCL KHI$IO_OTP ENTRY(2) ALTRET;
      332      670    1   DCL KHI$IO_OTPLCTBYT ENTRY(2) ALTRET;
      333      671    1   DCL KHI$RLCCCPLCT ENTRY(1) ALTRET;
      334      672
      335      673        /* Declare parameters */
      336      674
      337      675        %KH$DWNLODLCT (NAME = KH$DWNLODLCT, STCLASS = );
      338      699
      339      700        /* Declare CONSTANT and STATIC data. */
      340      701
      341      702        %KH$IO (FPTN = KH_IO_OTPLCTBYT, STCLASS = CONSTANT,
      342      703         FNC = %GH#IO_OTPLCTBYT);
      343      817        %KH$IO (FPTN = KH_IO_OTPINTCTR, STCLASS = CONSTANT, OTPCHN = YES,
      344      818         FNC = %GH#IO_OTPINTCTR);
      345      932        %KH$IO (FPTN = KH_IO_OTPCHNCTR_CCBLSTRST, STCLASS = CONSTANT,
      346      933         FNC = %GH#IO_OTPCHNCTR, CCBLSTRST = YES);
      347     1047        %KH$IO (FPTN = KH_IO_OTPCHNCTR_STPIO, STCLASS = CONSTANT,
      348     1048         FNC = %GH#IO_OTPCHNCTR, STPIO = YES);
      349     1162        %KH$IO (FPTN=KH_IO_OTPRAMCTR, STCLASS=CONSTANT, RAMADR=168,
      350     1163         FNC=%GH#IO_OTPRAMCTR, OTPCHN=YES);
      351     1277        %KH$IO (FPTN=KH_IO_INPSLCSTT, STCLASS=CONSTANT,
      352     1278         FNC=%GH#IO_INPSTT, OTPCHN=YES);
      353     1392        %KH$IO (FPTN=KH_IO_OTPCTR_STPIO, STCLASS=CONSTANT,
      354     1393         FNC=%GH#IO_OTPCTR, STPIO=YES, OTPCHN=YES);
      355     1507        %KH$RLCCCPLCT (NAME = KH_RLCCCPLCT, STCLASS = SYMREF READONLY);
      356     1529
      357     1530        /* Declare based structures */
      358     1531
      359     1532        %KH$CCPLCT (NAME = KH$CCPLCT, STCLASS = "BASED(KH$DWNLODLCT.CCPLCT$)");
      360     1558        %KH$CHN (NAME = KH$CHN, STCLASS = "BASED(KH$DWNLODLCT.CHN$)");
      361     1682
PL6.E3A0      #002=KHI$DWNLODLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:46   
      362     1683        /* Declare AUTO data */
      363     1684
      364     1685        %KH$IO (FPTN = KH@IO_OTPLCTBYT, STCLASS = AUTO,
      365     1686         FNC = %GH#IO_OTPLCTBYT);
      366     1800        %KH$IO (FPTN = KH@IO_OTPINTCTR, STCLASS = AUTO,
      367     1801         FNC = %GH#IO_OTPINTCTR);
      368     1915        %KH$IO (FPTN = KH@IO_OTPCHNCTR_CCBLSTRST, STCLASS = AUTO,
      369     1916         FNC = %GH#IO_OTPCHNCTR, CCBLSTRST = YES);
      370     2030        %KH$IO (FPTN = KH@IO_OTPCHNCTR_STPIO, STCLASS = AUTO,
      371     2031         FNC = %GH#IO_OTPCHNCTR, STPIO = YES);
      372     2145        %KH$IOLD (FPTN=KH@IOLD, STCLASS=AUTO);
      373     2196        %KH$IO (FPTN=KH@IO_INPINTB_STT, STCLASS=AUTO,
      374     2197         FNC=%GH#IO_INPINTB_STT, OTPCHN=YES);
      375     2311        %KH$RLCCCPLCT (NAME = KH@RLCCCPLCT, STCLASS = AUTO);
      376     2333    1   DCL Y@LOPCNT UBIN WORD AUTO;
      377     2334    1   DCL Y@LCTADRHI UBIN WORD AUTO;
      378     2335
      379     2336        /* Initialize AUTO copies of structures. */
      380     2337
      381     2338    1      KH@IO_OTPINTCTR = KH_IO_OTPINTCTR;
      382     2339    1      KH@IO_OTPCHNCTR_STPIO = KH_IO_OTPCHNCTR_STPIO;
      383     2340    1      KH@IO_OTPCHNCTR_CCBLSTRST = KH_IO_OTPCHNCTR_CCBLSTRST;
      384     2341    1      KH@IO_OTPLCTBYT = KH_IO_OTPLCTBYT;
      385     2342
      386     2343    1      IF KH$CHN.EXTDVCID = '2978'X THEN
      387     2344    1      Y@LCTADRHI = 255;                    /* MLC-16                             */
      388     2345    1      ELSE
      389     2346    1      Y@LCTADRHI = 63;                     /* MCLP (MLC-8)                       */
      390     2347
      391     2348        /* CCBLSTRST makes CCBSTTPTR no longer valid. */
      392     2349
      393     2350    1      KH$CHN.INPCCBSTTPTRVLD = '0'B;
      394     2351    1      KH$CHN.OTPCCBSTTPTRVLD = '0'B;
      395     2352
      396     2353    2      IF KH$CHN.ATTR&%G_ATTR_CL_SLCC THEN DO;
      397     2354        /*
      398     2355           For the SLCC, use RAMDATTRN to load up the scratchpad memory.
PL6.E3A0      #002=KHI$DWNLODLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:47   
      399     2356        */
      400     2357    2         CALL KHI$IO_OTP(KH$CHN, KH_IO_OTPCTR_STPIO);
      401     2358    2         Y@LOPCNT = 10000;
      402     2359    2         KH@IOLD.OTPCHN = '1'B;
      403     2360    2         KH@IOLD.FNC = %GH#IO_IOLD_SLCRAMTRN;
      404     2361    2         KH@IOLD.BFR_.ADR$ = ADDR(KH$CCPLCT.SLCSPM);
      405     2362    2         KH@IOLD.BFR_.BYTSIZ = KH$CCPLCT.SLCSPMWRDSIZ*2;
      406     2363    2         KH@IOLD.BFR_.BYTX = 0;
      407     2364    2         CALL KHI$IO_OTP(KH$CHN, KH_IO_OTPRAMCTR) ALTRET(Y$IO_ERR);
      408     2365
      409     2366    2         CALL KHI$IOLD_FNC(KH$CHN, KH@IOLD) ALTRET(Y$IO_ERR);
      410     2367
      411     2368        /* Wait for the RAM data transfer to complete.  When complete,
      412     2369           check for IO errors. */
      413     2370
      414     2371    2         KH@IO_INPINTB_STT = KH_IO_INPSLCSTT;
      415     2372    3         DO UNTIL KH@IO_INPINTB_STT.INTB_STT.RAMDATTRNCMP;
      416     2373    3            Y@LOPCNT = Y@LOPCNT-1;
      417     2374    3            IF Y@LOPCNT=0 THEN GOTO Y$IO_ERR;
      418     2375    3            CALL KHI$IO_INP(KH$CHN, KH@IO_INPINTB_STT) ALTRET(Y$IO_ERR);
      419     2376    3         END;                              /* END DO UNTIL FNCCMP                */
      420     2377    2         IF KH@IO_INPINTB_STT.INTB_STT.RAMPRTERR OR
      421     2378    2           KH@IO_INPINTB_STT.INTB_STT.INVMMRADR OR
      422     2379    2           KH@IO_INPINTB_STT.INTB_STT.BUSPRTERR OR
      423     2380    2           KH@IO_INPINTB_STT.INTB_STT.UN_CRCMMRERR
      424     2381    2         THEN GOTO Y$IO_ERR;
      425     2382    2         GOTO Y$SET_INTLVL;
      426     2383    2      END;
      427     2384    2      DO Y@LOPCNT = 0 TO 32 BY 32;
      428     2385
      429     2386        /* This loop is traversed once for the input channel and once for
      430     2387        the output channel. */
      431     2388
      432     2389        /* Stop IO on the channel. */
      433     2390
      434     2391    2         CALL KHI$IO_OTP(KH$CHN, KH@IO_OTPCHNCTR_STPIO) ALTRET(Y$IO_ERR);
      435     2392
PL6.E3A0      #002=KHI$DWNLODLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:48   
      436     2393        /* Clear LCTs 5, 9, 22, 37, 41, and 56. */
      437     2394
      438     2395    2         KH@IO_OTPLCTBYT.LCTBYT.ADR = Y@LOPCNT + 5;
      439     2396    2         CALL Y$OTPLCTBYT ALTRET(Y$IO_ERR);
      440     2397    2         KH@IO_OTPLCTBYT.LCTBYT.ADR = Y@LOPCNT + 9;
      441     2398    2         CALL Y$OTPLCTBYT ALTRET(Y$IO_ERR);
      442     2399    2         KH@IO_OTPLCTBYT.LCTBYT.ADR = Y@LOPCNT + 22;
      443     2400    2         CALL Y$OTPLCTBYT ALTRET(Y$IO_ERR);
      444     2401
      445     2402        /* Do a CCB list reset */
      446     2403
      447     2404    2         CALL KHI$IO_OTP(KH$CHN, KH@IO_OTPCHNCTR_CCBLSTRST) ALTRET(Y$IO_ERR);
      448     2405
      449     2406        /* Set up so that if this is the input channel pass, we'll be
      450     2407        addressing the output channel on the next pass. */
      451     2408
      452     2409    2         KH@IO_OTPCHNCTR_STPIO.OTPCHN = '1'B;
      453     2410    2         KH@IO_OTPCHNCTR_CCBLSTRST.OTPCHN = '1'B;
      454     2411    2      END;                                 /* END DO Y@LOPCNT = 0 TO 32 BY 32    */
      455     2412
      456     2413        /* Down-load the LCTs passed by the caller. */
      457     2414
      458     2415    1      IF (KH$DWNLODLCT.CCPLODBIS ~= 0)
      459     2416    2        AND (KH$DWNLODLCT.CCPLODBIS ~= KH$CCPLCT.CCPLODBIS) THEN DO;
      460     2417        /*
      461     2418        The load bias (RAM address) indicates we need to relocate the CCP and LCTs.
      462     2419        */
      463     2420    2         KH@RLCCCPLCT = KH_RLCCCPLCT;
      464     2421    2         KH@RLCCCPLCT.CCPLODBIS = KH$DWNLODLCT.CCPLODBIS;
      465     2422    2         KH@RLCCCPLCT.CCPLCT$ = ADDR(KH$CCPLCT);
      466     2423    2         CALL KHI$RLCCCPLCT(KH@RLCCCPLCT);
      467     2424    2      END;                  /* END IF CCPLODBIS ~= 0 & CCPLODBIS ~= CCPLODBIS    */
      468     2425    2      DO KH@IO_OTPLCTBYT.LCTBYT.ADR = 0 TO Y@LCTADRHI;
      469     2426    2         KH@IO_OTPLCTBYT.LCTBYT.DAT = KH$CCPLCT.LCTBYT(KH@IO_OTPLCTBYT.LCTBYT.ADR);
      470     2427    2         CALL Y$OTPLCTBYT ALTRET(Y$IO_ERR);
      471     2428    2      END;                            /* END DO LCTBYT.ADR = 0 TO Y@LCTADRHI     */
      472     2429
PL6.E3A0      #002=KHI$DWNLODLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:49   
      473     2430    1   Y$SET_INTLVL:;
      474     2431        /* Set the return interrupt level for the transmit channel */
      475     2432
      476     2433    1      KH@IO_OTPINTCTR.INTCTR.INTLVL = KH$DWNLODLCT.TRNINTLVL;
      477     2434    1      CALL KHI$IO_OTP(KH$CHN, KH@IO_OTPINTCTR) ALTRET(Y$IO_ERR);
      478     2435
      479     2436        /* Set the return interrupt level for the receive channel */
      480     2437
      481     2438    1      KH@IO_OTPINTCTR.OTPCHN = '0'B;
      482     2439    1      KH@IO_OTPINTCTR.INTCTR.INTLVL = KH$DWNLODLCT.RCVINTLVL;
      483     2440    1      CALL KHI$IO_OTP(KH$CHN, KH@IO_OTPINTCTR) ALTRET(Y$IO_ERR);
      484     2441    1      KH$CHN.DWNLOD = '1'B;
      485     2442    1      KH$CHN.OTPCCBCNT = 0;
      486     2443    1      KH$CHN.INPCCBCNT = 0;
      487     2444    1      RETURN;
      488     2445
      489     2446    1   Y$IO_ERR:
      490     2447
      491     2448        /* We had a fatal IO error (irrecoverable IO NAK or trap 15).
      492     2449        Say the channel is dead, error log, and ALTRET. */
      493     2450
      494     2451        /*N* ERRLOG IO ERROR */
      495     2452    1      KH$CHN.DED = '1'B;
      496     2453    1      ALTRETURN;
      497     2454
      498     2455        /* Output an LCT byte to the MLCP. */
      499     2456
      500     2457    1   Y$OTPLCTBYT: PROC ALTRET;
      501     2458    2      CALL KHI$IO_OTPLCTBYT(KH$CHN, KH@IO_OTPLCTBYT)
      502     2459    3      WHENALTRETURN DO; ALTRETURN; END;
      503     2460    2   END Y$OTPLCTBYT;                        /* END PROC                           */
      504     2461    1   END KHI$DWNLODLCT;                      /* END PROC                           */
      505     2462        %EOD;

PL6.E3A0      #002=KHI$DWNLODLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:50   
--  Include file information  --

   KH$IO.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   GH_IOFNC_E.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is never referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is never referenced.
   KV$USR.:E05TOU  was found in the system file and is never referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is never referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is never referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is referenced.
   KI_CP6.:E05TOU  was found in the system file and is referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure KHI$DWNLODLCT.

   Procedure KHI$DWNLODLCT requires 439 words for executable code.
   Procedure KHI$DWNLODLCT requires 32 words of local(AUTO) storage.

PL6.E3A0      #002=KHI$DWNLODLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:51   

 Object Unit name= KHI$DWNLODLCT                              File name= KHI$CLCIO.:E05TOU
 UTS= JUL 30 '97 00:30:02.56 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0  RoData even  UTS     14      E  KHI$DWNLODLCT
    1   Proc  even  none   439    1B7  KHI$DWNLODLCT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        1  KHI$DWNLODLCT

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       2 KHI$IO_OTP
 yes     yes           Std       2 KHI$IOLD_FNC
 yes     yes           Std       2 KHI$IO_INP
 yes     yes           Std       1 KHI$RLCCCPLCT
 yes     yes           Std       2 KHI$IO_OTPLCTBYT
                       nStd      0 X6A_AUTO_1
                       nStd      0 X6A_ARET
                       nStd      0 X6A_AALT
PL6.E3A0      #002=KHI$DWNLODLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:52   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
r    KH_RLCCCPLCT                     r    G$ROS$
PL6.E3A0      #002=KHI$DWNLODLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:53   


      288        1        /*T***********************************************************/
      289        2        /*T*                                                         */
      290        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      291        4        /*T*                                                         */
      292        5        /*T***********************************************************/
      293        6        KHI$DWNLODLCT: PROC(KH$DWNLODLCT) ALTRET;

      6   1 000000  D380 0000 0000  xent KHI$DWNLODLCT   LNJ,B5   X6A_AUTO_1
          1 000003       0020 0001                       DC       32,1

      294        7
      295        8        /*F* NAME: KHI$DWNLODLCT - Down Load LCT into MLCP.
      296        9
      297       10        This routine resets the MLCP for the specified line,
      298       11        and then down-loads the specified LCTs for that line.
      299       12        IOs yielding IO NAKs are re-tried, and errors are logged.
      300       13
      301       14        If an irrecoverable IO error occurs, KH$CHN.DED (channel dead)
      302       15        will be set, and the ALTRET will be taken.
      303       16
      304       17        The form of the call for this service is:
      305       18
      306       19        .fif
      307       20           CALL KHI$DWNLODLCT(kh$dwnlodlct) ALTRET(label);
      308       21        .fin
      309       22
      310       23        where:
      311       24        */
      312       25
      313       26        /*K* kh$dwnlodlct -
      314       27        is the structure defined by the KH$DWNLODLCT macro.
      315       28        This macro is in file KH$IO.  See the description of
      316       29        KH$DWNLODLCT below for details.
      317       30        */
      318       31
      319       32        /* INCLUDEs */
PL6.E3A0      #002=KHI$DWNLODLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:54   
      320       33
      321       34        %INCLUDE LCP_6;
      322      225        %INCLUDE GH_IOFNC_E;
      323      294        %INCLUDE KH$CHN;
      324      416        %INCLUDE KH$IO;
      325      663 S      %INCLUDE KV$GLB;
      326      664
      327      665        /* Declare external routines needed. */
      328      666
      329      667    1   DCL KHI$IOLD_FNC ENTRY(2) ALTRET;
      330      668    1   DCL KHI$IO_INP ENTRY(2) ALTRET;
      331      669    1   DCL KHI$IO_OTP ENTRY(2) ALTRET;
      332      670    1   DCL KHI$IO_OTPLCTBYT ENTRY(2) ALTRET;
      333      671    1   DCL KHI$RLCCCPLCT ENTRY(1) ALTRET;
      334      672
      335      673        /* Declare parameters */
      336      674
      337      675        %KH$DWNLODLCT (NAME = KH$DWNLODLCT, STCLASS = );
      338      699
      339      700        /* Declare CONSTANT and STATIC data. */
      340      701
      341      702        %KH$IO (FPTN = KH_IO_OTPLCTBYT, STCLASS = CONSTANT,
      342      703         FNC = %GH#IO_OTPLCTBYT);
      343      817        %KH$IO (FPTN = KH_IO_OTPINTCTR, STCLASS = CONSTANT, OTPCHN = YES,
      344      818         FNC = %GH#IO_OTPINTCTR);
      345      932        %KH$IO (FPTN = KH_IO_OTPCHNCTR_CCBLSTRST, STCLASS = CONSTANT,
      346      933         FNC = %GH#IO_OTPCHNCTR, CCBLSTRST = YES);
      347     1047        %KH$IO (FPTN = KH_IO_OTPCHNCTR_STPIO, STCLASS = CONSTANT,
      348     1048         FNC = %GH#IO_OTPCHNCTR, STPIO = YES);
      349     1162        %KH$IO (FPTN=KH_IO_OTPRAMCTR, STCLASS=CONSTANT, RAMADR=168,
      350     1163         FNC=%GH#IO_OTPRAMCTR, OTPCHN=YES);
      351     1277        %KH$IO (FPTN=KH_IO_INPSLCSTT, STCLASS=CONSTANT,
      352     1278         FNC=%GH#IO_INPSTT, OTPCHN=YES);
      353     1392        %KH$IO (FPTN=KH_IO_OTPCTR_STPIO, STCLASS=CONSTANT,
      354     1393         FNC=%GH#IO_OTPCTR, STPIO=YES, OTPCHN=YES);
      355     1507        %KH$RLCCCPLCT (NAME = KH_RLCCCPLCT, STCLASS = SYMREF READONLY);
      356     1529
PL6.E3A0      #002=KHI$DWNLODLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:55   
      357     1530        /* Declare based structures */
      358     1531
      359     1532        %KH$CCPLCT (NAME = KH$CCPLCT, STCLASS = "BASED(KH$DWNLODLCT.CCPLCT$)");
      360     1558        %KH$CHN (NAME = KH$CHN, STCLASS = "BASED(KH$DWNLODLCT.CHN$)");
      361     1682
      362     1683        /* Declare AUTO data */
      363     1684
      364     1685        %KH$IO (FPTN = KH@IO_OTPLCTBYT, STCLASS = AUTO,
      365     1686         FNC = %GH#IO_OTPLCTBYT);
      366     1800        %KH$IO (FPTN = KH@IO_OTPINTCTR, STCLASS = AUTO,
      367     1801         FNC = %GH#IO_OTPINTCTR);
      368     1915        %KH$IO (FPTN = KH@IO_OTPCHNCTR_CCBLSTRST, STCLASS = AUTO,
      369     1916         FNC = %GH#IO_OTPCHNCTR, CCBLSTRST = YES);
      370     2030        %KH$IO (FPTN = KH@IO_OTPCHNCTR_STPIO, STCLASS = AUTO,
      371     2031         FNC = %GH#IO_OTPCHNCTR, STPIO = YES);
      372     2145        %KH$IOLD (FPTN=KH@IOLD, STCLASS=AUTO);
      373     2196        %KH$IO (FPTN=KH@IO_INPINTB_STT, STCLASS=AUTO,
      374     2197         FNC=%GH#IO_INPINTB_STT, OTPCHN=YES);
      375     2311        %KH$RLCCCPLCT (NAME = KH@RLCCCPLCT, STCLASS = AUTO);
      376     2333    1   DCL Y@LOPCNT UBIN WORD AUTO;
      377     2334    1   DCL Y@LCTADRHI UBIN WORD AUTO;
      378     2335
      379     2336        /* Initialize AUTO copies of structures. */
      380     2337
      381     2338    1      KH@IO_OTPINTCTR = KH_IO_OTPINTCTR;

   2338   1 000005  8C80 0000 0002  00                   LDI      KH_IO_OTPINTCTR
          1 000008  8D47 0008                            SDI      KH@IO_OTPINTCTR,AUTO

      382     2339    1      KH@IO_OTPCHNCTR_STPIO = KH_IO_OTPCHNCTR_STPIO;

   2339   1 00000A  8C80 0000 0006  00                   LDI      KH_IO_OTPCHNCTR_STPIO
          1 00000D  8D47 000C                            SDI      KH@IO_OTPCHNCTR_STPIO,AUTO

      383     2340    1      KH@IO_OTPCHNCTR_CCBLSTRST = KH_IO_OTPCHNCTR_CCBLSTRST;

   2340   1 00000F  8C80 0000 0004  00                   LDI      KH_IO_OTPCHNCTR_CCBLSTRST
PL6.E3A0      #002=KHI$DWNLODLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:56   
          1 000012  8D47 000A                            SDI      KH@IO_OTPCHNCTR_CCBLSTRST,AUTO

      384     2341    1      KH@IO_OTPLCTBYT = KH_IO_OTPLCTBYT;

   2341   1 000014  8C80 0000 0000  00                   LDI      KH_IO_OTPLCTBYT
          1 000017  8D47 0006                            SDI      KH@IO_OTPLCTBYT,AUTO

      385     2342
      386     2343    1      IF KH$CHN.EXTDVCID = '2978'X THEN

   2343   1 000019  ECC7 0004                            LDB,B6   @KH$DWNLODLCT,AUTO
          1 00001B  DC86                                 LDB,B5   ,B6
          1 00001C  D845 0003                            LDR,R5   3,B5
          1 00001E  D970 2978                            CMR,R5   10616,IMO
          1 000020  0981 0007                            BNE      s:2346,PREL

      387     2344    1      Y@LCTADRHI = 255;                    /* MLC-16                             */

   2344   1 000022  C870 00FF                            LDR,R4   255,IMO
          1 000024  CF47 0019                            STR,R4   Y@LCTADRHI,AUTO
          1 000026  0F81 0004                            B        s:2350,PREL

      388     2345    1      ELSE
      389     2346    1      Y@LCTADRHI = 63;                     /* MCLP (MLC-8)                       */

   2346   1 000028  4C3F                                 LDV,R4   63
          1 000029  CF47 0019                            STR,R4   Y@LCTADRHI,AUTO

      390     2347
      391     2348        /* CCBLSTRST makes CCBSTTPTR no longer valid. */
      392     2349
      393     2350    1      KH$CHN.INPCCBSTTPTRVLD = '0'B;

   2350   1 00002B  8845 0008                            LBF,'0080'X       8,B5
   2350   1 00002D       0080

      394     2351    1      KH$CHN.OTPCCBSTTPTRVLD = '0'B;
PL6.E3A0      #002=KHI$DWNLODLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:57   

   2351   1 00002E  DC86                                 LDB,B5   ,B6
          1 00002F  8845 0008                            LBF,'0040'X       8,B5
          1 000031       0040

      395     2352
      396     2353    2      IF KH$CHN.ATTR&%G_ATTR_CL_SLCC THEN DO;

   2353   1 000032  DC86                                 LDB,B5   ,B6
          1 000033  D845 0005                            LDR,R5   5,B5
          1 000035  D570 0200                            AND,R5   512,IMO
          1 000037  5901 0083                            BEZ,R5   s:2384,PREL

      397     2354        /*
      398     2355           For the SLCC, use RAMDATTRN to load up the scratchpad memory.
      399     2356        */
      400     2357    2         CALL KHI$IO_OTP(KH$CHN, KH_IO_OTPCTR_STPIO);

   2357   1 000039  CB80 0000 000C  00                   LAB,B4   KH_IO_OTPCTR_STPIO
          1 00003C  CFC7 001E                            STB,B4   Y@LCTADRHI+5,AUTO
          1 00003E  DFC7 001C                            STB,B5   Y@LCTADRHI+3,AUTO
          1 000040  BBC7 001C                            LAB,B3   Y@LCTADRHI+3,AUTO
          1 000042  CBF0 0200                            LAB,B4   512,IMO
          1 000044  E380 0000 0000  xent                 LNJ,B6   KHI$IO_OTP
          1 000047       0001                            DC       s:2358,PREL

      401     2358    2         Y@LOPCNT = 10000;

   2358   1 000048  E870 2710                            LDR,R6   10000,IMO
          1 00004A  EF47 0018                            STR,R6   Y@LOPCNT,AUTO

      402     2359    2         KH@IOLD.OTPCHN = '1'B;

   2359   1 00004C  8947 000E                            LBT,'0040'X       KH@IOLD,AUTO
   2359   1 00004E       0040

      403     2360    2         KH@IOLD.FNC = %GH#IO_IOLD_SLCRAMTRN;
PL6.E3A0      #002=KHI$DWNLODLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:58   

   2360   1 00004F  5C19                                 LDV,R5   25
          1 000050  DAC7 000E                            SRM,R5,'003F'X    KH@IOLD,AUTO
          1 000052       003F

      404     2361    2         KH@IOLD.BFR_.ADR$ = ADDR(KH$CCPLCT.SLCSPM);

   2361   1 000053  ECC7 0004                            LDB,B6   @KH$DWNLODLCT,AUTO
          1 000055  DCC6 0002                            LDB,B5   2,B6
          1 000057  CBC5 0003                            LAB,B4   3,B5
          1 000059  CFC7 000F                            STB,B4   KH@IOLD+1,AUTO

      405     2362    2         KH@IOLD.BFR_.BYTSIZ = KH$CCPLCT.SLCSPMWRDSIZ*2;

   2362   1 00005B  DCC6 0002                            LDB,B5   2,B6
          1 00005D  C845 0002                            LDR,R4   2,B5
          1 00005F  4001                                 SOL,R4   1
          1 000060  CF47 0012                            STR,R4   KH@IOLD+4,AUTO

      406     2363    2         KH@IOLD.BFR_.BYTX = 0;

   2363   1 000062  8747 0011                            CL       KH@IOLD+3,AUTO

      407     2364    2         CALL KHI$IO_OTP(KH$CHN, KH_IO_OTPRAMCTR) ALTRET(Y$IO_ERR);

   2364   1 000064  DC86                                 LDB,B5   ,B6
          1 000065  BB80 0000 0008  00                   LAB,B3   KH_IO_OTPRAMCTR
          1 000068  BFC7 001E                            STB,B3   Y@LCTADRHI+5,AUTO
          1 00006A  DFC7 001C                            STB,B5   Y@LCTADRHI+3,AUTO
          1 00006C  BBC7 001C                            LAB,B3   Y@LCTADRHI+3,AUTO
          1 00006E  CBF0 0200                            LAB,B4   512,IMO
          1 000070  E380 0000 0000  xent                 LNJ,B6   KHI$IO_OTP
          1 000073       011E                            DC       s:2452,PREL

      408     2365
      409     2366    2         CALL KHI$IOLD_FNC(KH$CHN, KH@IOLD) ALTRET(Y$IO_ERR);

PL6.E3A0      #002=KHI$DWNLODLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:59   
   2366   1 000074  ECC7 0004                            LDB,B6   @KH$DWNLODLCT,AUTO
          1 000076  DC86                                 LDB,B5   ,B6
          1 000077  CBC7 000E                            LAB,B4   KH@IOLD,AUTO
          1 000079  CFC7 001E                            STB,B4   Y@LCTADRHI+5,AUTO
          1 00007B  DFC7 001C                            STB,B5   Y@LCTADRHI+3,AUTO
          1 00007D  BBC7 001C                            LAB,B3   Y@LCTADRHI+3,AUTO
          1 00007F  CBF0 0200                            LAB,B4   512,IMO
          1 000081  E380 0000 0000  xent                 LNJ,B6   KHI$IOLD_FNC
          1 000084       010D                            DC       s:2452,PREL

      410     2367
      411     2368        /* Wait for the RAM data transfer to complete.  When complete,
      412     2369           check for IO errors. */
      413     2370
      414     2371    2         KH@IO_INPINTB_STT = KH_IO_INPSLCSTT;

   2371   1 000085  8C80 0000 000A  00                   LDI      KH_IO_INPSLCSTT
          1 000088  8D47 0013                            SDI      KH@IO_INPINTB_STT,AUTO

      415     2372    3         DO UNTIL KH@IO_INPINTB_STT.INTB_STT.RAMDATTRNCMP;

      416     2373    3            Y@LOPCNT = Y@LOPCNT-1;

   2373   1 00008A  88C7 0018                            DEC      Y@LOPCNT,AUTO

      417     2374    3            IF Y@LOPCNT=0 THEN GOTO Y$IO_ERR;

   2374   1 00008C  E847 0018                            LDR,R6   Y@LOPCNT,AUTO
          1 00008E  6901 0102                            BEZ,R6   s:2452,PREL

      418     2375    3            CALL KHI$IO_INP(KH$CHN, KH@IO_INPINTB_STT) ALTRET(Y$IO_ERR);

   2375   1 000090  ECC7 0004                            LDB,B6   @KH$DWNLODLCT,AUTO
          1 000092  DC86                                 LDB,B5   ,B6
          1 000093  CBC7 0013                            LAB,B4   KH@IO_INPINTB_STT,AUTO
          1 000095  CFC7 001E                            STB,B4   Y@LCTADRHI+5,AUTO
          1 000097  DFC7 001C                            STB,B5   Y@LCTADRHI+3,AUTO
PL6.E3A0      #002=KHI$DWNLODLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:60   
          1 000099  BBC7 001C                            LAB,B3   Y@LCTADRHI+3,AUTO
          1 00009B  CBF0 0200                            LAB,B4   512,IMO
          1 00009D  E380 0000 0000  xent                 LNJ,B6   KHI$IO_INP
          1 0000A0       00F1                            DC       s:2452,PREL

      419     2376    3         END;                              /* END DO UNTIL FNCCMP                */

   2376   1 0000A1  82C7 0014                            LB,'0020'X        KH@IO_INPINTB_STT+1,AUTO
   2376   1 0000A3       0020
          1 0000A4  05E6                                 BBF      s:2373,SPREL

      420     2377    2         IF KH@IO_INPINTB_STT.INTB_STT.RAMPRTERR OR

   2377   1 0000A5  82C7 0014                            LB,'0040'X        KH@IO_INPINTB_STT+1,AUTO
   2377   1 0000A7       0040
          1 0000A8  0501 00E8                            BBT      s:2452,PREL
          1 0000AA  82C7 0014                            LB,'0004'X        KH@IO_INPINTB_STT+1,AUTO
          1 0000AC       0004
          1 0000AD  0501 00E3                            BBT      s:2452,PREL
          1 0000AF  82C7 0014                            LB,'0002'X        KH@IO_INPINTB_STT+1,AUTO
          1 0000B1       0002
          1 0000B2  0501 00DE                            BBT      s:2452,PREL
          1 0000B4  82C7 0014                            LB,'0001'X        KH@IO_INPINTB_STT+1,AUTO
          1 0000B6       0001
          1 0000B7  0501 00D9                            BBT      s:2452,PREL

      421     2378    2           KH@IO_INPINTB_STT.INTB_STT.INVMMRADR OR
      422     2379    2           KH@IO_INPINTB_STT.INTB_STT.BUSPRTERR OR
      423     2380    2           KH@IO_INPINTB_STT.INTB_STT.UN_CRCMMRERR
      424     2381    2         THEN GOTO Y$IO_ERR;
      425     2382    2         GOTO Y$SET_INTLVL;

   2382   1 0000B9  0F81 0097                            B        s:2426,PREL

      426     2383    2      END;
      427     2384    2      DO Y@LOPCNT = 0 TO 32 BY 32;

PL6.E3A0      #002=KHI$DWNLODLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:61   
   2384   1 0000BB  8747 0018                            CL       Y@LOPCNT,AUTO

      428     2385
      429     2386        /* This loop is traversed once for the input channel and once for
      430     2387        the output channel. */
      431     2388
      432     2389        /* Stop IO on the channel. */
      433     2390
      434     2391    2         CALL KHI$IO_OTP(KH$CHN, KH@IO_OTPCHNCTR_STPIO) ALTRET(Y$IO_ERR);

   2391   1 0000BD  ECC7 0004                            LDB,B6   @KH$DWNLODLCT,AUTO
          1 0000BF  DC86                                 LDB,B5   ,B6
          1 0000C0  CBC7 000C                            LAB,B4   KH@IO_OTPCHNCTR_STPIO,AUTO
          1 0000C2  CFC7 001E                            STB,B4   Y@LCTADRHI+5,AUTO
          1 0000C4  DFC7 001C                            STB,B5   Y@LCTADRHI+3,AUTO
          1 0000C6  BBC7 001C                            LAB,B3   Y@LCTADRHI+3,AUTO
          1 0000C8  CBF0 0200                            LAB,B4   512,IMO
          1 0000CA  E380 0000 0000  xent                 LNJ,B6   KHI$IO_OTP
          1 0000CD       00C4                            DC       s:2452,PREL

      435     2392
      436     2393        /* Clear LCTs 5, 9, 22, 37, 41, and 56. */
      437     2394
      438     2395    2         KH@IO_OTPLCTBYT.LCTBYT.ADR = Y@LOPCNT + 5;

   2395   1 0000CE  E847 0018                            LDR,R6   Y@LOPCNT,AUTO
          1 0000D0  6E05                                 ADV,R6   5
          1 0000D1  EAC7 0007                            SRM,R6,'00FF'X    KH@IO_OTPLCTBYT+1,AUTO
          1 0000D3       00FF

      439     2396    2         CALL Y$OTPLCTBYT ALTRET(Y$IO_ERR);

   2396   1 0000D4  E3C0 00C5                            LNJ,B6   s:0,PREL
          1 0000D6       00BB                            DC       s:2452,PREL

      440     2397    2         KH@IO_OTPLCTBYT.LCTBYT.ADR = Y@LOPCNT + 9;

PL6.E3A0      #002=KHI$DWNLODLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:62   
   2397   1 0000D7  E847 0018                            LDR,R6   Y@LOPCNT,AUTO
          1 0000D9  6E09                                 ADV,R6   9
          1 0000DA  EAC7 0007                            SRM,R6,'00FF'X    KH@IO_OTPLCTBYT+1,AUTO
          1 0000DC       00FF

      441     2398    2         CALL Y$OTPLCTBYT ALTRET(Y$IO_ERR);

   2398   1 0000DD  E3C0 00BC                            LNJ,B6   s:0,PREL
          1 0000DF       00B2                            DC       s:2452,PREL

      442     2399    2         KH@IO_OTPLCTBYT.LCTBYT.ADR = Y@LOPCNT + 22;

   2399   1 0000E0  E847 0018                            LDR,R6   Y@LOPCNT,AUTO
          1 0000E2  6E16                                 ADV,R6   22
          1 0000E3  EAC7 0007                            SRM,R6,'00FF'X    KH@IO_OTPLCTBYT+1,AUTO
          1 0000E5       00FF

      443     2400    2         CALL Y$OTPLCTBYT ALTRET(Y$IO_ERR);

   2400   1 0000E6  E3C0 00B3                            LNJ,B6   s:0,PREL
          1 0000E8       00A9                            DC       s:2452,PREL

      444     2401
      445     2402        /* Do a CCB list reset */
      446     2403
      447     2404    2         CALL KHI$IO_OTP(KH$CHN, KH@IO_OTPCHNCTR_CCBLSTRST) ALTRET(Y$IO_ERR);

   2404   1 0000E9  ECC7 0004                            LDB,B6   @KH$DWNLODLCT,AUTO
          1 0000EB  DC86                                 LDB,B5   ,B6
          1 0000EC  CBC7 000A                            LAB,B4   KH@IO_OTPCHNCTR_CCBLSTRST,AUTO
          1 0000EE  CFC7 001E                            STB,B4   Y@LCTADRHI+5,AUTO
          1 0000F0  DFC7 001C                            STB,B5   Y@LCTADRHI+3,AUTO
          1 0000F2  BBC7 001C                            LAB,B3   Y@LCTADRHI+3,AUTO
          1 0000F4  CBF0 0200                            LAB,B4   512,IMO
          1 0000F6  E380 0000 0000  xent                 LNJ,B6   KHI$IO_OTP
          1 0000F9       0098                            DC       s:2452,PREL

PL6.E3A0      #002=KHI$DWNLODLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:63   
      448     2405
      449     2406        /* Set up so that if this is the input channel pass, we'll be
      450     2407        addressing the output channel on the next pass. */
      451     2408
      452     2409    2         KH@IO_OTPCHNCTR_STPIO.OTPCHN = '1'B;

   2409   1 0000FA  8947 000C                            LBT,'0040'X       KH@IO_OTPCHNCTR_STPIO,AUTO
   2409   1 0000FC       0040

      453     2410    2         KH@IO_OTPCHNCTR_CCBLSTRST.OTPCHN = '1'B;

   2410   1 0000FD  8947 000A                            LBT,'0040'X       KH@IO_OTPCHNCTR_CCBLSTRST,AUTO
   2410   1 0000FF       0040

      454     2411    2      END;                                 /* END DO Y@LOPCNT = 0 TO 32 BY 32    */

   2411   1 000100  E847 0018                            LDR,R6   Y@LOPCNT,AUTO
          1 000102  6E20                                 ADV,R6   32
          1 000103  EF47 0018                            STR,R6   Y@LOPCNT,AUTO
          1 000105  6D20                                 CMV,R6   32
          1 000106  0381 FFB6                            BLE      s:2391,PREL

      455     2412
      456     2413        /* Down-load the LCTs passed by the caller. */
      457     2414
      458     2415    1      IF (KH$DWNLODLCT.CCPLODBIS ~= 0)

   2415   1 000108  ECC7 0004                            LDB,B6   @KH$DWNLODLCT,AUTO
          1 00010A  D846 0004                            LDR,R5   4,B6
          1 00010C  5901 0022                            BEZ,R5   s:2425,PREL
          1 00010E  DCC6 0002                            LDB,B5   2,B6
          1 000110  D905                                 CMR,R5   ,B5
          1 000111  0901 001D                            BE       s:2425,PREL

      459     2416    2        AND (KH$DWNLODLCT.CCPLODBIS ~= KH$CCPLCT.CCPLODBIS) THEN DO;

      460     2417        /*
PL6.E3A0      #002=KHI$DWNLODLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:64   
      461     2418        The load bias (RAM address) indicates we need to relocate the CCP and LCTs.
      462     2419        */
      463     2420    2         KH@RLCCCPLCT = KH_RLCCCPLCT;

   2420   1 000113  AB80 0000 0000  xsym                 LAB,B2   KH_RLCCCPLCT
          1 000116  2C00                                 LDV,R2   0
          1 000117  6C06                                 LDV,R6   6
          1 000118  BB87                                 LAB,B3   ,AUTO
          1 000119  3C2A                                 LDV,R3   42
          1 00011A  0008                                 MMM

      464     2421    2         KH@RLCCCPLCT.CCPLODBIS = KH$DWNLODLCT.CCPLODBIS;

   2421   1 00011B  E846 0004                            LDR,R6   4,B6
          1 00011D  EF47 0017                            STR,R6   KH@RLCCCPLCT+2,AUTO

      465     2422    2         KH@RLCCCPLCT.CCPLCT$ = ADDR(KH$CCPLCT);

   2422   1 00011F  DCC6 0002                            LDB,B5   2,B6
          1 000121  DFC7 0015                            STB,B5   KH@RLCCCPLCT,AUTO

      466     2423    2         CALL KHI$RLCCCPLCT(KH@RLCCCPLCT);

   2423   1 000123  CBC7 0015                            LAB,B4   KH@RLCCCPLCT,AUTO
          1 000125  CFC7 001C                            STB,B4   Y@LCTADRHI+3,AUTO
          1 000127  BBC7 001C                            LAB,B3   Y@LCTADRHI+3,AUTO
          1 000129  CBF0 0100                            LAB,B4   256,IMO
          1 00012B  E380 0000 0000  xent                 LNJ,B6   KHI$RLCCCPLCT
          1 00012E       0001                            DC       s:2425,PREL

      467     2424    2      END;                  /* END IF CCPLODBIS ~= 0 & CCPLODBIS ~= CCPLODBIS    */

      468     2425    2      DO KH@IO_OTPLCTBYT.LCTBYT.ADR = 0 TO Y@LCTADRHI;

   2425   1 00012F  8847 0007                            LBF,'00FF'X       KH@IO_OTPLCTBYT+1,AUTO
   2425   1 000131       00FF
          1 000132  0F81 0017                            B        s:2428+7,PREL
PL6.E3A0      #002=KHI$DWNLODLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:65   

      469     2426    2         KH@IO_OTPLCTBYT.LCTBYT.DAT = KH$CCPLCT.LCTBYT(KH@IO_OTPLCTBYT.LCTBYT.ADR);

   2426   1 000134  ECC7 0004                            LDB,B6   @KH$DWNLODLCT,AUTO
          1 000136  DCC6 0002                            LDB,B5   2,B6
          1 000138  B847 0007                            LDR,R3   KH@IO_OTPLCTBYT+1,AUTO
          1 00013A  B570 00FF                            AND,R3   255,IMO
          1 00013C  3E06                                 ADV,R3   6
          1 00013D  E2B5                                 LLH,R6   ,B5,R3
          1 00013E  E7C7 0007                            STH,R6   KH@IO_OTPLCTBYT+1,AUTO

      470     2427    2         CALL Y$OTPLCTBYT ALTRET(Y$IO_ERR);

   2427   1 000140  E3C0 0059                            LNJ,B6   s:0,PREL
          1 000142       004F                            DC       s:2452,PREL

      471     2428    2      END;                            /* END DO LCTBYT.ADR = 0 TO Y@LCTADRHI     */

   2428   1 000143  E847 0007                            LDR,R6   KH@IO_OTPLCTBYT+1,AUTO
          1 000145  EA70 0001                            ADD,R6   1,IMO
          1 000147  EAC7 0007                            SRM,R6,'00FF'X    KH@IO_OTPLCTBYT+1,AUTO
          1 000149       00FF
          1 00014A  E847 0007                            LDR,R6   KH@IO_OTPLCTBYT+1,AUTO
          1 00014C  E570 00FF                            AND,R6   255,IMO
          1 00014E  E947 0019                            CMR,R6   Y@LCTADRHI,AUTO
          1 000150  03E4                                 BLE      s:2426,SPREL

   2426   1                              Y$SET_INTLVL    null
      472     2429
      473     2430    1   Y$SET_INTLVL:;
      474     2431        /* Set the return interrupt level for the transmit channel */
      475     2432
      476     2433    1      KH@IO_OTPINTCTR.INTCTR.INTLVL = KH$DWNLODLCT.TRNINTLVL;

   2433   1 000151  ECC7 0004            Y$SET_INTLVL    LDB,B6   @KH$DWNLODLCT,AUTO
          1 000153  E846 0006                            LDR,R6   6,B6
          1 000155  EAC7 0009                            SRM,R6,'003F'X    KH@IO_OTPINTCTR+1,AUTO
PL6.E3A0      #002=KHI$DWNLODLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:66   
          1 000157       003F

      477     2434    1      CALL KHI$IO_OTP(KH$CHN, KH@IO_OTPINTCTR) ALTRET(Y$IO_ERR);

   2434   1 000158  DC86                                 LDB,B5   ,B6
          1 000159  CBC7 0008                            LAB,B4   KH@IO_OTPINTCTR,AUTO
          1 00015B  CFC7 001E                            STB,B4   Y@LCTADRHI+5,AUTO
          1 00015D  DFC7 001C                            STB,B5   Y@LCTADRHI+3,AUTO
          1 00015F  BBC7 001C                            LAB,B3   Y@LCTADRHI+3,AUTO
          1 000161  CBF0 0200                            LAB,B4   512,IMO
          1 000163  E380 0000 0000  xent                 LNJ,B6   KHI$IO_OTP
          1 000166       002B                            DC       s:2452,PREL

      478     2435
      479     2436        /* Set the return interrupt level for the receive channel */
      480     2437
      481     2438    1      KH@IO_OTPINTCTR.OTPCHN = '0'B;

   2438   1 000167  8847 0008                            LBF,'0040'X       KH@IO_OTPINTCTR,AUTO
   2438   1 000169       0040

      482     2439    1      KH@IO_OTPINTCTR.INTCTR.INTLVL = KH$DWNLODLCT.RCVINTLVL;

   2439   1 00016A  ECC7 0004                            LDB,B6   @KH$DWNLODLCT,AUTO
          1 00016C  E846 0005                            LDR,R6   5,B6
          1 00016E  EAC7 0009                            SRM,R6,'003F'X    KH@IO_OTPINTCTR+1,AUTO
          1 000170       003F

      483     2440    1      CALL KHI$IO_OTP(KH$CHN, KH@IO_OTPINTCTR) ALTRET(Y$IO_ERR);

   2440   1 000171  DC86                                 LDB,B5   ,B6
          1 000172  CBC7 0008                            LAB,B4   KH@IO_OTPINTCTR,AUTO
          1 000174  CFC7 001E                            STB,B4   Y@LCTADRHI+5,AUTO
          1 000176  DFC7 001C                            STB,B5   Y@LCTADRHI+3,AUTO
          1 000178  BBC7 001C                            LAB,B3   Y@LCTADRHI+3,AUTO
          1 00017A  CBF0 0200                            LAB,B4   512,IMO
          1 00017C  E380 0000 0000  xent                 LNJ,B6   KHI$IO_OTP
PL6.E3A0      #002=KHI$DWNLODLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:67   
          1 00017F       0012                            DC       s:2452,PREL

      484     2441    1      KH$CHN.DWNLOD = '1'B;

   2441   1 000180  ECC7 0004                            LDB,B6   @KH$DWNLODLCT,AUTO
          1 000182  DC86                                 LDB,B5   ,B6
          1 000183  8945 0007                            LBT,'1000'X       7,B5
          1 000185       1000

      485     2442    1      KH$CHN.OTPCCBCNT = 0;

   2442   1 000186  DC86                                 LDB,B5   ,B6
          1 000187  8845 0007                            LBF,'000F'X       7,B5
          1 000189       000F

      486     2443    1      KH$CHN.INPCCBCNT = 0;

   2443   1 00018A  DC86                                 LDB,B5   ,B6
          1 00018B  8845 0007                            LBF,'0F00'X       7,B5
          1 00018D       0F00

      487     2444    1      RETURN;

   2444   1 00018E  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      488     2445
      489     2446    1   Y$IO_ERR:
      490     2447
      491     2448        /* We had a fatal IO error (irrecoverable IO NAK or trap 15).
      492     2449        Say the channel is dead, error log, and ALTRET. */
      493     2450
      494     2451        /*N* ERRLOG IO ERROR */
      495     2452    1      KH$CHN.DED = '1'B;

   2452   1 000191  ECC7 0004            Y$IO_ERR        LDB,B6   @KH$DWNLODLCT,AUTO
          1 000193  DC86                                 LDB,B5   ,B6
          1 000194  8945 0009                            LBT,'0100'X       9,B5
PL6.E3A0      #002=KHI$DWNLODLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:68   
          1 000196       0100

      496     2453    1      ALTRETURN;

   2453   1 000197  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      497     2454
      498     2455        /* Output an LCT byte to the MLCP. */
      499     2456
      500     2457    1   Y$OTPLCTBYT: PROC ALTRET;

   2457   1 00019A  EFC7 001A            Y$OTPLCTBYT     STB,B6   Y@LCTADRHI+1,AUTO

      501     2458    2      CALL KHI$IO_OTPLCTBYT(KH$CHN, KH@IO_OTPLCTBYT)

   2458   1 00019C  DCC7 0004                            LDB,B5   @KH$DWNLODLCT,AUTO
          1 00019E  CC85                                 LDB,B4   ,B5
          1 00019F  BBC7 0006                            LAB,B3   KH@IO_OTPLCTBYT,AUTO
          1 0001A1  BFC7 001E                            STB,B3   Y@LCTADRHI+5,AUTO
          1 0001A3  CFC7 001C                            STB,B4   Y@LCTADRHI+3,AUTO
          1 0001A5  BBC7 001C                            LAB,B3   Y@LCTADRHI+3,AUTO
          1 0001A7  CBF0 0200                            LAB,B4   512,IMO
          1 0001A9  E380 0000 0000  xent                 LNJ,B6   KHI$IO_OTPLCTBYT
          1 0001AC       0003                            DC       s:2459,PREL
          1 0001AD  0F81 0005                            B        s:2460,PREL

      502     2459    3      WHENALTRETURN DO; ALTRETURN; END;

   2459   1 0001AF  ECC7 001A                            LDB,B6   Y@LCTADRHI+1,AUTO
          1 0001B1  B806                                 LDR,R3   ,B6
          1 0001B2  C3B6                                 LNJ,B4   ,B6,R3

      503     2460    2   END Y$OTPLCTBYT;                        /* END PROC                           */

   2460   1 0001B3  ECC7 001A                            LDB,B6   Y@LCTADRHI+1,AUTO
          1 0001B5  C3C6 0001                            LNJ,B4   1,B6
      504     2461    1   END KHI$DWNLODLCT;                      /* END PROC                           */
PL6.E3A0      #002=KHI$DWNLODLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:69   
      505     2462        %EOD;

PL6.E3A0      #002=KHI$DWNLODLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:70   
--  Include file information  --

   KH$IO.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   GH_IOFNC_E.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is never referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is never referenced.
   KV$USR.:E05TOU  was found in the system file and is never referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is never referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is never referenced.
   KV$GLB.:E05TOU  was found in the system file and is referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is referenced.
   KI_CP6.:E05TOU  was found in the system file and is referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure KHI$DWNLODLCT.
PL6.E3A0      #002=KHI$DWNLODLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:71   

 **** Variables and constants ****

  ****  Section 000 RoData KHI$DWNLODLCT

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     A-0-0/w STRC(32)    r     1 KH_IO_INPSLCSTT
     4-0-0/w STRC(32)    r     1 KH_IO_OTPCHNCTR_CCBLSTRST
     6-0-0/w STRC(32)    r     1 KH_IO_OTPCHNCTR_STPIO
     C-0-0/w STRC(32)    r     1 KH_IO_OTPCTR_STPIO         2-0-0/w STRC(32)    r     1 KH_IO_OTPINTCTR
     0-0-0/w STRC(32)    r     1 KH_IO_OTPLCTBYT            8-0-0/w STRC(32)    r     1 KH_IO_OTPRAMCTR

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @KH$DWNLODLCT             *0-0-0/w STRC(112)   r     1 KH$DWNLODLCT
     E-0-0/w STRC(80)    r     1 KH@IOLD                   13-0-0/w STRC(32)    r     1 KH@IO_INPINTB_STT
     A-0-0/w STRC(32)    r     1 KH@IO_OTPCHNCTR_CCBLSTRST
     C-0-0/w STRC(32)    r     1 KH@IO_OTPCHNCTR_STPIO
     8-0-0/w STRC(32)    r     1 KH@IO_OTPINTCTR            6-0-0/w STRC(32)    r     1 KH@IO_OTPLCTBYT
    15-0-0/w STRC(48)    r     1 KH@RLCCCPLCT              19-0-0/w UBIN(16)    r     1 Y@LCTADRHI
    18-0-0/w UBIN(16)    r     1 Y@LOPCNT

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(48)    r     1 KH_RLCCCPLCT

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name
PL6.E3A0      #002=KHI$DWNLODLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:72   

     0-0-0/w STRC(2360)  r     1 KH$CCPLCT                  0-0-0/w STRC(512)   r     1 KH$CHN


   Procedure KHI$DWNLODLCT requires 439 words for executable code.
   Procedure KHI$DWNLODLCT requires 32 words of local(AUTO) storage.
PL6.E3A0      #002=KHI$DWNLODLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:73   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=KHI$DWNLODLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:74   
          MINI XREF LISTING

KH$CCPLCT
      1546**DCL      2422--ASSIGN
KH$CCPLCT.CCPLODBIS
      1552**DCL      2415>>IF
KH$CCPLCT.CCPRLCTBLWRDX
      1552**DCL      1552--REDEF
KH$CCPLCT.LCTBYT
      1553**DCL      1553--REDEF    1553--REDEF    2426>>ASSIGN
KH$CCPLCT.LCTRLCTBL_BYT
      1555**DCL      1556--REDEF
KH$CCPLCT.SLCSPM
      1553**DCL      2361--ASSIGN
KH$CCPLCT.SLCSPMWRDSIZ
      1552**DCL      2362>>ASSIGN
KH$CHN
      1573**DCL      2357<>CALL     2364<>CALL     2366<>CALL     2375<>CALL     2391<>CALL     2404<>CALL
      2434<>CALL     2440<>CALL     2458<>CALL
KH$CHN.ATTR
      1606**DCL      2353>>IF
KH$CHN.DED
      1633**DCL      2452<<ASSIGN
KH$CHN.DWNLOD
      1611**DCL      2441<<ASSIGN
KH$CHN.EXTDVCID
      1599**DCL      2343>>IF
KH$CHN.INPCCBCNT
      1612**DCL      2443<<ASSIGN
KH$CHN.INPCCBSTTPTRVLD
      1626**DCL      2350<<ASSIGN
KH$CHN.OTPCCBCNT
      1617**DCL      2442<<ASSIGN
KH$CHN.OTPCCBSTTPTRVLD
PL6.E3A0      #002=KHI$DWNLODLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:75   
      1626**DCL      2351<<ASSIGN
KH$CHN.TERMID.TERM
      1669**DCL      1678--REDEF
KH$DWNLODLCT
       689**DCL         6--PROC
KH$DWNLODLCT.CCPLCT$
       695**DCL      1546--IMP-PTR  2361>>ASSIGN   2362>>ASSIGN   2415>>IF       2422>>ASSIGN   2426>>ASSIGN
KH$DWNLODLCT.CCPLODBIS
       695**DCL      2415>>IF       2415>>IF       2421>>ASSIGN
KH$DWNLODLCT.CHN$
       695**DCL      1573--IMP-PTR  2343>>IF       2350>>ASSIGN   2351>>ASSIGN   2353>>IF       2357>>CALL
      2364>>CALL     2366>>CALL     2375>>CALL     2391>>CALL     2404>>CALL     2434>>CALL     2440>>CALL
      2441>>ASSIGN   2442>>ASSIGN   2443>>ASSIGN   2452>>ASSIGN   2458>>CALL
KH$DWNLODLCT.RCVINTLVL
       696**DCL      2439>>ASSIGN
KH$DWNLODLCT.TRNINTLVL
       696**DCL      2433>>ASSIGN
KH@IOLD
      2159**DCL      2366<>CALL
KH@IOLD.BFR_.ADR$
      2192**DCL      2361<<ASSIGN
KH@IOLD.BFR_.BYTSIZ
      2192**DCL      2362<<ASSIGN
KH@IOLD.BFR_.BYTX
      2192**DCL      2363<<ASSIGN
KH@IOLD.FNC
      2168**DCL      2360<<ASSIGN
KH@IOLD.OTPCHN
      2167**DCL      2359<<ASSIGN
KH@IO_INPINTB_STT
      2209**DCL      2371<<ASSIGN   2375<>CALL
KH@IO_INPINTB_STT.ASNSTT
      2218**DCL      2219--REDEF    2225--REDEF    2230--REDEF    2234--REDEF    2238--REDEF    2242--REDEF
      2249--REDEF    2255--REDEF    2261--REDEF    2266--REDEF    2273--REDEF    2276--REDEF    2280--REDEF
      2287--REDEF    2291--REDEF    2295--REDEF    2299--REDEF    2304--REDEF    2308--REDEF
KH@IO_INPINTB_STT.INTB_STT.BUSPRTERR
PL6.E3A0      #002=KHI$DWNLODLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:76   
      2256**DCL      2377>>IF
KH@IO_INPINTB_STT.INTB_STT.INVMMRADR
      2256**DCL      2377>>IF
KH@IO_INPINTB_STT.INTB_STT.RAMDATTRNCMP
      2256**DCL      2372>>DOUNTIL
KH@IO_INPINTB_STT.INTB_STT.RAMPRTERR
      2255**DCL      2377>>IF
KH@IO_INPINTB_STT.INTB_STT.UN_CRCMMRERR
      2257**DCL      2377>>IF
KH@IO_OTPCHNCTR_CCBLSTRST
      1928**DCL      2340<<ASSIGN   2404<>CALL
KH@IO_OTPCHNCTR_CCBLSTRST.ASNSTT
      1937**DCL      1938--REDEF    1944--REDEF    1949--REDEF    1953--REDEF    1957--REDEF    1961--REDEF
      1968--REDEF    1974--REDEF    1980--REDEF    1985--REDEF    1992--REDEF    1995--REDEF    1999--REDEF
      2006--REDEF    2010--REDEF    2014--REDEF    2018--REDEF    2023--REDEF    2027--REDEF
KH@IO_OTPCHNCTR_CCBLSTRST.OTPCHN
      1934**DCL      2410<<ASSIGN
KH@IO_OTPCHNCTR_STPIO
      2043**DCL      2339<<ASSIGN   2391<>CALL
KH@IO_OTPCHNCTR_STPIO.ASNSTT
      2052**DCL      2053--REDEF    2059--REDEF    2064--REDEF    2068--REDEF    2072--REDEF    2076--REDEF
      2083--REDEF    2089--REDEF    2095--REDEF    2100--REDEF    2107--REDEF    2110--REDEF    2114--REDEF
      2121--REDEF    2125--REDEF    2129--REDEF    2133--REDEF    2138--REDEF    2142--REDEF
KH@IO_OTPCHNCTR_STPIO.OTPCHN
      2049**DCL      2409<<ASSIGN
KH@IO_OTPINTCTR
      1813**DCL      2338<<ASSIGN   2434<>CALL     2440<>CALL
KH@IO_OTPINTCTR.ASNSTT
      1822**DCL      1823--REDEF    1829--REDEF    1834--REDEF    1838--REDEF    1842--REDEF    1846--REDEF
      1853--REDEF    1859--REDEF    1865--REDEF    1870--REDEF    1877--REDEF    1880--REDEF    1884--REDEF
      1891--REDEF    1895--REDEF    1899--REDEF    1903--REDEF    1908--REDEF    1912--REDEF
KH@IO_OTPINTCTR.INTCTR.INTLVL
      1865**DCL      2433<<ASSIGN   2439<<ASSIGN
KH@IO_OTPINTCTR.OTPCHN
      1819**DCL      2438<<ASSIGN
KH@IO_OTPLCTBYT
PL6.E3A0      #002=KHI$DWNLODLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:77   
      1698**DCL      2341<<ASSIGN   2458<>CALL
KH@IO_OTPLCTBYT.ASNSTT
      1707**DCL      1708--REDEF    1714--REDEF    1719--REDEF    1723--REDEF    1727--REDEF    1731--REDEF
      1738--REDEF    1744--REDEF    1750--REDEF    1755--REDEF    1762--REDEF    1765--REDEF    1769--REDEF
      1776--REDEF    1780--REDEF    1784--REDEF    1788--REDEF    1793--REDEF    1797--REDEF
KH@IO_OTPLCTBYT.LCTBYT.ADR
      1714**DCL      2395<<ASSIGN   2397<<ASSIGN   2399<<ASSIGN   2425<<DOINDEX  2426>>ASSIGN
KH@IO_OTPLCTBYT.LCTBYT.DAT
      1714**DCL      2426<<ASSIGN
KH@RLCCCPLCT
      2325**DCL      2420<<ASSIGN   2423<>CALL
KH@RLCCCPLCT.CCPLCT$
      2331**DCL      2422<<ASSIGN
KH@RLCCCPLCT.CCPLODBIS
      2331**DCL      2421<<ASSIGN
KHI$IOLD_FNC
       667**DCL-ENT  2366--CALL
KHI$IO_INP
       668**DCL-ENT  2375--CALL
KHI$IO_OTP
       669**DCL-ENT  2357--CALL     2364--CALL     2391--CALL     2404--CALL     2434--CALL     2440--CALL
KHI$IO_OTPLCTBYT
       670**DCL-ENT  2458--CALL
KHI$RLCCCPLCT
       671**DCL-ENT  2423--CALL
KH_IO_INPSLCSTT
      1290**DCL      2371>>ASSIGN
KH_IO_OTPCHNCTR_CCBLSTRST
       945**DCL      2340>>ASSIGN
KH_IO_OTPCHNCTR_STPIO
      1060**DCL      2339>>ASSIGN
KH_IO_OTPCTR_STPIO
      1405**DCL      2357<>CALL
KH_IO_OTPINTCTR
       830**DCL      2338>>ASSIGN
KH_IO_OTPLCTBYT
PL6.E3A0      #002=KHI$DWNLODLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:78   
       715**DCL      2341>>ASSIGN
KH_IO_OTPRAMCTR
      1175**DCL      2364<>CALL
KH_RLCCCPLCT
      1521**DCL      2420>>ASSIGN
Y$IO_ERR
      2452**LABEL    2364--CALLALT  2366--CALLALT  2374--GOTO     2375--CALLALT  2381--GOTO     2391--CALLALT
      2396--CALLALT  2398--CALLALT  2400--CALLALT  2404--CALLALT  2427--CALLALT  2434--CALLALT  2440--CALLALT
Y$OTPLCTBYT
      2457**PROC     2396--CALL     2398--CALL     2400--CALL     2427--CALL
Y$SET_INTLVL
      2426**LABEL    2382--GOTO
Y@LCTADRHI
      2334**DCL      2344<<ASSIGN   2346<<ASSIGN   2425>>DOINDEX
Y@LOPCNT
      2333**DCL      2358<<ASSIGN   2373<<ASSIGN   2373>>ASSIGN   2374>>IF       2384<<DOINDEX  2395>>ASSIGN
      2397>>ASSIGN   2399>>ASSIGN

PL6.E3A0      #003=KHI$RLCCCPLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:79   
      506        1        /*T***********************************************************/
      507        2        /*T*                                                         */
      508        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      509        4        /*T*                                                         */
      510        5        /*T***********************************************************/
      511        6        KHI$RLCCCPLCT: PROC(PRM_RLCCCPLCT) ALTRET;
      512        7
      513        8        /*F* NAME: KHI$RLCCCPLCT - Relocate LCT and CCP
      514        9
      515       10        The KHI$RLCCCPLCT routine relocates the LCTs and CCP passed (modifying
      516       11        what was passed), and updates the CCP load bias in the ELSIE header
      517       12        (KH$CCPLCT.CCPLODBIS).
      518       13
      519       14        The form of the call for this service is:
      520       15
      521       16        .fif
      522       17           CALL KHI$RLCCCPLCT(kh$rlccplct);
      523       18        .fin
      524       19
      525       20        where:
      526       21        */
      527       22
      528       23        /*K* kh$rlcccplct -
      529       24        is the structure defined by the KH$RLCCCPLCT macro,
      530       25        which is in file KH$IO.
      531       26        */
      532       27
      533       28        /* INCLUDEs */
      534       29
      535       30        %INCLUDE KH$IO;
      536      277
      537      278        /* Based structures. */
      538      279        /*
      539      280        CCP relocation table.
      540      281        */
      541      282    1   DCL 1 Y$CCPRLCTBL BASED(Y@CCPRLCTBL$) ALIGNED,
      542      283    1          2 BT(0:7) BIT(1) UNAL,
PL6.E3A0      #003=KHI$RLCCCPLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:80   
      543      284    1          2 BYT(0:0) REDEF BT UBIN BYTE UNAL;
      544      285
      545      286        /* Declare parameters */
      546      287
      547      288        %KH$RLCCCPLCT (NAME = PRM_RLCCCPLCT, STCLASS = PARAM);
      548      310
      549      311        /* Declare based structures */
      550      312
      551      313        %KH$CCPLCT (NAME = KH$CCPLCT, STCLASS = "BASED(PRM_RLCCCPLCT.CCPLCT$)");
      552      339
      553      340        /* Declare AUTO data */
      554      341        /*
      555      342        CCP relocation table pointer.
      556      343        */
      557      344    1   DCL Y@CCPRLCTBL$ PTR AUTO;
      558      345        /*
      559      346        Flag indicating we're relocating the first byte of a pair of bytes.
      560      347        */
      561      348    1   DCL Y@FRSBYT BIT(1) AUTO;
      562      349        /*
      563      350        Relocation table bit index.  Also the byte index into the LCTs or CCP.
      564      351        */
      565      352    1   DCL Y@RLCTBLBITX UBIN WORD AUTO;
      566      353        /*
      567      354        Relocation table byte index.
      568      355        */
      569      356    1   DCL Y@RLCTBLBYTX UBIN WORD AUTO;
      570      357        /*
      571      358        First byte (of an LCT or CCP pair needing relocation) index.
      572      359        */
      573      360    1   DCL Y@FRSBYTX UBIN WORD AUTO;
      574      361        /*
      575      362        Relocation delta; the value to be added to each pair of CCP/LCT bytes.
      576      363        */
      577      364    1   DCL Y@RLCDLT SBIN ALIGNED AUTO;
      578      365        /*
      579      366        Both bytes of a pair of LCTs or CCP requiring relocation.
PL6.E3A0      #003=KHI$RLCCCPLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:81   
      580      367        */
      581      368    1   DCL 1 Y@DAT ALIGNED AUTO,
      582      369    1          2 HI_BYT UBIN BYTE UNAL,
      583      370    1          2 LOWBYT UBIN BYTE UNAL;
      584      371
      585      372    1   DCL Y@DAT_WRD REDEF Y@DAT SBIN;
      586      373
      587      374    2      IF PRM_RLCCCPLCT.CCPLODBIS ~= KH$CCPLCT.CCPLODBIS THEN DO;
      588      375        /*
      589      376        The load biases don't match, so we have some relocating to do.
      590      377        */
      591      378    2         Y@RLCDLT = PRM_RLCCCPLCT.CCPLODBIS - KH$CCPLCT.CCPLODBIS;
      592      379    2         Y@FRSBYT = '1'B;
      593      380    3         DO Y@RLCTBLBYTX = 0 TO (256/8)-1;
      594      381        /*
      595      382        This loop is iterated for each byte in the LCT relocation table.
      596      383        */
      597      384    4            IF KH$CCPLCT.LCTRLCTBL_BYT(Y@RLCTBLBYTX) ~= 0 THEN DO;
      598      385        /*
      599      386        This byte of the LCT relocation table indicates we've got some relocating
      600      387        to do.
      601      388        */
      602      389    5               DO Y@RLCTBLBITX = Y@RLCTBLBYTX*8 TO Y@RLCTBLBYTX*8+7;
      603      390        /*
      604      391        This loop is iterated for each bit in a non-zero relocation table byte.
      605      392        */
      606      393    6                  IF KH$CCPLCT.LCTRLCTBL_BIT(Y@RLCTBLBITX) THEN DO;
      607      394        /*
      608      395        This byte of LCTs needs to be relocated.
      609      396        */
      610      397    7                     IF Y@FRSBYT THEN DO;
      611      398        /*
      612      399        This is the first byte of the pair needing relocation.
      613      400        */
      614      401    7                        Y@FRSBYTX = Y@RLCTBLBITX;
      615      402    7                        Y@FRSBYT = '0'B;
      616      403    7                     END; ELSE DO;
PL6.E3A0      #003=KHI$RLCCCPLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:82   
      617      404        /*
      618      405        This is the second byte of the pair needing relocation.
      619      406        */
      620      407    7                        Y@DAT.HI_BYT = KH$CCPLCT.LCTBYT(Y@FRSBYTX);
      621      408    7                        Y@DAT.LOWBYT = KH$CCPLCT.LCTBYT(Y@RLCTBLBITX);
      622      409    7                        Y@DAT_WRD = Y@DAT_WRD + Y@RLCDLT;
      623      410    7                        KH$CCPLCT.LCTBYT(Y@FRSBYTX) = Y@DAT.HI_BYT;
      624      411    7                        KH$CCPLCT.LCTBYT(Y@RLCTBLBITX) = Y@DAT.LOWBYT;
      625      412    7                        Y@FRSBYT = '1'B;
      626      413    7                     END;                  /* END ELSE IF Y@FRSBYT               */
      627      414    6                  END;                     /* END IF KH$CCPLCT.LCTRLCTBL_BYT     */
      628      415    5               END;                        /* END DO Y@RLCTBLBITX ...            */
      629      416    4            END;                           /* END IF RLCTBL ~= 0                 */
      630      417    3         END;                              /* END DO Y@RLCTBLBYTX = 0 TO ...     */
      631      418
      632      419
      633      420
      634      421    2         Y@CCPRLCTBL$ = PINCRW(ADDR(KH$CCPLCT), KH$CCPLCT.CCPRLCTBLWRDX);
      635      422
      636      423    3         DO Y@RLCTBLBYTX = 0 TO ((KH$CCPLCT.CCPBYTSIZ+7)/8)-1;
      637      424        /*
      638      425        This loop is iterated for each byte in the CCP relocation table.
      639      426        */
      640      427    4            IF Y$CCPRLCTBL.BYT(Y@RLCTBLBYTX) ~= 0 THEN DO;
      641      428        /*
      642      429        This byte of the CCP relocation table indicates we've got some relocating
      643      430        to do.
      644      431        */
      645      432    5               DO Y@RLCTBLBITX = Y@RLCTBLBYTX*8 TO Y@RLCTBLBYTX*8+7;
      646      433        /*
      647      434        This loop is iterated for each bit in a non-zero relocation table byte.
      648      435        */
      649      436    6                  IF Y$CCPRLCTBL.BT(Y@RLCTBLBITX) THEN DO;
      650      437        /*
      651      438        This byte of CCP needs to be relocated.
      652      439        */
      653      440    7                     IF Y@FRSBYT THEN DO;
PL6.E3A0      #003=KHI$RLCCCPLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:83   
      654      441        /*
      655      442        This is the first byte of the pair needing relocation.
      656      443        */
      657      444    7                        Y@FRSBYTX = Y@RLCTBLBITX;
      658      445    7                        Y@FRSBYT = '0'B;
      659      446    7                     END; ELSE DO;
      660      447        /*
      661      448        This is the second byte of the pair needing relocation.
      662      449        */
      663      450    7                        Y@DAT.HI_BYT = KH$CCPLCT.CCP(Y@FRSBYTX);
      664      451    7                        Y@DAT.LOWBYT = KH$CCPLCT.CCP(Y@RLCTBLBITX);
      665      452    7                        Y@DAT_WRD = Y@DAT_WRD + Y@RLCDLT;
      666      453    7                        KH$CCPLCT.CCP(Y@FRSBYTX) = Y@DAT.HI_BYT;
      667      454    7                        KH$CCPLCT.CCP(Y@RLCTBLBITX) = Y@DAT.LOWBYT;
      668      455    7                        Y@FRSBYT = '1'B;
      669      456    7                     END;                  /* END ELSE IF Y@FRSBYT               */
      670      457    6                  END;                     /* END IF Y$CCPRLCTBL.BYT             */
      671      458    5               END;                        /* END DO Y@RLCTBLBITX ...            */
      672      459    4            END;                           /* END IF RLCTBL ~= 0                 */
      673      460    3         END;                              /* END DO Y@RLCTBLBYTX = 0 TO ...     */
      674      461    2         KH$CCPLCT.CCPLODBIS = PRM_RLCCCPLCT.CCPLODBIS;
      675      462    2      END;             /* END IF PRM_RLCCCPLCT.CCPLODBIS ~= KH$CCPLCT.CCPLODBIS  */
      676      463    1   END KHI$RLCCCPLCT;

PL6.E3A0      #003=KHI$RLCCCPLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:84   
--  Include file information  --

   KH$IO.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is never referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is never referenced.
   KV$USR.:E05TOU  was found in the system file and is never referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is never referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is never referenced.
   KV$GLB.:E05TOU  was found in the system file and is never referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is never referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   KI_CP6.:E05TOU  was found in the system file and is never referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure KHI$RLCCCPLCT.

   Procedure KHI$RLCCCPLCT requires 213 words for executable code.
   Procedure KHI$RLCCCPLCT requires 16 words of local(AUTO) storage.

    No errors detected in file KHI$CLCIO.:E05TSI    .

PL6.E3A0      #003=KHI$RLCCCPLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:85   

 Object Unit name= KHI$RLCCCPLCT                              File name= KHI$CLCIO.:E05TOU
 UTS= JUL 30 '97 00:30:40.80 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0   Proc  even  none   213     D5  KHI$RLCCCPLCT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     0      0   yes    yes     yes      Std        1  KHI$RLCCCPLCT

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
                       nStd      0 X6A_AUTO_1
                       nStd      0 X6A_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
r    G$ROS$
PL6.E3A0      #003=KHI$RLCCCPLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:86   


      506        1        /*T***********************************************************/
      507        2        /*T*                                                         */
      508        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      509        4        /*T*                                                         */
      510        5        /*T***********************************************************/
      511        6        KHI$RLCCCPLCT: PROC(PRM_RLCCCPLCT) ALTRET;

      6   0 000000  D380 0000 0000  xent KHI$RLCCCPLCT   LNJ,B5   X6A_AUTO_1
          0 000003       0010 0001                       DC       16,1

      512        7
      513        8        /*F* NAME: KHI$RLCCCPLCT - Relocate LCT and CCP
      514        9
      515       10        The KHI$RLCCCPLCT routine relocates the LCTs and CCP passed (modifying
      516       11        what was passed), and updates the CCP load bias in the ELSIE header
      517       12        (KH$CCPLCT.CCPLODBIS).
      518       13
      519       14        The form of the call for this service is:
      520       15
      521       16        .fif
      522       17           CALL KHI$RLCCCPLCT(kh$rlccplct);
      523       18        .fin
      524       19
      525       20        where:
      526       21        */
      527       22
      528       23        /*K* kh$rlcccplct -
      529       24        is the structure defined by the KH$RLCCCPLCT macro,
      530       25        which is in file KH$IO.
      531       26        */
      532       27
      533       28        /* INCLUDEs */
      534       29
      535       30        %INCLUDE KH$IO;
      536      277
      537      278        /* Based structures. */
PL6.E3A0      #003=KHI$RLCCCPLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:87   
      538      279        /*
      539      280        CCP relocation table.
      540      281        */
      541      282    1   DCL 1 Y$CCPRLCTBL BASED(Y@CCPRLCTBL$) ALIGNED,
      542      283    1          2 BT(0:7) BIT(1) UNAL,
      543      284    1          2 BYT(0:0) REDEF BT UBIN BYTE UNAL;
      544      285
      545      286        /* Declare parameters */
      546      287
      547      288        %KH$RLCCCPLCT (NAME = PRM_RLCCCPLCT, STCLASS = PARAM);
      548      310
      549      311        /* Declare based structures */
      550      312
      551      313        %KH$CCPLCT (NAME = KH$CCPLCT, STCLASS = "BASED(PRM_RLCCCPLCT.CCPLCT$)");
      552      339
      553      340        /* Declare AUTO data */
      554      341        /*
      555      342        CCP relocation table pointer.
      556      343        */
      557      344    1   DCL Y@CCPRLCTBL$ PTR AUTO;
      558      345        /*
      559      346        Flag indicating we're relocating the first byte of a pair of bytes.
      560      347        */
      561      348    1   DCL Y@FRSBYT BIT(1) AUTO;
      562      349        /*
      563      350        Relocation table bit index.  Also the byte index into the LCTs or CCP.
      564      351        */
      565      352    1   DCL Y@RLCTBLBITX UBIN WORD AUTO;
      566      353        /*
      567      354        Relocation table byte index.
      568      355        */
      569      356    1   DCL Y@RLCTBLBYTX UBIN WORD AUTO;
      570      357        /*
      571      358        First byte (of an LCT or CCP pair needing relocation) index.
      572      359        */
      573      360    1   DCL Y@FRSBYTX UBIN WORD AUTO;
      574      361        /*
PL6.E3A0      #003=KHI$RLCCCPLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:88   
      575      362        Relocation delta; the value to be added to each pair of CCP/LCT bytes.
      576      363        */
      577      364    1   DCL Y@RLCDLT SBIN ALIGNED AUTO;
      578      365        /*
      579      366        Both bytes of a pair of LCTs or CCP requiring relocation.
      580      367        */
      581      368    1   DCL 1 Y@DAT ALIGNED AUTO,
      582      369    1          2 HI_BYT UBIN BYTE UNAL,
      583      370    1          2 LOWBYT UBIN BYTE UNAL;
      584      371
      585      372    1   DCL Y@DAT_WRD REDEF Y@DAT SBIN;
      586      373
      587      374    2      IF PRM_RLCCCPLCT.CCPLODBIS ~= KH$CCPLCT.CCPLODBIS THEN DO;

    374   0 000005  ECC7 0004                            LDB,B6   @PRM_RLCCCPLCT,AUTO
          0 000007  DC86                                 LDB,B5   ,B6
          0 000008  E846 0002                            LDR,R6   2,B6
          0 00000A  E905                                 CMR,R6   ,B5
          0 00000B  0901 00C6                            BE       s:463,PREL

      588      375        /*
      589      376        The load biases don't match, so we have some relocating to do.
      590      377        */
      591      378    2         Y@RLCDLT = PRM_RLCCCPLCT.CCPLODBIS - KH$CCPLCT.CCPLODBIS;

    378   0 00000D  E205                                 SUB,R6   ,B5
          0 00000E  EF47 000C                            STR,R6   Y@RLCDLT,AUTO

      592      379    2         Y@FRSBYT = '1'B;

    379   0 000010  8947 0008                            LBT,'8000'X       Y@FRSBYT,AUTO
    379   0 000012       8000

      593      380    3         DO Y@RLCTBLBYTX = 0 TO (256/8)-1;

    380   0 000013  8747 000A                            CL       Y@RLCTBLBYTX,AUTO
          0 000015  0F81 004C                            B        s:417+2,PREL
PL6.E3A0      #003=KHI$RLCCCPLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:89   

      594      381        /*
      595      382        This loop is iterated for each byte in the LCT relocation table.
      596      383        */
      597      384    4            IF KH$CCPLCT.LCTRLCTBL_BYT(Y@RLCTBLBYTX) ~= 0 THEN DO;

    384   0 000017  ECC7 0004                            LDB,B6   @PRM_RLCCCPLCT,AUTO
          0 000019  DC86                                 LDB,B5   ,B6
          0 00001A  CBC5 0083                            LAB,B4   131,B5
          0 00001C  B847 000A                            LDR,R3   Y@RLCTBLBYTX,AUTO
          0 00001E  E2B4                                 LLH,R6   ,B4,R3
          0 00001F  6901 0040                            BEZ,R6   s:417,PREL

      598      385        /*
      599      386        This byte of the LCT relocation table indicates we've got some relocating
      600      387        to do.
      601      388        */
      602      389    5               DO Y@RLCTBLBITX = Y@RLCTBLBYTX*8 TO Y@RLCTBLBYTX*8+7;

    389   0 000021  3003                                 SOL,R3   3
          0 000022  BF47 0009                            STR,R3   Y@RLCTBLBITX,AUTO
          0 000024  0F81 0034                            B        s:415+2,PREL

      603      390        /*
      604      391        This loop is iterated for each bit in a non-zero relocation table byte.
      605      392        */
      606      393    6                  IF KH$CCPLCT.LCTRLCTBL_BIT(Y@RLCTBLBITX) THEN DO;

    393   0 000026  ECC7 0004                            LDB,B6   @PRM_RLCCCPLCT,AUTO
          0 000028  DC86                                 LDB,B5   ,B6
          0 000029  CBC5 0083                            LAB,B4   131,B5
          0 00002B  B847 0009                            LDR,R3   Y@RLCTBLBITX,AUTO
          0 00002D  82B4                                 LB       ,B4,R3
          0 00002E  0581 0028                            BBF      s:415,PREL

      607      394        /*
      608      395        This byte of LCTs needs to be relocated.
PL6.E3A0      #003=KHI$RLCCCPLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:90   
      609      396        */
      610      397    7                     IF Y@FRSBYT THEN DO;

    397   0 000030  89C7 0008                            CMZ      Y@FRSBYT,AUTO
          0 000032  0881 0007                            BAGE     s:407,PREL

      611      398        /*
      612      399        This is the first byte of the pair needing relocation.
      613      400        */
      614      401    7                        Y@FRSBYTX = Y@RLCTBLBITX;

    401   0 000034  BF47 000B                            STR,R3   Y@FRSBYTX,AUTO

      615      402    7                        Y@FRSBYT = '0'B;

    402   0 000036  8747 0008                            CL       Y@FRSBYT,AUTO

      616      403    7                     END; ELSE DO;

    403   0 000038  0F81 001E                            B        s:415,PREL

      617      404        /*
      618      405        This is the second byte of the pair needing relocation.
      619      406        */
      620      407    7                        Y@DAT.HI_BYT = KH$CCPLCT.LCTBYT(Y@FRSBYTX);

    407   0 00003A  A847 000B                            LDR,R2   Y@FRSBYTX,AUTO
          0 00003C  2E06                                 ADV,R2   6
          0 00003D  E2A5                                 LLH,R6   ,B5,R2
          0 00003E  E7C7 000D                            STH,R6   Y@DAT,AUTO

      621      408    7                        Y@DAT.LOWBYT = KH$CCPLCT.LCTBYT(Y@RLCTBLBITX);

    408   0 000040  3E06                                 ADV,R3   6
          0 000041  D2B5                                 LLH,R5   ,B5,R3
          0 000042  DAC7 000D                            SRM,R5,'00FF'X    Y@DAT,AUTO
          0 000044       00FF
PL6.E3A0      #003=KHI$RLCCCPLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:91   

      622      409    7                        Y@DAT_WRD = Y@DAT_WRD + Y@RLCDLT;

    409   0 000045  C847 000D                            LDR,R4   Y@DAT,AUTO
          0 000047  CA47 000C                            ADD,R4   Y@RLCDLT,AUTO
          0 000049  CF47 000D                            STR,R4   Y@DAT,AUTO

      623      410    7                        KH$CCPLCT.LCTBYT(Y@FRSBYTX) = Y@DAT.HI_BYT;

    410   0 00004B  92C7 000D                            LLH,R1   Y@DAT,AUTO
          0 00004D  97A5                                 STH,R1   ,B5,R2

      624      411    7                        KH$CCPLCT.LCTBYT(Y@RLCTBLBITX) = Y@DAT.LOWBYT;

    411   0 00004E  DC86                                 LDB,B5   ,B6
          0 00004F  E847 000D                            LDR,R6   Y@DAT,AUTO
          0 000051  E570 00FF                            AND,R6   255,IMO
          0 000053  E7B5                                 STH,R6   ,B5,R3

      625      412    7                        Y@FRSBYT = '1'B;

    412   0 000054  8947 0008                            LBT,'8000'X       Y@FRSBYT,AUTO
    412   0 000056       8000

      626      413    7                     END;                  /* END ELSE IF Y@FRSBYT               */

      627      414    6                  END;                     /* END IF KH$CCPLCT.LCTRLCTBL_BYT     */

      628      415    5               END;                        /* END DO Y@RLCTBLBITX ...            */

    415   0 000057  8AC7 0009                            INC      Y@RLCTBLBITX,AUTO
          0 000059  E847 000A                            LDR,R6   Y@RLCTBLBYTX,AUTO
          0 00005B  6003                                 SOL,R6   3
          0 00005C  6E07                                 ADV,R6   7
          0 00005D  E947 0009                            CMR,R6   Y@RLCTBLBITX,AUTO
          0 00005F  02C7                                 BGE      s:393,SPREL

PL6.E3A0      #003=KHI$RLCCCPLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:92   
      629      416    4            END;                           /* END IF RLCTBL ~= 0                 */

      630      417    3         END;                              /* END DO Y@RLCTBLBYTX = 0 TO ...     */

    417   0 000060  8AC7 000A                            INC      Y@RLCTBLBYTX,AUTO
          0 000062  E847 000A                            LDR,R6   Y@RLCTBLBYTX,AUTO
          0 000064  6D1F                                 CMV,R6   31
          0 000065  0381 FFB1                            BLE      s:384,PREL

      631      418
      632      419
      633      420
      634      421    2         Y@CCPRLCTBL$ = PINCRW(ADDR(KH$CCPLCT), KH$CCPLCT.CCPRLCTBLWRDX);

    421   0 000067  DC86                                 LDB,B5   ,B6
          0 000068  B845 0002                            LDR,R3   2,B5
          0 00006A  DFC7 000E                            STB,B5   Y@DAT+1,AUTO
          0 00006C  F853                                 LDR,R7   R3
          0 00006D  6C00                                 LDV,R6   0
          0 00006E  8447 000E                            AID      Y@DAT+1,AUTO
          0 000070  8D47 0006                            SDI      Y@CCPRLCTBL$,AUTO

      635      422
      636      423    3         DO Y@RLCTBLBYTX = 0 TO ((KH$CCPLCT.CCPBYTSIZ+7)/8)-1;

    423   0 000072  8747 000A                            CL       Y@RLCTBLBYTX,AUTO
          0 000074  0F81 004F                            B        s:460+2,PREL

      637      424        /*
      638      425        This loop is iterated for each byte in the CCP relocation table.
      639      426        */
      640      427    4            IF Y$CCPRLCTBL.BYT(Y@RLCTBLBYTX) ~= 0 THEN DO;

    427   0 000076  ECC7 0006                            LDB,B6   Y@CCPRLCTBL$,AUTO
          0 000078  B847 000A                            LDR,R3   Y@RLCTBLBYTX,AUTO
          0 00007A  E2B6                                 LLH,R6   ,B6,R3
          0 00007B  6901 0046                            BEZ,R6   s:460,PREL
PL6.E3A0      #003=KHI$RLCCCPLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:93   

      641      428        /*
      642      429        This byte of the CCP relocation table indicates we've got some relocating
      643      430        to do.
      644      431        */
      645      432    5               DO Y@RLCTBLBITX = Y@RLCTBLBYTX*8 TO Y@RLCTBLBYTX*8+7;

    432   0 00007D  3003                                 SOL,R3   3
          0 00007E  BF47 0009                            STR,R3   Y@RLCTBLBITX,AUTO
          0 000080  0F81 003A                            B        s:458+2,PREL

      646      433        /*
      647      434        This loop is iterated for each bit in a non-zero relocation table byte.
      648      435        */
      649      436    6                  IF Y$CCPRLCTBL.BT(Y@RLCTBLBITX) THEN DO;

    436   0 000082  ECC7 0006                            LDB,B6   Y@CCPRLCTBL$,AUTO
          0 000084  B847 0009                            LDR,R3   Y@RLCTBLBITX,AUTO
          0 000086  82B6                                 LB       ,B6,R3
          0 000087  0581 0031                            BBF      s:458,PREL

      650      437        /*
      651      438        This byte of CCP needs to be relocated.
      652      439        */
      653      440    7                     IF Y@FRSBYT THEN DO;

    440   0 000089  89C7 0008                            CMZ      Y@FRSBYT,AUTO
          0 00008B  0881 0007                            BAGE     s:450,PREL

      654      441        /*
      655      442        This is the first byte of the pair needing relocation.
      656      443        */
      657      444    7                        Y@FRSBYTX = Y@RLCTBLBITX;

    444   0 00008D  BF47 000B                            STR,R3   Y@FRSBYTX,AUTO

      658      445    7                        Y@FRSBYT = '0'B;
PL6.E3A0      #003=KHI$RLCCCPLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:94   

    445   0 00008F  8747 0008                            CL       Y@FRSBYT,AUTO

      659      446    7                     END; ELSE DO;

    446   0 000091  0F81 0027                            B        s:458,PREL

      660      447        /*
      661      448        This is the second byte of the pair needing relocation.
      662      449        */
      663      450    7                        Y@DAT.HI_BYT = KH$CCPLCT.CCP(Y@FRSBYTX);

    450   0 000093  DCC7 0004                            LDB,B5   @PRM_RLCCCPLCT,AUTO
          0 000095  CC85                                 LDB,B4   ,B5
          0 000096  BBC4 0093                            LAB,B3   147,B4
          0 000098  A847 000B                            LDR,R2   Y@FRSBYTX,AUTO
          0 00009A  E2A3                                 LLH,R6   ,B3,R2
          0 00009B  E7C7 000D                            STH,R6   Y@DAT,AUTO

      664      451    7                        Y@DAT.LOWBYT = KH$CCPLCT.CCP(Y@RLCTBLBITX);

    451   0 00009D  BBC4 0093                            LAB,B3   147,B4
          0 00009F  E2B3                                 LLH,R6   ,B3,R3
          0 0000A0  EAC7 000D                            SRM,R6,'00FF'X    Y@DAT,AUTO
          0 0000A2       00FF

      665      452    7                        Y@DAT_WRD = Y@DAT_WRD + Y@RLCDLT;

    452   0 0000A3  E847 000D                            LDR,R6   Y@DAT,AUTO
          0 0000A5  EA47 000C                            ADD,R6   Y@RLCDLT,AUTO
          0 0000A7  EF47 000D                            STR,R6   Y@DAT,AUTO

      666      453    7                        KH$CCPLCT.CCP(Y@FRSBYTX) = Y@DAT.HI_BYT;

    453   0 0000A9  D2C7 000D                            LLH,R5   Y@DAT,AUTO
          0 0000AB  BBC4 0093                            LAB,B3   147,B4
          0 0000AD  D7A3                                 STH,R5   ,B3,R2
PL6.E3A0      #003=KHI$RLCCCPLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:95   

      667      454    7                        KH$CCPLCT.CCP(Y@RLCTBLBITX) = Y@DAT.LOWBYT;

    454   0 0000AE  CC85                                 LDB,B4   ,B5
          0 0000AF  C847 000D                            LDR,R4   Y@DAT,AUTO
          0 0000B1  C570 00FF                            AND,R4   255,IMO
          0 0000B3  BBC4 0093                            LAB,B3   147,B4
          0 0000B5  C7B3                                 STH,R4   ,B3,R3

      668      455    7                        Y@FRSBYT = '1'B;

    455   0 0000B6  8947 0008                            LBT,'8000'X       Y@FRSBYT,AUTO
    455   0 0000B8       8000

      669      456    7                     END;                  /* END ELSE IF Y@FRSBYT               */

      670      457    6                  END;                     /* END IF Y$CCPRLCTBL.BYT             */

      671      458    5               END;                        /* END DO Y@RLCTBLBITX ...            */

    458   0 0000B9  8AC7 0009                            INC      Y@RLCTBLBITX,AUTO
          0 0000BB  E847 000A                            LDR,R6   Y@RLCTBLBYTX,AUTO
          0 0000BD  6003                                 SOL,R6   3
          0 0000BE  6E07                                 ADV,R6   7
          0 0000BF  E947 0009                            CMR,R6   Y@RLCTBLBITX,AUTO
          0 0000C1  02C1                                 BGE      s:436,SPREL

      672      459    4            END;                           /* END IF RLCTBL ~= 0                 */

      673      460    3         END;                              /* END DO Y@RLCTBLBYTX = 0 TO ...     */

    460   0 0000C2  8AC7 000A                            INC      Y@RLCTBLBYTX,AUTO
          0 0000C4  ECC7 0004                            LDB,B6   @PRM_RLCCCPLCT,AUTO
          0 0000C6  DC86                                 LDB,B5   ,B6
          0 0000C7  E845 0001                            LDR,R6   1,B5
          0 0000C9  6E07                                 ADV,R6   7
          0 0000CA  6043                                 SOR,R6   3
PL6.E3A0      #003=KHI$RLCCCPLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:96   
          0 0000CB  E947 000A                            CMR,R6   Y@RLCTBLBYTX,AUTO
          0 0000CD  0301 FFA8                            BG       s:427,PREL

      674      461    2         KH$CCPLCT.CCPLODBIS = PRM_RLCCCPLCT.CCPLODBIS;

    461   0 0000CF  E846 0002                            LDR,R6   2,B6
          0 0000D1  EF05                                 STR,R6   ,B5

      675      462    2      END;             /* END IF PRM_RLCCCPLCT.CCPLODBIS ~= KH$CCPLCT.CCPLODBIS  */

      676      463    1   END KHI$RLCCCPLCT;

    463   0 0000D2  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

PL6.E3A0      #003=KHI$RLCCCPLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:97   
--  Include file information  --

   KH$IO.:E05TOU  is referenced.
   KV_PRMID_E.:E05TOU  was found in the system file and is never referenced.
   KV_GLBCNS_E.:E05TOU  was found in the system file and is never referenced.
   KV$VDO.:E05TOU  was found in the system file and is never referenced.
   KV$VDH.:E05TOU  was found in the system file and is never referenced.
   KV$USR.:E05TOU  was found in the system file and is never referenced.
   KV$SND.:E05TOU  was found in the system file and is never referenced.
   KV$INT.:E05TOU  was found in the system file and is never referenced.
   KV$GLBCTX.:E05TOU  was found in the system file and is never referenced.
   KV$GLB.:E05TOU  was found in the system file and is never referenced.
   G_LCP6_E.:E05TOU  was found in the system file and is never referenced.
   GT_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   KI_CP6.:E05TOU  was found in the system file and is never referenced.
   GF_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GM_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GU_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GJ_LCP6_M.:E05TOU  was found in the system file and is never referenced.
   GH_LCP6_M.:E05TOU  was found in the system file and is never referenced.
      No diagnostics issued in procedure KHI$RLCCCPLCT.
PL6.E3A0      #003=KHI$RLCCCPLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:98   

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @PRM_RLCCCPLCT            *0-0-0/w STRC(48)    r     1 PRM_RLCCCPLCT
     6-0-0/w PTR         r     1 Y@CCPRLCTBL$               D-0-0/w STRC(16)    r     1 Y@DAT
     D-0-0/w SBIN(16)    r     1 Y@DAT_WRD                  8-0-0/b BIT         r     1 Y@FRSBYT
     B-0-0/w UBIN(16)    r     1 Y@FRSBYTX                  C-0-0/w SBIN(16)    r     1 Y@RLCDLT
     9-0-0/w UBIN(16)    r     1 Y@RLCTBLBITX               A-0-0/w UBIN(16)    r     1 Y@RLCTBLBYTX

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(2360)  r     1 KH$CCPLCT                  0-0-0/w STRC(8)     r     1 Y$CCPRLCTBL


   Procedure KHI$RLCCCPLCT requires 213 words for executable code.
   Procedure KHI$RLCCCPLCT requires 16 words of local(AUTO) storage.

    No errors detected in file KHI$CLCIO.:E05TSI    .
PL6.E3A0      #003=KHI$RLCCCPLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:99   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=KHI$RLCCCPLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:100  
          MINI XREF LISTING

KH$CCPLCT
       327**DCL       421--ASSIGN
KH$CCPLCT.CCP
       337**DCL       450>>ASSIGN    451>>ASSIGN    453<<ASSIGN    454<<ASSIGN
KH$CCPLCT.CCPBYTSIZ
       333**DCL       423>>DOINDEX
KH$CCPLCT.CCPLODBIS
       333**DCL       374>>IF        378>>ASSIGN    461<<ASSIGN
KH$CCPLCT.CCPRLCTBLWRDX
       333**DCL       333--REDEF     421>>ASSIGN
KH$CCPLCT.LCTBYT
       334**DCL       334--REDEF     334--REDEF     407>>ASSIGN    408>>ASSIGN    410<<ASSIGN    411<<ASSIGN
KH$CCPLCT.LCTRLCTBL_BIT
       337**DCL       393>>IF
KH$CCPLCT.LCTRLCTBL_BYT
       336**DCL       337--REDEF     384>>IF
PRM_RLCCCPLCT
       302**DCL         6--PROC
PRM_RLCCCPLCT.CCPLCT$
       308**DCL       327--IMP-PTR   374>>IF        378>>ASSIGN    384>>IF        393>>IF        407>>ASSIGN
       408>>ASSIGN    410>>ASSIGN    411>>ASSIGN    421>>ASSIGN    421>>ASSIGN    423>>DOINDEX   450>>ASSIGN
       451>>ASSIGN    453>>ASSIGN    454>>ASSIGN    461>>ASSIGN
PRM_RLCCCPLCT.CCPLODBIS
       308**DCL       374>>IF        378>>ASSIGN    461>>ASSIGN
Y$CCPRLCTBL.BT
       283**DCL       284--REDEF     436>>IF
Y$CCPRLCTBL.BYT
       284**DCL       427>>IF
Y@CCPRLCTBL$
       344**DCL       282--IMP-PTR   421<<ASSIGN    427>>IF        436>>IF
Y@DAT
       368**DCL       372--REDEF
PL6.E3A0      #003=KHI$RLCCCPLCT File=KHI$CLCIO.:E05TSI                          WED 07/30/97 00:30 Page:101  
Y@DAT.HI_BYT
       369**DCL       407<<ASSIGN    410>>ASSIGN    450<<ASSIGN    453>>ASSIGN
Y@DAT.LOWBYT
       370**DCL       408<<ASSIGN    411>>ASSIGN    451<<ASSIGN    454>>ASSIGN
Y@DAT_WRD
       372**DCL       409<<ASSIGN    409>>ASSIGN    452<<ASSIGN    452>>ASSIGN
Y@FRSBYT
       348**DCL       379<<ASSIGN    397>>IF        402<<ASSIGN    412<<ASSIGN    440>>IF        445<<ASSIGN
       455<<ASSIGN
Y@FRSBYTX
       360**DCL       401<<ASSIGN    407>>ASSIGN    410>>ASSIGN    444<<ASSIGN    450>>ASSIGN    453>>ASSIGN
Y@RLCDLT
       364**DCL       378<<ASSIGN    409>>ASSIGN    452>>ASSIGN
Y@RLCTBLBITX
       352**DCL       389<<DOINDEX   393>>IF        401>>ASSIGN    408>>ASSIGN    411>>ASSIGN    432<<DOINDEX
       436>>IF        444>>ASSIGN    451>>ASSIGN    454>>ASSIGN
Y@RLCTBLBYTX
       356**DCL       380<<DOINDEX   384>>IF        389>>DOINDEX   389>>DOINDEX   423<<DOINDEX   427>>IF
       432>>DOINDEX   432>>DOINDEX
