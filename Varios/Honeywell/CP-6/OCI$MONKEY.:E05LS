VERSION E05

PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:1    
        1        1        /*M* OCI$MONKEY  monitor/KEYIN interface routines    */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* */
        8        8        %SET LISTSUB='1'B;
        9        9        /*P* NAME: OCI$MONKEY
       10       10                   OCI$MONKEY contains the routines necessary for
       11       11                   interfacing between the monitor and KEYIN.
       12       12                   This interfacing is accomplished through I/O
       13       13                   via the Central System COMGROUP           */
       14       14        /*M* OCI$MK_WRTM  routines to write messages to consoles */
       15       15        /*X* */
       16       16        /*F* NAME: OCI$MK_WRTM
       17       17
       18       18             PURPOSE: To write messages to operators' consoles from
       19       19                      the monitor.
       20       20
       21       21             DESCRIPTION: A KEYIN message header is built and lengths
       22       22                          and parameters appended.  The message is then
       23       23                          written to KEYIN via the Central System COMGROUP.
       24       24                                                                                       */
       25       25        /*D* NAME: OCI$MK_WRTM
       26       26
       27       27             CALL: CALL OCI$MK_WRTM (CADDR, MSG#, NPARAMS, LEN, TBL, DCTX, WSN, MSGID)
       28       28
       29       29                   Where the parameters are:
       30       30
       31       31                        CADDR BIT(18) UNAL -- console address
       32       32                        MSG# UBIN WORD UNAL -- message number
       33       33                        NPARAMS UBIN WORD UNAL -- number of message parameters
       34       34                        LEN -- an UNALigned string of one-byte message parameter lengths
       35       35                        TBL -- an UNALigned string of message parameters
       36       36                        DCTX UBIN WORD UNAL -- DCT index if this message is destined for
       37       37                                               a device console
PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:2    
       38       38                        WSN CHAR(8) -- workstation if this message is destined for
       39       39                                       a workstation
       40       40                        MSGID UBIN HALF UNAL -- unique message identifier (returned)
       41       41
       42       42             INTERFACE: KUW$WRITE, SCREECH
       43       43
       44       44             ENVIRONMENT: Any
       45       45
       46       46             INPUT: OCI_MSGID
       47       47
       48       48             OUTPUT: OCI_MSGID
       49       49
       50       50             SCRATCH: None
       51       51
       52       52             DESCRIPTION: The passed parameters are used to build a KEYIN
       53       53                          message header and message parameters.
       54       54                          TIMED WRITE is specified as the function to be
       55       55                          performed and the message is written to KEYIN via
       56       56                          the Central System COMGROUP.
       57       57                                                                                      */
       58       58        OCI$MK_WRTM: PROC (CADDR, MSG#, NPARAMS, LEN, TBL, DCTX, WSN, MSGID);
       59       59    1   DCL CADDR BIT(18) CALIGNED;
       60       60    1   DCL MSG# UBIN WORD CALIGNED;
       61       61    1   DCL NPARAMS UBIN WORD CALIGNED;
       62       62    1   DCL NPARAMSS REDEF NPARAMS SBIN;
       63       63    1   DCL LEN(0:0) UBIN BYTE CALIGNED;
       64       64    1   DCL TBL(0:0) UBIN BYTE CALIGNED;
       65       65    1   DCL DCTX UBIN WORD CALIGNED;
       66       66    1   DCL WSN CHAR(8) CALIGNED;
       67       67    1   DCL MSGID UBIN HALF CALIGNED;
       68       68        /*  */
       69       69        %INCLUDE B$JIT_C;
       70      383        %B$JIT0;
       71      472        %A$JIT6X;
       72      475        %INCLUDE CP_6_SUBS;
       73     1015        %INCLUDE JG_GHOSTS_C;
       74     1105          %INCLUDE N_FC_C;
PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:3    
       75     1142          %INCLUDE N$REQ;
       76     1216            %N$REQ (STCLASS="BASED(TEMP$)");
       77     1274          %INCLUDE OC_DATA_R;
       78     1283        %INCLUDE OC_SUBS_C;
       79     2014        %INCLUDE OCI_SUBS_C;
       80     2112          %INCLUDE OCI_DATA_R;
       81     2124          %INCLUDE OC$MESSHD_C;
       82     2145            %OC$MESSHD (NAME=OC_MESSHD,STCLASS="");
       83     2159    1         2 MESS CHAR(124) UNAL;
       84     2160          %INCLUDE NK_LDCT_R;
       85     2169          %INCLUDE NK$LDCT;
       86     2271                %NK$LDCT;
       87     2317                                                /**/
       88     2318        %INCLUDE FR$RAT;
       89     2371                                                /**/
       90     2372             %FR$RAT;
       91     2412                                                /**/
       92     2413        %INCLUDE FR_SUBS;
       93     2481                                                /**/
       94     2482        %INCLUDE FM$SET;
       95     2509    1   DCL FM_SYSSETX UBIN WORD SYMREF;
       96     2510    1   DCL F$CFU$ PTR SYMREF;
       97     2511        %JG_GHOSTS(STCLASS=SYMREF);
       98     2549    1   DCL S_TIMR UBIN SYMREF;
       99     2550                                                /**/
      100     2551             %FM$DEV (BASED="BASED(F$CFU$)");
      101     2557                                                /**/
      102     2558             %FM$VOL (BASED="BASED(F$CFU$)");
      103     2564        /*  */
      104     2565                %SUB BAD_DCTX='170311400017'O;
      105     2566        /*  */
      106     2567    1   DCL B$JIT$ PTR SYMREF;
      107     2568    1   DCL SC_OCBADDCTX ENTRY CONV(2,0);
      108     2569    1   DCL NIO$QUE ENTRY(1) ALTRET;
      109     2570    1   DCL NIO$IOSPIN ENTRY(1);
      110     2571    1   DCL NII$LIP ENTRY(1);
      111     2572    1   DCL NIQ$GET ENTRY(1) ALTRET;
PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:4    
      112     2573    1   DCL NIQ$REL ENTRY(1) ALTRET;
      113     2574    1   DCL KUW$WRITE ENTRY(3) ALTRET;
      114     2575    1   DCL I SBIN WORD;
      115     2576    1   DCL SIZE SBIN WORD;
      116     2577    1   DCL TEMP SBIN WORD;
      117     2578    1   DCL TEMP$ PTR;
      118     2579        /*  */
      119     2580    1   DCL CTDVM CHAR(30) CONSTANT INIT('****NNDD IO ERROR 000000000000');
      120     2581    1   DCL 1 TDVM ALIGNED,
      121     2582    1         2 * CHAR(4) UNAL,
      122     2583    1         2 DVNM CHAR(4) UNAL,
      123     2584    1         2 * CHAR(10) UNAL,
      124     2585    1         2 STAT (0:11) UNAL,
      125     2586    1           3 * UBIN(6) UNAL,
      126     2587    1           3 US UBIN(3) UNAL,
      127     2588    1         2 SPAC CHAR(6) UNAL;
      128     2589    1   DCL TDVMC REDEF TDVM CHAR(36) ALIGNED;
      129     2590                                                /**/
      130     2591    1   DCL ARG UBIN WORD BASED;
      131     2592    1   DCL ARG_C CHAR(12) UNAL;
      132     2593                                                /**/
      133     2594    1   DCL DP_I UBIN WORD;
      134     2595    1   DCL DISPLAY_CT SBIN WORD;
      135     2596    1   DCL UB3 (0:11) UBIN(3) UNAL BASED;
      136     2597        /*  */
      137     2598    1   DCL STRING CHAR(TEMP) BASED;
      138     2599        /*
      139     2600                                                               */
      140     2601    1           OC_MESSHD.FCN = 2 /* timed write */;
      141     2602    1           MSGID = DCTX;
      142     2603        /*N* For C00 the MSGID parameter should be removed from the call to
      143     2604             OCI$MK_WRTM and NIK$KEYIN should always use the DCT index for
      144     2605             the message id.  This is just a sleasy way to fix it for B02. */
      145     2606    1           OC_MESSHD.MSGID = MSGID;
      146     2607    1           GOTO A;
      147     2608        /*D* NAME: OCI$MK_WR
      148     2609
PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:5    
      149     2610             CALL: CALL OCI$MK_WR (CADDR, MSG#, NPARAMS, LEN, TBL, DCTX, WSN)
      150     2611
      151     2612                   Where the parameters are:
      152     2613
      153     2614                        CADDR BIT(18) UNAL -- console address
      154     2615                        MSG# UBIN WORD UNAL -- message number
      155     2616                        NPARAMS UBIN WORD UNAL -- number of message parameters
      156     2617                        LEN -- an UNALigned string of one-byte message parameter lengths
      157     2618                        TBL -- an UNALigned string of message parameters
      158     2619                        DCTX UBIN WORD UNAL -- DCT index if this message is destined for
      159     2620                                               a device console
      160     2621                        WSN CHAR(8) -- workstation if this message is destined for
      161     2622                                       a workstation
      162     2623
      163     2624                  INTERFACE: KUW$WRITE, SC_OCBADDCTX
      164     2625
      165     2626             ENVIRONMENT: Any
      166     2627
      167     2628             INPUT: None
      168     2629
      169     2630             OUTPUT: None
      170     2631
      171     2632             SCRATCH: None
      172     2633
      173     2634             DESCRIPTION: The passed parameters are used to build a KEYIN
      174     2635                          message header and message parameters.
      175     2636                          WRITE is specified as the function to be performed
      176     2637                          and the message is written to KEYIN via the
      177     2638                          Central System COMGROUP.
      178     2639                                                                                      */
      179     2640    1   OCI$MK_WR: ENTRY (CADDR, MSG#, NPARAMS, LEN, TBL, DCTX, WSN);
      180     2641    1           OC_MESSHD.FCN = 3 /* write */;
      181     2642    1           IF S_TIMR < 2
      182     2643    1           THEN
      183     2644    1              OC_MESSHD.SYSID=B$JIT.SYSID;
      184     2645    1   A:
      185     2646    1           IF OCI_BOOT                     /* KEYIN's not up yet                 */
PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:6    
      186     2647    1           THEN
      187     2648    2           DO;
      188     2649    2   SPEC_HAND: ;              /* Come here from normal, uptime
      189     2650                                                path if the thing has little
      190     2651                                                no probability of being
      191     2652                                                templated */
      192     2653    2              DISPLAY_CT = 1;
      193     2654    2              IF MSG# = 325 /* FILEIC_MSG# */
      194     2655    2              THEN
      195     2656    3              DO;
      196     2657    3                 TDVMC = ' *** FILE INCONSISTENCY 00 00 00';
      197     2658    3                 TEMP$ = ADDR(TBL(0));
      198     2659    3                 TEMP = 24;
      199     2660    4                 DO I = 0 TO 2;
      200     2661    4                    CALL BINCHAR (ARG_C, TEMP$ -> ARG);
      201     2662    4                    CALL INSERT (TDVMC, TEMP, 2, SUBSTR(ARG_C,10,2));
      202     2663    4                    TEMP = TEMP + 3;
      203     2664    4                    TEMP$ = PINCRC(TEMP$,4);
      204     2665    4                    END;
      205     2666    3                 GOTO MAKE_MSG;
      206     2667    3                 END;                      /* DO IF FILEIC_MSG#                  */
      207     2668                                                /**/
      208     2669    2              IF MSG# = 21 /* MOUNT_MSG# */
      209     2670    2              THEN
      210     2671    3              DO;                                     /* Must be PO reels changing
      211     2672                                                     volumes */
      212     2673    3                 TDVMC = ' *** Mount next PO reel (      )';
      213     2674    4                 DO I = 0 TO LEN(0)-1;
      214     2675    4                    CALL INSERT (TDVMC, 25 + I, 1, BINASC(TBL(I)));
      215     2676    4                    END;                   /* DO MOVE                            */
      216     2677    3                 GOTO MAKE_MSG;
      217     2678    3                 END;                      /* DO IF PO CVOL                      */
      218     2679                                                /**/
      219     2680    2              IF MSG# < 140 /* MINIO_MSG# */
      220     2681    2                OR
      221     2682    2                MSG# > 170 /* KIILGL_MSG# */
      222     2683    2              THEN
PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:7    
      223     2684    2                 RETURN;
      224     2685    2              IF MSG# = 149 /* FWL_MSG# */
      225     2686    2              THEN
      226     2687    3              DO;
      227     2688    3                 TDVMC = '  !!NNDD firmware loaded.';
      228     2689    3                 IF TBL(0) ~= 0
      229     2690    3                 THEN
      230     2691    3                    CALL INSERT(TDVMC,22,,' failed.');
      231     2692    3                 END;
      232     2693    2              ELSE
      233     2694    2                 IF MSG# = 170 /* KIILGL_MSG# */
      234     2695    2                 THEN
      235     2696    2                    TDVMC = '  !!NNDD Illegal keyin.';
      236     2697    2                 ELSE
      237     2698    3                 DO;
      238     2699    3                    TDVMC=CTDVM;
      239     2700    3                    DISPLAY_CT = 2;
      240     2701    3                    TEMP$=PINCRC(ADDR(TBL),LEN(0));
      241     2702    3                    IF LEN(1)>=4 THEN TEMP=11;
      242     2703    3                    ELSE TEMP=(LEN(1)*3)-1;
      243     2704    4                    DO I=0 TO TEMP;
      244     2705    4                       TDVM.STAT.US(I)=TEMP$->UB3(I);
      245     2706    4                       END;
      246     2707    3                    END;                   /* IF MSG#=FWL_MSG# ELSE              */
      247     2708    2              TDVM.DVNM = NK$LDCT$(DCTX)->NK$LDCT.DEVNM;
      248     2709    2   MAKE_MSG:  ;
      249     2710    2              CALL NIQ$GET(TEMP$) ALTRET (NOQ);
      250     2711    2              N$REQ.DLA.DCTX = B_SCDCTX;   /* DCT index of elephant              */
      251     2712    2              N$REQ.OPFLG = '010'O | '004'O;
      252     2713    2              N$REQ.BUF$ = ADDR (TDVM);    /* buffer address                     */
      253     2714    2              N$REQ.BUFSIZE = SIZEC(TDVM); /* buffer size                        */
      254     2715    2              N$REQ.FC = %N_WRITE;         /* write with CR/LF                   */
      255     2716    3              DO I = 0 TO (DISPLAY_CT-1);
      256     2717    3                 CALL NIO$QUE (N$REQ) ALTRET (RELQ);
      257     2718                                                /* Attempt to wait for the
      258     2719                                                     I/O to complete. */
      259     2720    3                 CALL NIO$IOSPIN(N$REQ);
PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:8    
      260     2721    3                 END;
      261     2722    2   RELQ:      ;
      262     2723    2              CALL NIQ$REL(TEMP$);
      263     2724    2   NOQ:       ;
      264     2725    2              RETURN;
      265     2726    2              END;
      266     2727    1           OC_MESSHD.CADDR = CADDR;
      267     2728    1           OC_MESSHD.MSG# = MSG#;
      268     2729                                                /**/
      269     2730                                           /* If a DCT index was passed
      270     2731                                              instead of a WSN, blank out
      271     2732                                              the WSN and assign the
      272     2733                                              TWSN in the next section. */
      273     2734                                                /**/
      274     2735    1           IF (ADDR (WSN) ~= ADDR (NIL))
      275     2736    1           THEN
      276     2737    1              OC_MESSHD.WSN = WSN;
      277     2738    1           ELSE
      278     2739    1              OC_MESSHD.WSN = ' ';
      279     2740                                                /**/
      280     2741    1           IF (ADDR (DCTX) ~= ADDR (NIL)) THEN
      281     2742    2           DO;
      282     2743                                                /**/
      283     2744    2              IF DCTX > NK_MXTOTAL
      284     2745    2              THEN
      285     2746    2                 CALL SC_OCBADDCTX;
      286     2747                                                /**/
      287     2748    2              IF NK$LDCT$(DCTX) = ADDR(NIL)
      288     2749    2              THEN
      289     2750    2                 CALL SC_OCBADDCTX;
      290     2751                                                /**/
      291     2752    2              OC_MESSHD.DEVNM = NK$LDCT$(DCTX) -> NK$LDCT.DEVNM;
      292     2753                                           /* Check here for the "SYSTEM" pack
      293     2754                                                set to bypass normal error
      294     2755                                                message processing (via KEYIN)
      295     2756                                                and handle it with IOQ */
      296     2757    2              IF NK$LDCT$ (DCTX) -> NK$LDCT.RAT$ ~= ADDR(NIL)
PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:9    
      297     2758    2              THEN
      298     2759    3              DO;
      299     2760    3                 TEMP$ = NK$LDCT$ (DCTX) -> NK$LDCT.RAT$;
      300     2761    3                 IF (TEMP$ -> FR$RAT.RCOD = 0 /*FR_DP*/)
      301     2762    3                   AND
      302     2763    3                   (MSG# >= 140 /* MINIO_MSG# */ AND MSG# <= 148 /* MAXIO_MSG# */)
      303     2764    3                 THEN
      304     2765    4                 DO;
      305     2766    4                    DP_I = FM$DEV.SECTL (DCTX);
      306     2767    5                    DO WHILE (DP_I ~= 0);
      307     2768    5                       IF FM$VOL.SETX (DP_I) = FM_SYSSETX
      308     2769    5                       THEN
      309     2770    5                          GOTO SPEC_HAND;
      310     2771    5                       DP_I = FM$VOL.SECTL (DP_I);
      311     2772    5                       END;
      312     2773    4                    END;
      313     2774    3                 END;                      /* DO IF RAT$ ~ NIL                   */
      314     2775                                                /**/
      315     2776    2              END;
      316     2777                                                /**/
      317     2778    1           SIZE = 0;
      318     2779    1           TEMP$ = ADDR (OC_MESSHD.MESS);
      319     2780    1           TEMP = NPARAMS;
      320     2781    2           DO I = 0 TO (NPARAMSS - 1);
      321     2782    2              SIZE = SIZE + LEN(I) + 1;
      322     2783    2              IF SIZE > SIZEC (OC_MESSHD.MESS) THEN
      323     2784    3              DO;
      324     2785    3                 TEMP = I;
      325     2786    3                 SIZE = SIZE - LEN(I) - 1;
      326     2787    3                 I = NPARAMS;              /* To exit loop                       */
      327     2788    3                 END;
      328     2789    2              END;
      329     2790    1           SIZE = SIZE - TEMP;             /* Calculate size of data             */
      330     2791    1           IF SIZE ~= 0 THEN
      331     2792    2           DO;
      332     2793    2              OC_MESSHD.NPARAMS = TEMP;
      333     2794    2              TEMP$ -> STRING = ADDR (LEN) -> STRING;
PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:10   
      334     2795    2              TEMP$ = PINCRC (TEMP$, TEMP);
      335     2796    2              TEMP = SIZE;
      336     2797    2              TEMP$ -> STRING = ADDR (TBL) -> STRING;
      337     2798    2              END;
      338     2799    1           ELSE
      339     2800    1              OC_MESSHD.NPARAMS = 0;
      340     2801    1           SIZE = OC_MESSHD.NPARAMS + SIZE +
      341     2802    1             20 /* SIZEC_OC_MESSHD# */;
      342     2803    1           CALL KUW$WRITE (OC_MESSHD, SIZE, J_KEYIN ); /* Write message to KEYIN */
      343     2804    1           RETURN;
      344     2805    1   END OCI$MK_WRTM;
      345     2806        %EOD;

PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:11   
--  Include file information  --

   FM$SET.:E05TOU  is referenced.
   FR_SUBS.:E05TOU  is referenced.
   FR$RAT.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   OC$MESSHD_C.:E05TOU  is referenced.
   OCI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   OCI_SUBS_C.:E05TOU  is referenced.
   OC_SUBS_C.:E05TOU  is referenced.
   OC_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   N$REQ.:E05TOU  is referenced.
   N_FC_C.:E05TOU  is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
      No diagnostics issued in procedure OCI$MK_WRTM.

   Procedure OCI$MK_WRTM requires 432 words for executable code.
   Procedure OCI$MK_WRTM requires 70 words of local(AUTO) storage.

PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:12   

 Object Unit name= OCI$MK_WRTM                                File name= OCI$MONKEY.:E05TOU
 UTS= JUL 30 '97 03:56:50.44 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS     39     47  OCI$MK_WRTM
    1   Proc  even  none   432    660  OCI$MK_WRTM
    2  RoData even  none     2      2  OCI$MK_WRTM

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        8  OCI$MK_WRTM
     1     15                  yes      Std        7  OCI$MK_WR

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 NIQ$GET
 yes     yes           Std       1 NIO$QUE
 yes     yes           Std       1 NIQ$REL
         yes           Std       1 NIO$IOSPIN
 yes     yes           Std       3 KUW$WRITE
                       nStd      0 X66_AUTO_N
                       nStd      0 X66_ARET
                       Std       0 B_CONSPOOL_D
PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:13   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_OCBADDCTX                          B_SCDCTX                         r    OCI_ROUTINE
     OCI_BOOT                              N$DCT$$                               NK_MXTOTAL
     FM_SYSSETX                            F$CFU$                                J_KEYIN
     S_TIMR                                B$JIT$                                B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ASLENTSID                             ISSID
PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:14   


        1        1        /*M* OCI$MONKEY  monitor/KEYIN interface routines    */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* */
        8        8        %SET LISTSUB='1'B;
        9        9        /*P* NAME: OCI$MONKEY
       10       10                   OCI$MONKEY contains the routines necessary for
       11       11                   interfacing between the monitor and KEYIN.
       12       12                   This interfacing is accomplished through I/O
       13       13                   via the Central System COMGROUP           */
       14       14        /*M* OCI$MK_WRTM  routines to write messages to consoles */
       15       15        /*X* */
       16       16        /*F* NAME: OCI$MK_WRTM
       17       17
       18       18             PURPOSE: To write messages to operators' consoles from
       19       19                      the monitor.
       20       20
       21       21             DESCRIPTION: A KEYIN message header is built and lengths
       22       22                          and parameters appended.  The message is then
       23       23                          written to KEYIN via the Central System COMGROUP.
       24       24                                                                                       */
       25       25        /*D* NAME: OCI$MK_WRTM
       26       26
       27       27             CALL: CALL OCI$MK_WRTM (CADDR, MSG#, NPARAMS, LEN, TBL, DCTX, WSN, MSGID)
       28       28
       29       29                   Where the parameters are:
       30       30
       31       31                        CADDR BIT(18) UNAL -- console address
       32       32                        MSG# UBIN WORD UNAL -- message number
       33       33                        NPARAMS UBIN WORD UNAL -- number of message parameters
       34       34                        LEN -- an UNALigned string of one-byte message parameter lengths
       35       35                        TBL -- an UNALigned string of message parameters
       36       36                        DCTX UBIN WORD UNAL -- DCT index if this message is destined for
PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:15   
       37       37                                               a device console
       38       38                        WSN CHAR(8) -- workstation if this message is destined for
       39       39                                       a workstation
       40       40                        MSGID UBIN HALF UNAL -- unique message identifier (returned)
       41       41
       42       42             INTERFACE: KUW$WRITE, SCREECH
       43       43
       44       44             ENVIRONMENT: Any
       45       45
       46       46             INPUT: OCI_MSGID
       47       47
       48       48             OUTPUT: OCI_MSGID
       49       49
       50       50             SCRATCH: None
       51       51
       52       52             DESCRIPTION: The passed parameters are used to build a KEYIN
       53       53                          message header and message parameters.
       54       54                          TIMED WRITE is specified as the function to be
       55       55                          performed and the message is written to KEYIN via
       56       56                          the Central System COMGROUP.
       57       57                                                                                      */
       58       58        OCI$MK_WRTM: PROC (CADDR, MSG#, NPARAMS, LEN, TBL, DCTX, WSN, MSGID);

     58  1 000000   000000 700200 xent  OCI$MK_WRTM  TSX0  ! X66_AUTO_N
         1 000001   000106 000010                    ZERO    70,8

       59       59    1   DCL CADDR BIT(18) CALIGNED;
       60       60    1   DCL MSG# UBIN WORD CALIGNED;
       61       61    1   DCL NPARAMS UBIN WORD CALIGNED;
       62       62    1   DCL NPARAMSS REDEF NPARAMS SBIN;
       63       63    1   DCL LEN(0:0) UBIN BYTE CALIGNED;
       64       64    1   DCL TBL(0:0) UBIN BYTE CALIGNED;
       65       65    1   DCL DCTX UBIN WORD CALIGNED;
       66       66    1   DCL WSN CHAR(8) CALIGNED;
       67       67    1   DCL MSGID UBIN HALF CALIGNED;
       68       68        /*  */
       69       69        %INCLUDE B$JIT_C;
PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:16   
       70      383        %B$JIT0;
       71      472        %A$JIT6X;
       72      475        %INCLUDE CP_6_SUBS;
       73     1015        %INCLUDE JG_GHOSTS_C;
       74     1105          %INCLUDE N_FC_C;
       75     1142          %INCLUDE N$REQ;
       76     1216            %N$REQ (STCLASS="BASED(TEMP$)");
       77     1274          %INCLUDE OC_DATA_R;
       78     1283        %INCLUDE OC_SUBS_C;
       79     2014        %INCLUDE OCI_SUBS_C;
       80     2112          %INCLUDE OCI_DATA_R;
       81     2124          %INCLUDE OC$MESSHD_C;
       82     2145            %OC$MESSHD (NAME=OC_MESSHD,STCLASS="");
       83     2159    1         2 MESS CHAR(124) UNAL;
       84     2160          %INCLUDE NK_LDCT_R;
       85     2169          %INCLUDE NK$LDCT;
       86     2271                %NK$LDCT;
       87     2317                                                /**/
       88     2318        %INCLUDE FR$RAT;
       89     2371                                                /**/
       90     2372             %FR$RAT;
       91     2412                                                /**/
       92     2413        %INCLUDE FR_SUBS;
       93     2481                                                /**/
       94     2482        %INCLUDE FM$SET;
       95     2509    1   DCL FM_SYSSETX UBIN WORD SYMREF;
       96     2510    1   DCL F$CFU$ PTR SYMREF;
       97     2511        %JG_GHOSTS(STCLASS=SYMREF);
       98     2549    1   DCL S_TIMR UBIN SYMREF;
       99     2550                                                /**/
      100     2551             %FM$DEV (BASED="BASED(F$CFU$)");
      101     2557                                                /**/
      102     2558             %FM$VOL (BASED="BASED(F$CFU$)");
      103     2564        /*  */
      104     2565                %SUB BAD_DCTX='170311400017'O;
      105     2566        /*  */
      106     2567    1   DCL B$JIT$ PTR SYMREF;
PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:17   
      107     2568    1   DCL SC_OCBADDCTX ENTRY CONV(2,0);
      108     2569    1   DCL NIO$QUE ENTRY(1) ALTRET;
      109     2570    1   DCL NIO$IOSPIN ENTRY(1);
      110     2571    1   DCL NII$LIP ENTRY(1);
      111     2572    1   DCL NIQ$GET ENTRY(1) ALTRET;
      112     2573    1   DCL NIQ$REL ENTRY(1) ALTRET;
      113     2574    1   DCL KUW$WRITE ENTRY(3) ALTRET;
      114     2575    1   DCL I SBIN WORD;
      115     2576    1   DCL SIZE SBIN WORD;
      116     2577    1   DCL TEMP SBIN WORD;
      117     2578    1   DCL TEMP$ PTR;
      118     2579        /*  */
      119     2580    1   DCL CTDVM CHAR(30) CONSTANT INIT('****NNDD IO ERROR 000000000000');
      120     2581    1   DCL 1 TDVM ALIGNED,
      121     2582    1         2 * CHAR(4) UNAL,
      122     2583    1         2 DVNM CHAR(4) UNAL,
      123     2584    1         2 * CHAR(10) UNAL,
      124     2585    1         2 STAT (0:11) UNAL,
      125     2586    1           3 * UBIN(6) UNAL,
      126     2587    1           3 US UBIN(3) UNAL,
      127     2588    1         2 SPAC CHAR(6) UNAL;
      128     2589    1   DCL TDVMC REDEF TDVM CHAR(36) ALIGNED;
      129     2590                                                /**/
      130     2591    1   DCL ARG UBIN WORD BASED;
      131     2592    1   DCL ARG_C CHAR(12) UNAL;
      132     2593                                                /**/
      133     2594    1   DCL DP_I UBIN WORD;
      134     2595    1   DCL DISPLAY_CT SBIN WORD;
      135     2596    1   DCL UB3 (0:11) UBIN(3) UNAL BASED;
      136     2597        /*  */
      137     2598    1   DCL STRING CHAR(TEMP) BASED;
      138     2599        /*
      139     2600                                                               */
      140     2601    1           OC_MESSHD.FCN = 2 /* timed write */;

   2601  1 000002   000002 236007                    LDQ     2,DL
         1 000003   200014 552104                    STBQ    OC_MESSHD+1,'04'O,AUTO
PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:18   

      141     2602    1           MSGID = DCTX;

   2602  1 000004   200010 470500                    LDP0    @DCTX,,AUTO
         1 000005   200012 471500                    LDP1    @MSGID,,AUTO
         1 000006   000100 101500                    MRL     fill='000'O
         1 000007   000000 000004                    ADSC9   0,,PR0                   cn=0,n=4
         1 000010   100000 000002                    ADSC9   0,,PR1                   cn=0,n=2

      142     2603        /*N* For C00 the MSGID parameter should be removed from the call to
      143     2604             OCI$MK_WRTM and NIK$KEYIN should always use the DCT index for
      144     2605             the message id.  This is just a sleasy way to fix it for B02. */
      145     2606    1           OC_MESSHD.MSGID = MSGID;

   2606  1 000011   000100 100500                    MLR     fill='000'O
         1 000012   100000 000002                    ADSC9   0,,PR1                   cn=0,n=2
         1 000013   200014 000002                    ADSC9   OC_MESSHD+1,,AUTO        cn=0,n=2

      146     2607    1           GOTO A;

   2607  1 000014   000027 710000 1                  TRA     A

      147     2608        /*D* NAME: OCI$MK_WR
      148     2609
      149     2610             CALL: CALL OCI$MK_WR (CADDR, MSG#, NPARAMS, LEN, TBL, DCTX, WSN)
      150     2611
      151     2612                   Where the parameters are:
      152     2613
      153     2614                        CADDR BIT(18) UNAL -- console address
      154     2615                        MSG# UBIN WORD UNAL -- message number
      155     2616                        NPARAMS UBIN WORD UNAL -- number of message parameters
      156     2617                        LEN -- an UNALigned string of one-byte message parameter lengths
      157     2618                        TBL -- an UNALigned string of message parameters
      158     2619                        DCTX UBIN WORD UNAL -- DCT index if this message is destined for
      159     2620                                               a device console
      160     2621                        WSN CHAR(8) -- workstation if this message is destined for
      161     2622                                       a workstation
PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:19   
      162     2623
      163     2624                  INTERFACE: KUW$WRITE, SC_OCBADDCTX
      164     2625
      165     2626             ENVIRONMENT: Any
      166     2627
      167     2628             INPUT: None
      168     2629
      169     2630             OUTPUT: None
      170     2631
      171     2632             SCRATCH: None
      172     2633
      173     2634             DESCRIPTION: The passed parameters are used to build a KEYIN
      174     2635                          message header and message parameters.
      175     2636                          WRITE is specified as the function to be performed
      176     2637                          and the message is written to KEYIN via the
      177     2638                          Central System COMGROUP.
      178     2639                                                                                      */
      179     2640    1   OCI$MK_WR: ENTRY (CADDR, MSG#, NPARAMS, LEN, TBL, DCTX, WSN);

   2640  1 000015   000000 700200 xent  OCI$MK_WR    TSX0  ! X66_AUTO_N
         1 000016   000106 000010                    ZERO    70,8

      180     2641    1           OC_MESSHD.FCN = 3 /* write */;

   2641  1 000017   000003 236007                    LDQ     3,DL
         1 000020   200014 552104                    STBQ    OC_MESSHD+1,'04'O,AUTO

      181     2642    1           IF S_TIMR < 2

   2642  1 000021   000000 235000 xsym               LDA     S_TIMR
         1 000022   000002 115007                    CMPA    2,DL
         1 000023   000027 603000 1                  TRC     A

      182     2643    1           THEN
      183     2644    1              OC_MESSHD.SYSID=B$JIT.SYSID;

   2644  1 000024   000000 470400 xsym               LDP0    B$JIT$
PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:20   
         1 000025   000000 720100                    LXL0    0,,PR0
         1 000026   200014 740100                    STX0    OC_MESSHD+1,,AUTO

      184     2645    1   A:
      185     2646    1           IF OCI_BOOT                     /* KEYIN's not up yet                 */

   2646  1 000027   000000 234000 xsym  A            SZN     OCI_BOOT
         1 000030   000365 605000 1                  TPL     s:2727

      186     2647    1           THEN
      187     2648    2           DO;

   2641  1 000031                       SPEC_HAND    null
      188     2649    2   SPEC_HAND: ;              /* Come here from normal, uptime
      189     2650                                                path if the thing has little
      190     2651                                                no probability of being
      191     2652                                                templated */
      192     2653    2              DISPLAY_CT = 1;

   2653  1 000031   000001 235007                    LDA     1,DL
         1 000032   200100 755100                    STA     DISPLAY_CT,,AUTO

      193     2654    2              IF MSG# = 325 /* FILEIC_MSG# */

   2654  1 000033   200004 470500                    LDP0    @MSG#,,AUTO
         1 000034   000100 100500                    MLR     fill='000'O
         1 000035   000000 000004                    ADSC9   0,,PR0                   cn=0,n=4
         1 000036   200102 000004                    ADSC9   DISPLAY_CT+2,,AUTO       cn=0,n=4
         1 000037   200102 236100                    LDQ     DISPLAY_CT+2,,AUTO
         1 000040   000505 116007                    CMPQ    325,DL
         1 000041   000077 601000 1                  TNZ     s:2669

      194     2655    2              THEN
      195     2656    3              DO;

      196     2657    3                 TDVMC = ' *** FILE INCONSISTENCY 00 00 00';

PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:21   
   2657  1 000042   040100 100400                    MLR     fill='040'O
         1 000043   000010 000040 0                  ADSC9   CTDVM+8                  cn=0,n=32
         1 000044   200063 000044                    ADSC9   TDVM,,AUTO               cn=0,n=36

      197     2658    3                 TEMP$ = ADDR(TBL(0));

   2658  1 000045   200007 236100                    LDQ     @TBL,,AUTO
         1 000046   200062 756100                    STQ     TEMP$,,AUTO

      198     2659    3                 TEMP = 24;

   2659  1 000047   000030 235007                    LDA     24,DL
         1 000050   200061 755100                    STA     TEMP,,AUTO

      199     2660    4                 DO I = 0 TO 2;

   2660  1 000051   200057 450100                    STZ     I,,AUTO

      200     2661    4                    CALL BINCHAR (ARG_C, TEMP$ -> ARG);

   2661  1 000052   200062 470500                    LDP0    TEMP$,,AUTO
         1 000053   000000 235100                    LDA     0,,PR0
         1 000054   000044 773000                    LRL     36
         1 000055   200102 757100                    STAQ    DISPLAY_CT+2,,AUTO
         1 000056   000100 301500                    BTD
         1 000057   200102 000010                    NDSC9   DISPLAY_CT+2,,AUTO       cn=0,s=lsgnf,sf=0,n=8
         1 000060   200074 030014                    NDSC9   ARG_C,,AUTO              cn=0,s=nosgn,sf=0,n=12

      201     2662    4                    CALL INSERT (TDVMC, TEMP, 2, SUBSTR(ARG_C,10,2));

   2662  1 000061   200061 235100                    LDA     TEMP,,AUTO
         1 000062   040105 100500                    MLR     fill='040'O
         1 000063   200076 400002                    ADSC9   ARG_C+2,,AUTO            cn=2,n=2
         1 000064   200063 000002                    ADSC9   TDVM,A,AUTO              cn=0,n=2

      202     2663    4                    TEMP = TEMP + 3;

PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:22   
   2663  1 000065   000003 236007                    LDQ     3,DL
         1 000066   200061 056100                    ASQ     TEMP,,AUTO

      203     2664    4                    TEMP$ = PINCRC(TEMP$,4);

   2664  1 000067   200062 236100                    LDQ     TEMP$,,AUTO
         1 000070   000001 036003                    ADLQ    1,DU
         1 000071   200062 756100                    STQ     TEMP$,,AUTO

      204     2665    4                    END;

   2665  1 000072   200057 054100                    AOS     I,,AUTO
         1 000073   200057 235100                    LDA     I,,AUTO
         1 000074   000002 115007                    CMPA    2,DL
         1 000075   000052 604400 1                  TMOZ    s:2661

      205     2666    3                 GOTO MAKE_MSG;

   2666  1 000076   000306 710000 1                  TRA     MAKE_MSG

      206     2667    3                 END;                      /* DO IF FILEIC_MSG#                  */
      207     2668                                                /**/
      208     2669    2              IF MSG# = 21 /* MOUNT_MSG# */

   2669  1 000077   000100 100500                    MLR     fill='000'O
         1 000100   000000 000004                    ADSC9   0,,PR0                   cn=0,n=4
         1 000101   200102 000004                    ADSC9   DISPLAY_CT+2,,AUTO       cn=0,n=4
         1 000102   200102 236100                    LDQ     DISPLAY_CT+2,,AUTO
         1 000103   000025 116007                    CMPQ    21,DL
         1 000104   000137 601000 1                  TNZ     s:2680

      209     2670    2              THEN
      210     2671    3              DO;                                     /* Must be PO reels changing

      211     2672                                                     volumes */
      212     2673    3                 TDVMC = ' *** Mount next PO reel (      )';

PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:23   
   2673  1 000105   040100 100400                    MLR     fill='040'O
         1 000106   000020 000040 0                  ADSC9   CTDVM+16                 cn=0,n=32
         1 000107   200063 000044                    ADSC9   TDVM,,AUTO               cn=0,n=36

      213     2674    4                 DO I = 0 TO LEN(0)-1;

   2674  1 000110   200057 450100                    STZ     I,,AUTO
         1 000111   000127 710000 1                  TRA     s:2676+1

      214     2675    4                    CALL INSERT (TDVMC, 25 + I, 1, BINASC(TBL(I)));

   2675  1 000112   200007 470500                    LDP0    @TBL,,AUTO
         1 000113   200057 235100                    LDA     I,,AUTO
         1 000114   000100 101505                    MRL     fill='000'O
         1 000115   000000 000001                    ADSC9   0,A,PR0                  cn=0,n=1
         1 000116   200102 000004                    ADSC9   DISPLAY_CT+2,,AUTO       cn=0,n=4
         1 000117   200102 236100                    LDQ     DISPLAY_CT+2,,AUTO
         1 000120   000033 736000                    QLS     27
         1 000121   000000 276000 2                  ORQ     0
         1 000122   200103 756100                    STQ     DISPLAY_CT+3,,AUTO
         1 000123   040105 100500                    MLR     fill='040'O
         1 000124   200103 000004                    ADSC9   DISPLAY_CT+3,,AUTO       cn=0,n=4
         1 000125   200071 200001                    ADSC9   TDVM+6,A,AUTO            cn=1,n=1

      215     2676    4                    END;                   /* DO MOVE                            */

   2676  1 000126   200057 054100                    AOS     I,,AUTO
         1 000127   200006 470500                    LDP0    @LEN,,AUTO
         1 000130   000100 101500                    MRL     fill='000'O
         1 000131   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
         1 000132   200102 000004                    ADSC9   DISPLAY_CT+2,,AUTO       cn=0,n=4
         1 000133   200102 236100                    LDQ     DISPLAY_CT+2,,AUTO
         1 000134   200057 116100                    CMPQ    I,,AUTO
         1 000135   000112 605400 1                  TPNZ    s:2675

      216     2677    3                 GOTO MAKE_MSG;

PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:24   
   2677  1 000136   000306 710000 1                  TRA     MAKE_MSG

      217     2678    3                 END;                      /* DO IF PO CVOL                      */
      218     2679                                                /**/
      219     2680    2              IF MSG# < 140 /* MINIO_MSG# */

   2680  1 000137   000100 100500                    MLR     fill='000'O
         1 000140   000000 000004                    ADSC9   0,,PR0                   cn=0,n=4
         1 000141   200102 000004                    ADSC9   DISPLAY_CT+2,,AUTO       cn=0,n=4
         1 000142   200102 236100                    LDQ     DISPLAY_CT+2,,AUTO
         1 000143   000214 116007                    CMPQ    140,DL
         1 000144   000153 602000 1                  TNC     s:2684
         1 000145   000100 100500                    MLR     fill='000'O
         1 000146   000000 000004                    ADSC9   0,,PR0                   cn=0,n=4
         1 000147   200103 000004                    ADSC9   DISPLAY_CT+3,,AUTO       cn=0,n=4
         1 000150   200103 236100                    LDQ     DISPLAY_CT+3,,AUTO
         1 000151   000253 116007                    CMPQ    171,DL
         1 000152   000154 602000 1                  TNC     s:2685

      220     2681    2                OR
      221     2682    2                MSG# > 170 /* KIILGL_MSG# */
      222     2683    2              THEN
      223     2684    2                 RETURN;

   2684  1 000153   000000 702200 xent               TSX2  ! X66_ARET

      224     2685    2              IF MSG# = 149 /* FWL_MSG# */

   2685  1 000154   000100 100500                    MLR     fill='000'O
         1 000155   000000 000004                    ADSC9   0,,PR0                   cn=0,n=4
         1 000156   200102 000004                    ADSC9   DISPLAY_CT+2,,AUTO       cn=0,n=4
         1 000157   200102 236100                    LDQ     DISPLAY_CT+2,,AUTO
         1 000160   000225 116007                    CMPQ    149,DL
         1 000161   000200 601000 1                  TNZ     s:2694

      225     2686    2              THEN
      226     2687    3              DO;
PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:25   

      227     2688    3                 TDVMC = '  !!NNDD firmware loaded.';

   2688  1 000162   040100 100400                    MLR     fill='040'O
         1 000163   000030 000031 0                  ADSC9   CTDVM+24                 cn=0,n=25
         1 000164   200063 000044                    ADSC9   TDVM,,AUTO               cn=0,n=36

      228     2689    3                 IF TBL(0) ~= 0

   2689  1 000165   200007 471500                    LDP1    @TBL,,AUTO
         1 000166   000100 101500                    MRL     fill='000'O
         1 000167   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
         1 000170   200102 000004                    ADSC9   DISPLAY_CT+2,,AUTO       cn=0,n=4
         1 000171   200102 236100                    LDQ     DISPLAY_CT+2,,AUTO
         1 000172   000000 116003                    CMPQ    0,DU
         1 000173   000275 600000 1                  TZE     s:2708

      229     2690    3                 THEN
      230     2691    3                    CALL INSERT(TDVMC,22,,' failed.');

   2691  1 000174   040100 100400                    MLR     fill='040'O
         1 000175   000037 000010 0                  ADSC9   CTDVM+31                 cn=0,n=8
         1 000176   200070 400016                    ADSC9   TDVM+5,,AUTO             cn=2,n=14

      231     2692    3                 END;

   2692  1 000177   000275 710000 1                  TRA     s:2708

      232     2693    2              ELSE
      233     2694    2                 IF MSG# = 170 /* KIILGL_MSG# */

   2694  1 000200   000100 100500                    MLR     fill='000'O
         1 000201   000000 000004                    ADSC9   0,,PR0                   cn=0,n=4
         1 000202   200102 000004                    ADSC9   DISPLAY_CT+2,,AUTO       cn=0,n=4
         1 000203   200102 236100                    LDQ     DISPLAY_CT+2,,AUTO
         1 000204   000252 116007                    CMPQ    170,DL
         1 000205   000212 601000 1                  TNZ     s:2699
PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:26   

      234     2695    2                 THEN
      235     2696    2                    TDVMC = '  !!NNDD Illegal keyin.';

   2696  1 000206   040100 100400                    MLR     fill='040'O
         1 000207   000041 000027 0                  ADSC9   CTDVM+33                 cn=0,n=23
         1 000210   200063 000044                    ADSC9   TDVM,,AUTO               cn=0,n=36
         1 000211   000275 710000 1                  TRA     s:2708

      236     2697    2                 ELSE
      237     2698    3                 DO;

      238     2699    3                    TDVMC=CTDVM;

   2699  1 000212   040100 100400                    MLR     fill='040'O
         1 000213   000000 000036 0                  ADSC9   CTDVM                    cn=0,n=30
         1 000214   200063 000044                    ADSC9   TDVM,,AUTO               cn=0,n=36

      239     2700    3                    DISPLAY_CT = 2;

   2700  1 000215   000002 235007                    LDA     2,DL
         1 000216   200100 755100                    STA     DISPLAY_CT,,AUTO

      240     2701    3                    TEMP$=PINCRC(ADDR(TBL),LEN(0));

   2701  1 000217   200006 471500                    LDP1    @LEN,,AUTO
         1 000220   000100 101500                    MRL     fill='000'O
         1 000221   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
         1 000222   200102 000004                    ADSC9   DISPLAY_CT+2,,AUTO       cn=0,n=4
         1 000223   200102 236100                    LDQ     DISPLAY_CT+2,,AUTO
         1 000224   000020 736000                    QLS     16
         1 000225   200007 036100                    ADLQ    @TBL,,AUTO
         1 000226   200062 756100                    STQ     TEMP$,,AUTO

      241     2702    3                    IF LEN(1)>=4 THEN TEMP=11;

   2702  1 000227   000100 101500                    MRL     fill='000'O
PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:27   
         1 000230   100000 200001                    ADSC9   0,,PR1                   cn=1,n=1
         1 000231   200102 000004                    ADSC9   DISPLAY_CT+2,,AUTO       cn=0,n=4
         1 000232   200102 236100                    LDQ     DISPLAY_CT+2,,AUTO
         1 000233   000004 116007                    CMPQ    4,DL
         1 000234   000240 604000 1                  TMI     s:2703

   2702  1 000235   000013 236007                    LDQ     11,DL
         1 000236   200061 756100                    STQ     TEMP,,AUTO
         1 000237   000247 710000 1                  TRA     s:2704

      242     2703    3                    ELSE TEMP=(LEN(1)*3)-1;

   2703  1 000240   000100 101500                    MRL     fill='000'O
         1 000241   100000 200001                    ADSC9   0,,PR1                   cn=1,n=1
         1 000242   200102 000004                    ADSC9   DISPLAY_CT+2,,AUTO       cn=0,n=4
         1 000243   200102 236100                    LDQ     DISPLAY_CT+2,,AUTO
         1 000244   000003 402007                    MPY     3,DL
         1 000245   000001 136007                    SBLQ    1,DL
         1 000246   200061 756100                    STQ     TEMP,,AUTO

      243     2704    4                    DO I=0 TO TEMP;

   2704  1 000247   200057 450100                    STZ     I,,AUTO
         1 000250   000272 710000 1                  TRA     s:2706+1

      244     2705    4                       TDVM.STAT.US(I)=TEMP$->UB3(I);

   2705  1 000251   200057 236100                    LDQ     I,,AUTO
         1 000252   000003 402007                    MPY     3,DL
         1 000253   000000 116003                    CMPQ    0,DU
         1 000254   000256 605000 1                  TPL     s:2705+5
         1 000255   000044 036003                    ADLQ    36,DU
         1 000256   200102 756100                    STQ     DISPLAY_CT+2,,AUTO
         1 000257   200057 236100                    LDQ     I,,AUTO
         1 000260   000011 402007                    MPY     9,DL
         1 000261   000000 116003                    CMPQ    0,DU
         1 000262   000264 605000 1                  TPL     s:2705+11
PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:28   
         1 000263   000044 036003                    ADLQ    36,DU
         1 000264   200062 470500                    LDP0    TEMP$,,AUTO
         1 000265   200102 235100                    LDA     DISPLAY_CT+2,,AUTO
         1 000266   003106 060505                    CSL     bolr='003'O
         1 000267   000000 000003                    BDSC    0,A,PR0                  by=0,bit=0,n=3
         1 000270   200067 460003                    BDSC    TDVM+4,Q,AUTO            by=2,bit=6,n=3

      245     2706    4                       END;

   2706  1 000271   200057 054100                    AOS     I,,AUTO
         1 000272   200057 236100                    LDQ     I,,AUTO
         1 000273   200061 116100                    CMPQ    TEMP,,AUTO
         1 000274   000251 604400 1                  TMOZ    s:2705

      246     2707    3                    END;                   /* IF MSG#=FWL_MSG# ELSE              */

      247     2708    2              TDVM.DVNM = NK$LDCT$(DCTX)->NK$LDCT.DEVNM;

   2708  1 000275   200010 470500                    LDP0    @DCTX,,AUTO
         1 000276   000100 101500                    MRL     fill='000'O
         1 000277   000000 000004                    ADSC9   0,,PR0                   cn=0,n=4
         1 000300   200102 000002                    ADSC9   DISPLAY_CT+2,,AUTO       cn=0,n=2
         1 000301   200102 220100                    LDX0    DISPLAY_CT+2,,AUTO
         1 000302   000000 471400 xsym               LDP1    N$DCT$$
         1 000303   100000 473510                    LDP3    0,X0,PR1
         1 000304   300002 236100                    LDQ     2,,PR3
         1 000305   200064 756100                    STQ     TDVM+1,,AUTO

   2708  1 000306                       MAKE_MSG     null
      248     2709    2   MAKE_MSG:  ;
      249     2710    2              CALL NIQ$GET(TEMP$) ALTRET (NOQ);

   2710  1 000306   200062 630500                    EPPR0   TEMP$,,AUTO
         1 000307   200102 450500                    STP0    DISPLAY_CT+2,,AUTO
         1 000310   200102 630500                    EPPR0   DISPLAY_CT+2,,AUTO
         1 000311   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000312   000000 701000 xent               TSX1    NIQ$GET
PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:29   
         1 000313   000364 702000 1                  TSX2    NOQ

      250     2711    2              N$REQ.DLA.DCTX = B_SCDCTX;   /* DCT index of elephant              */

   2711  1 000314   200062 470500                    LDP0    TEMP$,,AUTO
         1 000315   000000 236000 xsym               LDQ     B_SCDCTX
         1 000316   000025 736000                    QLS     21
         1 000317   000001 676100                    ERQ     1,,PR0
         1 000320   777770 376003                    ANQ     -8,DU
         1 000321   000001 656100                    ERSQ    1,,PR0

      251     2712    2              N$REQ.OPFLG = '010'O | '004'O;

   2712  1 000322   200062 470500                    LDP0    TEMP$,,AUTO
         1 000323   000014 236007                    LDQ     12,DL
         1 000324   000004 552104                    STBQ    4,'04'O,PR0

      252     2713    2              N$REQ.BUF$ = ADDR (TDVM);    /* buffer address                     */

   2713  1 000325   200063 630500                    EPPR0   TDVM,,AUTO
         1 000326   200062 471500                    LDP1    TEMP$,,AUTO
         1 000327   100005 450500                    STP0    5,,PR1

      253     2714    2              N$REQ.BUFSIZE = SIZEC(TDVM); /* buffer size                        */

   2714  1 000330   200062 470500                    LDP0    TEMP$,,AUTO
         1 000331   000004 236100                    LDQ     4,,PR0
         1 000332   177777 376007                    ANQ     65535,DL
         1 000333   000011 276003                    ORQ     9,DU
         1 000334   000004 756100                    STQ     4,,PR0

      254     2715    2              N$REQ.FC = %N_WRITE;         /* write with CR/LF                   */

   2715  1 000335   200062 470500                    LDP0    TEMP$,,AUTO
         1 000336   000015 236007                    LDQ     13,DL
         1 000337   000003 552104                    STBQ    3,'04'O,PR0

PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:30   
      255     2716    3              DO I = 0 TO (DISPLAY_CT-1);

   2716  1 000340   200057 450100                    STZ     I,,AUTO
         1 000341   000353 710000 1                  TRA     s:2721+1

      256     2717    3                 CALL NIO$QUE (N$REQ) ALTRET (RELQ);

   2717  1 000342   200062 630500                    EPPR0   TEMP$,,AUTO
         1 000343   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000344   000000 701000 xent               TSX1    NIO$QUE
         1 000345   000356 702000 1                  TSX2    RELQ

      257     2718                                                /* Attempt to wait for the
      258     2719                                                     I/O to complete. */
      259     2720    3                 CALL NIO$IOSPIN(N$REQ);

   2720  1 000346   200062 630500                    EPPR0   TEMP$,,AUTO
         1 000347   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000350   000000 701000 xent               TSX1    NIO$IOSPIN
         1 000351   000000 011000                    NOP     0

      260     2721    3                 END;

   2721  1 000352   200057 054100                    AOS     I,,AUTO
         1 000353   200057 236100                    LDQ     I,,AUTO
         1 000354   200100 116100                    CMPQ    DISPLAY_CT,,AUTO
         1 000355   000342 604000 1                  TMI     s:2717

   2717  1 000356                       RELQ         null
      261     2722    2   RELQ:      ;
      262     2723    2              CALL NIQ$REL(TEMP$);

   2723  1 000356   200062 630500                    EPPR0   TEMP$,,AUTO
         1 000357   200102 450500                    STP0    DISPLAY_CT+2,,AUTO
         1 000360   200102 630500                    EPPR0   DISPLAY_CT+2,,AUTO
         1 000361   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000362   000000 701000 xent               TSX1    NIQ$REL
PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:31   
         1 000363   000000 011000                    NOP     0

   2717  1 000364                       NOQ          null
      263     2724    2   NOQ:       ;
      264     2725    2              RETURN;

   2725  1 000364   000000 702200 xent               TSX2  ! X66_ARET

      265     2726    2              END;
      266     2727    1           OC_MESSHD.CADDR = CADDR;

   2727  1 000365   200003 470500                    LDP0    @CADDR,,AUTO
         1 000366   000100 100500                    MLR     fill='000'O
         1 000367   000000 000002                    ADSC9   0,,PR0                   cn=0,n=2
         1 000370   200013 000002                    ADSC9   OC_MESSHD,,AUTO          cn=0,n=2

      267     2728    1           OC_MESSHD.MSG# = MSG#;

   2728  1 000371   200004 471500                    LDP1    @MSG#,,AUTO
         1 000372   000100 101500                    MRL     fill='000'O
         1 000373   100000 000004                    ADSC9   0,,PR1                   cn=0,n=4
         1 000374   200013 400002                    ADSC9   OC_MESSHD,,AUTO          cn=2,n=2

      268     2729                                                /**/
      269     2730                                           /* If a DCT index was passed
      270     2731                                              instead of a WSN, blank out
      271     2732                                              the WSN and assign the
      272     2733                                              TWSN in the next section. */
      273     2734                                                /**/
      274     2735    1           IF (ADDR (WSN) ~= ADDR (NIL))

   2735  1 000375   200011 236100                    LDQ     @WSN,,AUTO
         1 000376   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000377   000405 600000 1                  TZE     s:2739

      275     2736    1           THEN
      276     2737    1              OC_MESSHD.WSN = WSN;
PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:32   

   2737  1 000400   200011 473500                    LDP3    @WSN,,AUTO
         1 000401   040100 100500                    MLR     fill='040'O
         1 000402   300000 000010                    ADSC9   0,,PR3                   cn=0,n=8
         1 000403   200016 000010                    ADSC9   OC_MESSHD+3,,AUTO        cn=0,n=8
         1 000404   000410 710000 1                  TRA     s:2741

      277     2738    1           ELSE
      278     2739    1              OC_MESSHD.WSN = ' ';

   2739  1 000405   000035 235000 xsym               LDA     B_VECTNIL+29
         1 000406   000035 236000 xsym               LDQ     B_VECTNIL+29
         1 000407   200016 757100                    STAQ    OC_MESSHD+3,,AUTO

      279     2740                                                /**/
      280     2741    1           IF (ADDR (DCTX) ~= ADDR (NIL)) THEN

   2741  1 000410   200010 236100                    LDQ     @DCTX,,AUTO
         1 000411   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000412   000536 600000 1                  TZE     s:2778

      281     2742    2           DO;

      282     2743                                                /**/
      283     2744    2              IF DCTX > NK_MXTOTAL

   2744  1 000413   200010 473500                    LDP3    @DCTX,,AUTO
         1 000414   000100 100500                    MLR     fill='000'O
         1 000415   300000 000004                    ADSC9   0,,PR3                   cn=0,n=4
         1 000416   200102 000004                    ADSC9   DISPLAY_CT+2,,AUTO       cn=0,n=4
         1 000417   200102 236100                    LDQ     DISPLAY_CT+2,,AUTO
         1 000420   000000 116000 xsym               CMPQ    NK_MXTOTAL
         1 000421   000425 602000 1                  TNC     s:2748
         1 000422   000425 600000 1                  TZE     s:2748

      284     2745    2              THEN
      285     2746    2                 CALL SC_OCBADDCTX;
PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:33   

   2746  1 000423   000000 713400 xsym               CLIMB   SC_OCBADDCTX
         1 000424   000000 600000 xsid               climb   nvectors=         0

      286     2747                                                /**/
      287     2748    2              IF NK$LDCT$(DCTX) = ADDR(NIL)

   2748  1 000425   200010 470500                    LDP0    @DCTX,,AUTO
         1 000426   000100 101500                    MRL     fill='000'O
         1 000427   000000 000004                    ADSC9   0,,PR0                   cn=0,n=4
         1 000430   200102 000002                    ADSC9   DISPLAY_CT+2,,AUTO       cn=0,n=2
         1 000431   200102 220100                    LDX0    DISPLAY_CT+2,,AUTO
         1 000432   000000 471400 xsym               LDP1    N$DCT$$
         1 000433   100000 236110                    LDQ     0,X0,PR1
         1 000434   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000435   000440 601000 1                  TNZ     s:2752

      288     2749    2              THEN
      289     2750    2                 CALL SC_OCBADDCTX;

   2750  1 000436   000000 713400 xsym               CLIMB   SC_OCBADDCTX
         1 000437   000000 600000 xsid               climb   nvectors=         0

      290     2751                                                /**/
      291     2752    2              OC_MESSHD.DEVNM = NK$LDCT$(DCTX) -> NK$LDCT.DEVNM;

   2752  1 000440   200010 470500                    LDP0    @DCTX,,AUTO
         1 000441   000100 101500                    MRL     fill='000'O
         1 000442   000000 000004                    ADSC9   0,,PR0                   cn=0,n=4
         1 000443   200102 000002                    ADSC9   DISPLAY_CT+2,,AUTO       cn=0,n=2
         1 000444   200102 220100                    LDX0    DISPLAY_CT+2,,AUTO
         1 000445   000000 471400 xsym               LDP1    N$DCT$$
         1 000446   100000 473510                    LDP3    0,X0,PR1
         1 000447   300002 237100                    LDAQ    2,,PR3
         1 000450   200016 757100                    STAQ    OC_MESSHD+3,,AUTO

      292     2753                                           /* Check here for the "SYSTEM" pack
PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:34   
      293     2754                                                set to bypass normal error
      294     2755                                                message processing (via KEYIN)
      295     2756                                                and handle it with IOQ */
      296     2757    2              IF NK$LDCT$ (DCTX) -> NK$LDCT.RAT$ ~= ADDR(NIL)

   2757  1 000451   000100 101500                    MRL     fill='000'O
         1 000452   000000 000004                    ADSC9   0,,PR0                   cn=0,n=4
         1 000453   200102 000002                    ADSC9   DISPLAY_CT+2,,AUTO       cn=0,n=2
         1 000454   200102 220100                    LDX0    DISPLAY_CT+2,,AUTO
         1 000455   100000 473510                    LDP3    0,X0,PR1
         1 000456   300005 236100                    LDQ     5,,PR3
         1 000457   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000460   000536 600000 1                  TZE     s:2778

      297     2758    2              THEN
      298     2759    3              DO;

      299     2760    3                 TEMP$ = NK$LDCT$ (DCTX) -> NK$LDCT.RAT$;

   2760  1 000461   000100 101500                    MRL     fill='000'O
         1 000462   000000 000004                    ADSC9   0,,PR0                   cn=0,n=4
         1 000463   200102 000002                    ADSC9   DISPLAY_CT+2,,AUTO       cn=0,n=2
         1 000464   200102 220100                    LDX0    DISPLAY_CT+2,,AUTO
         1 000465   100000 473510                    LDP3    0,X0,PR1
         1 000466   300005 236100                    LDQ     5,,PR3
         1 000467   200062 756100                    STQ     TEMP$,,AUTO

      300     2761    3                 IF (TEMP$ -> FR$RAT.RCOD = 0 /*FR_DP*/)

   2761  1 000470   200062 473500                    LDP3    TEMP$,,AUTO
         1 000471   300003 236100                    LDQ     3,,PR3
         1 000472   000740 316003                    CANQ    480,DU
         1 000473   000536 601000 1                  TNZ     s:2778
         1 000474   200004 474500                    LDP4    @MSG#,,AUTO
         1 000475   000100 100500                    MLR     fill='000'O
         1 000476   400000 000004                    ADSC9   0,,PR4                   cn=0,n=4
         1 000477   200102 000004                    ADSC9   DISPLAY_CT+2,,AUTO       cn=0,n=4
PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:35   
         1 000500   200102 236100                    LDQ     DISPLAY_CT+2,,AUTO
         1 000501   000214 116007                    CMPQ    140,DL
         1 000502   000536 602000 1                  TNC     s:2778
         1 000503   000100 100500                    MLR     fill='000'O
         1 000504   400000 000004                    ADSC9   0,,PR4                   cn=0,n=4
         1 000505   200103 000004                    ADSC9   DISPLAY_CT+3,,AUTO       cn=0,n=4
         1 000506   200103 236100                    LDQ     DISPLAY_CT+3,,AUTO
         1 000507   000225 116007                    CMPQ    149,DL
         1 000510   000536 603000 1                  TRC     s:2778

      301     2762    3                   AND
      302     2763    3                   (MSG# >= 140 /* MINIO_MSG# */ AND MSG# <= 148 /* MAXIO_MSG# */)
      303     2764    3                 THEN
      304     2765    4                 DO;

      305     2766    4                    DP_I = FM$DEV.SECTL (DCTX);

   2766  1 000511   000100 100500                    MLR     fill='000'O
         1 000512   000000 000004                    ADSC9   0,,PR0                   cn=0,n=4
         1 000513   200102 000004                    ADSC9   DISPLAY_CT+2,,AUTO       cn=0,n=4
         1 000514   200102 236100                    LDQ     DISPLAY_CT+2,,AUTO
         1 000515   000003 736000                    QLS     3
         1 000516   000000 475400 xsym               LDP5    F$CFU$
         1 000517   500005 236106                    LDQ     5,QL,PR5
         1 000520   777777 376007                    ANQ     -1,DL
         1 000521   200077 756100                    STQ     DP_I,,AUTO

      306     2767    5                    DO WHILE (DP_I ~= 0);

   2767  1 000522   000536 600000 1                  TZE     s:2778

      307     2768    5                       IF FM$VOL.SETX (DP_I) = FM_SYSSETX

   2768  1 000523   200077 235100                    LDA     DP_I,,AUTO
         1 000524   000003 735000                    ALS     3
         1 000525   000000 470400 xsym               LDP0    F$CFU$
         1 000526   000000 236105                    LDQ     0,AL,PR0
PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:36   
         1 000527   777777 376007                    ANQ     -1,DL
         1 000530   000000 116000 xsym               CMPQ    FM_SYSSETX
         1 000531   000031 600000 1                  TZE     SPEC_HAND

      308     2769    5                       THEN
      309     2770    5                          GOTO SPEC_HAND;
      310     2771    5                       DP_I = FM$VOL.SECTL (DP_I);

   2771  1 000532   000005 236105                    LDQ     5,AL,PR0
         1 000533   777777 376007                    ANQ     -1,DL
         1 000534   200077 756100                    STQ     DP_I,,AUTO

      311     2772    5                       END;

   2772  1 000535   000523 601000 1                  TNZ     s:2768

      312     2773    4                    END;

      313     2774    3                 END;                      /* DO IF RAT$ ~ NIL                   */

      314     2775                                                /**/
      315     2776    2              END;

      316     2777                                                /**/
      317     2778    1           SIZE = 0;

   2778  1 000536   200060 450100                    STZ     SIZE,,AUTO

      318     2779    1           TEMP$ = ADDR (OC_MESSHD.MESS);

   2779  1 000537   200020 630500                    EPPR0   OC_MESSHD+5,,AUTO
         1 000540   200062 450500                    STP0    TEMP$,,AUTO

      319     2780    1           TEMP = NPARAMS;

   2780  1 000541   200005 471500                    LDP1    @NPARAMS,,AUTO
         1 000542   000100 100500                    MLR     fill='000'O
PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:37   
         1 000543   100000 000004                    ADSC9   0,,PR1                   cn=0,n=4
         1 000544   200061 000004                    ADSC9   TEMP,,AUTO               cn=0,n=4

      320     2781    2           DO I = 0 TO (NPARAMSS - 1);

   2781  1 000545   200057 450100                    STZ     I,,AUTO
         1 000546   000576 710000 1                  TRA     s:2789+1

      321     2782    2              SIZE = SIZE + LEN(I) + 1;

   2782  1 000547   200006 470500                    LDP0    @LEN,,AUTO
         1 000550   200057 235100                    LDA     I,,AUTO
         1 000551   000100 101505                    MRL     fill='000'O
         1 000552   000000 000001                    ADSC9   0,A,PR0                  cn=0,n=1
         1 000553   200102 000004                    ADSC9   DISPLAY_CT+2,,AUTO       cn=0,n=4
         1 000554   200102 236100                    LDQ     DISPLAY_CT+2,,AUTO
         1 000555   200060 036100                    ADLQ    SIZE,,AUTO
         1 000556   000001 036007                    ADLQ    1,DL
         1 000557   200060 756100                    STQ     SIZE,,AUTO

      322     2783    2              IF SIZE > SIZEC (OC_MESSHD.MESS) THEN

   2783  1 000560   000174 116007                    CMPQ    124,DL
         1 000561   000575 604400 1                  TMOZ    s:2789

      323     2784    3              DO;

      324     2785    3                 TEMP = I;

   2785  1 000562   200061 755100                    STA     TEMP,,AUTO

      325     2786    3                 SIZE = SIZE - LEN(I) - 1;

   2786  1 000563   000100 101505                    MRL     fill='000'O
         1 000564   000000 000001                    ADSC9   0,A,PR0                  cn=0,n=1
         1 000565   200102 000004                    ADSC9   DISPLAY_CT+2,,AUTO       cn=0,n=4
         1 000566   200102 136100                    SBLQ    DISPLAY_CT+2,,AUTO
PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:38   
         1 000567   000001 136007                    SBLQ    1,DL
         1 000570   200060 756100                    STQ     SIZE,,AUTO

      326     2787    3                 I = NPARAMS;              /* To exit loop                       */

   2787  1 000571   200005 471500                    LDP1    @NPARAMS,,AUTO
         1 000572   000100 100500                    MLR     fill='000'O
         1 000573   100000 000004                    ADSC9   0,,PR1                   cn=0,n=4
         1 000574   200057 000004                    ADSC9   I,,AUTO                  cn=0,n=4

      327     2788    3                 END;

      328     2789    2              END;

   2789  1 000575   200057 054100                    AOS     I,,AUTO
         1 000576   200005 470500                    LDP0    @NPARAMS,,AUTO
         1 000577   200057 236100                    LDQ     I,,AUTO
         1 000600   000000 116100                    CMPQ    0,,PR0
         1 000601   000547 604000 1                  TMI     s:2782

      329     2790    1           SIZE = SIZE - TEMP;             /* Calculate size of data             */

   2790  1 000602   200060 236100                    LDQ     SIZE,,AUTO
         1 000603   200061 136100                    SBLQ    TEMP,,AUTO
         1 000604   200060 756100                    STQ     SIZE,,AUTO

      330     2791    1           IF SIZE ~= 0 THEN

   2791  1 000605   000635 600000 1                  TZE     s:2800

      331     2792    2           DO;

      332     2793    2              OC_MESSHD.NPARAMS = TEMP;

   2793  1 000606   200061 236100                    LDQ     TEMP,,AUTO
         1 000607   000011 736000                    QLS     9
         1 000610   200014 552110                    STBQ    OC_MESSHD+1,'10'O,AUTO
PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:39   

      333     2794    2              TEMP$ -> STRING = ADDR (LEN) -> STRING;

   2794  1 000611   200006 471500                    LDP1    @LEN,,AUTO
         1 000612   200061 720100                    LXL0    TEMP,,AUTO
         1 000613   200062 473500                    LDP3    TEMP$,,AUTO
         1 000614   040140 100540                    MLR     fill='040'O
         1 000615   100000 000010                    ADSC9   0,,PR1                   cn=0,n=*X0
         1 000616   300000 000010                    ADSC9   0,,PR3                   cn=0,n=*X0

      334     2795    2              TEMP$ = PINCRC (TEMP$, TEMP);

   2795  1 000617   200061 236100                    LDQ     TEMP,,AUTO
         1 000620   000020 736000                    QLS     16
         1 000621   200062 036100                    ADLQ    TEMP$,,AUTO
         1 000622   200062 756100                    STQ     TEMP$,,AUTO

      335     2796    2              TEMP = SIZE;

   2796  1 000623   200060 235100                    LDA     SIZE,,AUTO
         1 000624   200061 755100                    STA     TEMP,,AUTO

      336     2797    2              TEMP$ -> STRING = ADDR (TBL) -> STRING;

   2797  1 000625   200007 473500                    LDP3    @TBL,,AUTO
         1 000626   000000 620005                    EAX0    0,AL
         1 000627   200062 474500                    LDP4    TEMP$,,AUTO
         1 000630   200061 721100                    LXL1    TEMP,,AUTO
         1 000631   040140 100540                    MLR     fill='040'O
         1 000632   300000 000010                    ADSC9   0,,PR3                   cn=0,n=*X0
         1 000633   400000 000011                    ADSC9   0,,PR4                   cn=0,n=*X1

      337     2798    2              END;

   2798  1 000634   000637 710000 1                  TRA     s:2801

      338     2799    1           ELSE
PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:40   
      339     2800    1              OC_MESSHD.NPARAMS = 0;

   2800  1 000635   000000 236003                    LDQ     0,DU
         1 000636   200014 552110                    STBQ    OC_MESSHD+1,'10'O,AUTO

      340     2801    1           SIZE = OC_MESSHD.NPARAMS + SIZE +

   2801  1 000637   200014 236100                    LDQ     OC_MESSHD+1,,AUTO
         1 000640   000011 772000                    QRL     9
         1 000641   000777 376007                    ANQ     511,DL
         1 000642   200060 036100                    ADLQ    SIZE,,AUTO
         1 000643   000024 036007                    ADLQ    20,DL
         1 000644   200060 756100                    STQ     SIZE,,AUTO

      341     2802    1             20 /* SIZEC_OC_MESSHD# */;
      342     2803    1           CALL KUW$WRITE (OC_MESSHD, SIZE, J_KEYIN ); /* Write message to KEYIN */

   2803  1 000645   000001 236000 2                  LDQ     1
         1 000646   200104 756100                    STQ     DISPLAY_CT+4,,AUTO
         1 000647   200060 631500                    EPPR1   SIZE,,AUTO
         1 000650   200103 451500                    STP1    DISPLAY_CT+3,,AUTO
         1 000651   200013 633500                    EPPR3   OC_MESSHD,,AUTO
         1 000652   200102 453500                    STP3    DISPLAY_CT+2,,AUTO
         1 000653   200102 630500                    EPPR0   DISPLAY_CT+2,,AUTO
         1 000654   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000655   000000 701000 xent               TSX1    KUW$WRITE
         1 000656   000000 011000                    NOP     0

      343     2804    1           RETURN;

   2804  1 000657   000000 702200 xent               TSX2  ! X66_ARET

CTDVM
 Sect OctLoc
   0     000   052052 052052   116116 104104   040111 117040   105122 122117    ****NNDD IO ERRO
   0     004   122040 060060   060060 060060   060060 060060   060060 ******    R 000000000000..

PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:41   
(unnamed)
 Sect OctLoc
   0     010   040052 052052   040106 111114   105040 111116   103117 116123     *** FILE INCONS
   0     014   111123 124105   116103 131040   060060 040060   060040 060060    ISTENCY 00 00 00
   0     020   040052 052052   040115 157165   156164 040156   145170 164040     *** Mount next
   0     024   120117 040162   145145 154040   050040 040040   040040 040051    PO reel (      )
   0     030   040040 041041   116116 104104   040146 151162   155167 141162      !!NNDD firmwar
   0     034   145040 154157   141144 145144   056040 040040   040146 141151    e loaded.    fai
   0     040   154145 144056   040040 041041   116116 104104   040111 154154    led.  !!NNDD Ill
   0     044   145147 141154   040153 145171   151156 056040                    egal keyin.

(unnamed)
 Sect OctLoc
   2     000   000040 040040   000000 006000                                    .   ....
      344     2805    1   END OCI$MK_WRTM;
      345     2806        %EOD;

PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:42   
--  Include file information  --

   FM$SET.:E05TOU  is referenced.
   FR_SUBS.:E05TOU  is referenced.
   FR$RAT.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   OC$MESSHD_C.:E05TOU  is referenced.
   OCI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   OCI_SUBS_C.:E05TOU  is referenced.
   OC_SUBS_C.:E05TOU  is referenced.
   OC_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   N$REQ.:E05TOU  is referenced.
   N_FC_C.:E05TOU  is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
      No diagnostics issued in procedure OCI$MK_WRTM.
PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:43   

 **** Variables and constants ****

  ****  Section 000 RoData OCI$MK_WRTM

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c CHAR(30)    r     1 CTDVM

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @CADDR                    10-0-0/w PTR         r     1 @DCTX
     6-0-0/w PTR         r     1 @LEN                       4-0-0/w PTR         r     1 @MSG#
    12-0-0/w PTR         r     1 @MSGID                     5-0-0/w PTR         r     1 @NPARAMS
     7-0-0/w PTR         r     1 @TBL                      11-0-0/w PTR         r     1 @WSN
    74-0-0/c CHAR(12)    r     1 ARG_C                     *0-0-0/c BIT (18)    r     1 CADDR
    *0-0-0/c UBIN        r     1 DCTX                     100-0-0/w SBIN        r     1 DISPLAY_CT
    77-0-0/w UBIN        r     1 DP_I                      57-0-0/w SBIN        r     1 I
    *0-0-0/c UBIN(9)     r     1 LEN(0:0)                  *0-0-0/c UBIN        r     1 MSG#
    *0-0-0/c UBIN(18)    r     1 MSGID                     *0-0-0/c UBIN        r     1 NPARAMS
    *0-0-0/w SBIN        r     1 NPARAMSS                  13-0-0/c STRC(1296)  r     1 OC_MESSHD
    60-0-0/w SBIN        r     1 SIZE                      *0-0-0/c UBIN(9)     r     1 TBL(0:0)
    63-0-0/w STRC(324)   r     1 TDVM                      63-0-0/w CHAR        r     1 TDVMC
    61-0-0/w SBIN        r     1 TEMP                      62-0-0/w PTR         r     1 TEMP$
    *0-0-0/c CHAR(8)     r     1 WSN

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w UBIN        r     1 B_SCDCTX
     0-0-0/w PTR         r     1 F$CFU$                     0-0-0/w UBIN        r     1 FM_SYSSETX
     0-0-0/d CHAR(8)     r     1 J_KEYIN                    0-0-0/w PTR         r     1 N$DCT$$
PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:44   
     0-0-0/w UBIN        r     1 NK_MXTOTAL                 0-0-0/w BIT         r     1 OCI_BOOT
     0-0-0/w EPTR        r     1 OCI_ROUTINE(0:8191)
     0-0-0/w UBIN        r     1 S_TIMR

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN        r     1 ARG                        0-0-0/d STRC(2088)  r     1 B$JIT
     0-0-0/w STRC(288)   r     1 FM$DEV(0:0)                0-0-0/w STRC(288)   r     1 FM$VOL(0:0)
     0-0-0/w STRC(324)   r     1 FR$RAT                     0-0-0/d STRC(1080)  r     1 N$REQ
     0-0-0/d STRC(864)   r     1 NK$LDCT
     0-0-0/w PTR         r     1 NK$LDCT$(0:0)
     0-0-0/c ACHR        r     1 STRING                     0-0-0/b UBIN(3)     r     1 UB3(0:11)


   Procedure OCI$MK_WRTM requires 432 words for executable code.
   Procedure OCI$MK_WRTM requires 70 words of local(AUTO) storage.
PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:45   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:46   
          MINI XREF LISTING

A
      2646**LABEL    2607--GOTO
ARG
      2591**DCL      2661>>CALLBLT
ARG_C
      2592**DCL      2661<<CALLBLT  2662>>CALLBLT
B$JIT.ERR.MID
       390**DCL       390--REDEF
B$JIT.SYSID
       389**DCL      2644>>ASSIGN
B$JIT$
      2567**DCL       384--IMP-PTR  2644>>ASSIGN
B_SCDCTX
      1282**DCL      2711>>ASSIGN
CADDR
        59**DCL        58--PROC     2640--ENTRY    2727>>ASSIGN
CTDVM
      2580**DCL      2699>>ASSIGN
DCTX
        65**DCL        58--PROC     2602>>ASSIGN   2640--ENTRY    2708>>ASSIGN   2741--IF       2744>>IF
      2748>>IF       2752>>ASSIGN   2757>>IF       2760>>ASSIGN   2766>>ASSIGN
DISPLAY_CT
      2595**DCL      2653<<ASSIGN   2700<<ASSIGN   2716>>DOINDEX
DP_I
      2594**DCL      2766<<ASSIGN   2767>>DOWHILE  2768>>IF       2771<<ASSIGN   2771>>ASSIGN
F$CFU$
      2510**DCL      2552--IMP-PTR  2559--IMP-PTR  2766>>ASSIGN   2768>>IF       2771>>ASSIGN
FM$DEV.SECTL
      2554**DCL      2766>>ASSIGN
FM$DEV.USERLIST
      2553**DCL      2554--REDEF
FM$VOL.SECTL
PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:47   
      2561**DCL      2771>>ASSIGN
FM$VOL.SETX
      2559**DCL      2768>>IF
FM$VOL.USERLIST
      2560**DCL      2561--REDEF
FM_SYSSETX
      2509**DCL      2768>>IF
FR$RAT.RCOD
      2387**DCL      2761>>IF
I
      2575**DCL      2660<<DOINDEX  2674<<DOINDEX  2675>>CALLBLT  2675>>CALLBLT  2704<<DOINDEX  2705>>ASSIGN
      2705>>ASSIGN   2716<<DOINDEX  2781<<DOINDEX  2782>>ASSIGN   2785>>ASSIGN   2786>>ASSIGN   2787<<ASSIGN
J_KEYIN
      2533**DCL      2803<>CALL
KUW$WRITE
      2574**DCL-ENT  2803--CALL
LEN
        63**DCL        58--PROC     2640--ENTRY    2674>>DOINDEX  2701>>ASSIGN   2702>>IF       2703>>ASSIGN
      2782>>ASSIGN   2786>>ASSIGN   2794--ASSIGN
MAKE_MSG
      2708**LABEL    2666--GOTO     2677--GOTO
MSG#
        60**DCL        58--PROC     2640--ENTRY    2654>>IF       2669>>IF       2680>>IF       2680>>IF
      2685>>IF       2694>>IF       2728>>ASSIGN   2761>>IF       2761>>IF
MSGID
        67**DCL        58--PROC     2602<<ASSIGN   2606>>ASSIGN
N$DCT$$
      2167**DCL      2167--IMP-PTR  2708>>ASSIGN   2748>>IF       2752>>ASSIGN   2757>>IF       2760>>ASSIGN
N$REQ
      1225**DCL      2717<>CALL     2720<>CALL
N$REQ.BUF$
      1234**DCL      2713<<ASSIGN
N$REQ.BUFADDR
      1234**DCL      1235--REDEF    1235--REDEF
N$REQ.BUFSIZE
      1228**DCL      2714<<ASSIGN
PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:48   
N$REQ.DLA.DCTX
      1225**DCL      2711<<ASSIGN
N$REQ.DLA.DRELADDR
      1226**DCL      1226--REDEF
N$REQ.DVE.EOMCHAR
      1263**DCL      1264--REDEF
N$REQ.EAINFO
      1257**DCL      1257--REDEF
N$REQ.EAINFOX
      1257**DCL      1258--REDEF
N$REQ.EVNTINFO
      1258**DCL      1258--REDEF
N$REQ.FC
      1228**DCL      2715<<ASSIGN
N$REQ.OPFLG
      1231**DCL      2712<<ASSIGN
N$REQ.STATUS
      1239**DCL      1245--REDEF
NIO$IOSPIN
      2570**DCL-ENT  2720--CALL
NIO$QUE
      2569**DCL-ENT  2717--CALL
NIQ$GET
      2572**DCL-ENT  2710--CALL
NIQ$REL
      2573**DCL-ENT  2723--CALL
NK$LDCT.DDT$
      2286**DCL      2286--REDEF
NK$LDCT.DEVNM
      2286**DCL      2708>>ASSIGN   2752>>ASSIGN
NK$LDCT.IOQ$
      2285**DCL      2286--REDEF
NK$LDCT.LDCTX
      2287**DCL      2287--REDEF
NK$LDCT.LKFLG.ABORTED
      2299**DCL      2300--REDEF
PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:49   
NK$LDCT.RAT$
      2287**DCL      2757>>IF       2760>>ASSIGN
NK$LDCT.RLCID.LDCTX
      2309**DCL      2309--REDEF
NK$LDCT.STA$
      2305**DCL      2306--REDEF
NK$LDCT.SYMB$
      2284**DCL      2284--REDEF    2284--REDEF    2285--REDEF
NK$LDCT$
      2167**DCL      2708>>ASSIGN   2748>>IF       2752>>ASSIGN   2757>>IF       2760>>ASSIGN
NK_MXTOTAL
      2167**DCL      2744>>IF
NOQ
      2717**LABEL    2710--CALLALT
NPARAMS
        61**DCL        58--PROC       62--REDEF    2640--ENTRY    2780>>ASSIGN   2787>>ASSIGN
NPARAMSS
        62**DCL      2781>>DOINDEX
OCI_BOOT
      2123**DCL      2646>>IF
OC_MESSHD
      2146**DCL      2803<>CALL
OC_MESSHD.CADDR
      2147**DCL      2727<<ASSIGN
OC_MESSHD.DEVNM
      2157**DCL      2752<<ASSIGN
OC_MESSHD.FCN
      2152**DCL      2601<<ASSIGN   2641<<ASSIGN
OC_MESSHD.FLAGS
      2153**DCL      2154--REDEF
OC_MESSHD.MESS
      2159**DCL      2779--ASSIGN   2783--IF
OC_MESSHD.MSG#
      2148**DCL      2728<<ASSIGN
OC_MESSHD.MSGID
      2149**DCL      2150--REDEF    2606<<ASSIGN
PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:50   
OC_MESSHD.NPARAMS
      2151**DCL      2793<<ASSIGN   2800<<ASSIGN   2801>>ASSIGN
OC_MESSHD.SYSID
      2150**DCL      2644<<ASSIGN
OC_MESSHD.WSN
      2156**DCL      2157--REDEF    2737<<ASSIGN   2739<<ASSIGN
RELQ
      2717**LABEL    2717--CALLALT
SC_OCBADDCTX
      2568**DCL-ENT  2746--CALL     2750--CALL
SIZE
      2576**DCL      2778<<ASSIGN   2782<<ASSIGN   2782>>ASSIGN   2783>>IF       2786<<ASSIGN   2786>>ASSIGN
      2790<<ASSIGN   2790>>ASSIGN   2791>>IF       2796>>ASSIGN   2801<<ASSIGN   2801>>ASSIGN   2803<>CALL
SPEC_HAND
      2641**LABEL    2770--GOTO
STRING
      2598**DCL      2794<<ASSIGN   2794>>ASSIGN   2797<<ASSIGN   2797>>ASSIGN
S_TIMR
      2549**DCL      2642>>IF
TBL
        64**DCL        58--PROC     2640--ENTRY    2658--ASSIGN   2675>>CALLBLT  2689>>IF       2701--ASSIGN
      2797--ASSIGN
TDVM
      2581**DCL      2589--REDEF    2713--ASSIGN   2714--ASSIGN
TDVM.DVNM
      2583**DCL      2708<<ASSIGN
TDVM.STAT.US
      2587**DCL      2705<<ASSIGN
TDVMC
      2589**DCL      2657<<ASSIGN   2662<<CALLBLT  2673<<ASSIGN   2675<<CALLBLT  2688<<ASSIGN   2691<<CALLBLT
      2696<<ASSIGN   2699<<ASSIGN
TEMP
      2577**DCL      2598--IMP-SIZ  2659<<ASSIGN   2662>>CALLBLT  2663<<ASSIGN   2663>>ASSIGN   2702<<ASSIGN
      2703<<ASSIGN   2704>>DOINDEX  2780<<ASSIGN   2785<<ASSIGN   2790>>ASSIGN   2793>>ASSIGN   2794>>ASSIGN
      2794>>ASSIGN   2795>>ASSIGN   2796<<ASSIGN   2797>>ASSIGN   2797>>ASSIGN
TEMP$
PL6.E3A0      #001=OCI$MK_WRTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:56 Page:51   
      2578**DCL      1225--IMP-PTR  2658<<ASSIGN   2661>>CALLBLT  2664<<ASSIGN   2664>>ASSIGN   2701<<ASSIGN
      2705>>ASSIGN   2710<>CALL     2711>>ASSIGN   2712>>ASSIGN   2713>>ASSIGN   2714>>ASSIGN   2715>>ASSIGN
      2717>>CALL     2720>>CALL     2723<>CALL     2760<<ASSIGN   2761>>IF       2779<<ASSIGN   2794>>ASSIGN
      2795<<ASSIGN   2795>>ASSIGN   2797>>ASSIGN
UB3
      2596**DCL      2705>>ASSIGN
WSN
        66**DCL        58--PROC     2640--ENTRY    2735--IF       2737>>ASSIGN

PL6.E3A0      #002=OCI$MK_STTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:57 Page:52   
      346        1        /*M* OCI$MK_STTM  Routine to request KEYIN to stop a timed write */
      347        2        /*T***********************************************************/
      348        3        /*T*                                                         */
      349        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      350        5        /*T*                                                         */
      351        6        /*T***********************************************************/
      352        7        /*X* */
      353        8        %SET LISTSUB='1'B;
      354        9        /*F* NAME: OCI$MK_STTM
      355       10
      356       11             PURPOSE: To cause KEYIN to stop a timed write
      357       12             DESCRIPTION: A message header specifying the desired
      358       13                          action is built and written to KEYIN
      359       14                                                                   */
      360       15        /*D* NAME: OCI$MK_STTM
      361       16             CALL: CALL OCI$MK_STTM (MSGID)
      362       17                   Where the parameter is:
      363       18                        MSGID UBIN HALF UNAL -- message identifier of the timed
      364       19                                                message which is to be terminated
      365       20             INTERFACE: KUW$WRITE
      366       21             ENVIRONMENT: Any
      367       22             DESCRIPTION: A KEYIN message header is built with the passed
      368       23                          message identifier and the function STOP
      369       24                          TIMED WRITE specified.  The message is then
      370       25                          written to KEYIN by a call to KUW$WRITE
      371       26                                                                          */
      372       27        OCI$MK_STTM: PROC (MSGID);
      373       28    1   DCL MSGID UBIN HALF CALIGNED;
      374       29        /*  */
      375       30    1   DCL KUW$WRITE ENTRY(3) ALTRET;
      376       31        /*  */
      377       32        %INCLUDE JG_GHOSTS_C;
      378      122        %JG_GHOSTS(STCLASS=SYMREF);
      379      160          %INCLUDE OC$MESSHD_C;
      380      181            %OC$MESSHD (NAME=OC_MESSHD,STCLASS="",DELIM=";");
      381      195                                                /**/
      382      196        %INCLUDE OCI_DATA_R;
PL6.E3A0      #002=OCI$MK_STTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:57 Page:53   
      383      208                                                /**/
      384      209        %INCLUDE OC_SUBS_C;
      385      940        /*
      386      941                                                            */
      387      942    1           IF OCI_BOOT                     /* If KEYIN is not yet up,            */
      388      943    1           THEN                            /* don't bother cancelling            */
      389      944    1              RETURN;                      /* the timed write                    */
      390      945    1           OC_MESSHD.FCN = 1 /* stop timed write */;
      391      946    1           OC_MESSHD.MSGID = MSGID;
      392      947    1           CALL KUW$WRITE (OC_MESSHD, LENGTHC(OC_MESSHD), J_KEYIN );
      393      948    1           RETURN;
      394      949    1   END OCI$MK_STTM;
      395      950        %EOD;

PL6.E3A0      #002=OCI$MK_STTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:57 Page:54   
--  Include file information  --

   OC_SUBS_C.:E05TOU  is referenced.
   OCI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   OC$MESSHD_C.:E05TOU  is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
      No diagnostics issued in procedure OCI$MK_STTM.

   Procedure OCI$MK_STTM requires 22 words for executable code.
   Procedure OCI$MK_STTM requires 14 words of local(AUTO) storage.

PL6.E3A0      #002=OCI$MK_STTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:57 Page:55   

 Object Unit name= OCI$MK_STTM                                File name= OCI$MONKEY.:E05TOU
 UTS= JUL 30 '97 03:57:30.72 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none    22     26  OCI$MK_STTM
    1  RoData even  none     3      3  OCI$MK_STTM

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes            yes      Std        1  OCI$MK_STTM

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       3 KUW$WRITE
                       nStd      0 X66_AUTO_1
                       nStd      0 X66_ARET
                       Std       0 B_CONSPOOL_D

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     J_KEYIN                          r    OCI_ROUTINE                           OCI_BOOT
     B_VECTNIL
PL6.E3A0      #002=OCI$MK_STTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:57 Page:56   

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #002=OCI$MK_STTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:57 Page:57   


      346        1        /*M* OCI$MK_STTM  Routine to request KEYIN to stop a timed write */
      347        2        /*T***********************************************************/
      348        3        /*T*                                                         */
      349        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      350        5        /*T*                                                         */
      351        6        /*T***********************************************************/
      352        7        /*X* */
      353        8        %SET LISTSUB='1'B;
      354        9        /*F* NAME: OCI$MK_STTM
      355       10
      356       11             PURPOSE: To cause KEYIN to stop a timed write
      357       12             DESCRIPTION: A message header specifying the desired
      358       13                          action is built and written to KEYIN
      359       14                                                                   */
      360       15        /*D* NAME: OCI$MK_STTM
      361       16             CALL: CALL OCI$MK_STTM (MSGID)
      362       17                   Where the parameter is:
      363       18                        MSGID UBIN HALF UNAL -- message identifier of the timed
      364       19                                                message which is to be terminated
      365       20             INTERFACE: KUW$WRITE
      366       21             ENVIRONMENT: Any
      367       22             DESCRIPTION: A KEYIN message header is built with the passed
      368       23                          message identifier and the function STOP
      369       24                          TIMED WRITE specified.  The message is then
      370       25                          written to KEYIN by a call to KUW$WRITE
      371       26                                                                          */
      372       27        OCI$MK_STTM: PROC (MSGID);

     27  0 000000   000000 700200 xent  OCI$MK_STTM  TSX0  ! X66_AUTO_1
         0 000001   000016 000001                    ZERO    14,1

      373       28    1   DCL MSGID UBIN HALF CALIGNED;
      374       29        /*  */
      375       30    1   DCL KUW$WRITE ENTRY(3) ALTRET;
      376       31        /*  */
      377       32        %INCLUDE JG_GHOSTS_C;
PL6.E3A0      #002=OCI$MK_STTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:57 Page:58   
      378      122        %JG_GHOSTS(STCLASS=SYMREF);
      379      160          %INCLUDE OC$MESSHD_C;
      380      181            %OC$MESSHD (NAME=OC_MESSHD,STCLASS="",DELIM=";");
      381      195                                                /**/
      382      196        %INCLUDE OCI_DATA_R;
      383      208                                                /**/
      384      209        %INCLUDE OC_SUBS_C;
      385      940        /*
      386      941                                                            */
      387      942    1           IF OCI_BOOT                     /* If KEYIN is not yet up,            */

    942  0 000002   000000 234000 xsym               SZN     OCI_BOOT
         0 000003   000005 605000 0                  TPL     s:945

      388      943    1           THEN                            /* don't bother cancelling            */
      389      944    1              RETURN;                      /* the timed write                    */

    944  0 000004   000000 702200 xent               TSX2  ! X66_ARET

      390      945    1           OC_MESSHD.FCN = 1 /* stop timed write */;

    945  0 000005   000001 236007                    LDQ     1,DL
         0 000006   200005 552104                    STBQ    OC_MESSHD+1,'04'O,AUTO

      391      946    1           OC_MESSHD.MSGID = MSGID;

    946  0 000007   200003 470500                    LDP0    @MSGID,,AUTO
         0 000010   000100 100500                    MLR     fill='000'O
         0 000011   000000 000002                    ADSC9   0,,PR0                   cn=0,n=2
         0 000012   200005 000002                    ADSC9   OC_MESSHD+1,,AUTO        cn=0,n=2

      392      947    1           CALL KUW$WRITE (OC_MESSHD, LENGTHC(OC_MESSHD), J_KEYIN );

    947  0 000013   000001 236000 1                  LDQ     1
         0 000014   200014 756100                    STQ     OC_MESSHD+8,,AUTO
         0 000015   000002 236000 1                  LDQ     2
         0 000016   200013 756100                    STQ     OC_MESSHD+7,,AUTO
PL6.E3A0      #002=OCI$MK_STTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:57 Page:59   
         0 000017   200004 631500                    EPPR1   OC_MESSHD,,AUTO
         0 000020   200012 451500                    STP1    OC_MESSHD+6,,AUTO
         0 000021   200012 630500                    EPPR0   OC_MESSHD+6,,AUTO
         0 000022   000021 631400 xsym               EPPR1   B_VECTNIL+17
         0 000023   000000 701000 xent               TSX1    KUW$WRITE
         0 000024   000000 011000                    NOP     0

      393      948    1           RETURN;

    948  0 000025   000000 702200 xent               TSX2  ! X66_ARET

(unnamed)
 Sect OctLoc
   1     000   000000 000024   000000 006000   000000 006000                    ............
      394      949    1   END OCI$MK_STTM;
      395      950        %EOD;

PL6.E3A0      #002=OCI$MK_STTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:57 Page:60   
--  Include file information  --

   OC_SUBS_C.:E05TOU  is referenced.
   OCI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   OC$MESSHD_C.:E05TOU  is referenced.
   JG_GHOSTS_C.:E05TOU  is referenced.
      No diagnostics issued in procedure OCI$MK_STTM.
PL6.E3A0      #002=OCI$MK_STTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:57 Page:61   

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @MSGID                    *0-0-0/c UBIN(18)    r     1 MSGID
     4-0-0/c STRC(180)   r     1 OC_MESSHD

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d CHAR(8)     r     1 J_KEYIN                    0-0-0/w BIT         r     1 OCI_BOOT
     0-0-0/w EPTR        r     1 OCI_ROUTINE(0:8191)


   Procedure OCI$MK_STTM requires 22 words for executable code.
   Procedure OCI$MK_STTM requires 14 words of local(AUTO) storage.
PL6.E3A0      #002=OCI$MK_STTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:57 Page:62   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=OCI$MK_STTM File=OCI$MONKEY.:E05TSI                           WED 07/30/97 03:57 Page:63   
          MINI XREF LISTING

J_KEYIN
       144**DCL       947<>CALL
KUW$WRITE
        30**DCL-ENT   947--CALL
MSGID
        28**DCL        27--PROC      946>>ASSIGN
OCI_BOOT
       207**DCL       942>>IF
OC_MESSHD
       182**DCL       947<>CALL      947--CALL
OC_MESSHD.FCN
       188**DCL       945<<ASSIGN
OC_MESSHD.FLAGS
       189**DCL       190--REDEF
OC_MESSHD.MSGID
       185**DCL       186--REDEF     946<<ASSIGN
OC_MESSHD.WSN
       192**DCL       193--REDEF

PL6.E3A0      #003=OCI$KEYMON File=OCI$MONKEY.:E05TSI                            WED 07/30/97 03:57 Page:64   
      396        1        /*M* OCI$KEYMON  procedure to call proper keyin-processing routine */
      397        2        /*T***********************************************************/
      398        3        /*T*                                                         */
      399        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      400        5        /*T*                                                         */
      401        6        /*T***********************************************************/
      402        7        /*X* */
      403        8        %SET LISTSUB='1'B;
      404        9        OCI$KEYMON: PROC (N$REQ);
      405       10          %INCLUDE N$REQ;
      406       84            %N$REQ (STCLASS=" ");
      407      142    1   DCL NO_KEYIN CHAR(0) CONSTANT INIT (
      408      143    1   ' *** KEYIN aborted! ****   OR   *** CSCG problems *****');
      409      144    1   DCL TEMP$ PTR;
      410      145        %N$REQ (NAME=CONSOLE_WRT,STCLASS="BASED(TEMP$)");
      411      203    1   DCL OCI_STA UBIN WORD SYMREF;           /* DUMMY REALLY VLP_STATION           */
      412      204    1   DCL ROUTINE EPTR;
      413      205    1   DCL NIO$QUE ENTRY(1) ALTRET;
      414      206    1   DCL NIQ$GET ENTRY(1) ALTRET;
      415      207    1   DCL NIQ$REL ENTRY(1) ALTRET;
      416      208    1   DCL NIO$IOSPIN ENTRY(1) ;
      417      209    1   DCL SC_OCIDIAG ENTRY CONV(2,0);
      418      210    1   DCL OCI$MK_WR ENTRY(7);
      419      211          %INCLUDE N_FC_C;
      420      248          %INCLUDE OC_DATA_R;
      421      257          %INCLUDE OCI_DATA_R;
      422      269        /**/
      423      270    1           IF (N$REQ.TYC & '377777'O) = '0'B THEN /* no errors                   */
      424      271    2           DO;
      425      272    2              ROUTINE = OCI_ROUTINE (OCI_PARAM.RTN#);
               272                       /* get routine to call for this keyin */
      426      273    2              OCI_PARAM.RTN#=0;            /* ROUTINE SEES ONLY HIS NUMBER       */
      427      274    2              CALL ROUTINE (OCI_PARAM) ALTRET (SAY_EH); /* go process this keyin */
      428      275    2   READ:      ;
      429      276    2              N$REQ.STATION.LSTA$=ADDR(OCI_STA);
      430      277    2              N$REQ.OPFLG.REQ='1'B;
      431      278    2              RETURN;
PL6.E3A0      #003=OCI$KEYMON File=OCI$MONKEY.:E05TSI                            WED 07/30/97 03:57 Page:65   
      432      279    2   SAY_EH:
      433      280    2              CALL OCI$MK_WR (OCI_PARAM.CADDR, 0, 0);
      434      281    2              GOTO READ;
      435      282    2              END;
      436      283    1           ELSE                            /* Monkey got an ERR                  */
      437      284    2           DO;
      438      285    2              IF (OCI_DIAG)
      439      286    3              THEN DO;
      440      287    3                 OCI_DIAG= '0'B;           /*Only snap once                      */
      441      288    3                 CALL SC_OCIDIAG;
      442      289    3                 END;
      443      290        /*S* SCREECH_CODE: OCI-S$OCIDIAG
      444      291             TYPE:         SNAP
      445      292             MESSAGE:      Something is wrong in the CSCG.
      446      293             REMARKS:      Check the Q register for the TYC byte to see what
      447      294                           is wrong. (Refer to the Host monitor services draw
      448      295                           of M$DCB for a MAP of the TYC byte                        */
      449      296
      450      297                /* Get a Temporary IOQ packet to send a Message to the console
      451      298                   If no IOQ packets are Available just REPOST the read */
      452      299    2              CALL NIQ$GET (TEMP$) ALTRET (READ);
      453      300
      454      301                                 /* Set up parameters for the write to the console    */
      455      302    2              CONSOLE_WRT.OPFLG = '010'O | '004'O; /* BPF and HOLD              */
      456      303    2              CONSOLE_WRT.DLA.DCTX = B_SCDCTX; /* DCT index of system console    */
      457      304    2              CONSOLE_WRT.BUF$ = ADDR (NO_KEYIN); /* buffer pointer              */
      458      305    2              CONSOLE_WRT.BUFSIZE = SIZEC (NO_KEYIN); /* buffer size             */
      459      306    2              CONSOLE_WRT.FC = %N_WRITE;   /* write with CR/LF                   */
      460      307
      461      308                                                /* Send the message to the console    */
      462      309    2              CALL NIO$QUE   (CONSOLE_WRT) ALTRET (NO_IO);
      463      310
      464      311                                      /* Wait for the console to reciev the message   */
      465      312    2              CALL NIO$IOSPIN (CONSOLE_WRT);
      466      313
      467      314    2   NO_IO:     ;   /* The Write to the console went no where don't wait for it    */
      468      315
PL6.E3A0      #003=OCI$KEYMON File=OCI$MONKEY.:E05TSI                            WED 07/30/97 03:57 Page:66   
      469      316                                                /* Release TEMPorary IOQ packet       */
      470      317    2              CALL NIQ$REL    (CONSOLE_WRT);
      471      318
      472      319    2              GOTO READ;                   /* Repost Monkey's READ               */
      473      320    2              END;
      474      321    1   END OCI$KEYMON;
      475      322        %EOD;

PL6.E3A0      #003=OCI$KEYMON File=OCI$MONKEY.:E05TSI                            WED 07/30/97 03:57 Page:67   
--  Include file information  --

   OCI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   OC_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   N_FC_C.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
      No diagnostics issued in procedure OCI$KEYMON.

   Procedure OCI$KEYMON requires 71 words for executable code.
   Procedure OCI$KEYMON requires 8 words of local(AUTO) storage.

PL6.E3A0      #003=OCI$KEYMON File=OCI$MONKEY.:E05TSI                            WED 07/30/97 03:57 Page:68   

 Object Unit name= OCI$KEYMON                                 File name= OCI$MONKEY.:E05TOU
 UTS= JUL 30 '97 03:57:39.48 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS     14     16  OCI$KEYMON
    1   Proc  even  none    71    107  OCI$KEYMON
    2  RoData even  none     7      7  OCI$KEYMON

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        1  OCI$KEYMON

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       7 OCI$MK_WR
 yes     yes           Std       1 NIQ$GET
 yes     yes           Std       1 NIO$QUE
 yes     yes           Std       1 NIQ$REL
         yes           Std       1 NIO$IOSPIN
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
PL6.E3A0      #003=OCI$KEYMON File=OCI$MONKEY.:E05TSI                            WED 07/30/97 03:57 Page:69   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_OCIDIAG                            OCI_STA                               B_SCDCTX
r    OCI_ROUTINE                           OCI_PARAM                             OCI_DIAG
     B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ASLENTSID                             ISSID
PL6.E3A0      #003=OCI$KEYMON File=OCI$MONKEY.:E05TSI                            WED 07/30/97 03:57 Page:70   


      396        1        /*M* OCI$KEYMON  procedure to call proper keyin-processing routine */
      397        2        /*T***********************************************************/
      398        3        /*T*                                                         */
      399        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      400        5        /*T*                                                         */
      401        6        /*T***********************************************************/
      402        7        /*X* */
      403        8        %SET LISTSUB='1'B;
      404        9        OCI$KEYMON: PROC (N$REQ);

      9  1 000000   000000 700200 xent  OCI$KEYMON   TSX0  ! X66_AUTO_1
         1 000001   000010 000001                    ZERO    8,1

      405       10          %INCLUDE N$REQ;
      406       84            %N$REQ (STCLASS=" ");
      407      142    1   DCL NO_KEYIN CHAR(0) CONSTANT INIT (
      408      143    1   ' *** KEYIN aborted! ****   OR   *** CSCG problems *****');
      409      144    1   DCL TEMP$ PTR;
      410      145        %N$REQ (NAME=CONSOLE_WRT,STCLASS="BASED(TEMP$)");
      411      203    1   DCL OCI_STA UBIN WORD SYMREF;           /* DUMMY REALLY VLP_STATION           */
      412      204    1   DCL ROUTINE EPTR;
      413      205    1   DCL NIO$QUE ENTRY(1) ALTRET;
      414      206    1   DCL NIQ$GET ENTRY(1) ALTRET;
      415      207    1   DCL NIQ$REL ENTRY(1) ALTRET;
      416      208    1   DCL NIO$IOSPIN ENTRY(1) ;
      417      209    1   DCL SC_OCIDIAG ENTRY CONV(2,0);
      418      210    1   DCL OCI$MK_WR ENTRY(7);
      419      211          %INCLUDE N_FC_C;
      420      248          %INCLUDE OC_DATA_R;
      421      257          %INCLUDE OCI_DATA_R;
      422      269        /**/
      423      270    1           IF (N$REQ.TYC & '377777'O) = '0'B THEN /* no errors                   */

    270  1 000002   200003 470500                    LDP0    @N$REQ,,AUTO
         1 000003   000021 236100                    LDQ     17,,PR0
         1 000004   377777 376003                    ANQ     131071,DU
PL6.E3A0      #003=OCI$KEYMON File=OCI$MONKEY.:E05TSI                            WED 07/30/97 03:57 Page:71   
         1 000005   000034 601000 1                  TNZ     s:285

      424      271    2           DO;

      425      272    2              ROUTINE = OCI_ROUTINE (OCI_PARAM.RTN#);
               272                       /* get routine to call for this keyin */

    272  1 000006   000000 236000 xsym               LDQ     OCI_PARAM
         1 000007   000033 772000                    QRL     27
         1 000010   000000 236006 xsym               LDQ     OCI_ROUTINE,QL
         1 000011   200005 756100                    STQ     ROUTINE,,AUTO

      426      273    2              OCI_PARAM.RTN#=0;            /* ROUTINE SEES ONLY HIS NUMBER       */

    273  1 000012   000000 236003                    LDQ     0,DU
         1 000013   000000 552040 xsym               STBQ    OCI_PARAM,'40'O

      427      274    2              CALL ROUTINE (OCI_PARAM) ALTRET (SAY_EH); /* go process this keyin */

    274  1 000014   000000 630400 2                  EPPR0   0
         1 000015   200005 220100                    LDX0    ROUTINE,,AUTO
         1 000016   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000017   000000 701010                    TSX1    0,X0
         1 000020   000027 702000 1                  TSX2    SAY_EH

    273  1 000021                       READ         null
      428      275    2   READ:      ;
      429      276    2              N$REQ.STATION.LSTA$=ADDR(OCI_STA);

    276  1 000021   000001 236000 2                  LDQ     1
         1 000022   200003 470500                    LDP0    @N$REQ,,AUTO
         1 000023   000013 756100                    STQ     11,,PR0

      430      277    2              N$REQ.OPFLG.REQ='1'B;

    277  1 000024   000002 236007                    LDQ     2,DL
         1 000025   000004 256100                    ORSQ    4,,PR0
PL6.E3A0      #003=OCI$KEYMON File=OCI$MONKEY.:E05TSI                            WED 07/30/97 03:57 Page:72   

      431      278    2              RETURN;

    278  1 000026   000000 702200 xent               TSX2  ! X66_ARET

      432      279    2   SAY_EH:
      433      280    2              CALL OCI$MK_WR (OCI_PARAM.CADDR, 0, 0);

    280  1 000027   000002 630400 2     SAY_EH       EPPR0   2
         1 000030   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000031   000000 701000 xent               TSX1    OCI$MK_WR
         1 000032   000000 011000                    NOP     0

      434      281    2              GOTO READ;

    281  1 000033   000021 710000 1                  TRA     READ

      435      282    2              END;
      436      283    1           ELSE                            /* Monkey got an ERR                  */
      437      284    2           DO;

      438      285    2              IF (OCI_DIAG)

    285  1 000034   000000 234000 xsym               SZN     OCI_DIAG
         1 000035   000041 605000 1                  TPL     s:299

      439      286    3              THEN DO;

      440      287    3                 OCI_DIAG= '0'B;           /*Only snap once                      */

    287  1 000036   000000 450000 xsym               STZ     OCI_DIAG

      441      288    3                 CALL SC_OCIDIAG;

    288  1 000037   000000 713400 xsym               CLIMB   SC_OCIDIAG
         1 000040   000000 600000 xsid               climb   nvectors=         0

PL6.E3A0      #003=OCI$KEYMON File=OCI$MONKEY.:E05TSI                            WED 07/30/97 03:57 Page:73   
      442      289    3                 END;

      443      290        /*S* SCREECH_CODE: OCI-S$OCIDIAG
      444      291             TYPE:         SNAP
      445      292             MESSAGE:      Something is wrong in the CSCG.
      446      293             REMARKS:      Check the Q register for the TYC byte to see what
      447      294                           is wrong. (Refer to the Host monitor services draw
      448      295                           of M$DCB for a MAP of the TYC byte                        */
      449      296
      450      297                /* Get a Temporary IOQ packet to send a Message to the console
      451      298                   If no IOQ packets are Available just REPOST the read */
      452      299    2              CALL NIQ$GET (TEMP$) ALTRET (READ);

    299  1 000041   200004 630500                    EPPR0   TEMP$,,AUTO
         1 000042   200006 450500                    STP0    ROUTINE+1,,AUTO
         1 000043   200006 630500                    EPPR0   ROUTINE+1,,AUTO
         1 000044   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000045   000000 701000 xent               TSX1    NIQ$GET
         1 000046   000021 702000 1                  TSX2    READ

      453      300
      454      301                                 /* Set up parameters for the write to the console    */
      455      302    2              CONSOLE_WRT.OPFLG = '010'O | '004'O; /* BPF and HOLD              */

    302  1 000047   200004 470500                    LDP0    TEMP$,,AUTO
         1 000050   000014 236007                    LDQ     12,DL
         1 000051   000004 552104                    STBQ    4,'04'O,PR0

      456      303    2              CONSOLE_WRT.DLA.DCTX = B_SCDCTX; /* DCT index of system console    */

    303  1 000052   200004 470500                    LDP0    TEMP$,,AUTO
         1 000053   000000 236000 xsym               LDQ     B_SCDCTX
         1 000054   000025 736000                    QLS     21
         1 000055   000001 676100                    ERQ     1,,PR0
         1 000056   777770 376003                    ANQ     -8,DU
         1 000057   000001 656100                    ERSQ    1,,PR0

PL6.E3A0      #003=OCI$KEYMON File=OCI$MONKEY.:E05TSI                            WED 07/30/97 03:57 Page:74   
      457      304    2              CONSOLE_WRT.BUF$ = ADDR (NO_KEYIN); /* buffer pointer              */

    304  1 000060   000005 236000 2                  LDQ     5
         1 000061   200004 470500                    LDP0    TEMP$,,AUTO
         1 000062   000005 756100                    STQ     5,,PR0

      458      305    2              CONSOLE_WRT.BUFSIZE = SIZEC (NO_KEYIN); /* buffer size             */

    305  1 000063   000004 236100                    LDQ     4,,PR0
         1 000064   177777 376007                    ANQ     65535,DL
         1 000065   000006 276000 2                  ORQ     6
         1 000066   000004 756100                    STQ     4,,PR0

      459      306    2              CONSOLE_WRT.FC = %N_WRITE;   /* write with CR/LF                   */

    306  1 000067   200004 470500                    LDP0    TEMP$,,AUTO
         1 000070   000015 236007                    LDQ     13,DL
         1 000071   000003 552104                    STBQ    3,'04'O,PR0

      460      307
      461      308                                                /* Send the message to the console    */
      462      309    2              CALL NIO$QUE   (CONSOLE_WRT) ALTRET (NO_IO);

    309  1 000072   200004 630500                    EPPR0   TEMP$,,AUTO
         1 000073   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000074   000000 701000 xent               TSX1    NIO$QUE
         1 000075   000102 702000 1                  TSX2    NO_IO

      463      310
      464      311                                      /* Wait for the console to reciev the message   */
      465      312    2              CALL NIO$IOSPIN (CONSOLE_WRT);

    312  1 000076   200004 630500                    EPPR0   TEMP$,,AUTO
         1 000077   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000100   000000 701000 xent               TSX1    NIO$IOSPIN
         1 000101   000000 011000                    NOP     0

PL6.E3A0      #003=OCI$KEYMON File=OCI$MONKEY.:E05TSI                            WED 07/30/97 03:57 Page:75   
    306  1 000102                       NO_IO        null
      466      313
      467      314    2   NO_IO:     ;   /* The Write to the console went no where don't wait for it    */
      468      315
      469      316                                                /* Release TEMPorary IOQ packet       */
      470      317    2              CALL NIQ$REL    (CONSOLE_WRT);

    317  1 000102   200004 630500                    EPPR0   TEMP$,,AUTO
         1 000103   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000104   000000 701000 xent               TSX1    NIQ$REL
         1 000105   000000 011000                    NOP     0

      471      318
      472      319    2              GOTO READ;                   /* Repost Monkey's READ               */

    319  1 000106   000021 710000 1                  TRA     READ

NO_KEYIN
 Sect OctLoc
   0     000   040052 052052   040113 105131   111116 040141   142157 162164     *** KEYIN abort
   0     004   145144 041040   052052 052052   040040 040117   122040 040040    ed! ****   OR
   0     010   052052 052040   103123 103107   040160 162157   142154 145155    *** CSCG problem
   0     014   163040 052052   052052 052***                                    s *****.

(unnamed)
 Sect OctLoc
   2     000   000000 006000   000000 006000   000000 406000   000002 006000    ................
   2     004   000002 006000   000000 006000   000015 600000                    ............
      473      320    2              END;
      474      321    1   END OCI$KEYMON;
      475      322        %EOD;

PL6.E3A0      #003=OCI$KEYMON File=OCI$MONKEY.:E05TSI                            WED 07/30/97 03:57 Page:76   
--  Include file information  --

   OCI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   OC_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   N_FC_C.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
      No diagnostics issued in procedure OCI$KEYMON.
PL6.E3A0      #003=OCI$KEYMON File=OCI$MONKEY.:E05TSI                            WED 07/30/97 03:57 Page:77   

 **** Variables and constants ****

  ****  Section 000 RoData OCI$KEYMON

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c CHAR(55)    r     1 NO_KEYIN

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @N$REQ                    *0-0-0/d STRC(1080)  r     1 N$REQ
     5-0-0/w EPTR        r     1 ROUTINE                    4-0-0/w PTR         r     1 TEMP$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN        r     1 B_SCDCTX                   0-0-0/w BIT         r     1 OCI_DIAG
     0-0-0/c STRC(1260)  r     1 OCI_PARAM
     0-0-0/w EPTR        r     1 OCI_ROUTINE(0:8191)
     0-0-0/w UBIN        r     1 OCI_STA

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(1080)  r     1 CONSOLE_WRT


   Procedure OCI$KEYMON requires 71 words for executable code.
PL6.E3A0      #003=OCI$KEYMON File=OCI$MONKEY.:E05TSI                            WED 07/30/97 03:57 Page:78   
   Procedure OCI$KEYMON requires 8 words of local(AUTO) storage.
PL6.E3A0      #003=OCI$KEYMON File=OCI$MONKEY.:E05TSI                            WED 07/30/97 03:57 Page:79   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=OCI$KEYMON File=OCI$MONKEY.:E05TSI                            WED 07/30/97 03:57 Page:80   
          MINI XREF LISTING

B_SCDCTX
       256**DCL       303>>ASSIGN
CONSOLE_WRT
       154**DCL       309<>CALL      312<>CALL      317<>CALL
CONSOLE_WRT.BUF$
       163**DCL       304<<ASSIGN
CONSOLE_WRT.BUFADDR
       163**DCL       164--REDEF     164--REDEF
CONSOLE_WRT.BUFSIZE
       157**DCL       305<<ASSIGN
CONSOLE_WRT.DLA.DCTX
       154**DCL       303<<ASSIGN
CONSOLE_WRT.DLA.DRELADDR
       155**DCL       155--REDEF
CONSOLE_WRT.DVE.EOMCHAR
       192**DCL       193--REDEF
CONSOLE_WRT.EAINFO
       186**DCL       186--REDEF
CONSOLE_WRT.EAINFOX
       186**DCL       187--REDEF
CONSOLE_WRT.EVNTINFO
       187**DCL       187--REDEF
CONSOLE_WRT.FC
       157**DCL       306<<ASSIGN
CONSOLE_WRT.OPFLG
       160**DCL       302<<ASSIGN
CONSOLE_WRT.STATUS
       168**DCL       174--REDEF
N$REQ
        93**DCL         9--PROC
N$REQ.BUFADDR
       102**DCL       103--REDEF     103--REDEF
PL6.E3A0      #003=OCI$KEYMON File=OCI$MONKEY.:E05TSI                            WED 07/30/97 03:57 Page:81   
N$REQ.DLA.DRELADDR
        94**DCL        94--REDEF
N$REQ.DVE.EOMCHAR
       131**DCL       132--REDEF
N$REQ.EAINFO
       125**DCL       125--REDEF
N$REQ.EAINFOX
       125**DCL       126--REDEF
N$REQ.EVNTINFO
       126**DCL       126--REDEF
N$REQ.OPFLG.REQ
       101**DCL       277<<ASSIGN
N$REQ.STATION.LSTA$
       106**DCL       276<<ASSIGN
N$REQ.STATUS
       107**DCL       113--REDEF
N$REQ.TYC
       115**DCL       270>>IF
NIO$IOSPIN
       208**DCL-ENT   312--CALL
NIO$QUE
       205**DCL-ENT   309--CALL
NIQ$GET
       206**DCL-ENT   299--CALL
NIQ$REL
       207**DCL-ENT   317--CALL
NO_IO
       306**LABEL     309--CALLALT
NO_KEYIN
       142**DCL       304--ASSIGN    305--ASSIGN
OCI$MK_WR
       210**DCL-ENT   280--CALL
OCI_DIAG
       268**DCL       285>>IF        287<<ASSIGN
OCI_PARAM
       266**DCL       274<>CALL
PL6.E3A0      #003=OCI$KEYMON File=OCI$MONKEY.:E05TSI                            WED 07/30/97 03:57 Page:82   
OCI_PARAM.CADDR
       267**DCL       280<>CALL
OCI_PARAM.RTN#
       266**DCL       272>>ASSIGN    273<<ASSIGN
OCI_ROUTINE
       266**DCL       272>>ASSIGN
OCI_STA
       203**DCL       276--ASSIGN
READ
       273**LABEL     281--GOTO      299--CALLALT   319--GOTO
ROUTINE
       204**DCL       272<<ASSIGN    274>>CALL
SAY_EH
       280**LABEL     274--CALLALT
SC_OCIDIAG
       209**DCL-ENT   288--CALL
TEMP$
       144**DCL       154--IMP-PTR   299<>CALL      302>>ASSIGN    303>>ASSIGN    304>>ASSIGN    305>>ASSIGN
       306>>ASSIGN    309>>CALL      312>>CALL      317>>CALL

PL6.E3A0      #004=OCI$INIT File=OCI$MONKEY.:E05TSI                              WED 07/30/97 03:57 Page:83   
      476        1        /*M* OCI$INIT  procedure to start reads to the Central System COMGROUP */
      477        2        /*T***********************************************************/
      478        3        /*T*                                                         */
      479        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      480        5        /*T*                                                         */
      481        6        /*T***********************************************************/
      482        7        /*X* */
      483        8        %SET LISTSUB='1'B;
      484        9        OCI$INIT: PROC;
      485       10        %INCLUDE KC_CP6;
      486      570        %VLP_STATION (FPTN=OCI_STA,DIRONLY=YES,STCLASS="STATIC SYMDEF");
      487      597        %SUB FALSE='0'B;
      488      598    1   DCL OCI$KEYMON ENTRY(1);
      489      599    1   DCL NIQ$GET ENTRY(1) ALTRET;
      490      600    1   DCL NIO$QUE ENTRY(1) ALTRET;
      491      601    1   DCL NK_MONKLDX UBIN WORD SYMREF;
      492      602    1   DCL Q$ PTR;
      493      603          %INCLUDE OCI_DATA_R;
      494      615          %INCLUDE N_FC_C;
      495      652          %INCLUDE N$REQ;
      496      726            %N$REQ;
      497      784        /*          */
      498      785    1           CALL NIQ$GET (Q$);
      499      786    1           Q$ -> N$REQ.OPFLG = '040'O|'010'O; /* EA, BPF                          */
      500      787    1           Q$ -> N$REQ.DLA.DCTX = NK_MONKLDX; /* LDCT index of station 'MONKEY'  */
      501      788    1           Q$ -> N$REQ.BUF$ = OCI_PARAM$;  /* buffer pointer                     */
      502      789    1           Q$ -> N$REQ.BUFSIZE = SIZEC (OCI_PARAM); /* buffer size               */
      503      790    1           Q$ -> N$REQ.FC = %N_RDASC;      /* function is read                   */
      504      791    1           Q$ -> N$REQ.EAENTRY = ENTADDR (OCI$KEYMON); /* end-action routine     */
      505      792    1           Q$->N$REQ.STATION.LSTA$=ADDR(OCI_STA);
      506      793    1           Q$->N$REQ.NOALT='1'B;
      507      794    1           OCI_BOOT = '0'B;               /* for OCI$MK_WR                      */
      508      795    1           CALL NIO$QUE (Q$->N$REQ);
      509      796    1           RETURN;
      510      797    1   END OCI$INIT;
      511      798        %EOD;

PL6.E3A0      #004=OCI$INIT File=OCI$MONKEY.:E05TSI                              WED 07/30/97 03:57 Page:84   
--  Include file information  --

   N$REQ.:E05TOU  is referenced.
   N_FC_C.:E05TOU  is referenced.
   OCI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KC_CP6.:E05TOU  is referenced.
      No diagnostics issued in procedure OCI$INIT.

   Procedure OCI$INIT requires 38 words for executable code.
   Procedure OCI$INIT requires 6 words of local(AUTO) storage.

PL6.E3A0      #004=OCI$INIT File=OCI$MONKEY.:E05TSI                              WED 07/30/97 03:57 Page:85   

 Object Unit name= OCI$INIT                                   File name= OCI$MONKEY.:E05TOU
 UTS= JUL 30 '97 03:57:52.84 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Data  even  none     8     10  OCI$INIT
    1   Proc  even  none    38     46  OCI$INIT
    2  RoData even  none     1      1  OCI$INIT

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        0  OCI$INIT

  ****  Data defs  ****

 Sect OctLoc  Name                           Sect OctLoc  Name
    0      0  OCI_STA

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 NIQ$GET
 yes     yes           Std       1 NIO$QUE
         yes           Std       1 OCI$KEYMON
                       nStd      0 X66_AUTO_0
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
PL6.E3A0      #004=OCI$INIT File=OCI$MONKEY.:E05TSI                              WED 07/30/97 03:57 Page:86   

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     NK_MONKLDX                       r    OCI_ROUTINE                           OCI_PARAM
r    OCI_PARAM$                            OCI_BOOT                              B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #004=OCI$INIT File=OCI$MONKEY.:E05TSI                              WED 07/30/97 03:57 Page:87   


      476        1        /*M* OCI$INIT  procedure to start reads to the Central System COMGROUP */
      477        2        /*T***********************************************************/
      478        3        /*T*                                                         */
      479        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      480        5        /*T*                                                         */
      481        6        /*T***********************************************************/
      482        7        /*X* */
      483        8        %SET LISTSUB='1'B;
      484        9        OCI$INIT: PROC;

      9  1 000000   000000 700200 xent  OCI$INIT     TSX0  ! X66_AUTO_0
         1 000001   000006 000000                    ZERO    6,0

      485       10        %INCLUDE KC_CP6;
      486      570        %VLP_STATION (FPTN=OCI_STA,DIRONLY=YES,STCLASS="STATIC SYMDEF");
      487      597        %SUB FALSE='0'B;
      488      598    1   DCL OCI$KEYMON ENTRY(1);
      489      599    1   DCL NIQ$GET ENTRY(1) ALTRET;
      490      600    1   DCL NIO$QUE ENTRY(1) ALTRET;
      491      601    1   DCL NK_MONKLDX UBIN WORD SYMREF;
      492      602    1   DCL Q$ PTR;
      493      603          %INCLUDE OCI_DATA_R;
      494      615          %INCLUDE N_FC_C;
      495      652          %INCLUDE N$REQ;
      496      726            %N$REQ;
      497      784        /*          */
      498      785    1           CALL NIQ$GET (Q$);

    785  1 000002   200003 630500                    EPPR0   Q$,,AUTO
         1 000003   200004 450500                    STP0    Q$+1,,AUTO
         1 000004   200004 630500                    EPPR0   Q$+1,,AUTO
         1 000005   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000006   000000 701000 xent               TSX1    NIQ$GET
         1 000007   000000 011000                    NOP     0

      499      786    1           Q$ -> N$REQ.OPFLG = '040'O|'010'O; /* EA, BPF                          */
PL6.E3A0      #004=OCI$INIT File=OCI$MONKEY.:E05TSI                              WED 07/30/97 03:57 Page:88   

    786  1 000010   200003 470500                    LDP0    Q$,,AUTO
         1 000011   000050 236007                    LDQ     40,DL
         1 000012   000004 552104                    STBQ    4,'04'O,PR0

      500      787    1           Q$ -> N$REQ.DLA.DCTX = NK_MONKLDX; /* LDCT index of station 'MONKEY'  */

    787  1 000013   000000 236000 xsym               LDQ     NK_MONKLDX
         1 000014   000025 736000                    QLS     21
         1 000015   000001 676100                    ERQ     1,,PR0
         1 000016   777770 376003                    ANQ     -8,DU
         1 000017   000001 656100                    ERSQ    1,,PR0

      501      788    1           Q$ -> N$REQ.BUF$ = OCI_PARAM$;  /* buffer pointer                     */

    788  1 000020   000000 236000 xsym               LDQ     OCI_PARAM$
         1 000021   200003 470500                    LDP0    Q$,,AUTO
         1 000022   000005 756100                    STQ     5,,PR0

      502      789    1           Q$ -> N$REQ.BUFSIZE = SIZEC (OCI_PARAM); /* buffer size               */

    789  1 000023   000004 236100                    LDQ     4,,PR0
         1 000024   177777 376007                    ANQ     65535,DL
         1 000025   000043 276003                    ORQ     35,DU
         1 000026   000004 756100                    STQ     4,,PR0

      503      790    1           Q$ -> N$REQ.FC = %N_RDASC;      /* function is read                   */

    790  1 000027   000004 236007                    LDQ     4,DL
         1 000030   000003 552104                    STBQ    3,'04'O,PR0

      504      791    1           Q$ -> N$REQ.EAENTRY = ENTADDR (OCI$KEYMON); /* end-action routine     */

    791  1 000031   000000 636000 xent               EAQ     OCI$KEYMON
         1 000032   200003 470500                    LDP0    Q$,,AUTO
         1 000033   000023 756100                    STQ     19,,PR0

PL6.E3A0      #004=OCI$INIT File=OCI$MONKEY.:E05TSI                              WED 07/30/97 03:57 Page:89   
      505      792    1           Q$->N$REQ.STATION.LSTA$=ADDR(OCI_STA);

    792  1 000034   000000 236000 2                  LDQ     0
         1 000035   000013 756100                    STQ     11,,PR0

      506      793    1           Q$->N$REQ.NOALT='1'B;

    793  1 000036   100000 236007                    LDQ     32768,DL
         1 000037   000004 256100                    ORSQ    4,,PR0

      507      794    1           OCI_BOOT = '0'B;               /* for OCI$MK_WR                      */

    794  1 000040   000000 450000 xsym               STZ     OCI_BOOT

      508      795    1           CALL NIO$QUE (Q$->N$REQ);

    795  1 000041   200003 630500                    EPPR0   Q$,,AUTO
         1 000042   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000043   000000 701000 xent               TSX1    NIO$QUE
         1 000044   000000 011000                    NOP     0

      509      796    1           RETURN;

    796  1 000045   000000 702200 xent               TSX2  ! X66_ARET

OCI_STA
 Sect OctLoc
   0     000   040040 040040   040040 040040   040040 040040   040040 040040
   0     004   005000 000000   000000 000000   000000 000000   000000 000000    ................

(unnamed)
 Sect OctLoc
   2     000   000000 006000                                                    ....
      510      797    1   END OCI$INIT;
      511      798        %EOD;

PL6.E3A0      #004=OCI$INIT File=OCI$MONKEY.:E05TSI                              WED 07/30/97 03:57 Page:90   
--  Include file information  --

   N$REQ.:E05TOU  is referenced.
   N_FC_C.:E05TOU  is referenced.
   OCI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KC_CP6.:E05TOU  is referenced.
      No diagnostics issued in procedure OCI$INIT.
PL6.E3A0      #004=OCI$INIT File=OCI$MONKEY.:E05TSI                              WED 07/30/97 03:57 Page:91   

 **** Variables and constants ****

  ****  Section 000  Data  OCI$INIT

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(288)   r     1 OCI_STA

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 Q$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN        r     1 NK_MONKLDX                 0-0-0/w BIT         r     1 OCI_BOOT
     0-0-0/c STRC(1260)  r     1 OCI_PARAM                  0-0-0/w PTR         r     1 OCI_PARAM$
     0-0-0/w EPTR        r     1 OCI_ROUTINE(0:8191)

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(1080)  r     1 N$REQ


   Procedure OCI$INIT requires 38 words for executable code.
   Procedure OCI$INIT requires 6 words of local(AUTO) storage.
PL6.E3A0      #004=OCI$INIT File=OCI$MONKEY.:E05TSI                              WED 07/30/97 03:57 Page:92   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #004=OCI$INIT File=OCI$MONKEY.:E05TSI                              WED 07/30/97 03:57 Page:93   
          MINI XREF LISTING

N$REQ
       735**DCL       795<>CALL
N$REQ.BUF$
       744**DCL       788<<ASSIGN
N$REQ.BUFADDR
       744**DCL       745--REDEF     745--REDEF
N$REQ.BUFSIZE
       738**DCL       789<<ASSIGN
N$REQ.DLA.DCTX
       735**DCL       787<<ASSIGN
N$REQ.DLA.DRELADDR
       736**DCL       736--REDEF
N$REQ.DVE.EOMCHAR
       773**DCL       774--REDEF
N$REQ.EAENTRY
       766**DCL       791<<ASSIGN
N$REQ.EAINFO
       767**DCL       767--REDEF
N$REQ.EAINFOX
       767**DCL       768--REDEF
N$REQ.EVNTINFO
       768**DCL       768--REDEF
N$REQ.FC
       738**DCL       790<<ASSIGN
N$REQ.NOALT
       738**DCL       793<<ASSIGN
N$REQ.OPFLG
       741**DCL       786<<ASSIGN
N$REQ.STATION.LSTA$
       748**DCL       792<<ASSIGN
N$REQ.STATUS
       749**DCL       755--REDEF
PL6.E3A0      #004=OCI$INIT File=OCI$MONKEY.:E05TSI                              WED 07/30/97 03:57 Page:94   
NIO$QUE
       600**DCL-ENT   795--CALL
NIQ$GET
       599**DCL-ENT   785--CALL
NK_MONKLDX
       601**DCL       787>>ASSIGN
OCI$KEYMON
       598**DCL-ENT   791--ASSIGN
OCI_BOOT
       614**DCL       794<<ASSIGN
OCI_PARAM
       612**DCL       789--ASSIGN
OCI_PARAM$
       613**DCL       788>>ASSIGN
OCI_STA
       582**DCL       792--ASSIGN
OCI_STA.MSGIDXT
       592**DCL       595--REDEF
Q$
       602**DCL       785<>CALL      786>>ASSIGN    787>>ASSIGN    788>>ASSIGN    789>>ASSIGN    790>>ASSIGN
       791>>ASSIGN    792>>ASSIGN    793>>ASSIGN    795>>CALL

PL6.E3A0      #005=OCI$SPINTCON File=OCI$MONKEY.:E05TSI                          WED 07/30/97 03:58 Page:95   
      512        1        /*M* OCI$SPINTCON  handle operator request from console if KEYIN isn't up yet */
      513        2        /*T***********************************************************/
      514        3        /*T*                                                         */
      515        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      516        5        /*T*                                                         */
      517        6        /*T***********************************************************/
      518        7        /*X* */
      519        8        %SET LISTSUB='1'B;
      520        9        /*F* NAME: OCI$SPINTCON
      521       10
      522       11             PURPOSE: To handle special interrupts from the system console
      523       12                      before KEYIN has been started
      524       13
      525       14             DESCRIPTION: A read with prompt of '!' is performed on the
      526       15                          system console with end action to a keyin-processing
      527       16                          routine specified.  This is to allow entry into
      528       17                          XDELTA before the system has come up or to retry
      529       18                          or error devices if there is a necessity to do so
      530       19                          during SYSMAK.
      531       20
      532       21             INTERFACE: NIQ$GET, NIO$QUE.
      533       22                        OCI$SPINTCON is called from KCL$OCINT
      534       23        */
      535       24        OCI$SPINTCON: PROC (NK$LDCT);
      536       25        /**/
      537       26        %INCLUDE NK$LDCT;
      538      128        %NK$LDCT (STCLASS="");
      539      174          %INCLUDE OC_DATA_R;
      540      183          %INCLUDE OCI_DATA_R;
      541      195          %INCLUDE N_FC_C;
      542      232          %INCLUDE N$REQ;
      543      306            %N$REQ (STCLASS="BASED(Q$)");
      544      364        /**/
      545      365    1   DCL NIQ$GET ENTRY(1) ALTRET;
      546      366    1   DCL NIO$QUE ENTRY(1) ALTRET;
      547      367    1   DCL OCI$KEYIN ENTRY(1);
      548      368    1   DCL Q$ PTR;
PL6.E3A0      #005=OCI$SPINTCON File=OCI$MONKEY.:E05TSI                          WED 07/30/97 03:58 Page:96   
      549      369        /*
      550      370                         Main
      551      371                                          */
      552      372    1   GET:
      553      373    1           CALL NIQ$GET (Q$) ALTRET (GET); /* get a queue packet pointer         */
      554      374    1           OCI_KEYIN = '!';                /* set prompt                         */
      555      375    1           N$REQ.OPFLG = '040'O|'010'O;     /* EA, BPF                            */
      556      376    1           IF ADDR(NK$LDCT)~=ADDR(NIL) THEN N$REQ.DLA.DCTX=NK$LDCT.RLCID.LDCTX;
      557      377    1           ELSE N$REQ.DLA.DCTX=B_SCDCTX;
      558      378    1           N$REQ.BUF$ = ADDR (OCI_KEYIN);  /* buffer address                     */
      559      379    1           N$REQ.BUFSIZE = SIZEC (OCI_KEYIN); /* buffer size                     */
      560      380    1           N$REQ.FC = %N_READ;             /* read with prompt                   */
      561      381    1           N$REQ.EAENTRY = ENTADDR (OCI$KEYIN); /* end action address            */
      562      382    1           N$REQ.EAINFOP$=ADDR(NK$LDCT);
      563      383    1           CALL NIO$QUE (N$REQ);
      564      384    1           RETURN;
      565      385    1   END OCI$SPINTCON;
      566      386        %EOD;

PL6.E3A0      #005=OCI$SPINTCON File=OCI$MONKEY.:E05TSI                          WED 07/30/97 03:58 Page:97   
--  Include file information  --

   N$REQ.:E05TOU  is referenced.
   N_FC_C.:E05TOU  is referenced.
   OCI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   OC_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NK$LDCT.:E05TOU  is referenced.
      No diagnostics issued in procedure OCI$SPINTCON.

   Procedure OCI$SPINTCON requires 51 words for executable code.
   Procedure OCI$SPINTCON requires 8 words of local(AUTO) storage.

PL6.E3A0      #005=OCI$SPINTCON File=OCI$MONKEY.:E05TSI                          WED 07/30/97 03:58 Page:98   

 Object Unit name= OCI$SPINTCON                               File name= OCI$MONKEY.:E05TOU
 UTS= JUL 30 '97 03:58:05.12 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none    51     63  OCI$SPINTCON
    1  RoData even  none     2      2  OCI$SPINTCON

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes            yes      Std        1  OCI$SPINTCON

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       1 NIQ$GET
 yes     yes           Std       1 NIO$QUE
         yes           Std       1 OCI$KEYIN
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     B_SCDCTX                         r    OCI_ROUTINE                           OCI_KEYIN
     B_VECTNIL
PL6.E3A0      #005=OCI$SPINTCON File=OCI$MONKEY.:E05TSI                          WED 07/30/97 03:58 Page:99   

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #005=OCI$SPINTCON File=OCI$MONKEY.:E05TSI                          WED 07/30/97 03:58 Page:100  


      512        1        /*M* OCI$SPINTCON  handle operator request from console if KEYIN isn't up yet */
      513        2        /*T***********************************************************/
      514        3        /*T*                                                         */
      515        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      516        5        /*T*                                                         */
      517        6        /*T***********************************************************/
      518        7        /*X* */
      519        8        %SET LISTSUB='1'B;
      520        9        /*F* NAME: OCI$SPINTCON
      521       10
      522       11             PURPOSE: To handle special interrupts from the system console
      523       12                      before KEYIN has been started
      524       13
      525       14             DESCRIPTION: A read with prompt of '!' is performed on the
      526       15                          system console with end action to a keyin-processing
      527       16                          routine specified.  This is to allow entry into
      528       17                          XDELTA before the system has come up or to retry
      529       18                          or error devices if there is a necessity to do so
      530       19                          during SYSMAK.
      531       20
      532       21             INTERFACE: NIQ$GET, NIO$QUE.
      533       22                        OCI$SPINTCON is called from KCL$OCINT
      534       23        */
      535       24        OCI$SPINTCON: PROC (NK$LDCT);

     24  0 000000   000000 700200 xent  OCI$SPINTCON TSX0  ! X66_AUTO_1
         0 000001   000010 000001                    ZERO    8,1

      536       25        /**/
      537       26        %INCLUDE NK$LDCT;
      538      128        %NK$LDCT (STCLASS="");
      539      174          %INCLUDE OC_DATA_R;
      540      183          %INCLUDE OCI_DATA_R;
      541      195          %INCLUDE N_FC_C;
      542      232          %INCLUDE N$REQ;
      543      306            %N$REQ (STCLASS="BASED(Q$)");
PL6.E3A0      #005=OCI$SPINTCON File=OCI$MONKEY.:E05TSI                          WED 07/30/97 03:58 Page:101  
      544      364        /**/
      545      365    1   DCL NIQ$GET ENTRY(1) ALTRET;
      546      366    1   DCL NIO$QUE ENTRY(1) ALTRET;
      547      367    1   DCL OCI$KEYIN ENTRY(1);
      548      368    1   DCL Q$ PTR;
      549      369        /*
      550      370                         Main
      551      371                                          */
      552      372    1   GET:
      553      373    1           CALL NIQ$GET (Q$) ALTRET (GET); /* get a queue packet pointer         */

    373  0 000002   200004 630500       GET          EPPR0   Q$,,AUTO
         0 000003   200006 450500                    STP0    Q$+2,,AUTO
         0 000004   200006 630500                    EPPR0   Q$+2,,AUTO
         0 000005   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000006   000000 701000 xent               TSX1    NIQ$GET
         0 000007   000002 702000 0                  TSX2    GET

      554      374    1           OCI_KEYIN = '!';                /* set prompt                         */

    374  0 000010   040000 100400                    MLR     fill='040'O
         0 000011   000000 000001 1                  ADSC9   0                        cn=0,n=1
         0 000012   000000 000120 xsym               ADSC9   OCI_KEYIN                cn=0,n=80

      555      375    1           N$REQ.OPFLG = '040'O|'010'O;     /* EA, BPF                            */

    375  0 000013   200004 470500                    LDP0    Q$,,AUTO
         0 000014   000050 236007                    LDQ     40,DL
         0 000015   000004 552104                    STBQ    4,'04'O,PR0

      556      376    1           IF ADDR(NK$LDCT)~=ADDR(NIL) THEN N$REQ.DLA.DCTX=NK$LDCT.RLCID.LDCTX;

    376  0 000016   200003 236100                    LDQ     @NK$LDCT,,AUTO
         0 000017   000001 116000 xsym               CMPQ    B_VECTNIL+1
         0 000020   000031 600000 0                  TZE     s:377

    376  0 000021   200004 470500                    LDP0    Q$,,AUTO
PL6.E3A0      #005=OCI$SPINTCON File=OCI$MONKEY.:E05TSI                          WED 07/30/97 03:58 Page:102  
         0 000022   200003 471500                    LDP1    @NK$LDCT,,AUTO
         0 000023   100015 236100                    LDQ     13,,PR1
         0 000024   000025 736000                    QLS     21
         0 000025   000001 676100                    ERQ     1,,PR0
         0 000026   777770 376003                    ANQ     -8,DU
         0 000027   000001 656100                    ERSQ    1,,PR0
         0 000030   000037 710000 0                  TRA     s:378

      557      377    1           ELSE N$REQ.DLA.DCTX=B_SCDCTX;

    377  0 000031   200004 470500                    LDP0    Q$,,AUTO
         0 000032   000000 236000 xsym               LDQ     B_SCDCTX
         0 000033   000025 736000                    QLS     21
         0 000034   000001 676100                    ERQ     1,,PR0
         0 000035   777770 376003                    ANQ     -8,DU
         0 000036   000001 656100                    ERSQ    1,,PR0

      558      378    1           N$REQ.BUF$ = ADDR (OCI_KEYIN);  /* buffer address                     */

    378  0 000037   000001 236000 1                  LDQ     1
         0 000040   200004 470500                    LDP0    Q$,,AUTO
         0 000041   000005 756100                    STQ     5,,PR0

      559      379    1           N$REQ.BUFSIZE = SIZEC (OCI_KEYIN); /* buffer size                     */

    379  0 000042   000004 236100                    LDQ     4,,PR0
         0 000043   177777 376007                    ANQ     65535,DL
         0 000044   000024 276003                    ORQ     20,DU
         0 000045   000004 756100                    STQ     4,,PR0

      560      380    1           N$REQ.FC = %N_READ;             /* read with prompt                   */

    380  0 000046   200004 470500                    LDP0    Q$,,AUTO
         0 000047   000014 236007                    LDQ     12,DL
         0 000050   000003 552104                    STBQ    3,'04'O,PR0

      561      381    1           N$REQ.EAENTRY = ENTADDR (OCI$KEYIN); /* end action address            */
PL6.E3A0      #005=OCI$SPINTCON File=OCI$MONKEY.:E05TSI                          WED 07/30/97 03:58 Page:103  

    381  0 000051   000000 636000 xent               EAQ     OCI$KEYIN
         0 000052   200004 470500                    LDP0    Q$,,AUTO
         0 000053   000023 756100                    STQ     19,,PR0

      562      382    1           N$REQ.EAINFOP$=ADDR(NK$LDCT);

    382  0 000054   200003 236100                    LDQ     @NK$LDCT,,AUTO
         0 000055   000024 756100                    STQ     20,,PR0

      563      383    1           CALL NIO$QUE (N$REQ);

    383  0 000056   200004 630500                    EPPR0   Q$,,AUTO
         0 000057   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000060   000000 701000 xent               TSX1    NIO$QUE
         0 000061   000000 011000                    NOP     0

      564      384    1           RETURN;

    384  0 000062   000000 702200 xent               TSX2  ! X66_ARET

(unnamed)
 Sect OctLoc
   1     000   041040 040040   000000 006000                                    !   ....
      565      385    1   END OCI$SPINTCON;
      566      386        %EOD;

PL6.E3A0      #005=OCI$SPINTCON File=OCI$MONKEY.:E05TSI                          WED 07/30/97 03:58 Page:104  
--  Include file information  --

   N$REQ.:E05TOU  is referenced.
   N_FC_C.:E05TOU  is referenced.
   OCI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   OC_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NK$LDCT.:E05TOU  is referenced.
      No diagnostics issued in procedure OCI$SPINTCON.
PL6.E3A0      #005=OCI$SPINTCON File=OCI$MONKEY.:E05TSI                          WED 07/30/97 03:58 Page:105  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @NK$LDCT                  *0-0-0/d STRC(864)   r     1 NK$LDCT
     4-0-0/w PTR         r     1 Q$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w UBIN        r     1 B_SCDCTX                   0-0-0/c CHAR(80)    r     1 OCI_KEYIN
     0-0-0/w EPTR        r     1 OCI_ROUTINE(0:8191)

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(1080)  r     1 N$REQ


   Procedure OCI$SPINTCON requires 51 words for executable code.
   Procedure OCI$SPINTCON requires 8 words of local(AUTO) storage.
PL6.E3A0      #005=OCI$SPINTCON File=OCI$MONKEY.:E05TSI                          WED 07/30/97 03:58 Page:106  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #005=OCI$SPINTCON File=OCI$MONKEY.:E05TSI                          WED 07/30/97 03:58 Page:107  
          MINI XREF LISTING

B_SCDCTX
       182**DCL       377>>ASSIGN
GET
       373**LABEL     373--CALLALT
N$REQ
       315**DCL       383<>CALL
N$REQ.BUF$
       324**DCL       378<<ASSIGN
N$REQ.BUFADDR
       324**DCL       325--REDEF     325--REDEF
N$REQ.BUFSIZE
       318**DCL       379<<ASSIGN
N$REQ.DLA.DCTX
       315**DCL       376<<ASSIGN    377<<ASSIGN
N$REQ.DLA.DRELADDR
       316**DCL       316--REDEF
N$REQ.DVE.EOMCHAR
       353**DCL       354--REDEF
N$REQ.EAENTRY
       346**DCL       381<<ASSIGN
N$REQ.EAINFO
       347**DCL       347--REDEF
N$REQ.EAINFOP$
       347**DCL       382<<ASSIGN
N$REQ.EAINFOX
       347**DCL       348--REDEF
N$REQ.EVNTINFO
       348**DCL       348--REDEF
N$REQ.FC
       318**DCL       380<<ASSIGN
N$REQ.OPFLG
       321**DCL       375<<ASSIGN
PL6.E3A0      #005=OCI$SPINTCON File=OCI$MONKEY.:E05TSI                          WED 07/30/97 03:58 Page:108  
N$REQ.STATUS
       329**DCL       335--REDEF
NIO$QUE
       366**DCL-ENT   383--CALL
NIQ$GET
       365**DCL-ENT   373--CALL
NK$LDCT
       141**DCL        24--PROC      376--IF        382--ASSIGN
NK$LDCT.DDT$
       143**DCL       143--REDEF
NK$LDCT.IOQ$
       142**DCL       143--REDEF
NK$LDCT.LDCTX
       144**DCL       144--REDEF
NK$LDCT.LKFLG.ABORTED
       156**DCL       157--REDEF
NK$LDCT.RLCID.LDCTX
       166**DCL       166--REDEF     376>>ASSIGN
NK$LDCT.STA$
       162**DCL       163--REDEF
NK$LDCT.SYMB$
       141**DCL       141--REDEF     141--REDEF     142--REDEF
OCI$KEYIN
       367**DCL-ENT   381--ASSIGN
OCI_KEYIN
       193**DCL       374<<ASSIGN    378--ASSIGN    379--ASSIGN
Q$
       368**DCL       315--IMP-PTR   373<>CALL      375>>ASSIGN    376>>ASSIGN    377>>ASSIGN    378>>ASSIGN
       379>>ASSIGN    380>>ASSIGN    381>>ASSIGN    382>>ASSIGN    383>>CALL

PL6.E3A0      #006=OCI$KEYIN File=OCI$MONKEY.:E05TSI                             WED 07/30/97 03:58 Page:109  
      567        1        /*M* OCI$KEYIN  handle keyins if KEYIN isn't running yet */
      568        2        /*T***********************************************************/
      569        3        /*T*                                                         */
      570        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      571        5        /*T*                                                         */
      572        6        /*T***********************************************************/
      573        7        /*X* */
      574        8        %SET LISTSUB='1'B;
      575        9        /*F* NAME: OCI$KEYIN
      576       10
      577       11             PURPOSE: To handle keyins which are entered before KEYIN has
      578       12                      been started
      579       13
      580       14             DESCRIPTION: If nothing or only blanks has been entered,
      581       15                          the request is ignored.  If the keyin is recognized
      582       16                          as legal, the proper routine to process the keyin is
      583       17                          called.  If the keyin is not recognized or a processing
      584       18                          routine ALTRETURNS, the message " Eh?" is output.
      585       19                          Legal keyins are:
      586       20
      587       21                               !DELTA
      588       22                               !RETRY device
      589       23                               !PROCEED device
      590       24                               !FIRMLOAD device
      591       25                               !DIE!               (operator recovery)
      592       26                               !NOUSERS!
      593       27                               !ERROR device
      594       28
      595       29             INTERFACE: NIK$KEYIN, NIO$QUE, OCX$XDELTA, OCA$KMISC
      596       30                                                                           */
      597       31        OCI$KEYIN: PROC (N$REQ);
      598       32    1   DCL ZEROES CHAR(4) STATIC INIT('0000');
      599       33                                                /**/
      600       34                                                /**/
      601       35          %INCLUDE OC_SUBS_C;
      602      766        %INCLUDE OCI_SUBS_C;
      603      864          %INCLUDE OCI_DATA_R;
PL6.E3A0      #006=OCI$KEYIN File=OCI$MONKEY.:E05TSI                             WED 07/30/97 03:58 Page:110  
      604      876          %INCLUDE N_FC_C;
      605      913          %INCLUDE N$REQ;
      606      987            %N$REQ (STCLASS="");
      607     1045        %INCLUDE NK$LDCT;
      608     1147        %INCLUDE SS_SCHED_R;
      609     1190        %INCLUDE OC_DATA_R;
      610     1199        %NK$LDCT;
      611     1245        %INCLUDE KC_CP6;
      612     1805        %EQU_CG;
      613     1853        %INCLUDE B$TABLES_C;
      614     1961            %B$XL_UPPER;
      615     1965        /**/
      616     1966    1   DCL NIO$QUE ENTRY(1) ALTRET;
      617     1967    1   DCL NIK$KEYIN ENTRY(1) ALTRET;
      618     1968    1   DCL OCX$XDELTA ENTRY;
      619     1969    1   DCL KQP$EVNT ENTRY(2) ALTRET;
      620     1970    1   DCL OCA$KMISC ENTRY(1) ALTRET;
      621     1971    1   DCL OCA_SAVE_TUIS SBIN SYMREF;
      622     1972                                                /**/
      623     1973    1   DCL SC_OCOPERRECOV ENTRY CONV(2,0);
      624     1974                                                /**/
      625     1975    1   DCL I SBIN WORD STATIC;
      626     1976    1   DCL LEN UBIN WORD STATIC;
      627     1977    1   DCL POSN UBIN WORD STATIC;
      628     1978    1   DCL EH CHAR(4) STATIC INIT(' Eh?');
      629     1979    1   DCL FIELD CHAR(80) STATIC;
      630     1980    1   DCL LETTER CHAR(1) STATIC;
      631     1981    1   DCL 1 OCI_PARAM2,
      632     1982    1         2 RTN# UBIN(9) UNAL,
      633     1983    1         2 KIN# UBIN(9) UNAL,
      634     1984    1         2 CADDR UBIN(18) UNAL,
      635     1985    1         2 BUF CHAR(40) UNAL;
      636     1986                                                /**/
      637     1987    1   DCL ESCESCB BIT(18) CONSTANT INIT('033033'O);
      638     1988    1   DCL ESCESC REDEF ESCESCB CHAR(2);
      639     1989    1   DCL YCYCB BIT(18) CONSTANT INIT('031031'O);
      640     1990    1   DCL YCYC REDEF YCYCB CHAR(2);
PL6.E3A0      #006=OCI$KEYIN File=OCI$MONKEY.:E05TSI                             WED 07/30/97 03:58 Page:111  
      641     1991        /*
      642     1992                                           */
      643     1993    1   GET_FIELD: PROC;
      644     1994    2           LEN = 0;
      645     1995    2           FIELD = ' ';
      646     1996    3           DO I = POSN TO (N$REQ.ARSIZE - 1);
      647     1997    3              IF SUBSTR (OCI_KEYIN, I, 1) ~= ' ' THEN
      648     1998    4              DO I = I TO (N$REQ.ARSIZE - 1);
      649     1999    4                 LETTER = SUBSTR (OCI_KEYIN, I, 1);
      650     2000    4                 IF LETTER ~= ' ' THEN
      651     2001    5                 DO;
      652     2002    5                    CALL INSERT (FIELD, LEN, 1, LETTER);
      653     2003    5                    LEN = LEN + 1;
      654     2004    5                    END;
      655     2005    4                 ELSE
      656     2006    5                 DO;
      657     2007    5                    POSN = I;
      658     2008    5                    RETURN;
      659     2009    5                    END;
      660     2010    4                 END;
      661     2011    3              END;
      662     2012    2           POSN = N$REQ.ARSIZE;
      663     2013    2           RETURN;
      664     2014    2   END GET_FIELD;
      665     2015        /*
      666     2016                   Main
      667     2017                               */
      668     2018    2           DO INHIBIT;
      669     2019    2              IF OCI_INT THEN RETURN;
      670     2020    2              ELSE
      671     2021    2                 OCI_INT = '1'B /*TRUE#*/;
      672     2022    2              END;
      673     2023    1           CALL XLATE (OCI_KEYIN, B$XL_UPPER, OCI_KEYIN);
      674     2024    1           POSN = 0;
      675     2025    1           CALL GET_FIELD;
      676     2026    2           IF LEN=0 AND N$REQ.EAINFOP$~=ADDR(NIL) THEN DO;
      677     2027    2              CALL KQP$EVNT (N$REQ.EAINFOP$->NK$LDCT,%CG_TBRK_BRK#);
PL6.E3A0      #006=OCI$KEYIN File=OCI$MONKEY.:E05TSI                             WED 07/30/97 03:58 Page:112  
      678     2028    2              GOTO RETURN_;
      679     2029    2              END;
      680     2030    1           IF FIELD = 'DELTA'
      681     2031    1             OR
      682     2032    1             FIELD = ESCESC
      683     2033    1             OR
      684     2034    1             FIELD = YCYC
      685     2035    1           THEN
      686     2036    2           DO;
      687     2037    2              CALL OCX$XDELTA;
      688     2038    2              GOTO RETURN_;
      689     2039    2              END;
      690     2040                                                /**/
      691     2041    1           IF FIELD ='DIE!'
      692     2042    1           THEN
      693     2043    2           DO;
      694     2044    2              IF B_ZIP ~= 0
      695     2045    2              THEN
      696     2046    3              DO;
      697     2047    3                 S_TUIS = OCA_SAVE_TUIS;
      698     2048    3                 END;
      699     2049    2              CALL SC_OCOPERRECOV;         /* NO RETURN FROM HERE!               */
      700     2050    2              END;                         /* DO IF DIE!                         */
      701     2051                                                /**/
      702     2052    1           IF FIELD = 'NOUSERS!'
      703     2053    2           THEN DO;
      704     2054    2              OCI_PARAM2.RTN#=0;
      705     2055    2              OCI_PARAM2.KIN#=12 /* KEY_NOUSERS# */;
      706     2056    2              CALL OCA$KMISC (OCI_PARAM2) ALTRET(EH_);
      707     2057    2              GOTO RETURN_;
      708     2058    2              END;
      709     2059    1           IF FIELD = 'PROCEED'
      710     2060    1           THEN
      711     2061    1              OCI_PARAM2.KIN# = 20 /* KEY_PROCEED# */;
      712     2062    1           ELSE
      713     2063    1              IF FIELD = 'RETRY'
      714     2064    1              THEN
PL6.E3A0      #006=OCI$KEYIN File=OCI$MONKEY.:E05TSI                             WED 07/30/97 03:58 Page:113  
      715     2065    1                 OCI_PARAM2.KIN# = 18 /* KEY_RETRY# */;
      716     2066    1              ELSE
      717     2067    1                 IF FIELD = 'ERROR'
      718     2068    1                 THEN
      719     2069    1                    OCI_PARAM2.KIN# = 19 /* KEY_ERROR# */;
      720     2070    1                 ELSE
      721     2071    1                    IF FIELD = 'FIRMLOAD'
      722     2072    1                    THEN
      723     2073    1                       OCI_PARAM2.KIN# = 22 /* KEY_FIRMLOAD# */;
      724     2074    1                    ELSE
      725     2075    1                       GOTO EH_;
      726     2076    1           CALL GET_FIELD;
      727     2077    1           IF LEN = 0
      728     2078    1             OR LEN > 4
      729     2079    1           THEN
      730     2080    1              GOTO EH_;
      731     2081    1           CALL INSERT (OCI_PARAM2.BUF,0,4,FIELD);
      732     2082    1           CALL INSERT (OCI_PARAM2.BUF,4,4,ZEROES);
      733     2083    1           OCI_PARAM2.RTN# = 0;
      734     2084    1           CALL NIK$KEYIN (OCI_PARAM2) ALTRET (EH_);
      735     2085    1   RETURN_:
      736     2086    2           DO INHIBIT;
      737     2087    2              OCI_INT = '0'B /*FALSE#*/;
      738     2088    2              RETURN;
      739     2089    2              END;                         /* INHIBIT                            */
      740     2090    1   EH_:
      741     2091    1           N$REQ.OPFLG = '002'O | '010'O ; /* RE-WORK FLAGS IN PACKET            */
      742     2092    1           N$REQ.BUF$ = ADDR (EH);         /* buffer address                     */
      743     2093    1           N$REQ.BUFSIZE = 4;              /* buffer size                        */
      744     2094    1           N$REQ.FC = %N_WRITE;            /* write with CR/LF                   */
      745     2095    1           GOTO RETURN_;
      746     2096    1   END OCI$KEYIN;

PL6.E3A0      #006=OCI$KEYIN File=OCI$MONKEY.:E05TSI                             WED 07/30/97 03:58 Page:114  
--  Include file information  --

   B$TABLES_C.:E05TOU  cannot be made into a system file and is referenced.
   KC_CP6.:E05TOU  is referenced.
   OC_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   SS_CNTRLD_R.:E05TOU  cannot be made into a system file and is referenced.
   SS_CNTRL_R.:E05TOU  cannot be made into a system file and is referenced.
   SS_SCHED_R.:E05TOU  cannot be made into a system file and is referenced.
   NK$LDCT.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   N_FC_C.:E05TOU  is referenced.
   OCI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   OCI_SUBS_C.:E05TOU  is referenced.
   OC_SUBS_C.:E05TOU  is referenced.
      No diagnostics issued in procedure OCI$KEYIN.

   Procedure OCI$KEYIN requires 179 words for executable code.
   Procedure OCI$KEYIN requires 20 words of local(AUTO) storage.

    No errors detected in file OCI$MONKEY.:E05TSI    .

PL6.E3A0      #006=OCI$KEYIN File=OCI$MONKEY.:E05TSI                             WED 07/30/97 03:58 Page:115  

 Object Unit name= OCI$KEYIN                                  File name= OCI$MONKEY.:E05TOU
 UTS= JUL 30 '97 03:58:16.48 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Data  even  none    26     32  OCI$KEYIN
    1  RoData even  UTS     15     17  OCI$KEYIN
    2   Proc  even  none   179    263  OCI$KEYIN
    3  RoData even  none     2      2  OCI$KEYIN

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     2      0   yes            yes      Std        1  OCI$KEYIN

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes          ~proc      0 B_POINTER
 yes     yes           Std       2 KQP$EVNT
         yes           Std       0 OCX$XDELTA
 yes     yes           Std       1 NIK$KEYIN
 yes     yes           Std       1 OCA$KMISC
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
PL6.E3A0      #006=OCI$KEYIN File=OCI$MONKEY.:E05TSI                             WED 07/30/97 03:58 Page:116  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_OCOPERRECOV                   r    OCI_ROUTINE                           OCI_KEYIN
     OCI_INT                               S_TUIS                                B_ZIP
r    B$XL_UPPER$                           OCA_SAVE_TUIS                         B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ASLENTSID                             ISSID
PL6.E3A0      #006=OCI$KEYIN File=OCI$MONKEY.:E05TSI                             WED 07/30/97 03:58 Page:117  


      567        1        /*M* OCI$KEYIN  handle keyins if KEYIN isn't running yet */
      568        2        /*T***********************************************************/
      569        3        /*T*                                                         */
      570        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      571        5        /*T*                                                         */
      572        6        /*T***********************************************************/
      573        7        /*X* */
      574        8        %SET LISTSUB='1'B;
      575        9        /*F* NAME: OCI$KEYIN
      576       10
      577       11             PURPOSE: To handle keyins which are entered before KEYIN has
      578       12                      been started
      579       13
      580       14             DESCRIPTION: If nothing or only blanks has been entered,
      581       15                          the request is ignored.  If the keyin is recognized
      582       16                          as legal, the proper routine to process the keyin is
      583       17                          called.  If the keyin is not recognized or a processing
      584       18                          routine ALTRETURNS, the message " Eh?" is output.
      585       19                          Legal keyins are:
      586       20
      587       21                               !DELTA
      588       22                               !RETRY device
      589       23                               !PROCEED device
      590       24                               !FIRMLOAD device
      591       25                               !DIE!               (operator recovery)
      592       26                               !NOUSERS!
      593       27                               !ERROR device
      594       28
      595       29             INTERFACE: NIK$KEYIN, NIO$QUE, OCX$XDELTA, OCA$KMISC
      596       30                                                                           */
      597       31        OCI$KEYIN: PROC (N$REQ);

     31  2 000000   000000 700200 xent  OCI$KEYIN    TSX0  ! X66_AUTO_1
         2 000001   000024 000001                    ZERO    20,1
         2 000002   000062 710000 2                  TRA     s:2019

PL6.E3A0      #006=OCI$KEYIN File=OCI$MONKEY.:E05TSI                             WED 07/30/97 03:58 Page:118  
      598       32    1   DCL ZEROES CHAR(4) STATIC INIT('0000');
      599       33                                                /**/
      600       34                                                /**/
      601       35          %INCLUDE OC_SUBS_C;
      602      766        %INCLUDE OCI_SUBS_C;
      603      864          %INCLUDE OCI_DATA_R;
      604      876          %INCLUDE N_FC_C;
      605      913          %INCLUDE N$REQ;
      606      987            %N$REQ (STCLASS="");
      607     1045        %INCLUDE NK$LDCT;
      608     1147        %INCLUDE SS_SCHED_R;
      609     1190        %INCLUDE OC_DATA_R;
      610     1199        %NK$LDCT;
      611     1245        %INCLUDE KC_CP6;
      612     1805        %EQU_CG;
      613     1853        %INCLUDE B$TABLES_C;
      614     1961            %B$XL_UPPER;
      615     1965        /**/
      616     1966    1   DCL NIO$QUE ENTRY(1) ALTRET;
      617     1967    1   DCL NIK$KEYIN ENTRY(1) ALTRET;
      618     1968    1   DCL OCX$XDELTA ENTRY;
      619     1969    1   DCL KQP$EVNT ENTRY(2) ALTRET;
      620     1970    1   DCL OCA$KMISC ENTRY(1) ALTRET;
      621     1971    1   DCL OCA_SAVE_TUIS SBIN SYMREF;
      622     1972                                                /**/
      623     1973    1   DCL SC_OCOPERRECOV ENTRY CONV(2,0);
      624     1974                                                /**/
      625     1975    1   DCL I SBIN WORD STATIC;
      626     1976    1   DCL LEN UBIN WORD STATIC;
      627     1977    1   DCL POSN UBIN WORD STATIC;
      628     1978    1   DCL EH CHAR(4) STATIC INIT(' Eh?');
      629     1979    1   DCL FIELD CHAR(80) STATIC;
      630     1980    1   DCL LETTER CHAR(1) STATIC;
      631     1981    1   DCL 1 OCI_PARAM2,
      632     1982    1         2 RTN# UBIN(9) UNAL,
      633     1983    1         2 KIN# UBIN(9) UNAL,
      634     1984    1         2 CADDR UBIN(18) UNAL,
PL6.E3A0      #006=OCI$KEYIN File=OCI$MONKEY.:E05TSI                             WED 07/30/97 03:58 Page:119  
      635     1985    1         2 BUF CHAR(40) UNAL;
      636     1986                                                /**/
      637     1987    1   DCL ESCESCB BIT(18) CONSTANT INIT('033033'O);
      638     1988    1   DCL ESCESC REDEF ESCESCB CHAR(2);
      639     1989    1   DCL YCYCB BIT(18) CONSTANT INIT('031031'O);
      640     1990    1   DCL YCYC REDEF YCYCB CHAR(2);
      641     1991        /*
      642     1992                                           */
      643     1993    1   GET_FIELD: PROC;

   1993  2 000003   200020 741300       GET_FIELD    STX1  ! OCI_PARAM2+12,,AUTO

      644     1994    2           LEN = 0;

   1994  2 000004   000002 450000 0                  STZ     LEN

      645     1995    2           FIELD = ' ';

   1995  2 000005   040000 100400                    MLR     fill='040'O
         2 000006   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 000007   000005 000120 0                  ADSC9   FIELD                    cn=0,n=80

      646     1996    3           DO I = POSN TO (N$REQ.ARSIZE - 1);

   1996  2 000010   000003 235000 0                  LDA     POSN
         2 000011   000001 755000 0                  STA     I
         2 000012   000052 710000 2                  TRA     s:2011+1

      647     1997    3              IF SUBSTR (OCI_KEYIN, I, 1) ~= ' ' THEN

   1997  2 000013   000001 235000 0                  LDA     I
         2 000014   040000 106405                    CMPC    fill='040'O
         2 000015   000000 000001 xsym               ADSC9   OCI_KEYIN,A              cn=0,n=1
         2 000016   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 000017   000051 600000 2                  TZE     s:2011

      648     1998    4              DO I = I TO (N$REQ.ARSIZE - 1);
PL6.E3A0      #006=OCI$KEYIN File=OCI$MONKEY.:E05TSI                             WED 07/30/97 03:58 Page:120  

   1998  2 000020   000044 710000 2                  TRA     s:2010+1

      649     1999    4                 LETTER = SUBSTR (OCI_KEYIN, I, 1);

   1999  2 000021   000001 235000 0                  LDA     I
         2 000022   040000 100405                    MLR     fill='040'O
         2 000023   000000 000001 xsym               ADSC9   OCI_KEYIN,A              cn=0,n=1
         2 000024   000031 000001 0                  ADSC9   LETTER                   cn=0,n=1

      650     2000    4                 IF LETTER ~= ' ' THEN

   2000  2 000025   000031 236000 0                  LDQ     LETTER
         2 000026   777000 376003                    ANQ     -512,DU
         2 000027   040000 116003                    CMPQ    16384,DU
         2 000030   000040 600000 2                  TZE     s:2007

      651     2001    5                 DO;

      652     2002    5                    CALL INSERT (FIELD, LEN, 1, LETTER);

   2002  2 000031   000002 236000 0                  LDQ     LEN
         2 000032   040006 100400                    MLR     fill='040'O
         2 000033   000031 000001 0                  ADSC9   LETTER                   cn=0,n=1
         2 000034   000005 000001 0                  ADSC9   FIELD,Q                  cn=0,n=1

      653     2003    5                    LEN = LEN + 1;

   2003  2 000035   000001 036007                    ADLQ    1,DL
         2 000036   000002 756000 0                  STQ     LEN

      654     2004    5                    END;

   2004  2 000037   000043 710000 2                  TRA     s:2010

      655     2005    4                 ELSE
      656     2006    5                 DO;
PL6.E3A0      #006=OCI$KEYIN File=OCI$MONKEY.:E05TSI                             WED 07/30/97 03:58 Page:121  

      657     2007    5                    POSN = I;

   2007  2 000040   000003 755000 0                  STA     POSN

      658     2008    5                    RETURN;

   2008  2 000041   200020 221300                    LDX1  ! OCI_PARAM2+12,,AUTO
         2 000042   000001 702211                    TSX2  ! 1,X1

      659     2009    5                    END;
      660     2010    4                 END;

   2010  2 000043   000001 054000 0                  AOS     I
         2 000044   200003 470500                    LDP0    @N$REQ,,AUTO
         2 000045   000027 236100                    LDQ     23,,PR0
         2 000046   000020 772000                    QRL     16
         2 000047   000001 116000 0                  CMPQ    I
         2 000050   000021 605400 2                  TPNZ    s:1999

      661     2011    3              END;

   2011  2 000051   000001 054000 0                  AOS     I
         2 000052   200003 470500                    LDP0    @N$REQ,,AUTO
         2 000053   000027 236100                    LDQ     23,,PR0
         2 000054   000020 772000                    QRL     16
         2 000055   000001 116000 0                  CMPQ    I
         2 000056   000013 605400 2                  TPNZ    s:1997

      662     2012    2           POSN = N$REQ.ARSIZE;

   2012  2 000057   000003 756000 0                  STQ     POSN

      663     2013    2           RETURN;

   2013  2 000060   200020 221300                    LDX1  ! OCI_PARAM2+12,,AUTO
         2 000061   000001 702211                    TSX2  ! 1,X1
PL6.E3A0      #006=OCI$KEYIN File=OCI$MONKEY.:E05TSI                             WED 07/30/97 03:58 Page:122  

      664     2014    2   END GET_FIELD;
      665     2015        /*
      666     2016                   Main
      667     2017                               */
      668     2018    2           DO INHIBIT;

      669     2019    2              IF OCI_INT THEN RETURN;

   2019  2 000062   000000 234200 xsym               SZN   ! OCI_INT
         2 000063   000065 605200 2                  TPL   ! s:2021

   2019  2 000064   000000 702200 xent               TSX2  ! X66_ARET

      670     2020    2              ELSE
      671     2021    2                 OCI_INT = '1'B /*TRUE#*/;

   2021  2 000065   400000 236203                    LDQ   ! -131072,DU
         2 000066   000000 756200 xsym               STQ   ! OCI_INT

      672     2022    2              END;

      673     2023    1           CALL XLATE (OCI_KEYIN, B$XL_UPPER, OCI_KEYIN);

   2023  2 000067   000000 470400 xsym               LDP0    B$XL_UPPER$
         2 000070   040000 160400                    MVT     fill='040'O
         2 000071   000000 000120 xsym               ADSC9   OCI_KEYIN                cn=0,n=80
         2 000072   000000 000120 xsym               ADSC9   OCI_KEYIN                cn=0,n=80
         2 000073   000000 000100                    ARG     0,,PR0

      674     2024    1           POSN = 0;

   2024  2 000074   000003 450000 0                  STZ     POSN

      675     2025    1           CALL GET_FIELD;

   2025  2 000075   000003 701000 2                  TSX1    GET_FIELD
PL6.E3A0      #006=OCI$KEYIN File=OCI$MONKEY.:E05TSI                             WED 07/30/97 03:58 Page:123  
         2 000076   000000 011000                    NOP     0

      676     2026    2           IF LEN=0 AND N$REQ.EAINFOP$~=ADDR(NIL) THEN DO;

   2026  2 000077   000002 235000 0                  LDA     LEN
         2 000100   000116 601000 2                  TNZ     s:2030
         2 000101   200003 470500                    LDP0    @N$REQ,,AUTO
         2 000102   000024 236100                    LDQ     20,,PR0
         2 000103   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 000104   000116 600000 2                  TZE     s:2030

      677     2027    2              CALL KQP$EVNT (N$REQ.EAINFOP$->NK$LDCT,%CG_TBRK_BRK#);

   2027  2 000105   000024 471500                    LDP1    20,,PR0
         2 000106   000000 236000 3                  LDQ     0
         2 000107   200023 756100                    STQ     OCI_PARAM2+15,,AUTO
         2 000110   200022 451500                    STP1    OCI_PARAM2+14,,AUTO
         2 000111   200022 630500                    EPPR0   OCI_PARAM2+14,,AUTO
         2 000112   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000113   000000 701000 xent               TSX1    KQP$EVNT
         2 000114   000000 011000                    NOP     0

      678     2028    2              GOTO RETURN_;

   2028  2 000115   000245 710000 2                  TRA     RETURN_

      679     2029    2              END;
      680     2030    1           IF FIELD = 'DELTA'

   2030  2 000116   040000 106400                    CMPC    fill='040'O
         2 000117   000005 000120 0                  ADSC9   FIELD                    cn=0,n=80
         2 000120   000002 000005 1                  ADSC9   YCYCB+1                  cn=0,n=5
         2 000121   000132 600000 2                  TZE     s:2037
         2 000122   040000 106400                    CMPC    fill='040'O
         2 000123   000005 000120 0                  ADSC9   FIELD                    cn=0,n=80
         2 000124   000000 000002 1                  ADSC9   ESCESCB                  cn=0,n=2
         2 000125   000132 600000 2                  TZE     s:2037
PL6.E3A0      #006=OCI$KEYIN File=OCI$MONKEY.:E05TSI                             WED 07/30/97 03:58 Page:124  
         2 000126   040000 106400                    CMPC    fill='040'O
         2 000127   000005 000120 0                  ADSC9   FIELD                    cn=0,n=80
         2 000130   000001 000002 1                  ADSC9   YCYCB                    cn=0,n=2
         2 000131   000136 601000 2                  TNZ     s:2041

      681     2031    1             OR
      682     2032    1             FIELD = ESCESC
      683     2033    1             OR
      684     2034    1             FIELD = YCYC
      685     2035    1           THEN
      686     2036    2           DO;

      687     2037    2              CALL OCX$XDELTA;

   2037  2 000132   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000133   000000 701000 xent               TSX1    OCX$XDELTA
         2 000134   000000 011000                    NOP     0

      688     2038    2              GOTO RETURN_;

   2038  2 000135   000245 710000 2                  TRA     RETURN_

      689     2039    2              END;
      690     2040                                                /**/
      691     2041    1           IF FIELD ='DIE!'

   2041  2 000136   040000 106400                    CMPC    fill='040'O
         2 000137   000005 000120 0                  ADSC9   FIELD                    cn=0,n=80
         2 000140   000004 000004 1                  ADSC9   YCYCB+3                  cn=0,n=4
         2 000141   000150 601000 2                  TNZ     s:2052

      692     2042    1           THEN
      693     2043    2           DO;

      694     2044    2              IF B_ZIP ~= 0

   2044  2 000142   000000 236000 xsym               LDQ     B_ZIP
PL6.E3A0      #006=OCI$KEYIN File=OCI$MONKEY.:E05TSI                             WED 07/30/97 03:58 Page:125  
         2 000143   000146 600000 2                  TZE     s:2049

      695     2045    2              THEN
      696     2046    3              DO;

      697     2047    3                 S_TUIS = OCA_SAVE_TUIS;

   2047  2 000144   000000 235000 xsym               LDA     OCA_SAVE_TUIS
         2 000145   000000 755000 xsym               STA     S_TUIS

      698     2048    3                 END;

      699     2049    2              CALL SC_OCOPERRECOV;         /* NO RETURN FROM HERE!               */

   2049  2 000146   000000 713400 xsym               CLIMB   SC_OCOPERRECOV
         2 000147   000000 600000 xsid               climb   nvectors=         0

      700     2050    2              END;                         /* DO IF DIE!                         */

      701     2051                                                /**/
      702     2052    1           IF FIELD = 'NOUSERS!'

   2052  2 000150   040000 106400                    CMPC    fill='040'O
         2 000151   000005 000120 0                  ADSC9   FIELD                    cn=0,n=80
         2 000152   000005 000010 1                  ADSC9   YCYCB+4                  cn=0,n=8
         2 000153   000167 601000 2                  TNZ     s:2059

      703     2053    2           THEN DO;

      704     2054    2              OCI_PARAM2.RTN#=0;

   2054  2 000154   000000 236003                    LDQ     0,DU
         2 000155   200004 552140                    STBQ    OCI_PARAM2,'40'O,AUTO

      705     2055    2              OCI_PARAM2.KIN#=12 /* KEY_NOUSERS# */;

   2055  2 000156   000014 236003                    LDQ     12,DU
PL6.E3A0      #006=OCI$KEYIN File=OCI$MONKEY.:E05TSI                             WED 07/30/97 03:58 Page:126  
         2 000157   200004 552120                    STBQ    OCI_PARAM2,'20'O,AUTO

      706     2056    2              CALL OCA$KMISC (OCI_PARAM2) ALTRET(EH_);

   2056  2 000160   200004 630500                    EPPR0   OCI_PARAM2,,AUTO
         2 000161   200022 450500                    STP0    OCI_PARAM2+14,,AUTO
         2 000162   200022 630500                    EPPR0   OCI_PARAM2+14,,AUTO
         2 000163   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000164   000000 701000 xent               TSX1    OCA$KMISC
         2 000165   000247 702000 2                  TSX2    EH_

      707     2057    2              GOTO RETURN_;

   2057  2 000166   000245 710000 2                  TRA     RETURN_

      708     2058    2              END;
      709     2059    1           IF FIELD = 'PROCEED'

   2059  2 000167   040000 106400                    CMPC    fill='040'O
         2 000170   000005 000120 0                  ADSC9   FIELD                    cn=0,n=80
         2 000171   000007 000007 1                  ADSC9   YCYCB+6                  cn=0,n=7
         2 000172   000176 601000 2                  TNZ     s:2063

      710     2060    1           THEN
      711     2061    1              OCI_PARAM2.KIN# = 20 /* KEY_PROCEED# */;

   2061  2 000173   000024 236003                    LDQ     20,DU
         2 000174   200004 552120                    STBQ    OCI_PARAM2,'20'O,AUTO
         2 000175   000223 710000 2                  TRA     s:2076

      712     2062    1           ELSE
      713     2063    1              IF FIELD = 'RETRY'

   2063  2 000176   040000 106400                    CMPC    fill='040'O
         2 000177   000005 000120 0                  ADSC9   FIELD                    cn=0,n=80
         2 000200   000011 000005 1                  ADSC9   YCYCB+8                  cn=0,n=5
         2 000201   000205 601000 2                  TNZ     s:2067
PL6.E3A0      #006=OCI$KEYIN File=OCI$MONKEY.:E05TSI                             WED 07/30/97 03:58 Page:127  

      714     2064    1              THEN
      715     2065    1                 OCI_PARAM2.KIN# = 18 /* KEY_RETRY# */;

   2065  2 000202   000022 236003                    LDQ     18,DU
         2 000203   200004 552120                    STBQ    OCI_PARAM2,'20'O,AUTO
         2 000204   000223 710000 2                  TRA     s:2076

      716     2066    1              ELSE
      717     2067    1                 IF FIELD = 'ERROR'

   2067  2 000205   040000 106400                    CMPC    fill='040'O
         2 000206   000005 000120 0                  ADSC9   FIELD                    cn=0,n=80
         2 000207   000013 000005 1                  ADSC9   YCYCB+10                 cn=0,n=5
         2 000210   000214 601000 2                  TNZ     s:2071

      718     2068    1                 THEN
      719     2069    1                    OCI_PARAM2.KIN# = 19 /* KEY_ERROR# */;

   2069  2 000211   000023 236003                    LDQ     19,DU
         2 000212   200004 552120                    STBQ    OCI_PARAM2,'20'O,AUTO
         2 000213   000223 710000 2                  TRA     s:2076

      720     2070    1                 ELSE
      721     2071    1                    IF FIELD = 'FIRMLOAD'

   2071  2 000214   040000 106400                    CMPC    fill='040'O
         2 000215   000005 000120 0                  ADSC9   FIELD                    cn=0,n=80
         2 000216   000015 000010 1                  ADSC9   YCYCB+12                 cn=0,n=8
         2 000217   000247 601000 2                  TNZ     EH_

      722     2072    1                    THEN
      723     2073    1                       OCI_PARAM2.KIN# = 22 /* KEY_FIRMLOAD# */;

   2073  2 000220   000026 236003                    LDQ     22,DU
         2 000221   200004 552120                    STBQ    OCI_PARAM2,'20'O,AUTO
         2 000222   000223 710000 2                  TRA     s:2076
PL6.E3A0      #006=OCI$KEYIN File=OCI$MONKEY.:E05TSI                             WED 07/30/97 03:58 Page:128  

      724     2074    1                    ELSE
      725     2075    1                       GOTO EH_;
      726     2076    1           CALL GET_FIELD;

   2076  2 000223   000003 701000 2                  TSX1    GET_FIELD
         2 000224   000000 011000                    NOP     0

      727     2077    1           IF LEN = 0

   2077  2 000225   000002 235000 0                  LDA     LEN
         2 000226   000247 600000 2                  TZE     EH_
         2 000227   000005 115007                    CMPA    5,DL
         2 000230   000247 603000 2                  TRC     EH_

      728     2078    1             OR LEN > 4
      729     2079    1           THEN
      730     2080    1              GOTO EH_;
      731     2081    1           CALL INSERT (OCI_PARAM2.BUF,0,4,FIELD);

   2081  2 000231   000005 236000 0                  LDQ     FIELD
         2 000232   200005 756100                    STQ     OCI_PARAM2+1,,AUTO

      732     2082    1           CALL INSERT (OCI_PARAM2.BUF,4,4,ZEROES);

   2082  2 000233   000000 236000 0                  LDQ     ZEROES
         2 000234   200006 756100                    STQ     OCI_PARAM2+2,,AUTO

      733     2083    1           OCI_PARAM2.RTN# = 0;

   2083  2 000235   000000 236003                    LDQ     0,DU
         2 000236   200004 552140                    STBQ    OCI_PARAM2,'40'O,AUTO

      734     2084    1           CALL NIK$KEYIN (OCI_PARAM2) ALTRET (EH_);

   2084  2 000237   200004 630500                    EPPR0   OCI_PARAM2,,AUTO
         2 000240   200022 450500                    STP0    OCI_PARAM2+14,,AUTO
PL6.E3A0      #006=OCI$KEYIN File=OCI$MONKEY.:E05TSI                             WED 07/30/97 03:58 Page:129  
         2 000241   200022 630500                    EPPR0   OCI_PARAM2+14,,AUTO
         2 000242   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 000243   000000 701000 xent               TSX1    NIK$KEYIN
         2 000244   000247 702000 2                  TSX2    EH_

      735     2085    1   RETURN_:
      736     2086    2           DO INHIBIT;

   2086  2 000245                       RETURN_      null
      737     2087    2              OCI_INT = '0'B /*FALSE#*/;

   2087  2 000245   000000 450200 xsym               STZ   ! OCI_INT

      738     2088    2              RETURN;

   2088  2 000246   000000 702200 xent               TSX2  ! X66_ARET

      739     2089    2              END;                         /* INHIBIT                            */

      740     2090    1   EH_:
      741     2091    1           N$REQ.OPFLG = '002'O | '010'O ; /* RE-WORK FLAGS IN PACKET            */

   2091  2 000247   200003 470500       EH_          LDP0    @N$REQ,,AUTO
         2 000250   000012 236007                    LDQ     10,DL
         2 000251   000004 552104                    STBQ    4,'04'O,PR0

      742     2092    1           N$REQ.BUF$ = ADDR (EH);         /* buffer address                     */

   2092  2 000252   000001 236000 3                  LDQ     1
         2 000253   000005 756100                    STQ     5,,PR0

      743     2093    1           N$REQ.BUFSIZE = 4;              /* buffer size                        */

   2093  2 000254   000004 236100                    LDQ     4,,PR0
         2 000255   177777 376007                    ANQ     65535,DL
         2 000256   000001 276003                    ORQ     1,DU
         2 000257   000004 756100                    STQ     4,,PR0
PL6.E3A0      #006=OCI$KEYIN File=OCI$MONKEY.:E05TSI                             WED 07/30/97 03:58 Page:130  

      744     2094    1           N$REQ.FC = %N_WRITE;            /* write with CR/LF                   */

   2094  2 000260   000015 236007                    LDQ     13,DL
         2 000261   000003 552104                    STBQ    3,'04'O,PR0

      745     2095    1           GOTO RETURN_;

   2095  2 000262   000245 710000 2                  TRA     RETURN_

ZEROES
 Sect OctLoc
   0     000   060060 060060                                                    0000

EH
 Sect OctLoc
   0     004   040105 150077                                                     Eh?

FIELD
 Sect OctLoc
   0     005   ****** ******   ****** ******   ****** ******   ****** ******    ................

ESCESCB
 Sect OctLoc
   1     000   033033 ******                                                    ....

YCYCB
 Sect OctLoc
   1     001   031031 ******                                                    ....

(unnamed)
 Sect OctLoc
   1     002   104105 114124   101040 040040   104111 105041   116117 125123    DELTA   DIE!NOUS
   1     006   105122 123041   120122 117103   105105 104040   122105 124122    ERS!PROCEED RETR
   1     012   131040 040040   105122 122117   122040 040040   106111 122115    Y   ERROR   FIRM
   1     016   114117 101104                                                    LOAD

PL6.E3A0      #006=OCI$KEYIN File=OCI$MONKEY.:E05TSI                             WED 07/30/97 03:58 Page:131  
(unnamed)
 Sect OctLoc
   3     000   000003 006000   000004 006000                                    ........
      746     2096    1   END OCI$KEYIN;

PL6.E3A0      #006=OCI$KEYIN File=OCI$MONKEY.:E05TSI                             WED 07/30/97 03:58 Page:132  
--  Include file information  --

   B$TABLES_C.:E05TOU  cannot be made into a system file and is referenced.
   KC_CP6.:E05TOU  is referenced.
   OC_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   SS_CNTRLD_R.:E05TOU  cannot be made into a system file and is referenced.
   SS_CNTRL_R.:E05TOU  cannot be made into a system file and is referenced.
   SS_SCHED_R.:E05TOU  cannot be made into a system file and is referenced.
   NK$LDCT.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   N_FC_C.:E05TOU  is referenced.
   OCI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   OCI_SUBS_C.:E05TOU  is referenced.
   OC_SUBS_C.:E05TOU  is referenced.
      No diagnostics issued in procedure OCI$KEYIN.
PL6.E3A0      #006=OCI$KEYIN File=OCI$MONKEY.:E05TSI                             WED 07/30/97 03:58 Page:133  

 **** Variables and constants ****

  ****  Section 000  Data  OCI$KEYIN

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/c CHAR(4)     r     1 EH                         5-0-0/c CHAR(80)    r     1 FIELD
     1-0-0/w SBIN        r     1 I                          2-0-0/w UBIN        r     1 LEN
    31-0-0/c CHAR        r     1 LETTER                     3-0-0/w UBIN        r     1 POSN
     0-0-0/c CHAR(4)     r     1 ZEROES

  ****  Section 001 RoData OCI$KEYIN

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c CHAR(2)     r     1 ESCESC                     0-0-0/b BIT (18)    r     1 ESCESCB
     1-0-0/c CHAR(2)     r     1 YCYC                       1-0-0/b BIT (18)    r     1 YCYCB

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @N$REQ                    *0-0-0/d STRC(1080)  r     1 N$REQ
     4-0-0/c STRC(396)   r     1 OCI_PARAM2

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$XL_UPPER$                0-0-0/w SBIN        r     1 B_ZIP
     0-0-0/w SBIN        r     1 OCA_SAVE_TUIS              0-0-0/w BIT         r     1 OCI_INT
     0-0-0/c CHAR(80)    r     1 OCI_KEYIN
     0-0-0/w EPTR        r     1 OCI_ROUTINE(0:8191)
PL6.E3A0      #006=OCI$KEYIN File=OCI$MONKEY.:E05TSI                             WED 07/30/97 03:58 Page:134  
     0-0-0/w SBIN        r     1 S_TUIS

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(4608)  r     1 B$XL_UPPER                 0-0-0/d STRC(864)   r     1 NK$LDCT


   Procedure OCI$KEYIN requires 179 words for executable code.
   Procedure OCI$KEYIN requires 20 words of local(AUTO) storage.

    No errors detected in file OCI$MONKEY.:E05TSI    .
PL6.E3A0      #006=OCI$KEYIN File=OCI$MONKEY.:E05TSI                             WED 07/30/97 03:58 Page:135  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #006=OCI$KEYIN File=OCI$MONKEY.:E05TSI                             WED 07/30/97 03:58 Page:136  
          MINI XREF LISTING

B$XL_UPPER
      1963**DCL      2023>>CALLBLT
B$XL_UPPER$
      1962**DCL      1963--IMP-PTR  2023>>CALLBLT
B_ZIP
      1198**DCL      2044>>IF
EH
      1978**DCL      2092--ASSIGN
EH_
      2091**LABEL    2056--CALLALT  2075--GOTO     2080--GOTO     2084--CALLALT
ESCESC
      1988**DCL      2030>>IF
ESCESCB
      1987**DCL      1988--REDEF
FIELD
      1979**DCL      1995<<ASSIGN   2002<<CALLBLT  2030>>IF       2030>>IF       2030>>IF       2041>>IF
      2052>>IF       2059>>IF       2063>>IF       2067>>IF       2071>>IF       2081>>CALLBLT
GET_FIELD
      1993**PROC     2025--CALL     2076--CALL
I
      1975**DCL      1996<<DOINDEX  1997>>IF       1998<<DOINDEX  1998>>DOINDEX  1999>>ASSIGN   2007>>ASSIGN
KQP$EVNT
      1969**DCL-ENT  2027--CALL
LEN
      1976**DCL      1994<<ASSIGN   2002>>CALLBLT  2003<<ASSIGN   2003>>ASSIGN   2026>>IF       2077>>IF
      2077>>IF
LETTER
      1980**DCL      1999<<ASSIGN   2000>>IF       2002>>CALLBLT
N$REQ
       996**DCL        31--PROC
N$REQ.ARSIZE
      1029**DCL      1996>>DOINDEX  1998>>DOINDEX  2012>>ASSIGN
PL6.E3A0      #006=OCI$KEYIN File=OCI$MONKEY.:E05TSI                             WED 07/30/97 03:58 Page:137  
N$REQ.BUF$
      1005**DCL      2092<<ASSIGN
N$REQ.BUFADDR
      1005**DCL      1006--REDEF    1006--REDEF
N$REQ.BUFSIZE
       999**DCL      2093<<ASSIGN
N$REQ.DLA.DRELADDR
       997**DCL       997--REDEF
N$REQ.DVE.EOMCHAR
      1034**DCL      1035--REDEF
N$REQ.EAINFO
      1028**DCL      1028--REDEF
N$REQ.EAINFOP$
      1028**DCL      2026>>IF       2027>>CALL
N$REQ.EAINFOX
      1028**DCL      1029--REDEF
N$REQ.EVNTINFO
      1029**DCL      1029--REDEF
N$REQ.FC
       999**DCL      2094<<ASSIGN
N$REQ.OPFLG
      1002**DCL      2091<<ASSIGN
N$REQ.STATUS
      1010**DCL      1016--REDEF
NIK$KEYIN
      1967**DCL-ENT  2084--CALL
NK$LDCT
      1212**DCL      2027<>CALL
NK$LDCT.DDT$
      1214**DCL      1214--REDEF
NK$LDCT.IOQ$
      1213**DCL      1214--REDEF
NK$LDCT.LDCTX
      1215**DCL      1215--REDEF
NK$LDCT.LKFLG.ABORTED
      1227**DCL      1228--REDEF
PL6.E3A0      #006=OCI$KEYIN File=OCI$MONKEY.:E05TSI                             WED 07/30/97 03:58 Page:138  
NK$LDCT.RLCID.LDCTX
      1237**DCL      1237--REDEF
NK$LDCT.STA$
      1233**DCL      1234--REDEF
NK$LDCT.SYMB$
      1212**DCL      1212--REDEF    1212--REDEF    1213--REDEF
OCA$KMISC
      1970**DCL-ENT  2056--CALL
OCA_SAVE_TUIS
      1971**DCL      2047>>ASSIGN
OCI_INT
       874**DCL      2019>>IF       2021<<ASSIGN   2087<<ASSIGN
OCI_KEYIN
       874**DCL      1997>>IF       1999>>ASSIGN   2023<<CALLBLT  2023>>CALLBLT
OCI_PARAM2
      1981**DCL      2056<>CALL     2084<>CALL
OCI_PARAM2.BUF
      1985**DCL      2081<<CALLBLT  2082<<CALLBLT
OCI_PARAM2.KIN#
      1983**DCL      2055<<ASSIGN   2061<<ASSIGN   2065<<ASSIGN   2069<<ASSIGN   2073<<ASSIGN
OCI_PARAM2.RTN#
      1982**DCL      2054<<ASSIGN   2083<<ASSIGN
OCX$XDELTA
      1968**DCL-ENT  2037--CALL
POSN
      1977**DCL      1996>>DOINDEX  2007<<ASSIGN   2012<<ASSIGN   2024<<ASSIGN
RETURN_
      2086**LABEL    2028--GOTO     2038--GOTO     2057--GOTO     2095--GOTO
SC_OCOPERRECOV
      1973**DCL-ENT  2049--CALL
S_TUIS
      1173**DCL      2047<<ASSIGN
YCYC
      1990**DCL      2030>>IF
YCYCB
      1989**DCL      1990--REDEF
PL6.E3A0      #006=OCI$KEYIN File=OCI$MONKEY.:E05TSI                             WED 07/30/97 03:58 Page:139  
ZEROES
        32**DCL      2082>>CALLBLT
