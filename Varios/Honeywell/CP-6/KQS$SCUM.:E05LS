VERSION E05

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:1    
        1        1        /*M* KQS$SCUM COMGROUP garbage collection */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DMC,PLM=8,IND=0,IDT=2,SDI=2,CTI=0,ENU=0,AND,DCI=4,CSU=2,ECU=4,THI=0,DTI=0,STI=1
                 7        ,IAD=0,PRB */
        8        8        /**/
        9        9        /*P* NAME:         KQS$SCUM
       10       10             PURPOSE:      To provide COMGROUP garbage collection
       11       11             DESCRIPTION:  Contains various routines
       12       12        */
       13       13        /**/
       14       14        KQS$GARBF: PROC (PARM) ALTRET;
       15       15        /**/
       16       16
       17       17
       18       18
       19       19        /**/
       20       20        /* INCLUDES */
       21       21        /**/
       22       22        %INCLUDE KQ_SUBS_C;
       23      322        %INCLUDE KQ_MAC_C;
       24     2872        %INCLUDE HF_LOCK_C;
       25     2886        %INCLUDE KQ_DATA_R;
       26     3718        %INCLUDE CP_6_SUBS;
       27     4258        %INCLUDE KC$CP6V_C;
       28     4378        %INCLUDE KC_CP6;
       29     4938        %INCLUDE SS_SCHED_C;
       30     5171        %INCLUDE EL$TABLES;
       31     5494
       32     5495
       33     5496
       34     5497        /**/
       35     5498        /* PARAMETERS */
       36     5499        /**/
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:2    
       37     5500    1   DCL PARM UBIN;
       38     5501
       39     5502
       40     5503
       41     5504        /**/
       42     5505        /* MACROS */
       43     5506        /**/
       44     5507        %MACRO CHKCNT;
       45     5508                IF KQ_DEBUG ~= 0 THEN CALL CHKMLH;
       46     5509        %MEND;
       47     5510
       48     5511
       49     5512
       50     5513        /**/
       51     5514        /* BASED STRUCTURES */
       52     5515        /**/
       53     5516    1   DCL B$$PTR PTR BASED ALIGNED;
       54     5517        %KQ_CG   (FPTN=KQ$CG  ,STCLASS="BASED(CG$)");
       55     6256        %KQ_STA  (FPTN=KQ$STA ,STCLASS="BASED(STA$)");
       56     6595        %KQ_MBLK (FPTN=KQ$MBLK,STCLASS="BASED(MBLK$)",SUPR=1);
       57     6865        %KQ_MLH  (FPTN=KQ$MLH ,STCLASS="BASED(MLH$)");
       58     6935        %KQ_MTYP (FPTN=KQ$MTYP,STCLASS=BASED);
       59     7009        %KQ_THDR (FPTN=KQ$THDR,STCLASS=BASED);
       60     7047        %KQ_DBLK (FPTN=KQ$DBLK,STCLASS="BASED(DBLK$)");
       61     7100        %KQ_QTN  (FPTN=KQ$QTN ,STCLASS="BASED(QTN$)");
       62     7573        %KQ_DFRPARM (FPTN=KQ$DFRPARM,STCLASS="BASED(DFRP$)");
       63     7602        %KQ_DFRBLK (FPTN=KQ$DFRBLK,STCLASS=BASED);
       64     7652        %KQ_MBLK (FPTN=KQ$NRMLMBLK,STCLASS="BASED(MBLK$)",SUPR=0);
       65     7922        %KQ_MLHB02 (FPTN=KQ$MLHB02,STCLASS=BASED);
       66     7991        %KQ$DPTR;
       67     8018    1   DCL B$$CHARS CHAR(I) BASED UNAL;
       68     8019    1   DCL B$$HALF UBIN HALF BASED HALIGNED;
       69     8020
       70     8021
       71     8022
       72     8023        /**/
       73     8024        /* AUTO */
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:3    
       74     8025        /**/
       75     8026    1   DCL STA$ PTR;
       76     8027    1   DCL MBLK$ PTR;
       77     8028    1   DCL MBLK$R REDEF MBLK$ SBIN;
       78     8029    1   DCL CG$ PTR;
       79     8030    1   DCL P$ PTR;
       80     8031    1   DCL DFRP$ PTR;
       81     8032    1   DCL DBLK$ PTR;
       82     8033    1   DCL DBLK$R REDEF DBLK$ UBIN;
       83     8034    1   DCL I SBIN;
       84     8035    1   DCL DDA UBIN;
       85     8036    1   DCL MLH$ PTR;
       86     8037    1   DCL ENTFLAG UBIN;
       87     8038    1   DCL J SBIN;
       88     8039    1   DCL SAVP$ PTR;
       89     8040    1   DCL M$ PTR;
       90     8041    1   DCL NMBLKS SBIN;
       91     8042    1   DCL X$ PTR;
       92     8043    1   DCL Z$ PTR;
       93     8044    1   DCL QTN$ PTR;
       94     8045    1   DCL START$ PTR;
       95     8046    1   DCL CTLBLK$ PTR;
       96     8047    1   DCL END$ PTR;
       97     8048
       98     8049
       99     8050
      100     8051        /**/
      101     8052        /* CONSTANT */
      102     8053        /**/
      103     8054        %KQ_MBLK (FPTN=KQ_ISMBLK,STCLASS=CONSTANT,SUPR=1);
      104     8324
      105     8325
      106     8326
      107     8327        /**/
      108     8328        /* REFS */
      109     8329        /**/
      110     8330    1   DCL KCA$TELLAU    ENTRY(3) ALTRET;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:4    
      111     8331    1   DCL KCO$ABORTEM   ENTRY(1);
      112     8332    1   DCL KQD$DEFERGO   ENTRY(3) ALTRET;
      113     8333    1   DCL KQD$DELDDA    ENTRY(3) ALTRET;
      114     8334    1   DCL KQD$DELETE    ENTRY(2) ALTRET;
      115     8335    1   DCL KQD$ERRLOG    ENTRY(1) ALTRET;
      116     8336    1   DCL KQD$FETCH     ENTRY(3) ALTRET;
      117     8337    1   DCL KQD$GET       ENTRY(3) ALTRET;
      118     8338    1   DCL KQD$UNLOCK    ENTRY(2) ALTRET;
      119     8339    1   DCL KQD$UPDATE    ENTRY(2) ALTRET;
      120     8340    1   DCL KQD$UPDATED   ENTRY(2) ALTRET;
      121     8341    1   DCL KQG$TRUNC     ENTRY(1) ALTRET;
      122     8342    1   DCL KQL$COUNTDLY  ENTRY(2) ALTRET;
      123     8343    1   DCL KQL$DELMLHR   ENTRY(3) ALTRET;
      124     8344    1   DCL KQL$GARBDUNQ  ENTRY(1) ALTRET;
      125     8345    1   DCL KQL$GARBDUNS  ENTRY(1) ALTRET;
      126     8346    1   DCL KQL$GARBDUNSR ENTRY(1) ALTRET;
      127     8347    1   DCL KQL$RCVRDLY   ENTRY(2) ALTRET;
      128     8348    1   DCL KQL$SRQ       ENTRY(1) ALTRET;
      129     8349    1   DCL KQM$GARBDONE  ENTRY(3) ALTRET;
      130     8350    1   DCL KQM$GETB      ENTRY(3) ALTRET;
      131     8351    1   DCL KQM$RELMBLK   ENTRY(2) ALTRET;
      132     8352    1   DCL KQP$UNLOCK    ENTRY(1) ALTRET;
      133     8353    1   DCL KQR$TRUNC     ENTRY(1) ALTRET;
      134     8354    1   DCL KQT$DELTYP    ENTRY(2) ALTRET;
      135     8355    1   DCL KQX$SLIDE     ENTRY(2);
      136     8356    1   DCL KQZ$LOG       ENTRY(8) ALTRET;
      137     8357    1   DCL SSR$RUE       ENTRY(4);
      138     8358    1   DCL SSS$XSYSTIME  ENTRY(2);
      139     8359    1   DCL SC_CGNOTIMP   ENTRY    CONV(2,0);
      140     8360    1   DCL SC_CGGBSN     ENTRY    CONV(2,0);
      141     8361    1   DCL SC_CGGARB     ENTRY    CONV(2,0);
      142     8362        %EL$CGERR (NAME=KQ_ERRLOG_BFR,STCLASS=SYMREF,N=50);
      143     8366
      144     8367
      145     8368
      146     8369        /**/
      147     8370        /* SUBS */
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:5    
      148     8371        /**/
      149     8372        %SUB KQ$QTREE="CG$->KQ$CG.QUEUE.QTREE$->KQ$THDR";
      150     8373        %SUB KQ$QUEUE="CG$->KQ$CG.QUEUE";
      151     8374        %SUB KQ$GARB="CG$->KQ$CG.GARB";
      152     8375        %SUB KQ$STREE="CG$->KQ$CG.STREE";
      153     8376        %SUB KQ$TTREE="CG$->KQ$CG.TTREE";
      154     8377        %EQU_CG;
      155     8425        %EJECT;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:6    
      156     8426        /*
      157     8427               GGG    AAA   RRRR   BBBB    AAA    GGG   EEEEE
      158     8428              G   G  A   A  R   R  B   B  A   A  G   G  E
      159     8429              G      A   A  R   R  B   B  A   A  G      E
      160     8430              G      AAAAA  RRRR   BBBB   AAAAA  G      EEEE
      161     8431              G  GG  A   A  R R    B   B  A   A  G  GG  E
      162     8432              G   G  A   A  R  R   B   B  A   A  G   G  E
      163     8433               GGG   A   A  R   R  BBBB   A   A   GGG   EEEEE
      164     8434        */
      165     8435        /**/
      166     8436        /*F* NAME:         KQS$GARBF
      167     8437             PURPOSE:      To start a forced garbage collection
      168     8438             DESCRIPTION:  Just like KQS$GARB except that even if
      169     8439                           nobody is blocked for memory we will go
      170     8440                           through the first level of garbage
      171     8441                           collection.
      172     8442
      173     8443        KQS$GARBF: ENTRY (PARM) ALTRET;
      174     8444        */
      175     8445        /**/
      176     8446    1           CG$=ADDR(PARM);
      177     8447    1           CG$->KQ$CG.MMD.GFORCE='1'B;
      178     8448        /**/
      179     8449        /*F* NAME:         KQS$GARB
      180     8450             PURPOSE:      To perform memory garbage collection
      181     8451             CALL:         KQS$GARB (KQ$CG)
      182     8452             INPUT:        KQ$CG.MMD.GATE locked
      183     8453             OUTPUT:       KQ$CG.MMD.GATE unlocked, and garbage collector
      184     8454                           is running.
      185     8455             DESCRIPTION:  Garbage collection is initiated whenever the
      186     8456                           clock sees anything on the DELMSG$ list, or
      187     8457                           a process cannot get memory.  In the latter
      188     8458                           case the process is 'blocked' (see KQM$MM2).
      189     8459                           Unblocking will occur when release of memory
      190     8460                           (by anybody, but likely the garbage collector)
      191     8461                           causes the correctly-sized thing to become
      192     8462                           available, or when the garbage collector has
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:7    
      193     8463                           done all it can and there still is nothing
      194     8464                           available.
      195     8465
      196     8466                           The garbage collector makes memory available by
      197     8467                            - releasing MBLKs that were on the DELMSG$
      198     8468                              list after deleting their DBLKs
      199     8469                            - releasing RBLKs made available by TRUNCing
      200     8470                              the stations that had them
      201     8471                            - releasing MBLKs that it puts on disc.  This
      202     8472                              involves creation (or coalescing) of 'super'
      203     8473                              MBLKs - MBLKs whose data on disc consists
      204     8474                              of other MBLKs.  Much of the logic in KQL$LIST
      205     8475                              is devoted to searching MBLK lists which
      206     8476                              contain super MBLKs, since this involves
      207     8477                              reading the DBLK into memory and looking at
      208     8478                              the MBLKs in it for the desired kind of message.
      209     8479                              Two super MBLKs are coalesced simply by linking
      210     8480                              their DBLKs together in a linear list and discarding
      211     8481                              the second super MBLK.  Note that an MBLK list
      212     8482                              containing super MBLKs is still in PRIO and UTS
      213     8483                              order.
      214     8484
      215     8485
      216     8486                           The garbage collector runs driven by I/O endaction
      217     8487                           and, if necessary, driven by the clock (KQS$CLOCK).
      218     8488                           This latter only happens when we run out of defer
      219     8489                           blocks or some similar thing.  In practice, the
      220     8490                           first part of the work, initated by the call to
      221     8491                           KQS$GARB, may be on behalf of some user, but this
      222     8492                           is immaterial.
      223     8493
      224     8494                           When the garbage collector is running, the KQ$CG.MMD.GIP
      225     8495                           flag is set, and requests for garbage collection
      226     8496                           are ignored in this period.
      227     8497
      228     8498                           Garbage collection proceeds in the following order:
      229     8499
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:8    
      230     8500                            - the DELMSG$ list of deleted messages
      231     8501                            - ordinary MBLKs belonging to absent stations,
      232     8502                              or Q-tree nodes with MXACT = 0, are collected
      233     8503                              up and put on disc.
      234     8504                            - the above is done for ALL MLHs
      235     8505                            - ALL MLHs are garbage collected down to 1 super
      236     8506                              MBLK, by concatenating super MBLKs.
      237     8507
      238     8508                           At the completion of each phase, the garbage collector
      239     8509                           tries to quit by calling KQM$GARBDONE.  This will
      240     8510                           stop garbage collection as long as nobody is blocked
      241     8511                           for memory, or tell the garbage collector to continue
      242     8512                           if there is anyone still blocked.  At the completion
      243     8513                           of the last phase, if there is anyone still blocked
      244     8514                           the comgroup is considered to be full since there
      245     8515                           is nothing more to garbage collect.  At this time
      246     8516                           all the blocked people are unblocked and told the
      247     8517                           comgroup is full, and then ALL stations are deac-
      248     8518                           tivated.
      249     8519        */
      250     8520    1   KQS$GARB: ENTRY (PARM) ALTRET;
      251     8521        /**/
      252     8522    1           CG$=ADDR(PARM);
      253     8523    1           IF CG$->KQ$CG.MMD.GIP THEN
      254     8524    2             DO;
      255     8525                  %UNLOCK (G=CG$->KQ$CG.MMD.GATE);
      256     8528    2             ALTRETURN;
      257     8529    2             END;
      258     8530    1           CG$->KQ$CG.MMD.GIP='1'B;
      259     8531    1           KQ$GARB.DELAY=0;
      260     8532    1           ENTFLAG=0;
      261     8533                %UNLOCK (G=CG$->KQ$CG.MMD.GATE);
      262     8536        /**/
      263     8537    1           KQ$GARB.TYPE=KQGT_DMSG#;
      264     8538    1           KQ$GARB.RELCNT=0;
      265     8539    1           CALL DODELMSG ALTRET(RTN);
      266     8540    1   GB0:    CALL TRYQUIT ALTRET(RTN);
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:9    
      267     8541    1           CG$->KQ$CG.STATS.GARBCOLLS=CG$->KQ$CG.STATS.GARBCOLLS+1;
      268     8542    1           KQ_STATS.GARBCOLLS=KQ_STATS.GARBCOLLS+1;
      269     8543        /**/
      270     8544    1           KQ$GARB.TYPE=KQ$GARB.TYPE+1;
      271     8545    1   GBLOOP: ;
      272     8546    1           CALL DODELMSG ALTRET(RTN);
      273     8547    1   GB1:    IF CG$->KQ$CG.QISS THEN CALL DOT;
      274     8548    1           CALL TRYQUIT ALTRET(RTN);
      275     8549    1           CALL DOQ ALTRET(RTN);
      276     8550    1   GB2:    CALL TRYQUIT ALTRET(RTN);
      277     8551    1           CALL DOS ALTRET(RTN);
      278     8552    1   GB3:    CALL TRYQUIT ALTRET(RTN);
      279     8553    1           CALL DODELMSG ALTRET(RTN);
      280     8554    1           CALL TRYQUIT ALTRET(RTN);
      281     8555    1           KQ$GARB.TYPE=KQ$GARB.TYPE+1;
      282     8556    1           IF KQ$GARB.TYPE <= KQGT_MAX# THEN GOTO GBLOOP;
      283     8557    1           CALL TRYQUIT ALTRET(RTN);
      284     8558    1   GBFAIL: ;
      285     8559    1           CALL KQM$GARBDONE (CG$->KQ$CG,,1);
      286     8560    1           IF ENTFLAG ~= KQGD_QFULL# THEN
      287     8561    1            GOTO SETFULL; /* Too much stuff in memory */
      288     8562    1           GOTO RTN;      /* Ran out of disc space -  */
      289     8563                               /* KQS$CGFULL already called*/
      290     8564        /**/  /* ALTRET if we're done, else return */
      291     8565    1   TRYQUIT: PROC ALTRET;
      292     8566        /**/
      293     8567    2           IF KQ$CG.GARB.TYPE<=KQGT_MAX# THEN
      294     8568    3             DO;
      295     8569    3             IF KQ$GARB.JNLD$ ~= ADDR(NIL) THEN RETURN;
      296     8570    3             IF  KQ$GARB.TYPE <= KQGT_CANS#
      297     8571    3             AND CG$->KQ$CG.MMD.GFORCE THEN RETURN;
      298     8572    3             END;
      299     8573    2           CALL KQM$GARBDONE (CG$->KQ$CG,,0) ALTRET(ALTRT);
      300     8574    2           RETURN;
      301     8575    2   ALTRT:  ALTRETURN;
      302     8576    2   END TRYQUIT;
      303     8577        %EJECT;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:10   
      304     8578        /**/
      305     8579        /*F* NAME:         KQS$CGFULL
      306     8580             PURPOSE:      To signal the CG is out of disc space.
      307     8581             CALL:         KQS$CGFULL (KQ$CG)
      308     8582             DESCRIPTION:  Called by KQD$DBLK when we run out of disc
      309     8583                           space.
      310     8584        */
      311     8585    1   KQS$CGFULL: ENTRY (PARM) ALTRET; /* !!Doesn't ALTRET!! */
      312     8586        /**/
      313     8587    1           CG$=ADDR(PARM);
      314     8588    1   SETFULL:;
      315     8589                %LOCK (G=CG$->KQ$CG.GATE.CG);
      316     8592    1           CG$->KQ$CG.DELAY.CGFULL='1'B;
      317     8593                %UNLOCK (G=CG$->KQ$CG.GATE.CG);
      318     8596    1           CG$->KQ$CG.BASEDELAY=CG$->KQ$CG.BASEDELAY+1;
      319     8597    1           KQ_BASEDELAY=KQ_BASEDELAY+1;
      320     8598    1           GOTO RTN;
      321     8599        /**/
      322     8600        /*F* NAME:         KQS$DOFULL
      323     8601             PURPOSE:      To handle the comgroup-full condition
      324     8602             CALL:         KQS$DOFULL (KQ$CG)
      325     8603             DESCRIPTION:  Called from KCC$CLOCK when KQ$CG.DELAY.CGFULL
      326     8604                           is found set.
      327     8605        */
      328     8606    1   KQS$DOFULL: ENTRY (PARM) ALTRET; /* !!Doesn't ALTRET!! */
      329     8607        /**/
      330     8608    1           CG$=ADDR(PARM);
      331     8609    1           CALL CGFULL;
      332     8610    1           GOTO RTN;
      333     8611        /**/
      334     8612        /*D* NAME:         CGFULL
      335     8613             PURPOSE:      To handle CG full
      336     8614             DESCRIPTION:  Calls KQC$CLOSESTA on every station.
      337     8615                           Turns off TERMCONLGL.
      338     8616                           Sets DCBCONAU, DCBCONNAU to DEACTIVATE.
      339     8617        */
      340     8618    1   CGFULL: PROC;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:11   
      341     8619        /**/
      342     8620        %LOCK (G=CG$->KQ$CG.GATE.CG);
      343     8623    2           IF CG$->KQ$CG.DELAY.FIP THEN
      344     8624    3             DO;
      345     8625                  %UNLOCK (G=CG$->KQ$CG.GATE.CG);
      346     8628    3             RETURN;
      347     8629    3             END;
      348     8630    2           CG$->KQ$CG.DELAY.FIP='1'B;
      349     8631                %UNLOCK (G=CG$->KQ$CG.GATE.CG);
      350     8634        /**/
      351     8635                %LOCK (G=CG$->KQ$CG.DTREE.GATE);
      352     8638    2           CG$->KQ$CG.AUCTL.TERMCONLGL='0'B;
      353     8639    2           CG$->KQ$CG.AUCTL.DCBCONLGL ='0'B;
      354     8640    2           CG$->KQ$CG.AUCTL.DCBCONAU  ='0'B;
      355     8641    2           CG$->KQ$CG.AUCTL.DCBCONNAU ='0'B;
      356     8642    2           CG$->KQ$CG.AUCTL.TERMCONAU ='0'B;
      357     8643    2           CG$->KQ$CG.AUCTL.TERMCONNAU='0'B;
      358     8644    2           CG$->KQ$CG.AUCTL.AUCONDCB  =%DEACTIVATE#;
      359     8645    2           CG$->KQ$CG.AUCTL.AUDCONDCB =%DEACTIVATE#;
      360     8646    2           CG$->KQ$CG.AUCTL.AUCONTERM =%DEACTIVATE#;
      361     8647    2           CG$->KQ$CG.AUCTL.AUDCONTERM=%DEACTIVATE#;
      362     8648                %UNLOCK (G=CG$->KQ$CG.DTREE.GATE);
      363     8651        /**/
      364     8652    2           CALL KCO$ABORTEM (CG$->KQ$CG); /* Blow away all stations */
      365     8653        /**/
      366     8654                %LOCK (G=CG$->KQ$CG.GATE.CG);
      367     8657    2           CG$->KQ$CG.DELAY.CGFULL='0'B;
      368     8658    2           CG$->KQ$CG.DELAY.FIP='0'B;
      369     8659                %UNLOCK (G=CG$->KQ$CG.GATE.CG);
      370     8662    2           RETURN;
      371     8663    2   END CGFULL;
      372     8664        %EJECT;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:12   
      373     8665        /**/
      374     8666        /*F* NAME:         KQS$CLOCK
      375     8667             PURPOSE:      To continue the garbage collector
      376     8668             CALL:         KQS$CLOCK (KQ$CG)
      377     8669             DESCRIPTION:  Called from KCC$CLOCK with KQ$CG.GARB.DELAY
      378     8670                           indicating what part of the garbage collector
      379     8671                           had to delay and why.  Garbage collection is
      380     8672                           resumed.
      381     8673
      382     8674                           Called also from KQE$EA when it is assumed that
      383     8675                           a defer block may have become free.
      384     8676
      385     8677                           This routine is called when KQ$CG.GARB.DELAY is
      386     8678                           > 0, indicating a 'clocked' delay (usually due
      387     8679                           to no defer blocks).  The idea is to call here
      388     8680                           when delay is > 0 and there is a chance that
      389     8681                           we might be able to continue.  Since we're called
      390     8682                           from more than one spot, we must lock a gate to
      391     8683                           ensure that only one thread of garbage collection
      392     8684                           gets started.
      393     8685        */
      394     8686    1   KQS$CLOCK: ENTRY (PARM) ALTRET; /* !!Doesn't ALTRET!! */
      395     8687        /**/
      396     8688    1           CG$=ADDR(PARM);
      397     8689    1           IF NOT CG$->KQ$CG.MMD.GIP THEN CALL SC_CGGARB;
      398     8690                %LOCK (G=CG$->KQ$CG.GATE.CG);
      399     8693    1           IF KQ$GARB.DELAY <= 0 THEN
      400     8694    2             DO;
      401     8695                  %UNLOCK (G=CG$->KQ$CG.GATE.CG);
      402     8698    2             RETURN;
      403     8699    2             END;
      404     8700    1           ENTFLAG=KQ$GARB.DELAY;
      405     8701    1           KQ$GARB.DELAY=0;
      406     8702                %UNLOCK (G=CG$->KQ$CG.GATE.CG);
      407     8705    2             DO CASE (ENTFLAG);
      408     8706
      409     8707    2               CASE (KQGD_DMSG0#);
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:13   
      410     8708    2                 CALL CDELMSG0 ALTRET(RTN);
      411     8709    2   DELCONT:      IF KQ$GARB.TYPE = 0 THEN GOTO GB0;
      412     8710    2                 GOTO GB1;
      413     8711
      414     8712    2               CASE (KQGD_DMSG1#);
      415     8713    2                 CALL CDELMSG1 ALTRET(RTN);
      416     8714    2                 GOTO DELCONT;
      417     8715
      418     8716    2               CASE (KQGD_DMSG3#);
      419     8717    2                 CALL CDELMSG3 ALTRET(RTN);
      420     8718    2                 GOTO DELCONT;
      421     8719
      422     8720    2               CASE (KQGD_QFULL#);
      423     8721    2                 CALL SQUISHENT;
      424     8722    2                 GOTO SQDUN;
      425     8723
      426     8724    2               CASE (KQGD_SQGD0#);
      427     8725    2                 CALL SQUISHENT;
      428     8726    2                 GOTO SQ0;
      429     8727
      430     8728    2               CASE (KQGD_SQID0#);
      431     8729    2                 CALL SQUISHENT;
      432     8730    2                 CALL INSRTD0 ALTRET(RTN);
      433     8731    2                 GOTO SQ24;
      434     8732
      435     8733    2               CASE (KQGD_SQID1#);
      436     8734    2                 CALL SQUISHENT;
      437     8735    2                 CALL INSRTD1 ALTRET(RTN);
      438     8736    2                 GOTO SQ24;
      439     8737
      440     8738    2               CASE (KQGD_SQID2#);
      441     8739    2                 CALL SQUISHENT;
      442     8740    2                 CALL INSRTD2 ALTRET(RTN);
      443     8741    2                 GOTO SQ24;
      444     8742
      445     8743    2               CASE (KQGD_SQID3#);
      446     8744    2                 CALL SQUISHENT;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:14   
      447     8745    2                 CALL INSRTD3 ALTRET(RTN);
      448     8746    2                 GOTO SQ24;
      449     8747
      450     8748    2               CASE (KQGD_SQID4#);
      451     8749    2                 CALL SQUISHENT;
      452     8750    2                 CALL INSRTD4 ALTRET(RTN);
      453     8751    2                 GOTO SQ24;
      454     8752
      455     8753    2               CASE (KQGD_SQCD0#);
      456     8754    2                 CALL SQUISHENT;
      457     8755    2                 CALL CONCATD0 ALTRET(RTN);
      458     8756    2                 GOTO SQ30;
      459     8757
      460     8758    2               CASE (KQGD_SQCD1#);
      461     8759    2                 CALL SQUISHENT;
      462     8760    2                 CALL CONCATD1 ALTRET(RTN);
      463     8761    2                 GOTO SQ30;
      464     8762
      465     8763    2               CASE (ELSE);
      466     8764    2                 CALL SC_CGGBSN;
      467     8765        /*S* SCREECH_CODE: KQS-S$CGGBSN
      468     8766             TYPE:         SNAP
      469     8767             MESSAGE:      COMGROUP garbage collection inconsistency
      470     8768             REMARKS:      A recoverable inconsistency has been discovered
      471     8769                           during comgroup garbage collection. */
      472     8770
      473     8771    2             END;
      474     8772    1   RTN:    RETURN;
      475     8773        /**/
      476     8774        /*F* NAME:         KQS$FCONT
      477     8775             PURPOSE:      To continue a deferred fetch initiated by the
      478     8776                           garbage collector
      479     8777             CALL:         KQS$FCONT (KQ$DFRPARM)
      480     8778             DESCRIPTION:  KQ$CG.GARB.DELAY says how to continue.
      481     8779        */
      482     8780    1   KQS$FCONT: ENTRY (PARM) ALTRET; /* !!Doesn't ALTRET!! */
      483     8781        /**/
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:15   
      484     8782    1           DFRP$=ADDR(PARM);
      485     8783    1           DBLK$=DFRP$->KQ$DFRPARM.DBLK$;
      486     8784    1           DDA=DFRP$->KQ$DFRPARM.ERR;
      487     8785    1           CG$=DFRP$->KQ$DFRPARM.INFO$;
      488     8786    1           ENTFLAG=-KQ$GARB.DELAY;
      489     8787    1           KQ$GARB.DELAY=0;
      490     8788    2             DO CASE (ENTFLAG);
      491     8789
      492     8790    2               CASE (KQGD_DMSG2#);
      493     8791    2                 CALL CDELMSG2 ALTRET(RTN);
      494     8792    2                 GOTO DELCONT;
      495     8793
      496     8794    2               CASE (KQGD_SQCF0#);
      497     8795    2                 CALL SQUISHENT0;
      498     8796    2                 CALL CONCATF0 ALTRET(RTN);
      499     8797    2                 GOTO SQ30;
      500     8798
      501     8799    2               CASE (KQGD_SQCF1#);
      502     8800    2                 CALL SQUISHENT0;
      503     8801    2                 CALL CONCATF1 ALTRET(RTN);
      504     8802    2                 GOTO SQ30;
      505     8803
      506     8804    2               CASE (KQGD_SQIF0#);
      507     8805    2                 CALL SQUISHENT0;
      508     8806    2                 CALL INSRTF0 ALTRET(RTN);
      509     8807    2                 GOTO SQ24;
      510     8808
      511     8809    2               CASE (KQGD_SQIF1#);
      512     8810    2                 CALL SQUISHENT0;
      513     8811    2                 CALL INSRTF1 ALTRET(RTN);
      514     8812    2                 GOTO SQ24;
      515     8813
      516     8814    2               CASE (KQGD_SQIF2#);
      517     8815    2                 CALL SQUISHENT0;
      518     8816    2                 CALL INSRTF2 ALTRET(RTN);
      519     8817    2                 GOTO SQ24;
      520     8818
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:16   
      521     8819    2               CASE (KQGD_SQIF3#);
      522     8820    2                 CALL SQUISHENT0;
      523     8821    2                 CALL INSRTF3 ALTRET(RTN);
      524     8822    2                 GOTO SQ24;
      525     8823
      526     8824    2               CASE (ELSE);
      527     8825    2                 CALL SC_CGGBSN;
      528     8826
      529     8827    2             END;
      530     8828    1           GOTO RTN;
      531     8829        /**/
      532     8830        /*F* NAME:         KQS$CQUEUE
      533     8831             PURPOSE:      To begin to garbage-collect the queue
      534     8832             CALL:         KQS$CQUEUE (KQ$CG)
      535     8833             DESCRIPTION:  Called from KQL$LIST when a reader of the
      536     8834                           queue needs help or is finished with the queue,
      537     8835                           and the garbage collector was waiting for the queue.
      538     8836                           KQ$QUEUE.BUSY.GIP has been set by the caller.
      539     8837        */
      540     8838    1   KQS$CQUEUE: ENTRY (PARM) ALTRET; /* !!Doesn't ALTRET!! */
      541     8839        /**/
      542     8840    1           CG$=ADDR(PARM);
      543     8841    1           IF CG$->KQ$CG.MMD.GIP = '0'B
      544     8842    1           OR KQ$GARB.DELAY ~= -KQGD_QRDWT# THEN CALL SC_CGGARB;
      545     8843    1           ENTFLAG=-KQ$GARB.DELAY;
      546     8844    1           KQ$GARB.DELAY=0;
      547     8845    1           CALL DOQ1 ALTRET(RTN);
      548     8846    1           GOTO GB2;
      549     8847        %EJECT;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:17   
      550     8848        /**/
      551     8849        /*F* NAME:         KQS$RECOVER
      552     8850             PURPOSE:      To clean up the garbage collector when a
      553     8851                           comgroup is being opened after a crash
      554     8852             DESCRIPTION:  Called with the clock disabled.
      555     8853
      556     8854                           Cleans up every MLH in the comgroup, by zapping
      557     8855                           STATE in all super MBLKs, zapping the MLH
      558     8856                           read/GC flags, and fixing up the DELAY$
      559     8857                           list.    ****** WARNING ****** This last
      560     8858                           requires us to get called BEFORE station
      561     8859                           recovery runs since the latter deletes station
      562     8860                           nodes that may be linked on the DELAY$
      563     8861                           list (and delete sometimes means release
      564     8862                           the page....).
      565     8863
      566     8864                           If a delete-msg was in progress, the message
      567     8865                           being deleted is replaced on the DELMSG$ list
      568     8866                           (note that this can cause ERRLOG entries as
      569     8867                           DODELMSG tries to delete DDAs from that MBLK
      570     8868                           which he deleted before the crash).
      571     8869                           Must never do any data cache I/O.
      572     8870
      573     8871                           Resets the blocked-for-memory listheads.
      574     8872
      575     8873                           ALTRETs if it doesn't like something.
      576     8874        */
      577     8875    1   KQS$RECOVER: ENTRY (PARM) ALTRET;
      578     8876        /**/
      579     8877    1           CG$=ADDR(PARM);
      580     8878    1           KQ$GARB.DELAY=0;
      581     8879        /**/
      582     8880    1           IF KQ$GARB.JNLD$ ~= ADDR(NIL) THEN
      583     8881    2             DO;
      584     8882    2             X$=KQ$GARB.JNLD$;
      585     8883    3               DO WHILE (X$->KQ$MBLK.LNK$ ~= ADDR(NIL));
      586     8884    3               X$=X$->KQ$MBLK.LNK$;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:18   
      587     8885    3               END;
      588     8886    2             X$->KQ$MBLK.LNK$=CG$->KQ$CG.DELMSG$;
      589     8887    2             CG$->KQ$CG.DELMSG$=KQ$GARB.JNLD$;
      590     8888    2             KQ$GARB.JNLD$=ADDR(NIL);
      591     8889    2             END;
      592     8890        /**/
      593     8891    1           STA$=KQ$STREE.HEAD$;
      594     8892    2             DO WHILE (STA$ ~= ADDR(NIL));
      595     8893    2             CALL RCVMLH (STA$->KQ$STA.MLH) ALTRET(ALTRT);
      596     8894    2             CALL KQL$GARBDUNSR (STA$->KQ$STA);
      597     8895    2             STA$=STA$->KQ$STA.BTN.FLINK$;
      598     8896    2             END;
      599     8897        /**/
      600     8898    1           QTN$=KQ$QUEUE.PLHD$;
      601     8899    2             DO WHILE (QTN$ ~= ADDR(NIL));
      602     8900    2             CALL RCVMLH (QTN$->KQ$QTN.MLH) ALTRET(ALTRT);
      603     8901    2             QTN$=QTN$->KQ$QTN.PLINK$;
      604     8902    2             END;
      605     8903        /**/
      606     8904    1           KQ$GARB.DELAY=0;
      607     8905        /**/
      608     8906    1           CG$->KQ$CG.MMD.STAHD$=ADDR(NIL);
      609     8907    1           CG$->KQ$CG.MMD.MBLKHD$=ADDR(NIL);
      610     8908                        /* Now get ready to leave.  We'll be called
      611     8909                           back later at KQS$RECOVER2 to finish any
      612     8910                           garbage collection that was in progress
      613     8911                           and that required disk cache I/O. */
      614     8912    1           IF CG$->KQ$CG.MMD.GIP THEN
      615     8913    2             DO;
      616     8914    2             IF  KQ$GARB.DMIP
      617     8915    2             AND KQ$GARB.MBLK$ ~= ADDR(NIL) THEN
      618     8916    3               DO;
      619     8917    3               MBLK$=KQ$GARB.MBLK$;
      620     8918    3               KQ$GARB.MBLK$=ADDR(NIL);
      621     8919    3               MBLK$->KQ$MBLK.LNK$=CG$->KQ$CG.DELMSG$;
      622     8920    3               CG$->KQ$CG.DELMSG$=MBLK$;
      623     8921    3               END;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:19   
      624     8922    2             ELSE IF KQ$GARB.SQIP THEN
      625     8923    2               IF KQ$GARB.SPSTATE ~= 0 THEN
      626     8924    3                 DO; /* Re-setup some stuff clobbered by KCO and RCVR */
      627     8925    3                 CALL SQUISHENT;
      628     8926    3                 IF KQ$GARB.STA THEN
      629     8927    4                   DO;
      630     8928    4                   STA$->KQ$STA.LOCKCNT=STA$->KQ$STA.LOCKCNT+1;
      631     8929    4                   MLH$->KQ$MLH.BUSY.GIP='1'B;
      632     8930    4                   MLH$->KQ$MLH.GACT='1'B;
      633     8931    4                   END;
      634     8932    3                 ELSE
      635     8933    4                   DO;
      636     8934    4                   QTN$->KQ$QTN.LOCKCNT=QTN$->KQ$QTN.LOCKCNT+1;
      637     8935    4                   KQ$QUEUE.BUSY.GIP='1'B;
      638     8936    4                   KQ$QUEUE.GACT='1'B;
      639     8937    4                   END;
      640     8938    3                 CALL SQUISHX;
      641     8939    3                 END;
      642     8940    2             END;
      643     8941    1           RETURN;
      644     8942        /**/
      645     8943        /*F* NAME:         KQS$RECOVER2
      646     8944             PURPOSE:      To finish cleaning up the garbage collector
      647     8945                           during comgroup reopen
      648     8946             DESCRIPTION:  If an insert was in progress, then it is
      649     8947                           continued.  Else all garbage collection
      650     8948                           flags are zapped and we exit. */
      651     8949    1   KQS$RECOVER2: ENTRY (PARM) ALTRET;
      652     8950        /**/
      653     8951    1           CG$=ADDR(PARM);
      654     8952    1           IF CG$->KQ$CG.MMD.GIP THEN
      655     8953    2             DO;
      656     8954    2             IF KQ$GARB.SQIP THEN
      657     8955    3               DO;
      658     8956    3               IF KQ$GARB.SPSTATE ~= 0 THEN
      659     8957    4                 DO;
      660     8958    4                 CALL SQUISHENT;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:20   
      661     8959    4                 ENTFLAG=KQGD_SRCVR#;
      662     8960    4                 CALL INSRCVR ALTRET(RCVDUN);
      663     8961    4                 GOTO SQ24;
      664     8962    4                 END;
      665     8963    3               END;
      666     8964    2             END;
      667     8965        /**/
      668     8966    1           CG$->KQ$CG.MMD.GIP='0'B;
      669     8967    1           KQ$GARB.SQIP='0'B;
      670     8968    1           KQ$GARB.DMIP='0'B;
      671     8969        /**/
      672     8970    1   RCVDUN: ;
      673     8971    1           RETURN;
      674     8972        /**/
      675     8973    1   RCVMLH: PROC (KQ$MLH) ALTRET;
      676     8974        /**/
      677     8975        %KQ_MLH (FPTN=KQ$MLH,STCLASS="");
      678     9045        %KQ_MLH (FPTN=KQ$TMLH,STCLASS=AUTO);
      679     9115    2   DCL DELETE BIT(1) ALIGNED;
      680     9116        /**/
      681     9117    2           MLH$=ADDR(KQ$MLH);
      682     9118    2           DELETE='0'B;
      683     9119    2           IF NOT KQ$MLH.B03 THEN
      684     9120    3             DO;  /* fix up pre-B03 MLH */
      685     9121    3             KQ$TMLH=KQ_IMLH;
      686     9122    3             KQ$TMLH.HEAD$=MLH$->KQ$MLHB02.HEAD$;
      687     9123    3             KQ$TMLH.TAIL$=MLH$->KQ$MLHB02.TAIL$;
      688     9124    3             KQ$TMLH.DELAY$=MLH$->KQ$MLHB02.DWHD$;
      689     9125    3             KQ$TMLH.COUNT=MLH$->KQ$MLHB02.COUNT;
      690     9126    3             KQ$TMLH.QUEUE=MLH$->KQ$MLHB02.QUEUE;
      691     9127    3             DELETE=MLH$->KQ$MLHB02.DELETE;
      692     9128    3             KQ$TMLH.SUPERCNT=MLH$->KQ$MLHB02.SUPERCNT;
      693     9129    3             IF MLH$->KQ$MLHB02.BUSY ~= 0 THEN
      694     9130    3              KQ$TMLH.BUSY.RIP='1'B;
      695     9131    4               DO INHIBIT;
      696     9132    4               KQ$MLH=KQ$TMLH;
      697     9133    4               END;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:21   
      698     9134    3             END;
      699     9135        /**/
      700     9136    2           CALL KQL$RCVRDLY (KQ$MLH.DELAY$,KQ$MLH.DELAYDQ$);
      701     9137    2           IF DELETE THEN CALL KQL$DELMLHR(CG$->KQ$CG,MLH$);
      702     9138    2           CALL CHKMLH ALTRET(ALTRT);
      703     9139    2           IF KQ$MLH.BUSY.RIP THEN
      704     9140    3             DO;
      705     9141    3             I=0;
      706     9142    3             MBLK$=KQ$MLH.HEAD$;
      707     9143    4               DO WHILE (MBLK$ ~= ADDR(NIL));
      708     9144    4               IF MBLK$->KQ$MBLK.SUPER THEN
      709     9145    4                IF MBLK$->KQ$MBLK.STATE ~= KQSS_IDLE# THEN
      710     9146    5                  DO;
      711     9147    5                  IF I ~= 0 THEN ALTRETURN;
      712     9148    5                  I=1;
      713     9149    5                  MBLK$->KQ$MBLK.STATE=KQSS_IDLE#;
      714     9150    5                  END;
      715     9151    4               MBLK$=MBLK$->KQ$MBLK.LNK$;
      716     9152    4               END;
      717     9153    3             END;
      718     9154        /**/
      719     9155    2           KQ$MLH.BUSY='0'B;
      720     9156    2           KQ$MLH.GACT='0'B;
      721     9157    2           KQ$MLH.RUSR#=0;
      722     9158    2           KQ$MLH.PCSTAMP=0;
      723     9159    2           KQ$MLH.RQMEM='0'B;
      724     9160    2           KQ$MLH.RQGC='0'B;
      725     9161        /**/
      726     9162    2           RETURN;
      727     9163    2   ALTRT:  ALTRETURN;
      728     9164    2   END RCVMLH;
      729     9165        %EJECT;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:22   
      730     9166        /********************************************************
      731     9167        *********************************************************/
      732     9168        /**/
      733     9169        /*D* NAME:         DODELMSG
      734     9170             PURPOSE:      To delete the msgs on the DELMSG$
      735     9171                           list
      736     9172             DESCRIPTION:  Under normal conditions, this routine needs no
      737     9173                           help from the rest of the garbage collector,
      738     9174                           and is always called first because it can usually
      739     9175                           make lots of memory available cheaply.
      740     9176
      741     9177                           The exception lies in the deletion of journaled
      742     9178                           messages, which requires sending JOURNAL DELETE
      743     9179                           messages to the journal station.  If the messages
      744     9180                           involved are in memory, it's still no problem
      745     9181                           since the message MBLK is used for the MBLK of
      746     9182                           the journal delete message.  The problem comes
      747     9183                           when there's no memory available and the journaled
      748     9184                           message is in a super MBLK's disc list.  We're
      749     9185                           stuck then.  What we do is place the super MBLK
      750     9186                           on the JNLD$ list, and march on.  When we get
      751     9187                           to the end of the DELMSG$ list, we try the
      752     9188                           JNLD$ list again.  When we can't get memory to
      753     9189                           process something on the JNLD$ list, we return
      754     9190                           and let the rest of the garbage collector run
      755     9191                           to try to make some memory.  If this fails then
      756     9192                           the comgroup is full.
      757     9193
      758     9194                           If at any time, we must wait (either on the clock
      759     9195                           or on I/O endaction), we set KQ$CG.GARB.DELAY to
      760     9196                           an appropriate value and ALTRETURN.
      761     9197        */
      762     9198    1   DODELMSG: PROC ALTRET;
      763     9199        /**/
      764     9200    2   DCL STAMP UBIN;
      765     9201        /**/
      766     9202    2           IF KQ_LOG.GARB THEN
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:23   
      767     9203    3             DO;
      768     9204    3             CALL KQZ$LOG (CG$->KQ$CG,%KQLOG_GDELM,ENTFLAG,0,0,0,
      769     9205    3             CG$->KQ$CG.DELMSG$) ALTRET(ZA1);
      770     9206    3             RETURN;
      771     9207    3   ZA1:      END;
      772     9208    2   D0:     ;
      773     9209                %LOCK (G=CG$->KQ$CG.GATE.MISC);
      774     9212    2           MBLK$=CG$->KQ$CG.DELMSG$;
      775     9213    2           IF MBLK$ ~= ADDR(NIL) THEN
      776     9214    2            CG$->KQ$CG.DELMSG$=MBLK$->KQ$MBLK.LNK$;
      777     9215                %UNLOCK (G=CG$->KQ$CG.GATE.MISC);
      778     9218    2           IF MBLK$ = ADDR(NIL) THEN
      779     9219    3             DO;
      780     9220    3             IF KQ$GARB.JNLD$ = ADDR(NIL) THEN RETURN;
      781     9221    3             KQ$GARB.DELJ='1'B;
      782     9222    3             MBLK$=KQ$GARB.JNLD$;
      783     9223    3             KQ$GARB.JNLD$=MBLK$->KQ$MBLK.LNK$;
      784     9224    3             END;
      785     9225    2           ELSE KQ$GARB.DELJ='0'B;
      786     9226    2           KQ$GARB.MBLK$=MBLK$;
      787     9227    2           KQ$GARB.DMIP='1'B;
      788     9228        /**/
      789     9229    2           IF MBLK$->KQ$MBLK.SUPER = '0'B THEN
      790     9230    3             DO;
      791     9231    3             IF MBLK$->KQ$MBLK.DDA = 0 THEN
      792     9232    4               DO;
      793     9233    4   D1:         KQ$GARB.DMIP='0'B;
      794     9234    4               IF MBLK$->KQ$NRMLMBLK.JRNLD THEN
      795     9235    4                CALL KCA$TELLAU (CG$->KQ$CG.GORGOSTA$->KQ$STA,%CG_JNLD#,MBLK$->KQ$MBLK)
              9235                         ;
      796     9236    4               ELSE
      797     9237    4                CALL RELMBLK (MBLK$->KQ$MBLK);
      798     9238    4               KQ$GARB.MBLK$=ADDR(NIL);
      799     9239    4               GOTO D0;
      800     9240    4               END;
      801     9241    3   D3:       DBLK$R=MBLK$->KQ$MBLK.STAMP;
      802     9242    3             DDA=MBLK$->KQ$MBLK.DDA;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:24   
      803     9243    3             CALL KQD$DELDDA (CG$->KQ$CG,DBLK$,DDA) ALTRET(D4);
      804     9244    4               DO WHILE('0'B);
      805     9245    4   D4:         IF DDA=%KQDE_NDFRBLK THEN
      806     9246    5                 DO;   /* No defer blks; try later */
      807     9247    5                 KQ$GARB.DELAY=KQGD_DMSG0#;
      808     9248    5                 ALTRETURN;
      809     9249    5                 END;
      810     9250    4               END;
      811     9251    3             GOTO D1;
      812     9252    3             END;
      813     9253        /**/
      814     9254    3   D10:      DO WHILE (MBLK$->KQ$MBLK.INSHD$ ~= ADDR(NIL));
      815     9255    3             X$=MBLK$->KQ$MBLK.INSHD$;
      816     9256    3             IF X$->KQ$MBLK.DDA ~= 0 THEN
      817     9257    4               DO;
      818     9258    4               DBLK$R=X$->KQ$MBLK.STAMP;
      819     9259    4               DDA=X$->KQ$MBLK.DDA;
      820     9260    4               CALL KQD$DELDDA (CG$->KQ$CG,DBLK$,DDA) ALTRET(D14);
      821     9261    5                 DO WHILE('0'B);
      822     9262    5   D14:          IF DDA = %KQDE_NDFRBLK THEN
      823     9263    6                   DO; /* No defer blks */
      824     9264    6                   KQ$GARB.DELAY=KQGD_DMSG3#;
      825     9265    6                   ALTRETURN;
      826     9266    6                   END;
      827     9267    5                 END;
      828     9268    4               END;
      829     9269    3             MBLK$->KQ$MBLK.INSHD$=X$->KQ$MBLK.LNK$;
      830     9270    3             IF X$->KQ$NRMLMBLK.JRNLD THEN
      831     9271    3              CALL KCA$TELLAU (CG$->KQ$CG.GORGOSTA$->KQ$STA,%CG_JNLD#,X$->KQ$MBLK);
      832     9272    3             ELSE
      833     9273    3              CALL RELMBLK (X$->KQ$MBLK);
      834     9274    3             END D10;
      835     9275        /**/
      836     9276    2           IF MBLK$->KQ$MBLK.DDA = 0 THEN
      837     9277    3   D18:      DO;
      838     9278    3             CALL RELMBLK (MBLK$->KQ$MBLK);
      839     9279    3             KQ$GARB.DMIP='0'B;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:25   
      840     9280    3             KQ$GARB.MBLK$=ADDR(NIL);
      841     9281    3             GOTO D0;
      842     9282    3             END;
      843     9283    2           MBLK$->KQ$MBLK.PCDDA=0;
      844     9284    2           MBLK$->KQ$MBLK.CCSTAMP=MBLK$->KQ$MBLK.STAMP;
      845     9285    2           IF MBLK$->KQ$MBLK.KEY1VALID = '0'B THEN
      846     9286    2            MBLK$->KQ$MBLK.SDA.CCDDA=MBLK$->KQ$MBLK.DDA;
      847     9287    2           KQ$GARB.INDX=0;
      848     9288    2   D20:    MBLK$=KQ$GARB.MBLK$;
      849     9289    2           IF MBLK$->KQ$MBLK.KEY1VALID THEN DDA=MBLK$->KQ$MBLK.DDA;
      850     9290    2           ELSE DDA=MBLK$->KQ$MBLK.SDA.CCDDA;
      851     9291    2           DBLK$R=MBLK$->KQ$MBLK.CCSTAMP;
      852     9292    2           CALL KQD$FETCH (CG$->KQ$CG,DBLK$,DDA) ALTRET(D40);
      853     9293    2   D22:    CALL CHKBLINK ALTRET(D50);
      854     9294    2   D23:    IF KQ$GARB.INDX < DBLK$->KQ$DBLK.DSIZE THEN
      855     9295    3             DO;
      856     9296    3             MBLK$=PINCRC(DBLK$,SIZEC(KQ$DBLK)+KQ$GARB.INDX);
      857     9297    3             MBLK$=PINCRW(MBLK$,CTLBLK$->KQ$MBLK.FIRSTX);
      858     9298    3             DDA=MBLK$->KQ$MBLK.DDA;
      859     9299    3             IF DDA ~= 0 THEN
      860     9300    4               DO;
      861     9301    4               STAMP=MBLK$->KQ$MBLK.STAMP;
      862     9302    4               CALL KQD$DELDDA (CG$->KQ$CG,STAMP,DDA) ALTRET(D30);
      863     9303    4               END;
      864     9304    3   D28:      MBLK$->KQ$MBLK.DDA=0;
      865     9305    3             CALL UPDATE;
      866     9306    3             IF MBLK$->KQ$NRMLMBLK.JRNLD THEN
      867     9307    4               DO;
      868     9308    4               STAMP=SIZEW(KQ$MBLK);
      869     9309    4               CALL KQM$GETB (CG$->KQ$CG,X$,STAMP) ALTRET(D60);
      870     9310    4               X$->KQ$MBLK=MBLK$->KQ$MBLK;
      871     9311    4               CALL KCA$TELLAU (CG$->KQ$CG.GORGOSTA$->KQ$STA,%CG_JNLD#,X$->KQ$MBLK);
      872     9312    4               MBLK$->KQ$NRMLMBLK.JRNLD='0'B;
      873     9313    4               END;
      874     9314    3             KQ$GARB.INDX=KQ$GARB.INDX+SIZEC(KQ$MBLK);
      875     9315    3             GOTO D23;
      876     9316    3   D30:      IF DDA ~= %KQDE_NDFRBLK THEN GOTO D28; /* Finished */
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:26   
      877     9317    3             CALL UNLOCK;
      878     9318                     /* No defer blks: try later */
      879     9319    3   D32:      KQ$GARB.DELAY=KQGD_DMSG1#;
      880     9320    3             ALTRETURN;
      881     9321    3             END;
      882     9322    2           IF DBLK$->KQ$DBLK.FLNKDA ~= 0 THEN
      883     9323    3             DO;
      884     9324    3             MBLK$->KQ$MBLK.PCDDA=MBLK$->KQ$MBLK.SDA.CCDDA;
      885     9325    3             MBLK$->KQ$MBLK.CCSTAMP=CTLBLK$->KQ$MBLK.CCSTAMP;
      886     9326    3             MBLK$->KQ$MBLK.SDA.CCDDA=DBLK$->KQ$DBLK.FLNKDA;
      887     9327    3             CALL DELETE;
      888     9328    3             GOTO D20;
      889     9329    3             END;
      890     9330    2           CALL DELETE;
      891     9331    2           MBLK$=KQ$GARB.MBLK$;
      892     9332    2           GOTO D18;
      893     9333    2   D40:    IF DBLK$ = ADDR(NIL) THEN
      894     9334    3             DO CASE (DDA);
      895     9335
      896     9336    3               CASE (%KQDE_NDFRBLK);
      897     9337    3                 GOTO D32; /* No defer blks */
      898     9338    3               CASE (ELSE);
      899     9339    3   D50:          MLH$=ADDR(NIL);          /* For DISKERR's use only */
      900     9340    3                 CALL DISKERR;
      901     9341    3                 GOTO D18; /* Fetch error */
      902     9342    3             END;
      903     9343    2           KQ$GARB.DELAY=-KQGD_DMSG2#;
      904     9344    2           DBLK$->KQ$DFRBLK.INFO$=CG$;
      905     9345    2           CALL KQD$DEFERGO (CG$->KQ$CG,DBLK$,ENTADDR(KQS$FCONT));
      906     9346    2           ALTRETURN;
      907     9347    2   D60:    CALL UNLOCK;
      908     9348    2           MBLK$=KQ$GARB.MBLK$;
      909     9349    2           MBLK$->KQ$MBLK.LNK$=KQ$GARB.JNLD$;
      910     9350    2           KQ$GARB.JNLD$=MBLK$;
      911     9351    2           KQ$GARB.MBLK$=ADDR(NIL);
      912     9352    2           KQ$GARB.DMIP='0'B;
      913     9353    2           IF KQ$GARB.DELJ THEN RETURN;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:27   
      914     9354    2           GOTO D0;
      915     9355        /**/
      916     9356    2   CDELMSG0: ENTRY ALTRET;
      917     9357    2           MBLK$=KQ$GARB.MBLK$;
      918     9358    2           GOTO D3;
      919     9359    2   CDELMSG1: ENTRY ALTRET;
      920     9360    2           MBLK$=KQ$GARB.MBLK$;
      921     9361    2           GOTO D20;
      922     9362    2   CDELMSG2: ENTRY ALTRET;
      923     9363    2           MBLK$=KQ$GARB.MBLK$;
      924     9364    2           IF DBLK$ = ADDR(NIL) THEN GOTO D1;
      925     9365    2           GOTO D22;
      926     9366    2   CDELMSG3: ENTRY ALTRET;
      927     9367    2           MBLK$=KQ$GARB.MBLK$;
      928     9368    2           GOTO D10;
      929     9369    2   END DODELMSG;
      930     9370        /********************************************************
      931     9371        *********************************************************/
      932     9372        /**/
      933     9373        /*D* NAME:         DOQ
      934     9374             PURPOSE:      To squish messages in the queue to disk
      935     9375             DESCRIPTION:  All Q-tree nodes are examined and squished
      936     9376                           if appropriate.
      937     9377        */
      938     9378    1   DOQ:    PROC ALTRET;
      939     9379            %LOCK (G=KQ$QTREE.GATE);
      940     9382    2           KQ$QUEUE.GACT='1'B;
      941     9383    2           IF KQ$QUEUE.BUSY THEN
      942     9384    2            IF KQ$QUEUE.BUSY.GIP THEN CALL SC_CGGARB;
      943     9385    2            ELSE
      944     9386    2             IF  KQ$QUEUE.RQMEM = '0'B
      945     9387    2             AND KQ$QUEUE.RQGC = '0'B THEN
      946     9388    3               DO;
      947     9389    3               KQ$GARB.DELAY=-KQGD_QRDWT#;
      948     9390                    %UNLOCK (G=KQ$QTREE.GATE);
      949     9393    3               ALTRETURN;
      950     9394    3               END;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:28   
      951     9395        /**/
      952     9396    2           KQ$QUEUE.BUSY.GIP='1'B;
      953     9397    2   D0:     KQ$GARB.ACTCNT=KQ$QTREE.ACTCNT;
      954     9398    2           QTN$=KQ$QUEUE.PLHD$;
      955     9399    3             DO WHILE (QTN$ ~= ADDR(NIL));
      956     9400    3             IF KQ$GARB.TYPE ~= KQGT_COAZ#
      957     9401    3             OR QTN$->KQ$QTN.CNACT = 0 THEN
      958     9402    3              IF QTN$->KQ$QTN.MLH.COUNT > 1 THEN
      959     9403    4                DO;
      960     9404    4                KQ$GARB.OMLH$=QTN$;
      961     9405    4                QTN$->KQ$QTN.LOCKCNT=QTN$->KQ$QTN.LOCKCNT+1;
      962     9406                     %UNLOCK (G=KQ$QTREE.GATE);
      963     9409    4                KQ$GARB.STA='0'B;
      964     9410    4                CALL KQS$SQUISH (CG$->KQ$CG) ALTRET(ALTRT);
      965     9411    4   D1:          QTN$=KQ$GARB.OMLH$;
      966     9412                     %LOCK (G=KQ$QTREE.GATE);
      967     9415    4                IF KQ$GARB.ACTCNT ~= KQ$QTREE.ACTCNT THEN GOTO D0;
      968     9416    4                END;
      969     9417    3              ELSE IF QTN$->KQ$QTN.MLH.COUNT = 0 THEN
      970     9418    3                IF  QTN$->KQ$QTN.CNACT = 0
      971     9419    3                AND QTN$->KQ$QTN.READS$ = ADDR(NIL)
      972     9420    3                AND QTN$->KQ$QTN.LOCKCNT = 0 THEN
      973     9421    4                  DO;
      974     9422    4                  IF NOT CG$->KQ$CG.QISS THEN
      975     9423    5                    DO;
      976     9424    5                    IF NOT QTN$->KQ$MTYP.PERM THEN
      977     9425    6                      DO;
      978     9426    6                      X$=QTN$->KQ$QTN.PLINK$;
      979     9427    6                      CALL KQT$DELTYP (CG$->KQ$CG,QTN$);
      980     9428    6                      QTN$=X$;
      981     9429    6                      GOTO D11;
      982     9430    6                      END;
      983     9431    5                    END;
      984     9432    4                  END;
      985     9433    3             QTN$=QTN$->KQ$QTN.PLINK$;
      986     9434    3   D11:      END;
      987     9435        /**/
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:29   
      988     9436    2   D2:     ;
      989     9437    2           IF KQ$QUEUE.BUSY.RIP THEN
      990     9438    3             DO;
      991     9439    3             IF KQ$QUEUE.RQGC THEN
      992     9440    4               DO;
      993     9441    4               MLH$=KQ$QUEUE.MLH$;
      994     9442    4               CALL GETQM;
      995     9443    4               KQ$QUEUE.RQGC='0'B;
      996     9444    4               IF MBLK$->KQ$MBLK.USR = '0'B
      997     9445    4               OR MBLK$->KQ$MBLK.USR# ~= KQ$QUEUE.RUSR# THEN
      998     9446    4                CALL SC_CGGARB;
      999     9447    4               KQ$QUEUE.BUSY.GIP='0'B;
     1000     9448    4               KQ$QUEUE.GACT='0'B;
     1001     9449                    %UNLOCK (G=KQ$QTREE.GATE);
     1002     9452    4               CALL KQL$SRQ (MBLK$->KQ$MBLK);
     1003     9453    4               END;
     1004     9454    3             ELSE IF KQ$QUEUE.RQMEM THEN
     1005     9455    4                DO;
     1006     9456    4                KQ$QUEUE.BUSY.GIP='0'B;
     1007     9457    4                KQ$QUEUE.GACT='0'B;
     1008     9458                     %UNLOCK (G=KQ$QTREE.GATE);
     1009     9461    4                END;
     1010     9462    3              ELSE CALL SC_CGGARB;
     1011     9463    3             END;
     1012     9464    2           ELSE CALL KQL$GARBDUNQ (CG$->KQ$CG);
     1013     9465    2           RETURN;
     1014     9466    2   ALTRT:  ALTRETURN;
     1015     9467        /**/
     1016     9468    2   DOT:    ENTRY ALTRET; /* !!Doesn't ALTRET!! */
     1017     9469        /**/
     1018     9470                %LOCK (G=KQ$TTREE.GATE);
     1019     9473    2           QTN$=KQ$TTREE.HEAD$;
     1020     9474    3             DO WHILE (QTN$ ~= ADDR(NIL));
     1021     9475    3             IF NOT QTN$->KQ$MTYP.PERM THEN
     1022     9476    4               DO;
     1023     9477    4               X$=QTN$->KQ$MTYP.BTN.FLINK$;
     1024     9478    4               CALL KQT$DELTYP (CG$->KQ$CG,QTN$);
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:30   
     1025     9479    4               QTN$=X$;
     1026     9480    4               END;
     1027     9481    3             ELSE QTN$=QTN$->KQ$MTYP.BTN.FLINK$;
     1028     9482    3             END;
     1029     9483                %UNLOCK (G=KQ$TTREE.GATE);
     1030     9486    2           RETURN;
     1031     9487        /**/
     1032     9488    2   DOQ0:   ENTRY ALTRET;
     1033     9489    2           GOTO D1;
     1034     9490    2   DOQ0F:  ENTRY ALTRET;
     1035     9491                %LOCK (G=KQ$QTREE.GATE);
     1036     9494    2           GOTO D2;
     1037     9495    2   DOQ1:   ENTRY ALTRET;
     1038     9496                %LOCK (G=KQ$QTREE.GATE);
     1039     9499    2           GOTO D0;
     1040     9500    2   END DOQ;
     1041     9501        /********************************************************
     1042     9502        *********************************************************/
     1043     9503        /**/
     1044     9504        /*D* NAME:         DOS
     1045     9505             PURPOSE:      To squish directed messages to disk
     1046     9506             DESCRIPTION:  SOFT says whether (0) or not (1) to squish
     1047     9507                           messages at active stations.
     1048     9508                           All stations are examined and squished
     1049     9509                           if appropriate.
     1050     9510        */
     1051     9511    1   DOS:    PROC ALTRET;
     1052     9512            %LOCK (G=KQ$STREE.GATE);
     1053     9515    2   D0:     KQ$GARB.ACTCNT=KQ$STREE.ACTCNT;
     1054     9516    2           STA$=KQ$STREE.HEAD$;
     1055     9517    3             DO WHILE (STA$ ~= ADDR(NIL));
     1056     9518    3             IF KQ$GARB.TYPE ~= KQGT_COAZ#
     1057     9519    3             OR STA$->KQ$STA.LDCT$ = ADDR(NIL) THEN
     1058     9520    3              IF NOT STA$->KQ$STA.MONDCB THEN
     1059     9521    4   D01:         DO;
     1060     9522                     %LOCK (G=STA$->KQ$STA.GATE);
     1061     9525    4                IF NOT STA$->KQ$STA.IDSC THEN
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:31   
     1062     9526    5                  DO;
     1063     9527    5                  IF STA$->KQ$STA.TERM THEN CALL KQG$TRUNC (STA$->KQ$STA);
     1064     9528    5                  ELSE CALL KQR$TRUNC (STA$->KQ$STA);
     1065     9529    5                  END;
     1066     9530    4                IF STA$->KQ$STA.MLH.COUNT = 0 THEN
     1067     9531    5                  DO;
     1068     9532                       %UNLOCK (G=STA$->KQ$STA.GATE);
     1069     9535    5                  END;
     1070     9536    4                ELSE
     1071     9537    5   D02:           DO;
     1072     9538    5                  KQ$GARB.OMLH$=STA$;
     1073     9539    5                  STA$->KQ$STA.LOCKCNT=STA$->KQ$STA.LOCKCNT+1;
     1074     9540                       %UNLOCK (G=STA$->KQ$STA.GATE);
     1075     9543                       %UNLOCK (G=KQ$STREE.GATE);
     1076     9546    5                  KQ$GARB.STA='1'B;
     1077     9547    5                  CALL KQS$SQUISH (CG$->KQ$CG) ALTRET(ALTRT);
     1078     9548    5   D1:            STA$=KQ$GARB.OMLH$;
     1079     9549                       %LOCK (G=KQ$STREE.GATE);
     1080     9552    5                  IF KQ$GARB.ACTCNT ~= KQ$STREE.ACTCNT THEN GOTO D0;
     1081     9553    5                  END D02;
     1082     9554    4                END D01;
     1083     9555    3             STA$=STA$->KQ$STA.BTN.FLINK$;
     1084     9556    3             END;
     1085     9557                %UNLOCK (G=KQ$STREE.GATE);
     1086     9560    2           RETURN;
     1087     9561    2   ALTRT:  ALTRETURN;
     1088     9562        /**/
     1089     9563    2   DOS0:   ENTRY ALTRET;
     1090     9564    2           GOTO D1;
     1091     9565    2   END DOS;
     1092     9566        %EJECT;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:32   
     1093     9567        /*
     1094     9568               SSS    QQQ   U   U   III    SSS   H   H
     1095     9569              S   S  Q   Q  U   U    I    S   S  H   H
     1096     9570              S      Q   Q  U   U    I    S      H   H
     1097     9571               SSS   Q   Q  U   U    I     SSS   HHHHH
     1098     9572                  S  Q Q Q  U   U    I        S  H   H
     1099     9573              S   S  Q  QQ  U   U    I    S   S  H   H
     1100     9574               SSS    QQQ    UUU    III    SSS   H   H
     1101     9575        */
     1102     9576        /**/
     1103     9577        /*F* NAME:         KQS$SQUISH
     1104     9578             PURPOSE:      To squish an MLH to disk
     1105     9579             CALL:         KQS$SQUISH (KQ$CG)
     1106     9580             INPUT:        KQ$GARB.STA = 0/1 for Q-node/station
     1107     9581                           KQ$GARB.OMLH$ = KQ$QTN/KQ$STA
     1108     9582                           KQ$STA/KQ$QTN .LOCKCNT has been bumped
     1109     9583             DESCRIPTION:  Called by the garbage collector to squish an
     1110     9584                           MLH.
     1111     9585
     1112     9586                           If cannot finish immediately, ALTRETs and calls
     1113     9587                           DOQ0/DOS0 back when done; else RETURNs
     1114     9588        */
     1115     9589    1   KQS$SQUISH: ENTRY (PARM) ALTRET;
     1116     9590        /**/
     1117     9591    1           CG$=ADDR(PARM);
     1118     9592    1           ENTFLAG=0;
     1119     9593    1   RESQ:   CALL SQUISHENT ALTRET(SQ);
     1120     9594    1           MLH$->KQ$MLH.GACT='1'B;
     1121     9595    1           IF MLH$->KQ$MLH.BUSY THEN
     1122     9596    1            IF MLH$->KQ$MLH.BUSY.GIP THEN CALL SC_CGGARB;
     1123     9597    1            ELSE
     1124     9598    1             IF  MLH$->KQ$MLH.RQMEM = '0'B
     1125     9599    1             AND MLH$->KQ$MLH.RQGC = '0'B THEN
     1126     9600    2               DO;
     1127     9601    2               KQ$GARB.DELAY=-KQGD_SRDWT#;
     1128     9602    2               CALL SQUISHX;
     1129     9603    2               ALTRETURN;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:33   
     1130     9604    2               END;
     1131     9605    1           MLH$->KQ$MLH.BUSY.GIP='1'B;
     1132     9606    1           GOTO SQ;
     1133     9607        /**/
     1134     9608        /*F* NAME:         KQS$CSQUISH
     1135     9609             PURPOSE:      To start garbage collection on a station MLH
     1136     9610             CALL:         KQS$CSQUISH (KQ$CG)
     1137     9611             INPUT:        Station gate unlocked, MLH.BUSY.GIP set
     1138     9612             DESCRIPTION:  Called from KQL$LIST when a reader needs help
     1139     9613                           or has finished reading, and the garbage collector
     1140     9614                           was waiting for the MLH.
     1141     9615                           KQ$MLH.BUSY has been set to KQMU_GARB#.
     1142     9616        */
     1143     9617    1   KQS$CSQUISH: ENTRY (PARM) ALTRET; /* !!Doesn't ALTRET!! */
     1144     9618        /**/
     1145     9619    1           CG$=ADDR(PARM);
     1146     9620    1           IF CG$->KQ$CG.MMD.GIP = '0'B
     1147     9621    1           OR KQ$GARB.DELAY ~= -KQGD_SRDWT# THEN
     1148     9622    1            CALL SC_CGGARB;
     1149     9623    1           ENTFLAG=-KQ$GARB.DELAY;
     1150     9624    1           KQ$GARB.DELAY=0;
     1151     9625    1           CALL SQUISHENT;
     1152     9626        /**/
     1153     9627    1   SQ:     KQ$GARB.SQIP='1'B;
     1154     9628    1           IF KQ_LOG.GARB THEN
     1155     9629    2             DO;
     1156     9630    2             CALL KQZ$LOG (CG$->KQ$CG,%KQLOG_GSSQ,ENTFLAG,0,0,0,
     1157     9631    2             KQ$GARB.OMLH$) ALTRET(ZA1);
     1158     9632    2             RETURN;
     1159     9633    2   ZA1:      END;
     1160     9634                %CHKCNT;
     1161     9637    1   SQ0:    KQ$GARB.RECYCLE='0'B;
     1162     9638    2             DO CASE (KQ$GARB.TYPE);
     1163     9639
     1164     9640    2               CASE (KQGT_COAZ#,KQGT_CANS#);
     1165     9641    2                 CALL GATHER ALTRET(ALTRT);
     1166     9642
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:34   
     1167     9643    2               CASE (KQGT_CACS#);
     1168     9644    2                 CALL GATHER ALTRET(ALTRT);
     1169     9645        /**/
     1170     9646    2                 MBLK$=MLH$->KQ$MLH.HEAD$;
     1171     9647    3                   DO WHILE (MBLK$ ~= ADDR(NIL));
     1172     9648    3                   IF MBLK$->KQ$MBLK.SUPER = '0'B THEN MBLK$=MBLK$->KQ$MBLK.LNK$;
     1173     9649    3                   ELSE
     1174     9650    4                     DO;
     1175     9651    4                     END$=MBLK$->KQ$MBLK.LNK$;
     1176     9652    4                     IF END$ = ADDR(NIL) THEN MBLK$=ADDR(NIL);
     1177     9653    4                     ELSE IF END$->KQ$MBLK.SUPER THEN MBLK$=END$;
     1178     9654    4                      ELSE
     1179     9655    5                        DO;
     1180     9656    5                        X$=END$->KQ$MBLK.LNK$;
     1181     9657    5                        CALL CONCATN;
     1182     9658    5                        MBLK$=X$;
     1183     9659    5                        END;
     1184     9660    4                     END;
     1185     9661    3                   END;
     1186     9662        /**/
     1187     9663    2                 MBLK$=MLH$->KQ$MLH.HEAD$;
     1188     9664    2                 KQ$GARB.INSRT='1'B;
     1189     9665    3                   DO WHILE (MBLK$ ~= ADDR(NIL));
     1190     9666    3                   IF MBLK$->KQ$MBLK.SUPER THEN
     1191     9667    4                     DO;
     1192     9668    4                     KQ$GARB.MBLK$=MBLK$;
     1193     9669    4                     CALL INSRT ALTRET(ALTRT);
     1194     9670    4   SQ24:             IF KQ$GARB.RECYCLE THEN GOTO SQ0;
     1195     9671    4                     IF NOT KQ$GARB.INSRT THEN /* Did a SETLDA */ GOTO SQ26;
     1196     9672    4                     MBLK$=KQ$GARB.MBLK$;
     1197     9673    4                     END;
     1198     9674    3                   MBLK$=MBLK$->KQ$MBLK.LNK$;
     1199     9675    3                   END;
     1200     9676        /**/
     1201     9677    2   SQ26:         ;
     1202     9678    3                   DO FOREVER;
     1203     9679    3                   CALL GETSLIST ALTRET(SQ40);
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:35   
     1204     9680    3                   KQ$GARB.MBLK$=MBLK$;
     1205     9681    3   SQ28:           CALL CONCATS ALTRET(ALTRT);
     1206     9682    3   SQ30:           IF KQ$GARB.RECYCLE THEN GOTO SQ0;
     1207     9683    3                   IF KQ$GARB.CONERR THEN
     1208     9684    4                     DO; /* Err reading first guy's LDA: reset it */
     1209     9685    4                     KQ$GARB.INSRT='0'B; /* To drive SETLDA */
     1210     9686    4                     CALL SETLDA ALTRET(ALTRT);
     1211     9687    4                     GOTO SQ28; /* Try again now */
     1212     9688    4                     END;
     1213     9689    3                   END;
     1214     9690    2   SQ40:         ;
     1215     9691    2             END;
     1216     9692        /**/
     1217     9693                     /*    All done.
     1218     9694                      *    Unlock stuff,
     1219     9695                      *    merge delayed
     1220     9696                      *    messages back
     1221     9697                      *    in, and exit.
     1222     9698                      */
     1223     9699    1   SQDUN:  ;
     1224     9700    1           IF KQ_LOG.GARB THEN
     1225     9701    2             DO;
     1226     9702    2             CALL KQZ$LOG (CG$->KQ$CG,%KQLOG_GESQ,ENTFLAG,0,0,0,
     1227     9703    2             KQ$GARB.OMLH$) ALTRET(ZA2);
     1228     9704    2             RETURN;
     1229     9705    2   ZA2:      END;
     1230     9706    1           IF KQ$GARB.STA THEN
     1231     9707    2   SQX_S:    DO;
     1232     9708    2             IF MLH$->KQ$MLH.BUSY.RIP THEN
     1233     9709    3               DO; /* Reader active */
     1234     9710    3               IF MLH$->KQ$MLH.RQGC THEN
     1235     9711    4                 DO;
     1236     9712    4                 CALL GETQM;
     1237     9713    4                 MLH$->KQ$MLH.RQGC='0'B;
     1238     9714    4                 MLH$->KQ$MLH.GACT='0'B;
     1239     9715    4                 MLH$->KQ$MLH.BUSY.GIP='0'B;
     1240     9716    4                 CALL SQUISHX;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:36   
     1241     9717    4                 CALL KQL$SRQ (MBLK$->KQ$MBLK);
     1242     9718    4                 END;
     1243     9719    3               ELSE IF MLH$->KQ$MLH.RQMEM THEN
     1244     9720    4                  DO;
     1245     9721    4                  MLH$->KQ$MLH.GACT='0'B;
     1246     9722    4                  MLH$->KQ$MLH.BUSY.GIP='0'B;
     1247     9723    4                  CALL SQUISHX;
     1248     9724    4                  END;
     1249     9725    3                ELSE
     1250     9726    3                 CALL SC_CGGARB;
     1251     9727    3               END;
     1252     9728    2             ELSE CALL KQL$GARBDUNS (STA$->KQ$STA);
     1253     9729    2             CALL KQP$UNLOCK (STA$->KQ$STA);
     1254     9730    2             END SQX_S;
     1255     9731    1           ELSE
     1256     9732    2   SQX_Q:    DO;
     1257     9733    2             QTN$->KQ$QTN.LOCKCNT=QTN$->KQ$QTN.LOCKCNT-1;
     1258     9734    2             CALL SQUISHX;
     1259     9735    2             END SQX_Q;
     1260     9736        /**/
     1261     9737    1           KQ$GARB.SQIP='0'B;
     1262     9738    1           IF ENTFLAG = 0 THEN RETURN;
     1263     9739    1           IF KQ$GARB.STA THEN
     1264     9740    2             DO;
     1265     9741    2             IF ENTFLAG = KQGD_QFULL# THEN
     1266     9742    2              GOTO GBFAIL;
     1267     9743    2             CALL DOS0 ALTRET(RTN);
     1268     9744    2             GOTO GB3;
     1269     9745    2             END;
     1270     9746    1           IF ENTFLAG = KQGD_QFULL# THEN
     1271     9747    2             DO;
     1272     9748    2             CALL DOQ0F;
     1273     9749    2             GOTO GBFAIL;
     1274     9750    2             END;
     1275     9751    1           CALL DOQ0 ALTRET(RTN);
     1276     9752    1           GOTO GB2;
     1277     9753    1   ALTRT:  ALTRETURN;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:37   
     1278     9754        /**/
     1279     9755        /*F* NAME:         KQS$GCONT
     1280     9756             PURPOSE:      To continue a delayed KQD$GET issued by KQS$SQUISH
     1281     9757        */
     1282     9758    1   KQS$GCONT: ENTRY (PARM) ALTRET; /* !!Doesn't ALTRET!! */
     1283     9759        /**/
     1284     9760    1           DFRP$=ADDR(PARM);
     1285     9761    1           DBLK$=DFRP$->KQ$DFRPARM.DBLK$;
     1286     9762    1           CG$=DFRP$->KQ$DFRPARM.INFO$;
     1287     9763    1           DDA=DFRP$->KQ$DFRPARM.DDA;
     1288     9764    1           ENTFLAG=-KQ$GARB.DELAY;
     1289     9765    1           KQ$GARB.DELAY=0;
     1290     9766    2             DO CASE (ENTFLAG);
     1291     9767
     1292     9768    2               CASE (KQGD_SQGG0#);
     1293     9769    2                 CALL SQUISHENT0;
     1294     9770    2                 IF DBLK$ ~= ADDR(NIL) THEN GOTO SQ0;
     1295     9771    2                 IF DFRP$->KQ$DFRPARM.ERR ~= %KQDE_NSPC THEN CALL SC_CGGARB;
     1296     9772    2                 ENTFLAG=KQGD_QFULL#;
     1297     9773    2                 GOTO SQDUN;
     1298     9774
     1299     9775    2               CASE (KQGD_SQIG0#);
     1300     9776    2                 CALL SQUISHENT0;
     1301     9777    2                 CALL INSRTG0 ALTRET(RTN);
     1302     9778    2                 GOTO SQ24;
     1303     9779
     1304     9780    2               CASE (ELSE);
     1305     9781    2                 CALL SC_CGGBSN;
     1306     9782
     1307     9783    2             END;
     1308     9784    1           RETURN;
     1309     9785        %EJECT;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:38   
     1310     9786        /********************************************************
     1311     9787        *********************************************************/
     1312     9788        /**/
     1313     9789        /*D* NAME:         SQUISHENT
     1314     9790             PURPOSE:      To set up for entering the SQUISH process
     1315     9791                           ALTRETs if Q squish, RETURNs if station.
     1316     9792        */
     1317     9793    1   SQUISHENT: PROC ALTRET;
     1318     9794        /**/
     1319     9795    2           DBLK$=ADDR(NIL);
     1320     9796        /**/
     1321     9797    2   SQUISHENT0: ENTRY ALTRET;
     1322     9798        /**/
     1323     9799    2           IF KQ$GARB.STA THEN
     1324     9800    3             DO;
     1325     9801    3             STA$=KQ$GARB.OMLH$;
     1326     9802    3             MLH$=ADDR(STA$->KQ$STA.MLH);
     1327     9803                  %LOCK (G=STA$->KQ$STA.GATE);
     1328     9806    3             MBLK$=KQ$GARB.MBLK$;
     1329     9807    3             RETURN;
     1330     9808    3             END;
     1331     9809    2           QTN$=KQ$GARB.OMLH$;
     1332     9810    2           MLH$=ADDR(QTN$->KQ$QTN.MLH);
     1333     9811                %LOCK (G=KQ$QTREE.GATE);
     1334     9814    2           MBLK$=KQ$GARB.MBLK$;
     1335     9815    2           ALTRETURN;
     1336     9816        /********************************************************
     1337     9817        *********************************************************/
     1338     9818        /**/
     1339     9819        /*D* NAME:         SQUISHX
     1340     9820             PURPOSE:      To set up to leave the SQUISH process
     1341     9821        */
     1342     9822    2   SQUISHX: ENTRY ALTRET; /* !!Doesn't ALTRET!! */
     1343     9823        /**/
     1344     9824    2           IF KQ$GARB.STA THEN
     1345     9825    3             DO;
     1346     9826                  %UNLOCK (G=STA$->KQ$STA.GATE);
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:39   
     1347     9829    3             END;
     1348     9830    2           ELSE
     1349     9831    3             DO;
     1350     9832                  %UNLOCK (G=KQ$QTREE.GATE);
     1351     9835    3             END;
     1352     9836    2           RETURN;
     1353     9837    2   END SQUISHENT;
     1354     9838        /********************************************************
     1355     9839        *********************************************************/
     1356     9840        /**/
     1357     9841        /*D* NAME:         GATHER
     1358     9842             PURPOSE:      To gather MBLKs into super MBLKs
     1359     9843             DESCRIPTION:  Takes all lists of ordinary MBLKs in the
     1360     9844                           target MLH, and puts them on disk.
     1361     9845                           ALTRETs if delay for DBLK is required.
     1362     9846        */
     1363     9847    1   GATHER: PROC ALTRET;
     1364     9848        /**/
     1365     9849    3             DO FOREVER;
     1366     9850    3             CALL GETLIST ALTRET(RTN);
     1367     9851    3             IF DBLK$ = ADDR(NIL) THEN
     1368     9852    3              CALL GETDBLK (KQGD_SQGG0#,KQGD_SQGD0#) ALTRET(NOGET);
     1369     9853    3             CALL DUMPLIST;
     1370     9854              /* This loop may go on for a long time (as seen by STAR 12254).        */
     1371     9855              /* Don't leave the gate locked too long as a result.                   */
     1372     9856    3             IF KQ$GARB.STA
     1373     9857    4             THEN DO;
     1374     9858                    %UNLOCK (G=STA$->KQ$STA.GATE);
     1375     9861                    %LOCK (G=STA$->KQ$STA.GATE);
     1376     9864    4               END;
     1377     9865    4             ELSE DO;
     1378     9866                    %UNLOCK (G=KQ$QTREE.GATE);
     1379     9869                    %LOCK (G=KQ$QTREE.GATE);
     1380     9872    4               END;
     1381     9873    3             END;
     1382     9874    2   RTN:    RETURN;
     1383     9875    2   NOGET:  IF DBLK$ ~= ADDR(NIL)
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:40   
     1384     9876    2           OR DDA = %KQDE_NDFRBLK THEN ALTRETURN;
     1385     9877    2           CALL SQUISHX;
     1386     9878    2           KQ$GARB.DELAY=KQGD_QFULL#;
     1387     9879    2           ALTRETURN;
     1388     9880    2   END GATHER;
     1389     9881        /********************************************************
     1390     9882        *********************************************************/
     1391     9883        /**/
     1392     9884        /*D* NAME:         DUMPLIST
     1393     9885             PURPOSE:      To move an MBLK list to disk
     1394     9886             INPUT:        DBLK$ is the data block
     1395     9887                           DDA is its disk address
     1396     9888                           START$ points to the first MBLK
     1397     9889                           NMBLKS is the list count
     1398     9890                           END$ is the last one
     1399     9891             DESCRIPTION:  Puts them in the DBLK, builds a super MBLK
     1400     9892                           to represent them and stores it on top of
     1401     9893                           the START$ MBLK, flinking it at END$'s flink,
     1402     9894                           releases the MBLKs, and adjusts the MLH's
     1403     9895                           SUPERCNT.
     1404     9896                           Sets DBLK$ to ADDR(NIL) to indicate that the
     1405     9897                           DBLK was used.
     1406     9898        */
     1407     9899    1   DUMPLIST: PROC;
     1408     9900        /**/
     1409     9901    2   DCL T1$ PTR;
     1410     9902    2   DCL T2$ PTR;
     1411     9903        %KQ_MBLK (FPTN=SMBLK,STCLASS=AUTO,SUPR=1);
     1412    10173        /**/
     1413    10174    2           IF KQ_LOG.GARB THEN
     1414    10175    3             DO;
     1415    10176    3             T1$=END$;
     1416    10177    3             T2$=START$;
     1417    10178    3             CALL KQZ$LOG (CG$->KQ$CG,%KQLOG_GSMCR,ENTFLAG,T2$,
     1418    10179    3             ADDR(T2$)->B$$HALF,
     1419    10180    3             T1$,SMBLK.DDA) ALTRET(ZA1);
     1420    10181    3             RETURN;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:41   
     1421    10182    3   ZA1:      END;
     1422    10183    2           CALL FILLDBLK (START$,SMBLK);
     1423    10184    2           Z$=START$->KQ$MBLK.LNK$;
     1424    10185    2           SMBLK.LNK$=END$->KQ$MBLK.LNK$;
     1425    10186    3             DO INHIBIT;
     1426    10187    3             END$->KQ$MBLK.LNK$=ADDR(NIL);
     1427    10188    3             IF SMBLK.LNK$ = ADDR(NIL) THEN
     1428    10189    3              MLH$->KQ$MLH.TAIL$=START$;
     1429    10190    3             MLH$->KQ$MLH.SUPERCNT=MLH$->KQ$MLH.SUPERCNT+1;
     1430    10191    3             START$->KQ$MBLK=SMBLK;
     1431    10192                  %CHKCNT;
     1432    10195    4               DO WHILE (Z$ ~= ADDR(NIL));
     1433    10196    4               X$=Z$->KQ$MBLK.LNK$;
     1434    10197    4               CALL RELMBLK (Z$->KQ$MBLK);
     1435    10198    4               Z$=X$;
     1436    10199    4               END;
     1437    10200    3             CALL UNLOCK;
     1438    10201    3             RETURN;
     1439    10202    3             END;
     1440    10203    2   END DUMPLIST;
     1441    10204        /********************************************************
     1442    10205        *********************************************************/
     1443    10206        /**/
     1444    10207        /*D* NAME:         FILLDBLK
     1445    10208             PURPOSE:      To fill a DBLK with a list of MBLKs
     1446    10209             DESCRIPTION:  START$ is the first in the list, NMBLKS is
     1447    10210                           the count.  SMBLK is a place to make the
     1448    10211                           super MBLK.  The data block is filled but
     1449    10212                           not unlocked.
     1450    10213        */
     1451    10214    1   FILLDBLK: PROC (START$,SMBLK);
     1452    10215        /**/
     1453    10216    2   DCL START$ PTR;
     1454    10217        %KQ_MBLK (FPTN=SMBLK,STCLASS="",SUPR=1);
     1455    10487    2   DCL BLOTTO UBIN;
     1456    10488        /**/
     1457    10489    2           SMBLK=KQ_ISMBLK;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:42   
     1458    10490    2           SMBLK.SUPER  ='1'B;
     1459    10491    2           SMBLK.DDA    =DDA;
     1460    10492    2           SMBLK.PCVALID='1'B;
     1461    10493    2           SMBLK.KEY1   =START$->KQ$MBLK.KEY1;
     1462    10494    2           SMBLK.KEY2   =START$->KQ$MBLK.KEY2;
     1463    10495    2           SMBLK.PRIO   =START$->KQ$MBLK.PRIO;
     1464    10496    2           SMBLK.UTS    =START$->KQ$MBLK.UTS;
     1465    10497    2           SMBLK.UTSXTLO=START$->KQ$MBLK.STAMP;
     1466    10498    2           SMBLK.COUNT  =NMBLKS;
     1467    10499    2           SMBLK.FIRSTX =0;
     1468    10500    2           CALL SSS$XSYSTIME (BLOTTO,I);
     1469    10501    2           SMBLK.STAMP=I;
     1470    10502    2           Z$=PINCRW(DBLK$,SIZEW(KQ$DBLK));
     1471    10503    2           X$=START$;
     1472    10504    3             DO I = 1 TO NMBLKS;
     1473    10505    3             Z$->KQ$MBLK=X$->KQ$MBLK;
     1474    10506    3             IF X$->KQ$MBLK.KEY1 ~= SMBLK.KEY1 THEN SMBLK.KEY1ALL = '0'B;
     1475    10507    3             IF X$->KQ$MBLK.KEY2 ~= SMBLK.KEY2 THEN SMBLK.KEY2ALL = '0'B;
     1476    10508    3             Z$=PINCRW(Z$,SIZEW(KQ$MBLK));
     1477    10509    3             X$=X$->KQ$MBLK.LNK$;
     1478    10510    3             END;
     1479    10511    2           SMBLK.PRIOLO =PINCRW(Z$,-SIZEW(KQ$MBLK))->KQ$MBLK.PRIO;
     1480    10512    2           SMBLK.UTSHI  =PINCRW(Z$,-SIZEW(KQ$MBLK))->KQ$MBLK.UTS;
     1481    10513    2           SMBLK.UTSXTHI=PINCRW(Z$,-SIZEW(KQ$MBLK))->KQ$MBLK.STAMP;
     1482    10514    2           CTLBLK$=PINCRW(DBLK$,DBLK$->KQ$DBLK.SIZW-SIZEW(KQ$MBLK));
     1483    10515    2           CTLBLK$->KQ$MBLK=SMBLK;
     1484    10516    2           DBLK$->KQ$DBLK.MBLK='1'B;
     1485    10517    2           DBLK$->KQ$DBLK.STAMP=SMBLK.STAMP;
     1486    10518    2           DBLK$->KQ$DBLK.DSIZE=NMBLKS*SIZEC(KQ$MBLK);
     1487    10519    2           RETURN;
     1488    10520    2   END FILLDBLK;
     1489    10521        /********************************************************
     1490    10522        *********************************************************/
     1491    10523        /**/
     1492    10524        /*D* NAME:         GETLIST
     1493    10525             PURPOSE:      To find a sub-list of MBLKS
     1494    10526             DESCRIPTION:  Finds a sub-list of MBLKs that are all
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:43   
     1495    10527                           ordinary, of len >= 2.
     1496    10528                           ALTRETs if none
     1497    10529             OUTPUT:       START$ is first one
     1498    10530                           END$ is last one
     1499    10531                           NMBLKS is count
     1500    10532        */
     1501    10533    1   GETLIST: PROC ALTRET;
     1502    10534        /**/
     1503    10535    2           MBLK$=MLH$->KQ$MLH.HEAD$;
     1504    10536    2           NMBLKS = 0;
     1505    10537    3             DO WHILE (MBLK$ ~= ADDR(NIL));
     1506    10538    3             IF MBLK$->KQ$MBLK.SUPER
     1507    10539    3             OR MBLK$->KQ$NRMLMBLK.RBLK
     1508    10540    3             THEN
     1509    10541    3              IF NMBLKS >= 2 THEN RETURN;
     1510    10542    3              ELSE NMBLKS = 0;
     1511    10543    4             ELSE DO;
     1512    10544    4               IF NMBLKS = 0 THEN START$ = MBLK$;
     1513    10545    4               END$ = MBLK$;
     1514    10546    4               NMBLKS = NMBLKS + 1;
     1515    10547    4               IF NMBLKS = %KQ_MMPS# THEN RETURN;
     1516    10548    4               END;
     1517    10549    3             MBLK$ = MBLK$->KQ$MBLK.LNK$;
     1518    10550    3             END;  /* do while */
     1519    10551    2           IF NMBLKS < 2 THEN ALTRETURN;
     1520    10552    2           RETURN;
     1521    10553        /**/
     1522    10554        /*D* NAME:         GETSLIST
     1523    10555             PURPOSE:      To find 2 adjacent super MBLKs
     1524    10556        */
     1525    10557    2   GETSLIST: ENTRY ALTRET;
     1526    10558        /**/
     1527    10559    2           MBLK$=MLH$->KQ$MLH.HEAD$;
     1528    10560    2   GS0:    IF MBLK$ = ADDR(NIL) THEN ALTRETURN;
     1529    10561    2           IF NOT MBLK$->KQ$MBLK.SUPER THEN
     1530    10562    2            IF MBLK$ = MLH$->KQ$MLH.HEAD$ THEN
     1531    10563    3              DO;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:44   
     1532    10564    3              MBLK$=MBLK$->KQ$MBLK.LNK$;
     1533    10565    3              GOTO GS0;
     1534    10566    3              END;
     1535    10567    2            ELSE CALL SC_CGGARB;
     1536    10568    2           IF MBLK$->KQ$MBLK.LNK$ = ADDR(NIL) THEN ALTRETURN;
     1537    10569    2           END$=MBLK$->KQ$MBLK.LNK$;
     1538    10570    2           IF NOT END$->KQ$MBLK.SUPER THEN CALL SC_CGGARB;
     1539    10571        /*S* SCREECH_CODE: KQS-S$CGGARB
     1540    10572             TYPE:         SCREECH
     1541    10573             MESSAGE:      COMGROUP garbage collection error
     1542    10574             REMARKS:      An irrecoverable inconsistency has occurred
     1543    10575                           during comgroup garbage collection. */
     1544    10576    2           IF END$->KQ$MBLK.STATE ~= KQSS_IDLE# THEN
     1545    10577    3             DO;
     1546    10578    3             MBLK$=END$;
     1547    10579    3             GOTO GS0;
     1548    10580    3             END;
     1549    10581    2           NMBLKS=2;
     1550    10582    2           RETURN;
     1551    10583    2   END GETLIST;
     1552    10584        /********************************************************
     1553    10585        *********************************************************/
     1554    10586        /**/
     1555    10587        /*D* NAME:         GETDBLK
     1556    10588             PURPOSE:      To allocate a data block
     1557    10589             DESCRIPTION:  A data block big enuff for
     1558    10590                              MAX (NMBLKS,%KQ_MMPS#)
     1559    10591                           MBLKs is allocated.  If immediately successful,
     1560    10592                           RETURNs with DDA, DBLK$.  Else ALTRETURNs with
     1561    10593                           DDA = KQDE_NSPC or KQDE_NDFRBLK (having
     1562    10594                           already called SQUISHX if no defer block was
     1563    10595                           obtained.)  Else (got a defer block), defers
     1564    10596                           the process with the passed defer code and
     1565    10597                           ALTRETURNs with DBLK$ ~= ADDR(NIL);
     1566    10598
     1567    10599                           CLKDFR is the defer code to use if no defer
     1568    10600                           blocks are available, DFR is what to use if
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:45   
     1569    10601                           one was available.
     1570    10602        */
     1571    10603    1   GETDBLK: PROC (DFR,CLKDFR) ALTRET;
     1572    10604        /**/
     1573    10605    2   DCL DFR SBIN;
     1574    10606    2   DCL CLKDFR SBIN;
     1575    10607        /**/
     1576    10608    2           DDA=NMBLKS;
     1577    10609    2           IF DDA > %KQ_MMPS# THEN DDA=%KQ_MMPS#;
     1578    10610    2           DDA=(DDA+1)*SIZEC(KQ$MBLK); /* Leave space for REDUNDANT */
     1579    10611    2           CALL KQD$GET (CG$->KQ$CG,DBLK$,DDA) ALTRET(G1);
     1580    10612    2           RETURN;
     1581    10613    2   G1:     IF DBLK$ ~= ADDR(NIL) THEN
     1582    10614    3             DO; /* Got a defer block */
     1583    10615    3             DBLK$->KQ$DFRBLK.INFO$=CG$;
     1584    10616    3             KQ$GARB.DELAY=-DFR;
     1585    10617    3             CALL SQUISHX;
     1586    10618    3             CALL KQD$DEFERGO (CG$->KQ$CG,DBLK$,ENTADDR(KQS$GCONT));
     1587    10619    3             ALTRETURN;
     1588    10620    3             END;
     1589    10621        /**/
     1590    10622                      /* Error */
     1591    10623    3             DO CASE (DDA);
     1592    10624
     1593    10625    3               CASE (%KQDE_NDFRBLK); /* No defer blocks */
     1594    10626    3                 CALL SQUISHX;
     1595    10627    3                 KQ$GARB.DELAY=CLKDFR;
     1596    10628    3                 ALTRETURN;
     1597    10629
     1598    10630    3               CASE (%KQDE_NSPC);
     1599    10631    3                 ALTRETURN;
     1600    10632
     1601    10633    3               CASE (ELSE);
     1602    10634    3                 CALL SC_CGGARB;
     1603    10635
     1604    10636    3             END;
     1605    10637    2   END GETDBLK;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:46   
     1606    10638        /********************************************************
     1607    10639        *********************************************************/
     1608    10640        /**/
     1609    10641        /*D* NAME:         CONCATN
     1610    10642             PURPOSE:      To merge a super and normal MBLK
     1611    10643             DESCRIPTION:  MBLK$ is the super MBLK, END$ is its flink
     1612    10644                           and is normal.  END$ is placed on the tail
     1613    10645                           of MBLK$'s INSHD$ list, and removed from
     1614    10646                           the MLH chain.
     1615    10647        */
     1616    10648    1   CONCATN: PROC;
     1617    10649        /**/
     1618    10650    3             DO INHIBIT;
     1619    10651    3             MBLK$->KQ$MBLK.LNK$=END$->KQ$MBLK.LNK$;
     1620    10652    3             IF MBLK$->KQ$MBLK.LNK$ = ADDR(NIL) THEN MLH$->KQ$MLH.TAIL$=MBLK$;
     1621    10653    3             END$->KQ$MBLK.LNK$=ADDR(NIL);
     1622    10654    3             IF MBLK$->KQ$MBLK.INSHD$ = ADDR(NIL) THEN
     1623    10655    3              MBLK$->KQ$MBLK.INSHD$=END$;
     1624    10656    3             ELSE
     1625    10657    4               DO;
     1626    10658    4               P$=MBLK$->KQ$MBLK.INSHD$;
     1627    10659    5                 DO WHILE (P$->KQ$MBLK.LNK$ ~= ADDR(NIL));
     1628    10660    5                 P$=P$->KQ$MBLK.LNK$;
     1629    10661    5                 END;
     1630    10662    4               P$->KQ$MBLK.LNK$=END$;
     1631    10663    4               END;
     1632    10664    3             MBLK$->KQ$MBLK.UTSHI=END$->KQ$MBLK.UTS;
     1633    10665    3             MBLK$->KQ$MBLK.PRIOLO=END$->KQ$MBLK.PRIO;
     1634    10666    3             END;
     1635    10667    2           RETURN;
     1636    10668    2   END CONCATN;
     1637    10669        /********************************************************
     1638    10670        *********************************************************/
     1639    10671        /**/
     1640    10672        /*D* NAME:         CONCATS
     1641    10673             PURPOSE:      To concatenate 2 super MBLKS
     1642    10674             INPUT:        MBLK$ = first MBLK
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:47   
     1643    10675                           KQ$GARB.MBLK$ = MBLK$
     1644    10676             DESCRIPTION:  The last DBLK of the first is flinked to the
     1645    10677                           FDA of the 2nd, which is blinked to the former.
     1646    10678                           Neither have INSHD$ lists.  Finally the second
     1647    10679                           super MBLK is deleted.
     1648    10680        */
     1649    10681    1   CONCATS: PROC ALTRET;
     1650    10682        /**/
     1651    10683    2   DCL T1$ PTR;
     1652    10684    2   DCL T2$ PTR;
     1653    10685        /**/
     1654    10686    2           KQ$GARB.CONERR='0'B;
     1655    10687    2           END$=MBLK$->KQ$MBLK.LNK$;
     1656    10688    2           IF KQ_LOG.GARB THEN
     1657    10689    3             DO;
     1658    10690    3             T1$=MBLK$;
     1659    10691    3             T2$=END$;
     1660    10692    3             CALL KQZ$LOG (CG$->KQ$CG,%KQLOG_GCON,ENTFLAG,0,0,T1$,T2$) ALTRET(ZA1);
     1661    10693    3             RETURN;
     1662    10694    3   ZA1:      END;
     1663    10695    2           IF MBLK$->KQ$MBLK.INSHD$ ~= ADDR(NIL)
     1664    10696    2           OR END$->KQ$MBLK.INSHD$ ~= ADDR(NIL) THEN
     1665    10697    2            CALL SC_CGGARB;
     1666    10698    2           IF MBLK$->KQ$MBLK.DDA = 0 THEN
     1667    10699    3             DO;
     1668    10700    3             CALL INSMT;
     1669    10701    3             RETURN;
     1670    10702    3             END;
     1671    10703        /**/
     1672    10704    2   C10:    CALL INVALIDATE (MBLK$->KQ$MBLK);
     1673    10705    2           DDA=MBLK$->KQ$MBLK.SDA.LDA;
     1674    10706    2           DBLK$R=MBLK$->KQ$MBLK.LCSTAMP;
     1675    10707    2           CALL FETCH (KQGD_SQCF0#,KQGD_SQCD0#) ALTRET(NOFETCH0);
     1676    10708    2   C30:    CTLBLK$=PINCRW(DBLK$,DBLK$->KQ$DBLK.SIZW-SIZEW(KQ$MBLK));
     1677    10709    2           DBLK$->KQ$DBLK.FLNKDA=END$->KQ$MBLK.DDA;
     1678    10710    2           CTLBLK$->KQ$MBLK.CCSTAMP=END$->KQ$MBLK.STAMP;
     1679    10711    2           CALL UPDATED;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:48   
     1680    10712    2   C40:    DBLK$R=END$->KQ$MBLK.STAMP;
     1681    10713    2           CALL INVALIDATE (END$->KQ$MBLK);
     1682    10714    2           END$->KQ$MBLK.SDA.CCDDA=END$->KQ$MBLK.DDA;
     1683    10715    2           DDA=END$->KQ$MBLK.DDA;
     1684    10716    2           CALL FETCH (KQGD_SQCF1#,KQGD_SQCD1#) ALTRET(NOFETCH1);
     1685    10717    2   C60:    SAVP$=MBLK$;
     1686    10718    2           MBLK$=END$;
     1687    10719    2           CALL CHKBLINK ALTRET(FERR11);
     1688    10720    2           MBLK$=SAVP$;
     1689    10721    3             DO INHIBIT;
     1690    10722    3             CTLBLK$->KQ$MBLK.PCVALID='0'B;
     1691    10723    3             CTLBLK$->KQ$MBLK.PCDDA=MBLK$->KQ$MBLK.SDA.LDA;
     1692    10724    3             MBLK$->KQ$MBLK.COUNT  =MBLK$->KQ$MBLK.COUNT+END$->KQ$MBLK.COUNT;
     1693    10725    3             MBLK$->KQ$MBLK.PRIOLO =END$->KQ$MBLK.PRIOLO;
     1694    10726    3             MBLK$->KQ$MBLK.UTSHI  =END$->KQ$MBLK.UTSHI;
     1695    10727    3             MBLK$->KQ$MBLK.UTSXTHI=END$->KQ$MBLK.UTSXTHI;
     1696    10728    3             MBLK$->KQ$MBLK.SDA.LDA=END$->KQ$MBLK.SDA.LDA;
     1697    10729    3             MBLK$->KQ$MBLK.LCSTAMP=END$->KQ$MBLK.LCSTAMP;
     1698    10730    3             MBLK$->KQ$MBLK.LNK$=END$->KQ$MBLK.LNK$;
     1699    10731    3             IF MBLK$->KQ$MBLK.LNK$ = ADDR(NIL) THEN
     1700    10732    3              MLH$->KQ$MLH.TAIL$=MBLK$;
     1701    10733    3             MLH$->KQ$MLH.SUPERCNT=MLH$->KQ$MLH.SUPERCNT-1;
     1702    10734    3             CALL UPDATED;
     1703    10735    3             CALL RELMBLK (END$->KQ$MBLK);
     1704    10736    3             RETURN;
     1705    10737    3             END; /* INHIBIT */
     1706    10738        /**/
     1707    10739        /**/
     1708    10740    2   NOFETCH0:; /* Can't fetch LDA of first guy */
     1709    10741    2           IF DBLK$ ~= ADDR(NIL)
     1710    10742    2           OR DDA = %KQDE_NDFRBLK THEN ALTRETURN;
     1711    10743                           /* Fetch error */
     1712    10744    2   FERR0:  CALL DISKERR;
     1713    10745                     /*    Set CONERR and return.
     1714    10746                      *    This will cause SETLDA
     1715    10747                      *    to be called to re-establish
     1716    10748                      *    COUNT and LDA based on how
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:49   
     1717    10749                      *    far down the chain we can
     1718    10750                      *    successfully read.  Then
     1719    10751                      *    we'll try the concat again.
     1720    10752                      */
     1721    10753    2           KQ$GARB.CONERR='1'B;
     1722    10754    2           RETURN;
     1723    10755        /**/
     1724    10756    2   CONCATF0: ENTRY ALTRET;
     1725    10757        /**/
     1726    10758    2           END$=MBLK$->KQ$MBLK.LNK$;
     1727    10759    2           IF DBLK$ = ADDR(NIL) THEN GOTO FERR0;
     1728    10760    2           GOTO C30;
     1729    10761        /**/
     1730    10762    2   CONCATD0: ENTRY ALTRET;
     1731    10763        /**/
     1732    10764    2           END$=MBLK$->KQ$MBLK.LNK$;
     1733    10765    2           GOTO C10;
     1734    10766        /**/
     1735    10767        /**/
     1736    10768    2   NOFETCH1:; /* Can't fetch FDA of second guy */
     1737    10769    2           IF DBLK$ ~= ADDR(NIL)
     1738    10770    2           OR DDA = %KQDE_NDFRBLK THEN ALTRETURN;
     1739    10771                           /* Fetch error */
     1740    10772    2   FERR1:  SAVP$=MBLK$;
     1741    10773    2   FERR11: P$=SAVP$;
     1742    10774    2           MBLK$=END$;
     1743    10775    2           CALL DISKERR;
     1744    10776    2           I=MBLK$->KQ$MBLK.COUNT;
     1745    10777    2           MBLK$->KQ$MBLK.COUNT=0;
     1746    10778    2           MLH$->KQ$MLH.COUNT=MLH$->KQ$MLH.COUNT-I;
     1747    10779                %CHKCNT;
     1748    10782    2           MBLK$->KQ$MBLK.DDA=0;
     1749    10783    2           CALL INSMT1;
     1750    10784    2           MBLK$=SAVP$;
     1751    10785    2           RETURN;
     1752    10786        /**/
     1753    10787    2   CONCATF1: ENTRY ALTRET;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:50   
     1754    10788        /**/
     1755    10789    2           END$=MBLK$->KQ$MBLK.LNK$;
     1756    10790    2           IF DBLK$ = ADDR(NIL) THEN GOTO FERR1;
     1757    10791    2           GOTO C60;
     1758    10792        /**/
     1759    10793    2   CONCATD1: ENTRY ALTRET;
     1760    10794        /**/
     1761    10795    2           END$=MBLK$->KQ$MBLK.LNK$;
     1762    10796    2           GOTO C40;
     1763    10797    2   END CONCATS;
     1764    10798        /********************************************************
     1765    10799        *********************************************************/
     1766    10800        /**/
     1767    10801        /*D* NAME:         INSMT
     1768    10802             PURPOSE:      To fix a super MBLK with no DBLKs
     1769    10803             DESCRIPTION:  The INSHD$ list, if any, is merged
     1770    10804                           into the MLH list, and the super MBLK
     1771    10805                           deleted.
     1772    10806                           Sets KQ$GARB.RECYCLE to indicate we did this.
     1773    10807        */
     1774    10808    1   INSMT:  PROC;
     1775    10809        /**/
     1776    10810    2           CALL GETPRED;
     1777    10811        /**/
     1778    10812    2   INSMT1: ENTRY;
     1779    10813        /**/
     1780    10814    2           KQ$GARB.RECYCLE='1'B;
     1781    10815    2           IF MBLK$->KQ$MBLK.INSHD$ ~= ADDR(NIL) THEN
     1782    10816    3             DO;
     1783    10817    3             X$=MBLK$->KQ$MBLK.INSHD$;
     1784    10818    4               DO WHILE (X$->KQ$MBLK.LNK$ ~= ADDR(NIL));
     1785    10819    4               X$=X$->KQ$MBLK.LNK$;
     1786    10820    4               END;
     1787    10821    3             X$->KQ$MBLK.LNK$=MBLK$->KQ$MBLK.LNK$;
     1788    10822    3             IF X$->KQ$MBLK.LNK$ = ADDR(NIL) THEN
     1789    10823    3              MLH$->KQ$MLH.TAIL$=X$;
     1790    10824    3             IF P$ = ADDR(NIL) THEN
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:51   
     1791    10825    3              MLH$->KQ$MLH.HEAD$=MBLK$->KQ$MBLK.INSHD$;
     1792    10826    3             ELSE P$->KQ$MBLK.LNK$=MBLK$->KQ$MBLK.INSHD$;
     1793    10827    3             END;
     1794    10828    2           ELSE
     1795    10829    3             DO;
     1796    10830    3             IF P$ = ADDR(NIL) THEN
     1797    10831    3              MLH$->KQ$MLH.HEAD$=MBLK$->KQ$MBLK.LNK$;
     1798    10832    3             ELSE P$->KQ$MBLK.LNK$=MBLK$->KQ$MBLK.LNK$;
     1799    10833    3             IF MBLK$->KQ$MBLK.LNK$ = ADDR(NIL) THEN
     1800    10834    3              MLH$->KQ$MLH.TAIL$=P$;
     1801    10835    3             END;
     1802    10836    2           MLH$->KQ$MLH.SUPERCNT=MLH$->KQ$MLH.SUPERCNT-1;
     1803    10837                %CHKCNT;
     1804    10840    2           CALL RELMBLK (MBLK$->KQ$MBLK);
     1805    10841    2   RTN:    RETURN;
     1806    10842    2   END INSMT;
     1807    10843        /********************************************************
     1808    10844        *********************************************************/
     1809    10845        /**/
     1810    10846        /*D* NAME:         INSRT
     1811    10847             PURPOSE:      To insert the INSHD$ list of a super
     1812    10848                           MBLK into its disc list
     1813    10849             INPUT:        MBLK$ = first MBLK
     1814    10850                           KQ$GARB.MBLK$ = MBLK$
     1815    10851             DESCRIPTION:  ALTRETs if delay required, else returns
     1816    10852                           when done.
     1817    10853        */
     1818    10854    1   INSRT:  PROC ALTRET;
     1819    10855        /**/
     1820    10856    2   DCL I$ PTR;
     1821    10857    2   DCL NFREE SBIN;
     1822    10858    2   DCL FREE$ PTR;
     1823    10859        %KQ_MBLK (FPTN=SMBLK,STCLASS=AUTO,SUPR=1);
     1824    11129        /**/
     1825    11130    2           DBLK$=ADDR(NIL);
     1826    11131    2   I10:    IF MBLK$->KQ$MBLK.DDA = 0 THEN
     1827    11132    3             DO;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:52   
     1828    11133    3             CALL INSMT;
     1829    11134    3             GOTO INSX;
     1830    11135    3             END;
     1831    11136        /**/
     1832    11137    2           IF MBLK$->KQ$MBLK.INSHD$ = ADDR(NIL) THEN
     1833    11138    2            RETURN;
     1834    11139    2           IF KQ_LOG.GARB THEN
     1835    11140    3             DO;
     1836    11141    3             I$=MBLK$;
     1837    11142    3             CALL KQZ$LOG (CG$->KQ$CG,%KQLOG_GINS,ENTFLAG,0,0,I$,
     1838    11143    3             MBLK$->KQ$MBLK.DDA) ALTRET(ZA1);
     1839    11144    3             RETURN;
     1840    11145    3   ZA1:      END;
     1841    11146    2           GOTO I12;
     1842    11147        /**/
     1843    11148        /*D* NAME:         INSRCVR
     1844    11149             PURPOSE:      To continue an INSRT when a CG is reopened.
     1845    11150             DESCRIPTION:  KQS$RECOVER, upon finding that an insert was
     1846    11151                           in progress at crash time, restarts the
     1847    11152                           SQUISH process and calls here for the current
     1848    11153                           MBLK.  Based on where we were when we crashed,
     1849    11154                           we march on.
     1850    11155        */
     1851    11156    2   INSRCVR: ENTRY ALTRET;
     1852    11157        /**/
     1853    11158    2           MBLK$=KQ$GARB.MBLK$;
     1854    11159    2           DBLK$=KQ$GARB.DBLK$;
     1855    11160    3             DO CASE (KQ$GARB.SPSTATE);
     1856    11161    3               CASE (KQSP_CBIM0#,KQSP_CBIM1#);
     1857    11162    3                 GOTO FTCH0;
     1858    11163    3               CASE (KQSP_CBUL#);
     1859    11164    3                 GOTO RCBUL;
     1860    11165    3               CASE (KQSP_NBIM#);
     1861    11166    3                 GOTO DOSPLIT;
     1862    11167    3               CASE (KQSP_NBUL#);
     1863    11168    3                 GOTO RNBUL;
     1864    11169    3               CASE (KQSP_BBIM#);
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:53   
     1865    11170    3                 GOTO FTCH1;
     1866    11171    3               CASE (KQSP_BBUL#);
     1867    11172    3                 GOTO RBBUL;
     1868    11173    3               CASE (KQSP_FBIM#);
     1869    11174    3                 GOTO RFBIM;
     1870    11175    3               CASE (KQSP_FBUL#);
     1871    11176    3                 GOTO RFBUL;
     1872    11177    3               CASE (KQSP_RLSP#);
     1873    11178    3                 GOTO RRLSP;
     1874    11179    3               CASE (KQSP_DELD#);
     1875    11180    3                 GOTO RDELD;
     1876    11181    3             END;
     1877    11182    2           RETURN;
     1878    11183        /**/
     1879    11184        /*D* NAME:         SETLDA
     1880    11185             PURPOSE:      To re-establish LDA and COUNT
     1881    11186             DESCRIPTION:  Called when CONCATS gets an error fetching
     1882    11187                           the LDA of an MBLK.  We simply flink down
     1883    11188                           the disk chain and re-set everything properly
     1884    11189                           when we get an error.
     1885    11190        */
     1886    11191    2   SETLDA: ENTRY ALTRET;
     1887    11192        /**/
     1888    11193    2   I12:    CALL INVALIDATE (MBLK$->KQ$MBLK);
     1889    11194    2           MBLK$->KQ$MBLK.PCDDA=0;
     1890    11195    2           KQ$GARB.TCOUNT=0;
     1891    11196    2           MBLK$->KQ$MBLK.SDA.CCDDA=MBLK$->KQ$MBLK.DDA;
     1892    11197    2           MBLK$->KQ$MBLK.CCSTAMP=MBLK$->KQ$MBLK.STAMP;
     1893    11198        /**/
     1894    11199                     /* Fetch the next DBLK
     1895    11200                      * and process it
     1896    11201                      */
     1897    11202    2   FTCH0:  DDA=MBLK$->KQ$MBLK.SDA.CCDDA;
     1898    11203    2           DBLK$R=MBLK$->KQ$MBLK.CCSTAMP;
     1899    11204    2           KQ$GARB.SPSTATE=KQSP_CBIM0#;
     1900    11205    2           CALL FETCH (KQGD_SQIF0#,KQGD_SQID0#) ALTRET(NOFETCH0);
     1901    11206        /**/
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:54   
     1902    11207                /*    For those MBLKs that belong in this DBLK
     1903    11208                 *    (as determined by the limit PRIO/UTS in
     1904    11209                 *    the redundant MBLK), insert them in their
     1905    11210                 *    proper place, using free space if avail
     1906    11211                 *    or dropping the end MBLK onto the SPLIT
     1907    11212                 *    chain if not.  When we run out of space,
     1908    11213                 *    all belonging MBLKs go on the SPLIT chain.
     1909    11214                 *    At the finish, if the SPLIT chain is nonempty
     1910    11215                 *    we do a 'split', putting them into a new
     1911    11216                 *    DBLK.
     1912    11217                 */
     1913    11218        /**/
     1914    11219                /* CTLBLK$ redundant MBLK at end of DBLK
     1915    11220                 * Z$      current insert point
     1916    11221                 * NMBLKS  number of MBLKs left to look at
     1917    11222                 * FREE$   pointer to free space at DBLK end
     1918    11223                 * NFREE   number of free MBLK slots
     1919    11224                 * I$      current head of INSHD$ chain
     1920    11225                 */
     1921    11226        /**/
     1922    11227                /*    KQ$MBLK.SDA.CCDDA
     1923    11228                 *    KQ$MBLK.CCSTAMP    : current chunk we're inserting in
     1924    11229                 *    KQ$MBLK.PCDDA
     1925    11230                 *    KQ$GARB.PCSTAMP    : blink of current chunk
     1926    11231                 *    KQ$GARB.NCDDA
     1927    11232                 *    KQ$GARB.NCSTAMP    : flink of current chunk
     1928    11233                 *    KQ$GARB.SCDDA
     1929    11234                 *    KQ$GARB.SCSTAMP    : new DBLK being created; will become
     1930    11235                 *                         flink of 'current' chunk
     1931    11236                 */
     1932    11237        /**/
     1933    11238        /*
     1934    11239                                 DBLK
     1935    11240
     1936    11241                 *****************************************
     1937    11242                 *                                       *
     1938    11243                 *         KQ$DBLK  (header)             *
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:55   
     1939    11244                 *                                       *
     1940    11245                 *****************************************
     1941    11246                 *                                       *
     1942    11247                 *        Already-processed MBLKs        *
     1943    11248                 *                                       *
     1944    11249          Z$     *****************************************
     1945    11250                 *                                       *
     1946    11251                 *      NMBLKS MBLKs to look at yet      *
     1947    11252                 *                                       *
     1948    11253          FREE$  *****************************************
     1949    11254                 *                                       *
     1950    11255                 *           NFREE free MBLKs            *
     1951    11256                 *                                       *
     1952    11257          CTLBLK$*****************************************
     1953    11258                 *                                       *
     1954    11259                 *          The redundant MBLK           *
     1955    11260                 *                                       *
     1956    11261                 *****************************************
     1957    11262        */
     1958    11263        /**/
     1959    11264    2   FTCHD0: IF KQ$GARB.INSRT THEN
     1960    11265    3             DO;
     1961    11266    3             KQ$GARB.SPLITCNT=0;
     1962    11267    3             KQ$GARB.SQHD$=ADDR(NIL);
     1963    11268    3             KQ$GARB.SPHD$=ADDR(NIL);
     1964    11269    3             KQ$GARB.DBLK$=DBLK$;
     1965    11270    3             END;
     1966    11271    2   RCBIM:  CALL CHKBLINK ALTRET(FERR0);
     1967    11272    2           FREE$=PINCRC(DBLK$,SIZEC(KQ$DBLK)+DBLK$->KQ$DBLK.DSIZE);
     1968    11273    2           NFREE=POFFC(CTLBLK$,FREE$)/SIZEC(KQ$MBLK);
     1969    11274    2           NMBLKS=DBLK$->KQ$DBLK.DSIZE/SIZEC(KQ$MBLK);
     1970    11275    2           Z$=PINCRW(DBLK$,SIZEW(KQ$DBLK));
     1971    11276    2           IF CTLBLK$->KQ$MBLK.FIRSTX ~= 0 THEN
     1972    11277    3             DO INHIBIT; /* Slide up to the beginning to simplify */
     1973    11278    3             I=NMBLKS*SIZEC(KQ$MBLK);
     1974    11279    3             Z$->B$$CHARS=PINCRW(Z$,CTLBLK$->KQ$MBLK.FIRSTX)->B$$CHARS;
     1975    11280    3             CTLBLK$->KQ$MBLK.FIRSTX=0;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:56   
     1976    11281    3             CALL UPDATE;
     1977    11282    3             END;
     1978    11283    2           KQ$GARB.NCDDA=DBLK$->KQ$DBLK.FLNKDA;
     1979    11284    2           KQ$GARB.NCSTAMP=CTLBLK$->KQ$MBLK.CCSTAMP;
     1980    11285    2           IF KQ$GARB.SPSTATE = KQSP_CBIM0# THEN
     1981    11286    3             DO INHIBIT;
     1982    11287                        /* The ONLY unrecoverable part of this fetch
     1983    11288                         * process is this update of TCOUNT,  i.e.
     1984    11289                         * if we crash at any point up to here, it's
     1985    11290                         * perfectly OK to just start over again with
     1986    11291                         * the FETCH.  After this, however, we must
     1987    11292                         * change the state so that when we come thru
     1988    11293                         * again, we don't update TCOUNT a second time.
     1989    11294                         */
     1990    11295    3             KQ$GARB.TCOUNT=KQ$GARB.TCOUNT+NMBLKS;
     1991    11296    3             KQ$GARB.SPSTATE=KQSP_CBIM1#;
     1992    11297    3             END;
     1993    11298    2           KQ$GARB.CCCOUNT=NMBLKS;
     1994    11299    2           IF KQ$GARB.TCOUNT > MBLK$->KQ$MBLK.COUNT THEN
     1995    11300    2            CALL SC_CGGARB;
     1996    11301    2           ELSE IF KQ$GARB.TCOUNT = MBLK$->KQ$MBLK.COUNT THEN
     1997    11302    2             KQ$GARB.NCDDA=0;
     1998    11303    2            ELSE IF KQ$GARB.NCDDA = 0 THEN
     1999    11304    2              CALL SC_CGGARB;
     2000    11305    2           IF NOT KQ$GARB.INSRT THEN
     2001    11306    3             DO; /* SETLDA */
     2002    11307    3             IF KQ$GARB.NCDDA = 0 THEN RETURN;
     2003    11308    3             GOTO I90;
     2004    11309    3             END;
     2005    11310        /**/
     2006    11311    2   ILOOP:  I$=MBLK$->KQ$MBLK.INSHD$;
     2007    11312    2           IF I$ = ADDR(NIL) THEN GOTO SPLIT;
     2008    11313    2           IF I$->KQ$MBLK.PRIO < CTLBLK$->KQ$MBLK.PRIOLO THEN GOTO SPLIT;
     2009    11314    2           ELSE IF I$->KQ$MBLK.PRIO = CTLBLK$->KQ$MBLK.PRIOLO THEN
     2010    11315    2             IF I$->KQ$MBLK.UTS > CTLBLK$->KQ$MBLK.UTSHI THEN GOTO SPLIT;
     2011    11316    2             ELSE IF I$->KQ$MBLK.UTS = CTLBLK$->KQ$MBLK.UTSHI THEN
     2012    11317    2               IF I$->KQ$MBLK.STAMP > CTLBLK$->KQ$MBLK.UTSXTHI THEN GOTO SPLIT;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:57   
     2013    11318    2   IL0:    IF NMBLKS > 0 THEN
     2014    11319    3             DO;
     2015    11320    3             IF I$->KQ$MBLK.PRIO > Z$->KQ$MBLK.PRIO THEN GOTO IL10;
     2016    11321    3             ELSE IF I$->KQ$MBLK.PRIO = Z$->KQ$MBLK.PRIO THEN
     2017    11322    3               IF I$->KQ$MBLK.UTS < Z$->KQ$MBLK.UTS THEN GOTO IL10;
     2018    11323    3               ELSE IF I$->KQ$MBLK.UTS = Z$->KQ$MBLK.UTS THEN
     2019    11324    3                 IF I$->KQ$MBLK.STAMP < Z$->KQ$MBLK.STAMP THEN GOTO IL10;
     2020    11325    3             Z$=PINCRW(Z$,SIZEW(KQ$MBLK));
     2021    11326    3             NMBLKS=NMBLKS-1;
     2022    11327    3             GOTO IL0;
     2023    11328    3             END;
     2024    11329        /**/    /* Looked at all MBLKs that were there before */
     2025    11330    2           IF NFREE = 0 THEN
     2026    11331    3             DO;
     2027    11332                     /*    Put this one
     2028    11333                      *    on the SPLIT
     2029    11334                      *    list.
     2030    11335                      */
     2031    11336    3             CALL SPLT;
     2032    11337    3             GOTO ILOOP;
     2033    11338    3             END;
     2034    11339                     /*    Put this one
     2035    11340                      *    in the free
     2036    11341                      *    zone.
     2037    11342                      */
     2038    11343    2           FREE$->KQ$MBLK=I$->KQ$MBLK;
     2039    11344    2           CALL INSUPD;
     2040    11345    2           CALL RELMBLK (I$->KQ$MBLK);
     2041    11346    2           GOTO ILOOP;
     2042    11347        /**/
     2043    11348                     /*    Insert this one
     2044    11349                      *    ahead of Z$
     2045    11350                      */
     2046    11351    2   IL10:   IF NFREE > 0 THEN
     2047    11352    3             DO INHIBIT;
     2048    11353                     /*    Shuffle down
     2049    11354                      *    into the free zone.
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:58   
     2050    11355                      */
     2051    11356    3             CALL KQX$SLIDE (Z$->KQ$MBLK,NMBLKS);
     2052    11357    3             Z$->KQ$MBLK=I$->KQ$MBLK;
     2053    11358    3             CALL INSUPD;
     2054    11359    3             CALL RELMBLK (I$->KQ$MBLK);
     2055    11360    3             END;
     2056    11361    2           ELSE
     2057    11362    3             DO INHIBIT;
     2058    11363                     /*    No free space,
     2059    11364                      *    so squeeze last
     2060    11365                      *    onto SQUEEZE list.
     2061    11366                      */
     2062    11367    3             M$=PINCRW(CTLBLK$,-SIZEW(KQ$MBLK));
     2063    11368    3             SMBLK=M$->KQ$MBLK;
     2064    11369    3             CALL KQX$SLIDE (Z$->KQ$MBLK,NMBLKS-1);
     2065    11370    3             Z$->KQ$MBLK=I$->KQ$MBLK;
     2066    11371    3             MBLK$->KQ$MBLK.INSHD$=I$->KQ$MBLK.LNK$;
     2067    11372    3             I$->KQ$MBLK=SMBLK;
     2068    11373    3             CALL SQZ;
     2069    11374    3             CALL UPDATE;
     2070    11375    3             CTLBLK$->KQ$MBLK.PRIOLO =M$->KQ$MBLK.PRIO;
     2071    11376    3             CTLBLK$->KQ$MBLK.UTSHI  =M$->KQ$MBLK.UTS;
     2072    11377    3             CTLBLK$->KQ$MBLK.UTSXTHI=M$->KQ$MBLK.STAMP;
     2073    11378    3             END;
     2074    11379    2           NMBLKS=NMBLKS-1;
     2075    11380    2           Z$=PINCRW(Z$,SIZEW(KQ$MBLK));
     2076    11381    2           GOTO ILOOP;
     2077    11382        %EJECT;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:59   
     2078    11383        /**/
     2079    11384                     /*    Come here when done.
     2080    11385                      *    If there's anything
     2081    11386                      *    on the SPLIT list
     2082    11387                      *    then we must create
     2083    11388                      *    a new DBLK and dump
     2084    11389                      *    them into it, updating
     2085    11390                      *    various flinks and
     2086    11391                      *    blinks.
     2087    11392                      */
     2088    11393    2   SPLIT:  KQ$GARB.SPSTATE=KQSP_CBUL#;
     2089    11394    2           CALL UNLOCK;
     2090    11395    2   RCBUL:  IF KQ$GARB.SQHD$ ~= ADDR(NIL) THEN
     2091    11396    3             DO;
     2092    11397    4               DO WHILE (MBLK$->KQ$MBLK.INSHD$ ~= ADDR(NIL));
     2093    11398    4               I$=MBLK$->KQ$MBLK.INSHD$;
     2094    11399    4               IF I$->KQ$MBLK.PRIO < KQ$GARB.SQHD$->KQ$MBLK.PRIO THEN GOTO SPLIT0;
     2095    11400    4               ELSE IF I$->KQ$MBLK.PRIO = KQ$GARB.SQHD$->KQ$MBLK.PRIO THEN
     2096    11401    4                 IF I$->KQ$MBLK.UTS > KQ$GARB.SQHD$->KQ$MBLK.UTS THEN GOTO SPLIT0;
     2097    11402    4                 ELSE IF I$->KQ$MBLK.UTS = KQ$GARB.SQHD$->KQ$MBLK.UTS THEN
     2098    11403    4                   IF I$->KQ$MBLK.STAMP > KQ$GARB.SQHD$->KQ$MBLK.STAMP THEN GOTO SPLIT0
             11403                            ;
     2099    11404    4               CALL SPLT;
     2100    11405    4               END;
     2101    11406    3   SPLIT0:   IF KQ$GARB.SPHD$ ~= ADDR(NIL) THEN
     2102    11407    3              KQ$GARB.SPTL$->KQ$MBLK.LNK$=KQ$GARB.SQHD$;
     2103    11408    3             ELSE KQ$GARB.SPHD$=KQ$GARB.SQHD$;
     2104    11409    3             END;
     2105    11410    2           ELSE IF KQ$GARB.NCDDA = 0 THEN
     2106    11411    3              DO WHILE (MBLK$->KQ$MBLK.INSHD$ ~= ADDR(NIL));
     2107    11412    3              I$=MBLK$->KQ$MBLK.INSHD$;
     2108    11413    3              CALL SPLT;
     2109    11414    3              END;
     2110    11415    2           IF KQ$GARB.SPHD$ ~= ADDR(NIL) THEN
     2111    11416    3   DOSPLIT:  DO INHIBIT;
     2112    11417    3             NMBLKS=KQ$GARB.SPLITCNT;
     2113    11418    3             IF NMBLKS > %KQ_MMPS# THEN NMBLKS=%KQ_MMPS#;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:60   
     2114    11419    3             CALL GETDBLK (KQGD_SQIG0#,KQGD_SQID4#) ALTRET(NODBLK);
     2115    11420    3   GOTDBLK:  KQ$GARB.SPSTATE=KQSP_NBIM#;
     2116    11421    3             NMBLKS=KQ$GARB.SPLITCNT;
     2117    11422    3             IF NMBLKS > %KQ_MMPS# THEN NMBLKS=%KQ_MMPS#;
     2118    11423    3             CALL FILLDBLK (KQ$GARB.SPHD$,SMBLK);
     2119    11424    3             IF KQ_LOG.GARB THEN
     2120    11425    4               DO;
     2121    11426    4               CALL KQZ$LOG (CG$->KQ$CG,%KQLOG_GISP,ENTFLAG,
     2122    11427    4               SMBLK.DDA,
     2123    11428    4               ADDR(SMBLK.DDA)->B$$HALF,
     2124    11429    4               KQ$GARB.NCDDA,
     2125    11430    4               MBLK$->KQ$MBLK.SDA.CCDDA) ALTRET(ZA2);
     2126    11431    4               RETURN;
     2127    11432    4   ZA2:        END;
     2128    11433    3             CTLBLK$=PINCRW(DBLK$,DBLK$->KQ$DBLK.SIZW-SIZEW(KQ$MBLK));
     2129    11434    3             CTLBLK$->KQ$MBLK.CCSTAMP=KQ$GARB.NCSTAMP;
     2130    11435    3             CTLBLK$->KQ$MBLK.PCDDA=MBLK$->KQ$MBLK.SDA.CCDDA;
     2131    11436    3             CTLBLK$->KQ$MBLK.PCVALID='0'B;
     2132    11437    3             DBLK$->KQ$DBLK.FLNKDA=KQ$GARB.NCDDA;
     2133    11438    4               DO INHIBIT;
     2134    11439    4               KQ$GARB.TCOUNT=KQ$GARB.TCOUNT+NMBLKS;
     2135    11440    4               MBLK$->KQ$MBLK.COUNT=MBLK$->KQ$MBLK.COUNT+NMBLKS;
     2136    11441    4               KQ$GARB.SCDDA=DDA;
     2137    11442    4               KQ$GARB.SCSTAMP=SMBLK.STAMP;
     2138    11443    4               KQ$GARB.SPSTATE=KQSP_NBUL#;
     2139    11444    4               CALL UNLOCK;
     2140    11445    4               END;
     2141    11446    3   RNBUL:    ;
     2142    11447        /**/
     2143    11448    3   FTCH1:    DDA=MBLK$->KQ$MBLK.SDA.CCDDA;
     2144    11449    3             DBLK$R=MBLK$->KQ$MBLK.CCSTAMP;
     2145    11450    3             CALL FETCH (KQGD_SQIF1#,KQGD_SQID1#) ALTRET(NOFETCH1);
     2146    11451    3   FTCHD1:   KQ$GARB.SPSTATE=KQSP_BBIM#;
     2147    11452    3             CALL CHKBLINK ALTRET(FERR1);
     2148    11453    3             DBLK$->KQ$DBLK.FLNKDA=KQ$GARB.SCDDA;
     2149    11454    3             CTLBLK$->KQ$MBLK.CCSTAMP=KQ$GARB.SCSTAMP;
     2150    11455    3             KQ$GARB.SPSTATE=KQSP_BBUL#;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:61   
     2151    11456    3             CALL UPDATE;
     2152    11457    3             CALL UNLOCK;
     2153    11458    4               DO INHIBIT;
     2154    11459    4   RBBUL:      MBLK$->KQ$MBLK.PCDDA=MBLK$->KQ$MBLK.SDA.CCDDA;
     2155    11460    4               KQ$GARB.PCSTAMP=MBLK$->KQ$MBLK.CCSTAMP;
     2156    11461    4               MBLK$->KQ$MBLK.SDA.CCDDA=KQ$GARB.SCDDA;
     2157    11462    4               MBLK$->KQ$MBLK.CCSTAMP=KQ$GARB.SCSTAMP;
     2158    11463    4               NMBLKS=KQ$GARB.SPLITCNT;
     2159    11464    4               IF NMBLKS > %KQ_MMPS# THEN NMBLKS=%KQ_MMPS#;
     2160    11465    4               KQ$GARB.CCCOUNT=NMBLKS;
     2161    11466    4               IF KQ$GARB.NCDDA = 0 THEN
     2162    11467    5                 DO;
     2163    11468    5   I60:          MBLK$->KQ$MBLK.SDA.LDA=KQ$GARB.SCDDA;
     2164    11469    5                 MBLK$->KQ$MBLK.LCSTAMP=KQ$GARB.SCSTAMP;
     2165    11470    5                 END;
     2166    11471    4               ELSE
     2167    11472    5                 DO;
     2168    11473    5   FTCH2:        DDA=KQ$GARB.NCDDA;
     2169    11474    5                 DBLK$R=KQ$GARB.NCSTAMP;
     2170    11475    5   RFBIM:        CALL FETCH (KQGD_SQIF2#,KQGD_SQID2#) ALTRET(NOFETCH2);
     2171    11476    5   FTCHD2:       KQ$GARB.SPSTATE=KQSP_FBIM#;
     2172    11477    5                 CALL CHKBLINK ALTRET(FERR2);
     2173    11478    5                 CTLBLK$->KQ$MBLK.PCDDA=KQ$GARB.SCDDA;
     2174    11479    5                 KQ$GARB.SPSTATE=KQSP_FBUL#;
     2175    11480    5                 CALL UNLOCK;
     2176    11481    5   RFBUL:        END;
     2177    11482    4               END;
     2178    11483        /**/
     2179    11484    3   RRLSP:    KQ$GARB.SPSTATE=KQSP_RLSP#;
     2180    11485    3             NMBLKS=KQ$GARB.SPLITCNT;
     2181    11486    3             IF NMBLKS > %KQ_MMPS# THEN NMBLKS=%KQ_MMPS#;
     2182    11487    4               DO I = 1 TO NMBLKS;
     2183    11488    4               X$=KQ$GARB.SPHD$;
     2184    11489    5                 DO INHIBIT;
     2185    11490    5                 KQ$GARB.SPHD$=X$->KQ$MBLK.LNK$;
     2186    11491    5                 KQ$GARB.SPLITCNT=KQ$GARB.SPLITCNT-1;
     2187    11492    5                 CALL RELMBLK (X$->KQ$MBLK);
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:62   
     2188    11493    5                 END;
     2189    11494    4               END;
     2190    11495    3             IF KQ$GARB.SPLITCNT > 0 THEN GOTO DOSPLIT;
     2191    11496    3             END DOSPLIT;
     2192    11497        /**/
     2193    11498        /**/
     2194    11499                %CHKCNT;
     2195    11502    2           IF MBLK$->KQ$MBLK.INSHD$ = ADDR(NIL) THEN
     2196    11503    3             DO;
     2197    11504    3   INSX:     KQ$GARB.SPSTATE=0;
     2198    11505    3             RETURN;
     2199    11506    3             END;
     2200    11507    2           IF KQ$GARB.NCDDA = 0 THEN
     2201    11508    3             DO; /* Only happens if stuff was SQUEEZEd out */
     2202    11509    4               DO WHILE (MBLK$->KQ$MBLK.INSHD$ ~= ADDR(NIL));
     2203    11510    4               I$=MBLK$->KQ$MBLK.INSHD$;
     2204    11511    4               CALL SPLT;
     2205    11512    4               END;
     2206    11513    3             GOTO DOSPLIT;
     2207    11514    3             END;
     2208    11515    2   I90:    ;
     2209    11516    3             DO INHIBIT;
     2210    11517    3             MBLK$->KQ$MBLK.PCDDA=MBLK$->KQ$MBLK.SDA.CCDDA;
     2211    11518    3             KQ$GARB.PCSTAMP=MBLK$->KQ$MBLK.CCSTAMP;
     2212    11519    3             MBLK$->KQ$MBLK.SDA.CCDDA=KQ$GARB.NCDDA;
     2213    11520    3             MBLK$->KQ$MBLK.CCSTAMP=KQ$GARB.NCSTAMP;
     2214    11521    3             GOTO FTCH0;
     2215    11522    3             END; /* INHIBIT */
     2216    11523        /**/
     2217    11524        /**/
     2218    11525        %EJECT;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:63   
     2219    11526        /**/
     2220    11527        /**/
     2221    11528    2   NOFETCH0:; /* Can't fetch next DBLK */
     2222    11529    2           IF DBLK$ ~= ADDR(NIL)
     2223    11530    2           OR DDA = %KQDE_NDFRBLK THEN ALTRETURN;
     2224    11531                          /*    Truncate the
     2225    11532                           *    disk list at
     2226    11533                           *    this point,
     2227    11534                           *    and try again.
     2228    11535                           */
     2229    11536    2   FERR0:  CALL DISKERR;
     2230    11537    2           CALL RESET;
     2231    11538    2           GOTO I10;
     2232    11539        /**/
     2233    11540    2   INSRTF0: ENTRY ALTRET;
     2234    11541        /**/
     2235    11542    2           IF DBLK$ = ADDR(NIL) THEN GOTO FERR0;
     2236    11543    2           GOTO FTCHD0;
     2237    11544        /**/
     2238    11545    2   INSRTD0: ENTRY ALTRET;
     2239    11546        /**/
     2240    11547    2           GOTO FTCH0;
     2241    11548        /**/
     2242    11549        /**/
     2243    11550    2   NOFETCH1:; /* Can't fetch new DBLK's BLINK */
     2244    11551    2           IF DBLK$ ~= ADDR(NIL)
     2245    11552    2           OR DDA = %KQDE_NDFRBLK THEN ALTRETURN;
     2246    11553                          /*    Truncate the disk
     2247    11554                           *    list just before
     2248    11555                           *    the guy whose fetch
     2249    11556                           *    failed.  Put the
     2250    11557                           *    SPLIT list on
     2251    11558                           *    the INSHD$ list,
     2252    11559                           *    and go start over.
     2253    11560                           */
     2254    11561    2   FERR1:  CALL DISKERR;
     2255    11562    3             DO INHIBIT;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:64   
     2256    11563    3             KQ$GARB.TCOUNT=KQ$GARB.TCOUNT-KQ$GARB.CCCOUNT;
     2257    11564    3             CALL RESET;
     2258    11565    3             P$=KQ$GARB.SPHD$;
     2259    11566    4               DO WHILE (P$->KQ$MBLK.LNK$ ~= ADDR(NIL));
     2260    11567    4               P$=P$->KQ$MBLK.LNK$;
     2261    11568    4               END;
     2262    11569    3             P$->KQ$MBLK.LNK$=MBLK$->KQ$MBLK.INSHD$;
     2263    11570    3             MBLK$->KQ$MBLK.INSHD$=KQ$GARB.SPHD$;
     2264    11571    3             KQ$GARB.SPHD$=ADDR(NIL);
     2265    11572    3   RDELD:    KQ$GARB.SPSTATE=KQSP_DELD#;
     2266    11573                          /*    Delete the new DBLK */
     2267    11574    3   FTCH3:    DDA=KQ$GARB.SCDDA;
     2268    11575    3             DBLK$R=KQ$GARB.SCSTAMP;
     2269    11576    3             CALL FETCH (KQGD_SQIF3#,KQGD_SQID3#) ALTRET(NOFETCH3);
     2270    11577    3   FTCHD3:   MBLK$->KQ$MBLK.PCDDA=MBLK$->KQ$MBLK.SDA.CCDDA; /* For CHKBLINK */
     2271    11578    3             MBLK$->KQ$MBLK.SDA.CCDDA=KQ$GARB.SCDDA;
     2272    11579    3             CALL CHKBLINK ALTRET(FERR3);
     2273    11580    3             CALL DELETE;
     2274    11581    3             GOTO I10;
     2275    11582    3             END;
     2276    11583        /**/
     2277    11584    2   INSRTF1: ENTRY ALTRET;
     2278    11585        /**/
     2279    11586    2           IF DBLK$ = ADDR(NIL) THEN GOTO FERR1;
     2280    11587    2           GOTO FTCHD1;
     2281    11588        /**/
     2282    11589    2   INSRTD1: ENTRY ALTRET;
     2283    11590        /**/
     2284    11591    2           GOTO FTCH1;
     2285    11592        /**/
     2286    11593        /**/
     2287    11594    2   NOFETCH2:; /* Can't fetch new DBLK's FLINK */
     2288    11595    2           IF DBLK$ ~= ADDR(NIL)
     2289    11596    2           OR DDA = %KQDE_NDFRBLK THEN ALTRETURN;
     2290    11597                          /*    Truncate the disk list
     2291    11598                           *    just after the newly-built
     2292    11599                           *    DBLK, and continue.
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:65   
     2293    11600                           */
     2294    11601    2   FERR2:  CALL DISKERR;
     2295    11602    2           CALL RESET1;
     2296    11603    2           KQ$GARB.NCDDA=0;
     2297    11604    2           GOTO I60;
     2298    11605        /**/
     2299    11606    2   INSRTF2: ENTRY ALTRET;
     2300    11607        /**/
     2301    11608    2           IF DBLK$ = ADDR(NIL) THEN GOTO FERR2;
     2302    11609    2           GOTO FTCHD2;
     2303    11610        /**/
     2304    11611    2   INSRTD2: ENTRY ALTRET;
     2305    11612        /**/
     2306    11613    2           GOTO FTCH2;
     2307    11614        /**/
     2308    11615        /**/
     2309    11616    2   NOFETCH3:; /* Can't fetch the new DBLK to delete it */
     2310    11617    2           IF DBLK$ ~= ADDR(NIL)
     2311    11618    2           OR DDA = %KQDE_NDFRBLK THEN ALTRETURN;
     2312    11619                           /* Fetch error */
     2313    11620    2   FERR3:  CALL DISKERR;
     2314    11621    2           GOTO I10;
     2315    11622        /**/
     2316    11623    2   INSRTF3: ENTRY ALTRET;
     2317    11624        /**/
     2318    11625    2           IF DBLK$ = ADDR(NIL) THEN GOTO FERR3;
     2319    11626    2           GOTO FTCHD3;
     2320    11627        /**/
     2321    11628    2   INSRTD3: ENTRY ALTRET;
     2322    11629        /**/
     2323    11630    2           GOTO FTCH3;
     2324    11631        /**/
     2325    11632        /**/
     2326    11633    2   NODBLK: ;
     2327    11634    2           IF DBLK$ ~= ADDR(NIL)
     2328    11635    2           OR DDA = %KQDE_NDFRBLK THEN ALTRETURN;
     2329    11636                      /* No more disk space */
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:66   
     2330    11637    2           P$=KQ$GARB.SPHD$;
     2331    11638    3             DO WHILE (P$->KQ$MBLK.LNK$ ~= ADDR(NIL));
     2332    11639    3             P$=P$->KQ$MBLK.LNK$;
     2333    11640    3             END;
     2334    11641    2           P$->KQ$MBLK.LNK$=MBLK$->KQ$MBLK.INSHD$;
     2335    11642    2           MBLK$->KQ$MBLK.INSHD$=KQ$GARB.SPHD$;
     2336    11643    2           KQ$GARB.SPHD$=ADDR(NIL);
     2337    11644    2           KQ$GARB.SPSTATE=0;
     2338    11645    2           CALL SQUISHX;
     2339    11646    2           KQ$GARB.DELAY=KQGD_QFULL#;
     2340    11647    2           ALTRETURN;
     2341    11648        /**/
     2342    11649    2   INSRTG0: ENTRY ALTRET;
     2343    11650        /**/
     2344    11651    2           IF DBLK$ = ADDR(NIL) THEN GOTO NODBLK;
     2345    11652    2           GOTO GOTDBLK;
     2346    11653        /**/
     2347    11654    2   INSRTD4: ENTRY ALTRET;
     2348    11655        /**/
     2349    11656    2           GOTO DOSPLIT;
     2350    11657        /**/
     2351    11658        /**/
     2352    11659    2   RESET:  PROC;
     2353    11660        /**/
     2354    11661    4             DO INHIBIT;
     2355    11662    4             IF MBLK$->KQ$MBLK.PCDDA = 0 THEN
     2356    11663    5               DO;
     2357    11664    5               IF KQ$GARB.CCCOUNT ~= KQ$GARB.TCOUNT THEN
     2358    11665    5                CALL SC_CGGBSN;
     2359    11666    5               MBLK$->KQ$MBLK.DDA=0;
     2360    11667    5               I=MBLK$->KQ$MBLK.COUNT;
     2361    11668    5               MBLK$->KQ$MBLK.COUNT=0;
     2362    11669    5               GOTO RS1;
     2363    11670    5               END;
     2364    11671    4             MBLK$->KQ$MBLK.LCSTAMP=KQ$GARB.PCSTAMP;
     2365    11672    4             MBLK$->KQ$MBLK.SDA.LDA=MBLK$->KQ$MBLK.PCDDA;
     2366    11673    4             END;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:67   
     2367    11674        /**/
     2368    11675    3   RESET1: ENTRY;
     2369    11676        /**/
     2370    11677    4             DO INHIBIT;
     2371    11678    4             I=MBLK$->KQ$MBLK.COUNT-KQ$GARB.TCOUNT;
     2372    11679    4             IF I < 0 THEN CALL SC_CGGARB;
     2373    11680    4             MBLK$->KQ$MBLK.COUNT=KQ$GARB.TCOUNT;
     2374    11681    4   RS1:      ;
     2375    11682    4             IF MLH$->KQ$MLH.COUNT < I THEN CALL SC_CGGARB;
     2376    11683    4             MLH$->KQ$MLH.COUNT=MLH$->KQ$MLH.COUNT-I;
     2377    11684                  %CHKCNT;
     2378    11687    4             RETURN;
     2379    11688    4             END;
     2380    11689    3   END RESET;
     2381    11690        /**/
     2382    11691        /**/
     2383    11692    2   INSUPD: PROC;
     2384    11693        /**/
     2385    11694    4             DO INHIBIT;
     2386    11695    4             DBLK$->KQ$DBLK.DSIZE=DBLK$->KQ$DBLK.DSIZE+SIZEC(KQ$MBLK);
     2387    11696    4             MBLK$->KQ$MBLK.INSHD$=I$->KQ$MBLK.LNK$;
     2388    11697    4             KQ$GARB.TCOUNT=KQ$GARB.TCOUNT+1;
     2389    11698    4             MBLK$->KQ$MBLK.COUNT=MBLK$->KQ$MBLK.COUNT+1;
     2390    11699    4             KQ$GARB.CCCOUNT=KQ$GARB.CCCOUNT+1;
     2391    11700    4             END;
     2392    11701    3           CALL UPDATE;
     2393    11702    3           NFREE=NFREE-1;
     2394    11703    3           FREE$=PINCRW(FREE$,SIZEW(KQ$MBLK));
     2395    11704    3           RETURN;
     2396    11705    3   END INSUPD;
     2397    11706        /**/
     2398    11707        /**/
     2399    11708    2   SPLT:   PROC; /* SPLIT guys go on tail of SPLIT list */
     2400    11709        /**/
     2401    11710    4             DO INHIBIT;
     2402    11711    4             MBLK$->KQ$MBLK.INSHD$=I$->KQ$MBLK.LNK$;
     2403    11712    4             I$->KQ$MBLK.LNK$=ADDR(NIL);
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:68   
     2404    11713    4             IF KQ$GARB.SPHD$ = ADDR(NIL) THEN
     2405    11714    4              KQ$GARB.SPHD$=I$;
     2406    11715    4             ELSE KQ$GARB.SPTL$->KQ$MBLK.LNK$=I$;
     2407    11716    4             KQ$GARB.SPTL$=I$;
     2408    11717    4   XIT:      KQ$GARB.SPLITCNT=KQ$GARB.SPLITCNT+1;
     2409    11718    4             END; /* INHIBIT */
     2410    11719    3           RETURN;
     2411    11720        /**/
     2412    11721    3   SQZ:    ENTRY; /* SQUEEZEd guys go on head of SQUEEZE list */
     2413    11722        /**/
     2414    11723    4             DO INHIBIT;
     2415    11724    4             I$->KQ$MBLK.LNK$=KQ$GARB.SQHD$;
     2416    11725    4             KQ$GARB.SQHD$=I$;
     2417    11726    4             GOTO XIT;
     2418    11727    4             END; /* INHIBIT */
     2419    11728    3   END SPLT;
     2420    11729    2   END INSRT;
     2421    11730        %EJECT;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:69   
     2422    11731        /********************************************************
     2423    11732        *********************************************************/
     2424    11733        /**/
     2425    11734        /*D* NAME:         FETCH
     2426    11735             PURPOSE:      To FETCH a DBLK for the squish process
     2427    11736             INPUT:        DBLK$R = stamp
     2428    11737                           DDA    = dblk disc address
     2429    11738             DESCRIPTION:  Calls KQD$FETCH.  Returns if the fetch
     2430    11739                           succeeds immediately.  Else if a defer
     2431    11740                           block is obtained, uses DFR to put into
     2432    11741                           KQ$GARB.DELAY, calls SQUISHX and DEFERGO,
     2433    11742                           ALTRETs with DBLK$ ~= ADDR(NIL).
     2434    11743                           Else if no defer blocks were available,
     2435    11744                           delays using CLKDFR and ALTRETs with
     2436    11745                           DBLK$ = ADDR(NIL) and DDA = %KQDE_NDFRBLK.
     2437    11746                           Lastly, if an error occurred, ALTRETs with
     2438    11747                           DBLK$ = ADDR(NIL) and DDA ~= %KQDE_NDFRBLK.
     2439    11748        */
     2440    11749    1   FETCH:  PROC (DFR,CLKDFR) ALTRET;
     2441    11750        /**/
     2442    11751    2   DCL DFR SBIN;
     2443    11752    2   DCL CLKDFR UBIN;
     2444    11753        /**/
     2445    11754    2           CALL KQD$FETCH (CG$->KQ$CG,DBLK$,DDA) ALTRET(NOFETCH);
     2446    11755    2           RETURN;
     2447    11756    2   NOFETCH:;
     2448    11757    2           IF DBLK$ = ADDR(NIL) THEN
     2449    11758    3             DO CASE (DDA);
     2450    11759
     2451    11760    3               CASE (%KQDE_NDFRBLK); /* No defer blks */
     2452    11761    3                 CALL SQUISHX;
     2453    11762    3                 KQ$GARB.DELAY=CLKDFR;
     2454    11763    3                 ALTRETURN;
     2455    11764
     2456    11765    3               CASE (%KQDE_STMP,%KQDE_IOERR,%KQDE_BDDA,%KQDE_STATE);
     2457    11766    3                 ALTRETURN;
     2458    11767
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:70   
     2459    11768    3               CASE (ELSE);
     2460    11769    3                 CALL SC_CGGARB;
     2461    11770
     2462    11771    3             END;
     2463    11772        /**/
     2464    11773    2           KQ$GARB.MBLK$=MBLK$;
     2465    11774    2           DBLK$->KQ$DFRBLK.INFO$=CG$;
     2466    11775    2           KQ$GARB.DELAY=-DFR;
     2467    11776    2           CALL SQUISHX;
     2468    11777    2           CALL KQD$DEFERGO (CG$->KQ$CG,DBLK$,ENTADDR(KQS$FCONT));
     2469    11778    2           ALTRETURN;
     2470    11779    2   END FETCH;
     2471    11780        /********************************************************
     2472    11781        *********************************************************/
     2473    11782        /**/
     2474    11783        /*D* NAME:         DISKERR
     2475    11784             PURPOSE:      To log errors encountered while
     2476    11785                           reading disc chains.
     2477    11786             DESCRIPTION:  KQ$MBLK.SDA.CCDDA (or KQ$MBLK.DDA) is
     2478    11787                           the disc address we read.  DDA is the
     2479    11788                           error code.
     2480    11789        */
     2481    11790    1   DISKERR: PROC;
     2482    11791        /**/
     2483    11792    2   DCL T$ PTR;
     2484    11793        /**/
     2485    11794    2   DCL F$ PTR;
     2486    11795    2   DCL 1 FRAME BASED ALIGNED,
     2487    11796              %KQ_LOGENT (FPTN=LOGENT,STCLASS=BASED,LVL=2,LAST=",");
     2488    11838              %KQ_MLH (FPTN=MLH,STCLASS=BASED,LVL=2);
     2489    11908        /**/
     2490    11909    2           IF KQ_DEBUG ~= 0 THEN
     2491    11910    2            CALL SC_CGGBSN;
     2492    11911        /**/
     2493    11912                           /* Log the error */
     2494    11913                %LOCK (G=KQ_ERRLOG_GATE);
     2495    11916    2           KQ_ERRLOG_BFR.CODE=%KQELOG_KQS_FTCH;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:71   
     2496    11917    2           KQ_ERRLOG_BFR.SIZ=SIZEW(FRAME)+SIZEW(KQ$MBLK)+SIZEW(KQ$CG.GARB);
     2497    11918    2           KQ_ERRLOG_BFR.INFO='0'B;
     2498    11919    2           F$=ADDR(KQ_ERRLOG_BFR.INFO);
     2499    11920    2           T$=MBLK$;
     2500    11921    2           CALL KQZ$LOG (CG$->KQ$CG,ENTFLAG,0,0,0,T$,DDA,
     2501    11922    2           F$) ALTRET(ALT);
     2502    11923    2           RETURN;
     2503    11924    2   ALT:    IF MLH$ ~= ADDR(NIL) THEN
     2504    11925    2            F$->FRAME.MLH    =MLH$->KQ$MLH;
     2505    11926    2           F$=PINCRW(F$,SIZEW(FRAME));
     2506    11927    2           F$->KQ$CG.GARB=CG$->KQ$CG.GARB;
     2507    11928    2           F$=PINCRW(F$,SIZEW(KQ$CG.GARB));
     2508    11929    2           F$->KQ$MBLK=MBLK$->KQ$MBLK;
     2509    11930    2           CALL KQD$ERRLOG (CG$->KQ$CG);
     2510    11931    2           RETURN;
     2511    11932    2   END DISKERR;
     2512    11933        /********************************************************
     2513    11934        *********************************************************/
     2514    11935        /**/
     2515    11936        /*D* NAME:         CHKBLINK
     2516    11937             PURPOSE:      To validate a BLINK DDA
     2517    11938             DESCRIPTION:  DBLK$ points to a DBLK full of MBLKs.
     2518    11939                           KQ$MBLK.PCDDA is the expected blink DDA, to
     2519    11940                           be found in the control (REDUNDANT)
     2520    11941                           MBLK at the tail end of the DBLK.
     2521    11942                           CTLBLK$ is set to point to this and
     2522    11943                           the blink is checked.  If OK, returns.
     2523    11944                           Else unlocks the DBLK and ALTRETs.
     2524    11945                           KQ$MBLK.SDA.CCDDA (or KQ$MBLK.DDA) is the
     2525    11946                           guy we've just read.
     2526    11947        */
     2527    11948    1   CHKBLINK: PROC ALTRET;
     2528    11949        /**/
     2529    11950    2   DCL P$ PTR;
     2530    11951        /**/
     2531    11952    2           CTLBLK$=PINCRW(DBLK$,DBLK$->KQ$DBLK.SIZW-SIZEW(KQ$MBLK));
     2532    11953    2           IF MBLK$->KQ$MBLK.KEY1VALID
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:72   
     2533    11954    2           OR MBLK$->KQ$MBLK.SDA.CCDDA = MBLK$->KQ$MBLK.DDA THEN
     2534    11955    3             DO;
     2535    11956    3             IF CTLBLK$->KQ$MBLK.PCVALID THEN
     2536    11957    3              IF CTLBLK$->KQ$MBLK.PCDDA ~= 0 THEN GOTO ERR; ELSE;
     2537    11958    3             ELSE
     2538    11959    4               DO;
     2539    11960    4               CTLBLK$->KQ$MBLK.PCVALID='1'B;
     2540    11961    4               CTLBLK$->KQ$MBLK.PCDDA=MBLK$->KQ$MBLK.PCDDA;
     2541    11962    4               CALL UPDATE;
     2542    11963    4               END;
     2543    11964    3             END;
     2544    11965    2           ELSE
     2545    11966    2            IF CTLBLK$->KQ$MBLK.PCDDA ~= MBLK$->KQ$MBLK.PCDDA THEN
     2546    11967    3              DO;
     2547    11968    3   ERR:       ;
     2548    11969                   %LOCK (G=KQ_ERRLOG_GATE);
     2549    11972    3              KQ_ERRLOG_BFR.CODE=%KQELOG_KQS_BLNK;
     2550    11973    3              KQ_ERRLOG_BFR.SIZ=1+SIZEW(KQ$DBLK)+SIZEW(KQ$MBLK);
     2551    11974    3              KQ_ERRLOG_BFR.INFO='0'B;
     2552    11975    3              P$=ADDR(KQ_ERRLOG_BFR.INFO);
     2553    11976    3              P$->B$$PTR=MBLK$;
     2554    11977    3              P$=PINCRW(P$,1);
     2555    11978    3              P$->KQ$DBLK=DBLK$->KQ$DBLK;
     2556    11979    3              P$=PINCRW(P$,SIZEW(KQ$DBLK));
     2557    11980    3              P$->KQ$MBLK=CTLBLK$->KQ$MBLK;
     2558    11981    3              CALL KQD$ERRLOG (CG$->KQ$CG);
     2559    11982    3              CALL UNLOCK;
     2560    11983    3              ALTRETURN;
     2561    11984    3              END;
     2562    11985    2           RETURN;
     2563    11986    2   END CHKBLINK;
     2564    11987        /********************************************************
     2565    11988        *********************************************************/
     2566    11989        /**/
     2567    11990        /*D* NAME:         GETQM
     2568    11991             PURPOSE:      To find the MBLK on which a reader is queued
     2569    11992             DESCRIPTION:  Called when the MLH says the reader is waiting
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:73   
     2570    11993                           for the GC to finish, after he was blocked
     2571    11994                           for memory.  Finds a super MBLK in the list
     2572    11995                           that has the correct state, and returns
     2573    11996                           MBLK$ pointing to it.
     2574    11997        */
     2575    11998    1   GETQM:  PROC;
     2576    11999        /**/
     2577    12000    2           IF MLH$->KQ$MLH.SUPERCNT = 0 THEN CALL SC_CGGARB;
     2578    12001    2           MBLK$=MLH$->KQ$MLH.HEAD$;
     2579    12002    3             DO FOREVER;
     2580    12003    3             IF MBLK$->KQ$MBLK.SUPER THEN
     2581    12004    3              IF MBLK$->KQ$MBLK.STATE = KQSS_Q4GC# THEN RETURN;
     2582    12005    3              ELSE IF MBLK$->KQ$MBLK.STATE ~= KQSS_IDLE# THEN CALL SC_CGGARB;
     2583    12006    3             MBLK$=MBLK$->KQ$MBLK.LNK$;
     2584    12007    3             END;
     2585    12008    2   END GETQM;
     2586    12009        /********************************************************
     2587    12010        *********************************************************/
     2588    12011        /**/
     2589    12012        /*D* NAME:         CHKMLH
     2590    12013             PURPOSE:      To check the counts in an MLH
     2591    12014        */
     2592    12015    1   CHKMLH: PROC ALTRET;
     2593    12016        /**/
     2594    12017    2   DCL NORM SBIN;
     2595    12018    2   DCL INS SBIN;
     2596    12019    2   DCL DW SBIN;
     2597    12020    2   DCL CONTAINED UBIN;
     2598    12021    2   DCL SUPER SBIN;
     2599    12022    2   DCL M$ PTR;
     2600    12023    2   DCL I$ PTR;
     2601    12024        /**/
     2602    12025    2           NORM=0;
     2603    12026    2           INS=0;
     2604    12027    2           DW=0;
     2605    12028    2           CONTAINED=0;
     2606    12029    2           SUPER=0;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:74   
     2607    12030    2           M$=MLH$->KQ$MLH.HEAD$;
     2608    12031    3             DO WHILE (M$ ~= ADDR(NIL));
     2609    12032    3             IF M$->KQ$MBLK.SUPER THEN
     2610    12033    4               DO;
     2611    12034    4               SUPER=SUPER+1;
     2612    12035    4               CONTAINED=CONTAINED+M$->KQ$MBLK.COUNT;
     2613    12036    4               I$=M$->KQ$MBLK.INSHD$;
     2614    12037    5                 DO WHILE (I$ ~= ADDR(NIL));
     2615    12038    5                 I$=I$->KQ$MBLK.LNK$;
     2616    12039    5                 INS=INS+1;
     2617    12040    5                 END;
     2618    12041    4               END;
     2619    12042    3             ELSE NORM=NORM+1;
     2620    12043    3             M$=M$->KQ$MBLK.LNK$;
     2621    12044    3             END;
     2622    12045    2           IF MLH$->KQ$MLH.DELAY$ ~= ADDR(NIL) THEN
     2623    12046    3             DO;
     2624    12047    3             DW=KQRA_MBLK#;
     2625    12048    3             CALL KQL$COUNTDLY (MLH$->KQ$MLH.DELAY$,DW);
     2626    12049    3             END;
     2627    12050    2           IF NORM+INS+DW+CONTAINED ~= MLH$->KQ$MLH.COUNT
     2628    12051    2           OR SUPER ~= MLH$->KQ$MLH.SUPERCNT THEN
     2629    12052    3             DO;
     2630    12053    3             IF CG$->KQ$CG.RCVR THEN ALTRETURN;
     2631    12054    3             CALL SC_CGGBSN;
     2632    12055    3             ALTRETURN;
     2633    12056    3             END;
     2634    12057    2           RETURN;
     2635    12058    2   END CHKMLH;
     2636    12059        /********************************************************
     2637    12060        *********************************************************/
     2638    12061        /**/
     2639    12062        /*D* NAME:         DELETE
     2640    12063             PURPOSE:      To delete the in-core data block
     2641    12064             DESCRIPTION:  Calls KQD$DELETE & sets DBLK$=ADDR(NIL)
     2642    12065        */
     2643    12066    1   DELETE: PROC;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:75   
     2644    12067        /**/
     2645    12068    2           CALL KQD$DELETE (CG$->KQ$CG,DBLK$);
     2646    12069    2   XIT:    DBLK$=ADDR(NIL);
     2647    12070    2           RETURN;
     2648    12071        /**/
     2649    12072        /*D* NAME:         UPDATED
     2650    12073             PURPOSE:      To unlock & mark updated the current data block
     2651    12074             DESCRIPTION:  Calls KQD$UPDATED and sets DBLK$=ADDR(NIL)
     2652    12075        */
     2653    12076    2   UPDATED: ENTRY;
     2654    12077        /**/
     2655    12078    2           CALL KQD$UPDATED (CG$->KQ$CG,DBLK$);
     2656    12079    2           GOTO XIT;
     2657    12080        /**/
     2658    12081        /*D* NAME:         UNLOCK
     2659    12082             PURPOSE:      To unlock any current data block
     2660    12083             DESCRIPTION:  If DBLK$ ~= ADDR(NIL) then calls KQD$UNLOCK.
     2661    12084                           Sets DBLK$=ADDR(NIL)
     2662    12085        */
     2663    12086    2   UNLOCK: ENTRY;
     2664    12087        /**/
     2665    12088    2           IF DBLK$ ~= ADDR(NIL) THEN
     2666    12089    2            CALL KQD$UNLOCK (CG$->KQ$CG,DBLK$);
     2667    12090    2           GOTO XIT;
     2668    12091        /**/
     2669    12092        /*D* NAME:         UPDATE
     2670    12093             PURPOSE:      To mark the current DBLK updated
     2671    12094        */
     2672    12095    2   UPDATE: ENTRY;
     2673    12096        /**/
     2674    12097    2           CALL KQD$UPDATE (CG$->KQ$CG,DBLK$);
     2675    12098    2           RETURN;
     2676    12099    2   END DELETE;
     2677    12100        /********************************************************
     2678    12101        *********************************************************/
     2679    12102        /**/
     2680    12103        /*D* NAME:         GETPRED
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:76   
     2681    12104             PURPOSE:      To find the pred needed by REMOVE
     2682    12105        */
     2683    12106    1   GETPRED: PROC;
     2684    12107    2           P$=ADDR(NIL);
     2685    12108    2           IF MBLK$=MLH$->KQ$MLH.HEAD$ THEN RETURN;
     2686    12109    2           P$=MLH$->KQ$MLH.HEAD$;
     2687    12110    3             DO FOREVER;
     2688    12111    3             IF P$->KQ$MBLK.LNK$=MBLK$ THEN RETURN;
     2689    12112    3             P$=P$->KQ$MBLK.LNK$;
     2690    12113    3             END;
     2691    12114    2   END GETPRED;
     2692    12115        /********************************************************
     2693    12116        *********************************************************/
     2694    12117        /**/
     2695    12118        /*D* NAME:         INVALIDATE
     2696    12119             PURPOSE:      To set up an MBLK for use of the KEY1 area
     2697    12120        */
     2698    12121    1   INVALIDATE: PROC (MBLK);
     2699    12122        /**/
     2700    12123        %KQ_MBLK (FPTN=MBLK,STCLASS="",SUPR=1);
     2701    12393        /**/
     2702    12394    2           IF MBLK.KEY1VALID THEN
     2703    12395    3             DO;
     2704    12396    3             MBLK.KEY1VALID='0'B;
     2705    12397    3             MBLK.KEY1ALL='0'B;
     2706    12398    3             MBLK.SDA.LDA=MBLK.DDA;
     2707    12399    3             MBLK.LCSTAMP=MBLK.STAMP;
     2708    12400    3             END;
     2709    12401    2           RETURN;
     2710    12402    2   END INVALIDATE;
     2711    12403        /********************************************************
     2712    12404        *********************************************************/
     2713    12405        /**/
     2714    12406        /*D* NAME:         RELMBLK
     2715    12407             PURPOSE:      To release an MBLK
     2716    12408        */
     2717    12409    1   RELMBLK: PROC (MBLK);
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:77   
     2718    12410        /**/
     2719    12411        %KQ_MBLK (FPTN=MBLK,STCLASS="");
     2720    12681    2   DCL T$ PTR;
     2721    12682        /**/
     2722    12683    3             DO INHIBIT;
     2723    12684    3             T$=ADDR(MBLK);
     2724    12685    3             CALL KQM$RELMBLK (CG$->KQ$CG,T$);
     2725    12686    3             KQ$GARB.RELCNT=KQ$GARB.RELCNT+1;
     2726    12687    3             RETURN;
     2727    12688    3             END;
     2728    12689    2   END RELMBLK;
     2729    12690    1   END KQS$GARBF;

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:78   
--  Include file information  --

   EL$TABLES.:E05TOU  is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   KC_CP6.:E05TOU  is referenced.
   KC$CP6V_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   KQ_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   KQ_MAC_C.:E05TOU  is referenced.
   KQ_SUBS_C.:E05TOU  is referenced.
      No diagnostics issued in procedure KQS$GARBF.

   Procedure KQS$GARBF requires 3957 words for executable code.
   Procedure KQS$GARBF requires 62 words of local(AUTO) storage.

    No errors detected in file KQS$SCUM.:E05TSI    .

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:79   

 Object Unit name= KQS$GARBF                                  File name= KQS$SCUM.:E05TOU
 UTS= JUL 30 '97 01:36:04.44 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS     16     20  KQS$GARBF
    1   Proc  even  none  3957   7565  KQS$GARBF
    2  RoData even  none    69    105  KQS$GARBF

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        1  KQS$GARBF
     1     10          yes     yes      Std        1  KQS$GARB
     1    174          yes     yes      Std        1  KQS$CGFULL
     1    225          yes     yes      Std        1  KQS$DOFULL
     1    376          yes     yes      Std        1  KQS$CLOCK
     1    565          yes     yes      Std        1  KQS$FCONT
     1    673          yes     yes      Std        1  KQS$CQUEUE
     1    717          yes     yes      Std        1  KQS$RECOVER
     1   1104          yes     yes      Std        1  KQS$RECOVER2
     1   2732          yes     yes      Std        1  KQS$SQUISH
     1   2773          yes     yes      Std        1  KQS$CSQUISH
     1   3355          yes     yes      Std        1  KQS$GCONT
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:80   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 HFC$UNLOCK
 yes     yes           Std       1 KQP$UNLOCK
 yes     yes           Std       8 KQZ$LOG
 yes     yes           Std       1 KQL$GARBDUNS
 yes     yes           Std       1 KQL$GARBDUNSR
 yes     yes           Std       3 KQM$GARBDONE
         yes           Std       1 HFC$LOCK
 yes     yes           Std       1 KQL$SRQ
         yes           Std       1 KCO$ABORTEM
 yes     yes           Std       2 KQL$RCVRDLY
 yes     yes           Std       3 KQL$DELMLHR
 yes     yes           Std       3 KQD$DELDDA
 yes     yes           Std       3 KCA$TELLAU
 yes     yes           Std       3 KQM$GETB
 yes     yes           Std       3 KQD$DEFERGO
 yes     yes           Std       3 KQD$FETCH
 yes     yes           Std       1 KQL$GARBDUNQ
 yes     yes           Std       2 KQT$DELTYP
 yes     yes           Std       1 KQG$TRUNC
 yes     yes           Std       1 KQR$TRUNC
         yes           Std       2 SSS$XSYSTIME
 yes     yes           Std       3 KQD$GET
         yes           Std       2 KQX$SLIDE
 yes     yes           Std       1 KQD$ERRLOG
 yes     yes           Std       2 KQL$COUNTDLY
 yes     yes           Std       2 KQD$DELETE
 yes     yes           Std       2 KQD$UNLOCK
 yes     yes           Std       2 KQD$UPDATED
 yes     yes           Std       2 KQD$UPDATE
 yes     yes           Std       2 KQM$RELMBLK
 yes     yes           Std       1 KQS$FCONT
 yes     yes           Std       1 KQS$GCONT
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:81   
                       nStd      0 X66_AUTO_1
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AALT
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_CGGBSN                             SC_CGGARB                             KQ_BASEDELAY
     KQ_DEBUG                              KQ_STATS                              KQ_LOG
     KQ_ERRLOG_GATE                        KQ_IMLH                               KQ_ERRLOG_BFR
     B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     NULLSID                               ASLENTSID                             ISSID
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:82   


        1        1        /*M* KQS$SCUM COMGROUP garbage collection */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7       /*X* DMC,PLM=8,IND=0,IDT=2,SDI=2,CTI=0,ENU=0,AND,DCI=4,CSU=2,ECU=4,THI=0,DTI=0,STI=1
                 7        ,IAD=0,PRB */
        8        8        /**/
        9        9        /*P* NAME:         KQS$SCUM
       10       10             PURPOSE:      To provide COMGROUP garbage collection
       11       11             DESCRIPTION:  Contains various routines
       12       12        */
       13       13        /**/
       14       14        KQS$GARBF: PROC (PARM) ALTRET;

     14  1 000000   000000 700200 xent  KQS$GARBF    TSX0  ! X66_AUTO_1
         1 000001   000076 000001                    ZERO    62,1

       15       15        /**/
       16       16
       17       17
       18       18
       19       19        /**/
       20       20        /* INCLUDES */
       21       21        /**/
       22       22        %INCLUDE KQ_SUBS_C;
       23      322        %INCLUDE KQ_MAC_C;
       24     2872        %INCLUDE HF_LOCK_C;
       25     2886        %INCLUDE KQ_DATA_R;
       26     3718        %INCLUDE CP_6_SUBS;
       27     4258        %INCLUDE KC$CP6V_C;
       28     4378        %INCLUDE KC_CP6;
       29     4938        %INCLUDE SS_SCHED_C;
       30     5171        %INCLUDE EL$TABLES;
       31     5494
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:83   
       32     5495
       33     5496
       34     5497        /**/
       35     5498        /* PARAMETERS */
       36     5499        /**/
       37     5500    1   DCL PARM UBIN;
       38     5501
       39     5502
       40     5503
       41     5504        /**/
       42     5505        /* MACROS */
       43     5506        /**/
       44     5507        %MACRO CHKCNT;
       45     5508                IF KQ_DEBUG ~= 0 THEN CALL CHKMLH;
       46     5509        %MEND;
       47     5510
       48     5511
       49     5512
       50     5513        /**/
       51     5514        /* BASED STRUCTURES */
       52     5515        /**/
       53     5516    1   DCL B$$PTR PTR BASED ALIGNED;
       54     5517        %KQ_CG   (FPTN=KQ$CG  ,STCLASS="BASED(CG$)");
       55     6256        %KQ_STA  (FPTN=KQ$STA ,STCLASS="BASED(STA$)");
       56     6595        %KQ_MBLK (FPTN=KQ$MBLK,STCLASS="BASED(MBLK$)",SUPR=1);
       57     6865        %KQ_MLH  (FPTN=KQ$MLH ,STCLASS="BASED(MLH$)");
       58     6935        %KQ_MTYP (FPTN=KQ$MTYP,STCLASS=BASED);
       59     7009        %KQ_THDR (FPTN=KQ$THDR,STCLASS=BASED);
       60     7047        %KQ_DBLK (FPTN=KQ$DBLK,STCLASS="BASED(DBLK$)");
       61     7100        %KQ_QTN  (FPTN=KQ$QTN ,STCLASS="BASED(QTN$)");
       62     7573        %KQ_DFRPARM (FPTN=KQ$DFRPARM,STCLASS="BASED(DFRP$)");
       63     7602        %KQ_DFRBLK (FPTN=KQ$DFRBLK,STCLASS=BASED);
       64     7652        %KQ_MBLK (FPTN=KQ$NRMLMBLK,STCLASS="BASED(MBLK$)",SUPR=0);
       65     7922        %KQ_MLHB02 (FPTN=KQ$MLHB02,STCLASS=BASED);
       66     7991        %KQ$DPTR;
       67     8018    1   DCL B$$CHARS CHAR(I) BASED UNAL;
       68     8019    1   DCL B$$HALF UBIN HALF BASED HALIGNED;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:84   
       69     8020
       70     8021
       71     8022
       72     8023        /**/
       73     8024        /* AUTO */
       74     8025        /**/
       75     8026    1   DCL STA$ PTR;
       76     8027    1   DCL MBLK$ PTR;
       77     8028    1   DCL MBLK$R REDEF MBLK$ SBIN;
       78     8029    1   DCL CG$ PTR;
       79     8030    1   DCL P$ PTR;
       80     8031    1   DCL DFRP$ PTR;
       81     8032    1   DCL DBLK$ PTR;
       82     8033    1   DCL DBLK$R REDEF DBLK$ UBIN;
       83     8034    1   DCL I SBIN;
       84     8035    1   DCL DDA UBIN;
       85     8036    1   DCL MLH$ PTR;
       86     8037    1   DCL ENTFLAG UBIN;
       87     8038    1   DCL J SBIN;
       88     8039    1   DCL SAVP$ PTR;
       89     8040    1   DCL M$ PTR;
       90     8041    1   DCL NMBLKS SBIN;
       91     8042    1   DCL X$ PTR;
       92     8043    1   DCL Z$ PTR;
       93     8044    1   DCL QTN$ PTR;
       94     8045    1   DCL START$ PTR;
       95     8046    1   DCL CTLBLK$ PTR;
       96     8047    1   DCL END$ PTR;
       97     8048
       98     8049
       99     8050
      100     8051        /**/
      101     8052        /* CONSTANT */
      102     8053        /**/
      103     8054        %KQ_MBLK (FPTN=KQ_ISMBLK,STCLASS=CONSTANT,SUPR=1);
      104     8324
      105     8325
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:85   
      106     8326
      107     8327        /**/
      108     8328        /* REFS */
      109     8329        /**/
      110     8330    1   DCL KCA$TELLAU    ENTRY(3) ALTRET;
      111     8331    1   DCL KCO$ABORTEM   ENTRY(1);
      112     8332    1   DCL KQD$DEFERGO   ENTRY(3) ALTRET;
      113     8333    1   DCL KQD$DELDDA    ENTRY(3) ALTRET;
      114     8334    1   DCL KQD$DELETE    ENTRY(2) ALTRET;
      115     8335    1   DCL KQD$ERRLOG    ENTRY(1) ALTRET;
      116     8336    1   DCL KQD$FETCH     ENTRY(3) ALTRET;
      117     8337    1   DCL KQD$GET       ENTRY(3) ALTRET;
      118     8338    1   DCL KQD$UNLOCK    ENTRY(2) ALTRET;
      119     8339    1   DCL KQD$UPDATE    ENTRY(2) ALTRET;
      120     8340    1   DCL KQD$UPDATED   ENTRY(2) ALTRET;
      121     8341    1   DCL KQG$TRUNC     ENTRY(1) ALTRET;
      122     8342    1   DCL KQL$COUNTDLY  ENTRY(2) ALTRET;
      123     8343    1   DCL KQL$DELMLHR   ENTRY(3) ALTRET;
      124     8344    1   DCL KQL$GARBDUNQ  ENTRY(1) ALTRET;
      125     8345    1   DCL KQL$GARBDUNS  ENTRY(1) ALTRET;
      126     8346    1   DCL KQL$GARBDUNSR ENTRY(1) ALTRET;
      127     8347    1   DCL KQL$RCVRDLY   ENTRY(2) ALTRET;
      128     8348    1   DCL KQL$SRQ       ENTRY(1) ALTRET;
      129     8349    1   DCL KQM$GARBDONE  ENTRY(3) ALTRET;
      130     8350    1   DCL KQM$GETB      ENTRY(3) ALTRET;
      131     8351    1   DCL KQM$RELMBLK   ENTRY(2) ALTRET;
      132     8352    1   DCL KQP$UNLOCK    ENTRY(1) ALTRET;
      133     8353    1   DCL KQR$TRUNC     ENTRY(1) ALTRET;
      134     8354    1   DCL KQT$DELTYP    ENTRY(2) ALTRET;
      135     8355    1   DCL KQX$SLIDE     ENTRY(2);
      136     8356    1   DCL KQZ$LOG       ENTRY(8) ALTRET;
      137     8357    1   DCL SSR$RUE       ENTRY(4);
      138     8358    1   DCL SSS$XSYSTIME  ENTRY(2);
      139     8359    1   DCL SC_CGNOTIMP   ENTRY    CONV(2,0);
      140     8360    1   DCL SC_CGGBSN     ENTRY    CONV(2,0);
      141     8361    1   DCL SC_CGGARB     ENTRY    CONV(2,0);
      142     8362        %EL$CGERR (NAME=KQ_ERRLOG_BFR,STCLASS=SYMREF,N=50);
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:86   
      143     8366
      144     8367
      145     8368
      146     8369        /**/
      147     8370        /* SUBS */
      148     8371        /**/
      149     8372        %SUB KQ$QTREE="CG$->KQ$CG.QUEUE.QTREE$->KQ$THDR";
      150     8373        %SUB KQ$QUEUE="CG$->KQ$CG.QUEUE";
      151     8374        %SUB KQ$GARB="CG$->KQ$CG.GARB";
      152     8375        %SUB KQ$STREE="CG$->KQ$CG.STREE";
      153     8376        %SUB KQ$TTREE="CG$->KQ$CG.TTREE";
      154     8377        %EQU_CG;
      155     8425        %EJECT;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:87   
      156     8426        /*
      157     8427               GGG    AAA   RRRR   BBBB    AAA    GGG   EEEEE
      158     8428              G   G  A   A  R   R  B   B  A   A  G   G  E
      159     8429              G      A   A  R   R  B   B  A   A  G      E
      160     8430              G      AAAAA  RRRR   BBBB   AAAAA  G      EEEE
      161     8431              G  GG  A   A  R R    B   B  A   A  G  GG  E
      162     8432              G   G  A   A  R  R   B   B  A   A  G   G  E
      163     8433               GGG   A   A  R   R  BBBB   A   A   GGG   EEEEE
      164     8434        */
      165     8435        /**/
      166     8436        /*F* NAME:         KQS$GARBF
      167     8437             PURPOSE:      To start a forced garbage collection
      168     8438             DESCRIPTION:  Just like KQS$GARB except that even if
      169     8439                           nobody is blocked for memory we will go
      170     8440                           through the first level of garbage
      171     8441                           collection.
      172     8442
      173     8443        KQS$GARBF: ENTRY (PARM) ALTRET;
      174     8444        */
      175     8445        /**/
      176     8446    1           CG$=ADDR(PARM);

   8446  1 000002   200003 236100                    LDQ     @PARM,,AUTO
         1 000003   200006 756100                    STQ     CG$,,AUTO

      177     8447    1           CG$->KQ$CG.MMD.GFORCE='1'B;

   8447  1 000004   200006 470500                    LDP0    CG$,,AUTO
         1 000005   200000 236003                    LDQ     65536,DU
         1 000006   000011 256100                    ORSQ    9,,PR0
         1 000007   000012 710000 1                  TRA     s:8522

      178     8448        /**/
      179     8449        /*F* NAME:         KQS$GARB
      180     8450             PURPOSE:      To perform memory garbage collection
      181     8451             CALL:         KQS$GARB (KQ$CG)
      182     8452             INPUT:        KQ$CG.MMD.GATE locked
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:88   
      183     8453             OUTPUT:       KQ$CG.MMD.GATE unlocked, and garbage collector
      184     8454                           is running.
      185     8455             DESCRIPTION:  Garbage collection is initiated whenever the
      186     8456                           clock sees anything on the DELMSG$ list, or
      187     8457                           a process cannot get memory.  In the latter
      188     8458                           case the process is 'blocked' (see KQM$MM2).
      189     8459                           Unblocking will occur when release of memory
      190     8460                           (by anybody, but likely the garbage collector)
      191     8461                           causes the correctly-sized thing to become
      192     8462                           available, or when the garbage collector has
      193     8463                           done all it can and there still is nothing
      194     8464                           available.
      195     8465
      196     8466                           The garbage collector makes memory available by
      197     8467                            - releasing MBLKs that were on the DELMSG$
      198     8468                              list after deleting their DBLKs
      199     8469                            - releasing RBLKs made available by TRUNCing
      200     8470                              the stations that had them
      201     8471                            - releasing MBLKs that it puts on disc.  This
      202     8472                              involves creation (or coalescing) of 'super'
      203     8473                              MBLKs - MBLKs whose data on disc consists
      204     8474                              of other MBLKs.  Much of the logic in KQL$LIST
      205     8475                              is devoted to searching MBLK lists which
      206     8476                              contain super MBLKs, since this involves
      207     8477                              reading the DBLK into memory and looking at
      208     8478                              the MBLKs in it for the desired kind of message.
      209     8479                              Two super MBLKs are coalesced simply by linking
      210     8480                              their DBLKs together in a linear list and discarding
      211     8481                              the second super MBLK.  Note that an MBLK list
      212     8482                              containing super MBLKs is still in PRIO and UTS
      213     8483                              order.
      214     8484
      215     8485
      216     8486                           The garbage collector runs driven by I/O endaction
      217     8487                           and, if necessary, driven by the clock (KQS$CLOCK).
      218     8488                           This latter only happens when we run out of defer
      219     8489                           blocks or some similar thing.  In practice, the
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:89   
      220     8490                           first part of the work, initated by the call to
      221     8491                           KQS$GARB, may be on behalf of some user, but this
      222     8492                           is immaterial.
      223     8493
      224     8494                           When the garbage collector is running, the KQ$CG.MMD.GIP
      225     8495                           flag is set, and requests for garbage collection
      226     8496                           are ignored in this period.
      227     8497
      228     8498                           Garbage collection proceeds in the following order:
      229     8499
      230     8500                            - the DELMSG$ list of deleted messages
      231     8501                            - ordinary MBLKs belonging to absent stations,
      232     8502                              or Q-tree nodes with MXACT = 0, are collected
      233     8503                              up and put on disc.
      234     8504                            - the above is done for ALL MLHs
      235     8505                            - ALL MLHs are garbage collected down to 1 super
      236     8506                              MBLK, by concatenating super MBLKs.
      237     8507
      238     8508                           At the completion of each phase, the garbage collector
      239     8509                           tries to quit by calling KQM$GARBDONE.  This will
      240     8510                           stop garbage collection as long as nobody is blocked
      241     8511                           for memory, or tell the garbage collector to continue
      242     8512                           if there is anyone still blocked.  At the completion
      243     8513                           of the last phase, if there is anyone still blocked
      244     8514                           the comgroup is considered to be full since there
      245     8515                           is nothing more to garbage collect.  At this time
      246     8516                           all the blocked people are unblocked and told the
      247     8517                           comgroup is full, and then ALL stations are deac-
      248     8518                           tivated.
      249     8519        */
      250     8520    1   KQS$GARB: ENTRY (PARM) ALTRET;

   8520  1 000010   000000 700200 xent  KQS$GARB     TSX0  ! X66_AUTO_1
         1 000011   000076 000001                    ZERO    62,1

      251     8521        /**/
      252     8522    1           CG$=ADDR(PARM);
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:90   

   8522  1 000012   200003 236100                    LDQ     @PARM,,AUTO
         1 000013   200006 756100                    STQ     CG$,,AUTO

      253     8523    1           IF CG$->KQ$CG.MMD.GIP THEN

   8523  1 000014   200006 470500                    LDP0    CG$,,AUTO
         1 000015   000011 234100                    SZN     9,,PR0
         1 000016   000026 605000 1                  TPL     s:8530

      254     8524    2             DO;

      255     8525                  %UNLOCK (G=CG$->KQ$CG.MMD.GATE);

   8526  1 000017   000001 036003                    ADLQ    1,DU
         1 000020   200066 756100                    STQ     I$+1,,AUTO
         1 000021   200066 630500                    EPPR0   I$+1,,AUTO
         1 000022   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000023   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000024   000000 011000                    NOP     0

      256     8528    2             ALTRETURN;

   8528  1 000025   000000 702200 xent               TSX2  ! X66_AALT

      257     8529    2             END;
      258     8530    1           CG$->KQ$CG.MMD.GIP='1'B;

   8530  1 000026   400000 236003                    LDQ     -131072,DU
         1 000027   000011 256100                    ORSQ    9,,PR0

      259     8531    1           KQ$GARB.DELAY=0;

   8531  1 000030   000031 450100                    STZ     25,,PR0

      260     8532    1           ENTFLAG=0;

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:91   
   8532  1 000031   200015 450100                    STZ     ENTFLAG,,AUTO

      261     8533                %UNLOCK (G=CG$->KQ$CG.MMD.GATE);

   8534  1 000032   200006 236100                    LDQ     CG$,,AUTO
         1 000033   000001 036003                    ADLQ    1,DU
         1 000034   200066 756100                    STQ     I$+1,,AUTO
         1 000035   200066 630500                    EPPR0   I$+1,,AUTO
         1 000036   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000037   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000040   000000 011000                    NOP     0

      262     8536        /**/
      263     8537    1           KQ$GARB.TYPE=KQGT_DMSG#;

   8537  1 000041   200006 470500                    LDP0    CG$,,AUTO
         1 000042   000000 236003                    LDQ     0,DU
         1 000043   000032 552120                    STBQ    26,'20'O,PR0

      264     8538    1           KQ$GARB.RELCNT=0;

   8538  1 000044   000047 450100                    STZ     39,,PR0

      265     8539    1           CALL DODELMSG ALTRET(RTN);

   8539  1 000045   001307 701000 1                  TSX1    DODELMSG
         1 000046   000564 702000 1                  TSX2    RTN

      266     8540    1   GB0:    CALL TRYQUIT ALTRET(RTN);

   8540  1 000047   000135 701000 1     GB0          TSX1    TRYQUIT
         1 000050   000564 702000 1                  TSX2    RTN

      267     8541    1           CG$->KQ$CG.STATS.GARBCOLLS=CG$->KQ$CG.STATS.GARBCOLLS+1;

   8541  1 000051   200006 470500                    LDP0    CG$,,AUTO
         1 000052   000200 235100                    LDA     128,,PR0
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:92   
         1 000053   000001 035007                    ADLA    1,DL
         1 000054   000200 755100                    STA     128,,PR0

      268     8542    1           KQ_STATS.GARBCOLLS=KQ_STATS.GARBCOLLS+1;

   8542  1 000055   000002 054000 xsym               AOS     KQ_STATS+2

      269     8543        /**/
      270     8544    1           KQ$GARB.TYPE=KQ$GARB.TYPE+1;

   8544  1 000056   000032 236100                    LDQ     26,,PR0
         1 000057   000001 036003                    ADLQ    1,DU
         1 000060   000032 552120                    STBQ    26,'20'O,PR0

   8544  1 000061                       GBLOOP       null
      271     8545    1   GBLOOP: ;
      272     8546    1           CALL DODELMSG ALTRET(RTN);

   8546  1 000061   001307 701000 1                  TSX1    DODELMSG
         1 000062   000564 702000 1                  TSX2    RTN

      273     8547    1   GB1:    IF CG$->KQ$CG.QISS THEN CALL DOT;

   8547  1 000063   200006 470500       GB1          LDP0    CG$,,AUTO
         1 000064   000106 235100                    LDA     70,,PR0
         1 000065   000070 600000 1                  TZE     s:8548

   8547  1 000066   002445 701000 1                  TSX1    DOT
         1 000067   000000 011000                    NOP     0

      274     8548    1           CALL TRYQUIT ALTRET(RTN);

   8548  1 000070   000135 701000 1                  TSX1    TRYQUIT
         1 000071   000564 702000 1                  TSX2    RTN

      275     8549    1           CALL DOQ ALTRET(RTN);

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:93   
   8549  1 000072   002150 701000 1                  TSX1    DOQ
         1 000073   000564 702000 1                  TSX2    RTN

      276     8550    1   GB2:    CALL TRYQUIT ALTRET(RTN);

   8550  1 000074   000135 701000 1     GB2          TSX1    TRYQUIT
         1 000075   000564 702000 1                  TSX2    RTN

      277     8551    1           CALL DOS ALTRET(RTN);

   8551  1 000076   002543 701000 1                  TSX1    DOS
         1 000077   000564 702000 1                  TSX2    RTN

      278     8552    1   GB3:    CALL TRYQUIT ALTRET(RTN);

   8552  1 000100   000135 701000 1     GB3          TSX1    TRYQUIT
         1 000101   000564 702000 1                  TSX2    RTN

      279     8553    1           CALL DODELMSG ALTRET(RTN);

   8553  1 000102   001307 701000 1                  TSX1    DODELMSG
         1 000103   000564 702000 1                  TSX2    RTN

      280     8554    1           CALL TRYQUIT ALTRET(RTN);

   8554  1 000104   000135 701000 1                  TSX1    TRYQUIT
         1 000105   000564 702000 1                  TSX2    RTN

      281     8555    1           KQ$GARB.TYPE=KQ$GARB.TYPE+1;

   8555  1 000106   200006 470500                    LDP0    CG$,,AUTO
         1 000107   000032 236100                    LDQ     26,,PR0
         1 000110   000001 036003                    ADLQ    1,DU
         1 000111   000032 552120                    STBQ    26,'20'O,PR0

      282     8556    1           IF KQ$GARB.TYPE <= KQGT_MAX# THEN GOTO GBLOOP;

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:94   
   8556  1 000112   000032 236100                    LDQ     26,,PR0
         1 000113   000777 376003                    ANQ     511,DU
         1 000114   000004 116003                    CMPQ    4,DU
         1 000115   000061 602000 1                  TNC     GBLOOP

      283     8557    1           CALL TRYQUIT ALTRET(RTN);

   8557  1 000116   000135 701000 1                  TSX1    TRYQUIT
         1 000117   000564 702000 1                  TSX2    RTN

   8556  1 000120                       GBFAIL       null
      284     8558    1   GBFAIL: ;
      285     8559    1           CALL KQM$GARBDONE (CG$->KQ$CG,,1);

   8559  1 000120   000000 236000 2                  LDQ     0
         1 000121   200070 756100                    STQ     I$+3,,AUTO
         1 000122   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000123   200006 235100                    LDA     CG$,,AUTO
         1 000124   200066 757100                    STAQ    I$+1,,AUTO
         1 000125   200066 630500                    EPPR0   I$+1,,AUTO
         1 000126   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000127   000000 701000 xent               TSX1    KQM$GARBDONE
         1 000130   000000 011000                    NOP     0

      286     8560    1           IF ENTFLAG ~= KQGD_QFULL# THEN

   8560  1 000131   200015 235100                    LDA     ENTFLAG,,AUTO
         1 000132   000006 115007                    CMPA    6,DL
         1 000133   000200 601000 1                  TNZ     SETFULL

      287     8561    1            GOTO SETFULL; /* Too much stuff in memory */
      288     8562    1           GOTO RTN;      /* Ran out of disc space -  */

   8562  1 000134   000564 710000 1                  TRA     RTN

      289     8563                               /* KQS$CGFULL already called*/
      290     8564        /**/  /* ALTRET if we're done, else return */
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:95   
      291     8565    1   TRYQUIT: PROC ALTRET;

   8565  1 000135   200030 741300       TRYQUIT      STX1  ! END$+1,,AUTO

      292     8566        /**/
      293     8567    2           IF KQ$CG.GARB.TYPE<=KQGT_MAX# THEN

   8567  1 000136   200006 470500                    LDP0    CG$,,AUTO
         1 000137   000032 236100                    LDQ     26,,PR0
         1 000140   000777 376003                    ANQ     511,DU
         1 000141   000004 116003                    CMPQ    4,DU
         1 000142   000157 603000 1                  TRC     s:8573

      294     8568    3             DO;

      295     8569    3             IF KQ$GARB.JNLD$ ~= ADDR(NIL) THEN RETURN;

   8569  1 000143   000034 236100                    LDQ     28,,PR0
         1 000144   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000145   000147 600000 1                  TZE     s:8570

   8569  1 000146   000001 702211                    TSX2  ! 1,X1

      296     8570    3             IF  KQ$GARB.TYPE <= KQGT_CANS#

   8570  1 000147   000032 236100                    LDQ     26,,PR0
         1 000150   000777 376003                    ANQ     511,DU
         1 000151   000003 116003                    CMPQ    3,DU
         1 000152   000157 603000 1                  TRC     s:8573
         1 000153   000011 236100                    LDQ     9,,PR0
         1 000154   200000 316003                    CANQ    65536,DU
         1 000155   000157 600000 1                  TZE     s:8573

      297     8571    3             AND CG$->KQ$CG.MMD.GFORCE THEN RETURN;

   8571  1 000156   000001 702211                    TSX2  ! 1,X1

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:96   
      298     8572    3             END;
      299     8573    2           CALL KQM$GARBDONE (CG$->KQ$CG,,0) ALTRET(ALTRT);

   8573  1 000157   000001 236000 2                  LDQ     1
         1 000160   200070 756100                    STQ     I$+3,,AUTO
         1 000161   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000162   200006 235100                    LDA     CG$,,AUTO
         1 000163   200066 757100                    STAQ    I$+1,,AUTO
         1 000164   200066 630500                    EPPR0   I$+1,,AUTO
         1 000165   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000166   000000 701000 xent               TSX1    KQM$GARBDONE
         1 000167   000172 702000 1                  TSX2    ALTRT

      300     8574    2           RETURN;

   8574  1 000170   200030 221300                    LDX1  ! END$+1,,AUTO
         1 000171   000001 702211                    TSX2  ! 1,X1

      301     8575    2   ALTRT:  ALTRETURN;

   8575  1 000172   200030 221300       ALTRT        LDX1  ! END$+1,,AUTO
         1 000173   000000 702211                    TSX2  ! 0,X1

      302     8576    2   END TRYQUIT;
      303     8577        %EJECT;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:97   
      304     8578        /**/
      305     8579        /*F* NAME:         KQS$CGFULL
      306     8580             PURPOSE:      To signal the CG is out of disc space.
      307     8581             CALL:         KQS$CGFULL (KQ$CG)
      308     8582             DESCRIPTION:  Called by KQD$DBLK when we run out of disc
      309     8583                           space.
      310     8584        */
      311     8585    1   KQS$CGFULL: ENTRY (PARM) ALTRET; /* !!Doesn't ALTRET!! */

   8585  1 000174   000000 700200 xent  KQS$CGFULL   TSX0  ! X66_AUTO_1
         1 000175   000076 000001                    ZERO    62,1

      312     8586        /**/
      313     8587    1           CG$=ADDR(PARM);

   8587  1 000176   200003 236100                    LDQ     @PARM,,AUTO
         1 000177   200006 756100                    STQ     CG$,,AUTO

   8587  1 000200                       SETFULL      null
      314     8588    1   SETFULL:;
      315     8589                %LOCK (G=CG$->KQ$CG.GATE.CG);

   8590  1 000200   200006 236100                    LDQ     CG$,,AUTO
         1 000201   000107 036003                    ADLQ    71,DU
         1 000202   200066 756100                    STQ     I$+1,,AUTO
         1 000203   200066 630500                    EPPR0   I$+1,,AUTO
         1 000204   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000205   000000 701000 xent               TSX1    HFC$LOCK
         1 000206   000000 011000                    NOP     0

      316     8592    1           CG$->KQ$CG.DELAY.CGFULL='1'B;

   8592  1 000207   200006 470500                    LDP0    CG$,,AUTO
         1 000210   020000 236003                    LDQ     8192,DU
         1 000211   000020 256100                    ORSQ    16,,PR0

      317     8593                %UNLOCK (G=CG$->KQ$CG.GATE.CG);
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:98   

   8594  1 000212   200006 236100                    LDQ     CG$,,AUTO
         1 000213   000107 036003                    ADLQ    71,DU
         1 000214   200066 756100                    STQ     I$+1,,AUTO
         1 000215   200066 630500                    EPPR0   I$+1,,AUTO
         1 000216   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000217   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000220   000000 011000                    NOP     0

      318     8596    1           CG$->KQ$CG.BASEDELAY=CG$->KQ$CG.BASEDELAY+1;

   8596  1 000221   200006 470500                    LDP0    CG$,,AUTO
         1 000222   000025 054100                    AOS     21,,PR0

      319     8597    1           KQ_BASEDELAY=KQ_BASEDELAY+1;

   8597  1 000223   000000 054000 xsym               AOS     KQ_BASEDELAY

      320     8598    1           GOTO RTN;

   8598  1 000224   000564 710000 1                  TRA     RTN

      321     8599        /**/
      322     8600        /*F* NAME:         KQS$DOFULL
      323     8601             PURPOSE:      To handle the comgroup-full condition
      324     8602             CALL:         KQS$DOFULL (KQ$CG)
      325     8603             DESCRIPTION:  Called from KCC$CLOCK when KQ$CG.DELAY.CGFULL
      326     8604                           is found set.
      327     8605        */
      328     8606    1   KQS$DOFULL: ENTRY (PARM) ALTRET; /* !!Doesn't ALTRET!! */

   8606  1 000225   000000 700200 xent  KQS$DOFULL   TSX0  ! X66_AUTO_1
         1 000226   000076 000001                    ZERO    62,1

      329     8607        /**/
      330     8608    1           CG$=ADDR(PARM);

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:99   
   8608  1 000227   200003 236100                    LDQ     @PARM,,AUTO
         1 000230   200006 756100                    STQ     CG$,,AUTO

      331     8609    1           CALL CGFULL;

   8609  1 000231   000234 701000 1                  TSX1    CGFULL
         1 000232   000000 011000                    NOP     0

      332     8610    1           GOTO RTN;

   8610  1 000233   000564 710000 1                  TRA     RTN

      333     8611        /**/
      334     8612        /*D* NAME:         CGFULL
      335     8613             PURPOSE:      To handle CG full
      336     8614             DESCRIPTION:  Calls KQC$CLOSESTA on every station.
      337     8615                           Turns off TERMCONLGL.
      338     8616                           Sets DCBCONAU, DCBCONNAU to DEACTIVATE.
      339     8617        */
      340     8618    1   CGFULL: PROC;

   8618  1 000234   200030 741300       CGFULL       STX1  ! END$+1,,AUTO

      341     8619        /**/
      342     8620        %LOCK (G=CG$->KQ$CG.GATE.CG);

   8621  1 000235   200006 236100                    LDQ     CG$,,AUTO
         1 000236   000107 036003                    ADLQ    71,DU
         1 000237   200066 756100                    STQ     I$+1,,AUTO
         1 000240   200066 630500                    EPPR0   I$+1,,AUTO
         1 000241   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000242   000000 701000 xent               TSX1    HFC$LOCK
         1 000243   000000 011000                    NOP     0

      343     8623    2           IF CG$->KQ$CG.DELAY.FIP THEN

   8623  1 000244   200006 470500                    LDP0    CG$,,AUTO
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:100  
         1 000245   000020 236100                    LDQ     16,,PR0
         1 000246   010000 316003                    CANQ    4096,DU
         1 000247   000261 600000 1                  TZE     s:8630

      344     8624    3             DO;

      345     8625                  %UNLOCK (G=CG$->KQ$CG.GATE.CG);

   8626  1 000250   200006 236100                    LDQ     CG$,,AUTO
         1 000251   000107 036003                    ADLQ    71,DU
         1 000252   200066 756100                    STQ     I$+1,,AUTO
         1 000253   200066 630500                    EPPR0   I$+1,,AUTO
         1 000254   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000255   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000256   000000 011000                    NOP     0

      346     8628    3             RETURN;

   8628  1 000257   200030 221300                    LDX1  ! END$+1,,AUTO
         1 000260   000001 702211                    TSX2  ! 1,X1

      347     8629    3             END;
      348     8630    2           CG$->KQ$CG.DELAY.FIP='1'B;

   8630  1 000261   010000 236003                    LDQ     4096,DU
         1 000262   000020 256100                    ORSQ    16,,PR0

      349     8631                %UNLOCK (G=CG$->KQ$CG.GATE.CG);

   8632  1 000263   200006 236100                    LDQ     CG$,,AUTO
         1 000264   000107 036003                    ADLQ    71,DU
         1 000265   200066 756100                    STQ     I$+1,,AUTO
         1 000266   200066 630500                    EPPR0   I$+1,,AUTO
         1 000267   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000270   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000271   000000 011000                    NOP     0

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:101  
      350     8634        /**/
      351     8635                %LOCK (G=CG$->KQ$CG.DTREE.GATE);

   8636  1 000272   200006 236100                    LDQ     CG$,,AUTO
         1 000273   000231 036003                    ADLQ    153,DU
         1 000274   200066 756100                    STQ     I$+1,,AUTO
         1 000275   200066 630500                    EPPR0   I$+1,,AUTO
         1 000276   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000277   000000 701000 xent               TSX1    HFC$LOCK
         1 000300   000000 011000                    NOP     0

      352     8638    2           CG$->KQ$CG.AUCTL.TERMCONLGL='0'B;

   8638  1 000301   200006 470500                    LDP0    CG$,,AUTO
         1 000302   000002 236000 2                  LDQ     2
         1 000303   000136 356100                    ANSQ    94,,PR0

      353     8639    2           CG$->KQ$CG.AUCTL.DCBCONLGL ='0'B;

   8639  1 000304   000003 236000 2                  LDQ     3
         1 000305   000136 356100                    ANSQ    94,,PR0

      354     8640    2           CG$->KQ$CG.AUCTL.DCBCONAU  ='0'B;

   8640  1 000306   000004 236000 2                  LDQ     4
         1 000307   000133 356100                    ANSQ    91,,PR0

      355     8641    2           CG$->KQ$CG.AUCTL.DCBCONNAU ='0'B;

   8641  1 000310   000005 236000 2                  LDQ     5
         1 000311   000133 356100                    ANSQ    91,,PR0

      356     8642    2           CG$->KQ$CG.AUCTL.TERMCONAU ='0'B;

   8642  1 000312   000006 236000 2                  LDQ     6
         1 000313   000133 356100                    ANSQ    91,,PR0

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:102  
      357     8643    2           CG$->KQ$CG.AUCTL.TERMCONNAU='0'B;

   8643  1 000314   000007 236000 2                  LDQ     7
         1 000315   000133 356100                    ANSQ    91,,PR0

      358     8644    2           CG$->KQ$CG.AUCTL.AUCONDCB  =%DEACTIVATE#;

   8644  1 000316   000133 236100                    LDQ     91,,PR0
         1 000317   000010 376000 2                  ANQ     8
         1 000320   002000 276007                    ORQ     1024,DL
         1 000321   000133 756100                    STQ     91,,PR0

      359     8645    2           CG$->KQ$CG.AUCTL.AUDCONDCB =%DEACTIVATE#;

   8645  1 000322   000133 236100                    LDQ     91,,PR0
         1 000323   000011 376000 2                  ANQ     9
         1 000324   000100 276007                    ORQ     64,DL
         1 000325   000133 756100                    STQ     91,,PR0

      360     8646    2           CG$->KQ$CG.AUCTL.AUCONTERM =%DEACTIVATE#;

   8646  1 000326   000133 236100                    LDQ     91,,PR0
         1 000327   000012 376000 2                  ANQ     10
         1 000330   010000 276007                    ORQ     4096,DL
         1 000331   000133 756100                    STQ     91,,PR0

      361     8647    2           CG$->KQ$CG.AUCTL.AUDCONTERM=%DEACTIVATE#;

   8647  1 000332   000133 236100                    LDQ     91,,PR0
         1 000333   000013 376000 2                  ANQ     11
         1 000334   000400 276007                    ORQ     256,DL
         1 000335   000133 756100                    STQ     91,,PR0

      362     8648                %UNLOCK (G=CG$->KQ$CG.DTREE.GATE);

   8649  1 000336   200006 236100                    LDQ     CG$,,AUTO
         1 000337   000231 036003                    ADLQ    153,DU
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:103  
         1 000340   200066 756100                    STQ     I$+1,,AUTO
         1 000341   200066 630500                    EPPR0   I$+1,,AUTO
         1 000342   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000343   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000344   000000 011000                    NOP     0

      363     8651        /**/
      364     8652    2           CALL KCO$ABORTEM (CG$->KQ$CG); /* Blow away all stations */

   8652  1 000345   200006 630500                    EPPR0   CG$,,AUTO
         1 000346   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000347   000000 701000 xent               TSX1    KCO$ABORTEM
         1 000350   000000 011000                    NOP     0

      365     8653        /**/
      366     8654                %LOCK (G=CG$->KQ$CG.GATE.CG);

   8655  1 000351   200006 236100                    LDQ     CG$,,AUTO
         1 000352   000107 036003                    ADLQ    71,DU
         1 000353   200066 756100                    STQ     I$+1,,AUTO
         1 000354   200066 630500                    EPPR0   I$+1,,AUTO
         1 000355   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000356   000000 701000 xent               TSX1    HFC$LOCK
         1 000357   000000 011000                    NOP     0

      367     8657    2           CG$->KQ$CG.DELAY.CGFULL='0'B;

   8657  1 000360   200006 470500                    LDP0    CG$,,AUTO
         1 000361   000014 236000 2                  LDQ     12
         1 000362   000020 356100                    ANSQ    16,,PR0

      368     8658    2           CG$->KQ$CG.DELAY.FIP='0'B;

   8658  1 000363   000015 236000 2                  LDQ     13
         1 000364   000020 356100                    ANSQ    16,,PR0

      369     8659                %UNLOCK (G=CG$->KQ$CG.GATE.CG);
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:104  

   8660  1 000365   200006 236100                    LDQ     CG$,,AUTO
         1 000366   000107 036003                    ADLQ    71,DU
         1 000367   200066 756100                    STQ     I$+1,,AUTO
         1 000370   200066 630500                    EPPR0   I$+1,,AUTO
         1 000371   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000372   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000373   000000 011000                    NOP     0

      370     8662    2           RETURN;

   8662  1 000374   200030 221300                    LDX1  ! END$+1,,AUTO
         1 000375   000001 702211                    TSX2  ! 1,X1

      371     8663    2   END CGFULL;
      372     8664        %EJECT;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:105  
      373     8665        /**/
      374     8666        /*F* NAME:         KQS$CLOCK
      375     8667             PURPOSE:      To continue the garbage collector
      376     8668             CALL:         KQS$CLOCK (KQ$CG)
      377     8669             DESCRIPTION:  Called from KCC$CLOCK with KQ$CG.GARB.DELAY
      378     8670                           indicating what part of the garbage collector
      379     8671                           had to delay and why.  Garbage collection is
      380     8672                           resumed.
      381     8673
      382     8674                           Called also from KQE$EA when it is assumed that
      383     8675                           a defer block may have become free.
      384     8676
      385     8677                           This routine is called when KQ$CG.GARB.DELAY is
      386     8678                           > 0, indicating a 'clocked' delay (usually due
      387     8679                           to no defer blocks).  The idea is to call here
      388     8680                           when delay is > 0 and there is a chance that
      389     8681                           we might be able to continue.  Since we're called
      390     8682                           from more than one spot, we must lock a gate to
      391     8683                           ensure that only one thread of garbage collection
      392     8684                           gets started.
      393     8685        */
      394     8686    1   KQS$CLOCK: ENTRY (PARM) ALTRET; /* !!Doesn't ALTRET!! */

   8686  1 000376   000000 700200 xent  KQS$CLOCK    TSX0  ! X66_AUTO_1
         1 000377   000076 000001                    ZERO    62,1

      395     8687        /**/
      396     8688    1           CG$=ADDR(PARM);

   8688  1 000400   200003 236100                    LDQ     @PARM,,AUTO
         1 000401   200006 756100                    STQ     CG$,,AUTO

      397     8689    1           IF NOT CG$->KQ$CG.MMD.GIP THEN CALL SC_CGGARB;

   8689  1 000402   200006 470500                    LDP0    CG$,,AUTO
         1 000403   000011 234100                    SZN     9,,PR0
         1 000404   000407 604000 1                  TMI     s:8691
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:106  

   8689  1 000405   000000 713400 xsym               CLIMB   SC_CGGARB
         1 000406   000000 600000 xsid               climb   nvectors=         0

      398     8690                %LOCK (G=CG$->KQ$CG.GATE.CG);

   8691  1 000407   200006 236100                    LDQ     CG$,,AUTO
         1 000410   000107 036003                    ADLQ    71,DU
         1 000411   200066 756100                    STQ     I$+1,,AUTO
         1 000412   200066 630500                    EPPR0   I$+1,,AUTO
         1 000413   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000414   000000 701000 xent               TSX1    HFC$LOCK
         1 000415   000000 011000                    NOP     0

      399     8693    1           IF KQ$GARB.DELAY <= 0 THEN

   8693  1 000416   200006 470500                    LDP0    CG$,,AUTO
         1 000417   000031 235100                    LDA     25,,PR0
         1 000420   000431 605400 1                  TPNZ    s:8700

      400     8694    2             DO;

      401     8695                  %UNLOCK (G=CG$->KQ$CG.GATE.CG);

   8696  1 000421   200006 236100                    LDQ     CG$,,AUTO
         1 000422   000107 036003                    ADLQ    71,DU
         1 000423   200066 756100                    STQ     I$+1,,AUTO
         1 000424   200066 630500                    EPPR0   I$+1,,AUTO
         1 000425   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000426   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000427   000000 011000                    NOP     0

      402     8698    2             RETURN;

   8698  1 000430   000000 702200 xent               TSX2  ! X66_ARET

      403     8699    2             END;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:107  
      404     8700    1           ENTFLAG=KQ$GARB.DELAY;

   8700  1 000431   200015 755100                    STA     ENTFLAG,,AUTO

      405     8701    1           KQ$GARB.DELAY=0;

   8701  1 000432   000031 450100                    STZ     25,,PR0

      406     8702                %UNLOCK (G=CG$->KQ$CG.GATE.CG);

   8703  1 000433   200006 236100                    LDQ     CG$,,AUTO
         1 000434   000107 036003                    ADLQ    71,DU
         1 000435   200066 756100                    STQ     I$+1,,AUTO
         1 000436   200066 630500                    EPPR0   I$+1,,AUTO
         1 000437   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000440   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000441   000000 011000                    NOP     0

      407     8705    2             DO CASE (ENTFLAG);

   8705  1 000442   200015 235100                    LDA     ENTFLAG,,AUTO
         1 000443   000026 115007                    CMPA    22,DL
         1 000444   000446 602005 1                  TNC     s:8705+4,AL
         1 000445   000562 710000 1                  TRA     s:8764
         1 000446   000562 710000 1                  TRA     s:8764
         1 000447   000474 710000 1                  TRA     s:8708
         1 000450   000503 710000 1                  TRA     s:8713
         1 000451   000562 710000 1                  TRA     s:8764
         1 000452   000562 710000 1                  TRA     s:8764
         1 000453   000514 710000 1                  TRA     s:8725
         1 000454   000511 710000 1                  TRA     s:8721
         1 000455   000562 710000 1                  TRA     s:8764
         1 000456   000562 710000 1                  TRA     s:8764
         1 000457   000550 710000 1                  TRA     s:8754
         1 000460   000555 710000 1                  TRA     s:8759
         1 000461   000562 710000 1                  TRA     s:8764
         1 000462   000562 710000 1                  TRA     s:8764
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:108  
         1 000463   000562 710000 1                  TRA     s:8764
         1 000464   000562 710000 1                  TRA     s:8764
         1 000465   000517 710000 1                  TRA     s:8729
         1 000466   000524 710000 1                  TRA     s:8734
         1 000467   000531 710000 1                  TRA     s:8739
         1 000470   000536 710000 1                  TRA     s:8744
         1 000471   000543 710000 1                  TRA     s:8749
         1 000472   000562 710000 1                  TRA     s:8764
         1 000473   000506 710000 1                  TRA     s:8717

      408     8706
      409     8707    2               CASE (KQGD_DMSG0#);

      410     8708    2                 CALL CDELMSG0 ALTRET(RTN);

   8708  1 000474   002121 701000 1                  TSX1    CDELMSG0
         1 000475   000564 702000 1                  TSX2    RTN

      411     8709    2   DELCONT:      IF KQ$GARB.TYPE = 0 THEN GOTO GB0;

   8709  1 000476   200006 470500       DELCONT      LDP0    CG$,,AUTO
         1 000477   000032 236100                    LDQ     26,,PR0
         1 000500   000777 316003                    CANQ    511,DU
         1 000501   000047 600000 1                  TZE     GB0

      412     8710    2                 GOTO GB1;

   8710  1 000502   000063 710000 1                  TRA     GB1

      413     8711
      414     8712    2               CASE (KQGD_DMSG1#);

      415     8713    2                 CALL CDELMSG1 ALTRET(RTN);

   8713  1 000503   002126 701000 1                  TSX1    CDELMSG1
         1 000504   000564 702000 1                  TSX2    RTN

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:109  
      416     8714    2                 GOTO DELCONT;

   8714  1 000505   000476 710000 1                  TRA     DELCONT

      417     8715
      418     8716    2               CASE (KQGD_DMSG3#);

      419     8717    2                 CALL CDELMSG3 ALTRET(RTN);

   8717  1 000506   002143 701000 1                  TSX1    CDELMSG3
         1 000507   000564 702000 1                  TSX2    RTN

      420     8718    2                 GOTO DELCONT;

   8718  1 000510   000476 710000 1                  TRA     DELCONT

      421     8719
      422     8720    2               CASE (KQGD_QFULL#);

      423     8721    2                 CALL SQUISHENT;

   8721  1 000511   003450 701000 1                  TSX1    SQUISHENT
         1 000512   000000 011000                    NOP     0

      424     8722    2                 GOTO SQDUN;

   8722  1 000513   003207 710000 1                  TRA     SQ40

      425     8723
      426     8724    2               CASE (KQGD_SQGD0#);

      427     8725    2                 CALL SQUISHENT;

   8725  1 000514   003450 701000 1                  TSX1    SQUISHENT
         1 000515   000000 011000                    NOP     0

      428     8726    2                 GOTO SQ0;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:110  

   8726  1 000516   003051 710000 1                  TRA     SQ0

      429     8727
      430     8728    2               CASE (KQGD_SQID0#);

      431     8729    2                 CALL SQUISHENT;

   8729  1 000517   003450 701000 1                  TSX1    SQUISHENT
         1 000520   000000 011000                    NOP     0

      432     8730    2                 CALL INSRTD0 ALTRET(RTN);

   8730  1 000521   006323 701000 1                  TSX1    INSRTD0
         1 000522   000564 702000 1                  TSX2    RTN

      433     8731    2                 GOTO SQ24;

   8731  1 000523   003147 710000 1                  TRA     SQ24

      434     8732
      435     8733    2               CASE (KQGD_SQID1#);

      436     8734    2                 CALL SQUISHENT;

   8734  1 000524   003450 701000 1                  TSX1    SQUISHENT
         1 000525   000000 011000                    NOP     0

      437     8735    2                 CALL INSRTD1 ALTRET(RTN);

   8735  1 000526   006433 701000 1                  TSX1    INSRTD1
         1 000527   000564 702000 1                  TSX2    RTN

      438     8736    2                 GOTO SQ24;

   8736  1 000530   003147 710000 1                  TRA     SQ24

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:111  
      439     8737
      440     8738    2               CASE (KQGD_SQID2#);

      441     8739    2                 CALL SQUISHENT;

   8739  1 000531   003450 701000 1                  TSX1    SQUISHENT
         1 000532   000000 011000                    NOP     0

      442     8740    2                 CALL INSRTD2 ALTRET(RTN);

   8740  1 000533   006461 701000 1                  TSX1    INSRTD2
         1 000534   000564 702000 1                  TSX2    RTN

      443     8741    2                 GOTO SQ24;

   8741  1 000535   003147 710000 1                  TRA     SQ24

      444     8742
      445     8743    2               CASE (KQGD_SQID3#);

      446     8744    2                 CALL SQUISHENT;

   8744  1 000536   003450 701000 1                  TSX1    SQUISHENT
         1 000537   000000 011000                    NOP     0

      447     8745    2                 CALL INSRTD3 ALTRET(RTN);

   8745  1 000540   006503 701000 1                  TSX1    INSRTD3
         1 000541   000564 702000 1                  TSX2    RTN

      448     8746    2                 GOTO SQ24;

   8746  1 000542   003147 710000 1                  TRA     SQ24

      449     8747
      450     8748    2               CASE (KQGD_SQID4#);

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:112  
      451     8749    2                 CALL SQUISHENT;

   8749  1 000543   003450 701000 1                  TSX1    SQUISHENT
         1 000544   000000 011000                    NOP     0

      452     8750    2                 CALL INSRTD4 ALTRET(RTN);

   8750  1 000545   006556 701000 1                  TSX1    INSRTD4
         1 000546   000564 702000 1                  TSX2    RTN

      453     8751    2                 GOTO SQ24;

   8751  1 000547   003147 710000 1                  TRA     SQ24

      454     8752
      455     8753    2               CASE (KQGD_SQCD0#);

      456     8754    2                 CALL SQUISHENT;

   8754  1 000550   003450 701000 1                  TSX1    SQUISHENT
         1 000551   000000 011000                    NOP     0

      457     8755    2                 CALL CONCATD0 ALTRET(RTN);

   8755  1 000552   004711 701000 1                  TSX1    CONCATD0
         1 000553   000564 702000 1                  TSX2    RTN

      458     8756    2                 GOTO SQ30;

   8756  1 000554   003174 710000 1                  TRA     SQ30

      459     8757
      460     8758    2               CASE (KQGD_SQCD1#);

      461     8759    2                 CALL SQUISHENT;

   8759  1 000555   003450 701000 1                  TSX1    SQUISHENT
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:113  
         1 000556   000000 011000                    NOP     0

      462     8760    2                 CALL CONCATD1 ALTRET(RTN);

   8760  1 000557   004772 701000 1                  TSX1    CONCATD1
         1 000560   000564 702000 1                  TSX2    RTN

      463     8761    2                 GOTO SQ30;

   8761  1 000561   003174 710000 1                  TRA     SQ30

      464     8762
      465     8763    2               CASE (ELSE);

      466     8764    2                 CALL SC_CGGBSN;

   8764  1 000562   000000 713400 xsym               CLIMB   SC_CGGBSN
         1 000563   000000 600000 xsid               climb   nvectors=         0

      467     8765        /*S* SCREECH_CODE: KQS-S$CGGBSN
      468     8766             TYPE:         SNAP
      469     8767             MESSAGE:      COMGROUP garbage collection inconsistency
      470     8768             REMARKS:      A recoverable inconsistency has been discovered
      471     8769                           during comgroup garbage collection. */
      472     8770
      473     8771    2             END;

      474     8772    1   RTN:    RETURN;

   8772  1 000564   000000 702200 xent  RTN          TSX2  ! X66_ARET

      475     8773        /**/
      476     8774        /*F* NAME:         KQS$FCONT
      477     8775             PURPOSE:      To continue a deferred fetch initiated by the
      478     8776                           garbage collector
      479     8777             CALL:         KQS$FCONT (KQ$DFRPARM)
      480     8778             DESCRIPTION:  KQ$CG.GARB.DELAY says how to continue.
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:114  
      481     8779        */
      482     8780    1   KQS$FCONT: ENTRY (PARM) ALTRET; /* !!Doesn't ALTRET!! */

   8780  1 000565   000000 700200 xent  KQS$FCONT    TSX0  ! X66_AUTO_1
         1 000566   000076 000001                    ZERO    62,1

      483     8781        /**/
      484     8782    1           DFRP$=ADDR(PARM);

   8782  1 000567   200003 236100                    LDQ     @PARM,,AUTO
         1 000570   200010 756100                    STQ     DFRP$,,AUTO

      485     8783    1           DBLK$=DFRP$->KQ$DFRPARM.DBLK$;

   8783  1 000571   200010 470500                    LDP0    DFRP$,,AUTO
         1 000572   000001 236100                    LDQ     1,,PR0
         1 000573   200011 756100                    STQ     DBLK$,,AUTO

      486     8784    1           DDA=DFRP$->KQ$DFRPARM.ERR;

   8784  1 000574   000004 235100                    LDA     4,,PR0
         1 000575   200013 755100                    STA     DDA,,AUTO

      487     8785    1           CG$=DFRP$->KQ$DFRPARM.INFO$;

   8785  1 000576   000000 236100                    LDQ     0,,PR0
         1 000577   200006 756100                    STQ     CG$,,AUTO

      488     8786    1           ENTFLAG=-KQ$GARB.DELAY;

   8786  1 000600   200006 471500                    LDP1    CG$,,AUTO
         1 000601   100031 235100                    LDA     25,,PR1
         1 000602   000000 531000                    NEG     0
         1 000603   200015 755100                    STA     ENTFLAG,,AUTO

      489     8787    1           KQ$GARB.DELAY=0;

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:115  
   8787  1 000604   100031 450100                    STZ     25,,PR1

      490     8788    2             DO CASE (ENTFLAG);

   8788  1 000605   000017 115007                    CMPA    15,DL
         1 000606   000610 602005 1                  TNC     s:8788+3,AL
         1 000607   000670 710000 1                  TRA     s:8825
         1 000610   000670 710000 1                  TRA     s:8825
         1 000611   000670 710000 1                  TRA     s:8825
         1 000612   000670 710000 1                  TRA     s:8825
         1 000613   000627 710000 1                  TRA     s:8791
         1 000614   000670 710000 1                  TRA     s:8825
         1 000615   000670 710000 1                  TRA     s:8825
         1 000616   000670 710000 1                  TRA     s:8825
         1 000617   000632 710000 1                  TRA     s:8795
         1 000620   000637 710000 1                  TRA     s:8800
         1 000621   000670 710000 1                  TRA     s:8825
         1 000622   000670 710000 1                  TRA     s:8825
         1 000623   000644 710000 1                  TRA     s:8805
         1 000624   000651 710000 1                  TRA     s:8810
         1 000625   000656 710000 1                  TRA     s:8815
         1 000626   000663 710000 1                  TRA     s:8820

      491     8789
      492     8790    2               CASE (KQGD_DMSG2#);

      493     8791    2                 CALL CDELMSG2 ALTRET(RTN);

   8791  1 000627   002133 701000 1                  TSX1    CDELMSG2
         1 000630   000564 702000 1                  TSX2    RTN

      494     8792    2                 GOTO DELCONT;

   8792  1 000631   000476 710000 1                  TRA     DELCONT

      495     8793
      496     8794    2               CASE (KQGD_SQCF0#);
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:116  

      497     8795    2                 CALL SQUISHENT0;

   8795  1 000632   003454 701000 1                  TSX1    SQUISHENT0
         1 000633   000000 011000                    NOP     0

      498     8796    2                 CALL CONCATF0 ALTRET(RTN);

   8796  1 000634   004701 701000 1                  TSX1    CONCATF0
         1 000635   000564 702000 1                  TSX2    RTN

      499     8797    2                 GOTO SQ30;

   8797  1 000636   003174 710000 1                  TRA     SQ30

      500     8798
      501     8799    2               CASE (KQGD_SQCF1#);

      502     8800    2                 CALL SQUISHENT0;

   8800  1 000637   003454 701000 1                  TSX1    SQUISHENT0
         1 000640   000000 011000                    NOP     0

      503     8801    2                 CALL CONCATF1 ALTRET(RTN);

   8801  1 000641   004762 701000 1                  TSX1    CONCATF1
         1 000642   000564 702000 1                  TSX2    RTN

      504     8802    2                 GOTO SQ30;

   8802  1 000643   003174 710000 1                  TRA     SQ30

      505     8803
      506     8804    2               CASE (KQGD_SQIF0#);

      507     8805    2                 CALL SQUISHENT0;

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:117  
   8805  1 000644   003454 701000 1                  TSX1    SQUISHENT0
         1 000645   000000 011000                    NOP     0

      508     8806    2                 CALL INSRTF0 ALTRET(RTN);

   8806  1 000646   006316 701000 1                  TSX1    INSRTF0
         1 000647   000564 702000 1                  TSX2    RTN

      509     8807    2                 GOTO SQ24;

   8807  1 000650   003147 710000 1                  TRA     SQ24

      510     8808
      511     8809    2               CASE (KQGD_SQIF1#);

      512     8810    2                 CALL SQUISHENT0;

   8810  1 000651   003454 701000 1                  TSX1    SQUISHENT0
         1 000652   000000 011000                    NOP     0

      513     8811    2                 CALL INSRTF1 ALTRET(RTN);

   8811  1 000653   006426 701000 1                  TSX1    INSRTF1
         1 000654   000564 702000 1                  TSX2    RTN

      514     8812    2                 GOTO SQ24;

   8812  1 000655   003147 710000 1                  TRA     SQ24

      515     8813
      516     8814    2               CASE (KQGD_SQIF2#);

      517     8815    2                 CALL SQUISHENT0;

   8815  1 000656   003454 701000 1                  TSX1    SQUISHENT0
         1 000657   000000 011000                    NOP     0

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:118  
      518     8816    2                 CALL INSRTF2 ALTRET(RTN);

   8816  1 000660   006454 701000 1                  TSX1    INSRTF2
         1 000661   000564 702000 1                  TSX2    RTN

      519     8817    2                 GOTO SQ24;

   8817  1 000662   003147 710000 1                  TRA     SQ24

      520     8818
      521     8819    2               CASE (KQGD_SQIF3#);

      522     8820    2                 CALL SQUISHENT0;

   8820  1 000663   003454 701000 1                  TSX1    SQUISHENT0
         1 000664   000000 011000                    NOP     0

      523     8821    2                 CALL INSRTF3 ALTRET(RTN);

   8821  1 000665   006476 701000 1                  TSX1    INSRTF3
         1 000666   000564 702000 1                  TSX2    RTN

      524     8822    2                 GOTO SQ24;

   8822  1 000667   003147 710000 1                  TRA     SQ24

      525     8823
      526     8824    2               CASE (ELSE);

      527     8825    2                 CALL SC_CGGBSN;

   8825  1 000670   000000 713400 xsym               CLIMB   SC_CGGBSN
         1 000671   000000 600000 xsid               climb   nvectors=         0

      528     8826
      529     8827    2             END;

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:119  
      530     8828    1           GOTO RTN;

   8828  1 000672   000564 710000 1                  TRA     RTN

      531     8829        /**/
      532     8830        /*F* NAME:         KQS$CQUEUE
      533     8831             PURPOSE:      To begin to garbage-collect the queue
      534     8832             CALL:         KQS$CQUEUE (KQ$CG)
      535     8833             DESCRIPTION:  Called from KQL$LIST when a reader of the
      536     8834                           queue needs help or is finished with the queue,
      537     8835                           and the garbage collector was waiting for the queue.
      538     8836                           KQ$QUEUE.BUSY.GIP has been set by the caller.
      539     8837        */
      540     8838    1   KQS$CQUEUE: ENTRY (PARM) ALTRET; /* !!Doesn't ALTRET!! */

   8838  1 000673   000000 700200 xent  KQS$CQUEUE   TSX0  ! X66_AUTO_1
         1 000674   000076 000001                    ZERO    62,1

      541     8839        /**/
      542     8840    1           CG$=ADDR(PARM);

   8840  1 000675   200003 236100                    LDQ     @PARM,,AUTO
         1 000676   200006 756100                    STQ     CG$,,AUTO

      543     8841    1           IF CG$->KQ$CG.MMD.GIP = '0'B

   8841  1 000677   200006 470500                    LDP0    CG$,,AUTO
         1 000700   000011 234100                    SZN     9,,PR0
         1 000701   000705 605000 1                  TPL     s:8842
         1 000702   000031 235100                    LDA     25,,PR0
         1 000703   000016 115000 2                  CMPA    14
         1 000704   000707 600000 1                  TZE     s:8843

      544     8842    1           OR KQ$GARB.DELAY ~= -KQGD_QRDWT# THEN CALL SC_CGGARB;

   8842  1 000705   000000 713400 xsym               CLIMB   SC_CGGARB
         1 000706   000000 600000 xsid               climb   nvectors=         0
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:120  

      545     8843    1           ENTFLAG=-KQ$GARB.DELAY;

   8843  1 000707   200006 470500                    LDP0    CG$,,AUTO
         1 000710   000031 235100                    LDA     25,,PR0
         1 000711   000000 531000                    NEG     0
         1 000712   200015 755100                    STA     ENTFLAG,,AUTO

      546     8844    1           KQ$GARB.DELAY=0;

   8844  1 000713   000031 450100                    STZ     25,,PR0

      547     8845    1           CALL DOQ1 ALTRET(RTN);

   8845  1 000714   002532 701000 1                  TSX1    DOQ1
         1 000715   000564 702000 1                  TSX2    RTN

      548     8846    1           GOTO GB2;

   8846  1 000716   000074 710000 1                  TRA     GB2

      549     8847        %EJECT;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:121  
      550     8848        /**/
      551     8849        /*F* NAME:         KQS$RECOVER
      552     8850             PURPOSE:      To clean up the garbage collector when a
      553     8851                           comgroup is being opened after a crash
      554     8852             DESCRIPTION:  Called with the clock disabled.
      555     8853
      556     8854                           Cleans up every MLH in the comgroup, by zapping
      557     8855                           STATE in all super MBLKs, zapping the MLH
      558     8856                           read/GC flags, and fixing up the DELAY$
      559     8857                           list.    ****** WARNING ****** This last
      560     8858                           requires us to get called BEFORE station
      561     8859                           recovery runs since the latter deletes station
      562     8860                           nodes that may be linked on the DELAY$
      563     8861                           list (and delete sometimes means release
      564     8862                           the page....).
      565     8863
      566     8864                           If a delete-msg was in progress, the message
      567     8865                           being deleted is replaced on the DELMSG$ list
      568     8866                           (note that this can cause ERRLOG entries as
      569     8867                           DODELMSG tries to delete DDAs from that MBLK
      570     8868                           which he deleted before the crash).
      571     8869                           Must never do any data cache I/O.
      572     8870
      573     8871                           Resets the blocked-for-memory listheads.
      574     8872
      575     8873                           ALTRETs if it doesn't like something.
      576     8874        */
      577     8875    1   KQS$RECOVER: ENTRY (PARM) ALTRET;

   8875  1 000717   000000 700200 xent  KQS$RECOVER  TSX0  ! X66_AUTO_1
         1 000720   000076 000001                    ZERO    62,1

      578     8876        /**/
      579     8877    1           CG$=ADDR(PARM);

   8877  1 000721   200003 236100                    LDQ     @PARM,,AUTO
         1 000722   200006 756100                    STQ     CG$,,AUTO
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:122  

      580     8878    1           KQ$GARB.DELAY=0;

   8878  1 000723   200006 470500                    LDP0    CG$,,AUTO
         1 000724   000031 450100                    STZ     25,,PR0

      581     8879        /**/
      582     8880    1           IF KQ$GARB.JNLD$ ~= ADDR(NIL) THEN

   8880  1 000725   000034 236100                    LDQ     28,,PR0
         1 000726   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000727   000750 600000 1                  TZE     s:8891

      583     8881    2             DO;

      584     8882    2             X$=KQ$GARB.JNLD$;

   8882  1 000730   200022 756100                    STQ     X$,,AUTO

      585     8883    3               DO WHILE (X$->KQ$MBLK.LNK$ ~= ADDR(NIL));

   8883  1 000731   000735 710000 1                  TRA     s:8885

      586     8884    3               X$=X$->KQ$MBLK.LNK$;

   8884  1 000732   200022 470500                    LDP0    X$,,AUTO
         1 000733   000000 236100                    LDQ     0,,PR0
         1 000734   200022 756100                    STQ     X$,,AUTO

      587     8885    3               END;

   8885  1 000735   200022 470500                    LDP0    X$,,AUTO
         1 000736   000000 236100                    LDQ     0,,PR0
         1 000737   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000740   000732 601000 1                  TNZ     s:8884

      588     8886    2             X$->KQ$MBLK.LNK$=CG$->KQ$CG.DELMSG$;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:123  

   8886  1 000741   200006 471500                    LDP1    CG$,,AUTO
         1 000742   100114 236100                    LDQ     76,,PR1
         1 000743   000000 756100                    STQ     0,,PR0

      589     8887    2             CG$->KQ$CG.DELMSG$=KQ$GARB.JNLD$;

   8887  1 000744   100034 236100                    LDQ     28,,PR1
         1 000745   100114 756100                    STQ     76,,PR1

      590     8888    2             KQ$GARB.JNLD$=ADDR(NIL);

   8888  1 000746   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000747   100034 756100                    STQ     28,,PR1

      591     8889    2             END;

      592     8890        /**/
      593     8891    1           STA$=KQ$STREE.HEAD$;

   8891  1 000750   200006 470500                    LDP0    CG$,,AUTO
         1 000751   000101 236100                    LDQ     65,,PR0
         1 000752   200004 756100                    STQ     STA$,,AUTO

      594     8892    2             DO WHILE (STA$ ~= ADDR(NIL));

   8892  1 000753   000770 710000 1                  TRA     s:8896

      595     8893    2             CALL RCVMLH (STA$->KQ$STA.MLH) ALTRET(ALTRT);

   8893  1 000754   200004 236100                    LDQ     STA$,,AUTO
         1 000755   000034 036003                    ADLQ    28,DU
         1 000756   200031 756100                    STQ     END$+2,,AUTO
         1 000757   001137 701000 1                  TSX1    RCVMLH
         1 000760   003354 702000 1                  TSX2    ALTRT

      596     8894    2             CALL KQL$GARBDUNSR (STA$->KQ$STA);
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:124  

   8894  1 000761   200004 630500                    EPPR0   STA$,,AUTO
         1 000762   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000763   000000 701000 xent               TSX1    KQL$GARBDUNSR
         1 000764   000000 011000                    NOP     0

      597     8895    2             STA$=STA$->KQ$STA.BTN.FLINK$;

   8895  1 000765   200004 470500                    LDP0    STA$,,AUTO
         1 000766   000004 236100                    LDQ     4,,PR0
         1 000767   200004 756100                    STQ     STA$,,AUTO

      598     8896    2             END;

   8896  1 000770   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000771   000754 601000 1                  TNZ     s:8893

      599     8897        /**/
      600     8898    1           QTN$=KQ$QUEUE.PLHD$;

   8898  1 000772   200006 470500                    LDP0    CG$,,AUTO
         1 000773   000061 236100                    LDQ     49,,PR0
         1 000774   200024 756100                    STQ     QTN$,,AUTO

      601     8899    2             DO WHILE (QTN$ ~= ADDR(NIL));

   8899  1 000775   001006 710000 1                  TRA     s:8902

      602     8900    2             CALL RCVMLH (QTN$->KQ$QTN.MLH) ALTRET(ALTRT);

   8900  1 000776   200024 236100                    LDQ     QTN$,,AUTO
         1 000777   000055 036003                    ADLQ    45,DU
         1 001000   200031 756100                    STQ     END$+2,,AUTO
         1 001001   001137 701000 1                  TSX1    RCVMLH
         1 001002   003354 702000 1                  TSX2    ALTRT

      603     8901    2             QTN$=QTN$->KQ$QTN.PLINK$;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:125  

   8901  1 001003   200024 470500                    LDP0    QTN$,,AUTO
         1 001004   000047 236100                    LDQ     39,,PR0
         1 001005   200024 756100                    STQ     QTN$,,AUTO

      604     8902    2             END;

   8902  1 001006   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001007   000776 601000 1                  TNZ     s:8900

      605     8903        /**/
      606     8904    1           KQ$GARB.DELAY=0;

   8904  1 001010   200006 470500                    LDP0    CG$,,AUTO
         1 001011   000031 450100                    STZ     25,,PR0

      607     8905        /**/
      608     8906    1           CG$->KQ$CG.MMD.STAHD$=ADDR(NIL);

   8906  1 001012   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 001013   000013 756100                    STQ     11,,PR0

      609     8907    1           CG$->KQ$CG.MMD.MBLKHD$=ADDR(NIL);

   8907  1 001014   000014 756100                    STQ     12,,PR0

      610     8908                        /* Now get ready to leave.  We'll be called
      611     8909                           back later at KQS$RECOVER2 to finish any
      612     8910                           garbage collection that was in progress
      613     8911                           and that required disk cache I/O. */
      614     8912    1           IF CG$->KQ$CG.MMD.GIP THEN

   8912  1 001015   000011 234100                    SZN     9,,PR0
         1 001016   001103 605000 1                  TPL     s:8941

      615     8913    2             DO;

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:126  
      616     8914    2             IF  KQ$GARB.DMIP

   8914  1 001017   000032 236100                    LDQ     26,,PR0
         1 001020   200000 316003                    CANQ    65536,DU
         1 001021   001036 600000 1                  TZE     s:8922
         1 001022   000036 236100                    LDQ     30,,PR0
         1 001023   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001024   001036 600000 1                  TZE     s:8922

      617     8915    2             AND KQ$GARB.MBLK$ ~= ADDR(NIL) THEN
      618     8916    3               DO;

      619     8917    3               MBLK$=KQ$GARB.MBLK$;

   8917  1 001025   200005 756100                    STQ     MBLK$,,AUTO

      620     8918    3               KQ$GARB.MBLK$=ADDR(NIL);

   8918  1 001026   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 001027   000036 756100                    STQ     30,,PR0

      621     8919    3               MBLK$->KQ$MBLK.LNK$=CG$->KQ$CG.DELMSG$;

   8919  1 001030   000114 236100                    LDQ     76,,PR0
         1 001031   200005 471500                    LDP1    MBLK$,,AUTO
         1 001032   100000 756100                    STQ     0,,PR1

      622     8920    3               CG$->KQ$CG.DELMSG$=MBLK$;

   8920  1 001033   200005 236100                    LDQ     MBLK$,,AUTO
         1 001034   000114 756100                    STQ     76,,PR0

      623     8921    3               END;

   8921  1 001035   001103 710000 1                  TRA     s:8941

      624     8922    2             ELSE IF KQ$GARB.SQIP THEN
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:127  

   8922  1 001036   000032 236100                    LDQ     26,,PR0
         1 001037   010000 316003                    CANQ    4096,DU
         1 001040   001103 600000 1                  TZE     s:8941

      625     8923    2               IF KQ$GARB.SPSTATE ~= 0 THEN

   8923  1 001041   000046 236100                    LDQ     38,,PR0
         1 001042   000777 316003                    CANQ    511,DU
         1 001043   001103 600000 1                  TZE     s:8941

      626     8924    3                 DO; /* Re-setup some stuff clobbered by KCO and RCVR */

      627     8925    3                 CALL SQUISHENT;

   8925  1 001044   003450 701000 1                  TSX1    SQUISHENT
         1 001045   000000 011000                    NOP     0

      628     8926    3                 IF KQ$GARB.STA THEN

   8926  1 001046   200006 470500                    LDP0    CG$,,AUTO
         1 001047   000032 234100                    SZN     26,,PR0
         1 001050   001064 605000 1                  TPL     s:8934

      629     8927    4                   DO;

      630     8928    4                   STA$->KQ$STA.LOCKCNT=STA$->KQ$STA.LOCKCNT+1;

   8928  1 001051   200004 471500                    LDP1    STA$,,AUTO
         1 001052   100020 236100                    LDQ     16,,PR1
         1 001053   000001 036007                    ADLQ    1,DL
         1 001054   100020 552104                    STBQ    16,'04'O,PR1

      631     8929    4                   MLH$->KQ$MLH.BUSY.GIP='1'B;

   8929  1 001055   200014 473500                    LDP3    MLH$,,AUTO
         1 001056   000200 236003                    LDQ     128,DU
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:128  
         1 001057   300003 256100                    ORSQ    3,,PR3

      632     8930    4                   MLH$->KQ$MLH.GACT='1'B;

   8930  1 001060   200014 473500                    LDP3    MLH$,,AUTO
         1 001061   000040 236003                    LDQ     32,DU
         1 001062   300003 256100                    ORSQ    3,,PR3

      633     8931    4                   END;

   8931  1 001063   001101 710000 1                  TRA     s:8938

      634     8932    3                 ELSE
      635     8933    4                   DO;

      636     8934    4                   QTN$->KQ$QTN.LOCKCNT=QTN$->KQ$QTN.LOCKCNT+1;

   8934  1 001064   200024 471500                    LDP1    QTN$,,AUTO
         1 001065   100050 236100                    LDQ     40,,PR1
         1 001066   000033 772000                    QRL     27
         1 001067   000177 376007                    ANQ     127,DL
         1 001070   000001 036007                    ADLQ    1,DL
         1 001071   000033 736000                    QLS     27
         1 001072   100050 676100                    ERQ     40,,PR1
         1 001073   177000 376003                    ANQ     65024,DU
         1 001074   100050 656100                    ERSQ    40,,PR1

      637     8935    4                   KQ$QUEUE.BUSY.GIP='1'B;

   8935  1 001075   000200 236003                    LDQ     128,DU
         1 001076   000063 256100                    ORSQ    51,,PR0

      638     8936    4                   KQ$QUEUE.GACT='1'B;

   8936  1 001077   000040 236003                    LDQ     32,DU
         1 001100   000063 256100                    ORSQ    51,,PR0

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:129  
      639     8937    4                   END;

      640     8938    3                 CALL SQUISHX;

   8938  1 001101   003517 701000 1                  TSX1    SQUISHX
         1 001102   000000 011000                    NOP     0

      641     8939    3                 END;

      642     8940    2             END;

      643     8941    1           RETURN;

   8941  1 001103   000000 702200 xent               TSX2  ! X66_ARET

      644     8942        /**/
      645     8943        /*F* NAME:         KQS$RECOVER2
      646     8944             PURPOSE:      To finish cleaning up the garbage collector
      647     8945                           during comgroup reopen
      648     8946             DESCRIPTION:  If an insert was in progress, then it is
      649     8947                           continued.  Else all garbage collection
      650     8948                           flags are zapped and we exit. */
      651     8949    1   KQS$RECOVER2: ENTRY (PARM) ALTRET;

   8949  1 001104   000000 700200 xent  KQS$RECOVER2 TSX0  ! X66_AUTO_1
         1 001105   000076 000001                    ZERO    62,1

      652     8950        /**/
      653     8951    1           CG$=ADDR(PARM);

   8951  1 001106   200003 236100                    LDQ     @PARM,,AUTO
         1 001107   200006 756100                    STQ     CG$,,AUTO

      654     8952    1           IF CG$->KQ$CG.MMD.GIP THEN

   8952  1 001110   200006 470500                    LDP0    CG$,,AUTO
         1 001111   000011 234100                    SZN     9,,PR0
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:130  
         1 001112   001130 605000 1                  TPL     s:8966

      655     8953    2             DO;

      656     8954    2             IF KQ$GARB.SQIP THEN

   8954  1 001113   000032 236100                    LDQ     26,,PR0
         1 001114   010000 316003                    CANQ    4096,DU
         1 001115   001130 600000 1                  TZE     s:8966

      657     8955    3               DO;

      658     8956    3               IF KQ$GARB.SPSTATE ~= 0 THEN

   8956  1 001116   000046 236100                    LDQ     38,,PR0
         1 001117   000777 316003                    CANQ    511,DU
         1 001120   001130 600000 1                  TZE     s:8966

      659     8957    4                 DO;

      660     8958    4                 CALL SQUISHENT;

   8958  1 001121   003450 701000 1                  TSX1    SQUISHENT
         1 001122   000000 011000                    NOP     0

      661     8959    4                 ENTFLAG=KQGD_SRCVR#;

   8959  1 001123   000030 235007                    LDA     24,DL
         1 001124   200015 755100                    STA     ENTFLAG,,AUTO

      662     8960    4                 CALL INSRCVR ALTRET(RCVDUN);

   8960  1 001125   005155 701000 1                  TSX1    INSRCVR
         1 001126   001136 702000 1                  TSX2    RCVDUN

      663     8961    4                 GOTO SQ24;

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:131  
   8961  1 001127   003147 710000 1                  TRA     SQ24

      664     8962    4                 END;
      665     8963    3               END;
      666     8964    2             END;
      667     8965        /**/
      668     8966    1           CG$->KQ$CG.MMD.GIP='0'B;

   8966  1 001130   000031 236000 xsym               LDQ     B_VECTNIL+25
         1 001131   000011 356100                    ANSQ    9,,PR0

      669     8967    1           KQ$GARB.SQIP='0'B;

   8967  1 001132   000015 236000 2                  LDQ     13
         1 001133   000032 356100                    ANSQ    26,,PR0

      670     8968    1           KQ$GARB.DMIP='0'B;

   8968  1 001134   000017 236000 2                  LDQ     15
         1 001135   000032 356100                    ANSQ    26,,PR0

   8968  1 001136                       RCVDUN       null
      671     8969        /**/
      672     8970    1   RCVDUN: ;
      673     8971    1           RETURN;

   8971  1 001136   000000 702200 xent               TSX2  ! X66_ARET

      674     8972        /**/
      675     8973    1   RCVMLH: PROC (KQ$MLH) ALTRET;

   8973  1 001137   200030 741300       RCVMLH       STX1  ! END$+1,,AUTO

      676     8974        /**/
      677     8975        %KQ_MLH (FPTN=KQ$MLH,STCLASS="");
      678     9045        %KQ_MLH (FPTN=KQ$TMLH,STCLASS=AUTO);
      679     9115    2   DCL DELETE BIT(1) ALIGNED;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:132  
      680     9116        /**/
      681     9117    2           MLH$=ADDR(KQ$MLH);

   9117  1 001140   200031 236100                    LDQ     @KQ$MLH,,AUTO
         1 001141   200014 756100                    STQ     MLH$,,AUTO

      682     9118    2           DELETE='0'B;

   9118  1 001142   200042 450100                    STZ     DELETE,,AUTO

      683     9119    2           IF NOT KQ$MLH.B03 THEN

   9119  1 001143   200031 470500                    LDP0    @KQ$MLH,,AUTO
         1 001144   000003 236100                    LDQ     3,,PR0
         1 001145   000004 316003                    CANQ    4,DU
         1 001146   001206 601000 1                  TNZ     s:9136

      684     9120    3             DO;  /* fix up pre-B03 MLH */

      685     9121    3             KQ$TMLH=KQ_IMLH;

   9121  1 001147   000100 100400                    MLR     fill='000'O
         1 001150   000000 000040 xsym               ADSC9   KQ_IMLH                  cn=0,n=32
         1 001151   200032 000040                    ADSC9   KQ$TMLH,,AUTO            cn=0,n=32

      686     9122    3             KQ$TMLH.HEAD$=MLH$->KQ$MLHB02.HEAD$;

   9122  1 001152   200014 471500                    LDP1    MLH$,,AUTO
         1 001153   100000 236100                    LDQ     0,,PR1
         1 001154   200032 756100                    STQ     KQ$TMLH,,AUTO

      687     9123    3             KQ$TMLH.TAIL$=MLH$->KQ$MLHB02.TAIL$;

   9123  1 001155   100001 236100                    LDQ     1,,PR1
         1 001156   200033 756100                    STQ     NFREE+1,,AUTO

      688     9124    3             KQ$TMLH.DELAY$=MLH$->KQ$MLHB02.DWHD$;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:133  

   9124  1 001157   100002 236100                    LDQ     2,,PR1
         1 001160   200034 756100                    STQ     FREE$+1,,AUTO

      689     9125    3             KQ$TMLH.COUNT=MLH$->KQ$MLHB02.COUNT;

   9125  1 001161   100005 235100                    LDA     5,,PR1
         1 001162   200037 755100                    STA     SMBLK+1,,AUTO

      690     9126    3             KQ$TMLH.QUEUE=MLH$->KQ$MLHB02.QUEUE;

   9126  1 001163   100003 236100                    LDQ     3,,PR1
         1 001164   000010 772000                    QRL     8
         1 001165   200035 676100                    ERQ     SMBLK+1,,AUTO
         1 001166   000100 376003                    ANQ     64,DU
         1 001167   200035 656100                    ERSQ    SMBLK+1,,AUTO

      691     9127    3             DELETE=MLH$->KQ$MLHB02.DELETE;

   9127  1 001170   100003 236100                    LDQ     3,,PR1
         1 001171   000004 736000                    QLS     4
         1 001172   400000 376003                    ANQ     -131072,DU
         1 001173   200042 756100                    STQ     DELETE,,AUTO

      692     9128    3             KQ$TMLH.SUPERCNT=MLH$->KQ$MLHB02.SUPERCNT;

   9128  1 001174   100004 720100                    LXL0    4,,PR1
         1 001175   200036 440100                    SXL0    SMBLK+2,,AUTO

      693     9129    3             IF MLH$->KQ$MLHB02.BUSY ~= 0 THEN

   9129  1 001176   100003 236100                    LDQ     3,,PR1
         1 001177   700000 316003                    CANQ    -32768,DU
         1 001200   001203 600000 1                  TZE     s:9132

      694     9130    3              KQ$TMLH.BUSY.RIP='1'B;

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:134  
   9130  1 001201   000400 236003                    LDQ     256,DU
         1 001202   200035 256100                    ORSQ    SMBLK+1,,AUTO

      695     9131    4               DO INHIBIT;

      696     9132    4               KQ$MLH=KQ$TMLH;

   9132  1 001203   000100 100700                    MLR   ! fill='000'O
         1 001204   200032 000040                    ADSC9   KQ$TMLH,,AUTO            cn=0,n=32
         1 001205   000000 000040                    ADSC9   0,,PR0                   cn=0,n=32

      697     9133    4               END;

      698     9134    3             END;

      699     9135        /**/
      700     9136    2           CALL KQL$RCVRDLY (KQ$MLH.DELAY$,KQ$MLH.DELAYDQ$);

   9136  1 001206   200031 236100                    LDQ     @KQ$MLH,,AUTO
         1 001207   000006 036003                    ADLQ    6,DU
         1 001210   200067 756100                    STQ     I$+2,,AUTO
         1 001211   200031 236100                    LDQ     @KQ$MLH,,AUTO
         1 001212   000002 036003                    ADLQ    2,DU
         1 001213   200066 756100                    STQ     I$+1,,AUTO
         1 001214   200066 630500                    EPPR0   I$+1,,AUTO
         1 001215   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001216   000000 701000 xent               TSX1    KQL$RCVRDLY
         1 001217   000000 011000                    NOP     0

      701     9137    2           IF DELETE THEN CALL KQL$DELMLHR(CG$->KQ$CG,MLH$);

   9137  1 001220   200042 234100                    SZN     DELETE,,AUTO
         1 001221   001232 605000 1                  TPL     s:9138

   9137  1 001222   200014 630500                    EPPR0   MLH$,,AUTO
         1 001223   200067 450500                    STP0    I$+2,,AUTO
         1 001224   200006 236100                    LDQ     CG$,,AUTO
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:135  
         1 001225   200066 756100                    STQ     I$+1,,AUTO
         1 001226   200066 630500                    EPPR0   I$+1,,AUTO
         1 001227   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 001230   000000 701000 xent               TSX1    KQL$DELMLHR
         1 001231   000000 011000                    NOP     0

      702     9138    2           CALL CHKMLH ALTRET(ALTRT);

   9138  1 001232   007316 701000 1                  TSX1    CHKMLH
         1 001233   001305 702000 1                  TSX2    ALTRT

      703     9139    2           IF KQ$MLH.BUSY.RIP THEN

   9139  1 001234   200031 470500                    LDP0    @KQ$MLH,,AUTO
         1 001235   000003 236100                    LDQ     3,,PR0
         1 001236   000400 316003                    CANQ    256,DU
         1 001237   001266 600000 1                  TZE     s:9155

      704     9140    3             DO;

      705     9141    3             I=0;

   9141  1 001240   200012 450100                    STZ     I,,AUTO

      706     9142    3             MBLK$=KQ$MLH.HEAD$;

   9142  1 001241   000000 236100                    LDQ     0,,PR0
         1 001242   200005 756100                    STQ     MBLK$,,AUTO

      707     9143    4               DO WHILE (MBLK$ ~= ADDR(NIL));

   9143  1 001243   001264 710000 1                  TRA     s:9152

      708     9144    4               IF MBLK$->KQ$MBLK.SUPER THEN

   9144  1 001244   200005 470500                    LDP0    MBLK$,,AUTO
         1 001245   000010 234100                    SZN     8,,PR0
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:136  
         1 001246   001262 605000 1                  TPL     s:9151

      709     9145    4                IF MBLK$->KQ$MBLK.STATE ~= KQSS_IDLE# THEN

   9145  1 001247   000010 236100                    LDQ     8,,PR0
         1 001250   007000 316003                    CANQ    3584,DU
         1 001251   001262 600000 1                  TZE     s:9151

      710     9146    5                  DO;

      711     9147    5                  IF I ~= 0 THEN ALTRETURN;

   9147  1 001252   200012 235100                    LDA     I,,AUTO
         1 001253   001256 600000 1                  TZE     s:9148

   9147  1 001254   200030 221300                    LDX1  ! END$+1,,AUTO
         1 001255   000000 702211                    TSX2  ! 0,X1

      712     9148    5                  I=1;

   9148  1 001256   000001 235007                    LDA     1,DL
         1 001257   200012 755100                    STA     I,,AUTO

      713     9149    5                  MBLK$->KQ$MBLK.STATE=KQSS_IDLE#;

   9149  1 001260   000020 236000 2                  LDQ     16
         1 001261   000010 356100                    ANSQ    8,,PR0

      714     9150    5                  END;

      715     9151    4               MBLK$=MBLK$->KQ$MBLK.LNK$;

   9151  1 001262   000000 236100                    LDQ     0,,PR0
         1 001263   200005 756100                    STQ     MBLK$,,AUTO

      716     9152    4               END;

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:137  
   9152  1 001264   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001265   001244 601000 1                  TNZ     s:9144

      717     9153    3             END;

      718     9154        /**/
      719     9155    2           KQ$MLH.BUSY='0'B;

   9155  1 001266   200031 470500                    LDP0    @KQ$MLH,,AUTO
         1 001267   000021 236000 2                  LDQ     17
         1 001270   000003 356100                    ANSQ    3,,PR0

      720     9156    2           KQ$MLH.GACT='0'B;

   9156  1 001271   000022 236000 2                  LDQ     18
         1 001272   000003 356100                    ANSQ    3,,PR0

      721     9157    2           KQ$MLH.RUSR#=0;

   9157  1 001273   000000 236003                    LDQ     0,DU
         1 001274   000003 552140                    STBQ    3,'40'O,PR0

      722     9158    2           KQ$MLH.PCSTAMP=0;

   9158  1 001275   000000 220003                    LDX0    0,DU
         1 001276   000004 740100                    STX0    4,,PR0

      723     9159    2           KQ$MLH.RQMEM='0'B;

   9159  1 001277   000003 236000 2                  LDQ     3
         1 001300   000003 356100                    ANSQ    3,,PR0

      724     9160    2           KQ$MLH.RQGC='0'B;

   9160  1 001301   000002 236000 2                  LDQ     2
         1 001302   000003 356100                    ANSQ    3,,PR0

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:138  
      725     9161        /**/
      726     9162    2           RETURN;

   9162  1 001303   200030 221300                    LDX1  ! END$+1,,AUTO
         1 001304   000001 702211                    TSX2  ! 1,X1

      727     9163    2   ALTRT:  ALTRETURN;

   9163  1 001305   200030 221300       ALTRT        LDX1  ! END$+1,,AUTO
         1 001306   000000 702211                    TSX2  ! 0,X1

      728     9164    2   END RCVMLH;
      729     9165        %EJECT;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:139  
      730     9166        /********************************************************
      731     9167        *********************************************************/
      732     9168        /**/
      733     9169        /*D* NAME:         DODELMSG
      734     9170             PURPOSE:      To delete the msgs on the DELMSG$
      735     9171                           list
      736     9172             DESCRIPTION:  Under normal conditions, this routine needs no
      737     9173                           help from the rest of the garbage collector,
      738     9174                           and is always called first because it can usually
      739     9175                           make lots of memory available cheaply.
      740     9176
      741     9177                           The exception lies in the deletion of journaled
      742     9178                           messages, which requires sending JOURNAL DELETE
      743     9179                           messages to the journal station.  If the messages
      744     9180                           involved are in memory, it's still no problem
      745     9181                           since the message MBLK is used for the MBLK of
      746     9182                           the journal delete message.  The problem comes
      747     9183                           when there's no memory available and the journaled
      748     9184                           message is in a super MBLK's disc list.  We're
      749     9185                           stuck then.  What we do is place the super MBLK
      750     9186                           on the JNLD$ list, and march on.  When we get
      751     9187                           to the end of the DELMSG$ list, we try the
      752     9188                           JNLD$ list again.  When we can't get memory to
      753     9189                           process something on the JNLD$ list, we return
      754     9190                           and let the rest of the garbage collector run
      755     9191                           to try to make some memory.  If this fails then
      756     9192                           the comgroup is full.
      757     9193
      758     9194                           If at any time, we must wait (either on the clock
      759     9195                           or on I/O endaction), we set KQ$CG.GARB.DELAY to
      760     9196                           an appropriate value and ALTRETURN.
      761     9197        */
      762     9198    1   DODELMSG: PROC ALTRET;

   9198  1 001307   200030 741300       DODELMSG     STX1  ! END$+1,,AUTO

      763     9199        /**/
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:140  
      764     9200    2   DCL STAMP UBIN;
      765     9201        /**/
      766     9202    2           IF KQ_LOG.GARB THEN

   9202  1 001310   000000 236000 xsym               LDQ     KQ_LOG
         1 001311   200000 316003                    CANQ    65536,DU
         1 001312   001335 600000 1                  TZE     D0

      767     9203    3             DO;

      768     9204    3             CALL KQZ$LOG (CG$->KQ$CG,%KQLOG_GDELM,ENTFLAG,0,0,0,

   9204  1 001313   200006 236100                    LDQ     CG$,,AUTO
         1 001314   000114 036003                    ADLQ    76,DU
         1 001315   200074 756100                    STQ     I$+7,,AUTO
         1 001316   000024 237000 2                  LDAQ    20
         1 001317   200072 757100                    STAQ    I$+5,,AUTO
         1 001320   000001 236000 2                  LDQ     1
         1 001321   200071 756100                    STQ     I$+4,,AUTO
         1 001322   200015 630500                    EPPR0   ENTFLAG,,AUTO
         1 001323   200070 450500                    STP0    I$+3,,AUTO
         1 001324   000026 236000 2                  LDQ     22
         1 001325   200006 235100                    LDA     CG$,,AUTO
         1 001326   200066 757100                    STAQ    I$+1,,AUTO
         1 001327   200066 630500                    EPPR0   I$+1,,AUTO
         1 001330   000025 631400 xsym               EPPR1   B_VECTNIL+21
         1 001331   000000 701000 xent               TSX1    KQZ$LOG
         1 001332   001335 702000 1                  TSX2    D0

      769     9205    3             CG$->KQ$CG.DELMSG$) ALTRET(ZA1);
      770     9206    3             RETURN;

   9206  1 001333   200030 221300                    LDX1  ! END$+1,,AUTO
         1 001334   000001 702211                    TSX2  ! 1,X1

   9202  1 001335                       D0           null
      771     9207    3   ZA1:      END;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:141  
      772     9208    2   D0:     ;
      773     9209                %LOCK (G=CG$->KQ$CG.GATE.MISC);

   9210  1 001335   200006 236100                    LDQ     CG$,,AUTO
         1 001336   000111 036003                    ADLQ    73,DU
         1 001337   200066 756100                    STQ     I$+1,,AUTO
         1 001340   200066 630500                    EPPR0   I$+1,,AUTO
         1 001341   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001342   000000 701000 xent               TSX1    HFC$LOCK
         1 001343   000000 011000                    NOP     0

      774     9212    2           MBLK$=CG$->KQ$CG.DELMSG$;

   9212  1 001344   200006 470500                    LDP0    CG$,,AUTO
         1 001345   000114 236100                    LDQ     76,,PR0
         1 001346   200005 756100                    STQ     MBLK$,,AUTO

      775     9213    2           IF MBLK$ ~= ADDR(NIL) THEN

   9213  1 001347   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001350   001354 600000 1                  TZE     s:9216

      776     9214    2            CG$->KQ$CG.DELMSG$=MBLK$->KQ$MBLK.LNK$;

   9214  1 001351   200005 471500                    LDP1    MBLK$,,AUTO
         1 001352   100000 236100                    LDQ     0,,PR1
         1 001353   000114 756100                    STQ     76,,PR0

      777     9215                %UNLOCK (G=CG$->KQ$CG.GATE.MISC);

   9216  1 001354   200006 236100                    LDQ     CG$,,AUTO
         1 001355   000111 036003                    ADLQ    73,DU
         1 001356   200066 756100                    STQ     I$+1,,AUTO
         1 001357   200066 630500                    EPPR0   I$+1,,AUTO
         1 001360   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 001361   000000 701000 xent               TSX1    HFC$UNLOCK
         1 001362   000000 011000                    NOP     0
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:142  

      778     9218    2           IF MBLK$ = ADDR(NIL) THEN

   9218  1 001363   200005 236100                    LDQ     MBLK$,,AUTO
         1 001364   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001365   001404 601000 1                  TNZ     s:9225

      779     9219    3             DO;

      780     9220    3             IF KQ$GARB.JNLD$ = ADDR(NIL) THEN RETURN;

   9220  1 001366   200006 470500                    LDP0    CG$,,AUTO
         1 001367   000034 236100                    LDQ     28,,PR0
         1 001370   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001371   001374 601000 1                  TNZ     s:9221

   9220  1 001372   200030 221300                    LDX1  ! END$+1,,AUTO
         1 001373   000001 702211                    TSX2  ! 1,X1

      781     9221    3             KQ$GARB.DELJ='1'B;

   9221  1 001374   004000 236003                    LDQ     2048,DU
         1 001375   000032 256100                    ORSQ    26,,PR0

      782     9222    3             MBLK$=KQ$GARB.JNLD$;

   9222  1 001376   000034 236100                    LDQ     28,,PR0
         1 001377   200005 756100                    STQ     MBLK$,,AUTO

      783     9223    3             KQ$GARB.JNLD$=MBLK$->KQ$MBLK.LNK$;

   9223  1 001400   200005 471500                    LDP1    MBLK$,,AUTO
         1 001401   100000 236100                    LDQ     0,,PR1
         1 001402   000034 756100                    STQ     28,,PR0

      784     9224    3             END;

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:143  
   9224  1 001403   001407 710000 1                  TRA     s:9226

      785     9225    2           ELSE KQ$GARB.DELJ='0'B;

   9225  1 001404   200006 470500                    LDP0    CG$,,AUTO
         1 001405   000027 236000 2                  LDQ     23
         1 001406   000032 356100                    ANSQ    26,,PR0

      786     9226    2           KQ$GARB.MBLK$=MBLK$;

   9226  1 001407   200005 236100                    LDQ     MBLK$,,AUTO
         1 001410   000036 756100                    STQ     30,,PR0

      787     9227    2           KQ$GARB.DMIP='1'B;

   9227  1 001411   200000 236003                    LDQ     65536,DU
         1 001412   000032 256100                    ORSQ    26,,PR0

      788     9228        /**/
      789     9229    2           IF MBLK$->KQ$MBLK.SUPER = '0'B THEN

   9229  1 001413   200005 471500                    LDP1    MBLK$,,AUTO
         1 001414   100010 234100                    SZN     8,,PR1
         1 001415   001504 604000 1                  TMI     D10

      790     9230    3             DO;

      791     9231    3             IF MBLK$->KQ$MBLK.DDA = 0 THEN

   9231  1 001416   100006 235100                    LDA     6,,PR1
         1 001417   001452 601000 1                  TNZ     D3

      792     9232    4               DO;

      793     9233    4   D1:         KQ$GARB.DMIP='0'B;

   9233  1 001420   200006 470500       D1           LDP0    CG$,,AUTO
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:144  
         1 001421   000017 236000 2                  LDQ     15
         1 001422   000032 356100                    ANSQ    26,,PR0

      794     9234    4               IF MBLK$->KQ$NRMLMBLK.JRNLD THEN

   9234  1 001423   200005 471500                    LDP1    MBLK$,,AUTO
         1 001424   100010 236100                    LDQ     8,,PR1
         1 001425   040000 316003                    CANQ    16384,DU
         1 001426   001442 600000 1                  TZE     s:9237

      795     9235    4               CALL KCA$TELLAU (CG$->KQ$CG.GORGOSTA$->KQ$STA,%CG_JNLD#,MBLK$->KQ$MBLK)
              9235                         ;

   9235  1 001427   000207 473500                    LDP3    135,,PR0
         1 001430   200005 236100                    LDQ     MBLK$,,AUTO
         1 001431   200070 756100                    STQ     I$+3,,AUTO
         1 001432   000031 236000 2                  LDQ     25
         1 001433   200067 756100                    STQ     I$+2,,AUTO
         1 001434   200066 453500                    STP3    I$+1,,AUTO
         1 001435   200066 630500                    EPPR0   I$+1,,AUTO
         1 001436   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001437   000000 701000 xent               TSX1    KCA$TELLAU
         1 001440   000000 011000                    NOP     0
         1 001441   001446 710000 1                  TRA     s:9238

      796     9236    4               ELSE
      797     9237    4                CALL RELMBLK (MBLK$->KQ$MBLK);

   9237  1 001442   200005 236100                    LDQ     MBLK$,,AUTO
         1 001443   200057 756100                    STQ     F$+1,,AUTO
         1 001444   007545 701000 1                  TSX1    RELMBLK
         1 001445   000000 011000                    NOP     0

      798     9238    4               KQ$GARB.MBLK$=ADDR(NIL);

   9238  1 001446   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 001447   200006 470500                    LDP0    CG$,,AUTO
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:145  
         1 001450   000036 756100                    STQ     30,,PR0

      799     9239    4               GOTO D0;

   9239  1 001451   001335 710000 1                  TRA     D0

      800     9240    4               END;
      801     9241    3   D3:       DBLK$R=MBLK$->KQ$MBLK.STAMP;

   9241  1 001452   200005 470500       D3           LDP0    MBLK$,,AUTO
         1 001453   000001 236100                    LDQ     1,,PR0
         1 001454   777777 376007                    ANQ     -1,DL
         1 001455   200011 756100                    STQ     DBLK$,,AUTO

      802     9242    3             DDA=MBLK$->KQ$MBLK.DDA;

   9242  1 001456   000006 235100                    LDA     6,,PR0
         1 001457   200013 755100                    STA     DDA,,AUTO

      803     9243    3             CALL KQD$DELDDA (CG$->KQ$CG,DBLK$,DDA) ALTRET(D4);

   9243  1 001460   200013 631500                    EPPR1   DDA,,AUTO
         1 001461   200070 451500                    STP1    I$+3,,AUTO
         1 001462   200011 633500                    EPPR3   DBLK$,,AUTO
         1 001463   200067 453500                    STP3    I$+2,,AUTO
         1 001464   200006 236100                    LDQ     CG$,,AUTO
         1 001465   200066 756100                    STQ     I$+1,,AUTO
         1 001466   200066 630500                    EPPR0   I$+1,,AUTO
         1 001467   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001470   000000 701000 xent               TSX1    KQD$DELDDA
         1 001471   001473 702000 1                  TSX2    D4

      804     9244    4               DO WHILE('0'B);

   9244  1 001472   001503 710000 1                  TRA     s:9251

      805     9245    4   D4:         IF DDA=%KQDE_NDFRBLK THEN
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:146  

   9245  1 001473   200013 235100       D4           LDA     DDA,,AUTO
         1 001474   000012 115007                    CMPA    10,DL
         1 001475   001503 601000 1                  TNZ     s:9251

      806     9246    5                 DO;   /* No defer blks; try later */

      807     9247    5                 KQ$GARB.DELAY=KQGD_DMSG0#;

   9247  1 001476   000001 236007                    LDQ     1,DL
         1 001477   200006 470500                    LDP0    CG$,,AUTO
         1 001500   000031 756100                    STQ     25,,PR0

      808     9248    5                 ALTRETURN;

   9248  1 001501   200030 221300                    LDX1  ! END$+1,,AUTO
         1 001502   000000 702211                    TSX2  ! 0,X1

      809     9249    5                 END;
      810     9250    4               END;

      811     9251    3             GOTO D1;

   9251  1 001503   001420 710000 1                  TRA     D1

      812     9252    3             END;
      813     9253        /**/
      814     9254    3   D10:      DO WHILE (MBLK$->KQ$MBLK.INSHD$ ~= ADDR(NIL));

   9254  1 001504   001573 710000 1     D10          TRA     s:9274

      815     9255    3             X$=MBLK$->KQ$MBLK.INSHD$;

   9255  1 001505   200005 470500                    LDP0    MBLK$,,AUTO
         1 001506   000012 236100                    LDQ     10,,PR0
         1 001507   200022 756100                    STQ     X$,,AUTO

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:147  
      816     9256    3             IF X$->KQ$MBLK.DDA ~= 0 THEN

   9256  1 001510   200022 471500                    LDP1    X$,,AUTO
         1 001511   100006 235100                    LDA     6,,PR1
         1 001512   001543 600000 1                  TZE     s:9269

      817     9257    4               DO;

      818     9258    4               DBLK$R=X$->KQ$MBLK.STAMP;

   9258  1 001513   100001 236100                    LDQ     1,,PR1
         1 001514   777777 376007                    ANQ     -1,DL
         1 001515   200011 756100                    STQ     DBLK$,,AUTO

      819     9259    4               DDA=X$->KQ$MBLK.DDA;

   9259  1 001516   100006 235100                    LDA     6,,PR1
         1 001517   200013 755100                    STA     DDA,,AUTO

      820     9260    4               CALL KQD$DELDDA (CG$->KQ$CG,DBLK$,DDA) ALTRET(D14);

   9260  1 001520   200013 633500                    EPPR3   DDA,,AUTO
         1 001521   200070 453500                    STP3    I$+3,,AUTO
         1 001522   200011 634500                    EPPR4   DBLK$,,AUTO
         1 001523   200067 454500                    STP4    I$+2,,AUTO
         1 001524   200006 236100                    LDQ     CG$,,AUTO
         1 001525   200066 756100                    STQ     I$+1,,AUTO
         1 001526   200066 630500                    EPPR0   I$+1,,AUTO
         1 001527   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001530   000000 701000 xent               TSX1    KQD$DELDDA
         1 001531   001533 702000 1                  TSX2    D14

      821     9261    5                 DO WHILE('0'B);

   9261  1 001532   001543 710000 1                  TRA     s:9269

      822     9262    5   D14:          IF DDA = %KQDE_NDFRBLK THEN
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:148  

   9262  1 001533   200013 235100       D14          LDA     DDA,,AUTO
         1 001534   000012 115007                    CMPA    10,DL
         1 001535   001543 601000 1                  TNZ     s:9269

      823     9263    6                   DO; /* No defer blks */

      824     9264    6                   KQ$GARB.DELAY=KQGD_DMSG3#;

   9264  1 001536   000025 236007                    LDQ     21,DL
         1 001537   200006 470500                    LDP0    CG$,,AUTO
         1 001540   000031 756100                    STQ     25,,PR0

      825     9265    6                   ALTRETURN;

   9265  1 001541   200030 221300                    LDX1  ! END$+1,,AUTO
         1 001542   000000 702211                    TSX2  ! 0,X1

      826     9266    6                   END;
      827     9267    5                 END;

      828     9268    4               END;

      829     9269    3             MBLK$->KQ$MBLK.INSHD$=X$->KQ$MBLK.LNK$;

   9269  1 001543   200022 470500                    LDP0    X$,,AUTO
         1 001544   000000 236100                    LDQ     0,,PR0
         1 001545   200005 471500                    LDP1    MBLK$,,AUTO
         1 001546   100012 756100                    STQ     10,,PR1

      830     9270    3             IF X$->KQ$NRMLMBLK.JRNLD THEN

   9270  1 001547   200022 470500                    LDP0    X$,,AUTO
         1 001550   000010 236100                    LDQ     8,,PR0
         1 001551   040000 316003                    CANQ    16384,DU
         1 001552   001567 600000 1                  TZE     s:9273

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:149  
      831     9271    3              CALL KCA$TELLAU (CG$->KQ$CG.GORGOSTA$->KQ$STA,%CG_JNLD#,X$->KQ$MBLK);

   9271  1 001553   200006 473500                    LDP3    CG$,,AUTO
         1 001554   300207 474500                    LDP4    135,,PR3
         1 001555   200022 236100                    LDQ     X$,,AUTO
         1 001556   200070 756100                    STQ     I$+3,,AUTO
         1 001557   000031 236000 2                  LDQ     25
         1 001560   200067 756100                    STQ     I$+2,,AUTO
         1 001561   200066 454500                    STP4    I$+1,,AUTO
         1 001562   200066 630500                    EPPR0   I$+1,,AUTO
         1 001563   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001564   000000 701000 xent               TSX1    KCA$TELLAU
         1 001565   000000 011000                    NOP     0
         1 001566   001573 710000 1                  TRA     s:9274

      832     9272    3             ELSE
      833     9273    3              CALL RELMBLK (X$->KQ$MBLK);

   9273  1 001567   200022 236100                    LDQ     X$,,AUTO
         1 001570   200057 756100                    STQ     F$+1,,AUTO
         1 001571   007545 701000 1                  TSX1    RELMBLK
         1 001572   000000 011000                    NOP     0

      834     9274    3             END D10;

   9274  1 001573   200005 470500                    LDP0    MBLK$,,AUTO
         1 001574   000012 236100                    LDQ     10,,PR0
         1 001575   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 001576   001505 601000 1                  TNZ     s:9255

      835     9275        /**/
      836     9276    2           IF MBLK$->KQ$MBLK.DDA = 0 THEN

   9276  1 001577   000006 235100                    LDA     6,,PR0
         1 001600   001613 601000 1                  TNZ     s:9283

      837     9277    3   D18:      DO;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:150  

   9277  1 001601                       D18          null
      838     9278    3             CALL RELMBLK (MBLK$->KQ$MBLK);

   9278  1 001601   200005 236100                    LDQ     MBLK$,,AUTO
         1 001602   200057 756100                    STQ     F$+1,,AUTO
         1 001603   007545 701000 1                  TSX1    RELMBLK
         1 001604   000000 011000                    NOP     0

      839     9279    3             KQ$GARB.DMIP='0'B;

   9279  1 001605   200006 470500                    LDP0    CG$,,AUTO
         1 001606   000017 236000 2                  LDQ     15
         1 001607   000032 356100                    ANSQ    26,,PR0

      840     9280    3             KQ$GARB.MBLK$=ADDR(NIL);

   9280  1 001610   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 001611   000036 756100                    STQ     30,,PR0

      841     9281    3             GOTO D0;

   9281  1 001612   001335 710000 1                  TRA     D0

      842     9282    3             END;
      843     9283    2           MBLK$->KQ$MBLK.PCDDA=0;

   9283  1 001613   000017 450100                    STZ     15,,PR0

      844     9284    2           MBLK$->KQ$MBLK.CCSTAMP=MBLK$->KQ$MBLK.STAMP;

   9284  1 001614   000001 720100                    LXL0    1,,PR0
         1 001615   000016 440100                    SXL0    14,,PR0

      845     9285    2           IF MBLK$->KQ$MBLK.KEY1VALID = '0'B THEN

   9285  1 001616   000010 236100                    LDQ     8,,PR0
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:151  
         1 001617   020000 316003                    CANQ    8192,DU
         1 001620   001622 601000 1                  TNZ     s:9287

      846     9286    2            MBLK$->KQ$MBLK.SDA.CCDDA=MBLK$->KQ$MBLK.DDA;

   9286  1 001621   000003 755100                    STA     3,,PR0

      847     9287    2           KQ$GARB.INDX=0;

   9287  1 001622   200006 471500                    LDP1    CG$,,AUTO
         1 001623   100033 450100                    STZ     27,,PR1

      848     9288    2   D20:    MBLK$=KQ$GARB.MBLK$;

   9288  1 001624   200006 470500       D20          LDP0    CG$,,AUTO
         1 001625   000036 236100                    LDQ     30,,PR0
         1 001626   200005 756100                    STQ     MBLK$,,AUTO

      849     9289    2           IF MBLK$->KQ$MBLK.KEY1VALID THEN DDA=MBLK$->KQ$MBLK.DDA;

   9289  1 001627   200005 471500                    LDP1    MBLK$,,AUTO
         1 001630   100010 236100                    LDQ     8,,PR1
         1 001631   020000 316003                    CANQ    8192,DU
         1 001632   001636 600000 1                  TZE     s:9290

   9289  1 001633   100006 235100                    LDA     6,,PR1
         1 001634   200013 755100                    STA     DDA,,AUTO
         1 001635   001640 710000 1                  TRA     s:9291

      850     9290    2           ELSE DDA=MBLK$->KQ$MBLK.SDA.CCDDA;

   9290  1 001636   100003 235100                    LDA     3,,PR1
         1 001637   200013 755100                    STA     DDA,,AUTO

      851     9291    2           DBLK$R=MBLK$->KQ$MBLK.CCSTAMP;

   9291  1 001640   100016 236100                    LDQ     14,,PR1
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:152  
         1 001641   777777 376007                    ANQ     -1,DL
         1 001642   200011 756100                    STQ     DBLK$,,AUTO

      852     9292    2           CALL KQD$FETCH (CG$->KQ$CG,DBLK$,DDA) ALTRET(D40);

   9292  1 001643   200013 633500                    EPPR3   DDA,,AUTO
         1 001644   200070 453500                    STP3    I$+3,,AUTO
         1 001645   200011 634500                    EPPR4   DBLK$,,AUTO
         1 001646   200067 454500                    STP4    I$+2,,AUTO
         1 001647   200006 236100                    LDQ     CG$,,AUTO
         1 001650   200066 756100                    STQ     I$+1,,AUTO
         1 001651   200066 630500                    EPPR0   I$+1,,AUTO
         1 001652   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001653   000000 701000 xent               TSX1    KQD$FETCH
         1 001654   002032 702000 1                  TSX2    D40

      853     9293    2   D22:    CALL CHKBLINK ALTRET(D50);

   9293  1 001655   007153 701000 1     D22          TSX1    CHKBLINK
         1 001656   002044 702000 1                  TSX2    D50

      854     9294    2   D23:    IF KQ$GARB.INDX < DBLK$->KQ$DBLK.DSIZE THEN

   9294  1 001657   200006 470500       D23          LDP0    CG$,,AUTO
         1 001660   200011 471500                    LDP1    DBLK$,,AUTO
         1 001661   100000 236100                    LDQ     0,,PR1
         1 001662   777777 376007                    ANQ     -1,DL
         1 001663   000033 116100                    CMPQ    27,,PR0
         1 001664   002007 602000 1                  TNC     s:9322
         1 001665   002007 600000 1                  TZE     s:9322

      855     9295    3             DO;

      856     9296    3             MBLK$=PINCRC(DBLK$,SIZEC(KQ$DBLK)+KQ$GARB.INDX);

   9296  1 001666   000033 236100                    LDQ     27,,PR0
         1 001667   000020 736000                    QLS     16
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:153  
         1 001670   000006 036003                    ADLQ    6,DU
         1 001671   200011 036100                    ADLQ    DBLK$,,AUTO
         1 001672   200005 756100                    STQ     MBLK$,,AUTO

      857     9297    3             MBLK$=PINCRW(MBLK$,CTLBLK$->KQ$MBLK.FIRSTX);

   9297  1 001673   200026 473500                    LDP3    CTLBLK$,,AUTO
         1 001674   300013 720100                    LXL0    11,,PR3
         1 001675   000000 636010                    EAQ     0,X0
         1 001676   200005 036100                    ADLQ    MBLK$,,AUTO
         1 001677   200005 756100                    STQ     MBLK$,,AUTO

      858     9298    3             DDA=MBLK$->KQ$MBLK.DDA;

   9298  1 001700   200005 474500                    LDP4    MBLK$,,AUTO
         1 001701   400006 235100                    LDA     6,,PR4
         1 001702   200013 755100                    STA     DDA,,AUTO

      859     9299    3             IF DDA ~= 0 THEN

   9299  1 001703   001721 600000 1                  TZE     D28

      860     9300    4               DO;

      861     9301    4               STAMP=MBLK$->KQ$MBLK.STAMP;

   9301  1 001704   400001 236100                    LDQ     1,,PR4
         1 001705   777777 376007                    ANQ     -1,DL
         1 001706   200031 756100                    STQ     STAMP,,AUTO

      862     9302    4               CALL KQD$DELDDA (CG$->KQ$CG,STAMP,DDA) ALTRET(D30);

   9302  1 001707   200013 635500                    EPPR5   DDA,,AUTO
         1 001710   200070 455500                    STP5    I$+3,,AUTO
         1 001711   200031 636500                    EPPR6   STAMP,,AUTO
         1 001712   200067 456500                    STP6    I$+2,,AUTO
         1 001713   200006 236100                    LDQ     CG$,,AUTO
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:154  
         1 001714   200066 756100                    STQ     I$+1,,AUTO
         1 001715   200066 630500                    EPPR0   I$+1,,AUTO
         1 001716   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001717   000000 701000 xent               TSX1    KQD$DELDDA
         1 001720   001775 702000 1                  TSX2    D30

      863     9303    4               END;

      864     9304    3   D28:      MBLK$->KQ$MBLK.DDA=0;

   9304  1 001721   200005 470500       D28          LDP0    MBLK$,,AUTO
         1 001722   000006 450100                    STZ     6,,PR0

      865     9305    3             CALL UPDATE;

   9305  1 001723   007471 701000 1                  TSX1    UPDATE
         1 001724   000000 011000                    NOP     0

      866     9306    3             IF MBLK$->KQ$NRMLMBLK.JRNLD THEN

   9306  1 001725   200005 470500                    LDP0    MBLK$,,AUTO
         1 001726   000010 236100                    LDQ     8,,PR0
         1 001727   040000 316003                    CANQ    16384,DU
         1 001730   001770 600000 1                  TZE     s:9314

      867     9307    4               DO;

      868     9308    4               STAMP=SIZEW(KQ$MBLK);

   9308  1 001731   000020 235007                    LDA     16,DL
         1 001732   200031 755100                    STA     STAMP,,AUTO

      869     9309    4               CALL KQM$GETB (CG$->KQ$CG,X$,STAMP) ALTRET(D60);

   9309  1 001733   200031 631500                    EPPR1   STAMP,,AUTO
         1 001734   200070 451500                    STP1    I$+3,,AUTO
         1 001735   200022 633500                    EPPR3   X$,,AUTO
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:155  
         1 001736   200067 453500                    STP3    I$+2,,AUTO
         1 001737   200006 236100                    LDQ     CG$,,AUTO
         1 001740   200066 756100                    STQ     I$+1,,AUTO
         1 001741   200066 630500                    EPPR0   I$+1,,AUTO
         1 001742   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001743   000000 701000 xent               TSX1    KQM$GETB
         1 001744   002075 702000 1                  TSX2    D60

      870     9310    4               X$->KQ$MBLK=MBLK$->KQ$MBLK;

   9310  1 001745   200005 470500                    LDP0    MBLK$,,AUTO
         1 001746   200022 471500                    LDP1    X$,,AUTO
         1 001747   000100 100500                    MLR     fill='000'O
         1 001750   000000 000100                    ADSC9   0,,PR0                   cn=0,n=64
         1 001751   100000 000100                    ADSC9   0,,PR1                   cn=0,n=64

      871     9311    4               CALL KCA$TELLAU (CG$->KQ$CG.GORGOSTA$->KQ$STA,%CG_JNLD#,X$->KQ$MBLK);

   9311  1 001752   200006 471500                    LDP1    CG$,,AUTO
         1 001753   100207 473500                    LDP3    135,,PR1
         1 001754   200022 236100                    LDQ     X$,,AUTO
         1 001755   200070 756100                    STQ     I$+3,,AUTO
         1 001756   000031 236000 2                  LDQ     25
         1 001757   200067 756100                    STQ     I$+2,,AUTO
         1 001760   200066 453500                    STP3    I$+1,,AUTO
         1 001761   200066 630500                    EPPR0   I$+1,,AUTO
         1 001762   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 001763   000000 701000 xent               TSX1    KCA$TELLAU
         1 001764   000000 011000                    NOP     0

      872     9312    4               MBLK$->KQ$NRMLMBLK.JRNLD='0'B;

   9312  1 001765   200005 470500                    LDP0    MBLK$,,AUTO
         1 001766   000032 236000 2                  LDQ     26
         1 001767   000010 356100                    ANSQ    8,,PR0

      873     9313    4               END;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:156  

      874     9314    3             KQ$GARB.INDX=KQ$GARB.INDX+SIZEC(KQ$MBLK);

   9314  1 001770   200006 471500                    LDP1    CG$,,AUTO
         1 001771   100033 235100                    LDA     27,,PR1
         1 001772   000100 035007                    ADLA    64,DL
         1 001773   100033 755100                    STA     27,,PR1

      875     9315    3             GOTO D23;

   9315  1 001774   001657 710000 1                  TRA     D23

      876     9316    3   D30:      IF DDA ~= %KQDE_NDFRBLK THEN GOTO D28; /* Finished */

   9316  1 001775   200013 235100       D30          LDA     DDA,,AUTO
         1 001776   000012 115007                    CMPA    10,DL
         1 001777   001721 601000 1                  TNZ     D28

      877     9317    3             CALL UNLOCK;

   9317  1 002000   007454 701000 1                  TSX1    UNLOCK
         1 002001   000000 011000                    NOP     0

      878     9318                     /* No defer blks: try later */
      879     9319    3   D32:      KQ$GARB.DELAY=KQGD_DMSG1#;

   9319  1 002002   000002 235007       D32          LDA     2,DL
         1 002003   200006 470500                    LDP0    CG$,,AUTO
         1 002004   000031 755100                    STA     25,,PR0

      880     9320    3             ALTRETURN;

   9320  1 002005   200030 221300                    LDX1  ! END$+1,,AUTO
         1 002006   000000 702211                    TSX2  ! 0,X1

      881     9321    3             END;
      882     9322    2           IF DBLK$->KQ$DBLK.FLNKDA ~= 0 THEN
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:157  

   9322  1 002007   100001 235100                    LDA     1,,PR1
         1 002010   002024 600000 1                  TZE     s:9330

      883     9323    3             DO;

      884     9324    3             MBLK$->KQ$MBLK.PCDDA=MBLK$->KQ$MBLK.SDA.CCDDA;

   9324  1 002011   200005 473500                    LDP3    MBLK$,,AUTO
         1 002012   300003 235100                    LDA     3,,PR3
         1 002013   300017 755100                    STA     15,,PR3

      885     9325    3             MBLK$->KQ$MBLK.CCSTAMP=CTLBLK$->KQ$MBLK.CCSTAMP;

   9325  1 002014   200026 474500                    LDP4    CTLBLK$,,AUTO
         1 002015   400016 720100                    LXL0    14,,PR4
         1 002016   300016 440100                    SXL0    14,,PR3

      886     9326    3             MBLK$->KQ$MBLK.SDA.CCDDA=DBLK$->KQ$DBLK.FLNKDA;

   9326  1 002017   100001 235100                    LDA     1,,PR1
         1 002020   300003 755100                    STA     3,,PR3

      887     9327    3             CALL DELETE;

   9327  1 002021   007425 701000 1                  TSX1    DELETE
         1 002022   000000 011000                    NOP     0

      888     9328    3             GOTO D20;

   9328  1 002023   001624 710000 1                  TRA     D20

      889     9329    3             END;
      890     9330    2           CALL DELETE;

   9330  1 002024   007425 701000 1                  TSX1    DELETE
         1 002025   000000 011000                    NOP     0
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:158  

      891     9331    2           MBLK$=KQ$GARB.MBLK$;

   9331  1 002026   200006 470500                    LDP0    CG$,,AUTO
         1 002027   000036 236100                    LDQ     30,,PR0
         1 002030   200005 756100                    STQ     MBLK$,,AUTO

      892     9332    2           GOTO D18;

   9332  1 002031   001601 710000 1                  TRA     D18

      893     9333    2   D40:    IF DBLK$ = ADDR(NIL) THEN

   9333  1 002032   200011 236100       D40          LDQ     DBLK$,,AUTO
         1 002033   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002034   002051 601000 1                  TNZ     s:9343

      894     9334    3             DO CASE (DDA);

   9334  1 002035   200013 235100                    LDA     DDA,,AUTO
         1 002036   000012 135007                    SBLA    10,DL
         1 002037   000001 115007                    CMPA    1,DL
         1 002040   002042 602005 1                  TNC     s:9334+5,AL
         1 002041   002044 710000 1                  TRA     D50
         1 002042   002043 710000 1                  TRA     s:9337

      895     9335
      896     9336    3               CASE (%KQDE_NDFRBLK);

      897     9337    3                 GOTO D32; /* No defer blks */

   9337  1 002043   002002 710000 1                  TRA     D32

      898     9338    3               CASE (ELSE);

      899     9339    3   D50:          MLH$=ADDR(NIL);          /* For DISKERR's use only */

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:159  
   9339  1 002044   000001 236000 xsym  D50          LDQ     B_VECTNIL+1
         1 002045   200014 756100                    STQ     MLH$,,AUTO

      900     9340    3                 CALL DISKERR;

   9340  1 002046   007045 701000 1                  TSX1    DISKERR
         1 002047   000000 011000                    NOP     0

      901     9341    3                 GOTO D18; /* Fetch error */

   9341  1 002050   001601 710000 1                  TRA     D18

      902     9342    3             END;

      903     9343    2           KQ$GARB.DELAY=-KQGD_DMSG2#;

   9343  1 002051   000003 335007                    LCA     3,DL
         1 002052   200006 470500                    LDP0    CG$,,AUTO
         1 002053   000031 755100                    STA     25,,PR0

      904     9344    2           DBLK$->KQ$DFRBLK.INFO$=CG$;

   9344  1 002054   200006 236100                    LDQ     CG$,,AUTO
         1 002055   200011 471500                    LDP1    DBLK$,,AUTO
         1 002056   100006 756100                    STQ     6,,PR1

      905     9345    2           CALL KQD$DEFERGO (CG$->KQ$CG,DBLK$,ENTADDR(KQS$FCONT));

   9345  1 002057   000565 636000 1                  EAQ     s:8780
         1 002060   200066 756100                    STQ     I$+1,,AUTO
         1 002061   200066 631500                    EPPR1   I$+1,,AUTO
         1 002062   200071 451500                    STP1    I$+4,,AUTO
         1 002063   200011 633500                    EPPR3   DBLK$,,AUTO
         1 002064   200070 453500                    STP3    I$+3,,AUTO
         1 002065   200006 236100                    LDQ     CG$,,AUTO
         1 002066   200067 756100                    STQ     I$+2,,AUTO
         1 002067   200067 630500                    EPPR0   I$+2,,AUTO
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:160  
         1 002070   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 002071   000000 701000 xent               TSX1    KQD$DEFERGO
         1 002072   000000 011000                    NOP     0

      906     9346    2           ALTRETURN;

   9346  1 002073   200030 221300                    LDX1  ! END$+1,,AUTO
         1 002074   000000 702211                    TSX2  ! 0,X1

      907     9347    2   D60:    CALL UNLOCK;

   9347  1 002075   007454 701000 1     D60          TSX1    UNLOCK
         1 002076   000000 011000                    NOP     0

      908     9348    2           MBLK$=KQ$GARB.MBLK$;

   9348  1 002077   200006 470500                    LDP0    CG$,,AUTO
         1 002100   000036 236100                    LDQ     30,,PR0
         1 002101   200005 756100                    STQ     MBLK$,,AUTO

      909     9349    2           MBLK$->KQ$MBLK.LNK$=KQ$GARB.JNLD$;

   9349  1 002102   000034 236100                    LDQ     28,,PR0
         1 002103   200005 471500                    LDP1    MBLK$,,AUTO
         1 002104   100000 756100                    STQ     0,,PR1

      910     9350    2           KQ$GARB.JNLD$=MBLK$;

   9350  1 002105   200005 236100                    LDQ     MBLK$,,AUTO
         1 002106   000034 756100                    STQ     28,,PR0

      911     9351    2           KQ$GARB.MBLK$=ADDR(NIL);

   9351  1 002107   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 002110   000036 756100                    STQ     30,,PR0

      912     9352    2           KQ$GARB.DMIP='0'B;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:161  

   9352  1 002111   000017 236000 2                  LDQ     15
         1 002112   000032 356100                    ANSQ    26,,PR0

      913     9353    2           IF KQ$GARB.DELJ THEN RETURN;

   9353  1 002113   000032 236100                    LDQ     26,,PR0
         1 002114   004000 316003                    CANQ    2048,DU
         1 002115   002120 600000 1                  TZE     s:9354

   9353  1 002116   200030 221300                    LDX1  ! END$+1,,AUTO
         1 002117   000001 702211                    TSX2  ! 1,X1

      914     9354    2           GOTO D0;

   9354  1 002120   001335 710000 1                  TRA     D0

      915     9355        /**/
      916     9356    2   CDELMSG0: ENTRY ALTRET;

   9356  1 002121   200030 741300       CDELMSG0     STX1  ! END$+1,,AUTO

      917     9357    2           MBLK$=KQ$GARB.MBLK$;

   9357  1 002122   200006 470500                    LDP0    CG$,,AUTO
         1 002123   000036 236100                    LDQ     30,,PR0
         1 002124   200005 756100                    STQ     MBLK$,,AUTO

      918     9358    2           GOTO D3;

   9358  1 002125   001452 710000 1                  TRA     D3

      919     9359    2   CDELMSG1: ENTRY ALTRET;

   9359  1 002126   200030 741300       CDELMSG1     STX1  ! END$+1,,AUTO

      920     9360    2           MBLK$=KQ$GARB.MBLK$;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:162  

   9360  1 002127   200006 470500                    LDP0    CG$,,AUTO
         1 002130   000036 236100                    LDQ     30,,PR0
         1 002131   200005 756100                    STQ     MBLK$,,AUTO

      921     9361    2           GOTO D20;

   9361  1 002132   001624 710000 1                  TRA     D20

      922     9362    2   CDELMSG2: ENTRY ALTRET;

   9362  1 002133   200030 741300       CDELMSG2     STX1  ! END$+1,,AUTO

      923     9363    2           MBLK$=KQ$GARB.MBLK$;

   9363  1 002134   200006 470500                    LDP0    CG$,,AUTO
         1 002135   000036 236100                    LDQ     30,,PR0
         1 002136   200005 756100                    STQ     MBLK$,,AUTO

      924     9364    2           IF DBLK$ = ADDR(NIL) THEN GOTO D1;

   9364  1 002137   200011 236100                    LDQ     DBLK$,,AUTO
         1 002140   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002141   001420 600000 1                  TZE     D1

      925     9365    2           GOTO D22;

   9365  1 002142   001655 710000 1                  TRA     D22

      926     9366    2   CDELMSG3: ENTRY ALTRET;

   9366  1 002143   200030 741300       CDELMSG3     STX1  ! END$+1,,AUTO

      927     9367    2           MBLK$=KQ$GARB.MBLK$;

   9367  1 002144   200006 470500                    LDP0    CG$,,AUTO
         1 002145   000036 236100                    LDQ     30,,PR0
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:163  
         1 002146   200005 756100                    STQ     MBLK$,,AUTO

      928     9368    2           GOTO D10;

   9368  1 002147   001504 710000 1                  TRA     D10

      929     9369    2   END DODELMSG;
      930     9370        /********************************************************
      931     9371        *********************************************************/
      932     9372        /**/
      933     9373        /*D* NAME:         DOQ
      934     9374             PURPOSE:      To squish messages in the queue to disk
      935     9375             DESCRIPTION:  All Q-tree nodes are examined and squished
      936     9376                           if appropriate.
      937     9377        */
      938     9378    1   DOQ:    PROC ALTRET;

   9378  1 002150   200030 741300       DOQ          STX1  ! END$+1,,AUTO

      939     9379            %LOCK (G=KQ$QTREE.GATE);

   9380  1 002151   200006 470500                    LDP0    CG$,,AUTO
         1 002152   000057 471500                    LDP1    47,,PR0
         1 002153   200066 451500                    STP1    I$+1,,AUTO
         1 002154   200066 630500                    EPPR0   I$+1,,AUTO
         1 002155   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002156   000000 701000 xent               TSX1    HFC$LOCK
         1 002157   000000 011000                    NOP     0

      940     9382    2           KQ$QUEUE.GACT='1'B;

   9382  1 002160   200006 470500                    LDP0    CG$,,AUTO
         1 002161   000040 236003                    LDQ     32,DU
         1 002162   000063 256100                    ORSQ    51,,PR0

      941     9383    2           IF KQ$QUEUE.BUSY THEN

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:164  
   9383  1 002163   000063 236100                    LDQ     51,,PR0
         1 002164   000600 316003                    CANQ    384,DU
         1 002165   002211 600000 1                  TZE     s:9396

      942     9384    2            IF KQ$QUEUE.BUSY.GIP THEN CALL SC_CGGARB;

   9384  1 002166   000200 316003                    CANQ    128,DU
         1 002167   002173 600000 1                  TZE     s:9386

   9384  1 002170   000000 713400 xsym               CLIMB   SC_CGGARB
         1 002171   000000 600000 xsid               climb   nvectors=         0
         1 002172   002211 710000 1                  TRA     s:9396

      943     9385    2            ELSE
      944     9386    2             IF  KQ$QUEUE.RQMEM = '0'B

   9386  1 002173   000020 316003                    CANQ    16,DU
         1 002174   002211 601000 1                  TNZ     s:9396
         1 002175   000010 316003                    CANQ    8,DU
         1 002176   002211 601000 1                  TNZ     s:9396

      945     9387    2             AND KQ$QUEUE.RQGC = '0'B THEN
      946     9388    3               DO;

      947     9389    3               KQ$GARB.DELAY=-KQGD_QRDWT#;

   9389  1 002177   000026 335007                    LCA     22,DL
         1 002200   000031 755100                    STA     25,,PR0

      948     9390                    %UNLOCK (G=KQ$QTREE.GATE);

   9391  1 002201   000057 471500                    LDP1    47,,PR0
         1 002202   200066 451500                    STP1    I$+1,,AUTO
         1 002203   200066 630500                    EPPR0   I$+1,,AUTO
         1 002204   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002205   000000 701000 xent               TSX1    HFC$UNLOCK
         1 002206   000000 011000                    NOP     0
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:165  

      949     9393    3               ALTRETURN;

   9393  1 002207   200030 221300                    LDX1  ! END$+1,,AUTO
         1 002210   000000 702211                    TSX2  ! 0,X1

      950     9394    3               END;
      951     9395        /**/
      952     9396    2           KQ$QUEUE.BUSY.GIP='1'B;

   9396  1 002211   200006 470500                    LDP0    CG$,,AUTO
         1 002212   000200 236003                    LDQ     128,DU
         1 002213   000063 256100                    ORSQ    51,,PR0

      953     9397    2   D0:     KQ$GARB.ACTCNT=KQ$QTREE.ACTCNT;

   9397  1 002214   200006 470500       D0           LDP0    CG$,,AUTO
         1 002215   000057 471500                    LDP1    47,,PR0
         1 002216   100005 220100                    LDX0    5,,PR1
         1 002217   000032 440100                    SXL0    26,,PR0

      954     9398    2           QTN$=KQ$QUEUE.PLHD$;

   9398  1 002220   000061 236100                    LDQ     49,,PR0
         1 002221   200024 756100                    STQ     QTN$,,AUTO

      955     9399    3             DO WHILE (QTN$ ~= ADDR(NIL));

   9399  1 002222   002344 710000 1                  TRA     D11

      956     9400    3             IF KQ$GARB.TYPE ~= KQGT_COAZ#

   9400  1 002223   200006 470500                    LDP0    CG$,,AUTO
         1 002224   000032 236100                    LDQ     26,,PR0
         1 002225   000777 376003                    ANQ     511,DU
         1 002226   000001 116003                    CMPQ    1,DU
         1 002227   002233 601000 1                  TNZ     s:9402
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:166  
         1 002230   200024 471500                    LDP1    QTN$,,AUTO
         1 002231   100044 235100                    LDA     36,,PR1
         1 002232   002341 601000 1                  TNZ     s:9433

      957     9401    3             OR QTN$->KQ$QTN.CNACT = 0 THEN
      958     9402    3              IF QTN$->KQ$QTN.MLH.COUNT > 1 THEN

   9402  1 002233   200024 471500                    LDP1    QTN$,,AUTO
         1 002234   100062 235100                    LDA     50,,PR1
         1 002235   000001 115007                    CMPA    1,DL
         1 002236   002305 604400 1                  TMOZ    s:9417

      959     9403    4                DO;

      960     9404    4                KQ$GARB.OMLH$=QTN$;

   9404  1 002237   200024 236100                    LDQ     QTN$,,AUTO
         1 002240   000037 756100                    STQ     31,,PR0

      961     9405    4                QTN$->KQ$QTN.LOCKCNT=QTN$->KQ$QTN.LOCKCNT+1;

   9405  1 002241   100050 236100                    LDQ     40,,PR1
         1 002242   000033 772000                    QRL     27
         1 002243   000177 376007                    ANQ     127,DL
         1 002244   000001 036007                    ADLQ    1,DL
         1 002245   000033 736000                    QLS     27
         1 002246   100050 676100                    ERQ     40,,PR1
         1 002247   177000 376003                    ANQ     65024,DU
         1 002250   100050 656100                    ERSQ    40,,PR1

      962     9406                     %UNLOCK (G=KQ$QTREE.GATE);

   9407  1 002251   000057 473500                    LDP3    47,,PR0
         1 002252   200066 453500                    STP3    I$+1,,AUTO
         1 002253   200066 630500                    EPPR0   I$+1,,AUTO
         1 002254   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002255   000000 701000 xent               TSX1    HFC$UNLOCK
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:167  
         1 002256   000000 011000                    NOP     0

      963     9409    4                KQ$GARB.STA='0'B;

   9409  1 002257   200006 470500                    LDP0    CG$,,AUTO
         1 002260   000031 236000 xsym               LDQ     B_VECTNIL+25
         1 002261   000032 356100                    ANSQ    26,,PR0

      964     9410    4                CALL KQS$SQUISH (CG$->KQ$CG) ALTRET(ALTRT);

   9410  1 002262   200006 630500                    EPPR0   CG$,,AUTO
         1 002263   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002264   002732 701000 1                  TSX1    s:9589
         1 002265   002443 702000 1                  TSX2    ALTRT

      965     9411    4   D1:          QTN$=KQ$GARB.OMLH$;

   9411  1 002266   200006 470500       D1           LDP0    CG$,,AUTO
         1 002267   000037 236100                    LDQ     31,,PR0
         1 002270   200024 756100                    STQ     QTN$,,AUTO

      966     9412                     %LOCK (G=KQ$QTREE.GATE);

   9413  1 002271   000057 471500                    LDP1    47,,PR0
         1 002272   200066 451500                    STP1    I$+1,,AUTO
         1 002273   200066 630500                    EPPR0   I$+1,,AUTO
         1 002274   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002275   000000 701000 xent               TSX1    HFC$LOCK
         1 002276   000000 011000                    NOP     0

      967     9415    4                IF KQ$GARB.ACTCNT ~= KQ$QTREE.ACTCNT THEN GOTO D0;

   9415  1 002277   200006 470500                    LDP0    CG$,,AUTO
         1 002300   000057 471500                    LDP1    47,,PR0
         1 002301   000032 720100                    LXL0    26,,PR0
         1 002302   100005 100100                    CMPX0   5,,PR1
         1 002303   002214 601000 1                  TNZ     D0
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:168  

      968     9416    4                END;

   9416  1 002304   002341 710000 1                  TRA     s:9433

      969     9417    3              ELSE IF QTN$->KQ$QTN.MLH.COUNT = 0 THEN

   9417  1 002305   000000 115003                    CMPA    0,DU
         1 002306   002341 601000 1                  TNZ     s:9433

      970     9418    3                IF  QTN$->KQ$QTN.CNACT = 0

   9418  1 002307   100044 235100                    LDA     36,,PR1
         1 002310   002341 601000 1                  TNZ     s:9433
         1 002311   100046 236100                    LDQ     38,,PR1
         1 002312   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002313   002341 601000 1                  TNZ     s:9433
         1 002314   100050 236100                    LDQ     40,,PR1
         1 002315   177000 316003                    CANQ    65024,DU
         1 002316   002341 601000 1                  TNZ     s:9433

      971     9419    3                AND QTN$->KQ$QTN.READS$ = ADDR(NIL)
      972     9420    3                AND QTN$->KQ$QTN.LOCKCNT = 0 THEN
      973     9421    4                  DO;

      974     9422    4                  IF NOT CG$->KQ$CG.QISS THEN

   9422  1 002317   000106 235100                    LDA     70,,PR0
         1 002320   002341 601000 1                  TNZ     s:9433

      975     9423    5                    DO;

      976     9424    5                    IF NOT QTN$->KQ$MTYP.PERM THEN

   9424  1 002321   100007 236100                    LDQ     7,,PR1
         1 002322   000040 316003                    CANQ    32,DU
         1 002323   002341 601000 1                  TNZ     s:9433
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:169  

      977     9425    6                      DO;

      978     9426    6                      X$=QTN$->KQ$QTN.PLINK$;

   9426  1 002324   100047 236100                    LDQ     39,,PR1
         1 002325   200022 756100                    STQ     X$,,AUTO

      979     9427    6                      CALL KQT$DELTYP (CG$->KQ$CG,QTN$);

   9427  1 002326   200024 633500                    EPPR3   QTN$,,AUTO
         1 002327   200067 453500                    STP3    I$+2,,AUTO
         1 002330   200006 236100                    LDQ     CG$,,AUTO
         1 002331   200066 756100                    STQ     I$+1,,AUTO
         1 002332   200066 630500                    EPPR0   I$+1,,AUTO
         1 002333   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 002334   000000 701000 xent               TSX1    KQT$DELTYP
         1 002335   000000 011000                    NOP     0

      980     9428    6                      QTN$=X$;

   9428  1 002336   200022 236100                    LDQ     X$,,AUTO
         1 002337   200024 756100                    STQ     QTN$,,AUTO

      981     9429    6                      GOTO D11;

   9429  1 002340   002344 710000 1                  TRA     D11

      982     9430    6                      END;
      983     9431    5                    END;
      984     9432    4                  END;
      985     9433    3             QTN$=QTN$->KQ$QTN.PLINK$;

   9433  1 002341   200024 471500                    LDP1    QTN$,,AUTO
         1 002342   100047 236100                    LDQ     39,,PR1
         1 002343   200024 756100                    STQ     QTN$,,AUTO

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:170  
      986     9434    3   D11:      END;

   9434  1 002344   000001 116000 xsym  D11          CMPQ    B_VECTNIL+1
         1 002345   002223 601000 1                  TNZ     s:9400

   9433  1 002346                       D2           null
      987     9435        /**/
      988     9436    2   D2:     ;
      989     9437    2           IF KQ$QUEUE.BUSY.RIP THEN

   9437  1 002346   200006 470500                    LDP0    CG$,,AUTO
         1 002347   000063 236100                    LDQ     51,,PR0
         1 002350   000400 316003                    CANQ    256,DU
         1 002351   002435 600000 1                  TZE     s:9464

      990     9438    3             DO;

      991     9439    3             IF KQ$QUEUE.RQGC THEN

   9439  1 002352   000010 316003                    CANQ    8,DU
         1 002353   002415 600000 1                  TZE     s:9454

      992     9440    4               DO;

      993     9441    4               MLH$=KQ$QUEUE.MLH$;

   9441  1 002354   000065 236100                    LDQ     53,,PR0
         1 002355   200014 756100                    STQ     MLH$,,AUTO

      994     9442    4               CALL GETQM;

   9442  1 002356   007263 701000 1                  TSX1    GETQM
         1 002357   000000 011000                    NOP     0

      995     9443    4               KQ$QUEUE.RQGC='0'B;

   9443  1 002360   200006 470500                    LDP0    CG$,,AUTO
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:171  
         1 002361   000002 236000 2                  LDQ     2
         1 002362   000063 356100                    ANSQ    51,,PR0

      996     9444    4               IF MBLK$->KQ$MBLK.USR = '0'B

   9444  1 002363   200005 471500                    LDP1    MBLK$,,AUTO
         1 002364   100010 236100                    LDQ     8,,PR1
         1 002365   010000 316003                    CANQ    4096,DU
         1 002366   002373 600000 1                  TZE     s:9446
         1 002367   000063 236100                    LDQ     51,,PR0
         1 002370   000033 772000                    QRL     27
         1 002371   100013 116100                    CMPQ    11,,PR1
         1 002372   002375 600000 1                  TZE     s:9447

      997     9445    4               OR MBLK$->KQ$MBLK.USR# ~= KQ$QUEUE.RUSR# THEN
      998     9446    4                CALL SC_CGGARB;

   9446  1 002373   000000 713400 xsym               CLIMB   SC_CGGARB
         1 002374   000000 600000 xsid               climb   nvectors=         0

      999     9447    4               KQ$QUEUE.BUSY.GIP='0'B;

   9447  1 002375   200006 470500                    LDP0    CG$,,AUTO
         1 002376   000033 236000 2                  LDQ     27
         1 002377   000063 356100                    ANSQ    51,,PR0

     1000     9448    4               KQ$QUEUE.GACT='0'B;

   9448  1 002400   000022 236000 2                  LDQ     18
         1 002401   000063 356100                    ANSQ    51,,PR0

     1001     9449                    %UNLOCK (G=KQ$QTREE.GATE);

   9450  1 002402   000057 471500                    LDP1    47,,PR0
         1 002403   200066 451500                    STP1    I$+1,,AUTO
         1 002404   200066 630500                    EPPR0   I$+1,,AUTO
         1 002405   000017 631400 xsym               EPPR1   B_VECTNIL+15
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:172  
         1 002406   000000 701000 xent               TSX1    HFC$UNLOCK
         1 002407   000000 011000                    NOP     0

     1002     9452    4               CALL KQL$SRQ (MBLK$->KQ$MBLK);

   9452  1 002410   200005 630500                    EPPR0   MBLK$,,AUTO
         1 002411   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002412   000000 701000 xent               TSX1    KQL$SRQ
         1 002413   000000 011000                    NOP     0

     1003     9453    4               END;

   9453  1 002414   002441 710000 1                  TRA     s:9465

     1004     9454    3             ELSE IF KQ$QUEUE.RQMEM THEN

   9454  1 002415   000020 316003                    CANQ    16,DU
         1 002416   002432 600000 1                  TZE     s:9462

     1005     9455    4                DO;

     1006     9456    4                KQ$QUEUE.BUSY.GIP='0'B;

   9456  1 002417   000033 236000 2                  LDQ     27
         1 002420   000063 356100                    ANSQ    51,,PR0

     1007     9457    4                KQ$QUEUE.GACT='0'B;

   9457  1 002421   000022 236000 2                  LDQ     18
         1 002422   000063 356100                    ANSQ    51,,PR0

     1008     9458                     %UNLOCK (G=KQ$QTREE.GATE);

   9459  1 002423   000057 471500                    LDP1    47,,PR0
         1 002424   200066 451500                    STP1    I$+1,,AUTO
         1 002425   200066 630500                    EPPR0   I$+1,,AUTO
         1 002426   000017 631400 xsym               EPPR1   B_VECTNIL+15
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:173  
         1 002427   000000 701000 xent               TSX1    HFC$UNLOCK
         1 002430   000000 011000                    NOP     0

     1009     9461    4                END;

   9461  1 002431   002441 710000 1                  TRA     s:9465

     1010     9462    3              ELSE CALL SC_CGGARB;

   9462  1 002432   000000 713400 xsym               CLIMB   SC_CGGARB
         1 002433   000000 600000 xsid               climb   nvectors=         0

     1011     9463    3             END;

   9463  1 002434   002441 710000 1                  TRA     s:9465

     1012     9464    2           ELSE CALL KQL$GARBDUNQ (CG$->KQ$CG);

   9464  1 002435   200006 630500                    EPPR0   CG$,,AUTO
         1 002436   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002437   000000 701000 xent               TSX1    KQL$GARBDUNQ
         1 002440   000000 011000                    NOP     0

     1013     9465    2           RETURN;

   9465  1 002441   200030 221300                    LDX1  ! END$+1,,AUTO
         1 002442   000001 702211                    TSX2  ! 1,X1

     1014     9466    2   ALTRT:  ALTRETURN;

   9466  1 002443   200030 221300       ALTRT        LDX1  ! END$+1,,AUTO
         1 002444   000000 702211                    TSX2  ! 0,X1

     1015     9467        /**/
     1016     9468    2   DOT:    ENTRY ALTRET; /* !!Doesn't ALTRET!! */

   9468  1 002445   200030 741300       DOT          STX1  ! END$+1,,AUTO
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:174  

     1017     9469        /**/
     1018     9470                %LOCK (G=KQ$TTREE.GATE);

   9471  1 002446   200006 236100                    LDQ     CG$,,AUTO
         1 002447   000067 036003                    ADLQ    55,DU
         1 002450   200066 756100                    STQ     I$+1,,AUTO
         1 002451   200066 630500                    EPPR0   I$+1,,AUTO
         1 002452   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002453   000000 701000 xent               TSX1    HFC$LOCK
         1 002454   000000 011000                    NOP     0

     1019     9473    2           QTN$=KQ$TTREE.HEAD$;

   9473  1 002455   200006 470500                    LDP0    CG$,,AUTO
         1 002456   000073 236100                    LDQ     59,,PR0
         1 002457   200024 756100                    STQ     QTN$,,AUTO

     1020     9474    3             DO WHILE (QTN$ ~= ADDR(NIL));

   9474  1 002460   002504 710000 1                  TRA     s:9482

     1021     9475    3             IF NOT QTN$->KQ$MTYP.PERM THEN

   9475  1 002461   200024 470500                    LDP0    QTN$,,AUTO
         1 002462   000007 236100                    LDQ     7,,PR0
         1 002463   000040 316003                    CANQ    32,DU
         1 002464   002502 601000 1                  TNZ     s:9481

     1022     9476    4               DO;

     1023     9477    4               X$=QTN$->KQ$MTYP.BTN.FLINK$;

   9477  1 002465   000004 236100                    LDQ     4,,PR0
         1 002466   200022 756100                    STQ     X$,,AUTO

     1024     9478    4               CALL KQT$DELTYP (CG$->KQ$CG,QTN$);
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:175  

   9478  1 002467   200024 631500                    EPPR1   QTN$,,AUTO
         1 002470   200067 451500                    STP1    I$+2,,AUTO
         1 002471   200006 236100                    LDQ     CG$,,AUTO
         1 002472   200066 756100                    STQ     I$+1,,AUTO
         1 002473   200066 630500                    EPPR0   I$+1,,AUTO
         1 002474   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 002475   000000 701000 xent               TSX1    KQT$DELTYP
         1 002476   000000 011000                    NOP     0

     1025     9479    4               QTN$=X$;

   9479  1 002477   200022 236100                    LDQ     X$,,AUTO
         1 002500   200024 756100                    STQ     QTN$,,AUTO

     1026     9480    4               END;

   9480  1 002501   002504 710000 1                  TRA     s:9482

     1027     9481    3             ELSE QTN$=QTN$->KQ$MTYP.BTN.FLINK$;

   9481  1 002502   000004 236100                    LDQ     4,,PR0
         1 002503   200024 756100                    STQ     QTN$,,AUTO

     1028     9482    3             END;

   9482  1 002504   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002505   002461 601000 1                  TNZ     s:9475

     1029     9483                %UNLOCK (G=KQ$TTREE.GATE);

   9484  1 002506   200006 236100                    LDQ     CG$,,AUTO
         1 002507   000067 036003                    ADLQ    55,DU
         1 002510   200066 756100                    STQ     I$+1,,AUTO
         1 002511   200066 630500                    EPPR0   I$+1,,AUTO
         1 002512   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002513   000000 701000 xent               TSX1    HFC$UNLOCK
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:176  
         1 002514   000000 011000                    NOP     0

     1030     9486    2           RETURN;

   9486  1 002515   200030 221300                    LDX1  ! END$+1,,AUTO
         1 002516   000001 702211                    TSX2  ! 1,X1

     1031     9487        /**/
     1032     9488    2   DOQ0:   ENTRY ALTRET;

   9488  1 002517   200030 741300       DOQ0         STX1  ! END$+1,,AUTO

     1033     9489    2           GOTO D1;

   9489  1 002520   002266 710000 1                  TRA     D1

     1034     9490    2   DOQ0F:  ENTRY ALTRET;

   9490  1 002521   200030 741300       DOQ0F        STX1  ! END$+1,,AUTO

     1035     9491                %LOCK (G=KQ$QTREE.GATE);

   9492  1 002522   200006 470500                    LDP0    CG$,,AUTO
         1 002523   000057 471500                    LDP1    47,,PR0
         1 002524   200066 451500                    STP1    I$+1,,AUTO
         1 002525   200066 630500                    EPPR0   I$+1,,AUTO
         1 002526   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002527   000000 701000 xent               TSX1    HFC$LOCK
         1 002530   000000 011000                    NOP     0

     1036     9494    2           GOTO D2;

   9494  1 002531   002346 710000 1                  TRA     D2

     1037     9495    2   DOQ1:   ENTRY ALTRET;

   9495  1 002532   200030 741300       DOQ1         STX1  ! END$+1,,AUTO
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:177  

     1038     9496                %LOCK (G=KQ$QTREE.GATE);

   9497  1 002533   200006 470500                    LDP0    CG$,,AUTO
         1 002534   000057 471500                    LDP1    47,,PR0
         1 002535   200066 451500                    STP1    I$+1,,AUTO
         1 002536   200066 630500                    EPPR0   I$+1,,AUTO
         1 002537   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002540   000000 701000 xent               TSX1    HFC$LOCK
         1 002541   000000 011000                    NOP     0

     1039     9499    2           GOTO D0;

   9499  1 002542   002214 710000 1                  TRA     D0

     1040     9500    2   END DOQ;
     1041     9501        /********************************************************
     1042     9502        *********************************************************/
     1043     9503        /**/
     1044     9504        /*D* NAME:         DOS
     1045     9505             PURPOSE:      To squish directed messages to disk
     1046     9506             DESCRIPTION:  SOFT says whether (0) or not (1) to squish
     1047     9507                           messages at active stations.
     1048     9508                           All stations are examined and squished
     1049     9509                           if appropriate.
     1050     9510        */
     1051     9511    1   DOS:    PROC ALTRET;

   9511  1 002543   200030 741300       DOS          STX1  ! END$+1,,AUTO

     1052     9512            %LOCK (G=KQ$STREE.GATE);

   9513  1 002544   200006 236100                    LDQ     CG$,,AUTO
         1 002545   000075 036003                    ADLQ    61,DU
         1 002546   200066 756100                    STQ     I$+1,,AUTO
         1 002547   200066 630500                    EPPR0   I$+1,,AUTO
         1 002550   000017 631400 xsym               EPPR1   B_VECTNIL+15
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:178  
         1 002551   000000 701000 xent               TSX1    HFC$LOCK
         1 002552   000000 011000                    NOP     0

     1053     9515    2   D0:     KQ$GARB.ACTCNT=KQ$STREE.ACTCNT;

   9515  1 002553   200006 470500       D0           LDP0    CG$,,AUTO
         1 002554   000102 220100                    LDX0    66,,PR0
         1 002555   000032 440100                    SXL0    26,,PR0

     1054     9516    2           STA$=KQ$STREE.HEAD$;

   9516  1 002556   000101 236100                    LDQ     65,,PR0
         1 002557   200004 756100                    STQ     STA$,,AUTO

     1055     9517    3             DO WHILE (STA$ ~= ADDR(NIL));

   9517  1 002560   002713 710000 1                  TRA     s:9556

     1056     9518    3             IF KQ$GARB.TYPE ~= KQGT_COAZ#

   9518  1 002561   200006 470500                    LDP0    CG$,,AUTO
         1 002562   000032 236100                    LDQ     26,,PR0
         1 002563   000777 376003                    ANQ     511,DU
         1 002564   000001 116003                    CMPQ    1,DU
         1 002565   002572 601000 1                  TNZ     s:9520
         1 002566   200004 471500                    LDP1    STA$,,AUTO
         1 002567   100010 236100                    LDQ     8,,PR1
         1 002570   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002571   002710 601000 1                  TNZ     s:9555

     1057     9519    3             OR STA$->KQ$STA.LDCT$ = ADDR(NIL) THEN
     1058     9520    3              IF NOT STA$->KQ$STA.MONDCB THEN

   9520  1 002572   200004 471500                    LDP1    STA$,,AUTO
         1 002573   100020 236100                    LDQ     16,,PR1
         1 002574   100000 316003                    CANQ    32768,DU
         1 002575   002710 601000 1                  TNZ     s:9555
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:179  

     1059     9521    4   D01:         DO;

   9521  1 002576                       D01          null
     1060     9522                     %LOCK (G=STA$->KQ$STA.GATE);

   9523  1 002576   200004 236100                    LDQ     STA$,,AUTO
         1 002577   000016 036003                    ADLQ    14,DU
         1 002600   200066 756100                    STQ     I$+1,,AUTO
         1 002601   200066 630500                    EPPR0   I$+1,,AUTO
         1 002602   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002603   000000 701000 xent               TSX1    HFC$LOCK
         1 002604   000000 011000                    NOP     0

     1061     9525    4                IF NOT STA$->KQ$STA.IDSC THEN

   9525  1 002605   200004 470500                    LDP0    STA$,,AUTO
         1 002606   000020 234100                    SZN     16,,PR0
         1 002607   002624 604000 1                  TMI     s:9530

     1062     9526    5                  DO;

     1063     9527    5                  IF STA$->KQ$STA.TERM THEN CALL KQG$TRUNC (STA$->KQ$STA);

   9527  1 002610   000020 236100                    LDQ     16,,PR0
         1 002611   040000 316003                    CANQ    16384,DU
         1 002612   002620 600000 1                  TZE     s:9528

   9527  1 002613   200004 630500                    EPPR0   STA$,,AUTO
         1 002614   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002615   000000 701000 xent               TSX1    KQG$TRUNC
         1 002616   000000 011000                    NOP     0
         1 002617   002624 710000 1                  TRA     s:9530

     1064     9528    5                  ELSE CALL KQR$TRUNC (STA$->KQ$STA);

   9528  1 002620   200004 630500                    EPPR0   STA$,,AUTO
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:180  
         1 002621   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002622   000000 701000 xent               TSX1    KQR$TRUNC
         1 002623   000000 011000                    NOP     0

     1065     9529    5                  END;

     1066     9530    4                IF STA$->KQ$STA.MLH.COUNT = 0 THEN

   9530  1 002624   200004 470500                    LDP0    STA$,,AUTO
         1 002625   000041 235100                    LDA     33,,PR0
         1 002626   002637 601000 1                  TNZ     D02

     1067     9531    5                  DO;

     1068     9532                       %UNLOCK (G=STA$->KQ$STA.GATE);

   9533  1 002627   200004 236100                    LDQ     STA$,,AUTO
         1 002630   000016 036003                    ADLQ    14,DU
         1 002631   200066 756100                    STQ     I$+1,,AUTO
         1 002632   200066 630500                    EPPR0   I$+1,,AUTO
         1 002633   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002634   000000 701000 xent               TSX1    HFC$UNLOCK
         1 002635   000000 011000                    NOP     0

     1069     9535    5                  END;

   9535  1 002636   002710 710000 1                  TRA     s:9555

     1070     9536    4                ELSE
     1071     9537    5   D02:           DO;

   9537  1 002637                       D02          null
     1072     9538    5                  KQ$GARB.OMLH$=STA$;

   9538  1 002637   200004 236100                    LDQ     STA$,,AUTO
         1 002640   200006 471500                    LDP1    CG$,,AUTO
         1 002641   100037 756100                    STQ     31,,PR1
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:181  

     1073     9539    5                  STA$->KQ$STA.LOCKCNT=STA$->KQ$STA.LOCKCNT+1;

   9539  1 002642   000020 236100                    LDQ     16,,PR0
         1 002643   000001 036007                    ADLQ    1,DL
         1 002644   000020 552104                    STBQ    16,'04'O,PR0

     1074     9540                       %UNLOCK (G=STA$->KQ$STA.GATE);

   9541  1 002645   200004 236100                    LDQ     STA$,,AUTO
         1 002646   000016 036003                    ADLQ    14,DU
         1 002647   200066 756100                    STQ     I$+1,,AUTO
         1 002650   200066 630500                    EPPR0   I$+1,,AUTO
         1 002651   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002652   000000 701000 xent               TSX1    HFC$UNLOCK
         1 002653   000000 011000                    NOP     0

     1075     9543                       %UNLOCK (G=KQ$STREE.GATE);

   9544  1 002654   200006 236100                    LDQ     CG$,,AUTO
         1 002655   000075 036003                    ADLQ    61,DU
         1 002656   200066 756100                    STQ     I$+1,,AUTO
         1 002657   200066 630500                    EPPR0   I$+1,,AUTO
         1 002660   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002661   000000 701000 xent               TSX1    HFC$UNLOCK
         1 002662   000000 011000                    NOP     0

     1076     9546    5                  KQ$GARB.STA='1'B;

   9546  1 002663   200006 470500                    LDP0    CG$,,AUTO
         1 002664   400000 236003                    LDQ     -131072,DU
         1 002665   000032 256100                    ORSQ    26,,PR0

     1077     9547    5                  CALL KQS$SQUISH (CG$->KQ$CG) ALTRET(ALTRT);

   9547  1 002666   200006 630500                    EPPR0   CG$,,AUTO
         1 002667   000017 631400 xsym               EPPR1   B_VECTNIL+15
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:182  
         1 002670   002732 701000 1                  TSX1    s:9589
         1 002671   002726 702000 1                  TSX2    ALTRT

     1078     9548    5   D1:            STA$=KQ$GARB.OMLH$;

   9548  1 002672   200006 470500       D1           LDP0    CG$,,AUTO
         1 002673   000037 236100                    LDQ     31,,PR0
         1 002674   200004 756100                    STQ     STA$,,AUTO

     1079     9549                       %LOCK (G=KQ$STREE.GATE);

   9550  1 002675   200006 236100                    LDQ     CG$,,AUTO
         1 002676   000075 036003                    ADLQ    61,DU
         1 002677   200066 756100                    STQ     I$+1,,AUTO
         1 002700   200066 630500                    EPPR0   I$+1,,AUTO
         1 002701   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002702   000000 701000 xent               TSX1    HFC$LOCK
         1 002703   000000 011000                    NOP     0

     1080     9552    5                  IF KQ$GARB.ACTCNT ~= KQ$STREE.ACTCNT THEN GOTO D0;

   9552  1 002704   200006 470500                    LDP0    CG$,,AUTO
         1 002705   000032 720100                    LXL0    26,,PR0
         1 002706   000102 100100                    CMPX0   66,,PR0
         1 002707   002553 601000 1                  TNZ     D0

     1081     9553    5                  END D02;

     1082     9554    4                END D01;

     1083     9555    3             STA$=STA$->KQ$STA.BTN.FLINK$;

   9555  1 002710   200004 470500                    LDP0    STA$,,AUTO
         1 002711   000004 236100                    LDQ     4,,PR0
         1 002712   200004 756100                    STQ     STA$,,AUTO

     1084     9556    3             END;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:183  

   9556  1 002713   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 002714   002561 601000 1                  TNZ     s:9518

     1085     9557                %UNLOCK (G=KQ$STREE.GATE);

   9558  1 002715   200006 236100                    LDQ     CG$,,AUTO
         1 002716   000075 036003                    ADLQ    61,DU
         1 002717   200066 756100                    STQ     I$+1,,AUTO
         1 002720   200066 630500                    EPPR0   I$+1,,AUTO
         1 002721   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 002722   000000 701000 xent               TSX1    HFC$UNLOCK
         1 002723   000000 011000                    NOP     0

     1086     9560    2           RETURN;

   9560  1 002724   200030 221300                    LDX1  ! END$+1,,AUTO
         1 002725   000001 702211                    TSX2  ! 1,X1

     1087     9561    2   ALTRT:  ALTRETURN;

   9561  1 002726   200030 221300       ALTRT        LDX1  ! END$+1,,AUTO
         1 002727   000000 702211                    TSX2  ! 0,X1

     1088     9562        /**/
     1089     9563    2   DOS0:   ENTRY ALTRET;

   9563  1 002730   200030 741300       DOS0         STX1  ! END$+1,,AUTO

     1090     9564    2           GOTO D1;

   9564  1 002731   002672 710000 1                  TRA     D1

     1091     9565    2   END DOS;
     1092     9566        %EJECT;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:184  
     1093     9567        /*
     1094     9568               SSS    QQQ   U   U   III    SSS   H   H
     1095     9569              S   S  Q   Q  U   U    I    S   S  H   H
     1096     9570              S      Q   Q  U   U    I    S      H   H
     1097     9571               SSS   Q   Q  U   U    I     SSS   HHHHH
     1098     9572                  S  Q Q Q  U   U    I        S  H   H
     1099     9573              S   S  Q  QQ  U   U    I    S   S  H   H
     1100     9574               SSS    QQQ    UUU    III    SSS   H   H
     1101     9575        */
     1102     9576        /**/
     1103     9577        /*F* NAME:         KQS$SQUISH
     1104     9578             PURPOSE:      To squish an MLH to disk
     1105     9579             CALL:         KQS$SQUISH (KQ$CG)
     1106     9580             INPUT:        KQ$GARB.STA = 0/1 for Q-node/station
     1107     9581                           KQ$GARB.OMLH$ = KQ$QTN/KQ$STA
     1108     9582                           KQ$STA/KQ$QTN .LOCKCNT has been bumped
     1109     9583             DESCRIPTION:  Called by the garbage collector to squish an
     1110     9584                           MLH.
     1111     9585
     1112     9586                           If cannot finish immediately, ALTRETs and calls
     1113     9587                           DOQ0/DOS0 back when done; else RETURNs
     1114     9588        */
     1115     9589    1   KQS$SQUISH: ENTRY (PARM) ALTRET;

   9589  1 002732   000000 700200 xent  KQS$SQUISH   TSX0  ! X66_AUTO_1
         1 002733   000076 000001                    ZERO    62,1

     1116     9590        /**/
     1117     9591    1           CG$=ADDR(PARM);

   9591  1 002734   200003 236100                    LDQ     @PARM,,AUTO
         1 002735   200006 756100                    STQ     CG$,,AUTO

     1118     9592    1           ENTFLAG=0;

   9592  1 002736   200015 450100                    STZ     ENTFLAG,,AUTO

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:185  
     1119     9593    1   RESQ:   CALL SQUISHENT ALTRET(SQ);

   9593  1 002737   003450 701000 1     RESQ         TSX1    SQUISHENT
         1 002740   003016 702000 1                  TSX2    SQ

     1120     9594    1           MLH$->KQ$MLH.GACT='1'B;

   9594  1 002741   200014 470500                    LDP0    MLH$,,AUTO
         1 002742   000040 236003                    LDQ     32,DU
         1 002743   000003 256100                    ORSQ    3,,PR0

     1121     9595    1           IF MLH$->KQ$MLH.BUSY THEN

   9595  1 002744   200014 470500                    LDP0    MLH$,,AUTO
         1 002745   000003 236100                    LDQ     3,,PR0
         1 002746   000600 316003                    CANQ    384,DU
         1 002747   002767 600000 1                  TZE     s:9605

     1122     9596    1            IF MLH$->KQ$MLH.BUSY.GIP THEN CALL SC_CGGARB;

   9596  1 002750   000200 316003                    CANQ    128,DU
         1 002751   002755 600000 1                  TZE     s:9598

   9596  1 002752   000000 713400 xsym               CLIMB   SC_CGGARB
         1 002753   000000 600000 xsid               climb   nvectors=         0
         1 002754   002767 710000 1                  TRA     s:9605

     1123     9597    1            ELSE
     1124     9598    1             IF  MLH$->KQ$MLH.RQMEM = '0'B

   9598  1 002755   000020 316003                    CANQ    16,DU
         1 002756   002767 601000 1                  TNZ     s:9605
         1 002757   000010 316003                    CANQ    8,DU
         1 002760   002767 601000 1                  TNZ     s:9605

     1125     9599    1             AND MLH$->KQ$MLH.RQGC = '0'B THEN
     1126     9600    2               DO;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:186  

     1127     9601    2               KQ$GARB.DELAY=-KQGD_SRDWT#;

   9601  1 002761   000027 335007                    LCA     23,DL
         1 002762   200006 471500                    LDP1    CG$,,AUTO
         1 002763   100031 755100                    STA     25,,PR1

     1128     9602    2               CALL SQUISHX;

   9602  1 002764   003517 701000 1                  TSX1    SQUISHX
         1 002765   000000 011000                    NOP     0

     1129     9603    2               ALTRETURN;

   9603  1 002766   000000 702200 xent               TSX2  ! X66_AALT

     1130     9604    2               END;
     1131     9605    1           MLH$->KQ$MLH.BUSY.GIP='1'B;

   9605  1 002767   200014 470500                    LDP0    MLH$,,AUTO
         1 002770   000200 236003                    LDQ     128,DU
         1 002771   000003 256100                    ORSQ    3,,PR0

     1132     9606    1           GOTO SQ;

   9606  1 002772   003016 710000 1                  TRA     SQ

     1133     9607        /**/
     1134     9608        /*F* NAME:         KQS$CSQUISH
     1135     9609             PURPOSE:      To start garbage collection on a station MLH
     1136     9610             CALL:         KQS$CSQUISH (KQ$CG)
     1137     9611             INPUT:        Station gate unlocked, MLH.BUSY.GIP set
     1138     9612             DESCRIPTION:  Called from KQL$LIST when a reader needs help
     1139     9613                           or has finished reading, and the garbage collector
     1140     9614                           was waiting for the MLH.
     1141     9615                           KQ$MLH.BUSY has been set to KQMU_GARB#.
     1142     9616        */
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:187  
     1143     9617    1   KQS$CSQUISH: ENTRY (PARM) ALTRET; /* !!Doesn't ALTRET!! */

   9617  1 002773   000000 700200 xent  KQS$CSQUISH  TSX0  ! X66_AUTO_1
         1 002774   000076 000001                    ZERO    62,1

     1144     9618        /**/
     1145     9619    1           CG$=ADDR(PARM);

   9619  1 002775   200003 236100                    LDQ     @PARM,,AUTO
         1 002776   200006 756100                    STQ     CG$,,AUTO

     1146     9620    1           IF CG$->KQ$CG.MMD.GIP = '0'B

   9620  1 002777   200006 470500                    LDP0    CG$,,AUTO
         1 003000   000011 234100                    SZN     9,,PR0
         1 003001   003005 605000 1                  TPL     s:9622
         1 003002   000031 235100                    LDA     25,,PR0
         1 003003   000034 115000 2                  CMPA    28
         1 003004   003007 600000 1                  TZE     s:9623

     1147     9621    1           OR KQ$GARB.DELAY ~= -KQGD_SRDWT# THEN
     1148     9622    1            CALL SC_CGGARB;

   9622  1 003005   000000 713400 xsym               CLIMB   SC_CGGARB
         1 003006   000000 600000 xsid               climb   nvectors=         0

     1149     9623    1           ENTFLAG=-KQ$GARB.DELAY;

   9623  1 003007   200006 470500                    LDP0    CG$,,AUTO
         1 003010   000031 235100                    LDA     25,,PR0
         1 003011   000000 531000                    NEG     0
         1 003012   200015 755100                    STA     ENTFLAG,,AUTO

     1150     9624    1           KQ$GARB.DELAY=0;

   9624  1 003013   000031 450100                    STZ     25,,PR0

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:188  
     1151     9625    1           CALL SQUISHENT;

   9625  1 003014   003450 701000 1                  TSX1    SQUISHENT
         1 003015   000000 011000                    NOP     0

     1152     9626        /**/
     1153     9627    1   SQ:     KQ$GARB.SQIP='1'B;

   9627  1 003016   200006 470500       SQ           LDP0    CG$,,AUTO
         1 003017   010000 236003                    LDQ     4096,DU
         1 003020   000032 256100                    ORSQ    26,,PR0

     1154     9628    1           IF KQ_LOG.GARB THEN

   9628  1 003021   000000 236000 xsym               LDQ     KQ_LOG
         1 003022   200000 316003                    CANQ    65536,DU
         1 003023   003045 600000 1                  TZE     s:9635

     1155     9629    2             DO;

     1156     9630    2             CALL KQZ$LOG (CG$->KQ$CG,%KQLOG_GSSQ,ENTFLAG,0,0,0,

   9630  1 003024   200006 236100                    LDQ     CG$,,AUTO
         1 003025   000037 036003                    ADLQ    31,DU
         1 003026   200074 756100                    STQ     I$+7,,AUTO
         1 003027   000024 237000 2                  LDAQ    20
         1 003030   200072 757100                    STAQ    I$+5,,AUTO
         1 003031   000001 236000 2                  LDQ     1
         1 003032   200071 756100                    STQ     I$+4,,AUTO
         1 003033   200015 631500                    EPPR1   ENTFLAG,,AUTO
         1 003034   200070 451500                    STP1    I$+3,,AUTO
         1 003035   000036 236000 2                  LDQ     30
         1 003036   200006 235100                    LDA     CG$,,AUTO
         1 003037   200066 757100                    STAQ    I$+1,,AUTO
         1 003040   200066 630500                    EPPR0   I$+1,,AUTO
         1 003041   000025 631400 xsym               EPPR1   B_VECTNIL+21
         1 003042   000000 701000 xent               TSX1    KQZ$LOG
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:189  
         1 003043   003045 702000 1                  TSX2    s:9635

     1157     9631    2             KQ$GARB.OMLH$) ALTRET(ZA1);
     1158     9632    2             RETURN;

   9632  1 003044   000000 702200 xent               TSX2  ! X66_ARET

     1159     9633    2   ZA1:      END;
     1160     9634                %CHKCNT;

   9635  1 003045   000000 235000 xsym               LDA     KQ_DEBUG
         1 003046   003051 600000 1                  TZE     SQ0

   9635  1 003047   007316 701000 1                  TSX1    CHKMLH
         1 003050   000000 011000                    NOP     0

     1161     9637    1   SQ0:    KQ$GARB.RECYCLE='0'B;

   9637  1 003051   200006 470500       SQ0          LDP0    CG$,,AUTO
         1 003052   000037 236000 2                  LDQ     31
         1 003053   000032 356100                    ANSQ    26,,PR0

     1162     9638    2             DO CASE (KQ$GARB.TYPE);

   9638  1 003054   000032 220100                    LDX0    26,,PR0
         1 003055   000777 360003                    ANX0    511,DU
         1 003056   000004 100003                    CMPX0   4,DU
         1 003057   003061 602010 1                  TNC     s:9638+5,X0
         1 003060   003207 710000 1                  TRA     SQ40
         1 003061   003207 710000 1                  TRA     SQ40
         1 003062   003065 710000 1                  TRA     s:9641
         1 003063   003065 710000 1                  TRA     s:9641
         1 003064   003070 710000 1                  TRA     s:9644

     1163     9639
     1164     9640    2               CASE (KQGT_COAZ#,KQGT_CANS#);

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:190  
     1165     9641    2                 CALL GATHER ALTRET(ALTRT);

   9641  1 003065   003543 701000 1                  TSX1    GATHER
         1 003066   003354 702000 1                  TSX2    ALTRT
         1 003067   003207 710000 1                  TRA     SQ40

     1166     9642
     1167     9643    2               CASE (KQGT_CACS#);

     1168     9644    2                 CALL GATHER ALTRET(ALTRT);

   9644  1 003070   003543 701000 1                  TSX1    GATHER
         1 003071   003354 702000 1                  TSX2    ALTRT

     1169     9645        /**/
     1170     9646    2                 MBLK$=MLH$->KQ$MLH.HEAD$;

   9646  1 003072   200014 470500                    LDP0    MLH$,,AUTO
         1 003073   000000 236100                    LDQ     0,,PR0
         1 003074   200005 756100                    STQ     MBLK$,,AUTO

     1171     9647    3                   DO WHILE (MBLK$ ~= ADDR(NIL));

   9647  1 003075   003126 710000 1                  TRA     s:9661

     1172     9648    3                   IF MBLK$->KQ$MBLK.SUPER = '0'B THEN MBLK$=MBLK$->KQ$MBLK.LNK$;

   9648  1 003076   200005 470500                    LDP0    MBLK$,,AUTO
         1 003077   000010 234100                    SZN     8,,PR0
         1 003100   003104 604000 1                  TMI     s:9651

   9648  1 003101   000000 236100                    LDQ     0,,PR0
         1 003102   200005 756100                    STQ     MBLK$,,AUTO
         1 003103   003126 710000 1                  TRA     s:9661

     1173     9649    3                   ELSE
     1174     9650    4                     DO;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:191  

     1175     9651    4                     END$=MBLK$->KQ$MBLK.LNK$;

   9651  1 003104   000000 236100                    LDQ     0,,PR0
         1 003105   200027 756100                    STQ     END$,,AUTO

     1176     9652    4                     IF END$ = ADDR(NIL) THEN MBLK$=ADDR(NIL);

   9652  1 003106   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 003107   003113 601000 1                  TNZ     s:9653

   9652  1 003110   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 003111   200005 756100                    STQ     MBLK$,,AUTO
         1 003112   003126 710000 1                  TRA     s:9661

     1177     9653    4                     ELSE IF END$->KQ$MBLK.SUPER THEN MBLK$=END$;

   9653  1 003113   200027 471500                    LDP1    END$,,AUTO
         1 003114   100010 234100                    SZN     8,,PR1
         1 003115   003120 605000 1                  TPL     s:9656

   9653  1 003116   200005 756100                    STQ     MBLK$,,AUTO
         1 003117   003126 710000 1                  TRA     s:9661

     1178     9654    4                      ELSE
     1179     9655    5                        DO;

     1180     9656    5                        X$=END$->KQ$MBLK.LNK$;

   9656  1 003120   100000 236100                    LDQ     0,,PR1
         1 003121   200022 756100                    STQ     X$,,AUTO

     1181     9657    5                        CALL CONCATN;

   9657  1 003122   004376 701000 1                  TSX1    CONCATN
         1 003123   000000 011000                    NOP     0

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:192  
     1182     9658    5                        MBLK$=X$;

   9658  1 003124   200022 236100                    LDQ     X$,,AUTO
         1 003125   200005 756100                    STQ     MBLK$,,AUTO

     1183     9659    5                        END;

     1184     9660    4                     END;

     1185     9661    3                   END;

   9661  1 003126   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 003127   003076 601000 1                  TNZ     s:9648

     1186     9662        /**/
     1187     9663    2                 MBLK$=MLH$->KQ$MLH.HEAD$;

   9663  1 003130   200014 470500                    LDP0    MLH$,,AUTO
         1 003131   000000 236100                    LDQ     0,,PR0
         1 003132   200005 756100                    STQ     MBLK$,,AUTO

     1188     9664    2                 KQ$GARB.INSRT='1'B;

   9664  1 003133   200006 471500                    LDP1    CG$,,AUTO
         1 003134   040000 236003                    LDQ     16384,DU
         1 003135   100032 256100                    ORSQ    26,,PR1

     1189     9665    3                   DO WHILE (MBLK$ ~= ADDR(NIL));

   9665  1 003136   003162 710000 1                  TRA     s:9675

     1190     9666    3                   IF MBLK$->KQ$MBLK.SUPER THEN

   9666  1 003137   200005 470500                    LDP0    MBLK$,,AUTO
         1 003140   000010 234100                    SZN     8,,PR0
         1 003141   003157 605000 1                  TPL     s:9674

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:193  
     1191     9667    4                     DO;

     1192     9668    4                     KQ$GARB.MBLK$=MBLK$;

   9668  1 003142   200005 236100                    LDQ     MBLK$,,AUTO
         1 003143   200006 471500                    LDP1    CG$,,AUTO
         1 003144   100036 756100                    STQ     30,,PR1

     1193     9669    4                     CALL INSRT ALTRET(ALTRT);

   9669  1 003145   005107 701000 1                  TSX1    INSRT
         1 003146   003354 702000 1                  TSX2    ALTRT

     1194     9670    4   SQ24:             IF KQ$GARB.RECYCLE THEN GOTO SQ0;

   9670  1 003147   200006 470500       SQ24         LDP0    CG$,,AUTO
         1 003150   000032 236100                    LDQ     26,,PR0
         1 003151   100000 316003                    CANQ    32768,DU
         1 003152   003051 601000 1                  TNZ     SQ0

     1195     9671    4                     IF NOT KQ$GARB.INSRT THEN /* Did a SETLDA */ GOTO SQ26;

   9671  1 003153   040000 316003                    CANQ    16384,DU
         1 003154   003165 600000 1                  TZE     SQ26

     1196     9672    4                     MBLK$=KQ$GARB.MBLK$;

   9672  1 003155   000036 236100                    LDQ     30,,PR0
         1 003156   200005 756100                    STQ     MBLK$,,AUTO

     1197     9673    4                     END;

     1198     9674    3                   MBLK$=MBLK$->KQ$MBLK.LNK$;

   9674  1 003157   200005 470500                    LDP0    MBLK$,,AUTO
         1 003160   000000 236100                    LDQ     0,,PR0
         1 003161   200005 756100                    STQ     MBLK$,,AUTO
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:194  

     1199     9675    3                   END;

   9675  1 003162   200005 236100                    LDQ     MBLK$,,AUTO
         1 003163   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 003164   003137 601000 1                  TNZ     s:9666

   9671  1 003165                       SQ26         null
     1200     9676        /**/
     1201     9677    2   SQ26:         ;
     1202     9678    3                   DO FOREVER;

     1203     9679    3                   CALL GETSLIST ALTRET(SQ40);

   9679  1 003165   004204 701000 1                  TSX1    GETSLIST
         1 003166   003207 702000 1                  TSX2    SQ40

     1204     9680    3                   KQ$GARB.MBLK$=MBLK$;

   9680  1 003167   200005 236100                    LDQ     MBLK$,,AUTO
         1 003170   200006 470500                    LDP0    CG$,,AUTO
         1 003171   000036 756100                    STQ     30,,PR0

     1205     9681    3   SQ28:           CALL CONCATS ALTRET(ALTRT);

   9681  1 003172   004443 701000 1     SQ28         TSX1    CONCATS
         1 003173   003354 702000 1                  TSX2    ALTRT

     1206     9682    3   SQ30:           IF KQ$GARB.RECYCLE THEN GOTO SQ0;

   9682  1 003174   200006 470500       SQ30         LDP0    CG$,,AUTO
         1 003175   000032 236100                    LDQ     26,,PR0
         1 003176   100000 316003                    CANQ    32768,DU
         1 003177   003051 601000 1                  TNZ     SQ0

     1207     9683    3                   IF KQ$GARB.CONERR THEN

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:195  
   9683  1 003200   020000 316003                    CANQ    8192,DU
         1 003201   003165 600000 1                  TZE     SQ26

     1208     9684    4                     DO; /* Err reading first guy's LDA: reset it */

     1209     9685    4                     KQ$GARB.INSRT='0'B; /* To drive SETLDA */

   9685  1 003202   000032 236000 2                  LDQ     26
         1 003203   000032 356100                    ANSQ    26,,PR0

     1210     9686    4                     CALL SETLDA ALTRET(ALTRT);

   9686  1 003204   005217 701000 1                  TSX1    SETLDA
         1 003205   003354 702000 1                  TSX2    ALTRT

     1211     9687    4                     GOTO SQ28; /* Try again now */

   9687  1 003206   003172 710000 1                  TRA     SQ28

     1212     9688    4                     END;
     1213     9689    3                   END;

   9685  1 003207                       SQ40         null
     1214     9690    2   SQ40:         ;
     1215     9691    2             END;

   9685  1 003207                       SQDUN        null
     1216     9692        /**/
     1217     9693                     /*    All done.
     1218     9694                      *    Unlock stuff,
     1219     9695                      *    merge delayed
     1220     9696                      *    messages back
     1221     9697                      *    in, and exit.
     1222     9698                      */
     1223     9699    1   SQDUN:  ;
     1224     9700    1           IF KQ_LOG.GARB THEN

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:196  
   9700  1 003207   000000 236000 xsym               LDQ     KQ_LOG
         1 003210   200000 316003                    CANQ    65536,DU
         1 003211   003233 600000 1                  TZE     s:9706

     1225     9701    2             DO;

     1226     9702    2             CALL KQZ$LOG (CG$->KQ$CG,%KQLOG_GESQ,ENTFLAG,0,0,0,

   9702  1 003212   200006 236100                    LDQ     CG$,,AUTO
         1 003213   000037 036003                    ADLQ    31,DU
         1 003214   200074 756100                    STQ     I$+7,,AUTO
         1 003215   000024 237000 2                  LDAQ    20
         1 003216   200072 757100                    STAQ    I$+5,,AUTO
         1 003217   000001 236000 2                  LDQ     1
         1 003220   200071 756100                    STQ     I$+4,,AUTO
         1 003221   200015 630500                    EPPR0   ENTFLAG,,AUTO
         1 003222   200070 450500                    STP0    I$+3,,AUTO
         1 003223   000041 236000 2                  LDQ     33
         1 003224   200006 235100                    LDA     CG$,,AUTO
         1 003225   200066 757100                    STAQ    I$+1,,AUTO
         1 003226   200066 630500                    EPPR0   I$+1,,AUTO
         1 003227   000025 631400 xsym               EPPR1   B_VECTNIL+21
         1 003230   000000 701000 xent               TSX1    KQZ$LOG
         1 003231   003233 702000 1                  TSX2    s:9706

     1227     9703    2             KQ$GARB.OMLH$) ALTRET(ZA2);
     1228     9704    2             RETURN;

   9704  1 003232   000000 702200 xent               TSX2  ! X66_ARET

     1229     9705    2   ZA2:      END;
     1230     9706    1           IF KQ$GARB.STA THEN

   9706  1 003233   200006 470500                    LDP0    CG$,,AUTO
         1 003234   000032 234100                    SZN     26,,PR0
         1 003235   003314 605000 1                  TPL     SQX_Q

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:197  
     1231     9707    2   SQX_S:    DO;

   9707  1 003236                       SQX_S        null
     1232     9708    2             IF MLH$->KQ$MLH.BUSY.RIP THEN

   9708  1 003236   200014 471500                    LDP1    MLH$,,AUTO
         1 003237   100003 236100                    LDQ     3,,PR1
         1 003240   000400 316003                    CANQ    256,DU
         1 003241   003303 600000 1                  TZE     s:9728

     1233     9709    3               DO; /* Reader active */

     1234     9710    3               IF MLH$->KQ$MLH.RQGC THEN

   9710  1 003242   000010 316003                    CANQ    8,DU
         1 003243   003266 600000 1                  TZE     s:9719

     1235     9711    4                 DO;

     1236     9712    4                 CALL GETQM;

   9712  1 003244   007263 701000 1                  TSX1    GETQM
         1 003245   000000 011000                    NOP     0

     1237     9713    4                 MLH$->KQ$MLH.RQGC='0'B;

   9713  1 003246   200014 470500                    LDP0    MLH$,,AUTO
         1 003247   000002 236000 2                  LDQ     2
         1 003250   000003 356100                    ANSQ    3,,PR0

     1238     9714    4                 MLH$->KQ$MLH.GACT='0'B;

   9714  1 003251   200014 470500                    LDP0    MLH$,,AUTO
         1 003252   000022 236000 2                  LDQ     18
         1 003253   000003 356100                    ANSQ    3,,PR0

     1239     9715    4                 MLH$->KQ$MLH.BUSY.GIP='0'B;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:198  

   9715  1 003254   200014 470500                    LDP0    MLH$,,AUTO
         1 003255   000033 236000 2                  LDQ     27
         1 003256   000003 356100                    ANSQ    3,,PR0

     1240     9716    4                 CALL SQUISHX;

   9716  1 003257   003517 701000 1                  TSX1    SQUISHX
         1 003260   000000 011000                    NOP     0

     1241     9717    4                 CALL KQL$SRQ (MBLK$->KQ$MBLK);

   9717  1 003261   200005 630500                    EPPR0   MBLK$,,AUTO
         1 003262   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003263   000000 701000 xent               TSX1    KQL$SRQ
         1 003264   000000 011000                    NOP     0

     1242     9718    4                 END;

   9718  1 003265   003307 710000 1                  TRA     s:9729

     1243     9719    3               ELSE IF MLH$->KQ$MLH.RQMEM THEN

   9719  1 003266   000020 316003                    CANQ    16,DU
         1 003267   003300 600000 1                  TZE     s:9726

     1244     9720    4                  DO;

     1245     9721    4                  MLH$->KQ$MLH.GACT='0'B;

   9721  1 003270   000022 236000 2                  LDQ     18
         1 003271   100003 356100                    ANSQ    3,,PR1

     1246     9722    4                  MLH$->KQ$MLH.BUSY.GIP='0'B;

   9722  1 003272   200014 471500                    LDP1    MLH$,,AUTO
         1 003273   000033 236000 2                  LDQ     27
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:199  
         1 003274   100003 356100                    ANSQ    3,,PR1

     1247     9723    4                  CALL SQUISHX;

   9723  1 003275   003517 701000 1                  TSX1    SQUISHX
         1 003276   000000 011000                    NOP     0

     1248     9724    4                  END;

   9724  1 003277   003307 710000 1                  TRA     s:9729

     1249     9725    3                ELSE
     1250     9726    3                 CALL SC_CGGARB;

   9726  1 003300   000000 713400 xsym               CLIMB   SC_CGGARB
         1 003301   000000 600000 xsid               climb   nvectors=         0

     1251     9727    3               END;

   9727  1 003302   003307 710000 1                  TRA     s:9729

     1252     9728    2             ELSE CALL KQL$GARBDUNS (STA$->KQ$STA);

   9728  1 003303   200004 630500                    EPPR0   STA$,,AUTO
         1 003304   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003305   000000 701000 xent               TSX1    KQL$GARBDUNS
         1 003306   000000 011000                    NOP     0

     1253     9729    2             CALL KQP$UNLOCK (STA$->KQ$STA);

   9729  1 003307   200004 630500                    EPPR0   STA$,,AUTO
         1 003310   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003311   000000 701000 xent               TSX1    KQP$UNLOCK
         1 003312   000000 011000                    NOP     0

     1254     9730    2             END SQX_S;

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:200  
   9730  1 003313   003327 710000 1                  TRA     s:9737

     1255     9731    1           ELSE
     1256     9732    2   SQX_Q:    DO;

   9732  1 003314                       SQX_Q        null
     1257     9733    2             QTN$->KQ$QTN.LOCKCNT=QTN$->KQ$QTN.LOCKCNT-1;

   9733  1 003314   200024 471500                    LDP1    QTN$,,AUTO
         1 003315   100050 236100                    LDQ     40,,PR1
         1 003316   000033 772000                    QRL     27
         1 003317   000177 376007                    ANQ     127,DL
         1 003320   000001 136007                    SBLQ    1,DL
         1 003321   000033 736000                    QLS     27
         1 003322   100050 676100                    ERQ     40,,PR1
         1 003323   177000 376003                    ANQ     65024,DU
         1 003324   100050 656100                    ERSQ    40,,PR1

     1258     9734    2             CALL SQUISHX;

   9734  1 003325   003517 701000 1                  TSX1    SQUISHX
         1 003326   000000 011000                    NOP     0

     1259     9735    2             END SQX_Q;

     1260     9736        /**/
     1261     9737    1           KQ$GARB.SQIP='0'B;

   9737  1 003327   200006 470500                    LDP0    CG$,,AUTO
         1 003330   000015 236000 2                  LDQ     13
         1 003331   000032 356100                    ANSQ    26,,PR0

     1262     9738    1           IF ENTFLAG = 0 THEN RETURN;

   9738  1 003332   200015 235100                    LDA     ENTFLAG,,AUTO
         1 003333   003335 601000 1                  TNZ     s:9739

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:201  
   9738  1 003334   000000 702200 xent               TSX2  ! X66_ARET

     1263     9739    1           IF KQ$GARB.STA THEN

   9739  1 003335   000032 234100                    SZN     26,,PR0
         1 003336   003344 605000 1                  TPL     s:9746

     1264     9740    2             DO;

     1265     9741    2             IF ENTFLAG = KQGD_QFULL# THEN

   9741  1 003337   000006 115007                    CMPA    6,DL
         1 003340   000120 600000 1                  TZE     GBFAIL

     1266     9742    2              GOTO GBFAIL;
     1267     9743    2             CALL DOS0 ALTRET(RTN);

   9743  1 003341   002730 701000 1                  TSX1    DOS0
         1 003342   000564 702000 1                  TSX2    RTN

     1268     9744    2             GOTO GB3;

   9744  1 003343   000100 710000 1                  TRA     GB3

     1269     9745    2             END;
     1270     9746    1           IF ENTFLAG = KQGD_QFULL# THEN

   9746  1 003344   000006 115007                    CMPA    6,DL
         1 003345   003351 601000 1                  TNZ     s:9751

     1271     9747    2             DO;

     1272     9748    2             CALL DOQ0F;

   9748  1 003346   002521 701000 1                  TSX1    DOQ0F
         1 003347   000000 011000                    NOP     0

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:202  
     1273     9749    2             GOTO GBFAIL;

   9749  1 003350   000120 710000 1                  TRA     GBFAIL

     1274     9750    2             END;
     1275     9751    1           CALL DOQ0 ALTRET(RTN);

   9751  1 003351   002517 701000 1                  TSX1    DOQ0
         1 003352   000564 702000 1                  TSX2    RTN

     1276     9752    1           GOTO GB2;

   9752  1 003353   000074 710000 1                  TRA     GB2

     1277     9753    1   ALTRT:  ALTRETURN;

   9753  1 003354   000000 702200 xent  ALTRT        TSX2  ! X66_AALT

     1278     9754        /**/
     1279     9755        /*F* NAME:         KQS$GCONT
     1280     9756             PURPOSE:      To continue a delayed KQD$GET issued by KQS$SQUISH
     1281     9757        */
     1282     9758    1   KQS$GCONT: ENTRY (PARM) ALTRET; /* !!Doesn't ALTRET!! */

   9758  1 003355   000000 700200 xent  KQS$GCONT    TSX0  ! X66_AUTO_1
         1 003356   000076 000001                    ZERO    62,1

     1283     9759        /**/
     1284     9760    1           DFRP$=ADDR(PARM);

   9760  1 003357   200003 236100                    LDQ     @PARM,,AUTO
         1 003360   200010 756100                    STQ     DFRP$,,AUTO

     1285     9761    1           DBLK$=DFRP$->KQ$DFRPARM.DBLK$;

   9761  1 003361   200010 470500                    LDP0    DFRP$,,AUTO
         1 003362   000001 236100                    LDQ     1,,PR0
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:203  
         1 003363   200011 756100                    STQ     DBLK$,,AUTO

     1286     9762    1           CG$=DFRP$->KQ$DFRPARM.INFO$;

   9762  1 003364   000000 236100                    LDQ     0,,PR0
         1 003365   200006 756100                    STQ     CG$,,AUTO

     1287     9763    1           DDA=DFRP$->KQ$DFRPARM.DDA;

   9763  1 003366   000002 235100                    LDA     2,,PR0
         1 003367   200013 755100                    STA     DDA,,AUTO

     1288     9764    1           ENTFLAG=-KQ$GARB.DELAY;

   9764  1 003370   200006 471500                    LDP1    CG$,,AUTO
         1 003371   100031 235100                    LDA     25,,PR1
         1 003372   000000 531000                    NEG     0
         1 003373   200015 755100                    STA     ENTFLAG,,AUTO

     1289     9765    1           KQ$GARB.DELAY=0;

   9765  1 003374   100031 450100                    STZ     25,,PR1

     1290     9766    2             DO CASE (ENTFLAG);

   9766  1 003375   000004 135007                    SBLA    4,DL
         1 003376   000021 115007                    CMPA    17,DL
         1 003377   003401 602005 1                  TNC     s:9766+4,AL
         1 003400   003445 710000 1                  TRA     s:9781
         1 003401   003422 710000 1                  TRA     s:9769
         1 003402   003445 710000 1                  TRA     s:9781
         1 003403   003445 710000 1                  TRA     s:9781
         1 003404   003445 710000 1                  TRA     s:9781
         1 003405   003445 710000 1                  TRA     s:9781
         1 003406   003445 710000 1                  TRA     s:9781
         1 003407   003445 710000 1                  TRA     s:9781
         1 003410   003445 710000 1                  TRA     s:9781
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:204  
         1 003411   003445 710000 1                  TRA     s:9781
         1 003412   003445 710000 1                  TRA     s:9781
         1 003413   003445 710000 1                  TRA     s:9781
         1 003414   003445 710000 1                  TRA     s:9781
         1 003415   003445 710000 1                  TRA     s:9781
         1 003416   003445 710000 1                  TRA     s:9781
         1 003417   003445 710000 1                  TRA     s:9781
         1 003420   003445 710000 1                  TRA     s:9781
         1 003421   003440 710000 1                  TRA     s:9776

     1291     9767
     1292     9768    2               CASE (KQGD_SQGG0#);

     1293     9769    2                 CALL SQUISHENT0;

   9769  1 003422   003454 701000 1                  TSX1    SQUISHENT0
         1 003423   000000 011000                    NOP     0

     1294     9770    2                 IF DBLK$ ~= ADDR(NIL) THEN GOTO SQ0;

   9770  1 003424   200011 236100                    LDQ     DBLK$,,AUTO
         1 003425   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 003426   003051 601000 1                  TNZ     SQ0

     1295     9771    2                 IF DFRP$->KQ$DFRPARM.ERR ~= %KQDE_NSPC THEN CALL SC_CGGARB;

   9771  1 003427   200010 470500                    LDP0    DFRP$,,AUTO
         1 003430   000004 235100                    LDA     4,,PR0
         1 003431   000002 115007                    CMPA    2,DL
         1 003432   003435 600000 1                  TZE     s:9772

   9771  1 003433   000000 713400 xsym               CLIMB   SC_CGGARB
         1 003434   000000 600000 xsid               climb   nvectors=         0

     1296     9772    2                 ENTFLAG=KQGD_QFULL#;

   9772  1 003435   000006 235007                    LDA     6,DL
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:205  
         1 003436   200015 755100                    STA     ENTFLAG,,AUTO

     1297     9773    2                 GOTO SQDUN;

   9773  1 003437   003207 710000 1                  TRA     SQ40

     1298     9774
     1299     9775    2               CASE (KQGD_SQIG0#);

     1300     9776    2                 CALL SQUISHENT0;

   9776  1 003440   003454 701000 1                  TSX1    SQUISHENT0
         1 003441   000000 011000                    NOP     0

     1301     9777    2                 CALL INSRTG0 ALTRET(RTN);

   9777  1 003442   006551 701000 1                  TSX1    INSRTG0
         1 003443   000564 702000 1                  TSX2    RTN

     1302     9778    2                 GOTO SQ24;

   9778  1 003444   003147 710000 1                  TRA     SQ24

     1303     9779
     1304     9780    2               CASE (ELSE);

     1305     9781    2                 CALL SC_CGGBSN;

   9781  1 003445   000000 713400 xsym               CLIMB   SC_CGGBSN
         1 003446   000000 600000 xsid               climb   nvectors=         0

     1306     9782
     1307     9783    2             END;

     1308     9784    1           RETURN;

   9784  1 003447   000000 702200 xent               TSX2  ! X66_ARET
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:206  

     1309     9785        %EJECT;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:207  
     1310     9786        /********************************************************
     1311     9787        *********************************************************/
     1312     9788        /**/
     1313     9789        /*D* NAME:         SQUISHENT
     1314     9790             PURPOSE:      To set up for entering the SQUISH process
     1315     9791                           ALTRETs if Q squish, RETURNs if station.
     1316     9792        */
     1317     9793    1   SQUISHENT: PROC ALTRET;

   9793  1 003450   200060 741300       SQUISHENT    STX1  ! @MBLK+1,,AUTO

     1318     9794        /**/
     1319     9795    2           DBLK$=ADDR(NIL);

   9795  1 003451   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 003452   200011 756100                    STQ     DBLK$,,AUTO
         1 003453   003455 710000 1                  TRA     s:9799

     1320     9796        /**/
     1321     9797    2   SQUISHENT0: ENTRY ALTRET;

   9797  1 003454   200060 741300       SQUISHENT0   STX1  ! @MBLK+1,,AUTO

     1322     9798        /**/
     1323     9799    2           IF KQ$GARB.STA THEN

   9799  1 003455   200006 470500                    LDP0    CG$,,AUTO
         1 003456   000032 234100                    SZN     26,,PR0
         1 003457   003500 605000 1                  TPL     s:9809

     1324     9800    3             DO;

     1325     9801    3             STA$=KQ$GARB.OMLH$;

   9801  1 003460   000037 236100                    LDQ     31,,PR0
         1 003461   200004 756100                    STQ     STA$,,AUTO

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:208  
     1326     9802    3             MLH$=ADDR(STA$->KQ$STA.MLH);

   9802  1 003462   000034 036003                    ADLQ    28,DU
         1 003463   200014 756100                    STQ     MLH$,,AUTO

     1327     9803                  %LOCK (G=STA$->KQ$STA.GATE);

   9804  1 003464   200004 236100                    LDQ     STA$,,AUTO
         1 003465   000016 036003                    ADLQ    14,DU
         1 003466   200066 756100                    STQ     I$+1,,AUTO
         1 003467   200066 630500                    EPPR0   I$+1,,AUTO
         1 003470   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003471   000000 701000 xent               TSX1    HFC$LOCK
         1 003472   000000 011000                    NOP     0

     1328     9806    3             MBLK$=KQ$GARB.MBLK$;

   9806  1 003473   200006 470500                    LDP0    CG$,,AUTO
         1 003474   000036 236100                    LDQ     30,,PR0
         1 003475   200005 756100                    STQ     MBLK$,,AUTO

     1329     9807    3             RETURN;

   9807  1 003476   200060 221300                    LDX1  ! @MBLK+1,,AUTO
         1 003477   000001 702211                    TSX2  ! 1,X1

     1330     9808    3             END;
     1331     9809    2           QTN$=KQ$GARB.OMLH$;

   9809  1 003500   000037 236100                    LDQ     31,,PR0
         1 003501   200024 756100                    STQ     QTN$,,AUTO

     1332     9810    2           MLH$=ADDR(QTN$->KQ$QTN.MLH);

   9810  1 003502   000055 036003                    ADLQ    45,DU
         1 003503   200014 756100                    STQ     MLH$,,AUTO

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:209  
     1333     9811                %LOCK (G=KQ$QTREE.GATE);

   9812  1 003504   000057 471500                    LDP1    47,,PR0
         1 003505   200066 451500                    STP1    I$+1,,AUTO
         1 003506   200066 630500                    EPPR0   I$+1,,AUTO
         1 003507   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003510   000000 701000 xent               TSX1    HFC$LOCK
         1 003511   000000 011000                    NOP     0

     1334     9814    2           MBLK$=KQ$GARB.MBLK$;

   9814  1 003512   200006 470500                    LDP0    CG$,,AUTO
         1 003513   000036 236100                    LDQ     30,,PR0
         1 003514   200005 756100                    STQ     MBLK$,,AUTO

     1335     9815    2           ALTRETURN;

   9815  1 003515   200060 221300                    LDX1  ! @MBLK+1,,AUTO
         1 003516   000000 702211                    TSX2  ! 0,X1

     1336     9816        /********************************************************
     1337     9817        *********************************************************/
     1338     9818        /**/
     1339     9819        /*D* NAME:         SQUISHX
     1340     9820             PURPOSE:      To set up to leave the SQUISH process
     1341     9821        */
     1342     9822    2   SQUISHX: ENTRY ALTRET; /* !!Doesn't ALTRET!! */

   9822  1 003517   200060 741300       SQUISHX      STX1  ! @MBLK+1,,AUTO

     1343     9823        /**/
     1344     9824    2           IF KQ$GARB.STA THEN

   9824  1 003520   200006 470500                    LDP0    CG$,,AUTO
         1 003521   000032 234100                    SZN     26,,PR0
         1 003522   003533 605000 1                  TPL     s:9833

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:210  
     1345     9825    3             DO;

     1346     9826                  %UNLOCK (G=STA$->KQ$STA.GATE);

   9827  1 003523   200004 236100                    LDQ     STA$,,AUTO
         1 003524   000016 036003                    ADLQ    14,DU
         1 003525   200066 756100                    STQ     I$+1,,AUTO
         1 003526   200066 630500                    EPPR0   I$+1,,AUTO
         1 003527   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003530   000000 701000 xent               TSX1    HFC$UNLOCK
         1 003531   000000 011000                    NOP     0

     1347     9829    3             END;

   9829  1 003532   003541 710000 1                  TRA     s:9836

     1348     9830    2           ELSE
     1349     9831    3             DO;

     1350     9832                  %UNLOCK (G=KQ$QTREE.GATE);

   9833  1 003533   000057 471500                    LDP1    47,,PR0
         1 003534   200066 451500                    STP1    I$+1,,AUTO
         1 003535   200066 630500                    EPPR0   I$+1,,AUTO
         1 003536   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003537   000000 701000 xent               TSX1    HFC$UNLOCK
         1 003540   000000 011000                    NOP     0

     1351     9835    3             END;

     1352     9836    2           RETURN;

   9836  1 003541   200060 221300                    LDX1  ! @MBLK+1,,AUTO
         1 003542   000001 702211                    TSX2  ! 1,X1

     1353     9837    2   END SQUISHENT;
     1354     9838        /********************************************************
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:211  
     1355     9839        *********************************************************/
     1356     9840        /**/
     1357     9841        /*D* NAME:         GATHER
     1358     9842             PURPOSE:      To gather MBLKs into super MBLKs
     1359     9843             DESCRIPTION:  Takes all lists of ordinary MBLKs in the
     1360     9844                           target MLH, and puts them on disk.
     1361     9845                           ALTRETs if delay for DBLK is required.
     1362     9846        */
     1363     9847    1   GATHER: PROC ALTRET;

   9847  1 003543   200030 741300       GATHER       STX1  ! END$+1,,AUTO

     1364     9848        /**/
     1365     9849    3             DO FOREVER;

     1366     9850    3             CALL GETLIST ALTRET(RTN);

   9850  1 003544   004132 701000 1                  TSX1    GETLIST
         1 003545   003621 702000 1                  TSX2    RTN

     1367     9851    3             IF DBLK$ = ADDR(NIL) THEN

   9851  1 003546   200011 236100                    LDQ     DBLK$,,AUTO
         1 003547   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 003550   003557 601000 1                  TNZ     s:9853

     1368     9852    3              CALL GETDBLK (KQGD_SQGG0#,KQGD_SQGD0#) ALTRET(NOGET);

   9852  1 003551   000042 236000 2                  LDQ     34
         1 003552   200056 756100                    STQ     @MBLK+1,,AUTO
         1 003553   000043 236000 2                  LDQ     35
         1 003554   200055 756100                    STQ     DELETE+11,,AUTO
         1 003555   004257 701000 1                  TSX1    GETDBLK
         1 003556   003623 702000 1                  TSX2    NOGET

     1369     9853    3             CALL DUMPLIST;

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:212  
   9853  1 003557   003642 701000 1                  TSX1    DUMPLIST
         1 003560   000000 011000                    NOP     0

     1370     9854              /* This loop may go on for a long time (as seen by STAR 12254).        */
     1371     9855              /* Don't leave the gate locked too long as a result.                   */
     1372     9856    3             IF KQ$GARB.STA

   9856  1 003561   200006 470500                    LDP0    CG$,,AUTO
         1 003562   000032 234100                    SZN     26,,PR0
         1 003563   003603 605000 1                  TPL     s:9867

     1373     9857    4             THEN DO;

     1374     9858                    %UNLOCK (G=STA$->KQ$STA.GATE);

   9859  1 003564   200004 236100                    LDQ     STA$,,AUTO
         1 003565   000016 036003                    ADLQ    14,DU
         1 003566   200066 756100                    STQ     I$+1,,AUTO
         1 003567   200066 630500                    EPPR0   I$+1,,AUTO
         1 003570   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003571   000000 701000 xent               TSX1    HFC$UNLOCK
         1 003572   000000 011000                    NOP     0

     1375     9861                    %LOCK (G=STA$->KQ$STA.GATE);

   9862  1 003573   200004 236100                    LDQ     STA$,,AUTO
         1 003574   000016 036003                    ADLQ    14,DU
         1 003575   200066 756100                    STQ     I$+1,,AUTO
         1 003576   200066 630500                    EPPR0   I$+1,,AUTO
         1 003577   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003600   000000 701000 xent               TSX1    HFC$LOCK
         1 003601   000000 011000                    NOP     0

     1376     9864    4               END;

   9864  1 003602   003544 710000 1                  TRA     s:9850

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:213  
     1377     9865    4             ELSE DO;

     1378     9866                    %UNLOCK (G=KQ$QTREE.GATE);

   9867  1 003603   000057 471500                    LDP1    47,,PR0
         1 003604   200066 451500                    STP1    I$+1,,AUTO
         1 003605   200066 630500                    EPPR0   I$+1,,AUTO
         1 003606   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003607   000000 701000 xent               TSX1    HFC$UNLOCK
         1 003610   000000 011000                    NOP     0

     1379     9869                    %LOCK (G=KQ$QTREE.GATE);

   9870  1 003611   200006 470500                    LDP0    CG$,,AUTO
         1 003612   000057 471500                    LDP1    47,,PR0
         1 003613   200066 451500                    STP1    I$+1,,AUTO
         1 003614   200066 630500                    EPPR0   I$+1,,AUTO
         1 003615   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 003616   000000 701000 xent               TSX1    HFC$LOCK
         1 003617   000000 011000                    NOP     0

     1380     9872    4               END;

     1381     9873    3             END;

   9873  1 003620   003544 710000 1                  TRA     s:9850

     1382     9874    2   RTN:    RETURN;

   9874  1 003621   200030 221300       RTN          LDX1  ! END$+1,,AUTO
         1 003622   000001 702211                    TSX2  ! 1,X1

     1383     9875    2   NOGET:  IF DBLK$ ~= ADDR(NIL)

   9875  1 003623   200011 236100       NOGET        LDQ     DBLK$,,AUTO
         1 003624   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 003625   003631 601000 1                  TNZ     s:9876
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:214  
         1 003626   200013 235100                    LDA     DDA,,AUTO
         1 003627   000012 115007                    CMPA    10,DL
         1 003630   003633 601000 1                  TNZ     s:9877

     1384     9876    2           OR DDA = %KQDE_NDFRBLK THEN ALTRETURN;

   9876  1 003631   200030 221300                    LDX1  ! END$+1,,AUTO
         1 003632   000000 702211                    TSX2  ! 0,X1

     1385     9877    2           CALL SQUISHX;

   9877  1 003633   003517 701000 1                  TSX1    SQUISHX
         1 003634   000000 011000                    NOP     0

     1386     9878    2           KQ$GARB.DELAY=KQGD_QFULL#;

   9878  1 003635   000006 235007                    LDA     6,DL
         1 003636   200006 470500                    LDP0    CG$,,AUTO
         1 003637   000031 755100                    STA     25,,PR0

     1387     9879    2           ALTRETURN;

   9879  1 003640   200030 221300                    LDX1  ! END$+1,,AUTO
         1 003641   000000 702211                    TSX2  ! 0,X1

     1388     9880    2   END GATHER;
     1389     9881        /********************************************************
     1390     9882        *********************************************************/
     1391     9883        /**/
     1392     9884        /*D* NAME:         DUMPLIST
     1393     9885             PURPOSE:      To move an MBLK list to disk
     1394     9886             INPUT:        DBLK$ is the data block
     1395     9887                           DDA is its disk address
     1396     9888                           START$ points to the first MBLK
     1397     9889                           NMBLKS is the list count
     1398     9890                           END$ is the last one
     1399     9891             DESCRIPTION:  Puts them in the DBLK, builds a super MBLK
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:215  
     1400     9892                           to represent them and stores it on top of
     1401     9893                           the START$ MBLK, flinking it at END$'s flink,
     1402     9894                           releases the MBLKs, and adjusts the MLH's
     1403     9895                           SUPERCNT.
     1404     9896                           Sets DBLK$ to ADDR(NIL) to indicate that the
     1405     9897                           DBLK was used.
     1406     9898        */
     1407     9899    1   DUMPLIST: PROC;

   9899  1 003642   200032 741300       DUMPLIST     STX1  ! KQ$TMLH,,AUTO

     1408     9900        /**/
     1409     9901    2   DCL T1$ PTR;
     1410     9902    2   DCL T2$ PTR;
     1411     9903        %KQ_MBLK (FPTN=SMBLK,STCLASS=AUTO,SUPR=1);
     1412    10173        /**/
     1413    10174    2           IF KQ_LOG.GARB THEN

  10174  1 003643   000000 236000 xsym               LDQ     KQ_LOG
         1 003644   200000 316003                    CANQ    65536,DU
         1 003645   003675 600000 1                  TZE     s:10183

     1414    10175    3             DO;

     1415    10176    3             T1$=END$;

  10176  1 003646   200027 236100                    LDQ     END$,,AUTO
         1 003647   200033 756100                    STQ     T1$,,AUTO

     1416    10177    3             T2$=START$;

  10177  1 003650   200025 236100                    LDQ     START$,,AUTO
         1 003651   200034 756100                    STQ     T2$,,AUTO

     1417    10178    3             CALL KQZ$LOG (CG$->KQ$CG,%KQLOG_GSMCR,ENTFLAG,T2$,

  10178  1 003652   200044 630500                    EPPR0   DELETE+2,,AUTO
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:216  
         1 003653   200074 450500                    STP0    I$+7,,AUTO
         1 003654   200033 631500                    EPPR1   T1$,,AUTO
         1 003655   200073 451500                    STP1    I$+6,,AUTO
         1 003656   200034 633500                    EPPR3   T2$,,AUTO
         1 003657   200072 453500                    STP3    I$+5,,AUTO
         1 003660   200034 634500                    EPPR4   T2$,,AUTO
         1 003661   200071 454500                    STP4    I$+4,,AUTO
         1 003662   200015 635500                    EPPR5   ENTFLAG,,AUTO
         1 003663   200070 455500                    STP5    I$+3,,AUTO
         1 003664   000045 236000 2                  LDQ     37
         1 003665   200006 235100                    LDA     CG$,,AUTO
         1 003666   200066 757100                    STAQ    I$+1,,AUTO
         1 003667   200066 630500                    EPPR0   I$+1,,AUTO
         1 003670   000025 631400 xsym               EPPR1   B_VECTNIL+21
         1 003671   000000 701000 xent               TSX1    KQZ$LOG
         1 003672   003675 702000 1                  TSX2    s:10183

     1418    10179    3             ADDR(T2$)->B$$HALF,
     1419    10180    3             T1$,SMBLK.DDA) ALTRET(ZA1);
     1420    10181    3             RETURN;

  10181  1 003673   200032 221300                    LDX1  ! KQ$TMLH,,AUTO
         1 003674   000001 702211                    TSX2  ! 1,X1

     1421    10182    3   ZA1:      END;
     1422    10183    2           CALL FILLDBLK (START$,SMBLK);

  10183  1 003675   200036 630500                    EPPR0   SMBLK,,AUTO
         1 003676   200060 450500                    STP0    @MBLK+1,,AUTO
         1 003677   200025 631500                    EPPR1   START$,,AUTO
         1 003700   200057 451500                    STP1    F$+1,,AUTO
         1 003701   003757 701000 1                  TSX1    FILLDBLK
         1 003702   000000 011000                    NOP     0

     1423    10184    2           Z$=START$->KQ$MBLK.LNK$;

  10184  1 003703   200025 470500                    LDP0    START$,,AUTO
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:217  
         1 003704   000000 236100                    LDQ     0,,PR0
         1 003705   200023 756100                    STQ     Z$,,AUTO

     1424    10185    2           SMBLK.LNK$=END$->KQ$MBLK.LNK$;

  10185  1 003706   200027 471500                    LDP1    END$,,AUTO
         1 003707   100000 236100                    LDQ     0,,PR1
         1 003710   200036 756100                    STQ     SMBLK,,AUTO

     1425    10186    3             DO INHIBIT;

     1426    10187    3             END$->KQ$MBLK.LNK$=ADDR(NIL);

  10187  1 003711   000001 236200 xsym               LDQ   ! B_VECTNIL+1
         1 003712   100000 756300                    STQ   ! 0,,PR1

     1427    10188    3             IF SMBLK.LNK$ = ADDR(NIL) THEN

  10188  1 003713   200036 236300                    LDQ   ! SMBLK,,AUTO
         1 003714   000001 116200 xsym               CMPQ  ! B_VECTNIL+1
         1 003715   003721 601200 1                  TNZ   ! s:10190

     1428    10189    3              MLH$->KQ$MLH.TAIL$=START$;

  10189  1 003716   200025 236300                    LDQ   ! START$,,AUTO
         1 003717   200014 470700                    LDP0  ! MLH$,,AUTO
         1 003720   000001 756300                    STQ   ! 1,,PR0

     1429    10190    3             MLH$->KQ$MLH.SUPERCNT=MLH$->KQ$MLH.SUPERCNT+1;

  10190  1 003721   200014 470700                    LDP0  ! MLH$,,AUTO
         1 003722   000004 720300                    LXL0  ! 4,,PR0
         1 003723   000001 621210                    EAX1  ! 1,X0
         1 003724   000004 441300                    SXL1  ! 4,,PR0

     1430    10191    3             START$->KQ$MBLK=SMBLK;

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:218  
  10191  1 003725   200025 470700                    LDP0  ! START$,,AUTO
         1 003726   000100 100700                    MLR   ! fill='000'O
         1 003727   200036 000100                    ADSC9   SMBLK,,AUTO              cn=0,n=64
         1 003730   000000 000100                    ADSC9   0,,PR0                   cn=0,n=64

     1431    10192                  %CHKCNT;

  10193  1 003731   000000 235200 xsym               LDA   ! KQ_DEBUG
         1 003732   003735 600200 1                  TZE   ! s:10195

  10193  1 003733   007316 701200 1                  TSX1  ! CHKMLH
         1 003734   000000 011200                    NOP   ! 0

     1432    10195    4               DO WHILE (Z$ ~= ADDR(NIL));

  10195  1 003735   003747 710200 1                  TRA   ! s:10199

     1433    10196    4               X$=Z$->KQ$MBLK.LNK$;

  10196  1 003736   200023 470700                    LDP0  ! Z$,,AUTO
         1 003737   000000 236300                    LDQ   ! 0,,PR0
         1 003740   200022 756300                    STQ   ! X$,,AUTO

     1434    10197    4               CALL RELMBLK (Z$->KQ$MBLK);

  10197  1 003741   200023 236300                    LDQ   ! Z$,,AUTO
         1 003742   200057 756300                    STQ   ! F$+1,,AUTO
         1 003743   007545 701200 1                  TSX1  ! RELMBLK
         1 003744   000000 011200                    NOP   ! 0

     1435    10198    4               Z$=X$;

  10198  1 003745   200022 236300                    LDQ   ! X$,,AUTO
         1 003746   200023 756300                    STQ   ! Z$,,AUTO

     1436    10199    4               END;

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:219  
  10199  1 003747   200023 236300                    LDQ   ! Z$,,AUTO
         1 003750   000001 116200 xsym               CMPQ  ! B_VECTNIL+1
         1 003751   003736 601200 1                  TNZ   ! s:10196

     1437    10200    3             CALL UNLOCK;

  10200  1 003752   007454 701200 1                  TSX1  ! UNLOCK
         1 003753   000000 011200                    NOP   ! 0

     1438    10201    3             RETURN;

  10201  1 003754   200032 221300                    LDX1  ! KQ$TMLH,,AUTO
         1 003755   000001 702211                    TSX2  ! 1,X1

     1439    10202    3             END;

     1440    10203    2   END DUMPLIST;

  10203  1 003756   000001 702211                    TSX2  ! 1,X1

     1441    10204        /********************************************************
     1442    10205        *********************************************************/
     1443    10206        /**/
     1444    10207        /*D* NAME:         FILLDBLK
     1445    10208             PURPOSE:      To fill a DBLK with a list of MBLKs
     1446    10209             DESCRIPTION:  START$ is the first in the list, NMBLKS is
     1447    10210                           the count.  SMBLK is a place to make the
     1448    10211                           super MBLK.  The data block is filled but
     1449    10212                           not unlocked.
     1450    10213        */
     1451    10214    1   FILLDBLK: PROC (START$,SMBLK);

  10214  1 003757   200056 741300       FILLDBLK     STX1  ! @MBLK+1,,AUTO

     1452    10215        /**/
     1453    10216    2   DCL START$ PTR;
     1454    10217        %KQ_MBLK (FPTN=SMBLK,STCLASS="",SUPR=1);
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:220  
     1455    10487    2   DCL BLOTTO UBIN;
     1456    10488        /**/
     1457    10489    2           SMBLK=KQ_ISMBLK;

  10489  1 003760   200060 470500                    LDP0    @SMBLK,,AUTO
         1 003761   000100 100400                    MLR     fill='000'O
         1 003762   000000 000100 0                  ADSC9   KQ_ISMBLK                cn=0,n=64
         1 003763   000000 000100                    ADSC9   0,,PR0                   cn=0,n=64

     1458    10490    2           SMBLK.SUPER  ='1'B;

  10490  1 003764   400000 236003                    LDQ     -131072,DU
         1 003765   000010 256100                    ORSQ    8,,PR0

     1459    10491    2           SMBLK.DDA    =DDA;

  10491  1 003766   200013 235100                    LDA     DDA,,AUTO
         1 003767   000006 755100                    STA     6,,PR0

     1460    10492    2           SMBLK.PCVALID='1'B;

  10492  1 003770   010000 236003                    LDQ     4096,DU
         1 003771   000010 256100                    ORSQ    8,,PR0

     1461    10493    2           SMBLK.KEY1   =START$->KQ$MBLK.KEY1;

  10493  1 003772   200057 471500                    LDP1    @START$,,AUTO
         1 003773   100000 473500                    LDP3    0,,PR1
         1 003774   300002 237100                    LDAQ    2,,PR3
         1 003775   000002 757100                    STAQ    2,,PR0

     1462    10494    2           SMBLK.KEY2   =START$->KQ$MBLK.KEY2;

  10494  1 003776   100000 473500                    LDP3    0,,PR1
         1 003777   300004 237100                    LDAQ    4,,PR3
         1 004000   000004 757100                    STAQ    4,,PR0

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:221  
     1463    10495    2           SMBLK.PRIO   =START$->KQ$MBLK.PRIO;

  10495  1 004001   100000 473500                    LDP3    0,,PR1
         1 004002   300001 220100                    LDX0    1,,PR3
         1 004003   000001 740100                    STX0    1,,PR0

     1464    10496    2           SMBLK.UTS    =START$->KQ$MBLK.UTS;

  10496  1 004004   100000 473500                    LDP3    0,,PR1
         1 004005   300007 235100                    LDA     7,,PR3
         1 004006   000007 755100                    STA     7,,PR0

     1465    10497    2           SMBLK.UTSXTLO=START$->KQ$MBLK.STAMP;

  10497  1 004007   100000 473500                    LDP3    0,,PR1
         1 004010   300001 721100                    LXL1    1,,PR3
         1 004011   000014 741100                    STX1    12,,PR0

     1466    10498    2           SMBLK.COUNT  =NMBLKS;

  10498  1 004012   200021 235100                    LDA     NMBLKS,,AUTO
         1 004013   000015 755100                    STA     13,,PR0

     1467    10499    2           SMBLK.FIRSTX =0;

  10499  1 004014   000013 450100                    STZ     11,,PR0

     1468    10500    2           CALL SSS$XSYSTIME (BLOTTO,I);

  10500  1 004015   200012 633500                    EPPR3   I,,AUTO
         1 004016   200067 453500                    STP3    I$+2,,AUTO
         1 004017   200061 634500                    EPPR4   BLOTTO,,AUTO
         1 004020   200066 454500                    STP4    I$+1,,AUTO
         1 004021   200066 630500                    EPPR0   I$+1,,AUTO
         1 004022   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 004023   000000 701000 xent               TSX1    SSS$XSYSTIME
         1 004024   000000 011000                    NOP     0
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:222  

     1469    10501    2           SMBLK.STAMP=I;

  10501  1 004025   200012 720100                    LXL0    I,,AUTO
         1 004026   200060 470500                    LDP0    @SMBLK,,AUTO
         1 004027   000001 440100                    SXL0    1,,PR0

     1470    10502    2           Z$=PINCRW(DBLK$,SIZEW(KQ$DBLK));

  10502  1 004030   200011 236100                    LDQ     DBLK$,,AUTO
         1 004031   000006 036003                    ADLQ    6,DU
         1 004032   200023 756100                    STQ     Z$,,AUTO

     1471    10503    2           X$=START$;

  10503  1 004033   200057 471500                    LDP1    @START$,,AUTO
         1 004034   100000 236100                    LDQ     0,,PR1
         1 004035   200022 756100                    STQ     X$,,AUTO

     1472    10504    3             DO I = 1 TO NMBLKS;

  10504  1 004036   000001 235007                    LDA     1,DL
         1 004037   200012 755100                    STA     I,,AUTO
         1 004040   004072 710000 1                  TRA     s:10510+1

     1473    10505    3             Z$->KQ$MBLK=X$->KQ$MBLK;

  10505  1 004041   200022 470500                    LDP0    X$,,AUTO
         1 004042   200023 471500                    LDP1    Z$,,AUTO
         1 004043   000100 100500                    MLR     fill='000'O
         1 004044   000000 000100                    ADSC9   0,,PR0                   cn=0,n=64
         1 004045   100000 000100                    ADSC9   0,,PR1                   cn=0,n=64

     1474    10506    3             IF X$->KQ$MBLK.KEY1 ~= SMBLK.KEY1 THEN SMBLK.KEY1ALL = '0'B;

  10506  1 004046   200060 470500                    LDP0    @SMBLK,,AUTO
         1 004047   200022 473500                    LDP3    X$,,AUTO
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:223  
         1 004050   300002 237100                    LDAQ    2,,PR3
         1 004051   000002 117100                    CMPAQ   2,,PR0
         1 004052   004055 600000 1                  TZE     s:10507

  10506  1 004053   000017 236000 2                  LDQ     15
         1 004054   000010 356100                    ANSQ    8,,PR0

     1475    10507    3             IF X$->KQ$MBLK.KEY2 ~= SMBLK.KEY2 THEN SMBLK.KEY2ALL = '0'B;

  10507  1 004055   200022 473500                    LDP3    X$,,AUTO
         1 004056   300004 237100                    LDAQ    4,,PR3
         1 004057   000004 117100                    CMPAQ   4,,PR0
         1 004060   004063 600000 1                  TZE     s:10508

  10507  1 004061   000037 236000 2                  LDQ     31
         1 004062   000010 356100                    ANSQ    8,,PR0

     1476    10508    3             Z$=PINCRW(Z$,SIZEW(KQ$MBLK));

  10508  1 004063   200023 236100                    LDQ     Z$,,AUTO
         1 004064   000020 036003                    ADLQ    16,DU
         1 004065   200023 756100                    STQ     Z$,,AUTO

     1477    10509    3             X$=X$->KQ$MBLK.LNK$;

  10509  1 004066   200022 471500                    LDP1    X$,,AUTO
         1 004067   100000 236100                    LDQ     0,,PR1
         1 004070   200022 756100                    STQ     X$,,AUTO

     1478    10510    3             END;

  10510  1 004071   200012 054100                    AOS     I,,AUTO
         1 004072   200012 236100                    LDQ     I,,AUTO
         1 004073   200021 116100                    CMPQ    NMBLKS,,AUTO
         1 004074   004041 604400 1                  TMOZ    s:10505

     1479    10511    2           SMBLK.PRIOLO =PINCRW(Z$,-SIZEW(KQ$MBLK))->KQ$MBLK.PRIO;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:224  

  10511  1 004075   200023 471500                    LDP1    Z$,,AUTO
         1 004076   177761 220100                    LDX0    -15,,PR1
         1 004077   000010 440100                    SXL0    8,,PR0

     1480    10512    2           SMBLK.UTSHI  =PINCRW(Z$,-SIZEW(KQ$MBLK))->KQ$MBLK.UTS;

  10512  1 004100   177767 235100                    LDA     -9,,PR1
         1 004101   000011 755100                    STA     9,,PR0

     1481    10513    2           SMBLK.UTSXTHI=PINCRW(Z$,-SIZEW(KQ$MBLK))->KQ$MBLK.STAMP;

  10513  1 004102   177761 721100                    LXL1    -15,,PR1
         1 004103   000014 441100                    SXL1    12,,PR0

     1482    10514    2           CTLBLK$=PINCRW(DBLK$,DBLK$->KQ$DBLK.SIZW-SIZEW(KQ$MBLK));

  10514  1 004104   200011 473500                    LDP3    DBLK$,,AUTO
         1 004105   300004 222100                    LDX2    4,,PR3
         1 004106   777760 636012                    EAQ     -16,X2
         1 004107   200011 036100                    ADLQ    DBLK$,,AUTO
         1 004110   200026 756100                    STQ     CTLBLK$,,AUTO

     1483    10515    2           CTLBLK$->KQ$MBLK=SMBLK;

  10515  1 004111   200026 474500                    LDP4    CTLBLK$,,AUTO
         1 004112   000100 100500                    MLR     fill='000'O
         1 004113   000000 000100                    ADSC9   0,,PR0                   cn=0,n=64
         1 004114   400000 000100                    ADSC9   0,,PR4                   cn=0,n=64

     1484    10516    2           DBLK$->KQ$DBLK.MBLK='1'B;

  10516  1 004115   200011 473500                    LDP3    DBLK$,,AUTO
         1 004116   000020 236003                    LDQ     16,DU
         1 004117   300003 256100                    ORSQ    3,,PR3

     1485    10517    2           DBLK$->KQ$DBLK.STAMP=SMBLK.STAMP;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:225  

  10517  1 004120   000001 720100                    LXL0    1,,PR0
         1 004121   200011 473500                    LDP3    DBLK$,,AUTO
         1 004122   300000 740100                    STX0    0,,PR3

     1486    10518    2           DBLK$->KQ$DBLK.DSIZE=NMBLKS*SIZEC(KQ$MBLK);

  10518  1 004123   200021 235100                    LDA     NMBLKS,,AUTO
         1 004124   000006 735000                    ALS     6
         1 004125   000000 620005                    EAX0    0,AL
         1 004126   200011 473500                    LDP3    DBLK$,,AUTO
         1 004127   300000 440100                    SXL0    0,,PR3

     1487    10519    2           RETURN;

  10519  1 004130   200056 221300                    LDX1  ! @MBLK+1,,AUTO
         1 004131   000001 702211                    TSX2  ! 1,X1

     1488    10520    2   END FILLDBLK;
     1489    10521        /********************************************************
     1490    10522        *********************************************************/
     1491    10523        /**/
     1492    10524        /*D* NAME:         GETLIST
     1493    10525             PURPOSE:      To find a sub-list of MBLKS
     1494    10526             DESCRIPTION:  Finds a sub-list of MBLKs that are all
     1495    10527                           ordinary, of len >= 2.
     1496    10528                           ALTRETs if none
     1497    10529             OUTPUT:       START$ is first one
     1498    10530                           END$ is last one
     1499    10531                           NMBLKS is count
     1500    10532        */
     1501    10533    1   GETLIST: PROC ALTRET;

  10533  1 004132   200032 741300       GETLIST      STX1  ! KQ$TMLH,,AUTO

     1502    10534        /**/
     1503    10535    2           MBLK$=MLH$->KQ$MLH.HEAD$;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:226  

  10535  1 004133   200014 470500                    LDP0    MLH$,,AUTO
         1 004134   000000 236100                    LDQ     0,,PR0
         1 004135   200005 756100                    STQ     MBLK$,,AUTO

     1504    10536    2           NMBLKS = 0;

  10536  1 004136   200021 450100                    STZ     NMBLKS,,AUTO

     1505    10537    3             DO WHILE (MBLK$ ~= ADDR(NIL));

  10537  1 004137   004173 710000 1                  TRA     s:10550

     1506    10538    3             IF MBLK$->KQ$MBLK.SUPER

  10538  1 004140   200005 470500                    LDP0    MBLK$,,AUTO
         1 004141   000010 234100                    SZN     8,,PR0
         1 004142   004146 604000 1                  TMI     s:10541
         1 004143   000010 236100                    LDQ     8,,PR0
         1 004144   000100 316007                    CANQ    64,DL
         1 004145   004155 600000 1                  TZE     s:10544

     1507    10539    3             OR MBLK$->KQ$NRMLMBLK.RBLK
     1508    10540    3             THEN
     1509    10541    3              IF NMBLKS >= 2 THEN RETURN;

  10541  1 004146   200021 235100                    LDA     NMBLKS,,AUTO
         1 004147   000002 115007                    CMPA    2,DL
         1 004150   004153 604000 1                  TMI     s:10542

  10541  1 004151   200032 221300                    LDX1  ! KQ$TMLH,,AUTO
         1 004152   000001 702211                    TSX2  ! 1,X1

     1510    10542    3              ELSE NMBLKS = 0;

  10542  1 004153   200021 450100                    STZ     NMBLKS,,AUTO
         1 004154   004171 710000 1                  TRA     s:10549
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:227  

     1511    10543    4             ELSE DO;

     1512    10544    4               IF NMBLKS = 0 THEN START$ = MBLK$;

  10544  1 004155   200021 235100                    LDA     NMBLKS,,AUTO
         1 004156   004161 601000 1                  TNZ     s:10545

  10544  1 004157   200005 236100                    LDQ     MBLK$,,AUTO
         1 004160   200025 756100                    STQ     START$,,AUTO

     1513    10545    4               END$ = MBLK$;

  10545  1 004161   200005 236100                    LDQ     MBLK$,,AUTO
         1 004162   200027 756100                    STQ     END$,,AUTO

     1514    10546    4               NMBLKS = NMBLKS + 1;

  10546  1 004163   200021 054100                    AOS     NMBLKS,,AUTO

     1515    10547    4               IF NMBLKS = %KQ_MMPS# THEN RETURN;

  10547  1 004164   200021 235100                    LDA     NMBLKS,,AUTO
         1 004165   000035 115007                    CMPA    29,DL
         1 004166   004171 601000 1                  TNZ     s:10549

  10547  1 004167   200032 221300                    LDX1  ! KQ$TMLH,,AUTO
         1 004170   000001 702211                    TSX2  ! 1,X1

     1516    10548    4               END;
     1517    10549    3             MBLK$ = MBLK$->KQ$MBLK.LNK$;

  10549  1 004171   000000 236100                    LDQ     0,,PR0
         1 004172   200005 756100                    STQ     MBLK$,,AUTO

     1518    10550    3             END;  /* do while */

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:228  
  10550  1 004173   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 004174   004140 601000 1                  TNZ     s:10538

     1519    10551    2           IF NMBLKS < 2 THEN ALTRETURN;

  10551  1 004175   200021 235100                    LDA     NMBLKS,,AUTO
         1 004176   000002 115007                    CMPA    2,DL
         1 004177   004202 605000 1                  TPL     s:10552

  10551  1 004200   200032 221300                    LDX1  ! KQ$TMLH,,AUTO
         1 004201   000000 702211                    TSX2  ! 0,X1

     1520    10552    2           RETURN;

  10552  1 004202   200032 221300                    LDX1  ! KQ$TMLH,,AUTO
         1 004203   000001 702211                    TSX2  ! 1,X1

     1521    10553        /**/
     1522    10554        /*D* NAME:         GETSLIST
     1523    10555             PURPOSE:      To find 2 adjacent super MBLKs
     1524    10556        */
     1525    10557    2   GETSLIST: ENTRY ALTRET;

  10557  1 004204   200032 741300       GETSLIST     STX1  ! KQ$TMLH,,AUTO

     1526    10558        /**/
     1527    10559    2           MBLK$=MLH$->KQ$MLH.HEAD$;

  10559  1 004205   200014 470500                    LDP0    MLH$,,AUTO
         1 004206   000000 236100                    LDQ     0,,PR0
         1 004207   200005 756100                    STQ     MBLK$,,AUTO

     1528    10560    2   GS0:    IF MBLK$ = ADDR(NIL) THEN ALTRETURN;

  10560  1 004210   200005 236100       GS0          LDQ     MBLK$,,AUTO
         1 004211   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 004212   004215 601000 1                  TNZ     s:10561
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:229  

  10560  1 004213   200032 221300                    LDX1  ! KQ$TMLH,,AUTO
         1 004214   000000 702211                    TSX2  ! 0,X1

     1529    10561    2           IF NOT MBLK$->KQ$MBLK.SUPER THEN

  10561  1 004215   200005 470500                    LDP0    MBLK$,,AUTO
         1 004216   000010 234100                    SZN     8,,PR0
         1 004217   004230 604000 1                  TMI     s:10568

     1530    10562    2            IF MBLK$ = MLH$->KQ$MLH.HEAD$ THEN

  10562  1 004220   200014 471500                    LDP1    MLH$,,AUTO
         1 004221   100000 116100                    CMPQ    0,,PR1
         1 004222   004226 601000 1                  TNZ     s:10567

     1531    10563    3              DO;

     1532    10564    3              MBLK$=MBLK$->KQ$MBLK.LNK$;

  10564  1 004223   000000 236100                    LDQ     0,,PR0
         1 004224   200005 756100                    STQ     MBLK$,,AUTO

     1533    10565    3              GOTO GS0;

  10565  1 004225   004210 710000 1                  TRA     GS0

     1534    10566    3              END;
     1535    10567    2            ELSE CALL SC_CGGARB;

  10567  1 004226   000000 713400 xsym               CLIMB   SC_CGGARB
         1 004227   000000 600000 xsid               climb   nvectors=         0

     1536    10568    2           IF MBLK$->KQ$MBLK.LNK$ = ADDR(NIL) THEN ALTRETURN;

  10568  1 004230   200005 470500                    LDP0    MBLK$,,AUTO
         1 004231   000000 236100                    LDQ     0,,PR0
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:230  
         1 004232   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 004233   004236 601000 1                  TNZ     s:10569

  10568  1 004234   200032 221300                    LDX1  ! KQ$TMLH,,AUTO
         1 004235   000000 702211                    TSX2  ! 0,X1

     1537    10569    2           END$=MBLK$->KQ$MBLK.LNK$;

  10569  1 004236   200027 756100                    STQ     END$,,AUTO

     1538    10570    2           IF NOT END$->KQ$MBLK.SUPER THEN CALL SC_CGGARB;

  10570  1 004237   200027 471500                    LDP1    END$,,AUTO
         1 004240   100010 234100                    SZN     8,,PR1
         1 004241   004244 604000 1                  TMI     s:10576

  10570  1 004242   000000 713400 xsym               CLIMB   SC_CGGARB
         1 004243   000000 600000 xsid               climb   nvectors=         0

     1539    10571        /*S* SCREECH_CODE: KQS-S$CGGARB
     1540    10572             TYPE:         SCREECH
     1541    10573             MESSAGE:      COMGROUP garbage collection error
     1542    10574             REMARKS:      An irrecoverable inconsistency has occurred
     1543    10575                           during comgroup garbage collection. */
     1544    10576    2           IF END$->KQ$MBLK.STATE ~= KQSS_IDLE# THEN

  10576  1 004244   200027 470500                    LDP0    END$,,AUTO
         1 004245   000010 236100                    LDQ     8,,PR0
         1 004246   007000 316003                    CANQ    3584,DU
         1 004247   004253 600000 1                  TZE     s:10581

     1545    10577    3             DO;

     1546    10578    3             MBLK$=END$;

  10578  1 004250   200027 236100                    LDQ     END$,,AUTO
         1 004251   200005 756100                    STQ     MBLK$,,AUTO
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:231  

     1547    10579    3             GOTO GS0;

  10579  1 004252   004210 710000 1                  TRA     GS0

     1548    10580    3             END;
     1549    10581    2           NMBLKS=2;

  10581  1 004253   000002 235007                    LDA     2,DL
         1 004254   200021 755100                    STA     NMBLKS,,AUTO

     1550    10582    2           RETURN;

  10582  1 004255   200032 221300                    LDX1  ! KQ$TMLH,,AUTO
         1 004256   000001 702211                    TSX2  ! 1,X1

     1551    10583    2   END GETLIST;
     1552    10584        /********************************************************
     1553    10585        *********************************************************/
     1554    10586        /**/
     1555    10587        /*D* NAME:         GETDBLK
     1556    10588             PURPOSE:      To allocate a data block
     1557    10589             DESCRIPTION:  A data block big enuff for
     1558    10590                              MAX (NMBLKS,%KQ_MMPS#)
     1559    10591                           MBLKs is allocated.  If immediately successful,
     1560    10592                           RETURNs with DDA, DBLK$.  Else ALTRETURNs with
     1561    10593                           DDA = KQDE_NSPC or KQDE_NDFRBLK (having
     1562    10594                           already called SQUISHX if no defer block was
     1563    10595                           obtained.)  Else (got a defer block), defers
     1564    10596                           the process with the passed defer code and
     1565    10597                           ALTRETURNs with DBLK$ ~= ADDR(NIL);
     1566    10598
     1567    10599                           CLKDFR is the defer code to use if no defer
     1568    10600                           blocks are available, DFR is what to use if
     1569    10601                           one was available.
     1570    10602        */
     1571    10603    1   GETDBLK: PROC (DFR,CLKDFR) ALTRET;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:232  

  10603  1 004257   200054 741300       GETDBLK      STX1  ! DELETE+10,,AUTO

     1572    10604        /**/
     1573    10605    2   DCL DFR SBIN;
     1574    10606    2   DCL CLKDFR SBIN;
     1575    10607        /**/
     1576    10608    2           DDA=NMBLKS;

  10608  1 004260   200021 235100                    LDA     NMBLKS,,AUTO
         1 004261   200013 755100                    STA     DDA,,AUTO

     1577    10609    2           IF DDA > %KQ_MMPS# THEN DDA=%KQ_MMPS#;

  10609  1 004262   000036 115007                    CMPA    30,DL
         1 004263   004266 602000 1                  TNC     s:10610

  10609  1 004264   000035 236007                    LDQ     29,DL
         1 004265   200013 756100                    STQ     DDA,,AUTO

     1578    10610    2           DDA=(DDA+1)*SIZEC(KQ$MBLK); /* Leave space for REDUNDANT */

  10610  1 004266   200013 236100                    LDQ     DDA,,AUTO
         1 004267   000006 736000                    QLS     6
         1 004270   000100 036007                    ADLQ    64,DL
         1 004271   200013 756100                    STQ     DDA,,AUTO

     1579    10611    2           CALL KQD$GET (CG$->KQ$CG,DBLK$,DDA) ALTRET(G1);

  10611  1 004272   200013 630500                    EPPR0   DDA,,AUTO
         1 004273   200070 450500                    STP0    I$+3,,AUTO
         1 004274   200011 631500                    EPPR1   DBLK$,,AUTO
         1 004275   200067 451500                    STP1    I$+2,,AUTO
         1 004276   200006 236100                    LDQ     CG$,,AUTO
         1 004277   200066 756100                    STQ     I$+1,,AUTO
         1 004300   200066 630500                    EPPR0   I$+1,,AUTO
         1 004301   000021 631400 xsym               EPPR1   B_VECTNIL+17
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:233  
         1 004302   000000 701000 xent               TSX1    KQD$GET
         1 004303   004306 702000 1                  TSX2    G1

     1580    10612    2           RETURN;

  10612  1 004304   200054 221300                    LDX1  ! DELETE+10,,AUTO
         1 004305   000001 702211                    TSX2  ! 1,X1

     1581    10613    2   G1:     IF DBLK$ ~= ADDR(NIL) THEN

  10613  1 004306   200011 236100       G1           LDQ     DBLK$,,AUTO
         1 004307   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 004310   004341 600000 1                  TZE     s:10623

     1582    10614    3             DO; /* Got a defer block */

     1583    10615    3             DBLK$->KQ$DFRBLK.INFO$=CG$;

  10615  1 004311   200006 236100                    LDQ     CG$,,AUTO
         1 004312   200011 470500                    LDP0    DBLK$,,AUTO
         1 004313   000006 756100                    STQ     6,,PR0

     1584    10616    3             KQ$GARB.DELAY=-DFR;

  10616  1 004314   200055 470500                    LDP0    @DFR,,AUTO
         1 004315   200006 471500                    LDP1    CG$,,AUTO
         1 004316   000000 235100                    LDA     0,,PR0
         1 004317   000000 531000                    NEG     0
         1 004320   100031 755100                    STA     25,,PR1

     1585    10617    3             CALL SQUISHX;

  10617  1 004321   003517 701000 1                  TSX1    SQUISHX
         1 004322   000000 011000                    NOP     0

     1586    10618    3             CALL KQD$DEFERGO (CG$->KQ$CG,DBLK$,ENTADDR(KQS$GCONT));

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:234  
  10618  1 004323   003355 636000 1                  EAQ     s:9758
         1 004324   200066 756100                    STQ     I$+1,,AUTO
         1 004325   200066 630500                    EPPR0   I$+1,,AUTO
         1 004326   200071 450500                    STP0    I$+4,,AUTO
         1 004327   200011 631500                    EPPR1   DBLK$,,AUTO
         1 004330   200070 451500                    STP1    I$+3,,AUTO
         1 004331   200006 236100                    LDQ     CG$,,AUTO
         1 004332   200067 756100                    STQ     I$+2,,AUTO
         1 004333   200067 630500                    EPPR0   I$+2,,AUTO
         1 004334   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 004335   000000 701000 xent               TSX1    KQD$DEFERGO
         1 004336   000000 011000                    NOP     0

     1587    10619    3             ALTRETURN;

  10619  1 004337   200054 221300                    LDX1  ! DELETE+10,,AUTO
         1 004340   000000 702211                    TSX2  ! 0,X1

     1588    10620    3             END;
     1589    10621        /**/
     1590    10622                      /* Error */
     1591    10623    3             DO CASE (DDA);

  10623  1 004341   200013 235100                    LDA     DDA,,AUTO
         1 004342   000013 115007                    CMPA    11,DL
         1 004343   004345 602005 1                  TNC     s:10623+4,AL
         1 004344   004372 710000 1                  TRA     s:10634
         1 004345   004372 710000 1                  TRA     s:10634
         1 004346   004372 710000 1                  TRA     s:10634
         1 004347   004370 710000 1                  TRA     s:10631
         1 004350   004372 710000 1                  TRA     s:10634
         1 004351   004372 710000 1                  TRA     s:10634
         1 004352   004372 710000 1                  TRA     s:10634
         1 004353   004372 710000 1                  TRA     s:10634
         1 004354   004372 710000 1                  TRA     s:10634
         1 004355   004372 710000 1                  TRA     s:10634
         1 004356   004372 710000 1                  TRA     s:10634
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:235  
         1 004357   004360 710000 1                  TRA     s:10626

     1592    10624
     1593    10625    3               CASE (%KQDE_NDFRBLK); /* No defer blocks */

     1594    10626    3                 CALL SQUISHX;

  10626  1 004360   003517 701000 1                  TSX1    SQUISHX
         1 004361   000000 011000                    NOP     0

     1595    10627    3                 KQ$GARB.DELAY=CLKDFR;

  10627  1 004362   200056 470500                    LDP0    @CLKDFR,,AUTO
         1 004363   200006 471500                    LDP1    CG$,,AUTO
         1 004364   000000 235100                    LDA     0,,PR0
         1 004365   100031 755100                    STA     25,,PR1

     1596    10628    3                 ALTRETURN;

  10628  1 004366   200054 221300                    LDX1  ! DELETE+10,,AUTO
         1 004367   000000 702211                    TSX2  ! 0,X1

     1597    10629
     1598    10630    3               CASE (%KQDE_NSPC);

     1599    10631    3                 ALTRETURN;

  10631  1 004370   200054 221300                    LDX1  ! DELETE+10,,AUTO
         1 004371   000000 702211                    TSX2  ! 0,X1

     1600    10632
     1601    10633    3               CASE (ELSE);

     1602    10634    3                 CALL SC_CGGARB;

  10634  1 004372   000000 713400 xsym               CLIMB   SC_CGGARB
         1 004373   000000 600000 xsid               climb   nvectors=         0
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:236  

     1603    10635
     1604    10636    3             END;

     1605    10637    2   END GETDBLK;

  10637  1 004374   200054 221300                    LDX1  ! DELETE+10,,AUTO
         1 004375   000001 702211                    TSX2  ! 1,X1

     1606    10638        /********************************************************
     1607    10639        *********************************************************/
     1608    10640        /**/
     1609    10641        /*D* NAME:         CONCATN
     1610    10642             PURPOSE:      To merge a super and normal MBLK
     1611    10643             DESCRIPTION:  MBLK$ is the super MBLK, END$ is its flink
     1612    10644                           and is normal.  END$ is placed on the tail
     1613    10645                           of MBLK$'s INSHD$ list, and removed from
     1614    10646                           the MLH chain.
     1615    10647        */
     1616    10648    1   CONCATN: PROC;

  10648  1 004376   200030 741300       CONCATN      STX1  ! END$+1,,AUTO

     1617    10649        /**/
     1618    10650    3             DO INHIBIT;

     1619    10651    3             MBLK$->KQ$MBLK.LNK$=END$->KQ$MBLK.LNK$;

  10651  1 004377   200027 470700                    LDP0  ! END$,,AUTO
         1 004400   000000 236300                    LDQ   ! 0,,PR0
         1 004401   200005 471700                    LDP1  ! MBLK$,,AUTO
         1 004402   100000 756300                    STQ   ! 0,,PR1

     1620    10652    3             IF MBLK$->KQ$MBLK.LNK$ = ADDR(NIL) THEN MLH$->KQ$MLH.TAIL$=MBLK$;

  10652  1 004403   000001 116200 xsym               CMPQ  ! B_VECTNIL+1
         1 004404   004410 601200 1                  TNZ   ! s:10653
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:237  

  10652  1 004405   200005 236300                    LDQ   ! MBLK$,,AUTO
         1 004406   200014 473700                    LDP3  ! MLH$,,AUTO
         1 004407   300001 756300                    STQ   ! 1,,PR3

     1621    10653    3             END$->KQ$MBLK.LNK$=ADDR(NIL);

  10653  1 004410   000001 236200 xsym               LDQ   ! B_VECTNIL+1
         1 004411   000000 756300                    STQ   ! 0,,PR0

     1622    10654    3             IF MBLK$->KQ$MBLK.INSHD$ = ADDR(NIL) THEN

  10654  1 004412   100012 236300                    LDQ   ! 10,,PR1
         1 004413   000001 116200 xsym               CMPQ  ! B_VECTNIL+1
         1 004414   004420 601200 1                  TNZ   ! s:10658

     1623    10655    3              MBLK$->KQ$MBLK.INSHD$=END$;

  10655  1 004415   200027 236300                    LDQ   ! END$,,AUTO
         1 004416   100012 756300                    STQ   ! 10,,PR1
         1 004417   004433 710200 1                  TRA   ! s:10664

     1624    10656    3             ELSE
     1625    10657    4               DO;

     1626    10658    4               P$=MBLK$->KQ$MBLK.INSHD$;

  10658  1 004420   200007 756300                    STQ   ! P$,,AUTO

     1627    10659    5                 DO WHILE (P$->KQ$MBLK.LNK$ ~= ADDR(NIL));

  10659  1 004421   004425 710200 1                  TRA   ! s:10661

     1628    10660    5                 P$=P$->KQ$MBLK.LNK$;

  10660  1 004422   200007 470700                    LDP0  ! P$,,AUTO
         1 004423   000000 236300                    LDQ   ! 0,,PR0
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:238  
         1 004424   200007 756300                    STQ   ! P$,,AUTO

     1629    10661    5                 END;

  10661  1 004425   200007 470700                    LDP0  ! P$,,AUTO
         1 004426   000000 236300                    LDQ   ! 0,,PR0
         1 004427   000001 116200 xsym               CMPQ  ! B_VECTNIL+1
         1 004430   004422 601200 1                  TNZ   ! s:10660

     1630    10662    4               P$->KQ$MBLK.LNK$=END$;

  10662  1 004431   200027 236300                    LDQ   ! END$,,AUTO
         1 004432   000000 756300                    STQ   ! 0,,PR0

     1631    10663    4               END;

     1632    10664    3             MBLK$->KQ$MBLK.UTSHI=END$->KQ$MBLK.UTS;

  10664  1 004433   200027 470700                    LDP0  ! END$,,AUTO
         1 004434   200005 471700                    LDP1  ! MBLK$,,AUTO
         1 004435   000007 235300                    LDA   ! 7,,PR0
         1 004436   100011 755300                    STA   ! 9,,PR1

     1633    10665    3             MBLK$->KQ$MBLK.PRIOLO=END$->KQ$MBLK.PRIO;

  10665  1 004437   000001 220300                    LDX0  ! 1,,PR0
         1 004440   100010 440300                    SXL0  ! 8,,PR1

     1634    10666    3             END;

     1635    10667    2           RETURN;

  10667  1 004441   200030 221300                    LDX1  ! END$+1,,AUTO
         1 004442   000001 702211                    TSX2  ! 1,X1

     1636    10668    2   END CONCATN;
     1637    10669        /********************************************************
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:239  
     1638    10670        *********************************************************/
     1639    10671        /**/
     1640    10672        /*D* NAME:         CONCATS
     1641    10673             PURPOSE:      To concatenate 2 super MBLKS
     1642    10674             INPUT:        MBLK$ = first MBLK
     1643    10675                           KQ$GARB.MBLK$ = MBLK$
     1644    10676             DESCRIPTION:  The last DBLK of the first is flinked to the
     1645    10677                           FDA of the 2nd, which is blinked to the former.
     1646    10678                           Neither have INSHD$ lists.  Finally the second
     1647    10679                           super MBLK is deleted.
     1648    10680        */
     1649    10681    1   CONCATS: PROC ALTRET;

  10681  1 004443   200030 741300       CONCATS      STX1  ! END$+1,,AUTO

     1650    10682        /**/
     1651    10683    2   DCL T1$ PTR;
     1652    10684    2   DCL T2$ PTR;
     1653    10685        /**/
     1654    10686    2           KQ$GARB.CONERR='0'B;

  10686  1 004444   200006 470500                    LDP0    CG$,,AUTO
         1 004445   000014 236000 2                  LDQ     12
         1 004446   000032 356100                    ANSQ    26,,PR0

     1655    10687    2           END$=MBLK$->KQ$MBLK.LNK$;

  10687  1 004447   200005 471500                    LDP1    MBLK$,,AUTO
         1 004450   100000 236100                    LDQ     0,,PR1
         1 004451   200027 756100                    STQ     END$,,AUTO

     1656    10688    2           IF KQ_LOG.GARB THEN

  10688  1 004452   000000 236000 xsym               LDQ     KQ_LOG
         1 004453   200000 316003                    CANQ    65536,DU
         1 004454   004503 600000 1                  TZE     s:10695

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:240  
     1657    10689    3             DO;

     1658    10690    3             T1$=MBLK$;

  10690  1 004455   200005 236100                    LDQ     MBLK$,,AUTO
         1 004456   200031 756100                    STQ     T1$,,AUTO

     1659    10691    3             T2$=END$;

  10691  1 004457   200027 236100                    LDQ     END$,,AUTO
         1 004460   200032 756100                    STQ     T2$,,AUTO

     1660    10692    3             CALL KQZ$LOG (CG$->KQ$CG,%KQLOG_GCON,ENTFLAG,0,0,T1$,T2$) ALTRET(ZA1);

  10692  1 004461   200032 633500                    EPPR3   T2$,,AUTO
         1 004462   200074 453500                    STP3    I$+7,,AUTO
         1 004463   200031 634500                    EPPR4   T1$,,AUTO
         1 004464   200073 454500                    STP4    I$+6,,AUTO
         1 004465   000001 236000 2                  LDQ     1
         1 004466   200072 756100                    STQ     I$+5,,AUTO
         1 004467   200071 756100                    STQ     I$+4,,AUTO
         1 004470   200015 635500                    EPPR5   ENTFLAG,,AUTO
         1 004471   200070 455500                    STP5    I$+3,,AUTO
         1 004472   000047 236000 2                  LDQ     39
         1 004473   200006 235100                    LDA     CG$,,AUTO
         1 004474   200066 757100                    STAQ    I$+1,,AUTO
         1 004475   200066 630500                    EPPR0   I$+1,,AUTO
         1 004476   000025 631400 xsym               EPPR1   B_VECTNIL+21
         1 004477   000000 701000 xent               TSX1    KQZ$LOG
         1 004500   004503 702000 1                  TSX2    s:10695

     1661    10693    3             RETURN;

  10693  1 004501   200030 221300                    LDX1  ! END$+1,,AUTO
         1 004502   000001 702211                    TSX2  ! 1,X1

     1662    10694    3   ZA1:      END;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:241  
     1663    10695    2           IF MBLK$->KQ$MBLK.INSHD$ ~= ADDR(NIL)

  10695  1 004503   200005 470500                    LDP0    MBLK$,,AUTO
         1 004504   000012 236100                    LDQ     10,,PR0
         1 004505   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 004506   004513 601000 1                  TNZ     s:10697
         1 004507   200027 471500                    LDP1    END$,,AUTO
         1 004510   100012 236100                    LDQ     10,,PR1
         1 004511   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 004512   004515 600000 1                  TZE     s:10698

     1664    10696    2           OR END$->KQ$MBLK.INSHD$ ~= ADDR(NIL) THEN
     1665    10697    2            CALL SC_CGGARB;

  10697  1 004513   000000 713400 xsym               CLIMB   SC_CGGARB
         1 004514   000000 600000 xsid               climb   nvectors=         0

     1666    10698    2           IF MBLK$->KQ$MBLK.DDA = 0 THEN

  10698  1 004515   200005 470500                    LDP0    MBLK$,,AUTO
         1 004516   000006 235100                    LDA     6,,PR0
         1 004517   004524 601000 1                  TNZ     C10

     1667    10699    3             DO;

     1668    10700    3             CALL INSMT;

  10700  1 004520   004777 701000 1                  TSX1    INSMT
         1 004521   000000 011000                    NOP     0

     1669    10701    3             RETURN;

  10701  1 004522   200030 221300                    LDX1  ! END$+1,,AUTO
         1 004523   000001 702211                    TSX2  ! 1,X1

     1670    10702    3             END;
     1671    10703        /**/
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:242  
     1672    10704    2   C10:    CALL INVALIDATE (MBLK$->KQ$MBLK);

  10704  1 004524   200005 236100       C10          LDQ     MBLK$,,AUTO
         1 004525   200055 756100                    STQ     @DFR,,AUTO
         1 004526   007526 701000 1                  TSX1    INVALIDATE
         1 004527   000000 011000                    NOP     0

     1673    10705    2           DDA=MBLK$->KQ$MBLK.SDA.LDA;

  10705  1 004530   200005 470500                    LDP0    MBLK$,,AUTO
         1 004531   000002 235100                    LDA     2,,PR0
         1 004532   200013 755100                    STA     DDA,,AUTO

     1674    10706    2           DBLK$R=MBLK$->KQ$MBLK.LCSTAMP;

  10706  1 004533   000016 236100                    LDQ     14,,PR0
         1 004534   000022 772000                    QRL     18
         1 004535   200011 756100                    STQ     DBLK$,,AUTO

     1675    10707    2           CALL FETCH (KQGD_SQCF0#,KQGD_SQCD0#) ALTRET(NOFETCH0);

  10707  1 004536   000050 236000 2                  LDQ     40
         1 004537   200056 756100                    STQ     @CLKDFR,,AUTO
         1 004540   000051 236000 2                  LDQ     41
         1 004541   200055 756100                    STQ     @DFR,,AUTO
         1 004542   006740 701000 1                  TSX1    FETCH
         1 004543   004662 702000 1                  TSX2    NOFETCH0

     1676    10708    2   C30:    CTLBLK$=PINCRW(DBLK$,DBLK$->KQ$DBLK.SIZW-SIZEW(KQ$MBLK));

  10708  1 004544   200011 470500       C30          LDP0    DBLK$,,AUTO
         1 004545   000004 220100                    LDX0    4,,PR0
         1 004546   777760 636010                    EAQ     -16,X0
         1 004547   200011 036100                    ADLQ    DBLK$,,AUTO
         1 004550   200026 756100                    STQ     CTLBLK$,,AUTO

     1677    10709    2           DBLK$->KQ$DBLK.FLNKDA=END$->KQ$MBLK.DDA;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:243  

  10709  1 004551   200027 471500                    LDP1    END$,,AUTO
         1 004552   100006 235100                    LDA     6,,PR1
         1 004553   000001 755100                    STA     1,,PR0

     1678    10710    2           CTLBLK$->KQ$MBLK.CCSTAMP=END$->KQ$MBLK.STAMP;

  10710  1 004554   100001 720100                    LXL0    1,,PR1
         1 004555   200026 470500                    LDP0    CTLBLK$,,AUTO
         1 004556   000016 440100                    SXL0    14,,PR0

     1679    10711    2           CALL UPDATED;

  10711  1 004557   007442 701000 1                  TSX1    UPDATED
         1 004560   000000 011000                    NOP     0

     1680    10712    2   C40:    DBLK$R=END$->KQ$MBLK.STAMP;

  10712  1 004561   200027 470500       C40          LDP0    END$,,AUTO
         1 004562   000001 236100                    LDQ     1,,PR0
         1 004563   777777 376007                    ANQ     -1,DL
         1 004564   200011 756100                    STQ     DBLK$,,AUTO

     1681    10713    2           CALL INVALIDATE (END$->KQ$MBLK);

  10713  1 004565   200027 236100                    LDQ     END$,,AUTO
         1 004566   200055 756100                    STQ     @DFR,,AUTO
         1 004567   007526 701000 1                  TSX1    INVALIDATE
         1 004570   000000 011000                    NOP     0

     1682    10714    2           END$->KQ$MBLK.SDA.CCDDA=END$->KQ$MBLK.DDA;

  10714  1 004571   200027 470500                    LDP0    END$,,AUTO
         1 004572   000006 235100                    LDA     6,,PR0
         1 004573   000003 755100                    STA     3,,PR0

     1683    10715    2           DDA=END$->KQ$MBLK.DDA;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:244  

  10715  1 004574   200013 755100                    STA     DDA,,AUTO

     1684    10716    2           CALL FETCH (KQGD_SQCF1#,KQGD_SQCD1#) ALTRET(NOFETCH1);

  10716  1 004575   000052 236000 2                  LDQ     42
         1 004576   200056 756100                    STQ     @CLKDFR,,AUTO
         1 004577   000053 236000 2                  LDQ     43
         1 004600   200055 756100                    STQ     @DFR,,AUTO
         1 004601   006740 701000 1                  TSX1    FETCH
         1 004602   004716 702000 1                  TSX2    NOFETCH1

     1685    10717    2   C60:    SAVP$=MBLK$;

  10717  1 004603   200005 236100       C60          LDQ     MBLK$,,AUTO
         1 004604   200017 756100                    STQ     SAVP$,,AUTO

     1686    10718    2           MBLK$=END$;

  10718  1 004605   200027 236100                    LDQ     END$,,AUTO
         1 004606   200005 756100                    STQ     MBLK$,,AUTO

     1687    10719    2           CALL CHKBLINK ALTRET(FERR11);

  10719  1 004607   007153 701000 1                  TSX1    CHKBLINK
         1 004610   004730 702000 1                  TSX2    FERR11

     1688    10720    2           MBLK$=SAVP$;

  10720  1 004611   200017 236100                    LDQ     SAVP$,,AUTO
         1 004612   200005 756100                    STQ     MBLK$,,AUTO

     1689    10721    3             DO INHIBIT;

     1690    10722    3             CTLBLK$->KQ$MBLK.PCVALID='0'B;

  10722  1 004613   200026 470700                    LDP0  ! CTLBLK$,,AUTO
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:245  
         1 004614   000015 236200 2                  LDQ   ! 13
         1 004615   000010 356300                    ANSQ  ! 8,,PR0

     1691    10723    3             CTLBLK$->KQ$MBLK.PCDDA=MBLK$->KQ$MBLK.SDA.LDA;

  10723  1 004616   200005 471700                    LDP1  ! MBLK$,,AUTO
         1 004617   100002 235300                    LDA   ! 2,,PR1
         1 004620   000017 755300                    STA   ! 15,,PR0

     1692    10724    3             MBLK$->KQ$MBLK.COUNT  =MBLK$->KQ$MBLK.COUNT+END$->KQ$MBLK.COUNT;

  10724  1 004621   200027 473700                    LDP3  ! END$,,AUTO
         1 004622   100015 236300                    LDQ   ! 13,,PR1
         1 004623   300015 036300                    ADLQ  ! 13,,PR3
         1 004624   100015 756300                    STQ   ! 13,,PR1

     1693    10725    3             MBLK$->KQ$MBLK.PRIOLO =END$->KQ$MBLK.PRIOLO;

  10725  1 004625   300010 720300                    LXL0  ! 8,,PR3
         1 004626   100010 440300                    SXL0  ! 8,,PR1

     1694    10726    3             MBLK$->KQ$MBLK.UTSHI  =END$->KQ$MBLK.UTSHI;

  10726  1 004627   300011 235300                    LDA   ! 9,,PR3
         1 004630   100011 755300                    STA   ! 9,,PR1

     1695    10727    3             MBLK$->KQ$MBLK.UTSXTHI=END$->KQ$MBLK.UTSXTHI;

  10727  1 004631   300014 721300                    LXL1  ! 12,,PR3
         1 004632   100014 441300                    SXL1  ! 12,,PR1

     1696    10728    3             MBLK$->KQ$MBLK.SDA.LDA=END$->KQ$MBLK.SDA.LDA;

  10728  1 004633   300002 235300                    LDA   ! 2,,PR3
         1 004634   100002 755300                    STA   ! 2,,PR1

     1697    10729    3             MBLK$->KQ$MBLK.LCSTAMP=END$->KQ$MBLK.LCSTAMP;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:246  

  10729  1 004635   300016 222300                    LDX2  ! 14,,PR3
         1 004636   100016 742300                    STX2  ! 14,,PR1

     1698    10730    3             MBLK$->KQ$MBLK.LNK$=END$->KQ$MBLK.LNK$;

  10730  1 004637   300000 236300                    LDQ   ! 0,,PR3
         1 004640   100000 756300                    STQ   ! 0,,PR1

     1699    10731    3             IF MBLK$->KQ$MBLK.LNK$ = ADDR(NIL) THEN

  10731  1 004641   000001 116200 xsym               CMPQ  ! B_VECTNIL+1
         1 004642   004646 601200 1                  TNZ   ! s:10733

     1700    10732    3              MLH$->KQ$MLH.TAIL$=MBLK$;

  10732  1 004643   200005 236300                    LDQ   ! MBLK$,,AUTO
         1 004644   200014 474700                    LDP4  ! MLH$,,AUTO
         1 004645   400001 756300                    STQ   ! 1,,PR4

     1701    10733    3             MLH$->KQ$MLH.SUPERCNT=MLH$->KQ$MLH.SUPERCNT-1;

  10733  1 004646   200014 474700                    LDP4  ! MLH$,,AUTO
         1 004647   400004 720300                    LXL0  ! 4,,PR4
         1 004650   777777 621210                    EAX1  ! -1,X0
         1 004651   400004 441300                    SXL1  ! 4,,PR4

     1702    10734    3             CALL UPDATED;

  10734  1 004652   007442 701200 1                  TSX1  ! UPDATED
         1 004653   000000 011200                    NOP   ! 0

     1703    10735    3             CALL RELMBLK (END$->KQ$MBLK);

  10735  1 004654   200027 236300                    LDQ   ! END$,,AUTO
         1 004655   200057 756300                    STQ   ! @START$,,AUTO
         1 004656   007545 701200 1                  TSX1  ! RELMBLK
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:247  
         1 004657   000000 011200                    NOP   ! 0

     1704    10736    3             RETURN;

  10736  1 004660   200030 221300                    LDX1  ! END$+1,,AUTO
         1 004661   000001 702211                    TSX2  ! 1,X1

     1705    10737    3             END; /* INHIBIT */

  10735  1 004662                       NOFETCH0     null
     1706    10738        /**/
     1707    10739        /**/
     1708    10740    2   NOFETCH0:; /* Can't fetch LDA of first guy */
     1709    10741    2           IF DBLK$ ~= ADDR(NIL)

  10741  1 004662   200011 236100                    LDQ     DBLK$,,AUTO
         1 004663   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 004664   004670 601000 1                  TNZ     s:10742
         1 004665   200013 235100                    LDA     DDA,,AUTO
         1 004666   000012 115007                    CMPA    10,DL
         1 004667   004672 601000 1                  TNZ     FERR0

     1710    10742    2           OR DDA = %KQDE_NDFRBLK THEN ALTRETURN;

  10742  1 004670   200030 221300                    LDX1  ! END$+1,,AUTO
         1 004671   000000 702211                    TSX2  ! 0,X1

     1711    10743                           /* Fetch error */
     1712    10744    2   FERR0:  CALL DISKERR;

  10744  1 004672   007045 701000 1     FERR0        TSX1    DISKERR
         1 004673   000000 011000                    NOP     0

     1713    10745                     /*    Set CONERR and return.
     1714    10746                      *    This will cause SETLDA
     1715    10747                      *    to be called to re-establish
     1716    10748                      *    COUNT and LDA based on how
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:248  
     1717    10749                      *    far down the chain we can
     1718    10750                      *    successfully read.  Then
     1719    10751                      *    we'll try the concat again.
     1720    10752                      */
     1721    10753    2           KQ$GARB.CONERR='1'B;

  10753  1 004674   200006 470500                    LDP0    CG$,,AUTO
         1 004675   020000 236003                    LDQ     8192,DU
         1 004676   000032 256100                    ORSQ    26,,PR0

     1722    10754    2           RETURN;

  10754  1 004677   200030 221300                    LDX1  ! END$+1,,AUTO
         1 004700   000001 702211                    TSX2  ! 1,X1

     1723    10755        /**/
     1724    10756    2   CONCATF0: ENTRY ALTRET;

  10756  1 004701   200030 741300       CONCATF0     STX1  ! END$+1,,AUTO

     1725    10757        /**/
     1726    10758    2           END$=MBLK$->KQ$MBLK.LNK$;

  10758  1 004702   200005 470500                    LDP0    MBLK$,,AUTO
         1 004703   000000 236100                    LDQ     0,,PR0
         1 004704   200027 756100                    STQ     END$,,AUTO

     1727    10759    2           IF DBLK$ = ADDR(NIL) THEN GOTO FERR0;

  10759  1 004705   200011 236100                    LDQ     DBLK$,,AUTO
         1 004706   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 004707   004672 600000 1                  TZE     FERR0

     1728    10760    2           GOTO C30;

  10760  1 004710   004544 710000 1                  TRA     C30

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:249  
     1729    10761        /**/
     1730    10762    2   CONCATD0: ENTRY ALTRET;

  10762  1 004711   200030 741300       CONCATD0     STX1  ! END$+1,,AUTO

     1731    10763        /**/
     1732    10764    2           END$=MBLK$->KQ$MBLK.LNK$;

  10764  1 004712   200005 470500                    LDP0    MBLK$,,AUTO
         1 004713   000000 236100                    LDQ     0,,PR0
         1 004714   200027 756100                    STQ     END$,,AUTO

     1733    10765    2           GOTO C10;

  10765  1 004715   004524 710000 1                  TRA     C10

  10764  1 004716                       NOFETCH1     null
     1734    10766        /**/
     1735    10767        /**/
     1736    10768    2   NOFETCH1:; /* Can't fetch FDA of second guy */
     1737    10769    2           IF DBLK$ ~= ADDR(NIL)

  10769  1 004716   200011 236100                    LDQ     DBLK$,,AUTO
         1 004717   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 004720   004724 601000 1                  TNZ     s:10770
         1 004721   200013 235100                    LDA     DDA,,AUTO
         1 004722   000012 115007                    CMPA    10,DL
         1 004723   004726 601000 1                  TNZ     FERR1

     1738    10770    2           OR DDA = %KQDE_NDFRBLK THEN ALTRETURN;

  10770  1 004724   200030 221300                    LDX1  ! END$+1,,AUTO
         1 004725   000000 702211                    TSX2  ! 0,X1

     1739    10771                           /* Fetch error */
     1740    10772    2   FERR1:  SAVP$=MBLK$;

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:250  
  10772  1 004726   200005 236100       FERR1        LDQ     MBLK$,,AUTO
         1 004727   200017 756100                    STQ     SAVP$,,AUTO

     1741    10773    2   FERR11: P$=SAVP$;

  10773  1 004730   200017 236100       FERR11       LDQ     SAVP$,,AUTO
         1 004731   200007 756100                    STQ     P$,,AUTO

     1742    10774    2           MBLK$=END$;

  10774  1 004732   200027 236100                    LDQ     END$,,AUTO
         1 004733   200005 756100                    STQ     MBLK$,,AUTO

     1743    10775    2           CALL DISKERR;

  10775  1 004734   007045 701000 1                  TSX1    DISKERR
         1 004735   000000 011000                    NOP     0

     1744    10776    2           I=MBLK$->KQ$MBLK.COUNT;

  10776  1 004736   200005 470500                    LDP0    MBLK$,,AUTO
         1 004737   000015 235100                    LDA     13,,PR0
         1 004740   200012 755100                    STA     I,,AUTO

     1745    10777    2           MBLK$->KQ$MBLK.COUNT=0;

  10777  1 004741   000015 450100                    STZ     13,,PR0

     1746    10778    2           MLH$->KQ$MLH.COUNT=MLH$->KQ$MLH.COUNT-I;

  10778  1 004742   200014 471500                    LDP1    MLH$,,AUTO
         1 004743   100005 236100                    LDQ     5,,PR1
         1 004744   200012 136100                    SBLQ    I,,AUTO
         1 004745   100005 756100                    STQ     5,,PR1

     1747    10779                %CHKCNT;

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:251  
  10780  1 004746   000000 235000 xsym               LDA     KQ_DEBUG
         1 004747   004752 600000 1                  TZE     s:10782

  10780  1 004750   007316 701000 1                  TSX1    CHKMLH
         1 004751   000000 011000                    NOP     0

     1748    10782    2           MBLK$->KQ$MBLK.DDA=0;

  10782  1 004752   200005 470500                    LDP0    MBLK$,,AUTO
         1 004753   000006 450100                    STZ     6,,PR0

     1749    10783    2           CALL INSMT1;

  10783  1 004754   005003 701000 1                  TSX1    INSMT1
         1 004755   000000 011000                    NOP     0

     1750    10784    2           MBLK$=SAVP$;

  10784  1 004756   200017 236100                    LDQ     SAVP$,,AUTO
         1 004757   200005 756100                    STQ     MBLK$,,AUTO

     1751    10785    2           RETURN;

  10785  1 004760   200030 221300                    LDX1  ! END$+1,,AUTO
         1 004761   000001 702211                    TSX2  ! 1,X1

     1752    10786        /**/
     1753    10787    2   CONCATF1: ENTRY ALTRET;

  10787  1 004762   200030 741300       CONCATF1     STX1  ! END$+1,,AUTO

     1754    10788        /**/
     1755    10789    2           END$=MBLK$->KQ$MBLK.LNK$;

  10789  1 004763   200005 470500                    LDP0    MBLK$,,AUTO
         1 004764   000000 236100                    LDQ     0,,PR0
         1 004765   200027 756100                    STQ     END$,,AUTO
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:252  

     1756    10790    2           IF DBLK$ = ADDR(NIL) THEN GOTO FERR1;

  10790  1 004766   200011 236100                    LDQ     DBLK$,,AUTO
         1 004767   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 004770   004726 600000 1                  TZE     FERR1

     1757    10791    2           GOTO C60;

  10791  1 004771   004603 710000 1                  TRA     C60

     1758    10792        /**/
     1759    10793    2   CONCATD1: ENTRY ALTRET;

  10793  1 004772   200030 741300       CONCATD1     STX1  ! END$+1,,AUTO

     1760    10794        /**/
     1761    10795    2           END$=MBLK$->KQ$MBLK.LNK$;

  10795  1 004773   200005 470500                    LDP0    MBLK$,,AUTO
         1 004774   000000 236100                    LDQ     0,,PR0
         1 004775   200027 756100                    STQ     END$,,AUTO

     1762    10796    2           GOTO C40;

  10796  1 004776   004561 710000 1                  TRA     C40

     1763    10797    2   END CONCATS;
     1764    10798        /********************************************************
     1765    10799        *********************************************************/
     1766    10800        /**/
     1767    10801        /*D* NAME:         INSMT
     1768    10802             PURPOSE:      To fix a super MBLK with no DBLKs
     1769    10803             DESCRIPTION:  The INSHD$ list, if any, is merged
     1770    10804                           into the MLH list, and the super MBLK
     1771    10805                           deleted.
     1772    10806                           Sets KQ$GARB.RECYCLE to indicate we did this.
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:253  
     1773    10807        */
     1774    10808    1   INSMT:  PROC;

  10808  1 004777   200054 741300       INSMT        STX1  ! DELETE+10,,AUTO

     1775    10809        /**/
     1776    10810    2           CALL GETPRED;

  10810  1 005000   007504 701000 1                  TSX1    GETPRED
         1 005001   000000 011000                    NOP     0
         1 005002   005004 710000 1                  TRA     s:10814

     1777    10811        /**/
     1778    10812    2   INSMT1: ENTRY;

  10812  1 005003   200054 741300       INSMT1       STX1  ! DELETE+10,,AUTO

     1779    10813        /**/
     1780    10814    2           KQ$GARB.RECYCLE='1'B;

  10814  1 005004   200006 470500                    LDP0    CG$,,AUTO
         1 005005   100000 236003                    LDQ     32768,DU
         1 005006   000032 256100                    ORSQ    26,,PR0

     1781    10815    2           IF MBLK$->KQ$MBLK.INSHD$ ~= ADDR(NIL) THEN

  10815  1 005007   200005 471500                    LDP1    MBLK$,,AUTO
         1 005010   100012 236100                    LDQ     10,,PR1
         1 005011   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 005012   005051 600000 1                  TZE     s:10830

     1782    10816    3             DO;

     1783    10817    3             X$=MBLK$->KQ$MBLK.INSHD$;

  10817  1 005013   200022 756100                    STQ     X$,,AUTO

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:254  
     1784    10818    4               DO WHILE (X$->KQ$MBLK.LNK$ ~= ADDR(NIL));

  10818  1 005014   005020 710000 1                  TRA     s:10820

     1785    10819    4               X$=X$->KQ$MBLK.LNK$;

  10819  1 005015   200022 470500                    LDP0    X$,,AUTO
         1 005016   000000 236100                    LDQ     0,,PR0
         1 005017   200022 756100                    STQ     X$,,AUTO

     1786    10820    4               END;

  10820  1 005020   200022 470500                    LDP0    X$,,AUTO
         1 005021   000000 236100                    LDQ     0,,PR0
         1 005022   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 005023   005015 601000 1                  TNZ     s:10819

     1787    10821    3             X$->KQ$MBLK.LNK$=MBLK$->KQ$MBLK.LNK$;

  10821  1 005024   200005 471500                    LDP1    MBLK$,,AUTO
         1 005025   100000 236100                    LDQ     0,,PR1
         1 005026   000000 756100                    STQ     0,,PR0

     1788    10822    3             IF X$->KQ$MBLK.LNK$ = ADDR(NIL) THEN

  10822  1 005027   200022 470500                    LDP0    X$,,AUTO
         1 005030   000000 236100                    LDQ     0,,PR0
         1 005031   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 005032   005036 601000 1                  TNZ     s:10824

     1789    10823    3              MLH$->KQ$MLH.TAIL$=X$;

  10823  1 005033   200022 236100                    LDQ     X$,,AUTO
         1 005034   200014 473500                    LDP3    MLH$,,AUTO
         1 005035   300001 756100                    STQ     1,,PR3

     1790    10824    3             IF P$ = ADDR(NIL) THEN
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:255  

  10824  1 005036   200007 236100                    LDQ     P$,,AUTO
         1 005037   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 005040   005045 601000 1                  TNZ     s:10826

     1791    10825    3              MLH$->KQ$MLH.HEAD$=MBLK$->KQ$MBLK.INSHD$;

  10825  1 005041   100012 236100                    LDQ     10,,PR1
         1 005042   200014 470500                    LDP0    MLH$,,AUTO
         1 005043   000000 756100                    STQ     0,,PR0
         1 005044   005071 710000 1                  TRA     s:10836

     1792    10826    3             ELSE P$->KQ$MBLK.LNK$=MBLK$->KQ$MBLK.INSHD$;

  10826  1 005045   100012 236100                    LDQ     10,,PR1
         1 005046   200007 470500                    LDP0    P$,,AUTO
         1 005047   000000 756100                    STQ     0,,PR0

     1793    10827    3             END;

  10827  1 005050   005071 710000 1                  TRA     s:10836

     1794    10828    2           ELSE
     1795    10829    3             DO;

     1796    10830    3             IF P$ = ADDR(NIL) THEN

  10830  1 005051   200007 236100                    LDQ     P$,,AUTO
         1 005052   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 005053   005060 601000 1                  TNZ     s:10832

     1797    10831    3              MLH$->KQ$MLH.HEAD$=MBLK$->KQ$MBLK.LNK$;

  10831  1 005054   100000 236100                    LDQ     0,,PR1
         1 005055   200014 473500                    LDP3    MLH$,,AUTO
         1 005056   300000 756100                    STQ     0,,PR3
         1 005057   005063 710000 1                  TRA     s:10833
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:256  

     1798    10832    3             ELSE P$->KQ$MBLK.LNK$=MBLK$->KQ$MBLK.LNK$;

  10832  1 005060   100000 236100                    LDQ     0,,PR1
         1 005061   200007 473500                    LDP3    P$,,AUTO
         1 005062   300000 756100                    STQ     0,,PR3

     1799    10833    3             IF MBLK$->KQ$MBLK.LNK$ = ADDR(NIL) THEN

  10833  1 005063   100000 236100                    LDQ     0,,PR1
         1 005064   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 005065   005071 601000 1                  TNZ     s:10836

     1800    10834    3              MLH$->KQ$MLH.TAIL$=P$;

  10834  1 005066   200007 236100                    LDQ     P$,,AUTO
         1 005067   200014 473500                    LDP3    MLH$,,AUTO
         1 005070   300001 756100                    STQ     1,,PR3

     1801    10835    3             END;

     1802    10836    2           MLH$->KQ$MLH.SUPERCNT=MLH$->KQ$MLH.SUPERCNT-1;

  10836  1 005071   200014 470500                    LDP0    MLH$,,AUTO
         1 005072   000004 720100                    LXL0    4,,PR0
         1 005073   777777 621010                    EAX1    -1,X0
         1 005074   000004 441100                    SXL1    4,,PR0

     1803    10837                %CHKCNT;

  10838  1 005075   000000 235000 xsym               LDA     KQ_DEBUG
         1 005076   005101 600000 1                  TZE     s:10840

  10838  1 005077   007316 701000 1                  TSX1    CHKMLH
         1 005100   000000 011000                    NOP     0

     1804    10840    2           CALL RELMBLK (MBLK$->KQ$MBLK);
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:257  

  10840  1 005101   200005 236100                    LDQ     MBLK$,,AUTO
         1 005102   200057 756100                    STQ     @START$,,AUTO
         1 005103   007545 701000 1                  TSX1    RELMBLK
         1 005104   000000 011000                    NOP     0

     1805    10841    2   RTN:    RETURN;

  10841  1 005105   200054 221300       RTN          LDX1  ! DELETE+10,,AUTO
         1 005106   000001 702211                    TSX2  ! 1,X1

     1806    10842    2   END INSMT;
     1807    10843        /********************************************************
     1808    10844        *********************************************************/
     1809    10845        /**/
     1810    10846        /*D* NAME:         INSRT
     1811    10847             PURPOSE:      To insert the INSHD$ list of a super
     1812    10848                           MBLK into its disc list
     1813    10849             INPUT:        MBLK$ = first MBLK
     1814    10850                           KQ$GARB.MBLK$ = MBLK$
     1815    10851             DESCRIPTION:  ALTRETs if delay required, else returns
     1816    10852                           when done.
     1817    10853        */
     1818    10854    1   INSRT:  PROC ALTRET;

  10854  1 005107   200030 741300       INSRT        STX1  ! END$+1,,AUTO

     1819    10855        /**/
     1820    10856    2   DCL I$ PTR;
     1821    10857    2   DCL NFREE SBIN;
     1822    10858    2   DCL FREE$ PTR;
     1823    10859        %KQ_MBLK (FPTN=SMBLK,STCLASS=AUTO,SUPR=1);
     1824    11129        /**/
     1825    11130    2           DBLK$=ADDR(NIL);

  11130  1 005110   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 005111   200011 756100                    STQ     DBLK$,,AUTO
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:258  

     1826    11131    2   I10:    IF MBLK$->KQ$MBLK.DDA = 0 THEN

  11131  1 005112   200005 470500       I10          LDP0    MBLK$,,AUTO
         1 005113   000006 235100                    LDA     6,,PR0
         1 005114   005120 601000 1                  TNZ     s:11137

     1827    11132    3             DO;

     1828    11133    3             CALL INSMT;

  11133  1 005115   004777 701000 1                  TSX1    INSMT
         1 005116   000000 011000                    NOP     0

     1829    11134    3             GOTO INSX;

  11134  1 005117   006243 710000 1                  TRA     INSX

     1830    11135    3             END;
     1831    11136        /**/
     1832    11137    2           IF MBLK$->KQ$MBLK.INSHD$ = ADDR(NIL) THEN

  11137  1 005120   000012 236100                    LDQ     10,,PR0
         1 005121   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 005122   005125 601000 1                  TNZ     s:11139

     1833    11138    2            RETURN;

  11138  1 005123   200030 221300                    LDX1  ! END$+1,,AUTO
         1 005124   000001 702211                    TSX2  ! 1,X1

     1834    11139    2           IF KQ_LOG.GARB THEN

  11139  1 005125   000000 236000 xsym               LDQ     KQ_LOG
         1 005126   200000 316003                    CANQ    65536,DU
         1 005127   005154 600000 1                  TZE     s:11146

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:259  
     1835    11140    3             DO;

     1836    11141    3             I$=MBLK$;

  11141  1 005130   200005 236100                    LDQ     MBLK$,,AUTO
         1 005131   200031 756100                    STQ     I$,,AUTO

     1837    11142    3             CALL KQZ$LOG (CG$->KQ$CG,%KQLOG_GINS,ENTFLAG,0,0,I$,

  11142  1 005132   000006 036003                    ADLQ    6,DU
         1 005133   200074 756100                    STQ     I$+7,,AUTO
         1 005134   200031 631500                    EPPR1   I$,,AUTO
         1 005135   200073 451500                    STP1    I$+6,,AUTO
         1 005136   000001 236000 2                  LDQ     1
         1 005137   200072 756100                    STQ     I$+5,,AUTO
         1 005140   200071 756100                    STQ     I$+4,,AUTO
         1 005141   200015 633500                    EPPR3   ENTFLAG,,AUTO
         1 005142   200070 453500                    STP3    I$+3,,AUTO
         1 005143   000055 236000 2                  LDQ     45
         1 005144   200006 235100                    LDA     CG$,,AUTO
         1 005145   200066 757100                    STAQ    I$+1,,AUTO
         1 005146   200066 630500                    EPPR0   I$+1,,AUTO
         1 005147   000025 631400 xsym               EPPR1   B_VECTNIL+21
         1 005150   000000 701000 xent               TSX1    KQZ$LOG
         1 005151   005154 702000 1                  TSX2    s:11146

     1838    11143    3             MBLK$->KQ$MBLK.DDA) ALTRET(ZA1);
     1839    11144    3             RETURN;

  11144  1 005152   200030 221300                    LDX1  ! END$+1,,AUTO
         1 005153   000001 702211                    TSX2  ! 1,X1

     1840    11145    3   ZA1:      END;
     1841    11146    2           GOTO I12;

  11146  1 005154   005220 710000 1                  TRA     I12

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:260  
     1842    11147        /**/
     1843    11148        /*D* NAME:         INSRCVR
     1844    11149             PURPOSE:      To continue an INSRT when a CG is reopened.
     1845    11150             DESCRIPTION:  KQS$RECOVER, upon finding that an insert was
     1846    11151                           in progress at crash time, restarts the
     1847    11152                           SQUISH process and calls here for the current
     1848    11153                           MBLK.  Based on where we were when we crashed,
     1849    11154                           we march on.
     1850    11155        */
     1851    11156    2   INSRCVR: ENTRY ALTRET;

  11156  1 005155   200030 741300       INSRCVR      STX1  ! END$+1,,AUTO

     1852    11157        /**/
     1853    11158    2           MBLK$=KQ$GARB.MBLK$;

  11158  1 005156   200006 470500                    LDP0    CG$,,AUTO
         1 005157   000036 236100                    LDQ     30,,PR0
         1 005160   200005 756100                    STQ     MBLK$,,AUTO

     1854    11159    2           DBLK$=KQ$GARB.DBLK$;

  11159  1 005161   000052 236100                    LDQ     42,,PR0
         1 005162   200011 756100                    STQ     DBLK$,,AUTO

     1855    11160    3             DO CASE (KQ$GARB.SPSTATE);

  11160  1 005163   000046 220100                    LDX0    38,,PR0
         1 005164   000777 360003                    ANX0    511,DU
         1 005165   000014 100003                    CMPX0   12,DU
         1 005166   005170 602010 1                  TNC     s:11160+5,X0
         1 005167   005216 710000 1                  TRA     s:11182
         1 005170   005216 710000 1                  TRA     s:11182
         1 005171   005204 710000 1                  TRA     s:11162
         1 005172   005205 710000 1                  TRA     s:11164
         1 005173   005206 710000 1                  TRA     s:11166
         1 005174   005207 710000 1                  TRA     s:11168
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:261  
         1 005175   005210 710000 1                  TRA     s:11170
         1 005176   005211 710000 1                  TRA     s:11172
         1 005177   005204 710000 1                  TRA     s:11162
         1 005200   005212 710000 1                  TRA     s:11174
         1 005201   005213 710000 1                  TRA     s:11176
         1 005202   005214 710000 1                  TRA     s:11178
         1 005203   005215 710000 1                  TRA     s:11180

     1856    11161    3               CASE (KQSP_CBIM0#,KQSP_CBIM1#);

     1857    11162    3                 GOTO FTCH0;

  11162  1 005204   005234 710000 1                  TRA     FTCH0

     1858    11163    3               CASE (KQSP_CBUL#);

     1859    11164    3                 GOTO RCBUL;

  11164  1 005205   005626 710000 1                  TRA     RCBUL

     1860    11165    3               CASE (KQSP_NBIM#);

     1861    11166    3                 GOTO DOSPLIT;

  11166  1 005206   005721 710000 1                  TRA     DOSPLIT

     1862    11167    3               CASE (KQSP_NBUL#);

     1863    11168    3                 GOTO RNBUL;

  11168  1 005207   006047 710000 1                  TRA     RNBUL

     1864    11169    3               CASE (KQSP_BBIM#);

     1865    11170    3                 GOTO FTCH1;

  11170  1 005210   006047 710000 1                  TRA     RNBUL
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:262  

     1866    11171    3               CASE (KQSP_BBUL#);

     1867    11172    3                 GOTO RBBUL;

  11172  1 005211   006105 710000 1                  TRA     RBBUL

     1868    11173    3               CASE (KQSP_FBIM#);

     1869    11174    3                 GOTO RFBIM;

  11174  1 005212   006147 710000 1                  TRA     RFBIM

     1870    11175    3               CASE (KQSP_FBUL#);

     1871    11176    3                 GOTO RFBUL;

  11176  1 005213   006172 710000 1                  TRA     RFBUL

     1872    11177    3               CASE (KQSP_RLSP#);

     1873    11178    3                 GOTO RRLSP;

  11178  1 005214   006172 710000 1                  TRA     RFBUL

     1874    11179    3               CASE (KQSP_DELD#);

     1875    11180    3                 GOTO RDELD;

  11180  1 005215   006373 710000 1                  TRA     RDELD

     1876    11181    3             END;

     1877    11182    2           RETURN;

  11182  1 005216   000001 702211                    TSX2  ! 1,X1

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:263  
     1878    11183        /**/
     1879    11184        /*D* NAME:         SETLDA
     1880    11185             PURPOSE:      To re-establish LDA and COUNT
     1881    11186             DESCRIPTION:  Called when CONCATS gets an error fetching
     1882    11187                           the LDA of an MBLK.  We simply flink down
     1883    11188                           the disk chain and re-set everything properly
     1884    11189                           when we get an error.
     1885    11190        */
     1886    11191    2   SETLDA: ENTRY ALTRET;

  11191  1 005217   200030 741300       SETLDA       STX1  ! END$+1,,AUTO

     1887    11192        /**/
     1888    11193    2   I12:    CALL INVALIDATE (MBLK$->KQ$MBLK);

  11193  1 005220   200005 236100       I12          LDQ     MBLK$,,AUTO
         1 005221   200055 756100                    STQ     @DFR,,AUTO
         1 005222   007526 701000 1                  TSX1    INVALIDATE
         1 005223   000000 011000                    NOP     0

     1889    11194    2           MBLK$->KQ$MBLK.PCDDA=0;

  11194  1 005224   200005 470500                    LDP0    MBLK$,,AUTO
         1 005225   000017 450100                    STZ     15,,PR0

     1890    11195    2           KQ$GARB.TCOUNT=0;

  11195  1 005226   200006 471500                    LDP1    CG$,,AUTO
         1 005227   100035 450100                    STZ     29,,PR1

     1891    11196    2           MBLK$->KQ$MBLK.SDA.CCDDA=MBLK$->KQ$MBLK.DDA;

  11196  1 005230   000006 235100                    LDA     6,,PR0
         1 005231   000003 755100                    STA     3,,PR0

     1892    11197    2           MBLK$->KQ$MBLK.CCSTAMP=MBLK$->KQ$MBLK.STAMP;

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:264  
  11197  1 005232   000001 720100                    LXL0    1,,PR0
         1 005233   000016 440100                    SXL0    14,,PR0

     1893    11198        /**/
     1894    11199                     /* Fetch the next DBLK
     1895    11200                      * and process it
     1896    11201                      */
     1897    11202    2   FTCH0:  DDA=MBLK$->KQ$MBLK.SDA.CCDDA;

  11202  1 005234   200005 470500       FTCH0        LDP0    MBLK$,,AUTO
         1 005235   000003 235100                    LDA     3,,PR0
         1 005236   200013 755100                    STA     DDA,,AUTO

     1898    11203    2           DBLK$R=MBLK$->KQ$MBLK.CCSTAMP;

  11203  1 005237   000016 236100                    LDQ     14,,PR0
         1 005240   777777 376007                    ANQ     -1,DL
         1 005241   200011 756100                    STQ     DBLK$,,AUTO

     1899    11204    2           KQ$GARB.SPSTATE=KQSP_CBIM0#;

  11204  1 005242   200006 471500                    LDP1    CG$,,AUTO
         1 005243   000001 236003                    LDQ     1,DU
         1 005244   100046 552120                    STBQ    38,'20'O,PR1

     1900    11205    2           CALL FETCH (KQGD_SQIF0#,KQGD_SQID0#) ALTRET(NOFETCH0);

  11205  1 005245   000057 236000 2                  LDQ     47
         1 005246   200056 756100                    STQ     @CLKDFR,,AUTO
         1 005247   000060 236000 2                  LDQ     48
         1 005250   200055 756100                    STQ     @DFR,,AUTO
         1 005251   006740 701000 1                  TSX1    FETCH
         1 005252   006301 702000 1                  TSX2    NOFETCH0

     1901    11206        /**/
     1902    11207                /*    For those MBLKs that belong in this DBLK
     1903    11208                 *    (as determined by the limit PRIO/UTS in
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:265  
     1904    11209                 *    the redundant MBLK), insert them in their
     1905    11210                 *    proper place, using free space if avail
     1906    11211                 *    or dropping the end MBLK onto the SPLIT
     1907    11212                 *    chain if not.  When we run out of space,
     1908    11213                 *    all belonging MBLKs go on the SPLIT chain.
     1909    11214                 *    At the finish, if the SPLIT chain is nonempty
     1910    11215                 *    we do a 'split', putting them into a new
     1911    11216                 *    DBLK.
     1912    11217                 */
     1913    11218        /**/
     1914    11219                /* CTLBLK$ redundant MBLK at end of DBLK
     1915    11220                 * Z$      current insert point
     1916    11221                 * NMBLKS  number of MBLKs left to look at
     1917    11222                 * FREE$   pointer to free space at DBLK end
     1918    11223                 * NFREE   number of free MBLK slots
     1919    11224                 * I$      current head of INSHD$ chain
     1920    11225                 */
     1921    11226        /**/
     1922    11227                /*    KQ$MBLK.SDA.CCDDA
     1923    11228                 *    KQ$MBLK.CCSTAMP    : current chunk we're inserting in
     1924    11229                 *    KQ$MBLK.PCDDA
     1925    11230                 *    KQ$GARB.PCSTAMP    : blink of current chunk
     1926    11231                 *    KQ$GARB.NCDDA
     1927    11232                 *    KQ$GARB.NCSTAMP    : flink of current chunk
     1928    11233                 *    KQ$GARB.SCDDA
     1929    11234                 *    KQ$GARB.SCSTAMP    : new DBLK being created; will become
     1930    11235                 *                         flink of 'current' chunk
     1931    11236                 */
     1932    11237        /**/
     1933    11238        /*
     1934    11239                                 DBLK
     1935    11240
     1936    11241                 *****************************************
     1937    11242                 *                                       *
     1938    11243                 *         KQ$DBLK  (header)             *
     1939    11244                 *                                       *
     1940    11245                 *****************************************
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:266  
     1941    11246                 *                                       *
     1942    11247                 *        Already-processed MBLKs        *
     1943    11248                 *                                       *
     1944    11249          Z$     *****************************************
     1945    11250                 *                                       *
     1946    11251                 *      NMBLKS MBLKs to look at yet      *
     1947    11252                 *                                       *
     1948    11253          FREE$  *****************************************
     1949    11254                 *                                       *
     1950    11255                 *           NFREE free MBLKs            *
     1951    11256                 *                                       *
     1952    11257          CTLBLK$*****************************************
     1953    11258                 *                                       *
     1954    11259                 *          The redundant MBLK           *
     1955    11260                 *                                       *
     1956    11261                 *****************************************
     1957    11262        */
     1958    11263        /**/
     1959    11264    2   FTCHD0: IF KQ$GARB.INSRT THEN

  11264  1 005253   200006 470500       FTCHD0       LDP0    CG$,,AUTO
         1 005254   000032 236100                    LDQ     26,,PR0
         1 005255   040000 316003                    CANQ    16384,DU
         1 005256   005266 600000 1                  TZE     RCBIM

     1960    11265    3             DO;

     1961    11266    3             KQ$GARB.SPLITCNT=0;

  11266  1 005257   000000 220003                    LDX0    0,DU
         1 005260   000042 740100                    STX0    34,,PR0

     1962    11267    3             KQ$GARB.SQHD$=ADDR(NIL);

  11267  1 005261   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 005262   000051 756100                    STQ     41,,PR0

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:267  
     1963    11268    3             KQ$GARB.SPHD$=ADDR(NIL);

  11268  1 005263   000040 756100                    STQ     32,,PR0

     1964    11269    3             KQ$GARB.DBLK$=DBLK$;

  11269  1 005264   200011 236100                    LDQ     DBLK$,,AUTO
         1 005265   000052 756100                    STQ     42,,PR0

     1965    11270    3             END;

     1966    11271    2   RCBIM:  CALL CHKBLINK ALTRET(FERR0);

  11271  1 005266   007153 701000 1     RCBIM        TSX1    CHKBLINK
         1 005267   006311 702000 1                  TSX2    FERR0

     1967    11272    2           FREE$=PINCRC(DBLK$,SIZEC(KQ$DBLK)+DBLK$->KQ$DBLK.DSIZE);

  11272  1 005270   200011 470500                    LDP0    DBLK$,,AUTO
         1 005271   000000 236100                    LDQ     0,,PR0
         1 005272   777777 376007                    ANQ     -1,DL
         1 005273   000020 736000                    QLS     16
         1 005274   000006 036003                    ADLQ    6,DU
         1 005275   200011 036100                    ADLQ    DBLK$,,AUTO
         1 005276   200033 756100                    STQ     FREE$,,AUTO

     1968    11273    2           NFREE=POFFC(CTLBLK$,FREE$)/SIZEC(KQ$MBLK);

  11273  1 005277   200033 236100                    LDQ     FREE$,,AUTO
         1 005300   000020 772000                    QRL     16
         1 005301   200066 756100                    STQ     I$+1,,AUTO
         1 005302   200026 236100                    LDQ     CTLBLK$,,AUTO
         1 005303   000020 772000                    QRL     16
         1 005304   200066 136100                    SBLQ    I$+1,,AUTO
         1 005305   000100 506007                    DIV     64,DL
         1 005306   200032 756100                    STQ     NFREE,,AUTO

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:268  
     1969    11274    2           NMBLKS=DBLK$->KQ$DBLK.DSIZE/SIZEC(KQ$MBLK);

  11274  1 005307   000000 236100                    LDQ     0,,PR0
         1 005310   777777 376007                    ANQ     -1,DL
         1 005311   000006 772000                    QRL     6
         1 005312   200021 756100                    STQ     NMBLKS,,AUTO

     1970    11275    2           Z$=PINCRW(DBLK$,SIZEW(KQ$DBLK));

  11275  1 005313   200011 236100                    LDQ     DBLK$,,AUTO
         1 005314   000006 036003                    ADLQ    6,DU
         1 005315   200023 756100                    STQ     Z$,,AUTO

     1971    11276    2           IF CTLBLK$->KQ$MBLK.FIRSTX ~= 0 THEN

  11276  1 005316   200026 471500                    LDP1    CTLBLK$,,AUTO
         1 005317   100013 235100                    LDA     11,,PR1
         1 005320   005337 600000 1                  TZE     s:11283

     1972    11277    3             DO INHIBIT; /* Slide up to the beginning to simplify */

     1973    11278    3             I=NMBLKS*SIZEC(KQ$MBLK);

  11278  1 005321   200021 235300                    LDA   ! NMBLKS,,AUTO
         1 005322   000006 735200                    ALS   ! 6
         1 005323   200012 755300                    STA   ! I,,AUTO

     1974    11279    3             Z$->B$$CHARS=PINCRW(Z$,CTLBLK$->KQ$MBLK.FIRSTX)->B$$CHARS;

  11279  1 005324   100013 720300                    LXL0  ! 11,,PR1
         1 005325   000000 635210                    EAA   ! 0,X0
         1 005326   000020 771200                    ARL   ! 16
         1 005327   200023 473700                    LDP3  ! Z$,,AUTO
         1 005330   200012 721300                    LXL1  ! I,,AUTO
         1 005331   040140 100745                    MLR   ! fill='040'O
         1 005332   300000 000011                    ADSC9   0,A,PR3                  cn=0,n=*X1
         1 005333   300000 000011                    ADSC9   0,,PR3                   cn=0,n=*X1
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:269  

     1975    11280    3             CTLBLK$->KQ$MBLK.FIRSTX=0;

  11280  1 005334   100013 450300                    STZ   ! 11,,PR1

     1976    11281    3             CALL UPDATE;

  11281  1 005335   007471 701200 1                  TSX1  ! UPDATE
         1 005336   000000 011200                    NOP   ! 0

     1977    11282    3             END;

     1978    11283    2           KQ$GARB.NCDDA=DBLK$->KQ$DBLK.FLNKDA;

  11283  1 005337   200011 470500                    LDP0    DBLK$,,AUTO
         1 005340   200006 471500                    LDP1    CG$,,AUTO
         1 005341   000001 235100                    LDA     1,,PR0
         1 005342   100043 755100                    STA     35,,PR1

     1979    11284    2           KQ$GARB.NCSTAMP=CTLBLK$->KQ$MBLK.CCSTAMP;

  11284  1 005343   200026 473500                    LDP3    CTLBLK$,,AUTO
         1 005344   300016 720100                    LXL0    14,,PR3
         1 005345   100042 440100                    SXL0    34,,PR1

     1980    11285    2           IF KQ$GARB.SPSTATE = KQSP_CBIM0# THEN

  11285  1 005346   100046 236100                    LDQ     38,,PR1
         1 005347   000777 376003                    ANQ     511,DU
         1 005350   000001 116003                    CMPQ    1,DU
         1 005351   005357 601000 1                  TNZ     s:11298

     1981    11286    3             DO INHIBIT;

     1982    11287                        /* The ONLY unrecoverable part of this fetch
     1983    11288                         * process is this update of TCOUNT,  i.e.
     1984    11289                         * if we crash at any point up to here, it's
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:270  
     1985    11290                         * perfectly OK to just start over again with
     1986    11291                         * the FETCH.  After this, however, we must
     1987    11292                         * change the state so that when we come thru
     1988    11293                         * again, we don't update TCOUNT a second time.
     1989    11294                         */
     1990    11295    3             KQ$GARB.TCOUNT=KQ$GARB.TCOUNT+NMBLKS;

  11295  1 005352   100035 236300                    LDQ   ! 29,,PR1
         1 005353   200021 036300                    ADLQ  ! NMBLKS,,AUTO
         1 005354   100035 756300                    STQ   ! 29,,PR1

     1991    11296    3             KQ$GARB.SPSTATE=KQSP_CBIM1#;

  11296  1 005355   000007 236203                    LDQ   ! 7,DU
         1 005356   100046 552320                    STBQ  ! 38,'20'O,PR1

     1992    11297    3             END;

     1993    11298    2           KQ$GARB.CCCOUNT=NMBLKS;

  11298  1 005357   200021 721100                    LXL1    NMBLKS,,AUTO
         1 005360   100050 441100                    SXL1    40,,PR1

     1994    11299    2           IF KQ$GARB.TCOUNT > MBLK$->KQ$MBLK.COUNT THEN

  11299  1 005361   200005 474500                    LDP4    MBLK$,,AUTO
         1 005362   100035 236100                    LDQ     29,,PR1
         1 005363   400015 116100                    CMPQ    13,,PR4
         1 005364   005370 604400 1                  TMOZ    s:11301

     1995    11300    2            CALL SC_CGGARB;

  11300  1 005365   000000 713400 xsym               CLIMB   SC_CGGARB
         1 005366   000000 600000 xsid               climb   nvectors=         0
         1 005367   005377 710000 1                  TRA     s:11305

     1996    11301    2           ELSE IF KQ$GARB.TCOUNT = MBLK$->KQ$MBLK.COUNT THEN
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:271  

  11301  1 005370   005373 601000 1                  TNZ     s:11303

     1997    11302    2             KQ$GARB.NCDDA=0;

  11302  1 005371   100043 450100                    STZ     35,,PR1
         1 005372   005377 710000 1                  TRA     s:11305

     1998    11303    2            ELSE IF KQ$GARB.NCDDA = 0 THEN

  11303  1 005373   000000 115003                    CMPA    0,DU
         1 005374   005377 601000 1                  TNZ     s:11305

     1999    11304    2              CALL SC_CGGARB;

  11304  1 005375   000000 713400 xsym               CLIMB   SC_CGGARB
         1 005376   000000 600000 xsid               climb   nvectors=         0

     2000    11305    2           IF NOT KQ$GARB.INSRT THEN

  11305  1 005377   200006 470500                    LDP0    CG$,,AUTO
         1 005400   000032 236100                    LDQ     26,,PR0
         1 005401   040000 316003                    CANQ    16384,DU
         1 005402   005410 601000 1                  TNZ     ILOOP

     2001    11306    3             DO; /* SETLDA */

     2002    11307    3             IF KQ$GARB.NCDDA = 0 THEN RETURN;

  11307  1 005403   000043 235100                    LDA     35,,PR0
         1 005404   005407 601000 1                  TNZ     s:11308

  11307  1 005405   200030 221300                    LDX1  ! END$+1,,AUTO
         1 005406   000001 702211                    TSX2  ! 1,X1

     2003    11308    3             GOTO I90;

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:272  
  11308  1 005407   006266 710000 1                  TRA     I90

     2004    11309    3             END;
     2005    11310        /**/
     2006    11311    2   ILOOP:  I$=MBLK$->KQ$MBLK.INSHD$;

  11311  1 005410   200005 470500       ILOOP        LDP0    MBLK$,,AUTO
         1 005411   000012 236100                    LDQ     10,,PR0
         1 005412   200031 756100                    STQ     I$,,AUTO

     2007    11312    2           IF I$ = ADDR(NIL) THEN GOTO SPLIT;

  11312  1 005413   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 005414   005621 600000 1                  TZE     SPLIT

     2008    11313    2           IF I$->KQ$MBLK.PRIO < CTLBLK$->KQ$MBLK.PRIOLO THEN GOTO SPLIT;

  11313  1 005415   200026 471500                    LDP1    CTLBLK$,,AUTO
         1 005416   100010 720100                    LXL0    8,,PR1
         1 005417   200031 473500                    LDP3    I$,,AUTO
         1 005420   300001 100100                    CMPX0   1,,PR3
         1 005421   005423 600000 1                  TZE     s:11314
         1 005422   005621 603000 1                  TRC     SPLIT

     2009    11314    2           ELSE IF I$->KQ$MBLK.PRIO = CTLBLK$->KQ$MBLK.PRIOLO THEN

  11314  1 005423   005437 601000 1                  TNZ     IL0

     2010    11315    2             IF I$->KQ$MBLK.UTS > CTLBLK$->KQ$MBLK.UTSHI THEN GOTO SPLIT;

  11315  1 005424   100011 236100                    LDQ     9,,PR1
         1 005425   300007 116100                    CMPQ    7,,PR3
         1 005426   005621 602000 1                  TNC     SPLIT

     2011    11316    2             ELSE IF I$->KQ$MBLK.UTS = CTLBLK$->KQ$MBLK.UTSHI THEN

  11316  1 005427   005437 601000 1                  TNZ     IL0
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:273  

     2012    11317    2               IF I$->KQ$MBLK.STAMP > CTLBLK$->KQ$MBLK.UTSXTHI THEN GOTO SPLIT;

  11317  1 005430   300001 236100                    LDQ     1,,PR3
         1 005431   777777 376007                    ANQ     -1,DL
         1 005432   200066 756100                    STQ     I$+1,,AUTO
         1 005433   100014 236100                    LDQ     12,,PR1
         1 005434   777777 376007                    ANQ     -1,DL
         1 005435   200066 116100                    CMPQ    I$+1,,AUTO
         1 005436   005621 604000 1                  TMI     SPLIT

     2013    11318    2   IL0:    IF NMBLKS > 0 THEN

  11318  1 005437   200021 235100       IL0          LDA     NMBLKS,,AUTO
         1 005440   005472 604400 1                  TMOZ    s:11330

     2014    11319    3             DO;

     2015    11320    3             IF I$->KQ$MBLK.PRIO > Z$->KQ$MBLK.PRIO THEN GOTO IL10;

  11320  1 005441   200023 470500                    LDP0    Z$,,AUTO
         1 005442   000001 220100                    LDX0    1,,PR0
         1 005443   200031 471500                    LDP1    I$,,AUTO
         1 005444   100001 100100                    CMPX0   1,,PR1
         1 005445   005513 602000 1                  TNC     IL10

     2016    11321    3             ELSE IF I$->KQ$MBLK.PRIO = Z$->KQ$MBLK.PRIO THEN

  11321  1 005446   100001 221100                    LDX1    1,,PR1
         1 005447   000001 101100                    CMPX1   1,,PR0
         1 005450   005464 601000 1                  TNZ     s:11325

     2017    11322    3               IF I$->KQ$MBLK.UTS < Z$->KQ$MBLK.UTS THEN GOTO IL10;

  11322  1 005451   100007 236100                    LDQ     7,,PR1
         1 005452   000007 116100                    CMPQ    7,,PR0
         1 005453   005513 602000 1                  TNC     IL10
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:274  

     2018    11323    3               ELSE IF I$->KQ$MBLK.UTS = Z$->KQ$MBLK.UTS THEN

  11323  1 005454   005464 601000 1                  TNZ     s:11325

     2019    11324    3                 IF I$->KQ$MBLK.STAMP < Z$->KQ$MBLK.STAMP THEN GOTO IL10;

  11324  1 005455   000001 236100                    LDQ     1,,PR0
         1 005456   777777 376007                    ANQ     -1,DL
         1 005457   200066 756100                    STQ     I$+1,,AUTO
         1 005460   100001 236100                    LDQ     1,,PR1
         1 005461   777777 376007                    ANQ     -1,DL
         1 005462   200066 116100                    CMPQ    I$+1,,AUTO
         1 005463   005513 604000 1                  TMI     IL10

     2020    11325    3             Z$=PINCRW(Z$,SIZEW(KQ$MBLK));

  11325  1 005464   200023 236100                    LDQ     Z$,,AUTO
         1 005465   000020 036003                    ADLQ    16,DU
         1 005466   200023 756100                    STQ     Z$,,AUTO

     2021    11326    3             NMBLKS=NMBLKS-1;

  11326  1 005467   000001 336007                    LCQ     1,DL
         1 005470   200021 056100                    ASQ     NMBLKS,,AUTO

     2022    11327    3             GOTO IL0;

  11327  1 005471   005437 710000 1                  TRA     IL0

     2023    11328    3             END;
     2024    11329        /**/    /* Looked at all MBLKs that were there before */
     2025    11330    2           IF NFREE = 0 THEN

  11330  1 005472   200032 236100                    LDQ     NFREE,,AUTO
         1 005473   005477 601000 1                  TNZ     s:11343

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:275  
     2026    11331    3             DO;

     2027    11332                     /*    Put this one
     2028    11333                      *    on the SPLIT
     2029    11334                      *    list.
     2030    11335                      */
     2031    11336    3             CALL SPLT;

  11336  1 005474   006674 701000 1                  TSX1    SPLT
         1 005475   000000 011000                    NOP     0

     2032    11337    3             GOTO ILOOP;

  11337  1 005476   005410 710000 1                  TRA     ILOOP

     2033    11338    3             END;
     2034    11339                     /*    Put this one
     2035    11340                      *    in the free
     2036    11341                      *    zone.
     2037    11342                      */
     2038    11343    2           FREE$->KQ$MBLK=I$->KQ$MBLK;

  11343  1 005477   200031 470500                    LDP0    I$,,AUTO
         1 005500   200033 471500                    LDP1    FREE$,,AUTO
         1 005501   000100 100500                    MLR     fill='000'O
         1 005502   000000 000100                    ADSC9   0,,PR0                   cn=0,n=64
         1 005503   100000 000100                    ADSC9   0,,PR1                   cn=0,n=64

     2039    11344    2           CALL INSUPD;

  11344  1 005504   006644 701000 1                  TSX1    INSUPD
         1 005505   000000 011000                    NOP     0

     2040    11345    2           CALL RELMBLK (I$->KQ$MBLK);

  11345  1 005506   200031 236100                    LDQ     I$,,AUTO
         1 005507   200057 756100                    STQ     @START$,,AUTO
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:276  
         1 005510   007545 701000 1                  TSX1    RELMBLK
         1 005511   000000 011000                    NOP     0

     2041    11346    2           GOTO ILOOP;

  11346  1 005512   005410 710000 1                  TRA     ILOOP

     2042    11347        /**/
     2043    11348                     /*    Insert this one
     2044    11349                      *    ahead of Z$
     2045    11350                      */
     2046    11351    2   IL10:   IF NFREE > 0 THEN

  11351  1 005513   200032 236100       IL10         LDQ     NFREE,,AUTO
         1 005514   005541 604400 1                  TMOZ    s:11367

     2047    11352    3             DO INHIBIT;

     2048    11353                     /*    Shuffle down
     2049    11354                      *    into the free zone.
     2050    11355                      */
     2051    11356    3             CALL KQX$SLIDE (Z$->KQ$MBLK,NMBLKS);

  11356  1 005515   200021 633700                    EPPR3 ! NMBLKS,,AUTO
         1 005516   200067 453700                    STP3  ! I$+2,,AUTO
         1 005517   200023 236300                    LDQ   ! Z$,,AUTO
         1 005520   200066 756300                    STQ   ! I$+1,,AUTO
         1 005521   200066 630700                    EPPR0 ! I$+1,,AUTO
         1 005522   000020 631600 xsym               EPPR1 ! B_VECTNIL+16
         1 005523   000000 701200 xent               TSX1  ! KQX$SLIDE
         1 005524   000000 011200                    NOP   ! 0

     2052    11357    3             Z$->KQ$MBLK=I$->KQ$MBLK;

  11357  1 005525   200031 470700                    LDP0  ! I$,,AUTO
         1 005526   200023 471700                    LDP1  ! Z$,,AUTO
         1 005527   000100 100700                    MLR   ! fill='000'O
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:277  
         1 005530   000000 000100                    ADSC9   0,,PR0                   cn=0,n=64
         1 005531   100000 000100                    ADSC9   0,,PR1                   cn=0,n=64

     2053    11358    3             CALL INSUPD;

  11358  1 005532   006644 701200 1                  TSX1  ! INSUPD
         1 005533   000000 011200                    NOP   ! 0

     2054    11359    3             CALL RELMBLK (I$->KQ$MBLK);

  11359  1 005534   200031 236300                    LDQ   ! I$,,AUTO
         1 005535   200057 756300                    STQ   ! @START$,,AUTO
         1 005536   007545 701200 1                  TSX1  ! RELMBLK
         1 005537   000000 011200                    NOP   ! 0

     2055    11360    3             END;

  11360  1 005540   005613 710000 1                  TRA     s:11379

     2056    11361    2           ELSE
     2057    11362    3             DO INHIBIT;

     2058    11363                     /*    No free space,
     2059    11364                      *    so squeeze last
     2060    11365                      *    onto SQUEEZE list.
     2061    11366                      */
     2062    11367    3             M$=PINCRW(CTLBLK$,-SIZEW(KQ$MBLK));

  11367  1 005541   200026 236300                    LDQ   ! CTLBLK$,,AUTO
         1 005542   777760 036203                    ADLQ  ! -16,DU
         1 005543   200020 756300                    STQ   ! M$,,AUTO

     2063    11368    3             SMBLK=M$->KQ$MBLK;

  11368  1 005544   200020 473700                    LDP3  ! M$,,AUTO
         1 005545   000100 100700                    MLR   ! fill='000'O
         1 005546   300000 000100                    ADSC9   0,,PR3                   cn=0,n=64
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:278  
         1 005547   200034 000100                    ADSC9   SMBLK,,AUTO              cn=0,n=64

     2064    11369    3             CALL KQX$SLIDE (Z$->KQ$MBLK,NMBLKS-1);

  11369  1 005550   000001 135207                    SBLA  ! 1,DL
         1 005551   200066 755300                    STA   ! I$+1,,AUTO
         1 005552   200066 634700                    EPPR4 ! I$+1,,AUTO
         1 005553   200071 454700                    STP4  ! I$+4,,AUTO
         1 005554   200023 236300                    LDQ   ! Z$,,AUTO
         1 005555   200070 756300                    STQ   ! I$+3,,AUTO
         1 005556   200070 630700                    EPPR0 ! I$+3,,AUTO
         1 005557   000020 631600 xsym               EPPR1 ! B_VECTNIL+16
         1 005560   000000 701200 xent               TSX1  ! KQX$SLIDE
         1 005561   000000 011200                    NOP   ! 0

     2065    11370    3             Z$->KQ$MBLK=I$->KQ$MBLK;

  11370  1 005562   200031 470700                    LDP0  ! I$,,AUTO
         1 005563   200023 471700                    LDP1  ! Z$,,AUTO
         1 005564   000100 100700                    MLR   ! fill='000'O
         1 005565   000000 000100                    ADSC9   0,,PR0                   cn=0,n=64
         1 005566   100000 000100                    ADSC9   0,,PR1                   cn=0,n=64

     2066    11371    3             MBLK$->KQ$MBLK.INSHD$=I$->KQ$MBLK.LNK$;

  11371  1 005567   200031 470700                    LDP0  ! I$,,AUTO
         1 005570   000000 236300                    LDQ   ! 0,,PR0
         1 005571   200005 473700                    LDP3  ! MBLK$,,AUTO
         1 005572   300012 756300                    STQ   ! 10,,PR3

     2067    11372    3             I$->KQ$MBLK=SMBLK;

  11372  1 005573   200031 470700                    LDP0  ! I$,,AUTO
         1 005574   000100 100700                    MLR   ! fill='000'O
         1 005575   200034 000100                    ADSC9   SMBLK,,AUTO              cn=0,n=64
         1 005576   000000 000100                    ADSC9   0,,PR0                   cn=0,n=64

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:279  
     2068    11373    3             CALL SQZ;

  11373  1 005577   006726 701200 1                  TSX1  ! SQZ
         1 005600   000000 011200                    NOP   ! 0

     2069    11374    3             CALL UPDATE;

  11374  1 005601   007471 701200 1                  TSX1  ! UPDATE
         1 005602   000000 011200                    NOP   ! 0

     2070    11375    3             CTLBLK$->KQ$MBLK.PRIOLO =M$->KQ$MBLK.PRIO;

  11375  1 005603   200020 470700                    LDP0  ! M$,,AUTO
         1 005604   000001 220300                    LDX0  ! 1,,PR0
         1 005605   200026 471700                    LDP1  ! CTLBLK$,,AUTO
         1 005606   100010 440300                    SXL0  ! 8,,PR1

     2071    11376    3             CTLBLK$->KQ$MBLK.UTSHI  =M$->KQ$MBLK.UTS;

  11376  1 005607   000007 235300                    LDA   ! 7,,PR0
         1 005610   100011 755300                    STA   ! 9,,PR1

     2072    11377    3             CTLBLK$->KQ$MBLK.UTSXTHI=M$->KQ$MBLK.STAMP;

  11377  1 005611   000001 721300                    LXL1  ! 1,,PR0
         1 005612   100014 441300                    SXL1  ! 12,,PR1

     2073    11378    3             END;

     2074    11379    2           NMBLKS=NMBLKS-1;

  11379  1 005613   000001 336007                    LCQ     1,DL
         1 005614   200021 056100                    ASQ     NMBLKS,,AUTO

     2075    11380    2           Z$=PINCRW(Z$,SIZEW(KQ$MBLK));

  11380  1 005615   200023 236100                    LDQ     Z$,,AUTO
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:280  
         1 005616   000020 036003                    ADLQ    16,DU
         1 005617   200023 756100                    STQ     Z$,,AUTO

     2076    11381    2           GOTO ILOOP;

  11381  1 005620   005410 710000 1                  TRA     ILOOP

     2077    11382        %EJECT;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:281  
     2078    11383        /**/
     2079    11384                     /*    Come here when done.
     2080    11385                      *    If there's anything
     2081    11386                      *    on the SPLIT list
     2082    11387                      *    then we must create
     2083    11388                      *    a new DBLK and dump
     2084    11389                      *    them into it, updating
     2085    11390                      *    various flinks and
     2086    11391                      *    blinks.
     2087    11392                      */
     2088    11393    2   SPLIT:  KQ$GARB.SPSTATE=KQSP_CBUL#;

  11393  1 005621   200006 471500       SPLIT        LDP1    CG$,,AUTO
         1 005622   000002 236003                    LDQ     2,DU
         1 005623   100046 552120                    STBQ    38,'20'O,PR1

     2089    11394    2           CALL UNLOCK;

  11394  1 005624   007454 701000 1                  TSX1    UNLOCK
         1 005625   000000 011000                    NOP     0

     2090    11395    2   RCBUL:  IF KQ$GARB.SQHD$ ~= ADDR(NIL) THEN

  11395  1 005626   200006 470500       RCBUL        LDP0    CG$,,AUTO
         1 005627   000051 236100                    LDQ     41,,PR0
         1 005630   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 005631   005701 600000 1                  TZE     s:11410

     2091    11396    3             DO;

     2092    11397    4               DO WHILE (MBLK$->KQ$MBLK.INSHD$ ~= ADDR(NIL));

  11397  1 005632   005662 710000 1                  TRA     s:11405

     2093    11398    4               I$=MBLK$->KQ$MBLK.INSHD$;

  11398  1 005633   200005 470500                    LDP0    MBLK$,,AUTO
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:282  
         1 005634   000012 236100                    LDQ     10,,PR0
         1 005635   200031 756100                    STQ     I$,,AUTO

     2094    11399    4               IF I$->KQ$MBLK.PRIO < KQ$GARB.SQHD$->KQ$MBLK.PRIO THEN GOTO SPLIT0;

  11399  1 005636   200006 471500                    LDP1    CG$,,AUTO
         1 005637   100051 473500                    LDP3    41,,PR1
         1 005640   200031 474500                    LDP4    I$,,AUTO
         1 005641   400001 220100                    LDX0    1,,PR4
         1 005642   300001 100100                    CMPX0   1,,PR3
         1 005643   005666 602000 1                  TNC     SPLIT0

     2095    11400    4               ELSE IF I$->KQ$MBLK.PRIO = KQ$GARB.SQHD$->KQ$MBLK.PRIO THEN

  11400  1 005644   005660 601000 1                  TNZ     s:11404

     2096    11401    4                 IF I$->KQ$MBLK.UTS > KQ$GARB.SQHD$->KQ$MBLK.UTS THEN GOTO SPLIT0;

  11401  1 005645   300007 236100                    LDQ     7,,PR3
         1 005646   400007 116100                    CMPQ    7,,PR4
         1 005647   005666 602000 1                  TNC     SPLIT0

     2097    11402    4                 ELSE IF I$->KQ$MBLK.UTS = KQ$GARB.SQHD$->KQ$MBLK.UTS THEN

  11402  1 005650   005660 601000 1                  TNZ     s:11404

     2098    11403    4                  IF I$->KQ$MBLK.STAMP > KQ$GARB.SQHD$->KQ$MBLK.STAMP THEN GOTO SPLIT0
             11403                            ;

  11403  1 005651   400001 236100                    LDQ     1,,PR4
         1 005652   777777 376007                    ANQ     -1,DL
         1 005653   200066 756100                    STQ     I$+1,,AUTO
         1 005654   300001 236100                    LDQ     1,,PR3
         1 005655   777777 376007                    ANQ     -1,DL
         1 005656   200066 116100                    CMPQ    I$+1,,AUTO
         1 005657   005666 604000 1                  TMI     SPLIT0

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:283  
     2099    11404    4               CALL SPLT;

  11404  1 005660   006674 701000 1                  TSX1    SPLT
         1 005661   000000 011000                    NOP     0

     2100    11405    4               END;

  11405  1 005662   200005 470500                    LDP0    MBLK$,,AUTO
         1 005663   000012 236100                    LDQ     10,,PR0
         1 005664   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 005665   005633 601000 1                  TNZ     s:11398

     2101    11406    3   SPLIT0:   IF KQ$GARB.SPHD$ ~= ADDR(NIL) THEN

  11406  1 005666   200006 471500       SPLIT0       LDP1    CG$,,AUTO
         1 005667   100040 236100                    LDQ     32,,PR1
         1 005670   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 005671   005676 600000 1                  TZE     s:11408

     2102    11407    3              KQ$GARB.SPTL$->KQ$MBLK.LNK$=KQ$GARB.SQHD$;

  11407  1 005672   100041 473500                    LDP3    33,,PR1
         1 005673   100051 236100                    LDQ     41,,PR1
         1 005674   300000 756100                    STQ     0,,PR3
         1 005675   005715 710000 1                  TRA     s:11415

     2103    11408    3             ELSE KQ$GARB.SPHD$=KQ$GARB.SQHD$;

  11408  1 005676   100051 236100                    LDQ     41,,PR1
         1 005677   100040 756100                    STQ     32,,PR1

     2104    11409    3             END;

  11409  1 005700   005715 710000 1                  TRA     s:11415

     2105    11410    2           ELSE IF KQ$GARB.NCDDA = 0 THEN

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:284  
  11410  1 005701   000043 235100                    LDA     35,,PR0
         1 005702   005715 601000 1                  TNZ     s:11415

     2106    11411    3              DO WHILE (MBLK$->KQ$MBLK.INSHD$ ~= ADDR(NIL));

  11411  1 005703   005711 710000 1                  TRA     s:11414

     2107    11412    3              I$=MBLK$->KQ$MBLK.INSHD$;

  11412  1 005704   200005 470500                    LDP0    MBLK$,,AUTO
         1 005705   000012 236100                    LDQ     10,,PR0
         1 005706   200031 756100                    STQ     I$,,AUTO

     2108    11413    3              CALL SPLT;

  11413  1 005707   006674 701000 1                  TSX1    SPLT
         1 005710   000000 011000                    NOP     0

     2109    11414    3              END;

  11414  1 005711   200005 470500                    LDP0    MBLK$,,AUTO
         1 005712   000012 236100                    LDQ     10,,PR0
         1 005713   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 005714   005704 601000 1                  TNZ     s:11412

     2110    11415    2           IF KQ$GARB.SPHD$ ~= ADDR(NIL) THEN

  11415  1 005715   200006 470500                    LDP0    CG$,,AUTO
         1 005716   000040 236100                    LDQ     32,,PR0
         1 005717   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 005720   006233 600000 1                  TZE     s:11500

     2111    11416    3   DOSPLIT:  DO INHIBIT;

  11416  1 005721                       DOSPLIT      null
     2112    11417    3             NMBLKS=KQ$GARB.SPLITCNT;

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:285  
  11417  1 005721   200006 470700                    LDP0  ! CG$,,AUTO
         1 005722   000042 236300                    LDQ   ! 34,,PR0
         1 005723   000022 772200                    QRL   ! 18
         1 005724   200021 756300                    STQ   ! NMBLKS,,AUTO

     2113    11418    3             IF NMBLKS > %KQ_MMPS# THEN NMBLKS=%KQ_MMPS#;

  11418  1 005725   000035 116207                    CMPQ  ! 29,DL
         1 005726   005731 604600 1                  TMOZ  ! s:11419

  11418  1 005727   000035 235207                    LDA   ! 29,DL
         1 005730   200021 755300                    STA   ! NMBLKS,,AUTO

     2114    11419    3             CALL GETDBLK (KQGD_SQIG0#,KQGD_SQID4#) ALTRET(NODBLK);

  11419  1 005731   000063 236200 2                  LDQ   ! 51
         1 005732   200056 756300                    STQ   ! @CLKDFR,,AUTO
         1 005733   000064 236200 2                  LDQ   ! 52
         1 005734   200055 756300                    STQ   ! @DFR,,AUTO
         1 005735   004257 701200 1                  TSX1  ! GETDBLK
         1 005736   006505 702200 1                  TSX2  ! NODBLK

     2115    11420    3   GOTDBLK:  KQ$GARB.SPSTATE=KQSP_NBIM#;

  11420  1 005737   200006 470700       GOTDBLK      LDP0  ! CG$,,AUTO
         1 005740   000003 236203                    LDQ   ! 3,DU
         1 005741   000046 552320                    STBQ  ! 38,'20'O,PR0

     2116    11421    3             NMBLKS=KQ$GARB.SPLITCNT;

  11421  1 005742   000042 236300                    LDQ   ! 34,,PR0
         1 005743   000022 772200                    QRL   ! 18
         1 005744   200021 756300                    STQ   ! NMBLKS,,AUTO

     2117    11422    3             IF NMBLKS > %KQ_MMPS# THEN NMBLKS=%KQ_MMPS#;

  11422  1 005745   000035 116207                    CMPQ  ! 29,DL
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:286  
         1 005746   005751 604600 1                  TMOZ  ! s:11423

  11422  1 005747   000035 235207                    LDA   ! 29,DL
         1 005750   200021 755300                    STA   ! NMBLKS,,AUTO

     2118    11423    3             CALL FILLDBLK (KQ$GARB.SPHD$,SMBLK);

  11423  1 005751   200034 631700                    EPPR1 ! SMBLK,,AUTO
         1 005752   200060 451700                    STP1  ! @SMBLK,,AUTO
         1 005753   200006 236300                    LDQ   ! CG$,,AUTO
         1 005754   000040 036203                    ADLQ  ! 32,DU
         1 005755   200057 756300                    STQ   ! @START$,,AUTO
         1 005756   003757 701200 1                  TSX1  ! FILLDBLK
         1 005757   000000 011200                    NOP   ! 0

     2119    11424    3             IF KQ_LOG.GARB THEN

  11424  1 005760   000000 236200 xsym               LDQ   ! KQ_LOG
         1 005761   200000 316203                    CANQ  ! 65536,DU
         1 005762   006010 600200 1                  TZE   ! s:11433

     2120    11425    4               DO;

     2121    11426    4               CALL KQZ$LOG (CG$->KQ$CG,%KQLOG_GISP,ENTFLAG,

  11426  1 005763   200005 236300                    LDQ   ! MBLK$,,AUTO
         1 005764   000003 036203                    ADLQ  ! 3,DU
         1 005765   200074 756300                    STQ   ! I$+7,,AUTO
         1 005766   200006 236300                    LDQ   ! CG$,,AUTO
         1 005767   000043 036203                    ADLQ  ! 35,DU
         1 005770   200073 756300                    STQ   ! I$+6,,AUTO
         1 005771   200042 630700                    EPPR0 ! DELETE,,AUTO
         1 005772   200072 450700                    STP0  ! I$+5,,AUTO
         1 005773   200042 631700                    EPPR1 ! DELETE,,AUTO
         1 005774   200071 451700                    STP1  ! I$+4,,AUTO
         1 005775   200015 633700                    EPPR3 ! ENTFLAG,,AUTO
         1 005776   200070 453700                    STP3  ! I$+3,,AUTO
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:287  
         1 005777   000066 236200 2                  LDQ   ! 54
         1 006000   200006 235300                    LDA   ! CG$,,AUTO
         1 006001   200066 757300                    STAQ  ! I$+1,,AUTO
         1 006002   200066 630700                    EPPR0 ! I$+1,,AUTO
         1 006003   000025 631600 xsym               EPPR1 ! B_VECTNIL+21
         1 006004   000000 701200 xent               TSX1  ! KQZ$LOG
         1 006005   006010 702200 1                  TSX2  ! s:11433

     2122    11427    4               SMBLK.DDA,
     2123    11428    4               ADDR(SMBLK.DDA)->B$$HALF,
     2124    11429    4               KQ$GARB.NCDDA,
     2125    11430    4               MBLK$->KQ$MBLK.SDA.CCDDA) ALTRET(ZA2);
     2126    11431    4               RETURN;

  11431  1 006006   200030 221300                    LDX1  ! END$+1,,AUTO
         1 006007   000001 702211                    TSX2  ! 1,X1

     2127    11432    4   ZA2:        END;
     2128    11433    3             CTLBLK$=PINCRW(DBLK$,DBLK$->KQ$DBLK.SIZW-SIZEW(KQ$MBLK));

  11433  1 006010   200011 470700                    LDP0  ! DBLK$,,AUTO
         1 006011   000004 220300                    LDX0  ! 4,,PR0
         1 006012   777760 636210                    EAQ   ! -16,X0
         1 006013   200011 036300                    ADLQ  ! DBLK$,,AUTO
         1 006014   200026 756300                    STQ   ! CTLBLK$,,AUTO

     2129    11434    3             CTLBLK$->KQ$MBLK.CCSTAMP=KQ$GARB.NCSTAMP;

  11434  1 006015   200006 471700                    LDP1  ! CG$,,AUTO
         1 006016   100042 721300                    LXL1  ! 34,,PR1
         1 006017   200026 473700                    LDP3  ! CTLBLK$,,AUTO
         1 006020   300016 441300                    SXL1  ! 14,,PR3

     2130    11435    3             CTLBLK$->KQ$MBLK.PCDDA=MBLK$->KQ$MBLK.SDA.CCDDA;

  11435  1 006021   200005 474700                    LDP4  ! MBLK$,,AUTO
         1 006022   400003 235300                    LDA   ! 3,,PR4
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:288  
         1 006023   300017 755300                    STA   ! 15,,PR3

     2131    11436    3             CTLBLK$->KQ$MBLK.PCVALID='0'B;

  11436  1 006024   000015 236200 2                  LDQ   ! 13
         1 006025   300010 356300                    ANSQ  ! 8,,PR3

     2132    11437    3             DBLK$->KQ$DBLK.FLNKDA=KQ$GARB.NCDDA;

  11437  1 006026   200011 470700                    LDP0  ! DBLK$,,AUTO
         1 006027   100043 235300                    LDA   ! 35,,PR1
         1 006030   000001 755300                    STA   ! 1,,PR0

     2133    11438    4               DO INHIBIT;

     2134    11439    4               KQ$GARB.TCOUNT=KQ$GARB.TCOUNT+NMBLKS;

  11439  1 006031   100035 236300                    LDQ   ! 29,,PR1
         1 006032   200021 036300                    ADLQ  ! NMBLKS,,AUTO
         1 006033   100035 756300                    STQ   ! 29,,PR1

     2135    11440    4               MBLK$->KQ$MBLK.COUNT=MBLK$->KQ$MBLK.COUNT+NMBLKS;

  11440  1 006034   400015 236300                    LDQ   ! 13,,PR4
         1 006035   200021 036300                    ADLQ  ! NMBLKS,,AUTO
         1 006036   400015 756300                    STQ   ! 13,,PR4

     2136    11441    4               KQ$GARB.SCDDA=DDA;

  11441  1 006037   200013 235300                    LDA   ! DDA,,AUTO
         1 006040   100044 755300                    STA   ! 36,,PR1

     2137    11442    4               KQ$GARB.SCSTAMP=SMBLK.STAMP;

  11442  1 006041   200035 720300                    LXL0  ! SMBLK+1,,AUTO
         1 006042   100045 740300                    STX0  ! 37,,PR1

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:289  
     2138    11443    4               KQ$GARB.SPSTATE=KQSP_NBUL#;

  11443  1 006043   000004 236203                    LDQ   ! 4,DU
         1 006044   100046 552320                    STBQ  ! 38,'20'O,PR1

     2139    11444    4               CALL UNLOCK;

  11444  1 006045   007454 701200 1                  TSX1  ! UNLOCK
         1 006046   000000 011200                    NOP   ! 0

     2140    11445    4               END;

  11442  1 006047                       RNBUL        null
     2141    11446    3   RNBUL:    ;
     2142    11447        /**/
     2143    11448    3   FTCH1:    DDA=MBLK$->KQ$MBLK.SDA.CCDDA;

  11448  1 006047   200005 470700       FTCH1        LDP0  ! MBLK$,,AUTO
         1 006050   000003 235300                    LDA   ! 3,,PR0
         1 006051   200013 755300                    STA   ! DDA,,AUTO

     2144    11449    3             DBLK$R=MBLK$->KQ$MBLK.CCSTAMP;

  11449  1 006052   000016 236300                    LDQ   ! 14,,PR0
         1 006053   777777 376207                    ANQ   ! -1,DL
         1 006054   200011 756300                    STQ   ! DBLK$,,AUTO

     2145    11450    3             CALL FETCH (KQGD_SQIF1#,KQGD_SQID1#) ALTRET(NOFETCH1);

  11450  1 006055   000071 236200 2                  LDQ   ! 57
         1 006056   200056 756300                    STQ   ! @CLKDFR,,AUTO
         1 006057   000072 236200 2                  LDQ   ! 58
         1 006060   200055 756300                    STQ   ! @DFR,,AUTO
         1 006061   006740 701200 1                  TSX1  ! FETCH
         1 006062   006325 702200 1                  TSX2  ! NOFETCH1

     2146    11451    3   FTCHD1:   KQ$GARB.SPSTATE=KQSP_BBIM#;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:290  

  11451  1 006063   200006 470700       FTCHD1       LDP0  ! CG$,,AUTO
         1 006064   000005 236203                    LDQ   ! 5,DU
         1 006065   000046 552320                    STBQ  ! 38,'20'O,PR0

     2147    11452    3             CALL CHKBLINK ALTRET(FERR1);

  11452  1 006066   007153 701200 1                  TSX1  ! CHKBLINK
         1 006067   006335 702200 1                  TSX2  ! FERR1

     2148    11453    3             DBLK$->KQ$DBLK.FLNKDA=KQ$GARB.SCDDA;

  11453  1 006070   200006 470700                    LDP0  ! CG$,,AUTO
         1 006071   200011 471700                    LDP1  ! DBLK$,,AUTO
         1 006072   000044 235300                    LDA   ! 36,,PR0
         1 006073   100001 755300                    STA   ! 1,,PR1

     2149    11454    3             CTLBLK$->KQ$MBLK.CCSTAMP=KQ$GARB.SCSTAMP;

  11454  1 006074   000045 220300                    LDX0  ! 37,,PR0
         1 006075   200026 471700                    LDP1  ! CTLBLK$,,AUTO
         1 006076   100016 440300                    SXL0  ! 14,,PR1

     2150    11455    3             KQ$GARB.SPSTATE=KQSP_BBUL#;

  11455  1 006077   000006 236203                    LDQ   ! 6,DU
         1 006100   000046 552320                    STBQ  ! 38,'20'O,PR0

     2151    11456    3             CALL UPDATE;

  11456  1 006101   007471 701200 1                  TSX1  ! UPDATE
         1 006102   000000 011200                    NOP   ! 0

     2152    11457    3             CALL UNLOCK;

  11457  1 006103   007454 701200 1                  TSX1  ! UNLOCK
         1 006104   000000 011200                    NOP   ! 0
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:291  

     2153    11458    4               DO INHIBIT;

     2154    11459    4   RBBUL:      MBLK$->KQ$MBLK.PCDDA=MBLK$->KQ$MBLK.SDA.CCDDA;

  11459  1 006105   200005 470700       RBBUL        LDP0  ! MBLK$,,AUTO
         1 006106   000003 235300                    LDA   ! 3,,PR0
         1 006107   000017 755300                    STA   ! 15,,PR0

     2155    11460    4               KQ$GARB.PCSTAMP=MBLK$->KQ$MBLK.CCSTAMP;

  11460  1 006110   000016 720300                    LXL0  ! 14,,PR0
         1 006111   200006 471700                    LDP1  ! CG$,,AUTO
         1 006112   100050 740300                    STX0  ! 40,,PR1

     2156    11461    4               MBLK$->KQ$MBLK.SDA.CCDDA=KQ$GARB.SCDDA;

  11461  1 006113   100044 235300                    LDA   ! 36,,PR1
         1 006114   000003 755300                    STA   ! 3,,PR0

     2157    11462    4               MBLK$->KQ$MBLK.CCSTAMP=KQ$GARB.SCSTAMP;

  11462  1 006115   100045 220300                    LDX0  ! 37,,PR1
         1 006116   000016 440300                    SXL0  ! 14,,PR0

     2158    11463    4               NMBLKS=KQ$GARB.SPLITCNT;

  11463  1 006117   100042 236300                    LDQ   ! 34,,PR1
         1 006120   000022 772200                    QRL   ! 18
         1 006121   200021 756300                    STQ   ! NMBLKS,,AUTO

     2159    11464    4               IF NMBLKS > %KQ_MMPS# THEN NMBLKS=%KQ_MMPS#;

  11464  1 006122   000035 116207                    CMPQ  ! 29,DL
         1 006123   006126 604600 1                  TMOZ  ! s:11465

  11464  1 006124   000035 235207                    LDA   ! 29,DL
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:292  
         1 006125   200021 755300                    STA   ! NMBLKS,,AUTO

     2160    11465    4               KQ$GARB.CCCOUNT=NMBLKS;

  11465  1 006126   200021 720300                    LXL0  ! NMBLKS,,AUTO
         1 006127   100050 440300                    SXL0  ! 40,,PR1

     2161    11466    4               IF KQ$GARB.NCDDA = 0 THEN

  11466  1 006130   100043 235300                    LDA   ! 35,,PR1
         1 006131   006141 601200 1                  TNZ   ! FTCH2

     2162    11467    5                 DO;

     2163    11468    5   I60:          MBLK$->KQ$MBLK.SDA.LDA=KQ$GARB.SCDDA;

  11468  1 006132   200006 470700       I60          LDP0  ! CG$,,AUTO
         1 006133   200005 471700                    LDP1  ! MBLK$,,AUTO
         1 006134   000044 235300                    LDA   ! 36,,PR0
         1 006135   100002 755300                    STA   ! 2,,PR1

     2164    11469    5                 MBLK$->KQ$MBLK.LCSTAMP=KQ$GARB.SCSTAMP;

  11469  1 006136   000045 220300                    LDX0  ! 37,,PR0
         1 006137   100016 740300                    STX0  ! 14,,PR1

     2165    11470    5                 END;

  11470  1 006140   006172 710200 1                  TRA   ! RFBUL

     2166    11471    4               ELSE
     2167    11472    5                 DO;

     2168    11473    5   FTCH2:        DDA=KQ$GARB.NCDDA;

  11473  1 006141   200006 470700       FTCH2        LDP0  ! CG$,,AUTO
         1 006142   000043 235300                    LDA   ! 35,,PR0
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:293  
         1 006143   200013 755300                    STA   ! DDA,,AUTO

     2169    11474    5                 DBLK$R=KQ$GARB.NCSTAMP;

  11474  1 006144   000042 236300                    LDQ   ! 34,,PR0
         1 006145   777777 376207                    ANQ   ! -1,DL
         1 006146   200011 756300                    STQ   ! DBLK$,,AUTO

     2170    11475    5   RFBIM:        CALL FETCH (KQGD_SQIF2#,KQGD_SQID2#) ALTRET(NOFETCH2);

  11475  1 006147   000075 236200 2     RFBIM        LDQ   ! 61
         1 006150   200056 756300                    STQ   ! @CLKDFR,,AUTO
         1 006151   000076 236200 2                  LDQ   ! 62
         1 006152   200055 756300                    STQ   ! @DFR,,AUTO
         1 006153   006740 701200 1                  TSX1  ! FETCH
         1 006154   006435 702200 1                  TSX2  ! NOFETCH2

     2171    11476    5   FTCHD2:       KQ$GARB.SPSTATE=KQSP_FBIM#;

  11476  1 006155   200006 470700       FTCHD2       LDP0  ! CG$,,AUTO
         1 006156   000010 236203                    LDQ   ! 8,DU
         1 006157   000046 552320                    STBQ  ! 38,'20'O,PR0

     2172    11477    5                 CALL CHKBLINK ALTRET(FERR2);

  11477  1 006160   007153 701200 1                  TSX1  ! CHKBLINK
         1 006161   006445 702200 1                  TSX2  ! FERR2

     2173    11478    5                 CTLBLK$->KQ$MBLK.PCDDA=KQ$GARB.SCDDA;

  11478  1 006162   200006 470700                    LDP0  ! CG$,,AUTO
         1 006163   200026 471700                    LDP1  ! CTLBLK$,,AUTO
         1 006164   000044 235300                    LDA   ! 36,,PR0
         1 006165   100017 755300                    STA   ! 15,,PR1

     2174    11479    5                 KQ$GARB.SPSTATE=KQSP_FBUL#;

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:294  
  11479  1 006166   000011 236203                    LDQ   ! 9,DU
         1 006167   000046 552320                    STBQ  ! 38,'20'O,PR0

     2175    11480    5                 CALL UNLOCK;

  11480  1 006170   007454 701200 1                  TSX1  ! UNLOCK
         1 006171   000000 011200                    NOP   ! 0

     2176    11481    5   RFBUL:        END;

  11481  1 006172                       RFBUL        null
     2177    11482    4               END;

     2178    11483        /**/
     2179    11484    3   RRLSP:    KQ$GARB.SPSTATE=KQSP_RLSP#;

  11484  1 006172   200006 470700       RRLSP        LDP0  ! CG$,,AUTO
         1 006173   000012 236203                    LDQ   ! 10,DU
         1 006174   000046 552320                    STBQ  ! 38,'20'O,PR0

     2180    11485    3             NMBLKS=KQ$GARB.SPLITCNT;

  11485  1 006175   000042 236300                    LDQ   ! 34,,PR0
         1 006176   000022 772200                    QRL   ! 18
         1 006177   200021 756300                    STQ   ! NMBLKS,,AUTO

     2181    11486    3             IF NMBLKS > %KQ_MMPS# THEN NMBLKS=%KQ_MMPS#;

  11486  1 006200   000035 116207                    CMPQ  ! 29,DL
         1 006201   006204 604600 1                  TMOZ  ! s:11487

  11486  1 006202   000035 235207                    LDA   ! 29,DL
         1 006203   200021 755300                    STA   ! NMBLKS,,AUTO

     2182    11487    4               DO I = 1 TO NMBLKS;

  11487  1 006204   000001 235207                    LDA   ! 1,DL
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:295  
         1 006205   200012 755300                    STA   ! I,,AUTO
         1 006206   006225 710200 1                  TRA   ! s:11494+1

     2183    11488    4               X$=KQ$GARB.SPHD$;

  11488  1 006207   200006 470700                    LDP0  ! CG$,,AUTO
         1 006210   000040 236300                    LDQ   ! 32,,PR0
         1 006211   200022 756300                    STQ   ! X$,,AUTO

     2184    11489    5                 DO INHIBIT;

     2185    11490    5                 KQ$GARB.SPHD$=X$->KQ$MBLK.LNK$;

  11490  1 006212   200022 471700                    LDP1  ! X$,,AUTO
         1 006213   100000 236300                    LDQ   ! 0,,PR1
         1 006214   000040 756300                    STQ   ! 32,,PR0

     2186    11491    5                 KQ$GARB.SPLITCNT=KQ$GARB.SPLITCNT-1;

  11491  1 006215   000042 220300                    LDX0  ! 34,,PR0
         1 006216   777777 621210                    EAX1  ! -1,X0
         1 006217   000042 741300                    STX1  ! 34,,PR0

     2187    11492    5                 CALL RELMBLK (X$->KQ$MBLK);

  11492  1 006220   200022 236300                    LDQ   ! X$,,AUTO
         1 006221   200057 756300                    STQ   ! @START$,,AUTO
         1 006222   007545 701200 1                  TSX1  ! RELMBLK
         1 006223   000000 011200                    NOP   ! 0

     2188    11493    5                 END;

     2189    11494    4               END;

  11494  1 006224   200012 054300                    AOS   ! I,,AUTO
         1 006225   200012 236300                    LDQ   ! I,,AUTO
         1 006226   200021 116300                    CMPQ  ! NMBLKS,,AUTO
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:296  
         1 006227   006207 604600 1                  TMOZ  ! s:11488

     2190    11495    3             IF KQ$GARB.SPLITCNT > 0 THEN GOTO DOSPLIT;

  11495  1 006230   200006 470700                    LDP0  ! CG$,,AUTO
         1 006231   000042 220300                    LDX0  ! 34,,PR0
         1 006232   005721 601200 1                  TNZ   ! DOSPLIT

     2191    11496    3             END DOSPLIT;

     2192    11497        /**/
     2193    11498        /**/
     2194    11499                %CHKCNT;

  11500  1 006233   000000 235000 xsym               LDA     KQ_DEBUG
         1 006234   006237 600000 1                  TZE     s:11502

  11500  1 006235   007316 701000 1                  TSX1    CHKMLH
         1 006236   000000 011000                    NOP     0

     2195    11502    2           IF MBLK$->KQ$MBLK.INSHD$ = ADDR(NIL) THEN

  11502  1 006237   200005 470500                    LDP0    MBLK$,,AUTO
         1 006240   000012 236100                    LDQ     10,,PR0
         1 006241   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 006242   006250 601000 1                  TNZ     s:11507

     2196    11503    3             DO;

     2197    11504    3   INSX:     KQ$GARB.SPSTATE=0;

  11504  1 006243   200006 470500       INSX         LDP0    CG$,,AUTO
         1 006244   000000 236003                    LDQ     0,DU
         1 006245   000046 552120                    STBQ    38,'20'O,PR0

     2198    11505    3             RETURN;

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:297  
  11505  1 006246   200030 221300                    LDX1  ! END$+1,,AUTO
         1 006247   000001 702211                    TSX2  ! 1,X1

     2199    11506    3             END;
     2200    11507    2           IF KQ$GARB.NCDDA = 0 THEN

  11507  1 006250   200006 471500                    LDP1    CG$,,AUTO
         1 006251   100043 235100                    LDA     35,,PR1
         1 006252   006266 601000 1                  TNZ     I90

     2201    11508    3             DO; /* Only happens if stuff was SQUEEZEd out */

     2202    11509    4               DO WHILE (MBLK$->KQ$MBLK.INSHD$ ~= ADDR(NIL));

  11509  1 006253   006261 710000 1                  TRA     s:11512

     2203    11510    4               I$=MBLK$->KQ$MBLK.INSHD$;

  11510  1 006254   200005 470500                    LDP0    MBLK$,,AUTO
         1 006255   000012 236100                    LDQ     10,,PR0
         1 006256   200031 756100                    STQ     I$,,AUTO

     2204    11511    4               CALL SPLT;

  11511  1 006257   006674 701000 1                  TSX1    SPLT
         1 006260   000000 011000                    NOP     0

     2205    11512    4               END;

  11512  1 006261   200005 470500                    LDP0    MBLK$,,AUTO
         1 006262   000012 236100                    LDQ     10,,PR0
         1 006263   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 006264   006254 601000 1                  TNZ     s:11510

     2206    11513    3             GOTO DOSPLIT;

  11513  1 006265   005721 710000 1                  TRA     DOSPLIT
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:298  

  11507  1 006266                       I90          null
     2207    11514    3             END;
     2208    11515    2   I90:    ;
     2209    11516    3             DO INHIBIT;

     2210    11517    3             MBLK$->KQ$MBLK.PCDDA=MBLK$->KQ$MBLK.SDA.CCDDA;

  11517  1 006266   200005 470700                    LDP0  ! MBLK$,,AUTO
         1 006267   000003 235300                    LDA   ! 3,,PR0
         1 006270   000017 755300                    STA   ! 15,,PR0

     2211    11518    3             KQ$GARB.PCSTAMP=MBLK$->KQ$MBLK.CCSTAMP;

  11518  1 006271   000016 720300                    LXL0  ! 14,,PR0
         1 006272   200006 471700                    LDP1  ! CG$,,AUTO
         1 006273   100050 740300                    STX0  ! 40,,PR1

     2212    11519    3             MBLK$->KQ$MBLK.SDA.CCDDA=KQ$GARB.NCDDA;

  11519  1 006274   100043 235300                    LDA   ! 35,,PR1
         1 006275   000003 755300                    STA   ! 3,,PR0

     2213    11520    3             MBLK$->KQ$MBLK.CCSTAMP=KQ$GARB.NCSTAMP;

  11520  1 006276   100042 720300                    LXL0  ! 34,,PR1
         1 006277   000016 440300                    SXL0  ! 14,,PR0

     2214    11521    3             GOTO FTCH0;

  11521  1 006300   005234 710200 1                  TRA   ! FTCH0

     2215    11522    3             END; /* INHIBIT */

  11520  1 006301                       NOFETCH0     null
     2216    11523        /**/
     2217    11524        /**/
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:299  
     2218    11525        %EJECT;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:300  
     2219    11526        /**/
     2220    11527        /**/
     2221    11528    2   NOFETCH0:; /* Can't fetch next DBLK */
     2222    11529    2           IF DBLK$ ~= ADDR(NIL)

  11529  1 006301   200011 236100                    LDQ     DBLK$,,AUTO
         1 006302   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 006303   006307 601000 1                  TNZ     s:11530
         1 006304   200013 235100                    LDA     DDA,,AUTO
         1 006305   000012 115007                    CMPA    10,DL
         1 006306   006311 601000 1                  TNZ     FERR0

     2223    11530    2           OR DDA = %KQDE_NDFRBLK THEN ALTRETURN;

  11530  1 006307   200030 221300                    LDX1  ! END$+1,,AUTO
         1 006310   000000 702211                    TSX2  ! 0,X1

     2224    11531                          /*    Truncate the
     2225    11532                           *    disk list at
     2226    11533                           *    this point,
     2227    11534                           *    and try again.
     2228    11535                           */
     2229    11536    2   FERR0:  CALL DISKERR;

  11536  1 006311   007045 701000 1     FERR0        TSX1    DISKERR
         1 006312   000000 011000                    NOP     0

     2230    11537    2           CALL RESET;

  11537  1 006313   006560 701000 1                  TSX1    RESET
         1 006314   000000 011000                    NOP     0

     2231    11538    2           GOTO I10;

  11538  1 006315   005112 710000 1                  TRA     I10

     2232    11539        /**/
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:301  
     2233    11540    2   INSRTF0: ENTRY ALTRET;

  11540  1 006316   200030 741300       INSRTF0      STX1  ! END$+1,,AUTO

     2234    11541        /**/
     2235    11542    2           IF DBLK$ = ADDR(NIL) THEN GOTO FERR0;

  11542  1 006317   200011 236100                    LDQ     DBLK$,,AUTO
         1 006320   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 006321   006311 600000 1                  TZE     FERR0

     2236    11543    2           GOTO FTCHD0;

  11543  1 006322   005253 710000 1                  TRA     FTCHD0

     2237    11544        /**/
     2238    11545    2   INSRTD0: ENTRY ALTRET;

  11545  1 006323   200030 741300       INSRTD0      STX1  ! END$+1,,AUTO

     2239    11546        /**/
     2240    11547    2           GOTO FTCH0;

  11547  1 006324   005234 710000 1                  TRA     FTCH0

  11542  1 006325                       NOFETCH1     null
     2241    11548        /**/
     2242    11549        /**/
     2243    11550    2   NOFETCH1:; /* Can't fetch new DBLK's BLINK */
     2244    11551    2           IF DBLK$ ~= ADDR(NIL)

  11551  1 006325   200011 236100                    LDQ     DBLK$,,AUTO
         1 006326   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 006327   006333 601000 1                  TNZ     s:11552
         1 006330   200013 235100                    LDA     DDA,,AUTO
         1 006331   000012 115007                    CMPA    10,DL
         1 006332   006335 601000 1                  TNZ     FERR1
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:302  

     2245    11552    2           OR DDA = %KQDE_NDFRBLK THEN ALTRETURN;

  11552  1 006333   200030 221300                    LDX1  ! END$+1,,AUTO
         1 006334   000000 702211                    TSX2  ! 0,X1

     2246    11553                          /*    Truncate the disk
     2247    11554                           *    list just before
     2248    11555                           *    the guy whose fetch
     2249    11556                           *    failed.  Put the
     2250    11557                           *    SPLIT list on
     2251    11558                           *    the INSHD$ list,
     2252    11559                           *    and go start over.
     2253    11560                           */
     2254    11561    2   FERR1:  CALL DISKERR;

  11561  1 006335   007045 701000 1     FERR1        TSX1    DISKERR
         1 006336   000000 011000                    NOP     0

     2255    11562    3             DO INHIBIT;

     2256    11563    3             KQ$GARB.TCOUNT=KQ$GARB.TCOUNT-KQ$GARB.CCCOUNT;

  11563  1 006337   200006 470700                    LDP0  ! CG$,,AUTO
         1 006340   000050 236300                    LDQ   ! 40,,PR0
         1 006341   777777 376207                    ANQ   ! -1,DL
         1 006342   200066 756300                    STQ   ! I$+1,,AUTO
         1 006343   000035 236300                    LDQ   ! 29,,PR0
         1 006344   200066 136300                    SBLQ  ! I$+1,,AUTO
         1 006345   000035 756300                    STQ   ! 29,,PR0

     2257    11564    3             CALL RESET;

  11564  1 006346   006560 701200 1                  TSX1  ! RESET
         1 006347   000000 011200                    NOP   ! 0

     2258    11565    3             P$=KQ$GARB.SPHD$;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:303  

  11565  1 006350   200006 470700                    LDP0  ! CG$,,AUTO
         1 006351   000040 236300                    LDQ   ! 32,,PR0
         1 006352   200007 756300                    STQ   ! P$,,AUTO

     2259    11566    4               DO WHILE (P$->KQ$MBLK.LNK$ ~= ADDR(NIL));

  11566  1 006353   006357 710200 1                  TRA   ! s:11568

     2260    11567    4               P$=P$->KQ$MBLK.LNK$;

  11567  1 006354   200007 470700                    LDP0  ! P$,,AUTO
         1 006355   000000 236300                    LDQ   ! 0,,PR0
         1 006356   200007 756300                    STQ   ! P$,,AUTO

     2261    11568    4               END;

  11568  1 006357   200007 470700                    LDP0  ! P$,,AUTO
         1 006360   000000 236300                    LDQ   ! 0,,PR0
         1 006361   000001 116200 xsym               CMPQ  ! B_VECTNIL+1
         1 006362   006354 601200 1                  TNZ   ! s:11567

     2262    11569    3             P$->KQ$MBLK.LNK$=MBLK$->KQ$MBLK.INSHD$;

  11569  1 006363   200005 471700                    LDP1  ! MBLK$,,AUTO
         1 006364   100012 236300                    LDQ   ! 10,,PR1
         1 006365   000000 756300                    STQ   ! 0,,PR0

     2263    11570    3             MBLK$->KQ$MBLK.INSHD$=KQ$GARB.SPHD$;

  11570  1 006366   200006 473700                    LDP3  ! CG$,,AUTO
         1 006367   300040 236300                    LDQ   ! 32,,PR3
         1 006370   100012 756300                    STQ   ! 10,,PR1

     2264    11571    3             KQ$GARB.SPHD$=ADDR(NIL);

  11571  1 006371   000001 236200 xsym               LDQ   ! B_VECTNIL+1
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:304  
         1 006372   300040 756300                    STQ   ! 32,,PR3

     2265    11572    3   RDELD:    KQ$GARB.SPSTATE=KQSP_DELD#;

  11572  1 006373   200006 470700       RDELD        LDP0  ! CG$,,AUTO
         1 006374   000013 236203                    LDQ   ! 11,DU
         1 006375   000046 552320                    STBQ  ! 38,'20'O,PR0

     2266    11573                          /*    Delete the new DBLK */
     2267    11574    3   FTCH3:    DDA=KQ$GARB.SCDDA;

  11574  1 006376   200006 470700       FTCH3        LDP0  ! CG$,,AUTO
         1 006377   000044 235300                    LDA   ! 36,,PR0
         1 006400   200013 755300                    STA   ! DDA,,AUTO

     2268    11575    3             DBLK$R=KQ$GARB.SCSTAMP;

  11575  1 006401   000045 236300                    LDQ   ! 37,,PR0
         1 006402   000022 772200                    QRL   ! 18
         1 006403   200011 756300                    STQ   ! DBLK$,,AUTO

     2269    11576    3             CALL FETCH (KQGD_SQIF3#,KQGD_SQID3#) ALTRET(NOFETCH3);

  11576  1 006404   000101 236200 2                  LDQ   ! 65
         1 006405   200056 756300                    STQ   ! @CLKDFR,,AUTO
         1 006406   000102 236200 2                  LDQ   ! 66
         1 006407   200055 756300                    STQ   ! @DFR,,AUTO
         1 006410   006740 701200 1                  TSX1  ! FETCH
         1 006411   006463 702200 1                  TSX2  ! NOFETCH3

     2270    11577    3   FTCHD3:   MBLK$->KQ$MBLK.PCDDA=MBLK$->KQ$MBLK.SDA.CCDDA; /* For CHKBLINK */

  11577  1 006412   200005 470700       FTCHD3       LDP0  ! MBLK$,,AUTO
         1 006413   000003 235300                    LDA   ! 3,,PR0
         1 006414   000017 755300                    STA   ! 15,,PR0

     2271    11578    3             MBLK$->KQ$MBLK.SDA.CCDDA=KQ$GARB.SCDDA;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:305  

  11578  1 006415   200006 471700                    LDP1  ! CG$,,AUTO
         1 006416   100044 235300                    LDA   ! 36,,PR1
         1 006417   000003 755300                    STA   ! 3,,PR0

     2272    11579    3             CALL CHKBLINK ALTRET(FERR3);

  11579  1 006420   007153 701200 1                  TSX1  ! CHKBLINK
         1 006421   006473 702200 1                  TSX2  ! FERR3

     2273    11580    3             CALL DELETE;

  11580  1 006422   007425 701200 1                  TSX1  ! DELETE
         1 006423   000000 011200                    NOP   ! 0

     2274    11581    3             GOTO I10;

  11581  1 006424   005112 710200 1                  TRA   ! I10

     2275    11582    3             END;

  11582  1 006425   006427 710000 1                  TRA     s:11586

     2276    11583        /**/
     2277    11584    2   INSRTF1: ENTRY ALTRET;

  11584  1 006426   200030 741300       INSRTF1      STX1  ! END$+1,,AUTO

     2278    11585        /**/
     2279    11586    2           IF DBLK$ = ADDR(NIL) THEN GOTO FERR1;

  11586  1 006427   200011 236100                    LDQ     DBLK$,,AUTO
         1 006430   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 006431   006335 600000 1                  TZE     FERR1

     2280    11587    2           GOTO FTCHD1;

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:306  
  11587  1 006432   006063 710000 1                  TRA     FTCHD1

     2281    11588        /**/
     2282    11589    2   INSRTD1: ENTRY ALTRET;

  11589  1 006433   200030 741300       INSRTD1      STX1  ! END$+1,,AUTO

     2283    11590        /**/
     2284    11591    2           GOTO FTCH1;

  11591  1 006434   006047 710000 1                  TRA     RNBUL

  11586  1 006435                       NOFETCH2     null
     2285    11592        /**/
     2286    11593        /**/
     2287    11594    2   NOFETCH2:; /* Can't fetch new DBLK's FLINK */
     2288    11595    2           IF DBLK$ ~= ADDR(NIL)

  11595  1 006435   200011 236100                    LDQ     DBLK$,,AUTO
         1 006436   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 006437   006443 601000 1                  TNZ     s:11596
         1 006440   200013 235100                    LDA     DDA,,AUTO
         1 006441   000012 115007                    CMPA    10,DL
         1 006442   006445 601000 1                  TNZ     FERR2

     2289    11596    2           OR DDA = %KQDE_NDFRBLK THEN ALTRETURN;

  11596  1 006443   200030 221300                    LDX1  ! END$+1,,AUTO
         1 006444   000000 702211                    TSX2  ! 0,X1

     2290    11597                          /*    Truncate the disk list
     2291    11598                           *    just after the newly-built
     2292    11599                           *    DBLK, and continue.
     2293    11600                           */
     2294    11601    2   FERR2:  CALL DISKERR;

  11601  1 006445   007045 701000 1     FERR2        TSX1    DISKERR
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:307  
         1 006446   000000 011000                    NOP     0

     2295    11602    2           CALL RESET1;

  11602  1 006447   006606 701000 1                  TSX1    RESET1
         1 006450   000000 011000                    NOP     0

     2296    11603    2           KQ$GARB.NCDDA=0;

  11603  1 006451   200006 470500                    LDP0    CG$,,AUTO
         1 006452   000043 450100                    STZ     35,,PR0

     2297    11604    2           GOTO I60;

  11604  1 006453   006132 710000 1                  TRA     I60

     2298    11605        /**/
     2299    11606    2   INSRTF2: ENTRY ALTRET;

  11606  1 006454   200030 741300       INSRTF2      STX1  ! END$+1,,AUTO

     2300    11607        /**/
     2301    11608    2           IF DBLK$ = ADDR(NIL) THEN GOTO FERR2;

  11608  1 006455   200011 236100                    LDQ     DBLK$,,AUTO
         1 006456   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 006457   006445 600000 1                  TZE     FERR2

     2302    11609    2           GOTO FTCHD2;

  11609  1 006460   006155 710000 1                  TRA     FTCHD2

     2303    11610        /**/
     2304    11611    2   INSRTD2: ENTRY ALTRET;

  11611  1 006461   200030 741300       INSRTD2      STX1  ! END$+1,,AUTO

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:308  
     2305    11612        /**/
     2306    11613    2           GOTO FTCH2;

  11613  1 006462   006141 710000 1                  TRA     FTCH2

  11608  1 006463                       NOFETCH3     null
     2307    11614        /**/
     2308    11615        /**/
     2309    11616    2   NOFETCH3:; /* Can't fetch the new DBLK to delete it */
     2310    11617    2           IF DBLK$ ~= ADDR(NIL)

  11617  1 006463   200011 236100                    LDQ     DBLK$,,AUTO
         1 006464   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 006465   006471 601000 1                  TNZ     s:11618
         1 006466   200013 235100                    LDA     DDA,,AUTO
         1 006467   000012 115007                    CMPA    10,DL
         1 006470   006473 601000 1                  TNZ     FERR3

     2311    11618    2           OR DDA = %KQDE_NDFRBLK THEN ALTRETURN;

  11618  1 006471   200030 221300                    LDX1  ! END$+1,,AUTO
         1 006472   000000 702211                    TSX2  ! 0,X1

     2312    11619                           /* Fetch error */
     2313    11620    2   FERR3:  CALL DISKERR;

  11620  1 006473   007045 701000 1     FERR3        TSX1    DISKERR
         1 006474   000000 011000                    NOP     0

     2314    11621    2           GOTO I10;

  11621  1 006475   005112 710000 1                  TRA     I10

     2315    11622        /**/
     2316    11623    2   INSRTF3: ENTRY ALTRET;

  11623  1 006476   200030 741300       INSRTF3      STX1  ! END$+1,,AUTO
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:309  

     2317    11624        /**/
     2318    11625    2           IF DBLK$ = ADDR(NIL) THEN GOTO FERR3;

  11625  1 006477   200011 236100                    LDQ     DBLK$,,AUTO
         1 006500   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 006501   006473 600000 1                  TZE     FERR3

     2319    11626    2           GOTO FTCHD3;

  11626  1 006502   006412 710000 1                  TRA     FTCHD3

     2320    11627        /**/
     2321    11628    2   INSRTD3: ENTRY ALTRET;

  11628  1 006503   200030 741300       INSRTD3      STX1  ! END$+1,,AUTO

     2322    11629        /**/
     2323    11630    2           GOTO FTCH3;

  11630  1 006504   006376 710000 1                  TRA     FTCH3

  11625  1 006505                       NODBLK       null
     2324    11631        /**/
     2325    11632        /**/
     2326    11633    2   NODBLK: ;
     2327    11634    2           IF DBLK$ ~= ADDR(NIL)

  11634  1 006505   200011 236100                    LDQ     DBLK$,,AUTO
         1 006506   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 006507   006513 601000 1                  TNZ     s:11635
         1 006510   200013 235100                    LDA     DDA,,AUTO
         1 006511   000012 115007                    CMPA    10,DL
         1 006512   006515 601000 1                  TNZ     s:11637

     2328    11635    2           OR DDA = %KQDE_NDFRBLK THEN ALTRETURN;

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:310  
  11635  1 006513   200030 221300                    LDX1  ! END$+1,,AUTO
         1 006514   000000 702211                    TSX2  ! 0,X1

     2329    11636                      /* No more disk space */
     2330    11637    2           P$=KQ$GARB.SPHD$;

  11637  1 006515   200006 470500                    LDP0    CG$,,AUTO
         1 006516   000040 236100                    LDQ     32,,PR0
         1 006517   200007 756100                    STQ     P$,,AUTO

     2331    11638    3             DO WHILE (P$->KQ$MBLK.LNK$ ~= ADDR(NIL));

  11638  1 006520   006524 710000 1                  TRA     s:11640

     2332    11639    3             P$=P$->KQ$MBLK.LNK$;

  11639  1 006521   200007 470500                    LDP0    P$,,AUTO
         1 006522   000000 236100                    LDQ     0,,PR0
         1 006523   200007 756100                    STQ     P$,,AUTO

     2333    11640    3             END;

  11640  1 006524   200007 470500                    LDP0    P$,,AUTO
         1 006525   000000 236100                    LDQ     0,,PR0
         1 006526   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 006527   006521 601000 1                  TNZ     s:11639

     2334    11641    2           P$->KQ$MBLK.LNK$=MBLK$->KQ$MBLK.INSHD$;

  11641  1 006530   200005 471500                    LDP1    MBLK$,,AUTO
         1 006531   100012 236100                    LDQ     10,,PR1
         1 006532   000000 756100                    STQ     0,,PR0

     2335    11642    2           MBLK$->KQ$MBLK.INSHD$=KQ$GARB.SPHD$;

  11642  1 006533   200006 473500                    LDP3    CG$,,AUTO
         1 006534   300040 236100                    LDQ     32,,PR3
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:311  
         1 006535   100012 756100                    STQ     10,,PR1

     2336    11643    2           KQ$GARB.SPHD$=ADDR(NIL);

  11643  1 006536   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 006537   300040 756100                    STQ     32,,PR3

     2337    11644    2           KQ$GARB.SPSTATE=0;

  11644  1 006540   000000 236003                    LDQ     0,DU
         1 006541   300046 552120                    STBQ    38,'20'O,PR3

     2338    11645    2           CALL SQUISHX;

  11645  1 006542   003517 701000 1                  TSX1    SQUISHX
         1 006543   000000 011000                    NOP     0

     2339    11646    2           KQ$GARB.DELAY=KQGD_QFULL#;

  11646  1 006544   000006 235007                    LDA     6,DL
         1 006545   200006 470500                    LDP0    CG$,,AUTO
         1 006546   000031 755100                    STA     25,,PR0

     2340    11647    2           ALTRETURN;

  11647  1 006547   200030 221300                    LDX1  ! END$+1,,AUTO
         1 006550   000000 702211                    TSX2  ! 0,X1

     2341    11648        /**/
     2342    11649    2   INSRTG0: ENTRY ALTRET;

  11649  1 006551   200030 741300       INSRTG0      STX1  ! END$+1,,AUTO

     2343    11650        /**/
     2344    11651    2           IF DBLK$ = ADDR(NIL) THEN GOTO NODBLK;

  11651  1 006552   200011 236100                    LDQ     DBLK$,,AUTO
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:312  
         1 006553   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 006554   006505 600000 1                  TZE     NODBLK

     2345    11652    2           GOTO GOTDBLK;

  11652  1 006555   005737 710000 1                  TRA     GOTDBLK

     2346    11653        /**/
     2347    11654    2   INSRTD4: ENTRY ALTRET;

  11654  1 006556   200030 741300       INSRTD4      STX1  ! END$+1,,AUTO

     2348    11655        /**/
     2349    11656    2           GOTO DOSPLIT;

  11656  1 006557   005721 710000 1                  TRA     DOSPLIT

     2350    11657        /**/
     2351    11658        /**/
     2352    11659    2   RESET:  PROC;

  11659  1 006560   200054 741300       RESET        STX1  ! DELETE+10,,AUTO

     2353    11660        /**/
     2354    11661    4             DO INHIBIT;

     2355    11662    4             IF MBLK$->KQ$MBLK.PCDDA = 0 THEN

  11662  1 006561   200005 470700                    LDP0  ! MBLK$,,AUTO
         1 006562   000017 235300                    LDA   ! 15,,PR0
         1 006563   006601 601200 1                  TNZ   ! s:11671

     2356    11663    5               DO;

     2357    11664    5               IF KQ$GARB.CCCOUNT ~= KQ$GARB.TCOUNT THEN

  11664  1 006564   200006 471700                    LDP1  ! CG$,,AUTO
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:313  
         1 006565   100050 236300                    LDQ   ! 40,,PR1
         1 006566   777777 376207                    ANQ   ! -1,DL
         1 006567   100035 116300                    CMPQ  ! 29,,PR1
         1 006570   006573 600200 1                  TZE   ! s:11666

     2358    11665    5                CALL SC_CGGBSN;

  11665  1 006571   000000 713600 xsym               CLIMB ! SC_CGGBSN
         1 006572   000000 600000 xsid               climb   nvectors=         0

     2359    11666    5               MBLK$->KQ$MBLK.DDA=0;

  11666  1 006573   200005 470700                    LDP0  ! MBLK$,,AUTO
         1 006574   000006 450300                    STZ   ! 6,,PR0

     2360    11667    5               I=MBLK$->KQ$MBLK.COUNT;

  11667  1 006575   000015 235300                    LDA   ! 13,,PR0
         1 006576   200012 755300                    STA   ! I,,AUTO

     2361    11668    5               MBLK$->KQ$MBLK.COUNT=0;

  11668  1 006577   000015 450300                    STZ   ! 13,,PR0

     2362    11669    5               GOTO RS1;

  11669  1 006600   006623 710200 1                  TRA   ! RS1

     2363    11670    5               END;
     2364    11671    4             MBLK$->KQ$MBLK.LCSTAMP=KQ$GARB.PCSTAMP;

  11671  1 006601   200006 471700                    LDP1  ! CG$,,AUTO
         1 006602   100050 220300                    LDX0  ! 40,,PR1
         1 006603   000016 740300                    STX0  ! 14,,PR0

     2365    11672    4             MBLK$->KQ$MBLK.SDA.LDA=MBLK$->KQ$MBLK.PCDDA;

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:314  
  11672  1 006604   000002 755300                    STA   ! 2,,PR0

     2366    11673    4             END;

  11673  1 006605   006607 710000 1                  TRA     s:11678

     2367    11674        /**/
     2368    11675    3   RESET1: ENTRY;

  11675  1 006606   200054 741300       RESET1       STX1  ! DELETE+10,,AUTO

     2369    11676        /**/
     2370    11677    4             DO INHIBIT;

     2371    11678    4             I=MBLK$->KQ$MBLK.COUNT-KQ$GARB.TCOUNT;

  11678  1 006607   200006 470700                    LDP0  ! CG$,,AUTO
         1 006610   200005 471700                    LDP1  ! MBLK$,,AUTO
         1 006611   100015 236300                    LDQ   ! 13,,PR1
         1 006612   000035 136300                    SBLQ  ! 29,,PR0
         1 006613   200012 756300                    STQ   ! I,,AUTO

     2372    11679    4             IF I < 0 THEN CALL SC_CGGARB;

  11679  1 006614   006617 605200 1                  TPL   ! s:11680

  11679  1 006615   000000 713600 xsym               CLIMB ! SC_CGGARB
         1 006616   000000 600000 xsid               climb   nvectors=         0

     2373    11680    4             MBLK$->KQ$MBLK.COUNT=KQ$GARB.TCOUNT;

  11680  1 006617   200006 470700                    LDP0  ! CG$,,AUTO
         1 006620   200005 471700                    LDP1  ! MBLK$,,AUTO
         1 006621   000035 235300                    LDA   ! 29,,PR0
         1 006622   100015 755300                    STA   ! 13,,PR1

  11680  1 006623                       RS1          null
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:315  
     2374    11681    4   RS1:      ;
     2375    11682    4             IF MLH$->KQ$MLH.COUNT < I THEN CALL SC_CGGARB;

  11682  1 006623   200014 470700                    LDP0  ! MLH$,,AUTO
         1 006624   000005 236300                    LDQ   ! 5,,PR0
         1 006625   200012 116300                    CMPQ  ! I,,AUTO
         1 006626   006631 605200 1                  TPL   ! s:11683

  11682  1 006627   000000 713600 xsym               CLIMB ! SC_CGGARB
         1 006630   000000 600000 xsid               climb   nvectors=         0

     2376    11683    4             MLH$->KQ$MLH.COUNT=MLH$->KQ$MLH.COUNT-I;

  11683  1 006631   200014 470700                    LDP0  ! MLH$,,AUTO
         1 006632   000005 236300                    LDQ   ! 5,,PR0
         1 006633   200012 136300                    SBLQ  ! I,,AUTO
         1 006634   000005 756300                    STQ   ! 5,,PR0

     2377    11684                  %CHKCNT;

  11685  1 006635   000000 235200 xsym               LDA   ! KQ_DEBUG
         1 006636   006641 600200 1                  TZE   ! s:11687

  11685  1 006637   007316 701200 1                  TSX1  ! CHKMLH
         1 006640   000000 011200                    NOP   ! 0

     2378    11687    4             RETURN;

  11687  1 006641   200054 221300                    LDX1  ! DELETE+10,,AUTO
         1 006642   000001 702211                    TSX2  ! 1,X1

     2379    11688    4             END;

     2380    11689    3   END RESET;

  11689  1 006643   000001 702211                    TSX2  ! 1,X1

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:316  
     2381    11690        /**/
     2382    11691        /**/
     2383    11692    2   INSUPD: PROC;

  11692  1 006644   200054 741300       INSUPD       STX1  ! DELETE+10,,AUTO

     2384    11693        /**/
     2385    11694    4             DO INHIBIT;

     2386    11695    4             DBLK$->KQ$DBLK.DSIZE=DBLK$->KQ$DBLK.DSIZE+SIZEC(KQ$MBLK);

  11695  1 006645   200011 470700                    LDP0  ! DBLK$,,AUTO
         1 006646   000000 720300                    LXL0  ! 0,,PR0
         1 006647   000100 622210                    EAX2  ! 64,X0
         1 006650   000000 442300                    SXL2  ! 0,,PR0

     2387    11696    4             MBLK$->KQ$MBLK.INSHD$=I$->KQ$MBLK.LNK$;

  11696  1 006651   200031 470700                    LDP0  ! I$,,AUTO
         1 006652   000000 236300                    LDQ   ! 0,,PR0
         1 006653   200005 471700                    LDP1  ! MBLK$,,AUTO
         1 006654   100012 756300                    STQ   ! 10,,PR1

     2388    11697    4             KQ$GARB.TCOUNT=KQ$GARB.TCOUNT+1;

  11697  1 006655   200006 470700                    LDP0  ! CG$,,AUTO
         1 006656   000035 054300                    AOS   ! 29,,PR0

     2389    11698    4             MBLK$->KQ$MBLK.COUNT=MBLK$->KQ$MBLK.COUNT+1;

  11698  1 006657   100015 054300                    AOS   ! 13,,PR1

     2390    11699    4             KQ$GARB.CCCOUNT=KQ$GARB.CCCOUNT+1;

  11699  1 006660   000050 720300                    LXL0  ! 40,,PR0
         1 006661   000001 621210                    EAX1  ! 1,X0
         1 006662   000050 441300                    SXL1  ! 40,,PR0
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:317  

     2391    11700    4             END;

     2392    11701    3           CALL UPDATE;

  11701  1 006663   007471 701000 1                  TSX1    UPDATE
         1 006664   000000 011000                    NOP     0

     2393    11702    3           NFREE=NFREE-1;

  11702  1 006665   000001 336007                    LCQ     1,DL
         1 006666   200032 056100                    ASQ     NFREE,,AUTO

     2394    11703    3           FREE$=PINCRW(FREE$,SIZEW(KQ$MBLK));

  11703  1 006667   200033 236100                    LDQ     FREE$,,AUTO
         1 006670   000020 036003                    ADLQ    16,DU
         1 006671   200033 756100                    STQ     FREE$,,AUTO

     2395    11704    3           RETURN;

  11704  1 006672   200054 221300                    LDX1  ! DELETE+10,,AUTO
         1 006673   000001 702211                    TSX2  ! 1,X1

     2396    11705    3   END INSUPD;
     2397    11706        /**/
     2398    11707        /**/
     2399    11708    2   SPLT:   PROC; /* SPLIT guys go on tail of SPLIT list */

  11708  1 006674   200054 741300       SPLT         STX1  ! DELETE+10,,AUTO

     2400    11709        /**/
     2401    11710    4             DO INHIBIT;

     2402    11711    4             MBLK$->KQ$MBLK.INSHD$=I$->KQ$MBLK.LNK$;

  11711  1 006675   200031 470700                    LDP0  ! I$,,AUTO
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:318  
         1 006676   000000 236300                    LDQ   ! 0,,PR0
         1 006677   200005 471700                    LDP1  ! MBLK$,,AUTO
         1 006700   100012 756300                    STQ   ! 10,,PR1

     2403    11712    4             I$->KQ$MBLK.LNK$=ADDR(NIL);

  11712  1 006701   000001 236200 xsym               LDQ   ! B_VECTNIL+1
         1 006702   200031 470700                    LDP0  ! I$,,AUTO
         1 006703   000000 756300                    STQ   ! 0,,PR0

     2404    11713    4             IF KQ$GARB.SPHD$ = ADDR(NIL) THEN

  11713  1 006704   200006 470700                    LDP0  ! CG$,,AUTO
         1 006705   000040 236300                    LDQ   ! 32,,PR0
         1 006706   000001 116200 xsym               CMPQ  ! B_VECTNIL+1
         1 006707   006713 601200 1                  TNZ   ! s:11715

     2405    11714    4              KQ$GARB.SPHD$=I$;

  11714  1 006710   200031 236300                    LDQ   ! I$,,AUTO
         1 006711   000040 756300                    STQ   ! 32,,PR0
         1 006712   006716 710200 1                  TRA   ! s:11716

     2406    11715    4             ELSE KQ$GARB.SPTL$->KQ$MBLK.LNK$=I$;

  11715  1 006713   000041 473700                    LDP3  ! 33,,PR0
         1 006714   200031 236300                    LDQ   ! I$,,AUTO
         1 006715   300000 756300                    STQ   ! 0,,PR3

     2407    11716    4             KQ$GARB.SPTL$=I$;

  11716  1 006716   200031 236300                    LDQ   ! I$,,AUTO
         1 006717   000041 756300                    STQ   ! 33,,PR0

     2408    11717    4   XIT:      KQ$GARB.SPLITCNT=KQ$GARB.SPLITCNT+1;

  11717  1 006720   200006 470700       XIT          LDP0  ! CG$,,AUTO
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:319  
         1 006721   000042 220300                    LDX0  ! 34,,PR0
         1 006722   000001 621210                    EAX1  ! 1,X0
         1 006723   000042 741300                    STX1  ! 34,,PR0

     2409    11718    4             END; /* INHIBIT */

     2410    11719    3           RETURN;

  11719  1 006724   200054 221300                    LDX1  ! DELETE+10,,AUTO
         1 006725   000001 702211                    TSX2  ! 1,X1

     2411    11720        /**/
     2412    11721    3   SQZ:    ENTRY; /* SQUEEZEd guys go on head of SQUEEZE list */

  11721  1 006726   200054 741300       SQZ          STX1  ! DELETE+10,,AUTO

     2413    11722        /**/
     2414    11723    4             DO INHIBIT;

     2415    11724    4             I$->KQ$MBLK.LNK$=KQ$GARB.SQHD$;

  11724  1 006727   200006 470700                    LDP0  ! CG$,,AUTO
         1 006730   000051 236300                    LDQ   ! 41,,PR0
         1 006731   200031 471700                    LDP1  ! I$,,AUTO
         1 006732   100000 756300                    STQ   ! 0,,PR1

     2416    11725    4             KQ$GARB.SQHD$=I$;

  11725  1 006733   200031 236300                    LDQ   ! I$,,AUTO
         1 006734   000051 756300                    STQ   ! 41,,PR0

     2417    11726    4             GOTO XIT;

  11726  1 006735   006720 710200 1                  TRA   ! XIT

     2418    11727    4             END; /* INHIBIT */

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:320  
     2419    11728    3   END SPLT;

  11728  1 006736   200054 221300                    LDX1  ! DELETE+10,,AUTO
         1 006737   000001 702211                    TSX2  ! 1,X1

     2420    11729    2   END INSRT;
     2421    11730        %EJECT;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:321  
     2422    11731        /********************************************************
     2423    11732        *********************************************************/
     2424    11733        /**/
     2425    11734        /*D* NAME:         FETCH
     2426    11735             PURPOSE:      To FETCH a DBLK for the squish process
     2427    11736             INPUT:        DBLK$R = stamp
     2428    11737                           DDA    = dblk disc address
     2429    11738             DESCRIPTION:  Calls KQD$FETCH.  Returns if the fetch
     2430    11739                           succeeds immediately.  Else if a defer
     2431    11740                           block is obtained, uses DFR to put into
     2432    11741                           KQ$GARB.DELAY, calls SQUISHX and DEFERGO,
     2433    11742                           ALTRETs with DBLK$ ~= ADDR(NIL).
     2434    11743                           Else if no defer blocks were available,
     2435    11744                           delays using CLKDFR and ALTRETs with
     2436    11745                           DBLK$ = ADDR(NIL) and DDA = %KQDE_NDFRBLK.
     2437    11746                           Lastly, if an error occurred, ALTRETs with
     2438    11747                           DBLK$ = ADDR(NIL) and DDA ~= %KQDE_NDFRBLK.
     2439    11748        */
     2440    11749    1   FETCH:  PROC (DFR,CLKDFR) ALTRET;

  11749  1 006740   200054 741300       FETCH        STX1  ! DELETE+10,,AUTO

     2441    11750        /**/
     2442    11751    2   DCL DFR SBIN;
     2443    11752    2   DCL CLKDFR UBIN;
     2444    11753        /**/
     2445    11754    2           CALL KQD$FETCH (CG$->KQ$CG,DBLK$,DDA) ALTRET(NOFETCH);

  11754  1 006741   200013 630500                    EPPR0   DDA,,AUTO
         1 006742   200070 450500                    STP0    I$+3,,AUTO
         1 006743   200011 631500                    EPPR1   DBLK$,,AUTO
         1 006744   200067 451500                    STP1    I$+2,,AUTO
         1 006745   200006 236100                    LDQ     CG$,,AUTO
         1 006746   200066 756100                    STQ     I$+1,,AUTO
         1 006747   200066 630500                    EPPR0   I$+1,,AUTO
         1 006750   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 006751   000000 701000 xent               TSX1    KQD$FETCH
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:322  
         1 006752   006755 702000 1                  TSX2    NOFETCH

     2446    11755    2           RETURN;

  11755  1 006753   200054 221300                    LDX1  ! DELETE+10,,AUTO
         1 006754   000001 702211                    TSX2  ! 1,X1

  11754  1 006755                       NOFETCH      null
     2447    11756    2   NOFETCH:;
     2448    11757    2           IF DBLK$ = ADDR(NIL) THEN

  11757  1 006755   200011 236100                    LDQ     DBLK$,,AUTO
         1 006756   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 006757   007013 601000 1                  TNZ     s:11773

     2449    11758    3             DO CASE (DDA);

  11758  1 006760   200013 235100                    LDA     DDA,,AUTO
         1 006761   000013 115007                    CMPA    11,DL
         1 006762   006764 602005 1                  TNC     s:11758+4,AL
         1 006763   007011 710000 1                  TRA     s:11769
         1 006764   007011 710000 1                  TRA     s:11769
         1 006765   007011 710000 1                  TRA     s:11769
         1 006766   007011 710000 1                  TRA     s:11769
         1 006767   007007 710000 1                  TRA     s:11766
         1 006770   007007 710000 1                  TRA     s:11766
         1 006771   007007 710000 1                  TRA     s:11766
         1 006772   007007 710000 1                  TRA     s:11766
         1 006773   007011 710000 1                  TRA     s:11769
         1 006774   007011 710000 1                  TRA     s:11769
         1 006775   007011 710000 1                  TRA     s:11769
         1 006776   006777 710000 1                  TRA     s:11761

     2450    11759
     2451    11760    3               CASE (%KQDE_NDFRBLK); /* No defer blks */

     2452    11761    3                 CALL SQUISHX;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:323  

  11761  1 006777   003517 701000 1                  TSX1    SQUISHX
         1 007000   000000 011000                    NOP     0

     2453    11762    3                 KQ$GARB.DELAY=CLKDFR;

  11762  1 007001   200056 470500                    LDP0    @CLKDFR,,AUTO
         1 007002   000000 235100                    LDA     0,,PR0
         1 007003   200006 471500                    LDP1    CG$,,AUTO
         1 007004   100031 755100                    STA     25,,PR1

     2454    11763    3                 ALTRETURN;

  11763  1 007005   200054 221300                    LDX1  ! DELETE+10,,AUTO
         1 007006   000000 702211                    TSX2  ! 0,X1

     2455    11764
     2456    11765    3               CASE (%KQDE_STMP,%KQDE_IOERR,%KQDE_BDDA,%KQDE_STATE);

     2457    11766    3                 ALTRETURN;

  11766  1 007007   200054 221300                    LDX1  ! DELETE+10,,AUTO
         1 007010   000000 702211                    TSX2  ! 0,X1

     2458    11767
     2459    11768    3               CASE (ELSE);

     2460    11769    3                 CALL SC_CGGARB;

  11769  1 007011   000000 713400 xsym               CLIMB   SC_CGGARB
         1 007012   000000 600000 xsid               climb   nvectors=         0

     2461    11770
     2462    11771    3             END;

     2463    11772        /**/
     2464    11773    2           KQ$GARB.MBLK$=MBLK$;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:324  

  11773  1 007013   200005 236100                    LDQ     MBLK$,,AUTO
         1 007014   200006 470500                    LDP0    CG$,,AUTO
         1 007015   000036 756100                    STQ     30,,PR0

     2465    11774    2           DBLK$->KQ$DFRBLK.INFO$=CG$;

  11774  1 007016   200006 236100                    LDQ     CG$,,AUTO
         1 007017   200011 471500                    LDP1    DBLK$,,AUTO
         1 007020   100006 756100                    STQ     6,,PR1

     2466    11775    2           KQ$GARB.DELAY=-DFR;

  11775  1 007021   200055 471500                    LDP1    @DFR,,AUTO
         1 007022   100000 235100                    LDA     0,,PR1
         1 007023   000000 531000                    NEG     0
         1 007024   000031 755100                    STA     25,,PR0

     2467    11776    2           CALL SQUISHX;

  11776  1 007025   003517 701000 1                  TSX1    SQUISHX
         1 007026   000000 011000                    NOP     0

     2468    11777    2           CALL KQD$DEFERGO (CG$->KQ$CG,DBLK$,ENTADDR(KQS$FCONT));

  11777  1 007027   000565 636000 1                  EAQ     s:8780
         1 007030   200066 756100                    STQ     I$+1,,AUTO
         1 007031   200066 630500                    EPPR0   I$+1,,AUTO
         1 007032   200071 450500                    STP0    I$+4,,AUTO
         1 007033   200011 631500                    EPPR1   DBLK$,,AUTO
         1 007034   200070 451500                    STP1    I$+3,,AUTO
         1 007035   200006 236100                    LDQ     CG$,,AUTO
         1 007036   200067 756100                    STQ     I$+2,,AUTO
         1 007037   200067 630500                    EPPR0   I$+2,,AUTO
         1 007040   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 007041   000000 701000 xent               TSX1    KQD$DEFERGO
         1 007042   000000 011000                    NOP     0
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:325  

     2469    11778    2           ALTRETURN;

  11778  1 007043   200054 221300                    LDX1  ! DELETE+10,,AUTO
         1 007044   000000 702211                    TSX2  ! 0,X1

     2470    11779    2   END FETCH;
     2471    11780        /********************************************************
     2472    11781        *********************************************************/
     2473    11782        /**/
     2474    11783        /*D* NAME:         DISKERR
     2475    11784             PURPOSE:      To log errors encountered while
     2476    11785                           reading disc chains.
     2477    11786             DESCRIPTION:  KQ$MBLK.SDA.CCDDA (or KQ$MBLK.DDA) is
     2478    11787                           the disc address we read.  DDA is the
     2479    11788                           error code.
     2480    11789        */
     2481    11790    1   DISKERR: PROC;

  11790  1 007045   200054 741300       DISKERR      STX1  ! DELETE+10,,AUTO

     2482    11791        /**/
     2483    11792    2   DCL T$ PTR;
     2484    11793        /**/
     2485    11794    2   DCL F$ PTR;
     2486    11795    2   DCL 1 FRAME BASED ALIGNED,
     2487    11796              %KQ_LOGENT (FPTN=LOGENT,STCLASS=BASED,LVL=2,LAST=",");
     2488    11838              %KQ_MLH (FPTN=MLH,STCLASS=BASED,LVL=2);
     2489    11908        /**/
     2490    11909    2           IF KQ_DEBUG ~= 0 THEN

  11909  1 007046   000000 235000 xsym               LDA     KQ_DEBUG
         1 007047   007052 600000 1                  TZE     s:11914

     2491    11910    2            CALL SC_CGGBSN;

  11910  1 007050   000000 713400 xsym               CLIMB   SC_CGGBSN
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:326  
         1 007051   000000 600000 xsid               climb   nvectors=         0

     2492    11911        /**/
     2493    11912                           /* Log the error */
     2494    11913                %LOCK (G=KQ_ERRLOG_GATE);

  11914  1 007052   000103 630400 2                  EPPR0   67
         1 007053   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 007054   000000 701000 xent               TSX1    HFC$LOCK
         1 007055   000000 011000                    NOP     0

     2495    11916    2           KQ_ERRLOG_BFR.CODE=%KQELOG_KQS_FTCH;

  11916  1 007056   014000 236003                    LDQ     6144,DU
         1 007057   000000 552040 xsym               STBQ    KQ_ERRLOG_BFR,'40'O

     2496    11917    2           KQ_ERRLOG_BFR.SIZ=SIZEW(FRAME)+SIZEW(KQ$MBLK)+SIZEW(KQ$CG.GARB);

  11917  1 007060   000066 235007                    LDA     54,DL
         1 007061   000015 755000 xsym               STA     KQ_ERRLOG_BFR+13

     2497    11918    2           KQ_ERRLOG_BFR.INFO='0'B;

  11918  1 007062   000000 100400                    MLR     fill='000'O
         1 007063   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         1 007064   000016 000310 xsym               ADSC9   KQ_ERRLOG_BFR+14         cn=0,n=200

     2498    11919    2           F$=ADDR(KQ_ERRLOG_BFR.INFO);

  11919  1 007065   000104 236000 2                  LDQ     68
         1 007066   200056 756100                    STQ     F$,,AUTO

     2499    11920    2           T$=MBLK$;

  11920  1 007067   200005 236100                    LDQ     MBLK$,,AUTO
         1 007070   200055 756100                    STQ     T$,,AUTO

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:327  
     2500    11921    2           CALL KQZ$LOG (CG$->KQ$CG,ENTFLAG,0,0,0,T$,DDA,

  11921  1 007071   200056 630500                    EPPR0   F$,,AUTO
         1 007072   200075 450500                    STP0    I$+8,,AUTO
         1 007073   200013 631500                    EPPR1   DDA,,AUTO
         1 007074   200074 451500                    STP1    I$+7,,AUTO
         1 007075   200055 633500                    EPPR3   T$,,AUTO
         1 007076   200073 453500                    STP3    I$+6,,AUTO
         1 007077   000001 236000 2                  LDQ     1
         1 007100   200072 756100                    STQ     I$+5,,AUTO
         1 007101   000024 237000 2                  LDAQ    20
         1 007102   200070 757100                    STAQ    I$+3,,AUTO
         1 007103   200015 634500                    EPPR4   ENTFLAG,,AUTO
         1 007104   200067 454500                    STP4    I$+2,,AUTO
         1 007105   200006 236100                    LDQ     CG$,,AUTO
         1 007106   200066 756100                    STQ     I$+1,,AUTO
         1 007107   200066 630500                    EPPR0   I$+1,,AUTO
         1 007110   000026 631400 xsym               EPPR1   B_VECTNIL+22
         1 007111   000000 701000 xent               TSX1    KQZ$LOG
         1 007112   007115 702000 1                  TSX2    ALT

     2501    11922    2           F$) ALTRET(ALT);
     2502    11923    2           RETURN;

  11923  1 007113   200054 221300                    LDX1  ! DELETE+10,,AUTO
         1 007114   000001 702211                    TSX2  ! 1,X1

     2503    11924    2   ALT:    IF MLH$ ~= ADDR(NIL) THEN

  11924  1 007115   200014 236100       ALT          LDQ     MLH$,,AUTO
         1 007116   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 007117   007125 600000 1                  TZE     s:11926

     2504    11925    2            F$->FRAME.MLH    =MLH$->KQ$MLH;

  11925  1 007120   200014 470500                    LDP0    MLH$,,AUTO
         1 007121   200056 471500                    LDP1    F$,,AUTO
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:328  
         1 007122   000100 100500                    MLR     fill='000'O
         1 007123   000000 000040                    ADSC9   0,,PR0                   cn=0,n=32
         1 007124   100010 000040                    ADSC9   8,,PR1                   cn=0,n=32

     2505    11926    2           F$=PINCRW(F$,SIZEW(FRAME));

  11926  1 007125   200056 236100                    LDQ     F$,,AUTO
         1 007126   000020 036003                    ADLQ    16,DU
         1 007127   200056 756100                    STQ     F$,,AUTO

     2506    11927    2           F$->KQ$CG.GARB=CG$->KQ$CG.GARB;

  11927  1 007130   200006 470500                    LDP0    CG$,,AUTO
         1 007131   200056 471500                    LDP1    F$,,AUTO
         1 007132   000100 100500                    MLR     fill='000'O
         1 007133   000031 000130                    ADSC9   25,,PR0                  cn=0,n=88
         1 007134   100031 000130                    ADSC9   25,,PR1                  cn=0,n=88

     2507    11928    2           F$=PINCRW(F$,SIZEW(KQ$CG.GARB));

  11928  1 007135   200056 236100                    LDQ     F$,,AUTO
         1 007136   000026 036003                    ADLQ    22,DU
         1 007137   200056 756100                    STQ     F$,,AUTO

     2508    11929    2           F$->KQ$MBLK=MBLK$->KQ$MBLK;

  11929  1 007140   200005 471500                    LDP1    MBLK$,,AUTO
         1 007141   200056 473500                    LDP3    F$,,AUTO
         1 007142   000100 100500                    MLR     fill='000'O
         1 007143   100000 000100                    ADSC9   0,,PR1                   cn=0,n=64
         1 007144   300000 000100                    ADSC9   0,,PR3                   cn=0,n=64

     2509    11930    2           CALL KQD$ERRLOG (CG$->KQ$CG);

  11930  1 007145   200006 630500                    EPPR0   CG$,,AUTO
         1 007146   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 007147   000000 701000 xent               TSX1    KQD$ERRLOG
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:329  
         1 007150   000000 011000                    NOP     0

     2510    11931    2           RETURN;

  11931  1 007151   200054 221300                    LDX1  ! DELETE+10,,AUTO
         1 007152   000001 702211                    TSX2  ! 1,X1

     2511    11932    2   END DISKERR;
     2512    11933        /********************************************************
     2513    11934        *********************************************************/
     2514    11935        /**/
     2515    11936        /*D* NAME:         CHKBLINK
     2516    11937             PURPOSE:      To validate a BLINK DDA
     2517    11938             DESCRIPTION:  DBLK$ points to a DBLK full of MBLKs.
     2518    11939                           KQ$MBLK.PCDDA is the expected blink DDA, to
     2519    11940                           be found in the control (REDUNDANT)
     2520    11941                           MBLK at the tail end of the DBLK.
     2521    11942                           CTLBLK$ is set to point to this and
     2522    11943                           the blink is checked.  If OK, returns.
     2523    11944                           Else unlocks the DBLK and ALTRETs.
     2524    11945                           KQ$MBLK.SDA.CCDDA (or KQ$MBLK.DDA) is the
     2525    11946                           guy we've just read.
     2526    11947        */
     2527    11948    1   CHKBLINK: PROC ALTRET;

  11948  1 007153   200054 741300       CHKBLINK     STX1  ! DELETE+10,,AUTO

     2528    11949        /**/
     2529    11950    2   DCL P$ PTR;
     2530    11951        /**/
     2531    11952    2           CTLBLK$=PINCRW(DBLK$,DBLK$->KQ$DBLK.SIZW-SIZEW(KQ$MBLK));

  11952  1 007154   200011 470500                    LDP0    DBLK$,,AUTO
         1 007155   000004 220100                    LDX0    4,,PR0
         1 007156   777760 636010                    EAQ     -16,X0
         1 007157   200011 036100                    ADLQ    DBLK$,,AUTO
         1 007160   200026 756100                    STQ     CTLBLK$,,AUTO
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:330  

     2532    11953    2           IF MBLK$->KQ$MBLK.KEY1VALID

  11953  1 007161   200005 471500                    LDP1    MBLK$,,AUTO
         1 007162   100010 236100                    LDQ     8,,PR1
         1 007163   020000 316003                    CANQ    8192,DU
         1 007164   007170 601000 1                  TNZ     s:11956
         1 007165   100003 236100                    LDQ     3,,PR1
         1 007166   100006 116100                    CMPQ    6,,PR1
         1 007167   007206 601000 1                  TNZ     s:11966

     2533    11954    2           OR MBLK$->KQ$MBLK.SDA.CCDDA = MBLK$->KQ$MBLK.DDA THEN
     2534    11955    3             DO;

     2535    11956    3             IF CTLBLK$->KQ$MBLK.PCVALID THEN

  11956  1 007170   200026 473500                    LDP3    CTLBLK$,,AUTO
         1 007171   300010 236100                    LDQ     8,,PR3
         1 007172   010000 316003                    CANQ    4096,DU
         1 007173   007177 600000 1                  TZE     s:11960

     2536    11957    3              IF CTLBLK$->KQ$MBLK.PCDDA ~= 0 THEN GOTO ERR; ELSE;

  11957  1 007174   300017 235100                    LDA     15,,PR3
         1 007175   007212 601000 1                  TNZ     ERR
         1 007176   007261 710000 1                  TRA     s:11985

     2537    11958    3             ELSE
     2538    11959    4               DO;

     2539    11960    4               CTLBLK$->KQ$MBLK.PCVALID='1'B;

  11960  1 007177   010000 236003                    LDQ     4096,DU
         1 007200   300010 256100                    ORSQ    8,,PR3

     2540    11961    4               CTLBLK$->KQ$MBLK.PCDDA=MBLK$->KQ$MBLK.PCDDA;

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:331  
  11961  1 007201   100017 235100                    LDA     15,,PR1
         1 007202   300017 755100                    STA     15,,PR3

     2541    11962    4               CALL UPDATE;

  11962  1 007203   007471 701000 1                  TSX1    UPDATE
         1 007204   000000 011000                    NOP     0

     2542    11963    4               END;

     2543    11964    3             END;

  11964  1 007205   007261 710000 1                  TRA     s:11985

     2544    11965    2           ELSE
     2545    11966    2            IF CTLBLK$->KQ$MBLK.PCDDA ~= MBLK$->KQ$MBLK.PCDDA THEN

  11966  1 007206   200026 473500                    LDP3    CTLBLK$,,AUTO
         1 007207   300017 236100                    LDQ     15,,PR3
         1 007210   100017 116100                    CMPQ    15,,PR1
         1 007211   007261 600000 1                  TZE     s:11985

     2546    11967    3              DO;

  11960  1 007212                       ERR          null
     2547    11968    3   ERR:       ;
     2548    11969                   %LOCK (G=KQ_ERRLOG_GATE);

  11970  1 007212   000103 630400 2                  EPPR0   67
         1 007213   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 007214   000000 701000 xent               TSX1    HFC$LOCK
         1 007215   000000 011000                    NOP     0

     2549    11972    3              KQ_ERRLOG_BFR.CODE=%KQELOG_KQS_BLNK;

  11972  1 007216   015000 236003                    LDQ     6656,DU
         1 007217   000000 552040 xsym               STBQ    KQ_ERRLOG_BFR,'40'O
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:332  

     2550    11973    3              KQ_ERRLOG_BFR.SIZ=1+SIZEW(KQ$DBLK)+SIZEW(KQ$MBLK);

  11973  1 007220   000027 235007                    LDA     23,DL
         1 007221   000015 755000 xsym               STA     KQ_ERRLOG_BFR+13

     2551    11974    3              KQ_ERRLOG_BFR.INFO='0'B;

  11974  1 007222   000000 100400                    MLR     fill='000'O
         1 007223   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         1 007224   000016 000310 xsym               ADSC9   KQ_ERRLOG_BFR+14         cn=0,n=200

     2552    11975    3              P$=ADDR(KQ_ERRLOG_BFR.INFO);

  11975  1 007225   000104 236000 2                  LDQ     68
         1 007226   200055 756100                    STQ     P$,,AUTO

     2553    11976    3              P$->B$$PTR=MBLK$;

  11976  1 007227   200005 236100                    LDQ     MBLK$,,AUTO
         1 007230   200055 470500                    LDP0    P$,,AUTO
         1 007231   000000 756100                    STQ     0,,PR0

     2554    11977    3              P$=PINCRW(P$,1);

  11977  1 007232   200055 236100                    LDQ     P$,,AUTO
         1 007233   000001 036003                    ADLQ    1,DU
         1 007234   200055 756100                    STQ     P$,,AUTO

     2555    11978    3              P$->KQ$DBLK=DBLK$->KQ$DBLK;

  11978  1 007235   200011 470500                    LDP0    DBLK$,,AUTO
         1 007236   200055 471500                    LDP1    P$,,AUTO
         1 007237   000100 100500                    MLR     fill='000'O
         1 007240   000000 000030                    ADSC9   0,,PR0                   cn=0,n=24
         1 007241   100000 000030                    ADSC9   0,,PR1                   cn=0,n=24

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:333  
     2556    11979    3              P$=PINCRW(P$,SIZEW(KQ$DBLK));

  11979  1 007242   000006 036003                    ADLQ    6,DU
         1 007243   200055 756100                    STQ     P$,,AUTO

     2557    11980    3              P$->KQ$MBLK=CTLBLK$->KQ$MBLK;

  11980  1 007244   200026 470500                    LDP0    CTLBLK$,,AUTO
         1 007245   200055 471500                    LDP1    P$,,AUTO
         1 007246   000100 100500                    MLR     fill='000'O
         1 007247   000000 000100                    ADSC9   0,,PR0                   cn=0,n=64
         1 007250   100000 000100                    ADSC9   0,,PR1                   cn=0,n=64

     2558    11981    3              CALL KQD$ERRLOG (CG$->KQ$CG);

  11981  1 007251   200006 630500                    EPPR0   CG$,,AUTO
         1 007252   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 007253   000000 701000 xent               TSX1    KQD$ERRLOG
         1 007254   000000 011000                    NOP     0

     2559    11982    3              CALL UNLOCK;

  11982  1 007255   007454 701000 1                  TSX1    UNLOCK
         1 007256   000000 011000                    NOP     0

     2560    11983    3              ALTRETURN;

  11983  1 007257   200054 221300                    LDX1  ! DELETE+10,,AUTO
         1 007260   000000 702211                    TSX2  ! 0,X1

     2561    11984    3              END;
     2562    11985    2           RETURN;

  11985  1 007261   200054 221300                    LDX1  ! DELETE+10,,AUTO
         1 007262   000001 702211                    TSX2  ! 1,X1

     2563    11986    2   END CHKBLINK;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:334  
     2564    11987        /********************************************************
     2565    11988        *********************************************************/
     2566    11989        /**/
     2567    11990        /*D* NAME:         GETQM
     2568    11991             PURPOSE:      To find the MBLK on which a reader is queued
     2569    11992             DESCRIPTION:  Called when the MLH says the reader is waiting
     2570    11993                           for the GC to finish, after he was blocked
     2571    11994                           for memory.  Finds a super MBLK in the list
     2572    11995                           that has the correct state, and returns
     2573    11996                           MBLK$ pointing to it.
     2574    11997        */
     2575    11998    1   GETQM:  PROC;

  11998  1 007263   200032 741300       GETQM        STX1  ! NFREE,,AUTO

     2576    11999        /**/
     2577    12000    2           IF MLH$->KQ$MLH.SUPERCNT = 0 THEN CALL SC_CGGARB;

  12000  1 007264   200014 470500                    LDP0    MLH$,,AUTO
         1 007265   000004 720100                    LXL0    4,,PR0
         1 007266   007271 601000 1                  TNZ     s:12001

  12000  1 007267   000000 713400 xsym               CLIMB   SC_CGGARB
         1 007270   000000 600000 xsid               climb   nvectors=         0

     2578    12001    2           MBLK$=MLH$->KQ$MLH.HEAD$;

  12001  1 007271   200014 470500                    LDP0    MLH$,,AUTO
         1 007272   000000 236100                    LDQ     0,,PR0
         1 007273   200005 756100                    STQ     MBLK$,,AUTO

     2579    12002    3             DO FOREVER;

     2580    12003    3             IF MBLK$->KQ$MBLK.SUPER THEN

  12003  1 007274   200005 470500                    LDP0    MBLK$,,AUTO
         1 007275   000010 234100                    SZN     8,,PR0
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:335  
         1 007276   007312 605000 1                  TPL     s:12006

     2581    12004    3              IF MBLK$->KQ$MBLK.STATE = KQSS_Q4GC# THEN RETURN;

  12004  1 007277   000010 236100                    LDQ     8,,PR0
         1 007300   007000 376003                    ANQ     3584,DU
         1 007301   004000 116003                    CMPQ    2048,DU
         1 007302   007305 601000 1                  TNZ     s:12005

  12004  1 007303   200032 221300                    LDX1  ! NFREE,,AUTO
         1 007304   000001 702211                    TSX2  ! 1,X1

     2582    12005    3              ELSE IF MBLK$->KQ$MBLK.STATE ~= KQSS_IDLE# THEN CALL SC_CGGARB;

  12005  1 007305   000010 236100                    LDQ     8,,PR0
         1 007306   007000 316003                    CANQ    3584,DU
         1 007307   007312 600000 1                  TZE     s:12006

  12005  1 007310   000000 713400 xsym               CLIMB   SC_CGGARB
         1 007311   000000 600000 xsid               climb   nvectors=         0

     2583    12006    3             MBLK$=MBLK$->KQ$MBLK.LNK$;

  12006  1 007312   200005 470500                    LDP0    MBLK$,,AUTO
         1 007313   000000 236100                    LDQ     0,,PR0
         1 007314   200005 756100                    STQ     MBLK$,,AUTO

     2584    12007    3             END;

  12007  1 007315   007274 710000 1                  TRA     s:12003

     2585    12008    2   END GETQM;
     2586    12009        /********************************************************
     2587    12010        *********************************************************/
     2588    12011        /**/
     2589    12012        /*D* NAME:         CHKMLH
     2590    12013             PURPOSE:      To check the counts in an MLH
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:336  
     2591    12014        */
     2592    12015    1   CHKMLH: PROC ALTRET;

  12015  1 007316   200056 741300       CHKMLH       STX1  ! F$,,AUTO

     2593    12016        /**/
     2594    12017    2   DCL NORM SBIN;
     2595    12018    2   DCL INS SBIN;
     2596    12019    2   DCL DW SBIN;
     2597    12020    2   DCL CONTAINED UBIN;
     2598    12021    2   DCL SUPER SBIN;
     2599    12022    2   DCL M$ PTR;
     2600    12023    2   DCL I$ PTR;
     2601    12024        /**/
     2602    12025    2           NORM=0;

  12025  1 007317   200057 450100                    STZ     NORM,,AUTO

     2603    12026    2           INS=0;

  12026  1 007320   200060 450100                    STZ     INS,,AUTO

     2604    12027    2           DW=0;

  12027  1 007321   200061 450100                    STZ     DW,,AUTO

     2605    12028    2           CONTAINED=0;

  12028  1 007322   200062 450100                    STZ     CONTAINED,,AUTO

     2606    12029    2           SUPER=0;

  12029  1 007323   200063 450100                    STZ     SUPER,,AUTO

     2607    12030    2           M$=MLH$->KQ$MLH.HEAD$;

  12030  1 007324   200014 470500                    LDP0    MLH$,,AUTO
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:337  
         1 007325   000000 236100                    LDQ     0,,PR0
         1 007326   200064 756100                    STQ     M$,,AUTO

     2608    12031    3             DO WHILE (M$ ~= ADDR(NIL));

  12031  1 007327   007355 710000 1                  TRA     s:12044

     2609    12032    3             IF M$->KQ$MBLK.SUPER THEN

  12032  1 007330   200064 470500                    LDP0    M$,,AUTO
         1 007331   000010 234100                    SZN     8,,PR0
         1 007332   007351 605000 1                  TPL     s:12042

     2610    12033    4               DO;

     2611    12034    4               SUPER=SUPER+1;

  12034  1 007333   200063 054100                    AOS     SUPER,,AUTO

     2612    12035    4               CONTAINED=CONTAINED+M$->KQ$MBLK.COUNT;

  12035  1 007334   200062 236100                    LDQ     CONTAINED,,AUTO
         1 007335   000015 036100                    ADLQ    13,,PR0
         1 007336   200062 756100                    STQ     CONTAINED,,AUTO

     2613    12036    4               I$=M$->KQ$MBLK.INSHD$;

  12036  1 007337   000012 236100                    LDQ     10,,PR0
         1 007340   200065 756100                    STQ     I$,,AUTO

     2614    12037    5                 DO WHILE (I$ ~= ADDR(NIL));

  12037  1 007341   007346 710000 1                  TRA     s:12040

     2615    12038    5                 I$=I$->KQ$MBLK.LNK$;

  12038  1 007342   200065 470500                    LDP0    I$,,AUTO
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:338  
         1 007343   000000 236100                    LDQ     0,,PR0
         1 007344   200065 756100                    STQ     I$,,AUTO

     2616    12039    5                 INS=INS+1;

  12039  1 007345   200060 054100                    AOS     INS,,AUTO

     2617    12040    5                 END;

  12040  1 007346   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 007347   007342 601000 1                  TNZ     s:12038

     2618    12041    4               END;

  12041  1 007350   007352 710000 1                  TRA     s:12043

     2619    12042    3             ELSE NORM=NORM+1;

  12042  1 007351   200057 054100                    AOS     NORM,,AUTO

     2620    12043    3             M$=M$->KQ$MBLK.LNK$;

  12043  1 007352   200064 470500                    LDP0    M$,,AUTO
         1 007353   000000 236100                    LDQ     0,,PR0
         1 007354   200064 756100                    STQ     M$,,AUTO

     2621    12044    3             END;

  12044  1 007355   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 007356   007330 601000 1                  TNZ     s:12032

     2622    12045    2           IF MLH$->KQ$MLH.DELAY$ ~= ADDR(NIL) THEN

  12045  1 007357   200014 470500                    LDP0    MLH$,,AUTO
         1 007360   000002 236100                    LDQ     2,,PR0
         1 007361   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 007362   007376 600000 1                  TZE     s:12050
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:339  

     2623    12046    3             DO;

     2624    12047    3             DW=KQRA_MBLK#;

  12047  1 007363   000001 235007                    LDA     1,DL
         1 007364   200061 755100                    STA     DW,,AUTO

     2625    12048    3             CALL KQL$COUNTDLY (MLH$->KQ$MLH.DELAY$,DW);

  12048  1 007365   200061 631500                    EPPR1   DW,,AUTO
         1 007366   200067 451500                    STP1    I$+2,,AUTO
         1 007367   200014 236100                    LDQ     MLH$,,AUTO
         1 007370   000002 036003                    ADLQ    2,DU
         1 007371   200066 756100                    STQ     I$+1,,AUTO
         1 007372   200066 630500                    EPPR0   I$+1,,AUTO
         1 007373   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 007374   000000 701000 xent               TSX1    KQL$COUNTDLY
         1 007375   000000 011000                    NOP     0

     2626    12049    3             END;

     2627    12050    2           IF NORM+INS+DW+CONTAINED ~= MLH$->KQ$MLH.COUNT

  12050  1 007376   200057 236100                    LDQ     NORM,,AUTO
         1 007377   200060 036100                    ADLQ    INS,,AUTO
         1 007400   200061 036100                    ADLQ    DW,,AUTO
         1 007401   200062 036100                    ADLQ    CONTAINED,,AUTO
         1 007402   200014 470500                    LDP0    MLH$,,AUTO
         1 007403   000005 116100                    CMPQ    5,,PR0
         1 007404   007411 601000 1                  TNZ     s:12053
         1 007405   000004 236100                    LDQ     4,,PR0
         1 007406   777777 376007                    ANQ     -1,DL
         1 007407   200063 116100                    CMPQ    SUPER,,AUTO
         1 007410   007423 600000 1                  TZE     s:12057

     2628    12051    2           OR SUPER ~= MLH$->KQ$MLH.SUPERCNT THEN
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:340  
     2629    12052    3             DO;

     2630    12053    3             IF CG$->KQ$CG.RCVR THEN ALTRETURN;

  12053  1 007411   200006 471500                    LDP1    CG$,,AUTO
         1 007412   100105 236100                    LDQ     69,,PR1
         1 007413   000010 316007                    CANQ    8,DL
         1 007414   007417 600000 1                  TZE     s:12054

  12053  1 007415   200056 221300                    LDX1  ! F$,,AUTO
         1 007416   000000 702211                    TSX2  ! 0,X1

     2631    12054    3             CALL SC_CGGBSN;

  12054  1 007417   000000 713400 xsym               CLIMB   SC_CGGBSN
         1 007420   000000 600000 xsid               climb   nvectors=         0

     2632    12055    3             ALTRETURN;

  12055  1 007421   200056 221300                    LDX1  ! F$,,AUTO
         1 007422   000000 702211                    TSX2  ! 0,X1

     2633    12056    3             END;
     2634    12057    2           RETURN;

  12057  1 007423   200056 221300                    LDX1  ! F$,,AUTO
         1 007424   000001 702211                    TSX2  ! 1,X1

     2635    12058    2   END CHKMLH;
     2636    12059        /********************************************************
     2637    12060        *********************************************************/
     2638    12061        /**/
     2639    12062        /*D* NAME:         DELETE
     2640    12063             PURPOSE:      To delete the in-core data block
     2641    12064             DESCRIPTION:  Calls KQD$DELETE & sets DBLK$=ADDR(NIL)
     2642    12065        */
     2643    12066    1   DELETE: PROC;
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:341  

  12066  1 007425   200056 741300       DELETE       STX1  ! F$,,AUTO

     2644    12067        /**/
     2645    12068    2           CALL KQD$DELETE (CG$->KQ$CG,DBLK$);

  12068  1 007426   200011 630500                    EPPR0   DBLK$,,AUTO
         1 007427   200067 450500                    STP0    I$+2,,AUTO
         1 007430   200006 236100                    LDQ     CG$,,AUTO
         1 007431   200066 756100                    STQ     I$+1,,AUTO
         1 007432   200066 630500                    EPPR0   I$+1,,AUTO
         1 007433   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 007434   000000 701000 xent               TSX1    KQD$DELETE
         1 007435   000000 011000                    NOP     0

     2646    12069    2   XIT:    DBLK$=ADDR(NIL);

  12069  1 007436   000001 236000 xsym  XIT          LDQ     B_VECTNIL+1
         1 007437   200011 756100                    STQ     DBLK$,,AUTO

     2647    12070    2           RETURN;

  12070  1 007440   200056 221300                    LDX1  ! F$,,AUTO
         1 007441   000001 702211                    TSX2  ! 1,X1

     2648    12071        /**/
     2649    12072        /*D* NAME:         UPDATED
     2650    12073             PURPOSE:      To unlock & mark updated the current data block
     2651    12074             DESCRIPTION:  Calls KQD$UPDATED and sets DBLK$=ADDR(NIL)
     2652    12075        */
     2653    12076    2   UPDATED: ENTRY;

  12076  1 007442   200056 741300       UPDATED      STX1  ! F$,,AUTO

     2654    12077        /**/
     2655    12078    2           CALL KQD$UPDATED (CG$->KQ$CG,DBLK$);

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:342  
  12078  1 007443   200011 630500                    EPPR0   DBLK$,,AUTO
         1 007444   200067 450500                    STP0    I$+2,,AUTO
         1 007445   200006 236100                    LDQ     CG$,,AUTO
         1 007446   200066 756100                    STQ     I$+1,,AUTO
         1 007447   200066 630500                    EPPR0   I$+1,,AUTO
         1 007450   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 007451   000000 701000 xent               TSX1    KQD$UPDATED
         1 007452   000000 011000                    NOP     0

     2656    12079    2           GOTO XIT;

  12079  1 007453   007436 710000 1                  TRA     XIT

     2657    12080        /**/
     2658    12081        /*D* NAME:         UNLOCK
     2659    12082             PURPOSE:      To unlock any current data block
     2660    12083             DESCRIPTION:  If DBLK$ ~= ADDR(NIL) then calls KQD$UNLOCK.
     2661    12084                           Sets DBLK$=ADDR(NIL)
     2662    12085        */
     2663    12086    2   UNLOCK: ENTRY;

  12086  1 007454   200056 741300       UNLOCK       STX1  ! F$,,AUTO

     2664    12087        /**/
     2665    12088    2           IF DBLK$ ~= ADDR(NIL) THEN

  12088  1 007455   200011 236100                    LDQ     DBLK$,,AUTO
         1 007456   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 007457   007470 600000 1                  TZE     s:12090

     2666    12089    2            CALL KQD$UNLOCK (CG$->KQ$CG,DBLK$);

  12089  1 007460   200011 630500                    EPPR0   DBLK$,,AUTO
         1 007461   200067 450500                    STP0    I$+2,,AUTO
         1 007462   200006 236100                    LDQ     CG$,,AUTO
         1 007463   200066 756100                    STQ     I$+1,,AUTO
         1 007464   200066 630500                    EPPR0   I$+1,,AUTO
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:343  
         1 007465   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 007466   000000 701000 xent               TSX1    KQD$UNLOCK
         1 007467   000000 011000                    NOP     0

     2667    12090    2           GOTO XIT;

  12090  1 007470   007436 710000 1                  TRA     XIT

     2668    12091        /**/
     2669    12092        /*D* NAME:         UPDATE
     2670    12093             PURPOSE:      To mark the current DBLK updated
     2671    12094        */
     2672    12095    2   UPDATE: ENTRY;

  12095  1 007471   200056 741300       UPDATE       STX1  ! F$,,AUTO

     2673    12096        /**/
     2674    12097    2           CALL KQD$UPDATE (CG$->KQ$CG,DBLK$);

  12097  1 007472   200011 630500                    EPPR0   DBLK$,,AUTO
         1 007473   200067 450500                    STP0    I$+2,,AUTO
         1 007474   200006 236100                    LDQ     CG$,,AUTO
         1 007475   200066 756100                    STQ     I$+1,,AUTO
         1 007476   200066 630500                    EPPR0   I$+1,,AUTO
         1 007477   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 007500   000000 701000 xent               TSX1    KQD$UPDATE
         1 007501   000000 011000                    NOP     0

     2675    12098    2           RETURN;

  12098  1 007502   200056 221300                    LDX1  ! F$,,AUTO
         1 007503   000001 702211                    TSX2  ! 1,X1

     2676    12099    2   END DELETE;
     2677    12100        /********************************************************
     2678    12101        *********************************************************/
     2679    12102        /**/
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:344  
     2680    12103        /*D* NAME:         GETPRED
     2681    12104             PURPOSE:      To find the pred needed by REMOVE
     2682    12105        */
     2683    12106    1   GETPRED: PROC;

  12106  1 007504   200056 741300       GETPRED      STX1  ! F$,,AUTO

     2684    12107    2           P$=ADDR(NIL);

  12107  1 007505   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 007506   200007 756100                    STQ     P$,,AUTO

     2685    12108    2           IF MBLK$=MLH$->KQ$MLH.HEAD$ THEN RETURN;

  12108  1 007507   200014 470500                    LDP0    MLH$,,AUTO
         1 007510   200005 236100                    LDQ     MBLK$,,AUTO
         1 007511   000000 116100                    CMPQ    0,,PR0
         1 007512   007514 601000 1                  TNZ     s:12109

  12108  1 007513   000001 702211                    TSX2  ! 1,X1

     2686    12109    2           P$=MLH$->KQ$MLH.HEAD$;

  12109  1 007514   000000 236100                    LDQ     0,,PR0
         1 007515   200007 756100                    STQ     P$,,AUTO

     2687    12110    3             DO FOREVER;

     2688    12111    3             IF P$->KQ$MBLK.LNK$=MBLK$ THEN RETURN;

  12111  1 007516   200007 470500                    LDP0    P$,,AUTO
         1 007517   000000 236100                    LDQ     0,,PR0
         1 007520   200005 116100                    CMPQ    MBLK$,,AUTO
         1 007521   007524 601000 1                  TNZ     s:12112

  12111  1 007522   200056 221300                    LDX1  ! F$,,AUTO
         1 007523   000001 702211                    TSX2  ! 1,X1
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:345  

     2689    12112    3             P$=P$->KQ$MBLK.LNK$;

  12112  1 007524   200007 756100                    STQ     P$,,AUTO

     2690    12113    3             END;

  12113  1 007525   007516 710000 1                  TRA     s:12111

     2691    12114    2   END GETPRED;
     2692    12115        /********************************************************
     2693    12116        *********************************************************/
     2694    12117        /**/
     2695    12118        /*D* NAME:         INVALIDATE
     2696    12119             PURPOSE:      To set up an MBLK for use of the KEY1 area
     2697    12120        */
     2698    12121    1   INVALIDATE: PROC (MBLK);

  12121  1 007526   200054 741300       INVALIDATE   STX1  ! DELETE+10,,AUTO

     2699    12122        /**/
     2700    12123        %KQ_MBLK (FPTN=MBLK,STCLASS="",SUPR=1);
     2701    12393        /**/
     2702    12394    2           IF MBLK.KEY1VALID THEN

  12394  1 007527   200055 470500                    LDP0    @MBLK,,AUTO
         1 007530   000010 236100                    LDQ     8,,PR0
         1 007531   020000 316003                    CANQ    8192,DU
         1 007532   007543 600000 1                  TZE     s:12401

     2703    12395    3             DO;

     2704    12396    3             MBLK.KEY1VALID='0'B;

  12396  1 007533   000014 236000 2                  LDQ     12
         1 007534   000010 356100                    ANSQ    8,,PR0

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:346  
     2705    12397    3             MBLK.KEY1ALL='0'B;

  12397  1 007535   000017 236000 2                  LDQ     15
         1 007536   000010 356100                    ANSQ    8,,PR0

     2706    12398    3             MBLK.SDA.LDA=MBLK.DDA;

  12398  1 007537   000006 235100                    LDA     6,,PR0
         1 007540   000002 755100                    STA     2,,PR0

     2707    12399    3             MBLK.LCSTAMP=MBLK.STAMP;

  12399  1 007541   000001 720100                    LXL0    1,,PR0
         1 007542   000016 740100                    STX0    14,,PR0

     2708    12400    3             END;

     2709    12401    2           RETURN;

  12401  1 007543   200054 221300                    LDX1  ! DELETE+10,,AUTO
         1 007544   000001 702211                    TSX2  ! 1,X1

     2710    12402    2   END INVALIDATE;
     2711    12403        /********************************************************
     2712    12404        *********************************************************/
     2713    12405        /**/
     2714    12406        /*D* NAME:         RELMBLK
     2715    12407             PURPOSE:      To release an MBLK
     2716    12408        */
     2717    12409    1   RELMBLK: PROC (MBLK);

  12409  1 007545   200056 741300       RELMBLK      STX1  ! F$,,AUTO

     2718    12410        /**/
     2719    12411        %KQ_MBLK (FPTN=MBLK,STCLASS="");
     2720    12681    2   DCL T$ PTR;
     2721    12682        /**/
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:347  
     2722    12683    3             DO INHIBIT;

     2723    12684    3             T$=ADDR(MBLK);

  12684  1 007546   200057 236300                    LDQ   ! @MBLK,,AUTO
         1 007547   200060 756300                    STQ   ! T$,,AUTO

     2724    12685    3             CALL KQM$RELMBLK (CG$->KQ$CG,T$);

  12685  1 007550   200060 630700                    EPPR0 ! T$,,AUTO
         1 007551   200067 450700                    STP0  ! I$+2,,AUTO
         1 007552   200006 236300                    LDQ   ! CG$,,AUTO
         1 007553   200066 756300                    STQ   ! I$+1,,AUTO
         1 007554   200066 630700                    EPPR0 ! I$+1,,AUTO
         1 007555   000020 631600 xsym               EPPR1 ! B_VECTNIL+16
         1 007556   000000 701200 xent               TSX1  ! KQM$RELMBLK
         1 007557   000000 011200                    NOP   ! 0

     2725    12686    3             KQ$GARB.RELCNT=KQ$GARB.RELCNT+1;

  12686  1 007560   200006 470700                    LDP0  ! CG$,,AUTO
         1 007561   000047 054300                    AOS   ! 39,,PR0

     2726    12687    3             RETURN;

  12687  1 007562   200056 221300                    LDX1  ! F$,,AUTO
         1 007563   000001 702211                    TSX2  ! 1,X1

     2727    12688    3             END;

     2728    12689    2   END RELMBLK;

  12689  1 007564   000001 702211                    TSX2  ! 1,X1

KQ_ISMBLK
 Sect OctLoc
   0     000   000000 006014   000000 000000   040040 040040   040040 040040    ........
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:348  
   0     004   040040 040040   040040 040040   000000 000000   000000 000000            ........
   0     010   360000 000000   000000 000000   000000 006014   000000 006014    ................
   0     014   000000 000000   000000 000000   000000 000000   000000 000000    ................

(unnamed)
 Sect OctLoc
   2     000   000003 006000   000002 006000   777767 777777   777757 777777    ................
   2     004   777777 677777   777777 757777   777777 577777   777777 737777    ................
   2     010   777777 774777   777777 777637   777777 763777   777777 777177    ................
   2     014   757777 777777   767777 777777   777777 777752   577777 777777    ................
   2     020   770777 777777   777177 777777   777737 777777   000000 000031    ................
   2     024   000002 006000   000002 006000   000023 006000   773777 777777    ................
   2     030   000000 000025   000030 006000   737777 777777   777577 777777    ................
   2     034   777777 777751   000000 000032   000035 006000   677777 777777    ................
   2     040   000000 000050   000040 006000   000007 006000   000006 006000    ...(. ..........
   2     044   000000 000033   000044 006000   000000 000034   000046 006000    .....$.......&..
   2     050   000013 006000   000011 006000   000014 006000   000012 006000    ................
   2     054   000000 000035   000054 006000   000000 000017   000056 006000    .....,..........
   2     060   000015 006000   000000 000024   000000 000023   000062 006000    .............2..
   2     064   000061 006000   000000 000036   000065 006000   000000 000014    .1.......5......
   2     070   000000 000020   000070 006000   000067 006000   000000 000015    .....8...7......
   2     074   000000 000021   000074 006000   000073 006000   000000 000016    .....<...;......
   2     100   000000 000022   000100 006000   000077 006000   000000 006000    .....@...?......
   2     104   000016 006000                                                    ....
     2729    12690    1   END KQS$GARBF;

PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:349  
--  Include file information  --

   EL$TABLES.:E05TOU  is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   KC_CP6.:E05TOU  is referenced.
   KC$CP6V_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   KQ_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   KQ_MAC_C.:E05TOU  is referenced.
   KQ_SUBS_C.:E05TOU  is referenced.
      No diagnostics issued in procedure KQS$GARBF.
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:350  

 **** Variables and constants ****

  ****  Section 000 RoData KQS$GARBF

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(576)   r     1 KQ_ISMBLK

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    56-0-0/w PTR         r     1 @CLKDFR                   56-0-0/w PTR         r     1 @CLKDFR
    55-0-0/w PTR         r     1 @DFR                      55-0-0/w PTR         r     1 @DFR
    31-0-0/w PTR         r     1 @KQ$MLH                   55-0-0/w PTR         r     1 @MBLK
    57-0-0/w PTR         r     1 @MBLK                      3-0-0/w PTR         r     1 @PARM
    60-0-0/w PTR         r     1 @SMBLK                    57-0-0/w PTR         r     1 @START$
    61-0-0/w UBIN        r     1 BLOTTO                     6-0-0/w PTR         r     1 CG$
    *0-0-0/w SBIN        r     1 CLKDFR                    *0-0-0/w UBIN        r     1 CLKDFR
    62-0-0/w UBIN        r     1 CONTAINED                 26-0-0/w PTR         r     1 CTLBLK$
    11-0-0/w PTR         r     1 DBLK$                     11-0-0/w UBIN        r     1 DBLK$R
    13-0-0/w UBIN        r     1 DDA                       42-0-0/w BIT         r     1 DELETE
    *0-0-0/w SBIN        r     1 DFR                       *0-0-0/w SBIN        r     1 DFR
    10-0-0/w PTR         r     1 DFRP$                     61-0-0/w SBIN        r     1 DW
    27-0-0/w PTR         r     1 END$                      15-0-0/w UBIN        r     1 ENTFLAG
    56-0-0/w PTR         r     1 F$                        33-0-0/w PTR         r     1 FREE$
    12-0-0/w SBIN        r     1 I                         31-0-0/w PTR         r     1 I$
    65-0-0/w PTR         r     1 I$                        60-0-0/w SBIN        r     1 INS
    *0-0-0/w STRC(288)   r     1 KQ$MLH                    32-0-0/w STRC(288)   r     1 KQ$TMLH
    20-0-0/w PTR         r     1 M$                        64-0-0/w PTR         r     1 M$
    *0-0-0/d STRC(576)   r     1 MBLK                      *0-0-0/d STRC(576)   r     1 MBLK
     5-0-0/w PTR         r     1 MBLK$                     14-0-0/w PTR         r     1 MLH$
    32-0-0/w SBIN        r     1 NFREE                     21-0-0/w SBIN        r     1 NMBLKS
    57-0-0/w SBIN        r     1 NORM                       7-0-0/w PTR         r     1 P$
    55-0-0/w PTR         r     1 P$                        *0-0-0/w UBIN        r     1 PARM
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:351  
    24-0-0/w PTR         r     1 QTN$                      17-0-0/w PTR         r     1 SAVP$
    36-0-0/d STRC(576)   r     1 SMBLK                     *0-0-0/d STRC(576)   r     1 SMBLK
    34-0-0/d STRC(576)   r     1 SMBLK                      4-0-0/w PTR         r     1 STA$
    31-0-0/w UBIN        r     1 STAMP                     25-0-0/w PTR         r     1 START$
    *0-0-0/w PTR         r     1 START$                    63-0-0/w SBIN        r     1 SUPER
    55-0-0/w PTR         r     1 T$                        60-0-0/w PTR         r     1 T$
    33-0-0/w PTR         r     1 T1$                       31-0-0/w PTR         r     1 T1$
    34-0-0/w PTR         r     1 T2$                       32-0-0/w PTR         r     1 T2$
    22-0-0/w PTR         r     1 X$                        23-0-0/w PTR         r     1 Z$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w SBIN        r     1 KQ_BASEDELAY               0-0-0/w UBIN        r     1 KQ_DEBUG
     0-0-0/w STRC(2304)  r     1 KQ_ERRLOG_BFR              0-0-0/b BIT (72)    r     1 KQ_ERRLOG_GATE
     0-0-0/w STRC(288)   r     1 KQ_IMLH                    0-0-0/b STRC        r     1 KQ_LOG
     0-0-0/w STRC(288)   r     1 KQ_STATS

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/c ACHR        r     1 B$$CHARS                   0-0-0/h UBIN(18)    r     1 B$$HALF
     0-0-0/w PTR         r     1 B$$PTR                     0-0-0/w STRC(576)   r     1 FRAME
     0-0-0/d STRC(6516)  r     1 KQ$CG                      0-0-0/d STRC(216)   r     1 KQ$DBLK
     0-0-0/d STRC(288)   r     1 KQ$DFRBLK                  0-0-0/w STRC(180)   r     1 KQ$DFRPARM
     0-0-0/d STRC(576)   r     1 KQ$MBLK                    0-0-0/w STRC(288)   r     1 KQ$MLH
     0-0-0/w STRC(288)   r     1 KQ$MLHB02                  0-0-0/d STRC(360)   r     1 KQ$MTYP
     0-0-0/d STRC(576)   r     1 KQ$NRMLMBLK                0-0-0/d STRC(1908)  r     1 KQ$QTN
     0-0-0/d STRC(1296)  r     1 KQ$STA                     0-0-0/w STRC(216)   r     1 KQ$THDR


   Procedure KQS$GARBF requires 3957 words for executable code.
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:352  
   Procedure KQS$GARBF requires 62 words of local(AUTO) storage.

    No errors detected in file KQS$SCUM.:E05TSI    .
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:353  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:354  
          MINI XREF LISTING

ALT IN PROCEDURE DISKERR
     11924**LABEL   11921--CALLALT
ALTRT
      9753**LABEL    8893--CALLALT  8900--CALLALT  9641--CALLALT  9644--CALLALT  9669--CALLALT  9681--CALLALT
      9686--CALLALT
ALTRT IN PROCEDURE DOQ
      9466**LABEL    9410--CALLALT
ALTRT IN PROCEDURE DOS
      9561**LABEL    9547--CALLALT
ALTRT IN PROCEDURE RCVMLH
      9163**LABEL    9138--CALLALT
ALTRT IN PROCEDURE TRYQUIT
      8575**LABEL    8573--CALLALT
B$$CHARS
      8018**DCL     11279<<ASSIGN  11279>>ASSIGN
B$$HALF
      8019**DCL     10178<>CALL    11426<>CALL
B$$PTR
      5516**DCL     11976<<ASSIGN
BLOTTO IN PROCEDURE FILLDBLK
     10487**DCL     10500<>CALL
C10 IN PROCEDURE CONCATS
     10704**LABEL   10765--GOTO
C30 IN PROCEDURE CONCATS
     10708**LABEL   10760--GOTO
C40 IN PROCEDURE CONCATS
     10712**LABEL   10796--GOTO
C60 IN PROCEDURE CONCATS
     10717**LABEL   10791--GOTO
CDELMSG0 IN PROCEDURE DODELMSG
      9356**ENTRY    8708--CALL
CDELMSG1 IN PROCEDURE DODELMSG
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:355  
      9359**ENTRY    8713--CALL
CDELMSG2 IN PROCEDURE DODELMSG
      9362**ENTRY    8791--CALL
CDELMSG3 IN PROCEDURE DODELMSG
      9366**ENTRY    8717--CALL
CG$
      8029**DCL      5532--IMP-PTR  8446<<ASSIGN   8447>>ASSIGN   8522<<ASSIGN   8523>>IF       8526>>CALL
      8530>>ASSIGN   8531>>ASSIGN   8534>>CALL     8537>>ASSIGN   8538>>ASSIGN   8541>>ASSIGN   8541>>ASSIGN
      8544>>ASSIGN   8544>>ASSIGN   8547>>IF       8555>>ASSIGN   8555>>ASSIGN   8556>>IF       8559>>CALL
      8567>>IF       8569>>IF       8570>>IF       8570>>IF       8573>>CALL     8587<<ASSIGN   8590>>CALL
      8592>>ASSIGN   8594>>CALL     8596>>ASSIGN   8596>>ASSIGN   8608<<ASSIGN   8621>>CALL     8623>>IF
      8626>>CALL     8630>>ASSIGN   8632>>CALL     8636>>CALL     8638>>ASSIGN   8639>>ASSIGN   8640>>ASSIGN
      8641>>ASSIGN   8642>>ASSIGN   8643>>ASSIGN   8644>>ASSIGN   8645>>ASSIGN   8646>>ASSIGN   8647>>ASSIGN
      8649>>CALL     8652>>CALL     8655>>CALL     8657>>ASSIGN   8658>>ASSIGN   8660>>CALL     8688<<ASSIGN
      8689>>IF       8691>>CALL     8693>>IF       8696>>CALL     8700>>ASSIGN   8701>>ASSIGN   8703>>CALL
      8709>>IF       8785<<ASSIGN   8786>>ASSIGN   8787>>ASSIGN   8840<<ASSIGN   8841>>IF       8841>>IF
      8843>>ASSIGN   8844>>ASSIGN   8877<<ASSIGN   8878>>ASSIGN   8880>>IF       8882>>ASSIGN   8886>>ASSIGN
      8887>>ASSIGN   8887>>ASSIGN   8888>>ASSIGN   8891>>ASSIGN   8898>>ASSIGN   8904>>ASSIGN   8906>>ASSIGN
      8907>>ASSIGN   8912>>IF       8914>>IF       8914>>IF       8917>>ASSIGN   8918>>ASSIGN   8919>>ASSIGN
      8920>>ASSIGN   8922>>IF       8923>>IF       8926>>IF       8935>>ASSIGN   8936>>ASSIGN   8951<<ASSIGN
      8952>>IF       8954>>IF       8956>>IF       8966>>ASSIGN   8967>>ASSIGN   8968>>ASSIGN   9137>>CALL
      9204>>CALL     9204>>CALL     9210>>CALL     9212>>ASSIGN   9214>>ASSIGN   9216>>CALL     9220>>IF
      9221>>ASSIGN   9222>>ASSIGN   9223>>ASSIGN   9225>>ASSIGN   9226>>ASSIGN   9227>>ASSIGN   9233>>ASSIGN
      9235>>CALL     9238>>ASSIGN   9243>>CALL     9247>>ASSIGN   9260>>CALL     9264>>ASSIGN   9271>>CALL
      9279>>ASSIGN   9280>>ASSIGN   9287>>ASSIGN   9288>>ASSIGN   9292>>CALL     9294>>IF       9296>>ASSIGN
      9302>>CALL     9309>>CALL     9311>>CALL     9314>>ASSIGN   9314>>ASSIGN   9319>>ASSIGN   9331>>ASSIGN
      9343>>ASSIGN   9344>>ASSIGN   9345>>CALL     9348>>ASSIGN   9349>>ASSIGN   9350>>ASSIGN   9351>>ASSIGN
      9352>>ASSIGN   9353>>IF       9357>>ASSIGN   9360>>ASSIGN   9363>>ASSIGN   9367>>ASSIGN   9380>>CALL
      9382>>ASSIGN   9383>>IF       9384>>IF       9386>>IF       9386>>IF       9389>>ASSIGN   9391>>CALL
      9396>>ASSIGN   9397>>ASSIGN   9397>>ASSIGN   9398>>ASSIGN   9400>>IF       9404>>ASSIGN   9407>>CALL
      9409>>ASSIGN   9410>>CALL     9411>>ASSIGN   9413>>CALL     9415>>IF       9415>>IF       9422>>IF
      9427>>CALL     9437>>IF       9439>>IF       9441>>ASSIGN   9443>>ASSIGN   9444>>IF       9447>>ASSIGN
      9448>>ASSIGN   9450>>CALL     9454>>IF       9456>>ASSIGN   9457>>ASSIGN   9459>>CALL     9464>>CALL
      9471>>CALL     9473>>ASSIGN   9478>>CALL     9484>>CALL     9492>>CALL     9497>>CALL     9513>>CALL
      9515>>ASSIGN   9515>>ASSIGN   9516>>ASSIGN   9518>>IF       9538>>ASSIGN   9544>>CALL     9546>>ASSIGN
      9547>>CALL     9548>>ASSIGN   9550>>CALL     9552>>IF       9552>>IF       9558>>CALL     9591<<ASSIGN
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:356  
      9601>>ASSIGN   9619<<ASSIGN   9620>>IF       9620>>IF       9623>>ASSIGN   9624>>ASSIGN   9627>>ASSIGN
      9630>>CALL     9630>>CALL     9637>>ASSIGN   9638>>DOCASE   9664>>ASSIGN   9668>>ASSIGN   9670>>IF
      9671>>IF       9672>>ASSIGN   9680>>ASSIGN   9682>>IF       9683>>IF       9685>>ASSIGN   9702>>CALL
      9702>>CALL     9706>>IF       9737>>ASSIGN   9739>>IF       9762<<ASSIGN   9764>>ASSIGN   9765>>ASSIGN
      9799>>IF       9801>>ASSIGN   9806>>ASSIGN   9809>>ASSIGN   9812>>CALL     9814>>ASSIGN   9824>>IF
      9833>>CALL     9856>>IF       9867>>CALL     9870>>CALL     9878>>ASSIGN  10178>>CALL    10611>>CALL
     10615>>ASSIGN  10616>>ASSIGN  10618>>CALL    10627>>ASSIGN  10686>>ASSIGN  10692>>CALL    10753>>ASSIGN
     10814>>ASSIGN  11142>>CALL    11158>>ASSIGN  11159>>ASSIGN  11160>>DOCASE  11195>>ASSIGN  11204>>ASSIGN
     11264>>IF      11266>>ASSIGN  11267>>ASSIGN  11268>>ASSIGN  11269>>ASSIGN  11283>>ASSIGN  11284>>ASSIGN
     11285>>IF      11295>>ASSIGN  11295>>ASSIGN  11296>>ASSIGN  11298>>ASSIGN  11299>>IF      11301>>IF
     11302>>ASSIGN  11303>>IF      11305>>IF      11307>>IF      11393>>ASSIGN  11395>>IF      11399>>IF
     11400>>IF      11401>>IF      11402>>IF      11403>>IF      11406>>IF      11407>>ASSIGN  11407>>ASSIGN
     11408>>ASSIGN  11408>>ASSIGN  11410>>IF      11415>>IF      11417>>ASSIGN  11420>>ASSIGN  11421>>ASSIGN
     11423>>CALL    11426>>CALL    11426>>CALL    11434>>ASSIGN  11437>>ASSIGN  11439>>ASSIGN  11439>>ASSIGN
     11441>>ASSIGN  11442>>ASSIGN  11443>>ASSIGN  11451>>ASSIGN  11453>>ASSIGN  11454>>ASSIGN  11455>>ASSIGN
     11460>>ASSIGN  11461>>ASSIGN  11462>>ASSIGN  11463>>ASSIGN  11465>>ASSIGN  11466>>IF      11468>>ASSIGN
     11469>>ASSIGN  11473>>ASSIGN  11474>>ASSIGN  11476>>ASSIGN  11478>>ASSIGN  11479>>ASSIGN  11484>>ASSIGN
     11485>>ASSIGN  11488>>ASSIGN  11490>>ASSIGN  11491>>ASSIGN  11491>>ASSIGN  11495>>IF      11504>>ASSIGN
     11507>>IF      11518>>ASSIGN  11519>>ASSIGN  11520>>ASSIGN  11563>>ASSIGN  11563>>ASSIGN  11563>>ASSIGN
     11565>>ASSIGN  11570>>ASSIGN  11571>>ASSIGN  11572>>ASSIGN  11574>>ASSIGN  11575>>ASSIGN  11578>>ASSIGN
     11603>>ASSIGN  11637>>ASSIGN  11642>>ASSIGN  11643>>ASSIGN  11644>>ASSIGN  11646>>ASSIGN  11664>>IF
     11664>>IF      11671>>ASSIGN  11678>>ASSIGN  11680>>ASSIGN  11697>>ASSIGN  11697>>ASSIGN  11699>>ASSIGN
     11699>>ASSIGN  11713>>IF      11714>>ASSIGN  11715>>ASSIGN  11716>>ASSIGN  11717>>ASSIGN  11717>>ASSIGN
     11724>>ASSIGN  11725>>ASSIGN  11754>>CALL    11762>>ASSIGN  11773>>ASSIGN  11774>>ASSIGN  11775>>ASSIGN
     11777>>CALL    11921>>CALL    11927>>ASSIGN  11930>>CALL    11981>>CALL    12053>>IF      12068>>CALL
     12078>>CALL    12089>>CALL    12097>>CALL    12685>>CALL    12686>>ASSIGN  12686>>ASSIGN
CGFULL
      8618**PROC     8609--CALL
CHKBLINK
     11948**PROC     9293--CALL    10719--CALL    11271--CALL    11452--CALL    11477--CALL    11579--CALL
CHKMLH
     12015**PROC     9138--CALL     9635--CALL    10193--CALL    10780--CALL    10838--CALL    11500--CALL
     11685--CALL
CLKDFR IN PROCEDURE FETCH
     11752**DCL     11749--PROC    11762>>ASSIGN
CLKDFR IN PROCEDURE GETDBLK
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:357  
     10606**DCL     10603--PROC    10627>>ASSIGN
CONCATD0 IN PROCEDURE CONCATS
     10762**ENTRY    8755--CALL
CONCATD1 IN PROCEDURE CONCATS
     10793**ENTRY    8760--CALL
CONCATF0 IN PROCEDURE CONCATS
     10756**ENTRY    8796--CALL
CONCATF1 IN PROCEDURE CONCATS
     10787**ENTRY    8801--CALL
CONCATN
     10648**PROC     9657--CALL
CONCATS
     10681**PROC     9681--CALL
CONTAINED IN PROCEDURE CHKMLH
     12020**DCL     12028<<ASSIGN  12035<<ASSIGN  12035>>ASSIGN  12050>>IF
CTLBLK$
      8046**DCL      9297>>ASSIGN   9325>>ASSIGN  10514<<ASSIGN  10515>>ASSIGN  10708<<ASSIGN  10710>>ASSIGN
     10722>>ASSIGN  10723>>ASSIGN  11273>>ASSIGN  11276>>IF      11279>>ASSIGN  11280>>ASSIGN  11284>>ASSIGN
     11313>>IF      11314>>IF      11315>>IF      11316>>IF      11317>>IF      11367>>ASSIGN  11375>>ASSIGN
     11376>>ASSIGN  11377>>ASSIGN  11433<<ASSIGN  11434>>ASSIGN  11435>>ASSIGN  11436>>ASSIGN  11454>>ASSIGN
     11478>>ASSIGN  11952<<ASSIGN  11956>>IF      11957>>IF      11960>>ASSIGN  11961>>ASSIGN  11966>>IF
     11980>>ASSIGN
D0 IN PROCEDURE DODELMSG
      9202**LABEL    9239--GOTO     9281--GOTO     9354--GOTO
D0 IN PROCEDURE DOQ
      9397**LABEL    9415--GOTO     9499--GOTO
D0 IN PROCEDURE DOS
      9515**LABEL    9552--GOTO
D1 IN PROCEDURE DODELMSG
      9233**LABEL    9251--GOTO     9364--GOTO
D1 IN PROCEDURE DOQ
      9411**LABEL    9489--GOTO
D1 IN PROCEDURE DOS
      9548**LABEL    9564--GOTO
D10 IN PROCEDURE DODELMSG
      9254**LABEL    9368--GOTO
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:358  
D11 IN PROCEDURE DOQ
      9434**LABEL    9429--GOTO
D14 IN PROCEDURE DODELMSG
      9262**LABEL    9260--CALLALT
D18 IN PROCEDURE DODELMSG
      9277**LABEL    9332--GOTO     9341--GOTO
D2 IN PROCEDURE DOQ
      9433**LABEL    9494--GOTO
D20 IN PROCEDURE DODELMSG
      9288**LABEL    9328--GOTO     9361--GOTO
D22 IN PROCEDURE DODELMSG
      9293**LABEL    9365--GOTO
D23 IN PROCEDURE DODELMSG
      9294**LABEL    9315--GOTO
D28 IN PROCEDURE DODELMSG
      9304**LABEL    9316--GOTO
D3 IN PROCEDURE DODELMSG
      9241**LABEL    9358--GOTO
D30 IN PROCEDURE DODELMSG
      9316**LABEL    9302--CALLALT
D32 IN PROCEDURE DODELMSG
      9319**LABEL    9337--GOTO
D4 IN PROCEDURE DODELMSG
      9245**LABEL    9243--CALLALT
D40 IN PROCEDURE DODELMSG
      9333**LABEL    9292--CALLALT
D50 IN PROCEDURE DODELMSG
      9339**LABEL    9293--CALLALT
D60 IN PROCEDURE DODELMSG
      9347**LABEL    9309--CALLALT
DBLK$
      8032**DCL      7060--IMP-PTR  8033--REDEF    8783<<ASSIGN   9243<>CALL     9260<>CALL     9292<>CALL
      9294>>IF       9296>>ASSIGN   9322>>IF       9326>>ASSIGN   9333>>IF       9344>>ASSIGN   9345<>CALL
      9364>>IF       9761<<ASSIGN   9770>>IF       9795<<ASSIGN   9851>>IF       9875>>IF      10502>>ASSIGN
     10514>>ASSIGN  10514>>ASSIGN  10516>>ASSIGN  10517>>ASSIGN  10518>>ASSIGN  10611<>CALL    10613>>IF
     10615>>ASSIGN  10618<>CALL    10708>>ASSIGN  10708>>ASSIGN  10709>>ASSIGN  10741>>IF      10759>>IF
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:359  
     10769>>IF      10790>>IF      11130<<ASSIGN  11159<<ASSIGN  11269>>ASSIGN  11272>>ASSIGN  11272>>ASSIGN
     11274>>ASSIGN  11275>>ASSIGN  11283>>ASSIGN  11433>>ASSIGN  11433>>ASSIGN  11437>>ASSIGN  11453>>ASSIGN
     11529>>IF      11542>>IF      11551>>IF      11586>>IF      11595>>IF      11608>>IF      11617>>IF
     11625>>IF      11634>>IF      11651>>IF      11695>>ASSIGN  11695>>ASSIGN  11754<>CALL    11757>>IF
     11774>>ASSIGN  11777<>CALL    11952>>ASSIGN  11952>>ASSIGN  11978>>ASSIGN  12068<>CALL    12069<<ASSIGN
     12078<>CALL    12088>>IF      12089<>CALL    12097<>CALL
DBLK$R
      8033**DCL      9241<<ASSIGN   9258<<ASSIGN   9291<<ASSIGN  10706<<ASSIGN  10712<<ASSIGN  11203<<ASSIGN
     11449<<ASSIGN  11474<<ASSIGN  11575<<ASSIGN
DDA
      8035**DCL      8784<<ASSIGN   9242<<ASSIGN   9243<>CALL     9245>>IF       9259<<ASSIGN   9260<>CALL
      9262>>IF       9289<<ASSIGN   9290<<ASSIGN   9292<>CALL     9298<<ASSIGN   9299>>IF       9302<>CALL
      9316>>IF       9334>>DOCASE   9763<<ASSIGN   9875>>IF      10491>>ASSIGN  10608<<ASSIGN  10609>>IF
     10609<<ASSIGN  10610<<ASSIGN  10610>>ASSIGN  10611<>CALL    10623>>DOCASE  10705<<ASSIGN  10715<<ASSIGN
     10741>>IF      10769>>IF      11202<<ASSIGN  11441>>ASSIGN  11448<<ASSIGN  11473<<ASSIGN  11529>>IF
     11551>>IF      11574<<ASSIGN  11595>>IF      11617>>IF      11634>>IF      11754<>CALL    11758>>DOCASE
     11921<>CALL
DELCONT
      8709**LABEL    8714--GOTO     8718--GOTO     8792--GOTO
DELETE
     12066**PROC     9327--CALL     9330--CALL    11580--CALL
DELETE IN PROCEDURE RCVMLH
      9115**DCL      9118<<ASSIGN   9127<<ASSIGN   9137>>IF
DFR IN PROCEDURE FETCH
     11751**DCL     11749--PROC    11775>>ASSIGN
DFR IN PROCEDURE GETDBLK
     10605**DCL     10603--PROC    10616>>ASSIGN
DFRP$
      8031**DCL      7586--IMP-PTR  8782<<ASSIGN   8783>>ASSIGN   8784>>ASSIGN   8785>>ASSIGN   9760<<ASSIGN
      9761>>ASSIGN   9762>>ASSIGN   9763>>ASSIGN   9771>>IF
DISKERR
     11790**PROC     9340--CALL    10744--CALL    10775--CALL    11536--CALL    11561--CALL    11601--CALL
     11620--CALL
DODELMSG
      9198**PROC     8539--CALL     8546--CALL     8553--CALL
DOQ
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:360  
      9378**PROC     8549--CALL
DOQ0 IN PROCEDURE DOQ
      9488**ENTRY    9751--CALL
DOQ0F IN PROCEDURE DOQ
      9490**ENTRY    9748--CALL
DOQ1 IN PROCEDURE DOQ
      9495**ENTRY    8845--CALL
DOS
      9511**PROC     8551--CALL
DOS0 IN PROCEDURE DOS
      9563**ENTRY    9743--CALL
DOSPLIT IN PROCEDURE INSRT
     11416**LABEL   11166--GOTO    11495--GOTO    11513--GOTO    11656--GOTO
DOT IN PROCEDURE DOQ
      9468**ENTRY    8547--CALL
DUMPLIST
      9899**PROC     9853--CALL
DW IN PROCEDURE CHKMLH
     12019**DCL     12027<<ASSIGN  12047<<ASSIGN  12048<>CALL    12050>>IF
END$
      8047**DCL      9651<<ASSIGN   9652>>IF       9653>>IF       9653>>ASSIGN   9656>>ASSIGN  10176>>ASSIGN
     10185>>ASSIGN  10187>>ASSIGN  10545<<ASSIGN  10569<<ASSIGN  10570>>IF      10576>>IF      10578>>ASSIGN
     10651>>ASSIGN  10653>>ASSIGN  10655>>ASSIGN  10662>>ASSIGN  10664>>ASSIGN  10665>>ASSIGN  10687<<ASSIGN
     10691>>ASSIGN  10695>>IF      10709>>ASSIGN  10710>>ASSIGN  10712>>ASSIGN  10713>>CALL    10714>>ASSIGN
     10714>>ASSIGN  10715>>ASSIGN  10718>>ASSIGN  10724>>ASSIGN  10725>>ASSIGN  10726>>ASSIGN  10727>>ASSIGN
     10728>>ASSIGN  10729>>ASSIGN  10730>>ASSIGN  10735>>CALL    10758<<ASSIGN  10764<<ASSIGN  10774>>ASSIGN
     10789<<ASSIGN  10795<<ASSIGN
ENTFLAG
      8037**DCL      8532<<ASSIGN   8560>>IF       8700<<ASSIGN   8705>>DOCASE   8786<<ASSIGN   8788>>DOCASE
      8843<<ASSIGN   8959<<ASSIGN   9204<>CALL     9592<<ASSIGN   9623<<ASSIGN   9630<>CALL     9702<>CALL
      9738>>IF       9741>>IF       9746>>IF       9764<<ASSIGN   9766>>DOCASE   9772<<ASSIGN  10178<>CALL
     10692<>CALL    11142<>CALL    11426<>CALL    11921<>CALL
ERR IN PROCEDURE CHKBLINK
     11960**LABEL   11957--GOTO
F$ IN PROCEDURE DISKERR
     11794**DCL     11919<<ASSIGN  11921<>CALL    11925>>ASSIGN  11926<<ASSIGN  11926>>ASSIGN  11927>>ASSIGN
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:361  
     11928<<ASSIGN  11928>>ASSIGN  11929>>ASSIGN
FERR0 IN PROCEDURE CONCATS
     10744**LABEL   10759--GOTO
FERR0 IN PROCEDURE INSRT
     11536**LABEL   11271--CALLALT 11542--GOTO
FERR1 IN PROCEDURE CONCATS
     10772**LABEL   10790--GOTO
FERR1 IN PROCEDURE INSRT
     11561**LABEL   11452--CALLALT 11586--GOTO
FERR11 IN PROCEDURE CONCATS
     10773**LABEL   10719--CALLALT
FERR2 IN PROCEDURE INSRT
     11601**LABEL   11477--CALLALT 11608--GOTO
FERR3 IN PROCEDURE INSRT
     11620**LABEL   11579--CALLALT 11625--GOTO
FETCH
     11749**PROC    10707--CALL    10716--CALL    11205--CALL    11450--CALL    11475--CALL    11576--CALL
FILLDBLK
     10214**PROC    10183--CALL    11423--CALL
FRAME IN PROCEDURE DISKERR
     11795**DCL     11917--ASSIGN  11926--ASSIGN
FRAME.MLH IN PROCEDURE DISKERR
     11854**DCL     11925<<ASSIGN
FREE$ IN PROCEDURE INSRT
     10858**DCL     11272<<ASSIGN  11273>>ASSIGN  11343>>ASSIGN  11703<<ASSIGN  11703>>ASSIGN
FTCH0 IN PROCEDURE INSRT
     11202**LABEL   11162--GOTO    11521--GOTO    11547--GOTO
FTCH1 IN PROCEDURE INSRT
     11448**LABEL   11170--GOTO    11591--GOTO
FTCH2 IN PROCEDURE INSRT
     11473**LABEL   11613--GOTO
FTCH3 IN PROCEDURE INSRT
     11574**LABEL   11630--GOTO
FTCHD0 IN PROCEDURE INSRT
     11264**LABEL   11543--GOTO
FTCHD1 IN PROCEDURE INSRT
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:362  
     11451**LABEL   11587--GOTO
FTCHD2 IN PROCEDURE INSRT
     11476**LABEL   11609--GOTO
FTCHD3 IN PROCEDURE INSRT
     11577**LABEL   11626--GOTO
G1 IN PROCEDURE GETDBLK
     10613**LABEL   10611--CALLALT
GATHER
      9847**PROC     9641--CALL     9644--CALL
GB0
      8540**LABEL    8709--GOTO
GB1
      8547**LABEL    8710--GOTO
GB2
      8550**LABEL    8846--GOTO     9752--GOTO
GB3
      8552**LABEL    9744--GOTO
GBFAIL
      8556**LABEL    9742--GOTO     9749--GOTO
GBLOOP
      8544**LABEL    8556--GOTO
GETDBLK
     10603**PROC     9852--CALL    11419--CALL
GETLIST
     10533**PROC     9850--CALL
GETPRED
     12106**PROC    10810--CALL
GETQM
     11998**PROC     9442--CALL     9712--CALL
GETSLIST IN PROCEDURE GETLIST
     10557**ENTRY    9679--CALL
GOTDBLK IN PROCEDURE INSRT
     11420**LABEL   11652--GOTO
GS0 IN PROCEDURE GETLIST
     10560**LABEL   10565--GOTO    10579--GOTO
HFC$LOCK
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:363  
      2885**DCL-ENT  8590--CALL     8621--CALL     8636--CALL     8655--CALL     8691--CALL     9210--CALL
      9380--CALL     9413--CALL     9471--CALL     9492--CALL     9497--CALL     9513--CALL     9523--CALL
      9550--CALL     9804--CALL     9812--CALL     9862--CALL     9870--CALL    11914--CALL    11970--CALL
HFC$UNLOCK
      2885**DCL-ENT  8526--CALL     8534--CALL     8594--CALL     8626--CALL     8632--CALL     8649--CALL
      8660--CALL     8696--CALL     8703--CALL     9216--CALL     9391--CALL     9407--CALL     9450--CALL
      9459--CALL     9484--CALL     9533--CALL     9541--CALL     9544--CALL     9558--CALL     9827--CALL
      9833--CALL     9859--CALL     9867--CALL
I
      8034**DCL      8018--IMP-SIZ  9141<<ASSIGN   9147>>IF       9148<<ASSIGN  10500<>CALL    10501>>ASSIGN
     10504<<DOINDEX 10776<<ASSIGN  10778>>ASSIGN  11278<<ASSIGN  11279>>ASSIGN  11279>>ASSIGN  11487<<DOINDEX
     11667<<ASSIGN  11678<<ASSIGN  11679>>IF      11682>>IF      11683>>ASSIGN
I$ IN PROCEDURE CHKMLH
     12023**DCL     12036<<ASSIGN  12037>>DOWHILE 12038<<ASSIGN  12038>>ASSIGN
I$ IN PROCEDURE INSRT
     10856**DCL     11141<<ASSIGN  11142<>CALL    11311<<ASSIGN  11312>>IF      11313>>IF      11314>>IF
     11315>>IF      11316>>IF      11317>>IF      11320>>IF      11321>>IF      11322>>IF      11323>>IF
     11324>>IF      11343>>ASSIGN  11345>>CALL    11357>>ASSIGN  11359>>CALL    11370>>ASSIGN  11371>>ASSIGN
     11372>>ASSIGN  11398<<ASSIGN  11399>>IF      11400>>IF      11401>>IF      11402>>IF      11403>>IF
     11412<<ASSIGN  11510<<ASSIGN  11696>>ASSIGN  11711>>ASSIGN  11712>>ASSIGN  11714>>ASSIGN  11715>>ASSIGN
     11716>>ASSIGN  11724>>ASSIGN  11725>>ASSIGN
I10 IN PROCEDURE INSRT
     11131**LABEL   11538--GOTO    11581--GOTO    11621--GOTO
I12 IN PROCEDURE INSRT
     11193**LABEL   11146--GOTO
I60 IN PROCEDURE INSRT
     11468**LABEL   11604--GOTO
I90 IN PROCEDURE INSRT
     11507**LABEL   11308--GOTO
IL0 IN PROCEDURE INSRT
     11318**LABEL   11327--GOTO
IL10 IN PROCEDURE INSRT
     11351**LABEL   11320--GOTO    11322--GOTO    11324--GOTO
ILOOP IN PROCEDURE INSRT
     11311**LABEL   11337--GOTO    11346--GOTO    11381--GOTO
INS IN PROCEDURE CHKMLH
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:364  
     12018**DCL     12026<<ASSIGN  12039<<ASSIGN  12039>>ASSIGN  12050>>IF
INSMT
     10808**PROC    10700--CALL    11133--CALL
INSMT1 IN PROCEDURE INSMT
     10812**ENTRY   10783--CALL
INSRCVR IN PROCEDURE INSRT
     11156**ENTRY    8960--CALL
INSRT
     10854**PROC     9669--CALL
INSRTD0 IN PROCEDURE INSRT
     11545**ENTRY    8730--CALL
INSRTD1 IN PROCEDURE INSRT
     11589**ENTRY    8735--CALL
INSRTD2 IN PROCEDURE INSRT
     11611**ENTRY    8740--CALL
INSRTD3 IN PROCEDURE INSRT
     11628**ENTRY    8745--CALL
INSRTD4 IN PROCEDURE INSRT
     11654**ENTRY    8750--CALL
INSRTF0 IN PROCEDURE INSRT
     11540**ENTRY    8806--CALL
INSRTF1 IN PROCEDURE INSRT
     11584**ENTRY    8811--CALL
INSRTF2 IN PROCEDURE INSRT
     11606**ENTRY    8816--CALL
INSRTF3 IN PROCEDURE INSRT
     11623**ENTRY    8821--CALL
INSRTG0 IN PROCEDURE INSRT
     11649**ENTRY    9777--CALL
INSUPD IN PROCEDURE INSRT
     11692**PROC    11344--CALL    11358--CALL
INSX IN PROCEDURE INSRT
     11504**LABEL   11134--GOTO
INVALIDATE
     12121**PROC    10704--CALL    10713--CALL    11193--CALL
KCA$TELLAU
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:365  
      8330**DCL-ENT  9235--CALL     9271--CALL     9311--CALL
KCO$ABORTEM
      8331**DCL-ENT  8652--CALL
KQ$CG
      5532**DCL      8559<>CALL     8573<>CALL     8652<>CALL     9137<>CALL     9204<>CALL     9243<>CALL
      9260<>CALL     9292<>CALL     9302<>CALL     9309<>CALL     9345<>CALL     9410<>CALL     9427<>CALL
      9464<>CALL     9478<>CALL     9547<>CALL     9630<>CALL     9702<>CALL    10178<>CALL    10611<>CALL
     10618<>CALL    10692<>CALL    11142<>CALL    11426<>CALL    11754<>CALL    11777<>CALL    11921<>CALL
     11930<>CALL    11981<>CALL    12068<>CALL    12078<>CALL    12089<>CALL    12097<>CALL    12685<>CALL
KQ$CG.AUCTL.AUCONDCB
      5973**DCL      8644<<ASSIGN
KQ$CG.AUCTL.AUCONTERM
      5973**DCL      8646<<ASSIGN
KQ$CG.AUCTL.AUDCONDCB
      5974**DCL      8645<<ASSIGN
KQ$CG.AUCTL.AUDCONTERM
      5973**DCL      8647<<ASSIGN
KQ$CG.AUCTL.DCBCONAU
      5972**DCL      8640<<ASSIGN
KQ$CG.AUCTL.DCBCONLGL
      5979**DCL      8639<<ASSIGN
KQ$CG.AUCTL.DCBCONNAU
      5973**DCL      8641<<ASSIGN
KQ$CG.AUCTL.DVBYTE.REREAD
      5975**DCL      5976--REDEF
KQ$CG.AUCTL.TERMCONAU
      5972**DCL      8642<<ASSIGN
KQ$CG.AUCTL.TERMCONLGL
      5980**DCL      8638<<ASSIGN
KQ$CG.AUCTL.TERMCONNAU
      5973**DCL      8643<<ASSIGN
KQ$CG.BASEDELAY
      5642**DCL      8596<<ASSIGN   8596>>ASSIGN
KQ$CG.DELAY.CGFULL
      5609**DCL      8592<<ASSIGN   8657<<ASSIGN
KQ$CG.DELAY.FIP
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:366  
      5611**DCL      8623>>IF       8630<<ASSIGN   8658<<ASSIGN
KQ$CG.DELMSG$
      5928**DCL      8886>>ASSIGN   8887<<ASSIGN   8919>>ASSIGN   8920<<ASSIGN   9204<>CALL     9212>>ASSIGN
      9214<<ASSIGN
KQ$CG.DTREE.GATE
      6117**DCL      8636<>CALL     8649<>CALL
KQ$CG.GARB
      5665**DCL     11917--ASSIGN  11927<<ASSIGN  11927>>ASSIGN  11928--ASSIGN
KQ$CG.GARB.ACTCNT
      5692**DCL      9397<<ASSIGN   9415>>IF       9515<<ASSIGN   9552>>IF
KQ$CG.GARB.CCCOUNT
      5737**DCL     11298<<ASSIGN  11465<<ASSIGN  11563>>ASSIGN  11664>>IF      11699<<ASSIGN  11699>>ASSIGN
KQ$CG.GARB.CONERR
      5681**DCL      9683>>IF      10686<<ASSIGN  10753<<ASSIGN
KQ$CG.GARB.DBLK$
      5741**DCL     11159>>ASSIGN  11269<<ASSIGN
KQ$CG.GARB.DELAY
      5667**DCL      8531<<ASSIGN   8693>>IF       8700>>ASSIGN   8701<<ASSIGN   8786>>ASSIGN   8787<<ASSIGN
      8841>>IF       8843>>ASSIGN   8844<<ASSIGN   8878<<ASSIGN   8904<<ASSIGN   9247<<ASSIGN   9264<<ASSIGN
      9319<<ASSIGN   9343<<ASSIGN   9389<<ASSIGN   9601<<ASSIGN   9620>>IF       9623>>ASSIGN   9624<<ASSIGN
      9764>>ASSIGN   9765<<ASSIGN   9878<<ASSIGN  10616<<ASSIGN  10627<<ASSIGN  11646<<ASSIGN  11762<<ASSIGN
     11775<<ASSIGN
KQ$CG.GARB.DELJ
      5685**DCL      9221<<ASSIGN   9225<<ASSIGN   9353>>IF
KQ$CG.GARB.DMIP
      5674**DCL      8914>>IF       8968<<ASSIGN   9227<<ASSIGN   9233<<ASSIGN   9279<<ASSIGN   9352<<ASSIGN
KQ$CG.GARB.INDX
      5694**DCL      9287<<ASSIGN   9294>>IF       9296>>ASSIGN   9314<<ASSIGN   9314>>ASSIGN
KQ$CG.GARB.INSRT
      5678**DCL      9664<<ASSIGN   9671>>IF       9685<<ASSIGN  11264>>IF      11305>>IF
KQ$CG.GARB.JNLD$
      5697**DCL      8569>>IF       8880>>IF       8882>>ASSIGN   8887>>ASSIGN   8888<<ASSIGN   9220>>IF
      9222>>ASSIGN   9223<<ASSIGN   9349>>ASSIGN   9350<<ASSIGN
KQ$CG.GARB.MBLK$
      5709**DCL      8914>>IF       8917>>ASSIGN   8918<<ASSIGN   9226<<ASSIGN   9238<<ASSIGN   9280<<ASSIGN
      9288>>ASSIGN   9331>>ASSIGN   9348>>ASSIGN   9351<<ASSIGN   9357>>ASSIGN   9360>>ASSIGN   9363>>ASSIGN
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:367  
      9367>>ASSIGN   9668<<ASSIGN   9672>>ASSIGN   9680<<ASSIGN   9806>>ASSIGN   9814>>ASSIGN  11158>>ASSIGN
     11773<<ASSIGN
KQ$CG.GARB.NCDDA
      5723**DCL     11283<<ASSIGN  11302<<ASSIGN  11303>>IF      11307>>IF      11410>>IF      11426<>CALL
     11437>>ASSIGN  11466>>IF      11473>>ASSIGN  11507>>IF      11519>>ASSIGN  11603<<ASSIGN
KQ$CG.GARB.NCSTAMP
      5720**DCL     11284<<ASSIGN  11434>>ASSIGN  11474>>ASSIGN  11520>>ASSIGN
KQ$CG.GARB.OMLH$
      5711**DCL      9404<<ASSIGN   9411>>ASSIGN   9538<<ASSIGN   9548>>ASSIGN   9630<>CALL     9702<>CALL
      9801>>ASSIGN   9809>>ASSIGN
KQ$CG.GARB.PCSTAMP
      5734**DCL     11460<<ASSIGN  11518<<ASSIGN  11671>>ASSIGN
KQ$CG.GARB.RECYCLE
      5676**DCL      9637<<ASSIGN   9670>>IF       9682>>IF      10814<<ASSIGN
KQ$CG.GARB.RELCNT
      5732**DCL      8538<<ASSIGN  12686<<ASSIGN  12686>>ASSIGN
KQ$CG.GARB.SCDDA
      5725**DCL     11441<<ASSIGN  11453>>ASSIGN  11461>>ASSIGN  11468>>ASSIGN  11478>>ASSIGN  11574>>ASSIGN
     11578>>ASSIGN
KQ$CG.GARB.SCSTAMP
      5727**DCL     11442<<ASSIGN  11454>>ASSIGN  11462>>ASSIGN  11469>>ASSIGN  11575>>ASSIGN
KQ$CG.GARB.SPHD$
      5714**DCL     11268<<ASSIGN  11406>>IF      11408<<ASSIGN  11415>>IF      11423<>CALL    11488>>ASSIGN
     11490<<ASSIGN  11565>>ASSIGN  11570>>ASSIGN  11571<<ASSIGN  11637>>ASSIGN  11642>>ASSIGN  11643<<ASSIGN
     11713>>IF      11714<<ASSIGN
KQ$CG.GARB.SPLITCNT
      5718**DCL     11266<<ASSIGN  11417>>ASSIGN  11421>>ASSIGN  11463>>ASSIGN  11485>>ASSIGN  11491<<ASSIGN
     11491>>ASSIGN  11495>>IF      11717<<ASSIGN  11717>>ASSIGN
KQ$CG.GARB.SPSTATE
      5730**DCL      8923>>IF       8956>>IF      11160>>DOCASE  11204<<ASSIGN  11285>>IF      11296<<ASSIGN
     11393<<ASSIGN  11420<<ASSIGN  11443<<ASSIGN  11451<<ASSIGN  11455<<ASSIGN  11476<<ASSIGN  11479<<ASSIGN
     11484<<ASSIGN  11504<<ASSIGN  11572<<ASSIGN  11644<<ASSIGN
KQ$CG.GARB.SPTL$
      5716**DCL     11407>>ASSIGN  11715>>ASSIGN  11716<<ASSIGN
KQ$CG.GARB.SQHD$
      5739**DCL     11267<<ASSIGN  11395>>IF      11399>>IF      11400>>IF      11401>>IF      11402>>IF
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:368  
     11403>>IF      11407>>ASSIGN  11408>>ASSIGN  11724>>ASSIGN  11725<<ASSIGN
KQ$CG.GARB.SQIP
      5683**DCL      8922>>IF       8954>>IF       8967<<ASSIGN   9627<<ASSIGN   9737<<ASSIGN
KQ$CG.GARB.STA
      5671**DCL      8926>>IF       9409<<ASSIGN   9546<<ASSIGN   9706>>IF       9739>>IF       9799>>IF
      9824>>IF       9856>>IF
KQ$CG.GARB.TCOUNT
      5703**DCL     11195<<ASSIGN  11295<<ASSIGN  11295>>ASSIGN  11299>>IF      11301>>IF      11439<<ASSIGN
     11439>>ASSIGN  11563<<ASSIGN  11563>>ASSIGN  11664>>IF      11678>>ASSIGN  11680>>ASSIGN  11697<<ASSIGN
     11697>>ASSIGN
KQ$CG.GARB.TYPE
      5689**DCL      8537<<ASSIGN   8544<<ASSIGN   8544>>ASSIGN   8555<<ASSIGN   8555>>ASSIGN   8556>>IF
      8567>>IF       8570>>IF       8709>>IF       9400>>IF       9518>>IF       9638>>DOCASE
KQ$CG.GATE.CG
      5922**DCL      8590<>CALL     8594<>CALL     8621<>CALL     8626<>CALL     8632<>CALL     8655<>CALL
      8660<>CALL     8691<>CALL     8696<>CALL     8703<>CALL
KQ$CG.GATE.MISC
      5924**DCL      9210<>CALL     9216<>CALL
KQ$CG.GORGOSTA$
      6031**DCL      9235>>CALL     9271>>CALL     9311>>CALL
KQ$CG.MMD.GATE
      5543**DCL      8526<>CALL     8534<>CALL
KQ$CG.MMD.GFORCE
      5566**DCL      8447<<ASSIGN   8570>>IF
KQ$CG.MMD.GIP
      5564**DCL      8523>>IF       8530<<ASSIGN   8689>>IF       8841>>IF       8912>>IF       8952>>IF
      8966<<ASSIGN   9620>>IF
KQ$CG.MMD.MBLKHD$
      5582**DCL      8907<<ASSIGN
KQ$CG.MMD.STAHD$
      5579**DCL      8906<<ASSIGN
KQ$CG.QISS
      5918**DCL      8547>>IF       9422>>IF
KQ$CG.QUEUE.BUSY
      5777**DCL      9383>>IF
KQ$CG.QUEUE.BUSY.GIP
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:369  
      5782**DCL      8935<<ASSIGN   9384>>IF       9396<<ASSIGN   9447<<ASSIGN   9456<<ASSIGN
KQ$CG.QUEUE.BUSY.RIP
      5780**DCL      9437>>IF
KQ$CG.QUEUE.GACT
      5785**DCL      8936<<ASSIGN   9382<<ASSIGN   9448<<ASSIGN   9457<<ASSIGN
KQ$CG.QUEUE.MLH$
      5799**DCL      9441>>ASSIGN
KQ$CG.QUEUE.PLHD$
      5765**DCL      8898>>ASSIGN   9398>>ASSIGN
KQ$CG.QUEUE.QTREE$
      5754**DCL      9380>>CALL     9391>>CALL     9397>>ASSIGN   9407>>CALL     9413>>CALL     9415>>IF
      9450>>CALL     9459>>CALL     9492>>CALL     9497>>CALL     9812>>CALL     9833>>CALL     9867>>CALL
      9870>>CALL
KQ$CG.QUEUE.RQGC
      5789**DCL      9386>>IF       9439>>IF       9443<<ASSIGN
KQ$CG.QUEUE.RQMEM
      5787**DCL      9386>>IF       9454>>IF
KQ$CG.QUEUE.RUSR#
      5774**DCL      9444>>IF
KQ$CG.RCVR
      5906**DCL     12053>>IF
KQ$CG.STATS.GARBCOLLS
      6026**DCL      8541<<ASSIGN   8541>>ASSIGN
KQ$CG.STREE.ACTCNT
      5879**DCL      9515>>ASSIGN   9552>>IF
KQ$CG.STREE.GATE
      5866**DCL      9513<>CALL     9544<>CALL     9550<>CALL     9558<>CALL
KQ$CG.STREE.HEAD$
      5874**DCL      8891>>ASSIGN   9516>>ASSIGN
KQ$CG.TTREE.GATE
      5827**DCL      9471<>CALL     9484<>CALL
KQ$CG.TTREE.HEAD$
      5835**DCL      9473>>ASSIGN
KQ$DBLK
      7060**DCL      9296--ASSIGN  10502--ASSIGN  11272--ASSIGN  11275--ASSIGN  11973--ASSIGN  11978<<ASSIGN
     11978>>ASSIGN  11979--ASSIGN
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:370  
KQ$DBLK.DSIZE
      7065**DCL      9294>>IF      10518<<ASSIGN  11272>>ASSIGN  11274>>ASSIGN  11695<<ASSIGN  11695>>ASSIGN
KQ$DBLK.FLNKDA
      7067**DCL      9322>>IF       9326>>ASSIGN  10709<<ASSIGN  11283>>ASSIGN  11437<<ASSIGN  11453<<ASSIGN
KQ$DBLK.MBLK
      7085**DCL     10516<<ASSIGN
KQ$DBLK.SIZW
      7094**DCL     10514>>ASSIGN  10708>>ASSIGN  11433>>ASSIGN  11952>>ASSIGN
KQ$DBLK.STAMP
      7061**DCL     10517<<ASSIGN
KQ$DFRBLK.DBLK$
      7637**DCL      7639--REDEF
KQ$DFRBLK.INFO
      7645**DCL      7647--REDEF
KQ$DFRBLK.INFO$
      7647**DCL      9344<<ASSIGN  10615<<ASSIGN  11774<<ASSIGN
KQ$DFRPARM.DBLK$
      7591**DCL      7593--REDEF    8783>>ASSIGN   9761>>ASSIGN
KQ$DFRPARM.DDA
      7595**DCL      9763>>ASSIGN
KQ$DFRPARM.ERR
      7599**DCL      8784>>ASSIGN   9771>>IF
KQ$DFRPARM.INFO
      7587**DCL      7589--REDEF
KQ$DFRPARM.INFO$
      7589**DCL      8785>>ASSIGN   9762>>ASSIGN
KQ$MBLK
      6608**DCL      9235<>CALL     9237<>CALL     9271<>CALL     9273<>CALL     9278<>CALL     9308--ASSIGN
      9310<<ASSIGN   9310>>ASSIGN   9311<>CALL     9314--ASSIGN   9452<>CALL     9717<>CALL    10191<<ASSIGN
     10197<>CALL    10505<<ASSIGN  10505>>ASSIGN  10508--ASSIGN  10511--ASSIGN  10512--ASSIGN  10513--ASSIGN
     10514--ASSIGN  10515<<ASSIGN  10518--ASSIGN  10610--ASSIGN  10704<>CALL    10708--ASSIGN  10713<>CALL
     10735<>CALL    10840<>CALL    11193<>CALL    11273--ASSIGN  11274--ASSIGN  11278--ASSIGN  11325--ASSIGN
     11343<<ASSIGN  11343>>ASSIGN  11345<>CALL    11356<>CALL    11357<<ASSIGN  11357>>ASSIGN  11359<>CALL
     11367--ASSIGN  11368>>ASSIGN  11369<>CALL    11370<<ASSIGN  11370>>ASSIGN  11372<<ASSIGN  11380--ASSIGN
     11433--ASSIGN  11492<>CALL    11695--ASSIGN  11703--ASSIGN  11917--ASSIGN  11929<<ASSIGN  11929>>ASSIGN
     11952--ASSIGN  11973--ASSIGN  11980<<ASSIGN  11980>>ASSIGN
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:371  
KQ$MBLK.CCSTAMP
      6854**DCL      9284<<ASSIGN   9291>>ASSIGN   9325<<ASSIGN   9325>>ASSIGN  10710<<ASSIGN  11197<<ASSIGN
     11203>>ASSIGN  11284>>ASSIGN  11434<<ASSIGN  11449>>ASSIGN  11454<<ASSIGN  11460>>ASSIGN  11462<<ASSIGN
     11518>>ASSIGN  11520<<ASSIGN
KQ$MBLK.COUNT
      6848**DCL     10724<<ASSIGN  10724>>ASSIGN  10724>>ASSIGN  10776>>ASSIGN  10777<<ASSIGN  11299>>IF
     11301>>IF      11440<<ASSIGN  11440>>ASSIGN  11667>>ASSIGN  11668<<ASSIGN  11678>>ASSIGN  11680<<ASSIGN
     11698<<ASSIGN  11698>>ASSIGN  12035>>ASSIGN
KQ$MBLK.DDA
      6673**DCL      9231>>IF       9242>>ASSIGN   9256>>IF       9259>>ASSIGN   9276>>IF       9286>>ASSIGN
      9289>>ASSIGN   9298>>ASSIGN   9304<<ASSIGN  10698>>IF      10709>>ASSIGN  10714>>ASSIGN  10715>>ASSIGN
     10782<<ASSIGN  11131>>IF      11142<>CALL    11196>>ASSIGN  11666<<ASSIGN  11953>>IF
KQ$MBLK.FIRSTX
      6837**DCL      9297>>ASSIGN  11276>>IF      11279>>ASSIGN  11280<<ASSIGN
KQ$MBLK.INSHD$
      6827**DCL      9254>>DOWHILE  9255>>ASSIGN   9269<<ASSIGN  10654>>IF      10655<<ASSIGN  10658>>ASSIGN
     10695>>IF      10695>>IF      10815>>IF      10817>>ASSIGN  10825>>ASSIGN  10826>>ASSIGN  11137>>IF
     11311>>ASSIGN  11371<<ASSIGN  11397>>DOWHILE 11398>>ASSIGN  11411>>DOWHILE 11412>>ASSIGN  11502>>IF
     11509>>DOWHILE 11510>>ASSIGN  11569>>ASSIGN  11570<<ASSIGN  11641>>ASSIGN  11642<<ASSIGN  11696<<ASSIGN
     11711<<ASSIGN  12036>>ASSIGN
KQ$MBLK.KEY1
      6636**DCL      6638--REDEF   10493>>ASSIGN  10506>>IF
KQ$MBLK.KEY1VALID
      6795**DCL      9285>>IF       9289>>IF      11953>>IF
KQ$MBLK.KEY2
      6645**DCL      6663--REDEF   10494>>ASSIGN  10507>>IF
KQ$MBLK.LCSTAMP
      6852**DCL     10706>>ASSIGN  10729<<ASSIGN  10729>>ASSIGN  11469<<ASSIGN  11671<<ASSIGN
KQ$MBLK.LNK$
      6610**DCL      6612--REDEF    6618--REDEF    6622--REDEF    8883>>DOWHILE  8884>>ASSIGN   8886<<ASSIGN
      8919<<ASSIGN   9151>>ASSIGN   9214>>ASSIGN   9223>>ASSIGN   9269>>ASSIGN   9349<<ASSIGN   9648>>ASSIGN
      9651>>ASSIGN   9656>>ASSIGN   9674>>ASSIGN  10184>>ASSIGN  10185>>ASSIGN  10187<<ASSIGN  10196>>ASSIGN
     10509>>ASSIGN  10549>>ASSIGN  10564>>ASSIGN  10568>>IF      10569>>ASSIGN  10651<<ASSIGN  10651>>ASSIGN
     10652>>IF      10653<<ASSIGN  10659>>DOWHILE 10660>>ASSIGN  10662<<ASSIGN  10687>>ASSIGN  10730<<ASSIGN
     10730>>ASSIGN  10731>>IF      10758>>ASSIGN  10764>>ASSIGN  10789>>ASSIGN  10795>>ASSIGN  10818>>DOWHILE
     10819>>ASSIGN  10821<<ASSIGN  10821>>ASSIGN  10822>>IF      10826<<ASSIGN  10831>>ASSIGN  10832<<ASSIGN
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:372  
     10832>>ASSIGN  10833>>IF      11371>>ASSIGN  11407<<ASSIGN  11490>>ASSIGN  11566>>DOWHILE 11567>>ASSIGN
     11569<<ASSIGN  11638>>DOWHILE 11639>>ASSIGN  11641<<ASSIGN  11696>>ASSIGN  11711>>ASSIGN  11712<<ASSIGN
     11715<<ASSIGN  11724<<ASSIGN  12006>>ASSIGN  12038>>ASSIGN  12043>>ASSIGN  12111>>IF      12112>>ASSIGN
KQ$MBLK.PCDDA
      6859**DCL      9283<<ASSIGN   9324<<ASSIGN  10723<<ASSIGN  11194<<ASSIGN  11435<<ASSIGN  11459<<ASSIGN
     11478<<ASSIGN  11517<<ASSIGN  11577<<ASSIGN  11662>>IF      11672>>ASSIGN  11957>>IF      11961<<ASSIGN
     11961>>ASSIGN  11966>>IF      11966>>IF
KQ$MBLK.PCVALID
      6806**DCL     10722<<ASSIGN  11436<<ASSIGN  11956>>IF      11960<<ASSIGN
KQ$MBLK.PRIO
      6626**DCL     10495>>ASSIGN  10511>>ASSIGN  10665>>ASSIGN  11313>>IF      11314>>IF      11320>>IF
     11320>>IF      11321>>IF      11321>>IF      11375>>ASSIGN  11399>>IF      11399>>IF      11400>>IF
     11400>>IF
KQ$MBLK.PRIOLO
      6822**DCL     10665<<ASSIGN  10725<<ASSIGN  10725>>ASSIGN  11313>>IF      11314>>IF      11375<<ASSIGN
KQ$MBLK.SDA.CCDDA
      6643**DCL      9286<<ASSIGN   9290>>ASSIGN   9324>>ASSIGN   9326<<ASSIGN  10714<<ASSIGN  11196<<ASSIGN
     11202>>ASSIGN  11426<>CALL    11435>>ASSIGN  11448>>ASSIGN  11459>>ASSIGN  11461<<ASSIGN  11517>>ASSIGN
     11519<<ASSIGN  11577>>ASSIGN  11578<<ASSIGN  11953>>IF
KQ$MBLK.SDA.LDA
      6640**DCL     10705>>ASSIGN  10723>>ASSIGN  10728<<ASSIGN  10728>>ASSIGN  11468<<ASSIGN  11672<<ASSIGN
KQ$MBLK.STA$
      6830**DCL      6833--REDEF    6837--REDEF
KQ$MBLK.STAMP
      6630**DCL      9241>>ASSIGN   9258>>ASSIGN   9284>>ASSIGN   9301>>ASSIGN  10497>>ASSIGN  10513>>ASSIGN
     10710>>ASSIGN  10712>>ASSIGN  11197>>ASSIGN  11317>>IF      11324>>IF      11324>>IF      11377>>ASSIGN
     11403>>IF      11403>>IF
KQ$MBLK.STATE
      6818**DCL      9145>>IF       9149<<ASSIGN  10576>>IF      12004>>IF      12005>>IF
KQ$MBLK.SUPER
      6689**DCL      9144>>IF       9229>>IF       9648>>IF       9653>>IF       9666>>IF      10538>>IF
     10561>>IF      10570>>IF      12003>>IF      12032>>IF
KQ$MBLK.USR
      6801**DCL      6806--REDEF    9444>>IF
KQ$MBLK.USR#
      6833**DCL      9444>>IF
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:373  
KQ$MBLK.UTS
      6680**DCL     10496>>ASSIGN  10512>>ASSIGN  10664>>ASSIGN  11315>>IF      11316>>IF      11322>>IF
     11322>>IF      11323>>IF      11323>>IF      11376>>ASSIGN  11401>>IF      11401>>IF      11402>>IF
     11402>>IF
KQ$MBLK.UTSHI
      6824**DCL     10664<<ASSIGN  10726<<ASSIGN  10726>>ASSIGN  11315>>IF      11316>>IF      11376<<ASSIGN
KQ$MBLK.UTSXTHI
      6846**DCL     10727<<ASSIGN  10727>>ASSIGN  11317>>IF      11377<<ASSIGN
KQ$MBLK.XSP.MREQ$
      6665**DCL      6669--REDEF
KQ$MLH
      6879**DCL     11925>>ASSIGN
KQ$MLH.BUSY
      6895**DCL      9595>>IF
KQ$MLH.BUSY.GIP
      6900**DCL      8929<<ASSIGN   9596>>IF       9605<<ASSIGN   9715<<ASSIGN   9722<<ASSIGN
KQ$MLH.BUSY.RIP
      6898**DCL      9708>>IF
KQ$MLH.COUNT
      6926**DCL     10778<<ASSIGN  10778>>ASSIGN  11682>>IF      11683<<ASSIGN  11683>>ASSIGN  12050>>IF
KQ$MLH.DELAY$
      6887**DCL     12045>>IF      12048<>CALL
KQ$MLH.GACT
      6905**DCL      8930<<ASSIGN   9594<<ASSIGN   9714<<ASSIGN   9721<<ASSIGN
KQ$MLH.HEAD$
      6883**DCL      9646>>ASSIGN   9663>>ASSIGN  10535>>ASSIGN  10559>>ASSIGN  10562>>IF      10825<<ASSIGN
     10831<<ASSIGN  12001>>ASSIGN  12030>>ASSIGN  12108>>IF      12109>>ASSIGN
KQ$MLH.RQGC
      6911**DCL      9598>>IF       9710>>IF       9713<<ASSIGN
KQ$MLH.RQMEM
      6909**DCL      9598>>IF       9719>>IF
KQ$MLH.SUPERCNT
      6924**DCL     10190<<ASSIGN  10190>>ASSIGN  10733<<ASSIGN  10733>>ASSIGN  10836<<ASSIGN  10836>>ASSIGN
     12000>>IF      12050>>IF
KQ$MLH.TAIL$
      6885**DCL     10189<<ASSIGN  10652<<ASSIGN  10732<<ASSIGN  10823<<ASSIGN  10834<<ASSIGN
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:374  
KQ$MLH IN PROCEDURE RCVMLH
      8989**DCL      8973--PROC     9117--ASSIGN   9132<<ASSIGN
KQ$MLH.B03 IN PROCEDURE RCVMLH
      9025**DCL      9119>>IF
KQ$MLH.BUSY IN PROCEDURE RCVMLH
      9005**DCL      9155<<ASSIGN
KQ$MLH.BUSY.RIP IN PROCEDURE RCVMLH
      9008**DCL      9139>>IF
KQ$MLH.DELAY$ IN PROCEDURE RCVMLH
      8997**DCL      9136<>CALL
KQ$MLH.DELAYDQ$ IN PROCEDURE RCVMLH
      9038**DCL      9136<>CALL
KQ$MLH.GACT IN PROCEDURE RCVMLH
      9015**DCL      9156<<ASSIGN
KQ$MLH.HEAD$ IN PROCEDURE RCVMLH
      8993**DCL      9142>>ASSIGN
KQ$MLH.PCSTAMP IN PROCEDURE RCVMLH
      9030**DCL      9158<<ASSIGN
KQ$MLH.RQGC IN PROCEDURE RCVMLH
      9021**DCL      9160<<ASSIGN
KQ$MLH.RQMEM IN PROCEDURE RCVMLH
      9019**DCL      9159<<ASSIGN
KQ$MLH.RUSR# IN PROCEDURE RCVMLH
      9002**DCL      9157<<ASSIGN
KQ$MLHB02.BUSY
      7947**DCL      9129>>IF
KQ$MLHB02.COUNT
      7987**DCL      9125>>ASSIGN
KQ$MLHB02.DELETE
      7954**DCL      9127>>ASSIGN
KQ$MLHB02.DWHD$
      7944**DCL      9124>>ASSIGN
KQ$MLHB02.HEAD$
      7940**DCL      9122>>ASSIGN
KQ$MLHB02.QUEUE
      7951**DCL      9126>>ASSIGN
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:375  
KQ$MLHB02.SUPERCNT
      7985**DCL      9128>>ASSIGN
KQ$MLHB02.TAIL$
      7942**DCL      9123>>ASSIGN
KQ$MTYP.BTN.FLINK$
      6978**DCL      9477>>ASSIGN   9481>>ASSIGN
KQ$MTYP.PERM
      6996**DCL      9424>>IF       9475>>IF
KQ$NRMLMBLK.DVE.EOMCHAR
      7767**DCL      7769--REDEF
KQ$NRMLMBLK.JRNLD
      7757**DCL      9234>>IF       9270>>IF       9306>>IF       9312<<ASSIGN
KQ$NRMLMBLK.KEY1
      7693**DCL      7695--REDEF
KQ$NRMLMBLK.KEY2
      7702**DCL      7720--REDEF
KQ$NRMLMBLK.LNK$
      7667**DCL      7669--REDEF    7675--REDEF    7679--REDEF
KQ$NRMLMBLK.RBLK
      7806**DCL     10538>>IF
KQ$NRMLMBLK.TYC
      7816**DCL      7818--REDEF
KQ$NRMLMBLK.XSP.MREQ$
      7722**DCL      7726--REDEF
KQ$QTN.CNACT
      7456**DCL      9400>>IF       9418>>IF
KQ$QTN.LOCKCNT
      7475**DCL      8934<<ASSIGN   8934>>ASSIGN   9405<<ASSIGN   9405>>ASSIGN   9418>>IF       9733<<ASSIGN
      9733>>ASSIGN
KQ$QTN.MLH
      7517**DCL      8900<>CALL     9810--ASSIGN
KQ$QTN.MLH.COUNT
      7562**DCL      9402>>IF       9417>>IF
KQ$QTN.MXACT
      7459**DCL      7461--REDEF
KQ$QTN.PLINK$
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:376  
      7468**DCL      8901>>ASSIGN   9426>>ASSIGN   9433>>ASSIGN
KQ$QTN.READS$
      7462**DCL      9418>>IF
KQ$QTN.STA.ACTTYC
      7181**DCL      7185--REDEF
KQ$QTN.STA.DCBLNK$
      7188**DCL      7191--REDEF    7195--REDEF
KQ$QTN.STA.EVCNT
      7274**DCL      7277--REDEF
KQ$QTN.STA.EVNT
      7240**DCL      7244--REDEF    7247--REDEF
KQ$QTN.STA.OPNBLKED
      7301**DCL      7304--REDEF
KQ$QTN.STA.OPNREJ
      7307**DCL      7309--REDEF
KQ$QTN.STA.SUCCREAD
      7230**DCL      7234--REDEF
KQ$QTN.STA.TCOUNT
      7359**DCL      7365--REDEF
KQ$QTN.STA.VGOT$
      7344**DCL      7348--REDEF    7352--REDEF
KQ$STA
      6270**DCL      8894<>CALL     9235<>CALL     9271<>CALL     9311<>CALL     9527<>CALL     9528<>CALL
      9728<>CALL     9729<>CALL
KQ$STA.ACTTYC
      6322**DCL      6326--REDEF
KQ$STA.BTN.FLINK$
      6304**DCL      8895>>ASSIGN   9555>>ASSIGN
KQ$STA.DCBLNK$
      6329**DCL      6332--REDEF    6336--REDEF
KQ$STA.EVCNT
      6415**DCL      6418--REDEF
KQ$STA.EVNT
      6381**DCL      6385--REDEF    6388--REDEF
KQ$STA.GATE
      6348**DCL      9523<>CALL     9533<>CALL     9541<>CALL     9804<>CALL     9827<>CALL     9859<>CALL
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:377  
      9862<>CALL
KQ$STA.IDSC
      6350**DCL      9525>>IF
KQ$STA.LDCT$
      6311**DCL      9518>>IF
KQ$STA.LOCKCNT
      6404**DCL      8928<<ASSIGN   8928>>ASSIGN   9539<<ASSIGN   9539>>ASSIGN
KQ$STA.MLH
      6538**DCL      8893<>CALL     9802--ASSIGN
KQ$STA.MLH.COUNT
      6583**DCL      9530>>IF
KQ$STA.MONDCB
      6354**DCL      9520>>IF
KQ$STA.OPNBLKED
      6442**DCL      6445--REDEF
KQ$STA.OPNREJ
      6448**DCL      6450--REDEF
KQ$STA.SUCCREAD
      6371**DCL      6375--REDEF
KQ$STA.TCOUNT
      6500**DCL      6506--REDEF
KQ$STA.TERM
      6366**DCL      9527>>IF
KQ$STA.VGOT$
      6485**DCL      6489--REDEF    6493--REDEF
KQ$THDR.ACTCNT
      7040**DCL      9397>>ASSIGN   9415>>IF
KQ$THDR.GATE
      7027**DCL      9380<>CALL     9391<>CALL     9407<>CALL     9413<>CALL     9450<>CALL     9459<>CALL
      9492<>CALL     9497<>CALL     9812<>CALL     9833<>CALL     9867<>CALL     9870<>CALL
KQ$TMLH IN PROCEDURE RCVMLH
      9059**DCL      9121<<ASSIGN   9132>>ASSIGN
KQ$TMLH.BUSY.RIP IN PROCEDURE RCVMLH
      9078**DCL      9130<<ASSIGN
KQ$TMLH.COUNT IN PROCEDURE RCVMLH
      9106**DCL      9125<<ASSIGN
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:378  
KQ$TMLH.DELAY$ IN PROCEDURE RCVMLH
      9067**DCL      9124<<ASSIGN
KQ$TMLH.HEAD$ IN PROCEDURE RCVMLH
      9063**DCL      9122<<ASSIGN
KQ$TMLH.QUEUE IN PROCEDURE RCVMLH
      9082**DCL      9126<<ASSIGN
KQ$TMLH.SUPERCNT IN PROCEDURE RCVMLH
      9104**DCL      9128<<ASSIGN
KQ$TMLH.TAIL$ IN PROCEDURE RCVMLH
      9065**DCL      9123<<ASSIGN
KQD$DEFERGO
      8332**DCL-ENT  9345--CALL    10618--CALL    11777--CALL
KQD$DELDDA
      8333**DCL-ENT  9243--CALL     9260--CALL     9302--CALL
KQD$DELETE
      8334**DCL-ENT 12068--CALL
KQD$ERRLOG
      8335**DCL-ENT 11930--CALL    11981--CALL
KQD$FETCH
      8336**DCL-ENT  9292--CALL    11754--CALL
KQD$GET
      8337**DCL-ENT 10611--CALL
KQD$UNLOCK
      8338**DCL-ENT 12089--CALL
KQD$UPDATE
      8339**DCL-ENT 12097--CALL
KQD$UPDATED
      8340**DCL-ENT 12078--CALL
KQG$TRUNC
      8341**DCL-ENT  9527--CALL
KQL$COUNTDLY
      8342**DCL-ENT 12048--CALL
KQL$DELMLHR
      8343**DCL-ENT  9137--CALL
KQL$GARBDUNQ
      8344**DCL-ENT  9464--CALL
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:379  
KQL$GARBDUNS
      8345**DCL-ENT  9728--CALL
KQL$GARBDUNSR
      8346**DCL-ENT  8894--CALL
KQL$RCVRDLY
      8347**DCL-ENT  9136--CALL
KQL$SRQ
      8348**DCL-ENT  9452--CALL     9717--CALL
KQM$GARBDONE
      8349**DCL-ENT  8559--CALL     8573--CALL
KQM$GETB
      8350**DCL-ENT  9309--CALL
KQM$RELMBLK
      8351**DCL-ENT 12685--CALL
KQP$UNLOCK
      8352**DCL-ENT  9729--CALL
KQR$TRUNC
      8353**DCL-ENT  9528--CALL
KQS$FCONT
      8780**ENTRY    9345--CALL    11777--CALL
KQS$GCONT
      9758**ENTRY   10618--CALL
KQS$SQUISH
      9589**ENTRY    9410--CALL     9547--CALL
KQT$DELTYP
      8354**DCL-ENT  9427--CALL     9478--CALL
KQX$SLIDE
      8355**DCL-ENT 11356--CALL    11369--CALL
KQZ$LOG
      8356**DCL-ENT  9204--CALL     9630--CALL     9702--CALL    10178--CALL    10692--CALL    11142--CALL
     11426--CALL    11921--CALL
KQ_BASEDELAY
      2896**DCL      8597<<ASSIGN   8597>>ASSIGN
KQ_DEBUG
      2898**DCL      9635>>IF      10193>>IF      10780>>IF      10838>>IF      11500>>IF      11685>>IF
     11909>>IF
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:380  
KQ_ERRLOG_BFR.CODE
      8363**DCL     11916<<ASSIGN  11972<<ASSIGN
KQ_ERRLOG_BFR.INFO
      8364**DCL     11918<<ASSIGN  11919--ASSIGN  11974<<ASSIGN  11975--ASSIGN
KQ_ERRLOG_BFR.SIZ
      8364**DCL     11917<<ASSIGN  11973<<ASSIGN
KQ_ERRLOG_GATE
      2928**DCL     11914<>CALL    11970<>CALL
KQ_IMBLK.DVE.EOMCHAR
      3560**DCL      3562--REDEF
KQ_IMBLK.KEY1
      3486**DCL      3488--REDEF
KQ_IMBLK.KEY2
      3495**DCL      3513--REDEF
KQ_IMBLK.LNK$
      3460**DCL      3462--REDEF    3468--REDEF    3472--REDEF
KQ_IMBLK.TYC
      3609**DCL      3611--REDEF
KQ_IMBLK.XSP.MREQ$
      3515**DCL      3519--REDEF
KQ_IMLH
      3389**DCL      9121>>ASSIGN
KQ_IRBLK.BUF$
      3064**DCL      3066--REDEF
KQ_IRBLK.CNACTD
      2978**DCL      2987--REDEF
KQ_IRBLK.DBLKX
      3084**DCL      3088--REDEF
KQ_IRBLK.EOFNONE
      2956**DCL      2959--REDEF
KQ_IRBLK.FROMQ
      2962**DCL      2965--REDEF
KQ_IRBLK.KEY1R
      3003**DCL      3004--REDEF
KQ_IRBLK.KEY2R
      3008**DCL      3009--REDEF
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:381  
KQ_IRBLK.LATCH
      2951**DCL      2953--REDEF
KQ_IRBLK.LWRITES$
      3095**DCL      3099--REDEF
KQ_IRBLKT.CNACTD
      3164**DCL      3173--REDEF
KQ_IRBLKT.DBLK$
      3227**DCL      3231--REDEF    3234--REDEF
KQ_IRBLKT.EOFNONE
      3142**DCL      3145--REDEF
KQ_IRBLKT.FROMQ
      3148**DCL      3151--REDEF
KQ_IRBLKT.KEY1R
      3189**DCL      3190--REDEF
KQ_IRBLKT.KEY2R
      3194**DCL      3195--REDEF
KQ_IRBLKT.LATCH
      3137**DCL      3139--REDEF
KQ_ISMBLK
      8067**DCL     10489>>ASSIGN
KQ_ISMBLK.KEY1
      8095**DCL      8097--REDEF
KQ_ISMBLK.KEY2
      8104**DCL      8122--REDEF
KQ_ISMBLK.LNK$
      8069**DCL      8071--REDEF    8077--REDEF    8081--REDEF
KQ_ISMBLK.STA$
      8289**DCL      8292--REDEF    8296--REDEF
KQ_ISMBLK.USR
      8260**DCL      8265--REDEF
KQ_ISMBLK.XSP.MREQ$
      8124**DCL      8128--REDEF
KQ_LOG.GARB
      2913**DCL      9202>>IF       9628>>IF       9700>>IF      10174>>IF      10688>>IF      11139>>IF
     11424>>IF
KQ_STATS.GARBCOLLS
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:382  
      2906**DCL      8542<<ASSIGN   8542>>ASSIGN
M$
      8040**DCL     11367<<ASSIGN  11368>>ASSIGN  11375>>ASSIGN  11376>>ASSIGN  11377>>ASSIGN
M$ IN PROCEDURE CHKMLH
     12022**DCL     12030<<ASSIGN  12031>>DOWHILE 12032>>IF      12035>>ASSIGN  12036>>ASSIGN  12043<<ASSIGN
     12043>>ASSIGN
MBLK IN PROCEDURE INVALIDATE
     12136**DCL     12121--PROC
MBLK.DDA IN PROCEDURE INVALIDATE
     12201**DCL     12398>>ASSIGN
MBLK.KEY1 IN PROCEDURE INVALIDATE
     12164**DCL     12166--REDEF
MBLK.KEY1ALL IN PROCEDURE INVALIDATE
     12310**DCL     12397<<ASSIGN
MBLK.KEY1VALID IN PROCEDURE INVALIDATE
     12323**DCL     12394>>IF      12396<<ASSIGN
MBLK.KEY2 IN PROCEDURE INVALIDATE
     12173**DCL     12191--REDEF
MBLK.LCSTAMP IN PROCEDURE INVALIDATE
     12380**DCL     12399<<ASSIGN
MBLK.LNK$ IN PROCEDURE INVALIDATE
     12138**DCL     12140--REDEF   12146--REDEF   12150--REDEF
MBLK.SDA.LDA IN PROCEDURE INVALIDATE
     12168**DCL     12398<<ASSIGN
MBLK.STA$ IN PROCEDURE INVALIDATE
     12358**DCL     12361--REDEF   12365--REDEF
MBLK.STAMP IN PROCEDURE INVALIDATE
     12158**DCL     12399>>ASSIGN
MBLK.USR IN PROCEDURE INVALIDATE
     12329**DCL     12334--REDEF
MBLK.XSP.MREQ$ IN PROCEDURE INVALIDATE
     12193**DCL     12197--REDEF
MBLK IN PROCEDURE RELMBLK
     12424**DCL     12409--PROC    12684--ASSIGN
MBLK.DVE.EOMCHAR IN PROCEDURE RELMBLK
     12526**DCL     12528--REDEF
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:383  
MBLK.KEY1 IN PROCEDURE RELMBLK
     12452**DCL     12454--REDEF
MBLK.KEY2 IN PROCEDURE RELMBLK
     12461**DCL     12479--REDEF
MBLK.LNK$ IN PROCEDURE RELMBLK
     12426**DCL     12428--REDEF   12434--REDEF   12438--REDEF
MBLK.TYC IN PROCEDURE RELMBLK
     12575**DCL     12577--REDEF
MBLK.XSP.MREQ$ IN PROCEDURE RELMBLK
     12481**DCL     12485--REDEF
MBLK$
      8027**DCL      6608--IMP-PTR  7665--IMP-PTR  8028--REDEF    8917<<ASSIGN   8919>>ASSIGN   8920>>ASSIGN
      9142<<ASSIGN   9143>>DOWHILE  9144>>IF       9145>>IF       9149>>ASSIGN   9151<<ASSIGN   9151>>ASSIGN
      9212<<ASSIGN   9213>>IF       9214>>ASSIGN   9218>>IF       9222<<ASSIGN   9223>>ASSIGN   9226>>ASSIGN
      9229>>IF       9231>>IF       9234>>IF       9235>>CALL     9237>>CALL     9241>>ASSIGN   9242>>ASSIGN
      9254>>DOWHILE  9255>>ASSIGN   9269>>ASSIGN   9276>>IF       9278>>CALL     9283>>ASSIGN   9284>>ASSIGN
      9284>>ASSIGN   9285>>IF       9286>>ASSIGN   9286>>ASSIGN   9288<<ASSIGN   9289>>IF       9289>>ASSIGN
      9290>>ASSIGN   9291>>ASSIGN   9296<<ASSIGN   9297<<ASSIGN   9297>>ASSIGN   9298>>ASSIGN   9301>>ASSIGN
      9304>>ASSIGN   9306>>IF       9310>>ASSIGN   9312>>ASSIGN   9324>>ASSIGN   9324>>ASSIGN   9325>>ASSIGN
      9326>>ASSIGN   9331<<ASSIGN   9348<<ASSIGN   9349>>ASSIGN   9350>>ASSIGN   9357<<ASSIGN   9360<<ASSIGN
      9363<<ASSIGN   9367<<ASSIGN   9444>>IF       9444>>IF       9452>>CALL     9646<<ASSIGN   9647>>DOWHILE
      9648>>IF       9648<<ASSIGN   9648>>ASSIGN   9651>>ASSIGN   9652<<ASSIGN   9653<<ASSIGN   9658<<ASSIGN
      9663<<ASSIGN   9665>>DOWHILE  9666>>IF       9668>>ASSIGN   9672<<ASSIGN   9674<<ASSIGN   9674>>ASSIGN
      9680>>ASSIGN   9717>>CALL     9806<<ASSIGN   9814<<ASSIGN  10535<<ASSIGN  10537>>DOWHILE 10538>>IF
     10538>>IF      10544>>ASSIGN  10545>>ASSIGN  10549<<ASSIGN  10549>>ASSIGN  10559<<ASSIGN  10560>>IF
     10561>>IF      10562>>IF      10564<<ASSIGN  10564>>ASSIGN  10568>>IF      10569>>ASSIGN  10578<<ASSIGN
     10651>>ASSIGN  10652>>IF      10652>>ASSIGN  10654>>IF      10655>>ASSIGN  10658>>ASSIGN  10664>>ASSIGN
     10665>>ASSIGN  10687>>ASSIGN  10690>>ASSIGN  10695>>IF      10698>>IF      10704>>CALL    10705>>ASSIGN
     10706>>ASSIGN  10717>>ASSIGN  10718<<ASSIGN  10720<<ASSIGN  10723>>ASSIGN  10724>>ASSIGN  10724>>ASSIGN
     10725>>ASSIGN  10726>>ASSIGN  10727>>ASSIGN  10728>>ASSIGN  10729>>ASSIGN  10730>>ASSIGN  10731>>IF
     10732>>ASSIGN  10758>>ASSIGN  10764>>ASSIGN  10772>>ASSIGN  10774<<ASSIGN  10776>>ASSIGN  10777>>ASSIGN
     10782>>ASSIGN  10784<<ASSIGN  10789>>ASSIGN  10795>>ASSIGN  10815>>IF      10817>>ASSIGN  10821>>ASSIGN
     10825>>ASSIGN  10826>>ASSIGN  10831>>ASSIGN  10832>>ASSIGN  10833>>IF      10840>>CALL    11131>>IF
     11137>>IF      11141>>ASSIGN  11142>>CALL    11158<<ASSIGN  11193>>CALL    11194>>ASSIGN  11196>>ASSIGN
     11196>>ASSIGN  11197>>ASSIGN  11197>>ASSIGN  11202>>ASSIGN  11203>>ASSIGN  11299>>IF      11301>>IF
     11311>>ASSIGN  11371>>ASSIGN  11397>>DOWHILE 11398>>ASSIGN  11411>>DOWHILE 11412>>ASSIGN  11426>>CALL
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:384  
     11435>>ASSIGN  11440>>ASSIGN  11440>>ASSIGN  11448>>ASSIGN  11449>>ASSIGN  11459>>ASSIGN  11459>>ASSIGN
     11460>>ASSIGN  11461>>ASSIGN  11462>>ASSIGN  11468>>ASSIGN  11469>>ASSIGN  11502>>IF      11509>>DOWHILE
     11510>>ASSIGN  11517>>ASSIGN  11517>>ASSIGN  11518>>ASSIGN  11519>>ASSIGN  11520>>ASSIGN  11569>>ASSIGN
     11570>>ASSIGN  11577>>ASSIGN  11577>>ASSIGN  11578>>ASSIGN  11641>>ASSIGN  11642>>ASSIGN  11662>>IF
     11666>>ASSIGN  11667>>ASSIGN  11668>>ASSIGN  11671>>ASSIGN  11672>>ASSIGN  11672>>ASSIGN  11678>>ASSIGN
     11680>>ASSIGN  11696>>ASSIGN  11698>>ASSIGN  11698>>ASSIGN  11711>>ASSIGN  11773>>ASSIGN  11920>>ASSIGN
     11929>>ASSIGN  11953>>IF      11953>>IF      11953>>IF      11961>>ASSIGN  11966>>IF      11976>>ASSIGN
     12001<<ASSIGN  12003>>IF      12004>>IF      12005>>IF      12006<<ASSIGN  12006>>ASSIGN  12108>>IF
     12111>>IF
MLH$
      8036**DCL      6879--IMP-PTR  8929>>ASSIGN   8930>>ASSIGN   9117<<ASSIGN   9122>>ASSIGN   9123>>ASSIGN
      9124>>ASSIGN   9125>>ASSIGN   9126>>ASSIGN   9127>>ASSIGN   9128>>ASSIGN   9129>>IF       9137<>CALL
      9339<<ASSIGN   9441<<ASSIGN   9594>>ASSIGN   9595>>IF       9596>>IF       9598>>IF       9598>>IF
      9605>>ASSIGN   9646>>ASSIGN   9663>>ASSIGN   9708>>IF       9710>>IF       9713>>ASSIGN   9714>>ASSIGN
      9715>>ASSIGN   9719>>IF       9721>>ASSIGN   9722>>ASSIGN   9802<<ASSIGN   9810<<ASSIGN  10189>>ASSIGN
     10190>>ASSIGN  10190>>ASSIGN  10535>>ASSIGN  10559>>ASSIGN  10562>>IF      10652>>ASSIGN  10732>>ASSIGN
     10733>>ASSIGN  10733>>ASSIGN  10778>>ASSIGN  10778>>ASSIGN  10823>>ASSIGN  10825>>ASSIGN  10831>>ASSIGN
     10834>>ASSIGN  10836>>ASSIGN  10836>>ASSIGN  11682>>IF      11683>>ASSIGN  11683>>ASSIGN  11924>>IF
     11925>>ASSIGN  12000>>IF      12001>>ASSIGN  12030>>ASSIGN  12045>>IF      12048>>CALL    12050>>IF
     12050>>IF      12108>>IF      12109>>ASSIGN
NFREE IN PROCEDURE INSRT
     10857**DCL     11273<<ASSIGN  11330>>IF      11351>>IF      11702<<ASSIGN  11702>>ASSIGN
NMBLKS
      8041**DCL     10498>>ASSIGN  10504>>DOINDEX 10518>>ASSIGN  10536<<ASSIGN  10541>>IF      10542<<ASSIGN
     10544>>IF      10546<<ASSIGN  10546>>ASSIGN  10547>>IF      10551>>IF      10581<<ASSIGN  10608>>ASSIGN
     11274<<ASSIGN  11278>>ASSIGN  11295>>ASSIGN  11298>>ASSIGN  11318>>IF      11326<<ASSIGN  11326>>ASSIGN
     11356<>CALL    11369>>CALL    11379<<ASSIGN  11379>>ASSIGN  11417<<ASSIGN  11418>>IF      11418<<ASSIGN
     11421<<ASSIGN  11422>>IF      11422<<ASSIGN  11439>>ASSIGN  11440>>ASSIGN  11463<<ASSIGN  11464>>IF
     11464<<ASSIGN  11465>>ASSIGN  11485<<ASSIGN  11486>>IF      11486<<ASSIGN  11487>>DOINDEX
NODBLK IN PROCEDURE INSRT
     11625**LABEL   11419--CALLALT 11651--GOTO
NOFETCH IN PROCEDURE FETCH
     11754**LABEL   11754--CALLALT
NOFETCH0 IN PROCEDURE CONCATS
     10735**LABEL   10707--CALLALT
NOFETCH0 IN PROCEDURE INSRT
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:385  
     11520**LABEL   11205--CALLALT
NOFETCH1 IN PROCEDURE CONCATS
     10764**LABEL   10716--CALLALT
NOFETCH1 IN PROCEDURE INSRT
     11542**LABEL   11450--CALLALT
NOFETCH2 IN PROCEDURE INSRT
     11586**LABEL   11475--CALLALT
NOFETCH3 IN PROCEDURE INSRT
     11608**LABEL   11576--CALLALT
NOGET IN PROCEDURE GATHER
      9875**LABEL    9852--CALLALT
NORM IN PROCEDURE CHKMLH
     12017**DCL     12025<<ASSIGN  12042<<ASSIGN  12042>>ASSIGN  12050>>IF
P$
      8030**DCL     10658<<ASSIGN  10659>>DOWHILE 10660<<ASSIGN  10660>>ASSIGN  10662>>ASSIGN  10773<<ASSIGN
     10824>>IF      10826>>ASSIGN  10830>>IF      10832>>ASSIGN  10834>>ASSIGN  11565<<ASSIGN  11566>>DOWHILE
     11567<<ASSIGN  11567>>ASSIGN  11569>>ASSIGN  11637<<ASSIGN  11638>>DOWHILE 11639<<ASSIGN  11639>>ASSIGN
     11641>>ASSIGN  12107<<ASSIGN  12109<<ASSIGN  12111>>IF      12112<<ASSIGN  12112>>ASSIGN
P$ IN PROCEDURE CHKBLINK
     11950**DCL     11975<<ASSIGN  11976>>ASSIGN  11977<<ASSIGN  11977>>ASSIGN  11978>>ASSIGN  11979<<ASSIGN
     11979>>ASSIGN  11980>>ASSIGN
PARM
      5500**DCL        14--PROC     8446--ASSIGN   8520--ENTRY    8522--ASSIGN   8585--ENTRY    8587--ASSIGN
      8606--ENTRY    8608--ASSIGN   8686--ENTRY    8688--ASSIGN   8780--ENTRY    8782--ASSIGN   8838--ENTRY
      8840--ASSIGN   8875--ENTRY    8877--ASSIGN   8949--ENTRY    8951--ASSIGN   9589--ENTRY    9591--ASSIGN
      9617--ENTRY    9619--ASSIGN   9758--ENTRY    9760--ASSIGN
QTN$
      8044**DCL      7113--IMP-PTR  8898<<ASSIGN   8899>>DOWHILE  8900>>CALL     8901<<ASSIGN   8901>>ASSIGN
      8934>>ASSIGN   8934>>ASSIGN   9398<<ASSIGN   9399>>DOWHILE  9400>>IF       9402>>IF       9404>>ASSIGN
      9405>>ASSIGN   9405>>ASSIGN   9411<<ASSIGN   9417>>IF       9418>>IF       9418>>IF       9418>>IF
      9424>>IF       9426>>ASSIGN   9427<>CALL     9428<<ASSIGN   9433<<ASSIGN   9433>>ASSIGN   9473<<ASSIGN
      9474>>DOWHILE  9475>>IF       9477>>ASSIGN   9478<>CALL     9479<<ASSIGN   9481<<ASSIGN   9481>>ASSIGN
      9733>>ASSIGN   9733>>ASSIGN   9809<<ASSIGN   9810>>ASSIGN
RBBUL IN PROCEDURE INSRT
     11459**LABEL   11172--GOTO
RCBUL IN PROCEDURE INSRT
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:386  
     11395**LABEL   11164--GOTO
RCVDUN
      8968**LABEL    8960--CALLALT
RCVMLH
      8973**PROC     8893--CALL     8900--CALL
RDELD IN PROCEDURE INSRT
     11572**LABEL   11180--GOTO
RELMBLK
     12409**PROC     9237--CALL     9273--CALL     9278--CALL    10197--CALL    10735--CALL    10840--CALL
     11345--CALL    11359--CALL    11492--CALL
RESET IN PROCEDURE INSRT
     11659**PROC    11537--CALL    11564--CALL
RESET1 IN PROCEDURE RESET
     11675**ENTRY   11602--CALL
RFBIM IN PROCEDURE INSRT
     11475**LABEL   11174--GOTO
RFBUL IN PROCEDURE INSRT
     11481**LABEL   11176--GOTO
RNBUL IN PROCEDURE INSRT
     11442**LABEL   11168--GOTO
RRLSP IN PROCEDURE INSRT
     11484**LABEL   11178--GOTO
RS1 IN PROCEDURE RESET
     11680**LABEL   11669--GOTO
RTN
      8772**LABEL    8539--CALLALT  8540--CALLALT  8546--CALLALT  8548--CALLALT  8549--CALLALT  8550--CALLALT
      8551--CALLALT  8552--CALLALT  8553--CALLALT  8554--CALLALT  8557--CALLALT  8562--GOTO     8598--GOTO
      8610--GOTO     8708--CALLALT  8713--CALLALT  8717--CALLALT  8730--CALLALT  8735--CALLALT  8740--CALLALT
      8745--CALLALT  8750--CALLALT  8755--CALLALT  8760--CALLALT  8791--CALLALT  8796--CALLALT  8801--CALLALT
      8806--CALLALT  8811--CALLALT  8816--CALLALT  8821--CALLALT  8828--GOTO     8845--CALLALT  9743--CALLALT
      9751--CALLALT  9777--CALLALT
RTN IN PROCEDURE GATHER
      9874**LABEL    9850--CALLALT
SAVP$
      8039**DCL     10717<<ASSIGN  10720>>ASSIGN  10772<<ASSIGN  10773>>ASSIGN  10784>>ASSIGN
SC_CGGARB
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:387  
      8361**DCL-ENT  8689--CALL     8842--CALL     9384--CALL     9446--CALL     9462--CALL     9596--CALL
      9622--CALL     9726--CALL     9771--CALL    10567--CALL    10570--CALL    10634--CALL    10697--CALL
     11300--CALL    11304--CALL    11679--CALL    11682--CALL    11769--CALL    12000--CALL    12005--CALL
SC_CGGBSN
      8360**DCL-ENT  8764--CALL     8825--CALL     9781--CALL    11665--CALL    11910--CALL    12054--CALL
SETFULL
      8587**LABEL    8561--GOTO
SETLDA IN PROCEDURE INSRT
     11191**ENTRY    9686--CALL
SMBLK IN PROCEDURE DUMPLIST
      9916**DCL     10183<>CALL    10191>>ASSIGN
SMBLK.DDA IN PROCEDURE DUMPLIST
      9981**DCL     10178<>CALL
SMBLK.KEY1 IN PROCEDURE DUMPLIST
      9944**DCL      9946--REDEF
SMBLK.KEY2 IN PROCEDURE DUMPLIST
      9953**DCL      9971--REDEF
SMBLK.LNK$ IN PROCEDURE DUMPLIST
      9918**DCL      9920--REDEF    9926--REDEF    9930--REDEF   10185<<ASSIGN  10188>>IF
SMBLK.STA$ IN PROCEDURE DUMPLIST
     10138**DCL     10141--REDEF   10145--REDEF
SMBLK.USR IN PROCEDURE DUMPLIST
     10109**DCL     10114--REDEF
SMBLK.XSP.MREQ$ IN PROCEDURE DUMPLIST
      9973**DCL      9977--REDEF
SMBLK IN PROCEDURE FILLDBLK
     10230**DCL     10214--PROC    10489<<ASSIGN  10515>>ASSIGN
SMBLK.COUNT IN PROCEDURE FILLDBLK
     10470**DCL     10498<<ASSIGN
SMBLK.DDA IN PROCEDURE FILLDBLK
     10295**DCL     10491<<ASSIGN
SMBLK.FIRSTX IN PROCEDURE FILLDBLK
     10459**DCL     10499<<ASSIGN
SMBLK.KEY1 IN PROCEDURE FILLDBLK
     10258**DCL     10260--REDEF   10493<<ASSIGN  10506>>IF
SMBLK.KEY1ALL IN PROCEDURE FILLDBLK
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:388  
     10404**DCL     10506<<ASSIGN
SMBLK.KEY2 IN PROCEDURE FILLDBLK
     10267**DCL     10285--REDEF   10494<<ASSIGN  10507>>IF
SMBLK.KEY2ALL IN PROCEDURE FILLDBLK
     10407**DCL     10507<<ASSIGN
SMBLK.LNK$ IN PROCEDURE FILLDBLK
     10232**DCL     10234--REDEF   10240--REDEF   10244--REDEF
SMBLK.PCVALID IN PROCEDURE FILLDBLK
     10428**DCL     10492<<ASSIGN
SMBLK.PRIO IN PROCEDURE FILLDBLK
     10248**DCL     10495<<ASSIGN
SMBLK.PRIOLO IN PROCEDURE FILLDBLK
     10444**DCL     10511<<ASSIGN
SMBLK.STA$ IN PROCEDURE FILLDBLK
     10452**DCL     10455--REDEF   10459--REDEF
SMBLK.STAMP IN PROCEDURE FILLDBLK
     10252**DCL     10501<<ASSIGN  10517>>ASSIGN
SMBLK.SUPER IN PROCEDURE FILLDBLK
     10311**DCL     10490<<ASSIGN
SMBLK.USR IN PROCEDURE FILLDBLK
     10423**DCL     10428--REDEF
SMBLK.UTS IN PROCEDURE FILLDBLK
     10302**DCL     10496<<ASSIGN
SMBLK.UTSHI IN PROCEDURE FILLDBLK
     10446**DCL     10512<<ASSIGN
SMBLK.UTSXTHI IN PROCEDURE FILLDBLK
     10468**DCL     10513<<ASSIGN
SMBLK.UTSXTLO IN PROCEDURE FILLDBLK
     10466**DCL     10497<<ASSIGN
SMBLK.XSP.MREQ$ IN PROCEDURE FILLDBLK
     10287**DCL     10291--REDEF
SMBLK IN PROCEDURE INSRT
     10872**DCL     11368<<ASSIGN  11372>>ASSIGN  11423<>CALL
SMBLK.DDA IN PROCEDURE INSRT
     10937**DCL     11426<>CALL    11426--CALL
SMBLK.KEY1 IN PROCEDURE INSRT
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:389  
     10900**DCL     10902--REDEF
SMBLK.KEY2 IN PROCEDURE INSRT
     10909**DCL     10927--REDEF
SMBLK.LNK$ IN PROCEDURE INSRT
     10874**DCL     10876--REDEF   10882--REDEF   10886--REDEF
SMBLK.STA$ IN PROCEDURE INSRT
     11094**DCL     11097--REDEF   11101--REDEF
SMBLK.STAMP IN PROCEDURE INSRT
     10894**DCL     11442>>ASSIGN
SMBLK.USR IN PROCEDURE INSRT
     11065**DCL     11070--REDEF
SMBLK.XSP.MREQ$ IN PROCEDURE INSRT
     10929**DCL     10933--REDEF
SPLIT IN PROCEDURE INSRT
     11393**LABEL   11312--GOTO    11313--GOTO    11315--GOTO    11317--GOTO
SPLIT0 IN PROCEDURE INSRT
     11406**LABEL   11399--GOTO    11401--GOTO    11403--GOTO
SPLT IN PROCEDURE INSRT
     11708**PROC    11336--CALL    11404--CALL    11413--CALL    11511--CALL
SQ
      9627**LABEL    9593--CALLALT  9606--GOTO
SQ0
      9637**LABEL    8726--GOTO     9670--GOTO     9682--GOTO     9770--GOTO
SQ24
      9670**LABEL    8731--GOTO     8736--GOTO     8741--GOTO     8746--GOTO     8751--GOTO     8807--GOTO
      8812--GOTO     8817--GOTO     8822--GOTO     8961--GOTO     9778--GOTO
SQ26
      9671**LABEL    9671--GOTO
SQ28
      9681**LABEL    9687--GOTO
SQ30
      9682**LABEL    8756--GOTO     8761--GOTO     8797--GOTO     8802--GOTO
SQ40
      9685**LABEL    9679--CALLALT
SQDUN
      9685**LABEL    8722--GOTO     9773--GOTO
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:390  
SQUISHENT
      9793**PROC     8721--CALL     8725--CALL     8729--CALL     8734--CALL     8739--CALL     8744--CALL
      8749--CALL     8754--CALL     8759--CALL     8925--CALL     8958--CALL     9593--CALL     9625--CALL
SQUISHENT0 IN PROCEDURE SQUISHENT
      9797**ENTRY    8795--CALL     8800--CALL     8805--CALL     8810--CALL     8815--CALL     8820--CALL
      9769--CALL     9776--CALL
SQUISHX IN PROCEDURE SQUISHENT
      9822**ENTRY    8938--CALL     9602--CALL     9716--CALL     9723--CALL     9734--CALL     9877--CALL
     10617--CALL    10626--CALL    11645--CALL    11761--CALL    11776--CALL
SQZ IN PROCEDURE SPLT
     11721**ENTRY   11373--CALL
SSS$XSYSTIME
      8358**DCL-ENT 10500--CALL
STA$
      8026**DCL      6270--IMP-PTR  8891<<ASSIGN   8892>>DOWHILE  8893>>CALL     8894>>CALL     8895<<ASSIGN
      8895>>ASSIGN   8928>>ASSIGN   8928>>ASSIGN   9516<<ASSIGN   9517>>DOWHILE  9518>>IF       9520>>IF
      9523>>CALL     9525>>IF       9527>>IF       9527>>CALL     9528>>CALL     9530>>IF       9533>>CALL
      9538>>ASSIGN   9539>>ASSIGN   9539>>ASSIGN   9541>>CALL     9548<<ASSIGN   9555<<ASSIGN   9555>>ASSIGN
      9728>>CALL     9729>>CALL     9801<<ASSIGN   9802>>ASSIGN   9804>>CALL     9827>>CALL     9859>>CALL
      9862>>CALL
STAMP IN PROCEDURE DODELMSG
      9200**DCL      9301<<ASSIGN   9302<>CALL     9308<<ASSIGN   9309<>CALL
START$
      8045**DCL     10177>>ASSIGN  10183<>CALL    10184>>ASSIGN  10189>>ASSIGN  10191>>ASSIGN  10544<<ASSIGN
START$ IN PROCEDURE FILLDBLK
     10216**DCL     10214--PROC    10493>>ASSIGN  10494>>ASSIGN  10495>>ASSIGN  10496>>ASSIGN  10497>>ASSIGN
     10503>>ASSIGN
SUPER IN PROCEDURE CHKMLH
     12021**DCL     12029<<ASSIGN  12034<<ASSIGN  12034>>ASSIGN  12050>>IF
T$ IN PROCEDURE DISKERR
     11792**DCL     11920<<ASSIGN  11921<>CALL
T$ IN PROCEDURE RELMBLK
     12681**DCL     12684<<ASSIGN  12685<>CALL
T1$ IN PROCEDURE CONCATS
     10683**DCL     10690<<ASSIGN  10692<>CALL
T1$ IN PROCEDURE DUMPLIST
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:391  
      9901**DCL     10176<<ASSIGN  10178<>CALL
T2$ IN PROCEDURE CONCATS
     10684**DCL     10691<<ASSIGN  10692<>CALL
T2$ IN PROCEDURE DUMPLIST
      9902**DCL     10177<<ASSIGN  10178<>CALL    10178--CALL
TRYQUIT
      8565**PROC     8540--CALL     8548--CALL     8550--CALL     8552--CALL     8554--CALL     8557--CALL
UNLOCK IN PROCEDURE DELETE
     12086**ENTRY    9317--CALL     9347--CALL    10200--CALL    11394--CALL    11444--CALL    11457--CALL
     11480--CALL    11982--CALL
UPDATE IN PROCEDURE DELETE
     12095**ENTRY    9305--CALL    11281--CALL    11374--CALL    11456--CALL    11701--CALL    11962--CALL
UPDATED IN PROCEDURE DELETE
     12076**ENTRY   10711--CALL    10734--CALL
X$
      8042**DCL      8882<<ASSIGN   8883>>DOWHILE  8884<<ASSIGN   8884>>ASSIGN   8886>>ASSIGN   9255<<ASSIGN
      9256>>IF       9258>>ASSIGN   9259>>ASSIGN   9269>>ASSIGN   9270>>IF       9271>>CALL     9273>>CALL
      9309<>CALL     9310>>ASSIGN   9311>>CALL     9426<<ASSIGN   9428>>ASSIGN   9477<<ASSIGN   9479>>ASSIGN
      9656<<ASSIGN   9658>>ASSIGN  10196<<ASSIGN  10198>>ASSIGN  10503<<ASSIGN  10505>>ASSIGN  10506>>IF
     10507>>IF      10509<<ASSIGN  10509>>ASSIGN  10817<<ASSIGN  10818>>DOWHILE 10819<<ASSIGN  10819>>ASSIGN
     10821>>ASSIGN  10822>>IF      10823>>ASSIGN  11488<<ASSIGN  11490>>ASSIGN  11492>>CALL
XIT IN PROCEDURE DELETE
     12069**LABEL   12079--GOTO    12090--GOTO
XIT IN PROCEDURE SPLT
     11717**LABEL   11726--GOTO
Z$
      8043**DCL     10184<<ASSIGN  10195>>DOWHILE 10196>>ASSIGN  10197>>CALL    10198<<ASSIGN  10502<<ASSIGN
     10505>>ASSIGN  10508<<ASSIGN  10508>>ASSIGN  10511>>ASSIGN  10512>>ASSIGN  10513>>ASSIGN  11275<<ASSIGN
     11279>>ASSIGN  11279>>ASSIGN  11320>>IF      11321>>IF      11322>>IF      11323>>IF      11324>>IF
     11325<<ASSIGN  11325>>ASSIGN  11356>>CALL    11357>>ASSIGN  11369>>CALL    11370>>ASSIGN  11380<<ASSIGN
     11380>>ASSIGN
ZA1
      9633**LABEL    9630--CALLALT
ZA1 IN PROCEDURE CONCATS
     10694**LABEL   10692--CALLALT
ZA1 IN PROCEDURE DODELMSG
PL6.E3A0      #001=KQS$GARBF File=KQS$SCUM.:E05TSI                               WED 07/30/97 01:36 Page:392  
      9207**LABEL    9204--CALLALT
ZA1 IN PROCEDURE DUMPLIST
     10182**LABEL   10178--CALLALT
ZA1 IN PROCEDURE INSRT
     11145**LABEL   11142--CALLALT
ZA2
      9705**LABEL    9702--CALLALT
ZA2 IN PROCEDURE INSRT
     11432**LABEL   11426--CALLALT
