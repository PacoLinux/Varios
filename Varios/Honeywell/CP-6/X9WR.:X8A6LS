VERSION A06

PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:1    
        1        1        /*M* X9WR$READ -- Provides the support for the READ statement.      */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7
        8        8        /*P*
        9        9                NAME: X9WR$READ_RAND (_NEXT)
       10       10             PURPOSE: This module provide the functionality neccessary for
       11       11                      the support of the READ and READ NEXT statements.
       12       12        */
       13       13        %eject;
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:2    
       14       14        /*------------*/
       15       15        X9WR$READ_RAND:  PROC (FAB, ALT_RET, INDX)  ALTRET;
       16       16        /*------------*/
       17       17
       18       18            %INCLUDE B_ERRORS_C;
       19     1144            %INCLUDE X8A_SYS_FILE;
       20     7414            %INCLUDE X9A_IO;
       21     7564            %INCLUDE X9A_LIB_IO;
       22     7948            %INCLUDE X9A_FAB;
       23     8135            %INCLUDE X8A_ERRCOM;
       24     8224            %DCL_FAB;
       25     8346            %DCL_SHARED        (@STCLASS = "BASED (FAB.SHARED$)");
       26     8355            %EQU NONE = 3;
       27     8356
       28     8357    1       DCL ALT_RET        BIT(1) ALIGNED;
       29     8358    1       DCL INDX           SBIN WORD;
       30     8359    1       DCL I              SBIN WORD;
       31     8360    1       DCL IO_STATUS      CHAR(2) BASED (FAB.IO_STATUS$);
       32     8361    1       DCL 1 RDB          DALIGNED BASED (FAB.BUFFER$),
       33     8362    1             2 RECORD     CHAR (FAB.MAX_REC_LEN);
       34     8363    1       DCL RELATIVE_KEY   UBIN WORD;
       35     8364    1       DCL INDEX_KEY$     PTR;
       36     8365    1       DCL ALT_LENGTH     SBIN WORD;
       37     8366    1       DCL INDEX_KEY      BASED  CHAR (FAB.RECORD_KEY_LEN);
       38     8367    1       DCL ALT_INDX       BASED (INDEX_KEY$) CHAR (ALT_LENGTH);
       39     8368    1       DCL LOW_VALUE      CHAR(255);
       40     8369    1       DCL 1 KEYED_KEY    ALIGNED,
       41     8370    1            2 LENGTH      UBIN(9)   UNAL,
       42     8371    1            2 TEXT        CHAR(255) UNAL;
       43     8372    1       DCL KEY_TEXT       CHAR (KEYED_KEY.LENGTH) BASED (FAB.RECORD_KEY$) UNAL;
       44     8373    1       DCL PAD_CHAR       CHAR(1) BASED (FAB.PAD_CHAR$);
       45     8374
       46     8375        %eject;
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:3    
       47     8376    1       DCL X9WE$IO_ERROR              ENTRY(2) ALTRET;
       48     8377    1       DCL X9WE$IO_ERROR_STATUS       ENTRY(2) ALTRET;
       49     8378    1       DCL X8ER$ERROR                 ENTRY(3) ;
       50     8379    1       DCL X8CV$CONVERT_TO_INTEGER    ENTRY(3) ALTRET;
       51     8380    1       DCL X8CV$CONVERT_FROM_INTEGER  ENTRY(3) ALTRET;
       52     8381    1       DCL XSA$READ                   ENTRY(2) ALTRET;
       53     8382    1       DCL X9WU$WRITE_USER_LABEL      ENTRY(4);
       54     8383    1       DCL X9WU$READ_USER_LABEL       ENTRY(4);
       55     8384
       56     8385            %VLP_ALTKEYS     (FPTN=ALT_KEYS, STCLASS="BASED (FAB.ALT_KEY$)");
       57     8400            %FPT_READ        (FPTN=FPT_READ);
       58     8439            %FPT_CVOL        (FPTN=CLOSE_VOLUME);
       59     8454        %eject;
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:4    
       60     8455        %MACRO SWAP_VOLUME_AND_REREAD;
       61     8456           DO;
       62     8457             CLOSE_VOLUME.V.DCB# = FAB.DCB_NUM;
       63     8458
       64     8459              %BEFORE_TAPE_SWAP_LABEL_PROC;
       65     8460
       66     8461             IF FAB.B.BEGIN_TAPE_LABEL THEN
       67     8462               CALL X9WU$WRITE_USER_LABEL (FAB, CLOSE_VOLUME.UHL_,
       68     8463                                           %BEGINNING_TAPE_LABEL);
       69     8464             ELSE
       70     8465               CLOSE_VOLUME.UHL_ = VECTOR(NIL);
       71     8466
       72     8467             IF FAB.B.END_TAPE_LABEL THEN
       73     8468               CALL X9WU$WRITE_USER_LABEL (FAB, CLOSE_VOLUME.UTL_,
       74     8469                                           %ENDING_TAPE_LABEL);
       75     8470             ELSE
       76     8471               CLOSE_VOLUME.UTL_ = VECTOR(NIL);
       77     8472
       78     8473             CALL M$CVOL (CLOSE_VOLUME)
       79     8474               WHENALTRETURN
       80     8475                 DO;
       81     8476                   CALL X9WE$IO_ERROR (FAB);
       82     8477                   RETURN;
       83     8478                 END;
       84     8479
       85     8480             IF FAB.B.BEGIN_TAPE_LABEL THEN
       86     8481               CALL X9WU$READ_USER_LABEL (FAB, CLOSE_VOLUME.UHL_,
       87     8482                                          %BEGINNING_TAPE_LABEL);
       88     8483
       89     8484             IF FAB.B.END_TAPE_LABEL THEN
       90     8485               CALL X9WU$READ_USER_LABEL (FAB, CLOSE_VOLUME.UTL_,
       91     8486                                          %ENDING_TAPE_LABEL);
       92     8487
       93     8488               %AFTER_TAPE_SWAP_LABEL_PROC;
       94     8489
       95     8490         /* Reread the file, because previous read is failed */
       96     8491
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:5    
       97     8492             CALL M$READ (FPT_READ)
       98     8493               WHENRETURN
       99     8494                 DO;
      100     8495                   FAB.LENGTH_READ = M$XX.ARS#;
      101     8496                   IF FAB.LENGTH_READ < FAB.MIN_REC_LEN
      102     8497                   OR FAB.LENGTH_READ > FAB.MAX_REC_LEN THEN
      103     8498                     IO_STATUS = %BAD_LENGTH;
      104     8499                   ELSE
      105     8500                     IO_STATUS = %SUCCESSFUL;
      106     8501                 END;
      107     8502               WHENALTRETURN
      108     8503                 DO;
      109     8504                   FAB.LENGTH_READ = M$XX.ARS#;
      110     8505                   CALL X9WE$IO_ERROR (FAB, ALT_RET)
      111     8506                     WHENRETURN
      112     8507                       DO;
      113     8508                         IF IO_STATUS = '04' THEN
      114     8509                           RETURN;
      115     8510                         ELSE
      116     8511                           ALTRETURN;
      117     8512                       END;
      118     8513                     WHENALTRETURN
      119     8514                       DO;
      120     8515                         ALTRETURN;
      121     8516                       END;
      122     8517                END;
      123     8518           END;
      124     8519         %MEND;
      125     8520        %eject;
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:6    
      126     8521        /*------------\
      127     8522        | Read Random |
      128     8523        \------------*/
      129     8524
      130     8525    2       DO CASE  (FAB.FILE_STATUS);
      131     8526
      132     8527    2         CASE (%FILE_NOT_PRESENT);
      133     8528
      134     8529    2           IO_STATUS = %NO_RANDOM_RECORD;                       /*AUDIT*/
      135     8530    2           CALL X9WE$IO_ERROR_STATUS (FAB, ALT_RET)
      136     8531    2           WHENALTRETURN
      137     8532    3             DO;
      138     8533    3               ALTRETURN;
      139     8534    3             END;
      140     8535
      141     8536    2         CASE (%FILE_LOCKED, %FILE_CLOSED, %FILE_NEVER_OPEN);
      142     8537
      143     8538    2           IO_STATUS = %NOT_OPEN_INPUT;
      144     8539    2           CALL X9WE$IO_ERROR_STATUS (FAB);
      145     8540        %eject;
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:7    
      146     8541        /*------------\
      147     8542        | Read Random |
      148     8543        \------------*/
      149     8544
      150     8545    2         CASE (%FILE_OPEN);
      151     8546
      152     8547    2           DCB$ = DCBADDR (FAB.DCB_NUM);
      153     8548    2           IF  M$XX.FUN#  = %CREATE THEN
      154     8549    3             DO;
      155     8550    3               IO_STATUS = %NOT_OPEN_INPUT;
      156     8551    3               CALL X9WE$IO_ERROR_STATUS (FAB);
      157     8552    3               RETURN;
      158     8553    3             END;
      159     8554    2           ELSE
      160     8555    3             DO;
      161     8556    3               FAB.LAST_IO = %READ_RANDOM;
      162     8557    3               FPT_READ.V.DCB# = FAB.DCB_NUM;
      163     8558    3               FPT_READ.V.KEYS# = %YES#;
      164     8559    4               DO CASE (FAB.ORG#);
      165     8560
      166     8561    4                 CASE (%CP6_RELATIVE);
      167     8562
      168     8563    4                   CALL X8CV$CONVERT_TO_INTEGER (FAB.RELATIVE_KEY$,
      169     8564    4                        FAB.RELATIVE_DESC, RELATIVE_KEY);
      170     8565    4                   FPT_READ.KEY_ = VECTOR  (RELATIVE_KEY);
      171     8566
      172     8567    4                 CASE (%CP6_KEYED);
      173     8568
      174     8569    4                    KEYED_KEY.LENGTH = FAB.RECORD_KEY_LEN;
      175     8570    4                    KEYED_KEY.TEXT   = KEY_TEXT;
      176     8571    4                    FPT_READ.KEY_ = VECTOR (KEYED_KEY);
      177     8572        %eject;
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:8    
      178     8573        /*------------\
      179     8574        | Read Random |
      180     8575        \------------*/
      181     8576
      182     8577    4                 CASE (%CP6_INDEXED);
      183     8578
      184     8579    4                   IF INDX = 0
      185     8580    4                   OR INDX = 1 THEN       /*  we have the primary key  */
      186     8581    5                     DO;
      187     8582    5                       FPT_READ.KEY_ = VECTOR (FAB.RECORD_KEY$-> INDEX_KEY);
      188     8583    5                       FPT_READ.V.INDX# = %PRIMARY_KEY;
      189     8584    5                       FAB.B.SHARED_INDEX_ALT = %NO#;
      190     8585    5                     END;
      191     8586    4                   ELSE
      192     8587    5                     DO;
      193     8588    5                       INDEX_KEY$ = PINCRC  (FAB.BUFFER$,
      194     8589    5                                        ALT_KEYS.K.KEYX# (INDX - 2));
      195     8590    5                       ALT_LENGTH = ALT_KEYS.K.KEYL# (INDX - 2);
      196     8591    5                       FPT_READ.KEY_ = VECTOR (ALT_INDX);
      197     8592    5                       FPT_READ.V.INDX# = INDX;
      198     8593    5                       IF  M$XX.SHARE# ~= %NONE                /*#32607*/
      199     8594    5                       AND FAB.ACS# ~= %FAB_RANDOM_ACCESS THEN /*#34275*/
      200     8595    6                         DO;
      201     8596    6                           FAB.B.SHARED_INDEX_ALT = %YES#;
      202     8597    6                           FAB.B.REPOSITION = %YES#;
      203     8598    6                           SHARED.RECNUM = 1;
      204     8599    6                           SHARED.INDX = INDX - 2;
      205     8600    6                         END;
      206     8601    5                     END;
      207     8602
      208     8603    4               END; /* case fab.org# */
      209     8604        %eject;
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:9    
      210     8605        /*------------\
      211     8606        | Read Random |
      212     8607        \------------*/
      213     8608
      214     8609    3               FPT_READ.BUF_   = VECTOR (RDB);
      215     8610
      216     8611    3               CALL M$READ (FPT_READ)
      217     8612    3                 WHENRETURN
      218     8613    4                   DO;
      219     8614    4                     FAB.B.NO_NEXT_RECORD_EXISTS = %NO#;
      220     8615    4                     FAB.LENGTH_READ = M$XX.ARS#;
      221     8616    4                     IF FAB.B.SHARED_INDEX_ALT THEN            /*#32607*/
      222     8617    4                       SUBSTR (SHARED.KEY,0,ALT_LENGTH) = ALT_INDX;
      223     8618    4                     IF FAB.LENGTH_READ < FAB.MAX_REC_LEN THEN
      224     8619    4                       SUBSTR (RDB.RECORD, FAB.LENGTH_READ, FAB.MAX_REC_LEN
      225     8620    4                               - FAB.LENGTH_READ) = ' ';
      226     8621    4                     IF FAB.LENGTH_READ > FAB.MAX_REC_LEN OR
      227     8622    4                        FAB.LENGTH_READ < FAB.MIN_REC_LEN THEN
      228     8623    4                       IO_STATUS = %BAD_LENGTH;
      229     8624    4                     ELSE
      230     8625    4                       IO_STATUS = %SUCCESSFUL;
      231     8626    4                   END;
      232     8627    3                 WHENALTRETURN
      233     8628    4                   DO;
      234     8629    4                     FAB.B.NO_NEXT_RECORD_EXISTS = %YES#;
      235     8630    4                     CALL X9WE$IO_ERROR (FAB, ALT_RET)
      236     8631    4                       WHENALTRETURN
      237     8632    5                         DO;
      238     8633    5                           ALTRETURN;  /* invalid key condition */
      239     8634    5                         END;
      240     8635    4                   END;
      241     8636    3             END;  /* if m$xx.fun# ~= %create */
      242     8637        %eject;
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:10   
      243     8638        /*------------\
      244     8639        | Read Random |
      245     8640        \------------*/
      246     8641
      247     8642    2         CASE (ELSE);     /* Invalid file status */
      248     8643
      249     8644    2           CALL X8ER$ERROR (%UNEXPECTED_CASE, 'X9WR$RR', 7);
      250     8645
      251     8646    2       END;  /*  case fab.file_status */
      252     8647    1       RETURN;
      253     8648        %eject;
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:11   
      254     8649        /*------------*/
      255     8650    1   X9WR$READ_NEXT:        ENTRY (FAB, ALT_RET)  ALTRET;
      256     8651        /*------------*/
      257     8652
      258     8653    2       DO CASE  (FAB.FILE_STATUS);
      259     8654
      260     8655    2         CASE (%FILE_NOT_PRESENT);
      261     8656
      262     8657    2           IO_STATUS = %END_OF_FILE;
      263     8658    2           CALL X9WE$IO_ERROR_STATUS (FAB, ALT_RET)
      264     8659    2             WHENALTRETURN
      265     8660    3               DO;
      266     8661    3                 ALTRETURN;
      267     8662    3               END;
      268     8663
      269     8664    2         CASE (%FILE_LOCKED, %FILE_CLOSED, %FILE_NEVER_OPEN);
      270     8665
      271     8666    2           IO_STATUS = %NOT_OPEN_INPUT;
      272     8667    2           CALL X9WE$IO_ERROR_STATUS (FAB);
      273     8668
      274     8669        %eject;
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:12   
      275     8670        /*----------\
      276     8671        | Read Next |
      277     8672        \----------*/
      278     8673
      279     8674    2         CASE (%FILE_OPEN);
      280     8675
      281     8676    2            DCB$ = DCBADDR (FAB.DCB_NUM);
      282     8677    2            IF  M$XX.FUN#  = %CREATE THEN
      283     8678    3              DO;
      284     8679    3                IO_STATUS = %NOT_OPEN_INPUT;
      285     8680    3                CALL X9WE$IO_ERROR_STATUS (FAB);
      286     8681    3                RETURN;
      287     8682    3              END;
      288     8683    2            ELSE
      289     8684    3              DO;
      290     8685    3                FAB.LAST_IO = %READ_NEXT;
      291     8686    3                FPT_READ.V.DCB# = FAB.DCB_NUM;
      292     8687    3                FPT_READ.V.KEYS# = %NO#;
      293     8688    3                FPT_READ.BUF_ = VECTOR (RDB);
      294     8689    3                IF FAB.B.NO_NEXT_RECORD_EXISTS  THEN
      295     8690    4                  DO;
      296     8691    4                    IO_STATUS = %NO_NEXT_RECORD;
      297     8692    4                    CALL X9WE$IO_ERROR_STATUS (FAB);
      298     8693    4                    RETURN;
      299     8694    4                  END;
      300     8695        %eject;
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:13   
      301     8696        /*----------\
      302     8697        | Read Next |
      303     8698        \----------*/
      304     8699    4                DO CASE  (FAB.ORG#);
      305     8700    4                  CASE (%CP6_SEQUENTIAL, %CP6_UR, %CP6_FIXED); /*#31822*/
      306     8701    4                    FPT_READ.V.KEYR# = NO#;
      307     8702
      308     8703    4                  CASE (%CP6_RELATIVE);
      309     8704    4                    FPT_READ.V.KEYR# = YES#;
      310     8705    4                    FPT_READ.KEY_    = VECTOR (RELATIVE_KEY);
      311     8706
      312     8707    4                  CASE (%CP6_KEYED);
      313     8708    4                    FPT_READ.V.KEYR# = YES#;
      314     8709    4                    KEYED_KEY.LENGTH = FAB.RECORD_KEY_LEN;
      315     8710    4                    FPT_READ.KEY_   = VECTOR (KEYED_KEY);
      316     8711        %eject;
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:14   
      317     8712    4                  CASE (%CP6_INDEXED);
      318     8713    4                    FPT_READ.V.INDX# = 0;
      319     8714    4                    FPT_READ.V.KEYR# = NO#;                    /*#40727*/
      320     8715    4                    IF FAB.B.SHARED_INDEX_ALT THEN             /*#24102*/
      321     8716    5                      DO;
      322     8717    5                        INDEX_KEY$ = PINCRC (FAB.BUFFER$,
      323     8718    5                                             ALT_KEYS.K.KEYX# (SHARED.INDX));
      324     8719    5                        ALT_LENGTH = ALT_KEYS.K.KEYL# (SHARED.INDX);
      325     8720    5                        SUBSTR (ALT_INDX,0,ALT_LENGTH) = SUBSTR (SHARED.KEY,0,
              8720                                 ALT_LENGTH);
      326     8721    5                        FPT_READ.V.KEYS# = %YES#;
      327     8722    5                        FPT_READ.V.INDX# = SHARED.INDX + 2;
      328     8723    5                        FPT_READ.KEY_ = VECTOR (ALT_INDX);
      329     8724    5                        IF FAB.B.REPOSITION THEN
      330     8725    5                          CALL NEXT_ALTKEY
      331     8726    5                            WHENALTRETURN
      332     8727    6                              DO;
      333     8728    6                                IO_STATUS = %END_OF_FILE;
      334     8729    6                                CALL X9WE$IO_ERROR_STATUS (FAB,ALT_RET) /*#37712*/
      335     8730    7                                     WHENALTRETURN DO;                  /*#37712*/
      336     8731    7                                                        IF   ALT_RET    /*#37712*/
      337     8732    7                                                        THEN ALTRETURN; /*#37712*/
      338     8733    7                                                   END;                 /*#37712*/
      339     8734    6                                RETURN;                                 /*#37712*/
      340     8735    6                              END;
      341     8736    5                        FAB.B.REPOSITION = %YES#;
      342     8737    5                        FPT_READ.V.RECNUM# = SHARED.RECNUM;
      343     8738    5                      END;
      344     8739
      345     8740    4                  CASE (ELSE);
      346     8741    4                    CALL X8ER$ERROR (%UNEXPECTED_CASE, 'X9WR$RN_ORG', 11);
      347     8742    4                END; /* case fab.org */
      348     8743        %eject;
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:15   
      349     8744        /*----------\
      350     8745        | Read Next |
      351     8746        \----------*/
      352     8747
      353     8748    3   REREAD:   CALL READ
      354     8749    3               WHENRETURN
      355     8750    4                 DO;
      356     8751    4                   IF FAB.PAD_CHAR$ ~= ADDR(NIL) THEN
      357     8752    5   PAD:              DO;
      358     8753    6                       DO I = 0 TO FAB.LENGTH_READ;
      359     8754    6                         IF SUBSTR (RDB.RECORD,I,1) ~= PAD_CHAR THEN
      360     8755    6                           EXIT PAD;
      361     8756    6                       END;
      362     8757    5                       GOTO REREAD;  /* Record was all pad_chars read  */
      363     8758    5                     END;            /* another one into the buffer.   */
      364     8759
      365     8760    4                   FAB.B.NO_NEXT_RECORD_EXISTS = %NO#;
      366     8761
      367     8762    5                   DO CASE  (FAB.ORG#);
      368     8763
      369     8764    5                     CASE  (%CP6_RELATIVE);
      370     8765
      371     8766    5                       CALL X8CV$CONVERT_FROM_INTEGER (FAB.RELATIVE_KEY$,
      372     8767    5                             FAB.RELATIVE_DESC, RELATIVE_KEY)
      373     8768    5                         WHENALTRETURN
      374     8769    6                           DO;
      375     8770    6                             IO_STATUS = %KEY_OVERFLOW;
      376     8771    6                             CALL X9WE$IO_ERROR_STATUS (FAB, ALT_RET)
      377     8772    6                               WHENALTRETURN
      378     8773    7                                 DO;
      379     8774    7                                   ALTRETURN;
      380     8775    7                                 END;
      381     8776    6                           END;
      382     8777        %eject;
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:16   
      383     8778        /*----------\
      384     8779        | Read Next |
      385     8780        \----------*/
      386     8781
      387     8782    5                     CASE  (%CP6_KEYED);
      388     8783
      389     8784    5                       FAB.RECORD_KEY$-> KEY_TEXT = KEYED_KEY.TEXT;
      390     8785
      391     8786    5                   END; /* case fab.org# */
      392     8787
      393     8788    4                   IF  FAB.LENGTH_READ < FAB.MAX_REC_LEN THEN
      394     8789    5                     DO;
      395     8790    5                       SUBSTR (RDB.RECORD, FAB.LENGTH_READ, FAB.MAX_REC_LEN
      396     8791    5                          - FAB.LENGTH_READ) = ' ';
      397     8792    5                     END;
      398     8793    4                 END;
      399     8794
      400     8795    3               WHENALTRETURN             /* CALL READ */
      401     8796    4                 DO;
      402     8797    4                   FAB.B.NO_NEXT_RECORD_EXISTS = %YES#;
      403     8798    4                   IF SUBSTR (IO_STATUS,0,1) = '1' THEN
      404     8799    4                     ALTRETURN;
      405     8800    4                   ELSE
      406     8801    4                     RETURN;
      407     8802    4                 END;
      408     8803    3               END; /* if m$xx.fun# ~= %create */
      409     8804
      410     8805    2         CASE (ELSE);
      411     8806    2           CALL X8ER$ERROR (%UNEXPECTED_CASE, 'X9WR$RN', 7);
      412     8807
      413     8808    2       END;  /* case fab.file_status */
      414     8809        %eject;
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:17   
      415     8810        /*----*/
      416     8811    1     READ:                PROC  ALTRET;
      417     8812        /*----*/
      418     8813        /*I*
      419     8814               NAME:  X9WR$READ_NEXT:READ
      420     8815            PURPOSE:  This procedure provides the interface to the CP-6
      421     8816                      Monitor Service function M$READ.  It will also use
      422     8817                      fast sequential file access (XSA$READ) whenever possible.
      423     8818        */
      424     8819    2       IF FAB.B.FAST_SEQUENTIAL THEN
      425     8820    2           CALL XSA$READ (FPT_READ, FAB.XSA)
      426     8821    2             WHENRETURN
      427     8822    3               DO;
      428     8823    3                 FAB.LENGTH_READ = FAB.XSA.ARS#;
      429     8824    3                 IF FAB.LENGTH_READ < FAB.MIN_REC_LEN
      430     8825    3                 OR FAB.LENGTH_READ > FAB.MAX_REC_LEN THEN
      431     8826    3                   IO_STATUS = %BAD_LENGTH;
      432     8827    3                 ELSE
      433     8828    3                   IO_STATUS = %SUCCESSFUL;
      434     8829    3               END;
      435     8830    2             WHENALTRETURN
      436     8831    3               DO;
      437     8832    3                 FAB.LENGTH_READ = FAB.XSA.ARS#;
      438     8833    3                 CALL X9WE$IO_ERROR (FAB, ALT_RET)
      439     8834    3                   WHENRETURN
      440     8835    4                     DO;
      441     8836    4                       IF IO_STATUS = '04' THEN
      442     8837    4                         RETURN;
      443     8838    4                       ELSE
      444     8839    4                         ALTRETURN;
      445     8840    4                     END;
      446     8841    3                   WHENALTRETURN
      447     8842    4                     DO;
      448     8843    4                       ALTRETURN;
      449     8844    4                     END;
      450     8845    3                END;
      451     8846        %eject;
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:18   
      452     8847    2       ELSE
      453     8848    2           CALL M$READ (FPT_READ)
      454     8849    2             WHENRETURN
      455     8850    3               DO;
      456     8851    3                 FAB.LENGTH_READ = M$XX.ARS#;
      457     8852    3                 IF FAB.LENGTH_READ < FAB.MIN_REC_LEN
      458     8853    3                 OR FAB.LENGTH_READ > FAB.MAX_REC_LEN THEN
      459     8854    3                   IO_STATUS = %BAD_LENGTH;
      460     8855    3                 ELSE
      461     8856    3                   IO_STATUS = %SUCCESSFUL;
      462     8857    3               END;
      463     8858    2             WHENALTRETURN
      464     8859    3               DO;
      465     8860    3                 IF B$TCB$ -> B$TCB.ALT$ -> B$ALT.ERR.ERR# = %E$EOVOL THEN
      466     8861    4                   DO;
      467     8862                          %SWAP_VOLUME_AND_REREAD;
      468     8990    4                   END;
      469     8991    3                 ELSE
      470     8992    4                   DO;
      471     8993    4                     FAB.LENGTH_READ = M$XX.ARS#;
      472     8994    4                     CALL X9WE$IO_ERROR (FAB, ALT_RET)
      473     8995    4                       WHENRETURN
      474     8996    5                         DO;
      475     8997    5                           IF IO_STATUS = '04' THEN
      476     8998    5                             RETURN;
      477     8999    5                           ELSE
      478     9000    5                             ALTRETURN;
      479     9001    5                         END;
      480     9002    4                       WHENALTRETURN
      481     9003    5                         DO;
      482     9004    5                           ALTRETURN;
      483     9005    5                         END;
      484     9006    4                   END;
      485     9007    3                END;
      486     9008
      487     9009    2     END READ;
      488     9010        %eject;
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:19   
      489     9011        /*-----------*/
      490     9012    1     NEXT_ALTKEY:         PROC   ALTRET;                       /*#24102*/
      491     9013        /*-----------*/
      492     9014
      493     9015        /*I*
      494     9016               NAME: X9WR$READ_NEXT:NEXT_ALTKEY
      495     9017
      496     9018            PURPOSE: This procedure was developed in order to provide support
      497     9019                     for sequential reads of shared indexed files accessed
      498     9020                     with an alternate key because this functionality was removed
      499     9021                     from the C00 release of the CP-6 operating system.
      500     9022        */
      501     9023
      502     9024    2     DCL SAVE_KEY         CHAR (256);
      503     9025
      504     9026          %FPT_PRECORD         (FPTN=START);
      505     9047
      506     9048    2     START.V.DCB# = FAB.DCB_NUM;
      507     9049    2     START.V.KEYS# = %YES#;
      508     9050    2     START.V.KEYR# = %YES#;
      509     9051    2     START.V.INDX# = SHARED.INDX + 2;                          /*#32658*/
      510     9052    2     START.KEY_    = VECTOR (SUBSTR (SHARED.KEY,0,ALT_LENGTH));
      511     9053
      512     9054    2     IF ALT_KEYS.K.UNIQUE# (SHARED.INDX) THEN
      513     9055    3       DO;
      514     9056    3         START.V.N# = 1;
      515     9057    3       END;
      516     9058    2     ELSE
      517     9059    3       DO;
      518     9060    3         SHARED.RECNUM = SHARED.RECNUM + 1;
      519     9061    3         START.V.RECNUM# = SHARED.RECNUM;
      520     9062    3         START.V.N# = 0;
      521     9063    3         SAVE_KEY = SHARED.KEY;
      522     9064    3       END;
      523     9065        %eject;
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:20   
      524     9066    2     CALL M$PRECORD (START)
      525     9067    2       WHENRETURN
      526     9068    3         DO;
      527     9069    3           ALT_INDX = SUBSTR (SHARED.KEY,0,ALT_LENGTH);
      528     9070    3         END;
      529     9071    2       WHENALTRETURN
      530     9072    3         DO;
      531     9073    3           CALL X9WE$IO_ERROR (FAB, ALT_RET)
      532     9074    3             WHENALTRETURN
      533     9075    4               DO;
      534     9076    4                 RETURN;
      535     9077    4               END;
      536     9078    3           IF NOT ALT_KEYS.K.UNIQUE# (SHARED.INDX) THEN
      537     9079    4             DO;
      538     9080    4               START.V.RECNUM# = SHARED.RECNUM - 1; /*last valid recnum*/
      539     9081    4               SHARED.RECNUM = 1;                              /*#32658*/
      540     9082    4               START.V.N# = 0;
      541     9083    4               SHARED.KEY = SAVE_KEY;
      542     9084    4               CALL M$PRECORD (START)
      543     9085    4                 WHENRETURN
      544     9086    5                   DO;   /* This key still exists, so position to it   */
      545     9087                              /* again and advance to the next key (N# = 1) */
      546     9088    5                     START.V.N# = 1;
      547     9089    5                     CALL M$PRECORD (START)
      548     9090    5                       WHENRETURN
      549     9091    6                         DO;
      550     9092    7                           DO I = 0 TO ALT_LENGTH - 1;
      551     9093    7                             SUBSTR (LOW_VALUE, I, 1) = BINASC(0);
      552     9094    7                           END;
      553     9095    6                           IF SUBSTR (SHARED.KEY, 0, ALT_LENGTH) =
      554     9096    6                              SUBSTR (LOW_VALUE,  0, ALT_LENGTH) THEN
      555     9097    6                             ALTRETURN; /* eof */
      556     9098    6                         END;
      557     9099    5                       WHENALTRETURN
      558     9100    6                         DO;
      559     9101    6                           CALL X9WE$IO_ERROR (FAB, ALT_RET)
      560     9102    6                             WHENALTRETURN
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:21   
      561     9103    7                               DO;
      562     9104    7                                 RETURN;
      563     9105    7                               END;
      564     9106    6                         END;
      565     9107    5                   END;
      566     9108        %eject;
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:22   
      567     9109    4                 WHENALTRETURN
      568     9110    5                   DO;  /* The old key is gone so position is ok */
      569     9111    5                     CALL X9WE$IO_ERROR (FAB, ALT_RET)
      570     9112    5                       WHENALTRETURN
      571     9113    6                         DO;
      572     9114    6                           RETURN;
      573     9115    6                         END;
      574     9116    5                   END;
      575     9117    4             END;  /* not unique */
      576     9118    3           ALT_INDX = SUBSTR (SHARED.KEY,0,ALT_LENGTH); /* set up the  */
      577     9119    3         END; /* whenaltreturn 1st m$precord */         /* key for read*/
      578     9120    2     END NEXT_ALTKEY; /* proc */
      579     9121    1   END X9WR$READ_RAND;  /* proc */
      580     9122        %eject;
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:23   

PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:24   
--  Include file information  --

   X8A_ERRCOM.:X8A6TOU  cannot be made into a system file and is referenced.
   XS_MACRO_C.:LIBRARY  is referenced.
   X9A_FAB.:X8A6TOU  is referenced.
   X9A_LIB_IO.:X8A6TOU  cannot be made into a system file and is referenced.
   X9A_IO.:X8A6TOU  is referenced.
   CP_6_SUBS.:LIB_E04  is referenced.
   CP_6_C.:LIB_E04  is referenced.
   CP_6.:LIB_E04  cannot be made into a system file and is referenced.
   Z9A_FLAGS.:Z8A6TOU  is referenced.
   X8A_SYS_FILE.:X8A6TOU  is referenced.
   B_ERRORS_C.:LIB_E04  is referenced.
      No diagnostics issued in procedure X9WR$READ_RAND.

   Procedure X9WR$READ_RAND requires 1028 words for executable code.
   Procedure X9WR$READ_RAND requires 232 words of local(AUTO) storage.

    No errors detected in file X9WR.:X8A6TSI    .

PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:25   

 Object Unit name= X9WR$READ_RAND                             File name= X9WR.:X8A6TOU
 UTS= AUG 09 '97 11:08:30.92 SAT                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1   Data  even  none    32     40  X9WR$READ_RAND
    2  RoData even  UTS     12     14  X9WR$READ_RAND
    3   Proc  even  none  1028   2004  X9WR$READ_RAND
    4  RoData even  none    34     42  X9WR$READ_RAND

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     3      0   yes    yes     yes      Std        3  X9WR$READ_RAND
     3    347          yes     yes      Std        2  X9WR$READ_NEXT
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:26   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       2 X9WE$IO_ERROR_STATUS
 yes     yes           Std       3 X8CV$CONVERT_TO_INTEGER
 yes     yes           Std       2 X9WE$IO_ERROR
 yes     yes           Std       3 X8CV$CONVERT_FROM_INTEGER
         yes           Std       3 X8ER$ERROR
 yes     yes           Std       2 XSA$READ
         yes           Std       4 X9WU$WRITE_USER_LABEL
         yes           Std       4 X9WU$READ_USER_LABEL
                       nStd      0 X66_AUTO_3
                       nStd      0 X66_AALT
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  B$TCB$

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID                                 NULLSID                               ROSID
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:27   


        1        1        /*M* X9WR$READ -- Provides the support for the READ statement.      */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7
        8        8        /*P*
        9        9                NAME: X9WR$READ_RAND (_NEXT)
       10       10             PURPOSE: This module provide the functionality neccessary for
       11       11                      the support of the READ and READ NEXT statements.
       12       12        */
       13       13        %eject;
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:28   
       14       14        /*------------*/
       15       15        X9WR$READ_RAND:  PROC (FAB, ALT_RET, INDX)  ALTRET;

     15  3 000000   000000 700200 xent  X9WR$READ_R* TSX0  ! X66_AUTO_3
         3 000001   000350 000003                    ZERO    232,3

       16       16        /*------------*/
       17       17
       18       18            %INCLUDE B_ERRORS_C;
       19     1144            %INCLUDE X8A_SYS_FILE;
       20     7414            %INCLUDE X9A_IO;
       21     7564            %INCLUDE X9A_LIB_IO;
       22     7948            %INCLUDE X9A_FAB;
       23     8135            %INCLUDE X8A_ERRCOM;
       24     8224            %DCL_FAB;
       25     8346            %DCL_SHARED        (@STCLASS = "BASED (FAB.SHARED$)");
       26     8355            %EQU NONE = 3;
       27     8356
       28     8357    1       DCL ALT_RET        BIT(1) ALIGNED;
       29     8358    1       DCL INDX           SBIN WORD;
       30     8359    1       DCL I              SBIN WORD;
       31     8360    1       DCL IO_STATUS      CHAR(2) BASED (FAB.IO_STATUS$);
       32     8361    1       DCL 1 RDB          DALIGNED BASED (FAB.BUFFER$),
       33     8362    1             2 RECORD     CHAR (FAB.MAX_REC_LEN);
       34     8363    1       DCL RELATIVE_KEY   UBIN WORD;
       35     8364    1       DCL INDEX_KEY$     PTR;
       36     8365    1       DCL ALT_LENGTH     SBIN WORD;
       37     8366    1       DCL INDEX_KEY      BASED  CHAR (FAB.RECORD_KEY_LEN);
       38     8367    1       DCL ALT_INDX       BASED (INDEX_KEY$) CHAR (ALT_LENGTH);
       39     8368    1       DCL LOW_VALUE      CHAR(255);
       40     8369    1       DCL 1 KEYED_KEY    ALIGNED,
       41     8370    1            2 LENGTH      UBIN(9)   UNAL,
       42     8371    1            2 TEXT        CHAR(255) UNAL;
       43     8372    1       DCL KEY_TEXT       CHAR (KEYED_KEY.LENGTH) BASED (FAB.RECORD_KEY$) UNAL;
       44     8373    1       DCL PAD_CHAR       CHAR(1) BASED (FAB.PAD_CHAR$);
       45     8374
       46     8375        %eject;
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:29   
       47     8376    1       DCL X9WE$IO_ERROR              ENTRY(2) ALTRET;
       48     8377    1       DCL X9WE$IO_ERROR_STATUS       ENTRY(2) ALTRET;
       49     8378    1       DCL X8ER$ERROR                 ENTRY(3) ;
       50     8379    1       DCL X8CV$CONVERT_TO_INTEGER    ENTRY(3) ALTRET;
       51     8380    1       DCL X8CV$CONVERT_FROM_INTEGER  ENTRY(3) ALTRET;
       52     8381    1       DCL XSA$READ                   ENTRY(2) ALTRET;
       53     8382    1       DCL X9WU$WRITE_USER_LABEL      ENTRY(4);
       54     8383    1       DCL X9WU$READ_USER_LABEL       ENTRY(4);
       55     8384
       56     8385            %VLP_ALTKEYS     (FPTN=ALT_KEYS, STCLASS="BASED (FAB.ALT_KEY$)");
       57     8400            %FPT_READ        (FPTN=FPT_READ);
       58     8439            %FPT_CVOL        (FPTN=CLOSE_VOLUME);
       59     8454        %eject;
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:30   
       60     8455        %MACRO SWAP_VOLUME_AND_REREAD;
       61     8456           DO;
       62     8457             CLOSE_VOLUME.V.DCB# = FAB.DCB_NUM;
       63     8458
       64     8459              %BEFORE_TAPE_SWAP_LABEL_PROC;
       65     8460
       66     8461             IF FAB.B.BEGIN_TAPE_LABEL THEN
       67     8462               CALL X9WU$WRITE_USER_LABEL (FAB, CLOSE_VOLUME.UHL_,
       68     8463                                           %BEGINNING_TAPE_LABEL);
       69     8464             ELSE
       70     8465               CLOSE_VOLUME.UHL_ = VECTOR(NIL);
       71     8466
       72     8467             IF FAB.B.END_TAPE_LABEL THEN
       73     8468               CALL X9WU$WRITE_USER_LABEL (FAB, CLOSE_VOLUME.UTL_,
       74     8469                                           %ENDING_TAPE_LABEL);
       75     8470             ELSE
       76     8471               CLOSE_VOLUME.UTL_ = VECTOR(NIL);
       77     8472
       78     8473             CALL M$CVOL (CLOSE_VOLUME)
       79     8474               WHENALTRETURN
       80     8475                 DO;
       81     8476                   CALL X9WE$IO_ERROR (FAB);
       82     8477                   RETURN;
       83     8478                 END;
       84     8479
       85     8480             IF FAB.B.BEGIN_TAPE_LABEL THEN
       86     8481               CALL X9WU$READ_USER_LABEL (FAB, CLOSE_VOLUME.UHL_,
       87     8482                                          %BEGINNING_TAPE_LABEL);
       88     8483
       89     8484             IF FAB.B.END_TAPE_LABEL THEN
       90     8485               CALL X9WU$READ_USER_LABEL (FAB, CLOSE_VOLUME.UTL_,
       91     8486                                          %ENDING_TAPE_LABEL);
       92     8487
       93     8488               %AFTER_TAPE_SWAP_LABEL_PROC;
       94     8489
       95     8490         /* Reread the file, because previous read is failed */
       96     8491
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:31   
       97     8492             CALL M$READ (FPT_READ)
       98     8493               WHENRETURN
       99     8494                 DO;
      100     8495                   FAB.LENGTH_READ = M$XX.ARS#;
      101     8496                   IF FAB.LENGTH_READ < FAB.MIN_REC_LEN
      102     8497                   OR FAB.LENGTH_READ > FAB.MAX_REC_LEN THEN
      103     8498                     IO_STATUS = %BAD_LENGTH;
      104     8499                   ELSE
      105     8500                     IO_STATUS = %SUCCESSFUL;
      106     8501                 END;
      107     8502               WHENALTRETURN
      108     8503                 DO;
      109     8504                   FAB.LENGTH_READ = M$XX.ARS#;
      110     8505                   CALL X9WE$IO_ERROR (FAB, ALT_RET)
      111     8506                     WHENRETURN
      112     8507                       DO;
      113     8508                         IF IO_STATUS = '04' THEN
      114     8509                           RETURN;
      115     8510                         ELSE
      116     8511                           ALTRETURN;
      117     8512                       END;
      118     8513                     WHENALTRETURN
      119     8514                       DO;
      120     8515                         ALTRETURN;
      121     8516                       END;
      122     8517                END;
      123     8518           END;
      124     8519         %MEND;
      125     8520        %eject;
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:32   
      126     8521        /*------------\
      127     8522        | Read Random |
      128     8523        \------------*/
      129     8524
      130     8525    2       DO CASE  (FAB.FILE_STATUS);

   8525  3 000002   200003 470500                    LDP0    @FAB,,AUTO
         3 000003   000026 235100                    LDA     22,,PR0
         3 000004   000006 115007                    CMPA    6,DL
         3 000005   000007 602005 3                  TNC     s:8525+5,AL
         3 000006   000342 710000 3                  TRA     s:8644
         3 000007   000030 710000 3                  TRA     s:8538
         3 000010   000030 710000 3                  TRA     s:8538
         3 000011   000041 710000 3                  TRA     s:8547
         3 000012   000015 710000 3                  TRA     s:8529
         3 000013   000342 710000 3                  TRA     s:8644
         3 000014   000030 710000 3                  TRA     s:8538

      131     8526
      132     8527    2         CASE (%FILE_NOT_PRESENT);

      133     8528
      134     8529    2           IO_STATUS = %NO_RANDOM_RECORD;                       /*AUDIT*/

   8529  3 000015   000036 471500                    LDP1    30,,PR0
         3 000016   040100 100400                    MLR     fill='040'O
         3 000017   000000 000002 2                  ADSC9   0                        cn=0,n=2
         3 000020   100000 000002                    ADSC9   0,,PR1                   cn=0,n=2

      135     8530    2           CALL X9WE$IO_ERROR_STATUS (FAB, ALT_RET)

   8530  3 000021   200003 630500                    EPPR0   @FAB,,AUTO
         3 000022   000000 631400 4                  EPPR1   0
         3 000023   000000 701000 xent               TSX1    X9WE$IO_ERROR_STATUS
         3 000024   000026 702000 3                  TSX2    s:8533
         3 000025   000027 710000 3                  TRA     s:8533+1

PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:33   
      136     8531    2           WHENALTRETURN
      137     8532    3             DO;

      138     8533    3               ALTRETURN;

   8533  3 000026   000000 702200 xent               TSX2  ! X66_AALT
         3 000027   000346 710000 3                  TRA     s:8647

      139     8534    3             END;
      140     8535
      141     8536    2         CASE (%FILE_LOCKED, %FILE_CLOSED, %FILE_NEVER_OPEN);

      142     8537
      143     8538    2           IO_STATUS = %NOT_OPEN_INPUT;

   8538  3 000030   000036 471500                    LDP1    30,,PR0
         3 000031   040100 100400                    MLR     fill='040'O
         3 000032   000001 000002 2                  ADSC9   1                        cn=0,n=2
         3 000033   100000 000002                    ADSC9   0,,PR1                   cn=0,n=2

      144     8539    2           CALL X9WE$IO_ERROR_STATUS (FAB);

   8539  3 000034   200003 630500                    EPPR0   @FAB,,AUTO
         3 000035   000001 631400 4                  EPPR1   1
         3 000036   000000 701000 xent               TSX1    X9WE$IO_ERROR_STATUS
         3 000037   000000 011000                    NOP     0
         3 000040   000346 710000 3                  TRA     s:8647

      145     8540        %eject;
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:34   
      146     8541        /*------------\
      147     8542        | Read Random |
      148     8543        \------------*/
      149     8544
      150     8545    2         CASE (%FILE_OPEN);

      151     8546
      152     8547    2           DCB$ = DCBADDR (FAB.DCB_NUM);

   8547  3 000041   000002 471400 4                  LDP1    2
         3 000042   100000 473500                    LDP3    0,,PR1
         3 000043   000034 220100                    LDX0    28,,PR0
         3 000044   300000 236110                    LDQ     0,X0,PR3
         3 000045   200006 756100                    STQ     DCB$,,AUTO

      153     8548    2           IF  M$XX.FUN#  = %CREATE THEN

   8548  3 000046   200006 474500                    LDP4    DCB$,,AUTO
         3 000047   400032 236100                    LDQ     26,,PR4
         3 000050   000777 376003                    ANQ     511,DU
         3 000051   000003 116003                    CMPQ    3,DU
         3 000052   000064 601000 3                  TNZ     s:8556

      154     8549    3             DO;

      155     8550    3               IO_STATUS = %NOT_OPEN_INPUT;

   8550  3 000053   000036 475500                    LDP5    30,,PR0
         3 000054   040100 100400                    MLR     fill='040'O
         3 000055   000001 000002 2                  ADSC9   1                        cn=0,n=2
         3 000056   500000 000002                    ADSC9   0,,PR5                   cn=0,n=2

      156     8551    3               CALL X9WE$IO_ERROR_STATUS (FAB);

   8551  3 000057   200003 630500                    EPPR0   @FAB,,AUTO
         3 000060   000001 631400 4                  EPPR1   1
         3 000061   000000 701000 xent               TSX1    X9WE$IO_ERROR_STATUS
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:35   
         3 000062   000000 011000                    NOP     0

      157     8552    3               RETURN;

   8552  3 000063   000000 702200 xent               TSX2  ! X66_ARET

      158     8553    3             END;
      159     8554    2           ELSE
      160     8555    3             DO;

      161     8556    3               FAB.LAST_IO = %READ_RANDOM;

   8556  3 000064   000025 450100                    STZ     21,,PR0

      162     8557    3               FPT_READ.V.DCB# = FAB.DCB_NUM;

   8557  3 000065   000010 740000 1                  STX0    FPT_READ+8

      163     8558    3               FPT_READ.V.KEYS# = %YES#;

   8558  3 000066   200000 236007                    LDQ     65536,DL
         3 000067   000010 256000 1                  ORSQ    FPT_READ+8

      164     8559    4               DO CASE (FAB.ORG#);

   8559  3 000070   000002 235100                    LDA     2,,PR0
         3 000071   000007 115007                    CMPA    7,DL
         3 000072   000074 602005 3                  TNC     s:8559+4,AL
         3 000073   000235 710000 3                  TRA     s:8609
         3 000074   000235 710000 3                  TRA     s:8609
         3 000075   000235 710000 3                  TRA     s:8609
         3 000076   000125 710000 3                  TRA     s:8569
         3 000077   000235 710000 3                  TRA     s:8609
         3 000100   000235 710000 3                  TRA     s:8609
         3 000101   000103 710000 3                  TRA     s:8563
         3 000102   000145 710000 3                  TRA     s:8579

PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:36   
      165     8560
      166     8561    4                 CASE (%CP6_RELATIVE);

      167     8562
      168     8563    4                   CALL X8CV$CONVERT_TO_INTEGER (FAB.RELATIVE_KEY$,

   8563  3 000103   200036 635500                    EPPR5   RELATIVE_KEY,,AUTO
         3 000104   200346 455500                    STP5    SAVE_KEY+67,,AUTO
         3 000105   200003 236100                    LDQ     @FAB,,AUTO
         3 000106   000030 036003                    ADLQ    24,DU
         3 000107   200345 756100                    STQ     SAVE_KEY+66,,AUTO
         3 000110   200003 236100                    LDQ     @FAB,,AUTO
         3 000111   000053 036003                    ADLQ    43,DU
         3 000112   200344 756100                    STQ     SAVE_KEY+65,,AUTO
         3 000113   200344 630500                    EPPR0   SAVE_KEY+65,,AUTO
         3 000114   000003 631400 4                  EPPR1   3
         3 000115   000000 701000 xent               TSX1    X8CV$CONVERT_TO_INTEGER
         3 000116   000000 011000                    NOP     0

      169     8564    4                        FAB.RELATIVE_DESC, RELATIVE_KEY);
      170     8565    4                   FPT_READ.KEY_ = VECTOR  (RELATIVE_KEY);

   8565  3 000117   777640 235007                    LDA     -96,DL
         3 000120   200344 452500                    STP2    SAVE_KEY+65,,AUTO
         3 000121   200344 236100                    LDQ     SAVE_KEY+65,,AUTO
         3 000122   000036 036003                    ADLQ    30,DU
         3 000123   000002 757000 1                  STAQ    FPT_READ+2
         3 000124   000235 710000 3                  TRA     s:8609

      171     8566
      172     8567    4                 CASE (%CP6_KEYED);

      173     8568
      174     8569    4                    KEYED_KEY.LENGTH = FAB.RECORD_KEY_LEN;

   8569  3 000125   000031 236100                    LDQ     25,,PR0
         3 000126   000033 736000                    QLS     27
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:37   
         3 000127   200141 552140                    STBQ    KEYED_KEY,'40'O,AUTO

      175     8570    4                    KEYED_KEY.TEXT   = KEY_TEXT;

   8570  3 000130   000054 475500                    LDP5    44,,PR0
         3 000131   200141 236100                    LDQ     KEYED_KEY,,AUTO
         3 000132   000033 772000                    QRL     27
         3 000133   000000 621006                    EAX1    0,QL
         3 000134   040100 100540                    MLR     fill='040'O
         3 000135   500000 000011                    ADSC9   0,,PR5                   cn=0,n=*X1
         3 000136   200141 200377                    ADSC9   KEYED_KEY,,AUTO          cn=1,n=255

      176     8571    4                    FPT_READ.KEY_ = VECTOR (KEYED_KEY);

   8571  3 000137   000004 235000 4                  LDA     4
         3 000140   200344 452500                    STP2    SAVE_KEY+65,,AUTO
         3 000141   200344 236100                    LDQ     SAVE_KEY+65,,AUTO
         3 000142   000141 036003                    ADLQ    97,DU
         3 000143   000002 757000 1                  STAQ    FPT_READ+2
         3 000144   000235 710000 3                  TRA     s:8609

      177     8572        %eject;
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:38   
      178     8573        /*------------\
      179     8574        | Read Random |
      180     8575        \------------*/
      181     8576
      182     8577    4                 CASE (%CP6_INDEXED);

      183     8578
      184     8579    4                   IF INDX = 0

   8579  3 000145   200005 475500                    LDP5    @INDX,,AUTO
         3 000146   500000 235100                    LDA     0,,PR5
         3 000147   000152 600000 3                  TZE     s:8582
         3 000150   000001 115007                    CMPA    1,DL
         3 000151   000167 601000 3                  TNZ     s:8588

      185     8580    4                   OR INDX = 1 THEN       /*  we have the primary key  */
      186     8581    5                     DO;

      187     8582    5                       FPT_READ.KEY_ = VECTOR (FAB.RECORD_KEY$-> INDEX_KEY);

   8582  3 000152   000054 476500                    LDP6    44,,PR0
         3 000153   000031 721100                    LXL1    25,,PR0
         3 000154   000000 635011                    EAA     0,X1
         3 000155   000002 731000                    ARS     2
         3 000156   000140 135007                    SBLA    96,DL
         3 000157   200344 456500                    STP6    SAVE_KEY+65,,AUTO
         3 000160   200344 236100                    LDQ     SAVE_KEY+65,,AUTO
         3 000161   000002 757000 1                  STAQ    FPT_READ+2

      188     8583    5                       FPT_READ.V.INDX# = %PRIMARY_KEY;

   8583  3 000162   000001 236007                    LDQ     1,DL
         3 000163   000010 552004 1                  STBQ    FPT_READ+8,'04'O

      189     8584    5                       FAB.B.SHARED_INDEX_ALT = %NO#;

   8584  3 000164   000005 236000 4                  LDQ     5
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:39   
         3 000165   000032 356100                    ANSQ    26,,PR0

      190     8585    5                     END;

   8585  3 000166   000235 710000 3                  TRA     s:8609

      191     8586    4                   ELSE
      192     8587    5                     DO;

      193     8588    5                       INDEX_KEY$ = PINCRC  (FAB.BUFFER$,

   8588  3 000167   000055 476500                    LDP6    45,,PR0
         3 000170   500000 721100                    LXL1    0,,PR5
         3 000171   677777 236111                    LDQ     -1,X1,PR6
         3 000172   777777 376007                    ANQ     -1,DL
         3 000173   000052 477500                    LDP7    42,,PR0
         3 000174   000011 402007                    MPY     9,DL
         3 000175   700000 503506                    ABD     0,QL,PR7
         3 000176   200037 457500                    STP7    INDEX_KEY$,,AUTO

      194     8589    5                                        ALT_KEYS.K.KEYX# (INDX - 2));
      195     8590    5                       ALT_LENGTH = ALT_KEYS.K.KEYL# (INDX - 2);

   8590  3 000177   500000 721100                    LXL1    0,,PR5
         3 000200   677777 236111                    LDQ     -1,X1,PR6
         3 000201   000022 772000                    QRL     18
         3 000202   000777 376007                    ANQ     511,DL
         3 000203   200040 756100                    STQ     ALT_LENGTH,,AUTO

      196     8591    5                       FPT_READ.KEY_ = VECTOR (ALT_INDX);

   8591  3 000204   200040 235100                    LDA     ALT_LENGTH,,AUTO
         3 000205   000020 735000                    ALS     16
         3 000206   000140 135007                    SBLA    96,DL
         3 000207   200037 236100                    LDQ     INDEX_KEY$,,AUTO
         3 000210   000002 757000 1                  STAQ    FPT_READ+2

PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:40   
      197     8592    5                       FPT_READ.V.INDX# = INDX;

   8592  3 000211   500000 236100                    LDQ     0,,PR5
         3 000212   000010 552004 1                  STBQ    FPT_READ+8,'04'O

      198     8593    5                       IF  M$XX.SHARE# ~= %NONE                /*#32607*/

   8593  3 000213   400031 236100                    LDQ     25,,PR4
         3 000214   000600 376007                    ANQ     384,DL
         3 000215   000600 116007                    CMPQ    384,DL
         3 000216   000235 600000 3                  TZE     s:8609
         3 000217   000004 235100                    LDA     4,,PR0
         3 000220   000003 115007                    CMPA    3,DL
         3 000221   000235 600000 3                  TZE     s:8609

      199     8594    5                       AND FAB.ACS# ~= %FAB_RANDOM_ACCESS THEN /*#34275*/
      200     8595    6                         DO;

      201     8596    6                           FAB.B.SHARED_INDEX_ALT = %YES#;

   8596  3 000222   100000 236007                    LDQ     32768,DL
         3 000223   000032 256100                    ORSQ    26,,PR0

      202     8597    6                           FAB.B.REPOSITION = %YES#;

   8597  3 000224   040000 236007                    LDQ     16384,DL
         3 000225   000032 256100                    ORSQ    26,,PR0

      203     8598    6                           SHARED.RECNUM = 1;

   8598  3 000226   000037 471500                    LDP1    31,,PR0
         3 000227   000001 235007                    LDA     1,DL
         3 000230   100002 755100                    STA     2,,PR1

      204     8599    6                           SHARED.INDX = INDX - 2;

   8599  3 000231   000037 471500                    LDP1    31,,PR0
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:41   
         3 000232   500000 235100                    LDA     0,,PR5
         3 000233   000002 135007                    SBLA    2,DL
         3 000234   100003 755100                    STA     3,,PR1

      205     8600    6                         END;

      206     8601    5                     END;

      207     8602
      208     8603    4               END; /* case fab.org# */

      209     8604        %eject;
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:42   
      210     8605        /*------------\
      211     8606        | Read Random |
      212     8607        \------------*/
      213     8608
      214     8609    3               FPT_READ.BUF_   = VECTOR (RDB);

   8609  3 000235   200003 470500                    LDP0    @FAB,,AUTO
         3 000236   000052 471500                    LDP1    42,,PR0
         3 000237   000010 720100                    LXL0    8,,PR0
         3 000240   000000 635010                    EAA     0,X0
         3 000241   000002 731000                    ARS     2
         3 000242   000140 135007                    SBLA    96,DL
         3 000243   200344 451500                    STP1    SAVE_KEY+65,,AUTO
         3 000244   200344 236100                    LDQ     SAVE_KEY+65,,AUTO
         3 000245   000004 757000 1                  STAQ    FPT_READ+4

      215     8610
      216     8611    3               CALL M$READ (FPT_READ)

   8611  3 000246   000000 630400 1                  EPPR0   FPT_READ
         3 000247   440000 713400                    CLIMB   alt,read
         3 000250   401400 401760                    pmme    nvectors=4
         3 000251   000330 702000 3                  TSX2    s:8629

      217     8612    3                 WHENRETURN
      218     8613    4                   DO;

      219     8614    4                     FAB.B.NO_NEXT_RECORD_EXISTS = %NO#;

   8614  3 000252   200003 470500                    LDP0    @FAB,,AUTO
         3 000253   000006 236000 4                  LDQ     6
         3 000254   000032 356100                    ANSQ    26,,PR0

      220     8615    4                     FAB.LENGTH_READ = M$XX.ARS#;

   8615  3 000255   200006 471500                    LDP1    DCB$,,AUTO
         3 000256   100000 235100                    LDA     0,,PR1
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:43   
         3 000257   000033 755100                    STA     27,,PR0

      221     8616    4                     IF FAB.B.SHARED_INDEX_ALT THEN            /*#32607*/

   8616  3 000260   000032 236100                    LDQ     26,,PR0
         3 000261   100000 316007                    CANQ    32768,DL
         3 000262   000271 600000 3                  TZE     s:8618

      222     8617    4                       SUBSTR (SHARED.KEY,0,ALT_LENGTH) = ALT_INDX;

   8617  3 000263   000037 473500                    LDP3    31,,PR0
         3 000264   200037 474500                    LDP4    INDEX_KEY$,,AUTO
         3 000265   200040 720100                    LXL0    ALT_LENGTH,,AUTO
         3 000266   040140 100540                    MLR     fill='040'O
         3 000267   400000 000010                    ADSC9   0,,PR4                   cn=0,n=*X0
         3 000270   300004 000010                    ADSC9   4,,PR3                   cn=0,n=*X0

      223     8618    4                     IF FAB.LENGTH_READ < FAB.MAX_REC_LEN THEN

   8618  3 000271   000033 236100                    LDQ     27,,PR0
         3 000272   000306 604000 3                  TMI     s:8621
         3 000273   000010 116100                    CMPQ    8,,PR0
         3 000274   000306 605000 3                  TPL     s:8621

      224     8619    4                       SUBSTR (RDB.RECORD, FAB.LENGTH_READ, FAB.MAX_REC_LEN

   8619  3 000275   000052 473500                    LDP3    42,,PR0
         3 000276   000010 720100                    LXL0    8,,PR0
         3 000277   000010 236100                    LDQ     8,,PR0
         3 000300   000033 136100                    SBLQ    27,,PR0
         3 000301   000033 235100                    LDA     27,,PR0
         3 000302   000000 621006                    EAX1    0,QL
         3 000303   040145 100400                    MLR     fill='040'O
         3 000304   000007 000001 4                  ADSC9   7                        cn=0,n=1
         3 000305   300000 000011                    ADSC9   0,A,PR3                  cn=0,n=*X1

      225     8620    4                               - FAB.LENGTH_READ) = ' ';
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:44   
      226     8621    4                     IF FAB.LENGTH_READ > FAB.MAX_REC_LEN OR

   8621  3 000306   000033 236100                    LDQ     27,,PR0
         3 000307   000316 604000 3                  TMI     s:8623
         3 000310   000010 116100                    CMPQ    8,,PR0
         3 000311   000316 605400 3                  TPNZ    s:8623
         3 000312   000000 116003                    CMPQ    0,DU
         3 000313   000323 604000 3                  TMI     s:8625
         3 000314   000007 116100                    CMPQ    7,,PR0
         3 000315   000323 605000 3                  TPL     s:8625

      227     8622    4                        FAB.LENGTH_READ < FAB.MIN_REC_LEN THEN
      228     8623    4                       IO_STATUS = %BAD_LENGTH;

   8623  3 000316   000036 473500                    LDP3    30,,PR0
         3 000317   040100 100400                    MLR     fill='040'O
         3 000320   000002 000002 2                  ADSC9   2                        cn=0,n=2
         3 000321   300000 000002                    ADSC9   0,,PR3                   cn=0,n=2
         3 000322   000327 710000 3                  TRA     s:8626

      229     8624    4                     ELSE
      230     8625    4                       IO_STATUS = %SUCCESSFUL;

   8625  3 000323   000036 473500                    LDP3    30,,PR0
         3 000324   040100 100400                    MLR     fill='040'O
         3 000325   000003 000002 2                  ADSC9   3                        cn=0,n=2
         3 000326   300000 000002                    ADSC9   0,,PR3                   cn=0,n=2

      231     8626    4                   END;

   8626  3 000327   000341 710000 3                  TRA     s:8636

      232     8627    3                 WHENALTRETURN
      233     8628    4                   DO;

      234     8629    4                     FAB.B.NO_NEXT_RECORD_EXISTS = %YES#;

PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:45   
   8629  3 000330   200003 470500                    LDP0    @FAB,,AUTO
         3 000331   000002 236003                    LDQ     2,DU
         3 000332   000032 256100                    ORSQ    26,,PR0

      235     8630    4                     CALL X9WE$IO_ERROR (FAB, ALT_RET)

   8630  3 000333   200003 630500                    EPPR0   @FAB,,AUTO
         3 000334   000000 631400 4                  EPPR1   0
         3 000335   000000 701000 xent               TSX1    X9WE$IO_ERROR
         3 000336   000340 702000 3                  TSX2    s:8633
         3 000337   000341 710000 3                  TRA     s:8636

      236     8631    4                       WHENALTRETURN
      237     8632    5                         DO;

      238     8633    5                           ALTRETURN;  /* invalid key condition */

   8633  3 000340   000000 702200 xent               TSX2  ! X66_AALT

      239     8634    5                         END;
      240     8635    4                   END;

      241     8636    3             END;  /* if m$xx.fun# ~= %create */

   8636  3 000341   000346 710000 3                  TRA     s:8647

      242     8637        %eject;
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:46   
      243     8638        /*------------\
      244     8639        | Read Random |
      245     8640        \------------*/
      246     8641
      247     8642    2         CASE (ELSE);     /* Invalid file status */

      248     8643
      249     8644    2           CALL X8ER$ERROR (%UNEXPECTED_CASE, 'X9WR$RR', 7);

   8644  3 000342   000012 630400 4                  EPPR0   10
         3 000343   000003 631400 4                  EPPR1   3
         3 000344   000000 701000 xent               TSX1    X8ER$ERROR
         3 000345   000000 011000                    NOP     0

      250     8645
      251     8646    2       END;  /*  case fab.file_status */

      252     8647    1       RETURN;

   8647  3 000346   000000 702200 xent               TSX2  ! X66_ARET

      253     8648        %eject;
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:47   
      254     8649        /*------------*/
      255     8650    1   X9WR$READ_NEXT:        ENTRY (FAB, ALT_RET)  ALTRET;

   8650  3 000347   000000 700200 xent  X9WR$READ_N* TSX0  ! X66_AUTO_3
         3 000350   000350 000003                    ZERO    232,3

      256     8651        /*------------*/
      257     8652
      258     8653    2       DO CASE  (FAB.FILE_STATUS);

   8653  3 000351   200003 470500                    LDP0    @FAB,,AUTO
         3 000352   000026 235100                    LDA     22,,PR0
         3 000353   000006 115007                    CMPA    6,DL
         3 000354   000356 602005 3                  TNC     s:8653+5,AL
         3 000355   000777 710000 3                  TRA     s:8806
         3 000356   000377 710000 3                  TRA     s:8666
         3 000357   000377 710000 3                  TRA     s:8666
         3 000360   000410 710000 3                  TRA     s:8676
         3 000361   000364 710000 3                  TRA     s:8657
         3 000362   000777 710000 3                  TRA     s:8806
         3 000363   000377 710000 3                  TRA     s:8666

      259     8654
      260     8655    2         CASE (%FILE_NOT_PRESENT);

      261     8656
      262     8657    2           IO_STATUS = %END_OF_FILE;

   8657  3 000364   000036 471500                    LDP1    30,,PR0
         3 000365   040100 100400                    MLR     fill='040'O
         3 000366   000006 000002 2                  ADSC9   6                        cn=0,n=2
         3 000367   100000 000002                    ADSC9   0,,PR1                   cn=0,n=2

      263     8658    2           CALL X9WE$IO_ERROR_STATUS (FAB, ALT_RET)

   8658  3 000370   200003 630500                    EPPR0   @FAB,,AUTO
         3 000371   000000 631400 4                  EPPR1   0
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:48   
         3 000372   000000 701000 xent               TSX1    X9WE$IO_ERROR_STATUS
         3 000373   000375 702000 3                  TSX2    s:8661
         3 000374   000376 710000 3                  TRA     s:8661+1

      264     8659    2             WHENALTRETURN
      265     8660    3               DO;

      266     8661    3                 ALTRETURN;

   8661  3 000375   000000 702200 xent               TSX2  ! X66_AALT
         3 000376   001003 710000 3                  TRA     s:8808

      267     8662    3               END;
      268     8663
      269     8664    2         CASE (%FILE_LOCKED, %FILE_CLOSED, %FILE_NEVER_OPEN);

      270     8665
      271     8666    2           IO_STATUS = %NOT_OPEN_INPUT;

   8666  3 000377   000036 471500                    LDP1    30,,PR0
         3 000400   040100 100400                    MLR     fill='040'O
         3 000401   000001 000002 2                  ADSC9   1                        cn=0,n=2
         3 000402   100000 000002                    ADSC9   0,,PR1                   cn=0,n=2

      272     8667    2           CALL X9WE$IO_ERROR_STATUS (FAB);

   8667  3 000403   200003 630500                    EPPR0   @FAB,,AUTO
         3 000404   000001 631400 4                  EPPR1   1
         3 000405   000000 701000 xent               TSX1    X9WE$IO_ERROR_STATUS
         3 000406   000000 011000                    NOP     0
         3 000407   001003 710000 3                  TRA     s:8808

      273     8668
      274     8669        %eject;
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:49   
      275     8670        /*----------\
      276     8671        | Read Next |
      277     8672        \----------*/
      278     8673
      279     8674    2         CASE (%FILE_OPEN);

      280     8675
      281     8676    2            DCB$ = DCBADDR (FAB.DCB_NUM);

   8676  3 000410   000002 471400 4                  LDP1    2
         3 000411   100000 473500                    LDP3    0,,PR1
         3 000412   000034 220100                    LDX0    28,,PR0
         3 000413   300000 236110                    LDQ     0,X0,PR3
         3 000414   200006 756100                    STQ     DCB$,,AUTO

      282     8677    2            IF  M$XX.FUN#  = %CREATE THEN

   8677  3 000415   200006 474500                    LDP4    DCB$,,AUTO
         3 000416   400032 236100                    LDQ     26,,PR4
         3 000417   000777 376003                    ANQ     511,DU
         3 000420   000003 116003                    CMPQ    3,DU
         3 000421   000433 601000 3                  TNZ     s:8685

      283     8678    3              DO;

      284     8679    3                IO_STATUS = %NOT_OPEN_INPUT;

   8679  3 000422   000036 475500                    LDP5    30,,PR0
         3 000423   040100 100400                    MLR     fill='040'O
         3 000424   000001 000002 2                  ADSC9   1                        cn=0,n=2
         3 000425   500000 000002                    ADSC9   0,,PR5                   cn=0,n=2

      285     8680    3                CALL X9WE$IO_ERROR_STATUS (FAB);

   8680  3 000426   200003 630500                    EPPR0   @FAB,,AUTO
         3 000427   000001 631400 4                  EPPR1   1
         3 000430   000000 701000 xent               TSX1    X9WE$IO_ERROR_STATUS
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:50   
         3 000431   000000 011000                    NOP     0

      286     8681    3                RETURN;

   8681  3 000432   000000 702200 xent               TSX2  ! X66_ARET

      287     8682    3              END;
      288     8683    2            ELSE
      289     8684    3              DO;

      290     8685    3                FAB.LAST_IO = %READ_NEXT;

   8685  3 000433   000007 235007                    LDA     7,DL
         3 000434   000025 755100                    STA     21,,PR0

      291     8686    3                FPT_READ.V.DCB# = FAB.DCB_NUM;

   8686  3 000435   000010 740000 1                  STX0    FPT_READ+8

      292     8687    3                FPT_READ.V.KEYS# = %NO#;

   8687  3 000436   000015 236000 4                  LDQ     13
         3 000437   000010 356000 1                  ANSQ    FPT_READ+8

      293     8688    3                FPT_READ.BUF_ = VECTOR (RDB);

   8688  3 000440   000052 475500                    LDP5    42,,PR0
         3 000441   000010 721100                    LXL1    8,,PR0
         3 000442   000000 635011                    EAA     0,X1
         3 000443   000002 731000                    ARS     2
         3 000444   000140 135007                    SBLA    96,DL
         3 000445   200344 455500                    STP5    SAVE_KEY+65,,AUTO
         3 000446   200344 236100                    LDQ     SAVE_KEY+65,,AUTO
         3 000447   000004 757000 1                  STAQ    FPT_READ+4

      294     8689    3                IF FAB.B.NO_NEXT_RECORD_EXISTS  THEN

PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:51   
   8689  3 000450   000032 236100                    LDQ     26,,PR0
         3 000451   000002 316003                    CANQ    2,DU
         3 000452   000464 600000 3                  TZE     s:8699

      295     8690    4                  DO;

      296     8691    4                    IO_STATUS = %NO_NEXT_RECORD;

   8691  3 000453   000036 475500                    LDP5    30,,PR0
         3 000454   040100 100400                    MLR     fill='040'O
         3 000455   000007 000002 2                  ADSC9   7                        cn=0,n=2
         3 000456   500000 000002                    ADSC9   0,,PR5                   cn=0,n=2

      297     8692    4                    CALL X9WE$IO_ERROR_STATUS (FAB);

   8692  3 000457   200003 630500                    EPPR0   @FAB,,AUTO
         3 000460   000001 631400 4                  EPPR1   1
         3 000461   000000 701000 xent               TSX1    X9WE$IO_ERROR_STATUS
         3 000462   000000 011000                    NOP     0

      298     8693    4                    RETURN;

   8693  3 000463   000000 702200 xent               TSX2  ! X66_ARET

      299     8694    4                  END;
      300     8695        %eject;
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:52   
      301     8696        /*----------\
      302     8697        | Read Next |
      303     8698        \----------*/
      304     8699    4                DO CASE  (FAB.ORG#);

   8699  3 000464   000002 235100                    LDA     2,,PR0
         3 000465   000020 115007                    CMPA    16,DL
         3 000466   000470 602005 3                  TNC     s:8699+4,AL
         3 000467   000636 710000 3                  TRA     s:8741
         3 000470   000636 710000 3                  TRA     s:8741
         3 000471   000510 710000 3                  TRA     s:8701
         3 000472   000523 710000 3                  TRA     s:8708
         3 000473   000636 710000 3                  TRA     s:8741
         3 000474   000510 710000 3                  TRA     s:8701
         3 000475   000513 710000 3                  TRA     s:8704
         3 000476   000536 710000 3                  TRA     s:8713
         3 000477   000636 710000 3                  TRA     s:8741
         3 000500   000636 710000 3                  TRA     s:8741
         3 000501   000636 710000 3                  TRA     s:8741
         3 000502   000636 710000 3                  TRA     s:8741
         3 000503   000636 710000 3                  TRA     s:8741
         3 000504   000636 710000 3                  TRA     s:8741
         3 000505   000636 710000 3                  TRA     s:8741
         3 000506   000636 710000 3                  TRA     s:8741
         3 000507   000510 710000 3                  TRA     s:8701

      305     8700    4                  CASE (%CP6_SEQUENTIAL, %CP6_UR, %CP6_FIXED); /*#31822*/

      306     8701    4                    FPT_READ.V.KEYR# = NO#;

   8701  3 000510   000005 236000 4                  LDQ     5
         3 000511   000010 356000 1                  ANSQ    FPT_READ+8
         3 000512   000642 710000 3                  TRA     REREAD

      307     8702
      308     8703    4                  CASE (%CP6_RELATIVE);

PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:53   
      309     8704    4                    FPT_READ.V.KEYR# = YES#;

   8704  3 000513   100000 236007                    LDQ     32768,DL
         3 000514   000010 256000 1                  ORSQ    FPT_READ+8

      310     8705    4                    FPT_READ.KEY_    = VECTOR (RELATIVE_KEY);

   8705  3 000515   777640 235007                    LDA     -96,DL
         3 000516   200344 452500                    STP2    SAVE_KEY+65,,AUTO
         3 000517   200344 236100                    LDQ     SAVE_KEY+65,,AUTO
         3 000520   000036 036003                    ADLQ    30,DU
         3 000521   000002 757000 1                  STAQ    FPT_READ+2
         3 000522   000642 710000 3                  TRA     REREAD

      311     8706
      312     8707    4                  CASE (%CP6_KEYED);

      313     8708    4                    FPT_READ.V.KEYR# = YES#;

   8708  3 000523   100000 236007                    LDQ     32768,DL
         3 000524   000010 256000 1                  ORSQ    FPT_READ+8

      314     8709    4                    KEYED_KEY.LENGTH = FAB.RECORD_KEY_LEN;

   8709  3 000525   000031 236100                    LDQ     25,,PR0
         3 000526   000033 736000                    QLS     27
         3 000527   200141 552140                    STBQ    KEYED_KEY,'40'O,AUTO

      315     8710    4                    FPT_READ.KEY_   = VECTOR (KEYED_KEY);

   8710  3 000530   000004 235000 4                  LDA     4
         3 000531   200344 452500                    STP2    SAVE_KEY+65,,AUTO
         3 000532   200344 236100                    LDQ     SAVE_KEY+65,,AUTO
         3 000533   000141 036003                    ADLQ    97,DU
         3 000534   000002 757000 1                  STAQ    FPT_READ+2
         3 000535   000642 710000 3                  TRA     REREAD

PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:54   
      316     8711        %eject;
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:55   
      317     8712    4                  CASE (%CP6_INDEXED);

      318     8713    4                    FPT_READ.V.INDX# = 0;

   8713  3 000536   000000 236003                    LDQ     0,DU
         3 000537   000010 552004 1                  STBQ    FPT_READ+8,'04'O

      319     8714    4                    FPT_READ.V.KEYR# = NO#;                    /*#40727*/

   8714  3 000540   000005 236000 4                  LDQ     5
         3 000541   000010 356000 1                  ANSQ    FPT_READ+8

      320     8715    4                    IF FAB.B.SHARED_INDEX_ALT THEN             /*#24102*/

   8715  3 000542   000032 236100                    LDQ     26,,PR0
         3 000543   100000 316007                    CANQ    32768,DL
         3 000544   000642 600000 3                  TZE     REREAD

      321     8716    5                      DO;

      322     8717    5                        INDEX_KEY$ = PINCRC (FAB.BUFFER$,

   8717  3 000545   000037 475500                    LDP5    31,,PR0
         3 000546   000055 476500                    LDP6    45,,PR0
         3 000547   500003 720100                    LXL0    3,,PR5
         3 000550   600001 236110                    LDQ     1,X0,PR6
         3 000551   777777 376007                    ANQ     -1,DL
         3 000552   000052 477500                    LDP7    42,,PR0
         3 000553   000011 402007                    MPY     9,DL
         3 000554   700000 503506                    ABD     0,QL,PR7
         3 000555   200037 457500                    STP7    INDEX_KEY$,,AUTO

      323     8718    5                                             ALT_KEYS.K.KEYX# (SHARED.INDX));
      324     8719    5                        ALT_LENGTH = ALT_KEYS.K.KEYL# (SHARED.INDX);

   8719  3 000556   600001 236110                    LDQ     1,X0,PR6
         3 000557   000022 772000                    QRL     18
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:56   
         3 000560   000777 376007                    ANQ     511,DL
         3 000561   200040 756100                    STQ     ALT_LENGTH,,AUTO

      325     8720    5                        SUBSTR (ALT_INDX,0,ALT_LENGTH) = SUBSTR (SHARED.KEY,0,
              8720                                 ALT_LENGTH);

   8720  3 000562   000000 621006                    EAX1    0,QL
         3 000563   200040 722100                    LXL2    ALT_LENGTH,,AUTO
         3 000564   040140 100540                    MLR     fill='040'O
         3 000565   500004 000011                    ADSC9   4,,PR5                   cn=0,n=*X1
         3 000566   700000 000012                    ADSC9   0,,PR7                   cn=0,n=*X2

      326     8721    5                        FPT_READ.V.KEYS# = %YES#;

   8721  3 000567   200000 236007                    LDQ     65536,DL
         3 000570   000010 256000 1                  ORSQ    FPT_READ+8

      327     8722    5                        FPT_READ.V.INDX# = SHARED.INDX + 2;

   8722  3 000571   000037 475500                    LDP5    31,,PR0
         3 000572   500003 236100                    LDQ     3,,PR5
         3 000573   000002 036007                    ADLQ    2,DL
         3 000574   000010 552004 1                  STBQ    FPT_READ+8,'04'O

      328     8723    5                        FPT_READ.KEY_ = VECTOR (ALT_INDX);

   8723  3 000575   200040 235100                    LDA     ALT_LENGTH,,AUTO
         3 000576   000020 735000                    ALS     16
         3 000577   000140 135007                    SBLA    96,DL
         3 000600   200037 236100                    LDQ     INDEX_KEY$,,AUTO
         3 000601   000002 757000 1                  STAQ    FPT_READ+2

      329     8724    5                        IF FAB.B.REPOSITION THEN

   8724  3 000602   000032 236100                    LDQ     26,,PR0
         3 000603   040000 316007                    CANQ    16384,DL
         3 000604   000627 600000 3                  TZE     s:8736
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:57   

      330     8725    5                          CALL NEXT_ALTKEY

   8725  3 000605   001605 701000 3                  TSX1    NEXT_ALTKEY
         3 000606   000610 702000 3                  TSX2    s:8728
         3 000607   000627 710000 3                  TRA     s:8736

      331     8726    5                            WHENALTRETURN
      332     8727    6                              DO;

      333     8728    6                                IO_STATUS = %END_OF_FILE;

   8728  3 000610   200003 470500                    LDP0    @FAB,,AUTO
         3 000611   000036 471500                    LDP1    30,,PR0
         3 000612   040100 100400                    MLR     fill='040'O
         3 000613   000006 000002 2                  ADSC9   6                        cn=0,n=2
         3 000614   100000 000002                    ADSC9   0,,PR1                   cn=0,n=2

      334     8729    6                                CALL X9WE$IO_ERROR_STATUS (FAB,ALT_RET) /*#37712*/

   8729  3 000615   200003 630500                    EPPR0   @FAB,,AUTO
         3 000616   000000 631400 4                  EPPR1   0
         3 000617   000000 701000 xent               TSX1    X9WE$IO_ERROR_STATUS
         3 000620   000622 702000 3                  TSX2    s:8731
         3 000621   000626 710000 3                  TRA     s:8734

      335     8730    7                                     WHENALTRETURN DO;                  /*#37712*/

      336     8731    7                                                        IF   ALT_RET    /*#37712*/

   8731  3 000622   200004 470500                    LDP0    @ALT_RET,,AUTO
         3 000623   000000 234100                    SZN     0,,PR0
         3 000624   000626 605000 3                  TPL     s:8734

      337     8732    7                                                        THEN ALTRETURN; /*#37712*/

   8732  3 000625   000000 702200 xent               TSX2  ! X66_AALT
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:58   

      338     8733    7                                                   END;                 /*#37712*/
      339     8734    6                                RETURN;                                 /*#37712*/

   8734  3 000626   000000 702200 xent               TSX2  ! X66_ARET

      340     8735    6                              END;
      341     8736    5                        FAB.B.REPOSITION = %YES#;

   8736  3 000627   200003 470500                    LDP0    @FAB,,AUTO
         3 000630   040000 236007                    LDQ     16384,DL
         3 000631   000032 256100                    ORSQ    26,,PR0

      342     8737    5                        FPT_READ.V.RECNUM# = SHARED.RECNUM;

   8737  3 000632   000037 471500                    LDP1    31,,PR0
         3 000633   100002 720100                    LXL0    2,,PR1
         3 000634   000013 440000 1                  SXL0    FPT_READ+11

      343     8738    5                      END;

   8738  3 000635   000642 710000 3                  TRA     REREAD

      344     8739
      345     8740    4                  CASE (ELSE);

      346     8741    4                    CALL X8ER$ERROR (%UNEXPECTED_CASE, 'X9WR$RN_ORG', 11);

   8741  3 000636   000017 630400 4                  EPPR0   15
         3 000637   000003 631400 4                  EPPR1   3
         3 000640   000000 701000 xent               TSX1    X8ER$ERROR
         3 000641   000000 011000                    NOP     0

      347     8742    4                END; /* case fab.org */

      348     8743        %eject;
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:59   
      349     8744        /*----------\
      350     8745        | Read Next |
      351     8746        \----------*/
      352     8747
      353     8748    3   REREAD:   CALL READ

   8748  3 000642   001004 701000 3     REREAD       TSX1    READ
         3 000643   000764 702000 3                  TSX2    s:8797

      354     8749    3               WHENRETURN
      355     8750    4                 DO;

      356     8751    4                   IF FAB.PAD_CHAR$ ~= ADDR(NIL) THEN

   8751  3 000644   200003 470500                    LDP0    @FAB,,AUTO
         3 000645   000035 236100                    LDQ     29,,PR0
         3 000646   000022 116000 4                  CMPQ    18
         3 000647   000671 600000 3                  TZE     s:8760

      357     8752    5   PAD:              DO;

   8752  3 000650                       PAD          null
      358     8753    6                       DO I = 0 TO FAB.LENGTH_READ;

   8753  3 000650   200035 450100                    STZ     I,,AUTO
         3 000651   000664 710000 3                  TRA     s:8756+1

      359     8754    6                         IF SUBSTR (RDB.RECORD,I,1) ~= PAD_CHAR THEN

   8754  3 000652   200003 470500                    LDP0    @FAB,,AUTO
         3 000653   000052 471500                    LDP1    42,,PR0
         3 000654   000010 720100                    LXL0    8,,PR0
         3 000655   000035 473500                    LDP3    29,,PR0
         3 000656   200035 235100                    LDA     I,,AUTO
         3 000657   040100 106505                    CMPC    fill='040'O
         3 000660   100000 000001                    ADSC9   0,A,PR1                  cn=0,n=1
         3 000661   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:60   
         3 000662   000671 601000 3                  TNZ     s:8760

      360     8755    6                           EXIT PAD;
      361     8756    6                       END;

   8756  3 000663   200035 054100                    AOS     I,,AUTO
         3 000664   000033 236100                    LDQ     27,,PR0
         3 000665   000652 604000 3                  TMI     s:8754
         3 000666   200035 116100                    CMPQ    I,,AUTO
         3 000667   000652 605000 3                  TPL     s:8754

      362     8757    5                       GOTO REREAD;  /* Record was all pad_chars read  */

   8757  3 000670   000642 710000 3                  TRA     REREAD

      363     8758    5                     END;            /* another one into the buffer.   */
      364     8759
      365     8760    4                   FAB.B.NO_NEXT_RECORD_EXISTS = %NO#;

   8760  3 000671   000006 236000 4                  LDQ     6
         3 000672   000032 356100                    ANSQ    26,,PR0

      366     8761
      367     8762    5                   DO CASE  (FAB.ORG#);

   8762  3 000673   000002 235100                    LDA     2,,PR0
         3 000674   000006 115007                    CMPA    6,DL
         3 000675   000677 602005 3                  TNC     s:8762+4,AL
         3 000676   000745 710000 3                  TRA     s:8788
         3 000677   000745 710000 3                  TRA     s:8788
         3 000700   000745 710000 3                  TRA     s:8788
         3 000701   000736 710000 3                  TRA     s:8784
         3 000702   000745 710000 3                  TRA     s:8788
         3 000703   000745 710000 3                  TRA     s:8788
         3 000704   000705 710000 3                  TRA     s:8766

      368     8763
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:61   
      369     8764    5                     CASE  (%CP6_RELATIVE);

      370     8765
      371     8766    5                       CALL X8CV$CONVERT_FROM_INTEGER (FAB.RELATIVE_KEY$,

   8766  3 000705   200036 631500                    EPPR1   RELATIVE_KEY,,AUTO
         3 000706   200346 451500                    STP1    SAVE_KEY+67,,AUTO
         3 000707   200003 236100                    LDQ     @FAB,,AUTO
         3 000710   000030 036003                    ADLQ    24,DU
         3 000711   200345 756100                    STQ     SAVE_KEY+66,,AUTO
         3 000712   200003 236100                    LDQ     @FAB,,AUTO
         3 000713   000053 036003                    ADLQ    43,DU
         3 000714   200344 756100                    STQ     SAVE_KEY+65,,AUTO
         3 000715   200344 630500                    EPPR0   SAVE_KEY+65,,AUTO
         3 000716   000003 631400 4                  EPPR1   3
         3 000717   000000 701000 xent               TSX1    X8CV$CONVERT_FROM_INTEGER
         3 000720   000722 702000 3                  TSX2    s:8770
         3 000721   000735 710000 3                  TRA     s:8776

      372     8767    5                             FAB.RELATIVE_DESC, RELATIVE_KEY)
      373     8768    5                         WHENALTRETURN
      374     8769    6                           DO;

      375     8770    6                             IO_STATUS = %KEY_OVERFLOW;

   8770  3 000722   200003 470500                    LDP0    @FAB,,AUTO
         3 000723   000036 471500                    LDP1    30,,PR0
         3 000724   040100 100400                    MLR     fill='040'O
         3 000725   000013 000002 2                  ADSC9   11                       cn=0,n=2
         3 000726   100000 000002                    ADSC9   0,,PR1                   cn=0,n=2

      376     8771    6                             CALL X9WE$IO_ERROR_STATUS (FAB, ALT_RET)

   8771  3 000727   200003 630500                    EPPR0   @FAB,,AUTO
         3 000730   000000 631400 4                  EPPR1   0
         3 000731   000000 701000 xent               TSX1    X9WE$IO_ERROR_STATUS
         3 000732   000734 702000 3                  TSX2    s:8774
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:62   
         3 000733   000735 710000 3                  TRA     s:8776

      377     8772    6                               WHENALTRETURN
      378     8773    7                                 DO;

      379     8774    7                                   ALTRETURN;

   8774  3 000734   000000 702200 xent               TSX2  ! X66_AALT

      380     8775    7                                 END;
      381     8776    6                           END;

   8776  3 000735   000745 710000 3                  TRA     s:8788

      382     8777        %eject;
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:63   
      383     8778        /*----------\
      384     8779        | Read Next |
      385     8780        \----------*/
      386     8781
      387     8782    5                     CASE  (%CP6_KEYED);

      388     8783
      389     8784    5                       FAB.RECORD_KEY$-> KEY_TEXT = KEYED_KEY.TEXT;

   8784  3 000736   000054 471500                    LDP1    44,,PR0
         3 000737   200141 236100                    LDQ     KEYED_KEY,,AUTO
         3 000740   000033 772000                    QRL     27
         3 000741   000000 620006                    EAX0    0,QL
         3 000742   040140 100500                    MLR     fill='040'O
         3 000743   200141 200377                    ADSC9   KEYED_KEY,,AUTO          cn=1,n=255
         3 000744   100000 000010                    ADSC9   0,,PR1                   cn=0,n=*X0

      390     8785
      391     8786    5                   END; /* case fab.org# */

      392     8787
      393     8788    4                   IF  FAB.LENGTH_READ < FAB.MAX_REC_LEN THEN

   8788  3 000745   200003 470500                    LDP0    @FAB,,AUTO
         3 000746   000033 236100                    LDQ     27,,PR0
         3 000747   000763 604000 3                  TMI     s:8793
         3 000750   000010 116100                    CMPQ    8,,PR0
         3 000751   000763 605000 3                  TPL     s:8793

      394     8789    5                     DO;

      395     8790    5                       SUBSTR (RDB.RECORD, FAB.LENGTH_READ, FAB.MAX_REC_LEN

   8790  3 000752   000052 471500                    LDP1    42,,PR0
         3 000753   000010 720100                    LXL0    8,,PR0
         3 000754   000010 236100                    LDQ     8,,PR0
         3 000755   000033 136100                    SBLQ    27,,PR0
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:64   
         3 000756   000033 235100                    LDA     27,,PR0
         3 000757   000000 621006                    EAX1    0,QL
         3 000760   040145 100400                    MLR     fill='040'O
         3 000761   000007 000001 4                  ADSC9   7                        cn=0,n=1
         3 000762   100000 000011                    ADSC9   0,A,PR1                  cn=0,n=*X1

      396     8791    5                          - FAB.LENGTH_READ) = ' ';
      397     8792    5                     END;

      398     8793    4                 END;

   8793  3 000763   000776 710000 3                  TRA     s:8803

      399     8794
      400     8795    3               WHENALTRETURN             /* CALL READ */
      401     8796    4                 DO;

      402     8797    4                   FAB.B.NO_NEXT_RECORD_EXISTS = %YES#;

   8797  3 000764   200003 470500                    LDP0    @FAB,,AUTO
         3 000765   000002 236003                    LDQ     2,DU
         3 000766   000032 256100                    ORSQ    26,,PR0

      403     8798    4                   IF SUBSTR (IO_STATUS,0,1) = '1' THEN

   8798  3 000767   000036 471500                    LDP1    30,,PR0
         3 000770   040000 106500                    CMPC    fill='040'O
         3 000771   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
         3 000772   000023 000001 4                  ADSC9   19                       cn=0,n=1
         3 000773   000775 601000 3                  TNZ     s:8801

      404     8799    4                     ALTRETURN;

   8799  3 000774   000000 702200 xent               TSX2  ! X66_AALT

      405     8800    4                   ELSE
      406     8801    4                     RETURN;
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:65   

   8801  3 000775   000000 702200 xent               TSX2  ! X66_ARET

      407     8802    4                 END;
      408     8803    3               END; /* if m$xx.fun# ~= %create */

   8803  3 000776   001003 710000 3                  TRA     s:8808

      409     8804
      410     8805    2         CASE (ELSE);

      411     8806    2           CALL X8ER$ERROR (%UNEXPECTED_CASE, 'X9WR$RN', 7);

   8806  3 000777   000024 630400 4                  EPPR0   20
         3 001000   000003 631400 4                  EPPR1   3
         3 001001   000000 701000 xent               TSX1    X8ER$ERROR
         3 001002   000000 011000                    NOP     0

      412     8807
      413     8808    2       END;  /* case fab.file_status */

   8808  3 001003   002003 710000 3                  TRA     s:9121

      414     8809        %eject;
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:66   
      415     8810        /*----*/
      416     8811    1     READ:                PROC  ALTRET;

   8811  3 001004   200242 741300       READ         STX1  ! KEYED_KEY+65,,AUTO

      417     8812        /*----*/
      418     8813        /*I*
      419     8814               NAME:  X9WR$READ_NEXT:READ
      420     8815            PURPOSE:  This procedure provides the interface to the CP-6
      421     8816                      Monitor Service function M$READ.  It will also use
      422     8817                      fast sequential file access (XSA$READ) whenever possible.
      423     8818        */
      424     8819    2       IF FAB.B.FAST_SEQUENTIAL THEN

   8819  3 001005   200003 470500                    LDP0    @FAB,,AUTO
         3 001006   000032 236100                    LDQ     26,,PR0
         3 001007   000004 316003                    CANQ    4,DU
         3 001010   001072 600000 3                  TZE     s:8848

      425     8820    2           CALL XSA$READ (FPT_READ, FAB.XSA)

   8820  3 001011   200003 236100                    LDQ     @FAB,,AUTO
         3 001012   000060 036003                    ADLQ    48,DU
         3 001013   000027 235000 4                  LDA     23
         3 001014   200344 757100                    STAQ    SAVE_KEY+65,,AUTO
         3 001015   200344 630500                    EPPR0   SAVE_KEY+65,,AUTO
         3 001016   000000 631400 4                  EPPR1   0
         3 001017   000000 701000 xent               TSX1    XSA$READ
         3 001020   001046 702000 3                  TSX2    s:8832

      426     8821    2             WHENRETURN
      427     8822    3               DO;

      428     8823    3                 FAB.LENGTH_READ = FAB.XSA.ARS#;

   8823  3 001021   200003 470500                    LDP0    @FAB,,AUTO
         3 001022   000060 235100                    LDA     48,,PR0
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:67   
         3 001023   000033 755100                    STA     27,,PR0

      429     8824    3                 IF FAB.LENGTH_READ < FAB.MIN_REC_LEN

   8824  3 001024   000033 236100                    LDQ     27,,PR0
         3 001025   001030 604000 3                  TMI     s:8824+4
         3 001026   000007 116100                    CMPQ    7,,PR0
         3 001027   001034 604000 3                  TMI     s:8826
         3 001030   000000 116003                    CMPQ    0,DU
         3 001031   001034 604000 3                  TMI     s:8826
         3 001032   000010 116100                    CMPQ    8,,PR0
         3 001033   001041 604400 3                  TMOZ    s:8828

      430     8825    3                 OR FAB.LENGTH_READ > FAB.MAX_REC_LEN THEN
      431     8826    3                   IO_STATUS = %BAD_LENGTH;

   8826  3 001034   000036 471500                    LDP1    30,,PR0
         3 001035   040100 100400                    MLR     fill='040'O
         3 001036   000002 000002 2                  ADSC9   2                        cn=0,n=2
         3 001037   100000 000002                    ADSC9   0,,PR1                   cn=0,n=2
         3 001040   001045 710000 3                  TRA     s:8829

      432     8827    3                 ELSE
      433     8828    3                   IO_STATUS = %SUCCESSFUL;

   8828  3 001041   000036 471500                    LDP1    30,,PR0
         3 001042   040100 100400                    MLR     fill='040'O
         3 001043   000003 000002 2                  ADSC9   3                        cn=0,n=2
         3 001044   100000 000002                    ADSC9   0,,PR1                   cn=0,n=2

      434     8829    3               END;

   8829  3 001045   001071 710000 3                  TRA     s:8843+2

      435     8830    2             WHENALTRETURN
      436     8831    3               DO;

PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:68   
      437     8832    3                 FAB.LENGTH_READ = FAB.XSA.ARS#;

   8832  3 001046   200003 470500                    LDP0    @FAB,,AUTO
         3 001047   000060 235100                    LDA     48,,PR0
         3 001050   000033 755100                    STA     27,,PR0

      438     8833    3                 CALL X9WE$IO_ERROR (FAB, ALT_RET)

   8833  3 001051   200003 630500                    EPPR0   @FAB,,AUTO
         3 001052   000000 631400 4                  EPPR1   0
         3 001053   000000 701000 xent               TSX1    X9WE$IO_ERROR
         3 001054   001067 702000 3                  TSX2    s:8843

      439     8834    3                   WHENRETURN
      440     8835    4                     DO;

      441     8836    4                       IF IO_STATUS = '04' THEN

   8836  3 001055   200003 470500                    LDP0    @FAB,,AUTO
         3 001056   000036 471500                    LDP1    30,,PR0
         3 001057   040000 106500                    CMPC    fill='040'O
         3 001060   100000 000002                    ADSC9   0,,PR1                   cn=0,n=2
         3 001061   000002 000002 2                  ADSC9   2                        cn=0,n=2
         3 001062   001065 601000 3                  TNZ     s:8839

      442     8837    4                         RETURN;

   8837  3 001063   200242 221300                    LDX1  ! KEYED_KEY+65,,AUTO
         3 001064   000001 702211                    TSX2  ! 1,X1

      443     8838    4                       ELSE
      444     8839    4                         ALTRETURN;

   8839  3 001065   200242 221300                    LDX1  ! KEYED_KEY+65,,AUTO
         3 001066   000000 702211                    TSX2  ! 0,X1

      445     8840    4                     END;
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:69   
      446     8841    3                   WHENALTRETURN
      447     8842    4                     DO;

      448     8843    4                       ALTRETURN;

   8843  3 001067   200242 221300                    LDX1  ! KEYED_KEY+65,,AUTO
         3 001070   000000 702211                    TSX2  ! 0,X1
         3 001071   001603 710000 3                  TRA     s:9009

      449     8844    4                     END;
      450     8845    3                END;
      451     8846        %eject;
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:70   
      452     8847    2       ELSE
      453     8848    2           CALL M$READ (FPT_READ)

   8848  3 001072   000000 630400 1                  EPPR0   FPT_READ
         3 001073   440000 713400                    CLIMB   alt,read
         3 001074   401400 401760                    pmme    nvectors=4
         3 001075   001124 702000 3                  TSX2    s:8860

      454     8849    2             WHENRETURN
      455     8850    3               DO;

      456     8851    3                 FAB.LENGTH_READ = M$XX.ARS#;

   8851  3 001076   200006 470500                    LDP0    DCB$,,AUTO
         3 001077   000000 235100                    LDA     0,,PR0
         3 001100   200003 471500                    LDP1    @FAB,,AUTO
         3 001101   100033 755100                    STA     27,,PR1

      457     8852    3                 IF FAB.LENGTH_READ < FAB.MIN_REC_LEN

   8852  3 001102   100033 236100                    LDQ     27,,PR1
         3 001103   001106 604000 3                  TMI     s:8852+4
         3 001104   100007 116100                    CMPQ    7,,PR1
         3 001105   001112 604000 3                  TMI     s:8854
         3 001106   000000 116003                    CMPQ    0,DU
         3 001107   001112 604000 3                  TMI     s:8854
         3 001110   100010 116100                    CMPQ    8,,PR1
         3 001111   001117 604400 3                  TMOZ    s:8856

      458     8853    3                 OR FAB.LENGTH_READ > FAB.MAX_REC_LEN THEN
      459     8854    3                   IO_STATUS = %BAD_LENGTH;

   8854  3 001112   100036 473500                    LDP3    30,,PR1
         3 001113   040100 100400                    MLR     fill='040'O
         3 001114   000002 000002 2                  ADSC9   2                        cn=0,n=2
         3 001115   300000 000002                    ADSC9   0,,PR3                   cn=0,n=2
         3 001116   001123 710000 3                  TRA     s:8857
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:71   

      460     8855    3                 ELSE
      461     8856    3                   IO_STATUS = %SUCCESSFUL;

   8856  3 001117   100036 473500                    LDP3    30,,PR1
         3 001120   040100 100400                    MLR     fill='040'O
         3 001121   000003 000002 2                  ADSC9   3                        cn=0,n=2
         3 001122   300000 000002                    ADSC9   0,,PR3                   cn=0,n=2

      462     8857    3               END;

   8857  3 001123   001603 710000 3                  TRA     s:9009

      463     8858    2             WHENALTRETURN
      464     8859    3               DO;

      465     8860    3                 IF B$TCB$ -> B$TCB.ALT$ -> B$ALT.ERR.ERR# = %E$EOVOL THEN

   8860  3 001124   000000 470400 xsym               LDP0    B$TCB$
         3 001125   000000 471500                    LDP1    0,,PR0
         3 001126   100102 236100                    LDQ     66,,PR1
         3 001127   377770 376007                    ANQ     131064,DL
         3 001130   013130 116007                    CMPQ    5720,DL
         3 001131   001557 601000 3                  TNZ     s:8993

      466     8861    4                   DO;

      467     8862                          %SWAP_VOLUME_AND_REREAD;

   8864  3 001132   200003 473500                    LDP3    @FAB,,AUTO
         3 001133   300034 220100                    LDX0    28,,PR3
         3 001134   000024 740000 1                  STX0    CLOSE_VOLUME+6

   8867  3 001135   300040 236100                    LDQ     32,,PR3
         3 001136   000022 116000 4                  CMPQ    18
         3 001137   001253 600000 3                  TZE     s:8902

PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:72   
   8869  3 001140   200007 756100                    STQ     USE$$,,AUTO

   8870  3 001141   000002 471400 4                  LDP1    2
         3 001142   100000 474500                    LDP4    0,,PR1
         3 001143   400000 236110                    LDQ     0,X0,PR4
         3 001144   200006 756100                    STQ     DCB$,,AUTO

   8871  3 001145   200006 475500                    LDP5    DCB$,,AUTO
         3 001146   500032 221100                    LDX1    26,,PR5
         3 001147   000777 361003                    ANX1    511,DU
         3 001150   000004 101003                    CMPX1   4,DU
         3 001151   001153 602011 3                  TNC     s:8871+6,X1
         3 001152   001253 710000 3                  TRA     s:8902
         3 001153   001253 710000 3                  TRA     s:8902
         3 001154   001253 710000 3                  TRA     s:8902
         3 001155   001231 710000 3                  TRA     s:8892
         3 001156   001157 710000 3                  TRA     s:8873

   8873  3 001157   500031 236100                    LDQ     25,,PR5
         3 001160   003000 376007                    ANQ     1536,DL
         3 001161   002000 116007                    CMPQ    1024,DL
         3 001162   001206 601000 3                  TNZ     s:8884

   8875  3 001163   200007 476500                    LDP6    USE$$,,AUTO
         3 001164   600021 236100                    LDQ     17,,PR6
         3 001165   200010 756100                    STQ     USE_ENTRY$,,AUTO

   8876  3 001166   000030 116000 4                  CMPQ    24
         3 001167   001174 600000 3                  TZE     s:8878

   8877  3 001170   200010 222100                    LDX2    USE_ENTRY$,,AUTO
         3 001171   000030 631400 4                  EPPR1   24
         3 001172   000000 701012                    TSX1    0,X2
         3 001173   000000 011000                    NOP     0

   8878  3 001174   200007 470500                    LDP0    USE$$,,AUTO
         3 001175   000016 236100                    LDQ     14,,PR0
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:73   
         3 001176   200010 756100                    STQ     USE_ENTRY$,,AUTO

   8879  3 001177   000030 116000 4                  CMPQ    24
         3 001200   001253 600000 3                  TZE     s:8902

   8880  3 001201   200010 220100                    LDX0    USE_ENTRY$,,AUTO
         3 001202   000030 631400 4                  EPPR1   24
         3 001203   000000 701010                    TSX1    0,X0
         3 001204   000000 011000                    NOP     0

   8881  3 001205   001253 710000 3                  TRA     s:8902

   8884  3 001206   200007 476500                    LDP6    USE$$,,AUTO
         3 001207   600020 236100                    LDQ     16,,PR6
         3 001210   200010 756100                    STQ     USE_ENTRY$,,AUTO

   8885  3 001211   000030 116000 4                  CMPQ    24
         3 001212   001217 600000 3                  TZE     s:8887

   8886  3 001213   200010 222100                    LDX2    USE_ENTRY$,,AUTO
         3 001214   000030 631400 4                  EPPR1   24
         3 001215   000000 701012                    TSX1    0,X2
         3 001216   000000 011000                    NOP     0

   8887  3 001217   200007 470500                    LDP0    USE$$,,AUTO
         3 001220   000015 236100                    LDQ     13,,PR0
         3 001221   200010 756100                    STQ     USE_ENTRY$,,AUTO

   8888  3 001222   000030 116000 4                  CMPQ    24
         3 001223   001253 600000 3                  TZE     s:8902

   8889  3 001224   200010 220100                    LDX0    USE_ENTRY$,,AUTO
         3 001225   000030 631400 4                  EPPR1   24
         3 001226   000000 701010                    TSX1    0,X0
         3 001227   000000 011000                    NOP     0

   8890  3 001230   001253 710000 3                  TRA     s:8902
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:74   

   8892  3 001231   200007 476500                    LDP6    USE$$,,AUTO
         3 001232   600017 236100                    LDQ     15,,PR6
         3 001233   200010 756100                    STQ     USE_ENTRY$,,AUTO

   8893  3 001234   000030 116000 4                  CMPQ    24
         3 001235   001242 600000 3                  TZE     s:8895

   8894  3 001236   200010 222100                    LDX2    USE_ENTRY$,,AUTO
         3 001237   000030 631400 4                  EPPR1   24
         3 001240   000000 701012                    TSX1    0,X2
         3 001241   000000 011000                    NOP     0

   8895  3 001242   200007 470500                    LDP0    USE$$,,AUTO
         3 001243   000014 236100                    LDQ     12,,PR0
         3 001244   200010 756100                    STQ     USE_ENTRY$,,AUTO

   8896  3 001245   000030 116000 4                  CMPQ    24
         3 001246   001253 600000 3                  TZE     s:8902

   8897  3 001247   200010 220100                    LDX0    USE_ENTRY$,,AUTO
         3 001250   000030 631400 4                  EPPR1   24
         3 001251   000000 701010                    TSX1    0,X0
         3 001252   000000 011000                    NOP     0

   8902  3 001253   200003 470500                    LDP0    @FAB,,AUTO
         3 001254   000032 236100                    LDQ     26,,PR0
         3 001255   000100 316003                    CANQ    64,DU
         3 001256   001271 600000 3                  TZE     s:8906

   8903  3 001257   000032 236000 4                  LDQ     26
         3 001260   200346 756100                    STQ     SAVE_KEY+67,,AUTO
         3 001261   000033 236000 4                  LDQ     27
         3 001262   200003 235100                    LDA     @FAB,,AUTO
         3 001263   200344 757100                    STAQ    SAVE_KEY+65,,AUTO
         3 001264   200344 630500                    EPPR0   SAVE_KEY+65,,AUTO
         3 001265   000003 631400 4                  EPPR1   3
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:75   
         3 001266   000000 701000 xent               TSX1    X9WU$WRITE_USER_LABEL
         3 001267   000000 011000                    NOP     0
         3 001270   001273 710000 3                  TRA     s:8907

   8906  3 001271   000034 237000 4                  LDAQ    28
         3 001272   000022 757000 1                  STAQ    CLOSE_VOLUME+4

   8907  3 001273   200003 470500                    LDP0    @FAB,,AUTO
         3 001274   000032 236100                    LDQ     26,,PR0
         3 001275   000020 316003                    CANQ    16,DU
         3 001276   001311 600000 3                  TZE     s:8911

   8908  3 001277   000037 236000 4                  LDQ     31
         3 001300   200346 756100                    STQ     SAVE_KEY+67,,AUTO
         3 001301   000040 236000 4                  LDQ     32
         3 001302   200003 235100                    LDA     @FAB,,AUTO
         3 001303   200344 757100                    STAQ    SAVE_KEY+65,,AUTO
         3 001304   200344 630500                    EPPR0   SAVE_KEY+65,,AUTO
         3 001305   000003 631400 4                  EPPR1   3
         3 001306   000000 701000 xent               TSX1    X9WU$WRITE_USER_LABEL
         3 001307   000000 011000                    NOP     0
         3 001310   001313 710000 3                  TRA     s:8912

   8911  3 001311   000034 237000 4                  LDAQ    28
         3 001312   000020 757000 1                  STAQ    CLOSE_VOLUME+2

   8912  3 001313   000016 630400 1                  EPPR0   CLOSE_VOLUME
         3 001314   450004 713400                    CLIMB   alt,+20484
         3 001315   401000 401760                    pmme    nvectors=3
         3 001316   001320 702000 3                  TSX2    s:8915
         3 001317   001326 710000 3                  TRA     s:8918

   8915  3 001320   200003 630500                    EPPR0   @FAB,,AUTO
         3 001321   000001 631400 4                  EPPR1   1
         3 001322   000000 701000 xent               TSX1    X9WE$IO_ERROR
         3 001323   000000 011000                    NOP     0

PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:76   
   8916  3 001324   200242 221300                    LDX1  ! KEYED_KEY+65,,AUTO
         3 001325   000001 702211                    TSX2  ! 1,X1

   8918  3 001326   200003 470500                    LDP0    @FAB,,AUTO
         3 001327   000032 236100                    LDQ     26,,PR0
         3 001330   000100 316003                    CANQ    64,DU
         3 001331   001343 600000 3                  TZE     s:8921

   8919  3 001332   000032 236000 4                  LDQ     26
         3 001333   200346 756100                    STQ     SAVE_KEY+67,,AUTO
         3 001334   000033 236000 4                  LDQ     27
         3 001335   200003 235100                    LDA     @FAB,,AUTO
         3 001336   200344 757100                    STAQ    SAVE_KEY+65,,AUTO
         3 001337   200344 630500                    EPPR0   SAVE_KEY+65,,AUTO
         3 001340   000003 631400 4                  EPPR1   3
         3 001341   000000 701000 xent               TSX1    X9WU$READ_USER_LABEL
         3 001342   000000 011000                    NOP     0

   8921  3 001343   200003 470500                    LDP0    @FAB,,AUTO
         3 001344   000032 236100                    LDQ     26,,PR0
         3 001345   000020 316003                    CANQ    16,DU
         3 001346   001360 600000 3                  TZE     s:8926

   8922  3 001347   000037 236000 4                  LDQ     31
         3 001350   200346 756100                    STQ     SAVE_KEY+67,,AUTO
         3 001351   000040 236000 4                  LDQ     32
         3 001352   200003 235100                    LDA     @FAB,,AUTO
         3 001353   200344 757100                    STAQ    SAVE_KEY+65,,AUTO
         3 001354   200344 630500                    EPPR0   SAVE_KEY+65,,AUTO
         3 001355   000003 631400 4                  EPPR1   3
         3 001356   000000 701000 xent               TSX1    X9WU$READ_USER_LABEL
         3 001357   000000 011000                    NOP     0

   8926  3 001360   200003 470500                    LDP0    @FAB,,AUTO
         3 001361   000040 236100                    LDQ     32,,PR0
         3 001362   000022 116000 4                  CMPQ    18
         3 001363   001500 600000 3                  TZE     s:8962
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:77   

   8928  3 001364   200007 756100                    STQ     USE$$,,AUTO

   8929  3 001365   000002 471400 4                  LDP1    2
         3 001366   100000 473500                    LDP3    0,,PR1
         3 001367   000034 220100                    LDX0    28,,PR0
         3 001370   300000 236110                    LDQ     0,X0,PR3
         3 001371   200006 756100                    STQ     DCB$,,AUTO

   8930  3 001372   200006 474500                    LDP4    DCB$,,AUTO
         3 001373   400032 221100                    LDX1    26,,PR4
         3 001374   000777 361003                    ANX1    511,DU
         3 001375   000004 101003                    CMPX1   4,DU
         3 001376   001400 602011 3                  TNC     s:8930+6,X1
         3 001377   001500 710000 3                  TRA     s:8962
         3 001400   001500 710000 3                  TRA     s:8962
         3 001401   001500 710000 3                  TRA     s:8962
         3 001402   001456 710000 3                  TRA     s:8951
         3 001403   001404 710000 3                  TRA     s:8932

   8932  3 001404   400031 236100                    LDQ     25,,PR4
         3 001405   003000 376007                    ANQ     1536,DL
         3 001406   002000 116007                    CMPQ    1024,DL
         3 001407   001433 601000 3                  TNZ     s:8943

   8934  3 001410   200007 475500                    LDP5    USE$$,,AUTO
         3 001411   500027 236100                    LDQ     23,,PR5
         3 001412   200010 756100                    STQ     USE_ENTRY$,,AUTO

   8935  3 001413   000030 116000 4                  CMPQ    24
         3 001414   001421 600000 3                  TZE     s:8937

   8936  3 001415   200010 222100                    LDX2    USE_ENTRY$,,AUTO
         3 001416   000030 631400 4                  EPPR1   24
         3 001417   000000 701012                    TSX1    0,X2
         3 001420   000000 011000                    NOP     0

PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:78   
   8937  3 001421   200007 470500                    LDP0    USE$$,,AUTO
         3 001422   000024 236100                    LDQ     20,,PR0
         3 001423   200010 756100                    STQ     USE_ENTRY$,,AUTO

   8938  3 001424   000030 116000 4                  CMPQ    24
         3 001425   001500 600000 3                  TZE     s:8962

   8939  3 001426   200010 220100                    LDX0    USE_ENTRY$,,AUTO
         3 001427   000030 631400 4                  EPPR1   24
         3 001430   000000 701010                    TSX1    0,X0
         3 001431   000000 011000                    NOP     0

   8940  3 001432   001500 710000 3                  TRA     s:8962

   8943  3 001433   200007 475500                    LDP5    USE$$,,AUTO
         3 001434   500026 236100                    LDQ     22,,PR5
         3 001435   200010 756100                    STQ     USE_ENTRY$,,AUTO

   8944  3 001436   000030 116000 4                  CMPQ    24
         3 001437   001444 600000 3                  TZE     s:8946

   8945  3 001440   200010 222100                    LDX2    USE_ENTRY$,,AUTO
         3 001441   000030 631400 4                  EPPR1   24
         3 001442   000000 701012                    TSX1    0,X2
         3 001443   000000 011000                    NOP     0

   8946  3 001444   200007 470500                    LDP0    USE$$,,AUTO
         3 001445   000023 236100                    LDQ     19,,PR0
         3 001446   200010 756100                    STQ     USE_ENTRY$,,AUTO

   8947  3 001447   000030 116000 4                  CMPQ    24
         3 001450   001500 600000 3                  TZE     s:8962

   8948  3 001451   200010 220100                    LDX0    USE_ENTRY$,,AUTO
         3 001452   000030 631400 4                  EPPR1   24
         3 001453   000000 701010                    TSX1    0,X0
         3 001454   000000 011000                    NOP     0
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:79   

   8949  3 001455   001500 710000 3                  TRA     s:8962

   8951  3 001456   200007 475500                    LDP5    USE$$,,AUTO
         3 001457   500025 236100                    LDQ     21,,PR5
         3 001460   200010 756100                    STQ     USE_ENTRY$,,AUTO

   8952  3 001461   000030 116000 4                  CMPQ    24
         3 001462   001467 600000 3                  TZE     s:8954

   8953  3 001463   200010 222100                    LDX2    USE_ENTRY$,,AUTO
         3 001464   000030 631400 4                  EPPR1   24
         3 001465   000000 701012                    TSX1    0,X2
         3 001466   000000 011000                    NOP     0

   8954  3 001467   200007 470500                    LDP0    USE$$,,AUTO
         3 001470   000022 236100                    LDQ     18,,PR0
         3 001471   200010 756100                    STQ     USE_ENTRY$,,AUTO

   8955  3 001472   000030 116000 4                  CMPQ    24
         3 001473   001500 600000 3                  TZE     s:8962

   8956  3 001474   200010 220100                    LDX0    USE_ENTRY$,,AUTO
         3 001475   000030 631400 4                  EPPR1   24
         3 001476   000000 701010                    TSX1    0,X0
         3 001477   000000 011000                    NOP     0

   8962  3 001500   000000 630400 1                  EPPR0   FPT_READ
         3 001501   440000 713400                    CLIMB   alt,read
         3 001502   401400 401760                    pmme    nvectors=4
         3 001503   001532 702000 3                  TSX2    s:8974

   8965  3 001504   200006 470500                    LDP0    DCB$,,AUTO
         3 001505   000000 235100                    LDA     0,,PR0
         3 001506   200003 471500                    LDP1    @FAB,,AUTO
         3 001507   100033 755100                    STA     27,,PR1

PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:80   
   8966  3 001510   100033 236100                    LDQ     27,,PR1
         3 001511   001514 604000 3                  TMI     s:8966+4
         3 001512   100007 116100                    CMPQ    7,,PR1
         3 001513   001520 604000 3                  TMI     s:8968
         3 001514   000000 116003                    CMPQ    0,DU
         3 001515   001520 604000 3                  TMI     s:8968
         3 001516   100010 116100                    CMPQ    8,,PR1
         3 001517   001525 604400 3                  TMOZ    s:8970

   8968  3 001520   100036 473500                    LDP3    30,,PR1
         3 001521   040100 100400                    MLR     fill='040'O
         3 001522   000002 000002 2                  ADSC9   2                        cn=0,n=2
         3 001523   300000 000002                    ADSC9   0,,PR3                   cn=0,n=2
         3 001524   001531 710000 3                  TRA     s:8971

   8970  3 001525   100036 473500                    LDP3    30,,PR1
         3 001526   040100 100400                    MLR     fill='040'O
         3 001527   000003 000002 2                  ADSC9   3                        cn=0,n=2
         3 001530   300000 000002                    ADSC9   0,,PR3                   cn=0,n=2

   8971  3 001531   001556 710000 3                  TRA     s:8990

   8974  3 001532   200006 470500                    LDP0    DCB$,,AUTO
         3 001533   000000 235100                    LDA     0,,PR0
         3 001534   200003 471500                    LDP1    @FAB,,AUTO
         3 001535   100033 755100                    STA     27,,PR1

   8975  3 001536   200003 630500                    EPPR0   @FAB,,AUTO
         3 001537   000000 631400 4                  EPPR1   0
         3 001540   000000 701000 xent               TSX1    X9WE$IO_ERROR
         3 001541   001554 702000 3                  TSX2    s:8985

   8978  3 001542   200003 470500                    LDP0    @FAB,,AUTO
         3 001543   000036 471500                    LDP1    30,,PR0
         3 001544   040000 106500                    CMPC    fill='040'O
         3 001545   100000 000002                    ADSC9   0,,PR1                   cn=0,n=2
         3 001546   000002 000002 2                  ADSC9   2                        cn=0,n=2
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:81   
         3 001547   001552 601000 3                  TNZ     s:8981

   8979  3 001550   200242 221300                    LDX1  ! KEYED_KEY+65,,AUTO
         3 001551   000001 702211                    TSX2  ! 1,X1

   8981  3 001552   200242 221300                    LDX1  ! KEYED_KEY+65,,AUTO
         3 001553   000000 702211                    TSX2  ! 0,X1

   8985  3 001554   200242 221300                    LDX1  ! KEYED_KEY+65,,AUTO
         3 001555   000000 702211                    TSX2  ! 0,X1

      468     8990    4                   END;

   8990  3 001556   001603 710000 3                  TRA     s:9009

      469     8991    3                 ELSE
      470     8992    4                   DO;

      471     8993    4                     FAB.LENGTH_READ = M$XX.ARS#;

   8993  3 001557   200006 473500                    LDP3    DCB$,,AUTO
         3 001560   300000 235100                    LDA     0,,PR3
         3 001561   200003 474500                    LDP4    @FAB,,AUTO
         3 001562   400033 755100                    STA     27,,PR4

      472     8994    4                     CALL X9WE$IO_ERROR (FAB, ALT_RET)

   8994  3 001563   200003 630500                    EPPR0   @FAB,,AUTO
         3 001564   000000 631400 4                  EPPR1   0
         3 001565   000000 701000 xent               TSX1    X9WE$IO_ERROR
         3 001566   001601 702000 3                  TSX2    s:9004

      473     8995    4                       WHENRETURN
      474     8996    5                         DO;

      475     8997    5                           IF IO_STATUS = '04' THEN

PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:82   
   8997  3 001567   200003 470500                    LDP0    @FAB,,AUTO
         3 001570   000036 471500                    LDP1    30,,PR0
         3 001571   040000 106500                    CMPC    fill='040'O
         3 001572   100000 000002                    ADSC9   0,,PR1                   cn=0,n=2
         3 001573   000002 000002 2                  ADSC9   2                        cn=0,n=2
         3 001574   001577 601000 3                  TNZ     s:9000

      476     8998    5                             RETURN;

   8998  3 001575   200242 221300                    LDX1  ! KEYED_KEY+65,,AUTO
         3 001576   000001 702211                    TSX2  ! 1,X1

      477     8999    5                           ELSE
      478     9000    5                             ALTRETURN;

   9000  3 001577   200242 221300                    LDX1  ! KEYED_KEY+65,,AUTO
         3 001600   000000 702211                    TSX2  ! 0,X1

      479     9001    5                         END;
      480     9002    4                       WHENALTRETURN
      481     9003    5                         DO;

      482     9004    5                           ALTRETURN;

   9004  3 001601   200242 221300                    LDX1  ! KEYED_KEY+65,,AUTO
         3 001602   000000 702211                    TSX2  ! 0,X1

      483     9005    5                         END;
      484     9006    4                   END;
      485     9007    3                END;
      486     9008
      487     9009    2     END READ;

   9009  3 001603   200242 221300                    LDX1  ! KEYED_KEY+65,,AUTO
         3 001604   000001 702211                    TSX2  ! 1,X1

      488     9010        %eject;
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:83   
      489     9011        /*-----------*/
      490     9012    1     NEXT_ALTKEY:         PROC   ALTRET;                       /*#24102*/

   9012  3 001605   200242 741300       NEXT_ALTKEY  STX1  ! KEYED_KEY+65,,AUTO

      491     9013        /*-----------*/
      492     9014
      493     9015        /*I*
      494     9016               NAME: X9WR$READ_NEXT:NEXT_ALTKEY
      495     9017
      496     9018            PURPOSE: This procedure was developed in order to provide support
      497     9019                     for sequential reads of shared indexed files accessed
      498     9020                     with an alternate key because this functionality was removed
      499     9021                     from the C00 release of the CP-6 operating system.
      500     9022        */
      501     9023
      502     9024    2     DCL SAVE_KEY         CHAR (256);
      503     9025
      504     9026          %FPT_PRECORD         (FPTN=START);
      505     9047
      506     9048    2     START.V.DCB# = FAB.DCB_NUM;

   9048  3 001606   200003 470500                    LDP0    @FAB,,AUTO
         3 001607   000034 220100                    LDX0    28,,PR0
         3 001610   000034 740000 1                  STX0    START+6

      507     9049    2     START.V.KEYS# = %YES#;

   9049  3 001611   400000 236007                    LDQ     -131072,DL
         3 001612   000034 256000 1                  ORSQ    START+6

      508     9050    2     START.V.KEYR# = %YES#;

   9050  3 001613   200000 236007                    LDQ     65536,DL
         3 001614   000034 256000 1                  ORSQ    START+6

      509     9051    2     START.V.INDX# = SHARED.INDX + 2;                          /*#32658*/
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:84   

   9051  3 001615   000037 471500                    LDP1    31,,PR0
         3 001616   100003 236100                    LDQ     3,,PR1
         3 001617   000002 036007                    ADLQ    2,DL
         3 001620   000034 552004 1                  STBQ    START+6,'04'O

      510     9052    2     START.KEY_    = VECTOR (SUBSTR (SHARED.KEY,0,ALT_LENGTH));

   9052  3 001621   200040 235100                    LDA     ALT_LENGTH,,AUTO
         3 001622   000020 735000                    ALS     16
         3 001623   000140 135007                    SBLA    96,DL
         3 001624   200344 451500                    STP1    SAVE_KEY+65,,AUTO
         3 001625   200344 236100                    LDQ     SAVE_KEY+65,,AUTO
         3 001626   000004 036003                    ADLQ    4,DU
         3 001627   000030 757000 1                  STAQ    START+2

      511     9053
      512     9054    2     IF ALT_KEYS.K.UNIQUE# (SHARED.INDX) THEN

   9054  3 001630   000037 471500                    LDP1    31,,PR0
         3 001631   000055 473500                    LDP3    45,,PR0
         3 001632   100003 720100                    LXL0    3,,PR1
         3 001633   300001 234110                    SZN     1,X0,PR3
         3 001634   001640 605000 3                  TPL     s:9060

      513     9055    3       DO;

      514     9056    3         START.V.N# = 1;

   9056  3 001635   000001 235007                    LDA     1,DL
         3 001636   000035 755000 1                  STA     START+7

      515     9057    3       END;

   9057  3 001637   001652 710000 3                  TRA     s:9066

      516     9058    2     ELSE
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:85   
      517     9059    3       DO;

      518     9060    3         SHARED.RECNUM = SHARED.RECNUM + 1;

   9060  3 001640   100002 235100                    LDA     2,,PR1
         3 001641   000001 035007                    ADLA    1,DL
         3 001642   100002 755100                    STA     2,,PR1

      519     9061    3         START.V.RECNUM# = SHARED.RECNUM;

   9061  3 001643   000037 471500                    LDP1    31,,PR0
         3 001644   100002 720100                    LXL0    2,,PR1
         3 001645   000036 740000 1                  STX0    START+8

      520     9062    3         START.V.N# = 0;

   9062  3 001646   000035 450000 1                  STZ     START+7

      521     9063    3         SAVE_KEY = SHARED.KEY;

   9063  3 001647   040100 100500                    MLR     fill='040'O
         3 001650   100004 000400                    ADSC9   4,,PR1                   cn=0,n=256
         3 001651   200243 000400                    ADSC9   SAVE_KEY,,AUTO           cn=0,n=256

      522     9064    3       END;

      523     9065        %eject;
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:86   
      524     9066    2     CALL M$PRECORD (START)

   9066  3 001652   000026 630400 1                  EPPR0   START
         3 001653   440003 713400                    CLIMB   alt,+16387
         3 001654   401000 401760                    pmme    nvectors=3
         3 001655   001666 702000 3                  TSX2    s:9073

      525     9067    2       WHENRETURN
      526     9068    3         DO;

      527     9069    3           ALT_INDX = SUBSTR (SHARED.KEY,0,ALT_LENGTH);

   9069  3 001656   200003 470500                    LDP0    @FAB,,AUTO
         3 001657   000037 471500                    LDP1    31,,PR0
         3 001660   200040 720100                    LXL0    ALT_LENGTH,,AUTO
         3 001661   200037 473500                    LDP3    INDEX_KEY$,,AUTO
         3 001662   040140 100540                    MLR     fill='040'O
         3 001663   100004 000010                    ADSC9   4,,PR1                   cn=0,n=*X0
         3 001664   300000 000010                    ADSC9   0,,PR3                   cn=0,n=*X0

      528     9070    3         END;

   9070  3 001665   002001 710000 3                  TRA     s:9120

      529     9071    2       WHENALTRETURN
      530     9072    3         DO;

      531     9073    3           CALL X9WE$IO_ERROR (FAB, ALT_RET)

   9073  3 001666   200003 630500                    EPPR0   @FAB,,AUTO
         3 001667   000000 631400 4                  EPPR1   0
         3 001670   000000 701000 xent               TSX1    X9WE$IO_ERROR
         3 001671   001673 702000 3                  TSX2    s:9076
         3 001672   001675 710000 3                  TRA     s:9078

      532     9074    3             WHENALTRETURN
      533     9075    4               DO;
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:87   

      534     9076    4                 RETURN;

   9076  3 001673   200242 221300                    LDX1  ! KEYED_KEY+65,,AUTO
         3 001674   000001 702211                    TSX2  ! 1,X1

      535     9077    4               END;
      536     9078    3           IF NOT ALT_KEYS.K.UNIQUE# (SHARED.INDX) THEN

   9078  3 001675   200003 470500                    LDP0    @FAB,,AUTO
         3 001676   000037 471500                    LDP1    31,,PR0
         3 001677   000055 473500                    LDP3    45,,PR0
         3 001700   100003 720100                    LXL0    3,,PR1
         3 001701   300001 234110                    SZN     1,X0,PR3
         3 001702   001772 604000 3                  TMI     s:9118

      537     9079    4             DO;

      538     9080    4               START.V.RECNUM# = SHARED.RECNUM - 1; /*last valid recnum*/

   9080  3 001703   100002 721100                    LXL1    2,,PR1
         3 001704   777777 622011                    EAX2    -1,X1
         3 001705   000036 742000 1                  STX2    START+8

      539     9081    4               SHARED.RECNUM = 1;                              /*#32658*/

   9081  3 001706   000001 235007                    LDA     1,DL
         3 001707   100002 755100                    STA     2,,PR1

      540     9082    4               START.V.N# = 0;

   9082  3 001710   000035 450000 1                  STZ     START+7

      541     9083    4               SHARED.KEY = SAVE_KEY;

   9083  3 001711   000037 471500                    LDP1    31,,PR0
         3 001712   040100 100500                    MLR     fill='040'O
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:88   
         3 001713   200243 000400                    ADSC9   SAVE_KEY,,AUTO           cn=0,n=256
         3 001714   100004 000400                    ADSC9   4,,PR1                   cn=0,n=256

      542     9084    4               CALL M$PRECORD (START)

   9084  3 001715   000026 630400 1                  EPPR0   START
         3 001716   440003 713400                    CLIMB   alt,+16387
         3 001717   401000 401760                    pmme    nvectors=3
         3 001720   001763 702000 3                  TSX2    s:9111

      543     9085    4                 WHENRETURN
      544     9086    5                   DO;   /* This key still exists, so position to it   */

      545     9087                              /* again and advance to the next key (N# = 1) */
      546     9088    5                     START.V.N# = 1;

   9088  3 001721   000001 235007                    LDA     1,DL
         3 001722   000035 755000 1                  STA     START+7

      547     9089    5                     CALL M$PRECORD (START)

   9089  3 001723   000026 630400 1                  EPPR0   START
         3 001724   440003 713400                    CLIMB   alt,+16387
         3 001725   401000 401760                    pmme    nvectors=3
         3 001726   001753 702000 3                  TSX2    s:9101

      548     9090    5                       WHENRETURN
      549     9091    6                         DO;

      550     9092    7                           DO I = 0 TO ALT_LENGTH - 1;

   9092  3 001727   200035 450100                    STZ     I,,AUTO
         3 001730   001736 710000 3                  TRA     s:9094+1

      551     9093    7                             SUBSTR (LOW_VALUE, I, 1) = BINASC(0);

   9093  3 001731   200035 235100                    LDA     I,,AUTO
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:89   
         3 001732   040105 100400                    MLR     fill='040'O
         3 001733   000041 000001 4                  ADSC9   33                       cn=0,n=1
         3 001734   200041 000001                    ADSC9   LOW_VALUE,A,AUTO         cn=0,n=1

      552     9094    7                           END;

   9094  3 001735   200035 054100                    AOS     I,,AUTO
         3 001736   200035 236100                    LDQ     I,,AUTO
         3 001737   200040 116100                    CMPQ    ALT_LENGTH,,AUTO
         3 001740   001731 604000 3                  TMI     s:9093

      553     9095    6                           IF SUBSTR (SHARED.KEY, 0, ALT_LENGTH) =

   9095  3 001741   200003 470500                    LDP0    @FAB,,AUTO
         3 001742   000037 471500                    LDP1    31,,PR0
         3 001743   200040 720100                    LXL0    ALT_LENGTH,,AUTO
         3 001744   040140 106540                    CMPC    fill='040'O
         3 001745   100004 000010                    ADSC9   4,,PR1                   cn=0,n=*X0
         3 001746   200041 000010                    ADSC9   LOW_VALUE,,AUTO          cn=0,n=*X0
         3 001747   001752 601000 3                  TNZ     s:9097+2

      554     9096    6                              SUBSTR (LOW_VALUE,  0, ALT_LENGTH) THEN
      555     9097    6                             ALTRETURN; /* eof */

   9097  3 001750   200242 221300                    LDX1  ! KEYED_KEY+65,,AUTO
         3 001751   000000 702211                    TSX2  ! 0,X1
         3 001752   001762 710000 3                  TRA     s:9107

      556     9098    6                         END;
      557     9099    5                       WHENALTRETURN
      558     9100    6                         DO;

      559     9101    6                           CALL X9WE$IO_ERROR (FAB, ALT_RET)

   9101  3 001753   200003 630500                    EPPR0   @FAB,,AUTO
         3 001754   000000 631400 4                  EPPR1   0
         3 001755   000000 701000 xent               TSX1    X9WE$IO_ERROR
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:90   
         3 001756   001760 702000 3                  TSX2    s:9104
         3 001757   001762 710000 3                  TRA     s:9107

      560     9102    6                             WHENALTRETURN
      561     9103    7                               DO;

      562     9104    7                                 RETURN;

   9104  3 001760   200242 221300                    LDX1  ! KEYED_KEY+65,,AUTO
         3 001761   000001 702211                    TSX2  ! 1,X1

      563     9105    7                               END;
      564     9106    6                         END;

      565     9107    5                   END;

   9107  3 001762   001772 710000 3                  TRA     s:9118

      566     9108        %eject;
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:91   
      567     9109    4                 WHENALTRETURN
      568     9110    5                   DO;  /* The old key is gone so position is ok */

      569     9111    5                     CALL X9WE$IO_ERROR (FAB, ALT_RET)

   9111  3 001763   200003 630500                    EPPR0   @FAB,,AUTO
         3 001764   000000 631400 4                  EPPR1   0
         3 001765   000000 701000 xent               TSX1    X9WE$IO_ERROR
         3 001766   001770 702000 3                  TSX2    s:9114
         3 001767   001772 710000 3                  TRA     s:9118

      570     9112    5                       WHENALTRETURN
      571     9113    6                         DO;

      572     9114    6                           RETURN;

   9114  3 001770   200242 221300                    LDX1  ! KEYED_KEY+65,,AUTO
         3 001771   000001 702211                    TSX2  ! 1,X1

      573     9115    6                         END;
      574     9116    5                   END;

      575     9117    4             END;  /* not unique */

      576     9118    3           ALT_INDX = SUBSTR (SHARED.KEY,0,ALT_LENGTH); /* set up the  */

   9118  3 001772   200003 470500                    LDP0    @FAB,,AUTO
         3 001773   000037 471500                    LDP1    31,,PR0
         3 001774   200040 720100                    LXL0    ALT_LENGTH,,AUTO
         3 001775   200037 473500                    LDP3    INDEX_KEY$,,AUTO
         3 001776   040140 100540                    MLR     fill='040'O
         3 001777   100004 000010                    ADSC9   4,,PR1                   cn=0,n=*X0
         3 002000   300000 000010                    ADSC9   0,,PR3                   cn=0,n=*X0

      577     9119    3         END; /* whenaltreturn 1st m$precord */         /* key for read*/

      578     9120    2     END NEXT_ALTKEY; /* proc */
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:92   

   9120  3 002001   200242 221300                    LDX1  ! KEYED_KEY+65,,AUTO
         3 002002   000001 702211                    TSX2  ! 1,X1

      579     9121    1   END X9WR$READ_RAND;  /* proc */

   9121  3 002003   000000 702200 xent               TSX2  ! X66_ARET
      580     9122        %eject;
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:93   

PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:94   
--  Include file information  --

   X8A_ERRCOM.:X8A6TOU  cannot be made into a system file and is referenced.
   XS_MACRO_C.:LIBRARY  is referenced.
   X9A_FAB.:X8A6TOU  is referenced.
   X9A_LIB_IO.:X8A6TOU  cannot be made into a system file and is referenced.
   X9A_IO.:X8A6TOU  is referenced.
   CP_6_SUBS.:LIB_E04  is referenced.
   CP_6_C.:LIB_E04  is referenced.
   CP_6.:LIB_E04  cannot be made into a system file and is referenced.
   Z9A_FLAGS.:Z8A6TOU  is referenced.
   X8A_SYS_FILE.:X8A6TOU  is referenced.
   B_ERRORS_C.:LIB_E04  is referenced.
      No diagnostics issued in procedure X9WR$READ_RAND.
PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:95   

 **** Variables and constants ****

  ****  Section 001  Data  X9WR$READ_RAND

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    16-0-0/d STRC(288)   r     1 CLOSE_VOLUME               0-0-0/d STRC(504)   r     1 FPT_READ
    26-0-0/d STRC(360)   r     1 START

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @ALT_RET                   3-0-0/w PTR         r     1 @FAB
     5-0-0/w PTR         r     1 @INDX                     40-0-0/w SBIN        r     1 ALT_LENGTH
    *0-0-0/w BIT         r     1 ALT_RET                    6-0-0/w PTR         r     1 DCB$
    *0-0-0/d STRC(2232)  r     1 FAB                       35-0-0/w SBIN        r     1 I
    37-0-0/w PTR         r     1 INDEX_KEY$                *0-0-0/w SBIN        r     1 INDX
   141-0-0/w STRC(2304)  r     1 KEYED_KEY                 41-0-0/c CHAR(255)   r     1 LOW_VALUE
    36-0-0/w UBIN        r     1 RELATIVE_KEY             243-0-0/c CHAR(256)   r     1 SAVE_KEY
    11-0-0/c CHAR(80)          1 SPECIAL_ERR_MSG            7-0-0/w PTR         r     1 USE$$
    10-0-0/w EPTR        r     1 USE_ENTRY$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$TCB$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

PL6.E3A0      #001=X9WR$READ_RAND File=X9WR.:X8A6TSI                             SAT 08/09/97 11:08 Page:96   
     0-0-0/c ACHR        r     1 ALT_INDX                   0-0-0/d STRC(72)    r     1 ALT_KEYS
     0-0-0/w STRC(2448)  r     1 B$ALT                      0-0-0/w STRC(144)   r     1 B$TCB
     0-0-0/c ACHR        r     1 INDEX_KEY                  0-0-0/c CHAR(2)     r     1 IO_STATUS
     0-0-0/c ACHR        r     1 KEY_TEXT                   0-0-0N  NULL        r     1 M$UC
     0-0-0/d ASTR(3528)  r     1 M$XX                       0-0-0/c CHAR        r     1 PAD_CHAR
     0-0-0/d ASTR(0)     r     1 RDB                        0-0-0/w STRC(2448)  r     1 SHARED
     0-0-0/w STRC(864)   r     1 USE_PROC


   Procedure X9WR$READ_RAND requires 1028 words for executable code.
   Procedure X9WR$READ_RAND requires 232 words of local(AUTO) storage.

    No errors detected in file X9WR.:X8A6TSI    .
