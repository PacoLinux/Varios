VERSION E05

PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:1    
        1        1        /*M* FRF$FEPRES - Fep resource management */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        FRF$IN: PROC (NK$LDCT,K$RWPARM) ALTRET;
        8        8
        9        9
       10       10
       11       11
       12       12
       13       13        /* INCLUDES */
       14       14
       15       15        %INCLUDE B$USER;
       16      231        %INCLUDE F$DCB;
       17      280        %INCLUDE F$JIT_C;
       18      710        %INCLUDE FR$RAT;
       19      763        %FR$RAT (NAME=RAT, STCLASS="BASED(RAT$)");
       20      803        %INCLUDE FR_SUBS;
       21      871        %INCLUDE NK$LDCT;
       22      973        %INCLUDE KV$VDO;
       23     1988        %INCLUDE KC_ERRORS_C;
       24     2035        %INCLUDE K_DATA_R;
       25     2746        %INCLUDE NK_SUBS;
       26     2771        %INCLUDE NK_LDCT_R;
       27     2780        %INCLUDE SS_SCHED_C;
       28     3013        %INCLUDE UD_SEV_C;
       29     3027        %INCLUDE UE_CP6;
       30     3718        %INCLUDE UM_CP6;
       31     4570
       32     4571
       33     4572        /* Equates */
       34     4573        %KV_VDO_ALL_E;
       35     4652        %SUB_EXC;
       36     4699
       37     4700
PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:2    
       38     4701
       39     4702
       40     4703
       41     4704        /* PARAMETERS */
       42     4705
       43     4706        %NK$LDCT (STCLASS="");
       44     4752        %K$RWPARM (NAME=K$RWPARM);
       45     5068
       46     5069
       47     5070
       48     5071
       49     5072        /* BASED STRUCTURES */
       50     5073
       51     5074        %B$COMIO (PARONLY=1, STCLASS=BASED);
       52     5083        %KV$VDO (STCLASS="BASED(K$RWPARM.UHDR$)");
       53     5110        %KV$VDO_EVT (STCLASS="BASED(K$RWPARM.UHDR$)");
       54     5152
       55     5153
       56     5154
       57     5155
       58     5156        /* Auto */
       59     5157
       60     5158    1   DCL LDCT$ PTR;
       61     5159    1   DCL RAT$ PTR;
       62     5160        %K$RWPARM (NAME=OPARM,STCLASS=AUTO);
       63     5476    1   DCL TSTATE CHAR(8);
       64     5477    1   DCL EVNT UBIN;
       65     5478    1   DCL DOMN UBIN;
       66     5479        %NK$LDCT (NAME=BLDCT, STCLASS="BASED(LDCT$)");
       67     5525        %B$COMIO (NAME=COMIO, STCLASS=AUTO, PARONLY=1);
       68     5534    1   DCL SUBC2 UBIN;
       69     5535
       70     5536
       71     5537
       72     5538
       73     5539        /* REFS */
       74     5540
PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:3    
       75     5541    1   DCL B$JIT$ PTR SYMREF READONLY;
       76     5542    1   DCL B$USRT$ PTR SYMREF;
       77     5543    1   DCL FSN$OPNCL_EVT ENTRY(1);
       78     5544    1   DCL KIA$DSC       ENTRY(3) ALTRET;
       79     5545    1   DCL KIA$MSG       ENTRY(1) ALTRET;
       80     5546    1   DCL KIA$FCNO      ENTRY(3) ALTRET;
       81     5547    1   DCL KIA$DSCTS ENTRY(2) ALTRET;
       82     5548    1   DCL KIA$GETEVNT ENTRY(3);
       83     5549    1   DCL KIA$UCIN ENTRY(2) ALTRET;
       84     5550    1   DCL NKL$RELDCTL ENTRY(1) ALTRET;
       85     5551    1   DCL SSR$RUE ENTRY(4);
       86     5552    1   DCL SSV$EVENT ENTRY(7);
       87     5553
       88     5554
       89     5555
       90     5556
       91     5557        /* CONSTANT */
       92     5558
       93     5559        %VLP_ERRCODE (STCLASS=CONSTANT,FCG=FR,MID=F,MON='1'B,SEV=SEV_ERROR#,
       94     5560                     FPTN=ERRCGORAU, ERR#=%E$CGORAU);
       95     5605        %EJECT;
PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:4    
       96     5606        /* CODE */
       97     5607    1           RAT$ = NK$LDCT.RAT$;
       98     5608    2           DO CASE (KV$VDO.FNC);
       99     5609    2            CASE (%KV_VDO_FNC_EVT);
      100     5610    2              IF KV$VDO_EVT.TYP=%KV_EVTTYP_MNTATN AND RAT.TYP~='CL'
      101     5611    3              THEN DO;
      102     5612    3                 OPARM = K_RWPARM_CON;
      103     5613    3                 CALL KIA$FCNO (LDCT,%KV_VDO_FNC_DSC_RQS,OPARM) ALTRET(GETOUT);
      104     5614    3                 RETURN;
      105     5615    3                 END;
      106     5616    2              LDCT$ = ADDR(LDCT);
      107     5617    2              IF RAT.TYP~='CL' THEN GOTO CALLOUT;
      108     5618    2              IF K$RWPARM.MRKTYP~= 0
      109     5619    2              THEN CALL KIA$FCNO (LDCT,%KV_VDO_FNC_MRK,K$RWPARM) ALTRET (GETOUT);
      110     5620    2              IF RAT.CLFLG.AUCTL AND RAT.DCTX=NK$LDCT.LDCTX
      111     5621    2              THEN SUBC2 = %SUBC2_IN_CALL#;
      112     5622    2              ELSE SUBC2 = %SUBC2_BREAK#;
      113     5623    2              CALL EVRPT;
      114     5624    2            CASE (%KV_VDO_FNC_RQSSTT);
      115     5625    2              OPARM = K_RWPARM_CON;
      116     5626    2              TSTATE = NK$LDCT.DEVNM;
      117     5627    2              OPARM.MSGSZ = LENGTHC(TSTATE);
      118     5628    2              OPARM.MSG$ = ADDR(TSTATE);
      119     5629    2              CALL KIA$FCNO(LDCT,%KV_VDO_FNC_STT,OPARM) ALTRET(GETOUT);
      120     5630    2            CASE (%KV_VDO_FNC_DSC_RQS);
      121     5631    2              CALL DISC ALTRET(GETOUT);
      122     5632    2            CASE (ELSE);
      123     5633    2   CALLOUT:   IF RAT.TYP='CL' AND NK$LDCT.USER~=0
      124     5634    2              THEN CALL KIA$UCIN (NK$LDCT, K$RWPARM) ALTRET (GETOUT);
      125     5635    2            END;
      126     5636    1           RETURN;
      127     5637    1   GETOUT: ;
      128     5638    1           ALTRETURN;
      129     5639        %EJECT;
PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:5    
      130     5640    1   FRF$DISC: ENTRY(NK$LDCT) ALTRET;
      131     5641
      132     5642    1           RAT$ = NK$LDCT.RAT$;
      133     5643    1           CALL DISC
      134     5644    2           WHENALTRETURN DO;
      135     5645    2              ALTRETURN;
      136     5646    2              END;
      137     5647    1           RETURN;
      138     5648
      139     5649        %EJECT;
PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:6    
      140     5650    1   FRF$EVRPT: ENTRY(NK$LDCT) ALTRET;
      141     5651
      142     5652        /* Entry to report DCB open or close, either to of from the AU */
      143     5653        /* to-au has no parameter, getting all info through B$JIT.DCB$ */
      144     5654        /* from-au has the new LDCT, already containing USER and DCBNO fields */
      145     5655
      146     5656    1           SUBC2 = %SUBC2_OPN_DCB#;
      147     5657    1           IF ADDR(NK$LDCT)~=ADDR(NIL)
      148     5658    1           THEN LDCT$ = ADDR(NK$LDCT);
      149     5659    2           ELSE DO;
      150     5660    2              LDCT$ = NK$LDCT$(B$JIT.DCB$->F$DCB.SETX);
      151     5661    2              IF NOT B$JIT.DCB$->F$DCB.FCD THEN EXIT; /* FCD if this is a close */
      152     5662    2              SUBC2 = %SUBC2_CLS_DCB#;
      153     5663    2              LDCT$ = NK$LDCT$(BLDCT.RAT$->RAT.DCTX);
      154     5664    2              IF LDCT$~=ADDR(NIL)
      155     5665    2              THEN IF BLDCT.USER~=B$JIT.USER AND BLDCT.RAT$->RAT.CLFLG.AUCTL
      156     5666    2              THEN EXIT;
      157     5667    2              RETURN;
      158     5668    2           END;
      159     5669    1           CALL EVRPT;
      160     5670    1           RETURN;
      161     5671        %EJECT;
PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:7    
      162     5672    1   DISC:   PROC ALTRET;
      163     5673    2           OPARM = K_RWPARM_CON;
      164     5674    2           IF NOT NK$LDCT.DFLG.FEDN
      165     5675    2           THEN
      166     5676    2              CALL KIA$DSC (NK$LDCT,%KV_VDO_FNC_DSC_RSP,OPARM);
      167     5677    2           LDCT$ = ADDR(NK$LDCT);
      168     5678    2           CALL KIA$DSCTS (NK$LDCT, OPARM); /* Cancel NW IO, set OLDSC. */
      169     5679    2           SUBC2 = %SUBC2_CLS_DCB#;
      170     5680    2           CALL EVRPT; /* Tell the user about it - since DSCTS didn't */
      171     5681    3           IF RAT.DCTX~=NK$LDCT.LDCTX THEN DO;
      172     5682    3              IF NOT RAT.CLFLG.AUCTL THEN EXIT;
      173     5683        /* Send an event to the AU if this one's not his. */
      174     5684    3              LDCT$ = NK$LDCT$(RAT.DCTX);
      175     5685    3              IF BLDCT.USER=NK$LDCT.USER THEN EXIT;
      176     5686    3              CALL EVRPT;
      177     5687    3              END;
      178     5688    3           ELSE DO;
      179     5689    3              RAT.FLG.RUP = '0'B;
      180     5690    3              IF RAT.FLG.OPN THEN EXIT; /* This resource is still being used */
      181     5691    3              CALL NKL$RELDCTL (NK$LDCT$(RAT.DCTX));
      182     5692    3              RAT.DCTX = 0;
      183     5693    3              RAT.RCOD = FR_FREE;
      184     5694    3              RAT.CLFLG = '0'B;
      185     5695    3              RAT.FLG = %DOWNBIT;
      186     5696    3              END;
      187     5697
      188     5698    2   END DISC;
      189     5699
      190     5700        %EJECT;
PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:8    
      191     5701    1   EVRPT: PROC;
      192     5702
      193     5703    2   DCL ENTADR# EPTR;
      194     5704
      195     5705    2           IF BLDCT.DFLG.RLSE THEN RETURN;
      196     5706    2           CALL KIA$GETEVNT (BLDCT,EVNT,DOMN);
      197     5707    2           IF SUBC2=%SUBC2_OPN_DCB# AND ADDR(NK$LDCT)=LDCT$
      198     5708    2           THEN ENTADR# = ENTADDR(FRF$OPNCL_EVT);
      199     5709    2           ELSE ENTADR# = ENTADDR(NIL);
      200     5710    2           CALL SSR$RUE (%SS_FPEVNT, BLDCT.USER);
      201     5711    2           IF EVNT=0 AND ENTADR#=ENTADDR(NIL) THEN RETURN;
      202     5712    2           COMIO = '0'B;
      203     5713    2           COMIO.P# = SIZEW(COMIO)-SIZEW(COMIO.P#);
      204     5714    2           COMIO.SUBC2 = SUBC2;
      205     5715    3           IF ADDR(NK$LDCT)=ADDR(NIL) THEN DO;
      206     5716    3              COMIO.ID.DCBNO = B$JIT.DCBNO;
      207     5717    3              COMIO.ID.SYSID = B$JIT.SYSID;
      208     5718    3           END; ELSE DO;
      209     5719    3              COMIO.ID.DCBNO = NK$LDCT.DCBNO;
      210     5720    3              IF ENTADR#=ENTADDR(NIL)
      211     5721    3              THEN IF SUBC2=%SUBC2_BREAK#
      212     5722    3              THEN COMIO.ID.SYSID = KV$VDO_EVT.BRKCNT;
      213     5723    3              ELSE COMIO.ID.SYSID = B$USRT$->B$USER.SYSID(NK$LDCT.USER);
      214     5724    3              ELSE IF NK$LDCT.LDCTX~=0
      215     5725    3              THEN COMIO.ID.SYSID = NK$LDCT.LDCTX;
      216     5726    4              ELSE DO;
      217     5727    4                 COMIO.ID.SYSID = NK$LDCT.MSGID; /* AU said no */
      218     5728    4                 COMIO.ID.DCBNO= COMIO.ID.DCBNO+512; /* Set a flag, too */
      219     5729    4              END;
      220     5730    3           END;
      221     5731    2           CALL SSV$EVENT
      222     5732    2             (BLDCT.USER,DOMN,%SUBC_COMIO#,EVNT,0,ADDR(COMIO),ENTADR#);
      223     5733    2   END EVRPT;
      224     5734        %EJECT;
PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:9    
      225     5735    1   FRF$OPNCL_EVT: ENTRY(NK$LDCT) ALTRET;
      226     5736
      227     5737        %EQU B$DO=CHARTEXT('ADDR(NK$LDCT)->B$DO');
      228     5738        %EQU B$COMIO=CHARTEXT('ADDR(ADDR(NK$LDCT)->B$DO.ECCSZ)->B$COMIO');
      229     5739
      230     5740        /* Entry to finish connecting a DCB that was redirected by the AU */
      231     5741
      232     5742    1           B$JIT.DCB$ = DCBADDR(MOD(%B$COMIO.ID.DCBNO,512));
      233     5743    2           IF %B$COMIO.ID.DCBNO>511 THEN DO; /* Open is to be aborted */
      234     5744    2              B$JIT.DCB$->F$DCB.SETX = 0;
      235     5745    2              B$JIT.DCB$->F$DCB.ARS = %B$COMIO.ID.SYSID;
      236     5746    2              B$JIT.ERR = ERRCGORAU;
      237     5747    2              %B$DO.ERRC = ERRCGORAU;
      238     5748        /*E* ERROR: FRF-E$CGORAU
      239     5749             MESSAGE:M$OPEN %of %DC%was rejected by the resource administrator.
      240     5750        */
      241     5751    2           END; ELSE DO;
      242     5752    2              B$JIT.DCB$->F$DCB.SETX = %B$COMIO.ID.SYSID;
      243     5753    2              LDCT$ = NK$LDCT$(%B$COMIO.ID.SYSID);
      244     5754    2              B$JIT.DCB$->F$DCB.ARS = BLDCT.MSGID;
      245     5755    2           END;
      246     5756    1           IF %B$DO.EVID=0 THEN ALTRETURN; /* No event to the user needed */
      247     5757    1           CALL FSN$OPNCL_EVT(B$JIT.DCB$->F$DCB);
      248     5758    1           RETURN;
      249     5759
      250     5760    1   END FRF$IN;
      251     5761
      252     5762
      253     5763        %EOD;

PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:10   
--  Include file information  --

   UM_CP6.:E05TOU  is referenced.
   UE_CP6.:E05TOU  is referenced.
   UD_SEV_C.:E05TOU  is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   NK_SUBS.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KC_ERRORS_C.:E05TOU  is referenced.
   KV$VDO.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   FR_SUBS.:E05TOU  is referenced.
   FR$RAT.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FRF$IN.

   Procedure FRF$IN requires 408 words for executable code.
   Procedure FRF$IN requires 68 words of local(AUTO) storage.

PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:11   

 Object Unit name= FRF$IN                                     File name= FRF$FEPRES.:E05TOU
 UTS= JUL 29 '97 17:22:20.04 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      2      2  FRF$IN
    1   Proc  even  none   408    630  FRF$IN
    2  RoData even  none    15     17  FRF$IN

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        2  FRF$IN
     1    173          yes     yes      Std        1  FRF$DISC
     1    205          yes     yes      Std        1  FRF$EVRPT
     1    552          yes     yes      Std        1  FRF$OPNCL_EVT
PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:12   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       3 KIA$FCNO
         yes           Std       1 FSN$OPNCL_EVT
 yes     yes           Std       2 KIA$UCIN
 yes     yes           Std       3 KIA$DSC
 yes     yes           Std       1 NKL$RELDCTL
 yes     yes           Std       2 KIA$DSCTS
         yes           Std       3 KIA$GETEVNT
         yes           Std       7 SSV$EVENT
         yes           Std       4 SSR$RUE
 yes     yes           Std       1 FRF$OPNCL_EVT
                       nStd      0 X66_AUTO_2
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
r    K_RWPARM_CON                          N$DCT$$                          r    B$JIT$
     B$USRT$                               B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ROSID                                 ISSID
PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:13   


        1        1        /*M* FRF$FEPRES - Fep resource management */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        FRF$IN: PROC (NK$LDCT,K$RWPARM) ALTRET;

      7  1 000000   000000 700200 xent  FRF$IN       TSX0  ! X66_AUTO_2
         1 000001   000104 000002                    ZERO    68,2

        8        8
        9        9
       10       10
       11       11
       12       12
       13       13        /* INCLUDES */
       14       14
       15       15        %INCLUDE B$USER;
       16      231        %INCLUDE F$DCB;
       17      280        %INCLUDE F$JIT_C;
       18      710        %INCLUDE FR$RAT;
       19      763        %FR$RAT (NAME=RAT, STCLASS="BASED(RAT$)");
       20      803        %INCLUDE FR_SUBS;
       21      871        %INCLUDE NK$LDCT;
       22      973        %INCLUDE KV$VDO;
       23     1988        %INCLUDE KC_ERRORS_C;
       24     2035        %INCLUDE K_DATA_R;
       25     2746        %INCLUDE NK_SUBS;
       26     2771        %INCLUDE NK_LDCT_R;
       27     2780        %INCLUDE SS_SCHED_C;
       28     3013        %INCLUDE UD_SEV_C;
       29     3027        %INCLUDE UE_CP6;
       30     3718        %INCLUDE UM_CP6;
       31     4570
       32     4571
PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:14   
       33     4572        /* Equates */
       34     4573        %KV_VDO_ALL_E;
       35     4652        %SUB_EXC;
       36     4699
       37     4700
       38     4701
       39     4702
       40     4703
       41     4704        /* PARAMETERS */
       42     4705
       43     4706        %NK$LDCT (STCLASS="");
       44     4752        %K$RWPARM (NAME=K$RWPARM);
       45     5068
       46     5069
       47     5070
       48     5071
       49     5072        /* BASED STRUCTURES */
       50     5073
       51     5074        %B$COMIO (PARONLY=1, STCLASS=BASED);
       52     5083        %KV$VDO (STCLASS="BASED(K$RWPARM.UHDR$)");
       53     5110        %KV$VDO_EVT (STCLASS="BASED(K$RWPARM.UHDR$)");
       54     5152
       55     5153
       56     5154
       57     5155
       58     5156        /* Auto */
       59     5157
       60     5158    1   DCL LDCT$ PTR;
       61     5159    1   DCL RAT$ PTR;
       62     5160        %K$RWPARM (NAME=OPARM,STCLASS=AUTO);
       63     5476    1   DCL TSTATE CHAR(8);
       64     5477    1   DCL EVNT UBIN;
       65     5478    1   DCL DOMN UBIN;
       66     5479        %NK$LDCT (NAME=BLDCT, STCLASS="BASED(LDCT$)");
       67     5525        %B$COMIO (NAME=COMIO, STCLASS=AUTO, PARONLY=1);
       68     5534    1   DCL SUBC2 UBIN;
       69     5535
PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:15   
       70     5536
       71     5537
       72     5538
       73     5539        /* REFS */
       74     5540
       75     5541    1   DCL B$JIT$ PTR SYMREF READONLY;
       76     5542    1   DCL B$USRT$ PTR SYMREF;
       77     5543    1   DCL FSN$OPNCL_EVT ENTRY(1);
       78     5544    1   DCL KIA$DSC       ENTRY(3) ALTRET;
       79     5545    1   DCL KIA$MSG       ENTRY(1) ALTRET;
       80     5546    1   DCL KIA$FCNO      ENTRY(3) ALTRET;
       81     5547    1   DCL KIA$DSCTS ENTRY(2) ALTRET;
       82     5548    1   DCL KIA$GETEVNT ENTRY(3);
       83     5549    1   DCL KIA$UCIN ENTRY(2) ALTRET;
       84     5550    1   DCL NKL$RELDCTL ENTRY(1) ALTRET;
       85     5551    1   DCL SSR$RUE ENTRY(4);
       86     5552    1   DCL SSV$EVENT ENTRY(7);
       87     5553
       88     5554
       89     5555
       90     5556
       91     5557        /* CONSTANT */
       92     5558
       93     5559        %VLP_ERRCODE (STCLASS=CONSTANT,FCG=FR,MID=F,MON='1'B,SEV=SEV_ERROR#,
       94     5560                     FPTN=ERRCGORAU, ERR#=%E$CGORAU);
       95     5605        %EJECT;
PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:16   
       96     5606        /* CODE */
       97     5607    1           RAT$ = NK$LDCT.RAT$;

   5607  1 000002   200003 470500                    LDP0    @NK$LDCT,,AUTO
         1 000003   000005 236100                    LDQ     5,,PR0
         1 000004   200006 756100                    STQ     RAT$,,AUTO

       98     5608    2           DO CASE (KV$VDO.FNC);

   5608  1 000005   200004 471500                    LDP1    @K$RWPARM,,AUTO
         1 000006   100014 473500                    LDP3    12,,PR1
         1 000007   000100 101500                    MRL     fill='000'O
         1 000010   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
         1 000011   200074 000004                    ADSC9   ENTADR#+1,,AUTO          cn=0,n=4
         1 000012   200074 236100                    LDQ     ENTADR#+1,,AUTO
         1 000013   000012 136007                    SBLQ    10,DL
         1 000014   000017 116007                    CMPQ    15,DL
         1 000015   000017 602006 1                  TNC     s:5608+10,QL
         1 000016   000156 710000 1                  TRA     CALLOUT
         1 000017   000153 710000 1                  TRA     s:5631
         1 000020   000156 710000 1                  TRA     CALLOUT
         1 000021   000156 710000 1                  TRA     CALLOUT
         1 000022   000036 710000 1                  TRA     s:5610
         1 000023   000156 710000 1                  TRA     CALLOUT
         1 000024   000156 710000 1                  TRA     CALLOUT
         1 000025   000156 710000 1                  TRA     CALLOUT
         1 000026   000156 710000 1                  TRA     CALLOUT
         1 000027   000156 710000 1                  TRA     CALLOUT
         1 000030   000156 710000 1                  TRA     CALLOUT
         1 000031   000156 710000 1                  TRA     CALLOUT
         1 000032   000156 710000 1                  TRA     CALLOUT
         1 000033   000156 710000 1                  TRA     CALLOUT
         1 000034   000156 710000 1                  TRA     CALLOUT
         1 000035   000130 710000 1                  TRA     s:5625

       99     5609    2            CASE (%KV_VDO_FNC_EVT);

PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:17   
      100     5610    2              IF KV$VDO_EVT.TYP=%KV_EVTTYP_MNTATN AND RAT.TYP~='CL'

   5610  1 000036   100014 473500                    LDP3    12,,PR1
         1 000037   000100 101500                    MRL     fill='000'O
         1 000040   300000 600001                    ADSC9   0,,PR3                   cn=3,n=1
         1 000041   200074 000004                    ADSC9   ENTADR#+1,,AUTO          cn=0,n=4
         1 000042   200074 236100                    LDQ     ENTADR#+1,,AUTO
         1 000043   000002 116007                    CMPQ    2,DL
         1 000044   000066 601000 1                  TNZ     s:5616
         1 000045   200006 473500                    LDP3    RAT$,,AUTO
         1 000046   300010 220100                    LDX0    8,,PR3
         1 000047   000001 100000 0                  CMPX0   ERRCGORAU+1
         1 000050   000066 600000 1                  TZE     s:5616

      101     5611    3              THEN DO;

      102     5612    3                 OPARM = K_RWPARM_CON;

   5612  1 000051   000100 100400                    MLR     fill='000'O
         1 000052   000000 000234 xsym               ADSC9   K_RWPARM_CON             cn=0,n=156
         1 000053   200010 000234                    ADSC9   OPARM,,AUTO              cn=0,n=156

      103     5613    3                 CALL KIA$FCNO (LDCT,%KV_VDO_FNC_DSC_RQS,OPARM) ALTRET(GETOUT);

   5613  1 000054   200010 634500                    EPPR4   OPARM,,AUTO
         1 000055   200076 454500                    STP4    ENTADR#+3,,AUTO
         1 000056   000000 236000 2                  LDQ     0
         1 000057   200003 235100                    LDA     @NK$LDCT,,AUTO
         1 000060   200074 757100                    STAQ    ENTADR#+1,,AUTO
         1 000061   200074 630500                    EPPR0   ENTADR#+1,,AUTO
         1 000062   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000063   000000 701000 xent               TSX1    KIA$FCNO
         1 000064   000172 702000 1                  TSX2    GETOUT

      104     5614    3                 RETURN;

   5614  1 000065   000000 702200 xent               TSX2  ! X66_ARET
PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:18   

      105     5615    3                 END;
      106     5616    2              LDCT$ = ADDR(LDCT);

   5616  1 000066   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000067   200005 756100                    STQ     LDCT$,,AUTO

      107     5617    2              IF RAT.TYP~='CL' THEN GOTO CALLOUT;

   5617  1 000070   200006 473500                    LDP3    RAT$,,AUTO
         1 000071   300010 220100                    LDX0    8,,PR3
         1 000072   000001 100000 0                  CMPX0   ERRCGORAU+1
         1 000073   000156 601000 1                  TNZ     CALLOUT

      108     5618    2              IF K$RWPARM.MRKTYP~= 0

   5618  1 000074   100040 236100                    LDQ     32,,PR1
         1 000075   777000 316007                    CANQ    -512,DL
         1 000076   000110 600000 1                  TZE     s:5620

      109     5619    2              THEN CALL KIA$FCNO (LDCT,%KV_VDO_FNC_MRK,K$RWPARM) ALTRET (GETOUT);

   5619  1 000077   200004 236100                    LDQ     @K$RWPARM,,AUTO
         1 000100   200076 756100                    STQ     ENTADR#+3,,AUTO
         1 000101   000002 236000 2                  LDQ     2
         1 000102   200003 235100                    LDA     @NK$LDCT,,AUTO
         1 000103   200074 757100                    STAQ    ENTADR#+1,,AUTO
         1 000104   200074 630500                    EPPR0   ENTADR#+1,,AUTO
         1 000105   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000106   000000 701000 xent               TSX1    KIA$FCNO
         1 000107   000172 702000 1                  TSX2    GETOUT

      110     5620    2              IF RAT.CLFLG.AUCTL AND RAT.DCTX=NK$LDCT.LDCTX

   5620  1 000110   200006 470500                    LDP0    RAT$,,AUTO
         1 000111   000003 236100                    LDQ     3,,PR0
         1 000112   000020 316003                    CANQ    16,DU
PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:19   
         1 000113   000123 600000 1                  TZE     s:5622
         1 000114   000003 720100                    LXL0    3,,PR0
         1 000115   200003 471500                    LDP1    @NK$LDCT,,AUTO
         1 000116   100006 100100                    CMPX0   6,,PR1
         1 000117   000123 601000 1                  TNZ     s:5622

      111     5621    2              THEN SUBC2 = %SUBC2_IN_CALL#;

   5621  1 000120   000005 235007                    LDA     5,DL
         1 000121   200067 755100                    STA     SUBC2,,AUTO
         1 000122   000125 710000 1                  TRA     s:5623

      112     5622    2              ELSE SUBC2 = %SUBC2_BREAK#;

   5622  1 000123   000006 235007                    LDA     6,DL
         1 000124   200067 755100                    STA     SUBC2,,AUTO

      113     5623    2              CALL EVRPT;

   5623  1 000125   000367 701000 1                  TSX1    EVRPT
         1 000126   000000 011000                    NOP     0
         1 000127   000171 710000 1                  TRA     s:5636

      114     5624    2            CASE (%KV_VDO_FNC_RQSSTT);

      115     5625    2              OPARM = K_RWPARM_CON;

   5625  1 000130   000100 100400                    MLR     fill='000'O
         1 000131   000000 000234 xsym               ADSC9   K_RWPARM_CON             cn=0,n=156
         1 000132   200010 000234                    ADSC9   OPARM,,AUTO              cn=0,n=156

      116     5626    2              TSTATE = NK$LDCT.DEVNM;

   5626  1 000133   000002 237100                    LDAQ    2,,PR0
         1 000134   200060 757100                    STAQ    TSTATE,,AUTO

      117     5627    2              OPARM.MSGSZ = LENGTHC(TSTATE);
PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:20   

   5627  1 000135   000010 235007                    LDA     8,DL
         1 000136   200011 755100                    STA     OPARM+1,,AUTO

      118     5628    2              OPARM.MSG$ = ADDR(TSTATE);

   5628  1 000137   200060 633500                    EPPR3   TSTATE,,AUTO
         1 000140   200010 453500                    STP3    OPARM,,AUTO

      119     5629    2              CALL KIA$FCNO(LDCT,%KV_VDO_FNC_STT,OPARM) ALTRET(GETOUT);

   5629  1 000141   200010 634500                    EPPR4   OPARM,,AUTO
         1 000142   200076 454500                    STP4    ENTADR#+3,,AUTO
         1 000143   000004 236000 2                  LDQ     4
         1 000144   200003 235100                    LDA     @NK$LDCT,,AUTO
         1 000145   200074 757100                    STAQ    ENTADR#+1,,AUTO
         1 000146   200074 630500                    EPPR0   ENTADR#+1,,AUTO
         1 000147   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000150   000000 701000 xent               TSX1    KIA$FCNO
         1 000151   000172 702000 1                  TSX2    GETOUT
         1 000152   000171 710000 1                  TRA     s:5636

      120     5630    2            CASE (%KV_VDO_FNC_DSC_RQS);

      121     5631    2              CALL DISC ALTRET(GETOUT);

   5631  1 000153   000255 701000 1                  TSX1    DISC
         1 000154   000172 702000 1                  TSX2    GETOUT
         1 000155   000171 710000 1                  TRA     s:5636

      122     5632    2            CASE (ELSE);

      123     5633    2   CALLOUT:   IF RAT.TYP='CL' AND NK$LDCT.USER~=0

   5633  1 000156   200006 473500       CALLOUT      LDP3    RAT$,,AUTO
         1 000157   300010 220100                    LDX0    8,,PR3
         1 000160   000001 100000 0                  CMPX0   ERRCGORAU+1
PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:21   
         1 000161   000171 601000 1                  TNZ     s:5636
         1 000162   000007 236100                    LDQ     7,,PR0
         1 000163   000777 316003                    CANQ    511,DU
         1 000164   000171 600000 1                  TZE     s:5636

      124     5634    2              THEN CALL KIA$UCIN (NK$LDCT, K$RWPARM) ALTRET (GETOUT);

   5634  1 000165   200003 630500                    EPPR0   @NK$LDCT,,AUTO
         1 000166   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000167   000000 701000 xent               TSX1    KIA$UCIN
         1 000170   000172 702000 1                  TSX2    GETOUT

      125     5635    2            END;

      126     5636    1           RETURN;

   5636  1 000171   000000 702200 xent               TSX2  ! X66_ARET

   5634  1 000172                       GETOUT       null
      127     5637    1   GETOUT: ;
      128     5638    1           ALTRETURN;

   5638  1 000172   000000 702200 xent               TSX2  ! X66_AALT

      129     5639        %EJECT;
PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:22   
      130     5640    1   FRF$DISC: ENTRY(NK$LDCT) ALTRET;

   5640  1 000173   000000 700200 xent  FRF$DISC     TSX0  ! X66_AUTO_2
         1 000174   000104 000002                    ZERO    68,2

      131     5641
      132     5642    1           RAT$ = NK$LDCT.RAT$;

   5642  1 000175   200003 470500                    LDP0    @NK$LDCT,,AUTO
         1 000176   000005 236100                    LDQ     5,,PR0
         1 000177   200006 756100                    STQ     RAT$,,AUTO

      133     5643    1           CALL DISC

   5643  1 000200   000255 701000 1                  TSX1    DISC
         1 000201   000203 702000 1                  TSX2    s:5645
         1 000202   000204 710000 1                  TRA     s:5647

      134     5644    2           WHENALTRETURN DO;

      135     5645    2              ALTRETURN;

   5645  1 000203   000000 702200 xent               TSX2  ! X66_AALT

      136     5646    2              END;
      137     5647    1           RETURN;

   5647  1 000204   000000 702200 xent               TSX2  ! X66_ARET

      138     5648
      139     5649        %EJECT;
PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:23   
      140     5650    1   FRF$EVRPT: ENTRY(NK$LDCT) ALTRET;

   5650  1 000205   000000 700200 xent  FRF$EVRPT    TSX0  ! X66_AUTO_2
         1 000206   000104 000002                    ZERO    68,2

      141     5651
      142     5652        /* Entry to report DCB open or close, either to of from the AU */
      143     5653        /* to-au has no parameter, getting all info through B$JIT.DCB$ */
      144     5654        /* from-au has the new LDCT, already containing USER and DCBNO fields */
      145     5655
      146     5656    1           SUBC2 = %SUBC2_OPN_DCB#;

   5656  1 000207   000004 235007                    LDA     4,DL
         1 000210   200067 755100                    STA     SUBC2,,AUTO

      147     5657    1           IF ADDR(NK$LDCT)~=ADDR(NIL)

   5657  1 000211   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000212   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000213   000216 600000 1                  TZE     s:5660

      148     5658    1           THEN LDCT$ = ADDR(NK$LDCT);

   5658  1 000214   200005 756100                    STQ     LDCT$,,AUTO
         1 000215   000252 710000 1                  TRA     s:5669

      149     5659    2           ELSE DO;

      150     5660    2              LDCT$ = NK$LDCT$(B$JIT.DCB$->F$DCB.SETX);

   5660  1 000216   000000 470400 xsym               LDP0    B$JIT$
         1 000217   000232 471500                    LDP1    154,,PR0
         1 000220   100051 720100                    LXL0    41,,PR1
         1 000221   000000 473400 xsym               LDP3    N$DCT$$
         1 000222   300000 236110                    LDQ     0,X0,PR3
         1 000223   200005 756100                    STQ     LDCT$,,AUTO

PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:24   
      151     5661    2              IF NOT B$JIT.DCB$->F$DCB.FCD THEN EXIT; /* FCD if this is a close */

   5661  1 000224   100031 236100                    LDQ     25,,PR1
         1 000225   020000 316007                    CANQ    8192,DL
         1 000226   000252 600000 1                  TZE     s:5669

      152     5662    2              SUBC2 = %SUBC2_CLS_DCB#;

   5662  1 000227   000003 235007                    LDA     3,DL
         1 000230   200067 755100                    STA     SUBC2,,AUTO

      153     5663    2              LDCT$ = NK$LDCT$(BLDCT.RAT$->RAT.DCTX);

   5663  1 000231   200005 474500                    LDP4    LDCT$,,AUTO
         1 000232   400005 475500                    LDP5    5,,PR4
         1 000233   500003 721100                    LXL1    3,,PR5
         1 000234   300000 236111                    LDQ     0,X1,PR3
         1 000235   200005 756100                    STQ     LDCT$,,AUTO

      154     5664    2              IF LDCT$~=ADDR(NIL)

   5664  1 000236   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000237   000251 600000 1                  TZE     s:5667

      155     5665    2              THEN IF BLDCT.USER~=B$JIT.USER AND BLDCT.RAT$->RAT.CLFLG.AUCTL

   5665  1 000240   200005 474500                    LDP4    LDCT$,,AUTO
         1 000241   400007 236100                    LDQ     7,,PR4
         1 000242   000000 676100                    ERQ     0,,PR0
         1 000243   000777 376003                    ANQ     511,DU
         1 000244   000251 600000 1                  TZE     s:5667
         1 000245   400005 475500                    LDP5    5,,PR4
         1 000246   500003 236100                    LDQ     3,,PR5
         1 000247   000020 316003                    CANQ    16,DU
         1 000250   000252 601000 1                  TNZ     s:5669

      156     5666    2              THEN EXIT;
PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:25   
      157     5667    2              RETURN;

   5667  1 000251   000000 702200 xent               TSX2  ! X66_ARET

      158     5668    2           END;
      159     5669    1           CALL EVRPT;

   5669  1 000252   000367 701000 1                  TSX1    EVRPT
         1 000253   000000 011000                    NOP     0

      160     5670    1           RETURN;

   5670  1 000254   000000 702200 xent               TSX2  ! X66_ARET

      161     5671        %EJECT;
PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:26   
      162     5672    1   DISC:   PROC ALTRET;

   5672  1 000255   200070 741300       DISC         STX1  ! SUBC2+1,,AUTO

      163     5673    2           OPARM = K_RWPARM_CON;

   5673  1 000256   000100 100400                    MLR     fill='000'O
         1 000257   000000 000234 xsym               ADSC9   K_RWPARM_CON             cn=0,n=156
         1 000260   200010 000234                    ADSC9   OPARM,,AUTO              cn=0,n=156

      164     5674    2           IF NOT NK$LDCT.DFLG.FEDN

   5674  1 000261   200003 470500                    LDP0    @NK$LDCT,,AUTO
         1 000262   000006 236100                    LDQ     6,,PR0
         1 000263   000020 316007                    CANQ    16,DL
         1 000264   000276 601000 1                  TNZ     s:5677

      165     5675    2           THEN
      166     5676    2              CALL KIA$DSC (NK$LDCT,%KV_VDO_FNC_DSC_RSP,OPARM);

   5676  1 000265   200010 631500                    EPPR1   OPARM,,AUTO
         1 000266   200076 451500                    STP1    ENTADR#+3,,AUTO
         1 000267   000005 236000 2                  LDQ     5
         1 000270   200003 235100                    LDA     @NK$LDCT,,AUTO
         1 000271   200074 757100                    STAQ    ENTADR#+1,,AUTO
         1 000272   200074 630500                    EPPR0   ENTADR#+1,,AUTO
         1 000273   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000274   000000 701000 xent               TSX1    KIA$DSC
         1 000275   000000 011000                    NOP     0

      167     5677    2           LDCT$ = ADDR(NK$LDCT);

   5677  1 000276   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000277   200005 756100                    STQ     LDCT$,,AUTO

      168     5678    2           CALL KIA$DSCTS (NK$LDCT, OPARM); /* Cancel NW IO, set OLDSC. */

PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:27   
   5678  1 000300   200010 630500                    EPPR0   OPARM,,AUTO
         1 000301   200075 450500                    STP0    ENTADR#+2,,AUTO
         1 000302   200074 756100                    STQ     ENTADR#+1,,AUTO
         1 000303   200074 630500                    EPPR0   ENTADR#+1,,AUTO
         1 000304   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000305   000000 701000 xent               TSX1    KIA$DSCTS
         1 000306   000000 011000                    NOP     0

      169     5679    2           SUBC2 = %SUBC2_CLS_DCB#;

   5679  1 000307   000003 235007                    LDA     3,DL
         1 000310   200067 755100                    STA     SUBC2,,AUTO

      170     5680    2           CALL EVRPT; /* Tell the user about it - since DSCTS didn't */

   5680  1 000311   000367 701000 1                  TSX1    EVRPT
         1 000312   000000 011000                    NOP     0

      171     5681    3           IF RAT.DCTX~=NK$LDCT.LDCTX THEN DO;

   5681  1 000313   200006 470500                    LDP0    RAT$,,AUTO
         1 000314   000003 720100                    LXL0    3,,PR0
         1 000315   200003 471500                    LDP1    @NK$LDCT,,AUTO
         1 000316   100006 100100                    CMPX0   6,,PR1
         1 000317   000336 600000 1                  TZE     s:5689

      172     5682    3              IF NOT RAT.CLFLG.AUCTL THEN EXIT;

   5682  1 000320   000003 236100                    LDQ     3,,PR0
         1 000321   000020 316003                    CANQ    16,DU
         1 000322   000335 600000 1                  TZE     s:5687

      173     5683        /* Send an event to the AU if this one's not his. */
      174     5684    3              LDCT$ = NK$LDCT$(RAT.DCTX);

   5684  1 000323   000000 473400 xsym               LDP3    N$DCT$$
         1 000324   300000 236110                    LDQ     0,X0,PR3
PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:28   
         1 000325   200005 756100                    STQ     LDCT$,,AUTO

      175     5685    3              IF BLDCT.USER=NK$LDCT.USER THEN EXIT;

   5685  1 000326   200005 474500                    LDP4    LDCT$,,AUTO
         1 000327   400007 236100                    LDQ     7,,PR4
         1 000330   100007 676100                    ERQ     7,,PR1
         1 000331   000777 376003                    ANQ     511,DU
         1 000332   000335 600000 1                  TZE     s:5687

      176     5686    3              CALL EVRPT;

   5686  1 000333   000367 701000 1                  TSX1    EVRPT
         1 000334   000000 011000                    NOP     0

      177     5687    3              END;

   5687  1 000335   000365 710000 1                  TRA     s:5698

      178     5688    3           ELSE DO;

      179     5689    3              RAT.FLG.RUP = '0'B;

   5689  1 000336   000006 236000 2                  LDQ     6
         1 000337   000010 356100                    ANSQ    8,,PR0

      180     5690    3              IF RAT.FLG.OPN THEN EXIT; /* This resource is still being used */

   5690  1 000340   000010 236100                    LDQ     8,,PR0
         1 000341   000020 316007                    CANQ    16,DL
         1 000342   000365 601000 1                  TNZ     s:5698

      181     5691    3              CALL NKL$RELDCTL (NK$LDCT$(RAT.DCTX));

   5691  1 000343   000000 636010                    EAQ     0,X0
         1 000344   000000 036000 xsym               ADLQ    N$DCT$$
         1 000345   200074 756100                    STQ     ENTADR#+1,,AUTO
PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:29   
         1 000346   200074 630500                    EPPR0   ENTADR#+1,,AUTO
         1 000347   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000350   000000 701000 xent               TSX1    NKL$RELDCTL
         1 000351   000000 011000                    NOP     0

      182     5692    3              RAT.DCTX = 0;

   5692  1 000352   000000 220003                    LDX0    0,DU
         1 000353   200006 470500                    LDP0    RAT$,,AUTO
         1 000354   000003 440100                    SXL0    3,,PR0

      183     5693    3              RAT.RCOD = FR_FREE;

   5693  1 000355   000003 236100                    LDQ     3,,PR0
         1 000356   000007 376000 2                  ANQ     7
         1 000357   000140 276003                    ORQ     96,DU
         1 000360   000003 756100                    STQ     3,,PR0

      184     5694    3              RAT.CLFLG = '0'B;

   5694  1 000361   000010 236000 2                  LDQ     8
         1 000362   000003 356100                    ANSQ    3,,PR0

      185     5695    3              RAT.FLG = %DOWNBIT;

   5695  1 000363   000002 236007                    LDQ     2,DL
         1 000364   000010 552104                    STBQ    8,'04'O,PR0

      186     5696    3              END;

      187     5697
      188     5698    2   END DISC;

   5698  1 000365   200070 221300                    LDX1  ! SUBC2+1,,AUTO
         1 000366   000001 702211                    TSX2  ! 1,X1

      189     5699
PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:30   
      190     5700        %EJECT;
PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:31   
      191     5701    1   EVRPT: PROC;

   5701  1 000367   200072 741300       EVRPT        STX1  ! SUBC2+3,,AUTO

      192     5702
      193     5703    2   DCL ENTADR# EPTR;
      194     5704
      195     5705    2           IF BLDCT.DFLG.RLSE THEN RETURN;

   5705  1 000370   200005 470500                    LDP0    LDCT$,,AUTO
         1 000371   000006 236100                    LDQ     6,,PR0
         1 000372   000400 316007                    CANQ    256,DL
         1 000373   000375 600000 1                  TZE     s:5706

   5705  1 000374   000001 702211                    TSX2  ! 1,X1

      196     5706    2           CALL KIA$GETEVNT (BLDCT,EVNT,DOMN);

   5706  1 000375   200063 631500                    EPPR1   DOMN,,AUTO
         1 000376   200076 451500                    STP1    ENTADR#+3,,AUTO
         1 000377   200062 633500                    EPPR3   EVNT,,AUTO
         1 000400   200075 453500                    STP3    ENTADR#+2,,AUTO
         1 000401   200005 236100                    LDQ     LDCT$,,AUTO
         1 000402   200074 756100                    STQ     ENTADR#+1,,AUTO
         1 000403   200074 630500                    EPPR0   ENTADR#+1,,AUTO
         1 000404   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000405   000000 701000 xent               TSX1    KIA$GETEVNT
         1 000406   000000 011000                    NOP     0

      197     5707    2           IF SUBC2=%SUBC2_OPN_DCB# AND ADDR(NK$LDCT)=LDCT$

   5707  1 000407   200067 235100                    LDA     SUBC2,,AUTO
         1 000410   000004 115007                    CMPA    4,DL
         1 000411   000420 601000 1                  TNZ     s:5709
         1 000412   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000413   200005 116100                    CMPQ    LDCT$,,AUTO
         1 000414   000420 601000 1                  TNZ     s:5709
PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:32   

      198     5708    2           THEN ENTADR# = ENTADDR(FRF$OPNCL_EVT);

   5708  1 000415   000552 636000 1                  EAQ     s:5735
         1 000416   200073 756100                    STQ     ENTADR#,,AUTO
         1 000417   000422 710000 1                  TRA     s:5710

      199     5709    2           ELSE ENTADR# = ENTADDR(NIL);

   5709  1 000420   000002 236000 xsym               LDQ     B_VECTNIL+2
         1 000421   200073 756100                    STQ     ENTADR#,,AUTO

      200     5710    2           CALL SSR$RUE (%SS_FPEVNT, BLDCT.USER);

   5710  1 000422   200005 236100                    LDQ     LDCT$,,AUTO
         1 000423   000012 036000 2                  ADLQ    10
         1 000424   000013 235000 2                  LDA     11
         1 000425   200074 757100                    STAQ    ENTADR#+1,,AUTO
         1 000426   200074 630500                    EPPR0   ENTADR#+1,,AUTO
         1 000427   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000430   000000 701000 xent               TSX1    SSR$RUE
         1 000431   000000 011000                    NOP     0

      201     5711    2           IF EVNT=0 AND ENTADR#=ENTADDR(NIL) THEN RETURN;

   5711  1 000432   200062 235100                    LDA     EVNT,,AUTO
         1 000433   000441 601000 1                  TNZ     s:5712
         1 000434   200073 236100                    LDQ     ENTADR#,,AUTO
         1 000435   000002 116000 xsym               CMPQ    B_VECTNIL+2
         1 000436   000441 601000 1                  TNZ     s:5712

   5711  1 000437   200072 221300                    LDX1  ! SUBC2+3,,AUTO
         1 000440   000001 702211                    TSX2  ! 1,X1

      202     5712    2           COMIO = '0'B;

   5712  1 000441   000100 100400                    MLR     fill='000'O
PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:33   
         1 000442   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         1 000443   200064 000014                    ADSC9   COMIO,,AUTO              cn=0,n=12

      203     5713    2           COMIO.P# = SIZEW(COMIO)-SIZEW(COMIO.P#);

   5713  1 000444   000002 236007                    LDQ     2,DL
         1 000445   200064 756100                    STQ     COMIO,,AUTO

      204     5714    2           COMIO.SUBC2 = SUBC2;

   5714  1 000446   200067 236100                    LDQ     SUBC2,,AUTO
         1 000447   200065 552104                    STBQ    COMIO+1,'04'O,AUTO

      205     5715    3           IF ADDR(NK$LDCT)=ADDR(NIL) THEN DO;

   5715  1 000450   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000451   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000452   000462 601000 1                  TNZ     s:5719

      206     5716    3              COMIO.ID.DCBNO = B$JIT.DCBNO;

   5716  1 000453   000000 470400 xsym               LDP0    B$JIT$
         1 000454   000022 720100                    LXL0    18,,PR0
         1 000455   000777 360003                    ANX0    511,DU
         1 000456   200066 440100                    SXL0    COMIO+2,,AUTO

      207     5717    3              COMIO.ID.SYSID = B$JIT.SYSID;

   5717  1 000457   000000 721100                    LXL1    0,,PR0
         1 000460   200066 741100                    STX1    COMIO+2,,AUTO

      208     5718    3           END; ELSE DO;

   5718  1 000461   000523 710000 1                  TRA     s:5731

      209     5719    3              COMIO.ID.DCBNO = NK$LDCT.DCBNO;

PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:34   
   5719  1 000462   200003 470500                    LDP0    @NK$LDCT,,AUTO
         1 000463   000014 236100                    LDQ     12,,PR0
         1 000464   000033 736000                    QLS     27
         1 000465   000033 732000                    QRS     27
         1 000466   000000 620006                    EAX0    0,QL
         1 000467   200066 440100                    SXL0    COMIO+2,,AUTO

      210     5720    3              IF ENTADR#=ENTADDR(NIL)

   5720  1 000470   200073 236100                    LDQ     ENTADR#,,AUTO
         1 000471   000002 116000 xsym               CMPQ    B_VECTNIL+2
         1 000472   000513 601000 1                  TNZ     s:5724

      211     5721    3              THEN IF SUBC2=%SUBC2_BREAK#

   5721  1 000473   200067 235100                    LDA     SUBC2,,AUTO
         1 000474   000006 115007                    CMPA    6,DL
         1 000475   000504 601000 1                  TNZ     s:5723

      212     5722    3              THEN COMIO.ID.SYSID = KV$VDO_EVT.BRKCNT;

   5722  1 000476   200004 471500                    LDP1    @K$RWPARM,,AUTO
         1 000477   100014 473500                    LDP3    12,,PR1
         1 000500   000100 101500                    MRL     fill='000'O
         1 000501   300000 400001                    ADSC9   0,,PR3                   cn=2,n=1
         1 000502   200066 000002                    ADSC9   COMIO+2,,AUTO            cn=0,n=2
         1 000503   000523 710000 1                  TRA     s:5731

      213     5723    3              ELSE COMIO.ID.SYSID = B$USRT$->B$USER.SYSID(NK$LDCT.USER);

   5723  1 000504   000007 236100                    LDQ     7,,PR0
         1 000505   000016 772000                    QRL     14
         1 000506   017760 376007                    ANQ     8176,DL
         1 000507   000000 471400 xsym               LDP1    B$USRT$
         1 000510   100014 721106                    LXL1    12,QL,PR1
         1 000511   200066 741100                    STX1    COMIO+2,,AUTO
         1 000512   000523 710000 1                  TRA     s:5731
PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:35   

      214     5724    3              ELSE IF NK$LDCT.LDCTX~=0

   5724  1 000513   000006 221100                    LDX1    6,,PR0
         1 000514   000517 600000 1                  TZE     s:5727

      215     5725    3              THEN COMIO.ID.SYSID = NK$LDCT.LDCTX;

   5725  1 000515   200066 741100                    STX1    COMIO+2,,AUTO
         1 000516   000523 710000 1                  TRA     s:5731

      216     5726    4              ELSE DO;

      217     5727    4                 COMIO.ID.SYSID = NK$LDCT.MSGID; /* AU said no */

   5727  1 000517   000000 722100                    LXL2    0,,PR0
         1 000520   200066 742100                    STX2    COMIO+2,,AUTO

      218     5728    4                 COMIO.ID.DCBNO= COMIO.ID.DCBNO+512; /* Set a flag, too */

   5728  1 000521   001000 621010                    EAX1    512,X0
         1 000522   200066 441100                    SXL1    COMIO+2,,AUTO

      219     5729    4              END;

      220     5730    3           END;

      221     5731    2           CALL SSV$EVENT

   5731  1 000523   200064 630500                    EPPR0   COMIO,,AUTO
         1 000524   200074 450500                    STP0    ENTADR#+1,,AUTO
         1 000525   200073 631500                    EPPR1   ENTADR#,,AUTO
         1 000526   200103 451500                    STP1    ENTADR#+8,,AUTO
         1 000527   200074 633500                    EPPR3   ENTADR#+1,,AUTO
         1 000530   200102 453500                    STP3    ENTADR#+7,,AUTO
         1 000531   000014 236000 2                  LDQ     12
         1 000532   200101 756100                    STQ     ENTADR#+6,,AUTO
PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:36   
         1 000533   200062 634500                    EPPR4   EVNT,,AUTO
         1 000534   200100 454500                    STP4    ENTADR#+5,,AUTO
         1 000535   000015 236000 2                  LDQ     13
         1 000536   200077 756100                    STQ     ENTADR#+4,,AUTO
         1 000537   200063 635500                    EPPR5   DOMN,,AUTO
         1 000540   200076 455500                    STP5    ENTADR#+3,,AUTO
         1 000541   200005 236100                    LDQ     LDCT$,,AUTO
         1 000542   000012 036000 2                  ADLQ    10
         1 000543   200075 756100                    STQ     ENTADR#+2,,AUTO
         1 000544   200075 630500                    EPPR0   ENTADR#+2,,AUTO
         1 000545   000025 631400 xsym               EPPR1   B_VECTNIL+21
         1 000546   000000 701000 xent               TSX1    SSV$EVENT
         1 000547   000000 011000                    NOP     0

      222     5732    2             (BLDCT.USER,DOMN,%SUBC_COMIO#,EVNT,0,ADDR(COMIO),ENTADR#);
      223     5733    2   END EVRPT;

   5733  1 000550   200072 221300                    LDX1  ! SUBC2+3,,AUTO
         1 000551   000001 702211                    TSX2  ! 1,X1

      224     5734        %EJECT;
PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:37   
      225     5735    1   FRF$OPNCL_EVT: ENTRY(NK$LDCT) ALTRET;

   5735  1 000552   000000 700200 xent  FRF$OPNCL_E* TSX0  ! X66_AUTO_2
         1 000553   000104 000002                    ZERO    68,2

      226     5736
      227     5737        %EQU B$DO=CHARTEXT('ADDR(NK$LDCT)->B$DO');
      228     5738        %EQU B$COMIO=CHARTEXT('ADDR(ADDR(NK$LDCT)->B$DO.ECCSZ)->B$COMIO');
      229     5739
      230     5740        /* Entry to finish connecting a DCB that was redirected by the AU */
      231     5741
      232     5742    1           B$JIT.DCB$ = DCBADDR(MOD(%B$COMIO.ID.DCBNO,512));

   5742  1 000554   200003 470500                    LDP0    @NK$LDCT,,AUTO
         1 000555   000007 236100                    LDQ     7,,PR0
         1 000556   777777 376007                    ANQ     -1,DL
         1 000557   000777 376007                    ANQ     511,DL
         1 000560   000016 471400 2                  LDP1    14
         1 000561   100000 473500                    LDP3    0,,PR1
         1 000562   300000 236106                    LDQ     0,QL,PR3
         1 000563   000000 474400 xsym               LDP4    B$JIT$
         1 000564   400232 756100                    STQ     154,,PR4

      233     5743    2           IF %B$COMIO.ID.DCBNO>511 THEN DO; /* Open is to be aborted */

   5743  1 000565   000007 720100                    LXL0    7,,PR0
         1 000566   001000 100003                    CMPX0   512,DU
         1 000567   000603 602000 1                  TNC     s:5752

      234     5744    2              B$JIT.DCB$->F$DCB.SETX = 0;

   5744  1 000570   400232 475500                    LDP5    154,,PR4
         1 000571   000000 221003                    LDX1    0,DU
         1 000572   500051 441100                    SXL1    41,,PR5

      235     5745    2              B$JIT.DCB$->F$DCB.ARS = %B$COMIO.ID.SYSID;

PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:38   
   5745  1 000573   400232 475500                    LDP5    154,,PR4
         1 000574   000007 236100                    LDQ     7,,PR0
         1 000575   000022 772000                    QRL     18
         1 000576   500000 756100                    STQ     0,,PR5

      236     5746    2              B$JIT.ERR = ERRCGORAU;

   5746  1 000577   000000 236000 0                  LDQ     ERRCGORAU
         1 000600   400012 756100                    STQ     10,,PR4

      237     5747    2              %B$DO.ERRC = ERRCGORAU;

   5747  1 000601   000004 756100                    STQ     4,,PR0

      238     5748        /*E* ERROR: FRF-E$CGORAU
      239     5749             MESSAGE:M$OPEN %of %DC%was rejected by the resource administrator.
      240     5750        */
      241     5751    2           END; ELSE DO;

   5751  1 000602   000616 710000 1                  TRA     s:5756

      242     5752    2              B$JIT.DCB$->F$DCB.SETX = %B$COMIO.ID.SYSID;

   5752  1 000603   400232 475500                    LDP5    154,,PR4
         1 000604   000007 221100                    LDX1    7,,PR0
         1 000605   500051 441100                    SXL1    41,,PR5

      243     5753    2              LDCT$ = NK$LDCT$(%B$COMIO.ID.SYSID);

   5753  1 000606   000007 220100                    LDX0    7,,PR0
         1 000607   000000 475400 xsym               LDP5    N$DCT$$
         1 000610   500000 236110                    LDQ     0,X0,PR5
         1 000611   200005 756100                    STQ     LDCT$,,AUTO

      244     5754    2              B$JIT.DCB$->F$DCB.ARS = BLDCT.MSGID;

   5754  1 000612   400232 476500                    LDP6    154,,PR4
PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:39   
         1 000613   200005 477500                    LDP7    LDCT$,,AUTO
         1 000614   700000 235100                    LDA     0,,PR7
         1 000615   600000 755100                    STA     0,,PR6

      245     5755    2           END;

      246     5756    1           IF %B$DO.EVID=0 THEN ALTRETURN; /* No event to the user needed */

   5756  1 000616   000003 235100                    LDA     3,,PR0
         1 000617   000621 601000 1                  TNZ     s:5757

   5756  1 000620   000000 702200 xent               TSX2  ! X66_AALT

      247     5757    1           CALL FSN$OPNCL_EVT(B$JIT.DCB$->F$DCB);

   5757  1 000621   400232 475500                    LDP5    154,,PR4
         1 000622   200074 455500                    STP5    ENTADR#+1,,AUTO
         1 000623   200074 630500                    EPPR0   ENTADR#+1,,AUTO
         1 000624   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000625   000000 701000 xent               TSX1    FSN$OPNCL_EVT
         1 000626   000000 011000                    NOP     0

      248     5758    1           RETURN;

   5758  1 000627   000000 702200 xent               TSX2  ! X66_ARET

ERRCGORAU
 Sect OctLoc
   0     000   062206 415744                                                    2...

(unnamed)
 Sect OctLoc
   0     001   103114 040040                                                    CL

(unnamed)
 Sect OctLoc
   2     000   000014 006000   000000 000037   000001 006000   000000 000035    ................
PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:40   
   2     004   000003 006000   000015 006000   777777 777773   777037 777777    ................
   2     010   777740 777777   000000 000053   000007 200000   000011 006000    .......+........
   2     014   000002 006000   000010 006000   000000 006003                    ............
      249     5759
      250     5760    1   END FRF$IN;
      251     5761
      252     5762
      253     5763        %EOD;

PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:41   
--  Include file information  --

   UM_CP6.:E05TOU  is referenced.
   UE_CP6.:E05TOU  is referenced.
   UD_SEV_C.:E05TOU  is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   NK_LDCT_R.:E05TOU  cannot be made into a system file and is referenced.
   NK_SUBS.:E05TOU  is referenced.
   K$RWPARM.:E05TOU  is referenced.
   K_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   KC_ERRORS_C.:E05TOU  is referenced.
   KV$VDO.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   FR_SUBS.:E05TOU  is referenced.
   FR$RAT.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   F$JIT_C.:E05TOU  cannot be made into a system file and is referenced.
   F$DCB.:E05TOU  cannot be made into a system file and is referenced.
   B$USER.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FRF$IN.
PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:42   

 **** Variables and constants ****

  ****  Section 000 RoData FRF$IN

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC        r     1 ERRCGORAU

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @K$RWPARM                  3-0-0/w PTR         r     1 @NK$LDCT
    64-0-0/w STRC(108)   r     1 COMIO                     63-0-0/w UBIN        r     1 DOMN
    73-0-0/w EPTR        r     1 ENTADR#                   62-0-0/w UBIN        r     1 EVNT
    *0-0-0/d STRC(1404)  r     1 K$RWPARM                   5-0-0/w PTR         r     1 LDCT$
    *0-0-0/d STRC(864)   r     1 NK$LDCT                   10-0-0/d STRC(1404)  r     1 OPARM
     6-0-0/w PTR         r     1 RAT$                      67-0-0/w UBIN        r     1 SUBC2
    60-0-0/c CHAR(8)     r     1 TSTATE

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$USRT$
     0-0-0/d STRC(1404)  r     1 K_RWPARM_CON               0-0-0/w PTR         r     1 N$DCT$$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(108)   r     1 B$COMIO                    0-0-0/d STRC(396)   r     1 B$DO
     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/w STRC(576)   r     1 B$USER(0:0)
PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:43   
     0-0-0/d STRC(864)   r     1 BLDCT                      0-0-0/d ASTR(3528)  r     1 F$DCB
     0-0-0/h STRC(18)    r     1 KV$VDO                     0-0-0/h STRC        r     1 KV$VDO_EVT
     0-0-0/w PTR         r     1 NK$LDCT$(0:0)
     0-0-0/w STRC(324)   r     1 RAT


   Procedure FRF$IN requires 408 words for executable code.
   Procedure FRF$IN requires 68 words of local(AUTO) storage.
PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:44   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:45   
          MINI XREF LISTING

B$COMIO.ARS
      5080**DCL      5080--REDEF
B$COMIO.ID.DCBNO
      5080**DCL      5742>>ASSIGN   5743>>IF
B$COMIO.ID.SYSID
      5080**DCL      5745>>ASSIGN   5752>>ASSIGN   5753>>ASSIGN
B$DO.ECCINFO
       166**DCL       167--REDEF
B$DO.ECCSZ
       165**DCL      5742--ASSIGN   5743--IF       5745--ASSIGN   5752--ASSIGN   5753--ASSIGN
B$DO.ERRC
       161**DCL      5747<<ASSIGN
B$DO.EVID
       160**DCL      5756>>IF
B$JIT.DCB$
       697**DCL      5660>>ASSIGN   5661>>IF       5742<<ASSIGN   5744>>ASSIGN   5745>>ASSIGN   5752>>ASSIGN
      5754>>ASSIGN   5757>>CALL     5757>>CALL
B$JIT.DCBNO
       688**DCL      5716>>ASSIGN
B$JIT.ERR
       607**DCL      5746<<ASSIGN
B$JIT.ERR.MID
       608**DCL       608--REDEF
B$JIT.SYSID
       607**DCL      5717>>ASSIGN
B$JIT.USER
       607**DCL      5665>>IF
B$JIT$
      5541**DCL       602--IMP-PTR  5660>>ASSIGN   5661>>IF       5665>>IF       5716>>ASSIGN   5717>>ASSIGN
      5742>>ASSIGN   5744>>ASSIGN   5745>>ASSIGN   5746>>ASSIGN   5752>>ASSIGN   5754>>ASSIGN   5757>>CALL
      5757>>CALL
B$U.MISC
PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:46   
       145**DCL       146--REDEF
B$USER.MISC
       221**DCL       222--REDEF
B$USER.SYSID
       216**DCL      5723>>ASSIGN
B$USRT$
      5542**DCL      5723>>ASSIGN
BLDCT
      5492**DCL      5706<>CALL
BLDCT.DDT$
      5494**DCL      5494--REDEF
BLDCT.DFLG.RLSE
      5499**DCL      5705>>IF
BLDCT.IOQ$
      5493**DCL      5494--REDEF
BLDCT.LDCTX
      5495**DCL      5495--REDEF
BLDCT.LKFLG.ABORTED
      5507**DCL      5508--REDEF
BLDCT.MSGID
      5492**DCL      5754>>ASSIGN
BLDCT.RAT$
      5495**DCL      5663>>ASSIGN   5665>>IF
BLDCT.RLCID.LDCTX
      5517**DCL      5517--REDEF
BLDCT.STA$
      5513**DCL      5514--REDEF
BLDCT.SYMB$
      5492**DCL      5492--REDEF    5492--REDEF    5493--REDEF
BLDCT.USER
      5502**DCL      5665>>IF       5685>>IF       5710<>CALL     5731<>CALL
CALLOUT
      5633**LABEL    5617--GOTO
COMIO
      5529**DCL      5712<<ASSIGN   5713--ASSIGN   5731--CALL
COMIO.ARS
PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:47   
      5531**DCL      5531--REDEF
COMIO.ID.DCBNO
      5531**DCL      5716<<ASSIGN   5719<<ASSIGN   5728<<ASSIGN   5728>>ASSIGN
COMIO.ID.SYSID
      5531**DCL      5717<<ASSIGN   5722<<ASSIGN   5723<<ASSIGN   5725<<ASSIGN   5727<<ASSIGN
COMIO.P#
      5531**DCL      5713<<ASSIGN   5713--ASSIGN
COMIO.SUBC2
      5531**DCL      5714<<ASSIGN
DISC
      5672**PROC     5631--CALL     5643--CALL
DOMN
      5478**DCL      5706<>CALL     5731<>CALL
ENTADR# IN PROCEDURE EVRPT
      5703**DCL      5708<<ASSIGN   5709<<ASSIGN   5711>>IF       5720>>IF       5731<>CALL
ERRCGORAU
      5572**DCL      5746>>ASSIGN   5747>>ASSIGN
EVNT
      5477**DCL      5706<>CALL     5711>>IF       5731<>CALL
EVRPT
      5701**PROC     5623--CALL     5669--CALL     5680--CALL     5686--CALL
F$DCB
       232**DCL      5757<>CALL
F$DCB.ACTPOS
       257**DCL       257--REDEF
F$DCB.ARS
       232**DCL       232--REDEF    5745<<ASSIGN   5754<<ASSIGN
F$DCB.ATTR
       250**DCL       251--REDEF
F$DCB.BORROW
       265**DCL       265--REDEF     265--REDEF     265--REDEF
F$DCB.DCBNAME.L
       279**DCL       279--IMP-SIZ  5757>>CALL
F$DCB.EOMCHAR
       236**DCL       236--REDEF
F$DCB.FCD
PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:48   
       245**DCL      5661>>IF
F$DCB.FLDID
       260**DCL       260--REDEF
F$DCB.FORM$
       254**DCL       254--REDEF
F$DCB.FSECT
       270**DCL       270--REDEF
F$DCB.FSN
       247**DCL       247--REDEF     247--REDEF     248--REDEF
F$DCB.HEADER$
       253**DCL       253--REDEF
F$DCB.IXTNSIZE
       251**DCL       251--REDEF
F$DCB.LASTSTA$
       241**DCL       241--REDEF
F$DCB.LVL
       266**DCL       266--REDEF
F$DCB.NAME.C
       241**DCL       241--REDEF
F$DCB.NOEOF
       262**DCL       262--REDEF
F$DCB.NRECS
       252**DCL       252--REDEF
F$DCB.NRECX
       271**DCL       271--REDEF
F$DCB.OHDR
       263**DCL       263--REDEF
F$DCB.ORG
       246**DCL       246--REDEF
F$DCB.PRECNO
       269**DCL       269--REDEF
F$DCB.RCSZ
       274**DCL       274--REDEF
F$DCB.RES
       242**DCL       242--REDEF
F$DCB.SETX
PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:49   
       254**DCL       254--REDEF    5660>>ASSIGN   5744<<ASSIGN   5752<<ASSIGN
F$DCB.TAB$
       253**DCL       254--REDEF
F$DCB.TDA
       268**DCL       268--REDEF
F$DCB.WSN
       243**DCL       243--REDEF
FRF$OPNCL_EVT
      5735**ENTRY    5708--ASSIGN
FSN$OPNCL_EVT
      5543**DCL-ENT  5757--CALL
GETOUT
      5634**LABEL    5613--CALLALT  5619--CALLALT  5629--CALLALT  5631--CALLALT  5634--CALLALT
K$RWPARM
      4773**DCL         7--PROC     5619<>CALL     5634<>CALL
K$RWPARM.BLKREC
      4799**DCL      4824--REDEF
K$RWPARM.BLKREC.BLKU#
      4800**DCL      4802--REDEF
K$RWPARM.BLKREC.RECU#
      4812**DCL      4814--REDEF
K$RWPARM.DVE.DVBYTE.VFC
      4839**DCL      4840--REDEF
K$RWPARM.DVE.EOMCHAR
      4847**DCL      4851--REDEF
K$RWPARM.ERR
      4911**DCL      4916--REDEF
K$RWPARM.FC
      4875**DCL      4876--REDEF
K$RWPARM.FLDID
      5057**DCL      5058--REDEF
K$RWPARM.FPT$
      4938**DCL      4945--REDEF
K$RWPARM.KEYTYPE
      5064**DCL      5065--REDEF
K$RWPARM.MRKTYP
PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:50   
      5049**DCL      5618>>IF
K$RWPARM.MSG$
      4774**DCL      4780--REDEF
K$RWPARM.MSGID
      4886**DCL      4891--REDEF
K$RWPARM.MSGIDXT
      4899**DCL      4903--REDEF
K$RWPARM.ORG
      5035**DCL      5036--REDEF
K$RWPARM.THDRSZ
      4979**DCL      4983--REDEF
K$RWPARM.UHDR$
      4924**DCL      5103--IMP-PTR  5143--IMP-PTR  5608>>DOCASE   5610>>IF       5722>>ASSIGN
K$RWPARM.VDOFLGS
      5037**DCL      5048--REDEF
KIA$DSC
      5544**DCL-ENT  5676--CALL
KIA$DSCTS
      5547**DCL-ENT  5678--CALL
KIA$FCNO
      5546**DCL-ENT  5613--CALL     5619--CALL     5629--CALL
KIA$GETEVNT
      5548**DCL-ENT  5706--CALL
KIA$UCIN
      5549**DCL-ENT  5634--CALL
KV$VDO.FNC
      5107**DCL      5608>>DOCASE
KV$VDO_EVT.BRKCNT
      5150**DCL      5722>>ASSIGN
KV$VDO_EVT.TYP
      5150**DCL      5610>>IF
K_RWPARM_CON
      2450**DCL      5612>>ASSIGN   5625>>ASSIGN   5673>>ASSIGN
K_RWPARM_CON.BLKREC
      2476**DCL      2501--REDEF
K_RWPARM_CON.BLKREC.BLKU#
PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:51   
      2477**DCL      2479--REDEF
K_RWPARM_CON.BLKREC.RECU#
      2489**DCL      2491--REDEF
K_RWPARM_CON.DVE.DVBYTE.VFC
      2516**DCL      2517--REDEF
K_RWPARM_CON.DVE.EOMCHAR
      2524**DCL      2528--REDEF
K_RWPARM_CON.ERR
      2588**DCL      2593--REDEF
K_RWPARM_CON.FC
      2552**DCL      2553--REDEF
K_RWPARM_CON.FLDID
      2734**DCL      2735--REDEF
K_RWPARM_CON.FPT$
      2615**DCL      2622--REDEF
K_RWPARM_CON.KEYTYPE
      2741**DCL      2742--REDEF
K_RWPARM_CON.MSG$
      2451**DCL      2457--REDEF
K_RWPARM_CON.MSGID
      2563**DCL      2568--REDEF
K_RWPARM_CON.MSGIDXT
      2576**DCL      2580--REDEF
K_RWPARM_CON.ORG
      2712**DCL      2713--REDEF
K_RWPARM_CON.THDRSZ
      2656**DCL      2660--REDEF
K_RWPARM_CON.VDOFLGS
      2714**DCL      2725--REDEF
LDCT$
      5158**DCL      5492--IMP-PTR  5616<<ASSIGN   5658<<ASSIGN   5660<<ASSIGN   5663<<ASSIGN   5663>>ASSIGN
      5664>>IF       5665>>IF       5665>>IF       5677<<ASSIGN   5684<<ASSIGN   5685>>IF       5705>>IF
      5706>>CALL     5707>>IF       5710>>CALL     5731>>CALL     5753<<ASSIGN   5754>>ASSIGN
N$DCT$$
      2778**DCL      2778--IMP-PTR  5660>>ASSIGN   5663>>ASSIGN   5684>>ASSIGN   5691>>CALL     5753>>ASSIGN
NK$LDCT
PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:52   
      4719**DCL         7--PROC     5613<>CALL     5616--ASSIGN   5619<>CALL     5629<>CALL     5634<>CALL
      5640--ENTRY    5650--ENTRY    5657--IF       5658--ASSIGN   5676<>CALL     5677--ASSIGN   5678<>CALL
      5707--IF       5715--IF       5735--ENTRY    5742--ASSIGN   5743--IF       5745--ASSIGN   5747--ASSIGN
      5752--ASSIGN   5753--ASSIGN   5756--IF
NK$LDCT.DCBNO
      4743**DCL      5719>>ASSIGN
NK$LDCT.DDT$
      4721**DCL      4721--REDEF
NK$LDCT.DEVNM
      4721**DCL      5626>>ASSIGN
NK$LDCT.DFLG.FEDN
      4727**DCL      5674>>IF
NK$LDCT.IOQ$
      4720**DCL      4721--REDEF
NK$LDCT.LDCTX
      4722**DCL      4722--REDEF    5620>>IF       5681>>IF       5724>>IF       5725>>ASSIGN
NK$LDCT.LKFLG.ABORTED
      4734**DCL      4735--REDEF
NK$LDCT.MSGID
      4719**DCL      5727>>ASSIGN
NK$LDCT.RAT$
      4722**DCL      5607>>ASSIGN   5642>>ASSIGN
NK$LDCT.RLCID.LDCTX
      4744**DCL      4744--REDEF
NK$LDCT.STA$
      4740**DCL      4741--REDEF
NK$LDCT.SYMB$
      4719**DCL      4719--REDEF    4719--REDEF    4720--REDEF
NK$LDCT.USER
      4729**DCL      5633>>IF       5685>>IF       5723>>ASSIGN
NK$LDCT$
      2778**DCL      5660>>ASSIGN   5663>>ASSIGN   5684>>ASSIGN   5691<>CALL     5753>>ASSIGN
NKL$RELDCTL
      5550**DCL-ENT  5691--CALL
OPARM
      5181**DCL      5612<<ASSIGN   5613<>CALL     5625<<ASSIGN   5629<>CALL     5673<<ASSIGN   5676<>CALL
PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:53   
      5678<>CALL
OPARM.BLKREC
      5207**DCL      5232--REDEF
OPARM.BLKREC.BLKU#
      5208**DCL      5210--REDEF
OPARM.BLKREC.RECU#
      5220**DCL      5222--REDEF
OPARM.DVE.DVBYTE.VFC
      5247**DCL      5248--REDEF
OPARM.DVE.EOMCHAR
      5255**DCL      5259--REDEF
OPARM.ERR
      5319**DCL      5324--REDEF
OPARM.FC
      5283**DCL      5284--REDEF
OPARM.FLDID
      5465**DCL      5466--REDEF
OPARM.FPT$
      5346**DCL      5353--REDEF
OPARM.KEYTYPE
      5472**DCL      5473--REDEF
OPARM.MSG$
      5182**DCL      5188--REDEF    5628<<ASSIGN
OPARM.MSGID
      5294**DCL      5299--REDEF
OPARM.MSGIDXT
      5307**DCL      5311--REDEF
OPARM.MSGSZ
      5189**DCL      5627<<ASSIGN
OPARM.ORG
      5443**DCL      5444--REDEF
OPARM.THDRSZ
      5387**DCL      5391--REDEF
OPARM.VDOFLGS
      5445**DCL      5456--REDEF
RAT.CLFLG
PL6.E3A0      #001=FRF$IN File=FRF$FEPRES.:E05TSI                                TUE 07/29/97 17:22 Page:54   
       779**DCL      5694<<ASSIGN
RAT.CLFLG.AUCTL
       780**DCL      5620>>IF       5665>>IF       5682>>IF
RAT.DCTX
       783**DCL      5620>>IF       5663>>ASSIGN   5681>>IF       5684>>ASSIGN   5691>>CALL     5692<<ASSIGN
RAT.FLG
       791**DCL      5695<<ASSIGN
RAT.FLG.OPN
       797**DCL      5690>>IF
RAT.FLG.RUP
       799**DCL      5689<<ASSIGN
RAT.RCOD
       778**DCL      5693<<ASSIGN
RAT.TYP
       789**DCL      5610>>IF       5617>>IF       5633>>IF
RAT$
      5159**DCL       765--IMP-PTR  5607<<ASSIGN   5610>>IF       5617>>IF       5620>>IF       5620>>IF
      5633>>IF       5642<<ASSIGN   5681>>IF       5682>>IF       5684>>ASSIGN   5689>>ASSIGN   5690>>IF
      5691>>CALL     5692>>ASSIGN   5693>>ASSIGN   5694>>ASSIGN   5695>>ASSIGN
SSR$RUE
      5551**DCL-ENT  5710--CALL
SSV$EVENT
      5552**DCL-ENT  5731--CALL
SUBC2
      5534**DCL      5621<<ASSIGN   5622<<ASSIGN   5656<<ASSIGN   5662<<ASSIGN   5679<<ASSIGN   5707>>IF
      5714>>ASSIGN   5721>>IF
TSTATE
      5476**DCL      5626<<ASSIGN   5627--ASSIGN   5628--ASSIGN

PL6.E3A0      #002=FRF$ADDRES File=FRF$FEPRES.:E05TSI                            TUE 07/29/97 17:22 Page:55   
      254        1        /*T***********************************************************/
      255        2        /*T*                                                         */
      256        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      257        4        /*T*                                                         */
      258        5        /*T***********************************************************/
      259        6        FRF$ADDRES: PROC(NK$LDCT,PCD) ALTRET;
      260        7
      261        8        %INCLUDE B$JIT;
      262      611        %INCLUDE FR$RAT;
      263      664        %FR$RAT (NAME=RAT,STCLASS="BASED(RAT$)");
      264      704        %INCLUDE FR_DATA_R;
      265      736        %INCLUDE FR_ERRORS_C;
      266      767        %INCLUDE FR_SUBS;
      267      835        %INCLUDE HF_LOCK_C;
      268      849        %INCLUDE KC$CGBLK;
      269      897        %INCLUDE KC_CP6;
      270     1457        %INCLUDE KL_MACRO_C;
      271     4809        %INCLUDE NK$LDCT;
      272     4911        %INCLUDE UD_SEV_C;
      273     4925        %INCLUDE UM_CP6;
      274     5777
      275     5778        /* Paramters */
      276     5779        %KL_PCD(FPTN=PCD,CG=1,STCLASS=PARAM);
      277     5944        %NK$LDCT (STCLASS=PARAM);
      278     5990
      279     5991        /* Symrefs */
      280     5992    1   DCL B$JIT$ PTR SYMREF;
      281     5993
      282     5994        /* Auto */
      283     5995    1   DCL RAT$ PTR;
      284     5996
      285     5997        /* Error codes */
      286     5998        %VLP_ERRCODE (STCLASS=CONSTANT,FCG=FR,MID=F,MON='1'B,SEV=SEV_ERROR#,
      287     5999                     FPTN=NORESSLOT, ERR#=%E$NORESSLOT);
      288     6044
      289     6045        %EJECT;
PL6.E3A0      #002=FRF$ADDRES File=FRF$FEPRES.:E05TSI                            TUE 07/29/97 17:22 Page:56   
      290     6046                                                /* Find an empty slot                 */
      291     6047    1           RAT$ = FR$HD$(FR_NPOOL);
      292     6048
      293     6049    2           DO WHILE (RAT$ ~= ADDR(NIL));
      294     6050    2              IF RAT.RCOD=FR_FREE
      295     6051    2              THEN
      296     6052    2                 GOTO FOUND_FREE;
      297     6053    2              RAT$ = RAT.LNK$;
      298     6054    2              END;
      299     6055
      300     6056    1           B$JIT.ERR = NORESSLOT;
      301     6057             /*E* ERROR: FRF-E$NORESSLOT-0
      302     6058                  MESSAGE: There is no empty resource slot for this resource.
      303     6059              */
      304     6060    1           ALTRETURN;
      305     6061
      306     6062    1   FOUND_FREE: ;
      307     6063    1           RAT.DCTX = NK$LDCT.LDCTX;
      308     6064    1           RAT.RES = '0'B;
      309     6065    1           RAT.FLG = '0'B;
      310     6066    1           RAT.REEL = '0'B;
      311     6067    1           RAT.CLFLG = '0'B;
      312     6068    1           RAT.TYP = SUBSTR(NK$LDCT.DEVNM,0,2);
      313     6069    2           IF RAT.TYP='CL' THEN DO;
      314     6070    2               NK$LDCT.CLLNK$ = ADDR(NK$LDCT);
      315     6071    2              RAT.REEL.SER = PCD.CGINFO.RESINFO.RNAME;
      316     6072    3              IF PCD.CGINFO.RESINFO.MODE~=3 THEN DO;/* FIXED */
      317     6073    3                 RAT.CLFLG.MULT = '1'B;
      318     6074    3                 NK$LDCT.DFLG.INPUT = '0'B;
      319     6075    3                 END;
      320     6076    2              NK$LDCT.LOGON_ACCT = PCD.CGINFO.RESINFO.AUACCT;
      321     6077    2              IF NK$LDCT.LOGON_ACCT~=' '
      322     6078    2              THEN RAT.CLFLG.AUCTL = '1'B;
      323     6079    2              ELSE NK$LDCT.LOGON_ACCT = '?';
      324     6080    2              END;
      325     6081    1           ELSE RAT.FLG.MBIT.MTD = '1'B;
      326     6082    1           RAT.M1 = PCD.CGINFO.ATTR;
PL6.E3A0      #002=FRF$ADDRES File=FRF$FEPRES.:E05TSI                            TUE 07/29/97 17:22 Page:57   
      327     6083    1           RAT.RCOD = FR_FEPRES;
      328     6084        /*      RAT.FLG.RUP = '1'B; delay setting RUP until LDCT.RLCID is there */
      329     6085    1           NK$LDCT.RAT$ = RAT$;
      330     6086    1           RETURN;
      331     6087
      332     6088    1   END FRF$ADDRES;

PL6.E3A0      #002=FRF$ADDRES File=FRF$FEPRES.:E05TSI                            TUE 07/29/97 17:22 Page:58   
--  Include file information  --

   UM_CP6.:E05TOU  is referenced.
   UD_SEV_C.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   KC_CP6.:E05TOU  is referenced.
   KC$CGBLK.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   FR_SUBS.:E05TOU  is referenced.
   FR_ERRORS_C.:E05TOU  is referenced.
   FR_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FR$RAT.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FRF$ADDRES.

   Procedure FRF$ADDRES requires 75 words for executable code.
   Procedure FRF$ADDRES requires 8 words of local(AUTO) storage.

    No errors detected in file FRF$FEPRES.:E05TSI    .

PL6.E3A0      #002=FRF$ADDRES File=FRF$FEPRES.:E05TSI                            TUE 07/29/97 17:22 Page:59   

 Object Unit name= FRF$ADDRES                                 File name= FRF$FEPRES.:E05TOU
 UTS= JUL 29 '97 17:22:38.20 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      2      2  FRF$ADDRES
    1   Proc  even  none    75    113  FRF$ADDRES
    2  RoData even  none     6      6  FRF$ADDRES

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        2  FRF$ADDRES

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
                       nStd      0 X66_AUTO_2
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AALT
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     FR$HD$                                B$JIT$                                B_VECTNIL
PL6.E3A0      #002=FRF$ADDRES File=FRF$FEPRES.:E05TSI                            TUE 07/29/97 17:22 Page:60   


      254        1        /*T***********************************************************/
      255        2        /*T*                                                         */
      256        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      257        4        /*T*                                                         */
      258        5        /*T***********************************************************/
      259        6        FRF$ADDRES: PROC(NK$LDCT,PCD) ALTRET;

      6  1 000000   000000 700200 xent  FRF$ADDRES   TSX0  ! X66_AUTO_2
         1 000001   000010 000002                    ZERO    8,2

      260        7
      261        8        %INCLUDE B$JIT;
      262      611        %INCLUDE FR$RAT;
      263      664        %FR$RAT (NAME=RAT,STCLASS="BASED(RAT$)");
      264      704        %INCLUDE FR_DATA_R;
      265      736        %INCLUDE FR_ERRORS_C;
      266      767        %INCLUDE FR_SUBS;
      267      835        %INCLUDE HF_LOCK_C;
      268      849        %INCLUDE KC$CGBLK;
      269      897        %INCLUDE KC_CP6;
      270     1457        %INCLUDE KL_MACRO_C;
      271     4809        %INCLUDE NK$LDCT;
      272     4911        %INCLUDE UD_SEV_C;
      273     4925        %INCLUDE UM_CP6;
      274     5777
      275     5778        /* Paramters */
      276     5779        %KL_PCD(FPTN=PCD,CG=1,STCLASS=PARAM);
      277     5944        %NK$LDCT (STCLASS=PARAM);
      278     5990
      279     5991        /* Symrefs */
      280     5992    1   DCL B$JIT$ PTR SYMREF;
      281     5993
      282     5994        /* Auto */
      283     5995    1   DCL RAT$ PTR;
      284     5996
      285     5997        /* Error codes */
PL6.E3A0      #002=FRF$ADDRES File=FRF$FEPRES.:E05TSI                            TUE 07/29/97 17:22 Page:61   
      286     5998        %VLP_ERRCODE (STCLASS=CONSTANT,FCG=FR,MID=F,MON='1'B,SEV=SEV_ERROR#,
      287     5999                     FPTN=NORESSLOT, ERR#=%E$NORESSLOT);
      288     6044
      289     6045        %EJECT;
PL6.E3A0      #002=FRF$ADDRES File=FRF$FEPRES.:E05TSI                            TUE 07/29/97 17:22 Page:62   
      290     6046                                                /* Find an empty slot                 */
      291     6047    1           RAT$ = FR$HD$(FR_NPOOL);

   6047  1 000002   000002 236000 xsym               LDQ     FR$HD$+2
         1 000003   200005 756100                    STQ     RAT$,,AUTO

      292     6048
      293     6049    2           DO WHILE (RAT$ ~= ADDR(NIL));

   6049  1 000004   000014 710000 1                  TRA     s:6054

      294     6050    2              IF RAT.RCOD=FR_FREE

   6050  1 000005   200005 470500                    LDP0    RAT$,,AUTO
         1 000006   000003 236100                    LDQ     3,,PR0
         1 000007   000740 376003                    ANQ     480,DU
         1 000010   000140 116003                    CMPQ    96,DU
         1 000011   000022 600000 1                  TZE     FOUND_FREE

      295     6051    2              THEN
      296     6052    2                 GOTO FOUND_FREE;
      297     6053    2              RAT$ = RAT.LNK$;

   6053  1 000012   000000 236100                    LDQ     0,,PR0
         1 000013   200005 756100                    STQ     RAT$,,AUTO

      298     6054    2              END;

   6054  1 000014   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000015   000005 601000 1                  TNZ     s:6050

      299     6055
      300     6056    1           B$JIT.ERR = NORESSLOT;

   6056  1 000016   000000 236000 0                  LDQ     NORESSLOT
         1 000017   000000 470400 xsym               LDP0    B$JIT$
         1 000020   000012 756100                    STQ     10,,PR0
PL6.E3A0      #002=FRF$ADDRES File=FRF$FEPRES.:E05TSI                            TUE 07/29/97 17:22 Page:63   

      301     6057             /*E* ERROR: FRF-E$NORESSLOT-0
      302     6058                  MESSAGE: There is no empty resource slot for this resource.
      303     6059              */
      304     6060    1           ALTRETURN;

   6060  1 000021   000000 702200 xent               TSX2  ! X66_AALT

   6056  1 000022                       FOUND_FREE   null
      305     6061
      306     6062    1   FOUND_FREE: ;
      307     6063    1           RAT.DCTX = NK$LDCT.LDCTX;

   6063  1 000022   200003 471500                    LDP1    @NK$LDCT,,AUTO
         1 000023   100006 220100                    LDX0    6,,PR1
         1 000024   000003 440100                    SXL0    3,,PR0

      308     6064    1           RAT.RES = '0'B;

   6064  1 000025   000100 100400                    MLR     fill='000'O
         1 000026   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         1 000027   000001 000011                    ADSC9   1,,PR0                   cn=0,n=9

      309     6065    1           RAT.FLG = '0'B;

   6065  1 000030   000000 236003                    LDQ     0,DU
         1 000031   000010 552104                    STBQ    8,'04'O,PR0

      310     6066    1           RAT.REEL = '0'B;

   6066  1 000032   000004 450100                    STZ     4,,PR0
         1 000033   000005 450100                    STZ     5,,PR0

      311     6067    1           RAT.CLFLG = '0'B;

   6067  1 000034   000000 236000 2                  LDQ     0
         1 000035   000003 356100                    ANSQ    3,,PR0
PL6.E3A0      #002=FRF$ADDRES File=FRF$FEPRES.:E05TSI                            TUE 07/29/97 17:22 Page:64   

      312     6068    1           RAT.TYP = SUBSTR(NK$LDCT.DEVNM,0,2);

   6068  1 000036   100002 221100                    LDX1    2,,PR1
         1 000037   000010 741100                    STX1    8,,PR0

      313     6069    2           IF RAT.TYP='CL' THEN DO;

   6069  1 000040   000001 101000 0                  CMPX1   NORESSLOT+1
         1 000041   000074 601000 1                  TNZ     s:6081

      314     6070    2               NK$LDCT.CLLNK$ = ADDR(NK$LDCT);

   6070  1 000042   200003 236100                    LDQ     @NK$LDCT,,AUTO
         1 000043   100012 756100                    STQ     10,,PR1

      315     6071    2              RAT.REEL.SER = PCD.CGINFO.RESINFO.RNAME;

   6071  1 000044   200004 473500                    LDP3    @PCD,,AUTO
         1 000045   040100 100500                    MLR     fill='040'O
         1 000046   300044 400006                    ADSC9   36,,PR3                  cn=2,n=6
         1 000047   000004 400006                    ADSC9   4,,PR0                   cn=2,n=6

      316     6072    3              IF PCD.CGINFO.RESINFO.MODE~=3 THEN DO;/* FIXED */

   6072  1 000050   300044 220100                    LDX0    36,,PR3
         1 000051   000003 100003                    CMPX0   3,DU
         1 000052   000057 600000 1                  TZE     s:6076

      317     6073    3                 RAT.CLFLG.MULT = '1'B;

   6073  1 000053   000010 236003                    LDQ     8,DU
         1 000054   000003 256100                    ORSQ    3,,PR0

      318     6074    3                 NK$LDCT.DFLG.INPUT = '0'B;

   6074  1 000055   000001 236000 2                  LDQ     1
PL6.E3A0      #002=FRF$ADDRES File=FRF$FEPRES.:E05TSI                            TUE 07/29/97 17:22 Page:65   
         1 000056   100006 356100                    ANSQ    6,,PR1

      319     6075    3                 END;

      320     6076    2              NK$LDCT.LOGON_ACCT = PCD.CGINFO.RESINFO.AUACCT;

   6076  1 000057   040100 100500                    MLR     fill='040'O
         1 000060   300046 000010                    ADSC9   38,,PR3                  cn=0,n=8
         1 000061   100024 000010                    ADSC9   20,,PR1                  cn=0,n=8

      321     6077    2              IF NK$LDCT.LOGON_ACCT~=' '

   6077  1 000062   100024 237100                    LDAQ    20,,PR1
         1 000063   000002 117000 2                  CMPAQ   2
         1 000064   000070 600000 1                  TZE     s:6079

      322     6078    2              THEN RAT.CLFLG.AUCTL = '1'B;

   6078  1 000065   000020 236003                    LDQ     16,DU
         1 000066   000003 256100                    ORSQ    3,,PR0
         1 000067   000076 710000 1                  TRA     s:6082

      323     6079    2              ELSE NK$LDCT.LOGON_ACCT = '?';

   6079  1 000070   000004 235000 2                  LDA     4
         1 000071   000035 236000 xsym               LDQ     B_VECTNIL+29
         1 000072   100024 757100                    STAQ    20,,PR1

      324     6080    2              END;

   6080  1 000073   000076 710000 1                  TRA     s:6082

      325     6081    1           ELSE RAT.FLG.MBIT.MTD = '1'B;

   6081  1 000074   000400 236007                    LDQ     256,DL
         1 000075   000010 256100                    ORSQ    8,,PR0

PL6.E3A0      #002=FRF$ADDRES File=FRF$FEPRES.:E05TSI                            TUE 07/29/97 17:22 Page:66   
      326     6082    1           RAT.M1 = PCD.CGINFO.ATTR;

   6082  1 000076   200004 473500                    LDP3    @PCD,,AUTO
         1 000077   000100 100500                    MLR     fill='000'O
         1 000100   300043 200002                    ADSC9   35,,PR3                  cn=1,n=2
         1 000101   200006 000004                    ADSC9   RAT$+1,,AUTO             cn=0,n=4
         1 000102   200006 220100                    LDX0    RAT$+1,,AUTO
         1 000103   000006 740100                    STX0    6,,PR0

      327     6083    1           RAT.RCOD = FR_FEPRES;

   6083  1 000104   000003 236100                    LDQ     3,,PR0
         1 000105   000005 376000 2                  ANQ     5
         1 000106   000240 276003                    ORQ     160,DU
         1 000107   000003 756100                    STQ     3,,PR0

      328     6084        /*      RAT.FLG.RUP = '1'B; delay setting RUP until LDCT.RLCID is there */
      329     6085    1           NK$LDCT.RAT$ = RAT$;

   6085  1 000110   200005 236100                    LDQ     RAT$,,AUTO
         1 000111   100005 756100                    STQ     5,,PR1

      330     6086    1           RETURN;

   6086  1 000112   000000 702200 xent               TSX2  ! X66_ARET

NORESSLOT
 Sect OctLoc
   0     000   062206 412414                                                    2...

(unnamed)
 Sect OctLoc
   0     001   103114 040040                                                    CL

(unnamed)
 Sect OctLoc
   2     000   777740 777777   777777 377777   040040 040040   040040 040040    ........
PL6.E3A0      #002=FRF$ADDRES File=FRF$FEPRES.:E05TSI                            TUE 07/29/97 17:22 Page:67   
   2     004   077040 040040   777037 777777                                    ?   ....
      331     6087
      332     6088    1   END FRF$ADDRES;

PL6.E3A0      #002=FRF$ADDRES File=FRF$FEPRES.:E05TSI                            TUE 07/29/97 17:22 Page:68   
--  Include file information  --

   UM_CP6.:E05TOU  is referenced.
   UD_SEV_C.:E05TOU  is referenced.
   NK$LDCT.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   KC_CP6.:E05TOU  is referenced.
   KC$CGBLK.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   FR_SUBS.:E05TOU  is referenced.
   FR_ERRORS_C.:E05TOU  is referenced.
   FR_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   FR$RAT.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure FRF$ADDRES.
PL6.E3A0      #002=FRF$ADDRES File=FRF$FEPRES.:E05TSI                            TUE 07/29/97 17:22 Page:69   

 **** Variables and constants ****

  ****  Section 000 RoData FRF$ADDRES

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC        r     1 NORESSLOT

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @NK$LDCT                   4-0-0/w PTR         r     1 @PCD
    *0-0-0/d STRC(864)   r     1 NK$LDCT                   *0-0-0/w STRC(2448)  r     1 PCD
     5-0-0/w PTR         r     1 RAT$

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 FR$HD$(0:3)

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8856)  r     1 B$JIT                      0-0-0/w STRC(324)   r     1 RAT


   Procedure FRF$ADDRES requires 75 words for executable code.
   Procedure FRF$ADDRES requires 8 words of local(AUTO) storage.
PL6.E3A0      #002=FRF$ADDRES File=FRF$FEPRES.:E05TSI                            TUE 07/29/97 17:22 Page:70   

    No errors detected in file FRF$FEPRES.:E05TSI    .
PL6.E3A0      #002=FRF$ADDRES File=FRF$FEPRES.:E05TSI                            TUE 07/29/97 17:22 Page:71   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=FRF$ADDRES File=FRF$FEPRES.:E05TSI                            TUE 07/29/97 17:22 Page:72   
          MINI XREF LISTING

B$JIT.CPFLAGS1.SLEAZE
       429**DCL       429--REDEF
B$JIT.ERR
       335**DCL      6056<<ASSIGN
B$JIT.ERR.MID
       336**DCL       336--REDEF
B$JIT.JRESPEAK
       497**DCL       498--REDEF
B$JIT.ORIGINATOR_PORT.FROM_CR
       606**DCL       606--REDEF     607--REDEF
B$JIT.PNR
       510**DCL       510--REDEF
B$JIT.TSLINE
       604**DCL       605--REDEF
B$JIT$
      5992**DCL       330--IMP-PTR  6056>>ASSIGN
FOUND_FREE
      6056**LABEL    6052--GOTO
FR$HD$
       713**DCL      6047>>ASSIGN
NK$LDCT
      5957**DCL         6--PROC     6070--ASSIGN
NK$LDCT.CLLNK$
      5979**DCL      6070<<ASSIGN
NK$LDCT.DDT$
      5959**DCL      5959--REDEF
NK$LDCT.DEVNM
      5959**DCL      6068>>ASSIGN
NK$LDCT.DFLG.INPUT
      5961**DCL      6074<<ASSIGN
NK$LDCT.IOQ$
      5958**DCL      5959--REDEF
PL6.E3A0      #002=FRF$ADDRES File=FRF$FEPRES.:E05TSI                            TUE 07/29/97 17:22 Page:73   
NK$LDCT.LDCTX
      5960**DCL      5960--REDEF    6063>>ASSIGN
NK$LDCT.LKFLG.ABORTED
      5972**DCL      5973--REDEF
NK$LDCT.LOGON_ACCT
      5987**DCL      6076<<ASSIGN   6077>>IF       6079<<ASSIGN
NK$LDCT.RAT$
      5960**DCL      6085<<ASSIGN
NK$LDCT.RLCID.LDCTX
      5982**DCL      5982--REDEF
NK$LDCT.STA$
      5978**DCL      5979--REDEF
NK$LDCT.SYMB$
      5957**DCL      5957--REDEF    5957--REDEF    5958--REDEF
NORESSLOT
      6011**DCL      6056>>ASSIGN
PCD
      5794**DCL         6--PROC
PCD.ADDD.CINFO
      5844**DCL      5848--REDEF
PCD.ADDD.DEVNM
      5837**DCL      5838--REDEF
PCD.ADDD.NMID
      5851**DCL      5852--REDEF
PCD.CGINFO.ATTR
      5903**DCL      5903--REDEF    6082>>ASSIGN
PCD.CGINFO.RESINFO.AUACCT
      5924**DCL      6076>>ASSIGN
PCD.CGINFO.RESINFO.MODE
      5909**DCL      6072>>IF
PCD.CGINFO.RESINFO.RNAME
      5919**DCL      6071>>ASSIGN
PCD.CGINFO.XTRAINFO
      5906**DCL      5908--REDEF
RAT.CLFLG
       680**DCL      6067<<ASSIGN
PL6.E3A0      #002=FRF$ADDRES File=FRF$FEPRES.:E05TSI                            TUE 07/29/97 17:22 Page:74   
RAT.CLFLG.AUCTL
       681**DCL      6078<<ASSIGN
RAT.CLFLG.MULT
       682**DCL      6073<<ASSIGN
RAT.DCTX
       684**DCL      6063<<ASSIGN
RAT.FLG
       692**DCL      6065<<ASSIGN
RAT.FLG.MBIT.MTD
       694**DCL      6081<<ASSIGN
RAT.LNK$
       667**DCL      6053>>ASSIGN
RAT.M1
       688**DCL      6082<<ASSIGN
RAT.RCOD
       679**DCL      6050>>IF       6083<<ASSIGN
RAT.REEL
       685**DCL      6066<<ASSIGN
RAT.REEL.SER
       687**DCL      6071<<ASSIGN
RAT.RES
       668**DCL      6064<<ASSIGN
RAT.TYP
       690**DCL      6068<<ASSIGN   6069>>IF
RAT$
      5995**DCL       666--IMP-PTR  6047<<ASSIGN   6049>>DOWHILE  6050>>IF       6053<<ASSIGN   6053>>ASSIGN
      6063>>ASSIGN   6064>>ASSIGN   6065>>ASSIGN   6066>>ASSIGN   6067>>ASSIGN   6068>>ASSIGN   6069>>IF
      6071>>ASSIGN   6073>>ASSIGN   6078>>ASSIGN   6081>>ASSIGN   6082>>ASSIGN   6083>>ASSIGN   6085>>ASSIGN
