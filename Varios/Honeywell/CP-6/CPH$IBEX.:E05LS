VERSION E05

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:1    
        1        1        /*M*    CPH$IBEX  implements BATCH, DEFAULT, GLOBAL, XEQand XMIT cmds */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X*    DMC,DFC */
        8        8        /*P*   NAME:   CPH$IBEX
        9        9               PURPOSE: To perform all the required operations in the execution
       10       10                       of BATCH, DEFAULT, GLOBAL and XEQ commands.
       11       11               DESCRIPTION:
       12       12               REFERENCE: Programmers Reference Manual
       13       13        */
       14       14        /**********************************************************************/
       15       15        CPH$IBEX:
       16       16          PROC(P$PCB)    ALTRET;
       17       17                   %INCLUDE CP_6;
       18       98                   %INCLUDE B$JIT;
       19      388                   %INCLUDE B_MACROS_C;
       20      499                   %INCLUDE B_MICROPS_C;
       21      671                   %INCLUDE CP_6_SUBS;
       22     1211                   %INCLUDE B_ERRORS_C;
       23     2338                   %INCLUDE AS_SUPER_C;
       24     2773                   %INCLUDE CP_MACROS_C;
       25     3525                   %INCLUDE CP_PERR_C;
       26     3863                   %INCLUDE CP_SUBS_C;
       27     4780                   %INCLUDE XU_MACRO_C;
       28     7886                   %INCLUDE XU_PERR_C;
       29     8077                   %INCLUDE XUM_MACRO_C;
       30     8104                   %INCLUDE CP_DATA_R;
       31    10667                   %INCLUDE XU_SUBS_C;
       32    10759                   %INCLUDE XUH_MACRO_C;
       33    10843                   %INCLUDE B$TABLES_C ;
       34    10951                   %INCLUDE XSJ_SUBS_C;
       35    10978                   %INCLUDE XSJ_MAC_C;
       36    11057        /***** vectors *****/
       37    11058          %VECTOR (NAME=SEG3_,STCLASS=AUTO);
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:2    
       38    11068        /***** ptrs *****/
       39    11069    1     DCL JOB_FID$ PTR;
       40    11070    1     DCL TEMP$ PTR;
       41    11071    1     DCL P$ PTR;
       42    11072    1     DCL BLK$ PTR;
       43    11073        /***** external routines *****/
       44    11074    1     DCL CPA$GETRES ENTRY ALTRET;
       45    11075    1     DCL CPK$SUBMIT_CHECK ENTRY(1) ALTRET;
       46    11076    1     DCL CPB$OPENCS ENTRY;
       47    11077    1     DCL CPC$GETDCB ENTRY(2);
       48    11078    1     DCL CPC$GETSEG ENTRY(2) ALTRET;
       49    11079    1     DCL CPC$OPEN_LL ENTRY ;
       50    11080    1     DCL CPC$OPEN_S ENTRY(1) ALTRET;
       51    11081    1     DCL CPC$RELDCB ENTRY(1);
       52    11082    1     DCL CPC$RDUSERS ENTRY(2) ALTRET;
       53    11083    1     DCL CPC$RELSEG ENTRY(1);
       54    11084    1     DCL CPC$SCREECH ENTRY(2);
       55    11085    1     DCL CPC$WRITEMSGE ENTRY(6);
       56    11086    1     DCL CPD$SET_NODES ENTRY(4) ;
       57    11087    1     DCL CPD$NULL_SFROUTINE ENTRY(1) ;
       58    11088    1     DCL CPD$SYNTRY ENTRY(1);
       59    11089    1     DCL CPE$DIAGOUT ENTRY(1) ALTRET;
       60    11090    1     DCL CPE$LISTOUT ENTRY(1) ALTRET;
       61    11091    1     DCL CPE$RZEROS ENTRY(3);
       62    11092    1     DCL CPG$SET_WHEN_STATE ENTRY ALTRET;
       63    11093    1     DCL CPH$CONTINUE ENTRY(1);
       64    11094    1     DCL CPH$SYM_DELETE ENTRY(2) ALTRET;
       65    11095    1     DCL CPH$SYM_GET ENTRY(2) ALTRET;
       66    11096    1     DCL CPH$SYM_PUT ENTRY(2) ALTRET;
       67    11097    1     DCL CPH$STRING_SUB ENTRY(1);
       68    11098    1     DCL X$STRIP_BLANKS ENTRY(1);
       69    11099    1     DCL CPJ$READ_S ENTRY(3) ALTRET;
       70    11100    1     DCL CPJ$WRITE_S ENTRY(3) ALTRET;
       71    11101    1     DCL CXP$POSTERR ENTRY(5);
       72    11102    1     DCL CXX$OCTBIN ENTRY(2) ALTRET;
       73    11103    1     DCL CXX$VERIFY ENTRY(2);
       74    11104    1     DCL CPR$RPTERR ENTRY(2);
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:3    
       75    11105    1     DCL X$DEALLOCATE ENTRY(1) ALTRET;
       76    11106    1     DCL X$PARSE ENTRY(1) ALTRET;
       77    11107    1     DCL XSJ$OPEN ENTRY(1) ALTRET;
       78    11108    1     DCL XSJ$READ ENTRY(1) ALTRET;
       79    11109    1     DCL XSJ$CLOSE ENTRY(1) ALTRET;
       80    11110          %INCLUDE CXG_ENTRY;
       81    11122        /***** Constants *****/
       82    11123    1     DCL EDIT_MOPS (0:4) BIT(9) UNAL CONSTANT
       83    11124    1        INIT (%MVZB4, %MVC1, %SES10, %INSB7, %MVC3);
       84    11125          %XSJ_PARAM (FPTN = CXSJ_PARAM,
       85    11126                      STCLASS = CONSTANT,
       86    11127                      MODE = %IN#,
       87    11128                      TYPE = %TYP_NAME#,
       88    11129                      SHARE = %ALL#) ;
       89    11146        /***** symref variables *****/
       90    11147    1     DCL CPSL_NODES UBIN WORD SYMREF;
       91    11148    1     DCL IF_ UBIN WORD SYMREF;
       92    11149    1     DCL IBEX_CMD UBIN WORD SYMREF;
       93    11150        %B$SR_NON_BLANK;
       94    11154        %B$XL_UPPER;
       95    11158        /***** character strings *****/
       96    11159    1     DCL WRITEBUF CHAR(%CPBUFFSIZE) AUTO;
       97    11160    1     DCL TEMPBUF CHAR(%CPBUFFSIZE) AUTO;
       98    11161    1     DCL BLANKS CHAR(8) CONSTANT  INIT(' ');
       99    11162    1     DCL READBUF  CHAR(%CPBUFFSIZE) AUTO;
      100    11163    1     DCL READBUFB(0:%(CPBUFFSIZE/4-1)) REDEF READBUF BIT(36);
      101    11164    1     DCL END_LABEL CHAR(31) AUTO;
      102    11165    1     DCL START_LABEL CHAR(31) AUTO;
      103    11166    1     DCL FID_ASN UBIN(9);   /*Fid asn*/
      104    11167    1     DCL FID_RES CHAR(4);   /*Fid res*/
      105    11168    1     DCL VALUE_BUF CHAR(8) AUTO;   /* Only for CHARBIN/BINCHAR ops */
      106    11169    1   DCL 1 FOL_NAME AUTO,
      107    11170    1         2 CNT UBIN BYTE UNAL,
      108    11171    1         2 NAME CHAR(31) CALIGNED;
      109    11172    1   DCL FOL_ACCT CHAR(8) AUTO ;
      110    11173        /***** word variables *****/
      111    11174    1     DCL END_METHOD UBIN WORD AUTO;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:4    
      112    11175    1     DCL END_NUM UBIN WORD AUTO;
      113    11176    1     DCL START_METHOD UBIN WORD AUTO;
      114    11177    1     DCL START_NUM UBIN WORD AUTO;
      115    11178    1     DCL VALUE SBIN WORD AUTO;   /* Only for CHARBIN/BINCHAR ops */
      116    11179    1     DCL SAVE_NUM UBIN WORD AUTO;   /* Only for !INCLUDE processing */
      117    11180    1     DCL SAVE_SEED BIT(36) AUTO;   /* Only for !INCLUDE processing */
      118    11181    1     DCL CPOS UBIN WORD AUTO;   /* Only for CXP$POSTERR charpos */
      119    11182    1     DCL START_INDX UBIN WORD AUTO;   /* Only for INDEX function */
      120    11183    1     DCL STR_INDX UBIN WORD AUTO;   /* Only for INDEX function */
      121    11184    1     DCL NUM_FILES UBIN WORD AUTO;   /* Loop counter */
      122    11185    1     DCL NUM_OPTS UBIN WORD AUTO;   /* Loop counter */
      123    11186    1     DCL X UBIN WORD AUTO;           /* Unused variable for SEARCH */
      124    11187        /***** bit flags *****/
      125    11188    1     DCL JOB_FLAG# BIT(1) AUTO;
      126    11189    1     DCL MATCHED_PAIR# BIT(1) AUTO;
      127    11190    1     DCL NSTATUS_OPT# BIT(1) AUTO;
      128    11191    1     DCL CROSS_ACCT_BATCH_FLG BIT(1) AUTO;
      129    11192    1     DCL SCAN_OPT# BIT(1) AUTO;
      130    11193    1     DCL ECHO_FILE_OK# BIT(1) AUTO;
      131    11194    1     DCL CALL_FLG# BIT(1) AUTO;
      132    11195    1     DCL TRUNCATED_RECORD BIT(1) AUTO ;
      133    11196    1   DCL IBEX_OPEN_2_JOBSTATS BIT(1) ;
      134    11197    1   DCL NEED_2_RELEASE_IBEX2 BIT(1) ;
      135    11198    1   DCL NEED_ALTRETURN BIT(1) ;
      136    11199    1   DCL ECHO_JOB_CMD BIT(1) ;
      137    11200        /***** fpts *****/
      138    11201          %FPT_READ (FPTN=FPT_READ,STCLASS=AUTO);
      139    11240          %FPT_READ (FPTN=FPT$READ,STCLASS=BASED);
      140    11279          %FPT_PROMPT (FPTN=FPT_PROMPT,STCLASS=AUTO);
      141    11307          %FPT_OPEN (FPTN=FPT_OPEN,STCLASS=AUTO);
      142    11416          %FPT_WRITE (FPTN=FPT_WRITE,STCLASS=AUTO);
      143    11447          %FPT_WRITE (FPTN=FPT$WRITE,STCLASS=BASED);
      144    11478          %FPT_CLOSE (FPTN=FPT_CLOSE,STCLASS=AUTO);
      145    11520          %FPT_FID (FPTN=FPT_FID,STCLASS=AUTO);
      146    11543          %FPT_UNFID (FPTN=FPT_UNFID,STCLASS=AUTO);
      147    11561          %FPT_DELREC (FPTN=FPT_DELREC,STCLASS=AUTO);
      148    11580          %FPT_PRECORD (FPTN=FPT_PRECORD,STCLASS=AUTO);
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:5    
      149    11601        %FPT_PROMPT (FPTN=INCLUDE_PROMPT, STCLASS=CONSTANT, PROMPT=DOT_PROMPT, VFC=YES);
      150    11629    1   DCL DOT_PROMPT CONSTANT CHAR(2) INIT(%CONCAT(BINASC(30), '.'));
      151    11630          %FPT_WAIT (FPTN=FPT_WAIT,STCLASS=AUTO);
      152    11644          %F$DCB (DCBN=F$DCB);
      153    11701          %VLR_FID (FPTN=FID_RESULTS,STCLASS=AUTO);
      154    11720          %VLP_NAME (FPTN=FID_NAME,LEN=31,STCLASS=AUTO);
      155    11747          %VLP_ACCT (FPTN=FID_ACCT,STCLASS=AUTO);
      156    11760          %VLP_PASS (FPTN=FID_PASS,STCLASS=AUTO);
      157    11773          %VLP_WSN (FPTN=FID_WSN,STCLASS=AUTO);
      158    11786          %VLP_SN (FPTN=FID_SN,N=3,STCLASS=AUTO);
      159    11799        %XUG_GETCMD (NAME=GET$CMD, STCLASS=BASED);
      160    12137        %XUG_PARAMS (NAME=XUG$PARAMS, STCLASS=BASED);
      161    12581          %XSJ_PARAM (FPTN=XSJ_PARAM,STCLASS=AUTO);
      162    12598    1     DCL 1 INIT_KEY CONSTANT,   /* FOR INIT'IN START & END KEY */
      163    12599    1           2 COUNT UBIN BYTE UNAL INIT (3),
      164    12600    1           2 KEY   UBIN (27) UNAL INIT (0);
      165    12601    1     DCL FKEY_ADJUST (0:3) SBIN CONSTANT /* for correcting frac. keys */
      166    12602    1       INIT (1000, 100, 10, 1);          /* based on their length */
      167    12603          %VLP_ERRCODE(FPTN=ERR,STCLASS=AUTO);
      168    12648        /***** Auto structures *****/
      169    12649    1     DCL   1  END_KEY AUTO,
      170    12650    1              2  COUNT UBIN BYTE UNAL,
      171    12651    1              2  KEY UBIN (27) UNAL;
      172    12652        /**/
      173    12653    1     DCL   1  READ_KEY AUTO,
      174    12654    1              2  COUNT UBIN BYTE UNAL,
      175    12655    1              2  KEY UBIN (27) UNAL;
      176    12656        /**/
      177    12657    1     DCL   1  START_KEY AUTO,
      178    12658    1              2  COUNT UBIN BYTE UNAL,
      179    12659    1              2  KEY UBIN (27) UNAL;
      180    12660        /**/
      181    12661    1     DCL   1  KEY_BUF AUTO,
      182    12662    1              2  COUNT UBIN BYTE UNAL,
      183    12663    1              2  TEXT CHAR(9);
      184    12664        /***** based structures *****/
      185    12665          %CP$COMVARS (NAME=CP$GLOBALS,STCLASS="BASED(SEG3$)");
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:6    
      186    12673          %SEG$2;
      187    12733          %B$TCB (STCLASS="BASED(B$TCB$)");
      188    12736          %B$ALT;
      189    12744    1   DCL CHARN CHAR(4) BASED;
      190    12745        /***** Constant structures *****/
      191    12746    1     DCL   1  SAME_LINE_VFC CONSTANT,
      192    12747    1              2  VFC CHAR(1) INIT('@') UNAL;
      193    12748        /***** error codes *****/
      194    12749          %ERR_CODE (NAME=E_BDSCAN,MID#=CPH$IBEXMID,CODE#=E$BDSCAN,STCLASS=CONSTANT);
      195    12769          %ERR_CODE (NAME=E_NOSCAN,MID#=CPH$IBEXMID,CODE#=E$NOSCAN,STCLASS=CONSTANT);
      196    12789          %ERR_CODE (NAME=E_BDSTARTNUM,MID#=CPH$IBEXMID,CODE#=E$BDSTARTNUM,STCLASS=CONSTANT)
             12789              ;
      197    12809          %ERR_CODE (NAME=E_TRUNREC,MID#=CPH$IBEXMID,CODE#=E$TRUNREC,STCLASS=CONSTANT);
      198    12829          %ERR_CODE (NAME=E_MSGLOBAL,MID#=CPH$IBEXMID,CODE#=E$MSGLOBAL,STCLASS=CONSTANT);
      199    12849          %ERR_CODE (NAME=E_MSDEFAULT,MID#=CPH$IBEXMID,CODE#=E$MSDEFAULT,STCLASS=CONSTANT);
      200    12869        %ERR_CODE (NAME=E_CHKAP,MID#=CPB$IBEXMID,CODE#=E$CHKAP,STCLASS=CONSTANT);
      201    12889        %ERR_CODE (NAME=E_ILLXDEST,MID#=CPH$IBEXMID,CODE#=E$ILLXDEST,STCLASS=CONSTANT);
      202    12909        %VLP_ERRCODE (FPTN=E_BDSTARTENDTYPE,MID=H,ERR#=E$BDSTARTENDTYPE,FCG=CP,STCLASS=
             12909            CONSTANT);
      203    12954        /*E*    ERROR: CPH-E$ILLXDEST-0
      204    12955                MESSAGE: Illegal destination fid.
      205    12956                MESSAGE1: You do not have permission to write into that file.
      206    12957        */
      207    12958        %VLP_ERRCODE(FPTN=E_NONAME,FCG=CP,MID=H,ERR#=%E$NONAME,STCLASS=CONSTANT);
      208    13003        /*E* ERROR: CPH-E$NONAME
      209    13004             MESSAGE: The job this one is to follow does not exist.
      210    13005        */
      211    13006        %VLP_ERRCODE(FPTN=E_NONAME_4_CONT,FCG=CP,MID=H,ERR#=%E$NONAME_4_CONT,STCLASS=
             13006            CONSTANT);
      212    13051        /*E* ERROR: CPH-E$NONAME_4_CONT
      213    13052             MESSAGE: The job, %U1%.%U2%, this one is to follow does not exist.
      214    13053        */
      215    13054        %VLP_ERRCODE(FPTN=E_NODCBS4FOLLOW,FCG=CP,MID=H,ERR#=%E$NODCBS4FOLLOW,STCLASS=
             13054            CONSTANT);
      216    13099        /*E* ERROR: CPH-E$NODCBS4FOLLOW
      217    13100             MESSAGE: Unable to get a DCB to test FOLLOW option.
      218    13101             MESSAGE1: IBEX continued without checking the existence of the job to FOLLOW.
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:7    
      219    13102        */
      220    13103          %EJECT;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:8    
      221    13104        /***** symbol macros *****/
      222    13105          %XUM$MCB(NAME=X$MCB);
      223    13109          %CP$PARAM (NAME=X$PARAM,STCLASS=AUTO);
      224    13125          %TEXTC (NAME=X$STRING);
      225    13130          %XUM$MAP(NAME=X$MAP);
      226    13133        /***** parsing macros *****/
      227    13134          %PLIST;
      228    13135          %PARSE$OUT(NAME=P$B,STCLASS=BASED);
      229    13180          %PARSE$SYM(NAME=P$S,STCLASS=BASED);
      230    13218          %P$PCB(NAME=P$PCB,STCLASS="");
      231    13419          %P$PCB(NAME=PCB,STCLASS=AUTO);
      232    13620          %P$PCB(NAME=BASED$PCB,STCLASS=BASED) ;
      233    13821          %PARSE$OUT(NAME=FAKE_NODE,STCLASS=AUTO);
      234    13866          %PARSE$OUT(NAME=FAKE_NODE2,STCLASS=AUTO);
      235    13911          %PARSE$OUT(NAME=FAKE_NODE3,STCLASS=AUTO, /* Really PARSE$SYM, so ... */
      236    13912             SUBLK$="SUBLK$(0:2) PTR,2 *"); /* Add two words for sYsid */
      237    13957          %U$PARAM (NAME=U$PARAM,STCLASS=BASED);
      238    13973          %U$PARAM (NAME=U_PARAM,STCLASS=AUTO);
      239    13989    1   DCL SCAN_REMEM REMEMBER AUTO;
      240    13990    1   DCL WORKSPACE(0:999) UBIN WORD;   /* temporary parser workspace         */
      241    13991          %LIST;
      242    13992        /***** substitution macros *****/
      243    13993          %SUB$PARAMS;
             13994    1   DCL  1  NAME STCLASS ALIGNED,
             13995    1           2  ONLINE_DEF_HEAD$ PTR,        /* PTR to list of ONLINE subs         */
             13996    1           2  GLOBAL_DEF_HEAD$ PTR,        /* PTR to list of GLOBAL subs         */
             13997    1           2  PROMPT_DEF_HEAD$ PTR,        /* PTR to list of PROMPT subs         */
             13998    1           2  DEFAULT_DEF_HEAD$ PTR,       /* PTR to list of DEFAULT subs        */
             13999    1           2  READBUF$ PTR,                /* PTR to READBUF                     */
             14000    1           2  TEMPBUF$ PTR,                /* PTR to TEMPBUF                     */
             14001    1           2  WRITEBUF$ PTR,               /* PTR to WRITEBUF                    */
             14002    1           2  FPT_READ$ PTR,               /* FPT for reading JCL file           */
             14003    1           2  FPT_WRITE$ PTR,              /* FPT for writing CMD STREAM         */
             14004    1           2  X$MCB$ PTR,                  /* PTR to X$MCB for mem mgnt.         */
             14005    1           2  X$PARAM$ PTR,                /* PTR to X$PARAM for string mgnt.    */
             14006    1           2  BUF_LEN SBIN WORD,           /* LENGTHV of READBUF                 */
             14007    1           2  REC_NUM SBIN WORD,           /* Number of this record              */
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:9    
             14008    1           2  SUB_MADE# BIT(1) UNAL,       /* Was a substitution made?           */
             14009    1           2  PRINT_OPT# BIT(1) UNAL,      /* Was PRINT option specified?        */
             14010    1           2  TEST_OPT# BIT(1) UNAL,       /* Was TEST option specified?         */
             14011    1           2  BATCH_ABORTED# BIT(1) UNAL,  /* Has there been any errors?         */
             14012    1           2  NO_GLOBALS# BIT(1) UNAL;     /* Dont do any GLOBAL substitutions   */
      244    14014          %EJECT;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:10   
      245    14015    1   CPH$GLOBAL:
      246    14016    1     ENTRY(P$PCB) ALTRET;
      247    14017    1     BLK$ = P$PCB.OUT$;
      248    14018    1     CALL GLOBAL  ALTRET(ERR_RETURN);
      249    14019    1     RETURN;
      250    14020    1   ERR_RETURN:
      251    14021    1     ALTRETURN;
      252    14022          %EJECT;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:11   
      253    14023        /*****************************************************************/
      254    14024        /*F*       NAME:    CPH$BATXEQ
      255    14025         **
      256    14026                   PURPOSE:    Process the BATCH, XEQ and XMIT commands.
      257    14027         **
      258    14028                   DESCRIPTION:   The JCL file specified on the command line
      259    14029                            is opened and its records inserted into a BATCH
      260    14030                            COMMAND STREAM.  String and field substitution is
      261    14031                            performed on the records prior to insertion.
      262    14032         **
      263    14033                   REFERENCE:  Programming Reference Manual
      264    14034        */
      265    14035        /*****************************************************************/
      266    14036        /*
      267    14037             Dcb name        purpose
      268    14038             --------        -------
      269    14039              M$IBEX1           read *S file for global subs
      270    14040              M$IBEX1           also used to write to command stream
      271    14041              M$IBEX            read the jcl file
      272    14042        */
      273    14043    1   CPH$BATXEQ:
      274    14044    1     ENTRY(P$PCB)   ALTRET;
      275    14045    1     BLK$ = P$PCB.OUT$;
      276    14046    1     IF BLK$->P$B.CODE = XEQCMND AND B$JIT.CPFLAGS1.WHEN_INPUT
      277    14047    1       THEN
      278    14048    2         CALL CPG$SET_WHEN_STATE WHENALTRETURN DO;
      279    14049    2                                       END;
      280    14050        /*
      281    14051             ***** Initialize ptrs and flags ...
      282    14052        */
      283    14053    1     JOB_FLAG# = %NO#;
      284    14054        /*
      285    14055             ***** Init fpts...
      286    14056        */
      287    14057        /* close */
      288    14058    1     FPT_CLOSE = CFPT_CLOSE;
      289    14059    1     FPT_CLOSE.V_ = VECTOR(FPT_CLOSE.V);
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:12   
      290    14060        /* open */
      291    14061    1     FPT_OPEN = CFPT_OPEN;
      292    14062    1     FPT_OPEN.V_=VECTOR(FPT_OPEN.V);
      293    14063        /* write */
      294    14064    1     FPT_WRITE = CFPT_WRITE;
      295    14065    1     FPT_WRITE.V_ = VECTOR(FPT_WRITE.V);
      296    14066    1     FPT_WRITE.V.DCB#=M$IBEX1_NUM;
      297    14067    1     FPT_WRITE.BUF_=VECTOR(READBUF);
      298    14068        /* read */
      299    14069    1     FPT_READ = CFPT_READ;
      300    14070    1     FPT_READ.V_ = VECTOR(FPT_READ.V);
      301    14071    1     FPT_READ.V.DCB# = M$IBEX_NUM;
      302    14072    1     FPT_READ.KEY_ = VECTOR(READ_KEY);
      303    14073    1     FPT_READ.BUF_ = VECTOR(READBUF);
      304    14074        /* precord */
      305    14075    1     FPT_PRECORD = CFPT_PRECORD;
      306    14076    1     FPT_PRECORD.V_ = VECTOR(FPT_PRECORD.V);
      307    14077    1     FPT_PRECORD.V.DCB# = M$IBEX_NUM;
      308    14078        /*FAKE_NODE */
      309    14079    1     FAKE_NODE.TEMP = %NO#;
      310    14080        /*
      311    14081             ***** Initialize SUB$PARAMS
      312    14082                   necessary for continuation and string substitutions...
      313    14083        */
      314    14084    1     SUB$PARAMS.READBUF$ = ADDR(READBUF);
      315    14085    1     SUB$PARAMS.TEMPBUF$ = ADDR(TEMPBUF);
      316    14086    1     SUB$PARAMS.WRITEBUF$ = ADDR(WRITEBUF);
      317    14087    1     SUB$PARAMS.FPT_READ$ = ADDR(FPT_READ);
      318    14088    1     SUB$PARAMS.FPT_WRITE$ = ADDR(FPT_WRITE);
      319    14089    1     SUB$PARAMS.X$MCB$ = ADDR(X$MCB);
      320    14090    1     SUB$PARAMS.X$PARAM$ = ADDR(X$PARAM);
      321    14091        /*
      322    14092             ***** Close M$IBEX if it is open...
      323    14093        */
      324    14094    1     IF DCBADDR(M$IBEX_NUM) -> F$DCB.FCD#
      325    14095    1        THEN
      326    14096    2           DO;   /* Close M$IBEX */
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:13   
      327    14097    2              FPT_CLOSE.V.DISP# = %SAVE#;
      328    14098    2              FPT_CLOSE.V.DCB# = M$IBEX_NUM;
      329    14099    2              CALL M$CLOSE (FPT_CLOSE) ALTRET(ABORT);
      330    14100    2           END;
      331    14101        /*
      332    14102             ***** Read any global subs in from the *S file...
      333    14103        */
      334    14104    1   GET_GLOBALS:
      335    14105    1     CALL READ_GLOBALS ALTRET (REL_PAGES);
      336    14106        /*
      337    14107             ***** Once the global subs have been read
      338    14108                   from the *S file, it is no longer
      339    14109                   necessary to keep the *S file open...
      340    14110        */
      341    14111    1     FPT_CLOSE.V.DISP# = %SAVE#;
      342    14112    1     FPT_CLOSE.V.DCB# = M$IBEX1_NUM;
      343    14113    1     CALL M$CLOSE (FPT_CLOSE) ALTRET (ABORT);
      344    14114        /*
      345    14115             ***** Initialize the fpt thru which
      346    14116                   listings are to be written...
      347    14117        */
      348    14118    1     SEG$2.FPT_WRITECC$ -> FPT$WRITE.BUF_ = VECTOR(WRITEBUF);
      349    14119        /*
      350    14120             ***** Initialize PCB...
      351    14121        */
      352    14122    1     PCB = CP$PCB;
      353    14123    1     PCB.WORK$ = ADDR (WORKSPACE);
      354    14124    1     PCB.WKSZ = SIZEW (WORKSPACE);
      355    14125    1     PCB.TEXT$ = ADDR(READBUF);
      356    14126    1     U_PARAM = P$PCB.USER$ -> U$PARAM;
      357    14127    1     U_PARAM.CNTU$$ = ENTADDR(CPH$CONTINUE);
      358    14128    1     U_PARAM.MODE = BATCHSCAN_MODE;
      359    14129    1     U_PARAM.PARAMS$ = ADDR(SUB$PARAMS);
      360    14130    1     U_PARAM.REMEM$ = ADDR(SCAN_REMEM);
      361    14131    1     REMEMBER WRITE IN SCAN_REMEM;
      362    14132    1     PCB.USER$ = ADDR(U_PARAM);
      363    14133        /*
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:14   
      364    14134             ***** Main loop
      365    14135                   BATCH /XEQ / XMIT loops here once for each
      366    14136                   file specified on the command line ...
      367    14137        */
      368    14138    1     IF BLK$ -> P$B.CODE = XMITCMND
      369    14139    1        THEN   /* Last blk is destination info. Surpress */
      370    14140    1           BLK$ -> P$B.NSUBLKS = BLK$ -> P$B.NSUBLKS - 1;
      371    14141        /**/
      372    14142    2     DO NUM_FILES = 0 TO BLK$ -> P$B.NSUBLKS - 1;
      373    14143        /*
      374    14144             ***** initialize for each file...
      375    14145        */
      376    14146    2        SUB$PARAMS.ONLINE_DEF_HEAD$ = ADDR(NIL);
      377    14147    2        SUB$PARAMS.DEFAULT_DEF_HEAD$ = ADDR(NIL);
      378    14148    2        JOB_FLAG# = %NO#;
      379    14149    2        SCAN_OPT# = %NO#;
      380    14150    2        NSTATUS_OPT# = %NO#;
      381    14151    2        CROSS_ACCT_BATCH_FLG = %NO#;
      382    14152    2        FPT_READ.V.SEED# = '0'B;
      383    14153    2        START_METHOD = 0;
      384    14154    2        END_METHOD = 0;
      385    14155    2        SUB$PARAMS.REC_NUM = 0;
      386    14156    2        SUB$PARAMS.TEST_OPT# = %NO#;
      387    14157    2        SUB$PARAMS.PRINT_OPT# = %NO#;
      388    14158    2        SUB$PARAMS.BATCH_ABORTED# = %NO#;
      389    14159    2        SUB$PARAMS.NO_GLOBALS# = %NO#;
      390    14160    2        JOB_FID$ = BLK$ -> P$B.SUBLK$ (NUM_FILES);
      391    14161        /*
      392    14162             ***** Process the options...
      393    14163        */
      394    14164    2        X$PARAM.SYM_HEAD$=SUB$PARAMS.ONLINE_DEF_HEAD$;
      395    14165    2        X$PARAM.SRCH = 1;
      396    14166    3        DO NUM_OPTS = 0 TO JOB_FID$ -> P$B.NSUBLKS - 1;
      397    14167    3           TEMP$ = JOB_FID$ -> P$B.SUBLK$(NUM_OPTS);
      398    14168    4           DO CASE (TEMP$ -> P$B.CODE);
      399    14169    4            CASE (BA_CRPT);
      400    14170    4              TEMP$ = TEMP$ -> P$B.SUBLK$(0);
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:15   
      401    14171    4              IF TEMP$ -> P$B.NDTYPE = %OCT#
      402    14172    4                 THEN
      403    14173    4                    CALL CXX$OCTBIN (TEMP$ -> P$S.COUNT, FPT_READ.V.SEED#);
      404    14174    4                 ELSE
      405    14175    4                    SUBSTR (ADDR(FPT_READ.V.SEED#)->CHARN, 0,
      406    14176    4                      TEMP$->P$S.COUNT) = TEMP$->P$S.TEXT;
      407    14177    4            CASE (BA_END);
      408    14178    4              END_METHOD = TEMP$ -> P$B.SUBLK$(0) -> P$B.CODE;
      409    14179    5              DO CASE (END_METHOD);
      410    14180    5               CASE (BA_LABEL);
      411    14181    5                 END_LABEL = TEMP$ -> P$B.SUBLK$(0) -> P$S.TEXT;
      412    14182    5               CASE (BA_NUM);
      413    14183    5                 CALL CHARBIN (END_NUM,TEMP$ -> P$B.SUBLK$(0)->
      414    14184    5                      P$S.TEXT);
      415    14185    5               CASE (BA_KEY);
      416    14186                         /* Move TEMP$ to point to BA_KEY */
      417    14187    5                 TEMP$ = TEMP$ -> P$B.SUBLK$(0);
      418    14188    5                 END_KEY = INIT_KEY;
      419    14189    5                 IF (TEMP$->P$B.SUBLK$(0)->P$S.CODE = BA_IKEY)
      420    14190    6                   THEN DO;  /* have the integer part */
      421    14191    6                     CALL CHARBIN (VALUE, TEMP$->P$B.SUBLK$(0)->P$S.TEXT);
      422    14192    6                     END_KEY.KEY = VALUE * 1000;   /* Edit keys */
      423    14193    6                   END;
      424    14194    5                 TEMP$ = TEMP$->P$B.SUBLK$(TEMP$->P$B.NSUBLKS-1);  /* last node */
      425    14195    5                 IF (TEMP$->P$S.CODE = BA_FKEY)
      426    14196    6                   THEN DO;  /* have the fractional part */
      427    14197    6                     CALL CHARBIN (VALUE, TEMP$->P$S.TEXT);
      428    14198    6                     END_KEY.KEY = END_KEY.KEY + (VALUE * FKEY_ADJUST(TEMP$->P$S.COUNT)
             14198                              );
      429    14199    6                   END;
      430    14200    5                 FPT_READ.V.KEYR# = %YES#;
      431    14201    5               END;   /* End = ... */
      432    14202    4            CASE (BA_FID, BA_DFID);
      433    14203            /* Open the JCL file */
      434    14204    4              FPT_OPEN.V.DCB# = M$IBEX_NUM;
      435    14205    4              FPT_OPEN.V.FUN# = %IN#;
      436    14206    4              FPT_OPEN.V.ORG# = %CONSEC#;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:16   
      437    14207    4              FPT_OPEN.V.ACS# = %SEQUEN#;
      438    14208    4              FPT_READ.V.KEYR# = %NO#;
      439    14209    4              CALL OPEN_FID (TEMP$) ALTRET(DELETE_CMD_STREAM);
      440    14210        /*
      441    14211             Set a dot prompt if we're XMITing ME.
      442    14212        */
      443    14213    4              IF B$JIT.MODE = %M_INT# AND FPT_OPEN.V.ASN# = %DEVICE#
      444    14214    4                 THEN
      445    14215    5                    DO;
      446    14216    6                       CALL M$PROMPT (INCLUDE_PROMPT) WHENALTRETURN DO; END;
      447    14217    5                       SEG$2.GETCMD$->GET$CMD.WORK$->XUG$PARAMS.PROMPT = '@';
      448    14218    5                    END;
      449    14219    4              ECHO_FILE_OK# = ~(DCBADDR(M$IBEX_NUM) -> F$DCB.FFLG.EXEC#);
      450    14220    4            CASE (BA_STRING);
      451    14221    4              X$PARAM.TEXTC$(0) = TEMP$->P$B.SUBLK$(0)->P$S.TEXTC$;
      452    14222    4              X$PARAM.TEXTC$(1) = TEMP$->P$B.SUBLK$(1)->P$S.TEXTC$;
      453    14223    4              X$PARAM.TYPE = TEMP$->P$B.SUBLK$(0)->P$S.NDTYPE;
      454    14224    4              CALL CPH$SYM_PUT (X$MCB,X$PARAM) ALTRET(SYM_ERR);
      455    14225    4              SUB$PARAMS.ONLINE_DEF_HEAD$ = X$PARAM.SYM_HEAD$;
      456    14226    4            CASE (BA_NGSUBS);
      457    14227    4              SUB$PARAMS.NO_GLOBALS# = %YES#;
      458    14228    4            CASE (BA_NSTATUS);
      459    14229    4              NSTATUS_OPT# = %YES#;
      460    14230    4            CASE (BA_PRINT);
      461    14231    4              SUB$PARAMS.PRINT_OPT#=%YES#;
      462    14232    4            CASE (BA_TEST);
      463    14233    4              SUB$PARAMS.TEST_OPT#=%YES#;
      464    14234    4            CASE (BA_SCAN);
      465    14235    4              CALL CPA$GETRES ALTRET(SCAN_ERR);
      466    14236    4              CALL CPC$RDUSERS (M$IBEX1_NUM,%IN#) ALTRET(SCAN_ERR);
      467    14237    4              PCB.USER$ -> U$PARAM.PSEUDO$ = SEG$2.PSEUDO$;
      468    14238    4              PCB.USER$ -> U$PARAM.PHYS$ = SEG$2.PHYS$;
      469    14239    4              PCB.USER$ -> U$PARAM.USERS$ = SEG$2.USERS$;
      470    14240    4              SCAN_OPT#=%YES#;
      471    14241    4            CASE (BA_START);
      472    14242    4              START_METHOD = TEMP$ -> P$B.SUBLK$(0) -> P$S.CODE;
      473    14243    5              DO CASE (START_METHOD);
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:17   
      474    14244    5               CASE (BA_LABEL);
      475    14245    5                 START_LABEL = TEMP$ -> P$B.SUBLK$(0) -> P$S.TEXT;
      476    14246    5               CASE (BA_NUM);
      477    14247    5                 CALL CHARBIN (START_NUM,TEMP$ -> P$B.SUBLK$(0)->
      478    14248    5                      P$S.TEXT);
      479    14249    5               CASE (BA_KEY);
      480    14250                         /* Move TEMP$ to point to BA_KEY */
      481    14251    5                 TEMP$ = TEMP$ -> P$B.SUBLK$(0);
      482    14252    5                 START_KEY = INIT_KEY;
      483    14253    5                 IF (TEMP$->P$B.SUBLK$(0)->P$S.CODE = BA_IKEY)
      484    14254    6                   THEN DO;  /* have the integer part */
      485    14255    6                     CALL CHARBIN (VALUE, TEMP$->P$B.SUBLK$(0)->P$S.TEXT);
      486    14256    6                     START_KEY.KEY = VALUE * 1000;   /* Edit keys */
      487    14257    6                   END;
      488    14258    5                 TEMP$ = TEMP$->P$B.SUBLK$(TEMP$->P$B.NSUBLKS-1);  /* last node */
      489    14259    5                 IF (TEMP$->P$S.CODE = BA_FKEY)
      490    14260    6                   THEN DO;  /* have the fractional part */
      491    14261    6                     CALL CHARBIN (VALUE, TEMP$->P$S.TEXT);
      492    14262    6                     START_KEY.KEY = START_KEY.KEY + (VALUE * FKEY_ADJUST(TEMP$->P$S.
             14262                              COUNT));
      493    14263    6                   END;
      494    14264    5                 FPT_READ.V.KEYR# = %YES#;
      495    14265    5               END;   /* Start = ... */
      496    14266    4            END;   /* Do case (options) end */
      497    14267        /*
      498    14268             ***** Write CPH$SYM_PUT err msg ...
      499    14269        */
      500    14270    4           DO WHILE (%NO#);
      501    14271    4   SYM_ERR:
      502    14272    4              CPOS = TEMP$ -> P$S.CPOS;
      503    14273    4              CALL CXP$POSTERR (ADDR(SEG$2.ERRBUF),CPOS,X$PARAM.ERR);
      504    14274    4           END;
      505    14275    4           DO WHILE (%NO#);
      506    14276    4   SCAN_ERR:
      507    14277    4              IF B$JIT.USRERR.CODE ~= 0
      508    14278    4                 THEN
      509    14279    4                    CALL CPC$WRITEMSGE (B$JIT.USRERR);
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:18   
      510    14280    4              CALL CPC$WRITEMSGE (E_NOSCAN);
      511    14281    4              SEG$2.ERRBUF(1) = 0;   /* Throw away error */
      512    14282    4           END;
      513    14283        /*E*    ERROR: CPH-E$NOSCAN-C
      514    14284                MESSAGE: SCAN option ignored. JIT.ERR follows.
      515    14285        */
      516    14286    3        END;   /* Do NUM_OPTS ... end */
      517    14287        /*
      518    14288             ***** Start = label
      519    14289                   start = key.xxx
      520    14290                   start = rec_num
      521    14291        */
      522    14292    2        SUB$PARAMS.REC_NUM = 0;
      523    14293    2   START_READ:
      524    14294    2        READBUF = ' ';
      525    14295    2        TRUNCATED_RECORD = %NO#;
      526    14296    3        CALL M$READ (FPT_READ) WHENALTRETURN DO ;
      527    14297    3                              IF B$TCB.ALT$->B$ALT.ERR.CODE = %E$LD
      528    14298    3                                 THEN
      529    14299    3                                    TRUNCATED_RECORD = %YES#;
      530    14300    3                                 ELSE
      531    14301    3                                    GOTO E_READ;
      532    14302    3                            END ; /* Whenaltreturn Do */
      533    14303    2        SUB$PARAMS.BUF_LEN = DCBADDR(M$IBEX_NUM) -> F$DCB.ARS# -1;
      534    14304    2        SUB$PARAMS.REC_NUM = SUB$PARAMS.REC_NUM + 1;
      535    14305    3        DO CASE (START_METHOD);
      536    14306    3         CASE (0);
      537    14307                /* No START option specified */
      538    14308    3         CASE (BA_KEY);
      539    14309    3           IF READ_KEY.KEY >= START_KEY.KEY
      540    14310    3              THEN
      541    14311    3                 START_METHOD = 0;
      542    14312    3         CASE (BA_NUM);
      543    14313    3           IF SUB$PARAMS.REC_NUM >= START_NUM
      544    14314    3              THEN
      545    14315    3                 START_METHOD = 0;
      546    14316    3         CASE (BA_LABEL);
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:19   
      547    14317    3           IF SUBSTR(READBUF,0,1) = '!'
      548    14318    4           THEN DO;  /* must be an IBEX command */
      549    14319    4             CALL SEARCH (START_INDX, X, B$SR_NON_BLANK, READBUF, 1)
      550    14320    5             WHENRETURN DO;
      551    14321    5               CALL INDEX (STR_INDX, ': ', READBUF)
      552    14322    6               WHENRETURN DO;
      553    14323    6                 IF SUBSTR (READBUF, START_INDX, STR_INDX-START_INDX) = START_LABEL
      554    14324    6                   THEN   /* Found it */
      555    14325    6                     START_METHOD = 0;
      556    14326    6              END;
      557    14327    5            END;
      558    14328    4          END;
      559    14329    3        END;   /* Do case START_METHOD end */
      560    14330    2        IF START_METHOD ~= 0
      561    14331    2           THEN
      562    14332    3              DO;
      563    14333        /*
      564    14334             ***** If still waiting to start, process DEFAULT commands only.
      565    14335        */
      566    14336    3                 CALL PROCESS_DIRECTIVES
      567    14337    4                   WHENRETURN DO;   /* we found a DEFAULT stmt */
      568    14338    4                     IF TRUNCATED_RECORD THEN GOTO OVERFLOW_ON_READ;
      569    14339    4                   END;
      570    14340    3                 GOTO START_READ;
      571    14341    3              END;
      572    14342    2        IF TRUNCATED_RECORD THEN GOTO OVERFLOW_ON_READ;
      573    14343    2   OPEN_CMD_STREAM:
      574    14344        /*
      575    14345             ***** If TEST was specified
      576    14346                   or the COMMAND STREAM is already open
      577    14347                   (XMIT cmd or multiple XEQ fids) then
      578    14348                   do not try to open it again ...
      579    14349        */
      580    14350    2        IF SUB$PARAMS.TEST_OPT# = %NO#
      581    14351    2        AND DCBADDR(M$IBEX1_NUM) -> F$DCB.FCD# = %NO#
      582    14352    2           THEN
      583    14353    3              DO;   /* Open the COMMAND STREAM */
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:20   
      584    14354    3                 FPT_OPEN.V.ASN#=%DEVICE#;
      585    14355    3                 FPT_OPEN.V.DCB#=M$IBEX1_NUM;
      586    14356    3                 FPT_OPEN.V.DISP#=%SAVE#;
      587    14357    3                 FPT_OPEN.V.EXIST#=%NEWFILE#;
      588    14358    3                 FPT_OPEN.V.FUN#=%CREATE#;
      589    14359    3                 FPT_OPEN.V.XTNSIZE# = 10;
      590    14360    3                 FPT_OPEN.WSN_=VECTOR(BLANKS);
      591    14361    4                 DO CASE (BLK$ -> P$B.CODE);
      592    14362    4                    CASE (BATCHCMND);
      593    14363    4                       FPT_OPEN.V.RES#='JE';
      594    14364    4                       CALL M$OPEN (FPT_OPEN) ALTRET(ABORT);
      595    14365    4                    CASE (XEQCMND);
      596    14366    4                       FPT_OPEN.V.RES#='JF';
      597    14367    4                       CALL M$OPEN (FPT_OPEN) ALTRET(ABORT);
      598    14368    4                    CASE (XMITCMND);
      599    14369    4                       TEMP$ = BLK$ -> P$B.SUBLK$(BLK$ -> P$B.NSUBLKS);
      600    14370    4                       FPT_OPEN.V.RES#='JE';
      601    14371    5                       DO CASE (TEMP$ -> P$B.CODE);
      602    14372    5                          CASE (BA_INTO);
      603    14373    5                             FPT_OPEN.V.EXIST# = %OLDFILE#;
      604    14374    5                             FPT_OPEN.V.ACS# = %DIRECT#;
      605    14375    5                          CASE (BA_ON);
      606    14376    5                             FPT_OPEN.V.EXIST# = %ERROR#;
      607    14377    5                          CASE (BA_OVER);
      608    14378    5                             FPT_OPEN.V.EXIST# = %NEWFILE#;
      609    14379    5                       END;   /* INTO, ON, OVER */
      610    14380        /**/
      611    14381    4                       CALL OPEN_FID (TEMP$ -> P$B.SUBLK$(0)) ALTRET(CLOSE_DCBS);
      612    14382    4                       IF DCBADDR(M$IBEX1_NUM) -> F$DCB.FFLG.EXEC#
      613    14383    4                          THEN   /* Not allowed to write this file */
      614    14384    5                             DO;
      615    14385    5                                CPOS = TEMP$ -> P$B.CPOS;
      616    14386    5                                CALL CXP$POSTERR (ADDR(SEG$2.ERRBUF),CPOS,E_ILLXDEST);
      617    14387    5                                GOTO CLOSE_DCBS;
      618    14388    5                             END;
      619    14389    4                 END;   /* Do case xxxCMND ... end */
      620    14390    3              END;   /* Open the COMMAND STREAM */
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:21   
      621    14391        /*
      622    14392             ***** Process any DIRECTIVES
      623    14393                   PROCESS_DIRECTIVES altreturns if no directives found ...
      624    14394        */
      625    14395    3           DO WHILE (%YES#);
      626    14396    3              CALL PROCESS_DIRECTIVES ALTRET(JOB_CARD);
      627    14397    3              READBUF=' ';   /* Blank the buffer */
      628    14398    3              CALL M$READ (FPT_READ) ALTRET (E_READ) ;
      629    14399    3              SUB$PARAMS.BUF_LEN = DCBADDR(M$IBEX_NUM) -> F$DCB.ARS# -1;
      630    14400    3              SUB$PARAMS.REC_NUM = SUB$PARAMS.REC_NUM + 1;
      631    14401    3           END;
      632    14402        /*
      633    14403             ***** look for !JOB command...
      634    14404        */
      635    14405    2   JOB_CARD:
      636    14406    2           IF BLK$->P$B.CODE = BATCHCMND
      637    14407    2                AND (READBUFB(0)&'777737737737'O) = '041112117102'O
      638    14408    2                AND (SUBSTR(READBUF,4,1) = ' ')
      639    14409    2              THEN
      640    14410    3                 DO;   /* Process the !JOB command */
      641    14411        /*
      642    14412             ***** Do string substitutions on !JOB command...
      643    14413        */
      644    14414    3                    CALL CPH$STRING_SUB (SUB$PARAMS);
      645    14415        /*
      646    14416             ***** Add "FILE=name.accnt" comment...
      647    14417        */
      648    14418    3                    TEMPBUF = READBUF;
      649    14419    3                    MATCHED_PAIR# = %YES#;
      650    14420    3                    START_INDX=0;
      651    14421    4                    DO WHILE (%YES#);
      652    14422    4                       CALL INDEX (STR_INDX,'"',READBUF,START_INDX) ALTRET(ADD_COMMENT)
             14422                                ;
      653    14423    4                       MATCHED_PAIR# = ~MATCHED_PAIR#;
      654    14424    4                       START_INDX = STR_INDX+1;
      655    14425    4                    END;
      656    14426    3   ADD_COMMENT:
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:22   
      657    14427    3                    IF MATCHED_PAIR#
      658    14428    3                       THEN   /* Need leading and trailing quote */
      659    14429    3                          CALL CONCAT(READBUF,SUBSTR(TEMPBUF,0,SUB$PARAMS.BUF_LEN+2),
      660    14430    3                               '"File=',SUBSTR(FID_NAME.NAME#,0,FID_NAME.L#),
      661    14431    3                               '.',FID_ACCT.ACCT#,'"');
      662    14432    3                       ELSE   /* Dont use any quotes */
      663    14433    3                          CALL CONCAT(READBUF,SUBSTR(TEMPBUF,0,SUB$PARAMS.BUF_LEN+2),
      664    14434    3                               'File=',SUBSTR(FID_NAME.NAME#,0,FID_NAME.L#),
      665    14435    3                               '.',FID_ACCT.ACCT#);
      666    14436    3                    SUB$PARAMS.BUF_LEN = SUB$PARAMS.BUF_LEN + 17 + FID_NAME.L#;
      667    14437    3                    IF SUB$PARAMS.BUF_LEN > SIZEV(READBUF)
      668    14438    3                       THEN
      669    14439    3                          SUB$PARAMS.BUF_LEN = SIZEV(READBUF);
      670    14440        /*
      671    14441             ***** Check syntax of !JOB cmd...
      672    14442        */
      673    14443    3                    PCB.TEXT$ = PINCRC(ADDR(READBUF),1);
      674    14444    3                    PCB.NCHARS = SUB$PARAMS.BUF_LEN;
      675    14445    3                    PCB.OUT$ = ADDR(FAKE_NODE);
      676    14446    3                    PCB.U$$ = ENTADDR(CPD$SYNTRY);
      677    14447    3                    PCB.CONTINUE = '1'B;
      678    14448    3                    FAKE_NODE.CODE = JOBCMND;
      679    14449    3                    CALL CPD$SET_NODES (PCB, PCB.ROOT$, PCB.USER$->U$PARAM.SPCL$$,
      680    14450    3                                CALL_FLG#) ;
      681    14451    3                    SEG$2.FLAGS.CONTINUED = %NO# ;
      682    14452    3                    CALL X$PARSE (PCB) ALTRET(BAD_COMMAND) ;
      683    14453    3                    IF SEG$2.ERRBUF(1) ~= 0
      684    14454    3                       THEN   /* context errors */
      685    14455    3                          GOTO BAD_COMMAND;
      686    14456    3                    ECHO_JOB_CMD = %YES# ;
      687    14457    3                    CALL CHK_4_CROSS_ACCT_BATCH(PCB.OUT$);
      688    14458    3                    IF NOT SUB$PARAMS.TEST_OPT#
      689    14459    3                     THEN
      690    14460    4                       CALL CHK_FOLLOW_CONDITION(PCB.OUT$) WHENALTRETURN DO ;
      691    14461    4                                                         IF ECHO_JOB_CMD
      692    14462    4                                                           THEN
      693    14463    4                                                              GOTO BAD_COMMAND ;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:23   
      694    14464    4                                                           ELSE
      695    14465    4                                                              GOTO BAD_COMMAND_NO_ECHO
             14465                                                                       ;
      696    14466    4                                                         END ; /* Whenalt. Do */
      697    14467    3                    SEG$2.FLAGS.CONTINUED = %NO# ;
      698    14468    3                    GOTO WRITE;
      699    14469    3                 END;   /* Process the !JOB command */
      700    14470        /*
      701    14471             ***** Check to see if a break has been received...
      702    14472        */
      703    14473    2   CHK_BRK:
      704    14474    2           IF B$JIT.CPFLAGS1 & %CP_BRK#
      705    14475    2              THEN
      706    14476    3                 DO;
      707    14477    3                    CALL CHK_BREAK ALTRET(DELETE_CMD_STREAM);
      708    14478    3                 END;
      709    14479        /*
      710    14480             *****    Do string SUBSTITUTIONS...
      711    14481        */
      712    14482    2           CALL CPH$STRING_SUB (SUB$PARAMS);
      713    14483        /*
      714    14484             ***** If the SCAN option was specified then check each
      715    14485                   IBEX command for SYNTAX and CONTEXT errors.
      716    14486                   Do not attempt to SCAN PREPROCESSOR EXPRESSIONS ...
      717    14487        */
      718    14488    2           IF SCAN_OPT#
      719    14489    2           AND SUBSTR(READBUF,0,1) = '!'
      720    14490    2              THEN
      721    14491    3                 DO;
      722    14492    3                     IF SUBSTR(READBUF,0,2) = '!!'
      723    14493    3                       THEN
      724    14494    3                         GOTO WRITE ;  /* Treat this record as DATA record. */
      725    14495    3                    CALL INDEX (STR_INDX,'%',READBUF);
      726    14496    3                    IF STR_INDX < LENGTHC(READBUF)
      727    14497    3                       THEN   /* Found a % */
      728    14498    3                          GOTO WRITE;
      729    14499    3                    PCB.ROOT$ = ADDR(IBEX_CMD);
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:24   
      730    14500    3                    PCB.NCHARS = SUB$PARAMS.BUF_LEN;
      731    14501    3                    PCB.TEXT$ = PINCRC(ADDR(READBUF),1);
      732    14502    3                    PCB.U$$ = ENTADDR(CPD$NULL_SFROUTINE);
      733    14503    3                    PCB.CONTINUE = '0'B;
      734    14504    3                    CALL X$PARSE (PCB) ALTRET(BAD_COMMAND);
      735    14505    3                    PCB.U$$ = ENTADDR(CPD$SYNTRY);
      736    14506    3                    IF PCB.OUT$->P$B.TEMP
      737    14507    3                       THEN
      738    14508    4                         DO ;
      739    14509    4                           PCB.OUT$ = PCB.OUT$->P$B.SUBLK$(1) ;
      740    14510    4   RE_PARSE:               PCB.TEXT$ = PINCRC(PCB.TEXT$, PCB.OUT$->P$B.CPOS);
      741    14511    4                           PCB.NCHARS = PCB.NCHARS - PCB.OUT$->P$B.CPOS;
      742    14512    4                           IF PCB.NCHARS = 0
      743    14513    4                             THEN
      744    14514    4                               GOTO WRITE ;
      745    14515    4                         END ; /* Then Do */
      746    14516    3                    PCB.CONTINUE = '1'B;
      747    14517    3                    CALL CPD$SET_NODES (PCB, PCB.ROOT$, PCB.USER$->U$PARAM.SPCL$$,
      748    14518    3                                CALL_FLG#) ;
      749    14519    3                    CALL X$PARSE (PCB) ALTRET(BAD_COMMAND) ;
      750    14520    3                    IF PCB.ROOT$ = ADDR(CPSL_NODES)
      751    14521    3                       THEN
      752    14522    3                          CALL CXX$VERIFY (PCB.OUT$->P$B, ADDR(SEG$2.ERRBUF));
      753    14523    3                    IF SEG$2.ERRBUF(1) ~= 0
      754    14524    3                       THEN   /* context errors */
      755    14525    3                          GOTO BAD_COMMAND;
      756    14526    3                    IF PCB.ROOT$ = ADDR(IF_)
      757    14527    3                       THEN
      758    14528    4                          DO;
      759    14529    4                             PCB.OUT$ = PCB.OUT$->P$B.SUBLK$(1)->P$B.SUBLK$(0);
      760    14530    4                             PCB.ROOT$ = ADDR(IBEX_CMD); /* Just in case */
      761    14531    4                             GOTO RE_PARSE;
      762    14532    4                          END;
      763    14533    3                 END;
      764    14534    2   WRITE:
      765    14535    2           CALL WRITE_BUF ALTRET(ABORT);
      766    14536        /*
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:25   
      767    14537             ***** Read the next record from the file...
      768    14538        */
      769    14539    2   READ:
      770    14540    2           READBUF= ' ';   /* Blank the buffer */
      771    14541    2           CALL M$READ (FPT_READ) ALTRET (E_READ) ;
      772    14542    2           SUB$PARAMS.BUF_LEN = DCBADDR(M$IBEX_NUM) -> F$DCB.ARS# -1;
      773    14543    2           SUB$PARAMS.REC_NUM = SUB$PARAMS.REC_NUM + 1;
      774    14544        /*
      775    14545             ***** IF END=xxx was specified then check to see
      776    14546                   if we have reached the end of the road ...
      777    14547        */
      778    14548    3           DO CASE (END_METHOD);
      779    14549    3              CASE (0);
      780    14550                      /* Nothing specified */
      781    14551    3              CASE (BA_KEY);
      782    14552    3                 IF READ_KEY.KEY > END_KEY.KEY
      783    14553    3                    THEN
      784    14554    3                       GOTO CLOSE_CMD_STREAM;
      785    14555    3              CASE (BA_LABEL);
      786    14556    3                 IF SUBSTR(READBUF,0,1) = '!'
      787    14557    4                 THEN DO;  /* must be an IBEX command */
      788    14558    4                   CALL SEARCH (START_INDX, X, B$SR_NON_BLANK, READBUF, 1)
      789    14559    5                   WHENRETURN DO;
      790    14560    5                     CALL INDEX (STR_INDX, ': ', READBUF)
      791    14561    6                     WHENRETURN DO;
      792    14562    6                       IF SUBSTR (READBUF, START_INDX, STR_INDX-START_INDX) = END_LABEL
      793    14563    6                         THEN   /* Found it! */
      794    14564    7                           DO; /* setup ot quit after this record */
      795    14565    7                             END_NUM = 0;
      796    14566    7                             END_METHOD = BA_NUM;
      797    14567    7                           END;
      798    14568    6                     END;
      799    14569    5                   END;
      800    14570    4                 END;
      801    14571    3              CASE (BA_NUM);
      802    14572    3                 IF SUB$PARAMS.REC_NUM > END_NUM
      803    14573    3                    THEN
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:26   
      804    14574    3                       GOTO CLOSE_CMD_STREAM;
      805    14575    3           END;   /* Do case (END_METHOD) end */
      806    14576        /*
      807    14577             ***** Look for !JOB commands...
      808    14578        */
      809    14579    2           IF BLK$ -> P$B.CODE = BATCHCMND
      810    14580    2           AND (READBUFB(0)&'777737737737'O) = '041112117102'O
      811    14581    2           AND SUBSTR (READBUF,4,1) = ' '
      812    14582    2              THEN
      813    14583    3                 DO;
      814    14584    3                    JOB_FLAG# = %YES#;
      815    14585    3                    GOTO CLOSE_CMD_STREAM;
      816    14586    3                 END;
      817    14587        /*
      818    14588             ***** Process any DIRECTIVES
      819    14589                   PROCESS_DIRECTIVES altreturns if no directives found ...
      820    14590        */
      821    14591    2           CALL PROCESS_DIRECTIVES ALTRET (CHK_BRK);
      822    14592    2           GOTO READ;
      823    14593        /*
      824    14594             ***** Syntax error. Delete the command stream ...
      825    14595        */
      826    14596    2   BAD_COMMAND:
      827    14597        /*E*    ERROR: CPH-E$BDSCAN-C
      828    14598                MESSAGE: Processing aborted.
      829    14599        */
      830    14600        /*
      831    14601             ***** Print the record...
      832    14602        */
      833    14603    2           CALL CONCAT (WRITEBUF,'     ',READBUF);
      834    14604    2           SEG$2.FPT_WRITECC$->FPT$WRITE.BUF_.BOUND =
      835    14605    2             MINIMUM (LENGTHV(WRITEBUF), SUB$PARAMS.BUF_LEN+4);
      836    14606    2           CALL CPE$DIAGOUT (SEG$2.FPT_WRITECC$);
      837    14607    2   BAD_COMMAND_NO_ECHO:
      838    14608    2           CALL STUFF_GETCMD_4_ERRPTR ;
      839    14609    2           IF PCB.ERROR.CODE ~= 0
      840    14610    2              THEN
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:27   
      841    14611    3                 DO;   /* Post it */
      842    14612    3                    IF PCB.ERROR.CODE = %E$SYNERR
      843    14613    3                       THEN
      844    14614    4                         DO ;
      845    14615    4                           CPOS = PCB.HI_CHAR ;
      846    14616    4                           CALL CXP$POSTERR (ADDR(SEG$2.ERRBUF),CPOS,PCB.ERROR);
      847    14617    4                           IF B$JIT.PRFLAGS.POINT AND PCB.HI_CHAR + 5 > PCB.NCHARS
      848    14618    4                             THEN
      849    14619    4                               SEG$2.GETCMD$->GET$CMD.PCB$->BASED$PCB.NCHARS =
      850    14620    4                                   SEG$2.GETCMD$->GET$CMD.PCB$->BASED$PCB.NCHARS +
      851    14621    4                                     5 ; /* Need to fake out CXG$ERRPTR */
      852    14622    4                         END ; /* Then Do */
      853    14623    3                       ELSE   /* No charpos avail */
      854    14624    3                          CALL CXP$POSTERR (ADDR(SEG$2.ERRBUF),511,PCB.ERROR);
      855    14625    3                 END;
      856    14626    2           IF SEG$2.ERRBUF(1) ~= 0
      857    14627    2              THEN
      858    14628    3                 DO;
      859    14629    3                    CALL CPR$RPTERR(SEG$2.ERRBUF,POFFC(PCB.TEXT$,ADDR(READBUF))+5);
      860    14630    3                 END;
      861    14631    2           SEG$2.ERRBUF(1) = 0;   /* Throw away errors after reporting */
      862    14632    2           SUB$PARAMS.BATCH_ABORTED# = %YES#;
      863    14633    2           GOTO READ;
      864    14634        %EJECT;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:28   
      865    14635        /*
      866    14636             ***** On end_of_file write sysid & close the command STREAM...
      867    14637        */
      868    14638    2   E_READ:
      869    14639        /*E*    ERROR: CPH-E$TRUNREC-0
      870    14640                MESSAGE: Record longer than IBEX maximum of 256 chars.
      871    14641        */
      872    14642        /*E*    ERROR: CPH-E$BDSTARTNUM-0
      873    14643             MESSAGE: START parameter failed.
      874    14644        */
      875    14645        /*E*    ERROR: CPH-E$BDSTARTENDTYPE-0
      876    14646                MESSAGE: Illegal START or END option.
      877    14647               MESSAGE1: Only START=label and/or END=label is allowed for non-EDIT key type.
      878    14648        */
      879    14649    2        IF B$TCB.ALT$ -> B$ALT.ERR.CODE ~= %E$EOF OR START_METHOD ~= 0
      880    14650    2           THEN   /* A real error */
      881    14651    3              DO;
      882    14652    3   OVERFLOW_ON_READ:
      883    14653    3                 SUB$PARAMS.BATCH_ABORTED# = %YES#;
      884    14654    3                 CALL CONCAT (WRITEBUF,'     ',READBUF);
      885    14655    3                 SEG$2.FPT_WRITECC$->FPT$WRITE.BUF_.BOUND =
      886    14656    3                       MINIMUM(LENGTHV(WRITEBUF),DCBADDR(M$IBEX_NUM) ->
      887    14657    3                             F$DCB.ARS# + 4);
      888    14658    3                 CALL CPE$DIAGOUT (SEG$2.FPT_WRITECC$);
      889    14659    3                 ERR = B$TCB.ALT$ -> B$ALT.ERR;
      890    14660    3                 IF ERR.ERR# = %E$LD OR TRUNCATED_RECORD
      891    14661    3                   THEN
      892    14662    3                      ERR = E_TRUNREC;
      893    14663    3                 ELSE IF ERR.ERR# = %E$BADVECT1
      894    14664    3                   THEN
      895    14665    3                      ERR = E_BDSTARTENDTYPE;
      896    14666    3                 CALL CXP$POSTERR (ADDR(SEG$2.ERRBUF), 511, ERR,
      897    14667    3                                   B$TCB.ALT$ -> B$ALT.DCB#);
      898    14668    3                 IF START_METHOD ~= 0
      899    14669    3                    THEN
      900    14670        /*E*    ERROR: CPH-E$BDSTARTNUM-0
      901    14671             MESSAGE: START parameter failed.
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:29   
      902    14672        */
      903    14673    3                       CALL CXP$POSTERR (ADDR(SEG$2.ERRBUF),511,E_BDSTARTNUM);
      904    14674        /*
      905    14675             ***** Abort the copy...
      906    14676        */
      907    14677    3   DELETE_CMD_STREAM:
      908    14678        /*
      909    14679             ***** Inform the user that BATCH/XEQ/XMIT has been aborted
      910    14680        */
      911    14681    3                       CALL CXP$POSTERR (ADDR(SEG$2.ERRBUF),511,E_BDSCAN);
      912    14682        /*
      913    14683             ***** If the command stream is currently open, close it
      914    14684                   scratch. Then goto CLEAN_UP code...
      915    14685        */
      916    14686    3                       IF DCBADDR(M$IBEX1_NUM) -> F$DCB.FCD#
      917    14687    3                          THEN
      918    14688    4                             DO;   /* Close COMMAND STREAM */
      919    14689    4                                FPT_CLOSE.V.DISP# = 0;
      920    14690    4                                FPT_CLOSE.V.DCB# = M$IBEX1_NUM;
      921    14691    4                                CALL M$CLOSE (FPT_CLOSE) ALTRET(ABORT);
      922    14692    4                             END;
      923    14693    3                 CALL CPR$RPTERR (SEG$2.ERRBUF,511);
      924    14694    3                 SEG$2.ERRBUF(1) = 0;   /* Throw away error */
      925    14695    3                       GOTO CLEAN_UP;
      926    14696    3              END;
      927    14697    2   CLOSE_CMD_STREAM:
      928    14698    2           IF SUB$PARAMS.BATCH_ABORTED#
      929    14699    2              THEN
      930    14700    2                 GOTO DELETE_CMD_STREAM;
      931    14701        /*
      932    14702             ***** Close the command stream ...
      933    14703        */
      934    14704    2           IF BLK$ -> P$B.CODE ~= XEQCMND AND NOT SUB$PARAMS.TEST_OPT#
      935    14705    2              THEN
      936    14706    3                 DO;   /* Close COMMAND STREAM */
      937    14707    3                    IF NOT DCBADDR(M$IBEX1_NUM) -> F$DCB.FCD#
      938    14708    3                    OR DCBADDR(M$IBEX1_NUM) -> F$DCB.UB$ = B$PS0$
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:30   
      939    14709    3                    AND DCBADDR(M$IBEX1_NUM) -> F$DCB.NRECS# = 0
      940    14710    3                       THEN   /* Nothing in stream. Delete it */
      941    14711    3                          GOTO DELETE_CMD_STREAM;
      942    14712
      943    14713    3                    FPT_CLOSE.V.DISP# = %SAVE#;
      944    14714    3                    FPT_CLOSE.V.DCB# = M$IBEX1_NUM;
      945    14715    3                    CALL M$CLOSE (FPT_CLOSE) ALTRET(ABORT);
      946    14716        /*
      947    14717             ***** If this was a BATCH command and TEST or
      948    14718                   NSTATUS was not specified, then get the
      949    14719                   status message from CHECK. Also enters the
      950    14720                   SYSID into the NOTIFY list ...
      951    14721        */
      952    14722    3                    IF BLK$ -> P$B.CODE ~= BATCHCMND
      953    14723    3                       THEN
      954    14724    3                          EXIT;
      955    14725                            /* Get status of job */
      956    14726        /*
      957    14727             ***** Get the sysid and setup to fake out check ...
      958    14728        */
      959    14729    3                    ADDR(FAKE_NODE3)->P$S.COUNT = 6;
      960    14730    3                    ADDR(FAKE_NODE3)->P$S.TEXT =
      961    14731    3                      DCBADDR(M$IBEX1_NUM) -> F$DCB.NAME#.C;
      962    14732    3                    PCB.OUT$ = ADDR(FAKE_NODE);
      963    14733                  /*  FAKE_NODE.TEMP passes the NSTATUS_OPT# to CPK$SUBMIT_CHECK.
      964    14734                      FAKE_NODE2.TEMP tells CPK$SUBMIT_CHECK whether this is a cross
      965    14735                                account batch job.
      966    14736                  */
      967    14737    3                    FAKE_NODE.TEMP = NSTATUS_OPT# ;
      968    14738    3                    FAKE_NODE.NSUBLKS = 1;
      969    14739    3                    FAKE_NODE2.TEMP = CROSS_ACCT_BATCH_FLG;
      970    14740    3                    FAKE_NODE2.NSUBLKS = 1;
      971    14741    3                    FAKE_NODE3.NSUBLKS = 1;
      972    14742    3                    FAKE_NODE.SUBLK$(0) = ADDR(FAKE_NODE2);
      973    14743    3                    FAKE_NODE2.SUBLK$(0) = ADDR(FAKE_NODE3);
      974    14744    3                    FAKE_NODE3.SUBLK$(0) = ADDR(ADDR(FAKE_NODE3)->P$S.COUNT);
      975    14745    3                    FAKE_NODE2.CODE = %CH_SYSIDCMD;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:31   
      976    14746    3                    FAKE_NODE3.CODE = %CH_SYSID;
      977    14747    3                    IF NOT NSTATUS_OPT#
      978    14748    3                     THEN
      979    14749    4                       DO ;
      980    14750        /*
      981    14751             ***** Wait 1 sec so PRESCAN and all others to look at
      982    14752                   the file...
      983    14753        */
      984    14754    4                         FPT_WAIT = CFPT_WAIT;
      985    14755    4                         FPT_WAIT.V_ = VECTOR(FPT_WAIT.V);
      986    14756    4                         FPT_WAIT.V.UNITS# = 1;   /* 1 sec */
      987    14757    5                         CALL M$WAIT (FPT_WAIT) WHENALTRETURN DO; END;
      988    14758    4                       END ; /* Then Do */
      989    14759        /*
      990    14760             ***** Call check to get the status message...
      991    14761        */
      992    14762    3                    CALL CPK$SUBMIT_CHECK (PCB) ALTRET(ABORT);
      993    14763    3                    SEG$2.ERRBUF(1) = 0;   /* Throw away msg */
      994    14764    3                    FAKE_NODE.TEMP = %NO#;
      995    14765    3                 END;   /* get status of job */
      996    14766        /*
      997    14767             ***** Delete online and default subs...
      998    14768        */
      999    14769    3         DO WHILE('0'B);
     1000    14770    3   CLEAN_UP:
     1001    14771    3             SUB$PARAMS.BATCH_ABORTED# = %YES#;
     1002    14772    3             END;
     1003    14773        /*
     1004    14774             ***** if a !JOB cmd was found then dont close the
     1005    14775                   jcl file. else close the jcl file and
     1006    14776                   delete all default and online subs...
     1007    14777        */
     1008    14778    2           IF JOB_FLAG#
     1009    14779    2              THEN
     1010    14780    3                 DO;
     1011    14781    3                    IF DCBADDR(M$IBEX_NUM) -> F$DCB.FCD# = %YES#
     1012    14782    3                       THEN
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:32   
     1013    14783    4                          DO;   /* Close M$IBEX */
     1014    14784    4                             FPT_CLOSE.V.DISP# = %SAVE#;
     1015    14785    4                             FPT_CLOSE.V.DCB# = M$IBEX_NUM;
     1016    14786    4                             CALL M$CLOSE (FPT_CLOSE) ALTRET(ABORT);
     1017    14787    4                          END;
     1018    14788        /*
     1019    14789             ***** Setup FPT_OPEN for opening jcl file ...
     1020    14790        */
     1021    14791    3                    FPT_OPEN.V.DCB# = M$IBEX_NUM;
     1022    14792    3                    FPT_OPEN.V.FUN# = %IN#;
     1023    14793    3                    CALL OPEN_FID(JOB_FID$ -> P$B.SUBLK$(0)) ALTRET(CLOSE_DCBS);
     1024    14794    3                    IF DCBADDR(M$IBEX_NUM) -> F$DCB.ORG# = %CONSEC#
     1025    14795    3                      OR NOT FPT_READ.V.KEYR#
     1026    14796    3                       THEN
     1027    14797    4                          DO;
     1028    14798    4                             FPT_PRECORD.V.KEYS# = %NO#;
     1029    14799    4                             FPT_PRECORD.V.N# = SUB$PARAMS.REC_NUM -1;
     1030    14800    4                             CALL M$PRECORD (FPT_PRECORD) ALTRET(CLOSE_DCBS);
     1031    14801    4                          END;
     1032    14802    3                       ELSE
     1033    14803    4                          DO;
     1034    14804    4                             FPT_PRECORD.V.KEYS# = %YES#;
     1035    14805    4                             FPT_PRECORD.V.N# = 0;
     1036    14806    4                             FPT_PRECORD.KEY_ = VECTOR(READ_KEY);
     1037    14807    4                             CALL M$PRECORD (FPT_PRECORD) ALTRET(CLOSE_DCBS);
     1038    14808    4                          END;
     1039    14809    3                    CALL M$READ (FPT_READ) ALTRET(CLOSE_DCBS);
     1040    14810    3                    JOB_FLAG# = %NO#;
     1041    14811    3                    GOTO OPEN_CMD_STREAM;
     1042    14812    3                 END;
     1043    14813    3           DO WHILE (SUB$PARAMS.ONLINE_DEF_HEAD$ ~= ADDR(NIL));
     1044    14814    3              X$MCB.ADDRESS$ = SUB$PARAMS.ONLINE_DEF_HEAD$;
     1045    14815    3              SUB$PARAMS.ONLINE_DEF_HEAD$ = SUB$PARAMS.ONLINE_DEF_HEAD$ -> X$MAP.LINK$;
     1046    14816    3              CALL X$DEALLOCATE (X$MCB);
     1047    14817    3           END;
     1048    14818    3           DO WHILE (SUB$PARAMS.DEFAULT_DEF_HEAD$ ~= ADDR(NIL));
     1049    14819    3              X$MCB.ADDRESS$ = SUB$PARAMS.DEFAULT_DEF_HEAD$;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:33   
     1050    14820    3              SUB$PARAMS.DEFAULT_DEF_HEAD$ = SUB$PARAMS.DEFAULT_DEF_HEAD$ -> X$MAP.
             14820                       LINK$;
     1051    14821    3              CALL X$DEALLOCATE (X$MCB);
     1052    14822    3           END;
     1053    14823        /*
     1054    14824             ***** Close the jcl file...
     1055    14825        */
     1056    14826    2   CLOSE_JCL_FILE:
     1057    14827    2           IF DCBADDR(M$IBEX_NUM) -> F$DCB.FCD# = %YES#
     1058    14828    2              THEN
     1059    14829    3                 DO;   /* Close M$IBEX */
     1060    14830    3                    FPT_CLOSE.V.DISP# = %SAVE#;
     1061    14831    3                    FPT_CLOSE.V.DCB# = M$IBEX_NUM;
     1062    14832    3                    CALL M$CLOSE (FPT_CLOSE) ALTRET(ABORT);
     1063    14833    3                 END;   /* Close M$IBEX */
     1064    14834    2         END;   /* Do main loop ... end */
     1065    14835        %EJECT;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:34   
     1066    14836        /*
     1067    14837             ***** Error conditions ...
     1068    14838        */
     1069    14839    2        DO WHILE (%NO#);
     1070    14840    2   ABORT:  ;
     1071    14841    2           CALL CXP$POSTERR (ADDR(SEG$2.ERRBUF),511,B$TCB.ALT$ -> B$ALT.ERR,,
     1072    14842    2                B$TCB.ALT$ -> B$ALT.DCB#);
     1073    14843    2           SUB$PARAMS.BATCH_ABORTED# = %YES#;
     1074    14844    2        END;
     1075    14845        %EJECT;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:35   
     1076    14846        /*
     1077    14847             ***** If xeq then the command stream is
     1078    14848                   still open. close it...
     1079    14849        */
     1080    14850    1   CLOSE_DCBS:
     1081    14851    1        IF DCBADDR(M$IBEX_NUM)->F$DCB.FCD# = %YES#
     1082    14852    1           THEN   /* somehow we missed a close */
     1083    14853    2              DO;
     1084    14854    2                 FPT_CLOSE.V.DISP# = %SAVE#;
     1085    14855    2                 FPT_CLOSE.V.DCB# = M$IBEX_NUM;
     1086    14856    2                 CALL M$CLOSE (FPT_CLOSE) ALTRET(E_CLOSE);
     1087    14857    2              END;
     1088    14858    1   E_CLOSE: ;   /* ignore altreturn */
     1089    14859    1        IF DCBADDR(M$IBEX1_NUM)->F$DCB.FCD# = %YES#
     1090    14860    1           THEN   /* close the command stream */
     1091    14861    2              DO;
     1092    14862    2                 FPT_CLOSE.V.DISP# = %SAVE#;
     1093    14863    2                 FPT_CLOSE.V.DCB# = M$IBEX1_NUM;
     1094    14864    2                 CALL M$CLOSE (FPT_CLOSE) ALTRET(E_CLOSE1);
     1095    14865    2              END;
     1096    14866    1   E_CLOSE1: ;   /* ignore altreturn */
     1097    14867        /*
     1098    14868             ***** Release the page(s) which
     1099    14869                   were used to store SUBS...
     1100    14870        */
     1101    14871    1   REL_PAGES:
     1102    14872    1        CALL CPC$RELSEG (SEG3$);
     1103    14873        /*
     1104    14874             ***** Since M$IBEX was used here it must be
     1105    14875                   re-opened to the COMMAND STREAM ...
     1106    14876        */
     1107    14877    1        CALL CPB$OPENCS;
     1108    14878    1        IF SUB$PARAMS.BATCH_ABORTED#
     1109    14879    1           THEN   /* Errors! */
     1110    14880    1              ALTRETURN;
     1111    14881    1           ELSE   /* AOK! */
     1112    14882    1              RETURN;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:36   
     1113    14883        %EJECT ;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:37   
     1114    14884    1   CHK_FOLLOW_CONDITION: PROC(BLK$) ALTRET ;
     1115    14885
     1116    14886    2   DCL BLK$ PTR PARAM ;
     1117    14887
     1118    14888    2   DCL I UBIN WORD ;
     1119    14889    2   DCL J UBIN WORD ;
     1120    14890    2   DCL SYSID UBIN HALF ;
     1121    14891    2   DCL TEMP$ PTR ;
     1122    14892    2   DCL NEED_2_READ_JOBSTATS BIT(1) ;
     1123    14893
     1124    14894    2     IBEX_OPEN_2_JOBSTATS = %NO# ;
     1125    14895    2     NEED_2_READ_JOBSTATS = %NO# ;
     1126    14896    2     NEED_2_RELEASE_IBEX2 = %NO# ;
     1127    14897    2     NEED_ALTRETURN = %NO# ;
     1128    14898    2     XSJ_PARAM = CXSJ_PARAM ;
     1129    14899    2     XSJ_PARAM.BUF_ = VECTOR(SYSID) ;
     1130    14900    2     XSJ_PARAM.DCB# = M$IBEX2_NUM ;
     1131    14901    2     FOL_ACCT = B$JIT.ACCN ; /* Setup default account name for follow test */
     1132    14902
     1133    14903    3     DO I=0 TO BLK$->P$B.NSUBLKS-1 ;
     1134    14904    3         IF BLK$->P$B.SUBLK$(I)->P$S.CODE = JOB_ACCTNAME
     1135    14905    3             THEN
     1136    14906    3               FOL_ACCT = BLK$->P$B.SUBLK$(I)->P$B.SUBLK$(0)->P$S.TEXT;
     1137    14907
     1138    14908    3         IF BLK$->P$B.SUBLK$(I)->P$S.CODE = JOB_FOLLOW
     1139    14909    3             THEN
     1140    14910    4               DO J=0 TO BLK$->P$B.SUBLK$(I)->P$B.NSUBLKS-1 ;
     1141    14911    4                 TEMP$ = BLK$->P$B.SUBLK$(I)->P$B.SUBLK$(J) ;
     1142    14912    5                 DO CASE(TEMP$->P$B.SUBLK$(0)->P$B.SUBLK$(0)->P$S.CODE) ;
     1143    14913
     1144    14914    5                   CASE(JOB_JNAME) ;
     1145    14915    5                     FOL_NAME.NAME = TEMP$->P$B.SUBLK$(0)->
     1146    14916    5                                             P$B.SUBLK$(0)->P$S.TEXT ;
     1147    14917    5                     FOL_NAME.CNT = TEMP$->P$B.SUBLK$(0)->
     1148    14918    5                                             P$B.SUBLK$(0)->P$S.COUNT ;
     1149    14919    5                     XSJ_PARAM.NAME$ = ADDR(FOL_NAME.NAME) ;
     1150    14920    5                     NEED_2_READ_JOBSTATS = %YES# ;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:38   
     1151    14921    5                     IF TEMP$->P$B.SUBLK$(0)->P$B.NSUBLKS > 1
     1152    14922    5                       THEN
     1153    14923    5                         FOL_ACCT = TEMP$->P$B.SUBLK$(0)->P$B.SUBLK$(1)->
     1154    14924    5                                         P$S.TEXT ;
     1155    14925    5                     XSJ_PARAM.ACCT$ = ADDR(FOL_ACCT) ;
     1156    14926
     1157    14927    5                   CASE(JOB_SYSID,ELSE) ;
     1158    14928    5                     NEED_2_READ_JOBSTATS = %NO# ;
     1159    14929                              /* Nothing Done */
     1160    14930
     1161    14931    5                 END ; /* Do Case */
     1162    14932    4                 IF NEED_2_READ_JOBSTATS
     1163    14933    4                   THEN
     1164    14934    5                     DO ;
     1165    14935    5                       IF NOT IBEX_OPEN_2_JOBSTATS
     1166    14936    5                         THEN
     1167    14937    5                           CALL OPEN_M$IBEX2 ALTRET(CHK_RETURN) ;
     1168    14938    6                       CALL XSJ$READ(XSJ_PARAM) WHENALTRETURN DO ;
     1169    14939    6                                         CPOS = TEMP$->P$S.CPOS ;
     1170    14940    6                                         IF B$TCB.ALT$->B$ALT.ERR.CODE = %E$NOKEY
     1171    14941    6                                           THEN
     1172    14942    6                                             CALL POST_ERR_4_NONAME ;
     1173    14943    6                                           ELSE
     1174    14944    6                                             GOTO CHK_RETURN ;
     1175    14945    6                                         END ; /* Whenaltreturn Do */
     1176    14946    5                     END ; /* Then Do */
     1177    14947    4               END ; /* Do J */
     1178    14948    3     END ;   /* Do I */
     1179    14949    2   CHK_RETURN:
     1180    14950    2         IF IBEX_OPEN_2_JOBSTATS
     1181    14951    2             THEN
     1182    14952    3               DO ;
     1183    14953    3                 CALL XSJ$CLOSE(XSJ_PARAM) ALTRET(CHK_ERR) ;
     1184    14954    3                 IBEX_OPEN_2_JOBSTATS = %NO# ;
     1185    14955    3                 IF NEED_2_RELEASE_IBEX2
     1186    14956    3                   THEN
     1187    14957    4                     DO ;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:39   
     1188    14958    4                       CALL CPC$RELDCB(M$IBEX2_NUM) ;
     1189    14959    4                     END ; /* Then Do */
     1190    14960    3                 NEED_2_RELEASE_IBEX2 = %NO# ;
     1191    14961    3               END ; /* Then Do */
     1192    14962
     1193    14963    2     IF NEED_ALTRETURN
     1194    14964    2         THEN
     1195    14965    2             GOTO CHK_ERR ;
     1196    14966
     1197    14967    2         RETURN ;
     1198    14968
     1199    14969    2   CHK_ERR:
     1200    14970    2         ALTRETURN ;
     1201    14971    2   END   CHK_FOLLOW_CONDITION ;
     1202    14972        %EJECT ;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:40   
     1203    14973    1   OPEN_M$IBEX2: PROC ALTRET ;
     1204    14974
     1205    14975    2     CALL CPC$GETDCB(M$IBEX2_NUM, IBEX2TXTC);
     1206    14976    2     NEED_2_RELEASE_IBEX2 = %YES# ;
     1207    14977    2     XSJ_PARAM.DCB# = M$IBEX2_NUM;
     1208    14978    2     CALL XSJ$OPEN(XSJ_PARAM) ;
     1209    14979    2     IBEX_OPEN_2_JOBSTATS = %YES# ;
     1210    14980    2     RETURN ;
     1211    14981
     1212    14982    2   END   OPEN_M$IBEX2 ;
     1213    14983        %EJECT ;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:41   
     1214    14984    1   POST_ERR_4_NONAME: PROC ;
     1215    14985
     1216    14986    2     IF SEG$2.FLAGS.CONTINUED
     1217    14987    2         THEN
     1218    14988    3             DO ;
     1219    14989    3               IF TEMP$->P$B.SUBLK$(0)->P$B.NSUBLKS > 1
     1220    14990    3                 THEN
     1221    14991    3                   CALL CPC$WRITEMSGE(E_NONAME_4_CONT,,FOL_NAME,FOL_ACCT,,%YES#) ;
     1222    14992    3                 ELSE
     1223    14993    3                   CALL CPC$WRITEMSGE(E_NONAME_4_CONT,,FOL_NAME,,,%YES#) ;
     1224    14994    3               ECHO_JOB_CMD = %NO# ;
     1225    14995    3             END ; /* Then Do */
     1226    14996    2         ELSE
     1227    14997    3             DO ;
     1228    14998    3               CALL STUFF_GETCMD_4_ERRPTR ;
     1229    14999    3               CALL CXP$POSTERR(ADDR(SEG$2.ERRBUF),CPOS,E_NONAME) ;
     1230    15000    3             END ; /* Else Do */
     1231    15001    2     NEED_ALTRETURN = %YES# ;
     1232    15002
     1233    15003    2     RETURN ;
     1234    15004    2   END   POST_ERR_4_NONAME ;
     1235    15005          %EJECT;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:42   
     1236    15006        /*****************************************************************/
     1237    15007        /*F*       NAME:    CPH$GLOBAL
     1238    15008         **
     1239    15009                   PURPOSE:    Process the GLOBAL command
     1240    15010         **
     1241    15011                   DESCRIPTION:
     1242    15012                                The STRING and FIELD definitions which
     1243    15013                            are defined on the GLOBAL command remain in
     1244    15014                            effect from one JOB step to another. These
     1245    15015                            definitions are stored in the *S file and
     1246    15016                            are read back in and searched during BATCH
     1247    15017                            and XEQ processing. GLOBAL substitutions have
     1248    15018                            priority over DEFAULT substitutions but ONLINE
     1249    15019                            substitutions have priority over GLOBALs.
     1250    15020         **
     1251    15021                   REFERENCE:  Programming Reference Manual
     1252    15022        */
     1253    15023        /*****************************************************************/
     1254    15024    1   GLOBAL: PROC  ALTRET;
     1255    15025        /*E*    ERROR: CPH-E$MSGLOBAL-C
     1256    15026                MESSAGE: Missing GLOBAL sub
     1257    15027        */
     1258    15028        /*
     1259    15029             ***** Read any existing GLOBAL substitions in from the *S file...
     1260    15030        */
     1261    15031    2   GET_GLOBALS:
     1262    15032    2     CALL READ_GLOBALS ALTRET(REL_PAGES);
     1263    15033    2     IF BLK$->P$B.NSUBLKS = 0
     1264    15034    2        THEN
     1265    15035        /*
     1266    15036             ***** List all the GLOBAL subs in effect currently...
     1267    15037        */
     1268    15038    3           DO;
     1269    15039    3              SEG$2.FPT_WRITECC$ -> FPT$WRITE.BUF_ = VECTOR(WRITEBUF);
     1270    15040    3              X$PARAM.SYM_HEAD$ = SUB$PARAMS.GLOBAL_DEF_HEAD$;
     1271    15041    3              X$PARAM.NUM = 0;
     1272    15042    3              X$PARAM.SRCH = 2;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:43   
     1273    15043    3              IF X$PARAM.SYM_HEAD$ = ADDR(NIL)
     1274    15044    3                 THEN
     1275    15045    4                    DO;   /* No GLOBALs */
     1276    15046    4                       WRITEBUF = '   Globals: none';
     1277    15047    4                       SEG$2.FPT_WRITECC$->FPT$WRITE.BUF_.BOUND=15;
     1278    15048    4                       CALL CPE$LISTOUT (SEG$2.FPT_WRITECC$);
     1279    15049    4                       GOTO REL_PAGES;
     1280    15050    4                    END;
     1281    15051    3                 ELSE
     1282    15052    4                    DO;
     1283    15053    4                       WRITEBUF = '   Globals:';
     1284    15054    4                       SEG$2.FPT_WRITECC$->FPT$WRITE.BUF_.BOUND=10;
     1285    15055    4                       CALL CPE$LISTOUT (SEG$2.FPT_WRITECC$);
     1286    15056    4                    END;
     1287    15057    4              DO WHILE (%YES#);
     1288    15058    4                 CALL CPH$SYM_GET (X$MCB,X$PARAM) ALTRET(REL_PAGES);
     1289    15059    4                 IF X$PARAM.TYPE = %DSTRING#
     1290    15060    4                    THEN
     1291    15061    4                       CALL CONCAT (WRITEBUF,'      ''',X$PARAM.TEXTC$(0)
     1292    15062    4                            -> X$STRING.TEXT,''' = ''',
     1293    15063    4                            X$PARAM.TEXTC$(1) -> X$STRING.TEXT,'''');
     1294    15064    4                    ELSE
     1295    15065    4                       CALL CONCAT (WRITEBUF,'      ',X$PARAM.TEXTC$(0)
     1296    15066    4                            -> X$STRING.TEXT,' = ''',
     1297    15067    4                            X$PARAM.TEXTC$(1) -> X$STRING.TEXT,'''');
     1298    15068    4                 SEG$2.FPT_WRITECC$->FPT$WRITE.BUF_.BOUND =
     1299    15069    4                      X$PARAM.TEXTC$(0)->X$STRING.SIZ+
     1300    15070    4                      X$PARAM.TEXTC$(1)->X$STRING.SIZ+12;
     1301    15071    4                 CALL CPE$LISTOUT (SEG$2.FPT_WRITECC$);
     1302    15072    4                 X$PARAM.NUM = X$PARAM.NUM + 1;
     1303    15073    4              END;
     1304    15074    3           END;
     1305    15075    2     TEMP$=BLK$->P$B.SUBLK$(0);
     1306    15076    2     IF TEMP$->P$B.CODE = BA_DELETE
     1307    15077    2        THEN
     1308    15078    3           DO;   /* Reset GLOBAL subs */
     1309    15079    3              IF TEMP$ -> P$B.NSUBLKS = 0
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:44   
     1310    15080    3                 THEN   /* reset all GLOBAL subs */
     1311    15081    3                    GOTO DELETE_ALL_SUBS;
     1312    15082        /*
     1313    15083             ***** delete the listed GLOBAL subs...
     1314    15084        */
     1315    15085    3              X$PARAM.SYM_HEAD$ = SUB$PARAMS.GLOBAL_DEF_HEAD$;
     1316    15086    3              X$PARAM.SRCH = 1;
     1317    15087    4              DO NUM_OPTS = 0 TO TEMP$ -> P$B.NSUBLKS -1;
     1318    15088    4                 P$ = TEMP$ -> P$B.SUBLK$(NUM_OPTS);
     1319    15089    4                 X$PARAM.TYPE = P$ -> P$B.NDTYPE;
     1320    15090    4                 X$PARAM.TEXTC$(0) = P$ -> P$S.TEXTC$;
     1321    15091    4                 CALL CPH$SYM_DELETE (X$MCB,X$PARAM) ALTRET(MSING_SUB);
     1322    15092    4                 SUB$PARAMS.GLOBAL_DEF_HEAD$ = X$PARAM.SYM_HEAD$;
     1323    15093    4                 GOTO END_LOOP;
     1324    15094    4   MSING_SUB:
     1325    15095    4                 CPOS = P$ -> P$S.CPOS;
     1326    15096    4                 CALL CXP$POSTERR (ADDR(SEG$2.ERRBUF),CPOS,E_MSGLOBAL);
     1327    15097    4   END_LOOP:
     1328    15098    4              END;   /* Reset GLOBAL subs */
     1329    15099    3              IF X$PARAM.SYM_HEAD$ ~= ADDR(NIL)
     1330    15100    3                 THEN
     1331    15101    3                    GOTO SAVE_SUBS;
     1332    15102        /*
     1333    15103             ***** delete all GLOBAL subs...
     1334    15104        */
     1335    15105    3   DELETE_ALL_SUBS:
     1336    15106    3              FPT_DELREC = CFPT_DELREC;
     1337    15107    3              FPT_DELREC.V_= VECTOR(FPT_DELREC.V);
     1338    15108    3              FPT_DELREC.V.DCB#=M$IBEX1_NUM;
     1339    15109    3              FPT_DELREC.KEY_=VECTOR(K_GLOBAL);
     1340    15110    3              CALL M$DELREC (FPT_DELREC) ALTRET (REL_PAGES);
     1341    15111    3              GOTO REL_PAGES;
     1342    15112    3           END;
     1343    15113        /*
     1344    15114             ***** add new GLOBAL subs...
     1345    15115        */
     1346    15116    2     X$PARAM.SYM_HEAD$=SUB$PARAMS.GLOBAL_DEF_HEAD$;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:45   
     1347    15117    2     X$PARAM.SRCH = 1;
     1348    15118    3     DO NUM_OPTS = 0 TO BLK$ -> P$B.NSUBLKS - 1;
     1349    15119    3        TEMP$=BLK$->P$B.SUBLK$(NUM_OPTS);
     1350    15120    3        X$PARAM.TEXTC$(0)=TEMP$->P$B.SUBLK$(0)->P$S.TEXTC$;
     1351    15121    3        X$PARAM.TEXTC$(1)=TEMP$->P$B.SUBLK$(1)->P$S.TEXTC$;
     1352    15122    3        X$PARAM.TYPE=TEMP$->P$B.SUBLK$(0)->P$S.NDTYPE;
     1353    15123    3        CALL CPH$SYM_PUT (X$MCB,X$PARAM);
     1354    15124    3        IF X$PARAM.ERR.CODE ~= 0
     1355    15125    3           THEN
     1356    15126    3              CALL CPC$WRITEMSGE (X$PARAM.ERR);
     1357    15127    3        SUB$PARAMS.GLOBAL_DEF_HEAD$=X$PARAM.SYM_HEAD$;
     1358    15128    3     END;
     1359    15129        /*
     1360    15130             ***** Save GLOBAL DEFS...
     1361    15131        */
     1362    15132    2   SAVE_SUBS:
     1363    15133    2     CP$GLOBALS.WKSZ_SAVE=X$MCB.WKSZ;
     1364    15134    2     CP$GLOBALS.HI_SEGMENT_SAVE$=X$MCB.HI_SEGMENT$;
     1365    15135    2     CP$GLOBALS.SYM_HEAD_SAVE$=SUB$PARAMS.GLOBAL_DEF_HEAD$;
     1366    15136    2     CP$GLOBALS.FREE_HEAD_SAVE$=X$MCB.FREE_HEAD$;
     1367    15137    2     CALL CPJ$WRITE_S (M$IBEX1_NUM,VECTOR(K_GLOBAL),SEG3_) ALTRET(ABORT1);
     1368    15138        /*
     1369    15139             ***** Release the page(s) which
     1370    15140                   were used to store SUBS...
     1371    15141        */
     1372    15142    2   REL_PAGES:
     1373    15143    2     CALL CPC$RELSEG (SEG3$);
     1374    15144        /*
     1375    15145             close the *S file...
     1376    15146        */
     1377    15147    2     FPT_CLOSE = CFPT_CLOSE;
     1378    15148    2     FPT_CLOSE.V_ = VECTOR(FPT_CLOSE.V);
     1379    15149    2     FPT_CLOSE.V.DCB#=M$IBEX1_NUM;
     1380    15150    2     FPT_CLOSE.V.DISP#=%SAVE#;
     1381    15151    2     CALL M$CLOSE (FPT_CLOSE) ALTRET(ABORT1);
     1382    15152    2     IF SEG$2.ERRBUF(1) = 0
     1383    15153    2        THEN   /* No errors reported */
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:46   
     1384    15154    2           RETURN;
     1385    15155    2        ELSE   /* Errors! */
     1386    15156    2           ALTRETURN;
     1387    15157    2   ABORT1:
     1388    15158    2     CALL CXP$POSTERR (ADDR(SEG$2.ERRBUF),511,B$TCB.ALT$ -> B$ALT.ERR,,M$IBEX1_NUM);
     1389    15159    2     ALTRETURN;
     1390    15160    2   END GLOBAL;
     1391    15161        %EJECT;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:47   
     1392    15162    1   READ_GLOBALS: PROC ALTRET;
     1393    15163        /*
     1394    15164             ***** Initialize...
     1395    15165        */
     1396    15166    2     X$MCB.SEGMENT_BASE$=SEG3$;
     1397    15167    2     X$MCB.WKSZ=1024;
     1398    15168    2     X$MCB.HI_SEGMENT$=PINCRW(SEG3$,5);
     1399    15169    2     X$MCB.FREE_HEAD$=ADDR(NIL);
     1400    15170    2     SUB$PARAMS.GLOBAL_DEF_HEAD$ = ADDR(NIL);
     1401    15171        /*
     1402    15172             ***** open the *S file
     1403    15173        */
     1404    15174    2     CALL CPC$OPEN_S (M$IBEX1_NUM) ALTRET(E_OPEN);
     1405    15175        /*
     1406    15176             ***** Get a page to keep string subs in...
     1407    15177        */
     1408    15178    2     CALL CPC$GETSEG (SEG3$) ALTRET(E_GETSEG);
     1409    15179    3     DO WHILE (%NO#);
     1410    15180    3   E_GETSEG:   /* Screech */
     1411    15181    3        CALL CPC$SCREECH (E$SUASEG,CPH$IBEXMID);
     1412    15182    3     END;
     1413    15183        /*
     1414    15184             ***** Initialize SEG3_
     1415    15185        */
     1416    15186    2     SEG3_ = VECTOR(CP$GLOBALS);
     1417    15187    2     SEG3_.VSIZE = 4095;   /* size of page */
     1418    15188        /*
     1419    15189             ***** Read global subs from *S file...
     1420    15190        */
     1421    15191    2     CALL CPJ$READ_S (M$IBEX1_NUM,VECTOR(K_GLOBAL),SEG3_) ALTRET(E_READ);
     1422    15192        /*
     1423    15193             ***** A sucessful read means that GLOBAL subs
     1424    15194                   already exist. Set up the mcb to frame them...
     1425    15195        */
     1426    15196    2     X$MCB.WKSZ=CP$GLOBALS.WKSZ_SAVE;
     1427    15197    2     X$MCB.HI_SEGMENT$=CP$GLOBALS.HI_SEGMENT_SAVE$;
     1428    15198    2     SUB$PARAMS.GLOBAL_DEF_HEAD$=CP$GLOBALS.SYM_HEAD_SAVE$;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:48   
     1429    15199    2     X$MCB.FREE_HEAD$=CP$GLOBALS.FREE_HEAD_SAVE$;
     1430    15200    2     RETURN;
     1431    15201        /*
     1432    15202             ***** Some error has occured on the read...
     1433    15203        */
     1434    15204    2   E_READ:
     1435    15205    2     B$JIT.USRERR = '0'O;
     1436    15206    2     RETURN;
     1437    15207        /*
     1438    15208             ***** If we got here,
     1439    15209                   then there must be some error...
     1440    15210        */
     1441    15211    2   E_OPEN:
     1442    15212    2     CALL CPC$WRITEMSGE (B$JIT.USRERR,M$IBEX1_NUM);
     1443    15213    2     ALTRETURN;
     1444    15214    2   END READ_GLOBALS;
     1445    15215        %EJECT;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:49   
     1446    15216        /*****************************************************************/
     1447    15217        /*I*    NAME:    PROCESS_DIRECTIVES
     1448    15218                PURPOSE: If a directive (DEFAULT, INCLUDE, PROMPT) is found
     1449    15219                         then process it. If no directives are found then
     1450    15220                         altreturn.
     1451    15221        */
     1452    15222        /*****************************************************************/
     1453    15223    1   PROCESS_DIRECTIVES:
     1454    15224    1     PROC ALTRET;
     1455    15225        /*E*    ERROR: CPH-E$MSDEFAULT-C
     1456    15226                MESSAGE: Missing DEFAULT sub
     1457    15227        */
     1458    15228        /*
     1459    15229             ***** Determine if this is a DIRECTIVE ...
     1460    15230        */
     1461    15231    2     IF SUBSTR(READBUF,0,1) ~= '!'
     1462    15232    2        THEN   /* Must have leading ! */
     1463    15233    2           ALTRETURN;
     1464    15234    2     CALL XLATE (TEMPBUF, B$XL_UPPER, READBUF);
     1465    15235        /*
     1466    15236             ***** look for first word after the '!' *****
     1467    15237        */
     1468    15238    2     CALL SEARCH (START_INDX, X, B$SR_NON_BLANK, TEMPBUF, 1)
     1469    15239    3     WHENRETURN DO;
     1470    15240    3        CALL INDEX (STR_INDX, ' ', TEMPBUF, START_INDX);
     1471    15241        /*
     1472    15242             ***** START_INDX and STR_INDX now frame VERB ...
     1473    15243        */
     1474    15244    3        IF (STR_INDX-START_INDX = 7) AND
     1475    15245    3           (SUBSTR(TEMPBUF,START_INDX,7) = 'DEFAULT')
     1476    15246    3           THEN
     1477    15247    4              DO;
     1478    15248    4                 FAKE_NODE.CODE = DEFAULTCMND;
     1479    15249    4                 GOTO PARSE_DIRECTIVE;
     1480    15250    4              END;
     1481    15251    3        IF (STR_INDX-START_INDX = 7) AND
     1482    15252    3           (SUBSTR(TEMPBUF,START_INDX,7) = 'INCLUDE')
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:50   
     1483    15253    3           THEN
     1484    15254    4              DO;
     1485    15255        /*
     1486    15256             ***** If still searching for START, don't do INCLUDES.
     1487    15257        */
     1488    15258    4                 IF START_METHOD ~= 0
     1489    15259    4                    THEN
     1490    15260    4                       ALTRETURN;
     1491    15261    4                 FAKE_NODE.CODE = INCLUDECMND;
     1492    15262    4                 CALL CPH$STRING_SUB (SUB$PARAMS);
     1493    15263    4                 GOTO PARSE_DIRECTIVE;
     1494    15264    4              END;
     1495    15265    3     END;
     1496    15266        /*
     1497    15267             ***** Not a DIRECTIVE ...
     1498    15268        */
     1499    15269    2     ALTRETURN;
     1500    15270        %EJECT;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:51   
     1501    15271    2   PARSE_DIRECTIVE:
     1502    15272    2     PCB.U$$ = ENTADDR(CPD$SYNTRY);
     1503    15273    2     PCB.TEXT$=PINCRC(ADDR(READBUF),1);
     1504    15274    2     PCB.NCHARS=SUB$PARAMS.BUF_LEN;
     1505    15275    2     PCB.OUT$ = ADDR(FAKE_NODE);
     1506    15276    2      PCB.CONTINUE = %NO#;
     1507    15277    2     CALL CPD$SET_NODES (PCB, PCB.ROOT$, PCB.USER$->U$PARAM.SPCL$$, CALL_FLG#) ;
     1508    15278    3     CALL X$PARSE (PCB) WHENALTRETURN DO;
     1509    15279    3        CALL CXP$POSTERR (ADDR(SEG$2.ERRBUF),PCB.HI_CHAR,PCB.ERROR);
     1510    15280    3     END;
     1511    15281        /**/
     1512    15282    2     IF SEG$2.ERRBUF(1) ~= 0
     1513    15283    2         THEN
     1514    15284    3             DO;
     1515    15285    3        CALL CONCAT (WRITEBUF,'     ',READBUF);
     1516    15286    3        SEG$2.FPT_WRITECC$->FPT$WRITE.BUF_.BOUND =
     1517    15287    3           MINIMUM(LENGTHV(WRITEBUF),DCBADDR(M$IBEX_NUM) ->
     1518    15288    3                 F$DCB.ARS# + 4);
     1519    15289    3        CALL CPE$DIAGOUT (SEG$2.FPT_WRITECC$);
     1520    15290    3        CALL STUFF_GETCMD_4_ERRPTR ;
     1521    15291    3        GOTO ABORT;
     1522    15292    3     END;
     1523    15293        /**/
     1524    15294        /**/
     1525    15295    2     IF PCB.OUT$ -> P$B.CODE = INCLUDECMND
     1526    15296    2        THEN
     1527    15297    2           GOTO PROCESS_INCLUDE;
     1528    15298        %EJECT;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:52   
     1529    15299    2   PROCESS_DEFAULT:
     1530    15300    2     IF PCB.OUT$->P$B.NSUBLKS = 0
     1531    15301    2        THEN
     1532    15302        /*
     1533    15303             ***** List all the DEFAULT subs in effect currently...
     1534    15304        */
     1535    15305    3           DO;
     1536    15306    3              SEG$2.FPT_WRITECC$ -> FPT$WRITE.BUF_ = VECTOR(WRITEBUF);
     1537    15307    3              X$PARAM.SYM_HEAD$ = SUB$PARAMS.DEFAULT_DEF_HEAD$;
     1538    15308    3              X$PARAM.NUM = 0;
     1539    15309    3              X$PARAM.SRCH = 2;
     1540    15310    3              IF X$PARAM.SYM_HEAD$ = ADDR(NIL)
     1541    15311    3                 THEN
     1542    15312    4                    DO;   /* No DEFAULTs */
     1543    15313    4                       WRITEBUF = '   Defaults: none';
     1544    15314    4                       SEG$2.FPT_WRITECC$->FPT$WRITE.BUF_.BOUND=16;
     1545    15315    4                       CALL CPE$LISTOUT (SEG$2.FPT_WRITECC$);
     1546    15316    4                       RETURN;
     1547    15317    4                    END;
     1548    15318    3                 ELSE
     1549    15319    4                    DO;
     1550    15320    4                       WRITEBUF = '   Defaults:';
     1551    15321    4                       SEG$2.FPT_WRITECC$->FPT$WRITE.BUF_.BOUND=11;
     1552    15322    4                       CALL CPE$LISTOUT (SEG$2.FPT_WRITECC$);
     1553    15323    4                    END;
     1554    15324    4              DO WHILE (%YES#);
     1555    15325    4                 CALL CPH$SYM_GET (X$MCB,X$PARAM) ALTRET(SYM_ERR);
     1556    15326    4                 IF X$PARAM.TYPE = %DSTRING#
     1557    15327    4                    THEN
     1558    15328    4                       CALL CONCAT (WRITEBUF,'      ''',X$PARAM.TEXTC$(0)
     1559    15329    4                            -> X$STRING.TEXT,''' = ''',
     1560    15330    4                            X$PARAM.TEXTC$(1) -> X$STRING.TEXT,'''');
     1561    15331    4                    ELSE
     1562    15332    4                       CALL CONCAT (WRITEBUF,'      ',X$PARAM.TEXTC$(0)
     1563    15333    4                            -> X$STRING.TEXT,' = ''',
     1564    15334    4                            X$PARAM.TEXTC$(1) -> X$STRING.TEXT,'''');
     1565    15335    4                 SEG$2.FPT_WRITECC$->FPT$WRITE.BUF_.BOUND =
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:53   
     1566    15336    4                      X$PARAM.TEXTC$(0)->X$STRING.SIZ+
     1567    15337    4                      X$PARAM.TEXTC$(1)->X$STRING.SIZ+12;
     1568    15338    4                 CALL CPE$LISTOUT (SEG$2.FPT_WRITECC$);
     1569    15339    4                 X$PARAM.NUM = X$PARAM.NUM + 1;
     1570    15340    4              END;
     1571    15341    3           END;
     1572    15342    2     TEMP$=PCB.OUT$->P$B.SUBLK$(0);
     1573    15343    2     IF TEMP$->P$B.CODE = BA_DELETE
     1574    15344    2        THEN
     1575    15345    3           DO;   /* Reset DEFAULT subs */
     1576    15346    3              IF TEMP$ -> P$B.NSUBLKS > 0
     1577    15347    4                 THEN DO;  /* delete the listed DEFAULT subs... */
     1578    15348    4                    X$PARAM.SYM_HEAD$ = SUB$PARAMS.DEFAULT_DEF_HEAD$;
     1579    15349    4                    X$PARAM.SRCH = 1;
     1580    15350    5                    DO NUM_OPTS = 0 TO TEMP$ -> P$B.NSUBLKS -1;
     1581    15351    5                       P$ = TEMP$ -> P$B.SUBLK$(NUM_OPTS);
     1582    15352    5                       X$PARAM.TYPE = P$ -> P$B.NDTYPE;
     1583    15353    5                       X$PARAM.TEXTC$(0) = P$ -> P$S.TEXTC$;
     1584    15354    5                       CALL CPH$SYM_DELETE (X$MCB,X$PARAM)
     1585    15355    6                       WHENRETURN DO;
     1586    15356    6                          SUB$PARAMS.DEFAULT_DEF_HEAD$ = X$PARAM.SYM_HEAD$;
     1587    15357    6                       END;
     1588    15358    6                       WHENALTRETURN DO;
     1589    15359    6                          CPOS = P$ -> P$S.CPOS;
     1590    15360    6                          CALL CXP$POSTERR (ADDR(SEG$2.ERRBUF),CPOS,E_MSDEFAULT);
     1591    15361    6                          CALL CONCAT (WRITEBUF,'     ',READBUF);
     1592    15362    6                          CALL STUFF_GETCMD_4_ERRPTR ;
     1593    15363    6                          SEG$2.FPT_WRITECC$->FPT$WRITE.BUF_.BOUND =
     1594    15364    6                              MINIMUM(LENGTHV(WRITEBUF),DCBADDR(M$IBEX_NUM) ->
     1595    15365    6                              F$DCB.ARS# + 4);
     1596    15366    6                          CALL CPE$DIAGOUT (SEG$2.FPT_WRITECC$);
     1597    15367    6                          GOTO ABORT ;
     1598    15368    6                       END;
     1599    15369    5                    END;   /* Reset DEFAULT subs */
     1600    15370    4                 END;  /* NSUBLKS > 0 */
     1601    15371    4                 ELSE DO;  /* delete all DEFAULT subs... */
     1602    15372    4                    X$PARAM.SYM_HEAD$ = SUB$PARAMS.DEFAULT_DEF_HEAD$;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:54   
     1603    15373    4                    X$PARAM.SRCH = 2;
     1604    15374    4                    CALL CPH$SYM_DELETE (X$MCB,X$PARAM);
     1605    15375    4                    SUB$PARAMS.DEFAULT_DEF_HEAD$ = ADDR(NIL);
     1606    15376    4                 END;
     1607    15377    3              RETURN;
     1608    15378    3           END;
     1609    15379        /*
     1610    15380             ***** add new DEFAULT subs...
     1611    15381        */
     1612    15382    2     X$PARAM.SYM_HEAD$=SUB$PARAMS.DEFAULT_DEF_HEAD$;
     1613    15383    2     X$PARAM.SRCH = 1;
     1614    15384    3     DO NUM_OPTS = 0 TO PCB.OUT$ -> P$B.NSUBLKS - 1;
     1615    15385    3        TEMP$=PCB.OUT$->P$B.SUBLK$(NUM_OPTS);
     1616    15386    3        X$PARAM.TEXTC$(0)=TEMP$->P$B.SUBLK$(0)->P$S.TEXTC$;
     1617    15387    4        DO CASE (TEMP$->P$B.SUBLK$(1)->P$S.CODE);
     1618    15388    4          CASE (DEFSTRING);
     1619    15389    4            X$PARAM.TEXTC$(1)=TEMP$->P$B.SUBLK$(1)->P$B.SUBLK$(0)->P$S.TEXTC$;
     1620    15390    4          CASE (DEFJOBFILE);
     1621    15391    4            FPT_UNFID = CFPT_UNFID;
     1622    15392    4            FPT_UNFID.V_ = VECTOR (FPT_UNFID.V);
     1623    15393    4            FPT_UNFID.TEXTFID_ = VECTOR (SUBSTR (TEMPBUF,1));
     1624    15394    4            FPT_UNFID.LEN_ = VECTOR (STR_INDX);
     1625    15395    4            FPT_UNFID.NAME_ = FPT_FID.NAME_;
     1626    15396    4            FPT_UNFID.ACCT_ = FPT_FID.ACCT_;
     1627    15397    4            FPT_UNFID.PASS_ = FPT_FID.PASS_;
     1628    15398    4            FPT_UNFID.SN_ =   FPT_FID.SN_;
     1629    15399    4            FPT_UNFID.WSN_ =  FPT_FID.WSN_;
     1630    15400    4            FPT_UNFID.ASN_ =  FPT_FID.ASN_;
     1631    15401    4            FPT_UNFID.RES_ =  FPT_FID.RES_;
     1632    15402    5            CALL M$UNFID (FPT_UNFID) WHENALTRETURN DO; END;
     1633    15403    4            SUBSTR (TEMPBUF, 0, 1) = BINASC (STR_INDX);
     1634    15404    4            X$PARAM.TEXTC$(1) = ADDR (TEMPBUF);
     1635    15405    4        END; /* DO CASE */
     1636    15406    3        X$PARAM.TYPE=TEMP$->P$B.SUBLK$(0)->P$S.NDTYPE;
     1637    15407    3        CALL CPH$SYM_PUT (X$MCB,X$PARAM);
     1638    15408    3        IF X$PARAM.ERR.CODE ~= 0
     1639    15409    3           THEN
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:55   
     1640    15410    4              DO;
     1641    15411    4                 CALL CPC$WRITEMSGE (X$PARAM.ERR,,X$PARAM.TEXTC$(0)
     1642    15412    4                       -> X$STRING.SIZ);
     1643    15413    4                 SUB$PARAMS.BATCH_ABORTED# = %YES#;
     1644    15414    4                 RETURN;   /* Don't process any more defaults */
     1645    15415    4              END;
     1646    15416    3           ELSE   /* No errors. Update DEFAULT_DEF_HEAD$ */
     1647    15417    3              SUB$PARAMS.DEFAULT_DEF_HEAD$ = X$PARAM.SYM_HEAD$;
     1648    15418    3     END;
     1649    15419    2     RETURN;
     1650    15420    2   SYM_ERR:
     1651    15421    2     RETURN;
     1652    15422        %EJECT;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:56   
     1653    15423    2   PROCESS_INCLUDE:
     1654    15424        /*
     1655    15425             ***** Save the RECORD_NUM and RECORD_KEY that the jcl
     1656    15426                   file is currently on ...
     1657    15427        */
     1658    15428    2     SAVE_NUM = SUB$PARAMS.REC_NUM;
     1659    15429    2     SAVE_SEED = FPT_READ.V.SEED#;
     1660    15430    2     FPT_READ.V.SEED# = '0'B;
     1661    15431        /*
     1662    15432             ***** Close the jcl file ...
     1663    15433        */
     1664    15434    2     FPT_CLOSE.V.DCB# = M$IBEX_NUM;
     1665    15435    2     FPT_CLOSE.V.DISP# = %SAVE#;
     1666    15436    2     CALL M$CLOSE (FPT_CLOSE) ALTRET(POST_ERR_AND_ABORT);
     1667    15437        /*
     1668    15438             ***** Open the INCLUDE file ...
     1669    15439        */
     1670    15440    2     FPT_OPEN.V.DCB# = M$IBEX_NUM;
     1671    15441    2     FPT_OPEN.V.FUN# = %IN#;
     1672    15442    2     CALL OPEN_FID (PCB.OUT$ -> P$B.SUBLK$(0)) ALTRET(E_OPEN);
     1673    15443    3     DO WHILE (%NO#);
     1674    15444    3   E_OPEN:
     1675    15445    3        CALL CONCAT (WRITEBUF,'     ',READBUF);
     1676    15446    3        IF B$JIT.PRFLAGS.POINT
     1677    15447    3         THEN
     1678    15448    4             DO ;
     1679    15449    4               SEG$2.FPT_WRITECC$->FPT$WRITE.BUF_.BOUND =
     1680    15450    4                     SUB$PARAMS.BUF_LEN + 5;
     1681    15451    4               CALL CPE$DIAGOUT (SEG$2.FPT_WRITECC$);
     1682    15452    4             END ; /* Then Do */
     1683    15453    3         CALL STUFF_GETCMD_4_ERRPTR ;
     1684    15454    3        CALL CPR$RPTERR (SEG$2.ERRBUF,6);
     1685    15455    3        SEG$2.ERRBUF(1) = 0;
     1686    15456    3        GOTO CLOSE_CMD_STREAM;
     1687    15457    3     END;   /* Do while ... end */
     1688    15458        /*
     1689    15459             Set a dot prompt if we're including ME.
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:57   
     1690    15460        */
     1691    15461    2     IF B$JIT.MODE = %M_INT# AND FPT_OPEN.V.ASN# = %DEVICE#
     1692    15462    2        THEN
     1693    15463    3           DO;
     1694    15464    4             CALL M$PROMPT (INCLUDE_PROMPT) WHENALTRETURN DO; END;
     1695    15465    3             SEG$2.GETCMD$->GET$CMD.WORK$->XUG$PARAMS.PROMPT = '@';
     1696    15466    3           END;
     1697    15467        /*
     1698    15468             ***** Copy the INCLUDE file to the jobstream ...
     1699    15469        */
     1700    15470    3     DO WHILE (%YES#);
     1701    15471    3        IF B$JIT.CPFLAGS1 & %CP_BRK#
     1702    15472    3           THEN
     1703    15473    3              CALL CHK_BREAK ALTRET(CLOSE_CMD_STREAM);
     1704    15474    3        READBUF = ' ';
     1705    15475    3        CALL M$READ (FPT_READ) ALTRET(E_READ);
     1706    15476    3        SUB$PARAMS.BUF_LEN = DCBADDR(M$IBEX_NUM) -> F$DCB.ARS# -1;
     1707    15477    3        CALL WRITE_BUF ALTRET(POST_ERR_AND_ABORT);
     1708    15478    3     END;
     1709    15479        /**/
     1710    15480    2   E_READ:
     1711    15481    2        IF B$TCB.ALT$ -> B$ALT.ERR.CODE ~= %E$EOF
     1712    15482    2           THEN   /* A real error */
     1713    15483    3              DO;
     1714    15484    3                 SUB$PARAMS.BATCH_ABORTED# = %YES#;
     1715    15485    3                 CALL CONCAT (WRITEBUF,'     ',READBUF);
     1716    15486    3                 SEG$2.FPT_WRITECC$->FPT$WRITE.BUF_.BOUND =
     1717    15487    3                       MINIMUM(LENGTHV(WRITEBUF),DCBADDR(M$IBEX_NUM) ->
     1718    15488    3                             F$DCB.ARS# + 4);
     1719    15489    3                 CALL CPE$DIAGOUT (SEG$2.FPT_WRITECC$);
     1720    15490    3                 IF B$TCB.ALT$ -> B$ALT.ERR.CODE = %E$LD
     1721    15491    3                    THEN
     1722    15492    3                       CALL CXP$POSTERR (ADDR(SEG$2.ERRBUF),511,E_TRUNREC);
     1723    15493    3                    ELSE
     1724    15494    3                       CALL CXP$POSTERR (ADDR(SEG$2.ERRBUF),511,
     1725    15495    3                             B$TCB.ALT$ -> B$ALT.ERR,B$TCB.ALT$ -> B$ALT.DCB#);
     1726    15496    3                 CALL CPR$RPTERR (SEG$2.ERRBUF,511);
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:58   
     1727    15497    3                 SEG$2.ERRBUF(1) = 0;   /* Throw away error */
     1728    15498    3              END;
     1729    15499        /*
     1730    15500             ***** Close the INCLUDE file ...
     1731    15501        */
     1732    15502    2   CLOSE_CMD_STREAM:
     1733    15503    2        IF DCBADDR(M$IBEX_NUM)  -> F$DCB.FCD#
     1734    15504    2           THEN   /* Close file */
     1735    15505    2              CALL M$CLOSE (FPT_CLOSE) ALTRET(POST_ERR_AND_ABORT);
     1736    15506        /*
     1737    15507             ***** Reopen the JCL file ...
     1738    15508        */
     1739    15509    2        FPT_READ.V.SEED# = SAVE_SEED;
     1740    15510    2        CALL OPEN_FID (JOB_FID$ -> P$B.SUBLK$(0)) ALTRET(ABORT);
     1741    15511        /*
     1742    15512             ***** Position to just past the !INCLUDE ...
     1743    15513        */
     1744    15514    2        FPT_PRECORD.V.KEYS# = %NO#;
     1745    15515    2        FPT_PRECORD.V.N# = SAVE_NUM;
     1746    15516    2        IF DCBADDR(M$IBEX_NUM) -> F$DCB.ASN# ~= %DEVICE#
     1747    15517    2           THEN  /* No precord needed for devices */
     1748    15518    2              CALL M$PRECORD (FPT_PRECORD) ALTRET(ABORT);
     1749    15519        /*
     1750    15520             ***** Get the record number back ...
     1751    15521        */
     1752    15522    2        SUB$PARAMS.REC_NUM = SAVE_NUM;
     1753    15523    2        RETURN;
     1754    15524        %EJECT;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:59   
     1755    15525    2   POST_ERR_AND_ABORT:
     1756    15526    2     CPOS = 511 ;
     1757    15527    2     CALL CXP$POSTERR(ADDR(SEG$2.ERRBUF),CPOS,B$TCB.ALT$->B$ALT.ERR,,
     1758    15528    2                       B$TCB.ALT$->B$ALT.DCB#) ;
     1759    15529
     1760    15530    2   ABORT:
     1761    15531    2     SUB$PARAMS.BATCH_ABORTED# = %YES#;
     1762    15532    2     CALL CPR$RPTERR (SEG$2.ERRBUF,6);
     1763    15533    2     SEG$2.ERRBUF(1) = 0;   /* Throw away error */
     1764    15534    2     RETURN;
     1765    15535    2   END PROCESS_DIRECTIVES;
     1766    15536        %EJECT;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:60   
     1767    15537        %EJECT;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:61   
     1768    15538        /****************************************************************/
     1769    15539        /*I*    NAME: WRITE_BUF
     1770    15540                PURPOSE: To do all writes to command streams or user
     1771    15541                         from a central place.
     1772    15542        */
     1773    15543        /***************************************************************/
     1774    15544    1   WRITE_BUF: PROC ALTRET;
     1775    15545    2     IF (SUB$PARAMS.PRINT_OPT#
     1776    15546    2     OR (SUB$PARAMS.SUB_MADE# AND SUB$PARAMS.TEST_OPT#))
     1777    15547    2     AND ECHO_FILE_OK#
     1778    15548    2        THEN
     1779    15549    3           DO;
     1780    15550    3              CALL CONCAT (WRITEBUF,'     ',READBUF);
     1781    15551    3              IF SUB$PARAMS.BUF_LEN+5 > %CPBUFFSIZE
     1782    15552    3                 THEN
     1783    15553    3                    SEG$2.FPT_WRITECC$->FPT$WRITE.BUF_.BOUND=%CPBUFFSIZE;
     1784    15554    3                 ELSE
     1785    15555    3                    SEG$2.FPT_WRITECC$->FPT$WRITE.BUF_.BOUND=SUB$PARAMS.BUF_LEN+5;
     1786    15556    3              CALL CPE$LISTOUT (SEG$2.FPT_WRITECC$);
     1787    15557    3           END;
     1788    15558    2     IF SUB$PARAMS.TEST_OPT#
     1789    15559    2     OR SUB$PARAMS.BATCH_ABORTED#
     1790    15560    2        THEN   /* Dont write to command stream */
     1791    15561    2           RETURN;
     1792    15562    2     IF SUB$PARAMS.BUF_LEN < 0
     1793    15563    2        THEN
     1794    15564    3           DO;
     1795    15565    3              FPT_WRITE.BUF_ = VECTOR(NIL);
     1796    15566    3              CALL M$WRITE (FPT_WRITE) ALTRET(ABORT);
     1797    15567    3              FPT_WRITE.BUF_ = VECTOR(READBUF);
     1798    15568    3           END;
     1799    15569    2        ELSE
     1800    15570    3           DO;
     1801    15571    3              FPT_WRITE.BUF_.BOUND = SUB$PARAMS.BUF_LEN;
     1802    15572    3              CALL M$WRITE (FPT_WRITE) ALTRET(ABORT);
     1803    15573    3           END;
     1804    15574        /**/
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:62   
     1805    15575    2     RETURN;
     1806    15576        /**/
     1807    15577    2   ABORT:
     1808    15578    2     ALTRETURN;
     1809    15579    2   END WRITE_BUF;
     1810    15580        %EJECT;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:63   
     1811    15581        /*****************************************************************/
     1812    15582        /*I*    NAME: CHK_BREAK
     1813    15583                PURPOSE: To handle break control from a central point
     1814    15584        */
     1815    15585        /****************************************************************/
     1816    15586    1   CHK_BREAK: PROC ALTRET;
     1817    15587    2     B$JIT.CPFLAGS1 = B$JIT.CPFLAGS1 & ~%CP_BRK#;   /* Reset it */
     1818    15588    2     KEY_BUF.COUNT = LENGTHC(KEY_BUF.TEXT);
     1819    15589    2     IF DCBADDR(M$IBEX_NUM) -> F$DCB.ORG# = %KEYED#
     1820    15590    2     AND FPT_READ.V.KEYR#
     1821    15591    2        THEN
     1822    15592    3           DO;   /* Write KEY */
     1823    15593    3              CALL BINCHAR (VALUE_BUF,READ_KEY.KEY);
     1824    15594    3              CALL EDITCHAR (KEY_BUF.TEXT,,,EDIT_MOPS,VALUE_BUF);
     1825    15595    3              KEY_BUF.COUNT = LENGTHC(KEY_BUF.TEXT);
     1826    15596    3              CALL X$STRIP_BLANKS (ADDR(KEY_BUF));
     1827    15597    3           END;
     1828    15598    2        ELSE
     1829    15599    3           DO;   /* Write RECORD NUMBER */
     1830    15600    3              CALL BINCHAR (KEY_BUF.TEXT,SUB$PARAMS.REC_NUM);
     1831    15601    3              CALL CPE$RZEROS (KEY_BUF.TEXT,LENGTHC(KEY_BUF.TEXT),VALUE);
     1832    15602    3              KEY_BUF.COUNT = VALUE;
     1833    15603    3           END;
     1834    15604    2     CALL CONCAT (WRITEBUF,'@ Break at ',
     1835    15605    2           SUBSTR(KEY_BUF.TEXT,0,KEY_BUF.COUNT),
     1836    15606    2           ' ''C'' to continue.');
     1837    15607    2     SEG$2.FPT_WRITEUC$ -> FPT$WRITE.BUF_ = VECTOR(WRITEBUF);
     1838    15608    2     SEG$2.FPT_WRITEUC$ -> FPT$WRITE.V.DVBYTE.VFC# = %YES#;
     1839    15609    2     SEG$2.FPT_WRITEUC$ -> FPT$WRITE.BUF_.BOUND = 28 + KEY_BUF.COUNT;
     1840    15610    2     CALL M$WRITE (SEG$2.FPT_WRITEUC$->FPT$WRITE) ALTRET(ABORT);
     1841    15611        /**/
     1842    15612    2     FPT_PROMPT = CFPT_PROMPT;
     1843    15613    2     FPT_PROMPT.V_ = VECTOR(FPT_PROMPT.V);
     1844    15614    2     FPT_PROMPT.V.DVBYTE#.VFC# = %YES#;
     1845    15615    2     FPT_PROMPT.PROMPT_ = VECTOR(SAME_LINE_VFC);
     1846    15616    2     CALL M$PROMPT (FPT_PROMPT) ALTRET(ABORT);
     1847    15617        /**/
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:64   
     1848    15618    2     SEG$2.FPT_READUC$ -> FPT$READ.BUF_ = VECTOR(TEMPBUF);
     1849    15619    2     CALL M$READ (SEG$2.FPT_READUC$ -> FPT$READ) ALTRET(ABORT);
     1850    15620        /**/
     1851    15621    2     SEG$2.GETCMD$->GET$CMD.ALWAYS_SET_PROMPT# = %YES#;
     1852    15622        /**/
     1853    15623    2     IF DCBADDR(M$UC_NUM) -> F$DCB.ARS# = 0
     1854    15624    2     OR (SUBSTR(TEMPBUF,0,1) ~= 'C'
     1855    15625    2     AND SUBSTR(TEMPBUF,0,1) ~= 'c')
     1856    15626    2        THEN   /* Abort the processing */
     1857    15627    3           DO;
     1858    15628    3              SUB$PARAMS.BATCH_ABORTED# = %YES#;
     1859    15629    3              ALTRETURN;
     1860    15630    3           END;
     1861    15631    2        ELSE
     1862    15632    2           RETURN;
     1863    15633        /**/
     1864    15634    2   ABORT:
     1865    15635    2        CALL CXP$POSTERR (ADDR(SEG$2.ERRBUF),511,B$TCB.ALT$ -> B$ALT.ERR,,
     1866    15636    2              B$TCB.ALT$ -> B$ALT.DCB#);
     1867    15637    2        SUB$PARAMS.BATCH_ABORTED# = %YES#;
     1868    15638    2        ALTRETURN;
     1869    15639    2   END CHK_BREAK;
     1870    15640        %EJECT;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:65   
     1871    15641        /*****************************************************************/
     1872    15642        /*I*    NAME: OPEN_FID
     1873    15643                PURPOSE: A textc version of a FID is passed. This fid
     1874    15644                         is run thru M$FID and the fields of FPT_OPEN
     1875    15645                         filled in.
     1876    15646        */
     1877    15647        /*****************************************************************/
     1878    15648    1   OPEN_FID: PROC (PTR$) ALTRET;
     1879    15649        /**/
     1880    15650    2   DCL PTR$ PTR;
     1881    15651        /**/
     1882    15652        /*
     1883    15653           *****   Break up the FID...
     1884    15654        */
     1885    15655    2     FID_ASN = %FILE#;   /* Default value */
     1886    15656    2     FID_RES = ' ';   /* Default value */
     1887    15657    2     FPT_FID = CFPT_FID;
     1888    15658    2     FPT_FID.TEXTFID_ = VECTOR(PTR$ -> P$S.TEXT);
     1889    15659    2     FPT_FID.NAME_ = VECTOR(FID_NAME);
     1890    15660    2     FPT_FID.ACCT_ = VECTOR(FID_ACCT);
     1891    15661    2     FPT_FID.PASS_ = VECTOR(FID_PASS);
     1892    15662    2     FPT_FID.SN_ = VECTOR(FID_SN);
     1893    15663    2     FPT_FID.WSN_ = VECTOR(FID_WSN);
     1894    15664    2     FPT_FID.ASN_ = VECTOR(FID_ASN);
     1895    15665    2     FPT_FID.RES_ = VECTOR(FID_RES);
     1896    15666    2     FPT_FID.RESULTS_ = VECTOR(FID_RESULTS);
     1897    15667    2     CALL M$FID(FPT_FID) ALTRET(E_OPEN);
     1898    15668        /*
     1899    15669             ***** Open the file...
     1900    15670        */
     1901    15671    2     IF FID_RESULTS.ACCT = %NO#
     1902    15672    3        THEN DO;  /* Default to current account */
     1903    15673    3           FPT_FID.ACCT_ = VECTOR (B$JIT.FACCN);
     1904    15674    3           IF FID_RESULTS.SN = %NO#
     1905    15675    4              THEN DO;
     1906    15676    4                 FID_SN.NUM# = 1;
     1907    15677    4                 FID_SN.SN#(0) = B$JIT.FPSN;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:66   
     1908    15678    4                 FPT_FID.SN_ = VECTOR(FID_SN);
     1909    15679    4                 END;
     1910    15680    3           END;
     1911    15681    2     FPT_OPEN.NAME_ = FPT_FID.NAME_;
     1912    15682    2     FPT_OPEN.ACCT_ = FPT_FID.ACCT_;
     1913    15683    2     FPT_OPEN.PASS_ = FPT_FID.PASS_;
     1914    15684    2     FPT_OPEN.SN_ = FPT_FID.SN_;
     1915    15685    2     FPT_OPEN.WSN_ = FPT_FID.WSN_;
     1916    15686    2     IF FID_RESULTS.RES
     1917    15687    2        THEN
     1918    15688    2           FPT_OPEN.V.RES#=FID_RES;
     1919    15689    2     IF FID_RESULTS.ASN
     1920    15690    2        THEN
     1921    15691    2           FPT_OPEN.V.ASN#=FID_ASN;
     1922    15692    2     FPT_OPEN.V.INITZ.SCRUB# = %YES#;
     1923    15693    2     CALL M$OPEN(FPT_OPEN) ALTRET(E_OPEN);
     1924    15694    2     RETURN;
     1925    15695        /**/
     1926    15696    2   E_OPEN:
     1927    15697    2     CPOS = PTR$ -> P$S.CPOS;
     1928    15698    2     CALL CXP$POSTERR (ADDR(SEG$2.ERRBUF),CPOS,B$TCB.ALT$ -> B$ALT.ERR,,
     1929    15699    2           B$TCB.ALT$ -> B$ALT.DCB#);
     1930    15700    2     SUB$PARAMS.BATCH_ABORTED# = %YES#;
     1931    15701    2     B$JIT.STEPCC = %CC_ERR# ;
     1932    15702    2     ALTRETURN;
     1933    15703    2   END OPEN_FID;
     1934    15704        %EJECT ;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:67   
     1935    15705        /*****************************************************************/
     1936    15706        /*I*    NAME: STUFF_GETCMD_4_ERRPTR
     1937    15707                PURPOSE: CXG$GETCMD is passed the text of the record just
     1938    15708                         read so that when CXG$ERRPTR is called the correct
     1939    15709                         input line will be ECHOed by CXG$ERRPTR.
     1940    15710        */
     1941    15711        /*****************************************************************/
     1942    15712    1   STUFF_GETCMD_4_ERRPTR:  PROC ;
     1943    15713
     1944    15714        /*
     1945    15715             ***** Stuff in GETCMD memory so that XUG$ERRPTR works meaningfully
     1946    15716        */
     1947    15717    2     SEG$2.GETCMD$ -> GET$CMD.TEXT_ = VECTOR(WRITEBUF);
     1948    15718    2     SEG$2.GETCMD$ -> GET$CMD.NODES$ = ADDR(NIL); /* inhibit parse */
     1949    15719    2     SEG$2.GETCMD$ -> GET$CMD.SKIP_PREPROCESS# = %YES#; /* inhibit preproc */
     1950    15720    2     CALL CXG$GETCMD (SEG$2.GETCMD$ -> GET$CMD)
     1951    15721    3             WHENALTRETURN DO;
     1952    15722                      /* guaranteed to altreturn (null root);  ignore */
     1953    15723    3             END;
     1954    15724    2     SEG$2.GETCMD$ -> GET$CMD.WORK$ -> XUG$PARAMS.POFF = 0;
     1955    15725    2     SEG$2.GETCMD$ -> GET$CMD.TEXT_ = VECTOR(NIL);
     1956    15726    2     RETURN ;
     1957    15727
     1958    15728    2   END   STUFF_GETCMD_4_ERRPTR ;
     1959    15729        %EJECT ;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:68   
     1960    15730    1   CHK_4_CROSS_ACCT_BATCH: PROC(BLK$);
     1961    15731
     1962    15732    2   DCL BLK$ PTR PARAM ;
     1963    15733    2   DCL I UBIN WORD ;
     1964    15734
     1965    15735    2     CROSS_ACCT_BATCH_FLG = %NO#;
     1966    15736    3     DO I=0 TO BLK$->P$B.NSUBLKS-1 ;
     1967    15737    3         IF BLK$->P$B.SUBLK$(I)->P$S.CODE = JOB_ACCTNAME
     1968    15738    3             THEN
     1969    15739    3               IF BLK$->P$B.SUBLK$(I)->P$B.SUBLK$(0)->P$S.TEXT ~= B$JIT.ACCN
     1970    15740    3                 OR BLK$->P$B.SUBLK$(I)->P$B.SUBLK$(1)->P$S.TEXT ~= B$JIT.UNAME
     1971    15741    3                 THEN
     1972    15742    3                   CROSS_ACCT_BATCH_FLG = %YES#;
     1973    15743    3     END;    /* Do I */
     1974    15744
     1975    15745    2     RETURN ;
     1976    15746    2   END   CHK_4_CROSS_ACCT_BATCH;
     1977    15747    1   END CPH$IBEX;

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:69   
--  Include file information  --

   CXG_ENTRY.:E05TOU  cannot be made into a system file and is referenced.
   XSJ_MAC_C.:E05TOU  is referenced.
   XSJ_SUBS_C.:E05TOU  is referenced.
   B$TABLES_C.:E05TOU  cannot be made into a system file and is referenced.
   XUH_MACRO_C.:E05TOU  is referenced.
   XU_SUBS_C.:E05TOU  is referenced.
   CP_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   XUM_MACRO_C.:E05TOU  is referenced.
   XU_PERR_C.:E05TOU  is referenced.
   XU_MACRO_C.:E05TOU  is referenced.
   CP_SUBS_C.:E05TOU  is referenced.
   CP_PERR_C.:E05TOU  is referenced.
   CP_MACROS_C.:E05TOU  is referenced.
   AS_SUPER_C.:E05TOU  is referenced.
   B_ERRORS_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   B_MICROPS_C.:E05TOU  is referenced.
   B_MACROS_C.:E05TOU  is referenced.
   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure CPH$IBEX.

   Procedure CPH$IBEX requires 3772 words for executable code.
   Procedure CPH$IBEX requires 1594 words of local(AUTO) storage.

    No errors detected in file CPH$IBEX.:E05TSI    .

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:70   

 Object Unit name= CPH$IBEX                                   File name= CPH$IBEX.:E05TOU
 UTS= JUL 29 '97 11:45:39.24 TUE                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   DCB   even  none     0      0  M$UC
    1  RoData even  UTS     79    117  CPH$IBEX
    2   Proc  even  none  3772   7274  CPH$IBEX
    3  RoData even  none    73    111  CPH$IBEX

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     2      0   yes    yes     yes      Std        1  CPH$IBEX
     2      3          yes     yes      Std        1  CPH$GLOBAL
     2     14          yes     yes      Std        1  CPH$BATXEQ
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:71   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes          ~proc      0 B_POINTER
 yes     yes           Std       2 CPH$SYM_PUT
 yes     yes           Std       0 CPA$GETRES
 yes     yes           Std       1 X$DEALLOCATE
         yes           Std       1 CPC$RELSEG
 yes     yes           Std       0 CPG$SET_WHEN_STATE
         yes           Std       1 CPH$STRING_SUB
         yes           Std       4 CPD$SET_NODES
         yes           Std       0 CPB$OPENCS
         yes           Std       1 CPD$SYNTRY
 yes     yes           Std       1 CPK$SUBMIT_CHECK
         yes           Std       1 CPH$CONTINUE
 yes     yes           Std       2 CXX$OCTBIN
 yes     yes           Std       2 CPC$RDUSERS
         yes           Std       6 CPC$WRITEMSGE
         yes           Std       5 CXP$POSTERR
         yes           Std       1 CPD$NULL_SFROUTINE
         yes           Std       2 CXX$VERIFY
         yes           Std       2 CPR$RPTERR
 yes     yes           Std       1 X$PARSE
 yes     yes           Std       1 CPE$DIAGOUT
 yes     yes           Std       1 XSJ$READ
 yes     yes           Std       1 XSJ$CLOSE
         yes           Std       1 CPC$RELDCB
         yes           Std       2 CPC$GETDCB
 yes     yes           Std       1 XSJ$OPEN
 yes     yes           Std       2 CPH$SYM_GET
 yes     yes           Std       2 CPH$SYM_DELETE
 yes     yes           Std       3 CPJ$WRITE_S
 yes     yes           Std       1 CPE$LISTOUT
 yes     yes           Std       1 CPC$OPEN_S
         yes           Std       2 CPC$SCREECH
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:72   
 yes     yes           Std       2 CPC$GETSEG
 yes     yes           Std       3 CPJ$READ_S
         yes           Std       1 X$STRIP_BLANKS
         yes           Std       3 CPE$RZEROS
 yes     yes           Std       1 CXG$GETCMD
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_AUTO_1
                       nStd      0 X66_ARET
                       nStd      0 X66_AALT

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     M$UC                                  CP$PCB                                CFPT_OPEN
     CFPT_CLOSE                            CFPT_READ                             CFPT_WRITE
     CFPT_PRECORD                          CFPT_DELREC                           CFPT_FID
     CFPT_UNFID                            CFPT_PROMPT                           CFPT_WAIT
r    SEG2$                            r    SEG3$                            r    B$PS0$
r    B$JIT$                           r    B$TCB$                                M$UC_NUM
     M$IBEX_NUM                            M$IBEX1_NUM                           M$IBEX2_NUM
     IBEX2TXTC                             K_GLOBAL                              CPSL_NODES
     IF_                                   IBEX_CMD                         r    B$SR_NON_BLANK$
r    B$XL_UPPER$                           B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     NULLSID                               ISSID                                 ROSID
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:73   


        1        1        /*M*    CPH$IBEX  implements BATCH, DEFAULT, GLOBAL, XEQand XMIT cmds */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X*    DMC,DFC */
        8        8        /*P*   NAME:   CPH$IBEX
        9        9               PURPOSE: To perform all the required operations in the execution
       10       10                       of BATCH, DEFAULT, GLOBAL and XEQ commands.
       11       11               DESCRIPTION:
       12       12               REFERENCE: Programmers Reference Manual
       13       13        */
       14       14        /**********************************************************************/
       15       15        CPH$IBEX:
       16       16          PROC(P$PCB)    ALTRET;

     16  2 000000   000000 700200 xent  CPH$IBEX     TSX0  ! X66_AUTO_1
         2 000001   003072 000001                    ZERO    1594,1
         2 000002   000005 710000 2                  TRA     s:14017

       17       17                   %INCLUDE CP_6;
       18       98                   %INCLUDE B$JIT;
       19      388                   %INCLUDE B_MACROS_C;
       20      499                   %INCLUDE B_MICROPS_C;
       21      671                   %INCLUDE CP_6_SUBS;
       22     1211                   %INCLUDE B_ERRORS_C;
       23     2338                   %INCLUDE AS_SUPER_C;
       24     2773                   %INCLUDE CP_MACROS_C;
       25     3525                   %INCLUDE CP_PERR_C;
       26     3863                   %INCLUDE CP_SUBS_C;
       27     4780                   %INCLUDE XU_MACRO_C;
       28     7886                   %INCLUDE XU_PERR_C;
       29     8077                   %INCLUDE XUM_MACRO_C;
       30     8104                   %INCLUDE CP_DATA_R;
       31    10667                   %INCLUDE XU_SUBS_C;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:74   
       32    10759                   %INCLUDE XUH_MACRO_C;
       33    10843                   %INCLUDE B$TABLES_C ;
       34    10951                   %INCLUDE XSJ_SUBS_C;
       35    10978                   %INCLUDE XSJ_MAC_C;
       36    11057        /***** vectors *****/
       37    11058          %VECTOR (NAME=SEG3_,STCLASS=AUTO);
       38    11068        /***** ptrs *****/
       39    11069    1     DCL JOB_FID$ PTR;
       40    11070    1     DCL TEMP$ PTR;
       41    11071    1     DCL P$ PTR;
       42    11072    1     DCL BLK$ PTR;
       43    11073        /***** external routines *****/
       44    11074    1     DCL CPA$GETRES ENTRY ALTRET;
       45    11075    1     DCL CPK$SUBMIT_CHECK ENTRY(1) ALTRET;
       46    11076    1     DCL CPB$OPENCS ENTRY;
       47    11077    1     DCL CPC$GETDCB ENTRY(2);
       48    11078    1     DCL CPC$GETSEG ENTRY(2) ALTRET;
       49    11079    1     DCL CPC$OPEN_LL ENTRY ;
       50    11080    1     DCL CPC$OPEN_S ENTRY(1) ALTRET;
       51    11081    1     DCL CPC$RELDCB ENTRY(1);
       52    11082    1     DCL CPC$RDUSERS ENTRY(2) ALTRET;
       53    11083    1     DCL CPC$RELSEG ENTRY(1);
       54    11084    1     DCL CPC$SCREECH ENTRY(2);
       55    11085    1     DCL CPC$WRITEMSGE ENTRY(6);
       56    11086    1     DCL CPD$SET_NODES ENTRY(4) ;
       57    11087    1     DCL CPD$NULL_SFROUTINE ENTRY(1) ;
       58    11088    1     DCL CPD$SYNTRY ENTRY(1);
       59    11089    1     DCL CPE$DIAGOUT ENTRY(1) ALTRET;
       60    11090    1     DCL CPE$LISTOUT ENTRY(1) ALTRET;
       61    11091    1     DCL CPE$RZEROS ENTRY(3);
       62    11092    1     DCL CPG$SET_WHEN_STATE ENTRY ALTRET;
       63    11093    1     DCL CPH$CONTINUE ENTRY(1);
       64    11094    1     DCL CPH$SYM_DELETE ENTRY(2) ALTRET;
       65    11095    1     DCL CPH$SYM_GET ENTRY(2) ALTRET;
       66    11096    1     DCL CPH$SYM_PUT ENTRY(2) ALTRET;
       67    11097    1     DCL CPH$STRING_SUB ENTRY(1);
       68    11098    1     DCL X$STRIP_BLANKS ENTRY(1);
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:75   
       69    11099    1     DCL CPJ$READ_S ENTRY(3) ALTRET;
       70    11100    1     DCL CPJ$WRITE_S ENTRY(3) ALTRET;
       71    11101    1     DCL CXP$POSTERR ENTRY(5);
       72    11102    1     DCL CXX$OCTBIN ENTRY(2) ALTRET;
       73    11103    1     DCL CXX$VERIFY ENTRY(2);
       74    11104    1     DCL CPR$RPTERR ENTRY(2);
       75    11105    1     DCL X$DEALLOCATE ENTRY(1) ALTRET;
       76    11106    1     DCL X$PARSE ENTRY(1) ALTRET;
       77    11107    1     DCL XSJ$OPEN ENTRY(1) ALTRET;
       78    11108    1     DCL XSJ$READ ENTRY(1) ALTRET;
       79    11109    1     DCL XSJ$CLOSE ENTRY(1) ALTRET;
       80    11110          %INCLUDE CXG_ENTRY;
       81    11122        /***** Constants *****/
       82    11123    1     DCL EDIT_MOPS (0:4) BIT(9) UNAL CONSTANT
       83    11124    1        INIT (%MVZB4, %MVC1, %SES10, %INSB7, %MVC3);
       84    11125          %XSJ_PARAM (FPTN = CXSJ_PARAM,
       85    11126                      STCLASS = CONSTANT,
       86    11127                      MODE = %IN#,
       87    11128                      TYPE = %TYP_NAME#,
       88    11129                      SHARE = %ALL#) ;
       89    11146        /***** symref variables *****/
       90    11147    1     DCL CPSL_NODES UBIN WORD SYMREF;
       91    11148    1     DCL IF_ UBIN WORD SYMREF;
       92    11149    1     DCL IBEX_CMD UBIN WORD SYMREF;
       93    11150        %B$SR_NON_BLANK;
       94    11154        %B$XL_UPPER;
       95    11158        /***** character strings *****/
       96    11159    1     DCL WRITEBUF CHAR(%CPBUFFSIZE) AUTO;
       97    11160    1     DCL TEMPBUF CHAR(%CPBUFFSIZE) AUTO;
       98    11161    1     DCL BLANKS CHAR(8) CONSTANT  INIT(' ');
       99    11162    1     DCL READBUF  CHAR(%CPBUFFSIZE) AUTO;
      100    11163    1     DCL READBUFB(0:%(CPBUFFSIZE/4-1)) REDEF READBUF BIT(36);
      101    11164    1     DCL END_LABEL CHAR(31) AUTO;
      102    11165    1     DCL START_LABEL CHAR(31) AUTO;
      103    11166    1     DCL FID_ASN UBIN(9);   /*Fid asn*/
      104    11167    1     DCL FID_RES CHAR(4);   /*Fid res*/
      105    11168    1     DCL VALUE_BUF CHAR(8) AUTO;   /* Only for CHARBIN/BINCHAR ops */
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:76   
      106    11169    1   DCL 1 FOL_NAME AUTO,
      107    11170    1         2 CNT UBIN BYTE UNAL,
      108    11171    1         2 NAME CHAR(31) CALIGNED;
      109    11172    1   DCL FOL_ACCT CHAR(8) AUTO ;
      110    11173        /***** word variables *****/
      111    11174    1     DCL END_METHOD UBIN WORD AUTO;
      112    11175    1     DCL END_NUM UBIN WORD AUTO;
      113    11176    1     DCL START_METHOD UBIN WORD AUTO;
      114    11177    1     DCL START_NUM UBIN WORD AUTO;
      115    11178    1     DCL VALUE SBIN WORD AUTO;   /* Only for CHARBIN/BINCHAR ops */
      116    11179    1     DCL SAVE_NUM UBIN WORD AUTO;   /* Only for !INCLUDE processing */
      117    11180    1     DCL SAVE_SEED BIT(36) AUTO;   /* Only for !INCLUDE processing */
      118    11181    1     DCL CPOS UBIN WORD AUTO;   /* Only for CXP$POSTERR charpos */
      119    11182    1     DCL START_INDX UBIN WORD AUTO;   /* Only for INDEX function */
      120    11183    1     DCL STR_INDX UBIN WORD AUTO;   /* Only for INDEX function */
      121    11184    1     DCL NUM_FILES UBIN WORD AUTO;   /* Loop counter */
      122    11185    1     DCL NUM_OPTS UBIN WORD AUTO;   /* Loop counter */
      123    11186    1     DCL X UBIN WORD AUTO;           /* Unused variable for SEARCH */
      124    11187        /***** bit flags *****/
      125    11188    1     DCL JOB_FLAG# BIT(1) AUTO;
      126    11189    1     DCL MATCHED_PAIR# BIT(1) AUTO;
      127    11190    1     DCL NSTATUS_OPT# BIT(1) AUTO;
      128    11191    1     DCL CROSS_ACCT_BATCH_FLG BIT(1) AUTO;
      129    11192    1     DCL SCAN_OPT# BIT(1) AUTO;
      130    11193    1     DCL ECHO_FILE_OK# BIT(1) AUTO;
      131    11194    1     DCL CALL_FLG# BIT(1) AUTO;
      132    11195    1     DCL TRUNCATED_RECORD BIT(1) AUTO ;
      133    11196    1   DCL IBEX_OPEN_2_JOBSTATS BIT(1) ;
      134    11197    1   DCL NEED_2_RELEASE_IBEX2 BIT(1) ;
      135    11198    1   DCL NEED_ALTRETURN BIT(1) ;
      136    11199    1   DCL ECHO_JOB_CMD BIT(1) ;
      137    11200        /***** fpts *****/
      138    11201          %FPT_READ (FPTN=FPT_READ,STCLASS=AUTO);
      139    11240          %FPT_READ (FPTN=FPT$READ,STCLASS=BASED);
      140    11279          %FPT_PROMPT (FPTN=FPT_PROMPT,STCLASS=AUTO);
      141    11307          %FPT_OPEN (FPTN=FPT_OPEN,STCLASS=AUTO);
      142    11416          %FPT_WRITE (FPTN=FPT_WRITE,STCLASS=AUTO);
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:77   
      143    11447          %FPT_WRITE (FPTN=FPT$WRITE,STCLASS=BASED);
      144    11478          %FPT_CLOSE (FPTN=FPT_CLOSE,STCLASS=AUTO);
      145    11520          %FPT_FID (FPTN=FPT_FID,STCLASS=AUTO);
      146    11543          %FPT_UNFID (FPTN=FPT_UNFID,STCLASS=AUTO);
      147    11561          %FPT_DELREC (FPTN=FPT_DELREC,STCLASS=AUTO);
      148    11580          %FPT_PRECORD (FPTN=FPT_PRECORD,STCLASS=AUTO);
      149    11601        %FPT_PROMPT (FPTN=INCLUDE_PROMPT, STCLASS=CONSTANT, PROMPT=DOT_PROMPT, VFC=YES);
      150    11629    1   DCL DOT_PROMPT CONSTANT CHAR(2) INIT(%CONCAT(BINASC(30), '.'));
      151    11630          %FPT_WAIT (FPTN=FPT_WAIT,STCLASS=AUTO);
      152    11644          %F$DCB (DCBN=F$DCB);
      153    11701          %VLR_FID (FPTN=FID_RESULTS,STCLASS=AUTO);
      154    11720          %VLP_NAME (FPTN=FID_NAME,LEN=31,STCLASS=AUTO);
      155    11747          %VLP_ACCT (FPTN=FID_ACCT,STCLASS=AUTO);
      156    11760          %VLP_PASS (FPTN=FID_PASS,STCLASS=AUTO);
      157    11773          %VLP_WSN (FPTN=FID_WSN,STCLASS=AUTO);
      158    11786          %VLP_SN (FPTN=FID_SN,N=3,STCLASS=AUTO);
      159    11799        %XUG_GETCMD (NAME=GET$CMD, STCLASS=BASED);
      160    12137        %XUG_PARAMS (NAME=XUG$PARAMS, STCLASS=BASED);
      161    12581          %XSJ_PARAM (FPTN=XSJ_PARAM,STCLASS=AUTO);
      162    12598    1     DCL 1 INIT_KEY CONSTANT,   /* FOR INIT'IN START & END KEY */
      163    12599    1           2 COUNT UBIN BYTE UNAL INIT (3),
      164    12600    1           2 KEY   UBIN (27) UNAL INIT (0);
      165    12601    1     DCL FKEY_ADJUST (0:3) SBIN CONSTANT /* for correcting frac. keys */
      166    12602    1       INIT (1000, 100, 10, 1);          /* based on their length */
      167    12603          %VLP_ERRCODE(FPTN=ERR,STCLASS=AUTO);
      168    12648        /***** Auto structures *****/
      169    12649    1     DCL   1  END_KEY AUTO,
      170    12650    1              2  COUNT UBIN BYTE UNAL,
      171    12651    1              2  KEY UBIN (27) UNAL;
      172    12652        /**/
      173    12653    1     DCL   1  READ_KEY AUTO,
      174    12654    1              2  COUNT UBIN BYTE UNAL,
      175    12655    1              2  KEY UBIN (27) UNAL;
      176    12656        /**/
      177    12657    1     DCL   1  START_KEY AUTO,
      178    12658    1              2  COUNT UBIN BYTE UNAL,
      179    12659    1              2  KEY UBIN (27) UNAL;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:78   
      180    12660        /**/
      181    12661    1     DCL   1  KEY_BUF AUTO,
      182    12662    1              2  COUNT UBIN BYTE UNAL,
      183    12663    1              2  TEXT CHAR(9);
      184    12664        /***** based structures *****/
      185    12665          %CP$COMVARS (NAME=CP$GLOBALS,STCLASS="BASED(SEG3$)");
      186    12673          %SEG$2;
      187    12733          %B$TCB (STCLASS="BASED(B$TCB$)");
      188    12736          %B$ALT;
      189    12744    1   DCL CHARN CHAR(4) BASED;
      190    12745        /***** Constant structures *****/
      191    12746    1     DCL   1  SAME_LINE_VFC CONSTANT,
      192    12747    1              2  VFC CHAR(1) INIT('@') UNAL;
      193    12748        /***** error codes *****/
      194    12749          %ERR_CODE (NAME=E_BDSCAN,MID#=CPH$IBEXMID,CODE#=E$BDSCAN,STCLASS=CONSTANT);
      195    12769          %ERR_CODE (NAME=E_NOSCAN,MID#=CPH$IBEXMID,CODE#=E$NOSCAN,STCLASS=CONSTANT);
      196    12789         %ERR_CODE (NAME=E_BDSTARTNUM,MID#=CPH$IBEXMID,CODE#=E$BDSTARTNUM,STCLASS=CONSTANT)
             12789              ;
      197    12809          %ERR_CODE (NAME=E_TRUNREC,MID#=CPH$IBEXMID,CODE#=E$TRUNREC,STCLASS=CONSTANT);
      198    12829          %ERR_CODE (NAME=E_MSGLOBAL,MID#=CPH$IBEXMID,CODE#=E$MSGLOBAL,STCLASS=CONSTANT);
      199    12849          %ERR_CODE (NAME=E_MSDEFAULT,MID#=CPH$IBEXMID,CODE#=E$MSDEFAULT,STCLASS=CONSTANT);
      200    12869        %ERR_CODE (NAME=E_CHKAP,MID#=CPB$IBEXMID,CODE#=E$CHKAP,STCLASS=CONSTANT);
      201    12889        %ERR_CODE (NAME=E_ILLXDEST,MID#=CPH$IBEXMID,CODE#=E$ILLXDEST,STCLASS=CONSTANT);
      202    12909        %VLP_ERRCODE (FPTN=E_BDSTARTENDTYPE,MID=H,ERR#=E$BDSTARTENDTYPE,FCG=CP,STCLASS=
             12909            CONSTANT);
      203    12954        /*E*    ERROR: CPH-E$ILLXDEST-0
      204    12955                MESSAGE: Illegal destination fid.
      205    12956                MESSAGE1: You do not have permission to write into that file.
      206    12957        */
      207    12958        %VLP_ERRCODE(FPTN=E_NONAME,FCG=CP,MID=H,ERR#=%E$NONAME,STCLASS=CONSTANT);
      208    13003        /*E* ERROR: CPH-E$NONAME
      209    13004             MESSAGE: The job this one is to follow does not exist.
      210    13005        */
      211    13006        %VLP_ERRCODE(FPTN=E_NONAME_4_CONT,FCG=CP,MID=H,ERR#=%E$NONAME_4_CONT,STCLASS=
             13006            CONSTANT);
      212    13051        /*E* ERROR: CPH-E$NONAME_4_CONT
      213    13052             MESSAGE: The job, %U1%.%U2%, this one is to follow does not exist.
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:79   
      214    13053        */
      215    13054        %VLP_ERRCODE(FPTN=E_NODCBS4FOLLOW,FCG=CP,MID=H,ERR#=%E$NODCBS4FOLLOW,STCLASS=
             13054            CONSTANT);
      216    13099        /*E* ERROR: CPH-E$NODCBS4FOLLOW
      217    13100             MESSAGE: Unable to get a DCB to test FOLLOW option.
      218    13101             MESSAGE1: IBEX continued without checking the existence of the job to FOLLOW.
      219    13102        */
      220    13103          %EJECT;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:80   
      221    13104        /***** symbol macros *****/
      222    13105          %XUM$MCB(NAME=X$MCB);
      223    13109          %CP$PARAM (NAME=X$PARAM,STCLASS=AUTO);
      224    13125          %TEXTC (NAME=X$STRING);
      225    13130          %XUM$MAP(NAME=X$MAP);
      226    13133        /***** parsing macros *****/
      227    13134          %PLIST;
      228    13135          %PARSE$OUT(NAME=P$B,STCLASS=BASED);
      229    13180          %PARSE$SYM(NAME=P$S,STCLASS=BASED);
      230    13218          %P$PCB(NAME=P$PCB,STCLASS="");
      231    13419          %P$PCB(NAME=PCB,STCLASS=AUTO);
      232    13620          %P$PCB(NAME=BASED$PCB,STCLASS=BASED) ;
      233    13821          %PARSE$OUT(NAME=FAKE_NODE,STCLASS=AUTO);
      234    13866          %PARSE$OUT(NAME=FAKE_NODE2,STCLASS=AUTO);
      235    13911          %PARSE$OUT(NAME=FAKE_NODE3,STCLASS=AUTO, /* Really PARSE$SYM, so ... */
      236    13912             SUBLK$="SUBLK$(0:2) PTR,2 *"); /* Add two words for sYsid */
      237    13957          %U$PARAM (NAME=U$PARAM,STCLASS=BASED);
      238    13973          %U$PARAM (NAME=U_PARAM,STCLASS=AUTO);
      239    13989    1   DCL SCAN_REMEM REMEMBER AUTO;
      240    13990    1   DCL WORKSPACE(0:999) UBIN WORD;   /* temporary parser workspace         */
      241    13991          %LIST;
      242    13992        /***** substitution macros *****/
      243    13993          %SUB$PARAMS;
             13994    1   DCL  1  NAME STCLASS ALIGNED,
             13995    1           2  ONLINE_DEF_HEAD$ PTR,        /* PTR to list of ONLINE subs         */
             13996    1           2  GLOBAL_DEF_HEAD$ PTR,        /* PTR to list of GLOBAL subs         */
             13997    1           2  PROMPT_DEF_HEAD$ PTR,        /* PTR to list of PROMPT subs         */
             13998    1           2  DEFAULT_DEF_HEAD$ PTR,       /* PTR to list of DEFAULT subs        */
             13999    1           2  READBUF$ PTR,                /* PTR to READBUF                     */
             14000    1           2  TEMPBUF$ PTR,                /* PTR to TEMPBUF                     */
             14001    1           2  WRITEBUF$ PTR,               /* PTR to WRITEBUF                    */
             14002    1           2  FPT_READ$ PTR,               /* FPT for reading JCL file           */
             14003    1           2  FPT_WRITE$ PTR,              /* FPT for writing CMD STREAM         */
             14004    1           2  X$MCB$ PTR,                  /* PTR to X$MCB for mem mgnt.         */
             14005    1           2  X$PARAM$ PTR,                /* PTR to X$PARAM for string mgnt.    */
             14006    1           2  BUF_LEN SBIN WORD,           /* LENGTHV of READBUF                 */
             14007    1           2  REC_NUM SBIN WORD,           /* Number of this record              */
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:81   
             14008    1           2  SUB_MADE# BIT(1) UNAL,       /* Was a substitution made?           */
             14009    1           2  PRINT_OPT# BIT(1) UNAL,      /* Was PRINT option specified?        */
             14010    1           2  TEST_OPT# BIT(1) UNAL,       /* Was TEST option specified?         */
             14011    1           2  BATCH_ABORTED# BIT(1) UNAL,  /* Has there been any errors?         */
             14012    1           2  NO_GLOBALS# BIT(1) UNAL;     /* Dont do any GLOBAL substitutions   */
      244    14014          %EJECT;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:82   
      245    14015    1   CPH$GLOBAL:
      246    14016    1     ENTRY(P$PCB) ALTRET;

  14016  2 000003   000000 700200 xent  CPH$GLOBAL   TSX0  ! X66_AUTO_1
         2 000004   003072 000001                    ZERO    1594,1

      247    14017    1     BLK$ = P$PCB.OUT$;

  14017  2 000005   200003 470500                    LDP0    @P$PCB,,AUTO
         2 000006   000003 236100                    LDQ     3,,PR0
         2 000007   200011 756100                    STQ     BLK$,,AUTO

      248    14018    1     CALL GLOBAL  ALTRET(ERR_RETURN);

  14018  2 000010   003734 701000 2                  TSX1    GLOBAL
         2 000011   000013 702000 2                  TSX2    ERR_RETURN

      249    14019    1     RETURN;

  14019  2 000012   000000 702200 xent               TSX2  ! X66_ARET

      250    14020    1   ERR_RETURN:
      251    14021    1     ALTRETURN;

  14021  2 000013   000000 702200 xent  ERR_RETURN   TSX2  ! X66_AALT

      252    14022          %EJECT;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:83   
      253    14023        /*****************************************************************/
      254    14024        /*F*       NAME:    CPH$BATXEQ
      255    14025         **
      256    14026                   PURPOSE:    Process the BATCH, XEQ and XMIT commands.
      257    14027         **
      258    14028                   DESCRIPTION:   The JCL file specified on the command line
      259    14029                            is opened and its records inserted into a BATCH
      260    14030                            COMMAND STREAM.  String and field substitution is
      261    14031                            performed on the records prior to insertion.
      262    14032         **
      263    14033                   REFERENCE:  Programming Reference Manual
      264    14034        */
      265    14035        /*****************************************************************/
      266    14036        /*
      267    14037             Dcb name        purpose
      268    14038             --------        -------
      269    14039              M$IBEX1           read *S file for global subs
      270    14040              M$IBEX1           also used to write to command stream
      271    14041              M$IBEX            read the jcl file
      272    14042        */
      273    14043    1   CPH$BATXEQ:
      274    14044    1     ENTRY(P$PCB)   ALTRET;

  14044  2 000014   000000 700200 xent  CPH$BATXEQ   TSX0  ! X66_AUTO_1
         2 000015   003072 000001                    ZERO    1594,1

      275    14045    1     BLK$ = P$PCB.OUT$;

  14045  2 000016   200003 470500                    LDP0    @P$PCB,,AUTO
         2 000017   000003 236100                    LDQ     3,,PR0
         2 000020   200011 756100                    STQ     BLK$,,AUTO

      276    14046    1     IF BLK$->P$B.CODE = XEQCMND AND B$JIT.CPFLAGS1.WHEN_INPUT

  14046  2 000021   200011 471500                    LDP1    BLK$,,AUTO
         2 000022   100000 720100                    LXL0    0,,PR1
         2 000023   000111 100003                    CMPX0   73,DU
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:84   
         2 000024   000035 601000 2                  TNZ     s:14053
         2 000025   000000 473400 xsym               LDP3    B$JIT$
         2 000026   300143 236100                    LDQ     99,,PR3
         2 000027   000400 316003                    CANQ    256,DU
         2 000030   000035 600000 2                  TZE     s:14053

      277    14047    1       THEN
      278    14048    2         CALL CPG$SET_WHEN_STATE WHENALTRETURN DO;

  14048  2 000031   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000032   000000 701000 xent               TSX1    CPG$SET_WHEN_STATE
         2 000033   000035 702000 2                  TSX2    s:14053
         2 000034   000035 710000 2                  TRA     s:14053

      279    14049    2                                       END;

      280    14050        /*
      281    14051             ***** Initialize ptrs and flags ...
      282    14052        */
      283    14053    1     JOB_FLAG# = %NO#;

  14053  2 000035   200365 450100                    STZ     JOB_FLAG#,,AUTO

      284    14054        /*
      285    14055             ***** Init fpts...
      286    14056        */
      287    14057        /* close */
      288    14058    1     FPT_CLOSE = CFPT_CLOSE;

  14058  2 000036   000100 100400                    MLR     fill='000'O
         2 000037   000000 000170 xsym               ADSC9   CFPT_CLOSE               cn=0,n=120
         2 000040   200540 000170                    ADSC9   FPT_CLOSE,,AUTO          cn=0,n=120

      289    14059    1     FPT_CLOSE.V_ = VECTOR(FPT_CLOSE.V);

  14059  2 000041   000000 235000 3                  LDA     0
         2 000042   203064 452500                    STP2    NEED_2_READ_JOBSTATS+6,,AUTO
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:85   
         2 000043   203064 236100                    LDQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 000044   000572 036003                    ADLQ    378,DU
         2 000045   200540 757100                    STAQ    FPT_CLOSE,,AUTO

      290    14060        /* open */
      291    14061    1     FPT_OPEN = CFPT_OPEN;

  14061  2 000046   000100 100400                    MLR     fill='000'O
         2 000047   000000 000350 xsym               ADSC9   CFPT_OPEN                cn=0,n=232
         2 000050   200432 000350                    ADSC9   FPT_OPEN,,AUTO           cn=0,n=232

      292    14062    1     FPT_OPEN.V_=VECTOR(FPT_OPEN.V);

  14062  2 000051   000001 235000 3                  LDA     1
         2 000052   203064 452500                    STP2    NEED_2_READ_JOBSTATS+6,,AUTO
         2 000053   203064 236100                    LDQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 000054   000476 036003                    ADLQ    318,DU
         2 000055   200432 757100                    STAQ    FPT_OPEN,,AUTO

      293    14063        /* write */
      294    14064    1     FPT_WRITE = CFPT_WRITE;

  14064  2 000056   000100 100400                    MLR     fill='000'O
         2 000057   000000 000060 xsym               ADSC9   CFPT_WRITE               cn=0,n=48
         2 000060   200524 000060                    ADSC9   FPT_WRITE,,AUTO          cn=0,n=48

      295    14065    1     FPT_WRITE.V_ = VECTOR(FPT_WRITE.V);

  14065  2 000061   000000 235000 3                  LDA     0
         2 000062   203064 452500                    STP2    NEED_2_READ_JOBSTATS+6,,AUTO
         2 000063   203064 236100                    LDQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 000064   000534 036003                    ADLQ    348,DU
         2 000065   200524 757100                    STAQ    FPT_WRITE,,AUTO

      296    14066    1     FPT_WRITE.V.DCB#=M$IBEX1_NUM;

  14066  2 000066   000000 720000 xsym               LXL0    M$IBEX1_NUM
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:86   
         2 000067   200534 740100                    STX0    FPT_WRITE+8,,AUTO

      297    14067    1     FPT_WRITE.BUF_=VECTOR(READBUF);

  14067  2 000070   000002 235000 3                  LDA     2
         2 000071   203064 452500                    STP2    NEED_2_READ_JOBSTATS+6,,AUTO
         2 000072   203064 236100                    LDQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 000073   000212 036003                    ADLQ    138,DU
         2 000074   200530 757100                    STAQ    FPT_WRITE+4,,AUTO

      298    14068        /* read */
      299    14069    1     FPT_READ = CFPT_READ;

  14069  2 000075   000100 100400                    MLR     fill='000'O
         2 000076   000000 000070 xsym               ADSC9   CFPT_READ                cn=0,n=56
         2 000077   200402 000070                    ADSC9   FPT_READ,,AUTO           cn=0,n=56

      300    14070    1     FPT_READ.V_ = VECTOR(FPT_READ.V);

  14070  2 000100   000003 235000 3                  LDA     3
         2 000101   203064 452500                    STP2    NEED_2_READ_JOBSTATS+6,,AUTO
         2 000102   203064 236100                    LDQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 000103   000412 036003                    ADLQ    266,DU
         2 000104   200402 757100                    STAQ    FPT_READ,,AUTO

      301    14071    1     FPT_READ.V.DCB# = M$IBEX_NUM;

  14071  2 000105   000000 721000 xsym               LXL1    M$IBEX_NUM
         2 000106   200412 741100                    STX1    FPT_READ+8,,AUTO

      302    14072    1     FPT_READ.KEY_ = VECTOR(READ_KEY);

  14072  2 000107   777640 235007                    LDA     -96,DL
         2 000110   203064 452500                    STP2    NEED_2_READ_JOBSTATS+6,,AUTO
         2 000111   203064 236100                    LDQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 000112   000756 036003                    ADLQ    494,DU
         2 000113   200404 757100                    STAQ    FPT_READ+2,,AUTO
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:87   

      303    14073    1     FPT_READ.BUF_ = VECTOR(READBUF);

  14073  2 000114   000002 235000 3                  LDA     2
         2 000115   203064 452500                    STP2    NEED_2_READ_JOBSTATS+6,,AUTO
         2 000116   203064 236100                    LDQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 000117   000212 036003                    ADLQ    138,DU
         2 000120   200406 757100                    STAQ    FPT_READ+4,,AUTO

      304    14074        /* precord */
      305    14075    1     FPT_PRECORD = CFPT_PRECORD;

  14075  2 000121   000100 100400                    MLR     fill='000'O
         2 000122   000000 000050 xsym               ADSC9   CFPT_PRECORD             cn=0,n=40
         2 000123   200666 000050                    ADSC9   FPT_PRECORD,,AUTO        cn=0,n=40

      306    14076    1     FPT_PRECORD.V_ = VECTOR(FPT_PRECORD.V);

  14076  2 000124   000000 235000 3                  LDA     0
         2 000125   203064 452500                    STP2    NEED_2_READ_JOBSTATS+6,,AUTO
         2 000126   203064 236100                    LDQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 000127   000674 036003                    ADLQ    444,DU
         2 000130   200666 757100                    STAQ    FPT_PRECORD,,AUTO

      307    14077    1     FPT_PRECORD.V.DCB# = M$IBEX_NUM;

  14077  2 000131   200674 741100                    STX1    FPT_PRECORD+6,,AUTO

      308    14078        /*FAKE_NODE */
      309    14079    1     FAKE_NODE.TEMP = %NO#;

  14079  2 000132   000031 236000 xsym               LDQ     B_VECTNIL+25
         2 000133   201021 356100                    ANSQ    FAKE_NODE,,AUTO

      310    14080        /*
      311    14081             ***** Initialize SUB$PARAMS
      312    14082                   necessary for continuation and string substitutions...
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:88   
      313    14083        */
      314    14084    1     SUB$PARAMS.READBUF$ = ADDR(READBUF);

  14084  2 000134   200212 630500                    EPPR0   READBUF,,AUTO
         2 000135   203036 450500                    STP0    SUB$PARAMS+4,,AUTO

      315    14085    1     SUB$PARAMS.TEMPBUF$ = ADDR(TEMPBUF);

  14085  2 000136   200112 631500                    EPPR1   TEMPBUF,,AUTO
         2 000137   203037 451500                    STP1    SUB$PARAMS+5,,AUTO

      316    14086    1     SUB$PARAMS.WRITEBUF$ = ADDR(WRITEBUF);

  14086  2 000140   200012 633500                    EPPR3   WRITEBUF,,AUTO
         2 000141   203040 453500                    STP3    SUB$PARAMS+6,,AUTO

      317    14087    1     SUB$PARAMS.FPT_READ$ = ADDR(FPT_READ);

  14087  2 000142   200402 634500                    EPPR4   FPT_READ,,AUTO
         2 000143   203041 454500                    STP4    SUB$PARAMS+7,,AUTO

      318    14088    1     SUB$PARAMS.FPT_WRITE$ = ADDR(FPT_WRITE);

  14088  2 000144   200524 635500                    EPPR5   FPT_WRITE,,AUTO
         2 000145   203042 455500                    STP5    SUB$PARAMS+8,,AUTO

      319    14089    1     SUB$PARAMS.X$MCB$ = ADDR(X$MCB);

  14089  2 000146   200763 636500                    EPPR6   X$MCB,,AUTO
         2 000147   203043 456500                    STP6    SUB$PARAMS+9,,AUTO

      320    14090    1     SUB$PARAMS.X$PARAM$ = ADDR(X$PARAM);

  14090  2 000150   200774 637500                    EPPR7   X$PARAM,,AUTO
         2 000151   203044 457500                    STP7    SUB$PARAMS+10,,AUTO

      321    14091        /*
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:89   
      322    14092             ***** Close M$IBEX if it is open...
      323    14093        */
      324    14094    1     IF DCBADDR(M$IBEX_NUM) -> F$DCB.FCD#

  14094  2 000152   000004 470400 3                  LDP0    4
         2 000153   000000 471500                    LDP1    0,,PR0
         2 000154   100000 470511                    LDP0    0,X1,PR1
         2 000155   000031 236100                    LDQ     25,,PR0
         2 000156   020000 316007                    CANQ    8192,DL
         2 000157   000167 600000 2                  TZE     GET_GLOBALS

      325    14095    1        THEN
      326    14096    2           DO;   /* Close M$IBEX */

      327    14097    2              FPT_CLOSE.V.DISP# = %SAVE#;

  14097  2 000160   000002 236007                    LDQ     2,DL
         2 000161   200572 552104                    STBQ    FPT_CLOSE+26,'04'O,AUTO

      328    14098    2              FPT_CLOSE.V.DCB# = M$IBEX_NUM;

  14098  2 000162   200572 741100                    STX1    FPT_CLOSE+26,,AUTO

      329    14099    2              CALL M$CLOSE (FPT_CLOSE) ALTRET(ABORT);

  14099  2 000163   200540 630500                    EPPR0   FPT_CLOSE,,AUTO
         2 000164   450001 713400                    CLIMB   alt,close
         2 000165   406000 401760                    pmme    nvectors=13
         2 000166   003262 702000 2                  TSX2    ABORT

      330    14100    2           END;

      331    14101        /*
      332    14102             ***** Read any global subs in from the *S file...
      333    14103        */
      334    14104    1   GET_GLOBALS:
      335    14105    1     CALL READ_GLOBALS ALTRET (REL_PAGES);
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:90   

  14105  2 000167   004555 701000 2     GET_GLOBALS  TSX1    READ_GLOBALS
         2 000170   003343 702000 2                  TSX2    E_CLOSE1

      336    14106        /*
      337    14107             ***** Once the global subs have been read
      338    14108                   from the *S file, it is no longer
      339    14109                   necessary to keep the *S file open...
      340    14110        */
      341    14111    1     FPT_CLOSE.V.DISP# = %SAVE#;

  14111  2 000171   000002 236007                    LDQ     2,DL
         2 000172   200572 552104                    STBQ    FPT_CLOSE+26,'04'O,AUTO

      342    14112    1     FPT_CLOSE.V.DCB# = M$IBEX1_NUM;

  14112  2 000173   000000 720000 xsym               LXL0    M$IBEX1_NUM
         2 000174   200572 740100                    STX0    FPT_CLOSE+26,,AUTO

      343    14113    1     CALL M$CLOSE (FPT_CLOSE) ALTRET (ABORT);

  14113  2 000175   200540 630500                    EPPR0   FPT_CLOSE,,AUTO
         2 000176   450001 713400                    CLIMB   alt,close
         2 000177   406000 401760                    pmme    nvectors=13
         2 000200   003262 702000 2                  TSX2    ABORT

      344    14114        /*
      345    14115             ***** Initialize the fpt thru which
      346    14116                   listings are to be written...
      347    14117        */
      348    14118    1     SEG$2.FPT_WRITECC$ -> FPT$WRITE.BUF_ = VECTOR(WRITEBUF);

  14118  2 000201   000000 470400 xsym               LDP0    SEG2$
         2 000202   000161 471500                    LDP1    113,,PR0
         2 000203   000002 235000 3                  LDA     2
         2 000204   203064 452500                    STP2    NEED_2_READ_JOBSTATS+6,,AUTO
         2 000205   203064 236100                    LDQ     NEED_2_READ_JOBSTATS+6,,AUTO
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:91   
         2 000206   000012 036003                    ADLQ    10,DU
         2 000207   100004 757100                    STAQ    4,,PR1

      349    14119        /*
      350    14120             ***** Initialize PCB...
      351    14121        */
      352    14122    1     PCB = CP$PCB;

  14122  2 000210   000100 100400                    MLR     fill='000'O
         2 000211   000000 000070 xsym               ADSC9   CP$PCB                   cn=0,n=56
         2 000212   201003 000070                    ADSC9   PCB,,AUTO                cn=0,n=56

      353    14123    1     PCB.WORK$ = ADDR (WORKSPACE);

  14123  2 000213   201062 631500                    EPPR1   WORKSPACE,,AUTO
         2 000214   201005 451500                    STP1    PCB+2,,AUTO

      354    14124    1     PCB.WKSZ = SIZEW (WORKSPACE);

  14124  2 000215   001750 220003                    LDX0    1000,DU
         2 000216   201010 740100                    STX0    PCB+5,,AUTO

      355    14125    1     PCB.TEXT$ = ADDR(READBUF);

  14125  2 000217   200212 633500                    EPPR3   READBUF,,AUTO
         2 000220   201003 453500                    STP3    PCB,,AUTO

      356    14126    1     U_PARAM = P$PCB.USER$ -> U$PARAM;

  14126  2 000221   200003 474500                    LDP4    @P$PCB,,AUTO
         2 000222   400014 475500                    LDP5    12,,PR4
         2 000223   000100 100500                    MLR     fill='000'O
         2 000224   500000 000100                    ADSC9   0,,PR5                   cn=0,n=64
         2 000225   201040 000100                    ADSC9   U_PARAM,,AUTO            cn=0,n=64

      357    14127    1     U_PARAM.CNTU$$ = ENTADDR(CPH$CONTINUE);

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:92   
  14127  2 000226   000000 636000 xent               EAQ     CPH$CONTINUE
         2 000227   201042 756100                    STQ     U_PARAM+2,,AUTO

      358    14128    1     U_PARAM.MODE = BATCHSCAN_MODE;

  14128  2 000230   002000 236003                    LDQ     1024,DU
         2 000231   201046 552140                    STBQ    U_PARAM+6,'40'O,AUTO

      359    14129    1     U_PARAM.PARAMS$ = ADDR(SUB$PARAMS);

  14129  2 000232   203032 635500                    EPPR5   SUB$PARAMS,,AUTO
         2 000233   201055 455500                    STP5    U_PARAM+13,,AUTO

      360    14130    1     U_PARAM.REMEM$ = ADDR(SCAN_REMEM);

  14130  2 000234   201060 636500                    EPPR6   SCAN_REMEM,,AUTO
         2 000235   201056 456500                    STP6    U_PARAM+14,,AUTO

      361    14131    1     REMEMBER WRITE IN SCAN_REMEM;

  14131  2 000236   002227 635000 2                  EAA     WRITE
         2 000237   201060 452500                    STP2    SCAN_REMEM,,AUTO
         2 000240   201061 755100                    STA     SCAN_REMEM+1,,AUTO

      362    14132    1     PCB.USER$ = ADDR(U_PARAM);

  14132  2 000241   201040 637500                    EPPR7   U_PARAM,,AUTO
         2 000242   201017 457500                    STP7    PCB+12,,AUTO

      363    14133        /*
      364    14134             ***** Main loop
      365    14135                   BATCH /XEQ / XMIT loops here once for each
      366    14136                   file specified on the command line ...
      367    14137        */
      368    14138    1     IF BLK$ -> P$B.CODE = XMITCMND

  14138  2 000243   200011 470500                    LDP0    BLK$,,AUTO
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:93   
         2 000244   000000 721100                    LXL1    0,,PR0
         2 000245   000112 101003                    CMPX1   74,DU
         2 000246   000252 601000 2                  TNZ     s:14142

      369    14139    1        THEN   /* Last blk is destination info. Surpress */
      370    14140    1           BLK$ -> P$B.NSUBLKS = BLK$ -> P$B.NSUBLKS - 1;

  14140  2 000247   000001 222100                    LDX2    1,,PR0
         2 000250   777777 623012                    EAX3    -1,X2
         2 000251   000001 743100                    STX3    1,,PR0

      371    14141        /**/
      372    14142    2     DO NUM_FILES = 0 TO BLK$ -> P$B.NSUBLKS - 1;

  14142  2 000252   200362 450100                    STZ     NUM_FILES,,AUTO
         2 000253   003253 710000 2                  TRA     s:14834+3

      373    14143        /*
      374    14144             ***** initialize for each file...
      375    14145        */
      376    14146    2        SUB$PARAMS.ONLINE_DEF_HEAD$ = ADDR(NIL);

  14146  2 000254   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 000255   203032 756100                    STQ     SUB$PARAMS,,AUTO

      377    14147    2        SUB$PARAMS.DEFAULT_DEF_HEAD$ = ADDR(NIL);

  14147  2 000256   203035 756100                    STQ     SUB$PARAMS+3,,AUTO

      378    14148    2        JOB_FLAG# = %NO#;

  14148  2 000257   200365 450100                    STZ     JOB_FLAG#,,AUTO

      379    14149    2        SCAN_OPT# = %NO#;

  14149  2 000260   200371 450100                    STZ     SCAN_OPT#,,AUTO

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:94   
      380    14150    2        NSTATUS_OPT# = %NO#;

  14150  2 000261   200367 450100                    STZ     NSTATUS_OPT#,,AUTO

      381    14151    2        CROSS_ACCT_BATCH_FLG = %NO#;

  14151  2 000262   200370 450100                    STZ     CROSS_ACCT_BATCH_FLG,,AUTO

      382    14152    2        FPT_READ.V.SEED# = '0'B;

  14152  2 000263   200414 450100                    STZ     FPT_READ+10,,AUTO

      383    14153    2        START_METHOD = 0;

  14153  2 000264   200352 450100                    STZ     START_METHOD,,AUTO

      384    14154    2        END_METHOD = 0;

  14154  2 000265   200350 450100                    STZ     END_METHOD,,AUTO

      385    14155    2        SUB$PARAMS.REC_NUM = 0;

  14155  2 000266   203046 450100                    STZ     SUB$PARAMS+12,,AUTO

      386    14156    2        SUB$PARAMS.TEST_OPT# = %NO#;

  14156  2 000267   000005 236000 3                  LDQ     5
         2 000270   203047 356100                    ANSQ    SUB$PARAMS+13,,AUTO

      387    14157    2        SUB$PARAMS.PRINT_OPT# = %NO#;

  14157  2 000271   000006 236000 3                  LDQ     6
         2 000272   203047 356100                    ANSQ    SUB$PARAMS+13,,AUTO

      388    14158    2        SUB$PARAMS.BATCH_ABORTED# = %NO#;

  14158  2 000273   000007 236000 3                  LDQ     7
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:95   
         2 000274   203047 356100                    ANSQ    SUB$PARAMS+13,,AUTO

      389    14159    2        SUB$PARAMS.NO_GLOBALS# = %NO#;

  14159  2 000275   000010 236000 3                  LDQ     8
         2 000276   203047 356100                    ANSQ    SUB$PARAMS+13,,AUTO

      390    14160    2        JOB_FID$ = BLK$ -> P$B.SUBLK$ (NUM_FILES);

  14160  2 000277   200011 470500                    LDP0    BLK$,,AUTO
         2 000300   200362 720100                    LXL0    NUM_FILES,,AUTO
         2 000301   000003 236110                    LDQ     3,X0,PR0
         2 000302   200006 756100                    STQ     JOB_FID$,,AUTO

      391    14161        /*
      392    14162             ***** Process the options...
      393    14163        */
      394    14164    2        X$PARAM.SYM_HEAD$=SUB$PARAMS.ONLINE_DEF_HEAD$;

  14164  2 000303   203032 236100                    LDQ     SUB$PARAMS,,AUTO
         2 000304   200774 756100                    STQ     X$PARAM,,AUTO

      395    14165    2        X$PARAM.SRCH = 1;

  14165  2 000305   001000 236003                    LDQ     512,DU
         2 000306   200776 552140                    STBQ    X$PARAM+2,'40'O,AUTO

      396    14166    3        DO NUM_OPTS = 0 TO JOB_FID$ -> P$B.NSUBLKS - 1;

  14166  2 000307   200363 450100                    STZ     NUM_OPTS,,AUTO
         2 000310   001034 710000 2                  TRA     s:14286+3

      397    14167    3           TEMP$ = JOB_FID$ -> P$B.SUBLK$(NUM_OPTS);

  14167  2 000311   200006 470500                    LDP0    JOB_FID$,,AUTO
         2 000312   200363 720100                    LXL0    NUM_OPTS,,AUTO
         2 000313   000003 236110                    LDQ     3,X0,PR0
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:96   
         2 000314   200007 756100                    STQ     TEMP$,,AUTO

      398    14168    4           DO CASE (TEMP$ -> P$B.CODE);

  14168  2 000315   200007 471500                    LDP1    TEMP$,,AUTO
         2 000316   100000 721100                    LXL1    0,,PR1
         2 000317   000023 101003                    CMPX1   19,DU
         2 000320   000322 602011 2                  TNC     s:14168+5,X1
         2 000321   000766 710000 2                  TRA     s:14270
         2 000322   000345 710000 2                  TRA     s:14170
         2 000323   000766 710000 2                  TRA     s:14270
         2 000324   000513 710000 2                  TRA     s:14204
         2 000325   000400 710000 2                  TRA     s:14178
         2 000326   000513 710000 2                  TRA     s:14204
         2 000327   000766 710000 2                  TRA     s:14270
         2 000330   000766 710000 2                  TRA     s:14270
         2 000331   000766 710000 2                  TRA     s:14270
         2 000332   000766 710000 2                  TRA     s:14270
         2 000333   000614 710000 2                  TRA     s:14227
         2 000334   000617 710000 2                  TRA     s:14229
         2 000335   000766 710000 2                  TRA     s:14270
         2 000336   000766 710000 2                  TRA     s:14270
         2 000337   000766 710000 2                  TRA     s:14270
         2 000340   000622 710000 2                  TRA     s:14231
         2 000341   000630 710000 2                  TRA     s:14235
         2 000342   000654 710000 2                  TRA     s:14242
         2 000343   000567 710000 2                  TRA     s:14221
         2 000344   000625 710000 2                  TRA     s:14233

      399    14169    4            CASE (BA_CRPT);

      400    14170    4              TEMP$ = TEMP$ -> P$B.SUBLK$(0);

  14170  2 000345   100003 236100                    LDQ     3,,PR1
         2 000346   200007 756100                    STQ     TEMP$,,AUTO

      401    14171    4              IF TEMP$ -> P$B.NDTYPE = %OCT#
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:97   

  14171  2 000347   200007 471500                    LDP1    TEMP$,,AUTO
         2 000350   100000 236100                    LDQ     0,,PR1
         2 000351   000077 376003                    ANQ     63,DU
         2 000352   000021 116003                    CMPQ    17,DU
         2 000353   000366 601000 2                  TNZ     s:14175

      402    14172    4                 THEN
      403    14173    4                    CALL CXX$OCTBIN (TEMP$ -> P$S.COUNT, FPT_READ.V.SEED#);

  14173  2 000354   200414 633500                    EPPR3   FPT_READ+10,,AUTO
         2 000355   203065 453500                    STP3    NEED_2_READ_JOBSTATS+7,,AUTO
         2 000356   200007 236100                    LDQ     TEMP$,,AUTO
         2 000357   000004 036003                    ADLQ    4,DU
         2 000360   203064 756100                    STQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 000361   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 000362   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000363   000000 701000 xent               TSX1    CXX$OCTBIN
         2 000364   000000 011000                    NOP     0
         2 000365   000766 710000 2                  TRA     s:14270

      404    14174    4                 ELSE
      405    14175    4                    SUBSTR (ADDR(FPT_READ.V.SEED#)->CHARN, 0,

  14175  2 000366   100004 236100                    LDQ     4,,PR1
         2 000367   000033 772000                    QRL     27
         2 000370   000000 621006                    EAX1    0,QL
         2 000371   100004 236100                    LDQ     4,,PR1
         2 000372   000033 772000                    QRL     27
         2 000373   000000 622006                    EAX2    0,QL
         2 000374   040140 100540                    MLR     fill='040'O
         2 000375   100004 200012                    ADSC9   4,,PR1                   cn=1,n=*X2
         2 000376   200414 000011                    ADSC9   FPT_READ+10,,AUTO        cn=0,n=*X1
         2 000377   000766 710000 2                  TRA     s:14270

      406    14176    4                      TEMP$->P$S.COUNT) = TEMP$->P$S.TEXT;
      407    14177    4            CASE (BA_END);
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:98   

      408    14178    4              END_METHOD = TEMP$ -> P$B.SUBLK$(0) -> P$B.CODE;

  14178  2 000400   100003 473500                    LDP3    3,,PR1
         2 000401   300000 236100                    LDQ     0,,PR3
         2 000402   777777 376007                    ANQ     -1,DL
         2 000403   200350 756100                    STQ     END_METHOD,,AUTO

      409    14179    5              DO CASE (END_METHOD);

  14179  2 000404   000007 136007                    SBLQ    7,DL
         2 000405   000005 116007                    CMPQ    5,DL
         2 000406   000410 602006 2                  TNC     s:14179+4,QL
         2 000407   000766 710000 2                  TRA     s:14270
         2 000410   000435 710000 2                  TRA     s:14187
         2 000411   000415 710000 2                  TRA     s:14181
         2 000412   000512 710000 2                  TRA     s:14201
         2 000413   000512 710000 2                  TRA     s:14201
         2 000414   000424 710000 2                  TRA     s:14183

      410    14180    5               CASE (BA_LABEL);

      411    14181    5                 END_LABEL = TEMP$ -> P$B.SUBLK$(0) -> P$S.TEXT;

  14181  2 000415   300004 236100                    LDQ     4,,PR3
         2 000416   000033 772000                    QRL     27
         2 000417   000000 622006                    EAX2    0,QL
         2 000420   040100 100540                    MLR     fill='040'O
         2 000421   300004 200012                    ADSC9   4,,PR3                   cn=1,n=*X2
         2 000422   200312 000037                    ADSC9   END_LABEL,,AUTO          cn=0,n=31
         2 000423   000766 710000 2                  TRA     s:14270

      412    14182    5               CASE (BA_NUM);

      413    14183    5                 CALL CHARBIN (END_NUM,TEMP$ -> P$B.SUBLK$(0)->

  14183  2 000424   300004 236100                    LDQ     4,,PR3
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:99   
         2 000425   000033 772000                    QRL     27
         2 000426   000000 622006                    EAX2    0,QL
         2 000427   000100 305540                    DTB
         2 000430   300004 230012                    NDSC9   4,,PR3                   cn=1,s=nosgn,sf=0,n=*X2
         2 000431   203064 000010                    NDSC9 NEED_2_READ_JOBSTATS+6,,AUTO cn=0,s=lsgnf,sf=0,n=8
         2 000432   203065 235100                    LDA     NEED_2_READ_JOBSTATS+7,,AUTO
         2 000433   200351 755100                    STA     END_NUM,,AUTO
         2 000434   000766 710000 2                  TRA     s:14270

      414    14184    5                      P$S.TEXT);
      415    14185    5               CASE (BA_KEY);

      416    14186                         /* Move TEMP$ to point to BA_KEY */
      417    14187    5                 TEMP$ = TEMP$ -> P$B.SUBLK$(0);

  14187  2 000435   100003 236100                    LDQ     3,,PR1
         2 000436   200007 756100                    STQ     TEMP$,,AUTO

      418    14188    5                 END_KEY = INIT_KEY;

  14188  2 000437   000027 236000 1                  LDQ     INIT_KEY
         2 000440   200755 756100                    STQ     END_KEY,,AUTO

      419    14189    5                 IF (TEMP$->P$B.SUBLK$(0)->P$S.CODE = BA_IKEY)

  14189  2 000441   200007 471500                    LDP1    TEMP$,,AUTO
         2 000442   100003 473500                    LDP3    3,,PR1
         2 000443   300000 721100                    LXL1    0,,PR3
         2 000444   000023 101003                    CMPX1   19,DU
         2 000445   000457 601000 2                  TNZ     s:14194

      420    14190    6                   THEN DO;  /* have the integer part */

      421    14191    6                     CALL CHARBIN (VALUE, TEMP$->P$B.SUBLK$(0)->P$S.TEXT);

  14191  2 000446   300004 236100                    LDQ     4,,PR3
         2 000447   000033 772000                    QRL     27
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:100  
         2 000450   000000 622006                    EAX2    0,QL
         2 000451   000100 305540                    DTB
         2 000452   300004 230012                    NDSC9   4,,PR3                   cn=1,s=nosgn,sf=0,n=*X2
         2 000453   200354 000004                    NDSC9   VALUE,,AUTO              cn=0,s=lsgnf,sf=0,n=4

      422    14192    6                     END_KEY.KEY = VALUE * 1000;   /* Edit keys */

  14192  2 000454   200354 236100                    LDQ     VALUE,,AUTO
         2 000455   001750 402007                    MPY     1000,DL
         2 000456   200755 552134                    STBQ    END_KEY,'34'O,AUTO

      423    14193    6                   END;

      424    14194    5                 TEMP$ = TEMP$->P$B.SUBLK$(TEMP$->P$B.NSUBLKS-1);  /* last node */

  14194  2 000457   100001 221100                    LDX1    1,,PR1
         2 000460   100002 236111                    LDQ     2,X1,PR1
         2 000461   200007 756100                    STQ     TEMP$,,AUTO

      425    14195    5                 IF (TEMP$->P$S.CODE = BA_FKEY)

  14195  2 000462   200007 471500                    LDP1    TEMP$,,AUTO
         2 000463   100000 721100                    LXL1    0,,PR1
         2 000464   000024 101003                    CMPX1   20,DU
         2 000465   000510 601000 2                  TNZ     s:14200

      426    14196    6                   THEN DO;  /* have the fractional part */

      427    14197    6                     CALL CHARBIN (VALUE, TEMP$->P$S.TEXT);

  14197  2 000466   100004 236100                    LDQ     4,,PR1
         2 000467   000033 772000                    QRL     27
         2 000470   000000 622006                    EAX2    0,QL
         2 000471   000100 305540                    DTB
         2 000472   100004 230012                    NDSC9   4,,PR1                   cn=1,s=nosgn,sf=0,n=*X2
         2 000473   200354 000004                    NDSC9   VALUE,,AUTO              cn=0,s=lsgnf,sf=0,n=4

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:101  
      428    14198    6                    END_KEY.KEY = END_KEY.KEY + (VALUE * FKEY_ADJUST(TEMP$->P$S.COUNT)
             14198                              );

  14198  2 000474   100004 236100                    LDQ     4,,PR1
         2 000475   000033 772000                    QRL     27
         2 000476   000000 621006                    EAX1    0,QL
         2 000477   200354 236100                    LDQ     VALUE,,AUTO
         2 000500   000030 402011 1                  MPY     FKEY_ADJUST,X1
         2 000501   203064 756100                    STQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 000502   200755 236100                    LDQ     END_KEY,,AUTO
         2 000503   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 000504   203065 756100                    STQ     NEED_2_READ_JOBSTATS+7,,AUTO
         2 000505   203064 236100                    LDQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 000506   203065 036100                    ADLQ    NEED_2_READ_JOBSTATS+7,,AUTO
         2 000507   200755 552134                    STBQ    END_KEY,'34'O,AUTO

      429    14199    6                   END;

      430    14200    5                 FPT_READ.V.KEYR# = %YES#;

  14200  2 000510   100000 236007                    LDQ     32768,DL
         2 000511   200412 256100                    ORSQ    FPT_READ+8,,AUTO

      431    14201    5               END;   /* End = ... */

  14201  2 000512   000766 710000 2                  TRA     s:14270

      432    14202    4            CASE (BA_FID, BA_DFID);

      433    14203            /* Open the JCL file */
      434    14204    4              FPT_OPEN.V.DCB# = M$IBEX_NUM;

  14204  2 000513   000000 722000 xsym               LXL2    M$IBEX_NUM
         2 000514   200476 742100                    STX2    FPT_OPEN+36,,AUTO

      435    14205    4              FPT_OPEN.V.FUN# = %IN#;

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:102  
  14205  2 000515   002000 236007                    LDQ     1024,DL
         2 000516   200477 552110                    STBQ    FPT_OPEN+37,'10'O,AUTO

      436    14206    4              FPT_OPEN.V.ORG# = %CONSEC#;

  14206  2 000517   001000 236007                    LDQ     512,DL
         2 000520   200500 552110                    STBQ    FPT_OPEN+38,'10'O,AUTO

      437    14207    4              FPT_OPEN.V.ACS# = %SEQUEN#;

  14207  2 000521   000001 236007                    LDQ     1,DL
         2 000522   200500 552104                    STBQ    FPT_OPEN+38,'04'O,AUTO

      438    14208    4              FPT_READ.V.KEYR# = %NO#;

  14208  2 000523   000011 236000 3                  LDQ     9
         2 000524   200412 356100                    ANSQ    FPT_READ+8,,AUTO

      439    14209    4              CALL OPEN_FID (TEMP$) ALTRET(DELETE_CMD_STREAM);

  14209  2 000525   200007 633500                    EPPR3   TEMP$,,AUTO
         2 000526   203053 453500                    STP3    I+1,,AUTO
         2 000527   006746 701000 2                  TSX1    OPEN_FID
         2 000530   002665 702000 2                  TSX2    DELETE_CMD_STREAM

      440    14210        /*
      441    14211             Set a dot prompt if we're XMITing ME.
      442    14212        */
      443    14213    4              IF B$JIT.MODE = %M_INT# AND FPT_OPEN.V.ASN# = %DEVICE#

  14213  2 000531   000000 470400 xsym               LDP0    B$JIT$
         2 000532   000000 236100                    LDQ     0,,PR0
         2 000533   740000 376003                    ANQ     -16384,DU
         2 000534   140000 116003                    CMPQ    49152,DU
         2 000535   000555 601000 2                  TNZ     s:14219
         2 000536   200477 236100                    LDQ     FPT_OPEN+37,,AUTO
         2 000537   000777 376007                    ANQ     511,DL
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:103  
         2 000540   000003 116007                    CMPQ    3,DL
         2 000541   000555 601000 2                  TNZ     s:14219

      444    14214    4                 THEN
      445    14215    5                    DO;

      446    14216    6                       CALL M$PROMPT (INCLUDE_PROMPT) WHENALTRETURN DO; END;

  14216  2 000542   000014 630400 1                  EPPR0   INCLUDE_PROMPT
         2 000543   560002 713400                    CLIMB   alt,+57346
         2 000544   401000 401760                    pmme    nvectors=3
         2 000545   000547 702000 2                  TSX2    s:14217
         2 000546   000547 710000 2                  TRA     s:14217

      447    14217    5                       SEG$2.GETCMD$->GET$CMD.WORK$->XUG$PARAMS.PROMPT = '@';

  14217  2 000547   000000 470400 xsym               LDP0    SEG2$
         2 000550   000173 471500                    LDP1    123,,PR0
         2 000551   100004 473500                    LDP3    4,,PR1
         2 000552   040100 100400                    MLR     fill='040'O
         2 000553   000012 000001 3                  ADSC9   10                       cn=0,n=1
         2 000554   300037 000136                    ADSC9   31,,PR3                  cn=0,n=94

      448    14218    5                    END;

      449    14219    4              ECHO_FILE_OK# = ~(DCBADDR(M$IBEX_NUM) -> F$DCB.FFLG.EXEC#);

  14219  2 000555   000004 470400 3                  LDP0    4
         2 000556   000000 471500                    LDP1    0,,PR0
         2 000557   000000 720000 xsym               LXL0    M$IBEX_NUM
         2 000560   100000 473510                    LDP3    0,X0,PR1
         2 000561   300004 236100                    LDQ     4,,PR3
         2 000562   000007 736000                    QLS     7
         2 000563   400000 376003                    ANQ     -131072,DU
         2 000564   400000 676003                    ERQ     -131072,DU
         2 000565   200372 756100                    STQ     ECHO_FILE_OK#,,AUTO
         2 000566   000766 710000 2                  TRA     s:14270
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:104  

      450    14220    4            CASE (BA_STRING);

      451    14221    4              X$PARAM.TEXTC$(0) = TEMP$->P$B.SUBLK$(0)->P$S.TEXTC$;

  14221  2 000567   100003 473500                    LDP3    3,,PR1
         2 000570   300003 236100                    LDQ     3,,PR3
         2 000571   200777 756100                    STQ     X$PARAM+3,,AUTO

      452    14222    4              X$PARAM.TEXTC$(1) = TEMP$->P$B.SUBLK$(1)->P$S.TEXTC$;

  14222  2 000572   100004 473500                    LDP3    4,,PR1
         2 000573   300003 236100                    LDQ     3,,PR3
         2 000574   201000 756100                    STQ     X$PARAM+4,,AUTO

      453    14223    4              X$PARAM.TYPE = TEMP$->P$B.SUBLK$(0)->P$S.NDTYPE;

  14223  2 000575   100003 473500                    LDP3    3,,PR1
         2 000576   300000 236100                    LDQ     0,,PR3
         2 000577   000077 376003                    ANQ     63,DU
         2 000600   200776 552120                    STBQ    X$PARAM+2,'20'O,AUTO

      454    14224    4              CALL CPH$SYM_PUT (X$MCB,X$PARAM) ALTRET(SYM_ERR);

  14224  2 000601   200774 633500                    EPPR3   X$PARAM,,AUTO
         2 000602   203065 453500                    STP3    NEED_2_READ_JOBSTATS+7,,AUTO
         2 000603   200763 634500                    EPPR4   X$MCB,,AUTO
         2 000604   203064 454500                    STP4    NEED_2_READ_JOBSTATS+6,,AUTO
         2 000605   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 000606   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000607   000000 701000 xent               TSX1    CPH$SYM_PUT
         2 000610   000767 702000 2                  TSX2    SYM_ERR

      455    14225    4              SUB$PARAMS.ONLINE_DEF_HEAD$ = X$PARAM.SYM_HEAD$;

  14225  2 000611   200774 236100                    LDQ     X$PARAM,,AUTO
         2 000612   203032 756100                    STQ     SUB$PARAMS,,AUTO
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:105  
         2 000613   000766 710000 2                  TRA     s:14270

      456    14226    4            CASE (BA_NGSUBS);

      457    14227    4              SUB$PARAMS.NO_GLOBALS# = %YES#;

  14227  2 000614   020000 236003                    LDQ     8192,DU
         2 000615   203047 256100                    ORSQ    SUB$PARAMS+13,,AUTO
         2 000616   000766 710000 2                  TRA     s:14270

      458    14228    4            CASE (BA_NSTATUS);

      459    14229    4              NSTATUS_OPT# = %YES#;

  14229  2 000617   400000 236003                    LDQ     -131072,DU
         2 000620   200367 756100                    STQ     NSTATUS_OPT#,,AUTO
         2 000621   000766 710000 2                  TRA     s:14270

      460    14230    4            CASE (BA_PRINT);

      461    14231    4              SUB$PARAMS.PRINT_OPT#=%YES#;

  14231  2 000622   200000 236003                    LDQ     65536,DU
         2 000623   203047 256100                    ORSQ    SUB$PARAMS+13,,AUTO
         2 000624   000766 710000 2                  TRA     s:14270

      462    14232    4            CASE (BA_TEST);

      463    14233    4              SUB$PARAMS.TEST_OPT#=%YES#;

  14233  2 000625   100000 236003                    LDQ     32768,DU
         2 000626   203047 256100                    ORSQ    SUB$PARAMS+13,,AUTO
         2 000627   000766 710000 2                  TRA     s:14270

      464    14234    4            CASE (BA_SCAN);

      465    14235    4              CALL CPA$GETRES ALTRET(SCAN_ERR);
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:106  

  14235  2 000630   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 000631   000000 701000 xent               TSX1    CPA$GETRES
         2 000632   001010 702000 2                  TSX2    SCAN_ERR

      466    14236    4              CALL CPC$RDUSERS (M$IBEX1_NUM,%IN#) ALTRET(SCAN_ERR);

  14236  2 000633   000013 630400 3                  EPPR0   11
         2 000634   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 000635   000000 701000 xent               TSX1    CPC$RDUSERS
         2 000636   001010 702000 2                  TSX2    SCAN_ERR

      467    14237    4              PCB.USER$ -> U$PARAM.PSEUDO$ = SEG$2.PSEUDO$;

  14237  2 000637   000000 470400 xsym               LDP0    SEG2$
         2 000640   000154 236100                    LDQ     108,,PR0
         2 000641   201017 471500                    LDP1    PCB+12,,AUTO
         2 000642   100004 756100                    STQ     4,,PR1

      468    14238    4              PCB.USER$ -> U$PARAM.PHYS$ = SEG$2.PHYS$;

  14238  2 000643   000155 236100                    LDQ     109,,PR0
         2 000644   201017 471500                    LDP1    PCB+12,,AUTO
         2 000645   100005 756100                    STQ     5,,PR1

      469    14239    4              PCB.USER$ -> U$PARAM.USERS$ = SEG$2.USERS$;

  14239  2 000646   000152 236100                    LDQ     106,,PR0
         2 000647   201017 471500                    LDP1    PCB+12,,AUTO
         2 000650   100001 756100                    STQ     1,,PR1

      470    14240    4              SCAN_OPT#=%YES#;

  14240  2 000651   400000 236003                    LDQ     -131072,DU
         2 000652   200371 756100                    STQ     SCAN_OPT#,,AUTO
         2 000653   000766 710000 2                  TRA     s:14270

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:107  
      471    14241    4            CASE (BA_START);

      472    14242    4              START_METHOD = TEMP$ -> P$B.SUBLK$(0) -> P$S.CODE;

  14242  2 000654   100003 473500                    LDP3    3,,PR1
         2 000655   300000 236100                    LDQ     0,,PR3
         2 000656   777777 376007                    ANQ     -1,DL
         2 000657   200352 756100                    STQ     START_METHOD,,AUTO

      473    14243    5              DO CASE (START_METHOD);

  14243  2 000660   000007 136007                    SBLQ    7,DL
         2 000661   000005 116007                    CMPQ    5,DL
         2 000662   000664 602006 2                  TNC     s:14243+4,QL
         2 000663   000766 710000 2                  TRA     s:14270
         2 000664   000711 710000 2                  TRA     s:14251
         2 000665   000671 710000 2                  TRA     s:14245
         2 000666   000766 710000 2                  TRA     s:14270
         2 000667   000766 710000 2                  TRA     s:14270
         2 000670   000700 710000 2                  TRA     s:14247

      474    14244    5               CASE (BA_LABEL);

      475    14245    5                 START_LABEL = TEMP$ -> P$B.SUBLK$(0) -> P$S.TEXT;

  14245  2 000671   300004 236100                    LDQ     4,,PR3
         2 000672   000033 772000                    QRL     27
         2 000673   000000 622006                    EAX2    0,QL
         2 000674   040100 100540                    MLR     fill='040'O
         2 000675   300004 200012                    ADSC9   4,,PR3                   cn=1,n=*X2
         2 000676   200322 000037                    ADSC9   START_LABEL,,AUTO        cn=0,n=31
         2 000677   000766 710000 2                  TRA     s:14270

      476    14246    5               CASE (BA_NUM);

      477    14247    5                 CALL CHARBIN (START_NUM,TEMP$ -> P$B.SUBLK$(0)->

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:108  
  14247  2 000700   300004 236100                    LDQ     4,,PR3
         2 000701   000033 772000                    QRL     27
         2 000702   000000 622006                    EAX2    0,QL
         2 000703   000100 305540                    DTB
         2 000704   300004 230012                    NDSC9   4,,PR3                   cn=1,s=nosgn,sf=0,n=*X2
         2 000705   203064 000010                    NDSC9 NEED_2_READ_JOBSTATS+6,,AUTO cn=0,s=lsgnf,sf=0,n=8
         2 000706   203065 235100                    LDA     NEED_2_READ_JOBSTATS+7,,AUTO
         2 000707   200353 755100                    STA     START_NUM,,AUTO
         2 000710   000766 710000 2                  TRA     s:14270

      478    14248    5                      P$S.TEXT);
      479    14249    5               CASE (BA_KEY);

      480    14250                         /* Move TEMP$ to point to BA_KEY */
      481    14251    5                 TEMP$ = TEMP$ -> P$B.SUBLK$(0);

  14251  2 000711   100003 236100                    LDQ     3,,PR1
         2 000712   200007 756100                    STQ     TEMP$,,AUTO

      482    14252    5                 START_KEY = INIT_KEY;

  14252  2 000713   000027 236000 1                  LDQ     INIT_KEY
         2 000714   200757 756100                    STQ     START_KEY,,AUTO

      483    14253    5                 IF (TEMP$->P$B.SUBLK$(0)->P$S.CODE = BA_IKEY)

  14253  2 000715   200007 471500                    LDP1    TEMP$,,AUTO
         2 000716   100003 473500                    LDP3    3,,PR1
         2 000717   300000 721100                    LXL1    0,,PR3
         2 000720   000023 101003                    CMPX1   19,DU
         2 000721   000733 601000 2                  TNZ     s:14258

      484    14254    6                   THEN DO;  /* have the integer part */

      485    14255    6                     CALL CHARBIN (VALUE, TEMP$->P$B.SUBLK$(0)->P$S.TEXT);

  14255  2 000722   300004 236100                    LDQ     4,,PR3
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:109  
         2 000723   000033 772000                    QRL     27
         2 000724   000000 622006                    EAX2    0,QL
         2 000725   000100 305540                    DTB
         2 000726   300004 230012                    NDSC9   4,,PR3                   cn=1,s=nosgn,sf=0,n=*X2
         2 000727   200354 000004                    NDSC9   VALUE,,AUTO              cn=0,s=lsgnf,sf=0,n=4

      486    14256    6                     START_KEY.KEY = VALUE * 1000;   /* Edit keys */

  14256  2 000730   200354 236100                    LDQ     VALUE,,AUTO
         2 000731   001750 402007                    MPY     1000,DL
         2 000732   200757 552134                    STBQ    START_KEY,'34'O,AUTO

      487    14257    6                   END;

      488    14258    5                 TEMP$ = TEMP$->P$B.SUBLK$(TEMP$->P$B.NSUBLKS-1);  /* last node */

  14258  2 000733   100001 221100                    LDX1    1,,PR1
         2 000734   100002 236111                    LDQ     2,X1,PR1
         2 000735   200007 756100                    STQ     TEMP$,,AUTO

      489    14259    5                 IF (TEMP$->P$S.CODE = BA_FKEY)

  14259  2 000736   200007 471500                    LDP1    TEMP$,,AUTO
         2 000737   100000 721100                    LXL1    0,,PR1
         2 000740   000024 101003                    CMPX1   20,DU
         2 000741   000764 601000 2                  TNZ     s:14264

      490    14260    6                   THEN DO;  /* have the fractional part */

      491    14261    6                     CALL CHARBIN (VALUE, TEMP$->P$S.TEXT);

  14261  2 000742   100004 236100                    LDQ     4,,PR1
         2 000743   000033 772000                    QRL     27
         2 000744   000000 622006                    EAX2    0,QL
         2 000745   000100 305540                    DTB
         2 000746   100004 230012                    NDSC9   4,,PR1                   cn=1,s=nosgn,sf=0,n=*X2
         2 000747   200354 000004                    NDSC9   VALUE,,AUTO              cn=0,s=lsgnf,sf=0,n=4
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:110  

      492    14262    6                     START_KEY.KEY = START_KEY.KEY + (VALUE * FKEY_ADJUST(TEMP$->P$S.
             14262                              COUNT));

  14262  2 000750   100004 236100                    LDQ     4,,PR1
         2 000751   000033 772000                    QRL     27
         2 000752   000000 621006                    EAX1    0,QL
         2 000753   200354 236100                    LDQ     VALUE,,AUTO
         2 000754   000030 402011 1                  MPY     FKEY_ADJUST,X1
         2 000755   203064 756100                    STQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 000756   200757 236100                    LDQ     START_KEY,,AUTO
         2 000757   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 000760   203065 756100                    STQ     NEED_2_READ_JOBSTATS+7,,AUTO
         2 000761   203064 236100                    LDQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 000762   203065 036100                    ADLQ    NEED_2_READ_JOBSTATS+7,,AUTO
         2 000763   200757 552134                    STBQ    START_KEY,'34'O,AUTO

      493    14263    6                   END;

      494    14264    5                 FPT_READ.V.KEYR# = %YES#;

  14264  2 000764   100000 236007                    LDQ     32768,DL
         2 000765   200412 256100                    ORSQ    FPT_READ+8,,AUTO

      495    14265    5               END;   /* Start = ... */

      496    14266    4            END;   /* Do case (options) end */

      497    14267        /*
      498    14268             ***** Write CPH$SYM_PUT err msg ...
      499    14269        */
      500    14270    4           DO WHILE (%NO#);

  14270  2 000766   001007 710000 2                  TRA     s:14275

      501    14271    4   SYM_ERR:
      502    14272    4              CPOS = TEMP$ -> P$S.CPOS;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:111  

  14272  2 000767   200007 470500       SYM_ERR      LDP0    TEMP$,,AUTO
         2 000770   000002 235100                    LDA     2,,PR0
         2 000771   200357 755100                    STA     CPOS,,AUTO

      503    14273    4              CALL CXP$POSTERR (ADDR(SEG$2.ERRBUF),CPOS,X$PARAM.ERR);

  14273  2 000772   000000 236000 xsym               LDQ     SEG2$
         2 000773   000003 036003                    ADLQ    3,DU
         2 000774   203064 756100                    STQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 000775   201001 631500                    EPPR1   X$PARAM+5,,AUTO
         2 000776   203067 451500                    STP1    NEED_2_READ_JOBSTATS+9,,AUTO
         2 000777   200357 633500                    EPPR3   CPOS,,AUTO
         2 001000   203066 453500                    STP3    NEED_2_READ_JOBSTATS+8,,AUTO
         2 001001   203064 634500                    EPPR4   NEED_2_READ_JOBSTATS+6,,AUTO
         2 001002   203065 454500                    STP4    NEED_2_READ_JOBSTATS+7,,AUTO
         2 001003   203065 630500                    EPPR0   NEED_2_READ_JOBSTATS+7,,AUTO
         2 001004   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 001005   000000 701000 xent               TSX1    CXP$POSTERR
         2 001006   000000 011000                    NOP     0

      504    14274    4           END;

      505    14275    4           DO WHILE (%NO#);

  14275  2 001007   001031 710000 2                  TRA     s:14286

      506    14276    4   SCAN_ERR:
      507    14277    4              IF B$JIT.USRERR.CODE ~= 0

  14277  2 001010   000000 470400 xsym  SCAN_ERR     LDP0    B$JIT$
         2 001011   000144 236100                    LDQ     100,,PR0
         2 001012   377770 316007                    CANQ    131064,DL
         2 001013   001023 600000 2                  TZE     s:14280

      508    14278    4                 THEN
      509    14279    4                    CALL CPC$WRITEMSGE (B$JIT.USRERR);
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:112  

  14279  2 001014   000000 236000 xsym               LDQ     B$JIT$
         2 001015   000144 036003                    ADLQ    100,DU
         2 001016   203064 756100                    STQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 001017   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 001020   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001021   000000 701000 xent               TSX1    CPC$WRITEMSGE
         2 001022   000000 011000                    NOP     0

      510    14280    4              CALL CPC$WRITEMSGE (E_NOSCAN);

  14280  2 001023   000015 630400 3                  EPPR0   13
         2 001024   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001025   000000 701000 xent               TSX1    CPC$WRITEMSGE
         2 001026   000000 011000                    NOP     0

      511    14281    4              SEG$2.ERRBUF(1) = 0;   /* Throw away error */

  14281  2 001027   000000 470400 xsym               LDP0    SEG2$
         2 001030   000004 450100                    STZ     4,,PR0

      512    14282    4           END;

      513    14283        /*E*    ERROR: CPH-E$NOSCAN-C
      514    14284                MESSAGE: SCAN option ignored. JIT.ERR follows.
      515    14285        */
      516    14286    3        END;   /* Do NUM_OPTS ... end */

  14286  2 001031   200363 235100                    LDA     NUM_OPTS,,AUTO
         2 001032   000001 035007                    ADLA    1,DL
         2 001033   200363 755100                    STA     NUM_OPTS,,AUTO
         2 001034   200006 470500                    LDP0    JOB_FID$,,AUTO
         2 001035   000001 236100                    LDQ     1,,PR0
         2 001036   000022 772000                    QRL     18
         2 001037   200363 116100                    CMPQ    NUM_OPTS,,AUTO
         2 001040   001042 600000 2                  TZE     s:14292
         2 001041   000311 603000 2                  TRC     s:14167
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:113  

      517    14287        /*
      518    14288             ***** Start = label
      519    14289                   start = key.xxx
      520    14290                   start = rec_num
      521    14291        */
      522    14292    2        SUB$PARAMS.REC_NUM = 0;

  14292  2 001042   203046 450100                    STZ     SUB$PARAMS+12,,AUTO

      523    14293    2   START_READ:
      524    14294    2        READBUF = ' ';

  14294  2 001043   040100 100400       START_READ   MLR     fill='040'O
         2 001044   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 001045   200212 000400                    ADSC9   READBUF,,AUTO            cn=0,n=256

      525    14295    2        TRUNCATED_RECORD = %NO#;

  14295  2 001046   200374 450100                    STZ     TRUNCATED_RECORD,,AUTO

      526    14296    3        CALL M$READ (FPT_READ) WHENALTRETURN DO ;

  14296  2 001047   200402 630500                    EPPR0   FPT_READ,,AUTO
         2 001050   440000 713400                    CLIMB   alt,read
         2 001051   401400 401760                    pmme    nvectors=4
         2 001052   001054 702000 2                  TSX2    s:14297
         2 001053   001065 710000 2                  TRA     s:14303

      527    14297    3                              IF B$TCB.ALT$->B$ALT.ERR.CODE = %E$LD

  14297  2 001054   000000 470400 xsym               LDP0    B$TCB$
         2 001055   000000 471500                    LDP1    0,,PR0
         2 001056   100102 236100                    LDQ     66,,PR1
         2 001057   377770 376007                    ANQ     131064,DL
         2 001060   000070 116007                    CMPQ    56,DL
         2 001061   002541 601000 2                  TNZ     E_READ
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:114  

      528    14298    3                                 THEN
      529    14299    3                                    TRUNCATED_RECORD = %YES#;

  14299  2 001062   400000 236003                    LDQ     -131072,DU
         2 001063   200374 756100                    STQ     TRUNCATED_RECORD,,AUTO
         2 001064   001065 710000 2                  TRA     s:14303

      530    14300    3                                 ELSE
      531    14301    3                                    GOTO E_READ;
      532    14302    3                            END ; /* Whenaltreturn Do */
      533    14303    2        SUB$PARAMS.BUF_LEN = DCBADDR(M$IBEX_NUM) -> F$DCB.ARS# -1;

  14303  2 001065   000004 470400 3                  LDP0    4
         2 001066   000000 471500                    LDP1    0,,PR0
         2 001067   000000 720000 xsym               LXL0    M$IBEX_NUM
         2 001070   100000 473510                    LDP3    0,X0,PR1
         2 001071   300000 235100                    LDA     0,,PR3
         2 001072   000001 135007                    SBLA    1,DL
         2 001073   203045 755100                    STA     SUB$PARAMS+11,,AUTO

      534    14304    2        SUB$PARAMS.REC_NUM = SUB$PARAMS.REC_NUM + 1;

  14304  2 001074   203046 054100                    AOS     SUB$PARAMS+12,,AUTO

      535    14305    3        DO CASE (START_METHOD);

  14305  2 001075   200352 236100                    LDQ     START_METHOD,,AUTO
         2 001076   000014 116007                    CMPQ    12,DL
         2 001077   001101 602006 2                  TNC     s:14305+4,QL
         2 001100   001174 710000 2                  TRA     s:14330
         2 001101   001174 710000 2                  TRA     s:14330
         2 001102   001174 710000 2                  TRA     s:14330
         2 001103   001174 710000 2                  TRA     s:14330
         2 001104   001174 710000 2                  TRA     s:14330
         2 001105   001174 710000 2                  TRA     s:14330
         2 001106   001174 710000 2                  TRA     s:14330
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:115  
         2 001107   001174 710000 2                  TRA     s:14330
         2 001110   001115 710000 2                  TRA     s:14309
         2 001111   001134 710000 2                  TRA     s:14317
         2 001112   001174 710000 2                  TRA     s:14330
         2 001113   001174 710000 2                  TRA     s:14330
         2 001114   001126 710000 2                  TRA     s:14313

      536    14306    3         CASE (0);

      537    14307                /* No START option specified */
      538    14308    3         CASE (BA_KEY);

      539    14309    3           IF READ_KEY.KEY >= START_KEY.KEY

  14309  2 001115   200757 236100                    LDQ     START_KEY,,AUTO
         2 001116   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 001117   203064 756100                    STQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 001120   200756 236100                    LDQ     READ_KEY,,AUTO
         2 001121   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 001122   203064 116100                    CMPQ    NEED_2_READ_JOBSTATS+6,,AUTO
         2 001123   001174 604000 2                  TMI     s:14330

      540    14310    3              THEN
      541    14311    3                 START_METHOD = 0;

  14311  2 001124   200352 450100                    STZ     START_METHOD,,AUTO
         2 001125   001174 710000 2                  TRA     s:14330

      542    14312    3         CASE (BA_NUM);

      543    14313    3           IF SUB$PARAMS.REC_NUM >= START_NUM

  14313  2 001126   203046 236100                    LDQ     SUB$PARAMS+12,,AUTO
         2 001127   001174 604000 2                  TMI     s:14330
         2 001130   200353 116100                    CMPQ    START_NUM,,AUTO
         2 001131   001174 602000 2                  TNC     s:14330

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:116  
      544    14314    3              THEN
      545    14315    3                 START_METHOD = 0;

  14315  2 001132   200352 450100                    STZ     START_METHOD,,AUTO
         2 001133   001174 710000 2                  TRA     s:14330

      546    14316    3         CASE (BA_LABEL);

      547    14317    3           IF SUBSTR(READBUF,0,1) = '!'

  14317  2 001134   200212 236100                    LDQ     READBUF,,AUTO
         2 001135   777000 376003                    ANQ     -512,DU
         2 001136   041000 116003                    CMPQ    16896,DU
         2 001137   001174 601000 2                  TNZ     s:14330

      548    14318    4           THEN DO;  /* must be an IBEX command */

      549    14319    4             CALL SEARCH (START_INDX, X, B$SR_NON_BLANK, READBUF, 1)

  14319  2 001140   000000 474400 xsym               LDP4    B$SR_NON_BLANK$
         2 001141   000000 164500                    TCT
         2 001142   200212 200377                    ADSC9   READBUF,,AUTO            cn=1,n=255
         2 001143   400000 000100                    ARG     0,,PR4
         2 001144   200360 000100                    ARG     START_INDX,,AUTO
         2 001145   200360 236100                    LDQ     START_INDX,,AUTO
         2 001146   000044 737000                    LLS     36
         2 001147   000033 771000                    ARL     27
         2 001150   200364 755100                    STA     X,,AUTO
         2 001151   200360 551140                    STBA    START_INDX,'40'O,AUTO
         2 001152   200360 054100                    AOS     START_INDX,,AUTO
         2 001153   001174 606400 2                  TTN     s:14330

      550    14320    5             WHENRETURN DO;

      551    14321    5               CALL INDEX (STR_INDX, ': ', READBUF)

  14321  2 001154   000000 120500                    SCD
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:117  
         2 001155   200212 000400                    ADSC9   READBUF,,AUTO            cn=0,n=256
         2 001156   000051 000002 1                  ADSC9   E_NONAME_4_CONT+2        cn=0,n=2
         2 001157   200361 000100                    ARG     STR_INDX,,AUTO
         2 001160   001163 607000 2                  TTF     s:14323
         2 001161   200361 054100                    AOS     STR_INDX,,AUTO
         2 001162   001174 710000 2                  TRA     s:14330

      552    14322    6               WHENRETURN DO;

      553    14323    6                 IF SUBSTR (READBUF, START_INDX, STR_INDX-START_INDX) = START_LABEL

  14323  2 001163   200361 236100                    LDQ     STR_INDX,,AUTO
         2 001164   200360 136100                    SBLQ    START_INDX,,AUTO
         2 001165   000000 621006                    EAX1    0,QL
         2 001166   200360 236100                    LDQ     START_INDX,,AUTO
         2 001167   040100 106546                    CMPC    fill='040'O
         2 001170   200212 000011                    ADSC9   READBUF,Q,AUTO           cn=0,n=*X1
         2 001171   200322 000037                    ADSC9   START_LABEL,,AUTO        cn=0,n=31
         2 001172   001174 601000 2                  TNZ     s:14330

      554    14324    6                   THEN   /* Found it */
      555    14325    6                     START_METHOD = 0;

  14325  2 001173   200352 450100                    STZ     START_METHOD,,AUTO

      556    14326    6              END;

      557    14327    5            END;

      558    14328    4          END;

      559    14329    3        END;   /* Do case START_METHOD end */

      560    14330    2        IF START_METHOD ~= 0

  14330  2 001174   200352 235100                    LDA     START_METHOD,,AUTO
         2 001175   001203 600000 2                  TZE     s:14342
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:118  

      561    14331    2           THEN
      562    14332    3              DO;

      563    14333        /*
      564    14334             ***** If still waiting to start, process DEFAULT commands only.
      565    14335        */
      566    14336    3                 CALL PROCESS_DIRECTIVES

  14336  2 001176   004655 701000 2                  TSX1    PROCESS_DIRECTIVES
         2 001177   001202 702000 2                  TSX2    s:14340

      567    14337    4                   WHENRETURN DO;   /* we found a DEFAULT stmt */

      568    14338    4                     IF TRUNCATED_RECORD THEN GOTO OVERFLOW_ON_READ;

  14338  2 001200   200374 234100                    SZN     TRUNCATED_RECORD,,AUTO
         2 001201   002551 604000 2                  TMI     OVERFLOW_ON_READ

      569    14339    4                   END;

      570    14340    3                 GOTO START_READ;

  14340  2 001202   001043 710000 2                  TRA     START_READ

      571    14341    3              END;
      572    14342    2        IF TRUNCATED_RECORD THEN GOTO OVERFLOW_ON_READ;

  14342  2 001203   200374 234100                    SZN     TRUNCATED_RECORD,,AUTO
         2 001204   002551 604000 2                  TMI     OVERFLOW_ON_READ

      573    14343    2   OPEN_CMD_STREAM:
      574    14344        /*
      575    14345             ***** If TEST was specified
      576    14346                   or the COMMAND STREAM is already open
      577    14347                   (XMIT cmd or multiple XEQ fids) then
      578    14348                   do not try to open it again ...
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:119  
      579    14349        */
      580    14350    2        IF SUB$PARAMS.TEST_OPT# = %NO#

  14350  2 001205   203047 236100       OPEN_CMD_ST* LDQ     SUB$PARAMS+13,,AUTO
         2 001206   100000 316003                    CANQ    32768,DU
         2 001207   001473 601000 2                  TNZ     s:14396
         2 001210   000004 470400 3                  LDP0    4
         2 001211   000000 471500                    LDP1    0,,PR0
         2 001212   000000 720000 xsym               LXL0    M$IBEX1_NUM
         2 001213   100000 473510                    LDP3    0,X0,PR1
         2 001214   300031 236100                    LDQ     25,,PR3
         2 001215   020000 316007                    CANQ    8192,DL
         2 001216   001473 601000 2                  TNZ     s:14396

      581    14351    2        AND DCBADDR(M$IBEX1_NUM) -> F$DCB.FCD# = %NO#
      582    14352    2           THEN
      583    14353    3              DO;   /* Open the COMMAND STREAM */

      584    14354    3                 FPT_OPEN.V.ASN#=%DEVICE#;

  14354  2 001217   000003 236007                    LDQ     3,DL
         2 001220   200477 552104                    STBQ    FPT_OPEN+37,'04'O,AUTO

      585    14355    3                 FPT_OPEN.V.DCB#=M$IBEX1_NUM;

  14355  2 001221   200476 740100                    STX0    FPT_OPEN+36,,AUTO

      586    14356    3                 FPT_OPEN.V.DISP#=%SAVE#;

  14356  2 001222   000002 236007                    LDQ     2,DL
         2 001223   200503 552104                    STBQ    FPT_OPEN+41,'04'O,AUTO

      587    14357    3                 FPT_OPEN.V.EXIST#=%NEWFILE#;

  14357  2 001224   000600 236007                    LDQ     384,DL
         2 001225   200476 256100                    ORSQ    FPT_OPEN+36,,AUTO

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:120  
      588    14358    3                 FPT_OPEN.V.FUN#=%CREATE#;

  14358  2 001226   003000 236007                    LDQ     1536,DL
         2 001227   200477 552110                    STBQ    FPT_OPEN+37,'10'O,AUTO

      589    14359    3                 FPT_OPEN.V.XTNSIZE# = 10;

  14359  2 001230   000012 221003                    LDX1    10,DU
         2 001231   200506 441100                    SXL1    FPT_OPEN+44,,AUTO

      590    14360    3                 FPT_OPEN.WSN_=VECTOR(BLANKS);

  14360  2 001232   000016 237000 3                  LDAQ    14
         2 001233   200464 757100                    STAQ    FPT_OPEN+26,,AUTO

      591    14361    4                 DO CASE (BLK$ -> P$B.CODE);

  14361  2 001234   200011 474500                    LDP4    BLK$,,AUTO
         2 001235   400000 236100                    LDQ     0,,PR4
         2 001236   777777 376007                    ANQ     -1,DL
         2 001237   000006 136007                    SBLQ    6,DL
         2 001240   000105 116007                    CMPQ    69,DL
         2 001241   001243 602006 2                  TNC     s:14361+7,QL
         2 001242   001473 710000 2                  TRA     s:14396
         2 001243   001350 710000 2                  TRA     s:14363
         2 001244   001473 710000 2                  TRA     s:14396
         2 001245   001473 710000 2                  TRA     s:14396
         2 001246   001473 710000 2                  TRA     s:14396
         2 001247   001473 710000 2                  TRA     s:14396
         2 001250   001473 710000 2                  TRA     s:14396
         2 001251   001473 710000 2                  TRA     s:14396
         2 001252   001473 710000 2                  TRA     s:14396
         2 001253   001473 710000 2                  TRA     s:14396
         2 001254   001473 710000 2                  TRA     s:14396
         2 001255   001473 710000 2                  TRA     s:14396
         2 001256   001473 710000 2                  TRA     s:14396
         2 001257   001473 710000 2                  TRA     s:14396
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:121  
         2 001260   001473 710000 2                  TRA     s:14396
         2 001261   001473 710000 2                  TRA     s:14396
         2 001262   001473 710000 2                  TRA     s:14396
         2 001263   001473 710000 2                  TRA     s:14396
         2 001264   001473 710000 2                  TRA     s:14396
         2 001265   001473 710000 2                  TRA     s:14396
         2 001266   001473 710000 2                  TRA     s:14396
         2 001267   001473 710000 2                  TRA     s:14396
         2 001270   001473 710000 2                  TRA     s:14396
         2 001271   001473 710000 2                  TRA     s:14396
         2 001272   001473 710000 2                  TRA     s:14396
         2 001273   001473 710000 2                  TRA     s:14396
         2 001274   001473 710000 2                  TRA     s:14396
         2 001275   001473 710000 2                  TRA     s:14396
         2 001276   001473 710000 2                  TRA     s:14396
         2 001277   001473 710000 2                  TRA     s:14396
         2 001300   001473 710000 2                  TRA     s:14396
         2 001301   001473 710000 2                  TRA     s:14396
         2 001302   001473 710000 2                  TRA     s:14396
         2 001303   001473 710000 2                  TRA     s:14396
         2 001304   001473 710000 2                  TRA     s:14396
         2 001305   001473 710000 2                  TRA     s:14396
         2 001306   001473 710000 2                  TRA     s:14396
         2 001307   001473 710000 2                  TRA     s:14396
         2 001310   001473 710000 2                  TRA     s:14396
         2 001311   001473 710000 2                  TRA     s:14396
         2 001312   001473 710000 2                  TRA     s:14396
         2 001313   001473 710000 2                  TRA     s:14396
         2 001314   001473 710000 2                  TRA     s:14396
         2 001315   001473 710000 2                  TRA     s:14396
         2 001316   001473 710000 2                  TRA     s:14396
         2 001317   001473 710000 2                  TRA     s:14396
         2 001320   001473 710000 2                  TRA     s:14396
         2 001321   001473 710000 2                  TRA     s:14396
         2 001322   001473 710000 2                  TRA     s:14396
         2 001323   001473 710000 2                  TRA     s:14396
         2 001324   001473 710000 2                  TRA     s:14396
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:122  
         2 001325   001473 710000 2                  TRA     s:14396
         2 001326   001473 710000 2                  TRA     s:14396
         2 001327   001473 710000 2                  TRA     s:14396
         2 001330   001473 710000 2                  TRA     s:14396
         2 001331   001473 710000 2                  TRA     s:14396
         2 001332   001473 710000 2                  TRA     s:14396
         2 001333   001473 710000 2                  TRA     s:14396
         2 001334   001473 710000 2                  TRA     s:14396
         2 001335   001473 710000 2                  TRA     s:14396
         2 001336   001473 710000 2                  TRA     s:14396
         2 001337   001473 710000 2                  TRA     s:14396
         2 001340   001473 710000 2                  TRA     s:14396
         2 001341   001473 710000 2                  TRA     s:14396
         2 001342   001473 710000 2                  TRA     s:14396
         2 001343   001473 710000 2                  TRA     s:14396
         2 001344   001473 710000 2                  TRA     s:14396
         2 001345   001473 710000 2                  TRA     s:14396
         2 001346   001361 710000 2                  TRA     s:14366
         2 001347   001372 710000 2                  TRA     s:14369

      592    14362    4                    CASE (BATCHCMND);

      593    14363    4                       FPT_OPEN.V.RES#='JE';

  14363  2 001350   000052 236000 1                  LDQ     E_NONAME_4_CONT+3
         2 001351   777777 376003                    ANQ     -1,DU
         2 001352   040040 276007                    ORQ     16416,DL
         2 001353   200502 756100                    STQ     FPT_OPEN+40,,AUTO

      594    14364    4                       CALL M$OPEN (FPT_OPEN) ALTRET(ABORT);

  14364  2 001354   200432 630500                    EPPR0   FPT_OPEN,,AUTO
         2 001355   450000 713400                    CLIMB   alt,open
         2 001356   410400 401760                    pmme    nvectors=18
         2 001357   003262 702000 2                  TSX2    ABORT
         2 001360   001473 710000 2                  TRA     s:14396

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:123  
      595    14365    4                    CASE (XEQCMND);

      596    14366    4                       FPT_OPEN.V.RES#='JF';

  14366  2 001361   000053 236000 1                  LDQ     E_NONAME_4_CONT+4
         2 001362   777777 376003                    ANQ     -1,DU
         2 001363   040040 276007                    ORQ     16416,DL
         2 001364   200502 756100                    STQ     FPT_OPEN+40,,AUTO

      597    14367    4                       CALL M$OPEN (FPT_OPEN) ALTRET(ABORT);

  14367  2 001365   200432 630500                    EPPR0   FPT_OPEN,,AUTO
         2 001366   450000 713400                    CLIMB   alt,open
         2 001367   410400 401760                    pmme    nvectors=18
         2 001370   003262 702000 2                  TSX2    ABORT
         2 001371   001473 710000 2                  TRA     s:14396

      598    14368    4                    CASE (XMITCMND);

      599    14369    4                       TEMP$ = BLK$ -> P$B.SUBLK$(BLK$ -> P$B.NSUBLKS);

  14369  2 001372   400001 222100                    LDX2    1,,PR4
         2 001373   400003 236112                    LDQ     3,X2,PR4
         2 001374   200007 756100                    STQ     TEMP$,,AUTO

      600    14370    4                       FPT_OPEN.V.RES#='JE';

  14370  2 001375   000052 236000 1                  LDQ     E_NONAME_4_CONT+3
         2 001376   777777 376003                    ANQ     -1,DU
         2 001377   040040 276007                    ORQ     16416,DL
         2 001400   200502 756100                    STQ     FPT_OPEN+40,,AUTO

      601    14371    5                       DO CASE (TEMP$ -> P$B.CODE);

  14371  2 001401   200007 475500                    LDP5    TEMP$,,AUTO
         2 001402   500000 236100                    LDQ     0,,PR5
         2 001403   777777 376007                    ANQ     -1,DL
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:124  
         2 001404   000006 136007                    SBLQ    6,DL
         2 001405   000010 116007                    CMPQ    8,DL
         2 001406   001410 602006 2                  TNC     s:14371+7,QL
         2 001407   001436 710000 2                  TRA     s:14381
         2 001410   001420 710000 2                  TRA     s:14373
         2 001411   001436 710000 2                  TRA     s:14381
         2 001412   001436 710000 2                  TRA     s:14381
         2 001413   001436 710000 2                  TRA     s:14381
         2 001414   001436 710000 2                  TRA     s:14381
         2 001415   001436 710000 2                  TRA     s:14381
         2 001416   001427 710000 2                  TRA     s:14376
         2 001417   001434 710000 2                  TRA     s:14378

      602    14372    5                          CASE (BA_INTO);

      603    14373    5                             FPT_OPEN.V.EXIST# = %OLDFILE#;

  14373  2 001420   200476 236100                    LDQ     FPT_OPEN+36,,AUTO
         2 001421   000020 376000 3                  ANQ     16
         2 001422   000400 276007                    ORQ     256,DL
         2 001423   200476 756100                    STQ     FPT_OPEN+36,,AUTO

      604    14374    5                             FPT_OPEN.V.ACS# = %DIRECT#;

  14374  2 001424   000002 236007                    LDQ     2,DL
         2 001425   200500 552104                    STBQ    FPT_OPEN+38,'04'O,AUTO
         2 001426   001436 710000 2                  TRA     s:14381

      605    14375    5                          CASE (BA_ON);

      606    14376    5                             FPT_OPEN.V.EXIST# = %ERROR#;

  14376  2 001427   200476 236100                    LDQ     FPT_OPEN+36,,AUTO
         2 001430   000020 376000 3                  ANQ     16
         2 001431   000200 276007                    ORQ     128,DL
         2 001432   200476 756100                    STQ     FPT_OPEN+36,,AUTO
         2 001433   001436 710000 2                  TRA     s:14381
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:125  

      607    14377    5                          CASE (BA_OVER);

      608    14378    5                             FPT_OPEN.V.EXIST# = %NEWFILE#;

  14378  2 001434   000600 236007                    LDQ     384,DL
         2 001435   200476 256100                    ORSQ    FPT_OPEN+36,,AUTO

      609    14379    5                       END;   /* INTO, ON, OVER */

      610    14380        /**/
      611    14381    4                       CALL OPEN_FID (TEMP$ -> P$B.SUBLK$(0)) ALTRET(CLOSE_DCBS);

  14381  2 001436   200007 236100                    LDQ     TEMP$,,AUTO
         2 001437   000003 036003                    ADLQ    3,DU
         2 001440   203053 756100                    STQ     I+1,,AUTO
         2 001441   006746 701000 2                  TSX1    OPEN_FID
         2 001442   003307 702000 2                  TSX2    CLOSE_DCBS

      612    14382    4                       IF DCBADDR(M$IBEX1_NUM) -> F$DCB.FFLG.EXEC#

  14382  2 001443   000004 470400 3                  LDP0    4
         2 001444   000000 471500                    LDP1    0,,PR0
         2 001445   000000 720000 xsym               LXL0    M$IBEX1_NUM
         2 001446   100000 473510                    LDP3    0,X0,PR1
         2 001447   300004 236100                    LDQ     4,,PR3
         2 001450   002000 316003                    CANQ    1024,DU
         2 001451   001473 600000 2                  TZE     s:14396

      613    14383    4                          THEN   /* Not allowed to write this file */
      614    14384    5                             DO;

      615    14385    5                                CPOS = TEMP$ -> P$B.CPOS;

  14385  2 001452   200007 474500                    LDP4    TEMP$,,AUTO
         2 001453   400002 235100                    LDA     2,,PR4
         2 001454   200357 755100                    STA     CPOS,,AUTO
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:126  

      616    14386    5                                CALL CXP$POSTERR (ADDR(SEG$2.ERRBUF),CPOS,E_ILLXDEST);

  14386  2 001455   000000 236000 xsym               LDQ     SEG2$
         2 001456   000003 036003                    ADLQ    3,DU
         2 001457   203064 756100                    STQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 001460   000021 236000 3                  LDQ     17
         2 001461   203067 756100                    STQ     NEED_2_READ_JOBSTATS+9,,AUTO
         2 001462   200357 635500                    EPPR5   CPOS,,AUTO
         2 001463   203066 455500                    STP5    NEED_2_READ_JOBSTATS+8,,AUTO
         2 001464   203064 636500                    EPPR6   NEED_2_READ_JOBSTATS+6,,AUTO
         2 001465   203065 456500                    STP6    NEED_2_READ_JOBSTATS+7,,AUTO
         2 001466   203065 630500                    EPPR0   NEED_2_READ_JOBSTATS+7,,AUTO
         2 001467   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 001470   000000 701000 xent               TSX1    CXP$POSTERR
         2 001471   000000 011000                    NOP     0

      617    14387    5                                GOTO CLOSE_DCBS;

  14387  2 001472   003307 710000 2                  TRA     CLOSE_DCBS

      618    14388    5                             END;
      619    14389    4                 END;   /* Do case xxxCMND ... end */

      620    14390    3              END;   /* Open the COMMAND STREAM */

      621    14391        /*
      622    14392             ***** Process any DIRECTIVES
      623    14393                   PROCESS_DIRECTIVES altreturns if no directives found ...
      624    14394        */
      625    14395    3           DO WHILE (%YES#);

      626    14396    3              CALL PROCESS_DIRECTIVES ALTRET(JOB_CARD);

  14396  2 001473   004655 701000 2                  TSX1    PROCESS_DIRECTIVES
         2 001474   001515 702000 2                  TSX2    JOB_CARD

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:127  
      627    14397    3              READBUF=' ';   /* Blank the buffer */

  14397  2 001475   040100 100400                    MLR     fill='040'O
         2 001476   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 001477   200212 000400                    ADSC9   READBUF,,AUTO            cn=0,n=256

      628    14398    3              CALL M$READ (FPT_READ) ALTRET (E_READ) ;

  14398  2 001500   200402 630500                    EPPR0   FPT_READ,,AUTO
         2 001501   440000 713400                    CLIMB   alt,read
         2 001502   401400 401760                    pmme    nvectors=4
         2 001503   002541 702000 2                  TSX2    E_READ

      629    14399    3              SUB$PARAMS.BUF_LEN = DCBADDR(M$IBEX_NUM) -> F$DCB.ARS# -1;

  14399  2 001504   000004 470400 3                  LDP0    4
         2 001505   000000 471500                    LDP1    0,,PR0
         2 001506   000000 720000 xsym               LXL0    M$IBEX_NUM
         2 001507   100000 473510                    LDP3    0,X0,PR1
         2 001510   300000 235100                    LDA     0,,PR3
         2 001511   000001 135007                    SBLA    1,DL
         2 001512   203045 755100                    STA     SUB$PARAMS+11,,AUTO

      630    14400    3              SUB$PARAMS.REC_NUM = SUB$PARAMS.REC_NUM + 1;

  14400  2 001513   203046 054100                    AOS     SUB$PARAMS+12,,AUTO

      631    14401    3           END;

  14401  2 001514   001473 710000 2                  TRA     s:14396

      632    14402        /*
      633    14403             ***** look for !JOB command...
      634    14404        */
      635    14405    2   JOB_CARD:
      636    14406    2           IF BLK$->P$B.CODE = BATCHCMND

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:128  
  14406  2 001515   200011 470500       JOB_CARD     LDP0    BLK$,,AUTO
         2 001516   000000 720100                    LXL0    0,,PR0
         2 001517   000006 100003                    CMPX0   6,DU
         2 001520   002051 601000 2                  TNZ     CHK_BRK
         2 001521   200212 236100                    LDQ     READBUF,,AUTO
         2 001522   000054 376000 1                  ANQ     E_NONAME_4_CONT+5
         2 001523   000055 116000 1                  CMPQ    E_NONAME_4_CONT+6
         2 001524   002051 601000 2                  TNZ     CHK_BRK
         2 001525   200213 236100                    LDQ     READBUF+1,,AUTO
         2 001526   777000 376003                    ANQ     -512,DU
         2 001527   040000 116003                    CMPQ    16384,DU
         2 001530   002051 601000 2                  TNZ     CHK_BRK

      637    14407    2                AND (READBUFB(0)&'777737737737'O) = '041112117102'O
      638    14408    2                AND (SUBSTR(READBUF,4,1) = ' ')
      639    14409    2              THEN
      640    14410    3                 DO;   /* Process the !JOB command */

      641    14411        /*
      642    14412             ***** Do string substitutions on !JOB command...
      643    14413        */
      644    14414    3                    CALL CPH$STRING_SUB (SUB$PARAMS);

  14414  2 001531   203032 631500                    EPPR1   SUB$PARAMS,,AUTO
         2 001532   203064 451500                    STP1    NEED_2_READ_JOBSTATS+6,,AUTO
         2 001533   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 001534   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 001535   000000 701000 xent               TSX1    CPH$STRING_SUB
         2 001536   000000 011000                    NOP     0

      645    14415        /*
      646    14416             ***** Add "FILE=name.accnt" comment...
      647    14417        */
      648    14418    3                    TEMPBUF = READBUF;

  14418  2 001537   040100 100500                    MLR     fill='040'O
         2 001540   200212 000400                    ADSC9   READBUF,,AUTO            cn=0,n=256
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:129  
         2 001541   200112 000400                    ADSC9   TEMPBUF,,AUTO            cn=0,n=256

      649    14419    3                    MATCHED_PAIR# = %YES#;

  14419  2 001542   400000 236003                    LDQ     -131072,DU
         2 001543   200366 756100                    STQ     MATCHED_PAIR#,,AUTO

      650    14420    3                    START_INDX=0;

  14420  2 001544   200360 450100                    STZ     START_INDX,,AUTO

      651    14421    4                    DO WHILE (%YES#);

      652    14422    4                      CALL INDEX (STR_INDX,'"',READBUF,START_INDX) ALTRET(ADD_COMMENT)
             14422                                ;

  14422  2 001545   200360 720100                    LXL0    START_INDX,,AUTO
         2 001546   777377 620010                    EAX0    -257,X0
         2 001547   777777 660003                    ERX0    -1,DU
         2 001550   200360 236100                    LDQ     START_INDX,,AUTO
         2 001551   200360 235100                    LDA     START_INDX,,AUTO
         2 001552   000000 124545                    SCM     mask='000'O
         2 001553   200212 000010                    ADSC9   READBUF,A,AUTO           cn=0,n=*X0
         2 001554   000022 000001 3                  ADSC9   18                       cn=0,n=1
         2 001555   200361 000100                    ARG     STR_INDX,,AUTO
         2 001556   200361 056100                    ASQ     STR_INDX,,AUTO
         2 001557   001570 606400 2                  TTN     ADD_COMMENT

      653    14423    4                       MATCHED_PAIR# = ~MATCHED_PAIR#;

  14423  2 001560   200366 236100                    LDQ     MATCHED_PAIR#,,AUTO
         2 001561   400000 376003                    ANQ     -131072,DU
         2 001562   400000 676003                    ERQ     -131072,DU
         2 001563   200366 756100                    STQ     MATCHED_PAIR#,,AUTO

      654    14424    4                       START_INDX = STR_INDX+1;

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:130  
  14424  2 001564   200361 235100                    LDA     STR_INDX,,AUTO
         2 001565   000001 035007                    ADLA    1,DL
         2 001566   200360 755100                    STA     START_INDX,,AUTO

      655    14425    4                    END;

  14425  2 001567   001545 710000 2                  TRA     s:14422

      656    14426    3   ADD_COMMENT:
      657    14427    3                    IF MATCHED_PAIR#

  14427  2 001570   200366 234100       ADD_COMMENT  SZN     MATCHED_PAIR#,,AUTO
         2 001571   001663 605000 2                  TPL     s:14433

      658    14428    3                       THEN   /* Need leading and trailing quote */
      659    14429    3                          CALL CONCAT(READBUF,SUBSTR(TEMPBUF,0,SUB$PARAMS.BUF_LEN+2),

  14429  2 001572   200720 236100                    LDQ     FID_NAME,,AUTO
         2 001573   000033 772000                    QRL     27
         2 001574   203045 720100                    LXL0    SUB$PARAMS+11,,AUTO
         2 001575   000002 621010                    EAX1    2,X0
         2 001576   040100 100540                    MLR     fill='040'O
         2 001577   200112 000011                    ADSC9   TEMPBUF,,AUTO            cn=0,n=*X1
         2 001600   200212 000400                    ADSC9   READBUF,,AUTO            cn=0,n=256
         2 001601   000000 622006                    EAX2    0,QL
         2 001602   203045 236100                    LDQ     SUB$PARAMS+11,,AUTO
         2 001603   000376 116007                    CMPQ    254,DL
         2 001604   001662 605000 2                  TPL     s:14429+56
         2 001605   777401 623006                    EAX3    -255,QL
         2 001606   777777 663003                    ERX3    -1,DU
         2 001607   040146 100400                    MLR     fill='040'O
         2 001610   000056 000006 1                  ADSC9   E_NONAME_4_CONT+7        cn=0,n=6
         2 001611   200212 400013                    ADSC9   READBUF,Q,AUTO           cn=2,n=*X3
         2 001612   203045 236100                    LDQ     SUB$PARAMS+11,,AUTO
         2 001613   000370 116007                    CMPQ    248,DL
         2 001614   001662 605000 2                  TPL     s:14429+56
         2 001615   777407 620006                    EAX0    -249,QL
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:131  
         2 001616   777777 660003                    ERX0    -1,DU
         2 001617   040146 100540                    MLR     fill='040'O
         2 001620   200720 200012                    ADSC9   FID_NAME,,AUTO           cn=1,n=*X2
         2 001621   200214 000010                    ADSC9   READBUF+2,Q,AUTO         cn=0,n=*X0
         2 001622   000000 636012                    EAQ     0,X2
         2 001623   000022 772000                    QRL     18
         2 001624   203045 036100                    ADLQ    SUB$PARAMS+11,,AUTO
         2 001625   000370 116007                    CMPQ    248,DL
         2 001626   001662 605000 2                  TPL     s:14429+56
         2 001627   203064 756100                    STQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 001630   000000 636012                    EAQ     0,X2
         2 001631   000022 772000                    QRL     18
         2 001632   203045 036100                    ADLQ    SUB$PARAMS+11,,AUTO
         2 001633   203064 720100                    LXL0    NEED_2_READ_JOBSTATS+6,,AUTO
         2 001634   777407 620010                    EAX0    -249,X0
         2 001635   777777 660003                    ERX0    -1,DU
         2 001636   040146 100400                    MLR     fill='040'O
         2 001637   000023 000001 3                  ADSC9   19                       cn=0,n=1
         2 001640   200214 000010                    ADSC9   READBUF+2,Q,AUTO         cn=0,n=*X0
         2 001641   203065 756100                    STQ     NEED_2_READ_JOBSTATS+7,,AUTO
         2 001642   203064 236100                    LDQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 001643   000367 116007                    CMPQ    247,DL
         2 001644   001662 605000 2                  TPL     s:14429+56
         2 001645   777410 621006                    EAX1    -248,QL
         2 001646   777777 661003                    ERX1    -1,DU
         2 001647   203065 235100                    LDA     NEED_2_READ_JOBSTATS+7,,AUTO
         2 001650   040145 100500                    MLR     fill='040'O
         2 001651   200730 000010                    ADSC9   FID_ACCT,,AUTO           cn=0,n=8
         2 001652   200214 200011                    ADSC9   READBUF+2,A,AUTO         cn=1,n=*X1
         2 001653   000357 116007                    CMPQ    239,DL
         2 001654   001662 605000 2                  TPL     s:14429+56
         2 001655   777420 622006                    EAX2    -240,QL
         2 001656   777777 662003                    ERX2    -1,DU
         2 001657   040145 100400                    MLR     fill='040'O
         2 001660   000022 000001 3                  ADSC9   18                       cn=0,n=1
         2 001661   200216 200012                    ADSC9   READBUF+4,A,AUTO         cn=1,n=*X2
         2 001662   001744 710000 2                  TRA     s:14436
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:132  

      660    14430    3                               '"File=',SUBSTR(FID_NAME.NAME#,0,FID_NAME.L#),
      661    14431    3                               '.',FID_ACCT.ACCT#,'"');
      662    14432    3                       ELSE   /* Dont use any quotes */
      663    14433    3                          CALL CONCAT(READBUF,SUBSTR(TEMPBUF,0,SUB$PARAMS.BUF_LEN+2),

  14433  2 001663   200720 236100                    LDQ     FID_NAME,,AUTO
         2 001664   000033 772000                    QRL     27
         2 001665   203045 720100                    LXL0    SUB$PARAMS+11,,AUTO
         2 001666   000002 621010                    EAX1    2,X0
         2 001667   040100 100540                    MLR     fill='040'O
         2 001670   200112 000011                    ADSC9   TEMPBUF,,AUTO            cn=0,n=*X1
         2 001671   200212 000400                    ADSC9   READBUF,,AUTO            cn=0,n=256
         2 001672   000000 622006                    EAX2    0,QL
         2 001673   203045 236100                    LDQ     SUB$PARAMS+11,,AUTO
         2 001674   000376 116007                    CMPQ    254,DL
         2 001675   001744 605000 2                  TPL     s:14436
         2 001676   777401 623006                    EAX3    -255,QL
         2 001677   777777 663003                    ERX3    -1,DU
         2 001700   040146 100400                    MLR     fill='040'O
         2 001701   000060 000005 1                  ADSC9   E_NONAME_4_CONT+9        cn=0,n=5
         2 001702   200212 400013                    ADSC9   READBUF,Q,AUTO           cn=2,n=*X3
         2 001703   203045 236100                    LDQ     SUB$PARAMS+11,,AUTO
         2 001704   000371 116007                    CMPQ    249,DL
         2 001705   001744 605000 2                  TPL     s:14436
         2 001706   777406 620006                    EAX0    -250,QL
         2 001707   777777 660003                    ERX0    -1,DU
         2 001710   040146 100540                    MLR     fill='040'O
         2 001711   200720 200012                    ADSC9   FID_NAME,,AUTO           cn=1,n=*X2
         2 001712   200213 600010                    ADSC9   READBUF+1,Q,AUTO         cn=3,n=*X0
         2 001713   000000 636012                    EAQ     0,X2
         2 001714   000022 772000                    QRL     18
         2 001715   203045 036100                    ADLQ    SUB$PARAMS+11,,AUTO
         2 001716   000371 116007                    CMPQ    249,DL
         2 001717   001744 605000 2                  TPL     s:14436
         2 001720   203064 756100                    STQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 001721   000000 636012                    EAQ     0,X2
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:133  
         2 001722   000022 772000                    QRL     18
         2 001723   203045 036100                    ADLQ    SUB$PARAMS+11,,AUTO
         2 001724   203064 720100                    LXL0    NEED_2_READ_JOBSTATS+6,,AUTO
         2 001725   777406 620010                    EAX0    -250,X0
         2 001726   777777 660003                    ERX0    -1,DU
         2 001727   040146 100400                    MLR     fill='040'O
         2 001730   000023 000001 3                  ADSC9   19                       cn=0,n=1
         2 001731   200213 600010                    ADSC9   READBUF+1,Q,AUTO         cn=3,n=*X0
         2 001732   203065 756100                    STQ     NEED_2_READ_JOBSTATS+7,,AUTO
         2 001733   203064 236100                    LDQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 001734   000370 116007                    CMPQ    248,DL
         2 001735   001744 605000 2                  TPL     s:14436
         2 001736   777407 621006                    EAX1    -249,QL
         2 001737   777777 661003                    ERX1    -1,DU
         2 001740   203065 235100                    LDA     NEED_2_READ_JOBSTATS+7,,AUTO
         2 001741   040145 100500                    MLR     fill='040'O
         2 001742   200730 000010                    ADSC9   FID_ACCT,,AUTO           cn=0,n=8
         2 001743   200214 000011                    ADSC9   READBUF+2,A,AUTO         cn=0,n=*X1

      664    14434    3                               'File=',SUBSTR(FID_NAME.NAME#,0,FID_NAME.L#),
      665    14435    3                               '.',FID_ACCT.ACCT#);
      666    14436    3                    SUB$PARAMS.BUF_LEN = SUB$PARAMS.BUF_LEN + 17 + FID_NAME.L#;

  14436  2 001744   200720 236100                    LDQ     FID_NAME,,AUTO
         2 001745   000033 772000                    QRL     27
         2 001746   203045 036100                    ADLQ    SUB$PARAMS+11,,AUTO
         2 001747   000021 036007                    ADLQ    17,DL
         2 001750   203045 756100                    STQ     SUB$PARAMS+11,,AUTO

      667    14437    3                    IF SUB$PARAMS.BUF_LEN > SIZEV(READBUF)

  14437  2 001751   000377 116007                    CMPQ    255,DL
         2 001752   001755 604400 2                  TMOZ    s:14443

      668    14438    3                       THEN
      669    14439    3                          SUB$PARAMS.BUF_LEN = SIZEV(READBUF);

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:134  
  14439  2 001753   000377 235007                    LDA     255,DL
         2 001754   203045 755100                    STA     SUB$PARAMS+11,,AUTO

      670    14440        /*
      671    14441             ***** Check syntax of !JOB cmd...
      672    14442        */
      673    14443    3                    PCB.TEXT$ = PINCRC(ADDR(READBUF),1);

  14443  2 001755   203064 452500                    STP2    NEED_2_READ_JOBSTATS+6,,AUTO
         2 001756   203064 236100                    LDQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 001757   000024 036000 3                  ADLQ    20
         2 001760   201003 756100                    STQ     PCB,,AUTO

      674    14444    3                    PCB.NCHARS = SUB$PARAMS.BUF_LEN;

  14444  2 001761   203045 235100                    LDA     SUB$PARAMS+11,,AUTO
         2 001762   201014 755100                    STA     PCB+9,,AUTO

      675    14445    3                    PCB.OUT$ = ADDR(FAKE_NODE);

  14445  2 001763   201021 630500                    EPPR0   FAKE_NODE,,AUTO
         2 001764   201006 450500                    STP0    PCB+3,,AUTO

      676    14446    3                    PCB.U$$ = ENTADDR(CPD$SYNTRY);

  14446  2 001765   000000 636000 xent               EAQ     CPD$SYNTRY
         2 001766   201007 756100                    STQ     PCB+4,,AUTO

      677    14447    3                    PCB.CONTINUE = '1'B;

  14447  2 001767   200000 236007                    LDQ     65536,DL
         2 001770   201010 256100                    ORSQ    PCB+5,,AUTO

      678    14448    3                    FAKE_NODE.CODE = JOBCMND;

  14448  2 001771   000037 220003                    LDX0    31,DU
         2 001772   201021 440100                    SXL0    FAKE_NODE,,AUTO
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:135  

      679    14449    3                    CALL CPD$SET_NODES (PCB, PCB.ROOT$, PCB.USER$->U$PARAM.SPCL$$,

  14449  2 001773   200373 631500                    EPPR1   CALL_FLG#,,AUTO
         2 001774   203067 451500                    STP1    NEED_2_READ_JOBSTATS+9,,AUTO
         2 001775   201017 236100                    LDQ     PCB+12,,AUTO
         2 001776   000003 036003                    ADLQ    3,DU
         2 001777   203066 756100                    STQ     NEED_2_READ_JOBSTATS+8,,AUTO
         2 002000   201004 633500                    EPPR3   PCB+1,,AUTO
         2 002001   203065 453500                    STP3    NEED_2_READ_JOBSTATS+7,,AUTO
         2 002002   201003 634500                    EPPR4   PCB,,AUTO
         2 002003   203064 454500                    STP4    NEED_2_READ_JOBSTATS+6,,AUTO
         2 002004   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 002005   000022 631400 xsym               EPPR1   B_VECTNIL+18
         2 002006   000000 701000 xent               TSX1    CPD$SET_NODES
         2 002007   000000 011000                    NOP     0

      680    14450    3                                CALL_FLG#) ;
      681    14451    3                    SEG$2.FLAGS.CONTINUED = %NO# ;

  14451  2 002010   000000 470400 xsym               LDP0    SEG2$
         2 002011   000025 236000 3                  LDQ     21
         2 002012   000000 356100                    ANSQ    0,,PR0

      682    14452    3                    CALL X$PARSE (PCB) ALTRET(BAD_COMMAND) ;

  14452  2 002013   201003 631500                    EPPR1   PCB,,AUTO
         2 002014   203064 451500                    STP1    NEED_2_READ_JOBSTATS+6,,AUTO
         2 002015   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 002016   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002017   000000 701000 xent               TSX1    X$PARSE
         2 002020   002371 702000 2                  TSX2    BAD_COMMAND

      683    14453    3                    IF SEG$2.ERRBUF(1) ~= 0

  14453  2 002021   000000 470400 xsym               LDP0    SEG2$
         2 002022   000004 235100                    LDA     4,,PR0
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:136  
         2 002023   002371 601000 2                  TNZ     BAD_COMMAND

      684    14454    3                       THEN   /* context errors */
      685    14455    3                          GOTO BAD_COMMAND;
      686    14456    3                    ECHO_JOB_CMD = %YES# ;

  14456  2 002024   400000 236003                    LDQ     -131072,DU
         2 002025   200400 756100                    STQ     ECHO_JOB_CMD,,AUTO

      687    14457    3                    CALL CHK_4_CROSS_ACCT_BATCH(PCB.OUT$);

  14457  2 002026   201006 631500                    EPPR1   PCB+3,,AUTO
         2 002027   203051 451500                    STP1    SUB$PARAMS+15,,AUTO
         2 002030   007222 701000 2                  TSX1    CHK_4_CROSS_ACCT_BATCH
         2 002031   000000 011000                    NOP     0

      688    14458    3                    IF NOT SUB$PARAMS.TEST_OPT#

  14458  2 002032   203047 236100                    LDQ     SUB$PARAMS+13,,AUTO
         2 002033   100000 316003                    CANQ    32768,DU
         2 002034   002045 601000 2                  TNZ     s:14467

      689    14459    3                     THEN
      690    14460    4                       CALL CHK_FOLLOW_CONDITION(PCB.OUT$) WHENALTRETURN DO ;

  14460  2 002035   201006 630500                    EPPR0   PCB+3,,AUTO
         2 002036   203051 450500                    STP0    SUB$PARAMS+15,,AUTO
         2 002037   003357 701000 2                  TSX1    CHK_FOLLOW_CONDITION
         2 002040   002042 702000 2                  TSX2    s:14461
         2 002041   002045 710000 2                  TRA     s:14467

      691    14461    4                                                         IF ECHO_JOB_CMD

  14461  2 002042   200400 234100                    SZN     ECHO_JOB_CMD,,AUTO
         2 002043   002371 604000 2                  TMI     BAD_COMMAND

      692    14462    4                                                           THEN
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:137  
      693    14463    4                                                              GOTO BAD_COMMAND ;
      694    14464    4                                                           ELSE
      695    14465    4                                                              GOTO BAD_COMMAND_NO_ECHO
             14465                                                                       ;

  14465  2 002044   002421 710000 2                  TRA     BAD_COMMAND_NO_ECHO

      696    14466    4                                                         END ; /* Whenalt. Do */
      697    14467    3                    SEG$2.FLAGS.CONTINUED = %NO# ;

  14467  2 002045   000000 470400 xsym               LDP0    SEG2$
         2 002046   000025 236000 3                  LDQ     21
         2 002047   000000 356100                    ANSQ    0,,PR0

      698    14468    3                    GOTO WRITE;

  14468  2 002050   002227 710000 2                  TRA     WRITE

      699    14469    3                 END;   /* Process the !JOB command */
      700    14470        /*
      701    14471             ***** Check to see if a break has been received...
      702    14472        */
      703    14473    2   CHK_BRK:
      704    14474    2           IF B$JIT.CPFLAGS1 & %CP_BRK#

  14474  2 002051   000000 470400 xsym  CHK_BRK      LDP0    B$JIT$
         2 002052   000143 236100                    LDQ     99,,PR0
         2 002053   000006 376000 xsym               ANQ     B_VECTNIL+6
         2 002054   002057 600000 2                  TZE     s:14482

      705    14475    2              THEN
      706    14476    3                 DO;

      707    14477    3                    CALL CHK_BREAK ALTRET(DELETE_CMD_STREAM);

  14477  2 002055   006471 701000 2                  TSX1    CHK_BREAK
         2 002056   002665 702000 2                  TSX2    DELETE_CMD_STREAM
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:138  

      708    14478    3                 END;

      709    14479        /*
      710    14480             *****    Do string SUBSTITUTIONS...
      711    14481        */
      712    14482    2           CALL CPH$STRING_SUB (SUB$PARAMS);

  14482  2 002057   203032 630500                    EPPR0   SUB$PARAMS,,AUTO
         2 002060   203064 450500                    STP0    NEED_2_READ_JOBSTATS+6,,AUTO
         2 002061   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 002062   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002063   000000 701000 xent               TSX1    CPH$STRING_SUB
         2 002064   000000 011000                    NOP     0

      713    14483        /*
      714    14484             ***** If the SCAN option was specified then check each
      715    14485                   IBEX command for SYNTAX and CONTEXT errors.
      716    14486                   Do not attempt to SCAN PREPROCESSOR EXPRESSIONS ...
      717    14487        */
      718    14488    2           IF SCAN_OPT#

  14488  2 002065   200371 234100                    SZN     SCAN_OPT#,,AUTO
         2 002066   002227 605000 2                  TPL     WRITE
         2 002067   200212 236100                    LDQ     READBUF,,AUTO
         2 002070   777000 376003                    ANQ     -512,DU
         2 002071   041000 116003                    CMPQ    16896,DU
         2 002072   002227 601000 2                  TNZ     WRITE

      719    14489    2           AND SUBSTR(READBUF,0,1) = '!'
      720    14490    2              THEN
      721    14491    3                 DO;

      722    14492    3                     IF SUBSTR(READBUF,0,2) = '!!'

  14492  2 002073   200212 220100                    LDX0    READBUF,,AUTO
         2 002074   000062 100000 1                  CMPX0   E_NONAME_4_CONT+11
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:139  
         2 002075   002227 600000 2                  TZE     WRITE

      723    14493    3                       THEN
      724    14494    3                         GOTO WRITE ;  /* Treat this record as DATA record. */
      725    14495    3                    CALL INDEX (STR_INDX,'%',READBUF);

  14495  2 002076   000000 124500                    SCM     mask='000'O
         2 002077   200212 000400                    ADSC9   READBUF,,AUTO            cn=0,n=256
         2 002100   000026 000001 3                  ADSC9   22                       cn=0,n=1
         2 002101   200361 000100                    ARG     STR_INDX,,AUTO

      726    14496    3                    IF STR_INDX < LENGTHC(READBUF)

  14496  2 002102   200361 235100                    LDA     STR_INDX,,AUTO
         2 002103   000400 115007                    CMPA    256,DL
         2 002104   002227 602000 2                  TNC     WRITE

      727    14497    3                       THEN   /* Found a % */
      728    14498    3                          GOTO WRITE;
      729    14499    3                    PCB.ROOT$ = ADDR(IBEX_CMD);

  14499  2 002105   000027 236000 3                  LDQ     23
         2 002106   201004 756100                    STQ     PCB+1,,AUTO

      730    14500    3                    PCB.NCHARS = SUB$PARAMS.BUF_LEN;

  14500  2 002107   203045 235100                    LDA     SUB$PARAMS+11,,AUTO
         2 002110   201014 755100                    STA     PCB+9,,AUTO

      731    14501    3                    PCB.TEXT$ = PINCRC(ADDR(READBUF),1);

  14501  2 002111   203064 452500                    STP2    NEED_2_READ_JOBSTATS+6,,AUTO
         2 002112   203064 236100                    LDQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 002113   000024 036000 3                  ADLQ    20
         2 002114   201003 756100                    STQ     PCB,,AUTO

      732    14502    3                    PCB.U$$ = ENTADDR(CPD$NULL_SFROUTINE);
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:140  

  14502  2 002115   000000 636000 xent               EAQ     CPD$NULL_SFROUTINE
         2 002116   201007 756100                    STQ     PCB+4,,AUTO

      733    14503    3                    PCB.CONTINUE = '0'B;

  14503  2 002117   000030 236000 3                  LDQ     24
         2 002120   201010 356100                    ANSQ    PCB+5,,AUTO

      734    14504    3                    CALL X$PARSE (PCB) ALTRET(BAD_COMMAND);

  14504  2 002121   201003 630500                    EPPR0   PCB,,AUTO
         2 002122   203064 450500                    STP0    NEED_2_READ_JOBSTATS+6,,AUTO
         2 002123   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 002124   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002125   000000 701000 xent               TSX1    X$PARSE
         2 002126   002371 702000 2                  TSX2    BAD_COMMAND

      735    14505    3                    PCB.U$$ = ENTADDR(CPD$SYNTRY);

  14505  2 002127   000000 636000 xent               EAQ     CPD$SYNTRY
         2 002130   201007 756100                    STQ     PCB+4,,AUTO

      736    14506    3                    IF PCB.OUT$->P$B.TEMP

  14506  2 002131   201006 470500                    LDP0    PCB+3,,AUTO
         2 002132   000000 234100                    SZN     0,,PR0
         2 002133   002147 605000 2                  TPL     s:14516

      737    14507    3                       THEN
      738    14508    4                         DO ;

      739    14509    4                           PCB.OUT$ = PCB.OUT$->P$B.SUBLK$(1) ;

  14509  2 002134   000004 236100                    LDQ     4,,PR0
         2 002135   201006 756100                    STQ     PCB+3,,AUTO

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:141  
      740    14510    4   RE_PARSE:               PCB.TEXT$ = PINCRC(PCB.TEXT$, PCB.OUT$->P$B.CPOS);

  14510  2 002136   201006 470500       RE_PARSE     LDP0    PCB+3,,AUTO
         2 002137   000002 236100                    LDQ     2,,PR0
         2 002140   000020 736000                    QLS     16
         2 002141   201003 036100                    ADLQ    PCB,,AUTO
         2 002142   201003 756100                    STQ     PCB,,AUTO

      741    14511    4                           PCB.NCHARS = PCB.NCHARS - PCB.OUT$->P$B.CPOS;

  14511  2 002143   201014 236100                    LDQ     PCB+9,,AUTO
         2 002144   000002 136100                    SBLQ    2,,PR0
         2 002145   201014 756100                    STQ     PCB+9,,AUTO

      742    14512    4                           IF PCB.NCHARS = 0

  14512  2 002146   002227 600000 2                  TZE     WRITE

      743    14513    4                             THEN
      744    14514    4                               GOTO WRITE ;
      745    14515    4                         END ; /* Then Do */

      746    14516    3                    PCB.CONTINUE = '1'B;

  14516  2 002147   200000 236007                    LDQ     65536,DL
         2 002150   201010 256100                    ORSQ    PCB+5,,AUTO

      747    14517    3                    CALL CPD$SET_NODES (PCB, PCB.ROOT$, PCB.USER$->U$PARAM.SPCL$$,

  14517  2 002151   200373 631500                    EPPR1   CALL_FLG#,,AUTO
         2 002152   203067 451500                    STP1    NEED_2_READ_JOBSTATS+9,,AUTO
         2 002153   201017 236100                    LDQ     PCB+12,,AUTO
         2 002154   000003 036003                    ADLQ    3,DU
         2 002155   203066 756100                    STQ     NEED_2_READ_JOBSTATS+8,,AUTO
         2 002156   201004 633500                    EPPR3   PCB+1,,AUTO
         2 002157   203065 453500                    STP3    NEED_2_READ_JOBSTATS+7,,AUTO
         2 002160   201003 634500                    EPPR4   PCB,,AUTO
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:142  
         2 002161   203064 454500                    STP4    NEED_2_READ_JOBSTATS+6,,AUTO
         2 002162   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 002163   000022 631400 xsym               EPPR1   B_VECTNIL+18
         2 002164   000000 701000 xent               TSX1    CPD$SET_NODES
         2 002165   000000 011000                    NOP     0

      748    14518    3                                CALL_FLG#) ;
      749    14519    3                    CALL X$PARSE (PCB) ALTRET(BAD_COMMAND) ;

  14519  2 002166   201003 630500                    EPPR0   PCB,,AUTO
         2 002167   203064 450500                    STP0    NEED_2_READ_JOBSTATS+6,,AUTO
         2 002170   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 002171   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002172   000000 701000 xent               TSX1    X$PARSE
         2 002173   002371 702000 2                  TSX2    BAD_COMMAND

      750    14520    3                    IF PCB.ROOT$ = ADDR(CPSL_NODES)

  14520  2 002174   000031 236000 3                  LDQ     25
         2 002175   201004 116100                    CMPQ    PCB+1,,AUTO
         2 002176   002212 601000 2                  TNZ     s:14523

      751    14521    3                       THEN
      752    14522    3                          CALL CXX$VERIFY (PCB.OUT$->P$B, ADDR(SEG$2.ERRBUF));

  14522  2 002177   000000 236000 xsym               LDQ     SEG2$
         2 002200   000003 036003                    ADLQ    3,DU
         2 002201   203064 756100                    STQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 002202   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 002203   203067 450500                    STP0    NEED_2_READ_JOBSTATS+9,,AUTO
         2 002204   201006 236100                    LDQ     PCB+3,,AUTO
         2 002205   203066 756100                    STQ     NEED_2_READ_JOBSTATS+8,,AUTO
         2 002206   203066 630500                    EPPR0   NEED_2_READ_JOBSTATS+8,,AUTO
         2 002207   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 002210   000000 701000 xent               TSX1    CXX$VERIFY
         2 002211   000000 011000                    NOP     0

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:143  
      753    14523    3                    IF SEG$2.ERRBUF(1) ~= 0

  14523  2 002212   000000 470400 xsym               LDP0    SEG2$
         2 002213   000004 235100                    LDA     4,,PR0
         2 002214   002371 601000 2                  TNZ     BAD_COMMAND

      754    14524    3                       THEN   /* context errors */
      755    14525    3                          GOTO BAD_COMMAND;
      756    14526    3                    IF PCB.ROOT$ = ADDR(IF_)

  14526  2 002215   000032 236000 3                  LDQ     26
         2 002216   201004 116100                    CMPQ    PCB+1,,AUTO
         2 002217   002227 601000 2                  TNZ     WRITE

      757    14527    3                       THEN
      758    14528    4                          DO;

      759    14529    4                             PCB.OUT$ = PCB.OUT$->P$B.SUBLK$(1)->P$B.SUBLK$(0);

  14529  2 002220   201006 471500                    LDP1    PCB+3,,AUTO
         2 002221   100004 473500                    LDP3    4,,PR1
         2 002222   300003 236100                    LDQ     3,,PR3
         2 002223   201006 756100                    STQ     PCB+3,,AUTO

      760    14530    4                             PCB.ROOT$ = ADDR(IBEX_CMD); /* Just in case */

  14530  2 002224   000027 236000 3                  LDQ     23
         2 002225   201004 756100                    STQ     PCB+1,,AUTO

      761    14531    4                             GOTO RE_PARSE;

  14531  2 002226   002136 710000 2                  TRA     RE_PARSE

      762    14532    4                          END;
      763    14533    3                 END;
      764    14534    2   WRITE:
      765    14535    2           CALL WRITE_BUF ALTRET(ABORT);
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:144  

  14535  2 002227   006356 701000 2     WRITE        TSX1    WRITE_BUF
         2 002230   003262 702000 2                  TSX2    ABORT

      766    14536        /*
      767    14537             ***** Read the next record from the file...
      768    14538        */
      769    14539    2   READ:
      770    14540    2           READBUF= ' ';   /* Blank the buffer */

  14540  2 002231   040100 100400       READ         MLR     fill='040'O
         2 002232   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 002233   200212 000400                    ADSC9   READBUF,,AUTO            cn=0,n=256

      771    14541    2           CALL M$READ (FPT_READ) ALTRET (E_READ) ;

  14541  2 002234   200402 630500                    EPPR0   FPT_READ,,AUTO
         2 002235   440000 713400                    CLIMB   alt,read
         2 002236   401400 401760                    pmme    nvectors=4
         2 002237   002541 702000 2                  TSX2    E_READ

      772    14542    2           SUB$PARAMS.BUF_LEN = DCBADDR(M$IBEX_NUM) -> F$DCB.ARS# -1;

  14542  2 002240   000004 470400 3                  LDP0    4
         2 002241   000000 471500                    LDP1    0,,PR0
         2 002242   000000 720000 xsym               LXL0    M$IBEX_NUM
         2 002243   100000 473510                    LDP3    0,X0,PR1
         2 002244   300000 235100                    LDA     0,,PR3
         2 002245   000001 135007                    SBLA    1,DL
         2 002246   203045 755100                    STA     SUB$PARAMS+11,,AUTO

      773    14543    2           SUB$PARAMS.REC_NUM = SUB$PARAMS.REC_NUM + 1;

  14543  2 002247   203046 054100                    AOS     SUB$PARAMS+12,,AUTO

      774    14544        /*
      775    14545             ***** IF END=xxx was specified then check to see
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:145  
      776    14546                   if we have reached the end of the road ...
      777    14547        */
      778    14548    3           DO CASE (END_METHOD);

  14548  2 002250   200350 236100                    LDQ     END_METHOD,,AUTO
         2 002251   000014 116007                    CMPQ    12,DL
         2 002252   002254 602006 2                  TNC     s:14548+4,QL
         2 002253   002347 710000 2                  TRA     s:14579
         2 002254   002347 710000 2                  TRA     s:14579
         2 002255   002347 710000 2                  TRA     s:14579
         2 002256   002347 710000 2                  TRA     s:14579
         2 002257   002347 710000 2                  TRA     s:14579
         2 002260   002347 710000 2                  TRA     s:14579
         2 002261   002347 710000 2                  TRA     s:14579
         2 002262   002347 710000 2                  TRA     s:14579
         2 002263   002270 710000 2                  TRA     s:14552
         2 002264   002300 710000 2                  TRA     s:14556
         2 002265   002347 710000 2                  TRA     s:14579
         2 002266   002347 710000 2                  TRA     s:14579
         2 002267   002343 710000 2                  TRA     s:14572

      779    14549    3              CASE (0);

      780    14550                      /* Nothing specified */
      781    14551    3              CASE (BA_KEY);

      782    14552    3                 IF READ_KEY.KEY > END_KEY.KEY

  14552  2 002270   200756 236100                    LDQ     READ_KEY,,AUTO
         2 002271   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 002272   203064 756100                    STQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 002273   200755 236100                    LDQ     END_KEY,,AUTO
         2 002274   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 002275   203064 116100                    CMPQ    NEED_2_READ_JOBSTATS+6,,AUTO
         2 002276   002732 604000 2                  TMI     CLOSE_CMD_STREAM
         2 002277   002347 710000 2                  TRA     s:14579

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:146  
      783    14553    3                    THEN
      784    14554    3                       GOTO CLOSE_CMD_STREAM;
      785    14555    3              CASE (BA_LABEL);

      786    14556    3                 IF SUBSTR(READBUF,0,1) = '!'

  14556  2 002300   200212 236100                    LDQ     READBUF,,AUTO
         2 002301   777000 376003                    ANQ     -512,DU
         2 002302   041000 116003                    CMPQ    16896,DU
         2 002303   002347 601000 2                  TNZ     s:14579

      787    14557    4                 THEN DO;  /* must be an IBEX command */

      788    14558    4                   CALL SEARCH (START_INDX, X, B$SR_NON_BLANK, READBUF, 1)

  14558  2 002304   000000 474400 xsym               LDP4    B$SR_NON_BLANK$
         2 002305   000000 164500                    TCT
         2 002306   200212 200377                    ADSC9   READBUF,,AUTO            cn=1,n=255
         2 002307   400000 000100                    ARG     0,,PR4
         2 002310   200360 000100                    ARG     START_INDX,,AUTO
         2 002311   200360 236100                    LDQ     START_INDX,,AUTO
         2 002312   000044 737000                    LLS     36
         2 002313   000033 771000                    ARL     27
         2 002314   200364 755100                    STA     X,,AUTO
         2 002315   200360 551140                    STBA    START_INDX,'40'O,AUTO
         2 002316   200360 054100                    AOS     START_INDX,,AUTO
         2 002317   002342 606400 2                  TTN     s:14570

      789    14559    5                   WHENRETURN DO;

      790    14560    5                     CALL INDEX (STR_INDX, ': ', READBUF)

  14560  2 002320   000000 120500                    SCD
         2 002321   200212 000400                    ADSC9   READBUF,,AUTO            cn=0,n=256
         2 002322   000051 000002 1                  ADSC9   E_NONAME_4_CONT+2        cn=0,n=2
         2 002323   200361 000100                    ARG     STR_INDX,,AUTO
         2 002324   002327 607000 2                  TTF     s:14562
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:147  
         2 002325   200361 054100                    AOS     STR_INDX,,AUTO
         2 002326   002342 710000 2                  TRA     s:14570

      791    14561    6                     WHENRETURN DO;

      792    14562    6                      IF SUBSTR (READBUF, START_INDX, STR_INDX-START_INDX) = END_LABEL

  14562  2 002327   200361 236100                    LDQ     STR_INDX,,AUTO
         2 002330   200360 136100                    SBLQ    START_INDX,,AUTO
         2 002331   000000 621006                    EAX1    0,QL
         2 002332   200360 236100                    LDQ     START_INDX,,AUTO
         2 002333   040100 106546                    CMPC    fill='040'O
         2 002334   200212 000011                    ADSC9   READBUF,Q,AUTO           cn=0,n=*X1
         2 002335   200312 000037                    ADSC9   END_LABEL,,AUTO          cn=0,n=31
         2 002336   002342 601000 2                  TNZ     s:14570

      793    14563    6                         THEN   /* Found it! */
      794    14564    7                           DO; /* setup ot quit after this record */

      795    14565    7                             END_NUM = 0;

  14565  2 002337   200351 450100                    STZ     END_NUM,,AUTO

      796    14566    7                             END_METHOD = BA_NUM;

  14566  2 002340   000013 235007                    LDA     11,DL
         2 002341   200350 755100                    STA     END_METHOD,,AUTO

      797    14567    7                           END;

      798    14568    6                     END;

      799    14569    5                   END;

      800    14570    4                 END;

  14570  2 002342   002347 710000 2                  TRA     s:14579
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:148  

      801    14571    3              CASE (BA_NUM);

      802    14572    3                 IF SUB$PARAMS.REC_NUM > END_NUM

  14572  2 002343   200351 236100                    LDQ     END_NUM,,AUTO
         2 002344   002347 604000 2                  TMI     s:14579
         2 002345   203046 116100                    CMPQ    SUB$PARAMS+12,,AUTO
         2 002346   002732 604000 2                  TMI     CLOSE_CMD_STREAM

      803    14573    3                    THEN
      804    14574    3                       GOTO CLOSE_CMD_STREAM;
      805    14575    3           END;   /* Do case (END_METHOD) end */

      806    14576        /*
      807    14577             ***** Look for !JOB commands...
      808    14578        */
      809    14579    2           IF BLK$ -> P$B.CODE = BATCHCMND

  14579  2 002347   200011 470500                    LDP0    BLK$,,AUTO
         2 002350   000000 720100                    LXL0    0,,PR0
         2 002351   000006 100003                    CMPX0   6,DU
         2 002352   002366 601000 2                  TNZ     s:14591
         2 002353   200212 236100                    LDQ     READBUF,,AUTO
         2 002354   000054 376000 1                  ANQ     E_NONAME_4_CONT+5
         2 002355   000055 116000 1                  CMPQ    E_NONAME_4_CONT+6
         2 002356   002366 601000 2                  TNZ     s:14591
         2 002357   200213 236100                    LDQ     READBUF+1,,AUTO
         2 002360   777000 376003                    ANQ     -512,DU
         2 002361   040000 116003                    CMPQ    16384,DU
         2 002362   002366 601000 2                  TNZ     s:14591

      810    14580    2           AND (READBUFB(0)&'777737737737'O) = '041112117102'O
      811    14581    2           AND SUBSTR (READBUF,4,1) = ' '
      812    14582    2              THEN
      813    14583    3                 DO;

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:149  
      814    14584    3                    JOB_FLAG# = %YES#;

  14584  2 002363   400000 236003                    LDQ     -131072,DU
         2 002364   200365 756100                    STQ     JOB_FLAG#,,AUTO

      815    14585    3                    GOTO CLOSE_CMD_STREAM;

  14585  2 002365   002732 710000 2                  TRA     CLOSE_CMD_STREAM

      816    14586    3                 END;
      817    14587        /*
      818    14588             ***** Process any DIRECTIVES
      819    14589                   PROCESS_DIRECTIVES altreturns if no directives found ...
      820    14590        */
      821    14591    2           CALL PROCESS_DIRECTIVES ALTRET (CHK_BRK);

  14591  2 002366   004655 701000 2                  TSX1    PROCESS_DIRECTIVES
         2 002367   002051 702000 2                  TSX2    CHK_BRK

      822    14592    2           GOTO READ;

  14592  2 002370   002231 710000 2                  TRA     READ

      823    14593        /*
      824    14594             ***** Syntax error. Delete the command stream ...
      825    14595        */
      826    14596    2   BAD_COMMAND:
      827    14597        /*E*    ERROR: CPH-E$BDSCAN-C
      828    14598                MESSAGE: Processing aborted.
      829    14599        */
      830    14600        /*
      831    14601             ***** Print the record...
      832    14602        */
      833    14603    2           CALL CONCAT (WRITEBUF,'     ',READBUF);

  14603  2 002371   040100 100400       BAD_COMMAND  MLR     fill='040'O
         2 002372   000063 000005 1                  ADSC9   E_NONAME_4_CONT+12       cn=0,n=5
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:150  
         2 002373   200012 000005                    ADSC9   WRITEBUF,,AUTO           cn=0,n=5
         2 002374   040100 100500                    MLR     fill='040'O
         2 002375   200212 000373                    ADSC9   READBUF,,AUTO            cn=0,n=251
         2 002376   200013 200373                    ADSC9   WRITEBUF+1,,AUTO         cn=1,n=251

      834    14604    2           SEG$2.FPT_WRITECC$->FPT$WRITE.BUF_.BOUND =

  14604  2 002377   000000 470400 xsym               LDP0    SEG2$
         2 002400   000161 471500                    LDP1    113,,PR0
         2 002401   203045 236100                    LDQ     SUB$PARAMS+11,,AUTO
         2 002402   000004 036007                    ADLQ    4,DL
         2 002403   000377 116007                    CMPQ    255,DL
         2 002404   002406 604400 2                  TMOZ    s:14604+7
         2 002405   000377 236007                    LDQ     255,DL
         2 002406   000020 736000                    QLS     16
         2 002407   100004 676100                    ERQ     4,,PR1
         2 002410   000034 376000 xsym               ANQ     B_VECTNIL+28
         2 002411   100004 656100                    ERSQ    4,,PR1

      835    14605    2             MINIMUM (LENGTHV(WRITEBUF), SUB$PARAMS.BUF_LEN+4);
      836    14606    2           CALL CPE$DIAGOUT (SEG$2.FPT_WRITECC$);

  14606  2 002412   000000 236000 xsym               LDQ     SEG2$
         2 002413   000161 036003                    ADLQ    113,DU
         2 002414   203064 756100                    STQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 002415   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 002416   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002417   000000 701000 xent               TSX1    CPE$DIAGOUT
         2 002420   000000 011000                    NOP     0

      837    14607    2   BAD_COMMAND_NO_ECHO:
      838    14608    2           CALL STUFF_GETCMD_4_ERRPTR ;

  14608  2 002421   007164 701000 2     BAD_COMMAND* TSX1    STUFF_GETCMD_4_ERRPTR
         2 002422   000000 011000                    NOP     0

      839    14609    2           IF PCB.ERROR.CODE ~= 0
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:151  

  14609  2 002423   201011 236100                    LDQ     PCB+6,,AUTO
         2 002424   377770 316007                    CANQ    131064,DL
         2 002425   002506 600000 2                  TZE     s:14626

      840    14610    2              THEN
      841    14611    3                 DO;   /* Post it */

      842    14612    3                    IF PCB.ERROR.CODE = %E$SYNERR

  14612  2 002426   201011 236100                    LDQ     PCB+6,,AUTO
         2 002427   377770 376007                    ANQ     131064,DL
         2 002430   000010 116007                    CMPQ    8,DL
         2 002431   002471 601000 2                  TNZ     s:14624

      843    14613    3                       THEN
      844    14614    4                         DO ;

      845    14615    4                           CPOS = PCB.HI_CHAR ;

  14615  2 002432   201015 235100                    LDA     PCB+10,,AUTO
         2 002433   200357 755100                    STA     CPOS,,AUTO

      846    14616    4                           CALL CXP$POSTERR (ADDR(SEG$2.ERRBUF),CPOS,PCB.ERROR);

  14616  2 002434   000000 236000 xsym               LDQ     SEG2$
         2 002435   000003 036003                    ADLQ    3,DU
         2 002436   203064 756100                    STQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 002437   201011 630500                    EPPR0   PCB+6,,AUTO
         2 002440   203067 450500                    STP0    NEED_2_READ_JOBSTATS+9,,AUTO
         2 002441   200357 631500                    EPPR1   CPOS,,AUTO
         2 002442   203066 451500                    STP1    NEED_2_READ_JOBSTATS+8,,AUTO
         2 002443   203064 633500                    EPPR3   NEED_2_READ_JOBSTATS+6,,AUTO
         2 002444   203065 453500                    STP3    NEED_2_READ_JOBSTATS+7,,AUTO
         2 002445   203065 630500                    EPPR0   NEED_2_READ_JOBSTATS+7,,AUTO
         2 002446   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 002447   000000 701000 xent               TSX1    CXP$POSTERR
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:152  
         2 002450   000000 011000                    NOP     0

      847    14617    4                           IF B$JIT.PRFLAGS.POINT AND PCB.HI_CHAR + 5 > PCB.NCHARS

  14617  2 002451   000000 470400 xsym               LDP0    B$JIT$
         2 002452   000030 236100                    LDQ     24,,PR0
         2 002453   000200 316003                    CANQ    128,DU
         2 002454   002506 600000 2                  TZE     s:14626
         2 002455   201015 236100                    LDQ     PCB+10,,AUTO
         2 002456   000005 036007                    ADLQ    5,DL
         2 002457   201014 116100                    CMPQ    PCB+9,,AUTO
         2 002460   002506 602000 2                  TNC     s:14626
         2 002461   002506 600000 2                  TZE     s:14626

      848    14618    4                             THEN
      849    14619    4                               SEG$2.GETCMD$->GET$CMD.PCB$->BASED$PCB.NCHARS =

  14619  2 002462   000000 471400 xsym               LDP1    SEG2$
         2 002463   100173 473500                    LDP3    123,,PR1
         2 002464   300003 474500                    LDP4    3,,PR3
         2 002465   400011 235100                    LDA     9,,PR4
         2 002466   000005 035007                    ADLA    5,DL
         2 002467   400011 755100                    STA     9,,PR4

      850    14620    4                                   SEG$2.GETCMD$->GET$CMD.PCB$->BASED$PCB.NCHARS +
      851    14621    4                                     5 ; /* Need to fake out CXG$ERRPTR */
      852    14622    4                         END ; /* Then Do */

  14622  2 002470   002506 710000 2                  TRA     s:14626

      853    14623    3                       ELSE   /* No charpos avail */
      854    14624    3                          CALL CXP$POSTERR (ADDR(SEG$2.ERRBUF),511,PCB.ERROR);

  14624  2 002471   000000 236000 xsym               LDQ     SEG2$
         2 002472   000003 036003                    ADLQ    3,DU
         2 002473   203064 756100                    STQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 002474   201011 630500                    EPPR0   PCB+6,,AUTO
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:153  
         2 002475   203067 450500                    STP0    NEED_2_READ_JOBSTATS+9,,AUTO
         2 002476   000034 236000 3                  LDQ     28
         2 002477   203066 756100                    STQ     NEED_2_READ_JOBSTATS+8,,AUTO
         2 002500   203064 631500                    EPPR1   NEED_2_READ_JOBSTATS+6,,AUTO
         2 002501   203065 451500                    STP1    NEED_2_READ_JOBSTATS+7,,AUTO
         2 002502   203065 630500                    EPPR0   NEED_2_READ_JOBSTATS+7,,AUTO
         2 002503   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 002504   000000 701000 xent               TSX1    CXP$POSTERR
         2 002505   000000 011000                    NOP     0

      855    14625    3                 END;

      856    14626    2           IF SEG$2.ERRBUF(1) ~= 0

  14626  2 002506   000000 470400 xsym               LDP0    SEG2$
         2 002507   000004 235100                    LDA     4,,PR0
         2 002510   002534 600000 2                  TZE     s:14631

      857    14627    2              THEN
      858    14628    3                 DO;

      859    14629    3                    CALL CPR$RPTERR(SEG$2.ERRBUF,POFFC(PCB.TEXT$,ADDR(READBUF))+5);

  14629  2 002511   203064 452500                    STP2    NEED_2_READ_JOBSTATS+6,,AUTO
         2 002512   203064 236100                    LDQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 002513   000212 036003                    ADLQ    138,DU
         2 002514   000020 772000                    QRL     16
         2 002515   203065 756100                    STQ     NEED_2_READ_JOBSTATS+7,,AUTO
         2 002516   201003 236100                    LDQ     PCB,,AUTO
         2 002517   000020 772000                    QRL     16
         2 002520   203065 136100                    SBLQ    NEED_2_READ_JOBSTATS+7,,AUTO
         2 002521   000005 036007                    ADLQ    5,DL
         2 002522   203066 756100                    STQ     NEED_2_READ_JOBSTATS+8,,AUTO
         2 002523   203066 631500                    EPPR1   NEED_2_READ_JOBSTATS+8,,AUTO
         2 002524   203071 451500                    STP1    NEED_2_READ_JOBSTATS+11,,AUTO
         2 002525   000000 236000 xsym               LDQ     SEG2$
         2 002526   000003 036003                    ADLQ    3,DU
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:154  
         2 002527   203070 756100                    STQ     NEED_2_READ_JOBSTATS+10,,AUTO
         2 002530   203070 630500                    EPPR0   NEED_2_READ_JOBSTATS+10,,AUTO
         2 002531   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 002532   000000 701000 xent               TSX1    CPR$RPTERR
         2 002533   000000 011000                    NOP     0

      860    14630    3                 END;

      861    14631    2           SEG$2.ERRBUF(1) = 0;   /* Throw away errors after reporting */

  14631  2 002534   000000 470400 xsym               LDP0    SEG2$
         2 002535   000004 450100                    STZ     4,,PR0

      862    14632    2           SUB$PARAMS.BATCH_ABORTED# = %YES#;

  14632  2 002536   040000 236003                    LDQ     16384,DU
         2 002537   203047 256100                    ORSQ    SUB$PARAMS+13,,AUTO

      863    14633    2           GOTO READ;

  14633  2 002540   002231 710000 2                  TRA     READ

      864    14634        %EJECT;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:155  
      865    14635        /*
      866    14636             ***** On end_of_file write sysid & close the command STREAM...
      867    14637        */
      868    14638    2   E_READ:
      869    14639        /*E*    ERROR: CPH-E$TRUNREC-0
      870    14640                MESSAGE: Record longer than IBEX maximum of 256 chars.
      871    14641        */
      872    14642        /*E*    ERROR: CPH-E$BDSTARTNUM-0
      873    14643             MESSAGE: START parameter failed.
      874    14644        */
      875    14645        /*E*    ERROR: CPH-E$BDSTARTENDTYPE-0
      876    14646                MESSAGE: Illegal START or END option.
      877    14647              MESSAGE1: Only START=label and/or END=label is allowed for non-EDIT key type.
      878    14648        */
      879    14649    2        IF B$TCB.ALT$ -> B$ALT.ERR.CODE ~= %E$EOF OR START_METHOD ~= 0

  14649  2 002541   000000 470400 xsym  E_READ       LDP0    B$TCB$
         2 002542   000000 471500                    LDP1    0,,PR0
         2 002543   100102 236100                    LDQ     66,,PR1
         2 002544   377770 376007                    ANQ     131064,DL
         2 002545   000060 116007                    CMPQ    48,DL
         2 002546   002551 601000 2                  TNZ     OVERFLOW_ON_READ
         2 002547   200352 235100                    LDA     START_METHOD,,AUTO
         2 002550   002732 600000 2                  TZE     CLOSE_CMD_STREAM

      880    14650    2           THEN   /* A real error */
      881    14651    3              DO;

      882    14652    3   OVERFLOW_ON_READ:
      883    14653    3                 SUB$PARAMS.BATCH_ABORTED# = %YES#;

  14653  2 002551   040000 236003       OVERFLOW_ON* LDQ     16384,DU
         2 002552   203047 256100                    ORSQ    SUB$PARAMS+13,,AUTO

      884    14654    3                 CALL CONCAT (WRITEBUF,'     ',READBUF);

  14654  2 002553   040100 100400                    MLR     fill='040'O
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:156  
         2 002554   000063 000005 1                  ADSC9   E_NONAME_4_CONT+12       cn=0,n=5
         2 002555   200012 000005                    ADSC9   WRITEBUF,,AUTO           cn=0,n=5
         2 002556   040100 100500                    MLR     fill='040'O
         2 002557   200212 000373                    ADSC9   READBUF,,AUTO            cn=0,n=251
         2 002560   200013 200373                    ADSC9   WRITEBUF+1,,AUTO         cn=1,n=251

      885    14655    3                 SEG$2.FPT_WRITECC$->FPT$WRITE.BUF_.BOUND =

  14655  2 002561   000000 470400 xsym               LDP0    SEG2$
         2 002562   000161 471500                    LDP1    113,,PR0
         2 002563   000004 473400 3                  LDP3    4
         2 002564   300000 474500                    LDP4    0,,PR3
         2 002565   000000 720000 xsym               LXL0    M$IBEX_NUM
         2 002566   400000 475510                    LDP5    0,X0,PR4
         2 002567   500000 236100                    LDQ     0,,PR5
         2 002570   000004 036007                    ADLQ    4,DL
         2 002571   000377 116007                    CMPQ    255,DL
         2 002572   002574 604400 2                  TMOZ    s:14655+11
         2 002573   000377 236007                    LDQ     255,DL
         2 002574   000020 736000                    QLS     16
         2 002575   100004 676100                    ERQ     4,,PR1
         2 002576   000034 376000 xsym               ANQ     B_VECTNIL+28
         2 002577   100004 656100                    ERSQ    4,,PR1

      886    14656    3                       MINIMUM(LENGTHV(WRITEBUF),DCBADDR(M$IBEX_NUM) ->
      887    14657    3                             F$DCB.ARS# + 4);
      888    14658    3                 CALL CPE$DIAGOUT (SEG$2.FPT_WRITECC$);

  14658  2 002600   000000 236000 xsym               LDQ     SEG2$
         2 002601   000161 036003                    ADLQ    113,DU
         2 002602   203064 756100                    STQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 002603   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 002604   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 002605   000000 701000 xent               TSX1    CPE$DIAGOUT
         2 002606   000000 011000                    NOP     0

      889    14659    3                 ERR = B$TCB.ALT$ -> B$ALT.ERR;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:157  

  14659  2 002607   000000 470400 xsym               LDP0    B$TCB$
         2 002610   000000 471500                    LDP1    0,,PR0
         2 002611   100102 236100                    LDQ     66,,PR1
         2 002612   200754 756100                    STQ     ERR,,AUTO

      890    14660    3                 IF ERR.ERR# = %E$LD OR TRUNCATED_RECORD

  14660  2 002613   200754 236100                    LDQ     ERR,,AUTO
         2 002614   377770 376007                    ANQ     131064,DL
         2 002615   000070 116007                    CMPQ    56,DL
         2 002616   002621 600000 2                  TZE     s:14662
         2 002617   200374 234100                    SZN     TRUNCATED_RECORD,,AUTO
         2 002620   002624 605000 2                  TPL     s:14663

      891    14661    3                   THEN
      892    14662    3                      ERR = E_TRUNREC;

  14662  2 002621   000040 236000 1                  LDQ     E_TRUNREC
         2 002622   200754 756100                    STQ     ERR,,AUTO
         2 002623   002630 710000 2                  TRA     s:14666

      893    14663    3                 ELSE IF ERR.ERR# = %E$BADVECT1

  14663  2 002624   006450 116007                    CMPQ    3368,DL
         2 002625   002630 601000 2                  TNZ     s:14666

      894    14664    3                   THEN
      895    14665    3                      ERR = E_BDSTARTENDTYPE;

  14665  2 002626   000045 236000 1                  LDQ     E_BDSTARTENDTYPE
         2 002627   200754 756100                    STQ     ERR,,AUTO

      896    14666    3                 CALL CXP$POSTERR (ADDR(SEG$2.ERRBUF), 511, ERR,

  14666  2 002630   000000 471500                    LDP1    0,,PR0
         2 002631   000000 236000 xsym               LDQ     SEG2$
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:158  
         2 002632   000003 036003                    ADLQ    3,DU
         2 002633   203064 756100                    STQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 002634   100101 633500                    EPPR3   65,,PR1
         2 002635   203071 453500                    STP3    NEED_2_READ_JOBSTATS+11,,AUTO
         2 002636   200754 631500                    EPPR1   ERR,,AUTO
         2 002637   203070 451500                    STP1    NEED_2_READ_JOBSTATS+10,,AUTO
         2 002640   000034 236000 3                  LDQ     28
         2 002641   203067 756100                    STQ     NEED_2_READ_JOBSTATS+9,,AUTO
         2 002642   203064 634500                    EPPR4   NEED_2_READ_JOBSTATS+6,,AUTO
         2 002643   203066 454500                    STP4    NEED_2_READ_JOBSTATS+8,,AUTO
         2 002644   203066 630500                    EPPR0   NEED_2_READ_JOBSTATS+8,,AUTO
         2 002645   000022 631400 xsym               EPPR1   B_VECTNIL+18
         2 002646   000000 701000 xent               TSX1    CXP$POSTERR
         2 002647   000000 011000                    NOP     0

      897    14667    3                                   B$TCB.ALT$ -> B$ALT.DCB#);
      898    14668    3                 IF START_METHOD ~= 0

  14668  2 002650   200352 235100                    LDA     START_METHOD,,AUTO
         2 002651   002665 600000 2                  TZE     DELETE_CMD_STREAM

      899    14669    3                    THEN
      900    14670        /*E*    ERROR: CPH-E$BDSTARTNUM-0
      901    14671             MESSAGE: START parameter failed.
      902    14672        */
      903    14673    3                       CALL CXP$POSTERR (ADDR(SEG$2.ERRBUF),511,E_BDSTARTNUM);

  14673  2 002652   000000 236000 xsym               LDQ     SEG2$
         2 002653   000003 036003                    ADLQ    3,DU
         2 002654   203064 756100                    STQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 002655   000036 237000 3                  LDAQ    30
         2 002656   203066 757100                    STAQ    NEED_2_READ_JOBSTATS+8,,AUTO
         2 002657   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 002660   203065 450500                    STP0    NEED_2_READ_JOBSTATS+7,,AUTO
         2 002661   203065 630500                    EPPR0   NEED_2_READ_JOBSTATS+7,,AUTO
         2 002662   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 002663   000000 701000 xent               TSX1    CXP$POSTERR
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:159  
         2 002664   000000 011000                    NOP     0

      904    14674        /*
      905    14675             ***** Abort the copy...
      906    14676        */
      907    14677    3   DELETE_CMD_STREAM:
      908    14678        /*
      909    14679             ***** Inform the user that BATCH/XEQ/XMIT has been aborted
      910    14680        */
      911    14681    3                       CALL CXP$POSTERR (ADDR(SEG$2.ERRBUF),511,E_BDSCAN);

  14681  2 002665   000000 236000 xsym  DELETE_CMD_* LDQ     SEG2$
         2 002666   000003 036003                    ADLQ    3,DU
         2 002667   203064 756100                    STQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 002670   000034 237000 3                  LDAQ    28
         2 002671   203066 757100                    STAQ    NEED_2_READ_JOBSTATS+8,,AUTO
         2 002672   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 002673   203065 450500                    STP0    NEED_2_READ_JOBSTATS+7,,AUTO
         2 002674   203065 630500                    EPPR0   NEED_2_READ_JOBSTATS+7,,AUTO
         2 002675   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 002676   000000 701000 xent               TSX1    CXP$POSTERR
         2 002677   000000 011000                    NOP     0

      912    14682        /*
      913    14683             ***** If the command stream is currently open, close it
      914    14684                   scratch. Then goto CLEAN_UP code...
      915    14685        */
      916    14686    3                       IF DCBADDR(M$IBEX1_NUM) -> F$DCB.FCD#

  14686  2 002700   000004 470400 3                  LDP0    4
         2 002701   000000 471500                    LDP1    0,,PR0
         2 002702   000000 720000 xsym               LXL0    M$IBEX1_NUM
         2 002703   100000 473510                    LDP3    0,X0,PR1
         2 002704   300031 236100                    LDQ     25,,PR3
         2 002705   020000 316007                    CANQ    8192,DL
         2 002706   002716 600000 2                  TZE     s:14693

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:160  
      917    14687    3                          THEN
      918    14688    4                             DO;   /* Close COMMAND STREAM */

      919    14689    4                                FPT_CLOSE.V.DISP# = 0;

  14689  2 002707   000000 236003                    LDQ     0,DU
         2 002710   200572 552104                    STBQ    FPT_CLOSE+26,'04'O,AUTO

      920    14690    4                                FPT_CLOSE.V.DCB# = M$IBEX1_NUM;

  14690  2 002711   200572 740100                    STX0    FPT_CLOSE+26,,AUTO

      921    14691    4                                CALL M$CLOSE (FPT_CLOSE) ALTRET(ABORT);

  14691  2 002712   200540 630500                    EPPR0   FPT_CLOSE,,AUTO
         2 002713   450001 713400                    CLIMB   alt,close
         2 002714   406000 401760                    pmme    nvectors=13
         2 002715   003262 702000 2                  TSX2    ABORT

      922    14692    4                             END;

      923    14693    3                 CALL CPR$RPTERR (SEG$2.ERRBUF,511);

  14693  2 002716   000034 236000 3                  LDQ     28
         2 002717   203065 756100                    STQ     NEED_2_READ_JOBSTATS+7,,AUTO
         2 002720   000000 236000 xsym               LDQ     SEG2$
         2 002721   000003 036003                    ADLQ    3,DU
         2 002722   203064 756100                    STQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 002723   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 002724   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 002725   000000 701000 xent               TSX1    CPR$RPTERR
         2 002726   000000 011000                    NOP     0

      924    14694    3                 SEG$2.ERRBUF(1) = 0;   /* Throw away error */

  14694  2 002727   000000 470400 xsym               LDP0    SEG2$
         2 002730   000004 450100                    STZ     4,,PR0
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:161  

      925    14695    3                       GOTO CLEAN_UP;

  14695  2 002731   003072 710000 2                  TRA     CLEAN_UP

      926    14696    3              END;
      927    14697    2   CLOSE_CMD_STREAM:
      928    14698    2           IF SUB$PARAMS.BATCH_ABORTED#

  14698  2 002732   203047 236100       CLOSE_CMD_S* LDQ     SUB$PARAMS+13,,AUTO
         2 002733   040000 316003                    CANQ    16384,DU
         2 002734   002665 601000 2                  TNZ     DELETE_CMD_STREAM

      929    14699    2              THEN
      930    14700    2                 GOTO DELETE_CMD_STREAM;
      931    14701        /*
      932    14702             ***** Close the command stream ...
      933    14703        */
      934    14704    2           IF BLK$ -> P$B.CODE ~= XEQCMND AND NOT SUB$PARAMS.TEST_OPT#

  14704  2 002735   200011 470500                    LDP0    BLK$,,AUTO
         2 002736   000000 720100                    LXL0    0,,PR0
         2 002737   000111 100003                    CMPX0   73,DU
         2 002740   003071 600000 2                  TZE     s:14769
         2 002741   100000 316003                    CANQ    32768,DU
         2 002742   003071 601000 2                  TNZ     s:14769

      935    14705    2              THEN
      936    14706    3                 DO;   /* Close COMMAND STREAM */

      937    14707    3                    IF NOT DCBADDR(M$IBEX1_NUM) -> F$DCB.FCD#

  14707  2 002743   000004 471400 3                  LDP1    4
         2 002744   100000 473500                    LDP3    0,,PR1
         2 002745   000000 721000 xsym               LXL1    M$IBEX1_NUM
         2 002746   300000 474511                    LDP4    0,X1,PR3
         2 002747   400031 236100                    LDQ     25,,PR4
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:162  
         2 002750   020000 316007                    CANQ    8192,DL
         2 002751   002665 600000 2                  TZE     DELETE_CMD_STREAM
         2 002752   400075 236100                    LDQ     61,,PR4
         2 002753   000000 116000 xsym               CMPQ    B$PS0$
         2 002754   002757 601000 2                  TNZ     s:14713
         2 002755   400042 235100                    LDA     34,,PR4
         2 002756   002665 600000 2                  TZE     DELETE_CMD_STREAM

      938    14708    3                    OR DCBADDR(M$IBEX1_NUM) -> F$DCB.UB$ = B$PS0$
      939    14709    3                    AND DCBADDR(M$IBEX1_NUM) -> F$DCB.NRECS# = 0
      940    14710    3                       THEN   /* Nothing in stream. Delete it */
      941    14711    3                          GOTO DELETE_CMD_STREAM;
      942    14712
      943    14713    3                    FPT_CLOSE.V.DISP# = %SAVE#;

  14713  2 002757   000002 236007                    LDQ     2,DL
         2 002760   200572 552104                    STBQ    FPT_CLOSE+26,'04'O,AUTO

      944    14714    3                    FPT_CLOSE.V.DCB# = M$IBEX1_NUM;

  14714  2 002761   200572 741100                    STX1    FPT_CLOSE+26,,AUTO

      945    14715    3                    CALL M$CLOSE (FPT_CLOSE) ALTRET(ABORT);

  14715  2 002762   200540 630500                    EPPR0   FPT_CLOSE,,AUTO
         2 002763   450001 713400                    CLIMB   alt,close
         2 002764   406000 401760                    pmme    nvectors=13
         2 002765   003262 702000 2                  TSX2    ABORT

      946    14716        /*
      947    14717             ***** If this was a BATCH command and TEST or
      948    14718                   NSTATUS was not specified, then get the
      949    14719                   status message from CHECK. Also enters the
      950    14720                   SYSID into the NOTIFY list ...
      951    14721        */
      952    14722    3                    IF BLK$ -> P$B.CODE ~= BATCHCMND

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:163  
  14722  2 002766   200011 470500                    LDP0    BLK$,,AUTO
         2 002767   000000 720100                    LXL0    0,,PR0
         2 002770   000006 100003                    CMPX0   6,DU
         2 002771   003071 601000 2                  TNZ     s:14769

      953    14723    3                       THEN
      954    14724    3                          EXIT;
      955    14725                            /* Get status of job */
      956    14726        /*
      957    14727             ***** Get the sysid and setup to fake out check ...
      958    14728        */
      959    14729    3                    ADDR(FAKE_NODE3)->P$S.COUNT = 6;

  14729  2 002772   006000 236003                    LDQ     3072,DU
         2 002773   201035 552140                    STBQ    FAKE_NODE3+4,'40'O,AUTO

      960    14730    3                    ADDR(FAKE_NODE3)->P$S.TEXT =

  14730  2 002774   201035 236100                    LDQ     FAKE_NODE3+4,,AUTO
         2 002775   000033 772000                    QRL     27
         2 002776   000004 471400 3                  LDP1    4
         2 002777   100000 473500                    LDP3    0,,PR1
         2 003000   000000 720000 xsym               LXL0    M$IBEX1_NUM
         2 003001   300000 474510                    LDP4    0,X0,PR3
         2 003002   000000 621006                    EAX1    0,QL
         2 003003   040140 100500                    MLR     fill='040'O
         2 003004   400010 200037                    ADSC9   8,,PR4                   cn=1,n=31
         2 003005   201035 200011                    ADSC9   FAKE_NODE3+4,,AUTO       cn=1,n=*X1

      961    14731    3                      DCBADDR(M$IBEX1_NUM) -> F$DCB.NAME#.C;
      962    14732    3                    PCB.OUT$ = ADDR(FAKE_NODE);

  14732  2 003006   201021 635500                    EPPR5   FAKE_NODE,,AUTO
         2 003007   201006 455500                    STP5    PCB+3,,AUTO

      963    14733                  /*  FAKE_NODE.TEMP passes the NSTATUS_OPT# to CPK$SUBMIT_CHECK.
      964    14734                      FAKE_NODE2.TEMP tells CPK$SUBMIT_CHECK whether this is a cross
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:164  
      965    14735                                account batch job.
      966    14736                  */
      967    14737    3                    FAKE_NODE.TEMP = NSTATUS_OPT# ;

  14737  2 003010   200367 236100                    LDQ     NSTATUS_OPT#,,AUTO
         2 003011   201021 676100                    ERQ     FAKE_NODE,,AUTO
         2 003012   400000 376003                    ANQ     -131072,DU
         2 003013   201021 656100                    ERSQ    FAKE_NODE,,AUTO

      968    14738    3                    FAKE_NODE.NSUBLKS = 1;

  14738  2 003014   000001 222003                    LDX2    1,DU
         2 003015   201022 742100                    STX2    FAKE_NODE+1,,AUTO

      969    14739    3                    FAKE_NODE2.TEMP = CROSS_ACCT_BATCH_FLG;

  14739  2 003016   200370 236100                    LDQ     CROSS_ACCT_BATCH_FLG,,AUTO
         2 003017   201025 676100                    ERQ     FAKE_NODE2,,AUTO
         2 003020   400000 376003                    ANQ     -131072,DU
         2 003021   201025 656100                    ERSQ    FAKE_NODE2,,AUTO

      970    14740    3                    FAKE_NODE2.NSUBLKS = 1;

  14740  2 003022   201026 742100                    STX2    FAKE_NODE2+1,,AUTO

      971    14741    3                    FAKE_NODE3.NSUBLKS = 1;

  14741  2 003023   201032 742100                    STX2    FAKE_NODE3+1,,AUTO

      972    14742    3                    FAKE_NODE.SUBLK$(0) = ADDR(FAKE_NODE2);

  14742  2 003024   201025 636500                    EPPR6   FAKE_NODE2,,AUTO
         2 003025   201024 456500                    STP6    FAKE_NODE+3,,AUTO

      973    14743    3                    FAKE_NODE2.SUBLK$(0) = ADDR(FAKE_NODE3);

  14743  2 003026   201031 637500                    EPPR7   FAKE_NODE3,,AUTO
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:165  
         2 003027   201030 457500                    STP7    FAKE_NODE2+3,,AUTO

      974    14744    3                    FAKE_NODE3.SUBLK$(0) = ADDR(ADDR(FAKE_NODE3)->P$S.COUNT);

  14744  2 003030   201035 630500                    EPPR0   FAKE_NODE3+4,,AUTO
         2 003031   201034 450500                    STP0    FAKE_NODE3+3,,AUTO

      975    14745    3                    FAKE_NODE2.CODE = %CH_SYSIDCMD;

  14745  2 003032   000002 223003                    LDX3    2,DU
         2 003033   201025 443100                    SXL3    FAKE_NODE2,,AUTO

      976    14746    3                    FAKE_NODE3.CODE = %CH_SYSID;

  14746  2 003034   000772 224003                    LDX4    506,DU
         2 003035   201031 444100                    SXL4    FAKE_NODE3,,AUTO

      977    14747    3                    IF NOT NSTATUS_OPT#

  14747  2 003036   200367 234100                    SZN     NSTATUS_OPT#,,AUTO
         2 003037   003057 604000 2                  TMI     s:14762

      978    14748    3                     THEN
      979    14749    4                       DO ;

      980    14750        /*
      981    14751             ***** Wait 1 sec so PRESCAN and all others to look at
      982    14752                   the file...
      983    14753        */
      984    14754    4                         FPT_WAIT = CFPT_WAIT;

  14754  2 003040   000100 100400                    MLR     fill='000'O
         2 003041   000000 000030 xsym               ADSC9   CFPT_WAIT                cn=0,n=24
         2 003042   200700 000030                    ADSC9   FPT_WAIT,,AUTO           cn=0,n=24

      985    14755    4                         FPT_WAIT.V_ = VECTOR(FPT_WAIT.V);

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:166  
  14755  2 003043   000016 235000 3                  LDA     14
         2 003044   203064 452500                    STP2    NEED_2_READ_JOBSTATS+6,,AUTO
         2 003045   203064 236100                    LDQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 003046   000704 036003                    ADLQ    452,DU
         2 003047   200700 757100                    STAQ    FPT_WAIT,,AUTO

      986    14756    4                         FPT_WAIT.V.UNITS# = 1;   /* 1 sec */

  14756  2 003050   000001 235007                    LDA     1,DL
         2 003051   200704 755100                    STA     FPT_WAIT+4,,AUTO

      987    14757    5                         CALL M$WAIT (FPT_WAIT) WHENALTRETURN DO; END;

  14757  2 003052   200700 630500                    EPPR0   FPT_WAIT,,AUTO
         2 003053   420006 713400                    CLIMB   alt,+8198
         2 003054   400400 401760                    pmme    nvectors=2
         2 003055   003057 702000 2                  TSX2    s:14762
         2 003056   003057 710000 2                  TRA     s:14762

      988    14758    4                       END ; /* Then Do */

      989    14759        /*
      990    14760             ***** Call check to get the status message...
      991    14761        */
      992    14762    3                    CALL CPK$SUBMIT_CHECK (PCB) ALTRET(ABORT);

  14762  2 003057   201003 630500                    EPPR0   PCB,,AUTO
         2 003060   203064 450500                    STP0    NEED_2_READ_JOBSTATS+6,,AUTO
         2 003061   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 003062   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003063   000000 701000 xent               TSX1    CPK$SUBMIT_CHECK
         2 003064   003262 702000 2                  TSX2    ABORT

      993    14763    3                    SEG$2.ERRBUF(1) = 0;   /* Throw away msg */

  14763  2 003065   000000 470400 xsym               LDP0    SEG2$
         2 003066   000004 450100                    STZ     4,,PR0
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:167  

      994    14764    3                    FAKE_NODE.TEMP = %NO#;

  14764  2 003067   000031 236000 xsym               LDQ     B_VECTNIL+25
         2 003070   201021 356100                    ANSQ    FAKE_NODE,,AUTO

      995    14765    3                 END;   /* get status of job */

      996    14766        /*
      997    14767             ***** Delete online and default subs...
      998    14768        */
      999    14769    3         DO WHILE('0'B);

  14769  2 003071   003074 710000 2                  TRA     s:14778

     1000    14770    3   CLEAN_UP:
     1001    14771    3             SUB$PARAMS.BATCH_ABORTED# = %YES#;

  14771  2 003072   040000 236003       CLEAN_UP     LDQ     16384,DU
         2 003073   203047 256100                    ORSQ    SUB$PARAMS+13,,AUTO

     1002    14772    3             END;

     1003    14773        /*
     1004    14774             ***** if a !JOB cmd was found then dont close the
     1005    14775                   jcl file. else close the jcl file and
     1006    14776                   delete all default and online subs...
     1007    14777        */
     1008    14778    2           IF JOB_FLAG#

  14778  2 003074   200365 234100                    SZN     JOB_FLAG#,,AUTO
         2 003075   003174 605000 2                  TPL     s:14813

     1009    14779    2              THEN
     1010    14780    3                 DO;

     1011    14781    3                    IF DCBADDR(M$IBEX_NUM) -> F$DCB.FCD# = %YES#
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:168  

  14781  2 003076   000004 470400 3                  LDP0    4
         2 003077   000000 471500                    LDP1    0,,PR0
         2 003100   000000 720000 xsym               LXL0    M$IBEX_NUM
         2 003101   100000 473510                    LDP3    0,X0,PR1
         2 003102   300031 236100                    LDQ     25,,PR3
         2 003103   020000 316007                    CANQ    8192,DL
         2 003104   003114 600000 2                  TZE     s:14791

     1012    14782    3                       THEN
     1013    14783    4                          DO;   /* Close M$IBEX */

     1014    14784    4                             FPT_CLOSE.V.DISP# = %SAVE#;

  14784  2 003105   000002 236007                    LDQ     2,DL
         2 003106   200572 552104                    STBQ    FPT_CLOSE+26,'04'O,AUTO

     1015    14785    4                             FPT_CLOSE.V.DCB# = M$IBEX_NUM;

  14785  2 003107   200572 740100                    STX0    FPT_CLOSE+26,,AUTO

     1016    14786    4                             CALL M$CLOSE (FPT_CLOSE) ALTRET(ABORT);

  14786  2 003110   200540 630500                    EPPR0   FPT_CLOSE,,AUTO
         2 003111   450001 713400                    CLIMB   alt,close
         2 003112   406000 401760                    pmme    nvectors=13
         2 003113   003262 702000 2                  TSX2    ABORT

     1017    14787    4                          END;

     1018    14788        /*
     1019    14789             ***** Setup FPT_OPEN for opening jcl file ...
     1020    14790        */
     1021    14791    3                    FPT_OPEN.V.DCB# = M$IBEX_NUM;

  14791  2 003114   000000 720000 xsym               LXL0    M$IBEX_NUM
         2 003115   200476 740100                    STX0    FPT_OPEN+36,,AUTO
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:169  

     1022    14792    3                    FPT_OPEN.V.FUN# = %IN#;

  14792  2 003116   002000 236007                    LDQ     1024,DL
         2 003117   200477 552110                    STBQ    FPT_OPEN+37,'10'O,AUTO

     1023    14793    3                    CALL OPEN_FID(JOB_FID$ -> P$B.SUBLK$(0)) ALTRET(CLOSE_DCBS);

  14793  2 003120   200006 236100                    LDQ     JOB_FID$,,AUTO
         2 003121   000003 036003                    ADLQ    3,DU
         2 003122   203053 756100                    STQ     I+1,,AUTO
         2 003123   006746 701000 2                  TSX1    OPEN_FID
         2 003124   003307 702000 2                  TSX2    CLOSE_DCBS

     1024    14794    3                    IF DCBADDR(M$IBEX_NUM) -> F$DCB.ORG# = %CONSEC#

  14794  2 003125   000004 470400 3                  LDP0    4
         2 003126   000000 471500                    LDP1    0,,PR0
         2 003127   000000 720000 xsym               LXL0    M$IBEX_NUM
         2 003130   100000 473510                    LDP3    0,X0,PR1
         2 003131   300032 236100                    LDQ     26,,PR3
         2 003132   777000 376003                    ANQ     -512,DU
         2 003133   001000 116003                    CMPQ    512,DU
         2 003134   003140 600000 2                  TZE     s:14798
         2 003135   200412 236100                    LDQ     FPT_READ+8,,AUTO
         2 003136   100000 316007                    CANQ    32768,DL
         2 003137   003152 601000 2                  TNZ     s:14804

     1025    14795    3                      OR NOT FPT_READ.V.KEYR#
     1026    14796    3                       THEN
     1027    14797    4                          DO;

     1028    14798    4                             FPT_PRECORD.V.KEYS# = %NO#;

  14798  2 003140   000040 236000 3                  LDQ     32
         2 003141   200674 356100                    ANSQ    FPT_PRECORD+6,,AUTO

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:170  
     1029    14799    4                             FPT_PRECORD.V.N# = SUB$PARAMS.REC_NUM -1;

  14799  2 003142   203046 235100                    LDA     SUB$PARAMS+12,,AUTO
         2 003143   000001 135007                    SBLA    1,DL
         2 003144   200675 755100                    STA     FPT_PRECORD+7,,AUTO

     1030    14800    4                             CALL M$PRECORD (FPT_PRECORD) ALTRET(CLOSE_DCBS);

  14800  2 003145   200666 630500                    EPPR0   FPT_PRECORD,,AUTO
         2 003146   440003 713400                    CLIMB   alt,+16387
         2 003147   401000 401760                    pmme    nvectors=3
         2 003150   003307 702000 2                  TSX2    CLOSE_DCBS

     1031    14801    4                          END;

  14801  2 003151   003166 710000 2                  TRA     s:14809

     1032    14802    3                       ELSE
     1033    14803    4                          DO;

     1034    14804    4                             FPT_PRECORD.V.KEYS# = %YES#;

  14804  2 003152   400000 236007                    LDQ     -131072,DL
         2 003153   200674 256100                    ORSQ    FPT_PRECORD+6,,AUTO

     1035    14805    4                             FPT_PRECORD.V.N# = 0;

  14805  2 003154   200675 450100                    STZ     FPT_PRECORD+7,,AUTO

     1036    14806    4                             FPT_PRECORD.KEY_ = VECTOR(READ_KEY);

  14806  2 003155   777640 235007                    LDA     -96,DL
         2 003156   203064 452500                    STP2    NEED_2_READ_JOBSTATS+6,,AUTO
         2 003157   203064 236100                    LDQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 003160   000756 036003                    ADLQ    494,DU
         2 003161   200670 757100                    STAQ    FPT_PRECORD+2,,AUTO

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:171  
     1037    14807    4                             CALL M$PRECORD (FPT_PRECORD) ALTRET(CLOSE_DCBS);

  14807  2 003162   200666 630500                    EPPR0   FPT_PRECORD,,AUTO
         2 003163   440003 713400                    CLIMB   alt,+16387
         2 003164   401000 401760                    pmme    nvectors=3
         2 003165   003307 702000 2                  TSX2    CLOSE_DCBS

     1038    14808    4                          END;

     1039    14809    3                    CALL M$READ (FPT_READ) ALTRET(CLOSE_DCBS);

  14809  2 003166   200402 630500                    EPPR0   FPT_READ,,AUTO
         2 003167   440000 713400                    CLIMB   alt,read
         2 003170   401400 401760                    pmme    nvectors=4
         2 003171   003307 702000 2                  TSX2    CLOSE_DCBS

     1040    14810    3                    JOB_FLAG# = %NO#;

  14810  2 003172   200365 450100                    STZ     JOB_FLAG#,,AUTO

     1041    14811    3                    GOTO OPEN_CMD_STREAM;

  14811  2 003173   001205 710000 2                  TRA     OPEN_CMD_STREAM

     1042    14812    3                 END;
     1043    14813    3           DO WHILE (SUB$PARAMS.ONLINE_DEF_HEAD$ ~= ADDR(NIL));

  14813  2 003174   003210 710000 2                  TRA     s:14817

     1044    14814    3              X$MCB.ADDRESS$ = SUB$PARAMS.ONLINE_DEF_HEAD$;

  14814  2 003175   203032 236100                    LDQ     SUB$PARAMS,,AUTO
         2 003176   200763 756100                    STQ     X$MCB,,AUTO

     1045    14815    3             SUB$PARAMS.ONLINE_DEF_HEAD$ = SUB$PARAMS.ONLINE_DEF_HEAD$ -> X$MAP.LINK$;

  14815  2 003177   203032 470500                    LDP0    SUB$PARAMS,,AUTO
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:172  
         2 003200   000000 236100                    LDQ     0,,PR0
         2 003201   203032 756100                    STQ     SUB$PARAMS,,AUTO

     1046    14816    3              CALL X$DEALLOCATE (X$MCB);

  14816  2 003202   200763 630500                    EPPR0   X$MCB,,AUTO
         2 003203   203064 450500                    STP0    NEED_2_READ_JOBSTATS+6,,AUTO
         2 003204   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 003205   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003206   000000 701000 xent               TSX1    X$DEALLOCATE
         2 003207   000000 011000                    NOP     0

     1047    14817    3           END;

  14817  2 003210   203032 236100                    LDQ     SUB$PARAMS,,AUTO
         2 003211   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 003212   003175 601000 2                  TNZ     s:14814

     1048    14818    3           DO WHILE (SUB$PARAMS.DEFAULT_DEF_HEAD$ ~= ADDR(NIL));

  14818  2 003213   003227 710000 2                  TRA     s:14822

     1049    14819    3              X$MCB.ADDRESS$ = SUB$PARAMS.DEFAULT_DEF_HEAD$;

  14819  2 003214   203035 236100                    LDQ     SUB$PARAMS+3,,AUTO
         2 003215   200763 756100                    STQ     X$MCB,,AUTO

     1050    14820    3              SUB$PARAMS.DEFAULT_DEF_HEAD$ = SUB$PARAMS.DEFAULT_DEF_HEAD$ -> X$MAP.
             14820                       LINK$;

  14820  2 003216   203035 470500                    LDP0    SUB$PARAMS+3,,AUTO
         2 003217   000000 236100                    LDQ     0,,PR0
         2 003220   203035 756100                    STQ     SUB$PARAMS+3,,AUTO

     1051    14821    3              CALL X$DEALLOCATE (X$MCB);

  14821  2 003221   200763 630500                    EPPR0   X$MCB,,AUTO
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:173  
         2 003222   203064 450500                    STP0    NEED_2_READ_JOBSTATS+6,,AUTO
         2 003223   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 003224   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003225   000000 701000 xent               TSX1    X$DEALLOCATE
         2 003226   000000 011000                    NOP     0

     1052    14822    3           END;

  14822  2 003227   203035 236100                    LDQ     SUB$PARAMS+3,,AUTO
         2 003230   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 003231   003214 601000 2                  TNZ     s:14819

     1053    14823        /*
     1054    14824             ***** Close the jcl file...
     1055    14825        */
     1056    14826    2   CLOSE_JCL_FILE:
     1057    14827    2           IF DCBADDR(M$IBEX_NUM) -> F$DCB.FCD# = %YES#

  14827  2 003232   000004 470400 3     CLOSE_JCL_F* LDP0    4
         2 003233   000000 471500                    LDP1    0,,PR0
         2 003234   000000 720000 xsym               LXL0    M$IBEX_NUM
         2 003235   100000 473510                    LDP3    0,X0,PR1
         2 003236   300031 236100                    LDQ     25,,PR3
         2 003237   020000 316007                    CANQ    8192,DL
         2 003240   003250 600000 2                  TZE     s:14834

     1058    14828    2              THEN
     1059    14829    3                 DO;   /* Close M$IBEX */

     1060    14830    3                    FPT_CLOSE.V.DISP# = %SAVE#;

  14830  2 003241   000002 236007                    LDQ     2,DL
         2 003242   200572 552104                    STBQ    FPT_CLOSE+26,'04'O,AUTO

     1061    14831    3                    FPT_CLOSE.V.DCB# = M$IBEX_NUM;

  14831  2 003243   200572 740100                    STX0    FPT_CLOSE+26,,AUTO
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:174  

     1062    14832    3                    CALL M$CLOSE (FPT_CLOSE) ALTRET(ABORT);

  14832  2 003244   200540 630500                    EPPR0   FPT_CLOSE,,AUTO
         2 003245   450001 713400                    CLIMB   alt,close
         2 003246   406000 401760                    pmme    nvectors=13
         2 003247   003262 702000 2                  TSX2    ABORT

     1063    14833    3                 END;   /* Close M$IBEX */

     1064    14834    2         END;   /* Do main loop ... end */

  14834  2 003250   200362 235100                    LDA     NUM_FILES,,AUTO
         2 003251   000001 035007                    ADLA    1,DL
         2 003252   200362 755100                    STA     NUM_FILES,,AUTO
         2 003253   200011 470500                    LDP0    BLK$,,AUTO
         2 003254   000001 236100                    LDQ     1,,PR0
         2 003255   000022 772000                    QRL     18
         2 003256   200362 116100                    CMPQ    NUM_FILES,,AUTO
         2 003257   003261 600000 2                  TZE     s:14839
         2 003260   000254 603000 2                  TRC     s:14146

     1065    14835        %EJECT;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:175  
     1066    14836        /*
     1067    14837             ***** Error conditions ...
     1068    14838        */
     1069    14839    2        DO WHILE (%NO#);

  14839  2 003261   003307 710000 2                  TRA     CLOSE_DCBS

     1070    14840    2   ABORT:  ;

  14840  2 003262                       ABORT        null
     1071    14841    2           CALL CXP$POSTERR (ADDR(SEG$2.ERRBUF),511,B$TCB.ALT$ -> B$ALT.ERR,,

  14841  2 003262   000000 470400 xsym               LDP0    B$TCB$
         2 003263   000000 471500                    LDP1    0,,PR0
         2 003264   000000 236000 xsym               LDQ     SEG2$
         2 003265   000003 036003                    ADLQ    3,DU
         2 003266   203064 756100                    STQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 003267   100101 633500                    EPPR3   65,,PR1
         2 003270   203071 453500                    STP3    NEED_2_READ_JOBSTATS+11,,AUTO
         2 003271   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 003272   203070 756100                    STQ     NEED_2_READ_JOBSTATS+10,,AUTO
         2 003273   100102 634500                    EPPR4   66,,PR1
         2 003274   203067 454500                    STP4    NEED_2_READ_JOBSTATS+9,,AUTO
         2 003275   000034 236000 3                  LDQ     28
         2 003276   203066 756100                    STQ     NEED_2_READ_JOBSTATS+8,,AUTO
         2 003277   203064 631500                    EPPR1   NEED_2_READ_JOBSTATS+6,,AUTO
         2 003300   203065 451500                    STP1    NEED_2_READ_JOBSTATS+7,,AUTO
         2 003301   203065 630500                    EPPR0   NEED_2_READ_JOBSTATS+7,,AUTO
         2 003302   000023 631400 xsym               EPPR1   B_VECTNIL+19
         2 003303   000000 701000 xent               TSX1    CXP$POSTERR
         2 003304   000000 011000                    NOP     0

     1072    14842    2                B$TCB.ALT$ -> B$ALT.DCB#);
     1073    14843    2           SUB$PARAMS.BATCH_ABORTED# = %YES#;

  14843  2 003305   040000 236003                    LDQ     16384,DU
         2 003306   203047 256100                    ORSQ    SUB$PARAMS+13,,AUTO
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:176  

     1074    14844    2        END;

     1075    14845        %EJECT;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:177  
     1076    14846        /*
     1077    14847             ***** If xeq then the command stream is
     1078    14848                   still open. close it...
     1079    14849        */
     1080    14850    1   CLOSE_DCBS:
     1081    14851    1        IF DCBADDR(M$IBEX_NUM)->F$DCB.FCD# = %YES#

  14851  2 003307   000004 470400 3     CLOSE_DCBS   LDP0    4
         2 003310   000000 471500                    LDP1    0,,PR0
         2 003311   000000 720000 xsym               LXL0    M$IBEX_NUM
         2 003312   100000 473510                    LDP3    0,X0,PR1
         2 003313   300031 236100                    LDQ     25,,PR3
         2 003314   020000 316007                    CANQ    8192,DL
         2 003315   003325 600000 2                  TZE     E_CLOSE

     1082    14852    1           THEN   /* somehow we missed a close */
     1083    14853    2              DO;

     1084    14854    2                 FPT_CLOSE.V.DISP# = %SAVE#;

  14854  2 003316   000002 236007                    LDQ     2,DL
         2 003317   200572 552104                    STBQ    FPT_CLOSE+26,'04'O,AUTO

     1085    14855    2                 FPT_CLOSE.V.DCB# = M$IBEX_NUM;

  14855  2 003320   200572 740100                    STX0    FPT_CLOSE+26,,AUTO

     1086    14856    2                 CALL M$CLOSE (FPT_CLOSE) ALTRET(E_CLOSE);

  14856  2 003321   200540 630500                    EPPR0   FPT_CLOSE,,AUTO
         2 003322   450001 713400                    CLIMB   alt,close
         2 003323   406000 401760                    pmme    nvectors=13
         2 003324   003325 702000 2                  TSX2    E_CLOSE

     1087    14857    2              END;

  14851  2 003325                       E_CLOSE      null
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:178  
     1088    14858    1   E_CLOSE: ;   /* ignore altreturn */
     1089    14859    1        IF DCBADDR(M$IBEX1_NUM)->F$DCB.FCD# = %YES#

  14859  2 003325   000004 470400 3                  LDP0    4
         2 003326   000000 471500                    LDP1    0,,PR0
         2 003327   000000 720000 xsym               LXL0    M$IBEX1_NUM
         2 003330   100000 473510                    LDP3    0,X0,PR1
         2 003331   300031 236100                    LDQ     25,,PR3
         2 003332   020000 316007                    CANQ    8192,DL
         2 003333   003343 600000 2                  TZE     E_CLOSE1

     1090    14860    1           THEN   /* close the command stream */
     1091    14861    2              DO;

     1092    14862    2                 FPT_CLOSE.V.DISP# = %SAVE#;

  14862  2 003334   000002 236007                    LDQ     2,DL
         2 003335   200572 552104                    STBQ    FPT_CLOSE+26,'04'O,AUTO

     1093    14863    2                 FPT_CLOSE.V.DCB# = M$IBEX1_NUM;

  14863  2 003336   200572 740100                    STX0    FPT_CLOSE+26,,AUTO

     1094    14864    2                 CALL M$CLOSE (FPT_CLOSE) ALTRET(E_CLOSE1);

  14864  2 003337   200540 630500                    EPPR0   FPT_CLOSE,,AUTO
         2 003340   450001 713400                    CLIMB   alt,close
         2 003341   406000 401760                    pmme    nvectors=13
         2 003342   003343 702000 2                  TSX2    E_CLOSE1

     1095    14865    2              END;

  14859  2 003343                       E_CLOSE1     null
     1096    14866    1   E_CLOSE1: ;   /* ignore altreturn */
     1097    14867        /*
     1098    14868             ***** Release the page(s) which
     1099    14869                   were used to store SUBS...
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:179  
     1100    14870        */
     1101    14871    1   REL_PAGES:
     1102    14872    1        CALL CPC$RELSEG (SEG3$);

  14872  2 003343   000041 630400 3     REL_PAGES    EPPR0   33
         2 003344   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003345   000000 701000 xent               TSX1    CPC$RELSEG
         2 003346   000000 011000                    NOP     0

     1103    14873        /*
     1104    14874             ***** Since M$IBEX was used here it must be
     1105    14875                   re-opened to the COMMAND STREAM ...
     1106    14876        */
     1107    14877    1        CALL CPB$OPENCS;

  14877  2 003347   000002 631400 xsym               EPPR1   B_VECTNIL+2
         2 003350   000000 701000 xent               TSX1    CPB$OPENCS
         2 003351   000000 011000                    NOP     0

     1108    14878    1        IF SUB$PARAMS.BATCH_ABORTED#

  14878  2 003352   203047 236100                    LDQ     SUB$PARAMS+13,,AUTO
         2 003353   040000 316003                    CANQ    16384,DU
         2 003354   003356 600000 2                  TZE     s:14882

     1109    14879    1           THEN   /* Errors! */
     1110    14880    1              ALTRETURN;

  14880  2 003355   000000 702200 xent               TSX2  ! X66_AALT

     1111    14881    1           ELSE   /* AOK! */
     1112    14882    1              RETURN;

  14882  2 003356   000000 702200 xent               TSX2  ! X66_ARET

     1113    14883        %EJECT ;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:180  
     1114    14884    1   CHK_FOLLOW_CONDITION: PROC(BLK$) ALTRET ;

  14884  2 003357   203050 741300       CHK_FOLLOW_* STX1  ! SUB$PARAMS+14,,AUTO

     1115    14885
     1116    14886    2   DCL BLK$ PTR PARAM ;
     1117    14887
     1118    14888    2   DCL I UBIN WORD ;
     1119    14889    2   DCL J UBIN WORD ;
     1120    14890    2   DCL SYSID UBIN HALF ;
     1121    14891    2   DCL TEMP$ PTR ;
     1122    14892    2   DCL NEED_2_READ_JOBSTATS BIT(1) ;
     1123    14893
     1124    14894    2     IBEX_OPEN_2_JOBSTATS = %NO# ;

  14894  2 003360   200375 450100                    STZ     IBEX_OPEN_2_JOBSTATS,,AUTO

     1125    14895    2     NEED_2_READ_JOBSTATS = %NO# ;

  14895  2 003361   203056 450100                    STZ     NEED_2_READ_JOBSTATS,,AUTO

     1126    14896    2     NEED_2_RELEASE_IBEX2 = %NO# ;

  14896  2 003362   200376 450100                    STZ     NEED_2_RELEASE_IBEX2,,AUTO

     1127    14897    2     NEED_ALTRETURN = %NO# ;

  14897  2 003363   200377 450100                    STZ     NEED_ALTRETURN,,AUTO

     1128    14898    2     XSJ_PARAM = CXSJ_PARAM ;

  14898  2 003364   000100 100400                    MLR     fill='000'O
         2 003365   000002 000040 1                  ADSC9   CXSJ_PARAM               cn=0,n=32
         2 003366   200744 000040                    ADSC9   XSJ_PARAM,,AUTO          cn=0,n=32

     1129    14899    2     XSJ_PARAM.BUF_ = VECTOR(SYSID) ;

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:181  
  14899  2 003367   777640 235007                    LDA     -96,DL
         2 003370   203064 452500                    STP2    NEED_2_READ_JOBSTATS+6,,AUTO
         2 003371   203064 236100                    LDQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 003372   003054 036003                    ADLQ    1580,DU
         2 003373   200744 757100                    STAQ    XSJ_PARAM,,AUTO

     1130    14900    2     XSJ_PARAM.DCB# = M$IBEX2_NUM ;

  14900  2 003374   000000 720000 xsym               LXL0    M$IBEX2_NUM
         2 003375   200751 740100                    STX0    XSJ_PARAM+5,,AUTO

     1131    14901    2     FOL_ACCT = B$JIT.ACCN ; /* Setup default account name for follow test */

  14901  2 003376   000000 470400 xsym               LDP0    B$JIT$
         2 003377   040100 100500                    MLR     fill='040'O
         2 003400   000001 000010                    ADSC9   1,,PR0                   cn=0,n=8
         2 003401   200346 000010                    ADSC9   FOL_ACCT,,AUTO           cn=0,n=8

     1132    14902
     1133    14903    3     DO I=0 TO BLK$->P$B.NSUBLKS-1 ;

  14903  2 003402   203052 450100                    STZ     I,,AUTO
         2 003403   003561 710000 2                  TRA     s:14948+3

     1134    14904    3         IF BLK$->P$B.SUBLK$(I)->P$S.CODE = JOB_ACCTNAME

  14904  2 003404   203051 470500                    LDP0    @BLK$,,AUTO
         2 003405   000000 471500                    LDP1    0,,PR0
         2 003406   203052 720100                    LXL0    I,,AUTO
         2 003407   100003 473510                    LDP3    3,X0,PR1
         2 003410   300000 721100                    LXL1    0,,PR3
         2 003411   000003 101003                    CMPX1   3,DU
         2 003412   003422 601000 2                  TNZ     s:14908

     1135    14905    3             THEN
     1136    14906    3               FOL_ACCT = BLK$->P$B.SUBLK$(I)->P$B.SUBLK$(0)->P$S.TEXT;

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:182  
  14906  2 003413   300003 474500                    LDP4    3,,PR3
         2 003414   400004 236100                    LDQ     4,,PR4
         2 003415   000033 772000                    QRL     27
         2 003416   000000 622006                    EAX2    0,QL
         2 003417   040100 100540                    MLR     fill='040'O
         2 003420   400004 200012                    ADSC9   4,,PR4                   cn=1,n=*X2
         2 003421   200346 000010                    ADSC9   FOL_ACCT,,AUTO           cn=0,n=8

     1137    14907
     1138    14908    3         IF BLK$->P$B.SUBLK$(I)->P$S.CODE = JOB_FOLLOW

  14908  2 003422   000000 471500                    LDP1    0,,PR0
         2 003423   100003 473510                    LDP3    3,X0,PR1
         2 003424   300000 721100                    LXL1    0,,PR3
         2 003425   000017 101003                    CMPX1   15,DU
         2 003426   003556 601000 2                  TNZ     s:14948

     1139    14909    3             THEN
     1140    14910    4               DO J=0 TO BLK$->P$B.SUBLK$(I)->P$B.NSUBLKS-1 ;

  14910  2 003427   203053 450100                    STZ     J,,AUTO
         2 003430   003545 710000 2                  TRA     s:14947+3

     1141    14911    4                 TEMP$ = BLK$->P$B.SUBLK$(I)->P$B.SUBLK$(J) ;

  14911  2 003431   203051 470500                    LDP0    @BLK$,,AUTO
         2 003432   000000 471500                    LDP1    0,,PR0
         2 003433   203052 720100                    LXL0    I,,AUTO
         2 003434   100003 473510                    LDP3    3,X0,PR1
         2 003435   203053 721100                    LXL1    J,,AUTO
         2 003436   300003 236111                    LDQ     3,X1,PR3
         2 003437   203055 756100                    STQ     TEMP$,,AUTO

     1142    14912    5                 DO CASE(TEMP$->P$B.SUBLK$(0)->P$B.SUBLK$(0)->P$S.CODE) ;

  14912  2 003440   203055 474500                    LDP4    TEMP$,,AUTO
         2 003441   400003 475500                    LDP5    3,,PR4
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:183  
         2 003442   500003 476500                    LDP6    3,,PR5
         2 003443   600000 236100                    LDQ     0,,PR6
         2 003444   777777 376007                    ANQ     -1,DL
         2 003445   000023 136007                    SBLQ    19,DL
         2 003446   000001 116007                    CMPQ    1,DL
         2 003447   003451 602006 2                  TNC     s:14912+9,QL
         2 003450   003510 710000 2                  TRA     s:14928
         2 003451   003452 710000 2                  TRA     s:14915

     1143    14913
     1144    14914    5                   CASE(JOB_JNAME) ;

     1145    14915    5                     FOL_NAME.NAME = TEMP$->P$B.SUBLK$(0)->

  14915  2 003452   600004 236100                    LDQ     4,,PR6
         2 003453   000033 772000                    QRL     27
         2 003454   000000 622006                    EAX2    0,QL
         2 003455   040100 100540                    MLR     fill='040'O
         2 003456   600004 200012                    ADSC9   4,,PR6                   cn=1,n=*X2
         2 003457   200336 200037                    ADSC9   FOL_NAME,,AUTO           cn=1,n=31

     1146    14916    5                                             P$B.SUBLK$(0)->P$S.TEXT ;
     1147    14917    5                     FOL_NAME.CNT = TEMP$->P$B.SUBLK$(0)->

  14917  2 003460   400003 471500                    LDP1    3,,PR4
         2 003461   100003 473500                    LDP3    3,,PR1
         2 003462   300004 236100                    LDQ     4,,PR3
         2 003463   200336 552140                    STBQ    FOL_NAME,'40'O,AUTO

     1148    14918    5                                             P$B.SUBLK$(0)->P$S.COUNT ;
     1149    14919    5                     XSJ_PARAM.NAME$ = ADDR(FOL_NAME.NAME) ;

  14919  2 003464   203064 452500                    STP2    NEED_2_READ_JOBSTATS+6,,AUTO
         2 003465   203064 236100                    LDQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 003466   000042 036000 3                  ADLQ    34
         2 003467   200747 756100                    STQ     XSJ_PARAM+3,,AUTO

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:184  
     1150    14920    5                     NEED_2_READ_JOBSTATS = %YES# ;

  14920  2 003470   400000 236003                    LDQ     -131072,DU
         2 003471   203056 756100                    STQ     NEED_2_READ_JOBSTATS,,AUTO

     1151    14921    5                     IF TEMP$->P$B.SUBLK$(0)->P$B.NSUBLKS > 1

  14921  2 003472   400003 471500                    LDP1    3,,PR4
         2 003473   100001 222100                    LDX2    1,,PR1
         2 003474   000002 102003                    CMPX2   2,DU
         2 003475   003505 602000 2                  TNC     s:14925

     1152    14922    5                       THEN
     1153    14923    5                         FOL_ACCT = TEMP$->P$B.SUBLK$(0)->P$B.SUBLK$(1)->

  14923  2 003476   100004 473500                    LDP3    4,,PR1
         2 003477   300004 236100                    LDQ     4,,PR3
         2 003500   000033 772000                    QRL     27
         2 003501   000000 623006                    EAX3    0,QL
         2 003502   040100 100540                    MLR     fill='040'O
         2 003503   300004 200013                    ADSC9   4,,PR3                   cn=1,n=*X3
         2 003504   200346 000010                    ADSC9   FOL_ACCT,,AUTO           cn=0,n=8

     1154    14924    5                                         P$S.TEXT ;
     1155    14925    5                     XSJ_PARAM.ACCT$ = ADDR(FOL_ACCT) ;

  14925  2 003505   200346 631500                    EPPR1   FOL_ACCT,,AUTO
         2 003506   200746 451500                    STP1    XSJ_PARAM+2,,AUTO
         2 003507   003511 710000 2                  TRA     s:14932

     1156    14926
     1157    14927    5                   CASE(JOB_SYSID,ELSE) ;

     1158    14928    5                     NEED_2_READ_JOBSTATS = %NO# ;

  14928  2 003510   203056 450100                    STZ     NEED_2_READ_JOBSTATS,,AUTO

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:185  
     1159    14929                              /* Nothing Done */
     1160    14930
     1161    14931    5                 END ; /* Do Case */

     1162    14932    4                 IF NEED_2_READ_JOBSTATS

  14932  2 003511   203056 234100                    SZN     NEED_2_READ_JOBSTATS,,AUTO
         2 003512   003542 605000 2                  TPL     s:14947

     1163    14933    4                   THEN
     1164    14934    5                     DO ;

     1165    14935    5                       IF NOT IBEX_OPEN_2_JOBSTATS

  14935  2 003513   200375 234100                    SZN     IBEX_OPEN_2_JOBSTATS,,AUTO
         2 003514   003517 604000 2                  TMI     s:14938

     1166    14936    5                         THEN
     1167    14937    5                           CALL OPEN_M$IBEX2 ALTRET(CHK_RETURN) ;

  14937  2 003515   003616 701000 2                  TSX1    OPEN_M$IBEX2
         2 003516   003570 702000 2                  TSX2    CHK_RETURN

     1168    14938    6                       CALL XSJ$READ(XSJ_PARAM) WHENALTRETURN DO ;

  14938  2 003517   200744 630500                    EPPR0   XSJ_PARAM,,AUTO
         2 003520   203064 450500                    STP0    NEED_2_READ_JOBSTATS+6,,AUTO
         2 003521   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 003522   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003523   000000 701000 xent               TSX1    XSJ$READ
         2 003524   003526 702000 2                  TSX2    s:14939
         2 003525   003542 710000 2                  TRA     s:14947

     1169    14939    6                                         CPOS = TEMP$->P$S.CPOS ;

  14939  2 003526   203055 470500                    LDP0    TEMP$,,AUTO
         2 003527   000002 235100                    LDA     2,,PR0
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:186  
         2 003530   200357 755100                    STA     CPOS,,AUTO

     1170    14940    6                                         IF B$TCB.ALT$->B$ALT.ERR.CODE = %E$NOKEY

  14940  2 003531   000000 471400 xsym               LDP1    B$TCB$
         2 003532   100000 473500                    LDP3    0,,PR1
         2 003533   300102 236100                    LDQ     66,,PR3
         2 003534   377770 376007                    ANQ     131064,DL
         2 003535   001020 116007                    CMPQ    528,DL
         2 003536   003570 601000 2                  TNZ     CHK_RETURN

     1171    14941    6                                           THEN
     1172    14942    6                                             CALL POST_ERR_4_NONAME ;

  14942  2 003537   003641 701000 2                  TSX1    POST_ERR_4_NONAME
         2 003540   000000 011000                    NOP     0
         2 003541   003542 710000 2                  TRA     s:14947

     1173    14943    6                                           ELSE
     1174    14944    6                                             GOTO CHK_RETURN ;
     1175    14945    6                                         END ; /* Whenaltreturn Do */
     1176    14946    5                     END ; /* Then Do */

     1177    14947    4               END ; /* Do J */

  14947  2 003542   203053 235100                    LDA     J,,AUTO
         2 003543   000001 035007                    ADLA    1,DL
         2 003544   203053 755100                    STA     J,,AUTO
         2 003545   203051 470500                    LDP0    @BLK$,,AUTO
         2 003546   000000 471500                    LDP1    0,,PR0
         2 003547   203052 720100                    LXL0    I,,AUTO
         2 003550   100003 473510                    LDP3    3,X0,PR1
         2 003551   300001 236100                    LDQ     1,,PR3
         2 003552   000022 772000                    QRL     18
         2 003553   203053 116100                    CMPQ    J,,AUTO
         2 003554   003556 600000 2                  TZE     s:14948
         2 003555   003431 603000 2                  TRC     s:14911
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:187  

     1178    14948    3     END ;   /* Do I */

  14948  2 003556   203052 235100                    LDA     I,,AUTO
         2 003557   000001 035007                    ADLA    1,DL
         2 003560   203052 755100                    STA     I,,AUTO
         2 003561   203051 470500                    LDP0    @BLK$,,AUTO
         2 003562   000000 471500                    LDP1    0,,PR0
         2 003563   100001 236100                    LDQ     1,,PR1
         2 003564   000022 772000                    QRL     18
         2 003565   203052 116100                    CMPQ    I,,AUTO
         2 003566   003570 600000 2                  TZE     CHK_RETURN
         2 003567   003404 603000 2                  TRC     s:14904

     1179    14949    2   CHK_RETURN:
     1180    14950    2         IF IBEX_OPEN_2_JOBSTATS

  14950  2 003570   200375 234100       CHK_RETURN   SZN     IBEX_OPEN_2_JOBSTATS,,AUTO
         2 003571   003610 605000 2                  TPL     s:14963

     1181    14951    2             THEN
     1182    14952    3               DO ;

     1183    14953    3                 CALL XSJ$CLOSE(XSJ_PARAM) ALTRET(CHK_ERR) ;

  14953  2 003572   200744 630500                    EPPR0   XSJ_PARAM,,AUTO
         2 003573   203064 450500                    STP0    NEED_2_READ_JOBSTATS+6,,AUTO
         2 003574   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 003575   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003576   000000 701000 xent               TSX1    XSJ$CLOSE
         2 003577   003614 702000 2                  TSX2    CHK_ERR

     1184    14954    3                 IBEX_OPEN_2_JOBSTATS = %NO# ;

  14954  2 003600   200375 450100                    STZ     IBEX_OPEN_2_JOBSTATS,,AUTO

     1185    14955    3                 IF NEED_2_RELEASE_IBEX2
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:188  

  14955  2 003601   200376 234100                    SZN     NEED_2_RELEASE_IBEX2,,AUTO
         2 003602   003607 605000 2                  TPL     s:14960

     1186    14956    3                   THEN
     1187    14957    4                     DO ;

     1188    14958    4                       CALL CPC$RELDCB(M$IBEX2_NUM) ;

  14958  2 003603   000043 630400 3                  EPPR0   35
         2 003604   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003605   000000 701000 xent               TSX1    CPC$RELDCB
         2 003606   000000 011000                    NOP     0

     1189    14959    4                     END ; /* Then Do */

     1190    14960    3                 NEED_2_RELEASE_IBEX2 = %NO# ;

  14960  2 003607   200376 450100                    STZ     NEED_2_RELEASE_IBEX2,,AUTO

     1191    14961    3               END ; /* Then Do */

     1192    14962
     1193    14963    2     IF NEED_ALTRETURN

  14963  2 003610   200377 234100                    SZN     NEED_ALTRETURN,,AUTO
         2 003611   003614 604000 2                  TMI     CHK_ERR

     1194    14964    2         THEN
     1195    14965    2             GOTO CHK_ERR ;
     1196    14966
     1197    14967    2         RETURN ;

  14967  2 003612   203050 221300                    LDX1  ! SUB$PARAMS+14,,AUTO
         2 003613   000001 702211                    TSX2  ! 1,X1

     1198    14968
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:189  
     1199    14969    2   CHK_ERR:
     1200    14970    2         ALTRETURN ;

  14970  2 003614   203050 221300       CHK_ERR      LDX1  ! SUB$PARAMS+14,,AUTO
         2 003615   000000 702211                    TSX2  ! 0,X1

     1201    14971    2   END   CHK_FOLLOW_CONDITION ;
     1202    14972        %EJECT ;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:190  
     1203    14973    1   OPEN_M$IBEX2: PROC ALTRET ;

  14973  2 003616   203060 741300       OPEN_M$IBEX2 STX1  ! NEED_2_READ_JOBSTATS+2,,AUTO

     1204    14974
     1205    14975    2     CALL CPC$GETDCB(M$IBEX2_NUM, IBEX2TXTC);

  14975  2 003617   000044 630400 3                  EPPR0   36
         2 003620   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 003621   000000 701000 xent               TSX1    CPC$GETDCB
         2 003622   000000 011000                    NOP     0

     1206    14976    2     NEED_2_RELEASE_IBEX2 = %YES# ;

  14976  2 003623   400000 236003                    LDQ     -131072,DU
         2 003624   200376 756100                    STQ     NEED_2_RELEASE_IBEX2,,AUTO

     1207    14977    2     XSJ_PARAM.DCB# = M$IBEX2_NUM;

  14977  2 003625   000000 720000 xsym               LXL0    M$IBEX2_NUM
         2 003626   200751 740100                    STX0    XSJ_PARAM+5,,AUTO

     1208    14978    2     CALL XSJ$OPEN(XSJ_PARAM) ;

  14978  2 003627   200744 630500                    EPPR0   XSJ_PARAM,,AUTO
         2 003630   203064 450500                    STP0    NEED_2_READ_JOBSTATS+6,,AUTO
         2 003631   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 003632   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003633   000000 701000 xent               TSX1    XSJ$OPEN
         2 003634   000000 011000                    NOP     0

     1209    14979    2     IBEX_OPEN_2_JOBSTATS = %YES# ;

  14979  2 003635   400000 236003                    LDQ     -131072,DU
         2 003636   200375 756100                    STQ     IBEX_OPEN_2_JOBSTATS,,AUTO

     1210    14980    2     RETURN ;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:191  

  14980  2 003637   203060 221300                    LDX1  ! NEED_2_READ_JOBSTATS+2,,AUTO
         2 003640   000001 702211                    TSX2  ! 1,X1

     1211    14981
     1212    14982    2   END   OPEN_M$IBEX2 ;
     1213    14983        %EJECT ;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:192  
     1214    14984    1   POST_ERR_4_NONAME: PROC ;

  14984  2 003641   203060 741300       POST_ERR_4_* STX1  ! NEED_2_READ_JOBSTATS+2,,AUTO

     1215    14985
     1216    14986    2     IF SEG$2.FLAGS.CONTINUED

  14986  2 003642   000000 470400 xsym               LDP0    SEG2$
         2 003643   000000 236100                    LDQ     0,,PR0
         2 003644   002000 316003                    CANQ    1024,DU
         2 003645   003711 600000 2                  TZE     s:14998

     1217    14987    2         THEN
     1218    14988    3             DO ;

     1219    14989    3               IF TEMP$->P$B.SUBLK$(0)->P$B.NSUBLKS > 1

  14989  2 003646   200007 471500                    LDP1    TEMP$,,AUTO
         2 003647   100003 473500                    LDP3    3,,PR1
         2 003650   300001 220100                    LDX0    1,,PR3
         2 003651   000002 100003                    CMPX0   2,DU
         2 003652   003672 602000 2                  TNC     s:14993

     1220    14990    3                 THEN
     1221    14991    3                   CALL CPC$WRITEMSGE(E_NONAME_4_CONT,,FOL_NAME,FOL_ACCT,,%YES#) ;

  14991  2 003653   000046 236000 3                  LDQ     38
         2 003654   000001 235000 xsym               LDA     B_VECTNIL+1
         2 003655   203070 757100                    STAQ    NEED_2_READ_JOBSTATS+10,,AUTO
         2 003656   200346 633500                    EPPR3   FOL_ACCT,,AUTO
         2 003657   203067 453500                    STP3    NEED_2_READ_JOBSTATS+9,,AUTO
         2 003660   200336 634500                    EPPR4   FOL_NAME,,AUTO
         2 003661   203066 454500                    STP4    NEED_2_READ_JOBSTATS+8,,AUTO
         2 003662   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 003663   000047 235000 3                  LDA     39
         2 003664   203064 757100                    STAQ    NEED_2_READ_JOBSTATS+6,,AUTO
         2 003665   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:193  
         2 003666   000024 631400 xsym               EPPR1   B_VECTNIL+20
         2 003667   000000 701000 xent               TSX1    CPC$WRITEMSGE
         2 003670   000000 011000                    NOP     0
         2 003671   003707 710000 2                  TRA     s:14994

     1222    14992    3                 ELSE
     1223    14993    3                   CALL CPC$WRITEMSGE(E_NONAME_4_CONT,,FOL_NAME,,,%YES#) ;

  14993  2 003672   000046 236000 3                  LDQ     38
         2 003673   000001 235000 xsym               LDA     B_VECTNIL+1
         2 003674   203070 757100                    STAQ    NEED_2_READ_JOBSTATS+10,,AUTO
         2 003675   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 003676   203067 756100                    STQ     NEED_2_READ_JOBSTATS+9,,AUTO
         2 003677   200336 633500                    EPPR3   FOL_NAME,,AUTO
         2 003700   203066 453500                    STP3    NEED_2_READ_JOBSTATS+8,,AUTO
         2 003701   000047 235000 3                  LDA     39
         2 003702   203064 757100                    STAQ    NEED_2_READ_JOBSTATS+6,,AUTO
         2 003703   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 003704   000024 631400 xsym               EPPR1   B_VECTNIL+20
         2 003705   000000 701000 xent               TSX1    CPC$WRITEMSGE
         2 003706   000000 011000                    NOP     0

     1224    14994    3               ECHO_JOB_CMD = %NO# ;

  14994  2 003707   200400 450100                    STZ     ECHO_JOB_CMD,,AUTO

     1225    14995    3             END ; /* Then Do */

  14995  2 003710   003730 710000 2                  TRA     s:15001

     1226    14996    2         ELSE
     1227    14997    3             DO ;

     1228    14998    3               CALL STUFF_GETCMD_4_ERRPTR ;

  14998  2 003711   007164 701000 2                  TSX1    STUFF_GETCMD_4_ERRPTR
         2 003712   000000 011000                    NOP     0
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:194  

     1229    14999    3               CALL CXP$POSTERR(ADDR(SEG$2.ERRBUF),CPOS,E_NONAME) ;

  14999  2 003713   000000 236000 xsym               LDQ     SEG2$
         2 003714   000003 036003                    ADLQ    3,DU
         2 003715   203064 756100                    STQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 003716   000050 236000 3                  LDQ     40
         2 003717   203067 756100                    STQ     NEED_2_READ_JOBSTATS+9,,AUTO
         2 003720   200357 630500                    EPPR0   CPOS,,AUTO
         2 003721   203066 450500                    STP0    NEED_2_READ_JOBSTATS+8,,AUTO
         2 003722   203064 631500                    EPPR1   NEED_2_READ_JOBSTATS+6,,AUTO
         2 003723   203065 451500                    STP1    NEED_2_READ_JOBSTATS+7,,AUTO
         2 003724   203065 630500                    EPPR0   NEED_2_READ_JOBSTATS+7,,AUTO
         2 003725   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 003726   000000 701000 xent               TSX1    CXP$POSTERR
         2 003727   000000 011000                    NOP     0

     1230    15000    3             END ; /* Else Do */

     1231    15001    2     NEED_ALTRETURN = %YES# ;

  15001  2 003730   400000 236003                    LDQ     -131072,DU
         2 003731   200377 756100                    STQ     NEED_ALTRETURN,,AUTO

     1232    15002
     1233    15003    2     RETURN ;

  15003  2 003732   203060 221300                    LDX1  ! NEED_2_READ_JOBSTATS+2,,AUTO
         2 003733   000001 702211                    TSX2  ! 1,X1

     1234    15004    2   END   POST_ERR_4_NONAME ;
     1235    15005          %EJECT;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:195  
     1236    15006        /*****************************************************************/
     1237    15007        /*F*       NAME:    CPH$GLOBAL
     1238    15008         **
     1239    15009                   PURPOSE:    Process the GLOBAL command
     1240    15010         **
     1241    15011                   DESCRIPTION:
     1242    15012                                The STRING and FIELD definitions which
     1243    15013                            are defined on the GLOBAL command remain in
     1244    15014                            effect from one JOB step to another. These
     1245    15015                            definitions are stored in the *S file and
     1246    15016                            are read back in and searched during BATCH
     1247    15017                            and XEQ processing. GLOBAL substitutions have
     1248    15018                            priority over DEFAULT substitutions but ONLINE
     1249    15019                            substitutions have priority over GLOBALs.
     1250    15020         **
     1251    15021                   REFERENCE:  Programming Reference Manual
     1252    15022        */
     1253    15023        /*****************************************************************/
     1254    15024    1   GLOBAL: PROC  ALTRET;

  15024  2 003734   203050 741300       GLOBAL       STX1  ! SUB$PARAMS+14,,AUTO

     1255    15025        /*E*    ERROR: CPH-E$MSGLOBAL-C
     1256    15026                MESSAGE: Missing GLOBAL sub
     1257    15027        */
     1258    15028        /*
     1259    15029             ***** Read any existing GLOBAL substitions in from the *S file...
     1260    15030        */
     1261    15031    2   GET_GLOBALS:
     1262    15032    2     CALL READ_GLOBALS ALTRET(REL_PAGES);

  15032  2 003735   004555 701000 2     GET_GLOBALS  TSX1    READ_GLOBALS
         2 003736   004476 702000 2                  TSX2    REL_PAGES

     1263    15033    2     IF BLK$->P$B.NSUBLKS = 0

  15033  2 003737   200011 470500                    LDP0    BLK$,,AUTO
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:196  
         2 003740   000001 220100                    LDX0    1,,PR0
         2 003741   004254 601000 2                  TNZ     s:15075

     1264    15034    2        THEN
     1265    15035        /*
     1266    15036             ***** List all the GLOBAL subs in effect currently...
     1267    15037        */
     1268    15038    3           DO;

     1269    15039    3              SEG$2.FPT_WRITECC$ -> FPT$WRITE.BUF_ = VECTOR(WRITEBUF);

  15039  2 003742   000000 471400 xsym               LDP1    SEG2$
         2 003743   100161 473500                    LDP3    113,,PR1
         2 003744   000002 235000 3                  LDA     2
         2 003745   203064 452500                    STP2    NEED_2_READ_JOBSTATS+6,,AUTO
         2 003746   203064 236100                    LDQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 003747   000012 036003                    ADLQ    10,DU
         2 003750   300004 757100                    STAQ    4,,PR3

     1270    15040    3              X$PARAM.SYM_HEAD$ = SUB$PARAMS.GLOBAL_DEF_HEAD$;

  15040  2 003751   203033 236100                    LDQ     SUB$PARAMS+1,,AUTO
         2 003752   200774 756100                    STQ     X$PARAM,,AUTO

     1271    15041    3              X$PARAM.NUM = 0;

  15041  2 003753   000000 220003                    LDX0    0,DU
         2 003754   200776 440100                    SXL0    X$PARAM+2,,AUTO

     1272    15042    3              X$PARAM.SRCH = 2;

  15042  2 003755   002000 236003                    LDQ     1024,DU
         2 003756   200776 552140                    STBQ    X$PARAM+2,'40'O,AUTO

     1273    15043    3              IF X$PARAM.SYM_HEAD$ = ADDR(NIL)

  15043  2 003757   200774 236100                    LDQ     X$PARAM,,AUTO
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:197  
         2 003760   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 003761   004002 601000 2                  TNZ     s:15053

     1274    15044    3                 THEN
     1275    15045    4                    DO;   /* No GLOBALs */

     1276    15046    4                       WRITEBUF = '   Globals: none';

  15046  2 003762   040100 100400                    MLR     fill='040'O
         2 003763   000065 000020 1                  ADSC9   E_NONAME_4_CONT+14       cn=0,n=16
         2 003764   200012 000400                    ADSC9   WRITEBUF,,AUTO           cn=0,n=256

     1277    15047    4                       SEG$2.FPT_WRITECC$->FPT$WRITE.BUF_.BOUND=15;

  15047  2 003765   100161 473500                    LDP3    113,,PR1
         2 003766   300004 236100                    LDQ     4,,PR3
         2 003767   177777 376007                    ANQ     65535,DL
         2 003770   000051 276000 3                  ORQ     41
         2 003771   300004 756100                    STQ     4,,PR3

     1278    15048    4                       CALL CPE$LISTOUT (SEG$2.FPT_WRITECC$);

  15048  2 003772   000000 236000 xsym               LDQ     SEG2$
         2 003773   000161 036003                    ADLQ    113,DU
         2 003774   203064 756100                    STQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 003775   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 003776   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 003777   000000 701000 xent               TSX1    CPE$LISTOUT
         2 004000   000000 011000                    NOP     0

     1279    15049    4                       GOTO REL_PAGES;

  15049  2 004001   004476 710000 2                  TRA     REL_PAGES

     1280    15050    4                    END;
     1281    15051    3                 ELSE
     1282    15052    4                    DO;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:198  

     1283    15053    4                       WRITEBUF = '   Globals:';

  15053  2 004002   040100 100400                    MLR     fill='040'O
         2 004003   000065 000013 1                  ADSC9   E_NONAME_4_CONT+14       cn=0,n=11
         2 004004   200012 000400                    ADSC9   WRITEBUF,,AUTO           cn=0,n=256

     1284    15054    4                       SEG$2.FPT_WRITECC$->FPT$WRITE.BUF_.BOUND=10;

  15054  2 004005   100161 473500                    LDP3    113,,PR1
         2 004006   300004 236100                    LDQ     4,,PR3
         2 004007   177777 376007                    ANQ     65535,DL
         2 004010   000052 276000 3                  ORQ     42
         2 004011   300004 756100                    STQ     4,,PR3

     1285    15055    4                       CALL CPE$LISTOUT (SEG$2.FPT_WRITECC$);

  15055  2 004012   000000 236000 xsym               LDQ     SEG2$
         2 004013   000161 036003                    ADLQ    113,DU
         2 004014   203064 756100                    STQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 004015   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 004016   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 004017   000000 701000 xent               TSX1    CPE$LISTOUT
         2 004020   000000 011000                    NOP     0

     1286    15056    4                    END;

     1287    15057    4              DO WHILE (%YES#);

     1288    15058    4                 CALL CPH$SYM_GET (X$MCB,X$PARAM) ALTRET(REL_PAGES);

  15058  2 004021   200774 630500                    EPPR0   X$PARAM,,AUTO
         2 004022   203065 450500                    STP0    NEED_2_READ_JOBSTATS+7,,AUTO
         2 004023   200763 631500                    EPPR1   X$MCB,,AUTO
         2 004024   203064 451500                    STP1    NEED_2_READ_JOBSTATS+6,,AUTO
         2 004025   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 004026   000020 631400 xsym               EPPR1   B_VECTNIL+16
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:199  
         2 004027   000000 701000 xent               TSX1    CPH$SYM_GET
         2 004030   004476 702000 2                  TSX2    REL_PAGES

     1289    15059    4                 IF X$PARAM.TYPE = %DSTRING#

  15059  2 004031   200776 236100                    LDQ     X$PARAM+2,,AUTO
         2 004032   000777 376003                    ANQ     511,DU
         2 004033   000005 116003                    CMPQ    5,DU
         2 004034   004127 601000 2                  TNZ     s:15065

     1290    15060    4                    THEN
     1291    15061    4                       CALL CONCAT (WRITEBUF,'      ''',X$PARAM.TEXTC$(0)

  15061  2 004035   200777 470500                    LDP0    X$PARAM+3,,AUTO
         2 004036   000100 101500                    MRL     fill='000'O
         2 004037   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
         2 004040   203064 000002                    ADSC9   NEED_2_READ_JOBSTATS+6,,AUTO cn=0,n=2
         2 004041   203064 220100                    LDX0    NEED_2_READ_JOBSTATS+6,,AUTO
         2 004042   201000 471500                    LDP1    X$PARAM+4,,AUTO
         2 004043   000100 101500                    MRL     fill='000'O
         2 004044   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
         2 004045   203065 000002                    ADSC9   NEED_2_READ_JOBSTATS+7,,AUTO cn=0,n=2
         2 004046   203065 221100                    LDX1    NEED_2_READ_JOBSTATS+7,,AUTO
         2 004047   040100 100400                    MLR     fill='040'O
         2 004050   000071 000007 1                  ADSC9   E_NONAME_4_CONT+18       cn=0,n=7
         2 004051   200012 000007                    ADSC9   WRITEBUF,,AUTO           cn=0,n=7
         2 004052   040100 100540                    MLR     fill='040'O
         2 004053   000000 200010                    ADSC9   0,,PR0                   cn=1,n=*X0
         2 004054   200013 600371                    ADSC9   WRITEBUF+1,,AUTO         cn=3,n=249
         2 004055   000000 636010                    EAQ     0,X0
         2 004056   000022 772000                    QRL     18
         2 004057   000371 116007                    CMPQ    249,DL
         2 004060   004126 603000 2                  TRC     s:15061+57
         2 004061   203066 740100                    STX0    NEED_2_READ_JOBSTATS+8,,AUTO
         2 004062   777406 620010                    EAX0    -250,X0
         2 004063   777777 660003                    ERX0    -1,DU
         2 004064   203066 235100                    LDA     NEED_2_READ_JOBSTATS+8,,AUTO
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:200  
         2 004065   000022 771000                    ARL     18
         2 004066   040145 100400                    MLR     fill='040'O
         2 004067   000073 000005 1                  ADSC9   E_NONAME_4_CONT+20       cn=0,n=5
         2 004070   200013 600010                    ADSC9   WRITEBUF+1,A,AUTO        cn=3,n=*X0
         2 004071   203066 236100                    LDQ     NEED_2_READ_JOBSTATS+8,,AUTO
         2 004072   000022 772000                    QRL     18
         2 004073   000364 116007                    CMPQ    244,DL
         2 004074   004126 603000 2                  TRC     s:15061+57
         2 004075   777413 620006                    EAX0    -245,QL
         2 004076   777777 660003                    ERX0    -1,DU
         2 004077   201000 470500                    LDP0    X$PARAM+4,,AUTO
         2 004100   040146 100540                    MLR     fill='040'O
         2 004101   000000 200011                    ADSC9   0,,PR0                   cn=1,n=*X1
         2 004102   200015 000010                    ADSC9   WRITEBUF+3,Q,AUTO        cn=0,n=*X0
         2 004103   000000 635011                    EAA     0,X1
         2 004104   000022 771000                    ARL     18
         2 004105   203067 755100                    STA     NEED_2_READ_JOBSTATS+9,,AUTO
         2 004106   203067 036100                    ADLQ    NEED_2_READ_JOBSTATS+9,,AUTO
         2 004107   000364 116007                    CMPQ    244,DL
         2 004110   004126 603000 2                  TRC     s:15061+57
         2 004111   000000 635011                    EAA     0,X1
         2 004112   000022 771000                    ARL     18
         2 004113   203070 755100                    STA     NEED_2_READ_JOBSTATS+10,,AUTO
         2 004114   203071 756100                    STQ     NEED_2_READ_JOBSTATS+11,,AUTO
         2 004115   203066 236100                    LDQ     NEED_2_READ_JOBSTATS+8,,AUTO
         2 004116   000022 772000                    QRL     18
         2 004117   203070 036100                    ADLQ    NEED_2_READ_JOBSTATS+10,,AUTO
         2 004120   203071 722100                    LXL2    NEED_2_READ_JOBSTATS+11,,AUTO
         2 004121   777413 622012                    EAX2    -245,X2
         2 004122   777777 662003                    ERX2    -1,DU
         2 004123   040146 100400                    MLR     fill='040'O
         2 004124   000053 000001 3                  ADSC9   43                       cn=0,n=1
         2 004125   200015 000012                    ADSC9   WRITEBUF+3,Q,AUTO        cn=0,n=*X2
         2 004126   004220 710000 2                  TRA     s:15068

     1292    15062    4                            -> X$STRING.TEXT,''' = ''',
     1293    15063    4                            X$PARAM.TEXTC$(1) -> X$STRING.TEXT,'''');
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:201  
     1294    15064    4                    ELSE
     1295    15065    4                       CALL CONCAT (WRITEBUF,'      ',X$PARAM.TEXTC$(0)

  15065  2 004127   200777 470500                    LDP0    X$PARAM+3,,AUTO
         2 004130   000100 101500                    MRL     fill='000'O
         2 004131   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
         2 004132   203064 000002                    ADSC9   NEED_2_READ_JOBSTATS+6,,AUTO cn=0,n=2
         2 004133   203064 220100                    LDX0    NEED_2_READ_JOBSTATS+6,,AUTO
         2 004134   201000 471500                    LDP1    X$PARAM+4,,AUTO
         2 004135   000100 101500                    MRL     fill='000'O
         2 004136   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
         2 004137   203065 000002                    ADSC9   NEED_2_READ_JOBSTATS+7,,AUTO cn=0,n=2
         2 004140   203065 221100                    LDX1    NEED_2_READ_JOBSTATS+7,,AUTO
         2 004141   040100 100400                    MLR     fill='040'O
         2 004142   000063 000006 1                  ADSC9   E_NONAME_4_CONT+12       cn=0,n=6
         2 004143   200012 000006                    ADSC9   WRITEBUF,,AUTO           cn=0,n=6
         2 004144   040100 100540                    MLR     fill='040'O
         2 004145   000000 200010                    ADSC9   0,,PR0                   cn=1,n=*X0
         2 004146   200013 400372                    ADSC9   WRITEBUF+1,,AUTO         cn=2,n=250
         2 004147   000000 636010                    EAQ     0,X0
         2 004150   000022 772000                    QRL     18
         2 004151   000372 116007                    CMPQ    250,DL
         2 004152   004220 603000 2                  TRC     s:15068
         2 004153   203066 740100                    STX0    NEED_2_READ_JOBSTATS+8,,AUTO
         2 004154   777405 620010                    EAX0    -251,X0
         2 004155   777777 660003                    ERX0    -1,DU
         2 004156   203066 235100                    LDA     NEED_2_READ_JOBSTATS+8,,AUTO
         2 004157   000022 771000                    ARL     18
         2 004160   040145 100400                    MLR     fill='040'O
         2 004161   000075 000004 1                  ADSC9   E_NONAME_4_CONT+22       cn=0,n=4
         2 004162   200013 400010                    ADSC9   WRITEBUF+1,A,AUTO        cn=2,n=*X0
         2 004163   203066 236100                    LDQ     NEED_2_READ_JOBSTATS+8,,AUTO
         2 004164   000022 772000                    QRL     18
         2 004165   000366 116007                    CMPQ    246,DL
         2 004166   004220 603000 2                  TRC     s:15068
         2 004167   777411 620006                    EAX0    -247,QL
         2 004170   777777 660003                    ERX0    -1,DU
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:202  
         2 004171   201000 470500                    LDP0    X$PARAM+4,,AUTO
         2 004172   040146 100540                    MLR     fill='040'O
         2 004173   000000 200011                    ADSC9   0,,PR0                   cn=1,n=*X1
         2 004174   200014 400010                    ADSC9   WRITEBUF+2,Q,AUTO        cn=2,n=*X0
         2 004175   000000 635011                    EAA     0,X1
         2 004176   000022 771000                    ARL     18
         2 004177   203067 755100                    STA     NEED_2_READ_JOBSTATS+9,,AUTO
         2 004200   203067 036100                    ADLQ    NEED_2_READ_JOBSTATS+9,,AUTO
         2 004201   000366 116007                    CMPQ    246,DL
         2 004202   004220 603000 2                  TRC     s:15068
         2 004203   000000 635011                    EAA     0,X1
         2 004204   000022 771000                    ARL     18
         2 004205   203070 755100                    STA     NEED_2_READ_JOBSTATS+10,,AUTO
         2 004206   203071 756100                    STQ     NEED_2_READ_JOBSTATS+11,,AUTO
         2 004207   203066 236100                    LDQ     NEED_2_READ_JOBSTATS+8,,AUTO
         2 004210   000022 772000                    QRL     18
         2 004211   203070 036100                    ADLQ    NEED_2_READ_JOBSTATS+10,,AUTO
         2 004212   203071 722100                    LXL2    NEED_2_READ_JOBSTATS+11,,AUTO
         2 004213   777411 622012                    EAX2    -247,X2
         2 004214   777777 662003                    ERX2    -1,DU
         2 004215   040146 100400                    MLR     fill='040'O
         2 004216   000053 000001 3                  ADSC9   43                       cn=0,n=1
         2 004217   200014 400012                    ADSC9   WRITEBUF+2,Q,AUTO        cn=2,n=*X2

     1296    15066    4                            -> X$STRING.TEXT,' = ''',
     1297    15067    4                            X$PARAM.TEXTC$(1) -> X$STRING.TEXT,'''');
     1298    15068    4                 SEG$2.FPT_WRITECC$->FPT$WRITE.BUF_.BOUND =

  15068  2 004220   000000 470400 xsym               LDP0    SEG2$
         2 004221   000161 471500                    LDP1    113,,PR0
         2 004222   201000 473500                    LDP3    X$PARAM+4,,AUTO
         2 004223   000100 101500                    MRL     fill='000'O
         2 004224   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
         2 004225   203064 000004                    ADSC9   NEED_2_READ_JOBSTATS+6,,AUTO cn=0,n=4
         2 004226   200777 474500                    LDP4    X$PARAM+3,,AUTO
         2 004227   000100 101500                    MRL     fill='000'O
         2 004230   400000 000001                    ADSC9   0,,PR4                   cn=0,n=1
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:203  
         2 004231   203065 000004                    ADSC9   NEED_2_READ_JOBSTATS+7,,AUTO cn=0,n=4
         2 004232   203065 236100                    LDQ     NEED_2_READ_JOBSTATS+7,,AUTO
         2 004233   203064 036100                    ADLQ    NEED_2_READ_JOBSTATS+6,,AUTO
         2 004234   000014 036007                    ADLQ    12,DL
         2 004235   000020 736000                    QLS     16
         2 004236   100004 676100                    ERQ     4,,PR1
         2 004237   000034 376000 xsym               ANQ     B_VECTNIL+28
         2 004240   100004 656100                    ERSQ    4,,PR1

     1299    15069    4                      X$PARAM.TEXTC$(0)->X$STRING.SIZ+
     1300    15070    4                      X$PARAM.TEXTC$(1)->X$STRING.SIZ+12;
     1301    15071    4                 CALL CPE$LISTOUT (SEG$2.FPT_WRITECC$);

  15071  2 004241   000000 236000 xsym               LDQ     SEG2$
         2 004242   000161 036003                    ADLQ    113,DU
         2 004243   203064 756100                    STQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 004244   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 004245   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 004246   000000 701000 xent               TSX1    CPE$LISTOUT
         2 004247   000000 011000                    NOP     0

     1302    15072    4                 X$PARAM.NUM = X$PARAM.NUM + 1;

  15072  2 004250   200776 720100                    LXL0    X$PARAM+2,,AUTO
         2 004251   000001 621010                    EAX1    1,X0
         2 004252   200776 441100                    SXL1    X$PARAM+2,,AUTO

     1303    15073    4              END;

  15073  2 004253   004021 710000 2                  TRA     s:15058

     1304    15074    3           END;
     1305    15075    2     TEMP$=BLK$->P$B.SUBLK$(0);

  15075  2 004254   000003 236100                    LDQ     3,,PR0
         2 004255   200007 756100                    STQ     TEMP$,,AUTO

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:204  
     1306    15076    2     IF TEMP$->P$B.CODE = BA_DELETE

  15076  2 004256   200007 471500                    LDP1    TEMP$,,AUTO
         2 004257   100000 720100                    LXL0    0,,PR1
         2 004260   000001 100003                    CMPX0   1,DU
         2 004261   004374 601000 2                  TNZ     s:15116

     1307    15077    2        THEN
     1308    15078    3           DO;   /* Reset GLOBAL subs */

     1309    15079    3              IF TEMP$ -> P$B.NSUBLKS = 0

  15079  2 004262   100001 221100                    LDX1    1,,PR1
         2 004263   004353 600000 2                  TZE     DELETE_ALL_SUBS

     1310    15080    3                 THEN   /* reset all GLOBAL subs */
     1311    15081    3                    GOTO DELETE_ALL_SUBS;
     1312    15082        /*
     1313    15083             ***** delete the listed GLOBAL subs...
     1314    15084        */
     1315    15085    3              X$PARAM.SYM_HEAD$ = SUB$PARAMS.GLOBAL_DEF_HEAD$;

  15085  2 004264   203033 236100                    LDQ     SUB$PARAMS+1,,AUTO
         2 004265   200774 756100                    STQ     X$PARAM,,AUTO

     1316    15086    3              X$PARAM.SRCH = 1;

  15086  2 004266   001000 236003                    LDQ     512,DU
         2 004267   200776 552140                    STBQ    X$PARAM+2,'40'O,AUTO

     1317    15087    4              DO NUM_OPTS = 0 TO TEMP$ -> P$B.NSUBLKS -1;

  15087  2 004270   200363 450100                    STZ     NUM_OPTS,,AUTO
         2 004271   004342 710000 2                  TRA     END_LOOP+3

     1318    15088    4                 P$ = TEMP$ -> P$B.SUBLK$(NUM_OPTS);

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:205  
  15088  2 004272   200007 470500                    LDP0    TEMP$,,AUTO
         2 004273   200363 720100                    LXL0    NUM_OPTS,,AUTO
         2 004274   000003 236110                    LDQ     3,X0,PR0
         2 004275   200010 756100                    STQ     P$,,AUTO

     1319    15089    4                 X$PARAM.TYPE = P$ -> P$B.NDTYPE;

  15089  2 004276   200010 471500                    LDP1    P$,,AUTO
         2 004277   100000 236100                    LDQ     0,,PR1
         2 004300   000077 376003                    ANQ     63,DU
         2 004301   200776 552120                    STBQ    X$PARAM+2,'20'O,AUTO

     1320    15090    4                 X$PARAM.TEXTC$(0) = P$ -> P$S.TEXTC$;

  15090  2 004302   100003 236100                    LDQ     3,,PR1
         2 004303   200777 756100                    STQ     X$PARAM+3,,AUTO

     1321    15091    4                 CALL CPH$SYM_DELETE (X$MCB,X$PARAM) ALTRET(MSING_SUB);

  15091  2 004304   200774 633500                    EPPR3   X$PARAM,,AUTO
         2 004305   203065 453500                    STP3    NEED_2_READ_JOBSTATS+7,,AUTO
         2 004306   200763 634500                    EPPR4   X$MCB,,AUTO
         2 004307   203064 454500                    STP4    NEED_2_READ_JOBSTATS+6,,AUTO
         2 004310   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 004311   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 004312   000000 701000 xent               TSX1    CPH$SYM_DELETE
         2 004313   004317 702000 2                  TSX2    MSING_SUB

     1322    15092    4                 SUB$PARAMS.GLOBAL_DEF_HEAD$ = X$PARAM.SYM_HEAD$;

  15092  2 004314   200774 236100                    LDQ     X$PARAM,,AUTO
         2 004315   203033 756100                    STQ     SUB$PARAMS+1,,AUTO

     1323    15093    4                 GOTO END_LOOP;

  15093  2 004316   004337 710000 2                  TRA     END_LOOP

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:206  
     1324    15094    4   MSING_SUB:
     1325    15095    4                 CPOS = P$ -> P$S.CPOS;

  15095  2 004317   200010 470500       MSING_SUB    LDP0    P$,,AUTO
         2 004320   000002 235100                    LDA     2,,PR0
         2 004321   200357 755100                    STA     CPOS,,AUTO

     1326    15096    4                 CALL CXP$POSTERR (ADDR(SEG$2.ERRBUF),CPOS,E_MSGLOBAL);

  15096  2 004322   000000 236000 xsym               LDQ     SEG2$
         2 004323   000003 036003                    ADLQ    3,DU
         2 004324   203064 756100                    STQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 004325   000054 236000 3                  LDQ     44
         2 004326   203067 756100                    STQ     NEED_2_READ_JOBSTATS+9,,AUTO
         2 004327   200357 631500                    EPPR1   CPOS,,AUTO
         2 004330   203066 451500                    STP1    NEED_2_READ_JOBSTATS+8,,AUTO
         2 004331   203064 633500                    EPPR3   NEED_2_READ_JOBSTATS+6,,AUTO
         2 004332   203065 453500                    STP3    NEED_2_READ_JOBSTATS+7,,AUTO
         2 004333   203065 630500                    EPPR0   NEED_2_READ_JOBSTATS+7,,AUTO
         2 004334   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 004335   000000 701000 xent               TSX1    CXP$POSTERR
         2 004336   000000 011000                    NOP     0

     1327    15097    4   END_LOOP:
     1328    15098    4              END;   /* Reset GLOBAL subs */

  15098  2 004337   200363 235100       END_LOOP     LDA     NUM_OPTS,,AUTO
         2 004340   000001 035007                    ADLA    1,DL
         2 004341   200363 755100                    STA     NUM_OPTS,,AUTO
         2 004342   200007 470500                    LDP0    TEMP$,,AUTO
         2 004343   000001 236100                    LDQ     1,,PR0
         2 004344   000022 772000                    QRL     18
         2 004345   200363 116100                    CMPQ    NUM_OPTS,,AUTO
         2 004346   004350 600000 2                  TZE     s:15099
         2 004347   004272 603000 2                  TRC     s:15088

     1329    15099    3              IF X$PARAM.SYM_HEAD$ ~= ADDR(NIL)
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:207  

  15099  2 004350   200774 236100                    LDQ     X$PARAM,,AUTO
         2 004351   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 004352   004455 601000 2                  TNZ     SAVE_SUBS

     1330    15100    3                 THEN
     1331    15101    3                    GOTO SAVE_SUBS;
     1332    15102        /*
     1333    15103             ***** delete all GLOBAL subs...
     1334    15104        */
     1335    15105    3   DELETE_ALL_SUBS:
     1336    15106    3              FPT_DELREC = CFPT_DELREC;

  15106  2 004353   000100 100400       DELETE_ALL_* MLR     fill='000'O
         2 004354   000000 000050 xsym               ADSC9   CFPT_DELREC              cn=0,n=40
         2 004355   200654 000050                    ADSC9   FPT_DELREC,,AUTO         cn=0,n=40

     1337    15107    3              FPT_DELREC.V_= VECTOR(FPT_DELREC.V);

  15107  2 004356   000016 235000 3                  LDA     14
         2 004357   203064 452500                    STP2    NEED_2_READ_JOBSTATS+6,,AUTO
         2 004360   203064 236100                    LDQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 004361   000664 036003                    ADLQ    436,DU
         2 004362   200654 757100                    STAQ    FPT_DELREC,,AUTO

     1338    15108    3              FPT_DELREC.V.DCB#=M$IBEX1_NUM;

  15108  2 004363   000000 720000 xsym               LXL0    M$IBEX1_NUM
         2 004364   200664 740100                    STX0    FPT_DELREC+8,,AUTO

     1339    15109    3              FPT_DELREC.KEY_=VECTOR(K_GLOBAL);

  15109  2 004365   000056 237000 3                  LDAQ    46
         2 004366   200656 757100                    STAQ    FPT_DELREC+2,,AUTO

     1340    15110    3              CALL M$DELREC (FPT_DELREC) ALTRET (REL_PAGES);

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:208  
  15110  2 004367   200654 630500                    EPPR0   FPT_DELREC,,AUTO
         2 004370   440002 713400                    CLIMB   alt,+16386
         2 004371   401400 401760                    pmme    nvectors=4
         2 004372   004476 702000 2                  TSX2    REL_PAGES

     1341    15111    3              GOTO REL_PAGES;

  15111  2 004373   004476 710000 2                  TRA     REL_PAGES

     1342    15112    3           END;
     1343    15113        /*
     1344    15114             ***** add new GLOBAL subs...
     1345    15115        */
     1346    15116    2     X$PARAM.SYM_HEAD$=SUB$PARAMS.GLOBAL_DEF_HEAD$;

  15116  2 004374   203033 236100                    LDQ     SUB$PARAMS+1,,AUTO
         2 004375   200774 756100                    STQ     X$PARAM,,AUTO

     1347    15117    2     X$PARAM.SRCH = 1;

  15117  2 004376   001000 236003                    LDQ     512,DU
         2 004377   200776 552140                    STBQ    X$PARAM+2,'40'O,AUTO

     1348    15118    3     DO NUM_OPTS = 0 TO BLK$ -> P$B.NSUBLKS - 1;

  15118  2 004400   200363 450100                    STZ     NUM_OPTS,,AUTO
         2 004401   004447 710000 2                  TRA     s:15128+3

     1349    15119    3        TEMP$=BLK$->P$B.SUBLK$(NUM_OPTS);

  15119  2 004402   200011 470500                    LDP0    BLK$,,AUTO
         2 004403   200363 720100                    LXL0    NUM_OPTS,,AUTO
         2 004404   000003 236110                    LDQ     3,X0,PR0
         2 004405   200007 756100                    STQ     TEMP$,,AUTO

     1350    15120    3        X$PARAM.TEXTC$(0)=TEMP$->P$B.SUBLK$(0)->P$S.TEXTC$;

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:209  
  15120  2 004406   200007 471500                    LDP1    TEMP$,,AUTO
         2 004407   100003 473500                    LDP3    3,,PR1
         2 004410   300003 236100                    LDQ     3,,PR3
         2 004411   200777 756100                    STQ     X$PARAM+3,,AUTO

     1351    15121    3        X$PARAM.TEXTC$(1)=TEMP$->P$B.SUBLK$(1)->P$S.TEXTC$;

  15121  2 004412   100004 473500                    LDP3    4,,PR1
         2 004413   300003 236100                    LDQ     3,,PR3
         2 004414   201000 756100                    STQ     X$PARAM+4,,AUTO

     1352    15122    3        X$PARAM.TYPE=TEMP$->P$B.SUBLK$(0)->P$S.NDTYPE;

  15122  2 004415   100003 473500                    LDP3    3,,PR1
         2 004416   300000 236100                    LDQ     0,,PR3
         2 004417   000077 376003                    ANQ     63,DU
         2 004420   200776 552120                    STBQ    X$PARAM+2,'20'O,AUTO

     1353    15123    3        CALL CPH$SYM_PUT (X$MCB,X$PARAM);

  15123  2 004421   200774 633500                    EPPR3   X$PARAM,,AUTO
         2 004422   203065 453500                    STP3    NEED_2_READ_JOBSTATS+7,,AUTO
         2 004423   200763 634500                    EPPR4   X$MCB,,AUTO
         2 004424   203064 454500                    STP4    NEED_2_READ_JOBSTATS+6,,AUTO
         2 004425   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 004426   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 004427   000000 701000 xent               TSX1    CPH$SYM_PUT
         2 004430   000000 011000                    NOP     0

     1354    15124    3        IF X$PARAM.ERR.CODE ~= 0

  15124  2 004431   201001 236100                    LDQ     X$PARAM+5,,AUTO
         2 004432   377770 316007                    CANQ    131064,DL
         2 004433   004442 600000 2                  TZE     s:15127

     1355    15125    3           THEN
     1356    15126    3              CALL CPC$WRITEMSGE (X$PARAM.ERR);
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:210  

  15126  2 004434   201001 630500                    EPPR0   X$PARAM+5,,AUTO
         2 004435   203064 450500                    STP0    NEED_2_READ_JOBSTATS+6,,AUTO
         2 004436   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 004437   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 004440   000000 701000 xent               TSX1    CPC$WRITEMSGE
         2 004441   000000 011000                    NOP     0

     1357    15127    3        SUB$PARAMS.GLOBAL_DEF_HEAD$=X$PARAM.SYM_HEAD$;

  15127  2 004442   200774 236100                    LDQ     X$PARAM,,AUTO
         2 004443   203033 756100                    STQ     SUB$PARAMS+1,,AUTO

     1358    15128    3     END;

  15128  2 004444   200363 235100                    LDA     NUM_OPTS,,AUTO
         2 004445   000001 035007                    ADLA    1,DL
         2 004446   200363 755100                    STA     NUM_OPTS,,AUTO
         2 004447   200011 470500                    LDP0    BLK$,,AUTO
         2 004450   000001 236100                    LDQ     1,,PR0
         2 004451   000022 772000                    QRL     18
         2 004452   200363 116100                    CMPQ    NUM_OPTS,,AUTO
         2 004453   004455 600000 2                  TZE     SAVE_SUBS
         2 004454   004402 603000 2                  TRC     s:15119

     1359    15129        /*
     1360    15130             ***** Save GLOBAL DEFS...
     1361    15131        */
     1362    15132    2   SAVE_SUBS:
     1363    15133    2     CP$GLOBALS.WKSZ_SAVE=X$MCB.WKSZ;

  15133  2 004455   000000 470400 xsym  SAVE_SUBS    LDP0    SEG3$
         2 004456   200767 235100                    LDA     X$MCB+4,,AUTO
         2 004457   000000 755100                    STA     0,,PR0

     1364    15134    2     CP$GLOBALS.HI_SEGMENT_SAVE$=X$MCB.HI_SEGMENT$;

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:211  
  15134  2 004460   200766 236100                    LDQ     X$MCB+3,,AUTO
         2 004461   000001 756100                    STQ     1,,PR0

     1365    15135    2     CP$GLOBALS.SYM_HEAD_SAVE$=SUB$PARAMS.GLOBAL_DEF_HEAD$;

  15135  2 004462   203033 236100                    LDQ     SUB$PARAMS+1,,AUTO
         2 004463   000002 756100                    STQ     2,,PR0

     1366    15136    2     CP$GLOBALS.FREE_HEAD_SAVE$=X$MCB.FREE_HEAD$;

  15136  2 004464   200764 236100                    LDQ     X$MCB+1,,AUTO
         2 004465   000003 756100                    STQ     3,,PR0

     1367    15137    2     CALL CPJ$WRITE_S (M$IBEX1_NUM,VECTOR(K_GLOBAL),SEG3_) ALTRET(ABORT1);

  15137  2 004466   200004 631500                    EPPR1   SEG3_,,AUTO
         2 004467   203066 451500                    STP1    NEED_2_READ_JOBSTATS+8,,AUTO
         2 004470   000060 237000 3                  LDAQ    48
         2 004471   203064 757100                    STAQ    NEED_2_READ_JOBSTATS+6,,AUTO
         2 004472   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 004473   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 004474   000000 701000 xent               TSX1    CPJ$WRITE_S
         2 004475   004531 702000 2                  TSX2    ABORT1

     1368    15138        /*
     1369    15139             ***** Release the page(s) which
     1370    15140                   were used to store SUBS...
     1371    15141        */
     1372    15142    2   REL_PAGES:
     1373    15143    2     CALL CPC$RELSEG (SEG3$);

  15143  2 004476   000041 630400 3     REL_PAGES    EPPR0   33
         2 004477   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 004500   000000 701000 xent               TSX1    CPC$RELSEG
         2 004501   000000 011000                    NOP     0

     1374    15144        /*
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:212  
     1375    15145             close the *S file...
     1376    15146        */
     1377    15147    2     FPT_CLOSE = CFPT_CLOSE;

  15147  2 004502   000100 100400                    MLR     fill='000'O
         2 004503   000000 000170 xsym               ADSC9   CFPT_CLOSE               cn=0,n=120
         2 004504   200540 000170                    ADSC9   FPT_CLOSE,,AUTO          cn=0,n=120

     1378    15148    2     FPT_CLOSE.V_ = VECTOR(FPT_CLOSE.V);

  15148  2 004505   000000 235000 3                  LDA     0
         2 004506   203064 452500                    STP2    NEED_2_READ_JOBSTATS+6,,AUTO
         2 004507   203064 236100                    LDQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 004510   000572 036003                    ADLQ    378,DU
         2 004511   200540 757100                    STAQ    FPT_CLOSE,,AUTO

     1379    15149    2     FPT_CLOSE.V.DCB#=M$IBEX1_NUM;

  15149  2 004512   000000 720000 xsym               LXL0    M$IBEX1_NUM
         2 004513   200572 740100                    STX0    FPT_CLOSE+26,,AUTO

     1380    15150    2     FPT_CLOSE.V.DISP#=%SAVE#;

  15150  2 004514   000002 236007                    LDQ     2,DL
         2 004515   200572 552104                    STBQ    FPT_CLOSE+26,'04'O,AUTO

     1381    15151    2     CALL M$CLOSE (FPT_CLOSE) ALTRET(ABORT1);

  15151  2 004516   200540 630500                    EPPR0   FPT_CLOSE,,AUTO
         2 004517   450001 713400                    CLIMB   alt,close
         2 004520   406000 401760                    pmme    nvectors=13
         2 004521   004531 702000 2                  TSX2    ABORT1

     1382    15152    2     IF SEG$2.ERRBUF(1) = 0

  15152  2 004522   000000 470400 xsym               LDP0    SEG2$
         2 004523   000004 235100                    LDA     4,,PR0
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:213  
         2 004524   004527 601000 2                  TNZ     s:15156

     1383    15153    2        THEN   /* No errors reported */
     1384    15154    2           RETURN;

  15154  2 004525   203050 221300                    LDX1  ! SUB$PARAMS+14,,AUTO
         2 004526   000001 702211                    TSX2  ! 1,X1

     1385    15155    2        ELSE   /* Errors! */
     1386    15156    2           ALTRETURN;

  15156  2 004527   203050 221300                    LDX1  ! SUB$PARAMS+14,,AUTO
         2 004530   000000 702211                    TSX2  ! 0,X1

     1387    15157    2   ABORT1:
     1388    15158    2     CALL CXP$POSTERR (ADDR(SEG$2.ERRBUF),511,B$TCB.ALT$ -> B$ALT.ERR,,M$IBEX1_NUM);

  15158  2 004531   000000 470400 xsym  ABORT1       LDP0    B$TCB$
         2 004532   000000 471500                    LDP1    0,,PR0
         2 004533   000000 236000 xsym               LDQ     SEG2$
         2 004534   000003 036003                    ADLQ    3,DU
         2 004535   203064 756100                    STQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 004536   000013 236000 3                  LDQ     11
         2 004537   000001 235000 xsym               LDA     B_VECTNIL+1
         2 004540   203070 757100                    STAQ    NEED_2_READ_JOBSTATS+10,,AUTO
         2 004541   100102 633500                    EPPR3   66,,PR1
         2 004542   203067 453500                    STP3    NEED_2_READ_JOBSTATS+9,,AUTO
         2 004543   000034 236000 3                  LDQ     28
         2 004544   203066 756100                    STQ     NEED_2_READ_JOBSTATS+8,,AUTO
         2 004545   203064 631500                    EPPR1   NEED_2_READ_JOBSTATS+6,,AUTO
         2 004546   203065 451500                    STP1    NEED_2_READ_JOBSTATS+7,,AUTO
         2 004547   203065 630500                    EPPR0   NEED_2_READ_JOBSTATS+7,,AUTO
         2 004550   000023 631400 xsym               EPPR1   B_VECTNIL+19
         2 004551   000000 701000 xent               TSX1    CXP$POSTERR
         2 004552   000000 011000                    NOP     0

     1389    15159    2     ALTRETURN;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:214  

  15159  2 004553   203050 221300                    LDX1  ! SUB$PARAMS+14,,AUTO
         2 004554   000000 702211                    TSX2  ! 0,X1

     1390    15160    2   END GLOBAL;
     1391    15161        %EJECT;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:215  
     1392    15162    1   READ_GLOBALS: PROC ALTRET;

  15162  2 004555   203052 741300       READ_GLOBALS STX1  ! I,,AUTO

     1393    15163        /*
     1394    15164             ***** Initialize...
     1395    15165        */
     1396    15166    2     X$MCB.SEGMENT_BASE$=SEG3$;

  15166  2 004556   000000 236000 xsym               LDQ     SEG3$
         2 004557   200765 756100                    STQ     X$MCB+2,,AUTO

     1397    15167    2     X$MCB.WKSZ=1024;

  15167  2 004560   002000 235007                    LDA     1024,DL
         2 004561   200767 755100                    STA     X$MCB+4,,AUTO

     1398    15168    2     X$MCB.HI_SEGMENT$=PINCRW(SEG3$,5);

  15168  2 004562   000005 036003                    ADLQ    5,DU
         2 004563   200766 756100                    STQ     X$MCB+3,,AUTO

     1399    15169    2     X$MCB.FREE_HEAD$=ADDR(NIL);

  15169  2 004564   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 004565   200764 756100                    STQ     X$MCB+1,,AUTO

     1400    15170    2     SUB$PARAMS.GLOBAL_DEF_HEAD$ = ADDR(NIL);

  15170  2 004566   203033 756100                    STQ     SUB$PARAMS+1,,AUTO

     1401    15171        /*
     1402    15172             ***** open the *S file
     1403    15173        */
     1404    15174    2     CALL CPC$OPEN_S (M$IBEX1_NUM) ALTRET(E_OPEN);

  15174  2 004567   000013 630400 3                  EPPR0   11
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:216  
         2 004570   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 004571   000000 701000 xent               TSX1    CPC$OPEN_S
         2 004572   004642 702000 2                  TSX2    E_OPEN

     1405    15175        /*
     1406    15176             ***** Get a page to keep string subs in...
     1407    15177        */
     1408    15178    2     CALL CPC$GETSEG (SEG3$) ALTRET(E_GETSEG);

  15178  2 004573   000041 630400 3                  EPPR0   33
         2 004574   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 004575   000000 701000 xent               TSX1    CPC$GETSEG
         2 004576   004600 702000 2                  TSX2    E_GETSEG

     1409    15179    3     DO WHILE (%NO#);

  15179  2 004577   004604 710000 2                  TRA     s:15186

     1410    15180    3   E_GETSEG:   /* Screech */
     1411    15181    3        CALL CPC$SCREECH (E$SUASEG,CPH$IBEXMID);

  15181  2 004600   000064 630400 3     E_GETSEG     EPPR0   52
         2 004601   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 004602   000000 701000 xent               TSX1    CPC$SCREECH
         2 004603   000000 011000                    NOP     0

     1412    15182    3     END;

     1413    15183        /*
     1414    15184             ***** Initialize SEG3_
     1415    15185        */
     1416    15186    2     SEG3_ = VECTOR(CP$GLOBALS);

  15186  2 004604   000066 235000 3                  LDA     54
         2 004605   000000 236000 xsym               LDQ     SEG3$
         2 004606   200004 757100                    STAQ    SEG3_,,AUTO

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:217  
     1417    15187    2     SEG3_.VSIZE = 4095;   /* size of page */

  15187  2 004607   200004 236100                    LDQ     SEG3_,,AUTO
         2 004610   177777 376007                    ANQ     65535,DL
         2 004611   000067 276000 3                  ORQ     55
         2 004612   200004 756100                    STQ     SEG3_,,AUTO

     1418    15188        /*
     1419    15189             ***** Read global subs from *S file...
     1420    15190        */
     1421    15191    2     CALL CPJ$READ_S (M$IBEX1_NUM,VECTOR(K_GLOBAL),SEG3_) ALTRET(E_READ);

  15191  2 004613   200004 630500                    EPPR0   SEG3_,,AUTO
         2 004614   203066 450500                    STP0    NEED_2_READ_JOBSTATS+8,,AUTO
         2 004615   000060 237000 3                  LDAQ    48
         2 004616   203064 757100                    STAQ    NEED_2_READ_JOBSTATS+6,,AUTO
         2 004617   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 004620   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 004621   000000 701000 xent               TSX1    CPJ$READ_S
         2 004622   004636 702000 2                  TSX2    E_READ

     1422    15192        /*
     1423    15193             ***** A sucessful read means that GLOBAL subs
     1424    15194                   already exist. Set up the mcb to frame them...
     1425    15195        */
     1426    15196    2     X$MCB.WKSZ=CP$GLOBALS.WKSZ_SAVE;

  15196  2 004623   000000 470400 xsym               LDP0    SEG3$
         2 004624   000000 235100                    LDA     0,,PR0
         2 004625   200767 755100                    STA     X$MCB+4,,AUTO

     1427    15197    2     X$MCB.HI_SEGMENT$=CP$GLOBALS.HI_SEGMENT_SAVE$;

  15197  2 004626   000001 236100                    LDQ     1,,PR0
         2 004627   200766 756100                    STQ     X$MCB+3,,AUTO

     1428    15198    2     SUB$PARAMS.GLOBAL_DEF_HEAD$=CP$GLOBALS.SYM_HEAD_SAVE$;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:218  

  15198  2 004630   000002 236100                    LDQ     2,,PR0
         2 004631   203033 756100                    STQ     SUB$PARAMS+1,,AUTO

     1429    15199    2     X$MCB.FREE_HEAD$=CP$GLOBALS.FREE_HEAD_SAVE$;

  15199  2 004632   000003 236100                    LDQ     3,,PR0
         2 004633   200764 756100                    STQ     X$MCB+1,,AUTO

     1430    15200    2     RETURN;

  15200  2 004634   203052 221300                    LDX1  ! I,,AUTO
         2 004635   000001 702211                    TSX2  ! 1,X1

     1431    15201        /*
     1432    15202             ***** Some error has occured on the read...
     1433    15203        */
     1434    15204    2   E_READ:
     1435    15205    2     B$JIT.USRERR = '0'O;

  15205  2 004636   000000 470400 xsym  E_READ       LDP0    B$JIT$
         2 004637   000144 450100                    STZ     100,,PR0

     1436    15206    2     RETURN;

  15206  2 004640   203052 221300                    LDX1  ! I,,AUTO
         2 004641   000001 702211                    TSX2  ! 1,X1

     1437    15207        /*
     1438    15208             ***** If we got here,
     1439    15209                   then there must be some error...
     1440    15210        */
     1441    15211    2   E_OPEN:
     1442    15212    2     CALL CPC$WRITEMSGE (B$JIT.USRERR,M$IBEX1_NUM);

  15212  2 004642   000013 236000 3     E_OPEN       LDQ     11
         2 004643   203065 756100                    STQ     NEED_2_READ_JOBSTATS+7,,AUTO
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:219  
         2 004644   000000 236000 xsym               LDQ     B$JIT$
         2 004645   000144 036003                    ADLQ    100,DU
         2 004646   203064 756100                    STQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 004647   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 004650   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 004651   000000 701000 xent               TSX1    CPC$WRITEMSGE
         2 004652   000000 011000                    NOP     0

     1443    15213    2     ALTRETURN;

  15213  2 004653   203052 221300                    LDX1  ! I,,AUTO
         2 004654   000000 702211                    TSX2  ! 0,X1

     1444    15214    2   END READ_GLOBALS;
     1445    15215        %EJECT;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:220  
     1446    15216        /*****************************************************************/
     1447    15217        /*I*    NAME:    PROCESS_DIRECTIVES
     1448    15218                PURPOSE: If a directive (DEFAULT, INCLUDE, PROMPT) is found
     1449    15219                         then process it. If no directives are found then
     1450    15220                         altreturn.
     1451    15221        */
     1452    15222        /*****************************************************************/
     1453    15223    1   PROCESS_DIRECTIVES:

  15223  2 004655   203050 741300       PROCESS_DIR* STX1  ! SUB$PARAMS+14,,AUTO

     1454    15224    1     PROC ALTRET;
     1455    15225        /*E*    ERROR: CPH-E$MSDEFAULT-C
     1456    15226                MESSAGE: Missing DEFAULT sub
     1457    15227        */
     1458    15228        /*
     1459    15229             ***** Determine if this is a DIRECTIVE ...
     1460    15230        */
     1461    15231    2     IF SUBSTR(READBUF,0,1) ~= '!'

  15231  2 004656   200212 236100                    LDQ     READBUF,,AUTO
         2 004657   777000 376003                    ANQ     -512,DU
         2 004660   041000 116003                    CMPQ    16896,DU
         2 004661   004663 600000 2                  TZE     s:15234

     1462    15232    2        THEN   /* Must have leading ! */
     1463    15233    2           ALTRETURN;

  15233  2 004662   000000 702211                    TSX2  ! 0,X1

     1464    15234    2     CALL XLATE (TEMPBUF, B$XL_UPPER, READBUF);

  15234  2 004663   000000 470400 xsym               LDP0    B$XL_UPPER$
         2 004664   040100 160500                    MVT     fill='040'O
         2 004665   200212 000400                    ADSC9   READBUF,,AUTO            cn=0,n=256
         2 004666   200112 000400                    ADSC9   TEMPBUF,,AUTO            cn=0,n=256
         2 004667   000000 000100                    ARG     0,,PR0
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:221  

     1465    15235        /*
     1466    15236             ***** look for first word after the '!' *****
     1467    15237        */
     1468    15238    2     CALL SEARCH (START_INDX, X, B$SR_NON_BLANK, TEMPBUF, 1)

  15238  2 004670   000000 471400 xsym               LDP1    B$SR_NON_BLANK$
         2 004671   000000 164500                    TCT
         2 004672   200112 200377                    ADSC9   TEMPBUF,,AUTO            cn=1,n=255
         2 004673   100000 000100                    ARG     0,,PR1
         2 004674   200360 000100                    ARG     START_INDX,,AUTO
         2 004675   200360 235100                    LDA     START_INDX,,AUTO
         2 004676   000033 771000                    ARL     27
         2 004677   200364 755100                    STA     X,,AUTO
         2 004700   200360 551140                    STBA    START_INDX,'40'O,AUTO
         2 004701   200360 054100                    AOS     START_INDX,,AUTO
         2 004702   004754 606400 2                  TTN     s:15269

     1469    15239    3     WHENRETURN DO;

     1470    15240    3        CALL INDEX (STR_INDX, ' ', TEMPBUF, START_INDX);

  15240  2 004703   200360 720100                    LXL0    START_INDX,,AUTO
         2 004704   777377 620010                    EAX0    -257,X0
         2 004705   777777 660003                    ERX0    -1,DU
         2 004706   200360 236100                    LDQ     START_INDX,,AUTO
         2 004707   200360 235100                    LDA     START_INDX,,AUTO
         2 004710   000000 124545                    SCM     mask='000'O
         2 004711   200112 000010                    ADSC9   TEMPBUF,A,AUTO           cn=0,n=*X0
         2 004712   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 004713   200361 000100                    ARG     STR_INDX,,AUTO
         2 004714   200361 056100                    ASQ     STR_INDX,,AUTO

     1471    15241        /*
     1472    15242             ***** START_INDX and STR_INDX now frame VERB ...
     1473    15243        */
     1474    15244    3        IF (STR_INDX-START_INDX = 7) AND
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:222  

  15244  2 004715   200361 236100                    LDQ     STR_INDX,,AUTO
         2 004716   200360 136100                    SBLQ    START_INDX,,AUTO
         2 004717   000007 116007                    CMPQ    7,DL
         2 004720   004730 601000 2                  TNZ     s:15251
         2 004721   040000 106505                    CMPC    fill='040'O
         2 004722   200112 000007                    ADSC9   TEMPBUF,A,AUTO           cn=0,n=7
         2 004723   000076 000007 1                  ADSC9   E_NONAME_4_CONT+23       cn=0,n=7
         2 004724   004730 601000 2                  TNZ     s:15251

     1475    15245    3           (SUBSTR(TEMPBUF,START_INDX,7) = 'DEFAULT')
     1476    15246    3           THEN
     1477    15247    4              DO;

     1478    15248    4                 FAKE_NODE.CODE = DEFAULTCMND;

  15248  2 004725   000017 222003                    LDX2    15,DU
         2 004726   201021 442100                    SXL2    FAKE_NODE,,AUTO

     1479    15249    4                 GOTO PARSE_DIRECTIVE;

  15249  2 004727   004756 710000 2                  TRA     PARSE_DIRECTIVE

     1480    15250    4              END;
     1481    15251    3        IF (STR_INDX-START_INDX = 7) AND

  15251  2 004730   200361 236100                    LDQ     STR_INDX,,AUTO
         2 004731   200360 136100                    SBLQ    START_INDX,,AUTO
         2 004732   000007 116007                    CMPQ    7,DL
         2 004733   004754 601000 2                  TNZ     s:15269
         2 004734   040000 106505                    CMPC    fill='040'O
         2 004735   200112 000007                    ADSC9   TEMPBUF,A,AUTO           cn=0,n=7
         2 004736   000100 000007 1                  ADSC9   E_NONAME_4_CONT+25       cn=0,n=7
         2 004737   004754 601000 2                  TNZ     s:15269

     1482    15252    3           (SUBSTR(TEMPBUF,START_INDX,7) = 'INCLUDE')
     1483    15253    3           THEN
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:223  
     1484    15254    4              DO;

     1485    15255        /*
     1486    15256             ***** If still searching for START, don't do INCLUDES.
     1487    15257        */
     1488    15258    4                 IF START_METHOD ~= 0

  15258  2 004740   200352 236100                    LDQ     START_METHOD,,AUTO
         2 004741   004743 600000 2                  TZE     s:15261

     1489    15259    4                    THEN
     1490    15260    4                       ALTRETURN;

  15260  2 004742   000000 702211                    TSX2  ! 0,X1

     1491    15261    4                 FAKE_NODE.CODE = INCLUDECMND;

  15261  2 004743   000113 222003                    LDX2    75,DU
         2 004744   201021 442100                    SXL2    FAKE_NODE,,AUTO

     1492    15262    4                 CALL CPH$STRING_SUB (SUB$PARAMS);

  15262  2 004745   203032 633500                    EPPR3   SUB$PARAMS,,AUTO
         2 004746   203064 453500                    STP3    NEED_2_READ_JOBSTATS+6,,AUTO
         2 004747   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 004750   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 004751   000000 701000 xent               TSX1    CPH$STRING_SUB
         2 004752   000000 011000                    NOP     0

     1493    15263    4                 GOTO PARSE_DIRECTIVE;

  15263  2 004753   004756 710000 2                  TRA     PARSE_DIRECTIVE

     1494    15264    4              END;
     1495    15265    3     END;
     1496    15266        /*
     1497    15267             ***** Not a DIRECTIVE ...
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:224  
     1498    15268        */
     1499    15269    2     ALTRETURN;

  15269  2 004754   203050 221300                    LDX1  ! SUB$PARAMS+14,,AUTO
         2 004755   000000 702211                    TSX2  ! 0,X1

     1500    15270        %EJECT;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:225  
     1501    15271    2   PARSE_DIRECTIVE:
     1502    15272    2     PCB.U$$ = ENTADDR(CPD$SYNTRY);

  15272  2 004756   000000 636000 xent  PARSE_DIREC* EAQ     CPD$SYNTRY
         2 004757   201007 756100                    STQ     PCB+4,,AUTO

     1503    15273    2     PCB.TEXT$=PINCRC(ADDR(READBUF),1);

  15273  2 004760   203064 452500                    STP2    NEED_2_READ_JOBSTATS+6,,AUTO
         2 004761   203064 236100                    LDQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 004762   000024 036000 3                  ADLQ    20
         2 004763   201003 756100                    STQ     PCB,,AUTO

     1504    15274    2     PCB.NCHARS=SUB$PARAMS.BUF_LEN;

  15274  2 004764   203045 235100                    LDA     SUB$PARAMS+11,,AUTO
         2 004765   201014 755100                    STA     PCB+9,,AUTO

     1505    15275    2     PCB.OUT$ = ADDR(FAKE_NODE);

  15275  2 004766   201021 630500                    EPPR0   FAKE_NODE,,AUTO
         2 004767   201006 450500                    STP0    PCB+3,,AUTO

     1506    15276    2      PCB.CONTINUE = %NO#;

  15276  2 004770   000030 236000 3                  LDQ     24
         2 004771   201010 356100                    ANSQ    PCB+5,,AUTO

     1507    15277    2     CALL CPD$SET_NODES (PCB, PCB.ROOT$, PCB.USER$->U$PARAM.SPCL$$, CALL_FLG#) ;

  15277  2 004772   200373 631500                    EPPR1   CALL_FLG#,,AUTO
         2 004773   203067 451500                    STP1    NEED_2_READ_JOBSTATS+9,,AUTO
         2 004774   201017 236100                    LDQ     PCB+12,,AUTO
         2 004775   000003 036003                    ADLQ    3,DU
         2 004776   203066 756100                    STQ     NEED_2_READ_JOBSTATS+8,,AUTO
         2 004777   201004 633500                    EPPR3   PCB+1,,AUTO
         2 005000   203065 453500                    STP3    NEED_2_READ_JOBSTATS+7,,AUTO
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:226  
         2 005001   201003 634500                    EPPR4   PCB,,AUTO
         2 005002   203064 454500                    STP4    NEED_2_READ_JOBSTATS+6,,AUTO
         2 005003   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 005004   000022 631400 xsym               EPPR1   B_VECTNIL+18
         2 005005   000000 701000 xent               TSX1    CPD$SET_NODES
         2 005006   000000 011000                    NOP     0

     1508    15278    3     CALL X$PARSE (PCB) WHENALTRETURN DO;

  15278  2 005007   201003 630500                    EPPR0   PCB,,AUTO
         2 005010   203064 450500                    STP0    NEED_2_READ_JOBSTATS+6,,AUTO
         2 005011   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 005012   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 005013   000000 701000 xent               TSX1    X$PARSE
         2 005014   005016 702000 2                  TSX2    s:15279
         2 005015   005033 710000 2                  TRA     s:15282

     1509    15279    3        CALL CXP$POSTERR (ADDR(SEG$2.ERRBUF),PCB.HI_CHAR,PCB.ERROR);

  15279  2 005016   000000 236000 xsym               LDQ     SEG2$
         2 005017   000003 036003                    ADLQ    3,DU
         2 005020   203064 756100                    STQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 005021   201011 630500                    EPPR0   PCB+6,,AUTO
         2 005022   203067 450500                    STP0    NEED_2_READ_JOBSTATS+9,,AUTO
         2 005023   201015 631500                    EPPR1   PCB+10,,AUTO
         2 005024   203066 451500                    STP1    NEED_2_READ_JOBSTATS+8,,AUTO
         2 005025   203064 633500                    EPPR3   NEED_2_READ_JOBSTATS+6,,AUTO
         2 005026   203065 453500                    STP3    NEED_2_READ_JOBSTATS+7,,AUTO
         2 005027   203065 630500                    EPPR0   NEED_2_READ_JOBSTATS+7,,AUTO
         2 005030   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 005031   000000 701000 xent               TSX1    CXP$POSTERR
         2 005032   000000 011000                    NOP     0

     1510    15280    3     END;

     1511    15281        /**/
     1512    15282    2     IF SEG$2.ERRBUF(1) ~= 0
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:227  

  15282  2 005033   000000 470400 xsym               LDP0    SEG2$
         2 005034   000004 235100                    LDA     4,,PR0
         2 005035   005075 600000 2                  TZE     s:15295

     1513    15283    2         THEN
     1514    15284    3             DO;

     1515    15285    3        CALL CONCAT (WRITEBUF,'     ',READBUF);

  15285  2 005036   040100 100400                    MLR     fill='040'O
         2 005037   000063 000005 1                  ADSC9   E_NONAME_4_CONT+12       cn=0,n=5
         2 005040   200012 000005                    ADSC9   WRITEBUF,,AUTO           cn=0,n=5
         2 005041   040100 100500                    MLR     fill='040'O
         2 005042   200212 000373                    ADSC9   READBUF,,AUTO            cn=0,n=251
         2 005043   200013 200373                    ADSC9   WRITEBUF+1,,AUTO         cn=1,n=251

     1516    15286    3        SEG$2.FPT_WRITECC$->FPT$WRITE.BUF_.BOUND =

  15286  2 005044   000000 470400 xsym               LDP0    SEG2$
         2 005045   000161 471500                    LDP1    113,,PR0
         2 005046   000004 473400 3                  LDP3    4
         2 005047   300000 474500                    LDP4    0,,PR3
         2 005050   000000 720000 xsym               LXL0    M$IBEX_NUM
         2 005051   400000 475510                    LDP5    0,X0,PR4
         2 005052   500000 236100                    LDQ     0,,PR5
         2 005053   000004 036007                    ADLQ    4,DL
         2 005054   000377 116007                    CMPQ    255,DL
         2 005055   005057 604400 2                  TMOZ    s:15286+11
         2 005056   000377 236007                    LDQ     255,DL
         2 005057   000020 736000                    QLS     16
         2 005060   100004 676100                    ERQ     4,,PR1
         2 005061   000034 376000 xsym               ANQ     B_VECTNIL+28
         2 005062   100004 656100                    ERSQ    4,,PR1

     1517    15287    3           MINIMUM(LENGTHV(WRITEBUF),DCBADDR(M$IBEX_NUM) ->
     1518    15288    3                 F$DCB.ARS# + 4);
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:228  
     1519    15289    3        CALL CPE$DIAGOUT (SEG$2.FPT_WRITECC$);

  15289  2 005063   000000 236000 xsym               LDQ     SEG2$
         2 005064   000161 036003                    ADLQ    113,DU
         2 005065   203064 756100                    STQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 005066   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 005067   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 005070   000000 701000 xent               TSX1    CPE$DIAGOUT
         2 005071   000000 011000                    NOP     0

     1520    15290    3        CALL STUFF_GETCMD_4_ERRPTR ;

  15290  2 005072   007164 701000 2                  TSX1    STUFF_GETCMD_4_ERRPTR
         2 005073   000000 011000                    NOP     0

     1521    15291    3        GOTO ABORT;

  15291  2 005074   006337 710000 2                  TRA     ABORT

     1522    15292    3     END;
     1523    15293        /**/
     1524    15294        /**/
     1525    15295    2     IF PCB.OUT$ -> P$B.CODE = INCLUDECMND

  15295  2 005075   201006 471500                    LDP1    PCB+3,,AUTO
         2 005076   100000 720100                    LXL0    0,,PR1
         2 005077   000113 100003                    CMPX0   75,DU
         2 005100   005753 600000 2                  TZE     PROCESS_INCLUDE

     1526    15296    2        THEN
     1527    15297    2           GOTO PROCESS_INCLUDE;
     1528    15298        %EJECT;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:229  
     1529    15299    2   PROCESS_DEFAULT:
     1530    15300    2     IF PCB.OUT$->P$B.NSUBLKS = 0

  15300  2 005101   100001 221100       PROCESS_DEF* LDX1    1,,PR1
         2 005102   005415 601000 2                  TNZ     s:15342

     1531    15301    2        THEN
     1532    15302        /*
     1533    15303             ***** List all the DEFAULT subs in effect currently...
     1534    15304        */
     1535    15305    3           DO;

     1536    15306    3              SEG$2.FPT_WRITECC$ -> FPT$WRITE.BUF_ = VECTOR(WRITEBUF);

  15306  2 005103   000161 473500                    LDP3    113,,PR0
         2 005104   000002 235000 3                  LDA     2
         2 005105   203064 452500                    STP2    NEED_2_READ_JOBSTATS+6,,AUTO
         2 005106   203064 236100                    LDQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 005107   000012 036003                    ADLQ    10,DU
         2 005110   300004 757100                    STAQ    4,,PR3

     1537    15307    3              X$PARAM.SYM_HEAD$ = SUB$PARAMS.DEFAULT_DEF_HEAD$;

  15307  2 005111   203035 236100                    LDQ     SUB$PARAMS+3,,AUTO
         2 005112   200774 756100                    STQ     X$PARAM,,AUTO

     1538    15308    3              X$PARAM.NUM = 0;

  15308  2 005113   000000 220003                    LDX0    0,DU
         2 005114   200776 440100                    SXL0    X$PARAM+2,,AUTO

     1539    15309    3              X$PARAM.SRCH = 2;

  15309  2 005115   002000 236003                    LDQ     1024,DU
         2 005116   200776 552140                    STBQ    X$PARAM+2,'40'O,AUTO

     1540    15310    3              IF X$PARAM.SYM_HEAD$ = ADDR(NIL)
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:230  

  15310  2 005117   200774 236100                    LDQ     X$PARAM,,AUTO
         2 005120   000001 116000 xsym               CMPQ    B_VECTNIL+1
         2 005121   005143 601000 2                  TNZ     s:15320

     1541    15311    3                 THEN
     1542    15312    4                    DO;   /* No DEFAULTs */

     1543    15313    4                       WRITEBUF = '   Defaults: none';

  15313  2 005122   040100 100400                    MLR     fill='040'O
         2 005123   000102 000021 1                  ADSC9   E_NONAME_4_CONT+27       cn=0,n=17
         2 005124   200012 000400                    ADSC9   WRITEBUF,,AUTO           cn=0,n=256

     1544    15314    4                       SEG$2.FPT_WRITECC$->FPT$WRITE.BUF_.BOUND=16;

  15314  2 005125   000161 471500                    LDP1    113,,PR0
         2 005126   100004 236100                    LDQ     4,,PR1
         2 005127   177777 376007                    ANQ     65535,DL
         2 005130   000004 276003                    ORQ     4,DU
         2 005131   100004 756100                    STQ     4,,PR1

     1545    15315    4                       CALL CPE$LISTOUT (SEG$2.FPT_WRITECC$);

  15315  2 005132   000000 236000 xsym               LDQ     SEG2$
         2 005133   000161 036003                    ADLQ    113,DU
         2 005134   203064 756100                    STQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 005135   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 005136   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 005137   000000 701000 xent               TSX1    CPE$LISTOUT
         2 005140   000000 011000                    NOP     0

     1546    15316    4                       RETURN;

  15316  2 005141   203050 221300                    LDX1  ! SUB$PARAMS+14,,AUTO
         2 005142   000001 702211                    TSX2  ! 1,X1

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:231  
     1547    15317    4                    END;
     1548    15318    3                 ELSE
     1549    15319    4                    DO;

     1550    15320    4                       WRITEBUF = '   Defaults:';

  15320  2 005143   040100 100400                    MLR     fill='040'O
         2 005144   000102 000014 1                  ADSC9   E_NONAME_4_CONT+27       cn=0,n=12
         2 005145   200012 000400                    ADSC9   WRITEBUF,,AUTO           cn=0,n=256

     1551    15321    4                       SEG$2.FPT_WRITECC$->FPT$WRITE.BUF_.BOUND=11;

  15321  2 005146   000161 471500                    LDP1    113,,PR0
         2 005147   100004 236100                    LDQ     4,,PR1
         2 005150   177777 376007                    ANQ     65535,DL
         2 005151   000070 276000 3                  ORQ     56
         2 005152   100004 756100                    STQ     4,,PR1

     1552    15322    4                       CALL CPE$LISTOUT (SEG$2.FPT_WRITECC$);

  15322  2 005153   000000 236000 xsym               LDQ     SEG2$
         2 005154   000161 036003                    ADLQ    113,DU
         2 005155   203064 756100                    STQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 005156   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 005157   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 005160   000000 701000 xent               TSX1    CPE$LISTOUT
         2 005161   000000 011000                    NOP     0

     1553    15323    4                    END;

     1554    15324    4              DO WHILE (%YES#);

     1555    15325    4                 CALL CPH$SYM_GET (X$MCB,X$PARAM) ALTRET(SYM_ERR);

  15325  2 005162   200774 630500                    EPPR0   X$PARAM,,AUTO
         2 005163   203065 450500                    STP0    NEED_2_READ_JOBSTATS+7,,AUTO
         2 005164   200763 631500                    EPPR1   X$MCB,,AUTO
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:232  
         2 005165   203064 451500                    STP1    NEED_2_READ_JOBSTATS+6,,AUTO
         2 005166   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 005167   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 005170   000000 701000 xent               TSX1    CPH$SYM_GET
         2 005171   005751 702000 2                  TSX2    SYM_ERR

     1556    15326    4                 IF X$PARAM.TYPE = %DSTRING#

  15326  2 005172   200776 236100                    LDQ     X$PARAM+2,,AUTO
         2 005173   000777 376003                    ANQ     511,DU
         2 005174   000005 116003                    CMPQ    5,DU
         2 005175   005270 601000 2                  TNZ     s:15332

     1557    15327    4                    THEN
     1558    15328    4                       CALL CONCAT (WRITEBUF,'      ''',X$PARAM.TEXTC$(0)

  15328  2 005176   200777 470500                    LDP0    X$PARAM+3,,AUTO
         2 005177   000100 101500                    MRL     fill='000'O
         2 005200   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
         2 005201   203064 000002                    ADSC9   NEED_2_READ_JOBSTATS+6,,AUTO cn=0,n=2
         2 005202   203064 220100                    LDX0    NEED_2_READ_JOBSTATS+6,,AUTO
         2 005203   201000 471500                    LDP1    X$PARAM+4,,AUTO
         2 005204   000100 101500                    MRL     fill='000'O
         2 005205   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
         2 005206   203065 000002                    ADSC9   NEED_2_READ_JOBSTATS+7,,AUTO cn=0,n=2
         2 005207   203065 221100                    LDX1    NEED_2_READ_JOBSTATS+7,,AUTO
         2 005210   040100 100400                    MLR     fill='040'O
         2 005211   000071 000007 1                  ADSC9   E_NONAME_4_CONT+18       cn=0,n=7
         2 005212   200012 000007                    ADSC9   WRITEBUF,,AUTO           cn=0,n=7
         2 005213   040100 100540                    MLR     fill='040'O
         2 005214   000000 200010                    ADSC9   0,,PR0                   cn=1,n=*X0
         2 005215   200013 600371                    ADSC9   WRITEBUF+1,,AUTO         cn=3,n=249
         2 005216   000000 636010                    EAQ     0,X0
         2 005217   000022 772000                    QRL     18
         2 005220   000371 116007                    CMPQ    249,DL
         2 005221   005267 603000 2                  TRC     s:15328+57
         2 005222   203066 740100                    STX0    NEED_2_READ_JOBSTATS+8,,AUTO
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:233  
         2 005223   777406 620010                    EAX0    -250,X0
         2 005224   777777 660003                    ERX0    -1,DU
         2 005225   203066 235100                    LDA     NEED_2_READ_JOBSTATS+8,,AUTO
         2 005226   000022 771000                    ARL     18
         2 005227   040145 100400                    MLR     fill='040'O
         2 005230   000073 000005 1                  ADSC9   E_NONAME_4_CONT+20       cn=0,n=5
         2 005231   200013 600010                    ADSC9   WRITEBUF+1,A,AUTO        cn=3,n=*X0
         2 005232   203066 236100                    LDQ     NEED_2_READ_JOBSTATS+8,,AUTO
         2 005233   000022 772000                    QRL     18
         2 005234   000364 116007                    CMPQ    244,DL
         2 005235   005267 603000 2                  TRC     s:15328+57
         2 005236   777413 620006                    EAX0    -245,QL
         2 005237   777777 660003                    ERX0    -1,DU
         2 005240   201000 470500                    LDP0    X$PARAM+4,,AUTO
         2 005241   040146 100540                    MLR     fill='040'O
         2 005242   000000 200011                    ADSC9   0,,PR0                   cn=1,n=*X1
         2 005243   200015 000010                    ADSC9   WRITEBUF+3,Q,AUTO        cn=0,n=*X0
         2 005244   000000 635011                    EAA     0,X1
         2 005245   000022 771000                    ARL     18
         2 005246   203067 755100                    STA     NEED_2_READ_JOBSTATS+9,,AUTO
         2 005247   203067 036100                    ADLQ    NEED_2_READ_JOBSTATS+9,,AUTO
         2 005250   000364 116007                    CMPQ    244,DL
         2 005251   005267 603000 2                  TRC     s:15328+57
         2 005252   000000 635011                    EAA     0,X1
         2 005253   000022 771000                    ARL     18
         2 005254   203070 755100                    STA     NEED_2_READ_JOBSTATS+10,,AUTO
         2 005255   203071 756100                    STQ     NEED_2_READ_JOBSTATS+11,,AUTO
         2 005256   203066 236100                    LDQ     NEED_2_READ_JOBSTATS+8,,AUTO
         2 005257   000022 772000                    QRL     18
         2 005260   203070 036100                    ADLQ    NEED_2_READ_JOBSTATS+10,,AUTO
         2 005261   203071 722100                    LXL2    NEED_2_READ_JOBSTATS+11,,AUTO
         2 005262   777413 622012                    EAX2    -245,X2
         2 005263   777777 662003                    ERX2    -1,DU
         2 005264   040146 100400                    MLR     fill='040'O
         2 005265   000053 000001 3                  ADSC9   43                       cn=0,n=1
         2 005266   200015 000012                    ADSC9   WRITEBUF+3,Q,AUTO        cn=0,n=*X2
         2 005267   005361 710000 2                  TRA     s:15335
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:234  

     1559    15329    4                            -> X$STRING.TEXT,''' = ''',
     1560    15330    4                            X$PARAM.TEXTC$(1) -> X$STRING.TEXT,'''');
     1561    15331    4                    ELSE
     1562    15332    4                       CALL CONCAT (WRITEBUF,'      ',X$PARAM.TEXTC$(0)

  15332  2 005270   200777 470500                    LDP0    X$PARAM+3,,AUTO
         2 005271   000100 101500                    MRL     fill='000'O
         2 005272   000000 000001                    ADSC9   0,,PR0                   cn=0,n=1
         2 005273   203064 000002                    ADSC9   NEED_2_READ_JOBSTATS+6,,AUTO cn=0,n=2
         2 005274   203064 220100                    LDX0    NEED_2_READ_JOBSTATS+6,,AUTO
         2 005275   201000 471500                    LDP1    X$PARAM+4,,AUTO
         2 005276   000100 101500                    MRL     fill='000'O
         2 005277   100000 000001                    ADSC9   0,,PR1                   cn=0,n=1
         2 005300   203065 000002                    ADSC9   NEED_2_READ_JOBSTATS+7,,AUTO cn=0,n=2
         2 005301   203065 221100                    LDX1    NEED_2_READ_JOBSTATS+7,,AUTO
         2 005302   040100 100400                    MLR     fill='040'O
         2 005303   000063 000006 1                  ADSC9   E_NONAME_4_CONT+12       cn=0,n=6
         2 005304   200012 000006                    ADSC9   WRITEBUF,,AUTO           cn=0,n=6
         2 005305   040100 100540                    MLR     fill='040'O
         2 005306   000000 200010                    ADSC9   0,,PR0                   cn=1,n=*X0
         2 005307   200013 400372                    ADSC9   WRITEBUF+1,,AUTO         cn=2,n=250
         2 005310   000000 636010                    EAQ     0,X0
         2 005311   000022 772000                    QRL     18
         2 005312   000372 116007                    CMPQ    250,DL
         2 005313   005361 603000 2                  TRC     s:15335
         2 005314   203066 740100                    STX0    NEED_2_READ_JOBSTATS+8,,AUTO
         2 005315   777405 620010                    EAX0    -251,X0
         2 005316   777777 660003                    ERX0    -1,DU
         2 005317   203066 235100                    LDA     NEED_2_READ_JOBSTATS+8,,AUTO
         2 005320   000022 771000                    ARL     18
         2 005321   040145 100400                    MLR     fill='040'O
         2 005322   000075 000004 1                  ADSC9   E_NONAME_4_CONT+22       cn=0,n=4
         2 005323   200013 400010                    ADSC9   WRITEBUF+1,A,AUTO        cn=2,n=*X0
         2 005324   203066 236100                    LDQ     NEED_2_READ_JOBSTATS+8,,AUTO
         2 005325   000022 772000                    QRL     18
         2 005326   000366 116007                    CMPQ    246,DL
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:235  
         2 005327   005361 603000 2                  TRC     s:15335
         2 005330   777411 620006                    EAX0    -247,QL
         2 005331   777777 660003                    ERX0    -1,DU
         2 005332   201000 470500                    LDP0    X$PARAM+4,,AUTO
         2 005333   040146 100540                    MLR     fill='040'O
         2 005334   000000 200011                    ADSC9   0,,PR0                   cn=1,n=*X1
         2 005335   200014 400010                    ADSC9   WRITEBUF+2,Q,AUTO        cn=2,n=*X0
         2 005336   000000 635011                    EAA     0,X1
         2 005337   000022 771000                    ARL     18
         2 005340   203067 755100                    STA     NEED_2_READ_JOBSTATS+9,,AUTO
         2 005341   203067 036100                    ADLQ    NEED_2_READ_JOBSTATS+9,,AUTO
         2 005342   000366 116007                    CMPQ    246,DL
         2 005343   005361 603000 2                  TRC     s:15335
         2 005344   000000 635011                    EAA     0,X1
         2 005345   000022 771000                    ARL     18
         2 005346   203070 755100                    STA     NEED_2_READ_JOBSTATS+10,,AUTO
         2 005347   203071 756100                    STQ     NEED_2_READ_JOBSTATS+11,,AUTO
         2 005350   203066 236100                    LDQ     NEED_2_READ_JOBSTATS+8,,AUTO
         2 005351   000022 772000                    QRL     18
         2 005352   203070 036100                    ADLQ    NEED_2_READ_JOBSTATS+10,,AUTO
         2 005353   203071 722100                    LXL2    NEED_2_READ_JOBSTATS+11,,AUTO
         2 005354   777411 622012                    EAX2    -247,X2
         2 005355   777777 662003                    ERX2    -1,DU
         2 005356   040146 100400                    MLR     fill='040'O
         2 005357   000053 000001 3                  ADSC9   43                       cn=0,n=1
         2 005360   200014 400012                    ADSC9   WRITEBUF+2,Q,AUTO        cn=2,n=*X2

     1563    15333    4                            -> X$STRING.TEXT,' = ''',
     1564    15334    4                            X$PARAM.TEXTC$(1) -> X$STRING.TEXT,'''');
     1565    15335    4                 SEG$2.FPT_WRITECC$->FPT$WRITE.BUF_.BOUND =

  15335  2 005361   000000 470400 xsym               LDP0    SEG2$
         2 005362   000161 471500                    LDP1    113,,PR0
         2 005363   201000 473500                    LDP3    X$PARAM+4,,AUTO
         2 005364   000100 101500                    MRL     fill='000'O
         2 005365   300000 000001                    ADSC9   0,,PR3                   cn=0,n=1
         2 005366   203064 000004                    ADSC9   NEED_2_READ_JOBSTATS+6,,AUTO cn=0,n=4
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:236  
         2 005367   200777 474500                    LDP4    X$PARAM+3,,AUTO
         2 005370   000100 101500                    MRL     fill='000'O
         2 005371   400000 000001                    ADSC9   0,,PR4                   cn=0,n=1
         2 005372   203065 000004                    ADSC9   NEED_2_READ_JOBSTATS+7,,AUTO cn=0,n=4
         2 005373   203065 236100                    LDQ     NEED_2_READ_JOBSTATS+7,,AUTO
         2 005374   203064 036100                    ADLQ    NEED_2_READ_JOBSTATS+6,,AUTO
         2 005375   000014 036007                    ADLQ    12,DL
         2 005376   000020 736000                    QLS     16
         2 005377   100004 676100                    ERQ     4,,PR1
         2 005400   000034 376000 xsym               ANQ     B_VECTNIL+28
         2 005401   100004 656100                    ERSQ    4,,PR1

     1566    15336    4                      X$PARAM.TEXTC$(0)->X$STRING.SIZ+
     1567    15337    4                      X$PARAM.TEXTC$(1)->X$STRING.SIZ+12;
     1568    15338    4                 CALL CPE$LISTOUT (SEG$2.FPT_WRITECC$);

  15338  2 005402   000000 236000 xsym               LDQ     SEG2$
         2 005403   000161 036003                    ADLQ    113,DU
         2 005404   203064 756100                    STQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 005405   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 005406   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 005407   000000 701000 xent               TSX1    CPE$LISTOUT
         2 005410   000000 011000                    NOP     0

     1569    15339    4                 X$PARAM.NUM = X$PARAM.NUM + 1;

  15339  2 005411   200776 720100                    LXL0    X$PARAM+2,,AUTO
         2 005412   000001 621010                    EAX1    1,X0
         2 005413   200776 441100                    SXL1    X$PARAM+2,,AUTO

     1570    15340    4              END;

  15340  2 005414   005162 710000 2                  TRA     s:15325

     1571    15341    3           END;
     1572    15342    2     TEMP$=PCB.OUT$->P$B.SUBLK$(0);

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:237  
  15342  2 005415   100003 236100                    LDQ     3,,PR1
         2 005416   200007 756100                    STQ     TEMP$,,AUTO

     1573    15343    2     IF TEMP$->P$B.CODE = BA_DELETE

  15343  2 005417   200007 473500                    LDP3    TEMP$,,AUTO
         2 005420   300000 720100                    LXL0    0,,PR3
         2 005421   000001 100003                    CMPX0   1,DU
         2 005422   005571 601000 2                  TNZ     s:15382

     1574    15344    2        THEN
     1575    15345    3           DO;   /* Reset DEFAULT subs */

     1576    15346    3              IF TEMP$ -> P$B.NSUBLKS > 0

  15346  2 005423   300001 221100                    LDX1    1,,PR3
         2 005424   005551 600000 2                  TZE     s:15372

     1577    15347    4                 THEN DO;  /* delete the listed DEFAULT subs... */

     1578    15348    4                    X$PARAM.SYM_HEAD$ = SUB$PARAMS.DEFAULT_DEF_HEAD$;

  15348  2 005425   203035 236100                    LDQ     SUB$PARAMS+3,,AUTO
         2 005426   200774 756100                    STQ     X$PARAM,,AUTO

     1579    15349    4                    X$PARAM.SRCH = 1;

  15349  2 005427   001000 236003                    LDQ     512,DU
         2 005430   200776 552140                    STBQ    X$PARAM+2,'40'O,AUTO

     1580    15350    5                    DO NUM_OPTS = 0 TO TEMP$ -> P$B.NSUBLKS -1;

  15350  2 005431   200363 450100                    STZ     NUM_OPTS,,AUTO
         2 005432   005542 710000 2                  TRA     s:15369+3

     1581    15351    5                       P$ = TEMP$ -> P$B.SUBLK$(NUM_OPTS);

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:238  
  15351  2 005433   200007 470500                    LDP0    TEMP$,,AUTO
         2 005434   200363 720100                    LXL0    NUM_OPTS,,AUTO
         2 005435   000003 236110                    LDQ     3,X0,PR0
         2 005436   200010 756100                    STQ     P$,,AUTO

     1582    15352    5                       X$PARAM.TYPE = P$ -> P$B.NDTYPE;

  15352  2 005437   200010 471500                    LDP1    P$,,AUTO
         2 005440   100000 236100                    LDQ     0,,PR1
         2 005441   000077 376003                    ANQ     63,DU
         2 005442   200776 552120                    STBQ    X$PARAM+2,'20'O,AUTO

     1583    15353    5                       X$PARAM.TEXTC$(0) = P$ -> P$S.TEXTC$;

  15353  2 005443   100003 236100                    LDQ     3,,PR1
         2 005444   200777 756100                    STQ     X$PARAM+3,,AUTO

     1584    15354    5                       CALL CPH$SYM_DELETE (X$MCB,X$PARAM)

  15354  2 005445   200774 633500                    EPPR3   X$PARAM,,AUTO
         2 005446   203065 453500                    STP3    NEED_2_READ_JOBSTATS+7,,AUTO
         2 005447   200763 634500                    EPPR4   X$MCB,,AUTO
         2 005450   203064 454500                    STP4    NEED_2_READ_JOBSTATS+6,,AUTO
         2 005451   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 005452   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 005453   000000 701000 xent               TSX1    CPH$SYM_DELETE
         2 005454   005460 702000 2                  TSX2    s:15359

     1585    15355    6                       WHENRETURN DO;

     1586    15356    6                          SUB$PARAMS.DEFAULT_DEF_HEAD$ = X$PARAM.SYM_HEAD$;

  15356  2 005455   200774 236100                    LDQ     X$PARAM,,AUTO
         2 005456   203035 756100                    STQ     SUB$PARAMS+3,,AUTO

     1587    15357    6                       END;

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:239  
  15357  2 005457   005537 710000 2                  TRA     s:15369

     1588    15358    6                       WHENALTRETURN DO;

     1589    15359    6                          CPOS = P$ -> P$S.CPOS;

  15359  2 005460   200010 470500                    LDP0    P$,,AUTO
         2 005461   000002 235100                    LDA     2,,PR0
         2 005462   200357 755100                    STA     CPOS,,AUTO

     1590    15360    6                          CALL CXP$POSTERR (ADDR(SEG$2.ERRBUF),CPOS,E_MSDEFAULT);

  15360  2 005463   000000 236000 xsym               LDQ     SEG2$
         2 005464   000003 036003                    ADLQ    3,DU
         2 005465   203064 756100                    STQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 005466   000071 236000 3                  LDQ     57
         2 005467   203067 756100                    STQ     NEED_2_READ_JOBSTATS+9,,AUTO
         2 005470   200357 631500                    EPPR1   CPOS,,AUTO
         2 005471   203066 451500                    STP1    NEED_2_READ_JOBSTATS+8,,AUTO
         2 005472   203064 633500                    EPPR3   NEED_2_READ_JOBSTATS+6,,AUTO
         2 005473   203065 453500                    STP3    NEED_2_READ_JOBSTATS+7,,AUTO
         2 005474   203065 630500                    EPPR0   NEED_2_READ_JOBSTATS+7,,AUTO
         2 005475   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 005476   000000 701000 xent               TSX1    CXP$POSTERR
         2 005477   000000 011000                    NOP     0

     1591    15361    6                          CALL CONCAT (WRITEBUF,'     ',READBUF);

  15361  2 005500   040100 100400                    MLR     fill='040'O
         2 005501   000063 000005 1                  ADSC9   E_NONAME_4_CONT+12       cn=0,n=5
         2 005502   200012 000005                    ADSC9   WRITEBUF,,AUTO           cn=0,n=5
         2 005503   040100 100500                    MLR     fill='040'O
         2 005504   200212 000373                    ADSC9   READBUF,,AUTO            cn=0,n=251
         2 005505   200013 200373                    ADSC9   WRITEBUF+1,,AUTO         cn=1,n=251

     1592    15362    6                          CALL STUFF_GETCMD_4_ERRPTR ;

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:240  
  15362  2 005506   007164 701000 2                  TSX1    STUFF_GETCMD_4_ERRPTR
         2 005507   000000 011000                    NOP     0

     1593    15363    6                          SEG$2.FPT_WRITECC$->FPT$WRITE.BUF_.BOUND =

  15363  2 005510   000000 470400 xsym               LDP0    SEG2$
         2 005511   000161 471500                    LDP1    113,,PR0
         2 005512   000004 473400 3                  LDP3    4
         2 005513   300000 474500                    LDP4    0,,PR3
         2 005514   000000 720000 xsym               LXL0    M$IBEX_NUM
         2 005515   400000 475510                    LDP5    0,X0,PR4
         2 005516   500000 236100                    LDQ     0,,PR5
         2 005517   000004 036007                    ADLQ    4,DL
         2 005520   000377 116007                    CMPQ    255,DL
         2 005521   005523 604400 2                  TMOZ    s:15363+11
         2 005522   000377 236007                    LDQ     255,DL
         2 005523   000020 736000                    QLS     16
         2 005524   100004 676100                    ERQ     4,,PR1
         2 005525   000034 376000 xsym               ANQ     B_VECTNIL+28
         2 005526   100004 656100                    ERSQ    4,,PR1

     1594    15364    6                              MINIMUM(LENGTHV(WRITEBUF),DCBADDR(M$IBEX_NUM) ->
     1595    15365    6                              F$DCB.ARS# + 4);
     1596    15366    6                          CALL CPE$DIAGOUT (SEG$2.FPT_WRITECC$);

  15366  2 005527   000000 236000 xsym               LDQ     SEG2$
         2 005530   000161 036003                    ADLQ    113,DU
         2 005531   203064 756100                    STQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 005532   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 005533   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 005534   000000 701000 xent               TSX1    CPE$DIAGOUT
         2 005535   000000 011000                    NOP     0

     1597    15367    6                          GOTO ABORT ;

  15367  2 005536   006337 710000 2                  TRA     ABORT

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:241  
     1598    15368    6                       END;
     1599    15369    5                    END;   /* Reset DEFAULT subs */

  15369  2 005537   200363 235100                    LDA     NUM_OPTS,,AUTO
         2 005540   000001 035007                    ADLA    1,DL
         2 005541   200363 755100                    STA     NUM_OPTS,,AUTO
         2 005542   200007 470500                    LDP0    TEMP$,,AUTO
         2 005543   000001 236100                    LDQ     1,,PR0
         2 005544   000022 772000                    QRL     18
         2 005545   200363 116100                    CMPQ    NUM_OPTS,,AUTO
         2 005546   005550 600000 2                  TZE     s:15370
         2 005547   005433 603000 2                  TRC     s:15351

     1600    15370    4                 END;  /* NSUBLKS > 0 */

  15370  2 005550   005567 710000 2                  TRA     s:15377

     1601    15371    4                 ELSE DO;  /* delete all DEFAULT subs... */

     1602    15372    4                    X$PARAM.SYM_HEAD$ = SUB$PARAMS.DEFAULT_DEF_HEAD$;

  15372  2 005551   203035 236100                    LDQ     SUB$PARAMS+3,,AUTO
         2 005552   200774 756100                    STQ     X$PARAM,,AUTO

     1603    15373    4                    X$PARAM.SRCH = 2;

  15373  2 005553   002000 236003                    LDQ     1024,DU
         2 005554   200776 552140                    STBQ    X$PARAM+2,'40'O,AUTO

     1604    15374    4                    CALL CPH$SYM_DELETE (X$MCB,X$PARAM);

  15374  2 005555   200774 634500                    EPPR4   X$PARAM,,AUTO
         2 005556   203065 454500                    STP4    NEED_2_READ_JOBSTATS+7,,AUTO
         2 005557   200763 635500                    EPPR5   X$MCB,,AUTO
         2 005560   203064 455500                    STP5    NEED_2_READ_JOBSTATS+6,,AUTO
         2 005561   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 005562   000020 631400 xsym               EPPR1   B_VECTNIL+16
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:242  
         2 005563   000000 701000 xent               TSX1    CPH$SYM_DELETE
         2 005564   000000 011000                    NOP     0

     1605    15375    4                    SUB$PARAMS.DEFAULT_DEF_HEAD$ = ADDR(NIL);

  15375  2 005565   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 005566   203035 756100                    STQ     SUB$PARAMS+3,,AUTO

     1606    15376    4                 END;

     1607    15377    3              RETURN;

  15377  2 005567   203050 221300                    LDX1  ! SUB$PARAMS+14,,AUTO
         2 005570   000001 702211                    TSX2  ! 1,X1

     1608    15378    3           END;
     1609    15379        /*
     1610    15380             ***** add new DEFAULT subs...
     1611    15381        */
     1612    15382    2     X$PARAM.SYM_HEAD$=SUB$PARAMS.DEFAULT_DEF_HEAD$;

  15382  2 005571   203035 236100                    LDQ     SUB$PARAMS+3,,AUTO
         2 005572   200774 756100                    STQ     X$PARAM,,AUTO

     1613    15383    2     X$PARAM.SRCH = 1;

  15383  2 005573   001000 236003                    LDQ     512,DU
         2 005574   200776 552140                    STBQ    X$PARAM+2,'40'O,AUTO

     1614    15384    3     DO NUM_OPTS = 0 TO PCB.OUT$ -> P$B.NSUBLKS - 1;

  15384  2 005575   200363 450100                    STZ     NUM_OPTS,,AUTO
         2 005576   005741 710000 2                  TRA     s:15418+3

     1615    15385    3        TEMP$=PCB.OUT$->P$B.SUBLK$(NUM_OPTS);

  15385  2 005577   201006 470500                    LDP0    PCB+3,,AUTO
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:243  
         2 005600   200363 720100                    LXL0    NUM_OPTS,,AUTO
         2 005601   000003 236110                    LDQ     3,X0,PR0
         2 005602   200007 756100                    STQ     TEMP$,,AUTO

     1616    15386    3        X$PARAM.TEXTC$(0)=TEMP$->P$B.SUBLK$(0)->P$S.TEXTC$;

  15386  2 005603   200007 471500                    LDP1    TEMP$,,AUTO
         2 005604   100003 473500                    LDP3    3,,PR1
         2 005605   300003 236100                    LDQ     3,,PR3
         2 005606   200777 756100                    STQ     X$PARAM+3,,AUTO

     1617    15387    4        DO CASE (TEMP$->P$B.SUBLK$(1)->P$S.CODE);

  15387  2 005607   100004 473500                    LDP3    4,,PR1
         2 005610   300000 721100                    LXL1    0,,PR3
         2 005611   000003 101003                    CMPX1   3,DU
         2 005612   005614 602011 2                  TNC     s:15387+5,X1
         2 005613   005676 710000 2                  TRA     s:15406
         2 005614   005676 710000 2                  TRA     s:15406
         2 005615   005617 710000 2                  TRA     s:15389
         2 005616   005623 710000 2                  TRA     s:15391

     1618    15388    4          CASE (DEFSTRING);

     1619    15389    4            X$PARAM.TEXTC$(1)=TEMP$->P$B.SUBLK$(1)->P$B.SUBLK$(0)->P$S.TEXTC$;

  15389  2 005617   300003 474500                    LDP4    3,,PR3
         2 005620   400003 236100                    LDQ     3,,PR4
         2 005621   201000 756100                    STQ     X$PARAM+4,,AUTO
         2 005622   005676 710000 2                  TRA     s:15406

     1620    15390    4          CASE (DEFJOBFILE);

     1621    15391    4            FPT_UNFID = CFPT_UNFID;

  15391  2 005623   000100 100400                    MLR     fill='000'O
         2 005624   000000 000130 xsym               ADSC9   CFPT_UNFID               cn=0,n=88
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:244  
         2 005625   200626 000130                    ADSC9   FPT_UNFID,,AUTO          cn=0,n=88

     1622    15392    4            FPT_UNFID.V_ = VECTOR (FPT_UNFID.V);

  15392  2 005626   000016 235000 3                  LDA     14
         2 005627   203064 452500                    STP2    NEED_2_READ_JOBSTATS+6,,AUTO
         2 005630   203064 236100                    LDQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 005631   000652 036003                    ADLQ    426,DU
         2 005632   200626 757100                    STAQ    FPT_UNFID,,AUTO

     1623    15393    4            FPT_UNFID.TEXTFID_ = VECTOR (SUBSTR (TEMPBUF,1));

  15393  2 005633   000072 235000 3                  LDA     58
         2 005634   203064 452500                    STP2    NEED_2_READ_JOBSTATS+6,,AUTO
         2 005635   203064 236100                    LDQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 005636   000073 036000 3                  ADLQ    59
         2 005637   200630 757100                    STAQ    FPT_UNFID+2,,AUTO

     1624    15394    4            FPT_UNFID.LEN_ = VECTOR (STR_INDX);

  15394  2 005640   777640 235007                    LDA     -96,DL
         2 005641   203064 452500                    STP2    NEED_2_READ_JOBSTATS+6,,AUTO
         2 005642   203064 236100                    LDQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 005643   000361 036003                    ADLQ    241,DU
         2 005644   200650 757100                    STAQ    FPT_UNFID+18,,AUTO

     1625    15395    4            FPT_UNFID.NAME_ = FPT_FID.NAME_;

  15395  2 005645   200602 237100                    LDAQ    FPT_FID+4,,AUTO
         2 005646   200632 757100                    STAQ    FPT_UNFID+4,,AUTO

     1626    15396    4            FPT_UNFID.ACCT_ = FPT_FID.ACCT_;

  15396  2 005647   200604 237100                    LDAQ    FPT_FID+6,,AUTO
         2 005650   200634 757100                    STAQ    FPT_UNFID+6,,AUTO

     1627    15397    4            FPT_UNFID.PASS_ = FPT_FID.PASS_;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:245  

  15397  2 005651   200606 237100                    LDAQ    FPT_FID+8,,AUTO
         2 005652   200636 757100                    STAQ    FPT_UNFID+8,,AUTO

     1628    15398    4            FPT_UNFID.SN_ =   FPT_FID.SN_;

  15398  2 005653   200610 237100                    LDAQ    FPT_FID+10,,AUTO
         2 005654   200640 757100                    STAQ    FPT_UNFID+10,,AUTO

     1629    15399    4            FPT_UNFID.WSN_ =  FPT_FID.WSN_;

  15399  2 005655   200612 237100                    LDAQ    FPT_FID+12,,AUTO
         2 005656   200642 757100                    STAQ    FPT_UNFID+12,,AUTO

     1630    15400    4            FPT_UNFID.ASN_ =  FPT_FID.ASN_;

  15400  2 005657   200614 237100                    LDAQ    FPT_FID+14,,AUTO
         2 005660   200644 757100                    STAQ    FPT_UNFID+14,,AUTO

     1631    15401    4            FPT_UNFID.RES_ =  FPT_FID.RES_;

  15401  2 005661   200616 237100                    LDAQ    FPT_FID+16,,AUTO
         2 005662   200646 757100                    STAQ    FPT_UNFID+16,,AUTO

     1632    15402    5            CALL M$UNFID (FPT_UNFID) WHENALTRETURN DO; END;

  15402  2 005663   200626 630500                    EPPR0   FPT_UNFID,,AUTO
         2 005664   420021 713400                    CLIMB   alt,+8209
         2 005665   404400 401760                    pmme    nvectors=10
         2 005666   005670 702000 2                  TSX2    s:15403
         2 005667   005670 710000 2                  TRA     s:15403

     1633    15403    4            SUBSTR (TEMPBUF, 0, 1) = BINASC (STR_INDX);

  15403  2 005670   200361 236100                    LDQ     STR_INDX,,AUTO
         2 005671   000033 736000                    QLS     27
         2 005672   000074 276000 3                  ORQ     60
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:246  
         2 005673   200112 552140                    STBQ    TEMPBUF,'40'O,AUTO

     1634    15404    4            X$PARAM.TEXTC$(1) = ADDR (TEMPBUF);

  15404  2 005674   200112 630500                    EPPR0   TEMPBUF,,AUTO
         2 005675   201000 450500                    STP0    X$PARAM+4,,AUTO

     1635    15405    4        END; /* DO CASE */

     1636    15406    3        X$PARAM.TYPE=TEMP$->P$B.SUBLK$(0)->P$S.NDTYPE;

  15406  2 005676   200007 470500                    LDP0    TEMP$,,AUTO
         2 005677   000003 471500                    LDP1    3,,PR0
         2 005700   100000 236100                    LDQ     0,,PR1
         2 005701   000077 376003                    ANQ     63,DU
         2 005702   200776 552120                    STBQ    X$PARAM+2,'20'O,AUTO

     1637    15407    3        CALL CPH$SYM_PUT (X$MCB,X$PARAM);

  15407  2 005703   200774 631500                    EPPR1   X$PARAM,,AUTO
         2 005704   203065 451500                    STP1    NEED_2_READ_JOBSTATS+7,,AUTO
         2 005705   200763 633500                    EPPR3   X$MCB,,AUTO
         2 005706   203064 453500                    STP3    NEED_2_READ_JOBSTATS+6,,AUTO
         2 005707   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 005710   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 005711   000000 701000 xent               TSX1    CPH$SYM_PUT
         2 005712   000000 011000                    NOP     0

     1638    15408    3        IF X$PARAM.ERR.CODE ~= 0

  15408  2 005713   201001 236100                    LDQ     X$PARAM+5,,AUTO
         2 005714   377770 316007                    CANQ    131064,DL
         2 005715   005734 600000 2                  TZE     s:15417

     1639    15409    3           THEN
     1640    15410    4              DO;

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:247  
     1641    15411    4                 CALL CPC$WRITEMSGE (X$PARAM.ERR,,X$PARAM.TEXTC$(0)

  15411  2 005716   200777 236100                    LDQ     X$PARAM+3,,AUTO
         2 005717   203066 756100                    STQ     NEED_2_READ_JOBSTATS+8,,AUTO
         2 005720   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 005721   203065 756100                    STQ     NEED_2_READ_JOBSTATS+7,,AUTO
         2 005722   201001 630500                    EPPR0   X$PARAM+5,,AUTO
         2 005723   203064 450500                    STP0    NEED_2_READ_JOBSTATS+6,,AUTO
         2 005724   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 005725   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 005726   000000 701000 xent               TSX1    CPC$WRITEMSGE
         2 005727   000000 011000                    NOP     0

     1642    15412    4                       -> X$STRING.SIZ);
     1643    15413    4                 SUB$PARAMS.BATCH_ABORTED# = %YES#;

  15413  2 005730   040000 236003                    LDQ     16384,DU
         2 005731   203047 256100                    ORSQ    SUB$PARAMS+13,,AUTO

     1644    15414    4                 RETURN;   /* Don't process any more defaults */

  15414  2 005732   203050 221300                    LDX1  ! SUB$PARAMS+14,,AUTO
         2 005733   000001 702211                    TSX2  ! 1,X1

     1645    15415    4              END;
     1646    15416    3           ELSE   /* No errors. Update DEFAULT_DEF_HEAD$ */
     1647    15417    3              SUB$PARAMS.DEFAULT_DEF_HEAD$ = X$PARAM.SYM_HEAD$;

  15417  2 005734   200774 236100                    LDQ     X$PARAM,,AUTO
         2 005735   203035 756100                    STQ     SUB$PARAMS+3,,AUTO

     1648    15418    3     END;

  15418  2 005736   200363 235100                    LDA     NUM_OPTS,,AUTO
         2 005737   000001 035007                    ADLA    1,DL
         2 005740   200363 755100                    STA     NUM_OPTS,,AUTO
         2 005741   201006 470500                    LDP0    PCB+3,,AUTO
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:248  
         2 005742   000001 236100                    LDQ     1,,PR0
         2 005743   000022 772000                    QRL     18
         2 005744   200363 116100                    CMPQ    NUM_OPTS,,AUTO
         2 005745   005747 600000 2                  TZE     s:15419
         2 005746   005577 603000 2                  TRC     s:15385

     1649    15419    2     RETURN;

  15419  2 005747   203050 221300                    LDX1  ! SUB$PARAMS+14,,AUTO
         2 005750   000001 702211                    TSX2  ! 1,X1

     1650    15420    2   SYM_ERR:
     1651    15421    2     RETURN;

  15421  2 005751   203050 221300       SYM_ERR      LDX1  ! SUB$PARAMS+14,,AUTO
         2 005752   000001 702211                    TSX2  ! 1,X1

     1652    15422        %EJECT;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:249  
     1653    15423    2   PROCESS_INCLUDE:
     1654    15424        /*
     1655    15425             ***** Save the RECORD_NUM and RECORD_KEY that the jcl
     1656    15426                   file is currently on ...
     1657    15427        */
     1658    15428    2     SAVE_NUM = SUB$PARAMS.REC_NUM;

  15428  2 005753   203046 236100       PROCESS_INC* LDQ     SUB$PARAMS+12,,AUTO
         2 005754   200355 756100                    STQ     SAVE_NUM,,AUTO

     1659    15429    2     SAVE_SEED = FPT_READ.V.SEED#;

  15429  2 005755   200414 236100                    LDQ     FPT_READ+10,,AUTO
         2 005756   200356 756100                    STQ     SAVE_SEED,,AUTO

     1660    15430    2     FPT_READ.V.SEED# = '0'B;

  15430  2 005757   200414 450100                    STZ     FPT_READ+10,,AUTO

     1661    15431        /*
     1662    15432             ***** Close the jcl file ...
     1663    15433        */
     1664    15434    2     FPT_CLOSE.V.DCB# = M$IBEX_NUM;

  15434  2 005760   000000 720000 xsym               LXL0    M$IBEX_NUM
         2 005761   200572 740100                    STX0    FPT_CLOSE+26,,AUTO

     1665    15435    2     FPT_CLOSE.V.DISP# = %SAVE#;

  15435  2 005762   000002 236007                    LDQ     2,DL
         2 005763   200572 552104                    STBQ    FPT_CLOSE+26,'04'O,AUTO

     1666    15436    2     CALL M$CLOSE (FPT_CLOSE) ALTRET(POST_ERR_AND_ABORT);

  15436  2 005764   200540 630500                    EPPR0   FPT_CLOSE,,AUTO
         2 005765   450001 713400                    CLIMB   alt,close
         2 005766   406000 401760                    pmme    nvectors=13
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:250  
         2 005767   006312 702000 2                  TSX2    POST_ERR_AND_ABORT

     1667    15437        /*
     1668    15438             ***** Open the INCLUDE file ...
     1669    15439        */
     1670    15440    2     FPT_OPEN.V.DCB# = M$IBEX_NUM;

  15440  2 005770   000000 720000 xsym               LXL0    M$IBEX_NUM
         2 005771   200476 740100                    STX0    FPT_OPEN+36,,AUTO

     1671    15441    2     FPT_OPEN.V.FUN# = %IN#;

  15441  2 005772   002000 236007                    LDQ     1024,DL
         2 005773   200477 552110                    STBQ    FPT_OPEN+37,'10'O,AUTO

     1672    15442    2     CALL OPEN_FID (PCB.OUT$ -> P$B.SUBLK$(0)) ALTRET(E_OPEN);

  15442  2 005774   201006 236100                    LDQ     PCB+3,,AUTO
         2 005775   000003 036003                    ADLQ    3,DU
         2 005776   203053 756100                    STQ     J,,AUTO
         2 005777   006746 701000 2                  TSX1    OPEN_FID
         2 006000   006002 702000 2                  TSX2    E_OPEN

     1673    15443    3     DO WHILE (%NO#);

  15443  2 006001   006051 710000 2                  TRA     s:15461

     1674    15444    3   E_OPEN:
     1675    15445    3        CALL CONCAT (WRITEBUF,'     ',READBUF);

  15445  2 006002   040100 100400       E_OPEN       MLR     fill='040'O
         2 006003   000063 000005 1                  ADSC9   E_NONAME_4_CONT+12       cn=0,n=5
         2 006004   200012 000005                    ADSC9   WRITEBUF,,AUTO           cn=0,n=5
         2 006005   040100 100500                    MLR     fill='040'O
         2 006006   200212 000373                    ADSC9   READBUF,,AUTO            cn=0,n=251
         2 006007   200013 200373                    ADSC9   WRITEBUF+1,,AUTO         cn=1,n=251

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:251  
     1676    15446    3        IF B$JIT.PRFLAGS.POINT

  15446  2 006010   000000 470400 xsym               LDP0    B$JIT$
         2 006011   000030 236100                    LDQ     24,,PR0
         2 006012   000200 316003                    CANQ    128,DU
         2 006013   006033 600000 2                  TZE     s:15453

     1677    15447    3         THEN
     1678    15448    4             DO ;

     1679    15449    4               SEG$2.FPT_WRITECC$->FPT$WRITE.BUF_.BOUND =

  15449  2 006014   000000 471400 xsym               LDP1    SEG2$
         2 006015   100161 473500                    LDP3    113,,PR1
         2 006016   203045 236100                    LDQ     SUB$PARAMS+11,,AUTO
         2 006017   000005 036007                    ADLQ    5,DL
         2 006020   000020 736000                    QLS     16
         2 006021   300004 676100                    ERQ     4,,PR3
         2 006022   000034 376000 xsym               ANQ     B_VECTNIL+28
         2 006023   300004 656100                    ERSQ    4,,PR3

     1680    15450    4                     SUB$PARAMS.BUF_LEN + 5;
     1681    15451    4               CALL CPE$DIAGOUT (SEG$2.FPT_WRITECC$);

  15451  2 006024   000000 236000 xsym               LDQ     SEG2$
         2 006025   000161 036003                    ADLQ    113,DU
         2 006026   203064 756100                    STQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 006027   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 006030   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 006031   000000 701000 xent               TSX1    CPE$DIAGOUT
         2 006032   000000 011000                    NOP     0

     1682    15452    4             END ; /* Then Do */

     1683    15453    3         CALL STUFF_GETCMD_4_ERRPTR ;

  15453  2 006033   007164 701000 2                  TSX1    STUFF_GETCMD_4_ERRPTR
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:252  
         2 006034   000000 011000                    NOP     0

     1684    15454    3        CALL CPR$RPTERR (SEG$2.ERRBUF,6);

  15454  2 006035   000075 236000 3                  LDQ     61
         2 006036   203065 756100                    STQ     NEED_2_READ_JOBSTATS+7,,AUTO
         2 006037   000000 236000 xsym               LDQ     SEG2$
         2 006040   000003 036003                    ADLQ    3,DU
         2 006041   203064 756100                    STQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 006042   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 006043   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 006044   000000 701000 xent               TSX1    CPR$RPTERR
         2 006045   000000 011000                    NOP     0

     1685    15455    3        SEG$2.ERRBUF(1) = 0;

  15455  2 006046   000000 470400 xsym               LDP0    SEG2$
         2 006047   000004 450100                    STZ     4,,PR0

     1686    15456    3        GOTO CLOSE_CMD_STREAM;

  15456  2 006050   006244 710000 2                  TRA     CLOSE_CMD_STREAM

     1687    15457    3     END;   /* Do while ... end */

     1688    15458        /*
     1689    15459             Set a dot prompt if we're including ME.
     1690    15460        */
     1691    15461    2     IF B$JIT.MODE = %M_INT# AND FPT_OPEN.V.ASN# = %DEVICE#

  15461  2 006051   000000 470400 xsym               LDP0    B$JIT$
         2 006052   000000 236100                    LDQ     0,,PR0
         2 006053   740000 376003                    ANQ     -16384,DU
         2 006054   140000 116003                    CMPQ    49152,DU
         2 006055   006075 601000 2                  TNZ     s:15471
         2 006056   200477 236100                    LDQ     FPT_OPEN+37,,AUTO
         2 006057   000777 376007                    ANQ     511,DL
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:253  
         2 006060   000003 116007                    CMPQ    3,DL
         2 006061   006075 601000 2                  TNZ     s:15471

     1692    15462    2        THEN
     1693    15463    3           DO;

     1694    15464    4             CALL M$PROMPT (INCLUDE_PROMPT) WHENALTRETURN DO; END;

  15464  2 006062   000014 630400 1                  EPPR0   INCLUDE_PROMPT
         2 006063   560002 713400                    CLIMB   alt,+57346
         2 006064   401000 401760                    pmme    nvectors=3
         2 006065   006067 702000 2                  TSX2    s:15465
         2 006066   006067 710000 2                  TRA     s:15465

     1695    15465    3             SEG$2.GETCMD$->GET$CMD.WORK$->XUG$PARAMS.PROMPT = '@';

  15465  2 006067   000000 470400 xsym               LDP0    SEG2$
         2 006070   000173 471500                    LDP1    123,,PR0
         2 006071   100004 473500                    LDP3    4,,PR1
         2 006072   040100 100400                    MLR     fill='040'O
         2 006073   000012 000001 3                  ADSC9   10                       cn=0,n=1
         2 006074   300037 000136                    ADSC9   31,,PR3                  cn=0,n=94

     1696    15466    3           END;

     1697    15467        /*
     1698    15468             ***** Copy the INCLUDE file to the jobstream ...
     1699    15469        */
     1700    15470    3     DO WHILE (%YES#);

     1701    15471    3        IF B$JIT.CPFLAGS1 & %CP_BRK#

  15471  2 006075   000000 470400 xsym               LDP0    B$JIT$
         2 006076   000143 236100                    LDQ     99,,PR0
         2 006077   000006 376000 xsym               ANQ     B_VECTNIL+6
         2 006100   006103 600000 2                  TZE     s:15474

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:254  
     1702    15472    3           THEN
     1703    15473    3              CALL CHK_BREAK ALTRET(CLOSE_CMD_STREAM);

  15473  2 006101   006471 701000 2                  TSX1    CHK_BREAK
         2 006102   006244 702000 2                  TSX2    CLOSE_CMD_STREAM

     1704    15474    3        READBUF = ' ';

  15474  2 006103   040100 100400                    MLR     fill='040'O
         2 006104   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         2 006105   200212 000400                    ADSC9   READBUF,,AUTO            cn=0,n=256

     1705    15475    3        CALL M$READ (FPT_READ) ALTRET(E_READ);

  15475  2 006106   200402 630500                    EPPR0   FPT_READ,,AUTO
         2 006107   440000 713400                    CLIMB   alt,read
         2 006110   401400 401760                    pmme    nvectors=4
         2 006111   006124 702000 2                  TSX2    E_READ

     1706    15476    3        SUB$PARAMS.BUF_LEN = DCBADDR(M$IBEX_NUM) -> F$DCB.ARS# -1;

  15476  2 006112   000004 470400 3                  LDP0    4
         2 006113   000000 471500                    LDP1    0,,PR0
         2 006114   000000 720000 xsym               LXL0    M$IBEX_NUM
         2 006115   100000 473510                    LDP3    0,X0,PR1
         2 006116   300000 235100                    LDA     0,,PR3
         2 006117   000001 135007                    SBLA    1,DL
         2 006120   203045 755100                    STA     SUB$PARAMS+11,,AUTO

     1707    15477    3        CALL WRITE_BUF ALTRET(POST_ERR_AND_ABORT);

  15477  2 006121   006356 701000 2                  TSX1    WRITE_BUF
         2 006122   006312 702000 2                  TSX2    POST_ERR_AND_ABORT

     1708    15478    3     END;

  15478  2 006123   006075 710000 2                  TRA     s:15471
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:255  

     1709    15479        /**/
     1710    15480    2   E_READ:
     1711    15481    2        IF B$TCB.ALT$ -> B$ALT.ERR.CODE ~= %E$EOF

  15481  2 006124   000000 470400 xsym  E_READ       LDP0    B$TCB$
         2 006125   000000 471500                    LDP1    0,,PR0
         2 006126   100102 236100                    LDQ     66,,PR1
         2 006127   377770 376007                    ANQ     131064,DL
         2 006130   000060 116007                    CMPQ    48,DL
         2 006131   006244 600000 2                  TZE     CLOSE_CMD_STREAM

     1712    15482    2           THEN   /* A real error */
     1713    15483    3              DO;

     1714    15484    3                 SUB$PARAMS.BATCH_ABORTED# = %YES#;

  15484  2 006132   040000 236003                    LDQ     16384,DU
         2 006133   203047 256100                    ORSQ    SUB$PARAMS+13,,AUTO

     1715    15485    3                 CALL CONCAT (WRITEBUF,'     ',READBUF);

  15485  2 006134   040100 100400                    MLR     fill='040'O
         2 006135   000063 000005 1                  ADSC9   E_NONAME_4_CONT+12       cn=0,n=5
         2 006136   200012 000005                    ADSC9   WRITEBUF,,AUTO           cn=0,n=5
         2 006137   040100 100500                    MLR     fill='040'O
         2 006140   200212 000373                    ADSC9   READBUF,,AUTO            cn=0,n=251
         2 006141   200013 200373                    ADSC9   WRITEBUF+1,,AUTO         cn=1,n=251

     1716    15486    3                 SEG$2.FPT_WRITECC$->FPT$WRITE.BUF_.BOUND =

  15486  2 006142   000000 470400 xsym               LDP0    SEG2$
         2 006143   000161 471500                    LDP1    113,,PR0
         2 006144   000004 473400 3                  LDP3    4
         2 006145   300000 474500                    LDP4    0,,PR3
         2 006146   000000 720000 xsym               LXL0    M$IBEX_NUM
         2 006147   400000 475510                    LDP5    0,X0,PR4
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:256  
         2 006150   500000 236100                    LDQ     0,,PR5
         2 006151   000004 036007                    ADLQ    4,DL
         2 006152   000377 116007                    CMPQ    255,DL
         2 006153   006155 604400 2                  TMOZ    s:15486+11
         2 006154   000377 236007                    LDQ     255,DL
         2 006155   000020 736000                    QLS     16
         2 006156   100004 676100                    ERQ     4,,PR1
         2 006157   000034 376000 xsym               ANQ     B_VECTNIL+28
         2 006160   100004 656100                    ERSQ    4,,PR1

     1717    15487    3                       MINIMUM(LENGTHV(WRITEBUF),DCBADDR(M$IBEX_NUM) ->
     1718    15488    3                             F$DCB.ARS# + 4);
     1719    15489    3                 CALL CPE$DIAGOUT (SEG$2.FPT_WRITECC$);

  15489  2 006161   000000 236000 xsym               LDQ     SEG2$
         2 006162   000161 036003                    ADLQ    113,DU
         2 006163   203064 756100                    STQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 006164   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 006165   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 006166   000000 701000 xent               TSX1    CPE$DIAGOUT
         2 006167   000000 011000                    NOP     0

     1720    15490    3                 IF B$TCB.ALT$ -> B$ALT.ERR.CODE = %E$LD

  15490  2 006170   000000 470400 xsym               LDP0    B$TCB$
         2 006171   000000 471500                    LDP1    0,,PR0
         2 006172   100102 236100                    LDQ     66,,PR1
         2 006173   377770 376007                    ANQ     131064,DL
         2 006174   000070 116007                    CMPQ    56,DL
         2 006175   006212 601000 2                  TNZ     s:15494

     1721    15491    3                    THEN
     1722    15492    3                       CALL CXP$POSTERR (ADDR(SEG$2.ERRBUF),511,E_TRUNREC);

  15492  2 006176   000000 236000 xsym               LDQ     SEG2$
         2 006177   000003 036003                    ADLQ    3,DU
         2 006200   203064 756100                    STQ     NEED_2_READ_JOBSTATS+6,,AUTO
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:257  
         2 006201   000076 237000 3                  LDAQ    62
         2 006202   203066 757100                    STAQ    NEED_2_READ_JOBSTATS+8,,AUTO
         2 006203   203064 631500                    EPPR1   NEED_2_READ_JOBSTATS+6,,AUTO
         2 006204   203065 451500                    STP1    NEED_2_READ_JOBSTATS+7,,AUTO
         2 006205   203065 630500                    EPPR0   NEED_2_READ_JOBSTATS+7,,AUTO
         2 006206   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 006207   000000 701000 xent               TSX1    CXP$POSTERR
         2 006210   000000 011000                    NOP     0
         2 006211   006231 710000 2                  TRA     s:15496

     1723    15493    3                    ELSE
     1724    15494    3                       CALL CXP$POSTERR (ADDR(SEG$2.ERRBUF),511,

  15494  2 006212   000000 236000 xsym               LDQ     SEG2$
         2 006213   000003 036003                    ADLQ    3,DU
         2 006214   203064 756100                    STQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 006215   100101 633500                    EPPR3   65,,PR1
         2 006216   203071 453500                    STP3    NEED_2_READ_JOBSTATS+11,,AUTO
         2 006217   100102 634500                    EPPR4   66,,PR1
         2 006220   203070 454500                    STP4    NEED_2_READ_JOBSTATS+10,,AUTO
         2 006221   000034 236000 3                  LDQ     28
         2 006222   203067 756100                    STQ     NEED_2_READ_JOBSTATS+9,,AUTO
         2 006223   203064 631500                    EPPR1   NEED_2_READ_JOBSTATS+6,,AUTO
         2 006224   203066 451500                    STP1    NEED_2_READ_JOBSTATS+8,,AUTO
         2 006225   203066 630500                    EPPR0   NEED_2_READ_JOBSTATS+8,,AUTO
         2 006226   000022 631400 xsym               EPPR1   B_VECTNIL+18
         2 006227   000000 701000 xent               TSX1    CXP$POSTERR
         2 006230   000000 011000                    NOP     0

     1725    15495    3                             B$TCB.ALT$ -> B$ALT.ERR,B$TCB.ALT$ -> B$ALT.DCB#);
     1726    15496    3                 CALL CPR$RPTERR (SEG$2.ERRBUF,511);

  15496  2 006231   000034 236000 3                  LDQ     28
         2 006232   203065 756100                    STQ     NEED_2_READ_JOBSTATS+7,,AUTO
         2 006233   000000 236000 xsym               LDQ     SEG2$
         2 006234   000003 036003                    ADLQ    3,DU
         2 006235   203064 756100                    STQ     NEED_2_READ_JOBSTATS+6,,AUTO
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:258  
         2 006236   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 006237   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 006240   000000 701000 xent               TSX1    CPR$RPTERR
         2 006241   000000 011000                    NOP     0

     1727    15497    3                 SEG$2.ERRBUF(1) = 0;   /* Throw away error */

  15497  2 006242   000000 470400 xsym               LDP0    SEG2$
         2 006243   000004 450100                    STZ     4,,PR0

     1728    15498    3              END;

     1729    15499        /*
     1730    15500             ***** Close the INCLUDE file ...
     1731    15501        */
     1732    15502    2   CLOSE_CMD_STREAM:
     1733    15503    2        IF DCBADDR(M$IBEX_NUM)  -> F$DCB.FCD#

  15503  2 006244   000004 470400 3     CLOSE_CMD_S* LDP0    4
         2 006245   000000 471500                    LDP1    0,,PR0
         2 006246   000000 720000 xsym               LXL0    M$IBEX_NUM
         2 006247   100000 473510                    LDP3    0,X0,PR1
         2 006250   300031 236100                    LDQ     25,,PR3
         2 006251   020000 316007                    CANQ    8192,DL
         2 006252   006257 600000 2                  TZE     s:15509

     1734    15504    2           THEN   /* Close file */
     1735    15505    2              CALL M$CLOSE (FPT_CLOSE) ALTRET(POST_ERR_AND_ABORT);

  15505  2 006253   200540 630500                    EPPR0   FPT_CLOSE,,AUTO
         2 006254   450001 713400                    CLIMB   alt,close
         2 006255   406000 401760                    pmme    nvectors=13
         2 006256   006312 702000 2                  TSX2    POST_ERR_AND_ABORT

     1736    15506        /*
     1737    15507             ***** Reopen the JCL file ...
     1738    15508        */
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:259  
     1739    15509    2        FPT_READ.V.SEED# = SAVE_SEED;

  15509  2 006257   200356 236100                    LDQ     SAVE_SEED,,AUTO
         2 006260   200414 756100                    STQ     FPT_READ+10,,AUTO

     1740    15510    2        CALL OPEN_FID (JOB_FID$ -> P$B.SUBLK$(0)) ALTRET(ABORT);

  15510  2 006261   200006 236100                    LDQ     JOB_FID$,,AUTO
         2 006262   000003 036003                    ADLQ    3,DU
         2 006263   203053 756100                    STQ     J,,AUTO
         2 006264   006746 701000 2                  TSX1    OPEN_FID
         2 006265   006337 702000 2                  TSX2    ABORT

     1741    15511        /*
     1742    15512             ***** Position to just past the !INCLUDE ...
     1743    15513        */
     1744    15514    2        FPT_PRECORD.V.KEYS# = %NO#;

  15514  2 006266   000040 236000 3                  LDQ     32
         2 006267   200674 356100                    ANSQ    FPT_PRECORD+6,,AUTO

     1745    15515    2        FPT_PRECORD.V.N# = SAVE_NUM;

  15515  2 006270   200355 235100                    LDA     SAVE_NUM,,AUTO
         2 006271   200675 755100                    STA     FPT_PRECORD+7,,AUTO

     1746    15516    2        IF DCBADDR(M$IBEX_NUM) -> F$DCB.ASN# ~= %DEVICE#

  15516  2 006272   000004 470400 3                  LDP0    4
         2 006273   000000 471500                    LDP1    0,,PR0
         2 006274   000000 720000 xsym               LXL0    M$IBEX_NUM
         2 006275   100000 473510                    LDP3    0,X0,PR1
         2 006276   300032 236100                    LDQ     26,,PR3
         2 006277   777000 376007                    ANQ     -512,DL
         2 006300   003000 116007                    CMPQ    1536,DL
         2 006301   006306 600000 2                  TZE     s:15522

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:260  
     1747    15517    2           THEN  /* No precord needed for devices */
     1748    15518    2              CALL M$PRECORD (FPT_PRECORD) ALTRET(ABORT);

  15518  2 006302   200666 630500                    EPPR0   FPT_PRECORD,,AUTO
         2 006303   440003 713400                    CLIMB   alt,+16387
         2 006304   401000 401760                    pmme    nvectors=3
         2 006305   006337 702000 2                  TSX2    ABORT

     1749    15519        /*
     1750    15520             ***** Get the record number back ...
     1751    15521        */
     1752    15522    2        SUB$PARAMS.REC_NUM = SAVE_NUM;

  15522  2 006306   200355 235100                    LDA     SAVE_NUM,,AUTO
         2 006307   203046 755100                    STA     SUB$PARAMS+12,,AUTO

     1753    15523    2        RETURN;

  15523  2 006310   203050 221300                    LDX1  ! SUB$PARAMS+14,,AUTO
         2 006311   000001 702211                    TSX2  ! 1,X1

     1754    15524        %EJECT;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:261  
     1755    15525    2   POST_ERR_AND_ABORT:
     1756    15526    2     CPOS = 511 ;

  15526  2 006312   000777 235007       POST_ERR_AN* LDA     511,DL
         2 006313   200357 755100                    STA     CPOS,,AUTO

     1757    15527    2     CALL CXP$POSTERR(ADDR(SEG$2.ERRBUF),CPOS,B$TCB.ALT$->B$ALT.ERR,,

  15527  2 006314   000000 470400 xsym               LDP0    B$TCB$
         2 006315   000000 471500                    LDP1    0,,PR0
         2 006316   000000 236000 xsym               LDQ     SEG2$
         2 006317   000003 036003                    ADLQ    3,DU
         2 006320   203064 756100                    STQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 006321   100101 633500                    EPPR3   65,,PR1
         2 006322   203071 453500                    STP3    NEED_2_READ_JOBSTATS+11,,AUTO
         2 006323   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 006324   203070 756100                    STQ     NEED_2_READ_JOBSTATS+10,,AUTO
         2 006325   100102 634500                    EPPR4   66,,PR1
         2 006326   203067 454500                    STP4    NEED_2_READ_JOBSTATS+9,,AUTO
         2 006327   200357 631500                    EPPR1   CPOS,,AUTO
         2 006330   203066 451500                    STP1    NEED_2_READ_JOBSTATS+8,,AUTO
         2 006331   203064 635500                    EPPR5   NEED_2_READ_JOBSTATS+6,,AUTO
         2 006332   203065 455500                    STP5    NEED_2_READ_JOBSTATS+7,,AUTO
         2 006333   203065 630500                    EPPR0   NEED_2_READ_JOBSTATS+7,,AUTO
         2 006334   000023 631400 xsym               EPPR1   B_VECTNIL+19
         2 006335   000000 701000 xent               TSX1    CXP$POSTERR
         2 006336   000000 011000                    NOP     0

     1758    15528    2                       B$TCB.ALT$->B$ALT.DCB#) ;
     1759    15529
     1760    15530    2   ABORT:
     1761    15531    2     SUB$PARAMS.BATCH_ABORTED# = %YES#;

  15531  2 006337   040000 236003       ABORT        LDQ     16384,DU
         2 006340   203047 256100                    ORSQ    SUB$PARAMS+13,,AUTO

     1762    15532    2     CALL CPR$RPTERR (SEG$2.ERRBUF,6);
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:262  

  15532  2 006341   000075 236000 3                  LDQ     61
         2 006342   203065 756100                    STQ     NEED_2_READ_JOBSTATS+7,,AUTO
         2 006343   000000 236000 xsym               LDQ     SEG2$
         2 006344   000003 036003                    ADLQ    3,DU
         2 006345   203064 756100                    STQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 006346   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 006347   000020 631400 xsym               EPPR1   B_VECTNIL+16
         2 006350   000000 701000 xent               TSX1    CPR$RPTERR
         2 006351   000000 011000                    NOP     0

     1763    15533    2     SEG$2.ERRBUF(1) = 0;   /* Throw away error */

  15533  2 006352   000000 470400 xsym               LDP0    SEG2$
         2 006353   000004 450100                    STZ     4,,PR0

     1764    15534    2     RETURN;

  15534  2 006354   203050 221300                    LDX1  ! SUB$PARAMS+14,,AUTO
         2 006355   000001 702211                    TSX2  ! 1,X1

     1765    15535    2   END PROCESS_DIRECTIVES;
     1766    15536        %EJECT;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:263  
     1767    15537        %EJECT;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:264  
     1768    15538        /****************************************************************/
     1769    15539        /*I*    NAME: WRITE_BUF
     1770    15540                PURPOSE: To do all writes to command streams or user
     1771    15541                         from a central place.
     1772    15542        */
     1773    15543        /***************************************************************/
     1774    15544    1   WRITE_BUF: PROC ALTRET;

  15544  2 006356   203052 741300       WRITE_BUF    STX1  ! I,,AUTO

     1775    15545    2     IF (SUB$PARAMS.PRINT_OPT#

  15545  2 006357   203047 236100                    LDQ     SUB$PARAMS+13,,AUTO
         2 006360   200000 316003                    CANQ    65536,DU
         2 006361   006366 601000 2                  TNZ     s:15545+7
         2 006362   203047 234100                    SZN     SUB$PARAMS+13,,AUTO
         2 006363   006427 605000 2                  TPL     s:15558
         2 006364   100000 316003                    CANQ    32768,DU
         2 006365   006427 600000 2                  TZE     s:15558
         2 006366   200372 234100                    SZN     ECHO_FILE_OK#,,AUTO
         2 006367   006427 605000 2                  TPL     s:15558

     1776    15546    2     OR (SUB$PARAMS.SUB_MADE# AND SUB$PARAMS.TEST_OPT#))
     1777    15547    2     AND ECHO_FILE_OK#
     1778    15548    2        THEN
     1779    15549    3           DO;

     1780    15550    3              CALL CONCAT (WRITEBUF,'     ',READBUF);

  15550  2 006370   040100 100400                    MLR     fill='040'O
         2 006371   000063 000005 1                  ADSC9   E_NONAME_4_CONT+12       cn=0,n=5
         2 006372   200012 000005                    ADSC9   WRITEBUF,,AUTO           cn=0,n=5
         2 006373   040100 100500                    MLR     fill='040'O
         2 006374   200212 000373                    ADSC9   READBUF,,AUTO            cn=0,n=251
         2 006375   200013 200373                    ADSC9   WRITEBUF+1,,AUTO         cn=1,n=251

     1781    15551    3              IF SUB$PARAMS.BUF_LEN+5 > %CPBUFFSIZE
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:265  

  15551  2 006376   203045 235100                    LDA     SUB$PARAMS+11,,AUTO
         2 006377   000373 115007                    CMPA    251,DL
         2 006400   006410 604400 2                  TMOZ    s:15555

     1782    15552    3                 THEN
     1783    15553    3                    SEG$2.FPT_WRITECC$->FPT$WRITE.BUF_.BOUND=%CPBUFFSIZE;

  15553  2 006401   000000 470400 xsym               LDP0    SEG2$
         2 006402   000161 471500                    LDP1    113,,PR0
         2 006403   100004 236100                    LDQ     4,,PR1
         2 006404   177777 376007                    ANQ     65535,DL
         2 006405   000100 276003                    ORQ     64,DU
         2 006406   100004 756100                    STQ     4,,PR1
         2 006407   006420 710000 2                  TRA     s:15556

     1784    15554    3                 ELSE
     1785    15555    3                    SEG$2.FPT_WRITECC$->FPT$WRITE.BUF_.BOUND=SUB$PARAMS.BUF_LEN+5;

  15555  2 006410   000000 470400 xsym               LDP0    SEG2$
         2 006411   000161 471500                    LDP1    113,,PR0
         2 006412   203045 236100                    LDQ     SUB$PARAMS+11,,AUTO
         2 006413   000005 036007                    ADLQ    5,DL
         2 006414   000020 736000                    QLS     16
         2 006415   100004 676100                    ERQ     4,,PR1
         2 006416   000034 376000 xsym               ANQ     B_VECTNIL+28
         2 006417   100004 656100                    ERSQ    4,,PR1

     1786    15556    3              CALL CPE$LISTOUT (SEG$2.FPT_WRITECC$);

  15556  2 006420   000000 236000 xsym               LDQ     SEG2$
         2 006421   000161 036003                    ADLQ    113,DU
         2 006422   203064 756100                    STQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 006423   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 006424   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 006425   000000 701000 xent               TSX1    CPE$LISTOUT
         2 006426   000000 011000                    NOP     0
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:266  

     1787    15557    3           END;

     1788    15558    2     IF SUB$PARAMS.TEST_OPT#

  15558  2 006427   203047 236100                    LDQ     SUB$PARAMS+13,,AUTO
         2 006430   100000 316003                    CANQ    32768,DU
         2 006431   006434 601000 2                  TNZ     s:15561
         2 006432   040000 316003                    CANQ    16384,DU
         2 006433   006436 600000 2                  TZE     s:15562

     1789    15559    2     OR SUB$PARAMS.BATCH_ABORTED#
     1790    15560    2        THEN   /* Dont write to command stream */
     1791    15561    2           RETURN;

  15561  2 006434   203052 221300                    LDX1  ! I,,AUTO
         2 006435   000001 702211                    TSX2  ! 1,X1

     1792    15562    2     IF SUB$PARAMS.BUF_LEN < 0

  15562  2 006436   203045 235100                    LDA     SUB$PARAMS+11,,AUTO
         2 006437   006454 605000 2                  TPL     s:15571

     1793    15563    2        THEN
     1794    15564    3           DO;

     1795    15565    3              FPT_WRITE.BUF_ = VECTOR(NIL);

  15565  2 006440   000100 237000 3                  LDAQ    64
         2 006441   200530 757100                    STAQ    FPT_WRITE+4,,AUTO

     1796    15566    3              CALL M$WRITE (FPT_WRITE) ALTRET(ABORT);

  15566  2 006442   200524 630500                    EPPR0   FPT_WRITE,,AUTO
         2 006443   440001 713400                    CLIMB   alt,write
         2 006444   401400 401760                    pmme    nvectors=4
         2 006445   006467 702000 2                  TSX2    ABORT
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:267  

     1797    15567    3              FPT_WRITE.BUF_ = VECTOR(READBUF);

  15567  2 006446   000002 235000 3                  LDA     2
         2 006447   203064 452500                    STP2    NEED_2_READ_JOBSTATS+6,,AUTO
         2 006450   203064 236100                    LDQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 006451   000212 036003                    ADLQ    138,DU
         2 006452   200530 757100                    STAQ    FPT_WRITE+4,,AUTO

     1798    15568    3           END;

  15568  2 006453   006465 710000 2                  TRA     s:15575

     1799    15569    2        ELSE
     1800    15570    3           DO;

     1801    15571    3              FPT_WRITE.BUF_.BOUND = SUB$PARAMS.BUF_LEN;

  15571  2 006454   203045 236100                    LDQ     SUB$PARAMS+11,,AUTO
         2 006455   000020 736000                    QLS     16
         2 006456   200530 676100                    ERQ     FPT_WRITE+4,,AUTO
         2 006457   000034 376000 xsym               ANQ     B_VECTNIL+28
         2 006460   200530 656100                    ERSQ    FPT_WRITE+4,,AUTO

     1802    15572    3              CALL M$WRITE (FPT_WRITE) ALTRET(ABORT);

  15572  2 006461   200524 630500                    EPPR0   FPT_WRITE,,AUTO
         2 006462   440001 713400                    CLIMB   alt,write
         2 006463   401400 401760                    pmme    nvectors=4
         2 006464   006467 702000 2                  TSX2    ABORT

     1803    15573    3           END;

     1804    15574        /**/
     1805    15575    2     RETURN;

  15575  2 006465   203052 221300                    LDX1  ! I,,AUTO
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:268  
         2 006466   000001 702211                    TSX2  ! 1,X1

     1806    15576        /**/
     1807    15577    2   ABORT:
     1808    15578    2     ALTRETURN;

  15578  2 006467   203052 221300       ABORT        LDX1  ! I,,AUTO
         2 006470   000000 702211                    TSX2  ! 0,X1

     1809    15579    2   END WRITE_BUF;
     1810    15580        %EJECT;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:269  
     1811    15581        /*****************************************************************/
     1812    15582        /*I*    NAME: CHK_BREAK
     1813    15583                PURPOSE: To handle break control from a central point
     1814    15584        */
     1815    15585        /****************************************************************/
     1816    15586    1   CHK_BREAK: PROC ALTRET;

  15586  2 006471   203052 741300       CHK_BREAK    STX1  ! I,,AUTO

     1817    15587    2     B$JIT.CPFLAGS1 = B$JIT.CPFLAGS1 & ~%CP_BRK#;   /* Reset it */

  15587  2 006472   000006 236000 xsym               LDQ     B_VECTNIL+6
         2 006473   000027 676000 xsym               ERQ     B_VECTNIL+23
         2 006474   000000 470400 xsym               LDP0    B$JIT$
         2 006475   000143 376100                    ANQ     99,,PR0
         2 006476   000143 756100                    STQ     99,,PR0

     1818    15588    2     KEY_BUF.COUNT = LENGTHC(KEY_BUF.TEXT);

  15588  2 006477   011000 236003                    LDQ     4608,DU
         2 006500   200760 552140                    STBQ    KEY_BUF,'40'O,AUTO

     1819    15589    2     IF DCBADDR(M$IBEX_NUM) -> F$DCB.ORG# = %KEYED#

  15589  2 006501   000004 471400 3                  LDP1    4
         2 006502   100000 473500                    LDP3    0,,PR1
         2 006503   000000 720000 xsym               LXL0    M$IBEX_NUM
         2 006504   300000 474510                    LDP4    0,X0,PR3
         2 006505   400032 236100                    LDQ     26,,PR4
         2 006506   777000 376003                    ANQ     -512,DU
         2 006507   002000 116003                    CMPQ    1024,DU
         2 006510   006542 601000 2                  TNZ     s:15600
         2 006511   200412 236100                    LDQ     FPT_READ+8,,AUTO
         2 006512   100000 316007                    CANQ    32768,DL
         2 006513   006542 600000 2                  TZE     s:15600

     1820    15590    2     AND FPT_READ.V.KEYR#
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:270  
     1821    15591    2        THEN
     1822    15592    3           DO;   /* Write KEY */

     1823    15593    3              CALL BINCHAR (VALUE_BUF,READ_KEY.KEY);

  15593  2 006514   200756 236100                    LDQ     READ_KEY,,AUTO
         2 006515   000032 376000 xsym               ANQ     B_VECTNIL+26
         2 006516   000000 235003                    LDA     0,DU
         2 006517   203064 757100                    STAQ    NEED_2_READ_JOBSTATS+6,,AUTO
         2 006520   000100 301500                    BTD
         2 006521   203064 000010                    NDSC9 NEED_2_READ_JOBSTATS+6,,AUTO cn=0,s=lsgnf,sf=0,n=8
         2 006522   200334 030010                    NDSC9   VALUE_BUF,,AUTO          cn=0,s=nosgn,sf=0,n=8

     1824    15594    3              CALL EDITCHAR (KEY_BUF.TEXT,,,EDIT_MOPS,VALUE_BUF);

  15594  2 006523   100000 024500                    MVNE
         2 006524   200334 030010                    NDSC9   VALUE_BUF,,AUTO          cn=0,s=nosgn,sf=0,n=8
         2 006525   000000 000005 1                  ADSC9   EDIT_MOPS                cn=0,n=5
         2 006526   200760 200011                    ADSC9   KEY_BUF,,AUTO            cn=1,n=9

     1825    15595    3              KEY_BUF.COUNT = LENGTHC(KEY_BUF.TEXT);

  15595  2 006527   011000 236003                    LDQ     4608,DU
         2 006530   200760 552140                    STBQ    KEY_BUF,'40'O,AUTO

     1826    15596    3              CALL X$STRIP_BLANKS (ADDR(KEY_BUF));

  15596  2 006531   200760 635500                    EPPR5   KEY_BUF,,AUTO
         2 006532   203064 455500                    STP5    NEED_2_READ_JOBSTATS+6,,AUTO
         2 006533   203064 636500                    EPPR6   NEED_2_READ_JOBSTATS+6,,AUTO
         2 006534   203065 456500                    STP6    NEED_2_READ_JOBSTATS+7,,AUTO
         2 006535   203065 630500                    EPPR0   NEED_2_READ_JOBSTATS+7,,AUTO
         2 006536   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 006537   000000 701000 xent               TSX1    X$STRIP_BLANKS
         2 006540   000000 011000                    NOP     0

     1827    15597    3           END;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:271  

  15597  2 006541   006564 710000 2                  TRA     s:15604

     1828    15598    2        ELSE
     1829    15599    3           DO;   /* Write RECORD NUMBER */

     1830    15600    3              CALL BINCHAR (KEY_BUF.TEXT,SUB$PARAMS.REC_NUM);

  15600  2 006542   000100 301500                    BTD
         2 006543   203046 000004                    NDSC9   SUB$PARAMS+12,,AUTO      cn=0,s=lsgnf,sf=0,n=4
         2 006544   200760 230011                    NDSC9   KEY_BUF,,AUTO            cn=1,s=nosgn,sf=0,n=9

     1831    15601    3              CALL CPE$RZEROS (KEY_BUF.TEXT,LENGTHC(KEY_BUF.TEXT),VALUE);

  15601  2 006545   200354 635500                    EPPR5   VALUE,,AUTO
         2 006546   203066 455500                    STP5    NEED_2_READ_JOBSTATS+8,,AUTO
         2 006547   000102 236000 3                  LDQ     66
         2 006550   203065 756100                    STQ     NEED_2_READ_JOBSTATS+7,,AUTO
         2 006551   203067 452500                    STP2    NEED_2_READ_JOBSTATS+9,,AUTO
         2 006552   203067 236100                    LDQ     NEED_2_READ_JOBSTATS+9,,AUTO
         2 006553   000103 036000 3                  ADLQ    67
         2 006554   203064 756100                    STQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 006555   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 006556   000021 631400 xsym               EPPR1   B_VECTNIL+17
         2 006557   000000 701000 xent               TSX1    CPE$RZEROS
         2 006560   000000 011000                    NOP     0

     1832    15602    3              KEY_BUF.COUNT = VALUE;

  15602  2 006561   200354 236100                    LDQ     VALUE,,AUTO
         2 006562   000033 736000                    QLS     27
         2 006563   200760 552140                    STBQ    KEY_BUF,'40'O,AUTO

     1833    15603    3           END;

     1834    15604    2     CALL CONCAT (WRITEBUF,'@ Break at ',

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:272  
  15604  2 006564   200760 236100                    LDQ     KEY_BUF,,AUTO
         2 006565   000033 772000                    QRL     27
         2 006566   040100 100400                    MLR     fill='040'O
         2 006567   000107 000013 1                  ADSC9   E_NONAME_4_CONT+32       cn=0,n=11
         2 006570   200012 000013                    ADSC9   WRITEBUF,,AUTO           cn=0,n=11
         2 006571   000000 620006                    EAX0    0,QL
         2 006572   040100 100540                    MLR     fill='040'O
         2 006573   200760 200010                    ADSC9   KEY_BUF,,AUTO            cn=1,n=*X0
         2 006574   200014 600365                    ADSC9   WRITEBUF+2,,AUTO         cn=3,n=245
         2 006575   000365 116007                    CMPQ    245,DL
         2 006576   006604 603000 2                  TRC     s:15607
         2 006577   777412 620006                    EAX0    -246,QL
         2 006600   777777 660003                    ERX0    -1,DU
         2 006601   040146 100400                    MLR     fill='040'O
         2 006602   000112 000021 1                  ADSC9   E_NONAME_4_CONT+35       cn=0,n=17
         2 006603   200014 600010                    ADSC9   WRITEBUF+2,Q,AUTO        cn=3,n=*X0

     1835    15605    2           SUBSTR(KEY_BUF.TEXT,0,KEY_BUF.COUNT),
     1836    15606    2           ' ''C'' to continue.');
     1837    15607    2     SEG$2.FPT_WRITEUC$ -> FPT$WRITE.BUF_ = VECTOR(WRITEBUF);

  15607  2 006604   000000 470400 xsym               LDP0    SEG2$
         2 006605   000157 471500                    LDP1    111,,PR0
         2 006606   000002 235000 3                  LDA     2
         2 006607   203064 452500                    STP2    NEED_2_READ_JOBSTATS+6,,AUTO
         2 006610   203064 236100                    LDQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 006611   000012 036003                    ADLQ    10,DU
         2 006612   100004 757100                    STAQ    4,,PR1

     1838    15608    2     SEG$2.FPT_WRITEUC$ -> FPT$WRITE.V.DVBYTE.VFC# = %YES#;

  15608  2 006613   000157 471500                    LDP1    111,,PR0
         2 006614   100000 236003                    LDQ     32768,DU
         2 006615   100013 256100                    ORSQ    11,,PR1

     1839    15609    2     SEG$2.FPT_WRITEUC$ -> FPT$WRITE.BUF_.BOUND = 28 + KEY_BUF.COUNT;

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:273  
  15609  2 006616   000157 471500                    LDP1    111,,PR0
         2 006617   200760 236100                    LDQ     KEY_BUF,,AUTO
         2 006620   000033 772000                    QRL     27
         2 006621   000034 036007                    ADLQ    28,DL
         2 006622   000020 736000                    QLS     16
         2 006623   100004 676100                    ERQ     4,,PR1
         2 006624   000034 376000 xsym               ANQ     B_VECTNIL+28
         2 006625   100004 656100                    ERSQ    4,,PR1

     1840    15610    2     CALL M$WRITE (SEG$2.FPT_WRITEUC$->FPT$WRITE) ALTRET(ABORT);

  15610  2 006626   000157 471500                    LDP1    111,,PR0
         2 006627   100000 630500                    EPPR0   0,,PR1
         2 006630   440001 713400                    CLIMB   alt,write
         2 006631   401400 401760                    pmme    nvectors=4
         2 006632   006717 702000 2                  TSX2    ABORT

     1841    15611        /**/
     1842    15612    2     FPT_PROMPT = CFPT_PROMPT;

  15612  2 006633   000100 100400                    MLR     fill='000'O
         2 006634   000000 000050 xsym               ADSC9   CFPT_PROMPT              cn=0,n=40
         2 006635   200420 000050                    ADSC9   FPT_PROMPT,,AUTO         cn=0,n=40

     1843    15613    2     FPT_PROMPT.V_ = VECTOR(FPT_PROMPT.V);

  15613  2 006636   000000 235000 3                  LDA     0
         2 006637   203064 452500                    STP2    NEED_2_READ_JOBSTATS+6,,AUTO
         2 006640   203064 236100                    LDQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 006641   000426 036003                    ADLQ    278,DU
         2 006642   200420 757100                    STAQ    FPT_PROMPT,,AUTO

     1844    15614    2     FPT_PROMPT.V.DVBYTE#.VFC# = %YES#;

  15614  2 006643   100000 236003                    LDQ     32768,DU
         2 006644   200430 256100                    ORSQ    FPT_PROMPT+8,,AUTO

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:274  
     1845    15615    2     FPT_PROMPT.PROMPT_ = VECTOR(SAME_LINE_VFC);

  15615  2 006645   000104 237000 3                  LDAQ    68
         2 006646   200424 757100                    STAQ    FPT_PROMPT+4,,AUTO

     1846    15616    2     CALL M$PROMPT (FPT_PROMPT) ALTRET(ABORT);

  15616  2 006647   200420 630500                    EPPR0   FPT_PROMPT,,AUTO
         2 006650   560002 713400                    CLIMB   alt,+57346
         2 006651   401000 401760                    pmme    nvectors=3
         2 006652   006717 702000 2                  TSX2    ABORT

     1847    15617        /**/
     1848    15618    2     SEG$2.FPT_READUC$ -> FPT$READ.BUF_ = VECTOR(TEMPBUF);

  15618  2 006653   000000 470400 xsym               LDP0    SEG2$
         2 006654   000156 471500                    LDP1    110,,PR0
         2 006655   000002 235000 3                  LDA     2
         2 006656   203064 452500                    STP2    NEED_2_READ_JOBSTATS+6,,AUTO
         2 006657   203064 236100                    LDQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 006660   000112 036003                    ADLQ    74,DU
         2 006661   100004 757100                    STAQ    4,,PR1

     1849    15619    2     CALL M$READ (SEG$2.FPT_READUC$ -> FPT$READ) ALTRET(ABORT);

  15619  2 006662   000156 471500                    LDP1    110,,PR0
         2 006663   100000 630500                    EPPR0   0,,PR1
         2 006664   440000 713400                    CLIMB   alt,read
         2 006665   401400 401760                    pmme    nvectors=4
         2 006666   006717 702000 2                  TSX2    ABORT

     1850    15620        /**/
     1851    15621    2     SEG$2.GETCMD$->GET$CMD.ALWAYS_SET_PROMPT# = %YES#;

  15621  2 006667   000000 470400 xsym               LDP0    SEG2$
         2 006670   000173 471500                    LDP1    123,,PR0
         2 006671   002000 236003                    LDQ     1024,DU
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:275  
         2 006672   100006 256100                    ORSQ    6,,PR1

     1852    15622        /**/
     1853    15623    2     IF DCBADDR(M$UC_NUM) -> F$DCB.ARS# = 0

  15623  2 006673   000004 471400 3                  LDP1    4
         2 006674   100000 473500                    LDP3    0,,PR1
         2 006675   000000 720000 xsym               LXL0    M$UC_NUM
         2 006676   300000 474510                    LDP4    0,X0,PR3
         2 006677   400000 235100                    LDA     0,,PR4
         2 006700   006711 600000 2                  TZE     s:15628
         2 006701   200112 236100                    LDQ     TEMPBUF,,AUTO
         2 006702   777000 376003                    ANQ     -512,DU
         2 006703   103000 116003                    CMPQ    34304,DU
         2 006704   006715 600000 2                  TZE     s:15632
         2 006705   200112 236100                    LDQ     TEMPBUF,,AUTO
         2 006706   777000 376003                    ANQ     -512,DU
         2 006707   143000 116003                    CMPQ    50688,DU
         2 006710   006715 600000 2                  TZE     s:15632

     1854    15624    2     OR (SUBSTR(TEMPBUF,0,1) ~= 'C'
     1855    15625    2     AND SUBSTR(TEMPBUF,0,1) ~= 'c')
     1856    15626    2        THEN   /* Abort the processing */
     1857    15627    3           DO;

     1858    15628    3              SUB$PARAMS.BATCH_ABORTED# = %YES#;

  15628  2 006711   040000 236003                    LDQ     16384,DU
         2 006712   203047 256100                    ORSQ    SUB$PARAMS+13,,AUTO

     1859    15629    3              ALTRETURN;

  15629  2 006713   203052 221300                    LDX1  ! I,,AUTO
         2 006714   000000 702211                    TSX2  ! 0,X1

     1860    15630    3           END;
     1861    15631    2        ELSE
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:276  
     1862    15632    2           RETURN;

  15632  2 006715   203052 221300                    LDX1  ! I,,AUTO
         2 006716   000001 702211                    TSX2  ! 1,X1

     1863    15633        /**/
     1864    15634    2   ABORT:
     1865    15635    2        CALL CXP$POSTERR (ADDR(SEG$2.ERRBUF),511,B$TCB.ALT$ -> B$ALT.ERR,,

  15635  2 006717   000000 470400 xsym  ABORT        LDP0    B$TCB$
         2 006720   000000 471500                    LDP1    0,,PR0
         2 006721   000000 236000 xsym               LDQ     SEG2$
         2 006722   000003 036003                    ADLQ    3,DU
         2 006723   203064 756100                    STQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 006724   100101 633500                    EPPR3   65,,PR1
         2 006725   203071 453500                    STP3    NEED_2_READ_JOBSTATS+11,,AUTO
         2 006726   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 006727   203070 756100                    STQ     NEED_2_READ_JOBSTATS+10,,AUTO
         2 006730   100102 634500                    EPPR4   66,,PR1
         2 006731   203067 454500                    STP4    NEED_2_READ_JOBSTATS+9,,AUTO
         2 006732   000034 236000 3                  LDQ     28
         2 006733   203066 756100                    STQ     NEED_2_READ_JOBSTATS+8,,AUTO
         2 006734   203064 631500                    EPPR1   NEED_2_READ_JOBSTATS+6,,AUTO
         2 006735   203065 451500                    STP1    NEED_2_READ_JOBSTATS+7,,AUTO
         2 006736   203065 630500                    EPPR0   NEED_2_READ_JOBSTATS+7,,AUTO
         2 006737   000023 631400 xsym               EPPR1   B_VECTNIL+19
         2 006740   000000 701000 xent               TSX1    CXP$POSTERR
         2 006741   000000 011000                    NOP     0

     1866    15636    2              B$TCB.ALT$ -> B$ALT.DCB#);
     1867    15637    2        SUB$PARAMS.BATCH_ABORTED# = %YES#;

  15637  2 006742   040000 236003                    LDQ     16384,DU
         2 006743   203047 256100                    ORSQ    SUB$PARAMS+13,,AUTO

     1868    15638    2        ALTRETURN;

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:277  
  15638  2 006744   203052 221300                    LDX1  ! I,,AUTO
         2 006745   000000 702211                    TSX2  ! 0,X1

     1869    15639    2   END CHK_BREAK;
     1870    15640        %EJECT;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:278  
     1871    15641        /*****************************************************************/
     1872    15642        /*I*    NAME: OPEN_FID
     1873    15643                PURPOSE: A textc version of a FID is passed. This fid
     1874    15644                         is run thru M$FID and the fields of FPT_OPEN
     1875    15645                         filled in.
     1876    15646        */
     1877    15647        /*****************************************************************/
     1878    15648    1   OPEN_FID: PROC (PTR$) ALTRET;

  15648  2 006746   203052 741300       OPEN_FID     STX1  ! I,,AUTO

     1879    15649        /**/
     1880    15650    2   DCL PTR$ PTR;
     1881    15651        /**/
     1882    15652        /*
     1883    15653           *****   Break up the FID...
     1884    15654        */
     1885    15655    2     FID_ASN = %FILE#;   /* Default value */

  15655  2 006747   001000 236003                    LDQ     512,DU
         2 006750   200332 756100                    STQ     FID_ASN,,AUTO

     1886    15656    2     FID_RES = ' ';   /* Default value */

  15656  2 006751   000035 236000 xsym               LDQ     B_VECTNIL+29
         2 006752   200333 756100                    STQ     FID_RES,,AUTO

     1887    15657    2     FPT_FID = CFPT_FID;

  15657  2 006753   000100 100400                    MLR     fill='000'O
         2 006754   000000 000140 xsym               ADSC9   CFPT_FID                 cn=0,n=96
         2 006755   200576 000140                    ADSC9   FPT_FID,,AUTO            cn=0,n=96

     1888    15658    2     FPT_FID.TEXTFID_ = VECTOR(PTR$ -> P$S.TEXT);

  15658  2 006756   203053 470500                    LDP0    @PTR$,,AUTO
         2 006757   000000 471500                    LDP1    0,,PR0
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:279  
         2 006760   100004 236100                    LDQ     4,,PR1
         2 006761   000033 772000                    QRL     27
         2 006762   000064 737000                    LLS     52
         2 006763   000140 135007                    SBLA    96,DL
         2 006764   203064 451500                    STP1    NEED_2_READ_JOBSTATS+6,,AUTO
         2 006765   203064 236100                    LDQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 006766   000106 036000 3                  ADLQ    70
         2 006767   200600 757100                    STAQ    FPT_FID+2,,AUTO

     1889    15659    2     FPT_FID.NAME_ = VECTOR(FID_NAME);

  15659  2 006770   000107 235000 3                  LDA     71
         2 006771   203064 452500                    STP2    NEED_2_READ_JOBSTATS+6,,AUTO
         2 006772   203064 236100                    LDQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 006773   000720 036003                    ADLQ    464,DU
         2 006774   200602 757100                    STAQ    FPT_FID+4,,AUTO

     1890    15660    2     FPT_FID.ACCT_ = VECTOR(FID_ACCT);

  15660  2 006775   000016 235000 3                  LDA     14
         2 006776   203064 452500                    STP2    NEED_2_READ_JOBSTATS+6,,AUTO
         2 006777   203064 236100                    LDQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 007000   000730 036003                    ADLQ    472,DU
         2 007001   200604 757100                    STAQ    FPT_FID+6,,AUTO

     1891    15661    2     FPT_FID.PASS_ = VECTOR(FID_PASS);

  15661  2 007002   000016 235000 3                  LDA     14
         2 007003   203064 452500                    STP2    NEED_2_READ_JOBSTATS+6,,AUTO
         2 007004   203064 236100                    LDQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 007005   000732 036003                    ADLQ    474,DU
         2 007006   200606 757100                    STAQ    FPT_FID+8,,AUTO

     1892    15662    2     FPT_FID.SN_ = VECTOR(FID_SN);

  15662  2 007007   000003 235000 3                  LDA     3
         2 007010   203064 452500                    STP2    NEED_2_READ_JOBSTATS+6,,AUTO
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:280  
         2 007011   203064 236100                    LDQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 007012   000736 036003                    ADLQ    478,DU
         2 007013   200610 757100                    STAQ    FPT_FID+10,,AUTO

     1893    15663    2     FPT_FID.WSN_ = VECTOR(FID_WSN);

  15663  2 007014   000016 235000 3                  LDA     14
         2 007015   203064 452500                    STP2    NEED_2_READ_JOBSTATS+6,,AUTO
         2 007016   203064 236100                    LDQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 007017   000734 036003                    ADLQ    476,DU
         2 007020   200612 757100                    STAQ    FPT_FID+12,,AUTO

     1894    15664    2     FPT_FID.ASN_ = VECTOR(FID_ASN);

  15664  2 007021   777640 235007                    LDA     -96,DL
         2 007022   203064 452500                    STP2    NEED_2_READ_JOBSTATS+6,,AUTO
         2 007023   203064 236100                    LDQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 007024   000332 036003                    ADLQ    218,DU
         2 007025   200614 757100                    STAQ    FPT_FID+14,,AUTO

     1895    15665    2     FPT_FID.RES_ = VECTOR(FID_RES);

  15665  2 007026   777640 235007                    LDA     -96,DL
         2 007027   203064 452500                    STP2    NEED_2_READ_JOBSTATS+6,,AUTO
         2 007030   203064 236100                    LDQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 007031   000333 036003                    ADLQ    219,DU
         2 007032   200616 757100                    STAQ    FPT_FID+16,,AUTO

     1896    15666    2     FPT_FID.RESULTS_ = VECTOR(FID_RESULTS);

  15666  2 007033   000110 235000 3                  LDA     72
         2 007034   203064 452500                    STP2    NEED_2_READ_JOBSTATS+6,,AUTO
         2 007035   203064 236100                    LDQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 007036   000706 036003                    ADLQ    454,DU
         2 007037   200620 757100                    STAQ    FPT_FID+18,,AUTO

     1897    15667    2     CALL M$FID(FPT_FID) ALTRET(E_OPEN);
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:281  

  15667  2 007040   200576 630500                    EPPR0   FPT_FID,,AUTO
         2 007041   420001 713400                    CLIMB   alt,+8193
         2 007042   404400 401760                    pmme    nvectors=10
         2 007043   007126 702000 2                  TSX2    E_OPEN

     1898    15668        /*
     1899    15669             ***** Open the file...
     1900    15670        */
     1901    15671    2     IF FID_RESULTS.ACCT = %NO#

  15671  2 007044   200706 236100                    LDQ     FID_RESULTS,,AUTO
         2 007045   200000 316003                    CANQ    65536,DU
         2 007046   007071 601000 2                  TNZ     s:15681

     1902    15672    3        THEN DO;  /* Default to current account */

     1903    15673    3           FPT_FID.ACCT_ = VECTOR (B$JIT.FACCN);

  15673  2 007047   000016 235000 3                  LDA     14
         2 007050   000000 236000 xsym               LDQ     B$JIT$
         2 007051   000006 036003                    ADLQ    6,DU
         2 007052   200604 757100                    STAQ    FPT_FID+6,,AUTO

     1904    15674    3           IF FID_RESULTS.SN = %NO#

  15674  2 007053   200706 236100                    LDQ     FID_RESULTS,,AUTO
         2 007054   040000 316003                    CANQ    16384,DU
         2 007055   007071 601000 2                  TNZ     s:15681

     1905    15675    4              THEN DO;

     1906    15676    4                 FID_SN.NUM# = 1;

  15676  2 007056   000001 235007                    LDA     1,DL
         2 007057   200736 755100                    STA     FID_SN,,AUTO

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:282  
     1907    15677    4                 FID_SN.SN#(0) = B$JIT.FPSN;

  15677  2 007060   000000 470400 xsym               LDP0    B$JIT$
         2 007061   040100 100500                    MLR     fill='040'O
         2 007062   000021 000006                    ADSC9   17,,PR0                  cn=0,n=6
         2 007063   200737 000006                    ADSC9   FID_SN+1,,AUTO           cn=0,n=6

     1908    15678    4                 FPT_FID.SN_ = VECTOR(FID_SN);

  15678  2 007064   000003 235000 3                  LDA     3
         2 007065   203064 452500                    STP2    NEED_2_READ_JOBSTATS+6,,AUTO
         2 007066   203064 236100                    LDQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 007067   000736 036003                    ADLQ    478,DU
         2 007070   200610 757100                    STAQ    FPT_FID+10,,AUTO

     1909    15679    4                 END;

     1910    15680    3           END;

     1911    15681    2     FPT_OPEN.NAME_ = FPT_FID.NAME_;

  15681  2 007071   200602 237100                    LDAQ    FPT_FID+4,,AUTO
         2 007072   200440 757100                    STAQ    FPT_OPEN+6,,AUTO

     1912    15682    2     FPT_OPEN.ACCT_ = FPT_FID.ACCT_;

  15682  2 007073   200604 237100                    LDAQ    FPT_FID+6,,AUTO
         2 007074   200456 757100                    STAQ    FPT_OPEN+20,,AUTO

     1913    15683    2     FPT_OPEN.PASS_ = FPT_FID.PASS_;

  15683  2 007075   200606 237100                    LDAQ    FPT_FID+8,,AUTO
         2 007076   200442 757100                    STAQ    FPT_OPEN+8,,AUTO

     1914    15684    2     FPT_OPEN.SN_ = FPT_FID.SN_;

  15684  2 007077   200610 237100                    LDAQ    FPT_FID+10,,AUTO
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:283  
         2 007100   200434 757100                    STAQ    FPT_OPEN+2,,AUTO

     1915    15685    2     FPT_OPEN.WSN_ = FPT_FID.WSN_;

  15685  2 007101   200612 237100                    LDAQ    FPT_FID+12,,AUTO
         2 007102   200464 757100                    STAQ    FPT_OPEN+26,,AUTO

     1916    15686    2     IF FID_RESULTS.RES

  15686  2 007103   200706 236100                    LDQ     FID_RESULTS,,AUTO
         2 007104   004000 316003                    CANQ    2048,DU
         2 007105   007110 600000 2                  TZE     s:15689

     1917    15687    2        THEN
     1918    15688    2           FPT_OPEN.V.RES#=FID_RES;

  15688  2 007106   200333 236100                    LDQ     FID_RES,,AUTO
         2 007107   200502 756100                    STQ     FPT_OPEN+40,,AUTO

     1919    15689    2     IF FID_RESULTS.ASN

  15689  2 007110   200706 236100                    LDQ     FID_RESULTS,,AUTO
         2 007111   010000 316003                    CANQ    4096,DU
         2 007112   007116 600000 2                  TZE     s:15692

     1920    15690    2        THEN
     1921    15691    2           FPT_OPEN.V.ASN#=FID_ASN;

  15691  2 007113   200332 236100                    LDQ     FID_ASN,,AUTO
         2 007114   000033 772000                    QRL     27
         2 007115   200477 552104                    STBQ    FPT_OPEN+37,'04'O,AUTO

     1922    15692    2     FPT_OPEN.V.INITZ.SCRUB# = %YES#;

  15692  2 007116   400000 236007                    LDQ     -131072,DL
         2 007117   200476 256100                    ORSQ    FPT_OPEN+36,,AUTO

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:284  
     1923    15693    2     CALL M$OPEN(FPT_OPEN) ALTRET(E_OPEN);

  15693  2 007120   200432 630500                    EPPR0   FPT_OPEN,,AUTO
         2 007121   450000 713400                    CLIMB   alt,open
         2 007122   410400 401760                    pmme    nvectors=18
         2 007123   007126 702000 2                  TSX2    E_OPEN

     1924    15694    2     RETURN;

  15694  2 007124   203052 221300                    LDX1  ! I,,AUTO
         2 007125   000001 702211                    TSX2  ! 1,X1

     1925    15695        /**/
     1926    15696    2   E_OPEN:
     1927    15697    2     CPOS = PTR$ -> P$S.CPOS;

  15697  2 007126   203053 470500       E_OPEN       LDP0    @PTR$,,AUTO
         2 007127   000000 471500                    LDP1    0,,PR0
         2 007130   100002 235100                    LDA     2,,PR1
         2 007131   200357 755100                    STA     CPOS,,AUTO

     1928    15698    2     CALL CXP$POSTERR (ADDR(SEG$2.ERRBUF),CPOS,B$TCB.ALT$ -> B$ALT.ERR,,

  15698  2 007132   000000 471400 xsym               LDP1    B$TCB$
         2 007133   100000 473500                    LDP3    0,,PR1
         2 007134   000000 236000 xsym               LDQ     SEG2$
         2 007135   000003 036003                    ADLQ    3,DU
         2 007136   203064 756100                    STQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 007137   300101 634500                    EPPR4   65,,PR3
         2 007140   203071 454500                    STP4    NEED_2_READ_JOBSTATS+11,,AUTO
         2 007141   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 007142   203070 756100                    STQ     NEED_2_READ_JOBSTATS+10,,AUTO
         2 007143   300102 635500                    EPPR5   66,,PR3
         2 007144   203067 455500                    STP5    NEED_2_READ_JOBSTATS+9,,AUTO
         2 007145   200357 633500                    EPPR3   CPOS,,AUTO
         2 007146   203066 453500                    STP3    NEED_2_READ_JOBSTATS+8,,AUTO
         2 007147   203064 636500                    EPPR6   NEED_2_READ_JOBSTATS+6,,AUTO
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:285  
         2 007150   203065 456500                    STP6    NEED_2_READ_JOBSTATS+7,,AUTO
         2 007151   203065 630500                    EPPR0   NEED_2_READ_JOBSTATS+7,,AUTO
         2 007152   000023 631400 xsym               EPPR1   B_VECTNIL+19
         2 007153   000000 701000 xent               TSX1    CXP$POSTERR
         2 007154   000000 011000                    NOP     0

     1929    15699    2           B$TCB.ALT$ -> B$ALT.DCB#);
     1930    15700    2     SUB$PARAMS.BATCH_ABORTED# = %YES#;

  15700  2 007155   040000 236003                    LDQ     16384,DU
         2 007156   203047 256100                    ORSQ    SUB$PARAMS+13,,AUTO

     1931    15701    2     B$JIT.STEPCC = %CC_ERR# ;

  15701  2 007157   000000 470400 xsym               LDP0    B$JIT$
         2 007160   000004 236003                    LDQ     4,DU
         2 007161   000316 552120                    STBQ    206,'20'O,PR0

     1932    15702    2     ALTRETURN;

  15702  2 007162   203052 221300                    LDX1  ! I,,AUTO
         2 007163   000000 702211                    TSX2  ! 0,X1

     1933    15703    2   END OPEN_FID;
     1934    15704        %EJECT ;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:286  
     1935    15705        /*****************************************************************/
     1936    15706        /*I*    NAME: STUFF_GETCMD_4_ERRPTR
     1937    15707                PURPOSE: CXG$GETCMD is passed the text of the record just
     1938    15708                         read so that when CXG$ERRPTR is called the correct
     1939    15709                         input line will be ECHOed by CXG$ERRPTR.
     1940    15710        */
     1941    15711        /*****************************************************************/
     1942    15712    1   STUFF_GETCMD_4_ERRPTR:  PROC ;

  15712  2 007164   203062 741300       STUFF_GETCM* STX1  ! NEED_2_READ_JOBSTATS+4,,AUTO

     1943    15713
     1944    15714        /*
     1945    15715             ***** Stuff in GETCMD memory so that XUG$ERRPTR works meaningfully
     1946    15716        */
     1947    15717    2     SEG$2.GETCMD$ -> GET$CMD.TEXT_ = VECTOR(WRITEBUF);

  15717  2 007165   000000 470400 xsym               LDP0    SEG2$
         2 007166   000173 471500                    LDP1    123,,PR0
         2 007167   000002 235000 3                  LDA     2
         2 007170   203064 452500                    STP2    NEED_2_READ_JOBSTATS+6,,AUTO
         2 007171   203064 236100                    LDQ     NEED_2_READ_JOBSTATS+6,,AUTO
         2 007172   000012 036003                    ADLQ    10,DU
         2 007173   100034 757100                    STAQ    28,,PR1

     1948    15718    2     SEG$2.GETCMD$ -> GET$CMD.NODES$ = ADDR(NIL); /* inhibit parse */

  15718  2 007174   000173 471500                    LDP1    123,,PR0
         2 007175   000001 236000 xsym               LDQ     B_VECTNIL+1
         2 007176   100000 756100                    STQ     0,,PR1

     1949    15719    2     SEG$2.GETCMD$ -> GET$CMD.SKIP_PREPROCESS# = %YES#; /* inhibit preproc */

  15719  2 007177   000173 471500                    LDP1    123,,PR0
         2 007200   004000 236003                    LDQ     2048,DU
         2 007201   100006 256100                    ORSQ    6,,PR1

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:287  
     1950    15720    2     CALL CXG$GETCMD (SEG$2.GETCMD$ -> GET$CMD)

  15720  2 007202   000173 471500                    LDP1    123,,PR0
         2 007203   203064 451500                    STP1    NEED_2_READ_JOBSTATS+6,,AUTO
         2 007204   203064 630500                    EPPR0   NEED_2_READ_JOBSTATS+6,,AUTO
         2 007205   000017 631400 xsym               EPPR1   B_VECTNIL+15
         2 007206   000000 701000 xent               TSX1    CXG$GETCMD
         2 007207   007211 702000 2                  TSX2    s:15724
         2 007210   007211 710000 2                  TRA     s:15724

     1951    15721    3             WHENALTRETURN DO;

     1952    15722                      /* guaranteed to altreturn (null root);  ignore */
     1953    15723    3             END;

     1954    15724    2     SEG$2.GETCMD$ -> GET$CMD.WORK$ -> XUG$PARAMS.POFF = 0;

  15724  2 007211   000000 470400 xsym               LDP0    SEG2$
         2 007212   000173 471500                    LDP1    123,,PR0
         2 007213   100004 473500                    LDP3    4,,PR1
         2 007214   300036 450100                    STZ     30,,PR3

     1955    15725    2     SEG$2.GETCMD$ -> GET$CMD.TEXT_ = VECTOR(NIL);

  15725  2 007215   000173 471500                    LDP1    123,,PR0
         2 007216   000100 237000 3                  LDAQ    64
         2 007217   100034 757100                    STAQ    28,,PR1

     1956    15726    2     RETURN ;

  15726  2 007220   203062 221300                    LDX1  ! NEED_2_READ_JOBSTATS+4,,AUTO
         2 007221   000001 702211                    TSX2  ! 1,X1

     1957    15727
     1958    15728    2   END   STUFF_GETCMD_4_ERRPTR ;
     1959    15729        %EJECT ;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:288  
     1960    15730    1   CHK_4_CROSS_ACCT_BATCH: PROC(BLK$);

  15730  2 007222   203050 741300       CHK_4_CROSS* STX1  ! SUB$PARAMS+14,,AUTO

     1961    15731
     1962    15732    2   DCL BLK$ PTR PARAM ;
     1963    15733    2   DCL I UBIN WORD ;
     1964    15734
     1965    15735    2     CROSS_ACCT_BATCH_FLG = %NO#;

  15735  2 007223   200370 450100                    STZ     CROSS_ACCT_BATCH_FLG,,AUTO

     1966    15736    3     DO I=0 TO BLK$->P$B.NSUBLKS-1 ;

  15736  2 007224   203052 450100                    STZ     I,,AUTO
         2 007225   007263 710000 2                  TRA     s:15743+3

     1967    15737    3         IF BLK$->P$B.SUBLK$(I)->P$S.CODE = JOB_ACCTNAME

  15737  2 007226   203051 470500                    LDP0    @BLK$,,AUTO
         2 007227   000000 471500                    LDP1    0,,PR0
         2 007230   203052 720100                    LXL0    I,,AUTO
         2 007231   100003 473510                    LDP3    3,X0,PR1
         2 007232   300000 721100                    LXL1    0,,PR3
         2 007233   000003 101003                    CMPX1   3,DU
         2 007234   007260 601000 2                  TNZ     s:15743

     1968    15738    3             THEN
     1969    15739    3               IF BLK$->P$B.SUBLK$(I)->P$B.SUBLK$(0)->P$S.TEXT ~= B$JIT.ACCN

  15739  2 007235   300003 474500                    LDP4    3,,PR3
         2 007236   400004 236100                    LDQ     4,,PR4
         2 007237   000033 772000                    QRL     27
         2 007240   000000 622006                    EAX2    0,QL
         2 007241   000000 475400 xsym               LDP5    B$JIT$
         2 007242   040100 106540                    CMPC    fill='040'O
         2 007243   400004 200012                    ADSC9   4,,PR4                   cn=1,n=*X2
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:289  
         2 007244   500001 000010                    ADSC9   1,,PR5                   cn=0,n=8
         2 007245   007256 601000 2                  TNZ     s:15742
         2 007246   300004 476500                    LDP6    4,,PR3
         2 007247   600004 236100                    LDQ     4,,PR6
         2 007250   000033 772000                    QRL     27
         2 007251   000000 623006                    EAX3    0,QL
         2 007252   040100 106540                    CMPC    fill='040'O
         2 007253   600004 200013                    ADSC9   4,,PR6                   cn=1,n=*X3
         2 007254   500003 000014                    ADSC9   3,,PR5                   cn=0,n=12
         2 007255   007260 600000 2                  TZE     s:15743

     1970    15740    3                 OR BLK$->P$B.SUBLK$(I)->P$B.SUBLK$(1)->P$S.TEXT ~= B$JIT.UNAME
     1971    15741    3                 THEN
     1972    15742    3                   CROSS_ACCT_BATCH_FLG = %YES#;

  15742  2 007256   400000 236003                    LDQ     -131072,DU
         2 007257   200370 756100                    STQ     CROSS_ACCT_BATCH_FLG,,AUTO

     1973    15743    3     END;    /* Do I */

  15743  2 007260   203052 235100                    LDA     I,,AUTO
         2 007261   000001 035007                    ADLA    1,DL
         2 007262   203052 755100                    STA     I,,AUTO
         2 007263   203051 470500                    LDP0    @BLK$,,AUTO
         2 007264   000000 471500                    LDP1    0,,PR0
         2 007265   100001 236100                    LDQ     1,,PR1
         2 007266   000022 772000                    QRL     18
         2 007267   203052 116100                    CMPQ    I,,AUTO
         2 007270   007272 600000 2                  TZE     s:15745
         2 007271   007226 603000 2                  TRC     s:15737

     1974    15744
     1975    15745    2     RETURN ;

  15745  2 007272   203050 221300                    LDX1  ! SUB$PARAMS+14,,AUTO
         2 007273   000001 702211                    TSX2  ! 1,X1
     1976    15746    2   END   CHK_4_CROSS_ACCT_BATCH;
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:290  
     1977    15747    1   END CPH$IBEX;

PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:291  
--  Include file information  --

   CXG_ENTRY.:E05TOU  cannot be made into a system file and is referenced.
   XSJ_MAC_C.:E05TOU  is referenced.
   XSJ_SUBS_C.:E05TOU  is referenced.
   B$TABLES_C.:E05TOU  cannot be made into a system file and is referenced.
   XUH_MACRO_C.:E05TOU  is referenced.
   XU_SUBS_C.:E05TOU  is referenced.
   CP_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   XUM_MACRO_C.:E05TOU  is referenced.
   XU_PERR_C.:E05TOU  is referenced.
   XU_MACRO_C.:E05TOU  is referenced.
   CP_SUBS_C.:E05TOU  is referenced.
   CP_PERR_C.:E05TOU  is referenced.
   CP_MACROS_C.:E05TOU  is referenced.
   AS_SUPER_C.:E05TOU  is referenced.
   B_ERRORS_C.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   B_MICROPS_C.:E05TOU  is referenced.
   B_MACROS_C.:E05TOU  is referenced.
   B$JIT.:E05TOU  cannot be made into a system file and is referenced.
   CP_6.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  was found in the system file and is referenced.
   CP_6_C.:E05TOU  was found in the system file and is referenced.
      No diagnostics issued in procedure CPH$IBEX.
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:292  

 **** Variables and constants ****

  ****  Section 001 RoData CPH$IBEX

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    12-0-0/c CHAR(8)     r     1 BLANKS                     2-0-0/d STRC(288)   r     1 CXSJ_PARAM
    26-0-0/c CHAR(2)     r     1 DOT_PROMPT
     0-0-0/b BIT (9)     r     1 EDIT_MOPS(0:4)
    35-0-0/w STRC        r     1 E_BDSCAN                  45-0-0/w STRC        r     1 E_BDSTARTENDTYPE
    37-0-0/w STRC        r     1 E_BDSTARTNUM              44-0-0/w STRC        r     1 E_ILLXDEST
    42-0-0/w STRC        r     1 E_MSDEFAULT               41-0-0/w STRC        r     1 E_MSGLOBAL
    46-0-0/w STRC        r     1 E_NONAME                  47-0-0/w STRC        r     1 E_NONAME_4_CONT
    36-0-0/w STRC        r     1 E_NOSCAN                  40-0-0/w STRC        r     1 E_TRUNREC
    30-0-0/w SBIN        r     1 FKEY_ADJUST(0:3)
    14-0-0/d STRC(360)   r     1 INCLUDE_PROMPT            27-0-0/b STRC        r     1 INIT_KEY
    34-0-0/c STRC(9)     r     1 SAME_LINE_VFC

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

  3051-0-0/w PTR         r     1 @BLK$                   3051-0-0/w PTR         r     1 @BLK$
     3-0-0/w PTR         r     1 @P$PCB                  3053-0-0/w PTR         r     1 @PTR$
    11-0-0/w PTR         r     1 BLK$                      *0-0-0/w PTR         r     1 BLK$
    *0-0-0/w PTR         r     1 BLK$                     373-0-0/b BIT         r     1 CALL_FLG#
   357-0-0/w UBIN        r     1 CPOS                     370-0-0/b BIT         r     1 CROSS_ACCT_BATCH_FLG
   372-0-0/b BIT         r     1 ECHO_FILE_OK#            400-0-0/b BIT         r     1 ECHO_JOB_CMD
   755-0-0/b STRC        r     1 END_KEY                  312-0-0/c CHAR(31)    r     1 END_LABEL
   350-0-0/w UBIN        r     1 END_METHOD               351-0-0/w UBIN        r     1 END_NUM
   754-0-0/w STRC        r     1 ERR                     1021-0-0/w STRC(144)   r     1 FAKE_NODE
  1025-0-0/w STRC(144)   r     1 FAKE_NODE2              1031-0-0/w STRC(252)   r     1 FAKE_NODE3
   730-0-0/c STRC(72)    r     1 FID_ACCT                 332-0-0/w UBIN(9)     r     1 FID_ASN
   720-0-0/c STRC(288)   r     1 FID_NAME                 732-0-0/c STRC(72)    r     1 FID_PASS
   333-0-0/c CHAR(4)     r     1 FID_RES                  706-0-0/d STRC(324)   r     1 FID_RESULTS
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:293  
   736-0-0/d STRC(198)   r     1 FID_SN                   734-0-0/c STRC(72)    r     1 FID_WSN
   346-0-0/c CHAR(8)     r     1 FOL_ACCT                 336-0-0/c STRC(288)   r     1 FOL_NAME
   540-0-0/d STRC(1080)  r     1 FPT_CLOSE                654-0-0/d STRC(360)   r     1 FPT_DELREC
   576-0-0/d STRC(864)   r     1 FPT_FID                  432-0-0/d STRC(2088)  r     1 FPT_OPEN
   666-0-0/d STRC(360)   r     1 FPT_PRECORD              420-0-0/d STRC(360)   r     1 FPT_PROMPT
   402-0-0/d STRC(504)   r     1 FPT_READ                 626-0-0/d STRC(792)   r     1 FPT_UNFID
   700-0-0/d STRC(216)   r     1 FPT_WAIT                 524-0-0/d STRC(432)   r     1 FPT_WRITE
  3052-0-0/w UBIN        r     1 I                       3052-0-0/w UBIN        r     1 I
   375-0-0/b BIT         r     1 IBEX_OPEN_2_JOBSTATS    3053-0-0/w UBIN        r     1 J
     6-0-0/w PTR         r     1 JOB_FID$                 365-0-0/b BIT         r     1 JOB_FLAG#
   760-0-0/c STRC(90)    r     1 KEY_BUF                  366-0-0/b BIT         r     1 MATCHED_PAIR#
  3056-0-0/b BIT         r     1 NEED_2_READ_JOBSTATS     376-0-0/b BIT         r     1 NEED_2_RELEASE_IBEX2
   377-0-0/b BIT         r     1 NEED_ALTRETURN           367-0-0/b BIT         r     1 NSTATUS_OPT#
   362-0-0/w UBIN        r     1 NUM_FILES                363-0-0/w UBIN        r     1 NUM_OPTS
    10-0-0/w PTR         r     1 P$                        *0-0-0/w STRC(504)   r     1 P$PCB
  1003-0-0/w STRC(504)   r     1 PCB                       *0-0-0/w PTR         r     1 PTR$
   212-0-0/c CHAR(256)   r     1 READBUF
   212-0-0/c BIT         r     1 READBUFB(0:63)
   756-0-0/b STRC        r     1 READ_KEY                 355-0-0/w UBIN        r     1 SAVE_NUM
   356-0-0/b BIT         r     1 SAVE_SEED                371-0-0/b BIT         r     1 SCAN_OPT#
  1060-0-0/d REMB        r     1 SCAN_REMEM                 4-0-0/b STRC(72)    r     1 SEG3_
   360-0-0/w UBIN        r     1 START_INDX               757-0-0/b STRC        r     1 START_KEY
   322-0-0/c CHAR(31)    r     1 START_LABEL              352-0-0/w UBIN        r     1 START_METHOD
   353-0-0/w UBIN        r     1 START_NUM                361-0-0/w UBIN        r     1 STR_INDX
  3032-0-0/w STRC(473)   r     1 SUB$PARAMS              3054-0-0/w UBIN(18)    r     1 SYSID
     7-0-0/w PTR         r     1 TEMP$                   3055-0-0/w PTR         r     1 TEMP$
   112-0-0/c CHAR(256)   r     1 TEMPBUF                  374-0-0/b BIT         r     1 TRUNCATED_RECORD
  1040-0-0/w STRC(576)   r     1 U_PARAM                  354-0-0/w SBIN        r     1 VALUE
   334-0-0/c CHAR(8)     r     1 VALUE_BUF
  1062-0-0/w UBIN        r     1 WORKSPACE(0:999)
    12-0-0/c CHAR(256)   r     1 WRITEBUF                 364-0-0/w UBIN        r     1 X
   763-0-0/w STRC(324)   r     1 X$MCB                    774-0-0/w STRC(252)   r     1 X$PARAM
   744-0-0/d STRC(288)   r     1 XSJ_PARAM

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:294  
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$PS0$
     0-0-0/w PTR         r     1 B$SR_NON_BLANK$            0-0-0/w PTR         r     1 B$TCB$
     0-0-0/w PTR         r     1 B$XL_UPPER$                0-0-0/d STRC(1080)  r     1 CFPT_CLOSE
     0-0-0/d STRC(360)   r     1 CFPT_DELREC                0-0-0/d STRC(864)   r     1 CFPT_FID
     0-0-0/d STRC(2088)  r     1 CFPT_OPEN                  0-0-0/d STRC(360)   r     1 CFPT_PRECORD
     0-0-0/d STRC(360)   r     1 CFPT_PROMPT                0-0-0/d STRC(504)   r     1 CFPT_READ
     0-0-0/d STRC(792)   r     1 CFPT_UNFID                 0-0-0/d STRC(216)   r     1 CFPT_WAIT
     0-0-0/d STRC(432)   r     1 CFPT_WRITE                 0-0-0/w STRC(504)   r     1 CP$PCB
     0-0-0/w UBIN        r     1 CPSL_NODES                 0-0-0/d STRC(72)    r     1 IBEX2TXTC
     0-0-0/w UBIN        r     1 IBEX_CMD                   0-0-0/w UBIN        r     1 IF_
     0-0-0/c STRC(63)    r     1 K_GLOBAL                   0-0-0/w UBIN        r     1 M$IBEX1_NUM
     0-0-0/w UBIN        r     1 M$IBEX2_NUM                0-0-0/w UBIN        r     1 M$IBEX_NUM
     0-0-0/w UBIN        r     1 M$UC_NUM                   0-0-0/w PTR         r     1 SEG2$
     0-0-0/w PTR         r     1 SEG3$

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(2448)  r     1 B$ALT                      0-0-0/d STRC(8856)  r     1 B$JIT
     0-0-0/d STRC(4608)  r     1 B$SR_NON_BLANK             0-0-0/w STRC(144)   r     1 B$TCB
     0-0-0/d STRC(4608)  r     1 B$XL_UPPER                 0-0-0/w STRC(504)   r     1 BASED$PCB
     0-0-0/c CHAR(4)     r     1 CHARN                      0-0-0/w STRC(180)   r     1 CP$GLOBALS
     0-0-0/d ASTR(3528)  r     1 F$DCB                      0-0-0/d STRC(504)   r     1 FPT$READ
     0-0-0/d STRC(432)   r     1 FPT$WRITE                  0-0-0/d STRC(1512)  r     1 GET$CMD
     0-0-0N  NULL        r     1 M$UC                       0-0-0/w STRC(144)   r     1 P$B
     0-0-0/w ASTR(153)   r     1 P$S                        0-0-0/w STRC(6264)  r     1 SEG$2
     0-0-0/w STRC(576)   r     1 U$PARAM                    0-0-0/w STRC(90)    r     1 X$MAP
     0-0-0/c ASTR(9)     r     1 X$STRING                   0-0-0/d STRC(9612)  r     1 XUG$PARAMS


   Procedure CPH$IBEX requires 3772 words for executable code.
   Procedure CPH$IBEX requires 1594 words of local(AUTO) storage.
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:295  

    No errors detected in file CPH$IBEX.:E05TSI    .
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:296  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:297  
          MINI XREF LISTING

ABORT
     14840**LABEL   14099--CALLALT 14113--CALLALT 14364--CALLALT 14367--CALLALT 14535--CALLALT 14691--CALLALT
     14715--CALLALT 14762--CALLALT 14786--CALLALT 14832--CALLALT
ABORT IN PROCEDURE CHK_BREAK
     15635**LABEL   15610--CALLALT 15616--CALLALT 15619--CALLALT
ABORT IN PROCEDURE PROCESS_DIRECTIVES
     15531**LABEL   15291--GOTO    15367--GOTO    15510--CALLALT 15518--CALLALT
ABORT IN PROCEDURE WRITE_BUF
     15578**LABEL   15566--CALLALT 15572--CALLALT
ABORT1 IN PROCEDURE GLOBAL
     15158**LABEL   15137--CALLALT 15151--CALLALT
ADD_COMMENT
     14427**LABEL   14422--CALLALT
B$ALT.CODE
     12738**DCL     12738--REDEF   12739--REDEF   12739--REDEF
B$ALT.DCB#
     12739**DCL     14666<>CALL    14841<>CALL    15494<>CALL    15527<>CALL    15635<>CALL    15698<>CALL
B$ALT.ERR
     12739**DCL     14659>>ASSIGN  14841<>CALL    15158<>CALL    15494<>CALL    15527<>CALL    15635<>CALL
     15698<>CALL
B$ALT.ERR.CODE
     12740**DCL     14297>>IF      14649>>IF      14940>>IF      15481>>IF      15490>>IF
B$ALT.ERR.ERR#
     12740**DCL     12740--REDEF
B$ALT.EVID
     12739**DCL     12739--REDEF   12739--REDEF
B$JIT.ACCN
       112**DCL     14901>>ASSIGN  15739>>IF
B$JIT.CPFLAGS1
       201**DCL     14474>>IF      15471>>IF      15587<<ASSIGN  15587>>ASSIGN
B$JIT.CPFLAGS1.SLEAZE
       206**DCL       206--REDEF
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:298  
B$JIT.CPFLAGS1.WHEN_INPUT
       202**DCL     14046>>IF
B$JIT.ERR.MID
       113**DCL       113--REDEF
B$JIT.FACCN
       112**DCL     15673--ASSIGN
B$JIT.FPSN
       193**DCL     15677>>ASSIGN
B$JIT.JRESPEAK
       274**DCL       275--REDEF
B$JIT.MODE
       107**DCL     14213>>IF      15461>>IF
B$JIT.ORIGINATOR_PORT.FROM_CR
       383**DCL       383--REDEF     384--REDEF
B$JIT.PNR
       287**DCL       287--REDEF
B$JIT.PRFLAGS.POINT
       197**DCL     14617>>IF      15446>>IF
B$JIT.STEPCC
       339**DCL     15701<<ASSIGN
B$JIT.TSLINE
       381**DCL       382--REDEF
B$JIT.UNAME
       112**DCL     15739>>IF
B$JIT.USRERR
       248**DCL     14279<>CALL    15205<<ASSIGN  15212<>CALL
B$JIT.USRERR.CODE
       248**DCL     14277>>IF
B$JIT$
     10600**DCL       107--IMP-PTR 14046>>IF      14213>>IF      14277>>IF      14279>>CALL    14474>>IF
     14617>>IF      14901>>ASSIGN  15205>>ASSIGN  15212>>CALL    15446>>IF      15461>>IF      15471>>IF
     15587>>ASSIGN  15587>>ASSIGN  15673>>ASSIGN  15677>>ASSIGN  15701>>ASSIGN  15739>>IF      15739>>IF
B$PS0$
     10597**DCL     14707>>IF
B$SR_NON_BLANK
     11152**DCL     14319>>CALLBLT 14558>>CALLBLT 15238>>CALLBLT
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:299  
B$SR_NON_BLANK$
     11151**DCL     11152--IMP-PTR 14319>>CALLBLT 14558>>CALLBLT 15238>>CALLBLT
B$TCB.ALT$
     12734**DCL     14297>>IF      14649>>IF      14659>>ASSIGN  14666>>CALL    14841>>CALL    14841>>CALL
     14940>>IF      15158>>CALL    15481>>IF      15490>>IF      15494>>CALL    15494>>CALL    15527>>CALL
     15527>>CALL    15635>>CALL    15635>>CALL    15698>>CALL    15698>>CALL
B$TCB$
     10602**DCL     12734--IMP-PTR 14297>>IF      14649>>IF      14659>>ASSIGN  14666>>CALL    14841>>CALL
     14841>>CALL    14940>>IF      15158>>CALL    15481>>IF      15490>>IF      15494>>CALL    15494>>CALL
     15527>>CALL    15527>>CALL    15635>>CALL    15635>>CALL    15698>>CALL    15698>>CALL
B$XL_UPPER
     11156**DCL     15234>>CALLBLT
B$XL_UPPER$
     11155**DCL     11156--IMP-PTR 15234>>CALLBLT
BAD_COMMAND
     14603**LABEL   14452--CALLALT 14455--GOTO    14463--GOTO    14504--CALLALT 14519--CALLALT 14525--GOTO
BAD_COMMAND_NO_ECHO
     14608**LABEL   14465--GOTO
BASED$PCB.NCHARS
     13786**DCL     14619<<ASSIGN  14619>>ASSIGN
BLANKS
     11161**DCL     14360--ASSIGN
BLK$
     11072**DCL     14017<<ASSIGN  14045<<ASSIGN  14046>>IF      14138>>IF      14140>>ASSIGN  14140>>ASSIGN
     14142>>DOINDEX 14160>>ASSIGN  14361>>DOCASE  14369>>ASSIGN  14369>>ASSIGN  14406>>IF      14579>>IF
     14704>>IF      14722>>IF      15033>>IF      15075>>ASSIGN  15118>>DOINDEX 15119>>ASSIGN
BLK$ IN PROCEDURE CHK_4_CROSS_ACCT_BATCH
     15732**DCL     15730--PROC    15736>>DOINDEX 15737>>IF      15739>>IF      15739>>IF      15739>>IF
     15739>>IF
BLK$ IN PROCEDURE CHK_FOLLOW_CONDITION
     14886**DCL     14884--PROC    14903>>DOINDEX 14904>>IF      14906>>ASSIGN  14906>>ASSIGN  14908>>IF
     14910>>DOINDEX 14911>>ASSIGN
CALL_FLG#
     11194**DCL     14449<>CALL    14517<>CALL    15277<>CALL
CAMR_REC.ACSVEH_
      9639**DCL      9640--REDEF
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:300  
CAMR_REC.ALTKEYS_
      9645**DCL      9646--REDEF    9646--REDEF
CAMR_REC.HDR_
      9644**DCL      9645--REDEF
CAMR_REC.TAB_
      9643**DCL      9644--REDEF
CAMR_REC.UHL_
      9637**DCL      9638--REDEF    9638--REDEF
CAMR_REC.V.FSN#
      9677**DCL      9677--REDEF    9677--REDEF
CAMR_REC.WSN_
      9643**DCL      9643--REDEF
CFPT_CLOSE
      8481**DCL     14058>>ASSIGN  15147>>ASSIGN
CFPT_CLOSE.SN_
      8481**DCL      8481--REDEF
CFPT_CLOSE.UTL_
      8482**DCL      8482--REDEF
CFPT_CLOSE.V.EXPIRE#
      8496**DCL      8496--REDEF
CFPT_CLOSE.V.TYPE#
      8494**DCL      8494--REDEF
CFPT_CLOSE.V.XTNSIZE#
      8491**DCL      8491--REDEF    8493--REDEF
CFPT_DELREC
      8689**DCL     15106>>ASSIGN
CFPT_FID
      8788**DCL     15657>>ASSIGN
CFPT_OPEN
      8414**DCL     14061>>ASSIGN
CFPT_OPEN.ACSVEH_
      8416**DCL      8417--REDEF
CFPT_OPEN.ALTKEYS_
      8422**DCL      8423--REDEF    8423--REDEF
CFPT_OPEN.HDR_
      8421**DCL      8422--REDEF
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:301  
CFPT_OPEN.TAB_
      8420**DCL      8421--REDEF
CFPT_OPEN.UHL_
      8414**DCL      8415--REDEF    8415--REDEF
CFPT_OPEN.V.FSN#
      8454**DCL      8454--REDEF    8454--REDEF
CFPT_OPEN.WSN_
      8420**DCL      8420--REDEF
CFPT_PRECORD
      8668**DCL     14075>>ASSIGN
CFPT_PROMPT
      9088**DCL     15612>>ASSIGN
CFPT_READ
      8517**DCL     14069>>ASSIGN
CFPT_READ.STATION_
      8520**DCL      8521--REDEF
CFPT_READ.V.DVBYTE.REREAD#
      8532**DCL      8532--REDEF
CFPT_READ.V.INDX#
      8530**DCL      8530--REDEF
CFPT_READUC.STATION_
      8890**DCL      8891--REDEF
CFPT_READUC.V.DVBYTE.REREAD#
      8902**DCL      8902--REDEF
CFPT_READUC.V.INDX#
      8900**DCL      8900--REDEF
CFPT_TRTN.V.IR#
      9126**DCL      9127--REDEF
CFPT_UNFID
      8811**DCL     15391>>ASSIGN
CFPT_WAIT
      9766**DCL     14754>>ASSIGN
CFPT_WRITE
      8556**DCL     14064>>ASSIGN
CFPT_WRITE.STATION_
      8558**DCL      8558--REDEF
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:302  
CFPT_WRITE.V.DVBYTE.VFC#
      8565**DCL      8565--REDEF
CFPT_WRITEUC.STATION_
      8858**DCL      8858--REDEF
CFPT_WRITEUC.V.DVBYTE.VFC#
      8865**DCL      8865--REDEF
CFPT_XXX.V.STEPCC#
      9838**DCL      9838--REDEF
CGETCMD.OUT$
      9859**DCL      9865--REDEF
CHARN
     12744**DCL     14175<<ASSIGN
CHK_4_CROSS_ACCT_BATCH
     15730**PROC    14457--CALL
CHK_BREAK
     15586**PROC    14477--CALL    15473--CALL
CHK_BRK
     14474**LABEL   14591--CALLALT
CHK_ERR IN PROCEDURE CHK_FOLLOW_CONDITION
     14970**LABEL   14953--CALLALT 14965--GOTO
CHK_FOLLOW_CONDITION
     14884**PROC    14460--CALL
CHK_RETURN IN PROCEDURE CHK_FOLLOW_CONDITION
     14950**LABEL   14937--CALLALT 14944--GOTO
CLEAN_UP
     14771**LABEL   14695--GOTO
CLOSE_CMD_STREAM
     14698**LABEL   14554--GOTO    14574--GOTO    14585--GOTO
CLOSE_CMD_STREAM IN PROCEDURE PROCESS_DIRECTIVES
     15503**LABEL   15456--GOTO    15473--CALLALT
CLOSE_DCBS
     14851**LABEL   14381--CALLALT 14387--GOTO    14793--CALLALT 14800--CALLALT 14807--CALLALT 14809--CALLALT
CP$GLOBALS
     12666**DCL     15186--ASSIGN
CP$GLOBALS.FREE_HEAD_SAVE$
     12670**DCL     15136<<ASSIGN  15199>>ASSIGN
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:303  
CP$GLOBALS.HI_SEGMENT_SAVE$
     12668**DCL     15134<<ASSIGN  15197>>ASSIGN
CP$GLOBALS.SYM_HEAD_SAVE$
     12669**DCL     15135<<ASSIGN  15198>>ASSIGN
CP$GLOBALS.WKSZ_SAVE
     12667**DCL     15133<<ASSIGN  15196>>ASSIGN
CP$PCB
      8135**DCL     14122>>ASSIGN
CPA$GETRES
     11074**DCL-ENT 14235--CALL
CPB$OPENCS
     11076**DCL-ENT 14877--CALL
CPC$GETDCB
     11077**DCL-ENT 14975--CALL
CPC$GETSEG
     11078**DCL-ENT 15178--CALL
CPC$OPEN_S
     11080**DCL-ENT 15174--CALL
CPC$RDUSERS
     11082**DCL-ENT 14236--CALL
CPC$RELDCB
     11081**DCL-ENT 14958--CALL
CPC$RELSEG
     11083**DCL-ENT 14872--CALL    15143--CALL
CPC$SCREECH
     11084**DCL-ENT 15181--CALL
CPC$WRITEMSGE
     11085**DCL-ENT 14279--CALL    14280--CALL    14991--CALL    14993--CALL    15126--CALL    15212--CALL
     15411--CALL
CPD$NULL_SFROUTINE
     11087**DCL-ENT 14502--ASSIGN
CPD$SET_NODES
     11086**DCL-ENT 14449--CALL    14517--CALL    15277--CALL
CPD$SYNTRY
     11088**DCL-ENT 14446--ASSIGN  14505--ASSIGN  15272--ASSIGN
CPE$DIAGOUT
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:304  
     11089**DCL-ENT 14606--CALL    14658--CALL    15289--CALL    15366--CALL    15451--CALL    15489--CALL
CPE$LISTOUT
     11090**DCL-ENT 15048--CALL    15055--CALL    15071--CALL    15315--CALL    15322--CALL    15338--CALL
     15556--CALL
CPE$RZEROS
     11091**DCL-ENT 15601--CALL
CPG$SET_WHEN_STATE
     11092**DCL-ENT 14048--CALL
CPH$CONTINUE
     11093**DCL-ENT 14127--ASSIGN
CPH$STRING_SUB
     11097**DCL-ENT 14414--CALL    14482--CALL    15262--CALL
CPH$SYM_DELETE
     11094**DCL-ENT 15091--CALL    15354--CALL    15374--CALL
CPH$SYM_GET
     11095**DCL-ENT 15058--CALL    15325--CALL
CPH$SYM_PUT
     11096**DCL-ENT 14224--CALL    15123--CALL    15407--CALL
CPJ$READ_S
     11099**DCL-ENT 15191--CALL
CPJ$WRITE_S
     11100**DCL-ENT 15137--CALL
CPK$SUBMIT_CHECK
     11075**DCL-ENT 14762--CALL
CPOS
     11181**DCL     14272<<ASSIGN  14273<>CALL    14385<<ASSIGN  14386<>CALL    14615<<ASSIGN  14616<>CALL
     14939<<ASSIGN  14999<>CALL    15095<<ASSIGN  15096<>CALL    15359<<ASSIGN  15360<>CALL    15526<<ASSIGN
     15527<>CALL    15697<<ASSIGN  15698<>CALL
CPR$RPTERR
     11104**DCL-ENT 14629--CALL    14693--CALL    15454--CALL    15496--CALL    15532--CALL
CPSL_NODES
     11147**DCL     14520--IF
CROSS_ACCT_BATCH_FLG
     11191**DCL     14151<<ASSIGN  14739>>ASSIGN  15735<<ASSIGN  15742<<ASSIGN
CVLP_TRMCTL.BREAKCOUNT
      9450**DCL      9451--REDEF
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:305  
CVLP_WINDOW.FWINDOW#
      9546**DCL      9546--REDEF    9547--REDEF
CXG$GETCMD
     11117**DCL-ENT 15720--CALL
CXP$POSTERR
     11101**DCL-ENT 14273--CALL    14386--CALL    14616--CALL    14624--CALL    14666--CALL    14673--CALL
     14681--CALL    14841--CALL    14999--CALL    15096--CALL    15158--CALL    15279--CALL    15360--CALL
     15492--CALL    15494--CALL    15527--CALL    15635--CALL    15698--CALL
CXSJ_PARAM
     11140**DCL     14898>>ASSIGN
CXX$OCTBIN
     11102**DCL-ENT 14173--CALL
CXX$VERIFY
     11103**DCL-ENT 14522--CALL
DELETE_ALL_SUBS IN PROCEDURE GLOBAL
     15106**LABEL   15081--GOTO
DELETE_CMD_STREAM
     14681**LABEL   14209--CALLALT 14477--CALLALT 14700--GOTO    14711--GOTO
DOT_PROMPT
     11629**DCL     11623--DCLINIT
ECHO_FILE_OK#
     11193**DCL     14219<<ASSIGN  15545>>IF
ECHO_JOB_CMD
     11199**DCL     14456<<ASSIGN  14461>>IF      14994<<ASSIGN
EDIT_MOPS
     11123**DCL     15594>>CALLBLT
END_KEY
     12649**DCL     14188<<ASSIGN
END_KEY.KEY
     12651**DCL     14192<<ASSIGN  14198<<ASSIGN  14198>>ASSIGN  14552>>IF
END_LABEL
     11164**DCL     14181<<ASSIGN  14562>>IF
END_LOOP IN PROCEDURE GLOBAL
     15098**LABEL   15093--GOTO
END_METHOD
     11174**DCL     14154<<ASSIGN  14178<<ASSIGN  14179>>DOCASE  14548>>DOCASE  14566<<ASSIGN
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:306  
END_NUM
     11175**DCL     14183<<CALLBLT 14565<<ASSIGN  14572>>IF
ERR
     12615**DCL     14659<<ASSIGN  14662<<ASSIGN  14665<<ASSIGN  14666<>CALL
ERR.ERR#
     12645**DCL     14660>>IF      14663>>IF
ERR_RETURN
     14021**LABEL   14018--CALLALT
E_BDSCAN
     12762**DCL     14681<>CALL
E_BDSTARTENDTYPE
     12921**DCL     14665>>ASSIGN
E_BDSTARTNUM
     12802**DCL     14673<>CALL
E_CLOSE
     14851**LABEL   14856--CALLALT
E_CLOSE1
     14859**LABEL   14864--CALLALT
E_GETSEG IN PROCEDURE READ_GLOBALS
     15181**LABEL   15178--CALLALT
E_ILLXDEST
     12902**DCL     14386<>CALL
E_MSDEFAULT
     12862**DCL     15360<>CALL
E_MSGLOBAL
     12842**DCL     15096<>CALL
E_NONAME
     12970**DCL     14999<>CALL
E_NONAME_4_CONT
     13018**DCL     14991<>CALL    14993<>CALL
E_NOSCAN
     12782**DCL     14280<>CALL
E_OPEN IN PROCEDURE OPEN_FID
     15697**LABEL   15667--CALLALT 15693--CALLALT
E_OPEN IN PROCEDURE PROCESS_DIRECTIVES
     15445**LABEL   15442--CALLALT
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:307  
E_OPEN IN PROCEDURE READ_GLOBALS
     15212**LABEL   15174--CALLALT
E_READ
     14649**LABEL   14301--GOTO    14398--CALLALT 14541--CALLALT
E_READ IN PROCEDURE PROCESS_DIRECTIVES
     15481**LABEL   15475--CALLALT
E_READ IN PROCEDURE READ_GLOBALS
     15205**LABEL   15191--CALLALT
E_TRUNREC
     12822**DCL     14662>>ASSIGN  15492<>CALL
F$DCB.ACTPOS
     11677**DCL     11677--REDEF
F$DCB.ARS#
     11651**DCL     11651--REDEF   14303>>ASSIGN  14399>>ASSIGN  14542>>ASSIGN  14655>>ASSIGN  15286>>ASSIGN
     15363>>ASSIGN  15476>>ASSIGN  15486>>ASSIGN  15623>>IF
F$DCB.ASN#
     11666**DCL     15516>>IF
F$DCB.ATTR
     11670**DCL     11671--REDEF
F$DCB.BORROW
     11685**DCL     11685--REDEF   11685--REDEF   11685--REDEF
F$DCB.DCBNAME.L
     11699**DCL     11699--IMP-SIZ
F$DCB.EOMCHAR#
     11655**DCL     11655--REDEF
F$DCB.FCD#
     11664**DCL     14094>>IF      14350>>IF      14686>>IF      14707>>IF      14781>>IF      14827>>IF
     14851>>IF      14859>>IF      15503>>IF
F$DCB.FFLG.EXEC#
     11657**DCL     14219>>ASSIGN  14382>>IF
F$DCB.FLDID
     11680**DCL     11680--REDEF
F$DCB.FORM$
     11674**DCL     11674--REDEF
F$DCB.FSECT
     11690**DCL     11690--REDEF
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:308  
F$DCB.FSN#
     11667**DCL     11667--REDEF   11667--REDEF   11668--REDEF
F$DCB.HEADER$
     11673**DCL     11673--REDEF
F$DCB.IXTNSIZE#
     11671**DCL     11671--REDEF
F$DCB.LASTSTA$
     11660**DCL     11660--REDEF
F$DCB.LVL
     11686**DCL     11686--REDEF
F$DCB.NAME#.C
     11661**DCL     11661--REDEF   14730>>ASSIGN
F$DCB.NOEOF
     11683**DCL     11683--REDEF
F$DCB.NRECS#
     11672**DCL     11672--REDEF   14707>>IF
F$DCB.NRECX
     11691**DCL     11691--REDEF
F$DCB.OHDR
     11683**DCL     11683--REDEF
F$DCB.ORG#
     11666**DCL     11666--REDEF   14794>>IF      15589>>IF
F$DCB.PRECNO
     11689**DCL     11689--REDEF
F$DCB.RCSZ
     11695**DCL     11695--REDEF
F$DCB.RES#
     11662**DCL     11662--REDEF
F$DCB.SETX
     11674**DCL     11674--REDEF
F$DCB.TAB$
     11674**DCL     11674--REDEF
F$DCB.TDA
     11688**DCL     11689--REDEF
F$DCB.UB$
     11690**DCL     14707>>IF
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:309  
F$DCB.WSN#
     11662**DCL     11662--REDEF
FAKE_NODE
     13827**DCL     14445--ASSIGN  14732--ASSIGN  15275--ASSIGN
FAKE_NODE.CODE
     13835**DCL     14448<<ASSIGN  15248<<ASSIGN  15261<<ASSIGN
FAKE_NODE.NSUBLKS
     13839**DCL     14738<<ASSIGN
FAKE_NODE.SUBLK$
     13860**DCL     14742<<ASSIGN
FAKE_NODE.TEMP
     13828**DCL     14079<<ASSIGN  14737<<ASSIGN  14764<<ASSIGN
FAKE_NODE2
     13872**DCL     14742--ASSIGN
FAKE_NODE2.CODE
     13880**DCL     14745<<ASSIGN
FAKE_NODE2.NSUBLKS
     13884**DCL     14740<<ASSIGN
FAKE_NODE2.SUBLK$
     13905**DCL     14743<<ASSIGN
FAKE_NODE2.TEMP
     13873**DCL     14739<<ASSIGN
FAKE_NODE3
     13918**DCL     14729--ASSIGN  14730--ASSIGN  14730--ASSIGN  14743--ASSIGN  14744--ASSIGN
FAKE_NODE3.CODE
     13926**DCL     14746<<ASSIGN
FAKE_NODE3.NSUBLKS
     13930**DCL     14741<<ASSIGN
FAKE_NODE3.SUBLK$
     13951**DCL     14744<<ASSIGN
FID_ACCT
     11758**DCL     15660--ASSIGN
FID_ACCT.ACCT#
     11758**DCL     14429>>CALLBLT 14433>>CALLBLT
FID_ASN
     11166**DCL     15655<<ASSIGN  15664--ASSIGN  15691>>ASSIGN
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:310  
FID_NAME
     11745**DCL     15659--ASSIGN
FID_NAME.L#
     11745**DCL     14429>>CALLBLT 14433>>CALLBLT 14436>>ASSIGN
FID_NAME.NAME#
     11745**DCL     14429>>CALLBLT 14433>>CALLBLT
FID_PASS
     11771**DCL     15661--ASSIGN
FID_RES
     11167**DCL     15656<<ASSIGN  15665--ASSIGN  15688>>ASSIGN
FID_RESULTS
     11712**DCL     15666--ASSIGN
FID_RESULTS.ACCT
     11712**DCL     15671>>IF
FID_RESULTS.ASN
     11712**DCL     15689>>IF
FID_RESULTS.RES
     11712**DCL     15686>>IF
FID_RESULTS.SN
     11712**DCL     15674>>IF
FID_SN
     11797**DCL     15662--ASSIGN  15678--ASSIGN
FID_SN.NUM#
     11797**DCL     15676<<ASSIGN
FID_SN.SN#
     11797**DCL     15677<<ASSIGN
FID_WSN
     11784**DCL     15663--ASSIGN
FKEY_ADJUST
     12601**DCL     14198>>ASSIGN  14262>>ASSIGN
FOL_ACCT
     11172**DCL     14901<<ASSIGN  14906<<ASSIGN  14923<<ASSIGN  14925--ASSIGN  14991<>CALL
FOL_NAME
     11169**DCL     14991<>CALL    14993<>CALL
FOL_NAME.CNT
     11170**DCL     14917<<ASSIGN
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:311  
FOL_NAME.NAME
     11171**DCL     14915<<ASSIGN  14919--ASSIGN
FPT$READ
     11257**DCL     15619<>CALL
FPT$READ.BUF_
     11259**DCL     15618<<ASSIGN
FPT$READ.STATION_
     11260**DCL     11261--REDEF
FPT$READ.V.DVBYTE.REREAD#
     11272**DCL     11272--REDEF
FPT$READ.V.INDX#
     11270**DCL     11270--REDEF
FPT$WRITE
     11464**DCL     15610<>CALL
FPT$WRITE.BUF_
     11464**DCL     14118<<ASSIGN  15039<<ASSIGN  15306<<ASSIGN  15607<<ASSIGN
FPT$WRITE.BUF_.BOUND
     11464**DCL     14604<<ASSIGN  14655<<ASSIGN  15047<<ASSIGN  15054<<ASSIGN  15068<<ASSIGN  15286<<ASSIGN
     15314<<ASSIGN  15321<<ASSIGN  15335<<ASSIGN  15363<<ASSIGN  15449<<ASSIGN  15486<<ASSIGN  15553<<ASSIGN
     15555<<ASSIGN  15609<<ASSIGN
FPT$WRITE.STATION_
     11466**DCL     11466--REDEF
FPT$WRITE.V.DVBYTE.VFC#
     11473**DCL     11473--REDEF   15608<<ASSIGN
FPT_CLOSE
     11501**DCL     14058<<ASSIGN  14099<>CALL    14113<>CALL    14691<>CALL    14715<>CALL    14786<>CALL
     14832<>CALL    14856<>CALL    14864<>CALL    15147<<ASSIGN  15151<>CALL    15436<>CALL    15505<>CALL
FPT_CLOSE.SN_
     11501**DCL     11501--REDEF
FPT_CLOSE.UTL_
     11502**DCL     11502--REDEF
FPT_CLOSE.V
     11506**DCL     14059--ASSIGN  15148--ASSIGN
FPT_CLOSE.V.DCB#
     11507**DCL     14098<<ASSIGN  14112<<ASSIGN  14690<<ASSIGN  14714<<ASSIGN  14785<<ASSIGN  14831<<ASSIGN
     14855<<ASSIGN  14863<<ASSIGN  15149<<ASSIGN  15434<<ASSIGN
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:312  
FPT_CLOSE.V.DISP#
     11510**DCL     14097<<ASSIGN  14111<<ASSIGN  14689<<ASSIGN  14713<<ASSIGN  14784<<ASSIGN  14830<<ASSIGN
     14854<<ASSIGN  14862<<ASSIGN  15150<<ASSIGN  15435<<ASSIGN
FPT_CLOSE.V.EXPIRE#
     11516**DCL     11516--REDEF
FPT_CLOSE.V.TYPE#
     11514**DCL     11514--REDEF
FPT_CLOSE.V.XTNSIZE#
     11511**DCL     11511--REDEF   11513--REDEF
FPT_CLOSE.V_
     11501**DCL     14059<<ASSIGN  15148<<ASSIGN
FPT_DELREC
     11572**DCL     15106<<ASSIGN  15110<>CALL
FPT_DELREC.KEY_
     11572**DCL     15109<<ASSIGN
FPT_DELREC.V
     11575**DCL     15107--ASSIGN
FPT_DELREC.V.DCB#
     11576**DCL     15108<<ASSIGN
FPT_DELREC.V_
     11572**DCL     15107<<ASSIGN
FPT_FID
     11531**DCL     15657<<ASSIGN  15667<>CALL
FPT_FID.ACCT_
     11532**DCL     15396>>ASSIGN  15660<<ASSIGN  15673<<ASSIGN  15682>>ASSIGN
FPT_FID.ASN_
     11534**DCL     15400>>ASSIGN  15664<<ASSIGN
FPT_FID.NAME_
     11532**DCL     15395>>ASSIGN  15659<<ASSIGN  15681>>ASSIGN
FPT_FID.PASS_
     11532**DCL     15397>>ASSIGN  15661<<ASSIGN  15683>>ASSIGN
FPT_FID.RESULTS_
     11534**DCL     15666<<ASSIGN
FPT_FID.RES_
     11534**DCL     15401>>ASSIGN  15665<<ASSIGN
FPT_FID.SN_
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:313  
     11533**DCL     15398>>ASSIGN  15662<<ASSIGN  15678<<ASSIGN  15684>>ASSIGN
FPT_FID.TEXTFID_
     11531**DCL     15658<<ASSIGN
FPT_FID.WSN_
     11533**DCL     15399>>ASSIGN  15663<<ASSIGN  15685>>ASSIGN
FPT_OPEN
     11372**DCL     14061<<ASSIGN  14364<>CALL    14367<>CALL    15693<>CALL
FPT_OPEN.ACCT_
     11376**DCL     15682<<ASSIGN
FPT_OPEN.ACSVEH_
     11374**DCL     11375--REDEF
FPT_OPEN.ALTKEYS_
     11380**DCL     11381--REDEF   11381--REDEF
FPT_OPEN.HDR_
     11379**DCL     11380--REDEF
FPT_OPEN.NAME_
     11373**DCL     15681<<ASSIGN
FPT_OPEN.PASS_
     11374**DCL     15683<<ASSIGN
FPT_OPEN.SN_
     11372**DCL     15684<<ASSIGN
FPT_OPEN.TAB_
     11378**DCL     11379--REDEF
FPT_OPEN.UHL_
     11372**DCL     11373--REDEF   11373--REDEF
FPT_OPEN.V
     11381**DCL     14062--ASSIGN
FPT_OPEN.V.ACS#
     11392**DCL     14207<<ASSIGN  14374<<ASSIGN
FPT_OPEN.V.ASN#
     11391**DCL     14213>>IF      14354<<ASSIGN  15461>>IF      15691<<ASSIGN
FPT_OPEN.V.DCB#
     11381**DCL     14204<<ASSIGN  14355<<ASSIGN  14791<<ASSIGN  15440<<ASSIGN
FPT_OPEN.V.DISP#
     11397**DCL     14356<<ASSIGN
FPT_OPEN.V.EXIST#
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:314  
     11385**DCL     14357<<ASSIGN  14373<<ASSIGN  14376<<ASSIGN  14378<<ASSIGN
FPT_OPEN.V.FSN#
     11412**DCL     11412--REDEF   11412--REDEF
FPT_OPEN.V.FUN#
     11391**DCL     14205<<ASSIGN  14358<<ASSIGN  14792<<ASSIGN  15441<<ASSIGN
FPT_OPEN.V.INITZ.SCRUB#
     11382**DCL     15692<<ASSIGN
FPT_OPEN.V.ORG#
     11392**DCL     14206<<ASSIGN
FPT_OPEN.V.RES#
     11396**DCL     14363<<ASSIGN  14366<<ASSIGN  14370<<ASSIGN  15688<<ASSIGN
FPT_OPEN.V.XTNSIZE#
     11400**DCL     14359<<ASSIGN
FPT_OPEN.V_
     11372**DCL     14062<<ASSIGN
FPT_OPEN.WSN_
     11378**DCL     11378--REDEF   14360<<ASSIGN  15685<<ASSIGN
FPT_PRECORD
     11591**DCL     14075<<ASSIGN  14800<>CALL    14807<>CALL    15518<>CALL
FPT_PRECORD.KEY_
     11591**DCL     14806<<ASSIGN
FPT_PRECORD.V
     11593**DCL     14076--ASSIGN
FPT_PRECORD.V.DCB#
     11593**DCL     14077<<ASSIGN
FPT_PRECORD.V.KEYS#
     11594**DCL     14798<<ASSIGN  14804<<ASSIGN  15514<<ASSIGN
FPT_PRECORD.V.N#
     11597**DCL     14799<<ASSIGN  14805<<ASSIGN  15515<<ASSIGN
FPT_PRECORD.V_
     11591**DCL     14076<<ASSIGN
FPT_PROMPT
     11295**DCL     15612<<ASSIGN  15616<>CALL
FPT_PROMPT.PROMPT_
     11301**DCL     15615<<ASSIGN
FPT_PROMPT.V
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:315  
     11303**DCL     15613--ASSIGN
FPT_PROMPT.V.DVBYTE#.VFC#
     11304**DCL     15614<<ASSIGN
FPT_PROMPT.V_
     11297**DCL     15613<<ASSIGN
FPT_READ
     11218**DCL     14069<<ASSIGN  14087--ASSIGN  14296<>CALL    14398<>CALL    14541<>CALL    14809<>CALL
     15475<>CALL
FPT_READ.BUF_
     11220**DCL     14073<<ASSIGN
FPT_READ.KEY_
     11218**DCL     14072<<ASSIGN
FPT_READ.STATION_
     11221**DCL     11222--REDEF
FPT_READ.V
     11222**DCL     14070--ASSIGN
FPT_READ.V.DCB#
     11222**DCL     14071<<ASSIGN
FPT_READ.V.DVBYTE.REREAD#
     11233**DCL     11233--REDEF
FPT_READ.V.INDX#
     11231**DCL     11231--REDEF
FPT_READ.V.KEYR#
     11223**DCL     14200<<ASSIGN  14208<<ASSIGN  14264<<ASSIGN  14794>>IF      15589>>IF
FPT_READ.V.SEED#
     11232**DCL     14152<<ASSIGN  14173<>CALL    14175--ASSIGN  15429>>ASSIGN  15430<<ASSIGN  15509<<ASSIGN
FPT_READ.V_
     11218**DCL     14070<<ASSIGN
FPT_UNFID
     11554**DCL     15391<<ASSIGN  15402<>CALL
FPT_UNFID.ACCT_
     11555**DCL     15396<<ASSIGN
FPT_UNFID.ASN_
     11557**DCL     15400<<ASSIGN
FPT_UNFID.LEN_
     11557**DCL     15394<<ASSIGN
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:316  
FPT_UNFID.NAME_
     11555**DCL     15395<<ASSIGN
FPT_UNFID.PASS_
     11555**DCL     15397<<ASSIGN
FPT_UNFID.RES_
     11557**DCL     15401<<ASSIGN
FPT_UNFID.SN_
     11556**DCL     15398<<ASSIGN
FPT_UNFID.TEXTFID_
     11554**DCL     15393<<ASSIGN
FPT_UNFID.V
     11558**DCL     15392--ASSIGN
FPT_UNFID.V_
     11554**DCL     15392<<ASSIGN
FPT_UNFID.WSN_
     11556**DCL     15399<<ASSIGN
FPT_WAIT
     11641**DCL     14754<<ASSIGN  14757<>CALL
FPT_WAIT.V
     11642**DCL     14755--ASSIGN
FPT_WAIT.V.UNITS#
     11642**DCL     14756<<ASSIGN
FPT_WAIT.V_
     11641**DCL     14755<<ASSIGN
FPT_WRITE
     11433**DCL     14064<<ASSIGN  14088--ASSIGN  15566<>CALL    15572<>CALL
FPT_WRITE.BUF_
     11433**DCL     14067<<ASSIGN  15565<<ASSIGN  15567<<ASSIGN
FPT_WRITE.BUF_.BOUND
     11433**DCL     15571<<ASSIGN
FPT_WRITE.STATION_
     11435**DCL     11435--REDEF
FPT_WRITE.V
     11436**DCL     14065--ASSIGN
FPT_WRITE.V.DCB#
     11436**DCL     14066<<ASSIGN
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:317  
FPT_WRITE.V.DVBYTE.VFC#
     11442**DCL     11442--REDEF
FPT_WRITE.V_
     11433**DCL     14065<<ASSIGN
GET$CMD
     11812**DCL     15720<>CALL
GET$CMD.ALWAYS_SET_PROMPT#
     11900**DCL     15621<<ASSIGN
GET$CMD.NODES$
     11813**DCL     15718<<ASSIGN
GET$CMD.OUT$
     11817**DCL     11823--REDEF
GET$CMD.PCB$
     11837**DCL     14619>>ASSIGN  14619>>ASSIGN
GET$CMD.SKIP_PREPROCESS#
     11893**DCL     15719<<ASSIGN
GET$CMD.TEXT_
     12075**DCL     15717<<ASSIGN  15725<<ASSIGN
GET$CMD.WORK$
     11845**DCL     14217>>ASSIGN  15465>>ASSIGN  15724>>ASSIGN
GLOBAL
     15024**PROC    14018--CALL
I IN PROCEDURE CHK_4_CROSS_ACCT_BATCH
     15733**DCL     15736<<DOINDEX 15737>>IF      15739>>IF      15739>>IF      15739>>IF      15739>>IF
I IN PROCEDURE CHK_FOLLOW_CONDITION
     14888**DCL     14903<<DOINDEX 14904>>IF      14906>>ASSIGN  14906>>ASSIGN  14908>>IF      14910>>DOINDEX
     14911>>ASSIGN
IBEX2TXTC
     10615**DCL     14975<>CALL
IBEX_CMD
     11149**DCL     14499--ASSIGN  14530--ASSIGN
IBEX_OPEN_2_JOBSTATS
     11196**DCL     14894<<ASSIGN  14935>>IF      14950>>IF      14954<<ASSIGN  14979<<ASSIGN
IF_
     11148**DCL     14526--IF
INCLUDE_PROMPT
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:318  
     11617**DCL     14216<>CALL    15464<>CALL
INCLUDE_PROMPT.V
     11625**DCL     11619--DCLINIT
INIT_KEY
     12598**DCL     14188>>ASSIGN  14252>>ASSIGN
J IN PROCEDURE CHK_FOLLOW_CONDITION
     14889**DCL     14910<<DOINDEX 14911>>ASSIGN
JOB_CARD
     14406**LABEL   14396--CALLALT
JOB_FID$
     11069**DCL     14160<<ASSIGN  14166>>DOINDEX 14167>>ASSIGN  14793>>CALL    15510>>CALL
JOB_FLAG#
     11188**DCL     14053<<ASSIGN  14148<<ASSIGN  14584<<ASSIGN  14778>>IF      14810<<ASSIGN
KEY_BUF
     12661**DCL     15596--CALL
KEY_BUF.COUNT
     12662**DCL     15588<<ASSIGN  15595<<ASSIGN  15602<<ASSIGN  15604>>CALLBLT 15609>>ASSIGN
KEY_BUF.TEXT
     12663**DCL     15588--ASSIGN  15594<<CALLBLT 15595--ASSIGN  15600<<CALLBLT 15601<>CALL    15601--CALL
     15604>>CALLBLT
K_GLOBAL
     10631**DCL     15109--ASSIGN  15137--CALL    15191--CALL
M$CLOSE
        26**DCL-ENT 14099--CALL    14113--CALL    14691--CALL    14715--CALL    14786--CALL    14832--CALL
     14856--CALL    14864--CALL    15151--CALL    15436--CALL    15505--CALL
M$DELREC
        28**DCL-ENT 15110--CALL
M$FID
        89**DCL-ENT 15667--CALL
M$IBEX1_NUM
     10606**DCL     14066>>ASSIGN  14112>>ASSIGN  14236<>CALL    14350--IF      14355>>ASSIGN  14382--IF
     14686--IF      14690>>ASSIGN  14707--IF      14707--IF      14707--IF      14714>>ASSIGN  14730--ASSIGN
     14859--IF      14863>>ASSIGN  15108>>ASSIGN  15137<>CALL    15149>>ASSIGN  15158<>CALL    15174<>CALL
     15191<>CALL    15212<>CALL
M$IBEX2_NUM
     10607**DCL     14900>>ASSIGN  14958<>CALL    14975<>CALL    14977>>ASSIGN
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:319  
M$IBEX_NUM
     10605**DCL     14071>>ASSIGN  14077>>ASSIGN  14094--IF      14098>>ASSIGN  14204>>ASSIGN  14219--ASSIGN
     14303--ASSIGN  14399--ASSIGN  14542--ASSIGN  14655--ASSIGN  14781--IF      14785>>ASSIGN  14791>>ASSIGN
     14794--IF      14827--IF      14831>>ASSIGN  14851--IF      14855>>ASSIGN  15286--ASSIGN  15363--ASSIGN
     15434>>ASSIGN  15440>>ASSIGN  15476--ASSIGN  15486--ASSIGN  15503--IF      15516--IF      15589--IF
M$OPEN
        26**DCL-ENT 14364--CALL    14367--CALL    15693--CALL
M$PRECORD
        30**DCL-ENT 14800--CALL    14807--CALL    15518--CALL
M$PROMPT
        50**DCL-ENT 14216--CALL    15464--CALL    15616--CALL
M$READ
        27**DCL-ENT 14296--CALL    14398--CALL    14541--CALL    14809--CALL    15475--CALL    15619--CALL
M$UC_NUM
     10603**DCL     15623--IF
M$UNFID
        89**DCL-ENT 15402--CALL
M$WAIT
        84**DCL-ENT 14757--CALL
M$WRITE
        27**DCL-ENT 15566--CALL    15572--CALL    15610--CALL
MATCHED_PAIR#
     11189**DCL     14419<<ASSIGN  14423<<ASSIGN  14423>>ASSIGN  14427>>IF
MSING_SUB IN PROCEDURE GLOBAL
     15095**LABEL   15091--CALLALT
NEED_2_READ_JOBSTATS IN PROCEDURE CHK_FOLLOW_CONDITION
     14892**DCL     14895<<ASSIGN  14920<<ASSIGN  14928<<ASSIGN  14932>>IF
NEED_2_RELEASE_IBEX2
     11197**DCL     14896<<ASSIGN  14955>>IF      14960<<ASSIGN  14976<<ASSIGN
NEED_ALTRETURN
     11198**DCL     14897<<ASSIGN  14963>>IF      15001<<ASSIGN
NSTATUS_OPT#
     11190**DCL     14150<<ASSIGN  14229<<ASSIGN  14737>>ASSIGN  14747>>IF
NUM_FILES
     11184**DCL     14142<<DOINDEX 14160>>ASSIGN
NUM_OPTS
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:320  
     11185**DCL     14166<<DOINDEX 14167>>ASSIGN  15087<<DOINDEX 15088>>ASSIGN  15118<<DOINDEX 15119>>ASSIGN
     15350<<DOINDEX 15351>>ASSIGN  15384<<DOINDEX 15385>>ASSIGN
OPEN_CMD_STREAM
     14350**LABEL   14811--GOTO
OPEN_FID
     15648**PROC    14209--CALL    14381--CALL    14793--CALL    15442--CALL    15510--CALL
OPEN_M$IBEX2
     14973**PROC    14937--CALL
OVERFLOW_ON_READ
     14653**LABEL   14338--GOTO    14342--GOTO
P$
     11071**DCL     15088<<ASSIGN  15089>>ASSIGN  15090>>ASSIGN  15095>>ASSIGN  15351<<ASSIGN  15352>>ASSIGN
     15353>>ASSIGN  15359>>ASSIGN
P$B
     13141**DCL     14522<>CALL
P$B.CODE
     13149**DCL     14046>>IF      14138>>IF      14168>>DOCASE  14178>>ASSIGN  14361>>DOCASE  14371>>DOCASE
     14406>>IF      14579>>IF      14704>>IF      14722>>IF      15076>>IF      15295>>IF      15343>>IF
P$B.CPOS
     13167**DCL     14385>>ASSIGN  14510>>ASSIGN  14511>>ASSIGN
P$B.NDTYPE
     13144**DCL     14171>>IF      15089>>ASSIGN  15352>>ASSIGN
P$B.NSUBLKS
     13153**DCL     14140<<ASSIGN  14140>>ASSIGN  14142>>DOINDEX 14166>>DOINDEX 14194>>ASSIGN  14258>>ASSIGN
     14369>>ASSIGN  14903>>DOINDEX 14910>>DOINDEX 14921>>IF      14989>>IF      15033>>IF      15079>>IF
     15087>>DOINDEX 15118>>DOINDEX 15300>>IF      15346>>IF      15350>>DOINDEX 15384>>DOINDEX 15736>>DOINDEX
P$B.SUBLK$
     13174**DCL     14160>>ASSIGN  14167>>ASSIGN  14170>>ASSIGN  14178>>ASSIGN  14181>>ASSIGN  14181>>ASSIGN
     14183>>CALLBLT 14183>>CALLBLT 14187>>ASSIGN  14189>>IF      14191>>CALLBLT 14191>>CALLBLT 14194>>ASSIGN
     14221>>ASSIGN  14222>>ASSIGN  14223>>ASSIGN  14242>>ASSIGN  14245>>ASSIGN  14245>>ASSIGN  14247>>CALLBLT
     14247>>CALLBLT 14251>>ASSIGN  14253>>IF      14255>>CALLBLT 14255>>CALLBLT 14258>>ASSIGN  14369>>ASSIGN
     14381<>CALL    14509>>ASSIGN  14529>>ASSIGN  14529>>ASSIGN  14793<>CALL    14904>>IF      14906>>ASSIGN
     14906>>ASSIGN  14906>>ASSIGN  14906>>ASSIGN  14908>>IF      14910>>DOINDEX 14911>>ASSIGN  14911>>ASSIGN
     14912>>DOCASE  14912>>DOCASE  14915>>ASSIGN  14915>>ASSIGN  14915>>ASSIGN  14915>>ASSIGN  14917>>ASSIGN
     14917>>ASSIGN  14921>>IF      14923>>ASSIGN  14923>>ASSIGN  14923>>ASSIGN  14923>>ASSIGN  14989>>IF
     15075>>ASSIGN  15088>>ASSIGN  15119>>ASSIGN  15120>>ASSIGN  15121>>ASSIGN  15122>>ASSIGN  15342>>ASSIGN
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:321  
     15351>>ASSIGN  15385>>ASSIGN  15386>>ASSIGN  15387>>DOCASE  15389>>ASSIGN  15389>>ASSIGN  15406>>ASSIGN
     15442<>CALL    15510<>CALL    15737>>IF      15739>>IF      15739>>IF      15739>>IF      15739>>IF
     15739>>IF      15739>>IF      15739>>IF      15739>>IF
P$B.TEMP
     13142**DCL     14506>>IF
P$PCB
     13237**DCL        15--PROC    14015--ENTRY   14043--ENTRY
P$PCB.OUT$
     13250**DCL     14017>>ASSIGN  14045>>ASSIGN
P$PCB.USER$
     13404**DCL     14126>>ASSIGN
P$S.CODE
     13193**DCL     14189>>IF      14195>>IF      14242>>ASSIGN  14253>>IF      14259>>IF      14904>>IF
     14908>>IF      14912>>DOCASE  15387>>DOCASE  15737>>IF
P$S.COUNT
     13210**DCL     13213--IMP-SIZ 14173<>CALL    14175>>ASSIGN  14175>>ASSIGN  14181>>ASSIGN  14183>>CALLBLT
     14191>>CALLBLT 14197>>CALLBLT 14198>>ASSIGN  14245>>ASSIGN  14247>>CALLBLT 14255>>CALLBLT 14261>>CALLBLT
     14262>>ASSIGN  14729<<ASSIGN  14730>>ASSIGN  14744--ASSIGN  14906>>ASSIGN  14915>>ASSIGN  14917>>ASSIGN
     14923>>ASSIGN  15658>>ASSIGN  15739>>IF      15739>>IF
P$S.CPOS
     13202**DCL     14272>>ASSIGN  14939>>ASSIGN  15095>>ASSIGN  15359>>ASSIGN  15697>>ASSIGN
P$S.NDTYPE
     13190**DCL     14223>>ASSIGN  15122>>ASSIGN  15406>>ASSIGN
P$S.TEXT
     13213**DCL     14175>>ASSIGN  14181>>ASSIGN  14183>>CALLBLT 14191>>CALLBLT 14197>>CALLBLT 14245>>ASSIGN
     14247>>CALLBLT 14255>>CALLBLT 14261>>CALLBLT 14730<<ASSIGN  14906>>ASSIGN  14915>>ASSIGN  14923>>ASSIGN
     15658--ASSIGN  15739>>IF      15739>>IF
P$S.TEXTC$
     13205**DCL     14221>>ASSIGN  14222>>ASSIGN  15090>>ASSIGN  15120>>ASSIGN  15121>>ASSIGN  15353>>ASSIGN
     15386>>ASSIGN  15389>>ASSIGN
PARSE_DIRECTIVE IN PROCEDURE PROCESS_DIRECTIVES
     15272**LABEL   15249--GOTO    15263--GOTO
PCB
     13438**DCL     14122<<ASSIGN  14449<>CALL    14452<>CALL    14504<>CALL    14517<>CALL    14519<>CALL
     14762<>CALL    15277<>CALL    15278<>CALL
PCB.CONTINUE
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:322  
     13479**DCL     14447<<ASSIGN  14503<<ASSIGN  14516<<ASSIGN  15276<<ASSIGN
PCB.ERROR
     13542**DCL     14616<>CALL    14624<>CALL    15279<>CALL
PCB.ERROR.CODE
     13550**DCL     14609>>IF      14612>>IF
PCB.HI_CHAR
     13589**DCL     14615>>ASSIGN  14617>>IF      15279<>CALL
PCB.NCHARS
     13585**DCL     14444<<ASSIGN  14500<<ASSIGN  14511<<ASSIGN  14511>>ASSIGN  14512>>IF      14617>>IF
     15274<<ASSIGN
PCB.OUT$
     13451**DCL     14445<<ASSIGN  14457<>CALL    14460<>CALL    14506>>IF      14509<<ASSIGN  14509>>ASSIGN
     14510>>ASSIGN  14511>>ASSIGN  14522>>CALL    14529<<ASSIGN  14529>>ASSIGN  14732<<ASSIGN  15275<<ASSIGN
     15295>>IF      15300>>IF      15342>>ASSIGN  15384>>DOINDEX 15385>>ASSIGN  15442>>CALL
PCB.ROOT$
     13443**DCL     14449<>CALL    14499<<ASSIGN  14517<>CALL    14520>>IF      14526>>IF      14530<<ASSIGN
     15277<>CALL
PCB.TEXT$
     13439**DCL     14125<<ASSIGN  14443<<ASSIGN  14501<<ASSIGN  14510<<ASSIGN  14510>>ASSIGN  14629>>CALL
     15273<<ASSIGN
PCB.U$$
     13456**DCL     14446<<ASSIGN  14502<<ASSIGN  14505<<ASSIGN  15272<<ASSIGN
PCB.USER$
     13605**DCL     14132<<ASSIGN  14237>>ASSIGN  14238>>ASSIGN  14239>>ASSIGN  14449>>CALL    14517>>CALL
     15277>>CALL
PCB.WKSZ
     13468**DCL     14124<<ASSIGN
PCB.WORK$
     13447**DCL     14123<<ASSIGN
POST_ERR_4_NONAME
     14984**PROC    14942--CALL
POST_ERR_AND_ABORT IN PROCEDURE PROCESS_DIRECTIVES
     15526**LABEL   15436--CALLALT 15477--CALLALT 15505--CALLALT
PROCESS_DIRECTIVES
     15224**PROC    14336--CALL    14396--CALL    14591--CALL
PROCESS_INCLUDE IN PROCEDURE PROCESS_DIRECTIVES
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:323  
     15428**LABEL   15297--GOTO
PTR$ IN PROCEDURE OPEN_FID
     15650**DCL     15648--PROC    15658>>ASSIGN  15658>>ASSIGN  15697>>ASSIGN
READ
     14540**LABEL   14592--GOTO    14633--GOTO
READBUF
     11162**DCL     11163--REDEF   14067--ASSIGN  14073--ASSIGN  14084--ASSIGN  14125--ASSIGN  14294<<ASSIGN
     14317>>IF      14319>>CALLBLT 14321>>CALLBLT 14323>>IF      14397<<ASSIGN  14406>>IF      14418>>ASSIGN
     14422>>CALLBLT 14429<<CALLBLT 14433<<CALLBLT 14437--IF      14439--ASSIGN  14443--ASSIGN  14488>>IF
     14492>>IF      14495>>CALLBLT 14496--IF      14501--ASSIGN  14540<<ASSIGN  14556>>IF      14558>>CALLBLT
     14560>>CALLBLT 14562>>IF      14579>>IF      14603>>CALLBLT 14629--CALL    14654>>CALLBLT 15231>>IF
     15234>>CALLBLT 15273--ASSIGN  15285>>CALLBLT 15361>>CALLBLT 15445>>CALLBLT 15474<<ASSIGN  15485>>CALLBLT
     15550>>CALLBLT 15567--ASSIGN
READBUFB
     11163**DCL     14406>>IF      14579>>IF
READ_GLOBALS
     15162**PROC    14105--CALL    15032--CALL
READ_KEY
     12653**DCL     14072--ASSIGN  14806--ASSIGN
READ_KEY.KEY
     12655**DCL     14309>>IF      14552>>IF      15593>>CALLBLT
REL_PAGES
     14872**LABEL   14105--CALLALT
REL_PAGES IN PROCEDURE GLOBAL
     15143**LABEL   15032--CALLALT 15049--GOTO    15058--CALLALT 15110--CALLALT 15111--GOTO
RE_PARSE
     14510**LABEL   14531--GOTO
SAME_LINE_VFC
     12746**DCL     15615--ASSIGN
SAVE_NUM
     11179**DCL     15428<<ASSIGN  15515>>ASSIGN  15522>>ASSIGN
SAVE_SEED
     11180**DCL     15429<<ASSIGN  15509>>ASSIGN
SAVE_SUBS IN PROCEDURE GLOBAL
     15133**LABEL   15101--GOTO
SCAN_ERR
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:324  
     14277**LABEL   14235--CALLALT 14236--CALLALT
SCAN_OPT#
     11192**DCL     14149<<ASSIGN  14240<<ASSIGN  14488>>IF
SCAN_REMEM
     13989**DCL     14130--ASSIGN  14131<<REMEMBR
SEG$2.ERRBUF
     12699**DCL     14273--CALL    14281<<ASSIGN  14386--CALL    14453>>IF      14522--CALL    14523>>IF
     14616--CALL    14624--CALL    14626>>IF      14629<>CALL    14631<<ASSIGN  14666--CALL    14673--CALL
     14681--CALL    14693<>CALL    14694<<ASSIGN  14763<<ASSIGN  14841--CALL    14999--CALL    15096--CALL
     15152>>IF      15158--CALL    15279--CALL    15282>>IF      15360--CALL    15454<>CALL    15455<<ASSIGN
     15492--CALL    15494--CALL    15496<>CALL    15497<<ASSIGN  15527--CALL    15532<>CALL    15533<<ASSIGN
     15635--CALL    15698--CALL
SEG$2.FLAGS.CONTINUED
     12683**DCL     14451<<ASSIGN  14467<<ASSIGN  14986>>IF
SEG$2.FPT_READUC$
     12707**DCL     15618>>ASSIGN  15619>>CALL
SEG$2.FPT_WRITECC$
     12710**DCL     14118>>ASSIGN  14604>>ASSIGN  14606<>CALL    14655>>ASSIGN  14658<>CALL    15039>>ASSIGN
     15047>>ASSIGN  15048<>CALL    15054>>ASSIGN  15055<>CALL    15068>>ASSIGN  15071<>CALL    15286>>ASSIGN
     15289<>CALL    15306>>ASSIGN  15314>>ASSIGN  15315<>CALL    15321>>ASSIGN  15322<>CALL    15335>>ASSIGN
     15338<>CALL    15363>>ASSIGN  15366<>CALL    15449>>ASSIGN  15451<>CALL    15486>>ASSIGN  15489<>CALL
     15553>>ASSIGN  15555>>ASSIGN  15556<>CALL
SEG$2.FPT_WRITEUC$
     12708**DCL     15607>>ASSIGN  15608>>ASSIGN  15609>>ASSIGN  15610>>CALL
SEG$2.GETCMD$
     12720**DCL     14217>>ASSIGN  14619>>ASSIGN  14619>>ASSIGN  15465>>ASSIGN  15621>>ASSIGN  15717>>ASSIGN
     15718>>ASSIGN  15719>>ASSIGN  15720>>CALL    15724>>ASSIGN  15725>>ASSIGN
SEG$2.PHYS$
     12706**DCL     14238>>ASSIGN
SEG$2.PSEUDO$
     12705**DCL     14237>>ASSIGN
SEG$2.USERS$
     12703**DCL     14239>>ASSIGN
SEG2$
     10593**DCL     12674--IMP-PTR 14118>>ASSIGN  14217>>ASSIGN  14237>>ASSIGN  14238>>ASSIGN  14239>>ASSIGN
     14273>>CALL    14281>>ASSIGN  14386>>CALL    14451>>ASSIGN  14453>>IF      14467>>ASSIGN  14522>>CALL
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:325  
     14523>>IF      14604>>ASSIGN  14606>>CALL    14616>>CALL    14619>>ASSIGN  14619>>ASSIGN  14624>>CALL
     14626>>IF      14629>>CALL    14631>>ASSIGN  14655>>ASSIGN  14658>>CALL    14666>>CALL    14673>>CALL
     14681>>CALL    14693>>CALL    14694>>ASSIGN  14763>>ASSIGN  14841>>CALL    14986>>IF      14999>>CALL
     15039>>ASSIGN  15047>>ASSIGN  15048>>CALL    15054>>ASSIGN  15055>>CALL    15068>>ASSIGN  15071>>CALL
     15096>>CALL    15152>>IF      15158>>CALL    15279>>CALL    15282>>IF      15286>>ASSIGN  15289>>CALL
     15306>>ASSIGN  15314>>ASSIGN  15315>>CALL    15321>>ASSIGN  15322>>CALL    15335>>ASSIGN  15338>>CALL
     15360>>CALL    15363>>ASSIGN  15366>>CALL    15449>>ASSIGN  15451>>CALL    15454>>CALL    15455>>ASSIGN
     15465>>ASSIGN  15486>>ASSIGN  15489>>CALL    15492>>CALL    15494>>CALL    15496>>CALL    15497>>ASSIGN
     15527>>CALL    15532>>CALL    15533>>ASSIGN  15553>>ASSIGN  15555>>ASSIGN  15556>>CALL    15607>>ASSIGN
     15608>>ASSIGN  15609>>ASSIGN  15610>>CALL    15618>>ASSIGN  15619>>CALL    15621>>ASSIGN  15635>>CALL
     15698>>CALL    15717>>ASSIGN  15718>>ASSIGN  15719>>ASSIGN  15720>>CALL    15724>>ASSIGN  15725>>ASSIGN
SEG3$
     10594**DCL     12666--IMP-PTR 14872<>CALL    15133>>ASSIGN  15134>>ASSIGN  15135>>ASSIGN  15136>>ASSIGN
     15143<>CALL    15166>>ASSIGN  15168>>ASSIGN  15178<>CALL    15186>>ASSIGN  15196>>ASSIGN  15197>>ASSIGN
     15198>>ASSIGN  15199>>ASSIGN
SEG3_
     11059**DCL     15137<>CALL    15186<<ASSIGN  15191<>CALL
SEG3_.VSIZE
     11060**DCL     15187<<ASSIGN
START_INDX
     11182**DCL     14319<<CALLBLT 14323>>IF      14323>>IF      14420<<ASSIGN  14422>>CALLBLT 14424<<ASSIGN
     14558<<CALLBLT 14562>>IF      14562>>IF      15238<<CALLBLT 15240>>CALLBLT 15244>>IF      15244>>IF
     15251>>IF      15251>>IF
START_KEY
     12657**DCL     14252<<ASSIGN
START_KEY.KEY
     12659**DCL     14256<<ASSIGN  14262<<ASSIGN  14262>>ASSIGN  14309>>IF
START_LABEL
     11165**DCL     14245<<ASSIGN  14323>>IF
START_METHOD
     11176**DCL     14153<<ASSIGN  14242<<ASSIGN  14243>>DOCASE  14305>>DOCASE  14311<<ASSIGN  14315<<ASSIGN
     14325<<ASSIGN  14330>>IF      14649>>IF      14668>>IF      15258>>IF
START_NUM
     11177**DCL     14247<<CALLBLT 14313>>IF
START_READ
     14294**LABEL   14340--GOTO
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:326  
STR_INDX
     11183**DCL     14321<<CALLBLT 14323>>IF      14422<<CALLBLT 14424>>ASSIGN  14495<<CALLBLT 14496>>IF
     14560<<CALLBLT 14562>>IF      15240<<CALLBLT 15244>>IF      15251>>IF      15394--ASSIGN  15403>>ASSIGN
STUFF_GETCMD_4_ERRPTR
     15712**PROC    14608--CALL    14998--CALL    15290--CALL    15362--CALL    15453--CALL
SUB$PARAMS
     13994**DCL     14129--ASSIGN  14414<>CALL    14482<>CALL    15262<>CALL
SUB$PARAMS.BATCH_ABORTED#
     14011**DCL     14158<<ASSIGN  14632<<ASSIGN  14653<<ASSIGN  14698>>IF      14771<<ASSIGN  14843<<ASSIGN
     14878>>IF      15413<<ASSIGN  15484<<ASSIGN  15531<<ASSIGN  15558>>IF      15628<<ASSIGN  15637<<ASSIGN
     15700<<ASSIGN
SUB$PARAMS.BUF_LEN
     14006**DCL     14303<<ASSIGN  14399<<ASSIGN  14429>>CALLBLT 14433>>CALLBLT 14436<<ASSIGN  14436>>ASSIGN
     14437>>IF      14439<<ASSIGN  14444>>ASSIGN  14500>>ASSIGN  14542<<ASSIGN  14604>>ASSIGN  15274>>ASSIGN
     15449>>ASSIGN  15476<<ASSIGN  15551>>IF      15555>>ASSIGN  15562>>IF      15571>>ASSIGN
SUB$PARAMS.DEFAULT_DEF_HEAD$
     13998**DCL     14147<<ASSIGN  14818>>DOWHILE 14819>>ASSIGN  14820<<ASSIGN  14820>>ASSIGN  15307>>ASSIGN
     15348>>ASSIGN  15356<<ASSIGN  15372>>ASSIGN  15375<<ASSIGN  15382>>ASSIGN  15417<<ASSIGN
SUB$PARAMS.FPT_READ$
     14002**DCL     14087<<ASSIGN
SUB$PARAMS.FPT_WRITE$
     14003**DCL     14088<<ASSIGN
SUB$PARAMS.GLOBAL_DEF_HEAD$
     13996**DCL     15040>>ASSIGN  15085>>ASSIGN  15092<<ASSIGN  15116>>ASSIGN  15127<<ASSIGN  15135>>ASSIGN
     15170<<ASSIGN  15198<<ASSIGN
SUB$PARAMS.NO_GLOBALS#
     14012**DCL     14159<<ASSIGN  14227<<ASSIGN
SUB$PARAMS.ONLINE_DEF_HEAD$
     13995**DCL     14146<<ASSIGN  14164>>ASSIGN  14225<<ASSIGN  14813>>DOWHILE 14814>>ASSIGN  14815<<ASSIGN
     14815>>ASSIGN
SUB$PARAMS.PRINT_OPT#
     14009**DCL     14157<<ASSIGN  14231<<ASSIGN  15545>>IF
SUB$PARAMS.READBUF$
     13999**DCL     14084<<ASSIGN
SUB$PARAMS.REC_NUM
     14007**DCL     14155<<ASSIGN  14292<<ASSIGN  14304<<ASSIGN  14304>>ASSIGN  14313>>IF      14400<<ASSIGN
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:327  
     14400>>ASSIGN  14543<<ASSIGN  14543>>ASSIGN  14572>>IF      14799>>ASSIGN  15428>>ASSIGN  15522<<ASSIGN
     15600>>CALLBLT
SUB$PARAMS.SUB_MADE#
     14008**DCL     15545>>IF
SUB$PARAMS.TEMPBUF$
     14000**DCL     14085<<ASSIGN
SUB$PARAMS.TEST_OPT#
     14010**DCL     14156<<ASSIGN  14233<<ASSIGN  14350>>IF      14458>>IF      14704>>IF      15545>>IF
     15558>>IF
SUB$PARAMS.WRITEBUF$
     14001**DCL     14086<<ASSIGN
SUB$PARAMS.X$MCB$
     14004**DCL     14089<<ASSIGN
SUB$PARAMS.X$PARAM$
     14005**DCL     14090<<ASSIGN
SYM_ERR
     14272**LABEL   14224--CALLALT
SYM_ERR IN PROCEDURE PROCESS_DIRECTIVES
     15421**LABEL   15325--CALLALT
SYSID IN PROCEDURE CHK_FOLLOW_CONDITION
     14890**DCL     14899--ASSIGN
TEMP$
     11070**DCL     14167<<ASSIGN  14168>>DOCASE  14170<<ASSIGN  14170>>ASSIGN  14171>>IF      14173>>CALL
     14175>>ASSIGN  14175>>ASSIGN  14175>>ASSIGN  14178>>ASSIGN  14181>>ASSIGN  14181>>ASSIGN  14183>>CALLBLT
     14183>>CALLBLT 14187<<ASSIGN  14187>>ASSIGN  14189>>IF      14191>>CALLBLT 14191>>CALLBLT 14194<<ASSIGN
     14194>>ASSIGN  14194>>ASSIGN  14195>>IF      14197>>CALLBLT 14197>>CALLBLT 14198>>ASSIGN  14209<>CALL
     14221>>ASSIGN  14222>>ASSIGN  14223>>ASSIGN  14242>>ASSIGN  14245>>ASSIGN  14245>>ASSIGN  14247>>CALLBLT
     14247>>CALLBLT 14251<<ASSIGN  14251>>ASSIGN  14253>>IF      14255>>CALLBLT 14255>>CALLBLT 14258<<ASSIGN
     14258>>ASSIGN  14258>>ASSIGN  14259>>IF      14261>>CALLBLT 14261>>CALLBLT 14262>>ASSIGN  14272>>ASSIGN
     14369<<ASSIGN  14371>>DOCASE  14381>>CALL    14385>>ASSIGN  14989>>IF      15075<<ASSIGN  15076>>IF
     15079>>IF      15087>>DOINDEX 15088>>ASSIGN  15119<<ASSIGN  15120>>ASSIGN  15121>>ASSIGN  15122>>ASSIGN
     15342<<ASSIGN  15343>>IF      15346>>IF      15350>>DOINDEX 15351>>ASSIGN  15385<<ASSIGN  15386>>ASSIGN
     15387>>DOCASE  15389>>ASSIGN  15406>>ASSIGN
TEMP$ IN PROCEDURE CHK_FOLLOW_CONDITION
     14891**DCL     14911<<ASSIGN  14912>>DOCASE  14915>>ASSIGN  14915>>ASSIGN  14917>>ASSIGN  14921>>IF
     14923>>ASSIGN  14923>>ASSIGN  14939>>ASSIGN
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:328  
TEMPBUF
     11160**DCL     14085--ASSIGN  14418<<ASSIGN  14429>>CALLBLT 14433>>CALLBLT 15234<<CALLBLT 15238>>CALLBLT
     15240>>CALLBLT 15244>>IF      15251>>IF      15393--ASSIGN  15403<<ASSIGN  15404--ASSIGN  15618--ASSIGN
     15623>>IF      15623>>IF
TRUNCATED_RECORD
     11195**DCL     14295<<ASSIGN  14299<<ASSIGN  14338>>IF      14342>>IF      14660>>IF
U$PARAM
     13958**DCL     14126>>ASSIGN
U$PARAM.PHYS$
     13964**DCL     14238<<ASSIGN
U$PARAM.PSEUDO$
     13963**DCL     14237<<ASSIGN
U$PARAM.SPCL$$
     13962**DCL     14449<>CALL    14517<>CALL    15277<>CALL
U$PARAM.USERS$
     13960**DCL     14239<<ASSIGN
U_PARAM
     13974**DCL     14126<<ASSIGN  14132--ASSIGN
U_PARAM.CNTU$$
     13977**DCL     14127<<ASSIGN
U_PARAM.MODE
     13981**DCL     14128<<ASSIGN
U_PARAM.PARAMS$
     13985**DCL     14129<<ASSIGN
U_PARAM.REMEM$
     13986**DCL     14130<<ASSIGN
VALUE
     11178**DCL     14191<<CALLBLT 14192>>ASSIGN  14197<<CALLBLT 14198>>ASSIGN  14255<<CALLBLT 14256>>ASSIGN
     14261<<CALLBLT 14262>>ASSIGN  15601<>CALL    15602>>ASSIGN
VALUE_BUF
     11168**DCL     15593<<CALLBLT 15594>>CALLBLT
WORKSPACE
     13990**DCL     14123--ASSIGN  14124--ASSIGN
WRITE
     14535**LABEL   14131--REMEMBR 14468--GOTO    14494--GOTO    14498--GOTO    14514--GOTO
WRITEBUF
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:329  
     11159**DCL     14086--ASSIGN  14118--ASSIGN  14603<<CALLBLT 14604--ASSIGN  14654<<CALLBLT 14655--ASSIGN
     15039--ASSIGN  15046<<ASSIGN  15053<<ASSIGN  15061<<CALLBLT 15065<<CALLBLT 15285<<CALLBLT 15286--ASSIGN
     15306--ASSIGN  15313<<ASSIGN  15320<<ASSIGN  15328<<CALLBLT 15332<<CALLBLT 15361<<CALLBLT 15363--ASSIGN
     15445<<CALLBLT 15485<<CALLBLT 15486--ASSIGN  15550<<CALLBLT 15604<<CALLBLT 15607--ASSIGN  15717--ASSIGN
WRITE_BUF
     15544**PROC    14535--CALL    15477--CALL
X
     11186**DCL     14319<<CALLBLT 14558<<CALLBLT 15238<<CALLBLT
X$DEALLOCATE
     11105**DCL-ENT 14816--CALL    14821--CALL
X$MAP.LINK$
     13131**DCL     14815>>ASSIGN  14820>>ASSIGN
X$MCB
     13106**DCL     14089--ASSIGN  14224<>CALL    14816<>CALL    14821<>CALL    15058<>CALL    15091<>CALL
     15123<>CALL    15325<>CALL    15354<>CALL    15374<>CALL    15407<>CALL
X$MCB.ADDRESS$
     13106**DCL     14814<<ASSIGN  14819<<ASSIGN
X$MCB.FREE_HEAD$
     13106**DCL     15136>>ASSIGN  15169<<ASSIGN  15199<<ASSIGN
X$MCB.HI_SEGMENT$
     13106**DCL     15134>>ASSIGN  15168<<ASSIGN  15197<<ASSIGN
X$MCB.SEGMENT_BASE$
     13106**DCL     15166<<ASSIGN
X$MCB.WKSZ
     13106**DCL     15133>>ASSIGN  15167<<ASSIGN  15196<<ASSIGN
X$PARAM
     13110**DCL     14090--ASSIGN  14224<>CALL    15058<>CALL    15091<>CALL    15123<>CALL    15325<>CALL
     15354<>CALL    15374<>CALL    15407<>CALL
X$PARAM.ERR
     13117**DCL     14273<>CALL    15126<>CALL    15411<>CALL
X$PARAM.ERR.CODE
     13121**DCL     15124>>IF      15408>>IF
X$PARAM.NUM
     13115**DCL     15041<<ASSIGN  15072<<ASSIGN  15072>>ASSIGN  15308<<ASSIGN  15339<<ASSIGN  15339>>ASSIGN
X$PARAM.SRCH
     13113**DCL     14165<<ASSIGN  15042<<ASSIGN  15086<<ASSIGN  15117<<ASSIGN  15309<<ASSIGN  15349<<ASSIGN
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:330  
     15373<<ASSIGN  15383<<ASSIGN
X$PARAM.SYM_HEAD$
     13111**DCL     14164<<ASSIGN  14225>>ASSIGN  15040<<ASSIGN  15043>>IF      15085<<ASSIGN  15092>>ASSIGN
     15099>>IF      15116<<ASSIGN  15127>>ASSIGN  15307<<ASSIGN  15310>>IF      15348<<ASSIGN  15356>>ASSIGN
     15372<<ASSIGN  15382<<ASSIGN  15417>>ASSIGN
X$PARAM.TEXTC$
     13116**DCL     14221<<ASSIGN  14222<<ASSIGN  15061>>CALLBLT 15061>>CALLBLT 15061>>CALLBLT 15061>>CALLBLT
     15065>>CALLBLT 15065>>CALLBLT 15065>>CALLBLT 15065>>CALLBLT 15068>>ASSIGN  15068>>ASSIGN  15090<<ASSIGN
     15120<<ASSIGN  15121<<ASSIGN  15328>>CALLBLT 15328>>CALLBLT 15328>>CALLBLT 15328>>CALLBLT 15332>>CALLBLT
     15332>>CALLBLT 15332>>CALLBLT 15332>>CALLBLT 15335>>ASSIGN  15335>>ASSIGN  15353<<ASSIGN  15386<<ASSIGN
     15389<<ASSIGN  15404<<ASSIGN  15411>>CALL
X$PARAM.TYPE
     13114**DCL     14223<<ASSIGN  15059>>IF      15089<<ASSIGN  15122<<ASSIGN  15326>>IF      15352<<ASSIGN
     15406<<ASSIGN
X$PARSE
     11106**DCL-ENT 14452--CALL    14504--CALL    14519--CALL    15278--CALL
X$STRING.SIZ
     13127**DCL     13128--IMP-SIZ 15061>>CALLBLT 15061>>CALLBLT 15065>>CALLBLT 15065>>CALLBLT 15068>>ASSIGN
     15068>>ASSIGN  15328>>CALLBLT 15328>>CALLBLT 15332>>CALLBLT 15332>>CALLBLT 15335>>ASSIGN  15335>>ASSIGN
     15411<>CALL
X$STRING.TEXT
     13128**DCL     15061>>CALLBLT 15061>>CALLBLT 15065>>CALLBLT 15065>>CALLBLT 15328>>CALLBLT 15328>>CALLBLT
     15332>>CALLBLT 15332>>CALLBLT
X$STRIP_BLANKS
     11098**DCL-ENT 15596--CALL
XSJ$CLOSE
     11109**DCL-ENT 14953--CALL
XSJ$OPEN
     11107**DCL-ENT 14978--CALL
XSJ$READ
     11108**DCL-ENT 14938--CALL
XSJ_PARAM
     12592**DCL     14898<<ASSIGN  14938<>CALL    14953<>CALL    14978<>CALL
XSJ_PARAM.ACCT$
     12593**DCL     14925<<ASSIGN
XSJ_PARAM.BUF_
PL6.E3A0      #001=CPH$IBEX File=CPH$IBEX.:E05TSI                                TUE 07/29/97 11:45 Page:331  
     12592**DCL     14899<<ASSIGN
XSJ_PARAM.DCB#
     12595**DCL     14900<<ASSIGN  14977<<ASSIGN
XSJ_PARAM.NAME$
     12594**DCL     14919<<ASSIGN
XUG$PARAMS.BUF
     12576**DCL     12579--REDEF
XUG$PARAMS.POFF
     12222**DCL     15724<<ASSIGN
XUG$PARAMS.PROMPT
     12225**DCL     14217<<ASSIGN  15465<<ASSIGN
