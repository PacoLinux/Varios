VERSION E05

PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:1    
        1        1        /*M* KXV$VCNTW - protocol manager that interface a virtual ciruit with the */
        2        2        /*M*             network layer.                                            */
        3        3        /*T***********************************************************/
        4        4        /*T*                                                         */
        5        5        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        6        6        /*T*                                                         */
        7        7        /*T***********************************************************/
        8        8        /*X*   PLM = 4, IND=3, CTI=3, DCI=6, IAD=0, DTI=6, AND=Y, CSI=3, THI=3, STI=3, DMC=Y
                 8         */
        9        9        /*P* NAME: KXV$VCNTW                 */
       10       10        /*P* PURPOSE: This is the protocol manager which interfaces to
       11       11                      the Network layer on the higher side,
       12       12                      and to a single virtual circuit on
       13       13                      the lower side.        */
       14       14
       15       15        /*F* NAME: KXV$VCNTW                 */
       16       16        /*F* PURPOSE: This is the protocol manager which interfaces to
       17       17                      the Network layer on the higher side,
       18       18                      and to a single virtual circuit on
       19       19                      the lower side.        */
       20       20
       21       21        /*D* NAME: KXV$VCNTW                 */
       22       22        /*D* PURPOSE: This is the protocol manager which interfaces to
       23       23                      the Network layer on the higher side,
       24       24                      and to a single virtual circuit on
       25       25                      the lower side.        */
       26       26        /*D* CALL: CALL KXV$VCNTW ( FPT_X25 );  */
       27       27        /*D* INPUT: FPT_X25 - describes what actions to take.  */
       28       28        /*D* OUTPUT: none                    */
       29       29
       30       30        KXV$VCNTW: PROC ( FPT_X25 ) ALTRET;
       31       31        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:2    
       32       32        /*****************************************************************
       33       33        *                                                                *
       34       34        *                           Includes                             *
       35       35        *                                                                *
       36       36        *****************************************************************/
       37       37
       38       38        %INCLUDE K_ID_E;
       39       88        %K#ENTID_E;
       40      107        %K#LYRID_E;
       41      114        %INCLUDE KL_MACRO_C;
       42     3466        %INCLUDE KL_AFCN_C;
       43     3567        %INCLUDE LCP_6;
       44     7846        %INCLUDE CP_6_SUBS;
       45     8386        %INCLUDE G_JIT_M;
       46     8651        %INCLUDE KL_SUPER_C;
       47    11553        %INCLUDE KNH_MACRO_C;
       48    11836        %INCLUDE KH$CHN;
       49    11958        %INCLUDE KV$GLB;
       50    12377        %INCLUDE KV_GLBCNS_E;
       51    12718        %KV#CQ_HNDID_E;
       52    12723        %INCLUDE KX_EQUS_E;
       53    13162        %INCLUDE KX_PERR_C;
       54    13291        %INCLUDE KX_SCODE_C;
       55    13357        %INCLUDE KX_DATA_C;
       56    13425        %INCLUDE KX_MACROS_M;
       57    14196        %INCLUDE K_ADDRESS_M;
       58    14699        %INCLUDE K_REASON_C;
       59    14725        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:3    
       60    14726        /*****************************************************************
       61    14727        *                                                                *
       62    14728        *                           External References                  *
       63    14729        *                                                                *
       64    14730        *****************************************************************/
       65    14731
       66    14732    1   DCL KXS$Q_SYSLOG ENTRY (1);
       67    14733    1   DCL KXS$SYSLOG ENTRY (7);
       68    14734    1   DCL KXC$CQSCN ENTRY (1);
       69    14735    1   DCL KVB$GETSYS ENTRY (2) ALTRET;
       70    14736    1   DCL KVB$GET2NSYS ENTRY (2) ALTRET;
       71    14737    1   DCL KVB$RLSSYS ENTRY (2) ALTRET;
       72    14738    1   DCL KVM$SNDCQ ENTRY (1) ALTRET;
       73    14739    1   DCL KHD$SCREECH ENTRY (1);
       74    14740    1   DCL KHA$ERRLOG ENTRY (2) ALTRET;
       75    14741    1   DCL KXP$PACKET ENTRY (1) ALTRET;
       76    14742    1   DCL KXS$GETL3 ENTRY (3) ALTRET;
       77    14743        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:4    
       78    14744        /*****************************************************************
       79    14745        *                                                                *
       80    14746        *                           Local Equates                        *
       81    14747        *                                                                *
       82    14748        *****************************************************************/
       83    14749
       84    14750        /*****************************************************************
       85    14751        *                                                                *
       86    14752        *                           Actions                              *
       87    14753        *                                                                *
       88    14754        *****************************************************************/
       89    14755
       90    14756        %EQU Y_ACT_NULL#    =  0;
       91    14757        %EQU Y_ACT_SCREECH# =  1;
       92    14758        %EQU Y_ACT_INIT#    =  2;
       93    14759        %EQU Y_ACT_VCUP#    =  3;
       94    14760        %EQU Y_ACT_TERM#    =  4;
       95    14761        %EQU Y_ACT_RLS#     =  5;
       96    14762        %EQU Y_ACT_GETOTPBFR# = 6;
       97    14763        %EQU Y_ACT_INITACK# =  7;
       98    14764        %EQU Y_ACT_INITNAK# =  8;
       99    14765        %EQU Y_ACT_ZAP#     =  9;
      100    14766        %EQU Y_ACT_RLSMAYBE#= 10;
      101    14767        %EQU Y_ACT_MAX#     = 10;
      102    14768        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:5    
      103    14769        /*****************************************************************
      104    14770        *                                                                *
      105    14771        *                           Events                               *
      106    14772        *                                                                *
      107    14773        *****************************************************************/
      108    14774
      109    14775        %EQU Y_EV_DCL#    =  0;
      110    14776        %EQU Y_EV_INTACK# =  1;
      111    14777        %EQU Y_EV_VCUP#   =  2;
      112    14778        %EQU Y_EV_VCLST#  =  3;
      113    14779        %EQU Y_EV_TRMACK# =  4;
      114    14780        %EQU Y_EV_CNCRQS# =  5;
      115    14781        %EQU Y_EV_TERM#   =  6;
      116    14782        %EQU Y_EV_SP1#    =  7;
      117    14783        %EQU Y_EV_SP2#    =  8;
      118    14784        %EQU Y_EV_SP3#    =  9;
      119    14785        %EQU Y_EV_MAX#    =  9;
      120    14786        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:6    
      121    14787        /*****************************************************************
      122    14788        *                                                                *
      123    14789        *                           States                               *
      124    14790        *                                                                *
      125    14791        *****************************************************************/
      126    14792
      127    14793        %EQU Y_ST_DCL#     =  0;
      128    14794        %EQU Y_ST_INIT_WIA#=  1;
      129    14795        %EQU Y_ST_INIT_WVC#=  2;
      130    14796        %EQU Y_ST_NORMAL#  =  3;
      131    14797        %EQU Y_ST_TERM#    =  4;
      132    14798        %EQU Y_ST_TERM_WIA#=  5;
      133    14799        %EQU Y_ST_TERM_DCL#=  6;
      134    14800        %EQU Y_ST_CNC_WVC# =  7;
      135    14801        %EQU Y_ST_SP1#     =  8;
      136    14802        %EQU Y_ST_SP2#     =  9;
      137    14803        %EQU Y_ST_SP3#     = 10;
      138    14804        %EQU Y_ST_MAX#     = 10;
      139    14805        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:7    
      140    14806        /*****************************************************************
      141    14807        *                                                                *
      142    14808        *                           Auto                                 *
      143    14809        *                                                                *
      144    14810        *****************************************************************/
      145    14811
      146    14812        %FPT_X25 ( STCLASS = );
      147    14856
      148    14857    1   DCL SL$ PTR;
      149    14858    1   DCL L3$ PTR;
      150    14859    1   DCL MSG$ PTR;
      151    14860    1   DCL FPT$ PTR;
      152    14861    1   DCL EVENT UBIN;
      153    14862    1   DCL ACTION UBIN;
      154    14863    1   DCL STATE UBIN;
      155    14864    1   DCL Y$ PTR; /* For calling KVB, so PL6 can trash its memory */
      156    14865    1   DCL BYTX UBIN;
      157    14866    1   DCL KVBSIZ UBIN;
      158    14867        %FPT_X25 ( FPTN = CALL_FPT, STCLASS = );
      159    14911        %KNH$MESS ( FPTN = KNH_MESS, STCLASS = );
      160    14960        %VLP_ERRCODE(STCLASS=AUTO , FPTN=ERCOD) ;
      161    15006        %FPT_TERM ( FPTN = FPT@TERM, STCLASS = );
      162    15028        %FPT_TERM_ACK ( FPTN = FPT@TERM_ACK, STCLASS = );
      163    15050        %FPT_CONNECT ( FPTN = FPT@CONNECT, ADRTYP = NET, STCLASS = );
      164    15221        %FPT_CONNECT_ACK ( FPTN = FPT@CONNECT_ACK, STCLASS = );
      165    15270        %FPT_RESET ( FPTN = FPT@RESET, STCLASS = );
      166    15293    1   DCL CTX$ PTR;
      167    15294    1   DCL PRVCTX$ PTR;
      168    15295    1   DCL 1 KV@SNDCQ ALIGNED,
      169    15296    1         2 MSG_ (0:5),
      170    15297    1           3 ADR$ PTR,
      171    15298    1           3 BYTX UBIN WORD,
      172    15299    1           3 BYTSIZ UBIN WORD;
      173    15300    1   DCL OUTLINK$ PTR;
      174    15301    1   DCL CAL$_IS_L3$ BIT(1);
      175    15302
      176    15303        %EQU TL3CHN = %CHARTEXT('KX$TL3.CHN$->KH$CHN');
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:8    
      177    15304        %EQU L3CHN = %CHARTEXT('KX$L3.CHN$->KH$CHN');
      178    15305        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:9    
      179    15306        /*****************************************************************
      180    15307        *                                                                *
      181    15308        *                           Based                                *
      182    15309        *                                                                *
      183    15310        *****************************************************************/
      184    15311
      185    15312        %FPT_CONNECT_ACK ( FPTN = FPT$CONNECT_ACK, STCLASS = "BASED(FPT$)" );
      186    15361        %FPT_CONNECT ( FPTN = FPT$CONNECT, ADRTYP = NET, STCLASS = "BASED(FPT$)" );
      187    15532        %G$JIT ( STCLASS = "BASED(G$JIT$)" );
      188    15946        %KH$CHN;
      189    16070        %KX$SL ( STCLASS = "BASED(SL$)" );
      190    16109        %KX$L3 ( STCLASS = "BASED(L3$)" );
      191    16512        %KX$L2;
      192    16879    1   DCL B$STR CHAR(2000) BASED;
      193    16880    1   DCL INPDAT_ARY (0:4095) UBIN BYTE CALIGNED BASED (FPT_X25.V_.ADR$);
      194    16881        %VLP_SCODE ( FPTN=B$SCODE, STCLASS=BASED );
      195    16942        %FPT_RESET ( FPTN = FPT$RESET, STCLASS = "BASED(FPT$)" );
      196    16965        %KNH$MESS ( FPTN = KNH$MESS, STCLASS = BASED );
      197    17014        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:10   
      198    17015        /*****************************************************************
      199    17016        *                                                                *
      200    17017        *                           Constant                             *
      201    17018        *                                                                *
      202    17019        *****************************************************************/
      203    17020
      204    17021        /*****************************************************************
      205    17022        *                                                                *
      206    17023        *                           State table                          *
      207    17024        *                                                                *
      208    17025        *****************************************************************/
      209    17026
      210    17027    1   DCL 1 STATE_TABLE CONSTANT,
      211    17028    1         2 NEXT_STATE (0:%(%(%Y_EV_MAX# + 1) * %(%Y_ST_MAX# + 1)-1)) UBIN(8) UNAL
      212    17029    1             INIT(
      213    17030        /*
      214    17031            DCL - next state
      215    17032               DCL is the initial state when context is allocated.  The
      216    17033               only valid transition out is on event DCL, which states that
      217    17034               a VC has been associated with this Network Connection.
      218    17035        */
      219    17036    1   %Y_ST_INIT_WIA#,%Y_ST_DCL#*4,%Y_ST_CNC_WVC#,%Y_ST_DCL#*4,
      220    17037        /*
      221    17038            INIT_WIA - next state
      222    17039               INIT_WIA is the state after sending an INIT to the Network
      223    17040               layer, but before receiving an INITACK.
      224    17041        */
      225    17042    1   %Y_ST_INIT_WIA#,%Y_ST_INIT_WVC#,%Y_ST_INIT_WIA#,
      226    17043    1   %Y_ST_TERM_WIA#,%Y_ST_INIT_WIA#*6,
      227    17044        /*
      228    17045            INIT_WVC - next state
      229    17046               INIT_WVC is the state for connection pending - the VC
      230    17047               is in the establishment phase, but has not completed it yet.
      231    17048        */
      232    17049    1   %Y_ST_INIT_WVC#*2,%Y_ST_NORMAL#,
      233    17050    1   %Y_ST_TERM#,%Y_ST_INIT_WVC#*6,
      234    17051        /*
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:11   
      235    17052            NORMAL - next state
      236    17053               NORMAL is the data transfer state.
      237    17054        */
      238    17055    1   %Y_ST_NORMAL#*3,%Y_ST_TERM#,%Y_ST_NORMAL#*6,
      239    17056        /*
      240    17057            TERM - next state
      241    17058               TERM means that a TERM has been sent to the Network layer,
      242    17059               but the TERM_ACK has not yet been received.
      243    17060        */
      244    17061    1   %Y_ST_TERM_DCL#,%Y_ST_TERM#*3,%Y_ST_DCL#,%Y_ST_TERM#*5,
      245    17062        /*
      246    17063            TERM_WIA - next state
      247    17064               TERM_WIA means that the circuit is cleared while we are waiting
      248    17065               for the INIT_ACK from the network layer.
      249    17066        */
      250    17067    1   %Y_ST_INIT_WIA#,%Y_ST_TERM#,%Y_ST_TERM_WIA#*8,
      251    17068        /*
      252    17069            TERM_DCL - next state
      253    17070               TERM_DCL means that a TERM is in progress with the Network
      254    17071               layer, but once it is complete an INIT will be started
      255    17072               since the VC is attempting to reconnect.
      256    17073        */
      257    17074    1   %Y_ST_TERM_DCL#*3,%Y_ST_TERM#,%Y_ST_INIT_WIA#,%Y_ST_TERM_DCL#*5,
      258    17075        /*
      259    17076            CNC_WVC - next state
      260    17077               CNC_WVC means an INIT was received and a VC establishment is in
      261    17078               progress.
      262    17079        */
      263    17080    1   %Y_ST_CNC_WVC#*2,%Y_ST_NORMAL#,%Y_ST_CNC_WVC#*7,
      264    17081        /*
      265    17082            SP1 - next state
      266    17083               SP1 - spare state
      267    17084        */
      268    17085    1   %Y_ST_SP1#*10,
      269    17086        /*
      270    17087            SP2 - next state
      271    17088               SP2 - spare state
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:12   
      272    17089        */
      273    17090    1   %Y_ST_SP2#*10,
      274    17091        /*
      275    17092            SP3 - next state
      276    17093               SP3 - spare state
      277    17094        */
      278    17095    1   %Y_ST_SP3#*10 ),
      279    17096        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:13   
      280    17097    1         2 ACTION (0:%(%(%Y_EV_MAX# + 1) * %(%Y_ST_MAX# + 1)-1)) UBIN(8) UNAL
      281    17098    1             INIT(
      282    17099        /*
      283    17100            DCL - actions
      284    17101        */
      285    17102    1   %Y_ACT_INIT#,%Y_ACT_SCREECH#*2,%Y_ACT_RLS#,%Y_ACT_SCREECH#,
      286    17103    1   %Y_ACT_VCUP#,%Y_ACT_SCREECH#*4,
      287    17104        /*
      288    17105            INIT_WIA - actions
      289    17106        */
      290    17107    1   %Y_ACT_SCREECH#,%Y_ACT_VCUP#,%Y_ACT_SCREECH#,
      291    17108    1   %Y_ACT_RLSMAYBE#,%Y_ACT_SCREECH#,%Y_ACT_VCUP#,%Y_ACT_SCREECH#*4,
      292    17109        /*
      293    17110            INIT_WVC - actions
      294    17111        */
      295    17112    1   %Y_ACT_VCUP#,%Y_ACT_SCREECH#,%Y_ACT_GETOTPBFR#,%Y_ACT_TERM#,
      296    17113    1   %Y_ACT_SCREECH#*2,%Y_ACT_ZAP#,%Y_ACT_SCREECH#*3,
      297    17114        /*
      298    17115            NORMAL - actions
      299    17116        */
      300    17117    1   %Y_ACT_SCREECH#*3,%Y_ACT_TERM#,%Y_ACT_SCREECH#*2,
      301    17118    1   %Y_ACT_ZAP#,%Y_ACT_SCREECH#*3,
      302    17119        /*
      303    17120            TERM - actions
      304    17121        */
      305    17122    1   %Y_ACT_NULL#,%Y_ACT_SCREECH#*2,%Y_ACT_NULL#,%Y_ACT_RLS#,
      306    17123    1   %Y_ACT_SCREECH#,%Y_ACT_NULL#,%Y_ACT_SCREECH#*3,
      307    17124        /*
      308    17125            TERM_WIA - actions
      309    17126        */
      310    17127    1   %Y_ACT_NULL#,%Y_ACT_TERM#,%Y_ACT_SCREECH#,%Y_ACT_NULL#,%Y_ACT_SCREECH#*2,
      311    17128    1   %Y_ACT_SCREECH#*4,
      312    17129        /*
      313    17130            TERM_DCL - actions
      314    17131        */
      315    17132    1   %Y_ACT_SCREECH#*3,%Y_ACT_NULL#,%Y_ACT_INIT#,
      316    17133    1   %Y_ACT_SCREECH#,%Y_ACT_NULL#,%Y_ACT_SCREECH#*3,
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:14   
      317    17134        /*
      318    17135            CNC_WVC - actions
      319    17136        */
      320    17137    1   %Y_ACT_VCUP#,%Y_ACT_SCREECH#,%Y_ACT_INITACK#,%Y_ACT_INITNAK#,%Y_ACT_SCREECH#*6,
      321    17138        /*
      322    17139            SP1, SP2, SP3 - actions
      323    17140        */
      324    17141    1   %Y_ACT_SCREECH#*30 );
      325    17142        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:15   
      326    17143        /*****************************************************************
      327    17144        *                                                                *
      328    17145        *                           VLP_ERRCODEs                         *
      329    17146        *                                                                *
      330    17147        *****************************************************************/
      331    17148
      332    17149        %VLP_ERRCODE (STCLASS=CONSTANT,FCG='KX',MID='V',SEV=%G_WRSYSLOG_SEV_INFO#,
      333    17150                           FPTN = Y_SHR_PKT,
      334    17151                           ERR# = %E_KXV_SHRPKT# );
      335    17197        /*E*   ERROR:      KXV-E_KXV_SHRPKT#-0
      336    17198               MESSAGE:    SL received packet < 3 bytes long.
      337    17199        */
      338    17200        %VLP_ERRCODE (STCLASS=CONSTANT,FCG='KX',MID='V',SEV=%G_WRSYSLOG_SEV_INFO#,
      339    17201                           FPTN = Y_UNB_PKT,
      340    17202                           ERR# = %E_KXV_UNBPKT# );
      341    17248        /*E*   ERROR:      KXV-E_KXV_UNBPKT#-0
      342    17249               MESSAGE:    SL received packet that didn't balance in length.
      343    17250        */
      344    17251
      345    17252        %VLP_SCODE (FPTN=Y_NO_MEM,STCLASS=CONSTANT,FCG=KX,MID=V,ERR#=%S$KX_NO_MEM#);
      346    17313        %VLP_SCODE (FPTN=Y_UNKEVT,STCLASS=CONSTANT,FCG=KX,MID=V,ERR#=%S$KX_SL_UNKEVT#);
      347    17374        %VLP_SCODE (FPTN=Y_ACTSCR,STCLASS=CONSTANT,FCG=KX,MID=V,ERR#=%S$KX_SL_ACTSCR#);
      348    17435        %VLP_SCODE (FPTN=Y_BADSLLIST,STCLASS=CONSTANT,FCG=KX,MID=V,ERR#=%S$KX_BADSLLIST#);
      349    17496        %VLP_SCODE (FPTN=Y_BADPRM,STCLASS=CONSTANT,FCG=KX,MID=V,ERR#=%S$KX_SL_BADPRM#);
      350    17557        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:16   
      351    17558        /*****************************************************************
      352    17559        *                                                                *
      353    17560        *                           Generic constant                     *
      354    17561        *                                                                *
      355    17562        *****************************************************************/
      356    17563
      357    17564        %FPT_TERM ( FPTN = FPT_TERM_C, STCLASS = "CONSTANT SYMDEF" );
      358    17586        %FPT_CONNECT ( FPTN = FPT_CONNECT_C, STCLASS = "CONSTANT SYMDEF",
      359    17587                       TYPE = LINK, ADRTYP = NET );
      360    17758        %KX$SL (FPTN = KX_SL, STCLASS = CONSTANT);
      361    17797    1   DCL KH_NODE# UBIN SYMREF ;
      362    17798        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:17   
      363    17799        /*****************************************************************
      364    17800        *                                                                *
      365    17801        *                           Static                               *
      366    17802        *                                                                *
      367    17803        *****************************************************************/
      368    17804
      369    17805    1   DCL G$JIT$ PTR SYMREF;
      370    17806        %KX_DATA;
      371    18496        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:18   
      372    18497        /*****************************************************************
      373    18498        *                                                                *
      374    18499        *                           Procedure                            *
      375    18500        *                                                                *
      376    18501        *****************************************************************/
      377    18502    1       KV@SNDCQ = '0'B;
      378    18503    1       KNH_MESS = '0'B;
      379    18504    1       KV@SNDCQ.MSG_.ADR$ (0) = ADDR ( KNH_MESS );
      380    18505    1       KV@SNDCQ.MSG_.BYTSIZ (0) = (LENGTHC ( KNH_MESS ) + 3)/4*4;
      381    18506    1       IF FPT_X25.EVN = %KX_CM_EV_CNCRQS#
      382    18507    1          THEN
      383    18508    2             DO;
      384    18509    2                OUTLINK$ = FPT_X25.RCV$;
      385    18510    2                FPT_X25.RCV$ = ADDR(NIL);
      386    18511    2             END;
      387    18512
      388    18513    1       SL$ = FPT_X25.RCV$;
      389    18514    1       L3$ = FPT_X25.CAL$;
      390    18515    1       FPT$ = FPT_X25.PRM1$;
      391    18516    1       MSG$ = FPT_X25.V_.ADR$;
      392    18517    1       IF L3$ = ADDR(NIL) AND SL$ ~= ADDR(NIL)
      393    18518    1          THEN
      394    18519    1             L3$ = KX$SL.L3$;
      395    18520
      396    18521    1       IF SL$ = ADDR(NIL)
      397    18522    1          THEN
      398    18523    2             DO;
      399    18524    2                IF ( FPT_X25.EVN ~= %KX_CM_EV_DCL# AND
      400    18525    2                   FPT_X25.EVN ~= %KX_CM_EV_RMTDCL# OR L3$ = ADDR(NIL) )
      401    18526    2                   AND FPT_X25.EVN ~= %KX_CM_EV_CNCRQS#
      402    18527    2                   THEN
      403    18528        /*S* SCREECH_CODE: KXV-S$KX_SL_BADPRM#
      404    18529             MESSAGE: KXV received a call with bad parameters.
      405    18530        */
      406    18531    2                      CALL KHD$SCREECH ( Y_BADPRM );
      407    18532    2                CALL KVB$GETSYS (SIZEW(KX$SL),Y$) ALTRET ( SCR_NOMEM );
      408    18533        /*
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:19   
      409    18534            return the SL$ to the calling L3.
      410    18535        */
      411    18536    2                SL$ = Y$;
      412    18537    2                FPT_X25.RCV$ = SL$;
      413    18538    2                KX$SL = KX_SL;
      414    18539        /*    put this SL$ into the linked list KX_SLLIST.
      415    18540        */
      416    18541    2                IF KX_SLLIST.HD$ = ADDR(NIL)
      417    18542    2                   THEN
      418    18543    2                      KX_SLLIST.HD$ = SL$;
      419    18544    2                   ELSE
      420    18545    2                      KX_SLLIST.TL$ -> KX$SL.LNK$ = SL$;
      421    18546    2                KX$SL.LNK$ = ADDR(NIL);
      422    18547    2                KX_SLLIST.TL$ = SL$;
      423    18548        /*    initialize this context  */
      424    18549    2                IF L3$ ~= ADDR(NIL)
      425    18550    2                   THEN
      426    18551    3                      DO;
      427    18552    3                         KX$L3.CM$ = SL$;
      428    18553    3                         KX$SL.LCLNOD = KH_NODE#;
      429    18554    3                         IF FPT_X25.EVN = %KX_CM_EV_RMTDCL#
      430    18555    3                            THEN
      431    18556    4                               DO;
      432    18557    4                                  KX$L3.TYP = %KX_VC_TYP_INBOUND#;
      433    18558    4                                  IF FPT_X25.V_.BYTSIZ > 0
      434    18559    4                                     THEN
      435    18560    4                                        KX$L3.NOD =
      436    18561    4                                           INPDAT_ARY ( FPT_X25.V_.BYTX + 1 );
      437    18562    4                               END;
      438    18563    3                         KX$SL.RMTNOD = KX$L3.NOD;
      439    18564    3                         KX$SL.L3$ = L3$;
      440    18565    3                         FPT_X25.PRM1 = %KX_L3_TOACT_RSTRTR#;
      441    18566    3                      END;
      442    18567    2                   ELSE
      443    18568    3                      DO;
      444    18569        /*    this must be a CNCRQS.    */
      445    18570    3                         KX$SL.LDCTX = FPT_X25.PRM1;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:20   
      446    18571    3                         IF FPT_X25.V_.BYTSIZ > 0
      447    18572    3                            THEN
      448    18573    4                               DO;
      449    18574    4                                  CALL Y$COPY ALTRET ( SCR_NOMEM );
      450    18575    4                                  KX$SL.CALUSRDAT$ = Y$;
      451    18576    4                                  KX$SL.CALUSRDATBYTSIZ = FPT_X25.V_.BYTSIZ;
      452    18577    4                               END;
      453    18578        /*   get and initialize a L3 context  */
      454    18579    3                         CALL Y$GETL3 ( OUTLINK$, 0 ) WHENALTRETURN
      455    18580    4                               DO;
      456    18581    4                                  FPT@CONNECT_ACK.REASON = %K_REASON_NOLDCT;
      457    18582    4                                  GOTO SND_INITRSP;
      458    18583    4                               END;
      459    18584    3                      END;
      460    18585    2             END;
      461    18586
      462    18587    1       CALL_FPT = '0'B;
      463    18588    1       CALL_FPT.CAL$ = SL$;
      464    18589    1       CALL_FPT.RCV$ = L3$;
      465    18590        /*
      466    18591            initialize structures used to send CQ messages.
      467    18592        */
      468    18593    1       KNH_MESS.LDCTX = KX$SL.LDCTX;
      469    18594    1       KNH_MESS.UID$ = SL$;
      470    18595    1       KNH_MESS.UIDX.CQ_HNDID = %KV#CQ_HNDID_SL;
      471    18596
      472    18597    1       IF FPT_X25.EVN = %KX_CM_EV_CHKSCQ#
      473    18598    1          THEN
      474    18599    2             DO;
      475    18600        /*
      476    18601           This call from KXS$TMR every second gives us the opportunity to retry
      477    18602           any CQ messages that failed to make it in the SCQ.
      478    18603        */
      479    18604    3                DO WHILE ( SL$ ~= ADDR(NIL) );
      480    18605    3                   KNH_MESS.LDCTX = KX$SL.LDCTX;
      481    18606    3                   KNH_MESS.UID$ = SL$;
      482    18607    3                   KNH_MESS.UIDX.CQ_HNDID = %KV#CQ_HNDID_SL;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:21   
      483    18608    3                   IF KX$SL.SNDINT_ALTRET AND NOT KX$SL.REDIRECT
      484    18609    3                      THEN
      485    18610    3                         GOTO SND_INIT;
      486    18611    3                   IF KX$SL.SNDTRM_ALTRET AND NOT KX$SL.REDIRECT
      487    18612    3                      THEN
      488    18613    3                         GOTO SND_TERM;
      489    18614    3                   IF KX$SL.SNDINTACK_ALTRET AND NOT KX$SL.REDIRECT
      490    18615    3                      THEN
      491    18616    3                         GOTO SND_INITACK;
      492    18617    3                   IF KX$SL.SNDINTNAK_ALTRET AND NOT KX$SL.REDIRECT
      493    18618    3                      THEN
      494    18619    3                         GOTO SND_INITNAK;
      495    18620    3                   SL$ = KX$SL.LNK$;
      496    18621    3                END;
      497    18622    2                SL$ = KX_SLLIST.HD$;
      498    18623    2                CALL_FPT.EVN = %KX_P_EV_REDRQS#;
      499    18624    3                DO WHILE ( SL$ ~= ADDR(NIL) );
      500    18625    3                   IF KX$SL.SNDDAT_ALTRET AND KX$SL.STATE = %Y_ST_NORMAL#
      501    18626    3                      THEN
      502    18627    4                         DO;
      503    18628    4                            CALL_FPT.CAL$ = SL$;
      504    18629    4                            CALL_FPT.RCV$ = KX$SL.L3$;
      505    18630    4                            CALL Y$CAL_KXP;
      506    18631    4                         END;
      507    18632    3                   SL$ = KX$SL.LNK$;
      508    18633    3                END;
      509    18634    2                RETURN;
      510    18635    2             END;   /* if evn = chkscq */
      511    18636
      512    18637    1       IF KX$SL.REDIRECT
      513    18638    1          THEN
      514    18639    2             DO;
      515    18640        /*
      516    18641           What we do for redirected circuits are usually passing the same event
      517    18642           to the other circuit.
      518    18643        */
      519    18644    2                CALL_FPT = FPT_X25;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:22   
      520    18645    2                IF FPT_X25.CAL$ = KX$SL.L3$
      521    18646    2                   THEN
      522    18647    3                      DO;
      523    18648    3                         CAL$_IS_L3$ = '1'B;
      524    18649    3                         CALL_FPT.RCV$ = KX$SL.SCN_L3$;
      525    18650    3                      END;
      526    18651    2                   ELSE
      527    18652    3                      DO;
      528    18653    3                         CAL$_IS_L3$ = '0'B;
      529    18654    3                         CALL_FPT.RCV$ = KX$SL.L3$;
      530    18655    3                      END;
      531    18656    2                CALL_FPT.CAL$ = SL$;
      532    18657    3                DO CASE ( FPT_X25.EVN );
      533    18658
      534    18659    3                   CASE ( %KX_CM_EV_VCUP# );
      535    18660
      536    18661    3                      CALL_FPT.EVN = %KX_P_EV_VCUP#;
      537    18662
      538    18663    3                   CASE ( %KX_CM_EV_VCLST#, %KX_CM_EV_VCLST_PRM# );
      539    18664
      540    18665    3                      CALL_FPT.EVN = %KX_P_EV_VCLST#;
      541    18666
      542    18667    3                   CASE ( %KX_CM_EV_VCDWN# );
      543    18668
      544    18669    3                      CALL_FPT.EVN = %KX_P_EV_VCDWN#;
      545    18670
      546    18671    3                   CASE ( %KX_CM_EV_DATA_TO#, %KX_CM_EV_INTACK#, %KX_CM_EV_INTNAK# );
      547    18672
      548    18673    3                      RETURN;
      549    18674
      550    18675    3                   CASE ( %KX_CM_EV_DATRQS# );
      551    18676
      552    18677    3                      CALL_FPT.EVN = %KX_P_EV_REDRQS#;
      553    18678    3                      IF CAL$_IS_L3$
      554    18679    3                         THEN
      555    18680    4                            DO;
      556    18681    4                               IF KX$SL.INPDAT_ = '0'B
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:23   
      557    18682    4                                  THEN
      558    18683    4                                     RETURN;
      559    18684    4                               KX$SL.INPDAT_STAGE = KX$SL.INPDAT_STAGE + 1;
      560    18685    4                               IF KX$SL.INPDAT_STAGE = 1
      561    18686    4                                  THEN
      562    18687    5                                     DO;
      563    18688    5                                        FPT_X25.V_ = KX$SL.INPDAT_;
      564    18689    5                                        RETURN;
      565    18690    5                                     END;
      566    18691    4                                  ELSE
      567    18692    5                                     DO;
      568    18693    5                                        IF KX$SL.INPDAT_ALTRET
      569    18694    5                                           THEN
      570    18695    6                                              DO;
      571    18696    6                                                 KX$SL.INPDAT_ALTRET = '0'B;
      572    18697    6                                                 CALL Y$CAL_KXP;
      573    18698    6                                              END;
      574    18699    5                                           ELSE
      575    18700    6                                              DO;
      576    18701    6                                                 KX$SL.INPDAT_ = '0'B;
      577    18702    6                                                 KX$SL.INPDAT_STAGE = 0;
      578    18703    6                                              END;
      579    18704    5                                     END;
      580    18705    4                            END;
      581    18706    3                         ELSE   /* cal$ is not L3$ */
      582    18707    4                            DO;
      583    18708    4                               IF KX$SL.SCN_INPDAT_ = '0'B
      584    18709    4                                  THEN
      585    18710    4                                     RETURN;
      586    18711    4                               KX$SL.SCN_INPDAT_STAGE = KX$SL.SCN_INPDAT_STAGE + 1;
      587    18712    4                               IF KX$SL.SCN_INPDAT_STAGE = 1
      588    18713    4                                  THEN
      589    18714    5                                     DO;
      590    18715    5                                        FPT_X25.V_ = KX$SL.SCN_INPDAT_;
      591    18716    5                                        RETURN;
      592    18717    5                                     END;
      593    18718    4                                  ELSE   /* scn_inpdat_stage is 2 */
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:24   
      594    18719    5                                     DO;
      595    18720    5                                        IF KX$SL.SCN_INPDAT_ALTRET
      596    18721    5                                           THEN
      597    18722    6                                              DO;
      598    18723    6                                                 KX$SL.SCN_INPDAT_ALTRET = '0'B;
      599    18724    6                                                 CALL Y$CAL_KXP;
      600    18725    6                                              END;
      601    18726    5                                           ELSE
      602    18727    6                                              DO;
      603    18728    6                                                 KX$SL.SCN_INPDAT_ = '0'B;
      604    18729    6                                                 KX$SL.SCN_INPDAT_STAGE = 0;
      605    18730    6                                              END;
      606    18731    5                                     END;
      607    18732    4                            END;
      608    18733    3                      RETURN;
      609    18734
      610    18735    3                   CASE ( %KX_CM_EV_DATIN# );
      611    18736
      612    18737    3                      CALL_FPT.EVN = %KX_P_EV_DATAVL#;
      613    18738    3                      IF CAL$_IS_L3$
      614    18739    3                         THEN
      615    18740    4                            DO;
      616    18741    4                               IF FPT_X25.V_ = KX$SL.INPDAT_
      617    18742    4                                  THEN
      618    18743    5                                     DO;
      619    18744    5                                        KX$SL.INPDAT_ = '0'B;
      620    18745    5                                        KX$SL.INPDAT_STAGE = 0;
      621    18746    5                                        RETURN;
      622    18747    5                                     END;
      623    18748    4                               KX$SL.INPDAT_ = FPT_X25.V_;
      624    18749    4                               KX$SL.INPDAT_STAGE = 0;
      625    18750    4                               CALL Y$CAL_KXP;
      626    18751    4                               IF KX$SL.INPDAT_STAGE > 0 OR KX$SL.INPDAT_.ADR$ ~= ADDR(
             18751                                        NIL)
      627    18752    4                                  THEN
      628    18753    5                                     DO;
      629    18754    5                                        KX$SL.INPDAT_ALTRET = '1'B;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:25   
      630    18755    5                                        ALTRETURN;
      631    18756    5                                     END;
      632    18757    4                            END;
      633    18758    3                         ELSE
      634    18759    4                            DO;
      635    18760    4                               IF FPT_X25.V_ = KX$SL.SCN_INPDAT_
      636    18761    4                                  THEN
      637    18762    5                                     DO;
      638    18763    5                                        KX$SL.SCN_INPDAT_ = '0'B;
      639    18764    5                                        KX$SL.SCN_INPDAT_STAGE = 0;
      640    18765    5                                        RETURN;
      641    18766    5                                     END;
      642    18767    4                               KX$SL.SCN_INPDAT_ = FPT_X25.V_;
      643    18768    4                               KX$SL.SCN_INPDAT_STAGE = 0;
      644    18769    4                               CALL Y$CAL_KXP;
      645    18770    4                               IF KX$SL.SCN_INPDAT_STAGE > 0 OR KX$SL.SCN_INPDAT_.ADR$
             18770                                        ~= ADDR(NIL)
      646    18771    4                                  THEN
      647    18772    5                                     DO;
      648    18773    5                                        KX$SL.SCN_INPDAT_ALTRET = '1'B;
      649    18774    5                                        ALTRETURN;
      650    18775    5                                     END;
      651    18776    4                            END;
      652    18777    3                      RETURN;
      653    18778
      654    18779    3                   CASE ( %KX_CM_EV_VCRST#, %KX_CM_EV_RSTIND# );
      655    18780
      656    18781    3                      IF CAL$_IS_L3$
      657    18782    3                         THEN
      658    18783    4                            DO;
      659    18784    4                               IF KX$SL.L3_RSTPND
      660    18785    4                                  THEN
      661    18786    5                                     DO;
      662    18787    5                                        KX$SL.L3_RSTPND = '0'B;
      663    18788    5                                        RETURN;
      664    18789    5                                     END;
      665    18790    4                                  ELSE
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:26   
      666    18791    4                                     KX$SL.L3_RSTPND = '1'B;
      667    18792    4                            END;
      668    18793    3                         ELSE
      669    18794    4                            DO;
      670    18795    4                               IF KX$SL.SCN_L3_RSTPND
      671    18796    4                                  THEN
      672    18797    5                                     DO;
      673    18798    5                                        KX$SL.SCN_L3_RSTPND = '0'B;
      674    18799    5                                        RETURN;
      675    18800    5                                     END;
      676    18801    4                                  ELSE
      677    18802    4                                     KX$SL.SCN_L3_RSTPND = '1'B;
      678    18803    4                            END;
      679    18804    3                      CALL_FPT.EVN = %KX_P_EV_VCRST#;
      680    18805
      681    18806    3                   CASE ( %KX_CM_EV_INT# );
      682    18807
      683    18808    3                      CALL_FPT.EVN = %KX_P_EV_SNDINT#;
      684    18809
      685    18810    3                   CASE ( %KX_CM_EV_RLSL3# );
      686    18811
      687    18812    3                      IF CAL$_IS_L3$
      688    18813    3                         THEN
      689    18814    3                            KX$SL.L3$ = ADDR(NIL);
      690    18815    3                         ELSE
      691    18816    3                            KX$SL.SCN_L3$ = ADDR(NIL);
      692    18817    3                      IF KX$SL.L3$ = ADDR(NIL) AND KX$SL.SCN_L3$ = ADDR(NIL)
      693    18818    3                         THEN
      694    18819    3                            GOTO RLS_SL;
      695    18820    3                         ELSE
      696    18821    3                            RETURN;
      697    18822
      698    18823    3                   CASE ( ELSE );
      699    18824
      700    18825    3                      GOTO L_SCR;
      701    18826
      702    18827    3                END;   /* do case ( evn ) */
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:27   
      703    18828
      704    18829    2                CALL Y$CAL_KXP;
      705    18830    2                RETURN;
      706    18831
      707    18832    2             END;  /* if redirect */
      708    18833        /*
      709    18834                                             Do case on the external event to
      710    18835                                             convert it to an internal event.
      711    18836        */
      712    18837    2       DO CASE ( FPT_X25.EVN );
      713    18838
      714    18839    2          CASE ( %KX_CM_EV_CNCRQS# );
      715    18840
      716    18841    2             EVENT = %Y_EV_CNCRQS#;
      717    18842
      718    18843    2          CASE ( %KX_CM_EV_DSCRQS# );
      719    18844
      720    18845    2             IF KX$SL.START_RCQ$ ~= ADDR(NIL)
      721    18846    2                THEN
      722    18847    2                   ALTRETURN;
      723    18848    2             EVENT = %Y_EV_TERM#;
      724    18849    2             KX$SL.RPRDAT = '1'B;
      725    18850
      726    18851    2          CASE ( %KX_CM_EV_INITACK# );
      727    18852
      728    18853    2             IF FPT$CONNECT_ACK.REASON = %K_REASON_NORMAL
      729    18854    2                THEN
      730    18855    3                   DO;
      731    18856        /*
      732    18857           Save the LDCTX from the FPT.
      733    18858        */
      734    18859    3                      KX$SL.LDCTX = FPT_X25.PRM1;
      735    18860    3                      KNH_MESS.LDCTX = FPT_X25.PRM1;
      736    18861    3                      EVENT = %Y_EV_INTACK#;
      737    18862    3                      IF FPT_X25.V_.ADR$ ~= ADDR(NIL)
      738    18863    3                         THEN
      739    18864    4                            DO;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:28   
      740    18865    4                               CALL Y$COPY ALTRET ( SCR_NOMEM );
      741    18866    4                               IF KX$SL.L3$->%L3CHN.TERMID.LEV = %
             18866                                        TERMINAL_ID_LEV_SUBCHAN#
      742    18867    4                                  THEN
      743    18868    5                                     DO;
      744    18869    5                                        KX$SL.CALUSRDAT$ = Y$;
      745    18870    5                                        KX$SL.CALUSRDATBYTSIZ = FPT_X25.V_.BYTSIZ;
      746    18871    5                                     END;
      747    18872    4                                  ELSE
      748    18873    5                                     DO;
      749    18874    5                                        KX$SL.CALRSPDATBYTSIZ = FPT_X25.V_.BYTSIZ;
      750    18875    5                                        KX$SL.CALRSPDAT$ = Y$;
      751    18876    5                                     END;
      752    18877    4                            END;
      753    18878    3                   END;
      754    18879    2                ELSE
      755    18880    3                   DO;
      756    18881    3                      IF FPT$CONNECT_ACK.REASON ~= %K_REASON_REDIRECT
      757    18882    3                         THEN
      758    18883    4                            DO;
      759    18884    4   CLR_VC:                     CALL_FPT.EVN = %KX_P_EV_VCLST#;
      760    18885    4                               CALL_FPT.PRM1 = %KX_DIAG_TMPROUTE#;
      761    18886    4                               KX$SL.STATE = %Y_ST_DCL#;
      762    18887    4                               CALL Y$CAL_KXP;
      763    18888    4                               RETURN;
      764    18889        /*   release of SL context will be done when L3 reports back a VCLST   */
      765    18890    4                            END;
      766    18891    3                         ELSE
      767    18892    4                            DO;
      768    18893        /*
      769    18894           We are to redirect this call on a new link. Start by getting a L3 context.
      770    18895        */
      771    18896    4                               CALL Y$GETL3 ( FPT$CONNECT_ACK.OUTLINK$, 1 )
      772    18897    4                                  ALTRET ( CLR_VC );
      773    18898    4                               KX$SL.REDIRECT = '1'B;
      774    18899    4                               CALL_FPT.RCV$ = L3$;
      775    18900    4                               EVENT = %Y_EV_INTACK#;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:29   
      776    18901    4                            END;
      777    18902    3                   END;
      778    18903
      779    18904    2          CASE (%KX_CM_EV_VCUP#);
      780    18905        /*
      781    18906           A VC has established the call and is ready to transfer data.
      782    18907        */
      783    18908    2             EVENT = %Y_EV_VCUP#;
      784    18909    2             IF FPT_X25.V_.BYTSIZ > 0
      785    18910    2                THEN
      786    18911    3                   DO;
      787    18912    3                      CALL Y$COPY ALTRET ( SCR_NOMEM );
      788    18913    3                      KX$SL.CALRSPDAT$ = Y$;
      789    18914    3                      KX$SL.CALRSPDATBYTSIZ = FPT_X25.V_.BYTSIZ;
      790    18915    3                   END;
      791    18916
      792    18917    2          CASE ( %KX_CM_EV_VCLST#, %KX_CM_EV_VCLST_PRM# );
      793    18918        /*
      794    18919           A VC has been permanently severed.
      795    18920        */
      796    18921    2             EVENT = %Y_EV_VCLST#;
      797    18922    2             IF FPT_X25.V_.BYTSIZ > 0
      798    18923    2                THEN
      799    18924    3                   DO;
      800    18925    3                      CALL Y$COPY ALTRET ( SCR_NOMEM );
      801    18926    3                      KX$SL.CLRDAT$ = Y$;
      802    18927    3                      KX$SL.CLRDATBYTSIZ = FPT_X25.V_.BYTSIZ;
      803    18928    3                   END;
      804    18929    2             KX$SL.RPRDAT = '1'B;
      805    18930
      806    18931    2          CASE ( %KX_CM_EV_TERMACK# );
      807    18932
      808    18933    2             IF KX$SL.START_RCQ$ ~= ADDR(NIL)
      809    18934    2                THEN
      810    18935    2                   ALTRETURN;
      811    18936    2             EVENT = %Y_EV_TRMACK#;
      812    18937
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:30   
      813    18938    2          CASE ( %KX_CM_EV_DCL#, %KX_CM_EV_RMTDCL# );
      814    18939
      815    18940    2             EVENT = %Y_EV_DCL#;
      816    18941    2             IF FPT_X25.V_.BYTSIZ > 0 AND KX$SL.RMTNOD > 200
      817    18942    2                THEN
      818    18943    3                   DO;
      819    18944    3                      CALL Y$COPY ALTRET ( CLR_VC );
      820    18945    3                      KX$SL.CALUSRDATBYTSIZ = FPT_X25.V_.BYTSIZ;
      821    18946    3                      KX$SL.CALUSRDAT$ = Y$;
      822    18947    3                   END;
      823    18948
      824    18949    2          CASE ( %KX_CM_EV_VCDWN# );
      825    18950
      826    18951    2             IF KX$SL.STATE = %Y_ST_INIT_WVC# OR KX$SL.STATE = %Y_ST_CNC_WVC#
      827    18952    2                THEN
      828    18953    2                   RETURN;
      829    18954    2                ELSE
      830    18955    2                   EVENT = %Y_EV_VCLST#;
      831    18956
      832    18957    2          CASE ( %KX_CM_EV_DATA_TO# );
      833    18958
      834    18959    2             RETURN;
      835    18960
      836    18961    2          CASE ( %KX_CM_EV_CQSCN_XIT# );
      837    18962
      838    18963    3             DO WHILE ( SL$ ~= ADDR(NIL) );
      839    18964    3                L3$ = KX$SL.L3$;
      840    18965    3                CALL_FPT.CAL$ = SL$;
      841    18966    3                CALL_FPT.RCV$ = L3$;
      842    18967    3                KNH_MESS.LDCTX = KX$SL.LDCTX;
      843    18968    3                KNH_MESS.UID$ = SL$;
      844    18969    3                KNH_MESS.UIDX.CQ_HNDID = %KV#CQ_HNDID_SL;
      845    18970    3                IF KX$SL.RPRDAT
      846    18971    3                   AND ( KX$SL.CQMSG_.BYTSIZ > 0 OR KX$SL.OTPBFRBYTX > 0 )
      847    18972    3                   THEN
      848    18973    4                      DO;
      849    18974    4                         KX$SL.RPRDAT = '0'B;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:31   
      850    18975    4                         CALL_FPT.EVN = %KX_P_EV_DATAVL#;
      851    18976    4                         CALL Y$CAL_KXP;
      852    18977    4                      END;
      853    18978        /*
      854    18979           At this point we should check BCKLOG against the thresholds to
      855    18980           see if a flow control message to network is appropriate.
      856    18981        */
      857    18982    3                IF KX$SL.BCKLOG > 4*KX$SL.OTPBFRBYTSIZ AND NOT KX$SL.NTWBLK
      858    18983    3                   THEN
      859    18984    4                      DO;
      860    18985    4                         KNH_MESS.FUNCTION = %KN_FCN_BLOCK;
      861    18986    4                         CALL KVM$SNDCQ ( KV@SNDCQ ) WHENRETURN
      862    18987    5                               DO;
      863    18988    5                                  KX$SL.NTWBLK = '1'B;
      864    18989    5                               END;
      865    18990    4                      END;
      866    18991    3                IF KX$SL.BCKLOG < KX$SL.OTPBFRBYTSIZ AND KX$SL.NTWBLK
      867    18992    3                   THEN
      868    18993    4                      DO;
      869    18994    4                         KNH_MESS.FUNCTION = %KN_FCN_UNBLOCK;
      870    18995    4                         CALL KVM$SNDCQ ( KV@SNDCQ ) WHENRETURN
      871    18996    5                               DO;
      872    18997    5                                  KX$SL.NTWBLK = '0'B;
      873    18998    5                               END;
      874    18999    4                      END;
      875    19000    3                SL$ = KX$SL.LNK$;
      876    19001    3             END;  /* do while ... */
      877    19002    2             RETURN;
      878    19003
      879    19004    2          CASE (%KX_CM_EV_DATRQS#);
      880    19005        /*
      881    19006           Call from packet requesting data to transmit.
      882    19007        */
      883    19008    2             IF KX$SL.CQMSG_.BYTSIZ = 0 AND KX$SL.OTPBFRBYTX = 0
      884    19009    2                THEN
      885    19010    3                   DO;
      886    19011    3                      KX$SL.RPRDAT = '1'B;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:32   
      887    19012    3                      RETURN;
      888    19013    3                   END;
      889    19014    2             IF KX$SL.CQMSG_.BYTSIZ > 0
      890    19015    2                THEN
      891    19016    3                   DO;
      892    19017    3                      KX$SL.CQMSG_STAGE = KX$SL.CQMSG_STAGE + 1;
      893    19018    3                      IF KX$SL.CQMSG_STAGE = 1
      894    19019    3                         THEN
      895    19020    4                            DO;
      896    19021    4                               FPT_X25.V_.ADR$ = KX$SL.CQMSG_.ADR$;
      897    19022    4                               FPT_X25.V_.BYTX = 0;
      898    19023    4                               FPT_X25.V_.BYTSIZ = KX$SL.CQMSG_.BYTSIZ;
      899    19024    4                            END;
      900    19025    3                         ELSE
      901    19026        /* stage is 2. L3 is finished xmitting this CQMSG */
      902    19027    4                            DO;
      903    19028    4                               KX$SL.CQMSG_.BYTSIZ = 0;
      904    19029    4                               KX$SL.CQMSG_STAGE = 0;
      905    19030    4                               KX$SL.RPRDAT = '1'B;
      906    19031    4                            END;
      907    19032    3                      RETURN;
      908    19033    3                   END;
      909    19034    2             IF KX$SL.OTPBFRBYTX > 0
      910    19035    2                THEN
      911    19036    3                   DO;
      912    19037    3                      KX$SL.OTPBFR_STAGE = KX$SL.OTPBFR_STAGE + 1;
      913    19038    3                      IF KX$SL.OTPBFR_STAGE = 1
      914    19039    3                         THEN
      915    19040    4                            DO;
      916    19041    4                               FPT_X25.V_.ADR$ = KX$SL.OTPBFR$;
      917    19042    4                               FPT_X25.V_.BYTX = 0;
      918    19043    4                               FPT_X25.V_.BYTSIZ = KX$SL.OTPBFRBYTX;
      919    19044    4                            END;
      920    19045    3                         ELSE
      921    19046        /* stage is 2. L3 is finished xmitting this output buffer */
      922    19047    4                            DO;
      923    19048    4                               KX$SL.OTPBFRBYTX = 0;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:33   
      924    19049    4                               KX$SL.OTPBFR_STAGE = 0;
      925    19050    4                               KX$SL.RPRDAT = '1'B;
      926    19051    4                            END;
      927    19052    3                      RETURN;
      928    19053    3                   END;
      929    19054
      930    19055    2          CASE ( %KX_CM_EV_DATOUT# );
      931    19056
      932    19057    2             IF KX$SL.RMTNOD <= 200 AND MSG$ ~= ADDR(NIL)
      933    19058    2                THEN
      934    19059    3                   DO;
      935    19060        /*
      936    19061           For rfeps, the two bytes before the data message, which is KNH$MESS.MSGSZ,
      937    19062           is part of the message.
      938    19063        */
      939    19064    3                      MSG$ = PINCRW ( MSG$, -1 );
      940    19065    3                      FPT_X25.V_.BYTSIZ = FPT_X25.V_.BYTSIZ + 2;
      941    19066    3                   END;
      942    19067    2             IF KX$SL.START_RCQ$ ~= ADDR(NIL)
      943    19068    2                THEN
      944    19069    2                   IF KX$SL.START_RCQ$ ~= MSG$
      945    19070    2                      THEN
      946    19071    3                         DO;
      947    19072    3                            KX$SL.BCKLOG = KX$SL.BCKLOG + FPT_X25.V_.BYTSIZ;
      948    19073    3                            ALTRETURN;
      949    19074    3                         END;
      950    19075    2                      ELSE
      951    19076    2                         KX$SL.START_RCQ$ = ADDR(NIL);
      952    19077    2             IF KX$SL.STATE >= %Y_ST_TERM# AND KX$SL.STATE <= %Y_ST_TERM_DCL#
      953    19078    2                THEN
      954    19079        /*
      955    19080           Discard any data messages in these terminal states.
      956    19081        */
      957    19082    2                   RETURN;
      958    19083    2             KX$SL.BCKLOG = FPT_X25.V_.BYTSIZ;
      959    19084    2             IF NOT KX$SL.RPRDAT
      960    19085    2                THEN
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:34   
      961    19086    2                   IF NOT KX$L3.L2$->KX$L2.FLG.DATAVL
      962    19087    2                      THEN
      963    19088    2                         KX$SL.RPRDAT = '1'B;
      964    19089    2                      ELSE
      965    19090    3                         DO;
      966    19091    3   L_ALTRET:                KX$SL.START_RCQ$ = MSG$;
      967    19092    3                            ALTRETURN;
      968    19093    3                         END;
      969    19094    2             IF KX$SL.CQMSG_STAGE > 0
      970    19095    2                THEN
      971    19096    3                   DO;
      972    19097    3                      KX$SL.CQMSG_STAGE = 0; /* Message is in L2 or L3, so just */
      973    19098    3                      KX$SL.CQMSG_.BYTSIZ = 0; /* zap, since L2 may be blocked. */
      974    19099                           /* IF KX$SL.CQMSG_.ADR$ ~= MSG$ THEN SCREECH; */
      975    19100    3                      RETURN;
      976    19101    3                   END;
      977    19102    2             CALL_FPT.EVN = %KX_P_EV_DATAVL#;
      978    19103    2             IF FPT_X25.V_.BYTSIZ >= KX$SL.OTPBFRBYTSIZ OR KX$SL.RMTNOD > 200
      979    19104    2                THEN
      980    19105    3                   DO;
      981    19106    3                      IF KX$SL.OTPBFRBYTX > 0
      982    19107    3                         THEN
      983    19108    4                            DO;
      984    19109    4                               CALL Y$RPRDAT ALTRET (L_ALTRET);
      985    19110    4                            END;
      986    19111    3                      KX$SL.CQMSG_.ADR$ = MSG$;
      987    19112    3                      KX$SL.CQMSG_.BYTSIZ = FPT_X25.V_.BYTSIZ;
      988    19113    3                      CALL Y$RPRDAT ALTRET ( L_ALTRET );
      989    19114    3                      RETURN;
      990    19115    3                   END;
      991    19116    2                ELSE
      992    19117    3                   DO;
      993    19118    3                      IF FPT_X25.V_.BYTSIZ > KX$SL.OTPBFRBYTSIZ - KX$SL.OTPBFRBYTX
      994    19119    3                         OR KX$SL.OTPBFR_STAGE > 0
      995    19120    3                         THEN
      996    19121    4                            DO;
      997    19122    4                               CALL Y$RPRDAT ALTRET (L_ALTRET);
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:35   
      998    19123    4                            END;
      999    19124    3                      SUBSTR ( KX$SL.OTPBFR$->B$STR, KX$SL.OTPBFRBYTX, FPT_X25.V_.
             19124                               BYTSIZ )
     1000    19125    3                         = SUBSTR ( MSG$->B$STR, 0, FPT_X25.V_.BYTSIZ );
     1001    19126    3                      KX$SL.OTPBFRBYTX = KX$SL.OTPBFRBYTX + FPT_X25.V_.BYTSIZ;
     1002    19127    3                      KX$SL.BCKLOG = 0;
     1003    19128        /*
     1004    19129           tells KXC$CQSCN to inform me of CQSCN_XIT later.
     1005    19130        */
     1006    19131    3                      FPT_X25.RET_BIT1 = '1'B;
     1007    19132    3                      RETURN;
     1008    19133    3                   END;
     1009    19134
     1010    19135    2          CASE ( %KX_CM_EV_DATIN# );
     1011    19136
     1012    19137    2             IF KX$SL.STATE ~= %Y_ST_NORMAL#
     1013    19138    2                THEN
     1014    19139    2                   ALTRETURN;
     1015    19140    2             IF FPT_X25.V_.BYTSIZ < 3 AND KX$SL.RMTNOD > 200
     1016    19141          /* 2 bytes (size) + >1 byte (data) */
     1017    19142    2                THEN
     1018    19143    3                   DO;
     1019    19144    3                      ERCOD = Y_SHR_PKT;
     1020    19145    3                      CALL Y$ER;
     1021    19146    3                      RETURN;
     1022    19147    3                   END;
     1023    19148        /*
     1024    19149               DATIN - process data coming in from the line.
     1025    19150               A packet may contain concatenated network messages.
     1026    19151               Each rfep message is preceded
     1027    19152               by a word which indicates its byte size. Balance of the byte count
     1028    19153               and the packet boundary has to be checked. The packet will be
     1029    19154               discarded if a message size of 0 is encountered.
     1030    19155        */
     1031    19156
     1032    19157    2             KNH_MESS.FUNCTION = %KN_FCN_DATA;
     1033    19158
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:36   
     1034    19159               /*  Possibly concatenated messages  */
     1035    19160    2             KV@SNDCQ.MSG_.ADR$ (1) = FPT_X25.V_.ADR$;
     1036    19161    2             IF KX$SL.SNDDAT_ALTRET AND FPT_X25.V_.ADR$ = KX$SL.INPDAT_.ADR$
     1037    19162    2                THEN
     1038    19163    2                   BYTX = KX$SL.INPDAT_.BYTX;
     1039    19164    2                ELSE
     1040    19165    2                   BYTX = FPT_X25.V_.BYTX;
     1041    19166    3   INP_LOP:  DO WHILE ( BYTX < FPT_X25.V_.BYTX + FPT_X25.V_.BYTSIZ );
     1042    19167    3                IF KX$SL.RMTNOD <= 200
     1043    19168    3                   THEN
     1044    19169    4                      DO;
     1045    19170    4                         KNH_MESS.MSGSZ = INPDAT_ARY(BYTX)*256 + INPDAT_ARY(BYTX+1);
     1046    19171    4                         IF KNH_MESS.MSGSZ = 0 OR (FPT_X25.V_.BYTSIZ > KX_BUF.SIZ
     1047    19172    4                            (KX$L3.CALL_OPTS.RCVPCKSIZ) AND
     1048    19173    4                            KNH_MESS.MSGSZ ~= FPT_X25.V_.BYTSIZ-2)
     1049    19174    4                            THEN
     1050    19175    4                               EXIT INP_LOP;
     1051    19176    4                         BYTX = BYTX + 2;
     1052    19177    4                      END;
     1053    19178    3                   ELSE
     1054    19179    3                      KNH_MESS.MSGSZ = FPT_X25.V_.BYTSIZ;
     1055    19180    3                KV@SNDCQ.MSG_.BYTSIZ (1) = (KNH_MESS.MSGSZ + 3 ) / 4 * 4;
     1056    19181    3                KV@SNDCQ.MSG_.BYTX (1) = BYTX;
     1057    19182    3                CALL KVM$SNDCQ ( KV@SNDCQ ) WHENALTRETURN
     1058    19183    4                      DO;
     1059    19184    4                         KX$SL.SNDDAT_ALTRET = '1'B;
     1060    19185    4                         KX$SL.INPDAT_ = FPT_X25.V_;
     1061    19186    4                         IF KX$SL.RMTNOD <= 200
     1062    19187    4                            THEN
     1063    19188    4                               KX$SL.INPDAT_.BYTX = BYTX - 2;
     1064    19189    4                         ALTRETURN;
     1065    19190    4                      END;
     1066    19191    3                BYTX = BYTX + KNH_MESS.MSGSZ;
     1067    19192    3             END;  /* do while ( bytx ... ) */
     1068    19193    2             IF BYTX ~= FPT_X25.V_.BYTX + FPT_X25.V_.BYTSIZ
     1069    19194    2                THEN
     1070    19195    3                   DO;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:37   
     1071    19196    3                      ERCOD = Y_UNB_PKT;
     1072    19197    3                      CALL Y$ER;
     1073    19198    3                   END;
     1074    19199        /*
     1075    19200           To get here, we must have successfully delivered all the network messages
     1076    19201           in the current input block.
     1077    19202        */
     1078    19203    2             KX$SL.SNDDAT_ALTRET = '0'B;
     1079    19204    2             KX$SL.INPDAT_ = '0'B;
     1080    19205    2             RETURN;
     1081    19206        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:38   
     1082    19207
     1083    19208    2          CASE ( %KX_CM_EV_VCRST#, %KX_CM_EV_RSTIND#);
     1084    19209        /*
     1085    19210           A VC is undergoing a reset procedure. Send a CQ RESET message if we are
     1086    19211           in NORMAL state. Otherwise ignore.
     1087    19212        */
     1088    19213    2             IF KX$SL.STATE = %Y_ST_NORMAL# AND KX$SL.RMTNOD > 200
     1089    19214        /* make sure we are not an rfep too */
     1090    19215    2                THEN
     1091    19216    3                   DO;
     1092    19217    3                      KNH_MESS.FUNCTION = %KN_FCN_RESET;
     1093    19218    3                      KNH_MESS.FPTSZ = LENGTHC(FPT@RESET);
     1094    19219    3                      KV@SNDCQ.MSG_.ADR$ (1) = ADDR(FPT@RESET);
     1095    19220    3                      KV@SNDCQ.MSG_.BYTSIZ (1) = ( LENGTHC(FPT@RESET) + 3 ) / 4 * 4;
     1096    19221    3                      FPT@RESET.CAUSE = FPT_X25.PRM1;
     1097    19222    3                      FPT@RESET.DIAG = FPT_X25.PRM2;
     1098    19223    3                      GOTO SNDCQ2;
     1099    19224    3                   END;
     1100    19225    2             RETURN;
     1101    19226
     1102    19227    2          CASE (%KX_CM_EV_INT#);
     1103    19228        /*
     1104    19229          Interrupt packet received. Send a CQ message if we are in NORMAL state.
     1105    19230          Otherwise ignore.
     1106    19231        */
     1107    19232        /* make sure we are not an rfep too */
     1108    19233    2             IF KX$SL.STATE = %Y_ST_NORMAL# AND KX$SL.RMTNOD > 200
     1109    19234    2                THEN
     1110    19235    3                   DO;
     1111    19236    3                      KNH_MESS.FUNCTION = %KN_FCN_EXPEDITED_DATA;
     1112    19237    3                      KNH_MESS.MSGSZ = FPT_X25.V_.BYTSIZ;
     1113    19238    3                      KV@SNDCQ.MSG_.ADR$ (1) = FPT_X25.V_.ADR$;
     1114    19239    3                      KV@SNDCQ.MSG_.BYTSIZ (1) = ( FPT_X25.V_.BYTSIZ + 3 ) / 4 * 4;
     1115    19240    3                      KV@SNDCQ.MSG_.BYTX (1) = FPT_X25.V_.BYTX;
     1116    19241    3                      GOTO SNDCQ2;
     1117    19242    3                   END;
     1118    19243    2             RETURN;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:39   
     1119    19244
     1120    19245    2          CASE (%KX_CM_EV_INTACK#);
     1121    19246        /*
     1122    19247           Positive acknowledgement for transmitted interrupt.
     1123    19248        */
     1124    19249    2             KNH_MESS.FUNCTION = %KN_FCN_EXPEDITED_DATA_ACK;
     1125    19250    2             GOTO SNDCQ1;
     1126    19251
     1127    19252    2          CASE (%KX_CM_EV_INTNAK#);
     1128    19253        /*
     1129    19254           Negative acknowledgement for transmitted interrupt.
     1130    19255        */
     1131    19256    2             KNH_MESS.FUNCTION = %KN_FCN_EXPEDITED_DATA_NAK;
     1132    19257    2   SNDCQ1:   IF KX$SL.STATE = %Y_ST_NORMAL#
     1133    19258    2                THEN
     1134    19259    3                   DO;
     1135    19260    3   SNDCQ2:            CALL KVM$SNDCQ ( KV@SNDCQ )
     1136    19261    3                         WHENALTRETURN
     1137    19262    4                            DO;
     1138    19263        /*N* forget it? */
     1139    19264    4                            END;
     1140    19265    3                   END;
     1141    19266    2             RETURN;
     1142    19267
     1143    19268    2          CASE (%KX_CM_EV_RSTRQS#);
     1144    19269        /*
     1145    19270           Network wants to initiate a reset on this VC
     1146    19271        */
     1147    19272    2             IF KX$SL.STATE = %Y_ST_NORMAL#
     1148    19273    2                THEN
     1149    19274    3                   DO;
     1150    19275    3                      CALL_FPT.EVN = %KX_P_EV_VCRST#;
     1151    19276    3                      CALL_FPT.PRM1 = FPT$RESET.CAUSE;
     1152    19277    3                      CALL_FPT.PRM2 = FPT$RESET.DIAG;
     1153    19278    3                      GOTO CAL_KXP;
     1154    19279    3                   END;
     1155    19280    2                ELSE
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:40   
     1156    19281    2                   IF KX$SL.STATE >= %Y_ST_TERM#
     1157    19282    2                      THEN
     1158    19283    2                         RETURN;
     1159    19284    2             ALTRETURN;
     1160    19285
     1161    19286    2          CASE (%KX_CM_EV_INTRQS#);
     1162    19287        /*
     1163    19288           Network wants to send an interrupt packet.
     1164    19289        */
     1165    19290    2             IF KX$SL.STATE = %Y_ST_NORMAL#
     1166    19291    2                THEN
     1167    19292    3                   DO;
     1168    19293    3                      CALL_FPT.EVN = %KX_P_EV_SNDINT#;
     1169    19294    3                      CALL_FPT.V_ = FPT_X25.V_;
     1170    19295    3   CAL_KXP:           CALL Y$CAL_KXP;
     1171    19296    3                      RETURN;
     1172    19297    3                   END;
     1173    19298    2                ELSE
     1174    19299    2                   IF KX$SL.STATE >= %Y_ST_TERM#
     1175    19300    2                      THEN
     1176    19301    2                         RETURN;
     1177    19302    2             ALTRETURN;
     1178    19303
     1179    19304    2          CASE (%KX_CM_EV_RLSL3#);
     1180    19305        /*
     1181    19306           The L3 context is about to be released. Let's nil KX$SL.L3$.
     1182    19307           This is a non-state-table event.
     1183    19308        */
     1184    19309    2             IF SL$ ~= ADDR(NIL)
     1185    19310    2                THEN
     1186    19311    2                   KX$SL.L3$ = ADDR(NIL);
     1187    19312    2             RETURN;
     1188    19313
     1189    19314    2          CASE ( ELSE );
     1190    19315        /*S* SCREECH_CODE: KXV-S$KX_SL_UNKEVT#
     1191    19316             MESSAGE: KXV received a call with an unknown event.
     1192    19317        */
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:41   
     1193    19318    2             CALL KHD$SCREECH ( Y_UNKEVT );
     1194    19319
     1195    19320    2       END; /*  Case on external event  */
     1196    19321        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:42   
     1197    19322        /*
     1198    19323                                             Update the state and perform the
     1199    19324                                             specified action.
     1200    19325        */
     1201    19326    1       STATE = KX$SL.STATE;
     1202    19327    1       KVBSIZ = STATE * ( %Y_EV_MAX# + 1 ) + EVENT;
     1203    19328    1       STATE = STATE_TABLE.NEXT_STATE ( KVBSIZ );
     1204    19329    1       KX$SL.STATE = STATE;
     1205    19330    1       ACTION = STATE_TABLE.ACTION ( KVBSIZ );
     1206    19331    1       KX$SL.HIST.STT ( KX$SL.HIST.X ) = STATE;
     1207    19332    1       KX$SL.HIST.EVT ( KX$SL.HIST.X ) = EVENT;
     1208    19333    1       KX$SL.HIST.ACT ( KX$SL.HIST.X ) = ACTION;
     1209    19334    1       KX$SL.HIST.X = MOD ( KX$SL.HIST.X + 1, 8 );
     1210    19335
     1211    19336    2       DO CASE ( ACTION );
     1212    19337        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:43   
     1213    19338    2          CASE ( %Y_ACT_GETOTPBFR# );
     1214    19339        /*
     1215    19340               GETOTPBFR - connection is up all the way. Get an output buffer
     1216    19341                           the size of a max packet and start rolling.
     1217    19342                           Give L3 a redrqs just in case it has input buffered.
     1218    19343        */
     1219    19344    2             KX$SL.RPRDAT = '1'B;
     1220    19345    2             IF KX$SL.RMTNOD > 200
     1221    19346    2                THEN
     1222    19347    2                   RETURN;
     1223    19348    2             IF KX$SL.OTPBFR$ ~= ADDR(NIL)
     1224    19349    2                THEN
     1225    19350    3                   DO;
     1226    19351    3                      KX$SL.OTPBFRBYTSIZ = KX_BUF.SIZ ( KX$L3.CALL_OPTS.SNDPCKSIZ ) ;
     1227    19352    3                      KVBSIZ = KX$SL.OTPBFRBYTSIZ / 2;
     1228    19353    3                      CALL KVB$GETSYS ( KVBSIZ, Y$ ) WHENALTRETURN
     1229    19354    4                            DO;
     1230    19355        /*S* SCREECH_CODE: KXV-S$KX_NO_MEM#
     1231    19356             MESSAGE: The handler is out of MEMory.
     1232    19357        */
     1233    19358    4   SCR_NOMEM:                  CALL KHD$SCREECH ( Y_NO_MEM );
     1234    19359    4                            END;
     1235    19360    3                      KX$SL.OTPBFR$ = Y$;
     1236    19361    3                   END;
     1237    19362    2             KX$SL.OTPBFRBYTX = 0;
     1238    19363    2             KX$SL.OTPBFR_STAGE = 0;
     1239    19364    2             KX$SL.CQMSG_STAGE = 0;
     1240    19365    2             KX$SL.CQMSG_ = '0'B;
     1241    19366    2             CALL_FPT.EVN = %KX_P_EV_REDRQS#;
     1242    19367    2             CALL_FPT.CAL$ = SL$;
     1243    19368    2             CALL_FPT.RCV$ = KX$SL.L3$;
     1244    19369    2             CALL Y$CAL_KXP;
     1245    19370        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:44   
     1246    19371        /*
     1247    19372               INIT - Start a connection with the Network layer on behalf of the VC
     1248    19373        */
     1249    19374    2          CASE ( %Y_ACT_INIT# );
     1250    19375
     1251    19376    2   SND_INIT: FPT@CONNECT = FPT_CONNECT_C;
     1252    19377    2             FPT@CONNECT.RLCID.NODE = KX$SL.RMTNOD;
     1253    19378    2             FPT@CONNECT.RLCID.FEP_NODE = KX$SL.LCLNOD;
     1254    19379    2             FPT@CONNECT.RLCID.FLAGS.VIRCIR = '1'B;
     1255    19380    2             FPT@CONNECT.TERMINAL_ID = KX$SL.L3$->%L3CHN.TERMID;
     1256    19381    2             FPT@CONNECT.SERVICE = KX$SL.L3$->KX$L3.QOS;
     1257    19382    2             FPT@CONNECT.DSTSNPA = KX$SL.L3$->KX$L3.CALL_OPTS.RCVADR;
     1258    19383    2             IF KX$SL.L3$->KX$L3.LCLNSAP.NSAP.LEN > 0
     1259    19384    2                THEN
     1260    19385    3                   DO;
     1261    19386    3                      FPT@CONNECT.TYPE = %KN_CON_TYP_CIRCUIT;
     1262    19387    3                      FPT@CONNECT.DEST = KX$SL.L3$->KX$L3.LCLNSAP;
     1263    19388    3                      FPT@CONNECT.LADR = KX$SL.L3$->KX$L3.RMTNSAP;
     1264    19389    3                      FPT@CONNECT.DEST.LEN = (FPT@CONNECT.DEST.LEN+1)/2;
     1265    19390    3                      FPT@CONNECT.LADR.LEN = (FPT@CONNECT.LADR.LEN+1)/2;
     1266    19391    3                   END;
     1267    19392    2             KNH_MESS.FUNCTION = %KN_FCN_INIT;
     1268    19393    2             KNH_MESS.FPTSZ = 2 * SIZEW ( FPT@CONNECT );
     1269    19394    2             KNH_MESS.MSGSZ = KX$SL.CALUSRDATBYTSIZ;
     1270    19395    2             KNH_MESS.LDCTX = 0;
     1271    19396    2             KX$SL.LDCTX = 0;
     1272    19397    2             KV@SNDCQ.MSG_.ADR$ (1) = ADDR ( FPT@CONNECT );
     1273    19398    2             KV@SNDCQ.MSG_.BYTSIZ (1) = (LENGTHC(FPT@CONNECT) + 3)/4*4;
     1274    19399    2             KV@SNDCQ.MSG_.ADR$ (2) = KX$SL.CALUSRDAT$;
     1275    19400    2             KV@SNDCQ.MSG_.BYTSIZ (2) = KX$SL.CALUSRDATBYTSIZ;
     1276    19401    2             CALL KVM$SNDCQ ( KV@SNDCQ )
     1277    19402    2                WHENRETURN
     1278    19403    3                   DO;
     1279    19404    3                      KX$SL.SNDINT_ALTRET = '0'B;
     1280    19405    3                   END;
     1281    19406    2                WHENALTRETURN
     1282    19407    3                   DO;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:45   
     1283    19408    3                      KX$SL.SNDINT_ALTRET = '1'B;
     1284    19409    3                   END;
     1285    19410
     1286    19411        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:46   
     1287    19412        /*
     1288    19413               INITACK, INITNAK - Got a response from a circuits. Tell Network about
     1289    19414                                  the good (ack) or bad (nak) news.
     1290    19415        */
     1291    19416    2          CASE ( %Y_ACT_INITACK# );
     1292    19417
     1293    19418    2   SND_INITACK:
     1294    19419    2             FPT@CONNECT_ACK.REASON = %K_REASON_NORMAL;
     1295    19420    2             KNH_MESS.MSGSZ = KX$SL.CALRSPDATBYTSIZ;
     1296    19421    2             KV@SNDCQ.MSG_.ADR$ (2) = KX$SL.CALRSPDAT$;
     1297    19422    2             KX$SL.RPRDAT = '1'B;
     1298    19423    2             GOTO SND_INITRSP;
     1299    19424
     1300    19425    2          CASE ( %Y_ACT_INITNAK# );
     1301    19426
     1302    19427    2   SND_INITNAK:
     1303    19428    2             FPT@CONNECT_ACK.REASON = %K_REASON_NORTE;
     1304    19429    2             KNH_MESS.MSGSZ = KX$SL.CLRDATBYTSIZ;
     1305    19430    2             KV@SNDCQ.MSG_.ADR$ (2) = KX$SL.CLRDAT$;
     1306    19431    2   SND_INITRSP:
     1307    19432    2             KNH_MESS.FUNCTION = %KN_FCN_INIT_ACK;
     1308    19433    2             KNH_MESS.FPTSZ = 2 * SIZEW ( FPT@CONNECT_ACK );
     1309    19434    2             KV@SNDCQ.MSG_.ADR$ (1) = ADDR ( FPT@CONNECT_ACK );
     1310    19435    2             KV@SNDCQ.MSG_.BYTSIZ (1) = (LENGTHC(FPT@CONNECT_ACK) + 3)/4*4;
     1311    19436    2             KV@SNDCQ.MSG_.BYTSIZ (2) = ( KNH_MESS.MSGSZ + 3 ) / 4 * 4;
     1312    19437    2             CALL KVM$SNDCQ ( KV@SNDCQ )
     1313    19438    2                WHENRETURN
     1314    19439    3                   DO;
     1315    19440    3                      IF ACTION = %Y_ACT_INITACK#
     1316    19441    3                         THEN
     1317    19442    3                            KX$SL.SNDINTACK_ALTRET = '0'B;
     1318    19443    3                         ELSE
     1319    19444    3                            GOTO RLS_SL;
     1320    19445    3                   END;
     1321    19446    2                WHENALTRETURN
     1322    19447    3                   DO;
     1323    19448    3                      IF ACTION = %Y_ACT_INITACK#
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:47   
     1324    19449    3                         THEN
     1325    19450    3                            KX$SL.SNDINTACK_ALTRET = '1'B;
     1326    19451    3                         ELSE
     1327    19452    3                            KX$SL.SNDINTNAK_ALTRET = '1'B;
     1328    19453    3                   END;
     1329    19454        /*
     1330    19455           Clear the context.
     1331    19456        */
     1332    19457    2             KX$SL.OTPBFRBYTX = 0;
     1333    19458    2             KX$SL.OTPBFR_STAGE = 0;
     1334    19459    2             KX$SL.CQMSG_STAGE = 0;
     1335    19460    2             KX$SL.CQMSG_ = '0'B;
     1336    19461
     1337    19462        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:48   
     1338    19463        /*
     1339    19464               NULL - do nothing
     1340    19465        */
     1341    19466    2          CASE ( %Y_ACT_NULL# );
     1342    19467
     1343    19468        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:49   
     1344    19469        /*S* SCREECH_CODE: KXV-S$KX_SL_ACTSCR#
     1345    19470             MESSAGE: KXV received an illegal event in current state.
     1346    19471        */
     1347    19472    2          CASE ( %Y_ACT_SCREECH# );
     1348    19473
     1349    19474    2   L_SCR:    CALL KHD$SCREECH ( Y_ACTSCR );
     1350    19475        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:50   
     1351    19476        /*
     1352    19477               TERM - Send a termination request to the Network layer
     1353    19478        */
     1354    19479    2          CASE ( %Y_ACT_TERM# );
     1355    19480        /*
     1356    19481           Clear the context.
     1357    19482        */
     1358    19483    2             KX$SL.OTPBFRBYTX = 0;
     1359    19484    2             KX$SL.OTPBFR_STAGE = 0;
     1360    19485    2             KX$SL.CQMSG_STAGE = 0;
     1361    19486    2             KX$SL.CQMSG_ = '0'B;
     1362    19487    2             IF KX$SL.CALUSRDAT$ ~= ADDR(NIL)
     1363    19488    2                THEN
     1364    19489    2                   CALL KVB$RLSSYS ( (KX$SL.CALUSRDATBYTSIZ+1)/2, KX$SL.CALUSRDAT$ );
     1365    19490    2             IF KX$SL.CALRSPDAT$ ~= ADDR(NIL)
     1366    19491    2                THEN
     1367    19492    2                   CALL KVB$RLSSYS ( (KX$SL.CALRSPDATBYTSIZ+1)/2, KX$SL.CALRSPDAT$ );
     1368    19493    2             IF KX$SL.CLRDAT$ ~= ADDR(NIL)
     1369    19494    2                THEN
     1370    19495    2                   CALL KVB$RLSSYS ( (KX$SL.CLRDATBYTSIZ+1)/2, KX$SL.CLRDAT$ );
     1371    19496    2             KX$SL.CALUSRDAT$ = ADDR(NIL);
     1372    19497    2             KX$SL.CALRSPDAT$ = ADDR(NIL);
     1373    19498    2             KX$SL.CLRDAT$ = ADDR(NIL);
     1374    19499        /*
     1375    19500                                             Report the termination.
     1376    19501        */
     1377    19502    2   SND_TERM: FPT@TERM = FPT_TERM_C;
     1378    19503    2             FPT@TERM.RLCID.NODE = KX$SL.RMTNOD;
     1379    19504    2             FPT@TERM.RLCID.LDCTX = KX$SL.LDCTX;
     1380    19505    2             KNH_MESS.FUNCTION = %KN_FCN_TERM;
     1381    19506    2             KNH_MESS.FPTSZ = 2 * SIZEW ( FPT@TERM );
     1382    19507    2             KNH_MESS.MSGSZ = KX$SL.CLRDATBYTSIZ;
     1383    19508    2             KV@SNDCQ.MSG_.ADR$ (1) = ADDR ( FPT@TERM );
     1384    19509    2             KV@SNDCQ.MSG_.BYTSIZ (1) = (LENGTHC( FPT@TERM ) + 3)/4*4;
     1385    19510    2             KV@SNDCQ.MSG_.ADR$ (2) = KX$SL.CLRDAT$;
     1386    19511    2             KV@SNDCQ.MSG_.BYTSIZ (2) = ( KNH_MESS.MSGSZ + 3 ) / 4 * 4;
     1387    19512    2             CALL KVM$SNDCQ ( KV@SNDCQ )
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:51   
     1388    19513    2                WHENRETURN
     1389    19514    3                   DO;
     1390    19515    3                      KX$SL.SNDTRM_ALTRET = '0'B;
     1391    19516    3                   END;
     1392    19517    2                WHENALTRETURN
     1393    19518    3                   DO;
     1394    19519    3                      KX$SL.SNDTRM_ALTRET = '1'B;
     1395    19520    3                   END;
     1396    19521        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:52   
     1397    19522        /*
     1398    19523           RLS - The TRMACK has arrived.
     1399    19524        */
     1400    19525    2          CASE ( %Y_ACT_RLS# );
     1401    19526    2   RLS_SL:   CTX$ = KX_SLLIST.HD$;
     1402    19527    2             IF SL$ = CTX$
     1403    19528    2                THEN
     1404    19529    3                   DO;
     1405    19530    3                      KX_SLLIST.HD$ = KX$SL.LNK$;
     1406    19531    3                      IF KX$SL.LNK$ = ADDR(NIL)
     1407    19532    3                         THEN
     1408    19533    3                            KX_SLLIST.TL$ = ADDR(NIL);
     1409    19534    3                   END;
     1410    19535    2                ELSE
     1411    19536    3                   DO;
     1412    19537    3                      PRVCTX$ = CTX$;
     1413    19538    3                      CTX$ = CTX$->KX$SL.LNK$;
     1414    19539    4                      DO WHILE (( CTX$ ~= ADDR(NIL)) AND ( CTX$ ~= SL$ ));
     1415    19540    4                         PRVCTX$ = CTX$;
     1416    19541    4                         CTX$ = CTX$->KX$SL.LNK$;
     1417    19542    4                      END;
     1418    19543    3                      IF CTX$ = ADDR(NIL)
     1419    19544    3                         THEN
     1420    19545    4                            DO;
     1421    19546        /*S* SCREECH_CODE: KXV-S$KX_BADSLLIST#
     1422    19547             MESSAGE: The chain of SL contexts is corrupted.
     1423    19548        */
     1424    19549    4                               CALL KHD$SCREECH ( Y_BADSLLIST );
     1425    19550    4                            END;
     1426    19551    3                      PRVCTX$ -> KX$SL.LNK$ = KX$SL.LNK$;
     1427    19552    3                      IF KX$SL.LNK$ = ADDR(NIL)
     1428    19553    3                         THEN
     1429    19554    3                            KX_SLLIST.TL$ = PRVCTX$;
     1430    19555    3                   END;
     1431    19556    2             IF KX$SL.OTPBFR$ ~= ADDR(NIL)
     1432    19557    2                THEN
     1433    19558    2                   CALL KVB$RLSSYS ( KX$SL.OTPBFRBYTSIZ/2, KX$SL.OTPBFR$ );
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:53   
     1434    19559    2             IF KX$SL.CALUSRDAT$ ~= ADDR(NIL)
     1435    19560    2                THEN
     1436    19561    2                   CALL KVB$RLSSYS ( (KX$SL.CALUSRDATBYTSIZ+1)/2, KX$SL.CALUSRDAT$ );
     1437    19562    2             IF KX$SL.CALRSPDAT$ ~= ADDR(NIL)
     1438    19563    2                THEN
     1439    19564    2                   CALL KVB$RLSSYS ( (KX$SL.CALRSPDATBYTSIZ+1)/2, KX$SL.CALRSPDAT$ );
     1440    19565    2             IF KX$SL.CLRDAT$ ~= ADDR(NIL)
     1441    19566    2                THEN
     1442    19567    2                   CALL KVB$RLSSYS ( (KX$SL.CLRDATBYTSIZ+1)/2, KX$SL.CLRDAT$ );
     1443    19568    2             IF KX$SL.L3$ ~= ADDR(NIL)
     1444    19569    2                THEN
     1445    19570    2                   KX$SL.L3$->KX$L3.CM$ = ADDR(NIL);
     1446    19571    2             CALL KVB$RLSSYS ( SIZEW(KX$SL), SL$ );
     1447    19572        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:54   
     1448    19573    2          CASE ( %Y_ACT_RLSMAYBE# );
     1449    19574        /*
     1450    19575          RLSMAYBE - If we haven't yet sent out the INIT (SNDINT_ALRET
     1451    19576                     on), then forget it and release the SL.
     1452    19577        */
     1453    19578    2             IF KX$SL.SNDINT_ALTRET
     1454    19579    2                THEN
     1455    19580    2                   GOTO RLS_SL;  /* in case RLS */
     1456    19581        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:55   
     1457    19582
     1458    19583    2          CASE ( %Y_ACT_VCUP# );
     1459    19584        /*
     1460    19585           VCUP - Got an INIT_ACK from network. Start the VC.
     1461    19586        */
     1462    19587    2             CALL_FPT.EVN = %KX_P_EV_VCUP#;
     1463    19588    2             IF KX$SL.RMTNOD <= 200 AND KX$L3.TYP ~= %KX_VC_TYP_RMT#
     1464    19589    2                THEN
     1465    19590    3                   DO;
     1466    19591    3                      CALL_FPT.V_.ADR$ = ADDR(KX$SL.PRTID);
     1467    19592    3                      CALL_FPT.V_.BYTSIZ = 3;
     1468    19593    3                   END;
     1469    19594    2                ELSE
     1470    19595    3                   DO;
     1471    19596    3                      CALL_FPT.V_.ADR$ = KX$SL.CALUSRDAT$;
     1472    19597    3                      CALL_FPT.V_.BYTSIZ = KX$SL.CALUSRDATBYTSIZ;
     1473    19598    3                   END;
     1474    19599    2             GOTO CAL_KXP;
     1475    19600
     1476    19601    2          CASE ( %Y_ACT_ZAP# );
     1477    19602        /*
     1478    19603           ZAP - Got a TERM from Network. If L3$ ~= nil,
     1479    19604                 call kxp ( vclst ), send term_ack, release SL context.
     1480    19605        */
     1481    19606        /*
     1482    19607           Clear the context.
     1483    19608        */
     1484    19609    2             KX$SL.OTPBFRBYTX = 0;
     1485    19610    2             KX$SL.OTPBFR_STAGE = 0;
     1486    19611    2             KX$SL.CQMSG_STAGE = 0;
     1487    19612    2             KX$SL.CQMSG_ = '0'B;
     1488    19613    2             IF KX$SL.L3$ ~= ADDR(NIL)
     1489    19614    2                THEN
     1490    19615    3                   DO;
     1491    19616    3                      CALL_FPT.EVN = %KX_P_EV_VCLST#;
     1492    19617    3                      CALL_FPT.V_ = FPT_X25.V_;
     1493    19618    3                      CALL Y$CAL_KXP;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:56   
     1494    19619    3                   END;
     1495    19620    2   SND_TERMACK:
     1496    19621    2             FPT@TERM_ACK.REASON = 0;
     1497    19622    2             KNH_MESS.FUNCTION = %KN_FCN_TERM_ACK;
     1498    19623    2             KNH_MESS.FPTSZ = 2 * SIZEW ( FPT@TERM_ACK );
     1499    19624    2             KV@SNDCQ.MSG_.ADR$ (1) = ADDR ( FPT@TERM_ACK );
     1500    19625    2             KV@SNDCQ.MSG_.BYTSIZ (1) = (LENGTHC( FPT@TERM_ACK ) + 3)/4*4;
     1501    19626    2             CALL KVM$SNDCQ ( KV@SNDCQ )
     1502    19627    2                WHENRETURN
     1503    19628    3                   DO;
     1504    19629    3                      GOTO RLS_SL;
     1505    19630    3                   END;
     1506    19631    2                WHENALTRETURN
     1507    19632    3                   DO;
     1508    19633    3                      KX$SL.SNDTRMACK_ALTRET = '1'B;
     1509    19634    3                   END;
     1510    19635
     1511    19636    2          CASE ( ELSE );
     1512    19637
     1513    19638    2             GOTO L_SCR;   /* in case (action_screech) */
     1514    19639
     1515    19640    2       END;   /* do case (action) */
     1516    19641        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:57   
     1517    19642
     1518    19643    1   Y$RPRDAT: PROC ALTRET;
     1519    19644
     1520    19645    2       KX$SL.RPRDAT = '0'B;
     1521    19646    2       CALL KXP$PACKET ( CALL_FPT );
     1522    19647    2       IF NOT KX$SL.RPRDAT
     1523    19648    2          THEN
     1524    19649    2             ALTRETURN;
     1525    19650    2       RETURN;
     1526    19651
     1527    19652    2   END Y$RPRDAT;
     1528    19653
     1529    19654    1   Y$CAL_KXP: PROC;
     1530    19655
     1531    19656    2       CALL KXP$PACKET ( CALL_FPT ) WHENALTRETURN
     1532    19657    3             DO;
     1533    19658    3                CALL KHD$SCREECH ( CALL_FPT.PRM1$->B$SCODE );
     1534    19659    3             END;
     1535    19660    2       RETURN;
     1536    19661
     1537    19662    2   END Y$CAL_KXP;
     1538    19663
     1539    19664    1   Y$ER: PROC;
     1540    19665
     1541    19666            %WRSYSLOG ( ERRCOD = ERCOD, TRMID = "KX$SL.L3$->KX$L3.CHN$->KH$CHN.TERMID" );
     1542    19684    2       RETURN;
     1543    19685
     1544    19686    2   END Y$ER;
     1545    19687
     1546    19688    1   Y$GETL3: PROC ( L2$, REDIR ) ALTRET;
     1547    19689
     1548    19690    2   DCL L2$ PTR;      /* this is the input  */
     1549    19691    2   DCL REDIR UBIN;   /* 0 = new request, 1 = redirect circuit */
     1550    19692        %KX$L2;
     1551    20059    2   DCL TL3$ PTR;
     1552    20060        %KX$L3 ( FPTN = KX$TL3, STCLASS = "BASED(TL3$)" );
     1553    20463    2   DCL I UBIN;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:58   
     1554    20464
     1555    20465    2       CALL KXS$GETL3 ( L2$, L3$ ) ALTRET ( L_ALTRET );
     1556    20466    2       CALL KVB$GETSYS ( SIZEW(KH$CHN), KX$L3.CHN$ ) WHENALTRETURN
     1557    20467    3             DO;
     1558    20468    3                CALL KVB$RLSSYS ( SIZEW(KX$L3), L3$ );
     1559    20469    3   L_ALTRET:
     1560    20470    3                ALTRETURN;
     1561    20471    3             END;
     1562    20472    2       KX$L3.TYP = %KX_VC_TYP_CL0#;
     1563    20473    2       KX$L3.RLSCHN = '1'B;
     1564    20474    2       %L3CHN = L2$->KX$L2.CHN$->KH$CHN;
     1565    20475    2       %L3CHN.CTX$ = L3$;
     1566    20476    2       %L3CHN.SUB$ = ADDR(NIL);
     1567    20477    2       %L3CHN.TERMID.LEV = %TERMINAL_ID_LEV_SUBCHAN#;
     1568    20478    2       %L3CHN.TERMID.TTYP = %KLTY_VIRCIR#;
     1569    20479        /*
     1570    20480            find an available subdevice number for this L3.
     1571    20481        */
     1572    20482    3       DO I = 1 TO 4095;
     1573    20483    3          TL3$ = L2$->KX$L2.L3_HEAD$;
     1574    20484    4          DO WHILE ( TL3$ ~= L3$ AND
     1575    20485    4             ( %TL3CHN.TERMID.LEV ~= %TERMINAL_ID_LEV_SUBCHAN#
     1576    20486    4             OR %TL3CHN.TERMID.TERM.SUBDEVICE ~= I ));
     1577    20487    4             TL3$ = KX$TL3.NEXT$;
     1578    20488    4          END;  /* do while ( tl3$... */
     1579    20489    3          IF TL3$ = L3$
     1580    20490    3             THEN
     1581    20491    4                DO;
     1582    20492    4                   %L3CHN.TERMID.TERM.SUBDEVICE = I;
     1583    20493    4                   I = 4096;
     1584    20494    4                END;
     1585    20495    3       END;   /* do i = ... */
     1586    20496    2       KX$L3.CM$ = SL$;
     1587    20497    2       IF REDIR = 1
     1588    20498    2          THEN
     1589    20499    3             DO;
     1590    20500    3                KX$SL.SCN_L3$ = L3$;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:59   
     1591    20501    3                KX$L3.LCLNSAP = KX$SL.L3$->KX$TL3.LCLNSAP;
     1592    20502    3                KX$L3.RMTNSAP = KX$SL.L3$->KX$TL3.RMTNSAP;
     1593    20503    3                KX$L3.CALL_OPTS.RCVADR = KX$SL.L3$->KX$TL3.CALL_OPTS.RCVADR;
     1594    20504    3             END;
     1595    20505    2          ELSE
     1596    20506    3             DO;
     1597    20507    3                KX$SL.L3$ = L3$;
     1598    20508    3                KX$L3.LCLNSAP = FPT$CONNECT.LADR;
     1599    20509    3                KX$L3.RMTNSAP = FPT$CONNECT.DEST;
     1600    20510    3                KX$L3.CALL_OPTS.RCVADR = FPT$CONNECT.DSTSNPA;
     1601    20511    3             END;
     1602    20512    2       KX$L3.LCLNSAP.NSAP.LEN = KX$L3.LCLNSAP.NSAP.LEN*2;
     1603    20513    2       KX$L3.RMTNSAP.NSAP.LEN = KX$L3.RMTNSAP.NSAP.LEN*2;
     1604    20514
     1605    20515    2       KX$L3.DFL_OPTS = KX$L3.CALL_OPTS;
     1606    20516    2       KX$L3.CM_OPTS = KX$L3.CALL_OPTS;
     1607    20517        /* change the L3 state to DOWN so that we can tell him to start the call */
     1608    20518
     1609    20519    2       KX$L3.STATE.CURRENT = 5;
     1610    20520    2       RETURN;
     1611    20521
     1612    20522    2   END Y$GETL3;
     1613    20523
     1614    20524    1   Y$COPY: PROC ALTRET;
     1615    20525
     1616    20526    2       KVBSIZ = ( FPT_X25.V_.BYTSIZ + 1 ) / 2;
     1617    20527    2       CALL KVB$GETSYS ( KVBSIZ, Y$ ) WHENALTRETURN
     1618    20528    3             DO;
     1619    20529    3                ALTRETURN;
     1620    20530    3             END;
     1621    20531    2       SUBSTR ( Y$->B$STR, 0, FPT_X25.V_.BYTSIZ ) =
     1622    20532    2          SUBSTR ( FPT_X25.V_.ADR$->B$STR, FPT_X25.V_.BYTX, FPT_X25.V_.BYTSIZ );
     1623    20533    2       RETURN;
     1624    20534
     1625    20535    2   END Y$COPY;
     1626    20536
     1627    20537    1   END KXV$VCNTW;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:60   

PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:61   
--  Include file information  --

   K_REASON_C.:E05TOU  is referenced.
   K_ADDRESS_M.:E05TOU  is referenced.
   KX_MACROS_M.:E05TOU  is referenced.
   KX_DATA_C.:E05TOU  is referenced.
   KX_SCODE_C.:E05TOU  is referenced.
   KX_PERR_C.:E05TOU  is referenced.
   KX_EQUS_E.:E05TOU  is referenced.
   KV_GLBCNS_E.:E05TOU  is referenced.
   KV$GLB.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   KNH_MACRO_C.:E05TOU  is referenced.
   KL_SUPER_C.:E05TOU  is referenced.
   G_JIT_M.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   K_ID_E.:E05TOU  is referenced.
      No diagnostics issued in procedure KXV$VCNTW.

   Procedure KXV$VCNTW requires 3241 words for executable code.
   Procedure KXV$VCNTW requires 154 words of local(AUTO) storage.

    No errors detected in file KXV$VCNTW.:E05TSI    .
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:62   

PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:63   

 Object Unit name= KXV$VCNTW                                  File name= KXV$VCNTW.:E05TOU
 UTS= JUL 30 '97 02:28:54.20 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_LCP6_SYSTEM                               Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size HexSiz  Section name
    0  RoData even  UTS    227     E3  KXV$VCNTW
    1   Proc  even  none  3241    CA9  KXV$VCNTW
    2  RoData even  none    11      B  KXV$VCNTW

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect HexLoc Primary Altret sequence   type   Parms  Name
     1      0   yes    yes     yes      Std        1  KXV$VCNTW

  ****  Data defs  ****

 Sect HexLoc  Name                           Sect HexLoc  Name
    0     81  FPT_TERM_C                         0     85  FPT_CONNECT_C
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:64   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
 yes     yes           Std       2 KVB$GETSYS
 yes     yes           Std       2 KVB$RLSSYS
         yes           Std       1 KHD$SCREECH
 yes     yes           Std       1 KVM$SNDCQ
 yes     yes           Std       1 KXP$PACKET
         yes           Std       7 KXS$SYSLOG
 yes     yes           Std       3 KXS$GETL3
 yes     yes           Std       1 KXV$VCNTW
                       nStd      0 X6A_AUTO_1
                       nStd      0 X6A_ARET
                       nStd      0 X6A_AALT

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     KH_NODE#                              G$JIT$                                KX_SLLIST
     KX_BUF                                KX_PM$                           r    G$ROS$
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:65   


        1        1        /*M* KXV$VCNTW - protocol manager that interface a virtual ciruit with the */
        2        2        /*M*             network layer.                                            */
        3        3        /*T***********************************************************/
        4        4        /*T*                                                         */
        5        5        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        6        6        /*T*                                                         */
        7        7        /*T***********************************************************/
        8        8        /*X*  PLM = 4, IND=3, CTI=3, DCI=6, IAD=0, DTI=6, AND=Y, CSI=3, THI=3, STI=3, DMC=Y
                 8         */
        9        9        /*P* NAME: KXV$VCNTW                 */
       10       10        /*P* PURPOSE: This is the protocol manager which interfaces to
       11       11                      the Network layer on the higher side,
       12       12                      and to a single virtual circuit on
       13       13                      the lower side.        */
       14       14
       15       15        /*F* NAME: KXV$VCNTW                 */
       16       16        /*F* PURPOSE: This is the protocol manager which interfaces to
       17       17                      the Network layer on the higher side,
       18       18                      and to a single virtual circuit on
       19       19                      the lower side.        */
       20       20
       21       21        /*D* NAME: KXV$VCNTW                 */
       22       22        /*D* PURPOSE: This is the protocol manager which interfaces to
       23       23                      the Network layer on the higher side,
       24       24                      and to a single virtual circuit on
       25       25                      the lower side.        */
       26       26        /*D* CALL: CALL KXV$VCNTW ( FPT_X25 );  */
       27       27        /*D* INPUT: FPT_X25 - describes what actions to take.  */
       28       28        /*D* OUTPUT: none                    */
       29       29
       30       30        KXV$VCNTW: PROC ( FPT_X25 ) ALTRET;

     30   1 000000  D380 0000 0000  xent KXV$VCNTW       LNJ,B5   X6A_AUTO_1
          1 000003       009A 0001                       DC       154,1

       31       31        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:66   
       32       32        /*****************************************************************
       33       33        *                                                                *
       34       34        *                           Includes                             *
       35       35        *                                                                *
       36       36        *****************************************************************/
       37       37
       38       38        %INCLUDE K_ID_E;
       39       88        %K#ENTID_E;
       40      107        %K#LYRID_E;
       41      114        %INCLUDE KL_MACRO_C;
       42     3466        %INCLUDE KL_AFCN_C;
       43     3567        %INCLUDE LCP_6;
       44     7846        %INCLUDE CP_6_SUBS;
       45     8386        %INCLUDE G_JIT_M;
       46     8651        %INCLUDE KL_SUPER_C;
       47    11553        %INCLUDE KNH_MACRO_C;
       48    11836        %INCLUDE KH$CHN;
       49    11958        %INCLUDE KV$GLB;
       50    12377        %INCLUDE KV_GLBCNS_E;
       51    12718        %KV#CQ_HNDID_E;
       52    12723        %INCLUDE KX_EQUS_E;
       53    13162        %INCLUDE KX_PERR_C;
       54    13291        %INCLUDE KX_SCODE_C;
       55    13357        %INCLUDE KX_DATA_C;
       56    13425        %INCLUDE KX_MACROS_M;
       57    14196        %INCLUDE K_ADDRESS_M;
       58    14699        %INCLUDE K_REASON_C;
       59    14725        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:67   
       60    14726        /*****************************************************************
       61    14727        *                                                                *
       62    14728        *                           External References                  *
       63    14729        *                                                                *
       64    14730        *****************************************************************/
       65    14731
       66    14732    1   DCL KXS$Q_SYSLOG ENTRY (1);
       67    14733    1   DCL KXS$SYSLOG ENTRY (7);
       68    14734    1   DCL KXC$CQSCN ENTRY (1);
       69    14735    1   DCL KVB$GETSYS ENTRY (2) ALTRET;
       70    14736    1   DCL KVB$GET2NSYS ENTRY (2) ALTRET;
       71    14737    1   DCL KVB$RLSSYS ENTRY (2) ALTRET;
       72    14738    1   DCL KVM$SNDCQ ENTRY (1) ALTRET;
       73    14739    1   DCL KHD$SCREECH ENTRY (1);
       74    14740    1   DCL KHA$ERRLOG ENTRY (2) ALTRET;
       75    14741    1   DCL KXP$PACKET ENTRY (1) ALTRET;
       76    14742    1   DCL KXS$GETL3 ENTRY (3) ALTRET;
       77    14743        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:68   
       78    14744        /*****************************************************************
       79    14745        *                                                                *
       80    14746        *                           Local Equates                        *
       81    14747        *                                                                *
       82    14748        *****************************************************************/
       83    14749
       84    14750        /*****************************************************************
       85    14751        *                                                                *
       86    14752        *                           Actions                              *
       87    14753        *                                                                *
       88    14754        *****************************************************************/
       89    14755
       90    14756        %EQU Y_ACT_NULL#    =  0;
       91    14757        %EQU Y_ACT_SCREECH# =  1;
       92    14758        %EQU Y_ACT_INIT#    =  2;
       93    14759        %EQU Y_ACT_VCUP#    =  3;
       94    14760        %EQU Y_ACT_TERM#    =  4;
       95    14761        %EQU Y_ACT_RLS#     =  5;
       96    14762        %EQU Y_ACT_GETOTPBFR# = 6;
       97    14763        %EQU Y_ACT_INITACK# =  7;
       98    14764        %EQU Y_ACT_INITNAK# =  8;
       99    14765        %EQU Y_ACT_ZAP#     =  9;
      100    14766        %EQU Y_ACT_RLSMAYBE#= 10;
      101    14767        %EQU Y_ACT_MAX#     = 10;
      102    14768        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:69   
      103    14769        /*****************************************************************
      104    14770        *                                                                *
      105    14771        *                           Events                               *
      106    14772        *                                                                *
      107    14773        *****************************************************************/
      108    14774
      109    14775        %EQU Y_EV_DCL#    =  0;
      110    14776        %EQU Y_EV_INTACK# =  1;
      111    14777        %EQU Y_EV_VCUP#   =  2;
      112    14778        %EQU Y_EV_VCLST#  =  3;
      113    14779        %EQU Y_EV_TRMACK# =  4;
      114    14780        %EQU Y_EV_CNCRQS# =  5;
      115    14781        %EQU Y_EV_TERM#   =  6;
      116    14782        %EQU Y_EV_SP1#    =  7;
      117    14783        %EQU Y_EV_SP2#    =  8;
      118    14784        %EQU Y_EV_SP3#    =  9;
      119    14785        %EQU Y_EV_MAX#    =  9;
      120    14786        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:70   
      121    14787        /*****************************************************************
      122    14788        *                                                                *
      123    14789        *                           States                               *
      124    14790        *                                                                *
      125    14791        *****************************************************************/
      126    14792
      127    14793        %EQU Y_ST_DCL#     =  0;
      128    14794        %EQU Y_ST_INIT_WIA#=  1;
      129    14795        %EQU Y_ST_INIT_WVC#=  2;
      130    14796        %EQU Y_ST_NORMAL#  =  3;
      131    14797        %EQU Y_ST_TERM#    =  4;
      132    14798        %EQU Y_ST_TERM_WIA#=  5;
      133    14799        %EQU Y_ST_TERM_DCL#=  6;
      134    14800        %EQU Y_ST_CNC_WVC# =  7;
      135    14801        %EQU Y_ST_SP1#     =  8;
      136    14802        %EQU Y_ST_SP2#     =  9;
      137    14803        %EQU Y_ST_SP3#     = 10;
      138    14804        %EQU Y_ST_MAX#     = 10;
      139    14805        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:71   
      140    14806        /*****************************************************************
      141    14807        *                                                                *
      142    14808        *                           Auto                                 *
      143    14809        *                                                                *
      144    14810        *****************************************************************/
      145    14811
      146    14812        %FPT_X25 ( STCLASS = );
      147    14856
      148    14857    1   DCL SL$ PTR;
      149    14858    1   DCL L3$ PTR;
      150    14859    1   DCL MSG$ PTR;
      151    14860    1   DCL FPT$ PTR;
      152    14861    1   DCL EVENT UBIN;
      153    14862    1   DCL ACTION UBIN;
      154    14863    1   DCL STATE UBIN;
      155    14864    1   DCL Y$ PTR; /* For calling KVB, so PL6 can trash its memory */
      156    14865    1   DCL BYTX UBIN;
      157    14866    1   DCL KVBSIZ UBIN;
      158    14867        %FPT_X25 ( FPTN = CALL_FPT, STCLASS = );
      159    14911        %KNH$MESS ( FPTN = KNH_MESS, STCLASS = );
      160    14960        %VLP_ERRCODE(STCLASS=AUTO , FPTN=ERCOD) ;
      161    15006        %FPT_TERM ( FPTN = FPT@TERM, STCLASS = );
      162    15028        %FPT_TERM_ACK ( FPTN = FPT@TERM_ACK, STCLASS = );
      163    15050        %FPT_CONNECT ( FPTN = FPT@CONNECT, ADRTYP = NET, STCLASS = );
      164    15221        %FPT_CONNECT_ACK ( FPTN = FPT@CONNECT_ACK, STCLASS = );
      165    15270        %FPT_RESET ( FPTN = FPT@RESET, STCLASS = );
      166    15293    1   DCL CTX$ PTR;
      167    15294    1   DCL PRVCTX$ PTR;
      168    15295    1   DCL 1 KV@SNDCQ ALIGNED,
      169    15296    1         2 MSG_ (0:5),
      170    15297    1           3 ADR$ PTR,
      171    15298    1           3 BYTX UBIN WORD,
      172    15299    1           3 BYTSIZ UBIN WORD;
      173    15300    1   DCL OUTLINK$ PTR;
      174    15301    1   DCL CAL$_IS_L3$ BIT(1);
      175    15302
      176    15303        %EQU TL3CHN = %CHARTEXT('KX$TL3.CHN$->KH$CHN');
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:72   
      177    15304        %EQU L3CHN = %CHARTEXT('KX$L3.CHN$->KH$CHN');
      178    15305        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:73   
      179    15306        /*****************************************************************
      180    15307        *                                                                *
      181    15308        *                           Based                                *
      182    15309        *                                                                *
      183    15310        *****************************************************************/
      184    15311
      185    15312        %FPT_CONNECT_ACK ( FPTN = FPT$CONNECT_ACK, STCLASS = "BASED(FPT$)" );
      186    15361        %FPT_CONNECT ( FPTN = FPT$CONNECT, ADRTYP = NET, STCLASS = "BASED(FPT$)" );
      187    15532        %G$JIT ( STCLASS = "BASED(G$JIT$)" );
      188    15946        %KH$CHN;
      189    16070        %KX$SL ( STCLASS = "BASED(SL$)" );
      190    16109        %KX$L3 ( STCLASS = "BASED(L3$)" );
      191    16512        %KX$L2;
      192    16879    1   DCL B$STR CHAR(2000) BASED;
      193    16880    1   DCL INPDAT_ARY (0:4095) UBIN BYTE CALIGNED BASED (FPT_X25.V_.ADR$);
      194    16881        %VLP_SCODE ( FPTN=B$SCODE, STCLASS=BASED );
      195    16942        %FPT_RESET ( FPTN = FPT$RESET, STCLASS = "BASED(FPT$)" );
      196    16965        %KNH$MESS ( FPTN = KNH$MESS, STCLASS = BASED );
      197    17014        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:74   
      198    17015        /*****************************************************************
      199    17016        *                                                                *
      200    17017        *                           Constant                             *
      201    17018        *                                                                *
      202    17019        *****************************************************************/
      203    17020
      204    17021        /*****************************************************************
      205    17022        *                                                                *
      206    17023        *                           State table                          *
      207    17024        *                                                                *
      208    17025        *****************************************************************/
      209    17026
      210    17027    1   DCL 1 STATE_TABLE CONSTANT,
      211    17028    1         2 NEXT_STATE (0:%(%(%Y_EV_MAX# + 1) * %(%Y_ST_MAX# + 1)-1)) UBIN(8) UNAL
      212    17029    1             INIT(
      213    17030        /*
      214    17031            DCL - next state
      215    17032               DCL is the initial state when context is allocated.  The
      216    17033               only valid transition out is on event DCL, which states that
      217    17034               a VC has been associated with this Network Connection.
      218    17035        */
      219    17036    1   %Y_ST_INIT_WIA#,%Y_ST_DCL#*4,%Y_ST_CNC_WVC#,%Y_ST_DCL#*4,
      220    17037        /*
      221    17038            INIT_WIA - next state
      222    17039               INIT_WIA is the state after sending an INIT to the Network
      223    17040               layer, but before receiving an INITACK.
      224    17041        */
      225    17042    1   %Y_ST_INIT_WIA#,%Y_ST_INIT_WVC#,%Y_ST_INIT_WIA#,
      226    17043    1   %Y_ST_TERM_WIA#,%Y_ST_INIT_WIA#*6,
      227    17044        /*
      228    17045            INIT_WVC - next state
      229    17046               INIT_WVC is the state for connection pending - the VC
      230    17047               is in the establishment phase, but has not completed it yet.
      231    17048        */
      232    17049    1   %Y_ST_INIT_WVC#*2,%Y_ST_NORMAL#,
      233    17050    1   %Y_ST_TERM#,%Y_ST_INIT_WVC#*6,
      234    17051        /*
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:75   
      235    17052            NORMAL - next state
      236    17053               NORMAL is the data transfer state.
      237    17054        */
      238    17055    1   %Y_ST_NORMAL#*3,%Y_ST_TERM#,%Y_ST_NORMAL#*6,
      239    17056        /*
      240    17057            TERM - next state
      241    17058               TERM means that a TERM has been sent to the Network layer,
      242    17059               but the TERM_ACK has not yet been received.
      243    17060        */
      244    17061    1   %Y_ST_TERM_DCL#,%Y_ST_TERM#*3,%Y_ST_DCL#,%Y_ST_TERM#*5,
      245    17062        /*
      246    17063            TERM_WIA - next state
      247    17064               TERM_WIA means that the circuit is cleared while we are waiting
      248    17065               for the INIT_ACK from the network layer.
      249    17066        */
      250    17067    1   %Y_ST_INIT_WIA#,%Y_ST_TERM#,%Y_ST_TERM_WIA#*8,
      251    17068        /*
      252    17069            TERM_DCL - next state
      253    17070               TERM_DCL means that a TERM is in progress with the Network
      254    17071               layer, but once it is complete an INIT will be started
      255    17072               since the VC is attempting to reconnect.
      256    17073        */
      257    17074    1   %Y_ST_TERM_DCL#*3,%Y_ST_TERM#,%Y_ST_INIT_WIA#,%Y_ST_TERM_DCL#*5,
      258    17075        /*
      259    17076            CNC_WVC - next state
      260    17077               CNC_WVC means an INIT was received and a VC establishment is in
      261    17078               progress.
      262    17079        */
      263    17080    1   %Y_ST_CNC_WVC#*2,%Y_ST_NORMAL#,%Y_ST_CNC_WVC#*7,
      264    17081        /*
      265    17082            SP1 - next state
      266    17083               SP1 - spare state
      267    17084        */
      268    17085    1   %Y_ST_SP1#*10,
      269    17086        /*
      270    17087            SP2 - next state
      271    17088               SP2 - spare state
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:76   
      272    17089        */
      273    17090    1   %Y_ST_SP2#*10,
      274    17091        /*
      275    17092            SP3 - next state
      276    17093               SP3 - spare state
      277    17094        */
      278    17095    1   %Y_ST_SP3#*10 ),
      279    17096        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:77   
      280    17097    1         2 ACTION (0:%(%(%Y_EV_MAX# + 1) * %(%Y_ST_MAX# + 1)-1)) UBIN(8) UNAL
      281    17098    1             INIT(
      282    17099        /*
      283    17100            DCL - actions
      284    17101        */
      285    17102    1   %Y_ACT_INIT#,%Y_ACT_SCREECH#*2,%Y_ACT_RLS#,%Y_ACT_SCREECH#,
      286    17103    1   %Y_ACT_VCUP#,%Y_ACT_SCREECH#*4,
      287    17104        /*
      288    17105            INIT_WIA - actions
      289    17106        */
      290    17107    1   %Y_ACT_SCREECH#,%Y_ACT_VCUP#,%Y_ACT_SCREECH#,
      291    17108    1   %Y_ACT_RLSMAYBE#,%Y_ACT_SCREECH#,%Y_ACT_VCUP#,%Y_ACT_SCREECH#*4,
      292    17109        /*
      293    17110            INIT_WVC - actions
      294    17111        */
      295    17112    1   %Y_ACT_VCUP#,%Y_ACT_SCREECH#,%Y_ACT_GETOTPBFR#,%Y_ACT_TERM#,
      296    17113    1   %Y_ACT_SCREECH#*2,%Y_ACT_ZAP#,%Y_ACT_SCREECH#*3,
      297    17114        /*
      298    17115            NORMAL - actions
      299    17116        */
      300    17117    1   %Y_ACT_SCREECH#*3,%Y_ACT_TERM#,%Y_ACT_SCREECH#*2,
      301    17118    1   %Y_ACT_ZAP#,%Y_ACT_SCREECH#*3,
      302    17119        /*
      303    17120            TERM - actions
      304    17121        */
      305    17122    1   %Y_ACT_NULL#,%Y_ACT_SCREECH#*2,%Y_ACT_NULL#,%Y_ACT_RLS#,
      306    17123    1   %Y_ACT_SCREECH#,%Y_ACT_NULL#,%Y_ACT_SCREECH#*3,
      307    17124        /*
      308    17125            TERM_WIA - actions
      309    17126        */
      310    17127    1   %Y_ACT_NULL#,%Y_ACT_TERM#,%Y_ACT_SCREECH#,%Y_ACT_NULL#,%Y_ACT_SCREECH#*2,
      311    17128    1   %Y_ACT_SCREECH#*4,
      312    17129        /*
      313    17130            TERM_DCL - actions
      314    17131        */
      315    17132    1   %Y_ACT_SCREECH#*3,%Y_ACT_NULL#,%Y_ACT_INIT#,
      316    17133    1   %Y_ACT_SCREECH#,%Y_ACT_NULL#,%Y_ACT_SCREECH#*3,
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:78   
      317    17134        /*
      318    17135            CNC_WVC - actions
      319    17136        */
      320    17137    1   %Y_ACT_VCUP#,%Y_ACT_SCREECH#,%Y_ACT_INITACK#,%Y_ACT_INITNAK#,%Y_ACT_SCREECH#*6,
      321    17138        /*
      322    17139            SP1, SP2, SP3 - actions
      323    17140        */
      324    17141    1   %Y_ACT_SCREECH#*30 );
      325    17142        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:79   
      326    17143        /*****************************************************************
      327    17144        *                                                                *
      328    17145        *                           VLP_ERRCODEs                         *
      329    17146        *                                                                *
      330    17147        *****************************************************************/
      331    17148
      332    17149        %VLP_ERRCODE (STCLASS=CONSTANT,FCG='KX',MID='V',SEV=%G_WRSYSLOG_SEV_INFO#,
      333    17150                           FPTN = Y_SHR_PKT,
      334    17151                           ERR# = %E_KXV_SHRPKT# );
      335    17197        /*E*   ERROR:      KXV-E_KXV_SHRPKT#-0
      336    17198               MESSAGE:    SL received packet < 3 bytes long.
      337    17199        */
      338    17200        %VLP_ERRCODE (STCLASS=CONSTANT,FCG='KX',MID='V',SEV=%G_WRSYSLOG_SEV_INFO#,
      339    17201                           FPTN = Y_UNB_PKT,
      340    17202                           ERR# = %E_KXV_UNBPKT# );
      341    17248        /*E*   ERROR:      KXV-E_KXV_UNBPKT#-0
      342    17249               MESSAGE:    SL received packet that didn't balance in length.
      343    17250        */
      344    17251
      345    17252        %VLP_SCODE (FPTN=Y_NO_MEM,STCLASS=CONSTANT,FCG=KX,MID=V,ERR#=%S$KX_NO_MEM#);
      346    17313        %VLP_SCODE (FPTN=Y_UNKEVT,STCLASS=CONSTANT,FCG=KX,MID=V,ERR#=%S$KX_SL_UNKEVT#);
      347    17374        %VLP_SCODE (FPTN=Y_ACTSCR,STCLASS=CONSTANT,FCG=KX,MID=V,ERR#=%S$KX_SL_ACTSCR#);
      348    17435        %VLP_SCODE (FPTN=Y_BADSLLIST,STCLASS=CONSTANT,FCG=KX,MID=V,ERR#=%S$KX_BADSLLIST#);
      349    17496        %VLP_SCODE (FPTN=Y_BADPRM,STCLASS=CONSTANT,FCG=KX,MID=V,ERR#=%S$KX_SL_BADPRM#);
      350    17557        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:80   
      351    17558        /*****************************************************************
      352    17559        *                                                                *
      353    17560        *                           Generic constant                     *
      354    17561        *                                                                *
      355    17562        *****************************************************************/
      356    17563
      357    17564        %FPT_TERM ( FPTN = FPT_TERM_C, STCLASS = "CONSTANT SYMDEF" );
      358    17586        %FPT_CONNECT ( FPTN = FPT_CONNECT_C, STCLASS = "CONSTANT SYMDEF",
      359    17587                       TYPE = LINK, ADRTYP = NET );
      360    17758        %KX$SL (FPTN = KX_SL, STCLASS = CONSTANT);
      361    17797    1   DCL KH_NODE# UBIN SYMREF ;
      362    17798        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:81   
      363    17799        /*****************************************************************
      364    17800        *                                                                *
      365    17801        *                           Static                               *
      366    17802        *                                                                *
      367    17803        *****************************************************************/
      368    17804
      369    17805    1   DCL G$JIT$ PTR SYMREF;
      370    17806        %KX_DATA;
      371    18496        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:82   
      372    18497        /*****************************************************************
      373    18498        *                                                                *
      374    18499        *                           Procedure                            *
      375    18500        *                                                                *
      376    18501        *****************************************************************/
      377    18502    1       KV@SNDCQ = '0'B;

  18502   1 000005  5C30                                 LDV,R5   48
          1 000006  0021                                 ALR      ;
          1 000007       4178 0000                                ALPHANUM('0000'X,IMO,,1),;
          1 000009       4007 006E                                ALPHANUM(KV@SNDCQ,AUTO,,R5,FILL)

      378    18503    1       KNH_MESS = '0'B;

  18503   1 00000B  5C10                                 LDV,R5   16
          1 00000C  0021                                 ALR      ;
          1 00000D       4178 0000                                ALPHANUM('0000'X,IMO,,1),;
          1 00000F       4007 0025                                ALPHANUM(KNH_MESS,AUTO,,R5,FILL)

      379    18504    1       KV@SNDCQ.MSG_.ADR$ (0) = ADDR ( KNH_MESS );

  18504   1 000011  EBC7 0025                            LAB,B6   KNH_MESS,AUTO
          1 000013  437F                                 CSYNC    s:18504+1,SPREL
          1 000014  EFC7 006E                            STB,B6   KV@SNDCQ,AUTO

      380    18505    1       KV@SNDCQ.MSG_.BYTSIZ (0) = (LENGTHC ( KNH_MESS ) + 3)/4*4;

  18505   1 000016  DF47 0071                            STR,R5   KV@SNDCQ+3,AUTO

      381    18506    1       IF FPT_X25.EVN = %KX_CM_EV_CNCRQS#

  18506   1 000018  DCC7 0004                            LDB,B5   @FPT_X25,AUTO
          1 00001A  E805                                 LDR,R6   ,B5
          1 00001B  6D17                                 CMV,R6   23
          1 00001C  0981 000A                            BNE      s:18513,PREL

      382    18507    1          THEN
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:83   
      383    18508    2             DO;

      384    18509    2                OUTLINK$ = FPT_X25.RCV$;

  18509   1 00001E  CCC5 0003                            LDB,B4   3,B5
          1 000020  CFC7 0086                            STB,B4   OUTLINK$,AUTO

      385    18510    2                FPT_X25.RCV$ = ADDR(NIL);

  18510   1 000022  BB80 0000 0000                       LAB,B3   0
          1 000025  BFC5 0003                            STB,B3   3,B5

      386    18511    2             END;

      387    18512
      388    18513    1       SL$ = FPT_X25.RCV$;

  18513   1 000027  ECC5 0003                            LDB,B6   3,B5
          1 000029  EFC7 0006                            STB,B6   SL$,AUTO

      389    18514    1       L3$ = FPT_X25.CAL$;

  18514   1 00002B  CCC5 0001                            LDB,B4   1,B5
          1 00002D  CFC7 0008                            STB,B4   L3$,AUTO

      390    18515    1       FPT$ = FPT_X25.PRM1$;

  18515   1 00002F  BCC5 0007                            LDB,B3   7,B5
          1 000031  BFC7 000C                            STB,B3   FPT$,AUTO

      391    18516    1       MSG$ = FPT_X25.V_.ADR$;

  18516   1 000033  ACC5 000B                            LDB,B2   11,B5
          1 000035  AFC7 000A                            STB,B2   MSG$,AUTO

      392    18517    1       IF L3$ = ADDR(NIL) AND SL$ ~= ADDR(NIL)

PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:84   
  18517   1 000037  8DC7 0008                            CMN      L3$,AUTO
          1 000039  0981 0009                            BNE      s:18521,PREL
          1 00003B  8DC7 0006                            CMN      SL$,AUTO
          1 00003D  0901 0005                            BE       s:18521,PREL

      393    18518    1          THEN
      394    18519    1             L3$ = KX$SL.L3$;

  18519   1 00003F  9CC6 0004                            LDB,B1   4,B6
          1 000041  9FC7 0008                            STB,B1   L3$,AUTO

      395    18520
      396    18521    1       IF SL$ = ADDR(NIL)

  18521   1 000043  8DC7 0006                            CMN      SL$,AUTO
          1 000045  0981 00B5                            BNE      s:18587,PREL

      397    18522    1          THEN
      398    18523    2             DO;

      399    18524    2                IF ( FPT_X25.EVN ~= %KX_CM_EV_DCL# AND

  18524   1 000047  E805                                 LDR,R6   ,B5
          1 000048  6D01                                 CMV,R6   1
          1 000049  0901 0004                            BE       s:18524+7,PREL
          1 00004B  6D02                                 CMV,R6   2
          1 00004C  0981 0005                            BNE      s:18524+11,PREL
          1 00004E  8DC7 0008                            CMN      L3$,AUTO
          1 000050  0981 000D                            BNE      s:18532,PREL
          1 000052  6D17                                 CMV,R6   23
          1 000053  0901 000A                            BE       s:18532,PREL

      400    18525    2                   FPT_X25.EVN ~= %KX_CM_EV_RMTDCL# OR L3$ = ADDR(NIL) )
      401    18526    2                   AND FPT_X25.EVN ~= %KX_CM_EV_CNCRQS#
      402    18527    2                   THEN
      403    18528        /*S* SCREECH_CODE: KXV-S$KX_SL_BADPRM#
      404    18529             MESSAGE: KXV received a call with bad parameters.
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:85   
      405    18530        */
      406    18531    2                      CALL KHD$SCREECH ( Y_BADPRM );

  18531   1 000055  BB80 0000 0000  02                   LAB,B3   0
          1 000058  CBF0 0100                            LAB,B4   256,IMO
          1 00005A  E380 0000 0000  xent                 LNJ,B6   KHD$SCREECH
          1 00005D       0001                            DC       s:18532,PREL

      407    18532    2                CALL KVB$GETSYS (SIZEW(KX$SL),Y$) ALTRET ( SCR_NOMEM );

  18532   1 00005E  EBF0 0031                            LAB,B6   49,IMO
          1 000060  DBC7 0011                            LAB,B5   Y$,AUTO
          1 000062  DFC7 0096                            STB,B5   I+4,AUTO
          1 000064  EFC7 0094                            STB,B6   I+2,AUTO
          1 000066  BBC7 0094                            LAB,B3   I+2,AUTO
          1 000068  CBF0 0200                            LAB,B4   512,IMO
          1 00006A  E380 0000 0000  xent                 LNJ,B6   KVB$GETSYS
          1 00006D       074A                            DC       s:19354,PREL

      408    18533        /*
      409    18534            return the SL$ to the calling L3.
      410    18535        */
      411    18536    2                SL$ = Y$;

  18536   1 00006E  ECC7 0011                            LDB,B6   Y$,AUTO
          1 000070  EFC7 0006                            STB,B6   SL$,AUTO

      412    18537    2                FPT_X25.RCV$ = SL$;

  18537   1 000072  DCC7 0004                            LDB,B5   @FPT_X25,AUTO
          1 000074  EFC5 0003                            STB,B6   3,B5

      413    18538    2                KX$SL = KX_SL;

  18538   1 000076  AB80 0000 00B2  00                   LAB,B2   KX_SL
          1 000079  2C00                                 LDV,R2   0
          1 00007A  6C62                                 LDV,R6   98
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:86   
          1 00007B  BCC7 0006                            LDB,B3   SL$,AUTO
          1 00007D  3C00                                 LDV,R3   0
          1 00007E  0008                                 MMM

      414    18539        /*    put this SL$ into the linked list KX_SLLIST.
      415    18540        */
      416    18541    2                IF KX_SLLIST.HD$ = ADDR(NIL)

  18541   1 00007F  8D80 0000 0000  xsym                 CMN      KX_SLLIST
          1 000082  0981 0008                            BNE      s:18545,PREL

      417    18542    2                   THEN
      418    18543    2                      KX_SLLIST.HD$ = SL$;

  18543   1 000084  ECC7 0006                            LDB,B6   SL$,AUTO
          1 000086  EF80 0000 0000  xsym                 STB,B6   KX_SLLIST
          1 000089  0F81 0008                            B        s:18546,PREL

      419    18544    2                   ELSE
      420    18545    2                      KX_SLLIST.TL$ -> KX$SL.LNK$ = SL$;

  18545   1 00008B  ECC7 0006                            LDB,B6   SL$,AUTO
          1 00008D  CC80 0000 0002  xsym                 LDB,B4   KX_SLLIST+2
          1 000090  EFC4 0002                            STB,B6   2,B4

      421    18546    2                KX$SL.LNK$ = ADDR(NIL);

  18546   1 000092  EB80 0000 0000                       LAB,B6   0
          1 000095  CCC7 0006                            LDB,B4   SL$,AUTO
          1 000097  EFC4 0002                            STB,B6   2,B4

      422    18547    2                KX_SLLIST.TL$ = SL$;

  18547   1 000099  ECC7 0006                            LDB,B6   SL$,AUTO
          1 00009B  EF80 0000 0002  xsym                 STB,B6   KX_SLLIST+2

      423    18548        /*    initialize this context  */
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:87   
      424    18549    2                IF L3$ ~= ADDR(NIL)

  18549   1 00009E  8DC7 0008                            CMN      L3$,AUTO
          1 0000A0  0901 0031                            BE       s:18570,PREL

      425    18550    2                   THEN
      426    18551    3                      DO;

      427    18552    3                         KX$L3.CM$ = SL$;

  18552   1 0000A2  CCC7 0008                            LDB,B4   L3$,AUTO
          1 0000A4  EFC4 0004                            STB,B6   4,B4

      428    18553    3                         KX$SL.LCLNOD = KH_NODE#;

  18553   1 0000A6  E800 0000 0000  xsym                 LDR,R6   KH_NODE#
          1 0000A9  CCC7 0006                            LDB,B4   SL$,AUTO
          1 0000AB  EAC4 0008                            SRM,R6,'00FF'X    8,B4
          1 0000AD       00FF

      429    18554    3                         IF FPT_X25.EVN = %KX_CM_EV_RMTDCL#

  18554   1 0000AE  D805                                 LDR,R5   ,B5
          1 0000AF  5D02                                 CMV,R5   2
          1 0000B0  0981 0012                            BNE      s:18563,PREL

      430    18555    3                            THEN
      431    18556    4                               DO;

      432    18557    4                                  KX$L3.TYP = %KX_VC_TYP_INBOUND#;

  18557   1 0000B2  BCC7 0008                            LDB,B3   L3$,AUTO
          1 0000B4  4C05                                 LDV,R4   5
          1 0000B5  CF43 0013                            STR,R4   19,B3

      433    18558    4                                  IF FPT_X25.V_.BYTSIZ > 0

PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:88   
  18558   1 0000B7  D845 000E                            LDR,R5   14,B5
          1 0000B9  5901 0009                            BEZ,R5   s:18563,PREL

      434    18559    4                                     THEN
      435    18560    4                                        KX$L3.NOD =

  18560   1 0000BB  ACC5 000B                            LDB,B2   11,B5
          1 0000BD  B845 000D                            LDR,R3   13,B5
          1 0000BF  3E01                                 ADV,R3   1
          1 0000C0  A2B2                                 LLH,R2   ,B2,R3
          1 0000C1  A7C3 0012                            STH,R2   18,B3

      436    18561    4                                           INPDAT_ARY ( FPT_X25.V_.BYTX + 1 );
      437    18562    4                               END;

      438    18563    3                         KX$SL.RMTNOD = KX$L3.NOD;

  18563   1 0000C3  BCC7 0008                            LDB,B3   L3$,AUTO
          1 0000C5  D2C3 0012                            LLH,R5   18,B3
          1 0000C7  D7C4 0009                            STH,R5   9,B4

      439    18564    3                         KX$SL.L3$ = L3$;

  18564   1 0000C9  BCC7 0008                            LDB,B3   L3$,AUTO
          1 0000CB  BFC4 0004                            STB,B3   4,B4

      440    18565    3                         FPT_X25.PRM1 = %KX_L3_TOACT_RSTRTR#;

  18565   1 0000CD  5C03                                 LDV,R5   3
          1 0000CE  DF45 0005                            STR,R5   5,B5

      441    18566    3                      END;

  18566   1 0000D0  0F81 002A                            B        s:18587,PREL

      442    18567    2                   ELSE
      443    18568    3                      DO;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:89   

      444    18569        /*    this must be a CNCRQS.    */
      445    18570    3                         KX$SL.LDCTX = FPT_X25.PRM1;

  18570   1 0000D2  E845 0005                            LDR,R6   5,B5
          1 0000D4  EF46 000B                            STR,R6   11,B6

      446    18571    3                         IF FPT_X25.V_.BYTSIZ > 0

  18571   1 0000D6  D845 000E                            LDR,R5   14,B5
          1 0000D8  5901 0010                            BEZ,R5   s:18579,PREL

      447    18572    3                            THEN
      448    18573    4                               DO;

      449    18574    4                                  CALL Y$COPY ALTRET ( SCR_NOMEM );

  18574   1 0000DA  E3C0 0B99                            LNJ,B6   s:0,PREL
          1 0000DC       06DB                            DC       s:19354,PREL

      450    18575    4                                  KX$SL.CALUSRDAT$ = Y$;

  18575   1 0000DD  ECC7 0011                            LDB,B6   Y$,AUTO
          1 0000DF  DCC7 0006                            LDB,B5   SL$,AUTO
          1 0000E1  EFC5 0028                            STB,B6   40,B5

      451    18576    4                                  KX$SL.CALUSRDATBYTSIZ = FPT_X25.V_.BYTSIZ;

  18576   1 0000E3  CCC7 0004                            LDB,B4   @FPT_X25,AUTO
          1 0000E5  E844 000E                            LDR,R6   14,B4
          1 0000E7  EF45 002A                            STR,R6   42,B5

      452    18577    4                               END;

      453    18578        /*   get and initialize a L3 context  */
      454    18579    3                         CALL Y$GETL3 ( OUTLINK$, 0 ) WHENALTRETURN

PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:90   
  18579   1 0000E9  EBF0 0000                            LAB,B6   0,IMO
          1 0000EB  EFC7 008E                            STB,B6   @L2$+2,AUTO
          1 0000ED  DBC7 0086                            LAB,B5   OUTLINK$,AUTO
          1 0000EF  DFC7 008C                            STB,B5   CAL$_IS_L3$+4,AUTO
          1 0000F1  E3C0 0A62                            LNJ,B6   s:0,PREL
          1 0000F3       0003                            DC       s:18581,PREL
          1 0000F4  0F81 0006                            B        s:18587,PREL

      455    18580    4                               DO;

      456    18581    4                                  FPT@CONNECT_ACK.REASON = %K_REASON_NOLDCT;

  18581   1 0000F6  6C01                                 LDV,R6   1
          1 0000F7  EF47 0062                            STR,R6   FPT@CONNECT_ACK,AUTO

      457    18582    4                                  GOTO SND_INITRSP;

  18582   1 0000F9  0F81 079C                            B        s:19432,PREL

      458    18583    4                               END;
      459    18584    3                      END;

      460    18585    2             END;

      461    18586
      462    18587    1       CALL_FPT = '0'B;

  18587   1 0000FB  5C20                                 LDV,R5   32
          1 0000FC  0021                                 ALR      ;
          1 0000FD       4178 0000                                ALPHANUM('0000'X,IMO,,1),;
          1 0000FF       4007 0015                                ALPHANUM(CALL_FPT,AUTO,,R5,FILL)

      463    18588    1       CALL_FPT.CAL$ = SL$;

  18588   1 000101  ECC7 0006                            LDB,B6   SL$,AUTO
          1 000103  437F                                 CSYNC    s:18588+1,SPREL
          1 000104  EFC7 0016                            STB,B6   CALL_FPT+1,AUTO
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:91   

      464    18589    1       CALL_FPT.RCV$ = L3$;

  18589   1 000106  DCC7 0008                            LDB,B5   L3$,AUTO
          1 000108  DFC7 0018                            STB,B5   CALL_FPT+3,AUTO

      465    18590        /*
      466    18591            initialize structures used to send CQ messages.
      467    18592        */
      468    18593    1       KNH_MESS.LDCTX = KX$SL.LDCTX;

  18593   1 00010A  E846 000B                            LDR,R6   11,B6
          1 00010C  EF47 0026                            STR,R6   KNH_MESS+1,AUTO

      469    18594    1       KNH_MESS.UID$ = SL$;

  18594   1 00010E  EFC7 0027                            STB,B6   KNH_MESS+2,AUTO

      470    18595    1       KNH_MESS.UIDX.CQ_HNDID = %KV#CQ_HNDID_SL;

  18595   1 000110  4C01                                 LDV,R4   1
          1 000111  C7C7 0027                            STH,R4   KNH_MESS+2,AUTO

      471    18596
      472    18597    1       IF FPT_X25.EVN = %KX_CM_EV_CHKSCQ#

  18597   1 000113  CCC7 0004                            LDB,B4   @FPT_X25,AUTO
          1 000115  B804                                 LDR,R3   ,B4
          1 000116  3D16                                 CMV,R3   22
          1 000117  0981 0064                            BNE      s:18637,PREL

      473    18598    1          THEN
      474    18599    2             DO;

      475    18600        /*
      476    18601           This call from KXS$TMR every second gives us the opportunity to retry
      477    18602           any CQ messages that failed to make it in the SCQ.
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:92   
      478    18603        */
      479    18604    3                DO WHILE ( SL$ ~= ADDR(NIL) );

  18604   1 000119  0F81 0034                            B        s:18621,PREL

      480    18605    3                   KNH_MESS.LDCTX = KX$SL.LDCTX;

  18605   1 00011B  ECC7 0006                            LDB,B6   SL$,AUTO
          1 00011D  E846 000B                            LDR,R6   11,B6
          1 00011F  EF47 0026                            STR,R6   KNH_MESS+1,AUTO

      481    18606    3                   KNH_MESS.UID$ = SL$;

  18606   1 000121  EFC7 0027                            STB,B6   KNH_MESS+2,AUTO

      482    18607    3                   KNH_MESS.UIDX.CQ_HNDID = %KV#CQ_HNDID_SL;

  18607   1 000123  5C01                                 LDV,R5   1
          1 000124  D7C7 0027                            STH,R5   KNH_MESS+2,AUTO

      483    18608    3                   IF KX$SL.SNDINT_ALTRET AND NOT KX$SL.REDIRECT

  18608   1 000126  82C6 0009                            LB,'0010'X        9,B6
  18608   1 000128       0010
          1 000129  0581 0005                            BBF      s:18611,PREL
          1 00012B  89C6 000A                            CMZ      10,B6
          1 00012D  0881 06B6                            BAGE     s:19374,PREL

      484    18609    3                      THEN
      485    18610    3                         GOTO SND_INIT;
      486    18611    3                   IF KX$SL.SNDTRM_ALTRET AND NOT KX$SL.REDIRECT

  18611   1 00012F  82C6 0009                            LB,'0008'X        9,B6
  18611   1 000131       0008
          1 000132  0581 0005                            BBF      s:18614,PREL
          1 000134  89C6 000A                            CMZ      10,B6
          1 000136  0881 0829                            BAGE     s:19502,PREL
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:93   

      487    18612    3                      THEN
      488    18613    3                         GOTO SND_TERM;
      489    18614    3                   IF KX$SL.SNDINTACK_ALTRET AND NOT KX$SL.REDIRECT

  18614   1 000138  82C6 0009                            LB,'0004'X        9,B6
  18614   1 00013A       0004
          1 00013B  0581 0005                            BBF      s:18617,PREL
          1 00013D  89C6 000A                            CMZ      10,B6
          1 00013F  0881 073C                            BAGE     s:19416,PREL

      490    18615    3                      THEN
      491    18616    3                         GOTO SND_INITACK;
      492    18617    3                   IF KX$SL.SNDINTNAK_ALTRET AND NOT KX$SL.REDIRECT

  18617   1 000141  82C6 0009                            LB,'0002'X        9,B6
  18617   1 000143       0002
          1 000144  0581 0005                            BBF      s:18620,PREL
          1 000146  89C6 000A                            CMZ      10,B6
          1 000148  0881 0742                            BAGE     s:19425,PREL

      493    18618    3                      THEN
      494    18619    3                         GOTO SND_INITNAK;
      495    18620    3                   SL$ = KX$SL.LNK$;

  18620   1 00014A  DCC6 0002                            LDB,B5   2,B6
          1 00014C  DFC7 0006                            STB,B5   SL$,AUTO

      496    18621    3                END;

  18621   1 00014E  8DC7 0006                            CMN      SL$,AUTO
          1 000150  09CB                                 BNE      s:18605,SPREL

      497    18622    2                SL$ = KX_SLLIST.HD$;

  18622   1 000151  EC80 0000 0000  xsym                 LDB,B6   KX_SLLIST
          1 000154  EFC7 0006                            STB,B6   SL$,AUTO
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:94   

      498    18623    2                CALL_FPT.EVN = %KX_P_EV_REDRQS#;

  18623   1 000156  5C15                                 LDV,R5   21
          1 000157  DF47 0015                            STR,R5   CALL_FPT,AUTO

      499    18624    3                DO WHILE ( SL$ ~= ADDR(NIL) );

  18624   1 000159  0F81 001C                            B        s:18633,PREL

      500    18625    3                   IF KX$SL.SNDDAT_ALTRET AND KX$SL.STATE = %Y_ST_NORMAL#

  18625   1 00015B  ECC7 0006                            LDB,B6   SL$,AUTO
          1 00015D  82C6 0009                            LB,'0020'X        9,B6
          1 00015F       0020
          1 000160  0581 000F                            BBF      s:18632,PREL
          1 000162  E846 000C                            LDR,R6   12,B6
          1 000164  6D03                                 CMV,R6   3
          1 000165  0981 000A                            BNE      s:18632,PREL

      501    18626    3                      THEN
      502    18627    4                         DO;

      503    18628    4                            CALL_FPT.CAL$ = SL$;

  18628   1 000167  EFC7 0016                            STB,B6   CALL_FPT+1,AUTO

      504    18629    4                            CALL_FPT.RCV$ = KX$SL.L3$;

  18629   1 000169  DCC6 0004                            LDB,B5   4,B6
          1 00016B  DFC7 0018                            STB,B5   CALL_FPT+3,AUTO

      505    18630    4                            CALL Y$CAL_KXP;

  18630   1 00016D  E3C0 09A9                            LNJ,B6   s:0,PREL
          1 00016F       0001                            DC       s:18632,PREL

PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:95   
      506    18631    4                         END;

      507    18632    3                   SL$ = KX$SL.LNK$;

  18632   1 000170  ECC7 0006                            LDB,B6   SL$,AUTO
          1 000172  DCC6 0002                            LDB,B5   2,B6
          1 000174  DFC7 0006                            STB,B5   SL$,AUTO

      508    18633    3                END;

  18633   1 000176  8DC7 0006                            CMN      SL$,AUTO
          1 000178  09E3                                 BNE      s:18625,SPREL

      509    18634    2                RETURN;

  18634   1 000179  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      510    18635    2             END;   /* if evn = chkscq */
      511    18636
      512    18637    1       IF KX$SL.REDIRECT

  18637   1 00017C  89C6 000A                            CMZ      10,B6
          1 00017E  0881 0189                            BAGE     s:18837,PREL

      513    18638    1          THEN
      514    18639    2             DO;

      515    18640        /*
      516    18641           What we do for redirected circuits are usually passing the same event
      517    18642           to the other circuit.
      518    18643        */
      519    18644    2                CALL_FPT = FPT_X25;

  18644   1 000180  AB84                                 LAB,B2   ,B4
          1 000181  2C00                                 LDV,R2   0
          1 000182  6C20                                 LDV,R6   32
          1 000183  BB87                                 LAB,B3   ,AUTO
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:96   
          1 000184  3C2A                                 LDV,R3   42
          1 000185  0008                                 MMM

      520    18645    2                IF FPT_X25.CAL$ = KX$SL.L3$

  18645   1 000186  ECC2 0001                            LDB,B6   1,B2
          1 000188  DCC7 0006                            LDB,B5   SL$,AUTO
          1 00018A  EDC5 0004                            CMB,B6   4,B5
          1 00018C  0981 000A                            BNE      s:18653,PREL

      521    18646    2                   THEN
      522    18647    3                      DO;

      523    18648    3                         CAL$_IS_L3$ = '1'B;

  18648   1 00018E  8947 0088                            LBT,'8000'X       CAL$_IS_L3$,AUTO
  18648   1 000190       8000

      524    18649    3                         CALL_FPT.RCV$ = KX$SL.SCN_L3$;

  18649   1 000191  9CC5 0006                            LDB,B1   6,B5
          1 000193  9FC7 0018                            STB,B1   CALL_FPT+3,AUTO

      525    18650    3                      END;

  18650   1 000195  0F81 0007                            B        s:18656,PREL

      526    18651    2                   ELSE
      527    18652    3                      DO;

      528    18653    3                         CAL$_IS_L3$ = '0'B;

  18653   1 000197  8747 0088                            CL       CAL$_IS_L3$,AUTO

      529    18654    3                         CALL_FPT.RCV$ = KX$SL.L3$;

  18654   1 000199  9CC5 0004                            LDB,B1   4,B5
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:97   
          1 00019B  9FC7 0018                            STB,B1   CALL_FPT+3,AUTO

      530    18655    3                      END;

      531    18656    2                CALL_FPT.CAL$ = SL$;

  18656   1 00019D  DFC7 0016                            STB,B5   CALL_FPT+1,AUTO

      532    18657    3                DO CASE ( FPT_X25.EVN );

  18657   1 00019F  B802                                 LDR,R3   ,B2
          1 0001A0  3D12                                 CMV,R3   18
          1 0001A1  0281 015E                            BGE      s:18825,PREL
          1 0001A3  A830 0000 01A9  01                   LDR,R2   s:18657+10,R3
          1 0001A6  83A0 0000 01BB  01                   JMP      s:18661,R2
          1 0001A9       0145                            DC       s:18825,PREL
          1 0001AA       0145                            DC       s:18825,PREL
          1 0001AB       0145                            DC       s:18825,PREL
          1 0001AC       0000                            DC       s:18661,PREL
          1 0001AD       0005                            DC       s:18665,PREL
          1 0001AE       000A                            DC       s:18669,PREL
          1 0001AF       00FC                            DC       s:18781,PREL
          1 0001B0       0123                            DC       s:18808,PREL
          1 0001B1       0145                            DC       s:18825,PREL
          1 0001B2       0091                            DC       s:18737,PREL
          1 0001B3       000F                            DC       s:18673,PREL
          1 0001B4       000F                            DC       s:18673,PREL
          1 0001B5       0012                            DC       s:18677,PREL
          1 0001B6       0145                            DC       s:18825,PREL
          1 0001B7       0128                            DC       s:18812,PREL
          1 0001B8       0005                            DC       s:18665,PREL
          1 0001B9       00FC                            DC       s:18781,PREL
          1 0001BA       000F                            DC       s:18673,PREL

      533    18658
      534    18659    3                   CASE ( %KX_CM_EV_VCUP# );

PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:98   
      535    18660
      536    18661    3                      CALL_FPT.EVN = %KX_P_EV_VCUP#;

  18661   1 0001BB  6C04                                 LDV,R6   4
          1 0001BC  EF47 0015                            STR,R6   CALL_FPT,AUTO
          1 0001BE  0F81 0143                            B        s:18829,PREL

      537    18662
      538    18663    3                   CASE ( %KX_CM_EV_VCLST#, %KX_CM_EV_VCLST_PRM# );

      539    18664
      540    18665    3                      CALL_FPT.EVN = %KX_P_EV_VCLST#;

  18665   1 0001C0  6C09                                 LDV,R6   9
          1 0001C1  EF47 0015                            STR,R6   CALL_FPT,AUTO
          1 0001C3  0F81 013E                            B        s:18829,PREL

      541    18666
      542    18667    3                   CASE ( %KX_CM_EV_VCDWN# );

      543    18668
      544    18669    3                      CALL_FPT.EVN = %KX_P_EV_VCDWN#;

  18669   1 0001C5  6C05                                 LDV,R6   5
          1 0001C6  EF47 0015                            STR,R6   CALL_FPT,AUTO
          1 0001C8  0F81 0139                            B        s:18829,PREL

      545    18670
      546    18671    3                   CASE ( %KX_CM_EV_DATA_TO#, %KX_CM_EV_INTACK#, %KX_CM_EV_INTNAK# );

      547    18672
      548    18673    3                      RETURN;

  18673   1 0001CA  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      549    18674
      550    18675    3                   CASE ( %KX_CM_EV_DATRQS# );
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:99   

      551    18676
      552    18677    3                      CALL_FPT.EVN = %KX_P_EV_REDRQS#;

  18677   1 0001CD  6C15                                 LDV,R6   21
          1 0001CE  EF47 0015                            STR,R6   CALL_FPT,AUTO

      553    18678    3                      IF CAL$_IS_L3$

  18678   1 0001D0  89C7 0088                            CMZ      CAL$_IS_L3$,AUTO
          1 0001D2  0881 003A                            BAGE     s:18708,PREL

      554    18679    3                         THEN
      555    18680    4                            DO;

      556    18681    4                               IF KX$SL.INPDAT_ = '0'B

  18681   1 0001D4  EB80 0000 0000  02                   LAB,B6   0
          1 0001D7  5C01                                 LDV,R5   1
          1 0001D8  0022                                 ACM      ;
          1 0001D9       4805 001A                                ALPHANUM(26,B5,,8,FILL),;
          1 0001DB       4006 0002                                ALPHANUM(2,B6,,R5,FILL)
          1 0001DD  5301 0004                            CBNE     s:18684,PREL

      557    18682    4                                  THEN
      558    18683    4                                     RETURN;

  18683   1 0001DF  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      559    18684    4                               KX$SL.INPDAT_STAGE = KX$SL.INPDAT_STAGE + 1;

  18684   1 0001E2  B2C5 0024                            LLH,R3   36,B5
          1 0001E4  3E01                                 ADV,R3   1
          1 0001E5  B7C5 0024                            STH,R3   36,B5

      560    18685    4                               IF KX$SL.INPDAT_STAGE = 1

PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:100  
  18685   1 0001E7  B2C5 0024                            LLH,R3   36,B5
          1 0001E9  3D01                                 CMV,R3   1
          1 0001EA  0981 000A                            BNE      s:18693,PREL

      561    18686    4                                  THEN
      562    18687    5                                     DO;

      563    18688    5                                        FPT_X25.V_ = KX$SL.INPDAT_;

  18688   1 0001EC  AB85                                 LAB,B2   ,B5
          1 0001ED  2C34                                 LDV,R2   52
          1 0001EE  6C08                                 LDV,R6   8
          1 0001EF  BB84                                 LAB,B3   ,B4
          1 0001F0  3C16                                 LDV,R3   22
          1 0001F1  0008                                 MMM

      564    18689    5                                        RETURN;

  18689   1 0001F2  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      565    18690    5                                     END;
      566    18691    4                                  ELSE
      567    18692    5                                     DO;

      568    18693    5                                        IF KX$SL.INPDAT_ALTRET

  18693   1 0001F5  82C5 0009                            LB,'0010'X        9,B5
  18693   1 0001F7       0010
          1 0001F8  0581 0009                            BBF      s:18701,PREL

      569    18694    5                                           THEN
      570    18695    6                                              DO;

      571    18696    6                                                 KX$SL.INPDAT_ALTRET = '0'B;

  18696   1 0001FA  8845 0009                            LBF,'0010'X       9,B5
  18696   1 0001FC       0010
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:101  

      572    18697    6                                                 CALL Y$CAL_KXP;

  18697   1 0001FD  E3C0 0919                            LNJ,B6   s:0,PREL
          1 0001FF       0001                            DC       s:18698,PREL

      573    18698    6                                              END;

  18698   1 000200  0F81 0048                            B        s:18733,PREL

      574    18699    5                                           ELSE
      575    18700    6                                              DO;

      576    18701    6                                                 KX$SL.INPDAT_ = '0'B;

  18701   1 000202  5C08                                 LDV,R5   8
          1 000203  0021                                 ALR      ;
          1 000204       4178 0000                                ALPHANUM('0000'X,IMO,,1),;
          1 000206       4005 001A                                ALPHANUM(26,B5,,R5,FILL)

      577    18702    6                                                 KX$SL.INPDAT_STAGE = 0;

  18702   1 000208  437F                                 CSYNC    s:18701+5,SPREL
          1 000209  87C5 0024                            CLH      36,B5

      578    18703    6                                              END;

      579    18704    5                                     END;

      580    18705    4                            END;

  18705   1 00020B  0F81 003D                            B        s:18733,PREL

      581    18706    3                         ELSE   /* cal$ is not L3$ */
      582    18707    4                            DO;

      583    18708    4                               IF KX$SL.SCN_INPDAT_ = '0'B
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:102  

  18708   1 00020D  EB80 0000 0000  02                   LAB,B6   0
          1 000210  5C01                                 LDV,R5   1
          1 000211  0022                                 ACM      ;
          1 000212       4805 001E                                ALPHANUM(30,B5,,8,FILL),;
          1 000214       4006 0002                                ALPHANUM(2,B6,,R5,FILL)
          1 000216  5301 0004                            CBNE     s:18711,PREL

      584    18709    4                                  THEN
      585    18710    4                                     RETURN;

  18710   1 000218  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      586    18711    4                               KX$SL.SCN_INPDAT_STAGE = KX$SL.SCN_INPDAT_STAGE + 1;

  18711   1 00021B  B845 0024                            LDR,R3   36,B5
          1 00021D  BA70 0001                            ADD,R3   1,IMO
          1 00021F  BAC5 0024                            SRM,R3,'00FF'X    36,B5
          1 000221       00FF

      587    18712    4                               IF KX$SL.SCN_INPDAT_STAGE = 1

  18712   1 000222  B845 0024                            LDR,R3   36,B5
          1 000224  B570 00FF                            AND,R3   255,IMO
          1 000226  3D01                                 CMV,R3   1
          1 000227  0981 000A                            BNE      s:18720,PREL

      588    18713    4                                  THEN
      589    18714    5                                     DO;

      590    18715    5                                        FPT_X25.V_ = KX$SL.SCN_INPDAT_;

  18715   1 000229  AB85                                 LAB,B2   ,B5
          1 00022A  2C3C                                 LDV,R2   60
          1 00022B  6C08                                 LDV,R6   8
          1 00022C  BB84                                 LAB,B3   ,B4
          1 00022D  3C16                                 LDV,R3   22
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:103  
          1 00022E  0008                                 MMM

      591    18716    5                                        RETURN;

  18716   1 00022F  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      592    18717    5                                     END;
      593    18718    4                                  ELSE   /* scn_inpdat_stage is 2 */
      594    18719    5                                     DO;

      595    18720    5                                        IF KX$SL.SCN_INPDAT_ALTRET

  18720   1 000232  82C5 0009                            LB,'0008'X        9,B5
  18720   1 000234       0008
          1 000235  0581 0009                            BBF      s:18728,PREL

      596    18721    5                                           THEN
      597    18722    6                                              DO;

      598    18723    6                                                 KX$SL.SCN_INPDAT_ALTRET = '0'B;

  18723   1 000237  8845 0009                            LBF,'0008'X       9,B5
  18723   1 000239       0008

      599    18724    6                                                 CALL Y$CAL_KXP;

  18724   1 00023A  E3C0 08DC                            LNJ,B6   s:0,PREL
          1 00023C       0001                            DC       s:18725,PREL

      600    18725    6                                              END;

  18725   1 00023D  0F81 000B                            B        s:18733,PREL

      601    18726    5                                           ELSE
      602    18727    6                                              DO;

      603    18728    6                                                 KX$SL.SCN_INPDAT_ = '0'B;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:104  

  18728   1 00023F  5C08                                 LDV,R5   8
          1 000240  0021                                 ALR      ;
          1 000241       4178 0000                                ALPHANUM('0000'X,IMO,,1),;
          1 000243       4005 001E                                ALPHANUM(30,B5,,R5,FILL)

      604    18729    6                                                 KX$SL.SCN_INPDAT_STAGE = 0;

  18729   1 000245  437F                                 CSYNC    s:18728+5,SPREL
          1 000246  8845 0024                            LBF,'00FF'X       36,B5
          1 000248       00FF

      605    18730    6                                              END;

      606    18731    5                                     END;

      607    18732    4                            END;

      608    18733    3                      RETURN;

  18733   1 000249  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      609    18734
      610    18735    3                   CASE ( %KX_CM_EV_DATIN# );

      611    18736
      612    18737    3                      CALL_FPT.EVN = %KX_P_EV_DATAVL#;

  18737   1 00024C  6C0B                                 LDV,R6   11
          1 00024D  EF47 0015                            STR,R6   CALL_FPT,AUTO

      613    18738    3                      IF CAL$_IS_L3$

  18738   1 00024F  89C7 0088                            CMZ      CAL$_IS_L3$,AUTO
          1 000251  0881 0030                            BAGE     s:18760,PREL

      614    18739    3                         THEN
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:105  
      615    18740    4                            DO;

      616    18741    4                               IF FPT_X25.V_ = KX$SL.INPDAT_

  18741   1 000253  5C08                                 LDV,R5   8
          1 000254  0022                                 ACM      ;
          1 000255       4802 000B                                ALPHANUM(11,B2,,8,FILL),;
          1 000257       4005 001A                                ALPHANUM(26,B5,,R5,FILL)
          1 000259  5301 000C                            CBNE     s:18748,PREL

      617    18742    4                                  THEN
      618    18743    5                                     DO;

      619    18744    5                                        KX$SL.INPDAT_ = '0'B;

  18744   1 00025B  0021                                 ALR      ;
          1 00025C       4178 0000                                ALPHANUM('0000'X,IMO,,1),;
          1 00025E       4005 001A                                ALPHANUM(26,B5,,R5,FILL)

      620    18745    5                                        KX$SL.INPDAT_STAGE = 0;

  18745   1 000260  437F                                 CSYNC    s:18744+4,SPREL
          1 000261  87C5 0024                            CLH      36,B5

      621    18746    5                                        RETURN;

  18746   1 000263  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      622    18747    5                                     END;
      623    18748    4                               KX$SL.INPDAT_ = FPT_X25.V_;

  18748   1 000266  2C16                                 LDV,R2   22
          1 000267  6C08                                 LDV,R6   8
          1 000268  BB85                                 LAB,B3   ,B5
          1 000269  3C34                                 LDV,R3   52
          1 00026A  0008                                 MMM

PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:106  
      624    18749    4                               KX$SL.INPDAT_STAGE = 0;

  18749   1 00026B  ECC7 0006                            LDB,B6   SL$,AUTO
          1 00026D  87C6 0024                            CLH      36,B6

      625    18750    4                               CALL Y$CAL_KXP;

  18750   1 00026F  E3C0 08A7                            LNJ,B6   s:0,PREL
          1 000271       0001                            DC       s:18751,PREL

      626    18751    4                              IF KX$SL.INPDAT_STAGE > 0 OR KX$SL.INPDAT_.ADR$ ~= ADDR(
             18751                                        NIL)

  18751   1 000272  ECC7 0006                            LDB,B6   SL$,AUTO
          1 000274  E2C6 0024                            LLH,R6   36,B6
          1 000276  6981 0005                            BNEZ,R6  s:18754,PREL
          1 000278  8DC6 001A                            CMN      26,B6
          1 00027A  0901 0039                            BE       s:18777,PREL

      627    18752    4                                  THEN
      628    18753    5                                     DO;

      629    18754    5                                        KX$SL.INPDAT_ALTRET = '1'B;

  18754   1 00027C  8946 0009                            LBT,'0010'X       9,B6
  18754   1 00027E       0010

      630    18755    5                                        ALTRETURN;

  18755   1 00027F  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      631    18756    5                                     END;
      632    18757    4                            END;
      633    18758    3                         ELSE
      634    18759    4                            DO;

      635    18760    4                               IF FPT_X25.V_ = KX$SL.SCN_INPDAT_
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:107  

  18760   1 000282  5C08                                 LDV,R5   8
          1 000283  0022                                 ACM      ;
          1 000284       4802 000B                                ALPHANUM(11,B2,,8,FILL),;
          1 000286       4005 001E                                ALPHANUM(30,B5,,R5,FILL)
          1 000288  5301 000D                            CBNE     s:18767,PREL

      636    18761    4                                  THEN
      637    18762    5                                     DO;

      638    18763    5                                        KX$SL.SCN_INPDAT_ = '0'B;

  18763   1 00028A  0021                                 ALR      ;
          1 00028B       4178 0000                                ALPHANUM('0000'X,IMO,,1),;
          1 00028D       4005 001E                                ALPHANUM(30,B5,,R5,FILL)

      639    18764    5                                        KX$SL.SCN_INPDAT_STAGE = 0;

  18764   1 00028F  437F                                 CSYNC    s:18763+4,SPREL
          1 000290  8845 0024                            LBF,'00FF'X       36,B5
          1 000292       00FF

      640    18765    5                                        RETURN;

  18765   1 000293  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      641    18766    5                                     END;
      642    18767    4                               KX$SL.SCN_INPDAT_ = FPT_X25.V_;

  18767   1 000296  2C16                                 LDV,R2   22
          1 000297  6C08                                 LDV,R6   8
          1 000298  BB85                                 LAB,B3   ,B5
          1 000299  3C3C                                 LDV,R3   60
          1 00029A  0008                                 MMM

      643    18768    4                               KX$SL.SCN_INPDAT_STAGE = 0;

PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:108  
  18768   1 00029B  ECC7 0006                            LDB,B6   SL$,AUTO
          1 00029D  8846 0024                            LBF,'00FF'X       36,B6
          1 00029F       00FF

      644    18769    4                               CALL Y$CAL_KXP;

  18769   1 0002A0  E3C0 0876                            LNJ,B6   s:0,PREL
          1 0002A2       0001                            DC       s:18770,PREL

      645    18770    4                               IF KX$SL.SCN_INPDAT_STAGE > 0 OR KX$SL.SCN_INPDAT_.ADR$
             18770                                        ~= ADDR(NIL)

  18770   1 0002A3  ECC7 0006                            LDB,B6   SL$,AUTO
          1 0002A5  82C6 0024                            LB,'00FF'X        36,B6
          1 0002A7       00FF
          1 0002A8  0501 0005                            BBT      s:18773,PREL
          1 0002AA  8DC6 001E                            CMN      30,B6
          1 0002AC  0901 0007                            BE       s:18777,PREL

      646    18771    4                                  THEN
      647    18772    5                                     DO;

      648    18773    5                                        KX$SL.SCN_INPDAT_ALTRET = '1'B;

  18773   1 0002AE  8946 0009                            LBT,'0008'X       9,B6
  18773   1 0002B0       0008

      649    18774    5                                        ALTRETURN;

  18774   1 0002B1  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      650    18775    5                                     END;
      651    18776    4                            END;
      652    18777    3                      RETURN;

  18777   1 0002B4  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:109  
      653    18778
      654    18779    3                   CASE ( %KX_CM_EV_VCRST#, %KX_CM_EV_RSTIND# );

      655    18780
      656    18781    3                      IF CAL$_IS_L3$

  18781   1 0002B7  89C7 0088                            CMZ      CAL$_IS_L3$,AUTO
          1 0002B9  0881 0011                            BAGE     s:18795,PREL

      657    18782    3                         THEN
      658    18783    4                            DO;

      659    18784    4                               IF KX$SL.L3_RSTPND

  18784   1 0002BB  82C5 0009                            LB,'0004'X        9,B5
  18784   1 0002BD       0004
          1 0002BE  0581 0007                            BBF      s:18791,PREL

      660    18785    4                                  THEN
      661    18786    5                                     DO;

      662    18787    5                                        KX$SL.L3_RSTPND = '0'B;

  18787   1 0002C0  8845 0009                            LBF,'0004'X       9,B5
  18787   1 0002C2       0004

      663    18788    5                                        RETURN;

  18788   1 0002C3  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      664    18789    5                                     END;
      665    18790    4                                  ELSE
      666    18791    4                                     KX$SL.L3_RSTPND = '1'B;

  18791   1 0002C6  8945 0009                            LBT,'0004'X       9,B5
  18791   1 0002C8       0004

PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:110  
      667    18792    4                            END;

  18792   1 0002C9  0F81 000F                            B        s:18804,PREL

      668    18793    3                         ELSE
      669    18794    4                            DO;

      670    18795    4                               IF KX$SL.SCN_L3_RSTPND

  18795   1 0002CB  82C5 0009                            LB,'0002'X        9,B5
  18795   1 0002CD       0002
          1 0002CE  0581 0007                            BBF      s:18802,PREL

      671    18796    4                                  THEN
      672    18797    5                                     DO;

      673    18798    5                                        KX$SL.SCN_L3_RSTPND = '0'B;

  18798   1 0002D0  8845 0009                            LBF,'0002'X       9,B5
  18798   1 0002D2       0002

      674    18799    5                                        RETURN;

  18799   1 0002D3  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      675    18800    5                                     END;
      676    18801    4                                  ELSE
      677    18802    4                                     KX$SL.SCN_L3_RSTPND = '1'B;

  18802   1 0002D6  8945 0009                            LBT,'0002'X       9,B5
  18802   1 0002D8       0002

      678    18803    4                            END;

      679    18804    3                      CALL_FPT.EVN = %KX_P_EV_VCRST#;

  18804   1 0002D9  6C0A                                 LDV,R6   10
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:111  
          1 0002DA  EF47 0015                            STR,R6   CALL_FPT,AUTO
          1 0002DC  0F81 0025                            B        s:18829,PREL

      680    18805
      681    18806    3                   CASE ( %KX_CM_EV_INT# );

      682    18807
      683    18808    3                      CALL_FPT.EVN = %KX_P_EV_SNDINT#;

  18808   1 0002DE  6C12                                 LDV,R6   18
          1 0002DF  EF47 0015                            STR,R6   CALL_FPT,AUTO
          1 0002E1  0F81 0020                            B        s:18829,PREL

      684    18809
      685    18810    3                   CASE ( %KX_CM_EV_RLSL3# );

      686    18811
      687    18812    3                      IF CAL$_IS_L3$

  18812   1 0002E3  89C7 0088                            CMZ      CAL$_IS_L3$,AUTO
          1 0002E5  0881 0008                            BAGE     s:18816,PREL

      688    18813    3                         THEN
      689    18814    3                            KX$SL.L3$ = ADDR(NIL);

  18814   1 0002E7  EB80 0000 0000                       LAB,B6   0
          1 0002EA  EFC5 0004                            STB,B6   4,B5
          1 0002EC  0F81 0006                            B        s:18817,PREL

      690    18815    3                         ELSE
      691    18816    3                            KX$SL.SCN_L3$ = ADDR(NIL);

  18816   1 0002EE  EB80 0000 0000                       LAB,B6   0
          1 0002F1  EFC5 0006                            STB,B6   6,B5

      692    18817    3                      IF KX$SL.L3$ = ADDR(NIL) AND KX$SL.SCN_L3$ = ADDR(NIL)

PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:112  
  18817   1 0002F3  ECC7 0006                            LDB,B6   SL$,AUTO
          1 0002F5  8DC6 0004                            CMN      4,B6
          1 0002F7  0981 0005                            BNE      s:18821,PREL
          1 0002F9  8DC6 0006                            CMN      6,B6
          1 0002FB  0901 06A9                            BE       s:19525,PREL

      693    18818    3                         THEN
      694    18819    3                            GOTO RLS_SL;
      695    18820    3                         ELSE
      696    18821    3                            RETURN;

  18821   1 0002FD  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      697    18822
      698    18823    3                   CASE ( ELSE );

      699    18824
      700    18825    3                      GOTO L_SCR;

  18825   1 000300  0F81 05E3                            B        s:19472,PREL

      701    18826
      702    18827    3                END;   /* do case ( evn ) */

      703    18828
      704    18829    2                CALL Y$CAL_KXP;

  18829   1 000302  E3C0 0814                            LNJ,B6   s:0,PREL
          1 000304       0001                            DC       s:18830,PREL

      705    18830    2                RETURN;

  18830   1 000305  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      706    18831
      707    18832    2             END;  /* if redirect */
      708    18833        /*
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:113  
      709    18834                                             Do case on the external event to
      710    18835                                             convert it to an internal event.
      711    18836        */
      712    18837    2       DO CASE ( FPT_X25.EVN );

  18837   1 000308  3D19                                 CMV,R3   25
          1 000309  0281 042A                            BGE      s:19318,PREL
          1 00030B  A830 0000 0311  01                   LDR,R2   s:18837+9,R3
          1 00030E  83A0 0000 032A  01                   JMP      s:18841,R2
          1 000311       040A                            DC       s:19318,PREL
          1 000312       00BC                            DC       s:18940,PREL
          1 000313       00BC                            DC       s:18940,PREL
          1 000314       007B                            DC       s:18908,PREL
          1 000315       0093                            DC       s:18921,PREL
          1 000316       00D9                            DC       s:18951,PREL
          1 000317       035D                            DC       s:19213,PREL
          1 000318       0381                            DC       s:19233,PREL
          1 000319       03E1                            DC       s:19290,PREL
          1 00031A       0284                            DC       s:19137,PREL
          1 00031B       03A7                            DC       s:19249,PREL
          1 00031C       03AC                            DC       s:19256,PREL
          1 00031D       016B                            DC       s:19008,PREL
          1 00031E       03C5                            DC       s:19272,PREL
          1 00031F       03FE                            DC       s:19309,PREL
          1 000320       0093                            DC       s:18921,PREL
          1 000321       035D                            DC       s:19213,PREL
          1 000322       00E9                            DC       s:18959,PREL
          1 000323       01C4                            DC       s:19057,PREL
          1 000324       0014                            DC       s:18853,PREL
          1 000325       00B0                            DC       s:18933,PREL
          1 000326       00EC                            DC       s:18963,PREL
          1 000327       040A                            DC       s:19318,PREL
          1 000328       0000                            DC       s:18841,PREL
          1 000329       0005                            DC       s:18845,PREL

      713    18838
      714    18839    2          CASE ( %KX_CM_EV_CNCRQS# );
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:114  

      715    18840
      716    18841    2             EVENT = %Y_EV_CNCRQS#;

  18841   1 00032A  1C05                                 LDV,R1   5
          1 00032B  9F47 000E                            STR,R1   EVENT,AUTO
          1 00032D  0F81 040F                            B        s:19326,PREL

      717    18842
      718    18843    2          CASE ( %KX_CM_EV_DSCRQS# );

      719    18844
      720    18845    2             IF KX$SL.START_RCQ$ ~= ADDR(NIL)

  18845   1 00032F  8DC6 0026                            CMN      38,B6
          1 000331  0901 0004                            BE       s:18848,PREL

      721    18846    2                THEN
      722    18847    2                   ALTRETURN;

  18847   1 000333  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      723    18848    2             EVENT = %Y_EV_TERM#;

  18848   1 000336  1C06                                 LDV,R1   6
          1 000337  9F47 000E                            STR,R1   EVENT,AUTO

      724    18849    2             KX$SL.RPRDAT = '1'B;

  18849   1 000339  8946 0009                            LBT,'0080'X       9,B6
  18849   1 00033B       0080
          1 00033C  0F81 0400                            B        s:19326,PREL

      725    18850
      726    18851    2          CASE ( %KX_CM_EV_INITACK# );

      727    18852
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:115  
      728    18853    2             IF FPT$CONNECT_ACK.REASON = %K_REASON_NORMAL

  18853   1 00033E  BCC7 000C                            LDB,B3   FPT$,AUTO
          1 000340  9803                                 LDR,R1   ,B3
          1 000341  1981 0037                            BNEZ,R1  s:18881,PREL

      729    18854    2                THEN
      730    18855    3                   DO;

      731    18856        /*
      732    18857           Save the LDCTX from the FPT.
      733    18858        */
      734    18859    3                      KX$SL.LDCTX = FPT_X25.PRM1;

  18859   1 000343  E844 0005                            LDR,R6   5,B4
          1 000345  EF46 000B                            STR,R6   11,B6

      735    18860    3                      KNH_MESS.LDCTX = FPT_X25.PRM1;

  18860   1 000347  B844 0005                            LDR,R3   5,B4
          1 000349  BF47 0026                            STR,R3   KNH_MESS+1,AUTO

      736    18861    3                      EVENT = %Y_EV_INTACK#;

  18861   1 00034B  CF47 000E                            STR,R4   EVENT,AUTO

      737    18862    3                      IF FPT_X25.V_.ADR$ ~= ADDR(NIL)

  18862   1 00034D  8DC4 000B                            CMN      11,B4
          1 00034F  0901 03ED                            BE       s:19326,PREL

      738    18863    3                         THEN
      739    18864    4                            DO;

      740    18865    4                               CALL Y$COPY ALTRET ( SCR_NOMEM );

  18865   1 000351  E3C0 0922                            LNJ,B6   s:0,PREL
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:116  
          1 000353       0464                            DC       s:19354,PREL

      741    18866    4                               IF KX$SL.L3$->%L3CHN.TERMID.LEV = %
             18866                                        TERMINAL_ID_LEV_SUBCHAN#

  18866   1 000354  ECC7 0006                            LDB,B6   SL$,AUTO
          1 000356  DCC6 0004                            LDB,B5   4,B6
          1 000358  CCC5 0006                            LDB,B4   6,B5
          1 00035A  E844 0012                            LDR,R6   18,B4
          1 00035C  E570 00FF                            AND,R6   255,IMO
          1 00035E  6D02                                 CMV,R6   2
          1 00035F  0981 000D                            BNE      s:18874,PREL

      742    18867    4                                  THEN
      743    18868    5                                     DO;

      744    18869    5                                        KX$SL.CALUSRDAT$ = Y$;

  18869   1 000361  BCC7 0011                            LDB,B3   Y$,AUTO
          1 000363  BFC6 0028                            STB,B3   40,B6

      745    18870    5                                        KX$SL.CALUSRDATBYTSIZ = FPT_X25.V_.BYTSIZ;

  18870   1 000365  CCC7 0004                            LDB,B4   @FPT_X25,AUTO
          1 000367  E844 000E                            LDR,R6   14,B4
          1 000369  EF46 002A                            STR,R6   42,B6

      746    18871    5                                     END;

  18871   1 00036B  0F81 03D1                            B        s:19326,PREL

      747    18872    4                                  ELSE
      748    18873    5                                     DO;

      749    18874    5                                        KX$SL.CALRSPDATBYTSIZ = FPT_X25.V_.BYTSIZ;

  18874   1 00036D  BCC7 0004                            LDB,B3   @FPT_X25,AUTO
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:117  
          1 00036F  D843 000E                            LDR,R5   14,B3
          1 000371  DF46 002D                            STR,R5   45,B6

      750    18875    5                                        KX$SL.CALRSPDAT$ = Y$;

  18875   1 000373  CCC7 0011                            LDB,B4   Y$,AUTO
          1 000375  CFC6 002B                            STB,B4   43,B6

      751    18876    5                                     END;

      752    18877    4                            END;

      753    18878    3                   END;

  18878   1 000377  0F81 03C5                            B        s:19326,PREL

      754    18879    2                ELSE
      755    18880    3                   DO;

      756    18881    3                      IF FPT$CONNECT_ACK.REASON ~= %K_REASON_REDIRECT

  18881   1 000379  1D06                                 CMV,R1   6
          1 00037A  0901 0011                            BE       s:18896,PREL

      757    18882    3                         THEN
      758    18883    4                            DO;

      759    18884    4   CLR_VC:                     CALL_FPT.EVN = %KX_P_EV_VCLST#;

  18884   1 00037C  6C09                 CLR_VC          LDV,R6   9
          1 00037D  EF47 0015                            STR,R6   CALL_FPT,AUTO

      760    18885    4                               CALL_FPT.PRM1 = %KX_DIAG_TMPROUTE#;

  18885   1 00037F  5C78                                 LDV,R5   120
          1 000380  DF47 001A                            STR,R5   CALL_FPT+5,AUTO

PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:118  
      761    18886    4                               KX$SL.STATE = %Y_ST_DCL#;

  18886   1 000382  ECC7 0006                            LDB,B6   SL$,AUTO
          1 000384  8746 000C                            CL       12,B6

      762    18887    4                               CALL Y$CAL_KXP;

  18887   1 000386  E3C0 0790                            LNJ,B6   s:0,PREL
          1 000388       0001                            DC       s:18888,PREL

      763    18888    4                               RETURN;

  18888   1 000389  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      764    18889        /*   release of SL context will be done when L3 reports back a VCLST   */
      765    18890    4                            END;
      766    18891    3                         ELSE
      767    18892    4                            DO;

      768    18893        /*
      769    18894           We are to redirect this call on a new link. Start by getting a L3 context.
      770    18895        */
      771    18896    4                               CALL Y$GETL3 ( FPT$CONNECT_ACK.OUTLINK$, 1 )

  18896   1 00038C  ABF0 0001                            LAB,B2   1,IMO
          1 00038E  AFC7 008E                            STB,B2   @L2$+2,AUTO
          1 000390  9BC3 0001                            LAB,B1   1,B3
          1 000392  9FC7 008C                            STB,B1   CAL$_IS_L3$+4,AUTO
          1 000394  E3C0 07BF                            LNJ,B6   s:0,PREL
          1 000396       FFE6                            DC       s:18883,PREL

      772    18897    4                                  ALTRET ( CLR_VC );
      773    18898    4                               KX$SL.REDIRECT = '1'B;

  18898   1 000397  ECC7 0006                            LDB,B6   SL$,AUTO
          1 000399  8946 000A                            LBT,'8000'X       10,B6
          1 00039B       8000
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:119  

      774    18899    4                               CALL_FPT.RCV$ = L3$;

  18899   1 00039C  DCC7 0008                            LDB,B5   L3$,AUTO
          1 00039E  DFC7 0018                            STB,B5   CALL_FPT+3,AUTO

      775    18900    4                               EVENT = %Y_EV_INTACK#;

  18900   1 0003A0  6C01                                 LDV,R6   1
          1 0003A1  EF47 000E                            STR,R6   EVENT,AUTO

      776    18901    4                            END;

      777    18902    3                   END;

  18902   1 0003A3  0F81 0399                            B        s:19326,PREL

      778    18903
      779    18904    2          CASE (%KX_CM_EV_VCUP#);

      780    18905        /*
      781    18906           A VC has established the call and is ready to transfer data.
      782    18907        */
      783    18908    2             EVENT = %Y_EV_VCUP#;

  18908   1 0003A5  1C02                                 LDV,R1   2
          1 0003A6  9F47 000E                            STR,R1   EVENT,AUTO

      784    18909    2             IF FPT_X25.V_.BYTSIZ > 0

  18909   1 0003A8  E844 000E                            LDR,R6   14,B4
          1 0003AA  6901 0392                            BEZ,R6   s:19326,PREL

      785    18910    2                THEN
      786    18911    3                   DO;

      787    18912    3                      CALL Y$COPY ALTRET ( SCR_NOMEM );
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:120  

  18912   1 0003AC  E3C0 08C7                            LNJ,B6   s:0,PREL
          1 0003AE       0409                            DC       s:19354,PREL

      788    18913    3                      KX$SL.CALRSPDAT$ = Y$;

  18913   1 0003AF  ECC7 0011                            LDB,B6   Y$,AUTO
          1 0003B1  DCC7 0006                            LDB,B5   SL$,AUTO
          1 0003B3  EFC5 002B                            STB,B6   43,B5

      789    18914    3                      KX$SL.CALRSPDATBYTSIZ = FPT_X25.V_.BYTSIZ;

  18914   1 0003B5  CCC7 0004                            LDB,B4   @FPT_X25,AUTO
          1 0003B7  E844 000E                            LDR,R6   14,B4
          1 0003B9  EF45 002D                            STR,R6   45,B5

      790    18915    3                   END;

  18915   1 0003BB  0F81 0381                            B        s:19326,PREL

      791    18916
      792    18917    2          CASE ( %KX_CM_EV_VCLST#, %KX_CM_EV_VCLST_PRM# );

      793    18918        /*
      794    18919           A VC has been permanently severed.
      795    18920        */
      796    18921    2             EVENT = %Y_EV_VCLST#;

  18921   1 0003BD  1C03                                 LDV,R1   3
          1 0003BE  9F47 000E                            STR,R1   EVENT,AUTO

      797    18922    2             IF FPT_X25.V_.BYTSIZ > 0

  18922   1 0003C0  E844 000E                            LDR,R6   14,B4
          1 0003C2  6901 0010                            BEZ,R6   s:18929,PREL

      798    18923    2                THEN
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:121  
      799    18924    3                   DO;

      800    18925    3                      CALL Y$COPY ALTRET ( SCR_NOMEM );

  18925   1 0003C4  E3C0 08AF                            LNJ,B6   s:0,PREL
          1 0003C6       03F1                            DC       s:19354,PREL

      801    18926    3                      KX$SL.CLRDAT$ = Y$;

  18926   1 0003C7  ECC7 0011                            LDB,B6   Y$,AUTO
          1 0003C9  DCC7 0006                            LDB,B5   SL$,AUTO
          1 0003CB  EFC5 002E                            STB,B6   46,B5

      802    18927    3                      KX$SL.CLRDATBYTSIZ = FPT_X25.V_.BYTSIZ;

  18927   1 0003CD  CCC7 0004                            LDB,B4   @FPT_X25,AUTO
          1 0003CF  E844 000E                            LDR,R6   14,B4
          1 0003D1  EF45 0030                            STR,R6   48,B5

      803    18928    3                   END;

      804    18929    2             KX$SL.RPRDAT = '1'B;

  18929   1 0003D3  ECC7 0006                            LDB,B6   SL$,AUTO
          1 0003D5  8946 0009                            LBT,'0080'X       9,B6
          1 0003D7       0080
          1 0003D8  0F81 0364                            B        s:19326,PREL

      805    18930
      806    18931    2          CASE ( %KX_CM_EV_TERMACK# );

      807    18932
      808    18933    2             IF KX$SL.START_RCQ$ ~= ADDR(NIL)

  18933   1 0003DA  8DC6 0026                            CMN      38,B6
          1 0003DC  0901 0004                            BE       s:18936,PREL

PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:122  
      809    18934    2                THEN
      810    18935    2                   ALTRETURN;

  18935   1 0003DE  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      811    18936    2             EVENT = %Y_EV_TRMACK#;

  18936   1 0003E1  1C04                                 LDV,R1   4
          1 0003E2  9F47 000E                            STR,R1   EVENT,AUTO
          1 0003E4  0F81 0358                            B        s:19326,PREL

      812    18937
      813    18938    2          CASE ( %KX_CM_EV_DCL#, %KX_CM_EV_RMTDCL# );

      814    18939
      815    18940    2             EVENT = %Y_EV_DCL#;

  18940   1 0003E6  8747 000E                            CL       EVENT,AUTO

      816    18941    2             IF FPT_X25.V_.BYTSIZ > 0 AND KX$SL.RMTNOD > 200

  18941   1 0003E8  9844 000E                            LDR,R1   14,B4
          1 0003EA  1901 0352                            BEZ,R1   s:19326,PREL
          1 0003EC  E2C6 0009                            LLH,R6   9,B6
          1 0003EE  E970 00C8                            CMR,R6   200,IMO
          1 0003F0  0A81 034C                            BALE     s:19326,PREL

      817    18942    2                THEN
      818    18943    3                   DO;

      819    18944    3                      CALL Y$COPY ALTRET ( CLR_VC );

  18944   1 0003F2  E3C0 0881                            LNJ,B6   s:0,PREL
          1 0003F4       FF88                            DC       s:18883,PREL

      820    18945    3                      KX$SL.CALUSRDATBYTSIZ = FPT_X25.V_.BYTSIZ;

PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:123  
  18945   1 0003F5  ECC7 0006                            LDB,B6   SL$,AUTO
          1 0003F7  DCC7 0004                            LDB,B5   @FPT_X25,AUTO
          1 0003F9  E845 000E                            LDR,R6   14,B5
          1 0003FB  EF46 002A                            STR,R6   42,B6

      821    18946    3                      KX$SL.CALUSRDAT$ = Y$;

  18946   1 0003FD  CCC7 0011                            LDB,B4   Y$,AUTO
          1 0003FF  CFC6 0028                            STB,B4   40,B6

      822    18947    3                   END;

  18947   1 000401  0F81 033B                            B        s:19326,PREL

      823    18948
      824    18949    2          CASE ( %KX_CM_EV_VCDWN# );

      825    18950
      826    18951    2             IF KX$SL.STATE = %Y_ST_INIT_WVC# OR KX$SL.STATE = %Y_ST_CNC_WVC#

  18951   1 000403  9846 000C                            LDR,R1   12,B6
          1 000405  1D02                                 CMV,R1   2
          1 000406  0901 0004                            BE       s:18953,PREL
          1 000408  1D07                                 CMV,R1   7
          1 000409  0981 0004                            BNE      s:18955,PREL

      827    18952    2                THEN
      828    18953    2                   RETURN;

  18953   1 00040B  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      829    18954    2                ELSE
      830    18955    2                   EVENT = %Y_EV_VCLST#;

  18955   1 00040E  6C03                                 LDV,R6   3
          1 00040F  EF47 000E                            STR,R6   EVENT,AUTO
          1 000411  0F81 032B                            B        s:19326,PREL
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:124  

      831    18956
      832    18957    2          CASE ( %KX_CM_EV_DATA_TO# );

      833    18958
      834    18959    2             RETURN;

  18959   1 000413  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      835    18960
      836    18961    2          CASE ( %KX_CM_EV_CQSCN_XIT# );

      837    18962
      838    18963    3             DO WHILE ( SL$ ~= ADDR(NIL) );

  18963   1 000416  0F81 0077                            B        s:19001,PREL

      839    18964    3                L3$ = KX$SL.L3$;

  18964   1 000418  ECC7 0006                            LDB,B6   SL$,AUTO
          1 00041A  DCC6 0004                            LDB,B5   4,B6
          1 00041C  DFC7 0008                            STB,B5   L3$,AUTO

      840    18965    3                CALL_FPT.CAL$ = SL$;

  18965   1 00041E  EFC7 0016                            STB,B6   CALL_FPT+1,AUTO

      841    18966    3                CALL_FPT.RCV$ = L3$;

  18966   1 000420  DFC7 0018                            STB,B5   CALL_FPT+3,AUTO

      842    18967    3                KNH_MESS.LDCTX = KX$SL.LDCTX;

  18967   1 000422  E846 000B                            LDR,R6   11,B6
          1 000424  EF47 0026                            STR,R6   KNH_MESS+1,AUTO

      843    18968    3                KNH_MESS.UID$ = SL$;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:125  

  18968   1 000426  EFC7 0027                            STB,B6   KNH_MESS+2,AUTO

      844    18969    3                KNH_MESS.UIDX.CQ_HNDID = %KV#CQ_HNDID_SL;

  18969   1 000428  5C01                                 LDV,R5   1
          1 000429  D7C7 0027                            STH,R5   KNH_MESS+2,AUTO

      845    18970    3                IF KX$SL.RPRDAT

  18970   1 00042B  82C6 0009                            LB,'0080'X        9,B6
  18970   1 00042D       0080
          1 00042E  0581 0012                            BBF      s:18982,PREL
          1 000430  C846 0021                            LDR,R4   33,B6
          1 000432  4981 0005                            BNEZ,R4  s:18974,PREL
          1 000434  B846 0023                            LDR,R3   35,B6
          1 000436  3901 000A                            BEZ,R3   s:18982,PREL

      846    18971    3                   AND ( KX$SL.CQMSG_.BYTSIZ > 0 OR KX$SL.OTPBFRBYTX > 0 )
      847    18972    3                   THEN
      848    18973    4                      DO;

      849    18974    4                         KX$SL.RPRDAT = '0'B;

  18974   1 000438  8846 0009                            LBF,'0080'X       9,B6
  18974   1 00043A       0080

      850    18975    4                         CALL_FPT.EVN = %KX_P_EV_DATAVL#;

  18975   1 00043B  6C0B                                 LDV,R6   11
          1 00043C  EF47 0015                            STR,R6   CALL_FPT,AUTO

      851    18976    4                         CALL Y$CAL_KXP;

  18976   1 00043E  E3C0 06D8                            LNJ,B6   s:0,PREL
          1 000440       0001                            DC       s:18982,PREL

PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:126  
      852    18977    4                      END;

      853    18978        /*
      854    18979           At this point we should check BCKLOG against the thresholds to
      855    18980           see if a flow control message to network is appropriate.
      856    18981        */
      857    18982    3                IF KX$SL.BCKLOG > 4*KX$SL.OTPBFRBYTSIZ AND NOT KX$SL.NTWBLK

  18982   1 000441  ECC7 0006                            LDB,B6   SL$,AUTO
          1 000443  E846 0022                            LDR,R6   34,B6
          1 000445  6002                                 SOL,R6   2
          1 000446  6801 001E                            BLZ,R6   s:18991,PREL
          1 000448  E946 0025                            CMR,R6   37,B6
          1 00044A  0881 001A                            BAGE     s:18991,PREL
          1 00044C  82C6 0009                            LB,'0040'X        9,B6
          1 00044E       0040
          1 00044F  0501 0015                            BBT      s:18991,PREL

      858    18983    3                   THEN
      859    18984    4                      DO;

      860    18985    4                         KNH_MESS.FUNCTION = %KN_FCN_BLOCK;

  18985   1 000451  5C0B                                 LDV,R5   11
          1 000452  DF47 0025                            STR,R5   KNH_MESS,AUTO

      861    18986    4                         CALL KVM$SNDCQ ( KV@SNDCQ ) WHENRETURN

  18986   1 000454  DBC7 006E                            LAB,B5   KV@SNDCQ,AUTO
          1 000456  DFC7 0094                            STB,B5   I+2,AUTO
          1 000458  BBC7 0094                            LAB,B3   I+2,AUTO
          1 00045A  CBF0 0100                            LAB,B4   256,IMO
          1 00045C  E380 0000 0000  xent                 LNJ,B6   KVM$SNDCQ
          1 00045F       0006                            DC       s:18991,PREL

      862    18987    5                               DO;

PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:127  
      863    18988    5                                  KX$SL.NTWBLK = '1'B;

  18988   1 000460  ECC7 0006                            LDB,B6   SL$,AUTO
          1 000462  8946 0009                            LBT,'0040'X       9,B6
          1 000464       0040

      864    18989    5                               END;

      865    18990    4                      END;

      866    18991    3                IF KX$SL.BCKLOG < KX$SL.OTPBFRBYTSIZ AND KX$SL.NTWBLK

  18991   1 000465  ECC7 0006                            LDB,B6   SL$,AUTO
          1 000467  E846 0025                            LDR,R6   37,B6
          1 000469  6801 0005                            BLZ,R6   s:18991+10,PREL
          1 00046B  E946 0022                            CMR,R6   34,B6
          1 00046D  0281 001A                            BGE      s:19000,PREL
          1 00046F  82C6 0009                            LB,'0040'X        9,B6
          1 000471       0040
          1 000472  0581 0015                            BBF      s:19000,PREL

      867    18992    3                   THEN
      868    18993    4                      DO;

      869    18994    4                         KNH_MESS.FUNCTION = %KN_FCN_UNBLOCK;

  18994   1 000474  5C0C                                 LDV,R5   12
          1 000475  DF47 0025                            STR,R5   KNH_MESS,AUTO

      870    18995    4                         CALL KVM$SNDCQ ( KV@SNDCQ ) WHENRETURN

  18995   1 000477  DBC7 006E                            LAB,B5   KV@SNDCQ,AUTO
          1 000479  DFC7 0094                            STB,B5   I+2,AUTO
          1 00047B  BBC7 0094                            LAB,B3   I+2,AUTO
          1 00047D  CBF0 0100                            LAB,B4   256,IMO
          1 00047F  E380 0000 0000  xent                 LNJ,B6   KVM$SNDCQ
          1 000482       0006                            DC       s:19000,PREL
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:128  

      871    18996    5                               DO;

      872    18997    5                                  KX$SL.NTWBLK = '0'B;

  18997   1 000483  ECC7 0006                            LDB,B6   SL$,AUTO
          1 000485  8846 0009                            LBF,'0040'X       9,B6
          1 000487       0040

      873    18998    5                               END;

      874    18999    4                      END;

      875    19000    3                SL$ = KX$SL.LNK$;

  19000   1 000488  ECC7 0006                            LDB,B6   SL$,AUTO
          1 00048A  DCC6 0002                            LDB,B5   2,B6
          1 00048C  DFC7 0006                            STB,B5   SL$,AUTO

      876    19001    3             END;  /* do while ... */

  19001   1 00048E  8DC7 0006                            CMN      SL$,AUTO
          1 000490  0981 FF87                            BNE      s:18964,PREL

      877    19002    2             RETURN;

  19002   1 000492  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      878    19003
      879    19004    2          CASE (%KX_CM_EV_DATRQS#);

      880    19005        /*
      881    19006           Call from packet requesting data to transmit.
      882    19007        */
      883    19008    2             IF KX$SL.CQMSG_.BYTSIZ = 0 AND KX$SL.OTPBFRBYTX = 0

  19008   1 000495  9846 0021                            LDR,R1   33,B6
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:129  
          1 000497  1981 000B                            BNEZ,R1  s:19014,PREL
          1 000499  E846 0023                            LDR,R6   35,B6
          1 00049B  6981 0007                            BNEZ,R6  s:19014,PREL

      884    19009    2                THEN
      885    19010    3                   DO;

      886    19011    3                      KX$SL.RPRDAT = '1'B;

  19011   1 00049D  8946 0009                            LBT,'0080'X       9,B6
  19011   1 00049F       0080

      887    19012    3                      RETURN;

  19012   1 0004A0  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      888    19013    3                   END;
      889    19014    2             IF KX$SL.CQMSG_.BYTSIZ > 0

  19014   1 0004A3  1901 0026                            BEZ,R1   s:19034,PREL

      890    19015    2                THEN
      891    19016    3                   DO;

      892    19017    3                      KX$SL.CQMSG_STAGE = KX$SL.CQMSG_STAGE + 1;

  19017   1 0004A5  E846 0024                            LDR,R6   36,B6
          1 0004A7  EA70 0001                            ADD,R6   1,IMO
          1 0004A9  EAC6 0024                            SRM,R6,'00FF'X    36,B6
          1 0004AB       00FF

      893    19018    3                      IF KX$SL.CQMSG_STAGE = 1

  19018   1 0004AC  E846 0024                            LDR,R6   36,B6
          1 0004AE  E570 00FF                            AND,R6   255,IMO
          1 0004B0  6D01                                 CMV,R6   1
          1 0004B1  0981 000D                            BNE      s:19028,PREL
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:130  

      894    19019    3                         THEN
      895    19020    4                            DO;

      896    19021    4                               FPT_X25.V_.ADR$ = KX$SL.CQMSG_.ADR$;

  19021   1 0004B3  BCC6 001E                            LDB,B3   30,B6
          1 0004B5  BFC4 000B                            STB,B3   11,B4

      897    19022    4                               FPT_X25.V_.BYTX = 0;

  19022   1 0004B7  8744 000D                            CL       13,B4

      898    19023    4                               FPT_X25.V_.BYTSIZ = KX$SL.CQMSG_.BYTSIZ;

  19023   1 0004B9  E846 0021                            LDR,R6   33,B6
          1 0004BB  EF44 000E                            STR,R6   14,B4

      899    19024    4                            END;

  19024   1 0004BD  0F81 0009                            B        s:19032,PREL

      900    19025    3                         ELSE
      901    19026        /* stage is 2. L3 is finished xmitting this CQMSG */
      902    19027    4                            DO;

      903    19028    4                               KX$SL.CQMSG_.BYTSIZ = 0;

  19028   1 0004BF  8746 0021                            CL       33,B6

      904    19029    4                               KX$SL.CQMSG_STAGE = 0;

  19029   1 0004C1  8846 0024                            LBF,'00FF'X       36,B6
  19029   1 0004C3       00FF

      905    19030    4                               KX$SL.RPRDAT = '1'B;

PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:131  
  19030   1 0004C4  8946 0009                            LBT,'0080'X       9,B6
  19030   1 0004C6       0080

      906    19031    4                            END;

      907    19032    3                      RETURN;

  19032   1 0004C7  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      908    19033    3                   END;
      909    19034    2             IF KX$SL.OTPBFRBYTX > 0

  19034   1 0004CA  E846 0023                            LDR,R6   35,B6
          1 0004CC  6901 0270                            BEZ,R6   s:19326,PREL

      910    19035    2                THEN
      911    19036    3                   DO;

      912    19037    3                      KX$SL.OTPBFR_STAGE = KX$SL.OTPBFR_STAGE + 1;

  19037   1 0004CE  E2C6 0024                            LLH,R6   36,B6
          1 0004D0  6E01                                 ADV,R6   1
          1 0004D1  E7C6 0024                            STH,R6   36,B6

      913    19038    3                      IF KX$SL.OTPBFR_STAGE = 1

  19038   1 0004D3  E2C6 0024                            LLH,R6   36,B6
          1 0004D5  6D01                                 CMV,R6   1
          1 0004D6  0981 000D                            BNE      s:19048,PREL

      914    19039    3                         THEN
      915    19040    4                            DO;

      916    19041    4                               FPT_X25.V_.ADR$ = KX$SL.OTPBFR$;

  19041   1 0004D8  BCC6 0006                            LDB,B3   6,B6
          1 0004DA  BFC4 000B                            STB,B3   11,B4
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:132  

      917    19042    4                               FPT_X25.V_.BYTX = 0;

  19042   1 0004DC  8744 000D                            CL       13,B4

      918    19043    4                               FPT_X25.V_.BYTSIZ = KX$SL.OTPBFRBYTX;

  19043   1 0004DE  E846 0023                            LDR,R6   35,B6
          1 0004E0  EF44 000E                            STR,R6   14,B4

      919    19044    4                            END;

  19044   1 0004E2  0F81 0008                            B        s:19052,PREL

      920    19045    3                         ELSE
      921    19046        /* stage is 2. L3 is finished xmitting this output buffer */
      922    19047    4                            DO;

      923    19048    4                               KX$SL.OTPBFRBYTX = 0;

  19048   1 0004E4  8746 0023                            CL       35,B6

      924    19049    4                               KX$SL.OTPBFR_STAGE = 0;

  19049   1 0004E6  87C6 0024                            CLH      36,B6

      925    19050    4                               KX$SL.RPRDAT = '1'B;

  19050   1 0004E8  8946 0009                            LBT,'0080'X       9,B6
  19050   1 0004EA       0080

      926    19051    4                            END;

      927    19052    3                      RETURN;

  19052   1 0004EB  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:133  
      928    19053    3                   END;
      929    19054
      930    19055    2          CASE ( %KX_CM_EV_DATOUT# );

      931    19056
      932    19057    2             IF KX$SL.RMTNOD <= 200 AND MSG$ ~= ADDR(NIL)

  19057   1 0004EE  92C6 0009                            LLH,R1   9,B6
          1 0004F0  9970 00C8                            CMR,R1   200,IMO
          1 0004F2  0A01 0010                            BAG      s:19067,PREL
          1 0004F4  8DC7 000A                            CMN      MSG$,AUTO
          1 0004F6  0901 000C                            BE       s:19067,PREL

      933    19058    2                THEN
      934    19059    3                   DO;

      935    19060        /*
      936    19061           For rfeps, the two bytes before the data message, which is KNH$MESS.MSGSZ,
      937    19062           is part of the message.
      938    19063        */
      939    19064    3                      MSG$ = PINCRW ( MSG$, -1 );

  19064   1 0004F8  BCC7 000A                            LDB,B3   MSG$,AUTO
          1 0004FA  ABC3 FFFF                            LAB,B2   -1,B3
          1 0004FC  AFC7 000A                            STB,B2   MSG$,AUTO

      940    19065    3                      FPT_X25.V_.BYTSIZ = FPT_X25.V_.BYTSIZ + 2;

  19065   1 0004FE  E844 000E                            LDR,R6   14,B4
          1 000500  6E02                                 ADV,R6   2
          1 000501  EF44 000E                            STR,R6   14,B4

      941    19066    3                   END;

      942    19067    2             IF KX$SL.START_RCQ$ ~= ADDR(NIL)

  19067   1 000503  8DC6 0026                            CMN      38,B6
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:134  
          1 000505  0901 0015                            BE       s:19077,PREL

      943    19068    2                THEN
      944    19069    2                   IF KX$SL.START_RCQ$ ~= MSG$

  19069   1 000507  BCC6 0026                            LDB,B3   38,B6
          1 000509  BDC7 000A                            CMB,B3   MSG$,AUTO
          1 00050B  0901 000A                            BE       s:19076,PREL

      945    19070    2                      THEN
      946    19071    3                         DO;

      947    19072    3                            KX$SL.BCKLOG = KX$SL.BCKLOG + FPT_X25.V_.BYTSIZ;

  19072   1 00050D  E846 0025                            LDR,R6   37,B6
          1 00050F  EA44 000E                            ADD,R6   14,B4
          1 000511  EF46 0025                            STR,R6   37,B6

      948    19073    3                            ALTRETURN;

  19073   1 000513  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      949    19074    3                         END;
      950    19075    2                      ELSE
      951    19076    2                         KX$SL.START_RCQ$ = ADDR(NIL);

  19076   1 000516  AB80 0000 0000                       LAB,B2   0
          1 000519  AFC6 0026                            STB,B2   38,B6

      952    19077    2             IF KX$SL.STATE >= %Y_ST_TERM# AND KX$SL.STATE <= %Y_ST_TERM_DCL#

  19077   1 00051B  E846 000C                            LDR,R6   12,B6
          1 00051D  6D04                                 CMV,R6   4
          1 00051E  0201 0007                            BL       s:19083,PREL
          1 000520  6D06                                 CMV,R6   6
          1 000521  0301 0004                            BG       s:19083,PREL

PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:135  
      953    19078    2                THEN
      954    19079        /*
      955    19080           Discard any data messages in these terminal states.
      956    19081        */
      957    19082    2                   RETURN;

  19082   1 000523  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      958    19083    2             KX$SL.BCKLOG = FPT_X25.V_.BYTSIZ;

  19083   1 000526  B844 000E                            LDR,R3   14,B4
          1 000528  BF46 0025                            STR,R3   37,B6

      959    19084    2             IF NOT KX$SL.RPRDAT

  19084   1 00052A  82C6 0009                            LB,'0080'X        9,B6
  19084   1 00052C       0080
          1 00052D  0501 0016                            BBT      s:19094,PREL

      960    19085    2                THEN
      961    19086    2                   IF NOT KX$L3.L2$->KX$L2.FLG.DATAVL

  19086   1 00052F  BCC5 0002                            LDB,B3   2,B5
          1 000531  82C3 002E                            LB,'0002'X        46,B3
          1 000533       0002
          1 000534  0501 0006                            BBT      s:19090,PREL

      962    19087    2                      THEN
      963    19088    2                         KX$SL.RPRDAT = '1'B;

  19088   1 000536  8946 0009                            LBT,'0080'X       9,B6
  19088   1 000538       0080
          1 000539  0F81 000A                            B        s:19094,PREL

      964    19089    2                      ELSE
      965    19090    3                         DO;

PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:136  
      966    19091    3   L_ALTRET:                KX$SL.START_RCQ$ = MSG$;

  19091   1 00053B  ECC7 000A            L_ALTRET        LDB,B6   MSG$,AUTO
          1 00053D  DCC7 0006                            LDB,B5   SL$,AUTO
          1 00053F  EFC5 0026                            STB,B6   38,B5

      967    19092    3                            ALTRETURN;

  19092   1 000541  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

      968    19093    3                         END;
      969    19094    2             IF KX$SL.CQMSG_STAGE > 0

  19094   1 000544  82C6 0024                            LB,'00FF'X        36,B6
  19094   1 000546       00FF
          1 000547  0581 0009                            BBF      s:19102,PREL

      970    19095    2                THEN
      971    19096    3                   DO;

      972    19097    3                      KX$SL.CQMSG_STAGE = 0; /* Message is in L2 or L3, so just */

  19097   1 000549  8846 0024                            LBF,'00FF'X       36,B6
  19097   1 00054B       00FF

      973    19098    3                      KX$SL.CQMSG_.BYTSIZ = 0; /* zap, since L2 may be blocked. */

  19098   1 00054C  8746 0021                            CL       33,B6

      974    19099                           /* IF KX$SL.CQMSG_.ADR$ ~= MSG$ THEN SCREECH; */
      975    19100    3                      RETURN;

  19100   1 00054E  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      976    19101    3                   END;
      977    19102    2             CALL_FPT.EVN = %KX_P_EV_DATAVL#;

PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:137  
  19102   1 000551  2C0B                                 LDV,R2   11
          1 000552  AF47 0015                            STR,R2   CALL_FPT,AUTO

      978    19103    2             IF FPT_X25.V_.BYTSIZ >= KX$SL.OTPBFRBYTSIZ OR KX$SL.RMTNOD > 200

  19103   1 000554  E844 000E                            LDR,R6   14,B4
          1 000556  E946 0022                            CMR,R6   34,B6
          1 000558  0281 0007                            BGE      s:19106,PREL
          1 00055A  92C6 0009                            LLH,R1   9,B6
          1 00055C  9970 00C8                            CMR,R1   200,IMO
          1 00055E  0A81 001A                            BALE     s:19118,PREL

      979    19104    2                THEN
      980    19105    3                   DO;

      981    19106    3                      IF KX$SL.OTPBFRBYTX > 0

  19106   1 000560  9846 0023                            LDR,R1   35,B6
          1 000562  1901 0004                            BEZ,R1   s:19111,PREL

      982    19107    3                         THEN
      983    19108    4                            DO;

      984    19109    4                               CALL Y$RPRDAT ALTRET (L_ALTRET);

  19109   1 000564  E3C0 0590                            LNJ,B6   s:0,PREL
          1 000566       FFD5                            DC       s:19090,PREL

      985    19110    4                            END;

      986    19111    3                      KX$SL.CQMSG_.ADR$ = MSG$;

  19111   1 000567  ECC7 000A                            LDB,B6   MSG$,AUTO
          1 000569  DCC7 0006                            LDB,B5   SL$,AUTO
          1 00056B  EFC5 001E                            STB,B6   30,B5

      987    19112    3                      KX$SL.CQMSG_.BYTSIZ = FPT_X25.V_.BYTSIZ;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:138  

  19112   1 00056D  CCC7 0004                            LDB,B4   @FPT_X25,AUTO
          1 00056F  E844 000E                            LDR,R6   14,B4
          1 000571  EF45 0021                            STR,R6   33,B5

      988    19113    3                      CALL Y$RPRDAT ALTRET ( L_ALTRET );

  19113   1 000573  E3C0 0581                            LNJ,B6   s:0,PREL
          1 000575       FFC6                            DC       s:19090,PREL

      989    19114    3                      RETURN;

  19114   1 000576  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

      990    19115    3                   END;
      991    19116    2                ELSE
      992    19117    3                   DO;

      993    19118    3                      IF FPT_X25.V_.BYTSIZ > KX$SL.OTPBFRBYTSIZ - KX$SL.OTPBFRBYTX

  19118   1 000579  E846 0022                            LDR,R6   34,B6
          1 00057B  E246 0023                            SUB,R6   35,B6
          1 00057D  6801 0009                            BLZ,R6   s:19122,PREL
          1 00057F  E944 000E                            CMR,R6   14,B4
          1 000581  0201 0005                            BL       s:19122,PREL
          1 000583  E2C6 0024                            LLH,R6   36,B6
          1 000585  6901 0004                            BEZ,R6   s:19124,PREL

      994    19119    3                         OR KX$SL.OTPBFR_STAGE > 0
      995    19120    3                         THEN
      996    19121    4                            DO;

      997    19122    4                               CALL Y$RPRDAT ALTRET (L_ALTRET);

  19122   1 000587  E3C0 056D                            LNJ,B6   s:0,PREL
          1 000589       FFB2                            DC       s:19090,PREL

PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:139  
      998    19123    4                            END;

      999    19124    3                      SUBSTR ( KX$SL.OTPBFR$->B$STR, KX$SL.OTPBFRBYTX, FPT_X25.V_.
             19124                               BYTSIZ )

  19124   1 00058A  ECC7 0006                            LDB,B6   SL$,AUTO
          1 00058C  DCC6 0006                            LDB,B5   6,B6
          1 00058E  E846 0023                            LDR,R6   35,B6
          1 000590  CCC7 0004                            LDB,B4   @FPT_X25,AUTO
          1 000592  D844 000E                            LDR,R5   14,B4
          1 000594  ACC7 000A                            LDB,B2   MSG$,AUTO
          1 000596  2C00                                 LDV,R2   0
          1 000597  EF47 0094                            STR,R6   I+2,AUTO
          1 000599  E855                                 LDR,R6   R5
          1 00059A  BB85                                 LAB,B3   ,B5
          1 00059B  B847 0094                            LDR,R3   I+2,AUTO
          1 00059D  0008                                 MMM

     1000    19125    3                         = SUBSTR ( MSG$->B$STR, 0, FPT_X25.V_.BYTSIZ );
     1001    19126    3                      KX$SL.OTPBFRBYTX = KX$SL.OTPBFRBYTX + FPT_X25.V_.BYTSIZ;

  19126   1 00059E  ECC7 0006                            LDB,B6   SL$,AUTO
          1 0005A0  E846 0023                            LDR,R6   35,B6
          1 0005A2  EA44 000E                            ADD,R6   14,B4
          1 0005A4  EF46 0023                            STR,R6   35,B6

     1002    19127    3                      KX$SL.BCKLOG = 0;

  19127   1 0005A6  8746 0025                            CL       37,B6

     1003    19128        /*
     1004    19129           tells KXC$CQSCN to inform me of CQSCN_XIT later.
     1005    19130        */
     1006    19131    3                      FPT_X25.RET_BIT1 = '1'B;

  19131   1 0005A8  8944 000F                            LBT,'0400'X       15,B4
  19131   1 0005AA       0400
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:140  

     1007    19132    3                      RETURN;

  19132   1 0005AB  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1008    19133    3                   END;
     1009    19134
     1010    19135    2          CASE ( %KX_CM_EV_DATIN# );

     1011    19136
     1012    19137    2             IF KX$SL.STATE ~= %Y_ST_NORMAL#

  19137   1 0005AE  9846 000C                            LDR,R1   12,B6
          1 0005B0  1D03                                 CMV,R1   3
          1 0005B1  0901 0004                            BE       s:19140,PREL

     1013    19138    2                THEN
     1014    19139    2                   ALTRETURN;

  19139   1 0005B3  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

     1015    19140    2             IF FPT_X25.V_.BYTSIZ < 3 AND KX$SL.RMTNOD > 200

  19140   1 0005B6  E844 000E                            LDR,R6   14,B4
          1 0005B8  6D03                                 CMV,R6   3
          1 0005B9  0281 0012                            BGE      s:19157,PREL
          1 0005BB  E2C6 0009                            LLH,R6   9,B6
          1 0005BD  E970 00C8                            CMR,R6   200,IMO
          1 0005BF  0A81 000C                            BALE     s:19157,PREL

     1016    19141          /* 2 bytes (size) + >1 byte (data) */
     1017    19142    2                THEN
     1018    19143    3                   DO;

     1019    19144    3                      ERCOD = Y_SHR_PKT;

  19144   1 0005C1  8C80 0000 006E  00                   LDI      Y_SHR_PKT
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:141  
          1 0005C4  8D47 002D                            SDI      ERCOD,AUTO

     1020    19145    3                      CALL Y$ER;

  19145   1 0005C6  E3C0 056C                            LNJ,B6   s:0,PREL
          1 0005C8       0001                            DC       s:19146,PREL

     1021    19146    3                      RETURN;

  19146   1 0005C9  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1022    19147    3                   END;
     1023    19148        /*
     1024    19149               DATIN - process data coming in from the line.
     1025    19150               A packet may contain concatenated network messages.
     1026    19151               Each rfep message is preceded
     1027    19152               by a word which indicates its byte size. Balance of the byte count
     1028    19153               and the packet boundary has to be checked. The packet will be
     1029    19154               discarded if a message size of 0 is encountered.
     1030    19155        */
     1031    19156
     1032    19157    2             KNH_MESS.FUNCTION = %KN_FCN_DATA;

  19157   1 0005CC  6C05                                 LDV,R6   5
          1 0005CD  EF47 0025                            STR,R6   KNH_MESS,AUTO

     1033    19158
     1034    19159               /*  Possibly concatenated messages  */
     1035    19160    2             KV@SNDCQ.MSG_.ADR$ (1) = FPT_X25.V_.ADR$;

  19160   1 0005CF  BCC4 000B                            LDB,B3   11,B4
          1 0005D1  BFC7 0072                            STB,B3   KV@SNDCQ+4,AUTO

     1036    19161    2             IF KX$SL.SNDDAT_ALTRET AND FPT_X25.V_.ADR$ = KX$SL.INPDAT_.ADR$

  19161   1 0005D3  82C6 0009                            LB,'0020'X        9,B6
  19161   1 0005D5       0020
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:142  
          1 0005D6  0581 000D                            BBF      s:19165,PREL
          1 0005D8  ACC4 000B                            LDB,B2   11,B4
          1 0005DA  ADC6 001A                            CMB,B2   26,B6
          1 0005DC  0981 0007                            BNE      s:19165,PREL

     1037    19162    2                THEN
     1038    19163    2                   BYTX = KX$SL.INPDAT_.BYTX;

  19163   1 0005DE  B846 001C                            LDR,R3   28,B6
          1 0005E0  BF47 0013                            STR,R3   BYTX,AUTO
          1 0005E2  0F81 0005                            B        s:19166,PREL

     1039    19164    2                ELSE
     1040    19165    2                   BYTX = FPT_X25.V_.BYTX;

  19165   1 0005E4  B844 000D                            LDR,R3   13,B4
          1 0005E6  BF47 0013                            STR,R3   BYTX,AUTO

     1041    19166    3   INP_LOP:  DO WHILE ( BYTX < FPT_X25.V_.BYTX + FPT_X25.V_.BYTSIZ );

  19166   1 0005E8  0F81 006F            INP_LOP         B        s:19192,PREL

     1042    19167    3                IF KX$SL.RMTNOD <= 200

  19167   1 0005EA  ECC7 0006                            LDB,B6   SL$,AUTO
          1 0005EC  E2C6 0009                            LLH,R6   9,B6
          1 0005EE  E970 00C8                            CMR,R6   200,IMO
          1 0005F0  0A01 0028                            BAG      s:19179,PREL

     1043    19168    3                   THEN
     1044    19169    4                      DO;

     1045    19170    4                         KNH_MESS.MSGSZ = INPDAT_ARY(BYTX)*256 + INPDAT_ARY(BYTX+1);

  19170   1 0005F2  DCC7 0004                            LDB,B5   @FPT_X25,AUTO
          1 0005F4  CCC5 000B                            LDB,B4   11,B5
          1 0005F6  B847 0013                            LDR,R3   BYTX,AUTO
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:143  
          1 0005F8  D2B4                                 LLH,R5   ,B4,R3
          1 0005F9  5008                                 SOL,R5   8
          1 0005FA  3E01                                 ADV,R3   1
          1 0005FB  C2B4                                 LLH,R4   ,B4,R3
          1 0005FC  DA54                                 ADD,R5   R4
          1 0005FD  DF47 002C                            STR,R5   KNH_MESS+7,AUTO

     1046    19171    4                         IF KNH_MESS.MSGSZ = 0 OR (FPT_X25.V_.BYTSIZ > KX_BUF.SIZ

  19171   1 0005FF  5901 0064                            BEZ,R5   s:19193,PREL
          1 000601  CCC7 0008                            LDB,B4   L3$,AUTO
          1 000603  A2C4 0014                            LLH,R2   20,B4
          1 000605  E845 000E                            LDR,R6   14,B5
          1 000607  E920 0000 001E  xsym                 CMR,R6   KX_BUF+30,R2
          1 00060A  0381 0007                            BLE      s:19176,PREL
          1 00060C  6EFE                                 ADV,R6   -2
          1 00060D  6801 0056                            BLZ,R6   s:19193,PREL
          1 00060F  E955                                 CMR,R6   R5
          1 000610  0981 0053                            BNE      s:19193,PREL

     1047    19172    4                            (KX$L3.CALL_OPTS.RCVPCKSIZ) AND
     1048    19173    4                            KNH_MESS.MSGSZ ~= FPT_X25.V_.BYTSIZ-2)
     1049    19174    4                            THEN
     1050    19175    4                               EXIT INP_LOP;
     1051    19176    4                         BYTX = BYTX + 2;

  19176   1 000612  E847 0013                            LDR,R6   BYTX,AUTO
          1 000614  6E02                                 ADV,R6   2
          1 000615  EF47 0013                            STR,R6   BYTX,AUTO

     1052    19177    4                      END;

  19177   1 000617  0F81 0007                            B        s:19180,PREL

     1053    19178    3                   ELSE
     1054    19179    3                      KNH_MESS.MSGSZ = FPT_X25.V_.BYTSIZ;

PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:144  
  19179   1 000619  DCC7 0004                            LDB,B5   @FPT_X25,AUTO
          1 00061B  D845 000E                            LDR,R5   14,B5
          1 00061D  DF47 002C                            STR,R5   KNH_MESS+7,AUTO

     1055    19180    3                KV@SNDCQ.MSG_.BYTSIZ (1) = (KNH_MESS.MSGSZ + 3 ) / 4 * 4;

  19180   1 00061F  5E03                                 ADV,R5   3
          1 000620  5042                                 SOR,R5   2
          1 000621  5002                                 SOL,R5   2
          1 000622  DF47 0075                            STR,R5   KV@SNDCQ+7,AUTO

     1056    19181    3                KV@SNDCQ.MSG_.BYTX (1) = BYTX;

  19181   1 000624  E847 0013                            LDR,R6   BYTX,AUTO
          1 000626  EF47 0074                            STR,R6   KV@SNDCQ+6,AUTO

     1057    19182    3                CALL KVM$SNDCQ ( KV@SNDCQ ) WHENALTRETURN

  19182   1 000628  CBC7 006E                            LAB,B4   KV@SNDCQ,AUTO
          1 00062A  CFC7 0094                            STB,B4   I+2,AUTO
          1 00062C  BBC7 0094                            LAB,B3   I+2,AUTO
          1 00062E  CBF0 0100                            LAB,B4   256,IMO
          1 000630  E380 0000 0000  xent                 LNJ,B6   KVM$SNDCQ
          1 000633       0003                            DC       s:19184,PREL
          1 000634  0F81 001D                            B        s:19191,PREL

     1058    19183    4                      DO;

     1059    19184    4                         KX$SL.SNDDAT_ALTRET = '1'B;

  19184   1 000636  ECC7 0006                            LDB,B6   SL$,AUTO
          1 000638  8946 0009                            LBT,'0020'X       9,B6
          1 00063A       0020

     1060    19185    4                         KX$SL.INPDAT_ = FPT_X25.V_;

  19185   1 00063B  ACC7 0004                            LDB,B2   @FPT_X25,AUTO
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:145  
          1 00063D  2C16                                 LDV,R2   22
          1 00063E  6C08                                 LDV,R6   8
          1 00063F  BB86                                 LAB,B3   ,B6
          1 000640  3C34                                 LDV,R3   52
          1 000641  0008                                 MMM

     1061    19186    4                         IF KX$SL.RMTNOD <= 200

  19186   1 000642  DCC7 0006                            LDB,B5   SL$,AUTO
          1 000644  E2C5 0009                            LLH,R6   9,B5
          1 000646  E970 00C8                            CMR,R6   200,IMO
          1 000648  0A01 0006                            BAG      s:19189,PREL

     1062    19187    4                            THEN
     1063    19188    4                               KX$SL.INPDAT_.BYTX = BYTX - 2;

  19188   1 00064A  D847 0013                            LDR,R5   BYTX,AUTO
          1 00064C  5EFE                                 ADV,R5   -2
          1 00064D  DF45 001C                            STR,R5   28,B5

     1064    19189    4                         ALTRETURN;

  19189   1 00064F  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

     1065    19190    4                      END;
     1066    19191    3                BYTX = BYTX + KNH_MESS.MSGSZ;

  19191   1 000652  E847 0013                            LDR,R6   BYTX,AUTO
          1 000654  EA47 002C                            ADD,R6   KNH_MESS+7,AUTO
          1 000656  EF47 0013                            STR,R6   BYTX,AUTO

     1067    19192    3             END;  /* do while ( bytx ... ) */

  19192   1 000658  ECC7 0004                            LDB,B6   @FPT_X25,AUTO
          1 00065A  E846 000D                            LDR,R6   13,B6
          1 00065C  EA46 000E                            ADD,R6   14,B6
          1 00065E  6801 0005                            BLZ,R6   s:19193,PREL
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:146  
          1 000660  E947 0013                            CMR,R6   BYTX,AUTO
          1 000662  0301 FF87                            BG       s:19167,PREL

     1068    19193    2             IF BYTX ~= FPT_X25.V_.BYTX + FPT_X25.V_.BYTSIZ

  19193   1 000664  ECC7 0004                            LDB,B6   @FPT_X25,AUTO
          1 000666  E846 000D                            LDR,R6   13,B6
          1 000668  EA46 000E                            ADD,R6   14,B6
          1 00066A  6801 0005                            BLZ,R6   s:19196,PREL
          1 00066C  E947 0013                            CMR,R6   BYTX,AUTO
          1 00066E  0901 0009                            BE       s:19203,PREL

     1069    19194    2                THEN
     1070    19195    3                   DO;

     1071    19196    3                      ERCOD = Y_UNB_PKT;

  19196   1 000670  8C80 0000 0070  00                   LDI      Y_UNB_PKT
          1 000673  8D47 002D                            SDI      ERCOD,AUTO

     1072    19197    3                      CALL Y$ER;

  19197   1 000675  E3C0 04BD                            LNJ,B6   s:0,PREL
          1 000677       0001                            DC       s:19203,PREL

     1073    19198    3                   END;

     1074    19199        /*
     1075    19200           To get here, we must have successfully delivered all the network messages
     1076    19201           in the current input block.
     1077    19202        */
     1078    19203    2             KX$SL.SNDDAT_ALTRET = '0'B;

  19203   1 000678  ECC7 0006                            LDB,B6   SL$,AUTO
          1 00067A  8846 0009                            LBF,'0020'X       9,B6
          1 00067C       0020

PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:147  
     1079    19204    2             KX$SL.INPDAT_ = '0'B;

  19204   1 00067D  5C08                                 LDV,R5   8
          1 00067E  0021                                 ALR      ;
          1 00067F       4178 0000                                ALPHANUM('0000'X,IMO,,1),;
          1 000681       4006 001A                                ALPHANUM(26,B6,,R5,FILL)

     1080    19205    2             RETURN;

  19205   1 000683  437F                                 CSYNC    s:19204+5,SPREL
          1 000684  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1081    19206        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:148  
     1082    19207
     1083    19208    2          CASE ( %KX_CM_EV_VCRST#, %KX_CM_EV_RSTIND#);

     1084    19209        /*
     1085    19210           A VC is undergoing a reset procedure. Send a CQ RESET message if we are
     1086    19211           in NORMAL state. Otherwise ignore.
     1087    19212        */
     1088    19213    2             IF KX$SL.STATE = %Y_ST_NORMAL# AND KX$SL.RMTNOD > 200

  19213   1 000687  9846 000C                            LDR,R1   12,B6
          1 000689  1D03                                 CMV,R1   3
          1 00068A  0981 001D                            BNE      s:19225,PREL
          1 00068C  E2C6 0009                            LLH,R6   9,B6
          1 00068E  E970 00C8                            CMR,R6   200,IMO
          1 000690  0A81 0017                            BALE     s:19225,PREL

     1089    19214        /* make sure we are not an rfep too */
     1090    19215    2                THEN
     1091    19216    3                   DO;

     1092    19217    3                      KNH_MESS.FUNCTION = %KN_FCN_RESET;

  19217   1 000692  6C0A                                 LDV,R6   10
          1 000693  EF47 0025                            STR,R6   KNH_MESS,AUTO

     1093    19218    3                      KNH_MESS.FPTSZ = LENGTHC(FPT@RESET);

  19218   1 000695  3C04                                 LDV,R3   4
          1 000696  BF47 002B                            STR,R3   KNH_MESS+6,AUTO

     1094    19219    3                      KV@SNDCQ.MSG_.ADR$ (1) = ADDR(FPT@RESET);

  19219   1 000698  BBC7 0068                            LAB,B3   FPT@RESET,AUTO
          1 00069A  BFC7 0072                            STB,B3   KV@SNDCQ+4,AUTO

     1095    19220    3                      KV@SNDCQ.MSG_.BYTSIZ (1) = ( LENGTHC(FPT@RESET) + 3 ) / 4 * 4;

PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:149  
  19220   1 00069C  BF47 0075                            STR,R3   KV@SNDCQ+7,AUTO

     1096    19221    3                      FPT@RESET.CAUSE = FPT_X25.PRM1;

  19221   1 00069E  A844 0005                            LDR,R2   5,B4
          1 0006A0  AF47 0068                            STR,R2   FPT@RESET,AUTO

     1097    19222    3                      FPT@RESET.DIAG = FPT_X25.PRM2;

  19222   1 0006A2  9844 0006                            LDR,R1   6,B4
          1 0006A4  9F47 0069                            STR,R1   FPT@RESET+1,AUTO

     1098    19223    3                      GOTO SNDCQ2;

  19223   1 0006A6  0F81 0037                            B        s:19259,PREL

     1099    19224    3                   END;
     1100    19225    2             RETURN;

  19225   1 0006A8  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1101    19226
     1102    19227    2          CASE (%KX_CM_EV_INT#);

     1103    19228        /*
     1104    19229          Interrupt packet received. Send a CQ message if we are in NORMAL state.
     1105    19230          Otherwise ignore.
     1106    19231        */
     1107    19232        /* make sure we are not an rfep too */
     1108    19233    2             IF KX$SL.STATE = %Y_ST_NORMAL# AND KX$SL.RMTNOD > 200

  19233   1 0006AB  9846 000C                            LDR,R1   12,B6
          1 0006AD  1D03                                 CMV,R1   3
          1 0006AE  0981 001F                            BNE      s:19243,PREL
          1 0006B0  E2C6 0009                            LLH,R6   9,B6
          1 0006B2  E970 00C8                            CMR,R6   200,IMO
          1 0006B4  0A81 0019                            BALE     s:19243,PREL
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:150  

     1109    19234    2                THEN
     1110    19235    3                   DO;

     1111    19236    3                      KNH_MESS.FUNCTION = %KN_FCN_EXPEDITED_DATA;

  19236   1 0006B6  6C0D                                 LDV,R6   13
          1 0006B7  EF47 0025                            STR,R6   KNH_MESS,AUTO

     1112    19237    3                      KNH_MESS.MSGSZ = FPT_X25.V_.BYTSIZ;

  19237   1 0006B9  B844 000E                            LDR,R3   14,B4
          1 0006BB  BF47 002C                            STR,R3   KNH_MESS+7,AUTO

     1113    19238    3                      KV@SNDCQ.MSG_.ADR$ (1) = FPT_X25.V_.ADR$;

  19238   1 0006BD  BCC4 000B                            LDB,B3   11,B4
          1 0006BF  BFC7 0072                            STB,B3   KV@SNDCQ+4,AUTO

     1114    19239    3                      KV@SNDCQ.MSG_.BYTSIZ (1) = ( FPT_X25.V_.BYTSIZ + 3 ) / 4 * 4;

  19239   1 0006C1  A844 000E                            LDR,R2   14,B4
          1 0006C3  2E03                                 ADV,R2   3
          1 0006C4  2042                                 SOR,R2   2
          1 0006C5  2002                                 SOL,R2   2
          1 0006C6  AF47 0075                            STR,R2   KV@SNDCQ+7,AUTO

     1115    19240    3                      KV@SNDCQ.MSG_.BYTX (1) = FPT_X25.V_.BYTX;

  19240   1 0006C8  9844 000D                            LDR,R1   13,B4
          1 0006CA  9F47 0074                            STR,R1   KV@SNDCQ+6,AUTO

     1116    19241    3                      GOTO SNDCQ2;

  19241   1 0006CC  0F81 0011                            B        s:19259,PREL

     1117    19242    3                   END;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:151  
     1118    19243    2             RETURN;

  19243   1 0006CE  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1119    19244
     1120    19245    2          CASE (%KX_CM_EV_INTACK#);

     1121    19246        /*
     1122    19247           Positive acknowledgement for transmitted interrupt.
     1123    19248        */
     1124    19249    2             KNH_MESS.FUNCTION = %KN_FCN_EXPEDITED_DATA_ACK;

  19249   1 0006D1  1C0E                                 LDV,R1   14
          1 0006D2  9F47 0025                            STR,R1   KNH_MESS,AUTO

     1125    19250    2             GOTO SNDCQ1;

  19250   1 0006D4  0F81 0004                            B        s:19257,PREL

     1126    19251
     1127    19252    2          CASE (%KX_CM_EV_INTNAK#);

     1128    19253        /*
     1129    19254           Negative acknowledgement for transmitted interrupt.
     1130    19255        */
     1131    19256    2             KNH_MESS.FUNCTION = %KN_FCN_EXPEDITED_DATA_NAK;

  19256   1 0006D6  1C0F                                 LDV,R1   15
          1 0006D7  9F47 0025                            STR,R1   KNH_MESS,AUTO

     1132    19257    2   SNDCQ1:   IF KX$SL.STATE = %Y_ST_NORMAL#

  19257   1 0006D9  B846 000C            SNDCQ1          LDR,R3   12,B6
          1 0006DB  3D03                                 CMV,R3   3
          1 0006DC  0981 000F                            BNE      s:19266,PREL

     1133    19258    2                THEN
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:152  
     1134    19259    3                   DO;

     1135    19260    3   SNDCQ2:            CALL KVM$SNDCQ ( KV@SNDCQ )

  19260   1 0006DE  BBC7 006E            SNDCQ2          LAB,B3   KV@SNDCQ,AUTO
          1 0006E0  BFC7 0094                            STB,B3   I+2,AUTO
          1 0006E2  BBC7 0094                            LAB,B3   I+2,AUTO
          1 0006E4  CBF0 0100                            LAB,B4   256,IMO
          1 0006E6  E380 0000 0000  xent                 LNJ,B6   KVM$SNDCQ
          1 0006E9       0003                            DC       s:19266,PREL
          1 0006EA  0F81 0001                            B        s:19266,PREL

     1136    19261    3                         WHENALTRETURN
     1137    19262    4                            DO;

     1138    19263        /*N* forget it? */
     1139    19264    4                            END;

     1140    19265    3                   END;

     1141    19266    2             RETURN;

  19266   1 0006EC  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1142    19267
     1143    19268    2          CASE (%KX_CM_EV_RSTRQS#);

     1144    19269        /*
     1145    19270           Network wants to initiate a reset on this VC
     1146    19271        */
     1147    19272    2             IF KX$SL.STATE = %Y_ST_NORMAL#

  19272   1 0006EF  9846 000C                            LDR,R1   12,B6
          1 0006F1  1D03                                 CMV,R1   3
          1 0006F2  0981 000F                            BNE      s:19281,PREL

     1148    19273    2                THEN
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:153  
     1149    19274    3                   DO;

     1150    19275    3                      CALL_FPT.EVN = %KX_P_EV_VCRST#;

  19275   1 0006F4  6C0A                                 LDV,R6   10
          1 0006F5  EF47 0015                            STR,R6   CALL_FPT,AUTO

     1151    19276    3                      CALL_FPT.PRM1 = FPT$RESET.CAUSE;

  19276   1 0006F7  BCC7 000C                            LDB,B3   FPT$,AUTO
          1 0006F9  B803                                 LDR,R3   ,B3
          1 0006FA  BF47 001A                            STR,R3   CALL_FPT+5,AUTO

     1152    19277    3                      CALL_FPT.PRM2 = FPT$RESET.DIAG;

  19277   1 0006FC  A843 0001                            LDR,R2   1,B3
          1 0006FE  AF47 001B                            STR,R2   CALL_FPT+6,AUTO

     1153    19278    3                      GOTO CAL_KXP;

  19278   1 000700  0F81 0018                            B        s:19295,PREL

     1154    19279    3                   END;
     1155    19280    2                ELSE
     1156    19281    2                   IF KX$SL.STATE >= %Y_ST_TERM#

  19281   1 000702  1D04                                 CMV,R1   4
          1 000703  0201 0004                            BL       s:19284,PREL

     1157    19282    2                      THEN
     1158    19283    2                         RETURN;

  19283   1 000705  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1159    19284    2             ALTRETURN;

  19284   1 000708  C380 0000 0000  xent                 LNJ,B4   X6A_AALT
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:154  

     1160    19285
     1161    19286    2          CASE (%KX_CM_EV_INTRQS#);

     1162    19287        /*
     1163    19288           Network wants to send an interrupt packet.
     1164    19289        */
     1165    19290    2             IF KX$SL.STATE = %Y_ST_NORMAL#

  19290   1 00070B  9846 000C                            LDR,R1   12,B6
          1 00070D  1D03                                 CMV,R1   3
          1 00070E  0981 0010                            BNE      s:19299,PREL

     1166    19291    2                THEN
     1167    19292    3                   DO;

     1168    19293    3                      CALL_FPT.EVN = %KX_P_EV_SNDINT#;

  19293   1 000710  6C12                                 LDV,R6   18
          1 000711  EF47 0015                            STR,R6   CALL_FPT,AUTO

     1169    19294    3                      CALL_FPT.V_ = FPT_X25.V_;

  19294   1 000713  AB84                                 LAB,B2   ,B4
          1 000714  2C16                                 LDV,R2   22
          1 000715  6C08                                 LDV,R6   8
          1 000716  BB87                                 LAB,B3   ,AUTO
          1 000717  3C40                                 LDV,R3   64
          1 000718  0008                                 MMM

     1170    19295    3   CAL_KXP:           CALL Y$CAL_KXP;

  19295   1 000719  E3C0 03FD            CAL_KXP         LNJ,B6   s:0,PREL
          1 00071B       0001                            DC       s:19296,PREL

     1171    19296    3                      RETURN;

PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:155  
  19296   1 00071C  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1172    19297    3                   END;
     1173    19298    2                ELSE
     1174    19299    2                   IF KX$SL.STATE >= %Y_ST_TERM#

  19299   1 00071F  1D04                                 CMV,R1   4
          1 000720  0201 0004                            BL       s:19302,PREL

     1175    19300    2                      THEN
     1176    19301    2                         RETURN;

  19301   1 000722  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1177    19302    2             ALTRETURN;

  19302   1 000725  C380 0000 0000  xent                 LNJ,B4   X6A_AALT

     1178    19303
     1179    19304    2          CASE (%KX_CM_EV_RLSL3#);

     1180    19305        /*
     1181    19306           The L3 context is about to be released. Let's nil KX$SL.L3$.
     1182    19307           This is a non-state-table event.
     1183    19308        */
     1184    19309    2             IF SL$ ~= ADDR(NIL)

  19309   1 000728  8DC7 0006                            CMN      SL$,AUTO
          1 00072A  0901 0006                            BE       s:19312,PREL

     1185    19310    2                THEN
     1186    19311    2                   KX$SL.L3$ = ADDR(NIL);

  19311   1 00072C  BB80 0000 0000                       LAB,B3   0
          1 00072F  BFC6 0004                            STB,B3   4,B6

     1187    19312    2             RETURN;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:156  

  19312   1 000731  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1188    19313
     1189    19314    2          CASE ( ELSE );

     1190    19315        /*S* SCREECH_CODE: KXV-S$KX_SL_UNKEVT#
     1191    19316             MESSAGE: KXV received a call with an unknown event.
     1192    19317        */
     1193    19318    2             CALL KHD$SCREECH ( Y_UNKEVT );

  19318   1 000734  BB80 0000 0003  02                   LAB,B3   +3
          1 000737  CBF0 0100                            LAB,B4   256,IMO
          1 000739  E380 0000 0000  xent                 LNJ,B6   KHD$SCREECH
          1 00073C       0001                            DC       s:19326,PREL

     1194    19319
     1195    19320    2       END; /*  Case on external event  */

     1196    19321        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:157  
     1197    19322        /*
     1198    19323                                             Update the state and perform the
     1199    19324                                             specified action.
     1200    19325        */
     1201    19326    1       STATE = KX$SL.STATE;

  19326   1 00073D  ECC7 0006                            LDB,B6   SL$,AUTO
          1 00073F  E846 000C                            LDR,R6   12,B6
          1 000741  EF47 0010                            STR,R6   STATE,AUTO

     1202    19327    1       KVBSIZ = STATE * ( %Y_EV_MAX# + 1 ) + EVENT;

  19327   1 000743  6F0A                                 MLV,R6   10
          1 000744  EA47 000E                            ADD,R6   EVENT,AUTO
          1 000746  EF47 0014                            STR,R6   KVBSIZ,AUTO

     1203    19328    1       STATE = STATE_TABLE.NEXT_STATE ( KVBSIZ );

  19328   1 000748  B856                                 LDR,R3   R6
          1 000749  D2B0 0000 0000  00                   LLH,R5   STATE_TABLE,R3
          1 00074C  DF47 0010                            STR,R5   STATE,AUTO

     1204    19329    1       KX$SL.STATE = STATE;

  19329   1 00074E  DF46 000C                            STR,R5   12,B6

     1205    19330    1       ACTION = STATE_TABLE.ACTION ( KVBSIZ );

  19330   1 000750  A847 0014                            LDR,R2   KVBSIZ,AUTO
          1 000752  C2A0 0000 0037  00                   LLH,R4   STATE_TABLE+55,R2
          1 000755  CF47 000F                            STR,R4   ACTION,AUTO

     1206    19331    1       KX$SL.HIST.STT ( KX$SL.HIST.X ) = STATE;

  19331   1 000757  9846 000D                            LDR,R1   13,B6
          1 000759  1E1C                                 ADV,R1   28
          1 00075A  D796                                 STH,R5   ,B6,R1
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:158  

     1207    19332    1       KX$SL.HIST.EVT ( KX$SL.HIST.X ) = EVENT;

  19332   1 00075B  ECC7 0006                            LDB,B6   SL$,AUTO
          1 00075D  A846 000D                            LDR,R2   13,B6
          1 00075F  9847 000E                            LDR,R1   EVENT,AUTO
          1 000761  2E24                                 ADV,R2   36
          1 000762  97A6                                 STH,R1   ,B6,R2

     1208    19333    1       KX$SL.HIST.ACT ( KX$SL.HIST.X ) = ACTION;

  19333   1 000763  ECC7 0006                            LDB,B6   SL$,AUTO
          1 000765  A846 000D                            LDR,R2   13,B6
          1 000767  2E2C                                 ADV,R2   44
          1 000768  C7A6                                 STH,R4   ,B6,R2

     1209    19334    1       KX$SL.HIST.X = MOD ( KX$SL.HIST.X + 1, 8 );

  19334   1 000769  ECC7 0006                            LDB,B6   SL$,AUTO
          1 00076B  A846 000D                            LDR,R2   13,B6
          1 00076D  2E01                                 ADV,R2   1
          1 00076E  A570 0007                            AND,R2   7,IMO
          1 000770  AF46 000D                            STR,R2   13,B6

     1210    19335
     1211    19336    2       DO CASE ( ACTION );

  19336   1 000772  B854                                 LDR,R3   R4
          1 000773  3D0B                                 CMV,R3   11
          1 000774  0281 037C                            BGE      s:19638,PREL
          1 000776  A830 0000 077C  01                   LDR,R2   s:19336+10,R3
          1 000779  83A0 0000 0787  01                   JMP      s:19344,R2
          1 00077C       036C                            DC       s:19640,PREL
          1 00077D       015D                            DC       s:19472,PREL
          1 00077E       005D                            DC       s:19374,PREL
          1 00077F       0306                            DC       s:19587,PREL
          1 000780       0168                            DC       s:19483,PREL
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:159  
          1 000781       021E                            DC       s:19525,PREL
          1 000782       0000                            DC       s:19344,PREL
          1 000783       00F5                            DC       s:19416,PREL
          1 000784       0104                            DC       s:19425,PREL
          1 000785       0329                            DC       s:19609,PREL
          1 000786       02FF                            DC       s:19578,PREL

     1212    19337        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:160  
     1213    19338    2          CASE ( %Y_ACT_GETOTPBFR# );

     1214    19339        /*
     1215    19340               GETOTPBFR - connection is up all the way. Get an output buffer
     1216    19341                           the size of a max packet and start rolling.
     1217    19342                           Give L3 a redrqs just in case it has input buffered.
     1218    19343        */
     1219    19344    2             KX$SL.RPRDAT = '1'B;

  19344   1 000787  8946 0009                            LBT,'0080'X       9,B6
  19344   1 000789       0080

     1220    19345    2             IF KX$SL.RMTNOD > 200

  19345   1 00078A  A2C6 0009                            LLH,R2   9,B6
          1 00078C  A970 00C8                            CMR,R2   200,IMO
          1 00078E  0A81 0004                            BALE     s:19348,PREL

     1221    19346    2                THEN
     1222    19347    2                   RETURN;

  19347   1 000790  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

     1223    19348    2             IF KX$SL.OTPBFR$ ~= ADDR(NIL)

  19348   1 000793  8DC6 0006                            CMN      6,B6
          1 000795  0901 0030                            BE       s:19362,PREL

     1224    19349    2                THEN
     1225    19350    3                   DO;

     1226    19351    3                      KX$SL.OTPBFRBYTSIZ = KX_BUF.SIZ ( KX$L3.CALL_OPTS.SNDPCKSIZ ) ;

  19351   1 000797  DCC7 0008                            LDB,B5   L3$,AUTO
          1 000799  B845 0015                            LDR,R3   21,B5
          1 00079B  B570 00FF                            AND,R3   255,IMO
          1 00079D  E830 0000 001E  xsym                 LDR,R6   KX_BUF+30,R3
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:161  
          1 0007A0  EF46 0022                            STR,R6   34,B6

     1227    19352    3                      KVBSIZ = KX$SL.OTPBFRBYTSIZ / 2;

  19352   1 0007A2  6041                                 SOR,R6   1
          1 0007A3  EF47 0014                            STR,R6   KVBSIZ,AUTO

     1228    19353    3                      CALL KVB$GETSYS ( KVBSIZ, Y$ ) WHENALTRETURN

  19353   1 0007A5  CBC7 0011                            LAB,B4   Y$,AUTO
          1 0007A7  CFC7 0096                            STB,B4   I+4,AUTO
          1 0007A9  BBC7 0014                            LAB,B3   KVBSIZ,AUTO
          1 0007AB  BFC7 0094                            STB,B3   I+2,AUTO
          1 0007AD  BBC7 0094                            LAB,B3   I+2,AUTO
          1 0007AF  CBF0 0200                            LAB,B4   512,IMO
          1 0007B1  E380 0000 0000  xent                 LNJ,B6   KVB$GETSYS
          1 0007B4       0003                            DC       s:19354,PREL
          1 0007B5  0F81 000A                            B        s:19360,PREL

     1229    19354    4                            DO;

     1230    19355        /*S* SCREECH_CODE: KXV-S$KX_NO_MEM#
     1231    19356             MESSAGE: The handler is out of MEMory.
     1232    19357        */
     1233    19358    4   SCR_NOMEM:                  CALL KHD$SCREECH ( Y_NO_MEM );

  19358   1 0007B7  BB80 0000 0005  02   SCR_NOMEM       LAB,B3   +5
          1 0007BA  CBF0 0100                            LAB,B4   256,IMO
          1 0007BC  E380 0000 0000  xent                 LNJ,B6   KHD$SCREECH
          1 0007BF       0001                            DC       s:19360,PREL

     1234    19359    4                            END;

     1235    19360    3                      KX$SL.OTPBFR$ = Y$;

  19360   1 0007C0  ECC7 0011                            LDB,B6   Y$,AUTO
          1 0007C2  DCC7 0006                            LDB,B5   SL$,AUTO
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:162  
          1 0007C4  EFC5 0006                            STB,B6   6,B5

     1236    19361    3                   END;

     1237    19362    2             KX$SL.OTPBFRBYTX = 0;

  19362   1 0007C6  ECC7 0006                            LDB,B6   SL$,AUTO
          1 0007C8  8746 0023                            CL       35,B6

     1238    19363    2             KX$SL.OTPBFR_STAGE = 0;

  19363   1 0007CA  87C6 0024                            CLH      36,B6

     1239    19364    2             KX$SL.CQMSG_STAGE = 0;

  19364   1 0007CC  8846 0024                            LBF,'00FF'X       36,B6
  19364   1 0007CE       00FF

     1240    19365    2             KX$SL.CQMSG_ = '0'B;

  19365   1 0007CF  5C08                                 LDV,R5   8
          1 0007D0  0021                                 ALR      ;
          1 0007D1       4178 0000                                ALPHANUM('0000'X,IMO,,1),;
          1 0007D3       4006 001E                                ALPHANUM(30,B6,,R5,FILL)

     1241    19366    2             CALL_FPT.EVN = %KX_P_EV_REDRQS#;

  19366   1 0007D5  6C15                                 LDV,R6   21
          1 0007D6  EF47 0015                            STR,R6   CALL_FPT,AUTO

     1242    19367    2             CALL_FPT.CAL$ = SL$;

  19367   1 0007D8  EFC7 0016                            STB,B6   CALL_FPT+1,AUTO

     1243    19368    2             CALL_FPT.RCV$ = KX$SL.L3$;

  19368   1 0007DA  DCC6 0004                            LDB,B5   4,B6
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:163  
          1 0007DC  DFC7 0018                            STB,B5   CALL_FPT+3,AUTO

     1244    19369    2             CALL Y$CAL_KXP;

  19369   1 0007DE  437F                                 CSYNC    s:19368+3,SPREL
          1 0007DF  E3C0 0337                            LNJ,B6   s:0,PREL
          1 0007E1       0001                            DC       s:19369+4,PREL
          1 0007E2  0F81 0310                            B        s:19640,PREL

     1245    19370        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:164  
     1246    19371        /*
     1247    19372               INIT - Start a connection with the Network layer on behalf of the VC
     1248    19373        */
     1249    19374    2          CASE ( %Y_ACT_INIT# );

     1250    19375
     1251    19376    2   SND_INIT: FPT@CONNECT = FPT_CONNECT_C;

  19376   1 0007E4  AB80 0000 0085  00   SND_INIT        LAB,B2   FPT_CONNECT_C
          1 0007E7  2C00                                 LDV,R2   0
          1 0007E8  6C5A                                 LDV,R6   90
          1 0007E9  BB87                                 LAB,B3   ,AUTO
          1 0007EA  3C6A                                 LDV,R3   106
          1 0007EB  0008                                 MMM

     1252    19377    2             FPT@CONNECT.RLCID.NODE = KX$SL.RMTNOD;

  19377   1 0007EC  ECC7 0006                            LDB,B6   SL$,AUTO
          1 0007EE  E2C6 0009                            LLH,R6   9,B6
          1 0007F0  E7C7 0042                            STH,R6   FPT@CONNECT+13,AUTO

     1253    19378    2             FPT@CONNECT.RLCID.FEP_NODE = KX$SL.LCLNOD;

  19378   1 0007F2  E846 0008                            LDR,R6   8,B6
          1 0007F4  EAC7 0042                            SRM,R6,'00FF'X    FPT@CONNECT+13,AUTO
          1 0007F6       00FF

     1254    19379    2             FPT@CONNECT.RLCID.FLAGS.VIRCIR = '1'B;

  19379   1 0007F7  8947 0043                            LBT,'4000'X       FPT@CONNECT+14,AUTO
  19379   1 0007F9       4000

     1255    19380    2             FPT@CONNECT.TERMINAL_ID = KX$SL.L3$->%L3CHN.TERMID;

  19380   1 0007FA  DCC6 0004                            LDB,B5   4,B6
          1 0007FC  CCC5 0006                            LDB,B4   6,B5
          1 0007FE  AB84                                 LAB,B2   ,B4
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:165  
          1 0007FF  2C24                                 LDV,R2   36
          1 000800  6C10                                 LDV,R6   16
          1 000801  BB87                                 LAB,B3   ,AUTO
          1 000802  3C74                                 LDV,R3   116
          1 000803  0008                                 MMM

     1256    19381    2             FPT@CONNECT.SERVICE = KX$SL.L3$->KX$L3.QOS;

  19381   1 000804  ECC7 0006                            LDB,B6   SL$,AUTO
          1 000806  DCC6 0004                            LDB,B5   4,B6
          1 000808  E845 0012                            LDR,R6   18,B5
          1 00080A  EAC7 0045                            SRM,R6,'00FF'X    FPT@CONNECT+16,AUTO
          1 00080C       00FF

     1257    19382    2             FPT@CONNECT.DSTSNPA = KX$SL.L3$->KX$L3.CALL_OPTS.RCVADR;

  19382   1 00080D  DCC6 0004                            LDB,B5   4,B6
          1 00080F  AB85                                 LAB,B2   ,B5
          1 000810  2C2E                                 LDV,R2   46
          1 000811  6C08                                 LDV,R6   8
          1 000812  BBC7 005E                            LAB,B3   FPT@CONNECT+41,AUTO
          1 000814  3C00                                 LDV,R3   0
          1 000815  0008                                 MMM

     1258    19383    2             IF KX$SL.L3$->KX$L3.LCLNSAP.NSAP.LEN > 0

  19383   1 000816  ECC7 0006                            LDB,B6   SL$,AUTO
          1 000818  BCC6 0004                            LDB,B3   4,B6
          1 00081A  E2C3 007B                            LLH,R6   123,B3
          1 00081C  6901 0026                            BEZ,R6   s:19392,PREL

     1259    19384    2                THEN
     1260    19385    3                   DO;

     1261    19386    3                      FPT@CONNECT.TYPE = %KN_CON_TYP_CIRCUIT;

  19386   1 00081E  5C06                                 LDV,R5   6
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:166  
          1 00081F  DF47 0035                            STR,R5   FPT@CONNECT,AUTO

     1262    19387    3                      FPT@CONNECT.DEST = KX$SL.L3$->KX$L3.LCLNSAP;

  19387   1 000821  BCC6 0004                            LDB,B3   4,B6
          1 000823  ABC3 007B                            LAB,B2   123,B3
          1 000825  2C00                                 LDV,R2   0
          1 000826  6C16                                 LDV,R6   22
          1 000827  BBC7 0048                            LAB,B3   FPT@CONNECT+19,AUTO
          1 000829  3C00                                 LDV,R3   0
          1 00082A  0008                                 MMM

     1263    19388    3                      FPT@CONNECT.LADR = KX$SL.L3$->KX$L3.RMTNSAP;

  19388   1 00082B  ECC7 0006                            LDB,B6   SL$,AUTO
          1 00082D  BCC6 0004                            LDB,B3   4,B6
          1 00082F  ABC3 0086                            LAB,B2   134,B3
          1 000831  2C00                                 LDV,R2   0
          1 000832  6C16                                 LDV,R6   22
          1 000833  BBC7 0053                            LAB,B3   FPT@CONNECT+30,AUTO
          1 000835  3C00                                 LDV,R3   0
          1 000836  0008                                 MMM

     1264    19389    3                      FPT@CONNECT.DEST.LEN = (FPT@CONNECT.DEST.LEN+1)/2;

  19389   1 000837  E2C7 0048                            LLH,R6   FPT@CONNECT+19,AUTO
          1 000839  6E01                                 ADV,R6   1
          1 00083A  6041                                 SOR,R6   1
          1 00083B  E7C7 0048                            STH,R6   FPT@CONNECT+19,AUTO

     1265    19390    3                      FPT@CONNECT.LADR.LEN = (FPT@CONNECT.LADR.LEN+1)/2;

  19390   1 00083D  E2C7 0053                            LLH,R6   FPT@CONNECT+30,AUTO
          1 00083F  6E01                                 ADV,R6   1
          1 000840  6041                                 SOR,R6   1
          1 000841  E7C7 0053                            STH,R6   FPT@CONNECT+30,AUTO

PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:167  
     1266    19391    3                   END;

     1267    19392    2             KNH_MESS.FUNCTION = %KN_FCN_INIT;

  19392   1 000843  6C01                                 LDV,R6   1
          1 000844  EF47 0025                            STR,R6   KNH_MESS,AUTO

     1268    19393    2             KNH_MESS.FPTSZ = 2 * SIZEW ( FPT@CONNECT );

  19393   1 000846  5C5A                                 LDV,R5   90
          1 000847  DF47 002B                            STR,R5   KNH_MESS+6,AUTO

     1269    19394    2             KNH_MESS.MSGSZ = KX$SL.CALUSRDATBYTSIZ;

  19394   1 000849  ECC7 0006                            LDB,B6   SL$,AUTO
          1 00084B  C846 002A                            LDR,R4   42,B6
          1 00084D  CF47 002C                            STR,R4   KNH_MESS+7,AUTO

     1270    19395    2             KNH_MESS.LDCTX = 0;

  19395   1 00084F  8747 0026                            CL       KNH_MESS+1,AUTO

     1271    19396    2             KX$SL.LDCTX = 0;

  19396   1 000851  8746 000B                            CL       11,B6

     1272    19397    2             KV@SNDCQ.MSG_.ADR$ (1) = ADDR ( FPT@CONNECT );

  19397   1 000853  BBC7 0035                            LAB,B3   FPT@CONNECT,AUTO
          1 000855  BFC7 0072                            STB,B3   KV@SNDCQ+4,AUTO

     1273    19398    2             KV@SNDCQ.MSG_.BYTSIZ (1) = (LENGTHC(FPT@CONNECT) + 3)/4*4;

  19398   1 000857  4C5C                                 LDV,R4   92
          1 000858  CF47 0075                            STR,R4   KV@SNDCQ+7,AUTO

     1274    19399    2             KV@SNDCQ.MSG_.ADR$ (2) = KX$SL.CALUSRDAT$;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:168  

  19399   1 00085A  ACC6 0028                            LDB,B2   40,B6
          1 00085C  AFC7 0076                            STB,B2   KV@SNDCQ+8,AUTO

     1275    19400    2             KV@SNDCQ.MSG_.BYTSIZ (2) = KX$SL.CALUSRDATBYTSIZ;

  19400   1 00085E  B846 002A                            LDR,R3   42,B6
          1 000860  BF47 0079                            STR,R3   KV@SNDCQ+11,AUTO

     1276    19401    2             CALL KVM$SNDCQ ( KV@SNDCQ )

  19401   1 000862  9BC7 006E                            LAB,B1   KV@SNDCQ,AUTO
          1 000864  9FC7 0094                            STB,B1   I+2,AUTO
          1 000866  BBC7 0094                            LAB,B3   I+2,AUTO
          1 000868  CBF0 0100                            LAB,B4   256,IMO
          1 00086A  E380 0000 0000  xent                 LNJ,B6   KVM$SNDCQ
          1 00086D       0008                            DC       s:19408,PREL

     1277    19402    2                WHENRETURN
     1278    19403    3                   DO;

     1279    19404    3                      KX$SL.SNDINT_ALTRET = '0'B;

  19404   1 00086E  ECC7 0006                            LDB,B6   SL$,AUTO
          1 000870  8846 0009                            LBF,'0010'X       9,B6
          1 000872       0010

     1280    19405    3                   END;

  19405   1 000873  0F81 0006                            B        s:19409,PREL

     1281    19406    2                WHENALTRETURN
     1282    19407    3                   DO;

     1283    19408    3                      KX$SL.SNDINT_ALTRET = '1'B;

  19408   1 000875  ECC7 0006                            LDB,B6   SL$,AUTO
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:169  
          1 000877  8946 0009                            LBT,'0010'X       9,B6
          1 000879       0010

     1284    19409    3                   END;

  19409   1 00087A  0F81 0278                            B        s:19640,PREL

     1285    19410
     1286    19411        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:170  
     1287    19412        /*
     1288    19413               INITACK, INITNAK - Got a response from a circuits. Tell Network about
     1289    19414                                  the good (ack) or bad (nak) news.
     1290    19415        */
     1291    19416    2          CASE ( %Y_ACT_INITACK# );

     1292    19417
     1293    19418    2   SND_INITACK:
     1294    19419    2             FPT@CONNECT_ACK.REASON = %K_REASON_NORMAL;

  19419   1 00087C  8747 0062            SND_INITACK     CL       FPT@CONNECT_ACK,AUTO

     1295    19420    2             KNH_MESS.MSGSZ = KX$SL.CALRSPDATBYTSIZ;

  19420   1 00087E  E846 002D                            LDR,R6   45,B6
          1 000880  EF47 002C                            STR,R6   KNH_MESS+7,AUTO

     1296    19421    2             KV@SNDCQ.MSG_.ADR$ (2) = KX$SL.CALRSPDAT$;

  19421   1 000882  DCC6 002B                            LDB,B5   43,B6
          1 000884  DFC7 0076                            STB,B5   KV@SNDCQ+8,AUTO

     1297    19422    2             KX$SL.RPRDAT = '1'B;

  19422   1 000886  8946 0009                            LBT,'0080'X       9,B6
  19422   1 000888       0080

     1298    19423    2             GOTO SND_INITRSP;

  19423   1 000889  0F81 000C                            B        s:19432,PREL

     1299    19424
     1300    19425    2          CASE ( %Y_ACT_INITNAK# );

     1301    19426
     1302    19427    2   SND_INITNAK:
     1303    19428    2             FPT@CONNECT_ACK.REASON = %K_REASON_NORTE;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:171  

  19428   1 00088B  6C02                 SND_INITNAK     LDV,R6   2
          1 00088C  EF47 0062                            STR,R6   FPT@CONNECT_ACK,AUTO

     1304    19429    2             KNH_MESS.MSGSZ = KX$SL.CLRDATBYTSIZ;

  19429   1 00088E  D846 0030                            LDR,R5   48,B6
          1 000890  DF47 002C                            STR,R5   KNH_MESS+7,AUTO

     1305    19430    2             KV@SNDCQ.MSG_.ADR$ (2) = KX$SL.CLRDAT$;

  19430   1 000892  DCC6 002E                            LDB,B5   46,B6
          1 000894  DFC7 0076                            STB,B5   KV@SNDCQ+8,AUTO

     1306    19431    2   SND_INITRSP:
     1307    19432    2             KNH_MESS.FUNCTION = %KN_FCN_INIT_ACK;

  19432   1 000896  6C02                 SND_INITRSP     LDV,R6   2
          1 000897  EF47 0025                            STR,R6   KNH_MESS,AUTO

     1308    19433    2             KNH_MESS.FPTSZ = 2 * SIZEW ( FPT@CONNECT_ACK );

  19433   1 000899  5C0C                                 LDV,R5   12
          1 00089A  DF47 002B                            STR,R5   KNH_MESS+6,AUTO

     1309    19434    2             KV@SNDCQ.MSG_.ADR$ (1) = ADDR ( FPT@CONNECT_ACK );

  19434   1 00089C  EBC7 0062                            LAB,B6   FPT@CONNECT_ACK,AUTO
          1 00089E  EFC7 0072                            STB,B6   KV@SNDCQ+4,AUTO

     1310    19435    2             KV@SNDCQ.MSG_.BYTSIZ (1) = (LENGTHC(FPT@CONNECT_ACK) + 3)/4*4;

  19435   1 0008A0  DF47 0075                            STR,R5   KV@SNDCQ+7,AUTO

     1311    19436    2             KV@SNDCQ.MSG_.BYTSIZ (2) = ( KNH_MESS.MSGSZ + 3 ) / 4 * 4;

  19436   1 0008A2  C847 002C                            LDR,R4   KNH_MESS+7,AUTO
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:172  
          1 0008A4  4E03                                 ADV,R4   3
          1 0008A5  4042                                 SOR,R4   2
          1 0008A6  4002                                 SOL,R4   2
          1 0008A7  CF47 0079                            STR,R4   KV@SNDCQ+11,AUTO

     1312    19437    2             CALL KVM$SNDCQ ( KV@SNDCQ )

  19437   1 0008A9  DBC7 006E                            LAB,B5   KV@SNDCQ,AUTO
          1 0008AB  DFC7 0094                            STB,B5   I+2,AUTO
          1 0008AD  BBC7 0094                            LAB,B3   I+2,AUTO
          1 0008AF  CBF0 0100                            LAB,B4   256,IMO
          1 0008B1  E380 0000 0000  xent                 LNJ,B6   KVM$SNDCQ
          1 0008B4       000F                            DC       s:19448,PREL

     1313    19438    2                WHENRETURN
     1314    19439    3                   DO;

     1315    19440    3                      IF ACTION = %Y_ACT_INITACK#

  19440   1 0008B5  E847 000F                            LDR,R6   ACTION,AUTO
          1 0008B7  6D07                                 CMV,R6   7
          1 0008B8  0981 00EC                            BNE      s:19525,PREL

     1316    19441    3                         THEN
     1317    19442    3                            KX$SL.SNDINTACK_ALTRET = '0'B;

  19442   1 0008BA  ECC7 0006                            LDB,B6   SL$,AUTO
          1 0008BC  8846 0009                            LBF,'0004'X       9,B6
          1 0008BE       0004
          1 0008BF  0F81 0001                            B        s:19442+7,PREL
          1 0008C1  0F81 0012                            B        s:19457,PREL

     1318    19443    3                         ELSE
     1319    19444    3                            GOTO RLS_SL;
     1320    19445    3                   END;
     1321    19446    2                WHENALTRETURN
     1322    19447    3                   DO;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:173  

     1323    19448    3                      IF ACTION = %Y_ACT_INITACK#

  19448   1 0008C3  E847 000F                            LDR,R6   ACTION,AUTO
          1 0008C5  6D07                                 CMV,R6   7
          1 0008C6  0981 0008                            BNE      s:19452,PREL

     1324    19449    3                         THEN
     1325    19450    3                            KX$SL.SNDINTACK_ALTRET = '1'B;

  19450   1 0008C8  ECC7 0006                            LDB,B6   SL$,AUTO
          1 0008CA  8946 0009                            LBT,'0004'X       9,B6
          1 0008CC       0004
          1 0008CD  0F81 0006                            B        s:19457,PREL

     1326    19451    3                         ELSE
     1327    19452    3                            KX$SL.SNDINTNAK_ALTRET = '1'B;

  19452   1 0008CF  ECC7 0006                            LDB,B6   SL$,AUTO
          1 0008D1  8946 0009                            LBT,'0002'X       9,B6
          1 0008D3       0002

     1328    19453    3                   END;

     1329    19454        /*
     1330    19455           Clear the context.
     1331    19456        */
     1332    19457    2             KX$SL.OTPBFRBYTX = 0;

  19457   1 0008D4  8746 0023                            CL       35,B6

     1333    19458    2             KX$SL.OTPBFR_STAGE = 0;

  19458   1 0008D6  87C6 0024                            CLH      36,B6

     1334    19459    2             KX$SL.CQMSG_STAGE = 0;

PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:174  
  19459   1 0008D8  8846 0024                            LBF,'00FF'X       36,B6
  19459   1 0008DA       00FF

     1335    19460    2             KX$SL.CQMSG_ = '0'B;

  19460   1 0008DB  5C08                                 LDV,R5   8
          1 0008DC  0021                                 ALR      ;
          1 0008DD       4178 0000                                ALPHANUM('0000'X,IMO,,1),;
          1 0008DF       4006 001E                                ALPHANUM(30,B6,,R5,FILL)
          1 0008E1  437F                                 CSYNC    s:19460+5,SPREL
          1 0008E2  0F81 0210                            B        s:19640,PREL

     1336    19461
     1337    19462        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:175  
     1338    19463        /*
     1339    19464               NULL - do nothing
     1340    19465        */
     1341    19466    2          CASE ( %Y_ACT_NULL# );

     1342    19467
     1343    19468        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:176  
     1344    19469        /*S* SCREECH_CODE: KXV-S$KX_SL_ACTSCR#
     1345    19470             MESSAGE: KXV received an illegal event in current state.
     1346    19471        */
     1347    19472    2          CASE ( %Y_ACT_SCREECH# );

     1348    19473
     1349    19474    2   L_SCR:    CALL KHD$SCREECH ( Y_ACTSCR );

  19474   1 0008E4  BB80 0000 0007  02   L_SCR           LAB,B3   +7
          1 0008E7  CBF0 0100                            LAB,B4   256,IMO
          1 0008E9  E380 0000 0000  xent                 LNJ,B6   KHD$SCREECH
          1 0008EC       0001                            DC       s:19472+9,PREL
          1 0008ED  0F81 0205                            B        s:19640,PREL

     1350    19475        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:177  
     1351    19476        /*
     1352    19477               TERM - Send a termination request to the Network layer
     1353    19478        */
     1354    19479    2          CASE ( %Y_ACT_TERM# );

     1355    19480        /*
     1356    19481           Clear the context.
     1357    19482        */
     1358    19483    2             KX$SL.OTPBFRBYTX = 0;

  19483   1 0008EF  8746 0023                            CL       35,B6

     1359    19484    2             KX$SL.OTPBFR_STAGE = 0;

  19484   1 0008F1  87C6 0024                            CLH      36,B6

     1360    19485    2             KX$SL.CQMSG_STAGE = 0;

  19485   1 0008F3  8846 0024                            LBF,'00FF'X       36,B6
  19485   1 0008F5       00FF

     1361    19486    2             KX$SL.CQMSG_ = '0'B;

  19486   1 0008F6  5C08                                 LDV,R5   8
          1 0008F7  0021                                 ALR      ;
          1 0008F8       4178 0000                                ALPHANUM('0000'X,IMO,,1),;
          1 0008FA       4006 001E                                ALPHANUM(30,B6,,R5,FILL)

     1362    19487    2             IF KX$SL.CALUSRDAT$ ~= ADDR(NIL)

  19487   1 0008FC  437F                                 CSYNC    s:19486+5,SPREL
          1 0008FD  8DC6 0028                            CMN      40,B6
          1 0008FF  0901 0017                            BE       s:19490,PREL

     1363    19488    2                THEN
     1364    19489    2                   CALL KVB$RLSSYS ( (KX$SL.CALUSRDATBYTSIZ+1)/2, KX$SL.CALUSRDAT$ );

PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:178  
  19489   1 000901  A846 002A                            LDR,R2   42,B6
          1 000903  2E01                                 ADV,R2   1
          1 000904  2041                                 SOR,R2   1
          1 000905  AF47 0094                            STR,R2   I+2,AUTO
          1 000907  DBC6 0028                            LAB,B5   40,B6
          1 000909  DFC7 0097                            STB,B5   I+5,AUTO
          1 00090B  CBC7 0094                            LAB,B4   I+2,AUTO
          1 00090D  CFC7 0095                            STB,B4   I+3,AUTO
          1 00090F  BBC7 0095                            LAB,B3   I+3,AUTO
          1 000911  CBF0 0200                            LAB,B4   512,IMO
          1 000913  E380 0000 0000  xent                 LNJ,B6   KVB$RLSSYS
          1 000916       0001                            DC       s:19490,PREL

     1365    19490    2             IF KX$SL.CALRSPDAT$ ~= ADDR(NIL)

  19490   1 000917  ECC7 0006                            LDB,B6   SL$,AUTO
          1 000919  8DC6 002B                            CMN      43,B6
          1 00091B  0901 0017                            BE       s:19493,PREL

     1366    19491    2                THEN
     1367    19492    2                   CALL KVB$RLSSYS ( (KX$SL.CALRSPDATBYTSIZ+1)/2, KX$SL.CALRSPDAT$ );

  19492   1 00091D  E846 002D                            LDR,R6   45,B6
          1 00091F  6E01                                 ADV,R6   1
          1 000920  6041                                 SOR,R6   1
          1 000921  EF47 0094                            STR,R6   I+2,AUTO
          1 000923  DBC6 002B                            LAB,B5   43,B6
          1 000925  DFC7 0097                            STB,B5   I+5,AUTO
          1 000927  CBC7 0094                            LAB,B4   I+2,AUTO
          1 000929  CFC7 0095                            STB,B4   I+3,AUTO
          1 00092B  BBC7 0095                            LAB,B3   I+3,AUTO
          1 00092D  CBF0 0200                            LAB,B4   512,IMO
          1 00092F  E380 0000 0000  xent                 LNJ,B6   KVB$RLSSYS
          1 000932       0001                            DC       s:19493,PREL

     1368    19493    2             IF KX$SL.CLRDAT$ ~= ADDR(NIL)

PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:179  
  19493   1 000933  ECC7 0006                            LDB,B6   SL$,AUTO
          1 000935  8DC6 002E                            CMN      46,B6
          1 000937  0901 0017                            BE       s:19496,PREL

     1369    19494    2                THEN
     1370    19495    2                   CALL KVB$RLSSYS ( (KX$SL.CLRDATBYTSIZ+1)/2, KX$SL.CLRDAT$ );

  19495   1 000939  E846 0030                            LDR,R6   48,B6
          1 00093B  6E01                                 ADV,R6   1
          1 00093C  6041                                 SOR,R6   1
          1 00093D  EF47 0094                            STR,R6   I+2,AUTO
          1 00093F  DBC6 002E                            LAB,B5   46,B6
          1 000941  DFC7 0097                            STB,B5   I+5,AUTO
          1 000943  CBC7 0094                            LAB,B4   I+2,AUTO
          1 000945  CFC7 0095                            STB,B4   I+3,AUTO
          1 000947  BBC7 0095                            LAB,B3   I+3,AUTO
          1 000949  CBF0 0200                            LAB,B4   512,IMO
          1 00094B  E380 0000 0000  xent                 LNJ,B6   KVB$RLSSYS
          1 00094E       0001                            DC       s:19496,PREL

     1371    19496    2             KX$SL.CALUSRDAT$ = ADDR(NIL);

  19496   1 00094F  EB80 0000 0000                       LAB,B6   0
          1 000952  DCC7 0006                            LDB,B5   SL$,AUTO
          1 000954  EFC5 0028                            STB,B6   40,B5

     1372    19497    2             KX$SL.CALRSPDAT$ = ADDR(NIL);

  19497   1 000956  CB80 0000 0000                       LAB,B4   0
          1 000959  CFC5 002B                            STB,B4   43,B5

     1373    19498    2             KX$SL.CLRDAT$ = ADDR(NIL);

  19498   1 00095B  BB80 0000 0000                       LAB,B3   0
          1 00095E  BFC5 002E                            STB,B3   46,B5

     1374    19499        /*
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:180  
     1375    19500                                             Report the termination.
     1376    19501        */
     1377    19502    2   SND_TERM: FPT@TERM = FPT_TERM_C;

  19502   1 000960  AB80 0000 0081  00   SND_TERM        LAB,B2   FPT_TERM_C
          1 000963  2C00                                 LDV,R2   0
          1 000964  6C08                                 LDV,R6   8
          1 000965  BB87                                 LAB,B3   ,AUTO
          1 000966  3C5E                                 LDV,R3   94
          1 000967  0008                                 MMM

     1378    19503    2             FPT@TERM.RLCID.NODE = KX$SL.RMTNOD;

  19503   1 000968  ECC7 0006                            LDB,B6   SL$,AUTO
          1 00096A  E2C6 0009                            LLH,R6   9,B6
          1 00096C  E7C7 002F                            STH,R6   FPT@TERM,AUTO

     1379    19504    2             FPT@TERM.RLCID.LDCTX = KX$SL.LDCTX;

  19504   1 00096E  E846 000B                            LDR,R6   11,B6
          1 000970  EF47 0030                            STR,R6   FPT@TERM+1,AUTO

     1380    19505    2             KNH_MESS.FUNCTION = %KN_FCN_TERM;

  19505   1 000972  5C03                                 LDV,R5   3
          1 000973  DF47 0025                            STR,R5   KNH_MESS,AUTO

     1381    19506    2             KNH_MESS.FPTSZ = 2 * SIZEW ( FPT@TERM );

  19506   1 000975  4C08                                 LDV,R4   8
          1 000976  CF47 002B                            STR,R4   KNH_MESS+6,AUTO

     1382    19507    2             KNH_MESS.MSGSZ = KX$SL.CLRDATBYTSIZ;

  19507   1 000978  B846 0030                            LDR,R3   48,B6
          1 00097A  BF47 002C                            STR,R3   KNH_MESS+7,AUTO

PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:181  
     1383    19508    2             KV@SNDCQ.MSG_.ADR$ (1) = ADDR ( FPT@TERM );

  19508   1 00097C  DBC7 002F                            LAB,B5   FPT@TERM,AUTO
          1 00097E  DFC7 0072                            STB,B5   KV@SNDCQ+4,AUTO

     1384    19509    2             KV@SNDCQ.MSG_.BYTSIZ (1) = (LENGTHC( FPT@TERM ) + 3)/4*4;

  19509   1 000980  CF47 0075                            STR,R4   KV@SNDCQ+7,AUTO

     1385    19510    2             KV@SNDCQ.MSG_.ADR$ (2) = KX$SL.CLRDAT$;

  19510   1 000982  CCC6 002E                            LDB,B4   46,B6
          1 000984  CFC7 0076                            STB,B4   KV@SNDCQ+8,AUTO

     1386    19511    2             KV@SNDCQ.MSG_.BYTSIZ (2) = ( KNH_MESS.MSGSZ + 3 ) / 4 * 4;

  19511   1 000986  3E03                                 ADV,R3   3
          1 000987  3042                                 SOR,R3   2
          1 000988  3002                                 SOL,R3   2
          1 000989  BF47 0079                            STR,R3   KV@SNDCQ+11,AUTO

     1387    19512    2             CALL KVM$SNDCQ ( KV@SNDCQ )

  19512   1 00098B  ABC7 006E                            LAB,B2   KV@SNDCQ,AUTO
          1 00098D  AFC7 0094                            STB,B2   I+2,AUTO
          1 00098F  BBC7 0094                            LAB,B3   I+2,AUTO
          1 000991  CBF0 0100                            LAB,B4   256,IMO
          1 000993  E380 0000 0000  xent                 LNJ,B6   KVM$SNDCQ
          1 000996       0008                            DC       s:19519,PREL

     1388    19513    2                WHENRETURN
     1389    19514    3                   DO;

     1390    19515    3                      KX$SL.SNDTRM_ALTRET = '0'B;

  19515   1 000997  ECC7 0006                            LDB,B6   SL$,AUTO
          1 000999  8846 0009                            LBF,'0008'X       9,B6
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:182  
          1 00099B       0008

     1391    19516    3                   END;

  19516   1 00099C  0F81 0006                            B        s:19520,PREL

     1392    19517    2                WHENALTRETURN
     1393    19518    3                   DO;

     1394    19519    3                      KX$SL.SNDTRM_ALTRET = '1'B;

  19519   1 00099E  ECC7 0006                            LDB,B6   SL$,AUTO
          1 0009A0  8946 0009                            LBT,'0008'X       9,B6
          1 0009A2       0008

     1395    19520    3                   END;

  19520   1 0009A3  0F81 014F                            B        s:19640,PREL

     1396    19521        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:183  
     1397    19522        /*
     1398    19523           RLS - The TRMACK has arrived.
     1399    19524        */
     1400    19525    2          CASE ( %Y_ACT_RLS# );

     1401    19526    2   RLS_SL:   CTX$ = KX_SLLIST.HD$;

  19526   1 0009A5  EC80 0000 0000  xsym RLS_SL          LDB,B6   KX_SLLIST
          1 0009A8  EFC7 006A                            STB,B6   CTX$,AUTO

     1402    19527    2             IF SL$ = CTX$

  19527   1 0009AA  DCC7 0006                            LDB,B5   SL$,AUTO
          1 0009AC  DDC7 006A                            CMB,B5   CTX$,AUTO
          1 0009AE  0981 0012                            BNE      s:19537,PREL

     1403    19528    2                THEN
     1404    19529    3                   DO;

     1405    19530    3                      KX_SLLIST.HD$ = KX$SL.LNK$;

  19530   1 0009B0  CCC5 0002                            LDB,B4   2,B5
          1 0009B2  CF80 0000 0000  xsym                 STB,B4   KX_SLLIST

     1406    19531    3                      IF KX$SL.LNK$ = ADDR(NIL)

  19531   1 0009B5  8DC5 0002                            CMN      2,B5
          1 0009B7  0981 0040                            BNE      s:19556,PREL

     1407    19532    3                         THEN
     1408    19533    3                            KX_SLLIST.TL$ = ADDR(NIL);

  19533   1 0009B9  BB80 0000 0000                       LAB,B3   0
          1 0009BC  BF80 0000 0002  xsym                 STB,B3   KX_SLLIST+2

     1409    19534    3                   END;

PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:184  
  19534   1 0009BF  0F81 0038                            B        s:19556,PREL

     1410    19535    2                ELSE
     1411    19536    3                   DO;

     1412    19537    3                      PRVCTX$ = CTX$;

  19537   1 0009C1  EFC7 006C                            STB,B6   PRVCTX$,AUTO

     1413    19538    3                      CTX$ = CTX$->KX$SL.LNK$;

  19538   1 0009C3  CCC6 0002                            LDB,B4   2,B6
          1 0009C5  CFC7 006A                            STB,B4   CTX$,AUTO

     1414    19539    4                      DO WHILE (( CTX$ ~= ADDR(NIL)) AND ( CTX$ ~= SL$ ));

  19539   1 0009C7  0F81 0009                            B        s:19542,PREL

     1415    19540    4                         PRVCTX$ = CTX$;

  19540   1 0009C9  ECC7 006A                            LDB,B6   CTX$,AUTO
          1 0009CB  EFC7 006C                            STB,B6   PRVCTX$,AUTO

     1416    19541    4                         CTX$ = CTX$->KX$SL.LNK$;

  19541   1 0009CD  DCC6 0002                            LDB,B5   2,B6
          1 0009CF  DFC7 006A                            STB,B5   CTX$,AUTO

     1417    19542    4                      END;

  19542   1 0009D1  8DC7 006A                            CMN      CTX$,AUTO
          1 0009D3  0901 0006                            BE       s:19543,PREL
          1 0009D5  DCC7 006A                            LDB,B5   CTX$,AUTO
          1 0009D7  DDC7 0006                            CMB,B5   SL$,AUTO
          1 0009D9  09F0                                 BNE      s:19540,SPREL

     1418    19543    3                      IF CTX$ = ADDR(NIL)
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:185  

  19543   1 0009DA  8DC7 006A                            CMN      CTX$,AUTO
          1 0009DC  0981 000A                            BNE      s:19551,PREL

     1419    19544    3                         THEN
     1420    19545    4                            DO;

     1421    19546        /*S* SCREECH_CODE: KXV-S$KX_BADSLLIST#
     1422    19547             MESSAGE: The chain of SL contexts is corrupted.
     1423    19548        */
     1424    19549    4                               CALL KHD$SCREECH ( Y_BADSLLIST );

  19549   1 0009DE  BB80 0000 0009  02                   LAB,B3   +9
          1 0009E1  CBF0 0100                            LAB,B4   256,IMO
          1 0009E3  E380 0000 0000  xent                 LNJ,B6   KHD$SCREECH
          1 0009E6       0001                            DC       s:19551,PREL

     1425    19550    4                            END;

     1426    19551    3                      PRVCTX$ -> KX$SL.LNK$ = KX$SL.LNK$;

  19551   1 0009E7  ECC7 0006                            LDB,B6   SL$,AUTO
          1 0009E9  DCC6 0002                            LDB,B5   2,B6
          1 0009EB  CCC7 006C                            LDB,B4   PRVCTX$,AUTO
          1 0009ED  DFC4 0002                            STB,B5   2,B4

     1427    19552    3                      IF KX$SL.LNK$ = ADDR(NIL)

  19552   1 0009EF  ECC7 0006                            LDB,B6   SL$,AUTO
          1 0009F1  8DC6 0002                            CMN      2,B6
          1 0009F3  0981 0004                            BNE      s:19556,PREL

     1428    19553    3                         THEN
     1429    19554    3                            KX_SLLIST.TL$ = PRVCTX$;

  19554   1 0009F5  CF80 0000 0002  xsym                 STB,B4   KX_SLLIST+2

PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:186  
     1430    19555    3                   END;

     1431    19556    2             IF KX$SL.OTPBFR$ ~= ADDR(NIL)

  19556   1 0009F8  ECC7 0006                            LDB,B6   SL$,AUTO
          1 0009FA  8DC6 0006                            CMN      6,B6
          1 0009FC  0901 0016                            BE       s:19559,PREL

     1432    19557    2                THEN
     1433    19558    2                   CALL KVB$RLSSYS ( KX$SL.OTPBFRBYTSIZ/2, KX$SL.OTPBFR$ );

  19558   1 0009FE  E846 0022                            LDR,R6   34,B6
          1 000A00  6041                                 SOR,R6   1
          1 000A01  EF47 0094                            STR,R6   I+2,AUTO
          1 000A03  DBC6 0006                            LAB,B5   6,B6
          1 000A05  DFC7 0097                            STB,B5   I+5,AUTO
          1 000A07  CBC7 0094                            LAB,B4   I+2,AUTO
          1 000A09  CFC7 0095                            STB,B4   I+3,AUTO
          1 000A0B  BBC7 0095                            LAB,B3   I+3,AUTO
          1 000A0D  CBF0 0200                            LAB,B4   512,IMO
          1 000A0F  E380 0000 0000  xent                 LNJ,B6   KVB$RLSSYS
          1 000A12       0001                            DC       s:19559,PREL

     1434    19559    2             IF KX$SL.CALUSRDAT$ ~= ADDR(NIL)

  19559   1 000A13  ECC7 0006                            LDB,B6   SL$,AUTO
          1 000A15  8DC6 0028                            CMN      40,B6
          1 000A17  0901 0017                            BE       s:19562,PREL

     1435    19560    2                THEN
     1436    19561    2                   CALL KVB$RLSSYS ( (KX$SL.CALUSRDATBYTSIZ+1)/2, KX$SL.CALUSRDAT$ );

  19561   1 000A19  E846 002A                            LDR,R6   42,B6
          1 000A1B  6E01                                 ADV,R6   1
          1 000A1C  6041                                 SOR,R6   1
          1 000A1D  EF47 0094                            STR,R6   I+2,AUTO
          1 000A1F  DBC6 0028                            LAB,B5   40,B6
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:187  
          1 000A21  DFC7 0097                            STB,B5   I+5,AUTO
          1 000A23  CBC7 0094                            LAB,B4   I+2,AUTO
          1 000A25  CFC7 0095                            STB,B4   I+3,AUTO
          1 000A27  BBC7 0095                            LAB,B3   I+3,AUTO
          1 000A29  CBF0 0200                            LAB,B4   512,IMO
          1 000A2B  E380 0000 0000  xent                 LNJ,B6   KVB$RLSSYS
          1 000A2E       0001                            DC       s:19562,PREL

     1437    19562    2             IF KX$SL.CALRSPDAT$ ~= ADDR(NIL)

  19562   1 000A2F  ECC7 0006                            LDB,B6   SL$,AUTO
          1 000A31  8DC6 002B                            CMN      43,B6
          1 000A33  0901 0017                            BE       s:19565,PREL

     1438    19563    2                THEN
     1439    19564    2                   CALL KVB$RLSSYS ( (KX$SL.CALRSPDATBYTSIZ+1)/2, KX$SL.CALRSPDAT$ );

  19564   1 000A35  E846 002D                            LDR,R6   45,B6
          1 000A37  6E01                                 ADV,R6   1
          1 000A38  6041                                 SOR,R6   1
          1 000A39  EF47 0094                            STR,R6   I+2,AUTO
          1 000A3B  DBC6 002B                            LAB,B5   43,B6
          1 000A3D  DFC7 0097                            STB,B5   I+5,AUTO
          1 000A3F  CBC7 0094                            LAB,B4   I+2,AUTO
          1 000A41  CFC7 0095                            STB,B4   I+3,AUTO
          1 000A43  BBC7 0095                            LAB,B3   I+3,AUTO
          1 000A45  CBF0 0200                            LAB,B4   512,IMO
          1 000A47  E380 0000 0000  xent                 LNJ,B6   KVB$RLSSYS
          1 000A4A       0001                            DC       s:19565,PREL

     1440    19565    2             IF KX$SL.CLRDAT$ ~= ADDR(NIL)

  19565   1 000A4B  ECC7 0006                            LDB,B6   SL$,AUTO
          1 000A4D  8DC6 002E                            CMN      46,B6
          1 000A4F  0901 0017                            BE       s:19568,PREL

     1441    19566    2                THEN
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:188  
     1442    19567    2                   CALL KVB$RLSSYS ( (KX$SL.CLRDATBYTSIZ+1)/2, KX$SL.CLRDAT$ );

  19567   1 000A51  E846 0030                            LDR,R6   48,B6
          1 000A53  6E01                                 ADV,R6   1
          1 000A54  6041                                 SOR,R6   1
          1 000A55  EF47 0094                            STR,R6   I+2,AUTO
          1 000A57  DBC6 002E                            LAB,B5   46,B6
          1 000A59  DFC7 0097                            STB,B5   I+5,AUTO
          1 000A5B  CBC7 0094                            LAB,B4   I+2,AUTO
          1 000A5D  CFC7 0095                            STB,B4   I+3,AUTO
          1 000A5F  BBC7 0095                            LAB,B3   I+3,AUTO
          1 000A61  CBF0 0200                            LAB,B4   512,IMO
          1 000A63  E380 0000 0000  xent                 LNJ,B6   KVB$RLSSYS
          1 000A66       0001                            DC       s:19568,PREL

     1443    19568    2             IF KX$SL.L3$ ~= ADDR(NIL)

  19568   1 000A67  ECC7 0006                            LDB,B6   SL$,AUTO
          1 000A69  8DC6 0004                            CMN      4,B6
          1 000A6B  0901 0008                            BE       s:19571,PREL

     1444    19569    2                THEN
     1445    19570    2                   KX$SL.L3$->KX$L3.CM$ = ADDR(NIL);

  19570   1 000A6D  DCC6 0004                            LDB,B5   4,B6
          1 000A6F  CB80 0000 0000                       LAB,B4   0
          1 000A72  CFC5 0004                            STB,B4   4,B5

     1446    19571    2             CALL KVB$RLSSYS ( SIZEW(KX$SL), SL$ );

  19571   1 000A74  EBF0 0031                            LAB,B6   49,IMO
          1 000A76  DBC7 0006                            LAB,B5   SL$,AUTO
          1 000A78  DFC7 0096                            STB,B5   I+4,AUTO
          1 000A7A  EFC7 0094                            STB,B6   I+2,AUTO
          1 000A7C  BBC7 0094                            LAB,B3   I+2,AUTO
          1 000A7E  CBF0 0200                            LAB,B4   512,IMO
          1 000A80  E380 0000 0000  xent                 LNJ,B6   KVB$RLSSYS
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:189  
          1 000A83       0001                            DC       s:19571+16,PREL
          1 000A84  0F81 006E                            B        s:19640,PREL

     1447    19572        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:190  
     1448    19573    2          CASE ( %Y_ACT_RLSMAYBE# );

     1449    19574        /*
     1450    19575          RLSMAYBE - If we haven't yet sent out the INIT (SNDINT_ALRET
     1451    19576                     on), then forget it and release the SL.
     1452    19577        */
     1453    19578    2             IF KX$SL.SNDINT_ALTRET

  19578   1 000A86  82C6 0009                            LB,'0010'X        9,B6
  19578   1 000A88       0010
          1 000A89  0501 FF1B                            BBT      s:19525,PREL
          1 000A8B  0F81 0067                            B        s:19640,PREL

     1454    19579    2                THEN
     1455    19580    2                   GOTO RLS_SL;  /* in case RLS */
     1456    19581        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:191  
     1457    19582
     1458    19583    2          CASE ( %Y_ACT_VCUP# );

     1459    19584        /*
     1460    19585           VCUP - Got an INIT_ACK from network. Start the VC.
     1461    19586        */
     1462    19587    2             CALL_FPT.EVN = %KX_P_EV_VCUP#;

  19587   1 000A8D  6C04                                 LDV,R6   4
          1 000A8E  EF47 0015                            STR,R6   CALL_FPT,AUTO

     1463    19588    2             IF KX$SL.RMTNOD <= 200 AND KX$L3.TYP ~= %KX_VC_TYP_RMT#

  19588   1 000A90  E2C6 0009                            LLH,R6   9,B6
          1 000A92  E970 00C8                            CMR,R6   200,IMO
          1 000A94  0A01 0011                            BAG      s:19596,PREL
          1 000A96  DCC7 0008                            LDB,B5   L3$,AUTO
          1 000A98  E845 0013                            LDR,R6   19,B5
          1 000A9A  6D03                                 CMV,R6   3
          1 000A9B  0901 000A                            BE       s:19596,PREL

     1464    19589    2                THEN
     1465    19590    3                   DO;

     1466    19591    3                      CALL_FPT.V_.ADR$ = ADDR(KX$SL.PRTID);

  19591   1 000A9D  CBC6 0008                            LAB,B4   8,B6
          1 000A9F  CFC7 0020                            STB,B4   CALL_FPT+11,AUTO

     1467    19592    3                      CALL_FPT.V_.BYTSIZ = 3;

  19592   1 000AA1  6C03                                 LDV,R6   3
          1 000AA2  EF47 0023                            STR,R6   CALL_FPT+14,AUTO

     1468    19593    3                   END;

  19593   1 000AA4  0F81 0009                            B        s:19599,PREL
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:192  

     1469    19594    2                ELSE
     1470    19595    3                   DO;

     1471    19596    3                      CALL_FPT.V_.ADR$ = KX$SL.CALUSRDAT$;

  19596   1 000AA6  DCC6 0028                            LDB,B5   40,B6
          1 000AA8  DFC7 0020                            STB,B5   CALL_FPT+11,AUTO

     1472    19597    3                      CALL_FPT.V_.BYTSIZ = KX$SL.CALUSRDATBYTSIZ;

  19597   1 000AAA  E846 002A                            LDR,R6   42,B6
          1 000AAC  EF47 0023                            STR,R6   CALL_FPT+14,AUTO

     1473    19598    3                   END;

     1474    19599    2             GOTO CAL_KXP;

  19599   1 000AAE  0F81 FC6A                            B        s:19295,PREL

     1475    19600
     1476    19601    2          CASE ( %Y_ACT_ZAP# );

     1477    19602        /*
     1478    19603           ZAP - Got a TERM from Network. If L3$ ~= nil,
     1479    19604                 call kxp ( vclst ), send term_ack, release SL context.
     1480    19605        */
     1481    19606        /*
     1482    19607           Clear the context.
     1483    19608        */
     1484    19609    2             KX$SL.OTPBFRBYTX = 0;

  19609   1 000AB0  8746 0023                            CL       35,B6

     1485    19610    2             KX$SL.OTPBFR_STAGE = 0;

  19610   1 000AB2  87C6 0024                            CLH      36,B6
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:193  

     1486    19611    2             KX$SL.CQMSG_STAGE = 0;

  19611   1 000AB4  8846 0024                            LBF,'00FF'X       36,B6
  19611   1 000AB6       00FF

     1487    19612    2             KX$SL.CQMSG_ = '0'B;

  19612   1 000AB7  5C08                                 LDV,R5   8
          1 000AB8  0021                                 ALR      ;
          1 000AB9       4178 0000                                ALPHANUM('0000'X,IMO,,1),;
          1 000ABB       4006 001E                                ALPHANUM(30,B6,,R5,FILL)

     1488    19613    2             IF KX$SL.L3$ ~= ADDR(NIL)

  19613   1 000ABD  8DC6 0004                            CMN      4,B6
          1 000ABF  437F                                 CSYNC    s:19613+1,SPREL
          1 000AC0  0901 000E                            BE       s:19619,PREL

     1489    19614    2                THEN
     1490    19615    3                   DO;

     1491    19616    3                      CALL_FPT.EVN = %KX_P_EV_VCLST#;

  19616   1 000AC2  2C09                                 LDV,R2   9
          1 000AC3  AF47 0015                            STR,R2   CALL_FPT,AUTO

     1492    19617    3                      CALL_FPT.V_ = FPT_X25.V_;

  19617   1 000AC5  ACC7 0004                            LDB,B2   @FPT_X25,AUTO
          1 000AC7  2C16                                 LDV,R2   22
          1 000AC8  6C08                                 LDV,R6   8
          1 000AC9  BB87                                 LAB,B3   ,AUTO
          1 000ACA  3C40                                 LDV,R3   64
          1 000ACB  0008                                 MMM

     1493    19618    3                      CALL Y$CAL_KXP;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:194  

  19618   1 000ACC  E3C0 004A                            LNJ,B6   s:0,PREL
          1 000ACE       0001                            DC       s:19619,PREL

     1494    19619    3                   END;

     1495    19620    2   SND_TERMACK:
     1496    19621    2             FPT@TERM_ACK.REASON = 0;

  19621   1 000ACF  8747 0033            SND_TERMACK     CL       FPT@TERM_ACK,AUTO

     1497    19622    2             KNH_MESS.FUNCTION = %KN_FCN_TERM_ACK;

  19622   1 000AD1  6C04                                 LDV,R6   4
          1 000AD2  EF47 0025                            STR,R6   KNH_MESS,AUTO

     1498    19623    2             KNH_MESS.FPTSZ = 2 * SIZEW ( FPT@TERM_ACK );

  19623   1 000AD4  EF47 002B                            STR,R6   KNH_MESS+6,AUTO

     1499    19624    2             KV@SNDCQ.MSG_.ADR$ (1) = ADDR ( FPT@TERM_ACK );

  19624   1 000AD6  EBC7 0033                            LAB,B6   FPT@TERM_ACK,AUTO
          1 000AD8  EFC7 0072                            STB,B6   KV@SNDCQ+4,AUTO

     1500    19625    2             KV@SNDCQ.MSG_.BYTSIZ (1) = (LENGTHC( FPT@TERM_ACK ) + 3)/4*4;

  19625   1 000ADA  EF47 0075                            STR,R6   KV@SNDCQ+7,AUTO

     1501    19626    2             CALL KVM$SNDCQ ( KV@SNDCQ )

  19626   1 000ADC  DBC7 006E                            LAB,B5   KV@SNDCQ,AUTO
          1 000ADE  DFC7 0094                            STB,B5   I+2,AUTO
          1 000AE0  BBC7 0094                            LAB,B3   I+2,AUTO
          1 000AE2  CBF0 0100                            LAB,B4   256,IMO
          1 000AE4  E380 0000 0000  xent                 LNJ,B6   KVM$SNDCQ
          1 000AE7       0003                            DC       s:19633,PREL
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:195  

     1502    19627    2                WHENRETURN
     1503    19628    3                   DO;

     1504    19629    3                      GOTO RLS_SL;

  19629   1 000AE8  0F81 FEBC                            B        s:19525,PREL

     1505    19630    3                   END;
     1506    19631    2                WHENALTRETURN
     1507    19632    3                   DO;

     1508    19633    3                      KX$SL.SNDTRMACK_ALTRET = '1'B;

  19633   1 000AEA  ECC7 0006                            LDB,B6   SL$,AUTO
          1 000AEC  8946 0009                            LBT,'0001'X       9,B6
          1 000AEE       0001

     1509    19634    3                   END;

  19634   1 000AEF  0F81 0003                            B        s:19640,PREL

     1510    19635
     1511    19636    2          CASE ( ELSE );

     1512    19637
     1513    19638    2             GOTO L_SCR;   /* in case (action_screech) */

  19638   1 000AF1  0F81 FDF2                            B        s:19472,PREL

     1514    19639
     1515    19640    2       END;   /* do case (action) */

  19640   1 000AF3  0F81 01B2                            B        s:20537,PREL

     1516    19641        %EJECT;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:196  
     1517    19642
     1518    19643    1   Y$RPRDAT: PROC ALTRET;

  19643   1 000AF5  EFC7 008A            Y$RPRDAT        STB,B6   CAL$_IS_L3$+2,AUTO

     1519    19644
     1520    19645    2       KX$SL.RPRDAT = '0'B;

  19645   1 000AF7  DCC7 0006                            LDB,B5   SL$,AUTO
          1 000AF9  8845 0009                            LBF,'0080'X       9,B5
          1 000AFB       0080

     1521    19646    2       CALL KXP$PACKET ( CALL_FPT );

  19646   1 000AFC  EBC7 0015                            LAB,B6   CALL_FPT,AUTO
          1 000AFE  EFC7 0094                            STB,B6   I+2,AUTO
          1 000B00  BBC7 0094                            LAB,B3   I+2,AUTO
          1 000B02  CBF0 0100                            LAB,B4   256,IMO
          1 000B04  E380 0000 0000  xent                 LNJ,B6   KXP$PACKET
          1 000B07       0001                            DC       s:19647,PREL

     1522    19647    2       IF NOT KX$SL.RPRDAT

  19647   1 000B08  ECC7 0006                            LDB,B6   SL$,AUTO
          1 000B0A  82C6 0009                            LB,'0080'X        9,B6
          1 000B0C       0080
          1 000B0D  0501 0005                            BBT      s:19650,PREL

     1523    19648    2          THEN
     1524    19649    2             ALTRETURN;

  19649   1 000B0F  ECC7 008A                            LDB,B6   CAL$_IS_L3$+2,AUTO
          1 000B11  B806                                 LDR,R3   ,B6
          1 000B12  C3B6                                 LNJ,B4   ,B6,R3

     1525    19650    2       RETURN;

PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:197  
  19650   1 000B13  ECC7 008A                            LDB,B6   CAL$_IS_L3$+2,AUTO
          1 000B15  C3C6 0001                            LNJ,B4   1,B6

     1526    19651
     1527    19652    2   END Y$RPRDAT;
     1528    19653
     1529    19654    1   Y$CAL_KXP: PROC;

  19654   1 000B17  EFC7 008A            Y$CAL_KXP       STB,B6   CAL$_IS_L3$+2,AUTO

     1530    19655
     1531    19656    2       CALL KXP$PACKET ( CALL_FPT ) WHENALTRETURN

  19656   1 000B19  DBC7 0015                            LAB,B5   CALL_FPT,AUTO
          1 000B1B  DFC7 0094                            STB,B5   I+2,AUTO
          1 000B1D  BBC7 0094                            LAB,B3   I+2,AUTO
          1 000B1F  CBF0 0100                            LAB,B4   256,IMO
          1 000B21  E380 0000 0000  xent                 LNJ,B6   KXP$PACKET
          1 000B24       0003                            DC       s:19658,PREL
          1 000B25  0F81 0009                            B        s:19660,PREL

     1532    19657    3             DO;

     1533    19658    3                CALL KHD$SCREECH ( CALL_FPT.PRM1$->B$SCODE );

  19658   1 000B27  BBC7 001C                            LAB,B3   CALL_FPT+7,AUTO
          1 000B29  CBF0 0100                            LAB,B4   256,IMO
          1 000B2B  E380 0000 0000  xent                 LNJ,B6   KHD$SCREECH
          1 000B2E       0001                            DC       s:19660,PREL

     1534    19659    3             END;

     1535    19660    2       RETURN;

  19660   1 000B2F  ECC7 008A                            LDB,B6   CAL$_IS_L3$+2,AUTO
          1 000B31  C3C6 0001                            LNJ,B4   1,B6

PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:198  
     1536    19661
     1537    19662    2   END Y$CAL_KXP;
     1538    19663
     1539    19664    1   Y$ER: PROC;

  19664   1 000B33  EFC7 008A            Y$ER            STB,B6   CAL$_IS_L3$+2,AUTO

     1540    19665
     1541    19666            %WRSYSLOG ( ERRCOD = ERCOD, TRMID = "KX$SL.L3$->KX$L3.CHN$->KH$CHN.TERMID" );

  19682   1 000B35  DCC7 0006                            LDB,B5   SL$,AUTO
          1 000B37  CCC5 0004                            LDB,B4   4,B5
          1 000B39  BCC4 0006                            LDB,B3   6,B4
          1 000B3B  AB80 0000 0000                       LAB,B2   0
          1 000B3E  AFC7 0098                            STB,B2   I+6,AUTO
          1 000B40  CBC3 0012                            LAB,B4   18,B3
          1 000B42  CFC7 0096                            STB,B4   I+4,AUTO
          1 000B44  BBC7 002D                            LAB,B3   ERCOD,AUTO
          1 000B46  BFC7 0094                            STB,B3   I+2,AUTO
          1 000B48  BBC7 0094                            LAB,B3   I+2,AUTO
          1 000B4A  CBF0 0300                            LAB,B4   768,IMO
          1 000B4C  E380 0000 0000  xent                 LNJ,B6   KXS$SYSLOG
          1 000B4F       0001                            DC       s:19684,PREL

     1542    19684    2       RETURN;

  19684   1 000B50  ECC7 008A                            LDB,B6   CAL$_IS_L3$+2,AUTO
          1 000B52  C3C6 0001                            LNJ,B4   1,B6

     1543    19685
     1544    19686    2   END Y$ER;
     1545    19687
     1546    19688    1   Y$GETL3: PROC ( L2$, REDIR ) ALTRET;

  19688   1 000B54  EFC7 008A            Y$GETL3         STB,B6   CAL$_IS_L3$+2,AUTO

     1547    19689
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:199  
     1548    19690    2   DCL L2$ PTR;      /* this is the input  */
     1549    19691    2   DCL REDIR UBIN;   /* 0 = new request, 1 = redirect circuit */
     1550    19692        %KX$L2;
     1551    20059    2   DCL TL3$ PTR;
     1552    20060        %KX$L3 ( FPTN = KX$TL3, STCLASS = "BASED(TL3$)" );
     1553    20463    2   DCL I UBIN;
     1554    20464
     1555    20465    2       CALL KXS$GETL3 ( L2$, L3$ ) ALTRET ( L_ALTRET );

  20465   1 000B56  DBC7 0008                            LAB,B5   L3$,AUTO
          1 000B58  DFC7 0096                            STB,B5   I+4,AUTO
          1 000B5A  CCC7 008C                            LDB,B4   @L2$,AUTO
          1 000B5C  CFC7 0094                            STB,B4   I+2,AUTO
          1 000B5E  BBC7 0094                            LAB,B3   I+2,AUTO
          1 000B60  CBF0 0200                            LAB,B4   512,IMO
          1 000B62  E380 0000 0000  xent                 LNJ,B6   KXS$GETL3
          1 000B65       0025                            DC       s:20470,PREL

     1556    20466    2       CALL KVB$GETSYS ( SIZEW(KH$CHN), KX$L3.CHN$ ) WHENALTRETURN

  20466   1 000B66  EBF0 0020                            LAB,B6   32,IMO
          1 000B68  DCC7 0008                            LDB,B5   L3$,AUTO
          1 000B6A  CBC5 0006                            LAB,B4   6,B5
          1 000B6C  CFC7 0096                            STB,B4   I+4,AUTO
          1 000B6E  EFC7 0094                            STB,B6   I+2,AUTO
          1 000B70  BBC7 0094                            LAB,B3   I+2,AUTO
          1 000B72  CBF0 0200                            LAB,B4   512,IMO
          1 000B74  E380 0000 0000  xent                 LNJ,B6   KVB$GETSYS
          1 000B77       0003                            DC       s:20468,PREL
          1 000B78  0F81 0015                            B        s:20472,PREL

     1557    20467    3             DO;

     1558    20468    3                CALL KVB$RLSSYS ( SIZEW(KX$L3), L3$ );

  20468   1 000B7A  EBF0 0091                            LAB,B6   145,IMO
          1 000B7C  DBC7 0008                            LAB,B5   L3$,AUTO
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:200  
          1 000B7E  DFC7 0096                            STB,B5   I+4,AUTO
          1 000B80  EFC7 0094                            STB,B6   I+2,AUTO
          1 000B82  BBC7 0094                            LAB,B3   I+2,AUTO
          1 000B84  CBF0 0200                            LAB,B4   512,IMO
          1 000B86  E380 0000 0000  xent                 LNJ,B6   KVB$RLSSYS
          1 000B89       0001                            DC       s:20470,PREL

     1559    20469    3   L_ALTRET:
     1560    20470    3                ALTRETURN;

  20470   1 000B8A  ECC7 008A            L_ALTRET        LDB,B6   CAL$_IS_L3$+2,AUTO
          1 000B8C  B806                                 LDR,R3   ,B6
          1 000B8D  C3B6                                 LNJ,B4   ,B6,R3

     1561    20471    3             END;
     1562    20472    2       KX$L3.TYP = %KX_VC_TYP_CL0#;

  20472   1 000B8E  ECC7 0008                            LDB,B6   L3$,AUTO
          1 000B90  6C07                                 LDV,R6   7
          1 000B91  EF46 0013                            STR,R6   19,B6

     1563    20473    2       KX$L3.RLSCHN = '1'B;

  20473   1 000B93  8946 0029                            LBT,'0400'X       41,B6
  20473   1 000B95       0400

     1564    20474    2       %L3CHN = L2$->KX$L2.CHN$->KH$CHN;

  20474   1 000B96  DCC6 0006                            LDB,B5   6,B6
          1 000B98  CCC7 008C                            LDB,B4   @L2$,AUTO
          1 000B9A  BC84                                 LDB,B3   ,B4
          1 000B9B  ACC3 0002                            LDB,B2   2,B3
          1 000B9D  2C00                                 LDV,R2   0
          1 000B9E  6C40                                 LDV,R6   64
          1 000B9F  BB85                                 LAB,B3   ,B5
          1 000BA0  3C00                                 LDV,R3   0
          1 000BA1  0008                                 MMM
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:201  

     1565    20475    2       %L3CHN.CTX$ = L3$;

  20475   1 000BA2  ECC7 0008                            LDB,B6   L3$,AUTO
          1 000BA4  ACC6 0006                            LDB,B2   6,B6
          1 000BA6  EFC2 000C                            STB,B6   12,B2

     1566    20476    2       %L3CHN.SUB$ = ADDR(NIL);

  20476   1 000BA8  ACC6 0006                            LDB,B2   6,B6
          1 000BAA  9B80 0000 0000                       LAB,B1   0
          1 000BAD  9FC2 001A                            STB,B1   26,B2

     1567    20477    2       %L3CHN.TERMID.LEV = %TERMINAL_ID_LEV_SUBCHAN#;

  20477   1 000BAF  ACC6 0006                            LDB,B2   6,B6
          1 000BB1  6C02                                 LDV,R6   2
          1 000BB2  EAC2 0012                            SRM,R6,'00FF'X    18,B2
          1 000BB4       00FF

     1568    20478    2       %L3CHN.TERMID.TTYP = %KLTY_VIRCIR#;

  20478   1 000BB5  ACC6 0006                            LDB,B2   6,B6
          1 000BB7  5C08                                 LDV,R5   8
          1 000BB8  D7C2 0012                            STH,R5   18,B2

     1569    20479        /*
     1570    20480            find an available subdevice number for this L3.
     1571    20481        */
     1572    20482    3       DO I = 1 TO 4095;

  20482   1 000BBA  4C01                                 LDV,R4   1
          1 000BBB  CF47 0092                            STR,R4   I,AUTO

     1573    20483    3          TL3$ = L2$->KX$L2.L3_HEAD$;

  20483   1 000BBD  ECC7 008C                            LDB,B6   @L2$,AUTO
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:202  
          1 000BBF  DC86                                 LDB,B5   ,B6
          1 000BC0  CCC5 0034                            LDB,B4   52,B5
          1 000BC2  CFC7 0090                            STB,B4   TL3$,AUTO

     1574    20484    4          DO WHILE ( TL3$ ~= L3$ AND

  20484   1 000BC4  0F81 0006                            B        s:20488,PREL

     1575    20485    4             ( %TL3CHN.TERMID.LEV ~= %TERMINAL_ID_LEV_SUBCHAN#
     1576    20486    4             OR %TL3CHN.TERMID.TERM.SUBDEVICE ~= I ));
     1577    20487    4             TL3$ = KX$TL3.NEXT$;

  20487   1 000BC6  ECC7 0090                            LDB,B6   TL3$,AUTO
          1 000BC8  DC86                                 LDB,B5   ,B6
          1 000BC9  DFC7 0090                            STB,B5   TL3$,AUTO

     1578    20488    4          END;  /* do while ( tl3$... */

  20488   1 000BCB  ECC7 0090                            LDB,B6   TL3$,AUTO
          1 000BCD  EDC7 0008                            CMB,B6   L3$,AUTO
          1 000BCF  0901 000E                            BE       s:20489,PREL
          1 000BD1  DCC6 0006                            LDB,B5   6,B6
          1 000BD3  E845 0012                            LDR,R6   18,B5
          1 000BD5  E570 00FF                            AND,R6   255,IMO
          1 000BD7  6D02                                 CMV,R6   2
          1 000BD8  09EE                                 BNE      s:20487,SPREL
          1 000BD9  D845 0014                            LDR,R5   20,B5
          1 000BDB  D947 0092                            CMR,R5   I,AUTO
          1 000BDD  09E9                                 BNE      s:20487,SPREL

     1579    20489    3          IF TL3$ = L3$

  20489   1 000BDE  EDC7 0008                            CMB,B6   L3$,AUTO
          1 000BE0  0981 000D                            BNE      s:20495,PREL

     1580    20490    3             THEN
     1581    20491    4                DO;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:203  

     1582    20492    4                   %L3CHN.TERMID.TERM.SUBDEVICE = I;

  20492   1 000BE2  DCC7 0008                            LDB,B5   L3$,AUTO
          1 000BE4  CCC5 0006                            LDB,B4   6,B5
          1 000BE6  E847 0092                            LDR,R6   I,AUTO
          1 000BE8  EF44 0014                            STR,R6   20,B4

     1583    20493    4                   I = 4096;

  20493   1 000BEA  E870 1000                            LDR,R6   4096,IMO
          1 000BEC  EF47 0092                            STR,R6   I,AUTO

     1584    20494    4                END;

     1585    20495    3       END;   /* do i = ... */

  20495   1 000BEE  8AC7 0092                            INC      I,AUTO
          1 000BF0  E847 0092                            LDR,R6   I,AUTO
          1 000BF2  E970 0FFF                            CMR,R6   4095,IMO
          1 000BF4  03C9                                 BLE      s:20483,SPREL

     1586    20496    2       KX$L3.CM$ = SL$;

  20496   1 000BF5  DCC7 0006                            LDB,B5   SL$,AUTO
          1 000BF7  CCC7 0008                            LDB,B4   L3$,AUTO
          1 000BF9  DFC4 0004                            STB,B5   4,B4

     1587    20497    2       IF REDIR = 1

  20497   1 000BFB  DCC7 008E                            LDB,B5   @REDIR,AUTO
          1 000BFD  D805                                 LDR,R5   ,B5
          1 000BFE  5D01                                 CMV,R5   1
          1 000BFF  0981 0030                            BNE      s:20507,PREL

     1588    20498    2          THEN
     1589    20499    3             DO;
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:204  

     1590    20500    3                KX$SL.SCN_L3$ = L3$;

  20500   1 000C01  CCC7 0008                            LDB,B4   L3$,AUTO
          1 000C03  BCC7 0006                            LDB,B3   SL$,AUTO
          1 000C05  CFC3 0006                            STB,B4   6,B3

     1591    20501    3                KX$L3.LCLNSAP = KX$SL.L3$->KX$TL3.LCLNSAP;

  20501   1 000C07  CCC7 0006                            LDB,B4   SL$,AUTO
          1 000C09  BCC4 0004                            LDB,B3   4,B4
          1 000C0B  ABC3 007B                            LAB,B2   123,B3
          1 000C0D  2C00                                 LDV,R2   0
          1 000C0E  6C16                                 LDV,R6   22
          1 000C0F  BCC7 0008                            LDB,B3   L3$,AUTO
          1 000C11  BBC3 007B                            LAB,B3   123,B3
          1 000C13  3C00                                 LDV,R3   0
          1 000C14  0008                                 MMM

     1592    20502    3                KX$L3.RMTNSAP = KX$SL.L3$->KX$TL3.RMTNSAP;

  20502   1 000C15  ECC7 0006                            LDB,B6   SL$,AUTO
          1 000C17  CCC6 0004                            LDB,B4   4,B6
          1 000C19  ABC4 0086                            LAB,B2   134,B4
          1 000C1B  2C00                                 LDV,R2   0
          1 000C1C  6C16                                 LDV,R6   22
          1 000C1D  BCC7 0008                            LDB,B3   L3$,AUTO
          1 000C1F  BBC3 0086                            LAB,B3   134,B3
          1 000C21  3C00                                 LDV,R3   0
          1 000C22  0008                                 MMM

     1593    20503    3                KX$L3.CALL_OPTS.RCVADR = KX$SL.L3$->KX$TL3.CALL_OPTS.RCVADR;

  20503   1 000C23  ECC7 0006                            LDB,B6   SL$,AUTO
          1 000C25  CCC6 0004                            LDB,B4   4,B6
          1 000C27  AB84                                 LAB,B2   ,B4
          1 000C28  2C2E                                 LDV,R2   46
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:205  
          1 000C29  6C08                                 LDV,R6   8
          1 000C2A  BCC7 0008                            LDB,B3   L3$,AUTO
          1 000C2C  3C2E                                 LDV,R3   46
          1 000C2D  0008                                 MMM

     1594    20504    3             END;

  20504   1 000C2E  0F81 0023                            B        s:20512,PREL

     1595    20505    2          ELSE
     1596    20506    3             DO;

     1597    20507    3                KX$SL.L3$ = L3$;

  20507   1 000C30  CCC7 0008                            LDB,B4   L3$,AUTO
          1 000C32  BCC7 0006                            LDB,B3   SL$,AUTO
          1 000C34  CFC3 0004                            STB,B4   4,B3

     1598    20508    3                KX$L3.LCLNSAP = FPT$CONNECT.LADR;

  20508   1 000C36  ACC7 000C                            LDB,B2   FPT$,AUTO
          1 000C38  2C3C                                 LDV,R2   60
          1 000C39  6C16                                 LDV,R6   22
          1 000C3A  BCC7 0008                            LDB,B3   L3$,AUTO
          1 000C3C  BBC3 007B                            LAB,B3   123,B3
          1 000C3E  3C00                                 LDV,R3   0
          1 000C3F  0008                                 MMM

     1599    20509    3                KX$L3.RMTNSAP = FPT$CONNECT.DEST;

  20509   1 000C40  ACC7 000C                            LDB,B2   FPT$,AUTO
          1 000C42  2C26                                 LDV,R2   38
          1 000C43  6C16                                 LDV,R6   22
          1 000C44  BCC7 0008                            LDB,B3   L3$,AUTO
          1 000C46  BBC3 0086                            LAB,B3   134,B3
          1 000C48  3C00                                 LDV,R3   0
          1 000C49  0008                                 MMM
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:206  

     1600    20510    3                KX$L3.CALL_OPTS.RCVADR = FPT$CONNECT.DSTSNPA;

  20510   1 000C4A  ACC7 000C                            LDB,B2   FPT$,AUTO
          1 000C4C  2C52                                 LDV,R2   82
          1 000C4D  6C08                                 LDV,R6   8
          1 000C4E  BCC7 0008                            LDB,B3   L3$,AUTO
          1 000C50  3C2E                                 LDV,R3   46
          1 000C51  0008                                 MMM

     1601    20511    3             END;

     1602    20512    2       KX$L3.LCLNSAP.NSAP.LEN = KX$L3.LCLNSAP.NSAP.LEN*2;

  20512   1 000C52  ECC7 0008                            LDB,B6   L3$,AUTO
          1 000C54  E2C6 007B                            LLH,R6   123,B6
          1 000C56  6001                                 SOL,R6   1
          1 000C57  E7C6 007B                            STH,R6   123,B6

     1603    20513    2       KX$L3.RMTNSAP.NSAP.LEN = KX$L3.RMTNSAP.NSAP.LEN*2;

  20513   1 000C59  E2C6 0086                            LLH,R6   134,B6
          1 000C5B  6001                                 SOL,R6   1
          1 000C5C  E7C6 0086                            STH,R6   134,B6

     1604    20514
     1605    20515    2       KX$L3.DFL_OPTS = KX$L3.CALL_OPTS;

  20515   1 000C5E  AB86                                 LAB,B2   ,B6
          1 000C5F  2C28                                 LDV,R2   40
          1 000C60  6C0E                                 LDV,R6   14
          1 000C61  BB82                                 LAB,B3   ,B2
          1 000C62  3C44                                 LDV,R3   68
          1 000C63  0008                                 MMM

     1606    20516    2       KX$L3.CM_OPTS = KX$L3.CALL_OPTS;

PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:207  
  20516   1 000C64  ACC7 0008                            LDB,B2   L3$,AUTO
          1 000C66  2C28                                 LDV,R2   40
          1 000C67  6C0E                                 LDV,R6   14
          1 000C68  BB82                                 LAB,B3   ,B2
          1 000C69  3C36                                 LDV,R3   54
          1 000C6A  0008                                 MMM

     1607    20517        /* change the L3 state to DOWN so that we can tell him to start the call */
     1608    20518
     1609    20519    2       KX$L3.STATE.CURRENT = 5;

  20519   1 000C6B  6C05                                 LDV,R6   5
          1 000C6C  CCC7 0008                            LDB,B4   L3$,AUTO
          1 000C6E  E7C4 0031                            STH,R6   49,B4

     1610    20520    2       RETURN;

  20520   1 000C70  ECC7 008A                            LDB,B6   CAL$_IS_L3$+2,AUTO
          1 000C72  C3C6 0001                            LNJ,B4   1,B6

     1611    20521
     1612    20522    2   END Y$GETL3;
     1613    20523
     1614    20524    1   Y$COPY: PROC ALTRET;

  20524   1 000C74  EFC7 008A            Y$COPY          STB,B6   CAL$_IS_L3$+2,AUTO

     1615    20525
     1616    20526    2       KVBSIZ = ( FPT_X25.V_.BYTSIZ + 1 ) / 2;

  20526   1 000C76  DCC7 0004                            LDB,B5   @FPT_X25,AUTO
          1 000C78  E845 000E                            LDR,R6   14,B5
          1 000C7A  6E01                                 ADV,R6   1
          1 000C7B  6041                                 SOR,R6   1
          1 000C7C  EF47 0014                            STR,R6   KVBSIZ,AUTO

     1617    20527    2       CALL KVB$GETSYS ( KVBSIZ, Y$ ) WHENALTRETURN
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:208  

  20527   1 000C7E  CBC7 0011                            LAB,B4   Y$,AUTO
          1 000C80  CFC7 0096                            STB,B4   I+4,AUTO
          1 000C82  BBC7 0014                            LAB,B3   KVBSIZ,AUTO
          1 000C84  BFC7 0094                            STB,B3   I+2,AUTO
          1 000C86  BBC7 0094                            LAB,B3   I+2,AUTO
          1 000C88  CBF0 0200                            LAB,B4   512,IMO
          1 000C8A  E380 0000 0000  xent                 LNJ,B6   KVB$GETSYS
          1 000C8D       0003                            DC       s:20529,PREL
          1 000C8E  0F81 0005                            B        s:20531,PREL

     1618    20528    3             DO;

     1619    20529    3                ALTRETURN;

  20529   1 000C90  ECC7 008A                            LDB,B6   CAL$_IS_L3$+2,AUTO
          1 000C92  B806                                 LDR,R3   ,B6
          1 000C93  C3B6                                 LNJ,B4   ,B6,R3

     1620    20530    3             END;
     1621    20531    2       SUBSTR ( Y$->B$STR, 0, FPT_X25.V_.BYTSIZ ) =

  20531   1 000C94  ECC7 0004                            LDB,B6   @FPT_X25,AUTO
          1 000C96  E846 000E                            LDR,R6   14,B6
          1 000C98  DCC6 000B                            LDB,B5   11,B6
          1 000C9A  D846 000D                            LDR,R5   13,B6
          1 000C9C  AB85                                 LAB,B2   ,B5
          1 000C9D  A855                                 LDR,R2   R5
          1 000C9E  BCC7 0011                            LDB,B3   Y$,AUTO
          1 000CA0  3C00                                 LDV,R3   0
          1 000CA1  0008                                 MMM

     1622    20532    2          SUBSTR ( FPT_X25.V_.ADR$->B$STR, FPT_X25.V_.BYTX, FPT_X25.V_.BYTSIZ );
     1623    20533    2       RETURN;

  20533   1 000CA2  ECC7 008A                            LDB,B6   CAL$_IS_L3$+2,AUTO
          1 000CA4  C3C6 0001                            LNJ,B4   1,B6
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:209  

     1624    20534
     1625    20535    2   END Y$COPY;
     1626    20536
     1627    20537    1   END KXV$VCNTW;

  20537   1 000CA6  C380 0000 0000  xent                 LNJ,B4   X6A_ARET

PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:210  
--  Include file information  --

   K_REASON_C.:E05TOU  is referenced.
   K_ADDRESS_M.:E05TOU  is referenced.
   KX_MACROS_M.:E05TOU  is referenced.
   KX_DATA_C.:E05TOU  is referenced.
   KX_SCODE_C.:E05TOU  is referenced.
   KX_PERR_C.:E05TOU  is referenced.
   KX_EQUS_E.:E05TOU  is referenced.
   KV_GLBCNS_E.:E05TOU  is referenced.
   KV$GLB.:E05TOU  is referenced.
   KH$CHN.:E05TOU  is referenced.
   KNH_MACRO_C.:E05TOU  is referenced.
   KL_SUPER_C.:E05TOU  is referenced.
   G_JIT_M.:E05TOU  is referenced.
   CP_6_SUBS.:E05TOU  is referenced.
   G_LCP6_E.:E05TOU  is referenced.
   GT_LCP6_M.:E05TOU  is referenced.
   KI_CP6.:E05TOU  is referenced.
   GF_LCP6_M.:E05TOU  is referenced.
   GM_LCP6_M.:E05TOU  is referenced.
   GU_LCP6_M.:E05TOU  is referenced.
   GJ_LCP6_M.:E05TOU  is referenced.
   GH_LCP6_M.:E05TOU  is referenced.
   LCP_6.:E05TOU  cannot be made into a system file and is referenced.
   KL_AFCN_C.:E05TOU  is referenced.
   KL_MACRO_C.:E05TOU  is referenced.
   K_ID_E.:E05TOU  is referenced.
      No diagnostics issued in procedure KXV$VCNTW.
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:211  

 **** Variables and constants ****

  ****  Section 000 RoData KXV$VCNTW

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

    85-0-0/w STRC(720)   r     1 FPT_CONNECT_C             81-0-0/w STRC(64)    r     1 FPT_TERM_C
    B2-0-0/w STRC(784)   r     1 KX_SL                      0-0-0/b STRC(1760)  r     1 STATE_TABLE
    78-0-0/w STRC(48)    r     1 Y_ACTSCR                  7E-0-0/w STRC(48)    r     1 Y_BADPRM
    7B-0-0/w STRC(48)    r     1 Y_BADSLLIST               72-0-0/w STRC(48)    r     1 Y_NO_MEM
    6E-0-0/w STRC(32)    r     1 Y_SHR_PKT                 70-0-0/w STRC(32)    r     1 Y_UNB_PKT
    75-0-0/w STRC(48)    r     1 Y_UNKEVT

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     4-0-0/w PTR         r     1 @FPT_X25                  8C-0-0/w PTR         r     1 @L2$
    8E-0-0/w PTR         r     1 @REDIR                     F-0-0/w UBIN(16)    r     1 ACTION
    13-0-0/w UBIN(16)    r     1 BYTX                      88-0-0/b BIT         r     1 CAL$_IS_L3$
    15-0-0/w STRC(256)   r     1 CALL_FPT                  6A-0-0/w PTR         r     1 CTX$
    2D-0-0/w STRC(32)    r     1 ERCOD                      E-0-0/w UBIN(16)    r     1 EVENT
     C-0-0/w PTR         r     1 FPT$                      35-0-0/w STRC(720)   r     1 FPT@CONNECT
    62-0-0/w STRC(96)    r     1 FPT@CONNECT_ACK           68-0-0/w STRC(32)    r     1 FPT@RESET
    2F-0-0/w STRC(64)    r     1 FPT@TERM                  33-0-0/w STRC(32)    r     1 FPT@TERM_ACK
    *0-0-0/w STRC(256)   r     1 FPT_X25                   92-0-0/w UBIN(16)    r     1 I
    25-0-0/c STRC(128)   r     1 KNH_MESS                  6E-0-0/w STRC(384)   r     1 KV@SNDCQ
    14-0-0/w UBIN(16)    r     1 KVBSIZ                    *0-0-0/w PTR         r     1 L2$
     8-0-0/w PTR         r     1 L3$                        A-0-0/w PTR         r     1 MSG$
    86-0-0/w PTR         r     1 OUTLINK$                  6C-0-0/w PTR         r     1 PRVCTX$
    *0-0-0/w UBIN(16)    r     1 REDIR                      6-0-0/w PTR         r     1 SL$
    10-0-0/w UBIN(16)    r     1 STATE                     90-0-0/w PTR         r     1 TL3$
    11-0-0/w PTR         r     1 Y$

  ****  SYMREF variables  ****
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:212  

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 G$JIT$                     0-0-0/w UBIN(16)    r     1 KH_NODE#
     0-0-0/w STRC(672)   r     1 KX_BUF                     0-0-0/b EPTR        r     1 KX_PM$(0:2)
     0-0-0/w STRC(64)    r     1 KX_SLLIST

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
HexLoc.c.b A Datatyp(siz) R M Lvl/name                 HexLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(48)    r     1 B$SCODE                    0-0-0/c CHAR(2000)  r     1 B$STR
     0-0-0/w STRC(720)   r     1 FPT$CONNECT                0-0-0/w STRC(96)    r     1 FPT$CONNECT_ACK
     0-0-0/w STRC(32)    r     1 FPT$RESET
     0-0-0/c UBIN(8)     r     1 INPDAT_ARY(0:4095)
     0-0-0/w STRC(512)   r     1 KH$CHN                     0-0-0/w STRC(4992)  r     1 KX$L2
     0-0-0/w STRC(4992)  r     1 KX$L2                      0-0-0/w STRC(2320)  r     1 KX$L3
     0-0-0/w STRC(784)   r     1 KX$SL                      0-0-0/w STRC(2320)  r     1 KX$TL3


   Procedure KXV$VCNTW requires 3241 words for executable code.
   Procedure KXV$VCNTW requires 154 words of local(AUTO) storage.

    No errors detected in file KXV$VCNTW.:E05TSI    .
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:213  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:214  
          MINI XREF LISTING

ACTION
     14862**DCL     19330<<ASSIGN  19333>>ASSIGN  19336>>DOCASE  19440>>IF      19448>>IF
B$SCODE
     16908**DCL     19658<>CALL
B$STR
     16879**DCL     19124<<ASSIGN  19124>>ASSIGN  20531<<ASSIGN  20531>>ASSIGN
BYTX
     14865**DCL     19163<<ASSIGN  19165<<ASSIGN  19166>>DOWHILE 19170>>ASSIGN  19170>>ASSIGN  19176<<ASSIGN
     19176>>ASSIGN  19181>>ASSIGN  19188>>ASSIGN  19191<<ASSIGN  19191>>ASSIGN  19193>>IF
CAL$_IS_L3$
     15301**DCL     18648<<ASSIGN  18653<<ASSIGN  18678>>IF      18738>>IF      18781>>IF      18812>>IF
CALL_FPT
     14894**DCL     18587<<ASSIGN  18644<<ASSIGN  19646<>CALL    19656<>CALL
CALL_FPT.CAL$
     14898**DCL     18588<<ASSIGN  18628<<ASSIGN  18656<<ASSIGN  18965<<ASSIGN  19367<<ASSIGN
CALL_FPT.EVN
     14898**DCL     18623<<ASSIGN  18661<<ASSIGN  18665<<ASSIGN  18669<<ASSIGN  18677<<ASSIGN  18737<<ASSIGN
     18804<<ASSIGN  18808<<ASSIGN  18884<<ASSIGN  18975<<ASSIGN  19102<<ASSIGN  19275<<ASSIGN  19293<<ASSIGN
     19366<<ASSIGN  19587<<ASSIGN  19616<<ASSIGN
CALL_FPT.PRM1
     14899**DCL     18885<<ASSIGN  19276<<ASSIGN
CALL_FPT.PRM1$
     14899**DCL     14900--REDEF   19658>>CALL
CALL_FPT.PRM2
     14899**DCL     19277<<ASSIGN
CALL_FPT.PRM2$
     14901**DCL     14901--REDEF
CALL_FPT.RCV$
     14898**DCL     18589<<ASSIGN  18629<<ASSIGN  18649<<ASSIGN  18654<<ASSIGN  18899<<ASSIGN  18966<<ASSIGN
     19368<<ASSIGN
CALL_FPT.V_
     14902**DCL     19294<<ASSIGN  19617<<ASSIGN
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:215  
CALL_FPT.V_.ADR$
     14902**DCL     19591<<ASSIGN  19596<<ASSIGN
CALL_FPT.V_.BYTSIZ
     14903**DCL     19592<<ASSIGN  19597<<ASSIGN
CAL_KXP
     19295**LABEL   19278--GOTO    19599--GOTO
CLR_VC
     18884**LABEL   18896--CALLALT 18944--CALLALT
CTX$
     15293**DCL     19526<<ASSIGN  19527>>IF      19537>>ASSIGN  19538<<ASSIGN  19538>>ASSIGN  19539>>DOWHILE
     19539>>DOWHILE 19540>>ASSIGN  19541<<ASSIGN  19541>>ASSIGN  19543>>IF
ERCOD
     14974**DCL     19144<<ASSIGN  19196<<ASSIGN  19682<>CALL
EVENT
     14861**DCL     18841<<ASSIGN  18848<<ASSIGN  18861<<ASSIGN  18900<<ASSIGN  18908<<ASSIGN  18921<<ASSIGN
     18936<<ASSIGN  18940<<ASSIGN  18955<<ASSIGN  19327>>ASSIGN  19332>>ASSIGN
FPT$
     14860**DCL     15326--IMP-PTR 15375--IMP-PTR 16958--IMP-PTR 18515<<ASSIGN  18853>>IF      18881>>IF
     18896>>CALL    19276>>ASSIGN  19277>>ASSIGN  20508>>ASSIGN  20509>>ASSIGN  20510>>ASSIGN
FPT$CONNECT.DEST
     15442**DCL     20509>>ASSIGN
FPT$CONNECT.DEST.ADDRESS_N
     15472**DCL     15473--REDEF
FPT$CONNECT.DSTSNPA
     15528**DCL     20510>>ASSIGN
FPT$CONNECT.DSTSNPA.ADR_STRING
     15528**DCL     15528--REDEF
FPT$CONNECT.LADR
     15494**DCL     20508>>ASSIGN
FPT$CONNECT.LADR.ADDRESS_N
     15524**DCL     15525--REDEF
FPT$CONNECT.RLCID.GENERATION
     15411**DCL     15412--REDEF
FPT$CONNECT.RLCID.LDCTX
     15412**DCL     15412--REDEF
FPT$CONNECT.TERMINAL_ID.TERM
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:216  
     15400**DCL     15409--REDEF
FPT$CONNECT_ACK.OUTLINK$
     15330**DCL     18896<>CALL
FPT$CONNECT_ACK.REASON
     15330**DCL     18853>>IF      18881>>IF
FPT$CONNECT_ACK.UID.UID
     15356**DCL     15356--REDEF   15356--REDEF
FPT$RESET.CAUSE
     16962**DCL     19276>>ASSIGN
FPT$RESET.DIAG
     16962**DCL     19277>>ASSIGN
FPT@CONNECT
     15064**DCL     19376<<ASSIGN  19393--ASSIGN  19397--ASSIGN  19398--ASSIGN
FPT@CONNECT.DEST
     15131**DCL     19387<<ASSIGN
FPT@CONNECT.DEST.ADDRESS_N
     15161**DCL     15162--REDEF
FPT@CONNECT.DEST.LEN
     15133**DCL     19389<<ASSIGN  19389>>ASSIGN
FPT@CONNECT.DSTSNPA
     15217**DCL     19382<<ASSIGN
FPT@CONNECT.DSTSNPA.ADR_STRING
     15217**DCL     15217--REDEF
FPT@CONNECT.LADR
     15183**DCL     19388<<ASSIGN
FPT@CONNECT.LADR.ADDRESS_N
     15213**DCL     15214--REDEF
FPT@CONNECT.LADR.LEN
     15185**DCL     19390<<ASSIGN  19390>>ASSIGN
FPT@CONNECT.RLCID.FEP_NODE
     15101**DCL     19378<<ASSIGN
FPT@CONNECT.RLCID.FLAGS.VIRCIR
     15102**DCL     19379<<ASSIGN
FPT@CONNECT.RLCID.GENERATION
     15100**DCL     15101--REDEF
FPT@CONNECT.RLCID.LDCTX
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:217  
     15101**DCL     15101--REDEF
FPT@CONNECT.RLCID.NODE
     15100**DCL     19377<<ASSIGN
FPT@CONNECT.SERVICE
     15103**DCL     19381<<ASSIGN
FPT@CONNECT.TERMINAL_ID
     15087**DCL     19380<<ASSIGN
FPT@CONNECT.TERMINAL_ID.TERM
     15089**DCL     15098--REDEF
FPT@CONNECT.TYPE
     15068**DCL     19386<<ASSIGN
FPT@CONNECT_ACK
     15235**DCL     19433--ASSIGN  19434--ASSIGN  19435--ASSIGN
FPT@CONNECT_ACK.REASON
     15239**DCL     18581<<ASSIGN  19419<<ASSIGN  19428<<ASSIGN
FPT@CONNECT_ACK.UID.UID
     15265**DCL     15265--REDEF   15265--REDEF
FPT@RESET
     15286**DCL     19218--ASSIGN  19219--ASSIGN  19220--ASSIGN
FPT@RESET.CAUSE
     15290**DCL     19221<<ASSIGN
FPT@RESET.DIAG
     15290**DCL     19222<<ASSIGN
FPT@TERM
     15020**DCL     19502<<ASSIGN  19506--ASSIGN  19508--ASSIGN  19509--ASSIGN
FPT@TERM.RLCID.LDCTX
     15025**DCL     19504<<ASSIGN
FPT@TERM.RLCID.NODE
     15024**DCL     19503<<ASSIGN
FPT@TERM_ACK
     15044**DCL     19623--ASSIGN  19624--ASSIGN  19625--ASSIGN
FPT@TERM_ACK.REASON
     15048**DCL     19621<<ASSIGN
FPT_CONNECT_C
     17601**DCL     19376>>ASSIGN
FPT_CONNECT_C.DEST.ADDRESS_N
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:218  
     17698**DCL     17699--REDEF
FPT_CONNECT_C.DSTSNPA.ADR_STRING
     17754**DCL     17754--REDEF
FPT_CONNECT_C.LADR.ADDRESS_N
     17750**DCL     17751--REDEF
FPT_CONNECT_C.RLCID.GENERATION
     17637**DCL     17638--REDEF
FPT_CONNECT_C.RLCID.LDCTX
     17638**DCL     17638--REDEF
FPT_CONNECT_C.TERMINAL_ID.TERM
     17626**DCL     17635--REDEF
FPT_TERM_C
     17578**DCL     19502>>ASSIGN
FPT_X25
     14839**DCL        30--PROC    18644>>ASSIGN
FPT_X25.CAL$
     14843**DCL     18514>>ASSIGN  18645>>IF
FPT_X25.EVN
     14843**DCL     18506>>IF      18524>>IF      18524>>IF      18524>>IF      18554>>IF      18597>>IF
     18657>>DOCASE  18837>>DOCASE
FPT_X25.PRM1
     14844**DCL     18565<<ASSIGN  18570>>ASSIGN  18859>>ASSIGN  18860>>ASSIGN  19221>>ASSIGN
FPT_X25.PRM1$
     14844**DCL     14845--REDEF   18515>>ASSIGN
FPT_X25.PRM2
     14844**DCL     19222>>ASSIGN
FPT_X25.PRM2$
     14846**DCL     14846--REDEF
FPT_X25.RCV$
     14843**DCL     18509>>ASSIGN  18510<<ASSIGN  18513>>ASSIGN  18537<<ASSIGN
FPT_X25.RET_BIT1
     14851**DCL     19131<<ASSIGN
FPT_X25.V_
     14847**DCL     18688<<ASSIGN  18715<<ASSIGN  18741>>IF      18748>>ASSIGN  18760>>IF      18767>>ASSIGN
     19185>>ASSIGN  19294>>ASSIGN  19617>>ASSIGN
FPT_X25.V_.ADR$
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:219  
     14847**DCL     16880--IMP-PTR 18516>>ASSIGN  18560>>ASSIGN  18862>>IF      19021<<ASSIGN  19041<<ASSIGN
     19160>>ASSIGN  19161>>IF      19170>>ASSIGN  19170>>ASSIGN  19238>>ASSIGN  20531>>ASSIGN
FPT_X25.V_.BYTSIZ
     14848**DCL     18558>>IF      18571>>IF      18576>>ASSIGN  18870>>ASSIGN  18874>>ASSIGN  18909>>IF
     18914>>ASSIGN  18922>>IF      18927>>ASSIGN  18941>>IF      18945>>ASSIGN  19023<<ASSIGN  19043<<ASSIGN
     19065<<ASSIGN  19065>>ASSIGN  19072>>ASSIGN  19083>>ASSIGN  19103>>IF      19112>>ASSIGN  19118>>IF
     19124>>ASSIGN  19124>>ASSIGN  19126>>ASSIGN  19140>>IF      19166>>DOWHILE 19171>>IF      19171>>IF
     19179>>ASSIGN  19193>>IF      19237>>ASSIGN  19239>>ASSIGN  20526>>ASSIGN  20531>>ASSIGN  20531>>ASSIGN
FPT_X25.V_.BYTX
     14848**DCL     18560>>ASSIGN  19022<<ASSIGN  19042<<ASSIGN  19165>>ASSIGN  19166>>DOWHILE 19193>>IF
     19240>>ASSIGN  20531>>ASSIGN
G$JIT.ERRLOG
     15876**DCL     15879--REDEF
G$JIT.JSUNIT
     15615**DCL     15616--REDEF
G$JIT.MCLS
     15614**DCL     15614--REDEF
G$JIT.TMRZ
     15883**DCL     15884--REDEF
G$JIT.USER_EXTIME
     15607**DCL     15608--REDEF
G$JIT.USER_MEMTIME
     15610**DCL     15610--REDEF
G$JIT.USER_SVTIME
     15609**DCL     15609--REDEF
G$JIT$
     17805**DCL     15546--IMP-PTR
I IN PROCEDURE Y$GETL3
     20463**DCL     20482<<DOINDEX 20484>>DOWHILE 20492>>ASSIGN  20493<<ASSIGN
INPDAT_ARY
     16880**DCL     18560>>ASSIGN  19170>>ASSIGN  19170>>ASSIGN
INP_LOP
     19166**LABEL   19175--EXIT
KH$CHN
     15961**DCL     20466--CALL    20474<<ASSIGN  20474>>ASSIGN
KH$CHN.CTX$
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:220  
     16031**DCL     20475<<ASSIGN
KH$CHN.SUB$
     16068**DCL     20476<<ASSIGN
KH$CHN.TERMID
     16055**DCL     19380>>ASSIGN  19682<>CALL
KH$CHN.TERMID.LEV
     16057**DCL     18866>>IF      20477<<ASSIGN  20484>>DOWHILE
KH$CHN.TERMID.TERM
     16057**DCL     16066--REDEF
KH$CHN.TERMID.TERM.SUBDEVICE
     16063**DCL     20484>>DOWHILE 20492<<ASSIGN
KH$CHN.TERMID.TTYP
     16057**DCL     20478<<ASSIGN
KHD$SCREECH
     14739**DCL-ENT 18531--CALL    19318--CALL    19358--CALL    19474--CALL    19549--CALL    19658--CALL
KH_NODE#
     17797**DCL     18553>>ASSIGN
KNH$MESS.FUNCTION
     16978**DCL     16978--REDEF
KNH$MESS.UID
     17008**DCL     17008--REDEF   17008--REDEF
KNH_MESS
     14924**DCL     18503<<ASSIGN  18504--ASSIGN  18505--ASSIGN
KNH_MESS.FPTSZ
     14957**DCL     19218<<ASSIGN  19393<<ASSIGN  19433<<ASSIGN  19506<<ASSIGN  19623<<ASSIGN
KNH_MESS.FUNCTION
     14924**DCL     14924--REDEF   18985<<ASSIGN  18994<<ASSIGN  19157<<ASSIGN  19217<<ASSIGN  19236<<ASSIGN
     19249<<ASSIGN  19256<<ASSIGN  19392<<ASSIGN  19432<<ASSIGN  19505<<ASSIGN  19622<<ASSIGN
KNH_MESS.LDCTX
     14929**DCL     18593<<ASSIGN  18605<<ASSIGN  18860<<ASSIGN  18967<<ASSIGN  19395<<ASSIGN
KNH_MESS.MSGSZ
     14958**DCL     19170<<ASSIGN  19171>>IF      19171>>IF      19179<<ASSIGN  19180>>ASSIGN  19191>>ASSIGN
     19237<<ASSIGN  19394<<ASSIGN  19420<<ASSIGN  19429<<ASSIGN  19436>>ASSIGN  19507<<ASSIGN  19511>>ASSIGN
KNH_MESS.UID
     14954**DCL     14954--REDEF   14954--REDEF
KNH_MESS.UID$
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:221  
     14954**DCL     18594<<ASSIGN  18606<<ASSIGN  18968<<ASSIGN
KNH_MESS.UIDX.CQ_HNDID
     14955**DCL     18595<<ASSIGN  18607<<ASSIGN  18969<<ASSIGN
KV@SNDCQ
     15295**DCL     18502<<ASSIGN  18986<>CALL    18995<>CALL    19182<>CALL    19260<>CALL    19401<>CALL
     19437<>CALL    19512<>CALL    19626<>CALL
KV@SNDCQ.MSG_.ADR$
     15297**DCL     18504<<ASSIGN  19160<<ASSIGN  19219<<ASSIGN  19238<<ASSIGN  19397<<ASSIGN  19399<<ASSIGN
     19421<<ASSIGN  19430<<ASSIGN  19434<<ASSIGN  19508<<ASSIGN  19510<<ASSIGN  19624<<ASSIGN
KV@SNDCQ.MSG_.BYTSIZ
     15299**DCL     18505<<ASSIGN  19180<<ASSIGN  19220<<ASSIGN  19239<<ASSIGN  19398<<ASSIGN  19400<<ASSIGN
     19435<<ASSIGN  19436<<ASSIGN  19509<<ASSIGN  19511<<ASSIGN  19625<<ASSIGN
KV@SNDCQ.MSG_.BYTX
     15298**DCL     19181<<ASSIGN  19240<<ASSIGN
KVB$GETSYS
     14735**DCL-ENT 18532--CALL    19353--CALL    20466--CALL    20527--CALL
KVB$RLSSYS
     14737**DCL-ENT 19489--CALL    19492--CALL    19495--CALL    19558--CALL    19561--CALL    19564--CALL
     19567--CALL    19571--CALL    20468--CALL
KVBSIZ
     14866**DCL     19327<<ASSIGN  19328>>ASSIGN  19330>>ASSIGN  19352<<ASSIGN  19353<>CALL    20526<<ASSIGN
     20527<>CALL
KVM$SNDCQ
     14738**DCL-ENT 18986--CALL    18995--CALL    19182--CALL    19260--CALL    19401--CALL    19437--CALL
     19512--CALL    19626--CALL
KX$L2.DFLVCPRF.TRADEL
     16670**DCL     16680--REDEF
KX$L2.DSTSNPA.ADR_STRING
     16861**DCL     16861--REDEF
KX$L2.FLG.DATAVL
     16576**DCL     19086>>IF
KX$L2.FRMR_NSNR
     16647**DCL     16648--REDEF
KX$L2.NTWADR.ADR_STRING
     16581**DCL     16581--REDEF
KX$L2.STATES
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:222  
     16559**DCL     16559--REDEF
KX$L2.CHN$ IN PROCEDURE Y$GETL3
     19729**DCL     20474>>ASSIGN
KX$L2.DFLVCPRF.TRADEL IN PROCEDURE Y$GETL3
     19850**DCL     19860--REDEF
KX$L2.DSTSNPA.ADR_STRING IN PROCEDURE Y$GETL3
     20041**DCL     20041--REDEF
KX$L2.FRMR_NSNR IN PROCEDURE Y$GETL3
     19827**DCL     19828--REDEF
KX$L2.L3_HEAD$ IN PROCEDURE Y$GETL3
     19759**DCL     20483>>ASSIGN
KX$L2.NTWADR.ADR_STRING IN PROCEDURE Y$GETL3
     19761**DCL     19761--REDEF
KX$L2.STATES IN PROCEDURE Y$GETL3
     19739**DCL     19739--REDEF
KX$L3
     16129**DCL     20468--CALL
KX$L3.CALL_OPTS
     16164**DCL     20515>>ASSIGN  20516>>ASSIGN
KX$L3.CALL_OPTS.RCVADR
     16168**DCL     19382>>ASSIGN  20503<<ASSIGN  20510<<ASSIGN
KX$L3.CALL_OPTS.RCVADR.ADR_STRING
     16169**DCL     16169--REDEF
KX$L3.CALL_OPTS.RCVPCKSIZ
     16166**DCL     19171>>IF
KX$L3.CALL_OPTS.SNDPCKSIZ
     16167**DCL     19351>>ASSIGN
KX$L3.CHN$
     16130**DCL     18866>>IF      19380>>ASSIGN  19682>>CALL    20466<>CALL    20474>>ASSIGN  20475>>ASSIGN
     20476>>ASSIGN  20477>>ASSIGN  20478>>ASSIGN  20492>>ASSIGN
KX$L3.CM$
     16129**DCL     18552<<ASSIGN  19570<<ASSIGN  20496<<ASSIGN
KX$L3.CM_OPTS
     16199**DCL     20516<<ASSIGN
KX$L3.CM_OPTS.RCVADR.ADR_STRING
     16204**DCL     16204--REDEF
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:223  
KX$L3.CUG
     16247**DCL     16248--REDEF
KX$L3.DFL_OPTS
     16234**DCL     20515<<ASSIGN
KX$L3.DFL_OPTS.RCVADR.ADR_STRING
     16239**DCL     16239--REDEF
KX$L3.L2$
     16129**DCL     19086>>IF
KX$L3.LCLADR.ADR_STRING
     16364**DCL     16364--REDEF
KX$L3.LCLNSAP
     16381**DCL     16437--REDEF   19387>>ASSIGN  20501<<ASSIGN  20508<<ASSIGN
KX$L3.LCLNSAP.NSAP.ADDRESS_N
     16432**DCL     16433--REDEF
KX$L3.LCLNSAP.NSAP.LEN
     16404**DCL     19383>>IF      20512<<ASSIGN  20512>>ASSIGN
KX$L3.LCN#
     16246**DCL     16247--REDEF
KX$L3.NOD
     16134**DCL     18560<<ASSIGN  18563>>ASSIGN
KX$L3.QOS
     16135**DCL     19381>>ASSIGN
KX$L3.RLSCHN
     16243**DCL     20473<<ASSIGN
KX$L3.RMTNSAP
     16454**DCL     16510--REDEF   19388>>ASSIGN  20502<<ASSIGN  20509<<ASSIGN
KX$L3.RMTNSAP.NSAP.ADDRESS_N
     16505**DCL     16506--REDEF
KX$L3.RMTNSAP.NSAP.LEN
     16477**DCL     20513<<ASSIGN  20513>>ASSIGN
KX$L3.STATE.CURRENT
     16253**DCL     20519<<ASSIGN
KX$L3.STATES
     16252**DCL     16252--REDEF
KX$L3.TRNDLY
     16248**DCL     16249--REDEF
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:224  
KX$L3.TRNDLYIND
     16249**DCL     16250--REDEF
KX$L3.TYP
     16135**DCL     18557<<ASSIGN  19588>>IF      20472<<ASSIGN
KX$SL
     16088**DCL     18532--CALL    18538<<ASSIGN  19571--CALL
KX$SL.BCKLOG
     16104**DCL     18982>>IF      18991>>IF      19072<<ASSIGN  19072>>ASSIGN  19083<<ASSIGN  19127<<ASSIGN
KX$SL.CALRSPDAT$
     16106**DCL     18875<<ASSIGN  18913<<ASSIGN  19421>>ASSIGN  19490>>IF      19492<>CALL    19497<<ASSIGN
     19562>>IF      19564<>CALL
KX$SL.CALRSPDATBYTSIZ
     16106**DCL     18874<<ASSIGN  18914<<ASSIGN  19420>>ASSIGN  19492>>CALL    19564>>CALL
KX$SL.CALUSRDAT$
     16105**DCL     18575<<ASSIGN  18869<<ASSIGN  18946<<ASSIGN  19399>>ASSIGN  19487>>IF      19489<>CALL
     19496<<ASSIGN  19559>>IF      19561<>CALL    19596>>ASSIGN
KX$SL.CALUSRDATBYTSIZ
     16105**DCL     18576<<ASSIGN  18870<<ASSIGN  18945<<ASSIGN  19394>>ASSIGN  19400>>ASSIGN  19489>>CALL
     19561>>CALL    19597>>ASSIGN
KX$SL.CLRDAT$
     16107**DCL     18926<<ASSIGN  19430>>ASSIGN  19493>>IF      19495<>CALL    19498<<ASSIGN  19510>>ASSIGN
     19565>>IF      19567<>CALL
KX$SL.CLRDATBYTSIZ
     16107**DCL     18927<<ASSIGN  19429>>ASSIGN  19495>>CALL    19507>>ASSIGN  19567>>CALL
KX$SL.CQMSG_
     16099**DCL     16100--REDEF   19365<<ASSIGN  19460<<ASSIGN  19486<<ASSIGN  19612<<ASSIGN
KX$SL.CQMSG_.ADR$
     16099**DCL     19021>>ASSIGN  19111<<ASSIGN
KX$SL.CQMSG_.BYTSIZ
     16100**DCL     18970>>IF      19008>>IF      19014>>IF      19023>>ASSIGN  19028<<ASSIGN  19098<<ASSIGN
     19112<<ASSIGN
KX$SL.CQMSG_STAGE
     16103**DCL     16104--REDEF   19017<<ASSIGN  19017>>ASSIGN  19018>>IF      19029<<ASSIGN  19094>>IF
     19097<<ASSIGN  19364<<ASSIGN  19459<<ASSIGN  19485<<ASSIGN  19611<<ASSIGN
KX$SL.HIST.ACT
     16097**DCL     19333<<ASSIGN
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:225  
KX$SL.HIST.EVT
     16097**DCL     19332<<ASSIGN
KX$SL.HIST.STT
     16096**DCL     19331<<ASSIGN
KX$SL.HIST.X
     16096**DCL     19331>>ASSIGN  19332>>ASSIGN  19333>>ASSIGN  19334<<ASSIGN  19334>>ASSIGN
KX$SL.INPDAT_
     16098**DCL     18681>>IF      18688>>ASSIGN  18701<<ASSIGN  18741>>IF      18744<<ASSIGN  18748<<ASSIGN
     19185<<ASSIGN  19204<<ASSIGN
KX$SL.INPDAT_.ADR$
     16098**DCL     18751>>IF      19161>>IF
KX$SL.INPDAT_.BYTX
     16098**DCL     19163>>ASSIGN  19188<<ASSIGN
KX$SL.INPDAT_ALTRET
     16092**DCL     18693>>IF      18696<<ASSIGN  18754<<ASSIGN
KX$SL.INPDAT_STAGE
     16103**DCL     18684<<ASSIGN  18684>>ASSIGN  18685>>IF      18702<<ASSIGN  18745<<ASSIGN  18749<<ASSIGN
     18751>>IF
KX$SL.L3$
     16088**DCL     18519>>ASSIGN  18564<<ASSIGN  18629>>ASSIGN  18645>>IF      18654>>ASSIGN  18814<<ASSIGN
     18817>>IF      18866>>IF      18964>>ASSIGN  19311<<ASSIGN  19368>>ASSIGN  19380>>ASSIGN  19381>>ASSIGN
     19382>>ASSIGN  19383>>IF      19387>>ASSIGN  19388>>ASSIGN  19568>>IF      19570>>ASSIGN  19613>>IF
     19682>>CALL    20501>>ASSIGN  20502>>ASSIGN  20503>>ASSIGN  20507<<ASSIGN
KX$SL.L3_RSTPND
     16093**DCL     18784>>IF      18787<<ASSIGN  18791<<ASSIGN
KX$SL.LCLNOD
     16090**DCL     18553<<ASSIGN  19378>>ASSIGN
KX$SL.LDCTX
     16095**DCL     18570<<ASSIGN  18593>>ASSIGN  18605>>ASSIGN  18859<<ASSIGN  18967>>ASSIGN  19396<<ASSIGN
     19504>>ASSIGN
KX$SL.LNK$
     16088**DCL     18545<<ASSIGN  18546<<ASSIGN  18620>>ASSIGN  18632>>ASSIGN  19000>>ASSIGN  19530>>ASSIGN
     19531>>IF      19538>>ASSIGN  19541>>ASSIGN  19551<<ASSIGN  19551>>ASSIGN  19552>>IF
KX$SL.NTWBLK
     16091**DCL     18982>>IF      18988<<ASSIGN  18991>>IF      18997<<ASSIGN
KX$SL.OTPBFR$
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:226  
     16089**DCL     16089--REDEF   19041>>ASSIGN  19124>>ASSIGN  19348>>IF      19360<<ASSIGN  19556>>IF
     19558<>CALL
KX$SL.OTPBFRBYTSIZ
     16101**DCL     18982>>IF      18991>>IF      19103>>IF      19118>>IF      19351<<ASSIGN  19352>>ASSIGN
     19558>>CALL
KX$SL.OTPBFRBYTX
     16102**DCL     18970>>IF      19008>>IF      19034>>IF      19043>>ASSIGN  19048<<ASSIGN  19106>>IF
     19118>>IF      19124>>ASSIGN  19126<<ASSIGN  19126>>ASSIGN  19362<<ASSIGN  19457<<ASSIGN  19483<<ASSIGN
     19609<<ASSIGN
KX$SL.OTPBFR_STAGE
     16102**DCL     16103--REDEF   19037<<ASSIGN  19037>>ASSIGN  19038>>IF      19049<<ASSIGN  19118>>IF
     19363<<ASSIGN  19458<<ASSIGN  19484<<ASSIGN  19610<<ASSIGN
KX$SL.PRTID
     16090**DCL     19591--ASSIGN
KX$SL.REDIRECT
     16095**DCL     18608>>IF      18611>>IF      18614>>IF      18617>>IF      18637>>IF      18898<<ASSIGN
KX$SL.RMTNOD
     16090**DCL     18563<<ASSIGN  18941>>IF      19057>>IF      19103>>IF      19140>>IF      19167>>IF
     19186>>IF      19213>>IF      19233>>IF      19345>>IF      19377>>ASSIGN  19503>>ASSIGN  19588>>IF
KX$SL.RPRDAT
     16091**DCL     18849<<ASSIGN  18929<<ASSIGN  18970>>IF      18974<<ASSIGN  19011<<ASSIGN  19030<<ASSIGN
     19050<<ASSIGN  19084>>IF      19088<<ASSIGN  19344<<ASSIGN  19422<<ASSIGN  19645<<ASSIGN  19647>>IF
KX$SL.SCN_INPDAT_
     16100**DCL     18708>>IF      18715>>ASSIGN  18728<<ASSIGN  18760>>IF      18763<<ASSIGN  18767<<ASSIGN
KX$SL.SCN_INPDAT_.ADR$
     16101**DCL     18770>>IF
KX$SL.SCN_INPDAT_ALTRET
     16093**DCL     18720>>IF      18723<<ASSIGN  18773<<ASSIGN
KX$SL.SCN_INPDAT_STAGE
     16104**DCL     18711<<ASSIGN  18711>>ASSIGN  18712>>IF      18729<<ASSIGN  18764<<ASSIGN  18768<<ASSIGN
     18770>>IF
KX$SL.SCN_L3$
     16089**DCL     18649>>ASSIGN  18816<<ASSIGN  18817>>IF      20500<<ASSIGN
KX$SL.SCN_L3_RSTPND
     16094**DCL     18795>>IF      18798<<ASSIGN  18802<<ASSIGN
KX$SL.SNDDAT_ALTRET
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:227  
     16091**DCL     18625>>IF      19161>>IF      19184<<ASSIGN  19203<<ASSIGN
KX$SL.SNDINTACK_ALTRET
     16093**DCL     16093--REDEF   18614>>IF      19442<<ASSIGN  19450<<ASSIGN
KX$SL.SNDINTNAK_ALTRET
     16094**DCL     16094--REDEF   18617>>IF      19452<<ASSIGN
KX$SL.SNDINT_ALTRET
     16092**DCL     16092--REDEF   18608>>IF      19404<<ASSIGN  19408<<ASSIGN  19578>>IF
KX$SL.SNDTRMACK_ALTRET
     16094**DCL     19633<<ASSIGN
KX$SL.SNDTRM_ALTRET
     16092**DCL     16093--REDEF   18611>>IF      19515<<ASSIGN  19519<<ASSIGN
KX$SL.START_RCQ$
     16104**DCL     18845>>IF      18933>>IF      19067>>IF      19069>>IF      19076<<ASSIGN  19091<<ASSIGN
KX$SL.STATE
     16096**DCL     18625>>IF      18886<<ASSIGN  18951>>IF      18951>>IF      19077>>IF      19077>>IF
     19137>>IF      19213>>IF      19233>>IF      19257>>IF      19272>>IF      19281>>IF      19290>>IF
     19299>>IF      19326>>ASSIGN  19329<<ASSIGN
KX$TL3.CALL_OPTS.RCVADR IN PROCEDURE Y$GETL3
     20119**DCL     20503>>ASSIGN
KX$TL3.CALL_OPTS.RCVADR.ADR_STRING IN PROCEDURE Y$GETL3
     20120**DCL     20120--REDEF
KX$TL3.CHN$ IN PROCEDURE Y$GETL3
     20081**DCL     20484>>DOWHILE 20484>>DOWHILE
KX$TL3.CM_OPTS.RCVADR.ADR_STRING IN PROCEDURE Y$GETL3
     20155**DCL     20155--REDEF
KX$TL3.CUG IN PROCEDURE Y$GETL3
     20198**DCL     20199--REDEF
KX$TL3.DFL_OPTS.RCVADR.ADR_STRING IN PROCEDURE Y$GETL3
     20190**DCL     20190--REDEF
KX$TL3.LCLADR.ADR_STRING IN PROCEDURE Y$GETL3
     20315**DCL     20315--REDEF
KX$TL3.LCLNSAP IN PROCEDURE Y$GETL3
     20332**DCL     20388--REDEF   20501>>ASSIGN
KX$TL3.LCLNSAP.NSAP.ADDRESS_N IN PROCEDURE Y$GETL3
     20383**DCL     20384--REDEF
KX$TL3.LCN# IN PROCEDURE Y$GETL3
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:228  
     20197**DCL     20198--REDEF
KX$TL3.NEXT$ IN PROCEDURE Y$GETL3
     20080**DCL     20487>>ASSIGN
KX$TL3.RMTNSAP IN PROCEDURE Y$GETL3
     20405**DCL     20461--REDEF   20502>>ASSIGN
KX$TL3.RMTNSAP.NSAP.ADDRESS_N IN PROCEDURE Y$GETL3
     20456**DCL     20457--REDEF
KX$TL3.STATES IN PROCEDURE Y$GETL3
     20203**DCL     20203--REDEF
KX$TL3.TRNDLY IN PROCEDURE Y$GETL3
     20199**DCL     20200--REDEF
KX$TL3.TRNDLYIND IN PROCEDURE Y$GETL3
     20200**DCL     20201--REDEF
KXP$PACKET
     14741**DCL-ENT 19646--CALL    19656--CALL
KXS$GETL3
     14742**DCL-ENT 20465--CALL
KXS$SYSLOG
     14733**DCL-ENT 19682--CALL
KXV$VCNTW
        30**PROC    17776--DCLINIT
KX_BUF.SIZ
     17822**DCL     19171>>IF      19351>>ASSIGN
KX_SL
     17776**DCL     18538>>ASSIGN
KX_SL.CQMSG_
     17787**DCL     17788--REDEF
KX_SL.CQMSG_STAGE
     17791**DCL     17792--REDEF
KX_SL.OTPBFR$
     17777**DCL     17777--REDEF
KX_SL.OTPBFR_STAGE
     17790**DCL     17791--REDEF
KX_SL.SNDINTACK_ALTRET
     17781**DCL     17781--REDEF
KX_SL.SNDINTNAK_ALTRET
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:229  
     17782**DCL     17782--REDEF
KX_SL.SNDINT_ALTRET
     17780**DCL     17780--REDEF
KX_SL.SNDTRM_ALTRET
     17780**DCL     17781--REDEF
KX_SLLIST.HD$
     17819**DCL     18541>>IF      18543<<ASSIGN  18622>>ASSIGN  19526>>ASSIGN  19530<<ASSIGN
KX_SLLIST.TL$
     17820**DCL     18545>>ASSIGN  18547<<ASSIGN  19533<<ASSIGN  19554<<ASSIGN
KX_STATS_HDLC.REQSTATS.DSPMSK
     18093**DCL     18099--REDEF
KX_STATS_HDLC.REQSTATS.SLCMSK
     18134**DCL     18141--REDEF
KX_STATS_X25.REQSTATS.DSPMSK
     18418**DCL     18424--REDEF
KX_STATS_X25.REQSTATS.SLCMSK
     18459**DCL     18466--REDEF
L2$ IN PROCEDURE Y$GETL3
     19690**DCL     19688--PROC    20465<>CALL    20474>>ASSIGN  20483>>ASSIGN
L3$
     14858**DCL     16129--IMP-PTR 18514<<ASSIGN  18517>>IF      18519<<ASSIGN  18524>>IF      18549>>IF
     18552>>ASSIGN  18557>>ASSIGN  18560>>ASSIGN  18563>>ASSIGN  18564>>ASSIGN  18589>>ASSIGN  18899>>ASSIGN
     18964<<ASSIGN  18966>>ASSIGN  19086>>IF      19171>>IF      19351>>ASSIGN  19588>>IF      20465<>CALL
     20466>>CALL    20468<>CALL    20472>>ASSIGN  20473>>ASSIGN  20474>>ASSIGN  20475>>ASSIGN  20475>>ASSIGN
     20476>>ASSIGN  20477>>ASSIGN  20478>>ASSIGN  20484>>DOWHILE 20489>>IF      20492>>ASSIGN  20496>>ASSIGN
     20500>>ASSIGN  20501>>ASSIGN  20502>>ASSIGN  20503>>ASSIGN  20507>>ASSIGN  20508>>ASSIGN  20509>>ASSIGN
     20510>>ASSIGN  20512>>ASSIGN  20512>>ASSIGN  20513>>ASSIGN  20513>>ASSIGN  20515>>ASSIGN  20515>>ASSIGN
     20516>>ASSIGN  20516>>ASSIGN  20519>>ASSIGN
L_ALTRET
     19091**LABEL   19109--CALLALT 19113--CALLALT 19122--CALLALT
L_ALTRET IN PROCEDURE Y$GETL3
     20470**LABEL   20465--CALLALT
L_SCR
     19474**LABEL   18825--GOTO    19638--GOTO
MSG$
     14859**DCL     18516<<ASSIGN  19057>>IF      19064<<ASSIGN  19064>>ASSIGN  19069>>IF      19091>>ASSIGN
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:230  
     19111>>ASSIGN  19124>>ASSIGN
OUTLINK$
     15300**DCL     18509<<ASSIGN  18579<>CALL
PRVCTX$
     15294**DCL     19537<<ASSIGN  19540<<ASSIGN  19551>>ASSIGN  19554>>ASSIGN
REDIR IN PROCEDURE Y$GETL3
     19691**DCL     19688--PROC    20497>>IF
RLS_SL
     19526**LABEL   18819--GOTO    19444--GOTO    19580--GOTO    19629--GOTO
SCR_NOMEM
     19358**LABEL   18532--CALLALT 18574--CALLALT 18865--CALLALT 18912--CALLALT 18925--CALLALT
SL$
     14857**DCL     16088--IMP-PTR 18513<<ASSIGN  18517>>IF      18519>>ASSIGN  18521>>IF      18536<<ASSIGN
     18537>>ASSIGN  18538>>ASSIGN  18543>>ASSIGN  18545>>ASSIGN  18546>>ASSIGN  18547>>ASSIGN  18552>>ASSIGN
     18553>>ASSIGN  18563>>ASSIGN  18564>>ASSIGN  18570>>ASSIGN  18575>>ASSIGN  18576>>ASSIGN  18588>>ASSIGN
     18593>>ASSIGN  18594>>ASSIGN  18604>>DOWHILE 18605>>ASSIGN  18606>>ASSIGN  18608>>IF      18608>>IF
     18611>>IF      18611>>IF      18614>>IF      18614>>IF      18617>>IF      18617>>IF      18620<<ASSIGN
     18620>>ASSIGN  18622<<ASSIGN  18624>>DOWHILE 18625>>IF      18625>>IF      18628>>ASSIGN  18629>>ASSIGN
     18632<<ASSIGN  18632>>ASSIGN  18637>>IF      18645>>IF      18649>>ASSIGN  18654>>ASSIGN  18656>>ASSIGN
     18681>>IF      18684>>ASSIGN  18684>>ASSIGN  18685>>IF      18688>>ASSIGN  18693>>IF      18696>>ASSIGN
     18701>>ASSIGN  18702>>ASSIGN  18708>>IF      18711>>ASSIGN  18711>>ASSIGN  18712>>IF      18715>>ASSIGN
     18720>>IF      18723>>ASSIGN  18728>>ASSIGN  18729>>ASSIGN  18741>>IF      18744>>ASSIGN  18745>>ASSIGN
     18748>>ASSIGN  18749>>ASSIGN  18751>>IF      18751>>IF      18754>>ASSIGN  18760>>IF      18763>>ASSIGN
     18764>>ASSIGN  18767>>ASSIGN  18768>>ASSIGN  18770>>IF      18770>>IF      18773>>ASSIGN  18784>>IF
     18787>>ASSIGN  18791>>ASSIGN  18795>>IF      18798>>ASSIGN  18802>>ASSIGN  18814>>ASSIGN  18816>>ASSIGN
     18817>>IF      18817>>IF      18845>>IF      18849>>ASSIGN  18859>>ASSIGN  18866>>IF      18869>>ASSIGN
     18870>>ASSIGN  18874>>ASSIGN  18875>>ASSIGN  18886>>ASSIGN  18898>>ASSIGN  18913>>ASSIGN  18914>>ASSIGN
     18926>>ASSIGN  18927>>ASSIGN  18929>>ASSIGN  18933>>IF      18941>>IF      18945>>ASSIGN  18946>>ASSIGN
     18951>>IF      18951>>IF      18963>>DOWHILE 18964>>ASSIGN  18965>>ASSIGN  18967>>ASSIGN  18968>>ASSIGN
     18970>>IF      18970>>IF      18970>>IF      18974>>ASSIGN  18982>>IF      18982>>IF      18982>>IF
     18988>>ASSIGN  18991>>IF      18991>>IF      18991>>IF      18997>>ASSIGN  19000<<ASSIGN  19000>>ASSIGN
     19008>>IF      19008>>IF      19011>>ASSIGN  19014>>IF      19017>>ASSIGN  19017>>ASSIGN  19018>>IF
     19021>>ASSIGN  19023>>ASSIGN  19028>>ASSIGN  19029>>ASSIGN  19030>>ASSIGN  19034>>IF      19037>>ASSIGN
     19037>>ASSIGN  19038>>IF      19041>>ASSIGN  19043>>ASSIGN  19048>>ASSIGN  19049>>ASSIGN  19050>>ASSIGN
     19057>>IF      19067>>IF      19069>>IF      19072>>ASSIGN  19072>>ASSIGN  19076>>ASSIGN  19077>>IF
     19077>>IF      19083>>ASSIGN  19084>>IF      19088>>ASSIGN  19091>>ASSIGN  19094>>IF      19097>>ASSIGN
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:231  
     19098>>ASSIGN  19103>>IF      19103>>IF      19106>>IF      19111>>ASSIGN  19112>>ASSIGN  19118>>IF
     19118>>IF      19118>>IF      19124>>ASSIGN  19124>>ASSIGN  19126>>ASSIGN  19126>>ASSIGN  19127>>ASSIGN
     19137>>IF      19140>>IF      19161>>IF      19161>>IF      19163>>ASSIGN  19167>>IF      19184>>ASSIGN
     19185>>ASSIGN  19186>>IF      19188>>ASSIGN  19203>>ASSIGN  19204>>ASSIGN  19213>>IF      19213>>IF
     19233>>IF      19233>>IF      19257>>IF      19272>>IF      19281>>IF      19290>>IF      19299>>IF
     19309>>IF      19311>>ASSIGN  19326>>ASSIGN  19329>>ASSIGN  19331>>ASSIGN  19331>>ASSIGN  19332>>ASSIGN
     19332>>ASSIGN  19333>>ASSIGN  19333>>ASSIGN  19334>>ASSIGN  19334>>ASSIGN  19344>>ASSIGN  19345>>IF
     19348>>IF      19351>>ASSIGN  19352>>ASSIGN  19360>>ASSIGN  19362>>ASSIGN  19363>>ASSIGN  19364>>ASSIGN
     19365>>ASSIGN  19367>>ASSIGN  19368>>ASSIGN  19377>>ASSIGN  19378>>ASSIGN  19380>>ASSIGN  19381>>ASSIGN
     19382>>ASSIGN  19383>>IF      19387>>ASSIGN  19388>>ASSIGN  19394>>ASSIGN  19396>>ASSIGN  19399>>ASSIGN
     19400>>ASSIGN  19404>>ASSIGN  19408>>ASSIGN  19420>>ASSIGN  19421>>ASSIGN  19422>>ASSIGN  19429>>ASSIGN
     19430>>ASSIGN  19442>>ASSIGN  19450>>ASSIGN  19452>>ASSIGN  19457>>ASSIGN  19458>>ASSIGN  19459>>ASSIGN
     19460>>ASSIGN  19483>>ASSIGN  19484>>ASSIGN  19485>>ASSIGN  19486>>ASSIGN  19487>>IF      19489>>CALL
     19489>>CALL    19490>>IF      19492>>CALL    19492>>CALL    19493>>IF      19495>>CALL    19495>>CALL
     19496>>ASSIGN  19497>>ASSIGN  19498>>ASSIGN  19503>>ASSIGN  19504>>ASSIGN  19507>>ASSIGN  19510>>ASSIGN
     19515>>ASSIGN  19519>>ASSIGN  19527>>IF      19530>>ASSIGN  19531>>IF      19539>>DOWHILE 19551>>ASSIGN
     19552>>IF      19556>>IF      19558>>CALL    19558>>CALL    19559>>IF      19561>>CALL    19561>>CALL
     19562>>IF      19564>>CALL    19564>>CALL    19565>>IF      19567>>CALL    19567>>CALL    19568>>IF
     19570>>ASSIGN  19571<>CALL    19578>>IF      19588>>IF      19591>>ASSIGN  19596>>ASSIGN  19597>>ASSIGN
     19609>>ASSIGN  19610>>ASSIGN  19611>>ASSIGN  19612>>ASSIGN  19613>>IF      19633>>ASSIGN  19645>>ASSIGN
     19647>>IF      19682>>CALL    20496>>ASSIGN  20500>>ASSIGN  20501>>ASSIGN  20502>>ASSIGN  20503>>ASSIGN
     20507>>ASSIGN
SNDCQ1
     19257**LABEL   19250--GOTO
SNDCQ2
     19260**LABEL   19223--GOTO    19241--GOTO
SND_INIT
     19376**LABEL   18610--GOTO
SND_INITACK
     19419**LABEL   18616--GOTO
SND_INITNAK
     19428**LABEL   18619--GOTO
SND_INITRSP
     19432**LABEL   18582--GOTO    19423--GOTO
SND_TERM
     19502**LABEL   18613--GOTO
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:232  
STATE
     14863**DCL     19326<<ASSIGN  19327>>ASSIGN  19328<<ASSIGN  19329>>ASSIGN  19331>>ASSIGN
STATE_TABLE.ACTION
     17097**DCL     19330>>ASSIGN
STATE_TABLE.NEXT_STATE
     17028**DCL     19328>>ASSIGN
TL3$ IN PROCEDURE Y$GETL3
     20059**DCL     20080--IMP-PTR 20483<<ASSIGN  20484>>DOWHILE 20484>>DOWHILE 20484>>DOWHILE 20487<<ASSIGN
     20487>>ASSIGN  20489>>IF
Y$
     14864**DCL     18532<>CALL    18536>>ASSIGN  18575>>ASSIGN  18869>>ASSIGN  18875>>ASSIGN  18913>>ASSIGN
     18926>>ASSIGN  18946>>ASSIGN  19353<>CALL    19360>>ASSIGN  20527<>CALL    20531>>ASSIGN
Y$CAL_KXP
     19654**PROC    18630--CALL    18697--CALL    18724--CALL    18750--CALL    18769--CALL    18829--CALL
     18887--CALL    18976--CALL    19295--CALL    19369--CALL    19618--CALL
Y$COPY
     20524**PROC    18574--CALL    18865--CALL    18912--CALL    18925--CALL    18944--CALL
Y$ER
     19664**PROC    19145--CALL    19197--CALL
Y$GETL3
     19688**PROC    18579--CALL    18896--CALL
Y$RPRDAT
     19643**PROC    19109--CALL    19113--CALL    19122--CALL
Y_ACTSCR
     17401**DCL     19474<>CALL
Y_BADPRM
     17523**DCL     18531<>CALL
Y_BADSLLIST
     17462**DCL     19549<>CALL
Y_NO_MEM
     17279**DCL     19358<>CALL
Y_SHR_PKT
     17165**DCL     19144>>ASSIGN
Y_UNB_PKT
     17216**DCL     19196>>ASSIGN
Y_UNKEVT
PL6.E3A0      #001=KXV$VCNTW File=KXV$VCNTW.:E05TSI                              WED 07/30/97 02:28 Page:233  
     17340**DCL     19318<>CALL
