VERSION E05

PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:1    
        1        1        /*M* Mirrored Disk routines.                                       */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DFC=YES, DMC=YES, EDMC=YES                                    */
        8        8        /*P*
        9        9        NAME:           TDM$MIRROR
       10       10
       11       11        PURPOSE:        Module for Mirrored Disk routines.
       12       12
       13       13        REFERENCE:      AF1274C
       14       14                                                                           */
       15       15        /*D*
       16       16        NAME:           TDM$MIRROR
       17       17
       18       18        CALL            TDM$MIRROR
       19       19
       20       20        ENRIRONMENT:    Monitor, not privileged, not inhibited.
       21       21
       22       22        INPUT:          B$PS0$->FPT$MIRRORV
       23       23
       24       24        OUTPUT:         DCT.DP.MIRROR
       25       25                        MDCT.DP.MIRROR
       26       26
       27       27        DESCRIPTION:    The TDM$MIRROR routine is used to process the
       28       28                        M$MIRROR PMME.
       29       29                                                                           */
       30       30        TDM$MIRROR:     PROC ;
       31       31        /*
       32       32                        Includes
       33       33        */
       34       34        %INCLUDE                B$JIT_C ;
       35      348        %INCLUDE                HF_LOCK_C ;
       36      362        %INCLUDE                NI_DATA_C ;
       37      475        %INCLUDE                NI_DATA_R ;
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:2    
       38      912        %INCLUDE                NI_MACROS_C ;
       39     1179        %INCLUDE                SS_SCHED_C ;
       40     1412        %INCLUDE                TD$CP6V_C ;
       41     1448        %INCLUDE                TD_ERRORS_C ;
       42     1531        /*
       43     1532                        Entries
       44     1533        */
       45     1534    1   DCL 1 FMN$AVR           ENTRY(2) ;
       46     1535    1   DCL 1 FMN$MRRSWITCH     ENTRY(1) ;
       47     1536    1   DCL 1 NID$REQSCHEDL     ENTRY(1) ;
       48     1537    1   DCL 1 NID$SCANAQ        ENTRY(1) ;
       49     1538    1   DCL 1 SSR$REG           ENTRY(3) ALTRET ;
       50     1539    1   DCL 1 TDM$MIRFAIL       ENTRY(2) ;
       51     1540    1   DCL 1 TDM$MIRSCHED      ENTRY(3) ;
       52     1541    1   DCL 1 TDM$MIRSCHEDL     ENTRY(3) ;
       53     1542    1   DCL 1 UDB$PMMEXIT       ENTRY ;
       54     1543        /*
       55     1544                        Symrefs
       56     1545        */
       57     1546    1   DCL 1 B$JIT$            PTR SYMREF ;
       58     1547    1   DCL 1 B$PS0$            PTR SYMREF ;
       59     1548    1   DCL 1 NK_MXLOCAL        UBIN WORD SYMREF ;
       60     1549    1   DCL 1 S_CUN             UBIN WORD SYMREF ;
       61     1550        /*
       62     1551                        Auto
       63     1552        */
       64     1553    1   DCL 1 DCT$              PTR ALIGNED AUTO ;
       65     1554    1   DCL 1 DCTX              SBIN WORD ALIGNED AUTO ;
       66     1555    1   DCL 1 LOCK              BIT(1) ALIGNED AUTO ;
       67     1556    1   DCL 1 MDCT$             PTR ALIGNED AUTO ;
       68     1557    1   DCL 1 MDCTX             SBIN WORD ALIGNED AUTO ;
       69     1558    1   DCL 1 MLOCK             BIT(1) ALIGNED AUTO ;
       70     1559    1   DCL 1 MSQH$             PTR ALIGNED AUTO ;
       71     1560    1   DCL 1 MSTATE            SBIN WORD ALIGNED AUTO ;
       72     1561    1   DCL 1 REQ$              PTR ALIGNED AUTO ;
       73     1562    1   DCL 1 SQH$              PTR ALIGNED AUTO ;
       74     1563    1   DCL 1 STATE             SBIN WORD ALIGNED AUTO ;
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:3    
       75     1564        /*
       76     1565                        Based
       77     1566        */
       78     1567        %B$JIT0 ;
       79     1656        %U$JIT1X ;
       80     1659        %M$JIT2X ;
       81     1662        %F$JIT3 ;
       82     1667        %S$JIT4 ;
       83     1673        %A$JIT6X ;
       84     1676        %N$REQ                  ( NAME=REQ,     STCLASS="BASED(REQ$)" ) ;
       85     1734        %NI$DCT                 ( NAME=DCT,     STCLASS="BASED(DCT$)" ) ;
       86     1782        %NI$DCT                 ( NAME=MDCT,    STCLASS="BASED(MDCT$)" ) ;
       87     1830        %NI$SQH                 ( NAME=MSQH,    STCLASS="BASED(MSQH$)" ) ;
       88     1843        %FPT$MIRROR_V           ( FPTN=MIRROR,  BASED="BASED(B$PS0$)" ) ;
       89     1847        %NI$SQH                 ( NAME=SQH,     STCLASS="BASED(SQH$)" ) ;
       90     1860        /*
       91     1861                        Constants
       92     1862        */
       93     1863        %EQU  TDM#FCG1          = %SUBBIT ( %ASCBIT ( 'T' ), 3, 6 ) ;
       94     1864        %EQU  TDM#FCG2          = %SUBBIT ( %ASCBIT ( 'M' ), 3, 6 ) ;
       95     1865        %EQU  TDM#FCG           = %CONCAT ( TDM#FCG1,  TDM#FCG2  ) ;
       96     1866        %SUB  MODULE            = %TDM#FCG ;
       97     1867
       98     1868        %ERROR_WORD             ( N#=TDBADDISK,     C#=%E$TDBADDISK     ) ;
       99     1875        %ERROR_WORD             ( N#=TDBADFUNC,     C#=%E$TDBADFUNC     ) ;
      100     1882        %ERROR_WORD             ( N#=TDBADSTATE,    C#=%E$TDBADSTATE    ) ;
      101     1889        %ERROR_WORD             ( N#=TDMIRROR,      C#=%E$TDMIRROR      ) ;
      102     1896        %ERROR_WORD             ( N#=TDNOTFAIL,     C#=%E$TDNOTFAIL     ) ;
      103     1903        %ERROR_WORD             ( N#=TDNOTLOCKED,   C#=%E$TDNOTLOCKED   ) ;
      104     1910        %ERROR_WORD             ( N#=TDNOTLOCKER,   C#=%E$TDNOTLOCKER   ) ;
      105     1917        %ERROR_WORD             ( N#=TDNOTMIRROR,   C#=%E$TDNOTMIRROR   ) ;
      106     1924        %ERROR_WORD             ( N#=TDNOTOPER,     C#=%E$TDNOTOPER     ) ;
      107     1931        %ERROR_WORD             ( N#=TDNOTPRI,      C#=%E$TDNOTPRI      ) ;
      108     1938        %ERROR_WORD             ( N#=TDNOTUNLOCKED, C#=%E$TDNOTUNLOCKED ) ;
      109     1945
      110     1946        %SUB  TDM#BREAK         = " 1 /* TDM#BREAK    */" ;
      111     1947        %SUB  TDM#CHGSTATE      = " 2 /* TDM#CHGSTATE */" ;
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:4    
      112     1948        %SUB  TDM#LOCK          = " 3 /* TDM#LOCK     */" ;
      113     1949        %SUB  TDM#MAKE          = " 4 /* TDM#MAKE     */" ;
      114     1950        %SUB  TDM#SWITCH        = " 5 /* TDM#SWITCH   */" ;
      115     1951        %SUB  TDM#UNLOCK        = " 6 /* TDM#UNLOCK   */" ;
      116     1952
      117     1953        %EJECT ;
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:5    
      118     1954    1   LOCK  = '0'B ;
      119     1955    1   MLOCK = '0'B ;
      120     1956    1   MDCTX = 0 ;
      121     1957    1   MDCT$ = ADDR(NIL) ;
      122     1958    1   MSQH$ = ADDR(NIL) ;
      123     1959
      124     1960    1   DCTX = MIRROR.DCTX ;
      125     1961    1   CALL CHECK_DISK ( DCTX, DCT$ )                  ALTRET ( UNLOCK ) ;
      126     1962    1   SQH$ = DCT.SQH$ ;
      127     1963
      128     1964        %LOCK ( G#=SQH.GATE ) ;
      129     1967    1   LOCK = '1'B ;
      130     1968
      131     1969    2   DO CASE ( MIRROR.FUNCTION ) ;
      132     1970
      133     1971        %EJECT ;
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:6    
      134     1972    2   CASE ( TDM#BREAK    ) ;                         /*** BREAK      ***/
      135     1973
      136     1974
      137     1975    2       IF  DCT.DP.MIRROR.STATE = %NI_MIRROR_WAIT
      138     1976    3       THEN DO ;
      139     1977    3           CALL CHECK_NOMIRROR ( DCT )             ALTRET ( UNLOCK ) ;
      140     1978    3           CALL TDM$MIRSCHEDL ( DCT, %NI_MIRROR_NONE, MIRROR.UTS ) ;
      141     1979    3           LOCK = '0'B ;
      142     1980    3           CALL FMN$AVR ( DCT.DCTX, %NI_AVR_MIRROR ) ;
      143     1981    3           END ;
      144     1982    3       ELSE DO ;
      145     1983    3           CALL CHECK_MIRROR ( DCT )               ALTRET ( UNLOCK ) ;
      146     1984    3           MDCTX = DCT.DP.MIRROR.DCTX ;
      147     1985    3           MDCT$ = N$DCT$(MDCTX) ;
      148     1986    3           MSQH$ = MDCT.SQH$ ;
      149     1987    3           CALL CHECK_OPER ( DCT )                 ALTRET ( UNLOCK ) ;
      150     1988    3           IF  MSQH$ ~= SQH$
      151     1989    4           THEN DO ;
      152     1990                    %UNLOCK ( G#=SQH.GATE  ) ;
      153     1993    4               LOCK    = '0'B ;
      154     1994                    %LOCK   ( G#=MSQH.GATE ) ;
      155     1997    4               MLOCK   = '1'B ;
      156     1998    4               END ;
      157     1999    3           CALL TDM$MIRFAIL ( MDCT, MIRROR.UTS ) ;
      158     2000    3           LOCK  = '0'B ;
      159     2001    3           MLOCK = '0'B ;
      160     2002    3           END ;
      161     2003
      162     2004        %EJECT ;
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:7    
      163     2005    2   CASE ( TDM#CHGSTATE ) ;                         /*** CHGSTATE   ***/
      164     2006
      165     2007    2       CALL CHECK_MIRROR ( DCT )                   ALTRET ( UNLOCK ) ;
      166     2008    2       STATE = MIRROR.STATE ;
      167     2009    2       CALL CHECK_STATE ( STATE )                  ALTRET ( UNLOCK ) ;
      168     2010    2       CALL TDM$MIRSCHEDL ( DCT, STATE, MIRROR.UTS ) ;
      169     2011    2       LOCK = '0'B ;
      170     2012
      171     2013        %EJECT ;
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:8    
      172     2014    2   CASE ( TDM#LOCK     ) ;                         /*** LOCK       ***/
      173     2015
      174     2016    2       CALL CHECK_MIRROR ( DCT )                   ALTRET ( UNLOCK ) ;
      175     2017    2       CALL CHECK_UNLOCK ( DCT )                   ALTRET ( UNLOCK ) ;
      176     2018
      177     2019    2       DCT.DP.MIRROR.LOCK  = '1'B ;
      178     2020    2       DCT.DP.MIRROR.USER# = S_CUN ;
      179     2021
      180     2022    3       DO WHILE (    ( DCT.STATE  ~= %IDLE     )
      181     2023    3                  OR ( DCT.SQ$    ~= ADDR(NIL) )
      182     2024    3                  OR ( DCT.DP.BQ$ ~= ADDR(NIL) ) ) ;
      183     2025                %UNLOCK ( G#=SQH.GATE ) ;
      184     2028    3           LOCK = '0'B ;
      185     2029    3           CALL NID$SCANAQ ( SQH ) ;
      186     2030    3           CALL SSR$REG ( %SS_SL, , 2 ) ;
      187     2031                %LOCK   ( G#=SQH.GATE ) ;
      188     2034    3           LOCK = '1'B ;
      189     2035    3           END ;
      190     2036
      191     2037        %EJECT ;
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:9    
      192     2038    2   CASE ( TDM#MAKE     ) ;                         /*** MAKE       ***/
      193     2039
      194     2040    2       CALL CHECK_NOMIRROR ( DCT )                 ALTRET ( UNLOCK ) ;
      195     2041    2       STATE  = MIRROR.STATE ;
      196     2042    2       MSTATE = MIRROR.MSTATE ;
      197     2043    2       CALL CHECK_STATE ( STATE  )                 ALTRET ( UNLOCK ) ;
      198     2044    2       CALL CHECK_STATE ( MSTATE )                 ALTRET ( UNLOCK ) ;
      199     2045
      200     2046    2       MDCTX = MIRROR.MDCTX ;
      201     2047    2       CALL CHECK_DISK ( MDCTX, MDCT$ )            ALTRET ( UNLOCK ) ;
      202     2048    2       MSQH$ = MDCT.SQH$ ;
      203     2049
      204     2050    2       CALL CHECK_NOMIRROR ( MDCT )                ALTRET ( UNLOCK ) ;
      205     2051
      206     2052    2       DCT.DP.MIRROR         = '0'B ;
      207     2053    2       DCT.DP.MIRROR.STATE   = %NI_MIRROR_NONE ;
      208     2054    2       DCT.DP.MIRROR.DCTX    = MDCTX ;
      209     2055    2       DCT.DP.MIRROR.DRZERO  = MIRROR.DRZERO ;
      210     2056    2       DCT.DP.MIRROR.LQ$     = ADDR(NIL) ;
      211     2057    2       DCT.DP.MIRROR.PRI     = '1'B ;
      212     2058    2       DCT.DP.MIRROR.UTS     = MIRROR.UTS ;
      213     2059
      214     2060    2       MDCT.DP.MIRROR        = '0'B ;
      215     2061    2       MDCT.DP.MIRROR.STATE  = %NI_MIRROR_NONE ;
      216     2062    2       MDCT.DP.MIRROR.DCTX   = DCTX ;
      217     2063    2       MDCT.DP.MIRROR.DRZERO = MIRROR.DRZERO ;
      218     2064    2       MDCT.DP.MIRROR.LQ$    = ADDR(NIL) ;
      219     2065    2       MDCT.DP.MIRROR.PRI    = '0'B ;
      220     2066    2       MDCT.DP.MIRROR.UTS    = MIRROR.UTS ;
      221     2067
      222     2068    2       CALL TDM$MIRSCHEDL ( DCT, STATE, MIRROR.UTS ) ;
      223     2069    2       LOCK = '0'B ;
      224     2070
      225     2071    2       CALL TDM$MIRSCHED  ( MDCT, MSTATE, MIRROR.UTS ) ;
      226     2072
      227     2073    2       CALL FMN$AVR ( DCT.DCTX,  %NI_AVR_MIRROR ) ;
      228     2074    2       CALL FMN$AVR ( MDCT.DCTX, %NI_AVR_MIRROR ) ;
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:10   
      229     2075
      230     2076        %EJECT ;
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:11   
      231     2077    2   CASE ( TDM#SWITCH   ) ;                         /*** SWITCH     ***/
      232     2078
      233     2079    2       CALL CHECK_MIRROR ( DCT )                   ALTRET ( UNLOCK ) ;
      234     2080    2       CALL CHECK_OPER   ( DCT )                   ALTRET ( UNLOCK ) ;
      235     2081
      236     2082    2       MDCTX = DCT.DP.MIRROR.DCTX ;
      237     2083    2       MDCT$ = N$DCT$(MDCTX) ;
      238     2084    2       MSQH$ = MDCT.SQH$ ;
      239     2085    2       CALL CHECK_PRIMARY ( MDCT )                 ALTRET ( UNLOCK ) ;
      240     2086
      241     2087    2       CALL FMN$MRRSWITCH ( MDCT.DCTX ) ;
      242     2088
      243     2089    2       MDCT.DP.MIRROR.PRI = '0'B ;
      244     2090    2       DCT.DP.MIRROR.PRI  = '1'B ;
      245     2091
      246     2092        %EJECT ;
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:12   
      247     2093    2   CASE ( TDM#UNLOCK   ) ;                         /*** UNLOCK     ***/
      248     2094
      249     2095
      250     2096    2       CALL CHECK_MIRROR ( DCT )                   ALTRET ( UNLOCK ) ;
      251     2097    2       CALL CHECK_LOCK   ( DCT )                   ALTRET ( UNLOCK ) ;
      252     2098    3       DO WHILE ( DCT.DP.MIRROR.LQ$ ~= ADDR(NIL) ) ;
      253     2099                %DEQUEUE ( P#=REQ$, Q#=DCT.DP.MIRROR.LQ$ ) ;
      254     2106    3           CALL NID$REQSCHEDL ( REQ ) ;
      255     2107    3           END ;
      256     2108
      257     2109    2       DCT.DP.MIRROR.LOCK  = '0'B ;
      258     2110    2       DCT.DP.MIRROR.USER# = 0 ;
      259     2111
      260     2112            %UNLOCK ( G#=SQH.GATE ) ;
      261     2115    2       LOCK = '0'B ;
      262     2116
      263     2117    2       CALL NID$SCANAQ ( SQH ) ;
      264     2118
      265     2119        %EJECT ;
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:13   
      266     2120    2   CASE ( ELSE ) ;                                 /*** E$TDBADFUNC ***/
      267     2121        /*E*    ERROR:  TDM-E$TDBADFUNC-4
      268     2122              MESSAGE:  Bad FUNCTION on M$MIRROR PMME.
      269     2123             MESSAGE1:  Only BREAK, CHGSTATE, LOCK, MAKE, SWITCH, or UNLOCK
      270     2124                        are valid FUNCTIONs for M$MIRROR.
      271     2125                                                                           */
      272     2126    2       B$JIT.ERR = TDBADFUNC ;
      273     2127
      274     2128    2       END ; /* DO CASE ( MIRROR.FUNCTION ) */
      275     2129
      276     2130    1   UNLOCK:
      277     2131
      278     2132    1   IF  LOCK
      279     2133    2   THEN DO ;
      280     2134            %UNLOCK ( G#=SQH.GATE ) ;
      281     2137    2       LOCK = '0'B ;
      282     2138    2       END ;
      283     2139
      284     2140    1   IF  MLOCK
      285     2141    2   THEN DO ;
      286     2142            %UNLOCK ( G#=MSQH.GATE ) ;
      287     2145    2       MLOCK = '0'B ;
      288     2146    2       END ;
      289     2147
      290     2148    1   IF  B$JIT.ERR = '0'B
      291     2149    1   THEN
      292     2150    1       RETURN ;
      293     2151    1   ELSE
      294     2152    1       CALL UDB$PMMEXIT ;
      295     2153
      296     2154        %EJECT ;
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:14   
      297     2155    1   CHECK_DISK:     PROC ( DCTX, DCT$ ) ALTRET ;
      298     2156        /*
      299     2157                        Parameters
      300     2158        */
      301     2159    2   DCL 1 DCTX      SBIN WORD ALIGNED PARAM ;
      302     2160    2   DCL 1 DCT$      PTR ALIGNED PARAM ;
      303     2161
      304     2162
      305     2163
      306     2164    2   DCT$ = N$DCT$(DCTX) ;
      307     2165
      308     2166    2   IF  DCTX = 0
      309     2167    2   OR  DCTX > NK_MXLOCAL
      310     2168    2   OR  DCT$ = ADDR(NIL)
      311     2169    2   OR  DCT.TYPE ~= %DV_DP
      312     2170    3   THEN DO ;
      313     2171        /*E*       ERROR:  TDM-E$TDBADDISK-4
      314     2172                 MESSAGE:  Bad device control table index (DCTX) value.
      315     2173                MESSAGE1:  The specified DCTX or MDCTX value does not
      316     2174                           correspond to a local disk device.
      317     2175             DESCRIPTION:  The DCTX and MDCTX (if used) parameters must
      318     2176                           correspond to a local disk device.
      319     2177                                                                           */
      320     2178    3       B$JIT.ERR = TDBADDISK ;
      321     2179    3       ALTRETURN ;
      322     2180    3       END ;
      323     2181
      324     2182    2   RETURN ;
      325     2183
      326     2184    2   END CHECK_DISK ;
      327     2185
      328     2186        %EJECT ;
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:15   
      329     2187    1   CHECK_FAIL:     PROC ( DCT ) ALTRET ;
      330     2188        /*
      331     2189                        Parameters
      332     2190        */
      333     2191        %NI$DCT                 ( NAME=DCT, STCLASS=PARAM ) ;
      334     2239
      335     2240
      336     2241
      337     2242    2   IF  DCT.DP.MIRROR.STATE = %NI_MIRROR_FAIL
      338     2243    2   THEN
      339     2244    2       RETURN ;
      340     2245
      341     2246        /*E* ERROR:  TDM-E$TDNOTFAIL-4
      342     2247             MESSAGE:  Mirrored Disk device is not failed.
      343     2248             DESCRIPTION:  The specified Mirrored Disk device is not
      344     2249                           failed.  For this function, the specified
      345     2250                           Mirrored Disk device must be failed.
      346     2251                                                                           */
      347     2252    2   B$JIT.ERR = TDNOTFAIL ;
      348     2253
      349     2254    2   ALTRETURN ;
      350     2255
      351     2256    2   END CHECK_FAIL ;
      352     2257
      353     2258        %EJECT ;
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:16   
      354     2259    1   CHECK_LOCK:     PROC ( DCT ) ALTRET ;
      355     2260        /*
      356     2261                        Parameters
      357     2262        */
      358     2263        %NI$DCT                 ( NAME=DCT, STCLASS=PARAM ) ;
      359     2311
      360     2312
      361     2313
      362     2314    2   IF  DCT.DP.MIRROR.LOCK
      363     2315    2   THEN
      364     2316    2       IF  DCT.DP.MIRROR.USER# = S_CUN
      365     2317    2       THEN
      366     2318    2           RETURN ;
      367     2319    2       ELSE
      368     2320
      369     2321        /*E*
      370     2322        ERROR:  TDM-E$TDNOTLOCKER-4
      371     2323        MESSAGE:  Device is locked by another user.
      372     2324        DESCRIPTION:  The Mirrored Disk device is locked by
      373     2325                      another user.  A locked Mirrored Disk device
      374     2326                      can only be unlocked by the user who locked it.
      375     2327        */
      376     2328
      377     2329    2           B$JIT.ERR = TDNOTLOCKER ;
      378     2330
      379     2331    2   ELSE
      380     2332
      381     2333        /*E*
      382     2334        ERROR:  TDM-E$TDNOTLOCKED-4
      383     2335        MESSAGE:  Device is not locked.
      384     2336        DESCRIPTION:  The Mirrored Disk device is not locked.  A
      385     2337                      Mirrored Disk device can only be unlocked if
      386     2338                      it has been previously been locked.
      387     2339        */
      388     2340
      389     2341    2       B$JIT.ERR = TDNOTLOCKED ;
      390     2342
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:17   
      391     2343    2   ALTRETURN ;
      392     2344
      393     2345    2   END CHECK_LOCK ;
      394     2346
      395     2347        %EJECT ;
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:18   
      396     2348    1   CHECK_MIRROR:   PROC ( DCT ) ALTRET ;
      397     2349        /*
      398     2350                        Parameters
      399     2351        */
      400     2352        %NI$DCT                 ( NAME=DCT,     STCLASS=PARAM ) ;
      401     2400
      402     2401
      403     2402
      404     2403    2   IF  DCT.DP.MIRROR.FLAG
      405     2404    2   THEN
      406     2405    2       RETURN ;
      407     2406
      408     2407        /*E*       ERROR:  TDM-E$TDNOTMIRROR-4
      409     2408                 MESSAGE:  Device is not a Mirrored Disk device.
      410     2409             DESCRIPTION:  The device specified must be a
      411     2410                           Mirrored Disk device.  The device specified
      412     2411                           by either DCTX or MDCTX (if used) is not a
      413     2412                           Mirrored Disk device.
      414     2413                                                                           */
      415     2414    2   B$JIT.ERR = TDNOTMIRROR ;
      416     2415
      417     2416    2   ALTRETURN ;
      418     2417
      419     2418    2   END CHECK_MIRROR ;
      420     2419
      421     2420        %EJECT ;
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:19   
      422     2421    1   CHECK_NOMIRROR: PROC ( DCT ) ALTRET ;
      423     2422        /*
      424     2423                        Parameters
      425     2424        */
      426     2425        %NI$DCT                 ( NAME=DCT,     STCLASS=PARAM ) ;
      427     2473
      428     2474
      429     2475
      430     2476    2   IF  NOT DCT.DP.MIRROR.FLAG
      431     2477    2   THEN
      432     2478    2       RETURN ;
      433     2479
      434     2480        /*E*       ERROR:  TDM-E$TDMIRROR-4
      435     2481                 MESSAGE:  Device is a Mirrored Disk device.
      436     2482             DESCRIPTION:  The device specified must not be a
      437     2483                           Mirrored Disk device.  The device specified
      438     2484                           by either DCTX or MDCTX already
      439     2485                           is a Mirrored Disk device.
      440     2486                                                                           */
      441     2487    2   B$JIT.ERR = TDMIRROR ;
      442     2488
      443     2489    2   ALTRETURN ;
      444     2490
      445     2491    2   END CHECK_NOMIRROR ;
      446     2492
      447     2493        %EJECT ;
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:20   
      448     2494    1   CHECK_OPER:     PROC ( DCT ) ALTRET ;
      449     2495        /*
      450     2496                        Parameters
      451     2497        */
      452     2498        %NI$DCT                 ( NAME=DCT, STCLASS=PARAM ) ;
      453     2546
      454     2547
      455     2548
      456     2549    2   IF  DCT.DP.MIRROR.STATE = %NI_MIRROR_OPER
      457     2550    2   THEN
      458     2551    2       RETURN ;
      459     2552
      460     2553        /*E* ERROR:  TDM-E$TDNOTOPER-4
      461     2554             MESSAGE:  Mirrored Disk device is not operational.
      462     2555             DESCRIPTION:  The specified Mirrored Disk device is not
      463     2556                           operational.  For this function, the specified
      464     2557                           Mirrored Disk device must be operational.
      465     2558                                                                           */
      466     2559    2   B$JIT.ERR = TDNOTOPER ;
      467     2560
      468     2561    2   ALTRETURN ;
      469     2562
      470     2563    2   END CHECK_OPER ;
      471     2564
      472     2565        %EJECT ;
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:21   
      473     2566    1   CHECK_PRIMARY:  PROC ( DCT ) ALTRET ;
      474     2567        /*
      475     2568                        Parameters
      476     2569        */
      477     2570        %NI$DCT                 ( NAME=DCT, STCLASS=PARAM ) ;
      478     2618
      479     2619
      480     2620
      481     2621    2   IF  DCT.DP.MIRROR.PRI
      482     2622    2   THEN
      483     2623    2       RETURN ;
      484     2624
      485     2625        /*E* ERROR:  TDM-E$TDNOTPRI-4
      486     2626             MESSAGE:  Mirrored Disk device is not primary.
      487     2627             DESCRIPTION:  The Mirrored Disk device is not a primary
      488     2628                           Mirrored Disk device.  For this function,
      489     2629                           the specified Mirrored Disk device must be
      490     2630                           a primary Mirrored Disk device.
      491     2631                                                                           */
      492     2632    2   B$JIT.ERR = TDNOTPRI ;
      493     2633
      494     2634    2   ALTRETURN ;
      495     2635
      496     2636    2   END CHECK_PRIMARY ;
      497     2637
      498     2638        %EJECT ;
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:22   
      499     2639    1   CHECK_STATE:    PROC ( STATE ) ALTRET ;
      500     2640        /*
      501     2641                        Parameters
      502     2642        */
      503     2643    2   DCL 1 STATE     SBIN WORD ALIGNED PARAM ;
      504     2644
      505     2645
      506     2646
      507     2647    3   DO CASE ( STATE ) ;
      508     2648
      509     2649    3   CASE ( %NI_MIRROR_FAIL, %NI_MIRROR_NONE, %NI_MIRROR_OPER, %NI_MIRROR_REST, %
              2649            NI_MIRROR_WAIT ) ;
      510     2650    3       RETURN ;
      511     2651
      512     2652    3   CASE ( ELSE ) ;
      513     2653    3       B$JIT.ERR = TDBADSTATE ;
      514     2654    3       ALTRETURN ;
      515     2655
      516     2656    3       END ;
      517     2657
      518     2658    2   END CHECK_STATE ;
      519     2659
      520     2660        %EJECT ;
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:23   
      521     2661    1   CHECK_UNLOCK:   PROC ( DCT ) ALTRET ;
      522     2662        /*
      523     2663                        Parameters
      524     2664        */
      525     2665        %NI$DCT                 ( NAME=DCT, STCLASS=PARAM ) ;
      526     2713
      527     2714
      528     2715
      529     2716    2   IF  NOT DCT.DP.MIRROR.LOCK
      530     2717    2   THEN
      531     2718    2       RETURN ;
      532     2719
      533     2720        /*E*
      534     2721        ERROR:  TDM-E$TDNOTUNLOCKED-4
      535     2722        MESSAGE:  Device is not unlocked.
      536     2723        DESCRIPTION:  The Mirrored Disk device is not unlocked.  A
      537     2724                      Mirrored Disk device can only be locked if
      538     2725                      it is not currently locked.
      539     2726        */
      540     2727
      541     2728    2       B$JIT.ERR = TDNOTUNLOCKED ;
      542     2729
      543     2730    2   ALTRETURN ;
      544     2731
      545     2732    2   END CHECK_UNLOCK ;
      546     2733
      547     2734
      548     2735    1   END TDM$MIRROR ;
      549     2736        %EOD ;

PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:24   
--  Include file information  --

   TD_ERRORS_C.:E05TOU  is referenced.
   TD$CP6V_C.:E05TOU  is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   NI_MACROS_C.:E05TOU  cannot be made into a system file and is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NI_DATA_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  is referenced.
      No diagnostics issued in procedure TDM$MIRROR.

   Procedure TDM$MIRROR requires 532 words for executable code.
   Procedure TDM$MIRROR requires 22 words of local(AUTO) storage.

PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:25   

 Object Unit name= TDM$MIRROR                                 File name= TDM$MIRROR.:E05TOU
 UTS= JUL 30 '97 06:03:07.72 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS     11     13  TDM$MIRROR
    1   Proc  even  none   532   1024  TDM$MIRROR
    2  RoData even  none     7      7  TDM$MIRROR

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        0  TDM$MIRROR
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:26   

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 HFC$LOCK
         yes           Std       3 TDM$MIRSCHEDL
         yes           Std       2 FMN$AVR
         yes           Std       1 HFC$UNLOCK
 yes     yes           Std       3 SSR$REG
         yes           Std       1 FMN$MRRSWITCH
         yes           Std       2 TDM$MIRFAIL
         yes           Std       1 NID$SCANAQ
         yes           Std       1 NID$REQSCHEDL
         yes           Std       3 TDM$MIRSCHED
 yes     yes           Std       2 NIM$DEQUEUE
         yes           Std       0 UDB$PMMEXIT
                       nStd      0 X66_AUTO_0
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     N$DCT$$                               N$FQ$                                 NI$FQ$
     NI$IBUF$                              NI$RP$                                B$JIT$
     B$PS0$                                NK_MXLOCAL                            S_CUN
     B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:27   


        1        1        /*M* Mirrored Disk routines.                                       */
        2        2        /*T***********************************************************/
        3        3        /*T*                                                         */
        4        4        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
        5        5        /*T*                                                         */
        6        6        /*T***********************************************************/
        7        7        /*X* DFC=YES, DMC=YES, EDMC=YES                                    */
        8        8        /*P*
        9        9        NAME:           TDM$MIRROR
       10       10
       11       11        PURPOSE:        Module for Mirrored Disk routines.
       12       12
       13       13        REFERENCE:      AF1274C
       14       14                                                                           */
       15       15        /*D*
       16       16        NAME:           TDM$MIRROR
       17       17
       18       18        CALL            TDM$MIRROR
       19       19
       20       20        ENRIRONMENT:    Monitor, not privileged, not inhibited.
       21       21
       22       22        INPUT:          B$PS0$->FPT$MIRRORV
       23       23
       24       24        OUTPUT:         DCT.DP.MIRROR
       25       25                        MDCT.DP.MIRROR
       26       26
       27       27        DESCRIPTION:    The TDM$MIRROR routine is used to process the
       28       28                        M$MIRROR PMME.
       29       29                                                                           */
       30       30        TDM$MIRROR:     PROC ;

     30  1 000000   000000 700200 xent  TDM$MIRROR   TSX0  ! X66_AUTO_0
         1 000001   000026 000000                    ZERO    22,0

       31       31        /*
       32       32                        Includes
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:28   
       33       33        */
       34       34        %INCLUDE                B$JIT_C ;
       35      348        %INCLUDE                HF_LOCK_C ;
       36      362        %INCLUDE                NI_DATA_C ;
       37      475        %INCLUDE                NI_DATA_R ;
       38      912        %INCLUDE                NI_MACROS_C ;
       39     1179        %INCLUDE                SS_SCHED_C ;
       40     1412        %INCLUDE                TD$CP6V_C ;
       41     1448        %INCLUDE                TD_ERRORS_C ;
       42     1531        /*
       43     1532                        Entries
       44     1533        */
       45     1534    1   DCL 1 FMN$AVR           ENTRY(2) ;
       46     1535    1   DCL 1 FMN$MRRSWITCH     ENTRY(1) ;
       47     1536    1   DCL 1 NID$REQSCHEDL     ENTRY(1) ;
       48     1537    1   DCL 1 NID$SCANAQ        ENTRY(1) ;
       49     1538    1   DCL 1 SSR$REG           ENTRY(3) ALTRET ;
       50     1539    1   DCL 1 TDM$MIRFAIL       ENTRY(2) ;
       51     1540    1   DCL 1 TDM$MIRSCHED      ENTRY(3) ;
       52     1541    1   DCL 1 TDM$MIRSCHEDL     ENTRY(3) ;
       53     1542    1   DCL 1 UDB$PMMEXIT       ENTRY ;
       54     1543        /*
       55     1544                        Symrefs
       56     1545        */
       57     1546    1   DCL 1 B$JIT$            PTR SYMREF ;
       58     1547    1   DCL 1 B$PS0$            PTR SYMREF ;
       59     1548    1   DCL 1 NK_MXLOCAL        UBIN WORD SYMREF ;
       60     1549    1   DCL 1 S_CUN             UBIN WORD SYMREF ;
       61     1550        /*
       62     1551                        Auto
       63     1552        */
       64     1553    1   DCL 1 DCT$              PTR ALIGNED AUTO ;
       65     1554    1   DCL 1 DCTX              SBIN WORD ALIGNED AUTO ;
       66     1555    1   DCL 1 LOCK              BIT(1) ALIGNED AUTO ;
       67     1556    1   DCL 1 MDCT$             PTR ALIGNED AUTO ;
       68     1557    1   DCL 1 MDCTX             SBIN WORD ALIGNED AUTO ;
       69     1558    1   DCL 1 MLOCK             BIT(1) ALIGNED AUTO ;
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:29   
       70     1559    1   DCL 1 MSQH$             PTR ALIGNED AUTO ;
       71     1560    1   DCL 1 MSTATE            SBIN WORD ALIGNED AUTO ;
       72     1561    1   DCL 1 REQ$              PTR ALIGNED AUTO ;
       73     1562    1   DCL 1 SQH$              PTR ALIGNED AUTO ;
       74     1563    1   DCL 1 STATE             SBIN WORD ALIGNED AUTO ;
       75     1564        /*
       76     1565                        Based
       77     1566        */
       78     1567        %B$JIT0 ;
       79     1656        %U$JIT1X ;
       80     1659        %M$JIT2X ;
       81     1662        %F$JIT3 ;
       82     1667        %S$JIT4 ;
       83     1673        %A$JIT6X ;
       84     1676        %N$REQ                  ( NAME=REQ,     STCLASS="BASED(REQ$)" ) ;
       85     1734        %NI$DCT                 ( NAME=DCT,     STCLASS="BASED(DCT$)" ) ;
       86     1782        %NI$DCT                 ( NAME=MDCT,    STCLASS="BASED(MDCT$)" ) ;
       87     1830        %NI$SQH                 ( NAME=MSQH,    STCLASS="BASED(MSQH$)" ) ;
       88     1843        %FPT$MIRROR_V           ( FPTN=MIRROR,  BASED="BASED(B$PS0$)" ) ;
       89     1847        %NI$SQH                 ( NAME=SQH,     STCLASS="BASED(SQH$)" ) ;
       90     1860        /*
       91     1861                        Constants
       92     1862        */
       93     1863        %EQU  TDM#FCG1          = %SUBBIT ( %ASCBIT ( 'T' ), 3, 6 ) ;
       94     1864        %EQU  TDM#FCG2          = %SUBBIT ( %ASCBIT ( 'M' ), 3, 6 ) ;
       95     1865        %EQU  TDM#FCG           = %CONCAT ( TDM#FCG1,  TDM#FCG2  ) ;
       96     1866        %SUB  MODULE            = %TDM#FCG ;
       97     1867
       98     1868        %ERROR_WORD             ( N#=TDBADDISK,     C#=%E$TDBADDISK     ) ;
       99     1875        %ERROR_WORD             ( N#=TDBADFUNC,     C#=%E$TDBADFUNC     ) ;
      100     1882        %ERROR_WORD             ( N#=TDBADSTATE,    C#=%E$TDBADSTATE    ) ;
      101     1889        %ERROR_WORD             ( N#=TDMIRROR,      C#=%E$TDMIRROR      ) ;
      102     1896        %ERROR_WORD             ( N#=TDNOTFAIL,     C#=%E$TDNOTFAIL     ) ;
      103     1903        %ERROR_WORD             ( N#=TDNOTLOCKED,   C#=%E$TDNOTLOCKED   ) ;
      104     1910        %ERROR_WORD             ( N#=TDNOTLOCKER,   C#=%E$TDNOTLOCKER   ) ;
      105     1917        %ERROR_WORD             ( N#=TDNOTMIRROR,   C#=%E$TDNOTMIRROR   ) ;
      106     1924        %ERROR_WORD             ( N#=TDNOTOPER,     C#=%E$TDNOTOPER     ) ;
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:30   
      107     1931        %ERROR_WORD             ( N#=TDNOTPRI,      C#=%E$TDNOTPRI      ) ;
      108     1938        %ERROR_WORD             ( N#=TDNOTUNLOCKED, C#=%E$TDNOTUNLOCKED ) ;
      109     1945
      110     1946        %SUB  TDM#BREAK         = " 1 /* TDM#BREAK    */" ;
      111     1947        %SUB  TDM#CHGSTATE      = " 2 /* TDM#CHGSTATE */" ;
      112     1948        %SUB  TDM#LOCK          = " 3 /* TDM#LOCK     */" ;
      113     1949        %SUB  TDM#MAKE          = " 4 /* TDM#MAKE     */" ;
      114     1950        %SUB  TDM#SWITCH        = " 5 /* TDM#SWITCH   */" ;
      115     1951        %SUB  TDM#UNLOCK        = " 6 /* TDM#UNLOCK   */" ;
      116     1952
      117     1953        %EJECT ;
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:31   
      118     1954    1   LOCK  = '0'B ;

   1954  1 000002   200005 450100                    STZ     LOCK,,AUTO

      119     1955    1   MLOCK = '0'B ;

   1955  1 000003   200010 450100                    STZ     MLOCK,,AUTO

      120     1956    1   MDCTX = 0 ;

   1956  1 000004   200007 450100                    STZ     MDCTX,,AUTO

      121     1957    1   MDCT$ = ADDR(NIL) ;

   1957  1 000005   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000006   200006 756100                    STQ     MDCT$,,AUTO

      122     1958    1   MSQH$ = ADDR(NIL) ;

   1958  1 000007   200011 756100                    STQ     MSQH$,,AUTO

      123     1959
      124     1960    1   DCTX = MIRROR.DCTX ;

   1960  1 000010   000000 470400 xsym               LDP0    B$PS0$
         1 000011   000000 236100                    LDQ     0,,PR0
         1 000012   777777 376007                    ANQ     -1,DL
         1 000013   200004 756100                    STQ     DCTX,,AUTO

      125     1961    1   CALL CHECK_DISK ( DCTX, DCT$ )                  ALTRET ( UNLOCK ) ;

   1961  1 000014   200003 631500                    EPPR1   DCT$,,AUTO
         1 000015   200020 451500                    STP1    @DCT+1,,AUTO
         1 000016   200004 633500                    EPPR3   DCTX,,AUTO
         1 000017   200017 453500                    STP3    STATE+2,,AUTO
         1 000020   000622 701000 1                  TSX1    CHECK_DISK
         1 000021   000574 702000 1                  TSX2    UNLOCK
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:32   

      126     1962    1   SQH$ = DCT.SQH$ ;

   1962  1 000022   200003 470500                    LDP0    DCT$,,AUTO
         1 000023   000022 236100                    LDQ     18,,PR0
         1 000024   200014 756100                    STQ     SQH$,,AUTO

      127     1963
      128     1964        %LOCK ( G#=SQH.GATE ) ;

   1965  1 000025   200014 630500                    EPPR0   SQH$,,AUTO
         1 000026   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000027   000000 701000 xent               TSX1    HFC$LOCK
         1 000030   000000 011000                    NOP     0

      129     1967    1   LOCK = '1'B ;

   1967  1 000031   400000 236003                    LDQ     -131072,DU
         1 000032   200005 756100                    STQ     LOCK,,AUTO

      130     1968
      131     1969    2   DO CASE ( MIRROR.FUNCTION ) ;

   1969  1 000033   000000 470400 xsym               LDP0    B$PS0$
         1 000034   000000 236100                    LDQ     0,,PR0
         1 000035   000036 772000                    QRL     30
         1 000036   000007 116007                    CMPQ    7,DL
         1 000037   000041 602006 1                  TNC     s:1969+6,QL
         1 000040   000571 710000 1                  TRA     s:2126
         1 000041   000571 710000 1                  TRA     s:2126
         1 000042   000050 710000 1                  TRA     s:1975
         1 000043   000161 710000 1                  TRA     s:2007
         1 000044   000213 710000 1                  TRA     s:2016
         1 000045   000274 710000 1                  TRA     s:2040
         1 000046   000455 710000 1                  TRA     s:2079
         1 000047   000521 710000 1                  TRA     s:2096

PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:33   
      132     1970
      133     1971        %EJECT ;
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:34   
      134     1972    2   CASE ( TDM#BREAK    ) ;                         /*** BREAK      ***/

      135     1973
      136     1974
      137     1975    2       IF  DCT.DP.MIRROR.STATE = %NI_MIRROR_WAIT

   1975  1 000050   200003 471500                    LDP1    DCT$,,AUTO
         1 000051   100036 236100                    LDQ     30,,PR1
         1 000052   007700 376003                    ANQ     4032,DU
         1 000053   000300 116003                    CMPQ    192,DU
         1 000054   000106 601000 1                  TNZ     s:1983

      138     1976    3       THEN DO ;

      139     1977    3           CALL CHECK_NOMIRROR ( DCT )             ALTRET ( UNLOCK ) ;

   1977  1 000055   200003 236100                    LDQ     DCT$,,AUTO
         1 000056   200017 756100                    STQ     STATE+2,,AUTO
         1 000057   000727 701000 1                  TSX1    CHECK_NOMIRROR
         1 000060   000574 702000 1                  TSX2    UNLOCK

      140     1978    3           CALL TDM$MIRSCHEDL ( DCT, %NI_MIRROR_NONE, MIRROR.UTS ) ;

   1978  1 000061   000000 236000 xsym               LDQ     B$PS0$
         1 000062   000003 036003                    ADLQ    3,DU
         1 000063   200024 756100                    STQ     @DCT$+4,,AUTO
         1 000064   000000 236000 2                  LDQ     0
         1 000065   200003 235100                    LDA     DCT$,,AUTO
         1 000066   200022 757100                    STAQ    @DCT$+2,,AUTO
         1 000067   200022 630500                    EPPR0   @DCT$+2,,AUTO
         1 000070   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000071   000000 701000 xent               TSX1    TDM$MIRSCHEDL
         1 000072   000000 011000                    NOP     0

      141     1979    3           LOCK = '0'B ;

   1979  1 000073   200005 450100                    STZ     LOCK,,AUTO
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:35   

      142     1980    3           CALL FMN$AVR ( DCT.DCTX, %NI_AVR_MIRROR ) ;

   1980  1 000074   000001 236000 2                  LDQ     1
         1 000075   200023 756100                    STQ     @DCT$+3,,AUTO
         1 000076   200003 236100                    LDQ     DCT$,,AUTO
         1 000077   000006 036003                    ADLQ    6,DU
         1 000100   200022 756100                    STQ     @DCT$+2,,AUTO
         1 000101   200022 630500                    EPPR0   @DCT$+2,,AUTO
         1 000102   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000103   000000 701000 xent               TSX1    FMN$AVR
         1 000104   000000 011000                    NOP     0

      143     1981    3           END ;

   1981  1 000105   000574 710000 1                  TRA     UNLOCK

      144     1982    3       ELSE DO ;

      145     1983    3           CALL CHECK_MIRROR ( DCT )               ALTRET ( UNLOCK ) ;

   1983  1 000106   200003 236100                    LDQ     DCT$,,AUTO
         1 000107   200017 756100                    STQ     STATE+2,,AUTO
         1 000110   000715 701000 1                  TSX1    CHECK_MIRROR
         1 000111   000574 702000 1                  TSX2    UNLOCK

      146     1984    3           MDCTX = DCT.DP.MIRROR.DCTX ;

   1984  1 000112   200003 470500                    LDP0    DCT$,,AUTO
         1 000113   000037 236100                    LDQ     31,,PR0
         1 000114   000022 772000                    QRL     18
         1 000115   200007 756100                    STQ     MDCTX,,AUTO

      147     1985    3           MDCT$ = N$DCT$(MDCTX) ;

   1985  1 000116   000000 471400 xsym               LDP1    N$DCT$$
         1 000117   100000 236106                    LDQ     0,QL,PR1
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:36   
         1 000120   200006 756100                    STQ     MDCT$,,AUTO

      148     1986    3           MSQH$ = MDCT.SQH$ ;

   1986  1 000121   200006 473500                    LDP3    MDCT$,,AUTO
         1 000122   300022 236100                    LDQ     18,,PR3
         1 000123   200011 756100                    STQ     MSQH$,,AUTO

      149     1987    3           CALL CHECK_OPER ( DCT )                 ALTRET ( UNLOCK ) ;

   1987  1 000124   200003 236100                    LDQ     DCT$,,AUTO
         1 000125   200017 756100                    STQ     STATE+2,,AUTO
         1 000126   000741 701000 1                  TSX1    CHECK_OPER
         1 000127   000574 702000 1                  TSX2    UNLOCK

      150     1988    3           IF  MSQH$ ~= SQH$

   1988  1 000130   200011 236100                    LDQ     MSQH$,,AUTO
         1 000131   200014 116100                    CMPQ    SQH$,,AUTO
         1 000132   000146 600000 1                  TZE     s:1999

      151     1989    4           THEN DO ;

      152     1990                    %UNLOCK ( G#=SQH.GATE  ) ;

   1991  1 000133   200014 630500                    EPPR0   SQH$,,AUTO
         1 000134   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000135   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000136   000000 011000                    NOP     0

      153     1993    4               LOCK    = '0'B ;

   1993  1 000137   200005 450100                    STZ     LOCK,,AUTO

      154     1994                    %LOCK   ( G#=MSQH.GATE ) ;

   1995  1 000140   200011 630500                    EPPR0   MSQH$,,AUTO
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:37   
         1 000141   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000142   000000 701000 xent               TSX1    HFC$LOCK
         1 000143   000000 011000                    NOP     0

      155     1997    4               MLOCK   = '1'B ;

   1997  1 000144   400000 236003                    LDQ     -131072,DU
         1 000145   200010 756100                    STQ     MLOCK,,AUTO

      156     1998    4               END ;

      157     1999    3           CALL TDM$MIRFAIL ( MDCT, MIRROR.UTS ) ;

   1999  1 000146   000000 236000 xsym               LDQ     B$PS0$
         1 000147   000003 036003                    ADLQ    3,DU
         1 000150   200006 235100                    LDA     MDCT$,,AUTO
         1 000151   200022 757100                    STAQ    @DCT$+2,,AUTO
         1 000152   200022 630500                    EPPR0   @DCT$+2,,AUTO
         1 000153   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000154   000000 701000 xent               TSX1    TDM$MIRFAIL
         1 000155   000000 011000                    NOP     0

      158     2000    3           LOCK  = '0'B ;

   2000  1 000156   200005 450100                    STZ     LOCK,,AUTO

      159     2001    3           MLOCK = '0'B ;

   2001  1 000157   200010 450100                    STZ     MLOCK,,AUTO

      160     2002    3           END ;

   2002  1 000160   000574 710000 1                  TRA     UNLOCK

      161     2003
      162     2004        %EJECT ;
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:38   
      163     2005    2   CASE ( TDM#CHGSTATE ) ;                         /*** CHGSTATE   ***/

      164     2006
      165     2007    2       CALL CHECK_MIRROR ( DCT )                   ALTRET ( UNLOCK ) ;

   2007  1 000161   200003 236100                    LDQ     DCT$,,AUTO
         1 000162   200017 756100                    STQ     STATE+2,,AUTO
         1 000163   000715 701000 1                  TSX1    CHECK_MIRROR
         1 000164   000574 702000 1                  TSX2    UNLOCK

      166     2008    2       STATE = MIRROR.STATE ;

   2008  1 000165   000000 470400 xsym               LDP0    B$PS0$
         1 000166   000000 236100                    LDQ     0,,PR0
         1 000167   000030 772000                    QRL     24
         1 000170   000077 376007                    ANQ     63,DL
         1 000171   200015 756100                    STQ     STATE,,AUTO

      167     2009    2       CALL CHECK_STATE ( STATE )                  ALTRET ( UNLOCK ) ;

   2009  1 000172   200015 631500                    EPPR1   STATE,,AUTO
         1 000173   200017 451500                    STP1    STATE+2,,AUTO
         1 000174   000767 701000 1                  TSX1    CHECK_STATE
         1 000175   000574 702000 1                  TSX2    UNLOCK

      168     2010    2       CALL TDM$MIRSCHEDL ( DCT, STATE, MIRROR.UTS ) ;

   2010  1 000176   000000 236000 xsym               LDQ     B$PS0$
         1 000177   000003 036003                    ADLQ    3,DU
         1 000200   200024 756100                    STQ     @DCT$+4,,AUTO
         1 000201   200015 630500                    EPPR0   STATE,,AUTO
         1 000202   200023 450500                    STP0    @DCT$+3,,AUTO
         1 000203   200003 236100                    LDQ     DCT$,,AUTO
         1 000204   200022 756100                    STQ     @DCT$+2,,AUTO
         1 000205   200022 630500                    EPPR0   @DCT$+2,,AUTO
         1 000206   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000207   000000 701000 xent               TSX1    TDM$MIRSCHEDL
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:39   
         1 000210   000000 011000                    NOP     0

      169     2011    2       LOCK = '0'B ;

   2011  1 000211   200005 450100                    STZ     LOCK,,AUTO
         1 000212   000574 710000 1                  TRA     UNLOCK

      170     2012
      171     2013        %EJECT ;
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:40   
      172     2014    2   CASE ( TDM#LOCK     ) ;                         /*** LOCK       ***/

      173     2015
      174     2016    2       CALL CHECK_MIRROR ( DCT )                   ALTRET ( UNLOCK ) ;

   2016  1 000213   200003 236100                    LDQ     DCT$,,AUTO
         1 000214   200017 756100                    STQ     STATE+2,,AUTO
         1 000215   000715 701000 1                  TSX1    CHECK_MIRROR
         1 000216   000574 702000 1                  TSX2    UNLOCK

      175     2017    2       CALL CHECK_UNLOCK ( DCT )                   ALTRET ( UNLOCK ) ;

   2017  1 000217   200003 236100                    LDQ     DCT$,,AUTO
         1 000220   200017 756100                    STQ     STATE+2,,AUTO
         1 000221   001010 701000 1                  TSX1    CHECK_UNLOCK
         1 000222   000574 702000 1                  TSX2    UNLOCK

      176     2018
      177     2019    2       DCT.DP.MIRROR.LOCK  = '1'B ;

   2019  1 000223   200003 470500                    LDP0    DCT$,,AUTO
         1 000224   040000 236003                    LDQ     16384,DU
         1 000225   000036 256100                    ORSQ    30,,PR0

      178     2020    2       DCT.DP.MIRROR.USER# = S_CUN ;

   2020  1 000226   000000 236000 xsym               LDQ     S_CUN
         1 000227   000036 552104                    STBQ    30,'04'O,PR0

      179     2021
      180     2022    3       DO WHILE (    ( DCT.STATE  ~= %IDLE     )

   2022  1 000230   000261 710000 1                  TRA     s:2035

      181     2023    3                  OR ( DCT.SQ$    ~= ADDR(NIL) )
      182     2024    3                  OR ( DCT.DP.BQ$ ~= ADDR(NIL) ) ) ;
      183     2025                %UNLOCK ( G#=SQH.GATE ) ;
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:41   

   2026  1 000231   200014 630500                    EPPR0   SQH$,,AUTO
         1 000232   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000233   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000234   000000 011000                    NOP     0

      184     2028    3           LOCK = '0'B ;

   2028  1 000235   200005 450100                    STZ     LOCK,,AUTO

      185     2029    3           CALL NID$SCANAQ ( SQH ) ;

   2029  1 000236   200014 630500                    EPPR0   SQH$,,AUTO
         1 000237   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000240   000000 701000 xent               TSX1    NID$SCANAQ
         1 000241   000000 011000                    NOP     0

      186     2030    3           CALL SSR$REG ( %SS_SL, , 2 ) ;

   2030  1 000242   000003 236000 2                  LDQ     3
         1 000243   200024 756100                    STQ     @DCT$+4,,AUTO
         1 000244   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000245   000004 235000 2                  LDA     4
         1 000246   200022 757100                    STAQ    @DCT$+2,,AUTO
         1 000247   200022 630500                    EPPR0   @DCT$+2,,AUTO
         1 000250   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000251   000000 701000 xent               TSX1    SSR$REG
         1 000252   000000 011000                    NOP     0

      187     2031                %LOCK   ( G#=SQH.GATE ) ;

   2032  1 000253   200014 630500                    EPPR0   SQH$,,AUTO
         1 000254   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000255   000000 701000 xent               TSX1    HFC$LOCK
         1 000256   000000 011000                    NOP     0

      188     2034    3           LOCK = '1'B ;
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:42   

   2034  1 000257   400000 236003                    LDQ     -131072,DU
         1 000260   200005 756100                    STQ     LOCK,,AUTO

      189     2035    3           END ;

   2035  1 000261   200003 470500                    LDP0    DCT$,,AUTO
         1 000262   000007 236100                    LDQ     7,,PR0
         1 000263   000077 316007                    CANQ    63,DL
         1 000264   000231 601000 1                  TNZ     s:2026
         1 000265   000001 236100                    LDQ     1,,PR0
         1 000266   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000267   000231 601000 1                  TNZ     s:2026
         1 000270   000030 236100                    LDQ     24,,PR0
         1 000271   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000272   000231 601000 1                  TNZ     s:2026
         1 000273   000574 710000 1                  TRA     UNLOCK

      190     2036
      191     2037        %EJECT ;
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:43   
      192     2038    2   CASE ( TDM#MAKE     ) ;                         /*** MAKE       ***/

      193     2039
      194     2040    2       CALL CHECK_NOMIRROR ( DCT )                 ALTRET ( UNLOCK ) ;

   2040  1 000274   200003 236100                    LDQ     DCT$,,AUTO
         1 000275   200017 756100                    STQ     STATE+2,,AUTO
         1 000276   000727 701000 1                  TSX1    CHECK_NOMIRROR
         1 000277   000574 702000 1                  TSX2    UNLOCK

      195     2041    2       STATE  = MIRROR.STATE ;

   2041  1 000300   000000 470400 xsym               LDP0    B$PS0$
         1 000301   000000 236100                    LDQ     0,,PR0
         1 000302   000030 772000                    QRL     24
         1 000303   000077 376007                    ANQ     63,DL
         1 000304   200015 756100                    STQ     STATE,,AUTO

      196     2042    2       MSTATE = MIRROR.MSTATE ;

   2042  1 000305   000001 236100                    LDQ     1,,PR0
         1 000306   000030 772000                    QRL     24
         1 000307   000077 376007                    ANQ     63,DL
         1 000310   200012 756100                    STQ     MSTATE,,AUTO

      197     2043    2       CALL CHECK_STATE ( STATE  )                 ALTRET ( UNLOCK ) ;

   2043  1 000311   200015 631500                    EPPR1   STATE,,AUTO
         1 000312   200017 451500                    STP1    STATE+2,,AUTO
         1 000313   000767 701000 1                  TSX1    CHECK_STATE
         1 000314   000574 702000 1                  TSX2    UNLOCK

      198     2044    2       CALL CHECK_STATE ( MSTATE )                 ALTRET ( UNLOCK ) ;

   2044  1 000315   200012 630500                    EPPR0   MSTATE,,AUTO
         1 000316   200017 450500                    STP0    STATE+2,,AUTO
         1 000317   000767 701000 1                  TSX1    CHECK_STATE
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:44   
         1 000320   000574 702000 1                  TSX2    UNLOCK

      199     2045
      200     2046    2       MDCTX = MIRROR.MDCTX ;

   2046  1 000321   000000 470400 xsym               LDP0    B$PS0$
         1 000322   000001 236100                    LDQ     1,,PR0
         1 000323   777777 376007                    ANQ     -1,DL
         1 000324   200007 756100                    STQ     MDCTX,,AUTO

      201     2047    2       CALL CHECK_DISK ( MDCTX, MDCT$ )            ALTRET ( UNLOCK ) ;

   2047  1 000325   200006 631500                    EPPR1   MDCT$,,AUTO
         1 000326   200020 451500                    STP1    @DCT+1,,AUTO
         1 000327   200007 633500                    EPPR3   MDCTX,,AUTO
         1 000330   200017 453500                    STP3    STATE+2,,AUTO
         1 000331   000622 701000 1                  TSX1    CHECK_DISK
         1 000332   000574 702000 1                  TSX2    UNLOCK

      202     2048    2       MSQH$ = MDCT.SQH$ ;

   2048  1 000333   200006 470500                    LDP0    MDCT$,,AUTO
         1 000334   000022 236100                    LDQ     18,,PR0
         1 000335   200011 756100                    STQ     MSQH$,,AUTO

      203     2049
      204     2050    2       CALL CHECK_NOMIRROR ( MDCT )                ALTRET ( UNLOCK ) ;

   2050  1 000336   200006 236100                    LDQ     MDCT$,,AUTO
         1 000337   200017 756100                    STQ     STATE+2,,AUTO
         1 000340   000727 701000 1                  TSX1    CHECK_NOMIRROR
         1 000341   000574 702000 1                  TSX2    UNLOCK

      205     2051
      206     2052    2       DCT.DP.MIRROR         = '0'B ;

   2052  1 000342   200003 470500                    LDP0    DCT$,,AUTO
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:45   
         1 000343   000100 100400                    MLR     fill='000'O
         1 000344   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         1 000345   000036 000024                    ADSC9   30,,PR0                  cn=0,n=20

      207     2053    2       DCT.DP.MIRROR.STATE   = %NI_MIRROR_NONE ;

   2053  1 000346   000400 236003                    LDQ     256,DU
         1 000347   000036 752120                    STCQ    30,'20'O,PR0

      208     2054    2       DCT.DP.MIRROR.DCTX    = MDCTX ;

   2054  1 000350   200007 720100                    LXL0    MDCTX,,AUTO
         1 000351   000037 740100                    STX0    31,,PR0

      209     2055    2       DCT.DP.MIRROR.DRZERO  = MIRROR.DRZERO ;

   2055  1 000352   000000 471400 xsym               LDP1    B$PS0$
         1 000353   100002 235100                    LDA     2,,PR1
         1 000354   000041 755100                    STA     33,,PR0

      210     2056    2       DCT.DP.MIRROR.LQ$     = ADDR(NIL) ;

   2056  1 000355   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000356   000042 756100                    STQ     34,,PR0

      211     2057    2       DCT.DP.MIRROR.PRI     = '1'B ;

   2057  1 000357   020000 236003                    LDQ     8192,DU
         1 000360   000036 256100                    ORSQ    30,,PR0

      212     2058    2       DCT.DP.MIRROR.UTS     = MIRROR.UTS ;

   2058  1 000361   100003 235100                    LDA     3,,PR1
         1 000362   000040 755100                    STA     32,,PR0

      213     2059
      214     2060    2       MDCT.DP.MIRROR        = '0'B ;
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:46   

   2060  1 000363   200006 473500                    LDP3    MDCT$,,AUTO
         1 000364   000100 100400                    MLR     fill='000'O
         1 000365   000002 000001 xsym               ADSC9   B_VECTNIL+2              cn=0,n=1
         1 000366   300036 000024                    ADSC9   30,,PR3                  cn=0,n=20

      215     2061    2       MDCT.DP.MIRROR.STATE  = %NI_MIRROR_NONE ;

   2061  1 000367   000400 236003                    LDQ     256,DU
         1 000370   300036 752120                    STCQ    30,'20'O,PR3

      216     2062    2       MDCT.DP.MIRROR.DCTX   = DCTX ;

   2062  1 000371   200004 721100                    LXL1    DCTX,,AUTO
         1 000372   300037 741100                    STX1    31,,PR3

      217     2063    2       MDCT.DP.MIRROR.DRZERO = MIRROR.DRZERO ;

   2063  1 000373   100002 235100                    LDA     2,,PR1
         1 000374   300041 755100                    STA     33,,PR3

      218     2064    2       MDCT.DP.MIRROR.LQ$    = ADDR(NIL) ;

   2064  1 000375   000001 236000 xsym               LDQ     B_VECTNIL+1
         1 000376   300042 756100                    STQ     34,,PR3

      219     2065    2       MDCT.DP.MIRROR.PRI    = '0'B ;

   2065  1 000377   000005 236000 2                  LDQ     5
         1 000400   300036 356100                    ANSQ    30,,PR3

      220     2066    2       MDCT.DP.MIRROR.UTS    = MIRROR.UTS ;

   2066  1 000401   100003 235100                    LDA     3,,PR1
         1 000402   300040 755100                    STA     32,,PR3

      221     2067
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:47   
      222     2068    2       CALL TDM$MIRSCHEDL ( DCT, STATE, MIRROR.UTS ) ;

   2068  1 000403   000000 236000 xsym               LDQ     B$PS0$
         1 000404   000003 036003                    ADLQ    3,DU
         1 000405   200024 756100                    STQ     @DCT$+4,,AUTO
         1 000406   200015 634500                    EPPR4   STATE,,AUTO
         1 000407   200023 454500                    STP4    @DCT$+3,,AUTO
         1 000410   200003 236100                    LDQ     DCT$,,AUTO
         1 000411   200022 756100                    STQ     @DCT$+2,,AUTO
         1 000412   200022 630500                    EPPR0   @DCT$+2,,AUTO
         1 000413   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000414   000000 701000 xent               TSX1    TDM$MIRSCHEDL
         1 000415   000000 011000                    NOP     0

      223     2069    2       LOCK = '0'B ;

   2069  1 000416   200005 450100                    STZ     LOCK,,AUTO

      224     2070
      225     2071    2       CALL TDM$MIRSCHED  ( MDCT, MSTATE, MIRROR.UTS ) ;

   2071  1 000417   000000 236000 xsym               LDQ     B$PS0$
         1 000420   000003 036003                    ADLQ    3,DU
         1 000421   200024 756100                    STQ     @DCT$+4,,AUTO
         1 000422   200012 630500                    EPPR0   MSTATE,,AUTO
         1 000423   200023 450500                    STP0    @DCT$+3,,AUTO
         1 000424   200006 236100                    LDQ     MDCT$,,AUTO
         1 000425   200022 756100                    STQ     @DCT$+2,,AUTO
         1 000426   200022 630500                    EPPR0   @DCT$+2,,AUTO
         1 000427   000021 631400 xsym               EPPR1   B_VECTNIL+17
         1 000430   000000 701000 xent               TSX1    TDM$MIRSCHED
         1 000431   000000 011000                    NOP     0

      226     2072
      227     2073    2       CALL FMN$AVR ( DCT.DCTX,  %NI_AVR_MIRROR ) ;

   2073  1 000432   000001 236000 2                  LDQ     1
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:48   
         1 000433   200023 756100                    STQ     @DCT$+3,,AUTO
         1 000434   200003 236100                    LDQ     DCT$,,AUTO
         1 000435   000006 036003                    ADLQ    6,DU
         1 000436   200022 756100                    STQ     @DCT$+2,,AUTO
         1 000437   200022 630500                    EPPR0   @DCT$+2,,AUTO
         1 000440   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000441   000000 701000 xent               TSX1    FMN$AVR
         1 000442   000000 011000                    NOP     0

      228     2074    2       CALL FMN$AVR ( MDCT.DCTX, %NI_AVR_MIRROR ) ;

   2074  1 000443   000001 236000 2                  LDQ     1
         1 000444   200023 756100                    STQ     @DCT$+3,,AUTO
         1 000445   200006 236100                    LDQ     MDCT$,,AUTO
         1 000446   000006 036003                    ADLQ    6,DU
         1 000447   200022 756100                    STQ     @DCT$+2,,AUTO
         1 000450   200022 630500                    EPPR0   @DCT$+2,,AUTO
         1 000451   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000452   000000 701000 xent               TSX1    FMN$AVR
         1 000453   000000 011000                    NOP     0
         1 000454   000574 710000 1                  TRA     UNLOCK

      229     2075
      230     2076        %EJECT ;
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:49   
      231     2077    2   CASE ( TDM#SWITCH   ) ;                         /*** SWITCH     ***/

      232     2078
      233     2079    2       CALL CHECK_MIRROR ( DCT )                   ALTRET ( UNLOCK ) ;

   2079  1 000455   200003 236100                    LDQ     DCT$,,AUTO
         1 000456   200017 756100                    STQ     STATE+2,,AUTO
         1 000457   000715 701000 1                  TSX1    CHECK_MIRROR
         1 000460   000574 702000 1                  TSX2    UNLOCK

      234     2080    2       CALL CHECK_OPER   ( DCT )                   ALTRET ( UNLOCK ) ;

   2080  1 000461   200003 236100                    LDQ     DCT$,,AUTO
         1 000462   200017 756100                    STQ     STATE+2,,AUTO
         1 000463   000741 701000 1                  TSX1    CHECK_OPER
         1 000464   000574 702000 1                  TSX2    UNLOCK

      235     2081
      236     2082    2       MDCTX = DCT.DP.MIRROR.DCTX ;

   2082  1 000465   200003 470500                    LDP0    DCT$,,AUTO
         1 000466   000037 236100                    LDQ     31,,PR0
         1 000467   000022 772000                    QRL     18
         1 000470   200007 756100                    STQ     MDCTX,,AUTO

      237     2083    2       MDCT$ = N$DCT$(MDCTX) ;

   2083  1 000471   000000 471400 xsym               LDP1    N$DCT$$
         1 000472   100000 236106                    LDQ     0,QL,PR1
         1 000473   200006 756100                    STQ     MDCT$,,AUTO

      238     2084    2       MSQH$ = MDCT.SQH$ ;

   2084  1 000474   200006 473500                    LDP3    MDCT$,,AUTO
         1 000475   300022 236100                    LDQ     18,,PR3
         1 000476   200011 756100                    STQ     MSQH$,,AUTO

PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:50   
      239     2085    2       CALL CHECK_PRIMARY ( MDCT )                 ALTRET ( UNLOCK ) ;

   2085  1 000477   200006 236100                    LDQ     MDCT$,,AUTO
         1 000500   200017 756100                    STQ     STATE+2,,AUTO
         1 000501   000754 701000 1                  TSX1    CHECK_PRIMARY
         1 000502   000574 702000 1                  TSX2    UNLOCK

      240     2086
      241     2087    2       CALL FMN$MRRSWITCH ( MDCT.DCTX ) ;

   2087  1 000503   200006 236100                    LDQ     MDCT$,,AUTO
         1 000504   000006 036003                    ADLQ    6,DU
         1 000505   200022 756100                    STQ     @DCT$+2,,AUTO
         1 000506   200022 630500                    EPPR0   @DCT$+2,,AUTO
         1 000507   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000510   000000 701000 xent               TSX1    FMN$MRRSWITCH
         1 000511   000000 011000                    NOP     0

      242     2088
      243     2089    2       MDCT.DP.MIRROR.PRI = '0'B ;

   2089  1 000512   200006 470500                    LDP0    MDCT$,,AUTO
         1 000513   000005 236000 2                  LDQ     5
         1 000514   000036 356100                    ANSQ    30,,PR0

      244     2090    2       DCT.DP.MIRROR.PRI  = '1'B ;

   2090  1 000515   200003 471500                    LDP1    DCT$,,AUTO
         1 000516   020000 236003                    LDQ     8192,DU
         1 000517   100036 256100                    ORSQ    30,,PR1
         1 000520   000574 710000 1                  TRA     UNLOCK

      245     2091
      246     2092        %EJECT ;
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:51   
      247     2093    2   CASE ( TDM#UNLOCK   ) ;                         /*** UNLOCK     ***/

      248     2094
      249     2095
      250     2096    2       CALL CHECK_MIRROR ( DCT )                   ALTRET ( UNLOCK ) ;

   2096  1 000521   200003 236100                    LDQ     DCT$,,AUTO
         1 000522   200017 756100                    STQ     STATE+2,,AUTO
         1 000523   000715 701000 1                  TSX1    CHECK_MIRROR
         1 000524   000574 702000 1                  TSX2    UNLOCK

      251     2097    2       CALL CHECK_LOCK   ( DCT )                   ALTRET ( UNLOCK ) ;

   2097  1 000525   200003 236100                    LDQ     DCT$,,AUTO
         1 000526   200017 756100                    STQ     STATE+2,,AUTO
         1 000527   000672 701000 1                  TSX1    CHECK_LOCK
         1 000530   000574 702000 1                  TSX2    UNLOCK

      252     2098    3       DO WHILE ( DCT.DP.MIRROR.LQ$ ~= ADDR(NIL) ) ;

   2098  1 000531   000547 710000 1                  TRA     s:2107

      253     2099                %DEQUEUE ( P#=REQ$, Q#=DCT.DP.MIRROR.LQ$ ) ;

   2103  1 000532   200003 236100                    LDQ     DCT$,,AUTO
         1 000533   000042 036003                    ADLQ    34,DU
         1 000534   200023 756100                    STQ     @DCT$+3,,AUTO
         1 000535   200013 630500                    EPPR0   REQ$,,AUTO
         1 000536   200022 450500                    STP0    @DCT$+2,,AUTO
         1 000537   200022 630500                    EPPR0   @DCT$+2,,AUTO
         1 000540   000020 631400 xsym               EPPR1   B_VECTNIL+16
         1 000541   000000 701000 xent               TSX1    NIM$DEQUEUE
         1 000542   000000 011000                    NOP     0

      254     2106    3           CALL NID$REQSCHEDL ( REQ ) ;

   2106  1 000543   200013 630500                    EPPR0   REQ$,,AUTO
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:52   
         1 000544   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000545   000000 701000 xent               TSX1    NID$REQSCHEDL
         1 000546   000000 011000                    NOP     0

      255     2107    3           END ;

   2107  1 000547   200003 470500                    LDP0    DCT$,,AUTO
         1 000550   000042 236100                    LDQ     34,,PR0
         1 000551   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000552   000532 601000 1                  TNZ     s:2103

      256     2108
      257     2109    2       DCT.DP.MIRROR.LOCK  = '0'B ;

   2109  1 000553   000006 236000 2                  LDQ     6
         1 000554   000036 356100                    ANSQ    30,,PR0

      258     2110    2       DCT.DP.MIRROR.USER# = 0 ;

   2110  1 000555   000000 236003                    LDQ     0,DU
         1 000556   000036 552104                    STBQ    30,'04'O,PR0

      259     2111
      260     2112            %UNLOCK ( G#=SQH.GATE ) ;

   2113  1 000557   200014 630500                    EPPR0   SQH$,,AUTO
         1 000560   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000561   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000562   000000 011000                    NOP     0

      261     2115    2       LOCK = '0'B ;

   2115  1 000563   200005 450100                    STZ     LOCK,,AUTO

      262     2116
      263     2117    2       CALL NID$SCANAQ ( SQH ) ;

PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:53   
   2117  1 000564   200014 630500                    EPPR0   SQH$,,AUTO
         1 000565   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000566   000000 701000 xent               TSX1    NID$SCANAQ
         1 000567   000000 011000                    NOP     0
         1 000570   000574 710000 1                  TRA     UNLOCK

      264     2118
      265     2119        %EJECT ;
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:54   
      266     2120    2   CASE ( ELSE ) ;                                 /*** E$TDBADFUNC ***/

      267     2121        /*E*    ERROR:  TDM-E$TDBADFUNC-4
      268     2122              MESSAGE:  Bad FUNCTION on M$MIRROR PMME.
      269     2123             MESSAGE1:  Only BREAK, CHGSTATE, LOCK, MAKE, SWITCH, or UNLOCK
      270     2124                        are valid FUNCTIONs for M$MIRROR.
      271     2125                                                                           */
      272     2126    2       B$JIT.ERR = TDBADFUNC ;

   2126  1 000571   000001 236000 0                  LDQ     TDBADFUNC
         1 000572   000000 471400 xsym               LDP1    B$JIT$
         1 000573   100012 756100                    STQ     10,,PR1

      273     2127
      274     2128    2       END ; /* DO CASE ( MIRROR.FUNCTION ) */

      275     2129
      276     2130    1   UNLOCK:
      277     2131
      278     2132    1   IF  LOCK

   2132  1 000574   200005 234100       UNLOCK       SZN     LOCK,,AUTO
         1 000575   000603 605000 1                  TPL     s:2140

      279     2133    2   THEN DO ;

      280     2134            %UNLOCK ( G#=SQH.GATE ) ;

   2135  1 000576   200014 630500                    EPPR0   SQH$,,AUTO
         1 000577   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000600   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000601   000000 011000                    NOP     0

      281     2137    2       LOCK = '0'B ;

   2137  1 000602   200005 450100                    STZ     LOCK,,AUTO

PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:55   
      282     2138    2       END ;

      283     2139
      284     2140    1   IF  MLOCK

   2140  1 000603   200010 234100                    SZN     MLOCK,,AUTO
         1 000604   000612 605000 1                  TPL     s:2148

      285     2141    2   THEN DO ;

      286     2142            %UNLOCK ( G#=MSQH.GATE ) ;

   2143  1 000605   200011 630500                    EPPR0   MSQH$,,AUTO
         1 000606   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000607   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000610   000000 011000                    NOP     0

      287     2145    2       MLOCK = '0'B ;

   2145  1 000611   200010 450100                    STZ     MLOCK,,AUTO

      288     2146    2       END ;

      289     2147
      290     2148    1   IF  B$JIT.ERR = '0'B

   2148  1 000612   000000 470400 xsym               LDP0    B$JIT$
         1 000613   000012 235100                    LDA     10,,PR0
         1 000614   000616 601000 1                  TNZ     s:2152

      291     2149    1   THEN
      292     2150    1       RETURN ;

   2150  1 000615   000000 702200 xent               TSX2  ! X66_ARET

      293     2151    1   ELSE
      294     2152    1       CALL UDB$PMMEXIT ;
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:56   

   2152  1 000616   000002 631400 xsym               EPPR1   B_VECTNIL+2
         1 000617   000000 701000 xent               TSX1    UDB$PMMEXIT
         1 000620   000000 011000                    NOP     0
         1 000621   001023 710000 1                  TRA     s:2735

      295     2153
      296     2154        %EJECT ;
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:57   
      297     2155    1   CHECK_DISK:     PROC ( DCTX, DCT$ ) ALTRET ;

   2155  1 000622   200016 741300       CHECK_DISK   STX1  ! STATE+1,,AUTO

      298     2156        /*
      299     2157                        Parameters
      300     2158        */
      301     2159    2   DCL 1 DCTX      SBIN WORD ALIGNED PARAM ;
      302     2160    2   DCL 1 DCT$      PTR ALIGNED PARAM ;
      303     2161
      304     2162
      305     2163
      306     2164    2   DCT$ = N$DCT$(DCTX) ;

   2164  1 000623   200017 470500                    LDP0    @DCTX,,AUTO
         1 000624   000000 720100                    LXL0    0,,PR0
         1 000625   000000 471400 xsym               LDP1    N$DCT$$
         1 000626   100000 236110                    LDQ     0,X0,PR1
         1 000627   200020 473500                    LDP3    @DCT$,,AUTO
         1 000630   300000 756100                    STQ     0,,PR3

      307     2165
      308     2166    2   IF  DCTX = 0

   2166  1 000631   000000 235100                    LDA     0,,PR0
         1 000632   000647 600000 1                  TZE     s:2178
         1 000633   000000 236000 xsym               LDQ     NK_MXLOCAL
         1 000634   000637 604000 1                  TMI     s:2166+6
         1 000635   000000 116100                    CMPQ    0,,PR0
         1 000636   000647 604000 1                  TMI     s:2178
         1 000637   300000 236100                    LDQ     0,,PR3
         1 000640   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000641   000647 600000 1                  TZE     s:2178
         1 000642   200003 471500                    LDP1    DCT$,,AUTO
         1 000643   100007 236100                    LDQ     7,,PR1
         1 000644   007700 376007                    ANQ     4032,DL
         1 000645   000600 116007                    CMPQ    384,DL
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:58   
         1 000646   000654 600000 1                  TZE     s:2182

      309     2167    2   OR  DCTX > NK_MXLOCAL
      310     2168    2   OR  DCT$ = ADDR(NIL)
      311     2169    2   OR  DCT.TYPE ~= %DV_DP
      312     2170    3   THEN DO ;

      313     2171        /*E*       ERROR:  TDM-E$TDBADDISK-4
      314     2172                 MESSAGE:  Bad device control table index (DCTX) value.
      315     2173                MESSAGE1:  The specified DCTX or MDCTX value does not
      316     2174                           correspond to a local disk device.
      317     2175             DESCRIPTION:  The DCTX and MDCTX (if used) parameters must
      318     2176                           correspond to a local disk device.
      319     2177                                                                           */
      320     2178    3       B$JIT.ERR = TDBADDISK ;

   2178  1 000647   000000 236000 0                  LDQ     TDBADDISK
         1 000650   000000 471400 xsym               LDP1    B$JIT$
         1 000651   100012 756100                    STQ     10,,PR1

      321     2179    3       ALTRETURN ;

   2179  1 000652   200016 221300                    LDX1  ! STATE+1,,AUTO
         1 000653   000000 702211                    TSX2  ! 0,X1

      322     2180    3       END ;
      323     2181
      324     2182    2   RETURN ;

   2182  1 000654   200016 221300                    LDX1  ! STATE+1,,AUTO
         1 000655   000001 702211                    TSX2  ! 1,X1

      325     2183
      326     2184    2   END CHECK_DISK ;
      327     2185
      328     2186        %EJECT ;
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:59   
      329     2187    1   CHECK_FAIL:     PROC ( DCT ) ALTRET ;

   2187  1 000656   200016 741300       CHECK_FAIL   STX1  ! STATE+1,,AUTO

      330     2188        /*
      331     2189                        Parameters
      332     2190        */
      333     2191        %NI$DCT                 ( NAME=DCT, STCLASS=PARAM ) ;
      334     2239
      335     2240
      336     2241
      337     2242    2   IF  DCT.DP.MIRROR.STATE = %NI_MIRROR_FAIL

   2242  1 000657   200017 470500                    LDP0    @DCT,,AUTO
         1 000660   000036 236100                    LDQ     30,,PR0
         1 000661   007700 376003                    ANQ     4032,DU
         1 000662   000100 116003                    CMPQ    64,DU
         1 000663   000665 601000 1                  TNZ     s:2252

      338     2243    2   THEN
      339     2244    2       RETURN ;

   2244  1 000664   000001 702211                    TSX2  ! 1,X1

      340     2245
      341     2246        /*E* ERROR:  TDM-E$TDNOTFAIL-4
      342     2247             MESSAGE:  Mirrored Disk device is not failed.
      343     2248             DESCRIPTION:  The specified Mirrored Disk device is not
      344     2249                           failed.  For this function, the specified
      345     2250                           Mirrored Disk device must be failed.
      346     2251                                                                           */
      347     2252    2   B$JIT.ERR = TDNOTFAIL ;

   2252  1 000665   000004 236000 0                  LDQ     TDNOTFAIL
         1 000666   000000 471400 xsym               LDP1    B$JIT$
         1 000667   100012 756100                    STQ     10,,PR1

PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:60   
      348     2253
      349     2254    2   ALTRETURN ;

   2254  1 000670   200016 221300                    LDX1  ! STATE+1,,AUTO
         1 000671   000000 702211                    TSX2  ! 0,X1

      350     2255
      351     2256    2   END CHECK_FAIL ;
      352     2257
      353     2258        %EJECT ;
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:61   
      354     2259    1   CHECK_LOCK:     PROC ( DCT ) ALTRET ;

   2259  1 000672   200016 741300       CHECK_LOCK   STX1  ! STATE+1,,AUTO

      355     2260        /*
      356     2261                        Parameters
      357     2262        */
      358     2263        %NI$DCT                 ( NAME=DCT, STCLASS=PARAM ) ;
      359     2311
      360     2312
      361     2313
      362     2314    2   IF  DCT.DP.MIRROR.LOCK

   2314  1 000673   200017 470500                    LDP0    @DCT,,AUTO
         1 000674   000036 236100                    LDQ     30,,PR0
         1 000675   040000 316003                    CANQ    16384,DU
         1 000676   000710 600000 1                  TZE     s:2341

      363     2315    2   THEN
      364     2316    2       IF  DCT.DP.MIRROR.USER# = S_CUN

   2316  1 000677   000036 236100                    LDQ     30,,PR0
         1 000700   000777 376007                    ANQ     511,DL
         1 000701   000000 116000 xsym               CMPQ    S_CUN
         1 000702   000704 601000 1                  TNZ     s:2329

      365     2317    2       THEN
      366     2318    2           RETURN ;

   2318  1 000703   000001 702211                    TSX2  ! 1,X1

      367     2319    2       ELSE
      368     2320
      369     2321        /*E*
      370     2322        ERROR:  TDM-E$TDNOTLOCKER-4
      371     2323        MESSAGE:  Device is locked by another user.
      372     2324        DESCRIPTION:  The Mirrored Disk device is locked by
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:62   
      373     2325                      another user.  A locked Mirrored Disk device
      374     2326                      can only be unlocked by the user who locked it.
      375     2327        */
      376     2328
      377     2329    2           B$JIT.ERR = TDNOTLOCKER ;

   2329  1 000704   000006 236000 0                  LDQ     TDNOTLOCKER
         1 000705   000000 471400 xsym               LDP1    B$JIT$
         1 000706   100012 756100                    STQ     10,,PR1
         1 000707   000713 710000 1                  TRA     s:2343

      378     2330
      379     2331    2   ELSE
      380     2332
      381     2333        /*E*
      382     2334        ERROR:  TDM-E$TDNOTLOCKED-4
      383     2335        MESSAGE:  Device is not locked.
      384     2336        DESCRIPTION:  The Mirrored Disk device is not locked.  A
      385     2337                      Mirrored Disk device can only be unlocked if
      386     2338                      it has been previously been locked.
      387     2339        */
      388     2340
      389     2341    2       B$JIT.ERR = TDNOTLOCKED ;

   2341  1 000710   000005 236000 0                  LDQ     TDNOTLOCKED
         1 000711   000000 471400 xsym               LDP1    B$JIT$
         1 000712   100012 756100                    STQ     10,,PR1

      390     2342
      391     2343    2   ALTRETURN ;

   2343  1 000713   200016 221300                    LDX1  ! STATE+1,,AUTO
         1 000714   000000 702211                    TSX2  ! 0,X1

      392     2344
      393     2345    2   END CHECK_LOCK ;
      394     2346
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:63   
      395     2347        %EJECT ;
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:64   
      396     2348    1   CHECK_MIRROR:   PROC ( DCT ) ALTRET ;

   2348  1 000715   200016 741300       CHECK_MIRROR STX1  ! STATE+1,,AUTO

      397     2349        /*
      398     2350                        Parameters
      399     2351        */
      400     2352        %NI$DCT                 ( NAME=DCT,     STCLASS=PARAM ) ;
      401     2400
      402     2401
      403     2402
      404     2403    2   IF  DCT.DP.MIRROR.FLAG

   2403  1 000716   200017 470500                    LDP0    @DCT,,AUTO
         1 000717   000036 234100                    SZN     30,,PR0
         1 000720   000722 605000 1                  TPL     s:2414

      405     2404    2   THEN
      406     2405    2       RETURN ;

   2405  1 000721   000001 702211                    TSX2  ! 1,X1

      407     2406
      408     2407        /*E*       ERROR:  TDM-E$TDNOTMIRROR-4
      409     2408                 MESSAGE:  Device is not a Mirrored Disk device.
      410     2409             DESCRIPTION:  The device specified must be a
      411     2410                           Mirrored Disk device.  The device specified
      412     2411                           by either DCTX or MDCTX (if used) is not a
      413     2412                           Mirrored Disk device.
      414     2413                                                                           */
      415     2414    2   B$JIT.ERR = TDNOTMIRROR ;

   2414  1 000722   000007 236000 0                  LDQ     TDNOTMIRROR
         1 000723   000000 471400 xsym               LDP1    B$JIT$
         1 000724   100012 756100                    STQ     10,,PR1

      416     2415
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:65   
      417     2416    2   ALTRETURN ;

   2416  1 000725   200016 221300                    LDX1  ! STATE+1,,AUTO
         1 000726   000000 702211                    TSX2  ! 0,X1

      418     2417
      419     2418    2   END CHECK_MIRROR ;
      420     2419
      421     2420        %EJECT ;
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:66   
      422     2421    1   CHECK_NOMIRROR: PROC ( DCT ) ALTRET ;

   2421  1 000727   200016 741300       CHECK_NOMIR* STX1  ! STATE+1,,AUTO

      423     2422        /*
      424     2423                        Parameters
      425     2424        */
      426     2425        %NI$DCT                 ( NAME=DCT,     STCLASS=PARAM ) ;
      427     2473
      428     2474
      429     2475
      430     2476    2   IF  NOT DCT.DP.MIRROR.FLAG

   2476  1 000730   200017 470500                    LDP0    @DCT,,AUTO
         1 000731   000036 234100                    SZN     30,,PR0
         1 000732   000734 604000 1                  TMI     s:2487

      431     2477    2   THEN
      432     2478    2       RETURN ;

   2478  1 000733   000001 702211                    TSX2  ! 1,X1

      433     2479
      434     2480        /*E*       ERROR:  TDM-E$TDMIRROR-4
      435     2481                 MESSAGE:  Device is a Mirrored Disk device.
      436     2482             DESCRIPTION:  The device specified must not be a
      437     2483                           Mirrored Disk device.  The device specified
      438     2484                           by either DCTX or MDCTX already
      439     2485                           is a Mirrored Disk device.
      440     2486                                                                           */
      441     2487    2   B$JIT.ERR = TDMIRROR ;

   2487  1 000734   000003 236000 0                  LDQ     TDMIRROR
         1 000735   000000 471400 xsym               LDP1    B$JIT$
         1 000736   100012 756100                    STQ     10,,PR1

      442     2488
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:67   
      443     2489    2   ALTRETURN ;

   2489  1 000737   200016 221300                    LDX1  ! STATE+1,,AUTO
         1 000740   000000 702211                    TSX2  ! 0,X1

      444     2490
      445     2491    2   END CHECK_NOMIRROR ;
      446     2492
      447     2493        %EJECT ;
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:68   
      448     2494    1   CHECK_OPER:     PROC ( DCT ) ALTRET ;

   2494  1 000741   200016 741300       CHECK_OPER   STX1  ! STATE+1,,AUTO

      449     2495        /*
      450     2496                        Parameters
      451     2497        */
      452     2498        %NI$DCT                 ( NAME=DCT, STCLASS=PARAM ) ;
      453     2546
      454     2547
      455     2548
      456     2549    2   IF  DCT.DP.MIRROR.STATE = %NI_MIRROR_OPER

   2549  1 000742   200017 470500                    LDP0    @DCT,,AUTO
         1 000743   000036 236100                    LDQ     30,,PR0
         1 000744   007700 316003                    CANQ    4032,DU
         1 000745   000747 601000 1                  TNZ     s:2559

      457     2550    2   THEN
      458     2551    2       RETURN ;

   2551  1 000746   000001 702211                    TSX2  ! 1,X1

      459     2552
      460     2553        /*E* ERROR:  TDM-E$TDNOTOPER-4
      461     2554             MESSAGE:  Mirrored Disk device is not operational.
      462     2555             DESCRIPTION:  The specified Mirrored Disk device is not
      463     2556                           operational.  For this function, the specified
      464     2557                           Mirrored Disk device must be operational.
      465     2558                                                                           */
      466     2559    2   B$JIT.ERR = TDNOTOPER ;

   2559  1 000747   000010 236000 0                  LDQ     TDNOTOPER
         1 000750   000000 471400 xsym               LDP1    B$JIT$
         1 000751   100012 756100                    STQ     10,,PR1

      467     2560
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:69   
      468     2561    2   ALTRETURN ;

   2561  1 000752   200016 221300                    LDX1  ! STATE+1,,AUTO
         1 000753   000000 702211                    TSX2  ! 0,X1

      469     2562
      470     2563    2   END CHECK_OPER ;
      471     2564
      472     2565        %EJECT ;
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:70   
      473     2566    1   CHECK_PRIMARY:  PROC ( DCT ) ALTRET ;

   2566  1 000754   200016 741300       CHECK_PRIMA* STX1  ! STATE+1,,AUTO

      474     2567        /*
      475     2568                        Parameters
      476     2569        */
      477     2570        %NI$DCT                 ( NAME=DCT, STCLASS=PARAM ) ;
      478     2618
      479     2619
      480     2620
      481     2621    2   IF  DCT.DP.MIRROR.PRI

   2621  1 000755   200017 470500                    LDP0    @DCT,,AUTO
         1 000756   000036 236100                    LDQ     30,,PR0
         1 000757   020000 316003                    CANQ    8192,DU
         1 000760   000762 600000 1                  TZE     s:2632

      482     2622    2   THEN
      483     2623    2       RETURN ;

   2623  1 000761   000001 702211                    TSX2  ! 1,X1

      484     2624
      485     2625        /*E* ERROR:  TDM-E$TDNOTPRI-4
      486     2626             MESSAGE:  Mirrored Disk device is not primary.
      487     2627             DESCRIPTION:  The Mirrored Disk device is not a primary
      488     2628                           Mirrored Disk device.  For this function,
      489     2629                           the specified Mirrored Disk device must be
      490     2630                           a primary Mirrored Disk device.
      491     2631                                                                           */
      492     2632    2   B$JIT.ERR = TDNOTPRI ;

   2632  1 000762   000011 236000 0                  LDQ     TDNOTPRI
         1 000763   000000 471400 xsym               LDP1    B$JIT$
         1 000764   100012 756100                    STQ     10,,PR1

PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:71   
      493     2633
      494     2634    2   ALTRETURN ;

   2634  1 000765   200016 221300                    LDX1  ! STATE+1,,AUTO
         1 000766   000000 702211                    TSX2  ! 0,X1

      495     2635
      496     2636    2   END CHECK_PRIMARY ;
      497     2637
      498     2638        %EJECT ;
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:72   
      499     2639    1   CHECK_STATE:    PROC ( STATE ) ALTRET ;

   2639  1 000767   200016 741300       CHECK_STATE  STX1  ! STATE+1,,AUTO

      500     2640        /*
      501     2641                        Parameters
      502     2642        */
      503     2643    2   DCL 1 STATE     SBIN WORD ALIGNED PARAM ;
      504     2644
      505     2645
      506     2646
      507     2647    3   DO CASE ( STATE ) ;

   2647  1 000770   200017 470500                    LDP0    @STATE,,AUTO
         1 000771   000000 235100                    LDA     0,,PR0
         1 000772   000005 115007                    CMPA    5,DL
         1 000773   000775 602005 1                  TNC     s:2647+5,AL
         1 000774   001003 710000 1                  TRA     s:2653
         1 000775   001002 710000 1                  TRA     s:2650
         1 000776   001002 710000 1                  TRA     s:2650
         1 000777   001002 710000 1                  TRA     s:2650
         1 001000   001002 710000 1                  TRA     s:2650
         1 001001   001002 710000 1                  TRA     s:2650

      508     2648
      509     2649    3   CASE ( %NI_MIRROR_FAIL, %NI_MIRROR_NONE, %NI_MIRROR_OPER, %NI_MIRROR_REST, %
              2649            NI_MIRROR_WAIT ) ;

      510     2650    3       RETURN ;

   2650  1 001002   000001 702211                    TSX2  ! 1,X1

      511     2651
      512     2652    3   CASE ( ELSE ) ;

      513     2653    3       B$JIT.ERR = TDBADSTATE ;

PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:73   
   2653  1 001003   000002 236000 0                  LDQ     TDBADSTATE
         1 001004   000000 471400 xsym               LDP1    B$JIT$
         1 001005   100012 756100                    STQ     10,,PR1

      514     2654    3       ALTRETURN ;

   2654  1 001006   200016 221300                    LDX1  ! STATE+1,,AUTO
         1 001007   000000 702211                    TSX2  ! 0,X1

      515     2655
      516     2656    3       END ;

      517     2657
      518     2658    2   END CHECK_STATE ;
      519     2659
      520     2660        %EJECT ;
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:74   
      521     2661    1   CHECK_UNLOCK:   PROC ( DCT ) ALTRET ;

   2661  1 001010   200016 741300       CHECK_UNLOCK STX1  ! STATE+1,,AUTO

      522     2662        /*
      523     2663                        Parameters
      524     2664        */
      525     2665        %NI$DCT                 ( NAME=DCT, STCLASS=PARAM ) ;
      526     2713
      527     2714
      528     2715
      529     2716    2   IF  NOT DCT.DP.MIRROR.LOCK

   2716  1 001011   200017 470500                    LDP0    @DCT,,AUTO
         1 001012   000036 236100                    LDQ     30,,PR0
         1 001013   040000 316003                    CANQ    16384,DU
         1 001014   001016 601000 1                  TNZ     s:2728

      530     2717    2   THEN
      531     2718    2       RETURN ;

   2718  1 001015   000001 702211                    TSX2  ! 1,X1

      532     2719
      533     2720        /*E*
      534     2721        ERROR:  TDM-E$TDNOTUNLOCKED-4
      535     2722        MESSAGE:  Device is not unlocked.
      536     2723        DESCRIPTION:  The Mirrored Disk device is not unlocked.  A
      537     2724                      Mirrored Disk device can only be locked if
      538     2725                      it is not currently locked.
      539     2726        */
      540     2727
      541     2728    2       B$JIT.ERR = TDNOTUNLOCKED ;

   2728  1 001016   000012 236000 0                  LDQ     TDNOTUNLOCKED
         1 001017   000000 471400 xsym               LDP1    B$JIT$
         1 001020   100012 756100                    STQ     10,,PR1
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:75   

      542     2729
      543     2730    2   ALTRETURN ;

   2730  1 001021   200016 221300                    LDX1  ! STATE+1,,AUTO
         1 001022   000000 702211                    TSX2  ! 0,X1

      544     2731
      545     2732    2   END CHECK_UNLOCK ;
      546     2733
      547     2734
      548     2735    1   END TDM$MIRROR ;

   2735  1 001023   000000 702200 xent               TSX2  ! X66_ARET

TDBADDISK
 Sect OctLoc
   0     000   241500 432634                                                    ....

TDBADFUNC
 Sect OctLoc
   0     001   241500 432644                                                    ....

TDBADSTATE
 Sect OctLoc
   0     002   241500 432654                                                    ....

TDMIRROR
 Sect OctLoc
   0     003   241500 432724                                                    ....

TDNOTFAIL
 Sect OctLoc
   0     004   241500 432674                                                    ....

TDNOTLOCKED
 Sect OctLoc
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:76   
   0     005   241500 432734                                                    ....

TDNOTLOCKER
 Sect OctLoc
   0     006   241500 432744                                                    ....

TDNOTMIRROR
 Sect OctLoc
   0     007   241500 432664                                                    ....

TDNOTOPER
 Sect OctLoc
   0     010   241500 432704                                                    ....

TDNOTPRI
 Sect OctLoc
   0     011   241500 432714                                                    ....

TDNOTUNLOCKED
 Sect OctLoc
   0     012   241500 432754                                                    ....

(unnamed)
 Sect OctLoc
   2     000   000006 006000   000007 006000   000000 000031   000004 006000    ................
   2     004   000002 006000   757777 777777   737777 777777                    ............
      549     2736        %EOD ;

PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:77   
--  Include file information  --

   TD_ERRORS_C.:E05TOU  is referenced.
   TD$CP6V_C.:E05TOU  is referenced.
   SS_SCHED_C.:E05TOU  is referenced.
   NI_MACROS_C.:E05TOU  cannot be made into a system file and is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NI_DATA_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   B$JIT_C.:E05TOU  is referenced.
      No diagnostics issued in procedure TDM$MIRROR.
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:78   

 **** Variables and constants ****

  ****  Section 000 RoData TDM$MIRROR

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC        r     1 TDBADDISK                  1-0-0/w STRC        r     1 TDBADFUNC
     2-0-0/w STRC        r     1 TDBADSTATE                 3-0-0/w STRC        r     1 TDMIRROR
     4-0-0/w STRC        r     1 TDNOTFAIL                  5-0-0/w STRC        r     1 TDNOTLOCKED
     6-0-0/w STRC        r     1 TDNOTLOCKER                7-0-0/w STRC        r     1 TDNOTMIRROR
    10-0-0/w STRC        r     1 TDNOTOPER                 11-0-0/w STRC        r     1 TDNOTPRI
    12-0-0/w STRC        r     1 TDNOTUNLOCKED

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

    17-0-0/w PTR         r     1 @DCT                      17-0-0/w PTR         r     1 @DCT
    17-0-0/w PTR         r     1 @DCT                      17-0-0/w PTR         r     1 @DCT
    17-0-0/w PTR         r     1 @DCT                      17-0-0/w PTR         r     1 @DCT
    17-0-0/w PTR         r     1 @DCT                      20-0-0/w PTR         r     1 @DCT$
    17-0-0/w PTR         r     1 @DCTX                     17-0-0/w PTR         r     1 @STATE
    *0-0-0/w STRC(1332)  r     1 DCT                       *0-0-0/w STRC(1332)  r     1 DCT
    *0-0-0/w STRC(1332)  r     1 DCT                       *0-0-0/w STRC(1332)  r     1 DCT
    *0-0-0/w STRC(1332)  r     1 DCT                       *0-0-0/w STRC(1332)  r     1 DCT
    *0-0-0/w STRC(1332)  r     1 DCT                        3-0-0/w PTR         r     1 DCT$
    *0-0-0/w PTR         r     1 DCT$                       4-0-0/w SBIN        r     1 DCTX
    *0-0-0/w SBIN        r     1 DCTX                       5-0-0/w BIT         r     1 LOCK
     6-0-0/w PTR         r     1 MDCT$                      7-0-0/w SBIN        r     1 MDCTX
    10-0-0/w BIT         r     1 MLOCK                     11-0-0/w PTR         r     1 MSQH$
    12-0-0/w SBIN        r     1 MSTATE                    13-0-0/w PTR         r     1 REQ$
    14-0-0/w PTR         r     1 SQH$                      15-0-0/w SBIN        r     1 STATE
    *0-0-0/w SBIN        r     1 STATE

  ****  SYMREF variables  ****
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:79   

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 B$PS0$
     0-0-0/w PTR         r     1 N$DCT$$                    0-0-0/w PTR         r     1 N$FQ$
     0-0-0/w PTR         r     1 NI$FQ$                     0-0-0/w PTR         r     1 NI$IBUF$
     0-0-0/w PTR         r     1 NI$RP$                     0-0-0/w UBIN        r     1 NK_MXLOCAL
     0-0-0/w UBIN        r     1 S_CUN

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8568)  r     1 B$JIT                      0-0-0/w STRC(1332)  r     1 DCT
     0-0-0/w STRC(1332)  r     1 MDCT                       0-0-0/d STRC(144)   r     1 MIRROR
     0-0-0/w STRC(252)   r     1 MSQH                       0-0-0/w PTR         r     1 N$DCT$(0:0)
     0-0-0/d STRC(1080)  r     1 REQ                        0-0-0/w STRC(252)   r     1 SQH


   Procedure TDM$MIRROR requires 532 words for executable code.
   Procedure TDM$MIRROR requires 22 words of local(AUTO) storage.
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:80   
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:81   
          MINI XREF LISTING

B$JIT.ERR
      1573**DCL      2126<<ASSIGN   2148>>IF       2178<<ASSIGN   2252<<ASSIGN   2329<<ASSIGN   2341<<ASSIGN
      2414<<ASSIGN   2487<<ASSIGN   2559<<ASSIGN   2632<<ASSIGN   2653<<ASSIGN   2728<<ASSIGN
B$JIT.ERR.MID
      1574**DCL      1574--REDEF
B$JIT.PNR
      1670**DCL      1670--REDEF
B$JIT$
      1546**DCL      1568--IMP-PTR  2126>>ASSIGN   2148>>IF       2178>>ASSIGN   2252>>ASSIGN   2329>>ASSIGN
      2341>>ASSIGN   2414>>ASSIGN   2487>>ASSIGN   2559>>ASSIGN   2632>>ASSIGN   2653>>ASSIGN   2728>>ASSIGN
B$PS0$
      1547**DCL      1844--IMP-PTR  1960>>ASSIGN   1969>>DOCASE   1978>>CALL     1999>>CALL     2008>>ASSIGN
      2010>>CALL     2041>>ASSIGN   2042>>ASSIGN   2046>>ASSIGN   2055>>ASSIGN   2058>>ASSIGN   2063>>ASSIGN
      2066>>ASSIGN   2068>>CALL     2071>>CALL
CHECK_DISK
      2155**PROC     1961--CALL     2047--CALL
CHECK_LOCK
      2259**PROC     2097--CALL
CHECK_MIRROR
      2348**PROC     1983--CALL     2007--CALL     2016--CALL     2079--CALL     2096--CALL
CHECK_NOMIRROR
      2421**PROC     1977--CALL     2040--CALL     2050--CALL
CHECK_OPER
      2494**PROC     1987--CALL     2080--CALL
CHECK_PRIMARY
      2566**PROC     2085--CALL
CHECK_STATE
      2639**PROC     2009--CALL     2043--CALL     2044--CALL
CHECK_UNLOCK
      2661**PROC     2017--CALL
DCT
      1743**DCL      1977<>CALL     1978<>CALL     1983<>CALL     1987<>CALL     2007<>CALL     2010<>CALL
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:82   
      2016<>CALL     2017<>CALL     2040<>CALL     2068<>CALL     2079<>CALL     2080<>CALL     2096<>CALL
      2097<>CALL
DCT.DCTX
      1744**DCL      1980<>CALL     2073<>CALL
DCT.DP
      1763**DCL      1770--REDEF    1773--REDEF    1774--REDEF    1776--REDEF    1776--REDEF    1777--REDEF
      1778--REDEF    1778--REDEF
DCT.DP.BQ$
      1763**DCL      2022>>DOWHILE
DCT.DP.MIRROR
      1765**DCL      2052<<ASSIGN
DCT.DP.MIRROR.DCTX
      1768**DCL      1984>>ASSIGN   2054<<ASSIGN   2082>>ASSIGN
DCT.DP.MIRROR.DRZERO
      1769**DCL      2055<<ASSIGN
DCT.DP.MIRROR.LOCK
      1766**DCL      2019<<ASSIGN   2109<<ASSIGN
DCT.DP.MIRROR.LQ$
      1770**DCL      2056<<ASSIGN   2098>>DOWHILE  2103<>CALL
DCT.DP.MIRROR.PRI
      1767**DCL      2057<<ASSIGN   2090<<ASSIGN
DCT.DP.MIRROR.STATE
      1767**DCL      1975>>IF       2053<<ASSIGN
DCT.DP.MIRROR.USER#
      1768**DCL      2020<<ASSIGN   2110<<ASSIGN
DCT.DP.MIRROR.UTS
      1769**DCL      2058<<ASSIGN
DCT.MPC.IOCHANX
      1771**DCL      1771--REDEF
DCT.SQ$
      1743**DCL      2022>>DOWHILE
DCT.SQH$
      1758**DCL      1962>>ASSIGN
DCT.STATE
      1753**DCL      2022>>DOWHILE
DCT.TYPE
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:83   
      1753**DCL      2166>>IF
DCT IN PROCEDURE CHECK_FAIL
      2200**DCL      2187--PROC
DCT.DP IN PROCEDURE CHECK_FAIL
      2220**DCL      2227--REDEF    2230--REDEF    2231--REDEF    2233--REDEF    2233--REDEF    2234--REDEF
      2235--REDEF    2235--REDEF
DCT.DP.MIRROR.STATE IN PROCEDURE CHECK_FAIL
      2224**DCL      2242>>IF
DCT.MPC.IOCHANX IN PROCEDURE CHECK_FAIL
      2228**DCL      2228--REDEF
DCT IN PROCEDURE CHECK_LOCK
      2272**DCL      2259--PROC
DCT.DP IN PROCEDURE CHECK_LOCK
      2292**DCL      2299--REDEF    2302--REDEF    2303--REDEF    2305--REDEF    2305--REDEF    2306--REDEF
      2307--REDEF    2307--REDEF
DCT.DP.MIRROR.LOCK IN PROCEDURE CHECK_LOCK
      2295**DCL      2314>>IF
DCT.DP.MIRROR.USER# IN PROCEDURE CHECK_LOCK
      2297**DCL      2316>>IF
DCT.MPC.IOCHANX IN PROCEDURE CHECK_LOCK
      2300**DCL      2300--REDEF
DCT IN PROCEDURE CHECK_MIRROR
      2361**DCL      2348--PROC
DCT.DP IN PROCEDURE CHECK_MIRROR
      2381**DCL      2388--REDEF    2391--REDEF    2392--REDEF    2394--REDEF    2394--REDEF    2395--REDEF
      2396--REDEF    2396--REDEF
DCT.DP.MIRROR.FLAG IN PROCEDURE CHECK_MIRROR
      2383**DCL      2403>>IF
DCT.MPC.IOCHANX IN PROCEDURE CHECK_MIRROR
      2389**DCL      2389--REDEF
DCT IN PROCEDURE CHECK_NOMIRROR
      2434**DCL      2421--PROC
DCT.DP IN PROCEDURE CHECK_NOMIRROR
      2454**DCL      2461--REDEF    2464--REDEF    2465--REDEF    2467--REDEF    2467--REDEF    2468--REDEF
      2469--REDEF    2469--REDEF
DCT.DP.MIRROR.FLAG IN PROCEDURE CHECK_NOMIRROR
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:84   
      2456**DCL      2476>>IF
DCT.MPC.IOCHANX IN PROCEDURE CHECK_NOMIRROR
      2462**DCL      2462--REDEF
DCT IN PROCEDURE CHECK_OPER
      2507**DCL      2494--PROC
DCT.DP IN PROCEDURE CHECK_OPER
      2527**DCL      2534--REDEF    2537--REDEF    2538--REDEF    2540--REDEF    2540--REDEF    2541--REDEF
      2542--REDEF    2542--REDEF
DCT.DP.MIRROR.STATE IN PROCEDURE CHECK_OPER
      2531**DCL      2549>>IF
DCT.MPC.IOCHANX IN PROCEDURE CHECK_OPER
      2535**DCL      2535--REDEF
DCT IN PROCEDURE CHECK_PRIMARY
      2579**DCL      2566--PROC
DCT.DP IN PROCEDURE CHECK_PRIMARY
      2599**DCL      2606--REDEF    2609--REDEF    2610--REDEF    2612--REDEF    2612--REDEF    2613--REDEF
      2614--REDEF    2614--REDEF
DCT.DP.MIRROR.PRI IN PROCEDURE CHECK_PRIMARY
      2603**DCL      2621>>IF
DCT.MPC.IOCHANX IN PROCEDURE CHECK_PRIMARY
      2607**DCL      2607--REDEF
DCT IN PROCEDURE CHECK_UNLOCK
      2674**DCL      2661--PROC
DCT.DP IN PROCEDURE CHECK_UNLOCK
      2694**DCL      2701--REDEF    2704--REDEF    2705--REDEF    2707--REDEF    2707--REDEF    2708--REDEF
      2709--REDEF    2709--REDEF
DCT.DP.MIRROR.LOCK IN PROCEDURE CHECK_UNLOCK
      2697**DCL      2716>>IF
DCT.MPC.IOCHANX IN PROCEDURE CHECK_UNLOCK
      2702**DCL      2702--REDEF
DCT$
      1553**DCL      1743--IMP-PTR  1961<>CALL     1962>>ASSIGN   1975>>IF       1977>>CALL     1978>>CALL
      1980>>CALL     1983>>CALL     1984>>ASSIGN   1987>>CALL     2007>>CALL     2010>>CALL     2016>>CALL
      2017>>CALL     2019>>ASSIGN   2020>>ASSIGN   2022>>DOWHILE  2022>>DOWHILE  2022>>DOWHILE  2040>>CALL
      2052>>ASSIGN   2053>>ASSIGN   2054>>ASSIGN   2055>>ASSIGN   2056>>ASSIGN   2057>>ASSIGN   2058>>ASSIGN
      2068>>CALL     2073>>CALL     2079>>CALL     2080>>CALL     2082>>ASSIGN   2090>>ASSIGN   2096>>CALL
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:85   
      2097>>CALL     2098>>DOWHILE  2103>>CALL     2109>>ASSIGN   2110>>ASSIGN   2166>>IF
DCT$ IN PROCEDURE CHECK_DISK
      2160**DCL      2155--PROC     2164<<ASSIGN   2166>>IF
DCTX
      1554**DCL      1960<<ASSIGN   1961<>CALL     2062>>ASSIGN
DCTX IN PROCEDURE CHECK_DISK
      2159**DCL      2155--PROC     2164>>ASSIGN   2166>>IF       2166>>IF
FMN$AVR
      1534**DCL-ENT  1980--CALL     2073--CALL     2074--CALL
FMN$MRRSWITCH
      1535**DCL-ENT  2087--CALL
HFC$LOCK
       361**DCL-ENT  1965--CALL     1995--CALL     2032--CALL
HFC$UNLOCK
       361**DCL-ENT  1991--CALL     2026--CALL     2113--CALL     2135--CALL     2143--CALL
LOCK
      1555**DCL      1954<<ASSIGN   1967<<ASSIGN   1979<<ASSIGN   1993<<ASSIGN   2000<<ASSIGN   2011<<ASSIGN
      2028<<ASSIGN   2034<<ASSIGN   2069<<ASSIGN   2115<<ASSIGN   2132>>IF       2137<<ASSIGN
MDCT
      1791**DCL      1999<>CALL     2050<>CALL     2071<>CALL     2085<>CALL
MDCT.DCTX
      1792**DCL      2074<>CALL     2087<>CALL
MDCT.DP
      1811**DCL      1818--REDEF    1821--REDEF    1822--REDEF    1824--REDEF    1824--REDEF    1825--REDEF
      1826--REDEF    1826--REDEF
MDCT.DP.MIRROR
      1813**DCL      2060<<ASSIGN
MDCT.DP.MIRROR.DCTX
      1816**DCL      2062<<ASSIGN
MDCT.DP.MIRROR.DRZERO
      1817**DCL      2063<<ASSIGN
MDCT.DP.MIRROR.LQ$
      1818**DCL      2064<<ASSIGN
MDCT.DP.MIRROR.PRI
      1815**DCL      2065<<ASSIGN   2089<<ASSIGN
MDCT.DP.MIRROR.STATE
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:86   
      1815**DCL      2061<<ASSIGN
MDCT.DP.MIRROR.UTS
      1817**DCL      2066<<ASSIGN
MDCT.MPC.IOCHANX
      1819**DCL      1819--REDEF
MDCT.SQH$
      1806**DCL      1986>>ASSIGN   2048>>ASSIGN   2084>>ASSIGN
MDCT$
      1556**DCL      1791--IMP-PTR  1957<<ASSIGN   1985<<ASSIGN   1986>>ASSIGN   1999>>CALL     2047<>CALL
      2048>>ASSIGN   2050>>CALL     2060>>ASSIGN   2061>>ASSIGN   2062>>ASSIGN   2063>>ASSIGN   2064>>ASSIGN
      2065>>ASSIGN   2066>>ASSIGN   2071>>CALL     2074>>CALL     2083<<ASSIGN   2084>>ASSIGN   2085>>CALL
      2087>>CALL     2089>>ASSIGN
MDCTX
      1557**DCL      1956<<ASSIGN   1984<<ASSIGN   1985>>ASSIGN   2046<<ASSIGN   2047<>CALL     2054>>ASSIGN
      2082<<ASSIGN   2083>>ASSIGN
MIRROR.DCTX
      1844**DCL      1960>>ASSIGN
MIRROR.DRZERO
      1845**DCL      2055>>ASSIGN   2063>>ASSIGN
MIRROR.FUNCTION
      1844**DCL      1969>>DOCASE
MIRROR.MDCTX
      1845**DCL      2046>>ASSIGN
MIRROR.MSTATE
      1844**DCL      2042>>ASSIGN
MIRROR.STATE
      1844**DCL      2008>>ASSIGN   2041>>ASSIGN
MIRROR.UTS
      1845**DCL      1978<>CALL     1999<>CALL     2010<>CALL     2058>>ASSIGN   2066>>ASSIGN   2068<>CALL
      2071<>CALL
MLOCK
      1558**DCL      1955<<ASSIGN   1997<<ASSIGN   2001<<ASSIGN   2140>>IF       2145<<ASSIGN
MSQH.DOOR
      1839**DCL      1839--REDEF
MSQH.GATE
      1839**DCL      1995<>CALL     2143<>CALL
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:87   
MSQH$
      1559**DCL      1839--IMP-PTR  1958<<ASSIGN   1986<<ASSIGN   1988>>IF       1995>>CALL     2048<<ASSIGN
      2084<<ASSIGN   2143>>CALL
MSTATE
      1560**DCL      2042<<ASSIGN   2044<>CALL     2071<>CALL
N$DCT$
       907**DCL      1985>>ASSIGN   2083>>ASSIGN   2164>>ASSIGN
N$DCT$$
       773**DCL       907--IMP-PTR  1985>>ASSIGN   2083>>ASSIGN   2164>>ASSIGN
N$FQ$
       773**DCL       908--IMP-PTR
N$REQ_INIT.BUFADDR
       792**DCL       793--REDEF     793--REDEF
N$REQ_INIT.DLA.DRELADDR
       784**DCL       784--REDEF
N$REQ_INIT.DVE.EOMCHAR
       821**DCL       822--REDEF
N$REQ_INIT.EAINFO
       815**DCL       815--REDEF
N$REQ_INIT.EAINFOX
       815**DCL       816--REDEF
N$REQ_INIT.EVNTINFO
       816**DCL       816--REDEF
N$REQ_INIT.STATUS
       797**DCL       803--REDEF
NI$FQ$
       833**DCL       909--IMP-PTR
NI$IBUF$
       833**DCL       909--IMP-PTR
NI$IMXMBX_INIT.PAGED_BASE
       843**DCL       844--REDEF     844--REDEF
NI$IMXMBX_INIT.SIZE
       845**DCL       845--REDEF
NI$REQ_INIT.DCW
       867**DCL       870--REDEF
NI$REQ_INIT.DCW.TALLY
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:88   
       868**DCL       868--REDEF
NI$REQ_INIT.IDCW.EXTA
       870**DCL       870--REDEF
NI$REQ_INIT.PCW
       872**DCL       876--REDEF
NI$REQ_INIT.SEEK
       877**DCL       878--REDEF     879--REDEF
NI$RP$
       881**DCL       911--IMP-PTR
NID$REQSCHEDL
      1536**DCL-ENT  2106--CALL
NID$SCANAQ
      1537**DCL-ENT  2029--CALL     2117--CALL
NIM$DEQUEUE
       936**DCL-ENT  2103--CALL
NI_MBX_INIT.DCW.CONTROL.AE
       903**DCL       903--REDEF
NI_MBX_INIT.LPW.CONTROL.AE
       899**DCL       899--REDEF
NK_MXLOCAL
      1548**DCL      2166>>IF
REQ
      1685**DCL      2106<>CALL
REQ.BUFADDR
      1694**DCL      1695--REDEF    1695--REDEF
REQ.DLA.DRELADDR
      1686**DCL      1686--REDEF
REQ.DVE.EOMCHAR
      1723**DCL      1724--REDEF
REQ.EAINFO
      1717**DCL      1717--REDEF
REQ.EAINFOX
      1717**DCL      1718--REDEF
REQ.EVNTINFO
      1718**DCL      1718--REDEF
REQ.STATUS
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:89   
      1699**DCL      1705--REDEF
REQ$
      1561**DCL      1685--IMP-PTR  2103<>CALL     2106>>CALL
SQH
      1856**DCL      2029<>CALL     2117<>CALL
SQH.DOOR
      1856**DCL      1856--REDEF
SQH.GATE
      1856**DCL      1965<>CALL     1991<>CALL     2026<>CALL     2032<>CALL     2113<>CALL     2135<>CALL
SQH$
      1562**DCL      1856--IMP-PTR  1962<<ASSIGN   1965>>CALL     1988>>IF       1991>>CALL     2026>>CALL
      2029>>CALL     2032>>CALL     2113>>CALL     2117>>CALL     2135>>CALL
SSR$REG
      1538**DCL-ENT  2030--CALL
STATE
      1563**DCL      2008<<ASSIGN   2009<>CALL     2010<>CALL     2041<<ASSIGN   2043<>CALL     2068<>CALL
STATE IN PROCEDURE CHECK_STATE
      2643**DCL      2639--PROC     2647>>DOCASE
S_CUN
      1549**DCL      2020>>ASSIGN   2316>>IF
TDBADDISK
      1869**DCL      2178>>ASSIGN
TDBADFUNC
      1876**DCL      2126>>ASSIGN
TDBADSTATE
      1883**DCL      2653>>ASSIGN
TDM$MIRFAIL
      1539**DCL-ENT  1999--CALL
TDM$MIRSCHED
      1540**DCL-ENT  2071--CALL
TDM$MIRSCHEDL
      1541**DCL-ENT  1978--CALL     2010--CALL     2068--CALL
TDMIRROR
      1890**DCL      2487>>ASSIGN
TDNOTFAIL
      1897**DCL      2252>>ASSIGN
PL6.E3A0      #001=TDM$MIRROR File=TDM$MIRROR.:E05TSI                            WED 07/30/97 06:03 Page:90   
TDNOTLOCKED
      1904**DCL      2341>>ASSIGN
TDNOTLOCKER
      1911**DCL      2329>>ASSIGN
TDNOTMIRROR
      1918**DCL      2414>>ASSIGN
TDNOTOPER
      1925**DCL      2559>>ASSIGN
TDNOTPRI
      1932**DCL      2632>>ASSIGN
TDNOTUNLOCKED
      1939**DCL      2728>>ASSIGN
UDB$PMMEXIT
      1542**DCL-ENT  2152--CALL
UNLOCK
      2132**LABEL    1961--CALLALT  1977--CALLALT  1983--CALLALT  1987--CALLALT  2007--CALLALT  2009--CALLALT
      2016--CALLALT  2017--CALLALT  2040--CALLALT  2043--CALLALT  2044--CALLALT  2047--CALLALT  2050--CALLALT
      2079--CALLALT  2080--CALLALT  2085--CALLALT  2096--CALLALT  2097--CALLALT

PL6.E3A0      #002=TDM$MIRSCHED File=TDM$MIRROR.:E05TSI                          WED 07/30/97 06:03 Page:91   
      550        1        /*T***********************************************************/
      551        2        /*T*                                                         */
      552        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      553        4        /*T*                                                         */
      554        5        /*T***********************************************************/
      555        6        TDM$MIRSCHED:   PROC ( DCT, NEWSTATE, UTS ) ;
      556        7        /*D*
      557        8        NAME:           TDM$MIRSCHED
      558        9
      559       10        CALL:           CALL TDM$MIRSCHED ( DCT, NEWSTATE, UTS ) ;
      560       11
      561       12        INPUT:          DCT -- DCT of Mirrored Disk device
      562       13                        NEWSTATE -- New state for Mirrored Disk device
      563       14                        UTS -- UTS value for this state change
      564       15
      565       16        OUTPUT:         DCT.DP.MIRROR -- Reset if NEWSTATE is NONE
      566       17                        DCT.DP.MIRROR.STATE
      567       18                        DCT.DP.MIRROR.UTS
      568       19
      569       20                        EL$MIRROR logged in error log.
      570       21
      571       22                        Console message written to console.
      572       23
      573       24        ENVIRONMENT:    Monitor, not privileged, not inhibited.
      574       25
      575       26        DESCRIPTION:    SQH.GATE is locked and control then passes to the
      576       27                        common code in TDM$MIRSCHEDL.
      577       28                                                                           */
      578       29        /*
      579       30                        Includes
      580       31        */
      581       32        %INCLUDE                B$JIT_C ;
      582      346        %INCLUDE                EL$TABLES ;
      583      669        %INCLUDE                EL_SUBS_C ;
      584      753        %INCLUDE                FM$SET ;
      585      780        %INCLUDE                HF_LOCK_C ;
      586      794        %INCLUDE                OC_SUBS_C ;
PL6.E3A0      #002=TDM$MIRSCHED File=TDM$MIRROR.:E05TSI                          WED 07/30/97 06:03 Page:92   
      587     1525        %INCLUDE                NI_DATA_C ;
      588     1638        %INCLUDE                NI_DATA_R ;
      589     2075        %INCLUDE                NI_MACROS_C ;
      590     2342        /*
      591     2343                        Parameters
      592     2344        */
      593     2345        %NI$DCT                 ( NAME=DCT, STCLASS=PARAM ) ;
      594     2393    1   DCL 1 NEWSTATE          UBIN WORD ALIGNED PARAM ;
      595     2394    1   DCL 1 UTS               UBIN WORD ALIGNED PARAM ;
      596     2395        /*
      597     2396                        Entries
      598     2397        */
      599     2398    1   DCL 1 ELA$SYSLOG        ENTRY(6) ALTRET ;
      600     2399    1   DCL 1 OCI$MK_WR         ENTRY(7) ;
      601     2400        /*
      602     2401                        Symrefs
      603     2402        */
      604     2403    1   DCL 1 B$JIT$            PTR SYMREF ;
      605     2404    1   DCL 1 FM$SET$           PTR SYMREF ;
      606     2405    1   DCL 1 S_TIMR            UBIN WORD SYMREF ;
      607     2406        /*
      608     2407                        Auto
      609     2408        */
      610     2409    1   DCL 1 DCTX              UBIN WORD ALIGNED AUTO ;
      611     2410        %EL$MIRROR              ( NAME=EL$MIRROR, STCLASS=AUTO ) ;
      612     2414    1   DCL 1 JUNK              UBIN WORD ALIGNED AUTO ;
      613     2415    1   DCL 1 MDCT$             PTR ALIGNED AUTO ;
      614     2416    1   DCL 1 MDCTX             SBIN WORD ALIGNED AUTO ;
      615     2417    1   DCL 1 MSG#              UBIN WORD ALIGNED AUTO ;
      616     2418    1   DCL 1 SQH$              PTR ALIGNED AUTO ;
      617     2419        /*
      618     2420                        Based
      619     2421        */
      620     2422        %B$JIT0 ;
      621     2511        %U$JIT1X ;
      622     2514        %M$JIT2X ;
      623     2517        %F$JIT3 ;
PL6.E3A0      #002=TDM$MIRSCHED File=TDM$MIRROR.:E05TSI                          WED 07/30/97 06:03 Page:93   
      624     2522        %S$JIT4 ;
      625     2528        %A$JIT6X ;
      626     2531        %FM$DEV                 ( FM$DEV=FM$DEV, BASED="BASED(FM$SET$)"   ) ;
      627     2537        %NI$DCT                 ( NAME=MDCT,     STCLASS="BASED(MDCT$)" ) ;
      628     2585        %NI$SQH                 ( NAME=SQH,      STCLASS="BASED(SQH$)"  ) ;
      629     2598
      630     2599
      631     2600
      632     2601    1   SQH$ = DCT.SQH$ ;
      633     2602
      634     2603        %LOCK ( G#=SQH.GATE ) ;
      635     2606
      636     2607    1   GOTO SCHED ;
      637     2608
      638     2609        %EJECT ;
PL6.E3A0      #002=TDM$MIRSCHED File=TDM$MIRROR.:E05TSI                          WED 07/30/97 06:03 Page:94   
      639     2610        /*D*
      640     2611        NAME:           TDM$MIRSCHEDL
      641     2612
      642     2613        CALL:           CALL TDM$MIRSCHEDL ( DCT, NEWSTATE, UTS ) ;
      643     2614
      644     2615        INPUT:          DCT -- DCT of Mirrored Disk device
      645     2616                        NEWSTATE -- New state for Mirrored Disk device
      646     2617                        UTS -- UTS value for this state change
      647     2618
      648     2619        OUTPUT:         DCT.DP.MIRROR.FLAG -- Reset if NEWSTATE is NONE
      649     2620                        DCT.DP.MIRROR.STATE
      650     2621                        DCT.DP.MIRROR.UTS
      651     2622
      652     2623                        EL$MIRROR logged in error log.
      653     2624
      654     2625                        Console message written to console.
      655     2626
      656     2627                        SQH.GATE unlocked.
      657     2628
      658     2629        ENVIRONMENT:    Monitor, not privileged, not inhibited,
      659     2630                        SQH.GATE locked.
      660     2631
      661     2632        DESCRIPTION:    If NEWSTATE = %NI_MIRROR_NONE, DCT.DP.MIRROR.FLAG
      662     2633                        is reset.  Otherwise, DCT.DP.MIRROR.STATE is updated
      663     2634                        to the new state.
      664     2635
      665     2636                        DCT.DP.MIRROR.UTS is updated to the UTS value
      666     2637                        specified.
      667     2638
      668     2639                        SQH.GATE is unlocked.
      669     2640
      670     2641                        An EL$MIRROR error log entry is generated.
      671     2642
      672     2643                        A console message is written describing the new
      673     2644                        Mirrored Disk state.
      674     2645
      675     2646                                                                           */
PL6.E3A0      #002=TDM$MIRSCHED File=TDM$MIRROR.:E05TSI                          WED 07/30/97 06:03 Page:95   
      676     2647    1   TDM$MIRSCHEDL:  ENTRY ( DCT, NEWSTATE, UTS ) ;
      677     2648
      678     2649    1   SQH$  = DCT.SQH$ ;
      679     2650
      680     2651    1   SCHED:
      681     2652
      682     2653    1   DCTX  = DCT.DCTX ;
      683     2654    1   MDCTX = DCT.DP.MIRROR.DCTX ;
      684     2655    1   MDCT$ = N$DCT$(MDCTX) ;
      685     2656
      686     2657    1   IF  DCT.DP.MIRROR.FLAG
      687     2658    1   THEN
      688     2659    1       EL$MIRROR.STATE.OLD = DCT.DP.MIRROR.STATE ;
      689     2660    2   ELSE DO ;
      690     2661    2       DCT.DP.MIRROR.FLAG = '1'B ;
      691     2662    2       EL$MIRROR.STATE.OLD = %NI_MIRROR_NONE ;
      692     2663    2       END ;
      693     2664
      694     2665    1   DCT.DP.MIRROR.STATE = NEWSTATE ;
      695     2666    1   DCT.DP.MIRROR.UTS   = UTS ;
      696     2667
      697     2668    1   EL$MIRROR.STATE.NEW    = NEWSTATE ;
      698     2669    1   EL$MIRROR.UTS          = UTS ;
      699     2670    1   EL$MIRROR.DEVNM.THIS   = DCT.DEVNM ;
      700     2671    1   IF  MDCT$ ~= ADDR(NIL)
      701     2672    1   THEN
      702     2673    1       EL$MIRROR.DEVNM.OTHER  = MDCT.DEVNM ;
      703     2674    1   ELSE
      704     2675    1       EL$MIRROR.DEVNM.OTHER  = '        ' ;
      705     2676    1   EL$MIRROR.PRI          = DCT.DP.MIRROR.PRI ;
      706     2677
      707     2678    2   DO CASE ( DCT.DP.MIRROR.STATE ) ;
      708     2679
      709     2680    2   CASE ( %NI_MIRROR_FAIL, %NI_MIRROR_WAIT ) ;
      710     2681    2       DCT.DP.MIRROR.READ  = '0'B ;
      711     2682    2       DCT.DP.MIRROR.WRITE = '0'B ;
      712     2683
PL6.E3A0      #002=TDM$MIRSCHED File=TDM$MIRROR.:E05TSI                          WED 07/30/97 06:03 Page:96   
      713     2684    2   CASE ( %NI_MIRROR_OPER ) ;
      714     2685    2       DCT.DP.MIRROR.READ   = '1'B ;
      715     2686    2       DCT.DP.MIRROR.WRITE  = '1'B ;
      716     2687    2       DCT.DP.MIRROR.TOGGLE = '1'B ;
      717     2688
      718     2689    2   CASE ( %NI_MIRROR_REST ) ;
      719     2690    2       DCT.DP.MIRROR.READ  = '0'B ;
      720     2691    2       DCT.DP.MIRROR.WRITE = '1'B ;
      721     2692
      722     2693    2   CASE ( %NI_MIRROR_NONE ) ;
      723     2694    2       DCT.DP.MIRROR.FLAG  = '0'B ;
      724     2695    2       DCT.DP.MIRROR.STATE = %NI_MIRROR_NONE ;
      725     2696    2       DCT.DP.MIRROR.READ  = '0'B ;
      726     2697    2       DCT.DP.MIRROR.WRITE = '0'B ;
      727     2698
      728     2699    2       END ;
      729     2700
      730     2701        %UNLOCK ( G#=SQH.GATE ) ;
      731     2704
      732     2705    1   EL$MIRROR.VSN          = FM$DEV.VSN(DCTX) ;
      733     2706
      734     2707    1   IF  S_TIMR = 2
      735     2708    2   THEN DO ;
      736     2709    2       EL$MIRROR.ACCT         = ' ' ;
      737     2710    2       EL$MIRROR.UNAME        = ' ' ;
      738     2711    2       EL$MIRROR.SYSID        = 0 ;
      739     2712    2       END ;
      740     2713    2   ELSE DO ;
      741     2714    2       EL$MIRROR.ACCT         = B$JIT.ACCN ;
      742     2715    2       EL$MIRROR.UNAME        = B$JIT.UNAME ;
      743     2716    2       EL$MIRROR.SYSID        = B$JIT.SYSID ;
      744     2717    2       END ;
      745     2718
      746     2719    1   CALL ELA$SYSLOG ( EL_MIRROR,
      747     2720    1                     EL$MIRROR,
      748     2721    1                     SIZEW(EL$MIRROR),
      749     2722    1                     '0'B,
PL6.E3A0      #002=TDM$MIRSCHED File=TDM$MIRROR.:E05TSI                          WED 07/30/97 06:03 Page:97   
      750     2723    1                     EL_ERR,
      751     2724    1                     JUNK ) ;
      752     2725
      753     2726    1   IF  NEWSTATE = %NI_MIRROR_FAIL
      754     2727    1   THEN
      755     2728    1       MSG# = MIR_MSGC4# ;
      756     2729    1   ELSE
      757     2730    1       MSG# = MIR_MSGC3# ;
      758     2731
      759     2732    1   CALL OCI$MK_WR ( M_DEVC, MSG#, 1, '001'O, BINBIT(NEWSTATE,9), DCTX ) ;
      760     2733
      761     2734    1   RETURN ;
      762     2735
      763     2736    1   END TDM$MIRSCHED ;
      764     2737        %EOD ;

PL6.E3A0      #002=TDM$MIRSCHED File=TDM$MIRROR.:E05TSI                          WED 07/30/97 06:03 Page:98   
--  Include file information  --

   NI_MACROS_C.:E05TOU  cannot be made into a system file and is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NI_DATA_C.:E05TOU  is referenced.
   OC_SUBS_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   FM$SET.:E05TOU  is referenced.
   EL_SUBS_C.:E05TOU  is referenced.
   EL$TABLES.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
      No diagnostics issued in procedure TDM$MIRSCHED.

   Procedure TDM$MIRSCHED requires 173 words for executable code.
   Procedure TDM$MIRSCHED requires 34 words of local(AUTO) storage.

PL6.E3A0      #002=TDM$MIRSCHED File=TDM$MIRROR.:E05TSI                          WED 07/30/97 06:03 Page:99   

 Object Unit name= TDM$MIRSCHED                               File name= TDM$MIRROR.:E05TOU
 UTS= JUL 30 '97 06:03:59.08 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0  RoData even  UTS      2      2  TDM$MIRSCHED
    1   Proc  even  none   173    255  TDM$MIRSCHED
    2  RoData even  none    11     13  TDM$MIRSCHED

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     1      0   yes            yes      Std        3  TDM$MIRSCHED
     1     12                  yes      Std        3  TDM$MIRSCHEDL

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 HFC$LOCK
         yes           Std       1 HFC$UNLOCK
 yes     yes           Std       6 ELA$SYSLOG
         yes           Std       7 OCI$MK_WR
                       nStd      0 X66_AUTO_3
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
PL6.E3A0      #002=TDM$MIRSCHED File=TDM$MIRROR.:E05TSI                          WED 07/30/97 06:03 Page:100  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     N$DCT$$                               N$FQ$                                 NI$FQ$
     NI$IBUF$                              NI$RP$                                B$JIT$
     FM$SET$                               S_TIMR                                B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ISSID
PL6.E3A0      #002=TDM$MIRSCHED File=TDM$MIRROR.:E05TSI                          WED 07/30/97 06:03 Page:101  


      550        1        /*T***********************************************************/
      551        2        /*T*                                                         */
      552        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      553        4        /*T*                                                         */
      554        5        /*T***********************************************************/
      555        6        TDM$MIRSCHED:   PROC ( DCT, NEWSTATE, UTS ) ;

      6  1 000000   000000 700200 xent  TDM$MIRSCHED TSX0  ! X66_AUTO_3
         1 000001   000042 000003                    ZERO    34,3

      556        7        /*D*
      557        8        NAME:           TDM$MIRSCHED
      558        9
      559       10        CALL:           CALL TDM$MIRSCHED ( DCT, NEWSTATE, UTS ) ;
      560       11
      561       12        INPUT:          DCT -- DCT of Mirrored Disk device
      562       13                        NEWSTATE -- New state for Mirrored Disk device
      563       14                        UTS -- UTS value for this state change
      564       15
      565       16        OUTPUT:         DCT.DP.MIRROR -- Reset if NEWSTATE is NONE
      566       17                        DCT.DP.MIRROR.STATE
      567       18                        DCT.DP.MIRROR.UTS
      568       19
      569       20                        EL$MIRROR logged in error log.
      570       21
      571       22                        Console message written to console.
      572       23
      573       24        ENVIRONMENT:    Monitor, not privileged, not inhibited.
      574       25
      575       26        DESCRIPTION:    SQH.GATE is locked and control then passes to the
      576       27                        common code in TDM$MIRSCHEDL.
      577       28                                                                           */
      578       29        /*
      579       30                        Includes
      580       31        */
      581       32        %INCLUDE                B$JIT_C ;
PL6.E3A0      #002=TDM$MIRSCHED File=TDM$MIRROR.:E05TSI                          WED 07/30/97 06:03 Page:102  
      582      346        %INCLUDE                EL$TABLES ;
      583      669        %INCLUDE                EL_SUBS_C ;
      584      753        %INCLUDE                FM$SET ;
      585      780        %INCLUDE                HF_LOCK_C ;
      586      794        %INCLUDE                OC_SUBS_C ;
      587     1525        %INCLUDE                NI_DATA_C ;
      588     1638        %INCLUDE                NI_DATA_R ;
      589     2075        %INCLUDE                NI_MACROS_C ;
      590     2342        /*
      591     2343                        Parameters
      592     2344        */
      593     2345        %NI$DCT                 ( NAME=DCT, STCLASS=PARAM ) ;
      594     2393    1   DCL 1 NEWSTATE          UBIN WORD ALIGNED PARAM ;
      595     2394    1   DCL 1 UTS               UBIN WORD ALIGNED PARAM ;
      596     2395        /*
      597     2396                        Entries
      598     2397        */
      599     2398    1   DCL 1 ELA$SYSLOG        ENTRY(6) ALTRET ;
      600     2399    1   DCL 1 OCI$MK_WR         ENTRY(7) ;
      601     2400        /*
      602     2401                        Symrefs
      603     2402        */
      604     2403    1   DCL 1 B$JIT$            PTR SYMREF ;
      605     2404    1   DCL 1 FM$SET$           PTR SYMREF ;
      606     2405    1   DCL 1 S_TIMR            UBIN WORD SYMREF ;
      607     2406        /*
      608     2407                        Auto
      609     2408        */
      610     2409    1   DCL 1 DCTX              UBIN WORD ALIGNED AUTO ;
      611     2410        %EL$MIRROR              ( NAME=EL$MIRROR, STCLASS=AUTO ) ;
      612     2414    1   DCL 1 JUNK              UBIN WORD ALIGNED AUTO ;
      613     2415    1   DCL 1 MDCT$             PTR ALIGNED AUTO ;
      614     2416    1   DCL 1 MDCTX             SBIN WORD ALIGNED AUTO ;
      615     2417    1   DCL 1 MSG#              UBIN WORD ALIGNED AUTO ;
      616     2418    1   DCL 1 SQH$              PTR ALIGNED AUTO ;
      617     2419        /*
      618     2420                        Based
PL6.E3A0      #002=TDM$MIRSCHED File=TDM$MIRROR.:E05TSI                          WED 07/30/97 06:03 Page:103  
      619     2421        */
      620     2422        %B$JIT0 ;
      621     2511        %U$JIT1X ;
      622     2514        %M$JIT2X ;
      623     2517        %F$JIT3 ;
      624     2522        %S$JIT4 ;
      625     2528        %A$JIT6X ;
      626     2531        %FM$DEV                 ( FM$DEV=FM$DEV, BASED="BASED(FM$SET$)"   ) ;
      627     2537        %NI$DCT                 ( NAME=MDCT,     STCLASS="BASED(MDCT$)" ) ;
      628     2585        %NI$SQH                 ( NAME=SQH,      STCLASS="BASED(SQH$)"  ) ;
      629     2598
      630     2599
      631     2600
      632     2601    1   SQH$ = DCT.SQH$ ;

   2601  1 000002   200003 470500                    LDP0    @DCT,,AUTO
         1 000003   000022 236100                    LDQ     18,,PR0
         1 000004   200030 756100                    STQ     SQH$,,AUTO

      633     2602
      634     2603        %LOCK ( G#=SQH.GATE ) ;

   2604  1 000005   200030 630500                    EPPR0   SQH$,,AUTO
         1 000006   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000007   000000 701000 xent               TSX1    HFC$LOCK
         1 000010   000000 011000                    NOP     0

      635     2606
      636     2607    1   GOTO SCHED ;

   2607  1 000011   000017 710000 1                  TRA     SCHED

      637     2608
      638     2609        %EJECT ;
PL6.E3A0      #002=TDM$MIRSCHED File=TDM$MIRROR.:E05TSI                          WED 07/30/97 06:03 Page:104  
      639     2610        /*D*
      640     2611        NAME:           TDM$MIRSCHEDL
      641     2612
      642     2613        CALL:           CALL TDM$MIRSCHEDL ( DCT, NEWSTATE, UTS ) ;
      643     2614
      644     2615        INPUT:          DCT -- DCT of Mirrored Disk device
      645     2616                        NEWSTATE -- New state for Mirrored Disk device
      646     2617                        UTS -- UTS value for this state change
      647     2618
      648     2619        OUTPUT:         DCT.DP.MIRROR.FLAG -- Reset if NEWSTATE is NONE
      649     2620                        DCT.DP.MIRROR.STATE
      650     2621                        DCT.DP.MIRROR.UTS
      651     2622
      652     2623                        EL$MIRROR logged in error log.
      653     2624
      654     2625                        Console message written to console.
      655     2626
      656     2627                        SQH.GATE unlocked.
      657     2628
      658     2629        ENVIRONMENT:    Monitor, not privileged, not inhibited,
      659     2630                        SQH.GATE locked.
      660     2631
      661     2632        DESCRIPTION:    If NEWSTATE = %NI_MIRROR_NONE, DCT.DP.MIRROR.FLAG
      662     2633                        is reset.  Otherwise, DCT.DP.MIRROR.STATE is updated
      663     2634                        to the new state.
      664     2635
      665     2636                        DCT.DP.MIRROR.UTS is updated to the UTS value
      666     2637                        specified.
      667     2638
      668     2639                        SQH.GATE is unlocked.
      669     2640
      670     2641                        An EL$MIRROR error log entry is generated.
      671     2642
      672     2643                        A console message is written describing the new
      673     2644                        Mirrored Disk state.
      674     2645
      675     2646                                                                           */
PL6.E3A0      #002=TDM$MIRSCHED File=TDM$MIRROR.:E05TSI                          WED 07/30/97 06:03 Page:105  
      676     2647    1   TDM$MIRSCHEDL:  ENTRY ( DCT, NEWSTATE, UTS ) ;

   2647  1 000012   000000 700200 xent  TDM$MIRSCHE* TSX0  ! X66_AUTO_3
         1 000013   000042 000003                    ZERO    34,3

      677     2648
      678     2649    1   SQH$  = DCT.SQH$ ;

   2649  1 000014   200003 470500                    LDP0    @DCT,,AUTO
         1 000015   000022 236100                    LDQ     18,,PR0
         1 000016   200030 756100                    STQ     SQH$,,AUTO

      679     2650
      680     2651    1   SCHED:
      681     2652
      682     2653    1   DCTX  = DCT.DCTX ;

   2653  1 000017   200003 470500       SCHED        LDP0    @DCT,,AUTO
         1 000020   000006 236100                    LDQ     6,,PR0
         1 000021   000025 772000                    QRL     21
         1 000022   200006 756100                    STQ     DCTX,,AUTO

      683     2654    1   MDCTX = DCT.DP.MIRROR.DCTX ;

   2654  1 000023   000037 236100                    LDQ     31,,PR0
         1 000024   000022 772000                    QRL     18
         1 000025   200026 756100                    STQ     MDCTX,,AUTO

      684     2655    1   MDCT$ = N$DCT$(MDCTX) ;

   2655  1 000026   000000 471400 xsym               LDP1    N$DCT$$
         1 000027   100000 236106                    LDQ     0,QL,PR1
         1 000030   200025 756100                    STQ     MDCT$,,AUTO

      685     2656
      686     2657    1   IF  DCT.DP.MIRROR.FLAG

PL6.E3A0      #002=TDM$MIRSCHED File=TDM$MIRROR.:E05TSI                          WED 07/30/97 06:03 Page:106  
   2657  1 000031   000036 234100                    SZN     30,,PR0
         1 000032   000037 605000 1                  TPL     s:2661

      687     2658    1   THEN
      688     2659    1       EL$MIRROR.STATE.OLD = DCT.DP.MIRROR.STATE ;

   2659  1 000033   000036 236100                    LDQ     30,,PR0
         1 000034   000006 736000                    QLS     6
         1 000035   200015 752140                    STCQ    EL$MIRROR+6,'40'O,AUTO
         1 000036   000043 710000 1                  TRA     s:2665

      689     2660    2   ELSE DO ;

      690     2661    2       DCT.DP.MIRROR.FLAG = '1'B ;

   2661  1 000037   400000 236003                    LDQ     -131072,DU
         1 000040   000036 256100                    ORSQ    30,,PR0

      691     2662    2       EL$MIRROR.STATE.OLD = %NI_MIRROR_NONE ;

   2662  1 000041   040000 236003                    LDQ     16384,DU
         1 000042   200015 752140                    STCQ    EL$MIRROR+6,'40'O,AUTO

      692     2663    2       END ;

      693     2664
      694     2665    1   DCT.DP.MIRROR.STATE = NEWSTATE ;

   2665  1 000043   200004 473500                    LDP3    @NEWSTATE,,AUTO
         1 000044   300000 236100                    LDQ     0,,PR3
         1 000045   000030 736000                    QLS     24
         1 000046   000036 752120                    STCQ    30,'20'O,PR0

      695     2666    1   DCT.DP.MIRROR.UTS   = UTS ;

   2666  1 000047   200005 474500                    LDP4    @UTS,,AUTO
         1 000050   400000 235100                    LDA     0,,PR4
PL6.E3A0      #002=TDM$MIRSCHED File=TDM$MIRROR.:E05TSI                          WED 07/30/97 06:03 Page:107  
         1 000051   000040 755100                    STA     32,,PR0

      696     2667
      697     2668    1   EL$MIRROR.STATE.NEW    = NEWSTATE ;

   2668  1 000052   300000 236100                    LDQ     0,,PR3
         1 000053   000030 736000                    QLS     24
         1 000054   200015 752120                    STCQ    EL$MIRROR+6,'20'O,AUTO

      698     2669    1   EL$MIRROR.UTS          = UTS ;

   2669  1 000055   400000 235100                    LDA     0,,PR4
         1 000056   200014 755100                    STA     EL$MIRROR+5,,AUTO

      699     2670    1   EL$MIRROR.DEVNM.THIS   = DCT.DEVNM ;

   2670  1 000057   040100 100500                    MLR     fill='040'O
         1 000060   000002 000010                    ADSC9   2,,PR0                   cn=0,n=8
         1 000061   200007 000010                    ADSC9   EL$MIRROR,,AUTO          cn=0,n=8

      700     2671    1   IF  MDCT$ ~= ADDR(NIL)

   2671  1 000062   200025 236100                    LDQ     MDCT$,,AUTO
         1 000063   000001 116000 xsym               CMPQ    B_VECTNIL+1
         1 000064   000072 600000 1                  TZE     s:2675

      701     2672    1   THEN
      702     2673    1       EL$MIRROR.DEVNM.OTHER  = MDCT.DEVNM ;

   2673  1 000065   200025 475500                    LDP5    MDCT$,,AUTO
         1 000066   040100 100500                    MLR     fill='040'O
         1 000067   500002 000010                    ADSC9   2,,PR5                   cn=0,n=8
         1 000070   200011 000010                    ADSC9   EL$MIRROR+2,,AUTO        cn=0,n=8
         1 000071   000075 710000 1                  TRA     s:2676

      703     2674    1   ELSE
      704     2675    1       EL$MIRROR.DEVNM.OTHER  = '        ' ;
PL6.E3A0      #002=TDM$MIRSCHED File=TDM$MIRROR.:E05TSI                          WED 07/30/97 06:03 Page:108  

   2675  1 000072   000000 237000 0                  LDAQ    0
         1 000073   200011 755100                    STA     EL$MIRROR+2,,AUTO
         1 000074   200012 756100                    STQ     EL$MIRROR+3,,AUTO

      705     2676    1   EL$MIRROR.PRI          = DCT.DP.MIRROR.PRI ;

   2676  1 000075   000036 236100                    LDQ     30,,PR0
         1 000076   000010 772000                    QRL     8
         1 000077   200015 676100                    ERQ     EL$MIRROR+6,,AUTO
         1 000100   000040 376003                    ANQ     32,DU
         1 000101   200015 656100                    ERSQ    EL$MIRROR+6,,AUTO

      706     2677
      707     2678    2   DO CASE ( DCT.DP.MIRROR.STATE ) ;

   2678  1 000102   000036 236100                    LDQ     30,,PR0
         1 000103   000030 772000                    QRL     24
         1 000104   000077 376007                    ANQ     63,DL
         1 000105   000005 116007                    CMPQ    5,DL
         1 000106   000110 602006 1                  TNC     s:2678+6,QL
         1 000107   000146 710000 1                  TRA     s:2702
         1 000110   000122 710000 1                  TRA     s:2685
         1 000111   000115 710000 1                  TRA     s:2681
         1 000112   000131 710000 1                  TRA     s:2690
         1 000113   000115 710000 1                  TRA     s:2681
         1 000114   000136 710000 1                  TRA     s:2694

      708     2679
      709     2680    2   CASE ( %NI_MIRROR_FAIL, %NI_MIRROR_WAIT ) ;

      710     2681    2       DCT.DP.MIRROR.READ  = '0'B ;

   2681  1 000115   000000 236000 2                  LDQ     0
         1 000116   000036 356100                    ANSQ    30,,PR0

      711     2682    2       DCT.DP.MIRROR.WRITE = '0'B ;
PL6.E3A0      #002=TDM$MIRSCHED File=TDM$MIRROR.:E05TSI                          WED 07/30/97 06:03 Page:109  

   2682  1 000117   000001 236000 2                  LDQ     1
         1 000120   000036 356100                    ANSQ    30,,PR0
         1 000121   000146 710000 1                  TRA     s:2702

      712     2683
      713     2684    2   CASE ( %NI_MIRROR_OPER ) ;

      714     2685    2       DCT.DP.MIRROR.READ   = '1'B ;

   2685  1 000122   100000 236003                    LDQ     32768,DU
         1 000123   000036 256100                    ORSQ    30,,PR0

      715     2686    2       DCT.DP.MIRROR.WRITE  = '1'B ;

   2686  1 000124   200000 236003                    LDQ     65536,DU
         1 000125   000036 256100                    ORSQ    30,,PR0

      716     2687    2       DCT.DP.MIRROR.TOGGLE = '1'B ;

   2687  1 000126   010000 236003                    LDQ     4096,DU
         1 000127   000036 256100                    ORSQ    30,,PR0
         1 000130   000146 710000 1                  TRA     s:2702

      717     2688
      718     2689    2   CASE ( %NI_MIRROR_REST ) ;

      719     2690    2       DCT.DP.MIRROR.READ  = '0'B ;

   2690  1 000131   000000 236000 2                  LDQ     0
         1 000132   000036 356100                    ANSQ    30,,PR0

      720     2691    2       DCT.DP.MIRROR.WRITE = '1'B ;

   2691  1 000133   200000 236003                    LDQ     65536,DU
         1 000134   000036 256100                    ORSQ    30,,PR0
         1 000135   000146 710000 1                  TRA     s:2702
PL6.E3A0      #002=TDM$MIRSCHED File=TDM$MIRROR.:E05TSI                          WED 07/30/97 06:03 Page:110  

      721     2692
      722     2693    2   CASE ( %NI_MIRROR_NONE ) ;

      723     2694    2       DCT.DP.MIRROR.FLAG  = '0'B ;

   2694  1 000136   000031 236000 xsym               LDQ     B_VECTNIL+25
         1 000137   000036 356100                    ANSQ    30,,PR0

      724     2695    2       DCT.DP.MIRROR.STATE = %NI_MIRROR_NONE ;

   2695  1 000140   000400 236003                    LDQ     256,DU
         1 000141   000036 752120                    STCQ    30,'20'O,PR0

      725     2696    2       DCT.DP.MIRROR.READ  = '0'B ;

   2696  1 000142   000000 236000 2                  LDQ     0
         1 000143   000036 356100                    ANSQ    30,,PR0

      726     2697    2       DCT.DP.MIRROR.WRITE = '0'B ;

   2697  1 000144   000001 236000 2                  LDQ     1
         1 000145   000036 356100                    ANSQ    30,,PR0

      727     2698
      728     2699    2       END ;

      729     2700
      730     2701        %UNLOCK ( G#=SQH.GATE ) ;

   2702  1 000146   200030 630500                    EPPR0   SQH$,,AUTO
         1 000147   000017 631400 xsym               EPPR1   B_VECTNIL+15
         1 000150   000000 701000 xent               TSX1    HFC$UNLOCK
         1 000151   000000 011000                    NOP     0

      731     2704
      732     2705    1   EL$MIRROR.VSN          = FM$DEV.VSN(DCTX) ;
PL6.E3A0      #002=TDM$MIRSCHED File=TDM$MIRROR.:E05TSI                          WED 07/30/97 06:03 Page:111  

   2705  1 000152   200006 235100                    LDA     DCTX,,AUTO
         1 000153   000003 735000                    ALS     3
         1 000154   000000 470400 xsym               LDP0    FM$SET$
         1 000155   000001 235105                    LDA     1,AL,PR0
         1 000156   200013 755100                    STA     EL$MIRROR+4,,AUTO

      733     2706
      734     2707    1   IF  S_TIMR = 2

   2707  1 000157   000000 236000 xsym               LDQ     S_TIMR
         1 000160   000002 116007                    CMPQ    2,DL
         1 000161   000173 601000 1                  TNZ     s:2714

      735     2708    2   THEN DO ;

      736     2709    2       EL$MIRROR.ACCT         = ' ' ;

   2709  1 000162   040100 100400                    MLR     fill='040'O
         1 000163   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 000164   200015 400010                    ADSC9   EL$MIRROR+6,,AUTO        cn=2,n=8

      737     2710    2       EL$MIRROR.UNAME        = ' ' ;

   2710  1 000165   040100 100400                    MLR     fill='040'O
         1 000166   000035 000001 xsym               ADSC9   B_VECTNIL+29             cn=0,n=1
         1 000167   200017 400014                    ADSC9   EL$MIRROR+8,,AUTO        cn=2,n=12

      738     2711    2       EL$MIRROR.SYSID        = 0 ;

   2711  1 000170   000000 220003                    LDX0    0,DU
         1 000171   200023 740100                    STX0    EL$MIRROR+12,,AUTO

      739     2712    2       END ;

   2712  1 000172   000204 710000 1                  TRA     s:2719

PL6.E3A0      #002=TDM$MIRSCHED File=TDM$MIRROR.:E05TSI                          WED 07/30/97 06:03 Page:112  
      740     2713    2   ELSE DO ;

      741     2714    2       EL$MIRROR.ACCT         = B$JIT.ACCN ;

   2714  1 000173   000000 471400 xsym               LDP1    B$JIT$
         1 000174   040100 100500                    MLR     fill='040'O
         1 000175   100001 000010                    ADSC9   1,,PR1                   cn=0,n=8
         1 000176   200015 400010                    ADSC9   EL$MIRROR+6,,AUTO        cn=2,n=8

      742     2715    2       EL$MIRROR.UNAME        = B$JIT.UNAME ;

   2715  1 000177   040100 100500                    MLR     fill='040'O
         1 000200   100003 000014                    ADSC9   3,,PR1                   cn=0,n=12
         1 000201   200017 400014                    ADSC9   EL$MIRROR+8,,AUTO        cn=2,n=12

      743     2716    2       EL$MIRROR.SYSID        = B$JIT.SYSID ;

   2716  1 000202   100000 720100                    LXL0    0,,PR1
         1 000203   200023 740100                    STX0    EL$MIRROR+12,,AUTO

      744     2717    2       END ;

      745     2718
      746     2719    1   CALL ELA$SYSLOG ( EL_MIRROR,

   2719  1 000204   200024 631500                    EPPR1   JUNK,,AUTO
         1 000205   200037 451500                    STP1    SQH$+7,,AUTO
         1 000206   000004 236000 2                  LDQ     4
         1 000207   200036 756100                    STQ     SQH$+6,,AUTO
         1 000210   000006 237000 2                  LDAQ    6
         1 000211   200034 757100                    STAQ    SQH$+4,,AUTO
         1 000212   200007 633500                    EPPR3   EL$MIRROR,,AUTO
         1 000213   200033 453500                    STP3    SQH$+3,,AUTO
         1 000214   000010 236000 2                  LDQ     8
         1 000215   200032 756100                    STQ     SQH$+2,,AUTO
         1 000216   200032 630500                    EPPR0   SQH$+2,,AUTO
         1 000217   000024 631400 xsym               EPPR1   B_VECTNIL+20
PL6.E3A0      #002=TDM$MIRSCHED File=TDM$MIRROR.:E05TSI                          WED 07/30/97 06:03 Page:113  
         1 000220   000000 701000 xent               TSX1    ELA$SYSLOG
         1 000221   000000 011000                    NOP     0

      747     2720    1                     EL$MIRROR,
      748     2721    1                     SIZEW(EL$MIRROR),
      749     2722    1                     '0'B,
      750     2723    1                     EL_ERR,
      751     2724    1                     JUNK ) ;
      752     2725
      753     2726    1   IF  NEWSTATE = %NI_MIRROR_FAIL

   2726  1 000222   200004 470500                    LDP0    @NEWSTATE,,AUTO
         1 000223   000000 235100                    LDA     0,,PR0
         1 000224   000001 115007                    CMPA    1,DL
         1 000225   000231 601000 1                  TNZ     s:2730

      754     2727    1   THEN
      755     2728    1       MSG# = MIR_MSGC4# ;

   2728  1 000226   000262 236007                    LDQ     178,DL
         1 000227   200027 756100                    STQ     MSG#,,AUTO
         1 000230   000233 710000 1                  TRA     s:2732

      756     2729    1   ELSE
      757     2730    1       MSG# = MIR_MSGC3# ;

   2730  1 000231   000261 236007                    LDQ     177,DL
         1 000232   200027 756100                    STQ     MSG#,,AUTO

      758     2731
      759     2732    1   CALL OCI$MK_WR ( M_DEVC, MSG#, 1, '001'O, BINBIT(NEWSTATE,9), DCTX ) ;

   2732  1 000233   000000 236100                    LDQ     0,,PR0
         1 000234   000033 736000                    QLS     27
         1 000235   200032 552140                    STBQ    SQH$+2,'40'O,AUTO
         1 000236   200006 631500                    EPPR1   DCTX,,AUTO
         1 000237   200041 451500                    STP1    SQH$+9,,AUTO
PL6.E3A0      #002=TDM$MIRSCHED File=TDM$MIRROR.:E05TSI                          WED 07/30/97 06:03 Page:114  
         1 000240   200032 633500                    EPPR3   SQH$+2,,AUTO
         1 000241   200040 453500                    STP3    SQH$+8,,AUTO
         1 000242   000004 237000 2                  LDAQ    4
         1 000243   200036 757100                    STAQ    SQH$+6,,AUTO
         1 000244   200027 634500                    EPPR4   MSG#,,AUTO
         1 000245   200035 454500                    STP4    SQH$+5,,AUTO
         1 000246   000012 236000 2                  LDQ     10
         1 000247   200034 756100                    STQ     SQH$+4,,AUTO
         1 000250   200034 630500                    EPPR0   SQH$+4,,AUTO
         1 000251   000024 631400 xsym               EPPR1   B_VECTNIL+20
         1 000252   000000 701000 xent               TSX1    OCI$MK_WR
         1 000253   000000 011000                    NOP     0

      760     2733
      761     2734    1   RETURN ;

   2734  1 000254   000000 702200 xent               TSX2  ! X66_ARET

(unnamed)
 Sect OctLoc
   0     000   040040 040040   040040 040040

(unnamed)
 Sect OctLoc
   2     000   677777 777777   577777 777777   000000 000171   000000 000015    ...........y....
   2     004   000003 006000   000033 006000   000003 006000   000002 006000    ................
   2     010   000002 006000   100000 000000   000011 006000                    ....@.......
      762     2735
      763     2736    1   END TDM$MIRSCHED ;
      764     2737        %EOD ;

PL6.E3A0      #002=TDM$MIRSCHED File=TDM$MIRROR.:E05TSI                          WED 07/30/97 06:03 Page:115  
--  Include file information  --

   NI_MACROS_C.:E05TOU  cannot be made into a system file and is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NI_DATA_C.:E05TOU  is referenced.
   OC_SUBS_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
   FM$SET.:E05TOU  is referenced.
   EL_SUBS_C.:E05TOU  is referenced.
   EL$TABLES.:E05TOU  is referenced.
   B$JIT_C.:E05TOU  is referenced.
      No diagnostics issued in procedure TDM$MIRSCHED.
PL6.E3A0      #002=TDM$MIRSCHED File=TDM$MIRROR.:E05TSI                          WED 07/30/97 06:03 Page:116  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @DCT                       4-0-0/w PTR         r     1 @NEWSTATE
     5-0-0/w PTR         r     1 @UTS                      *0-0-0/w STRC(1332)  r     1 DCT
     6-0-0/w UBIN        r     1 DCTX                       7-0-0/w STRC(468)   r     1 EL$MIRROR
    24-0-0/w UBIN        r     1 JUNK                      25-0-0/w PTR         r     1 MDCT$
    26-0-0/w SBIN        r     1 MDCTX                     27-0-0/w UBIN        r     1 MSG#
    *0-0-0/w UBIN        r     1 NEWSTATE                  30-0-0/w PTR         r     1 SQH$
    *0-0-0/w UBIN        r     1 UTS

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 B$JIT$                     0-0-0/w PTR         r     1 FM$SET$
     0-0-0/w PTR         r     1 N$DCT$$                    0-0-0/w PTR         r     1 N$FQ$
     0-0-0/w PTR         r     1 NI$FQ$                     0-0-0/w PTR         r     1 NI$IBUF$
     0-0-0/w PTR         r     1 NI$RP$                     0-0-0/w UBIN        r     1 S_TIMR

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/d STRC(8568)  r     1 B$JIT                      0-0-0/w STRC(288)   r     1 FM$DEV(0:0)
     0-0-0/w STRC(1332)  r     1 MDCT                       0-0-0/w PTR         r     1 N$DCT$(0:0)
     0-0-0/w STRC(252)   r     1 SQH


   Procedure TDM$MIRSCHED requires 173 words for executable code.
PL6.E3A0      #002=TDM$MIRSCHED File=TDM$MIRROR.:E05TSI                          WED 07/30/97 06:03 Page:117  
   Procedure TDM$MIRSCHED requires 34 words of local(AUTO) storage.
PL6.E3A0      #002=TDM$MIRSCHED File=TDM$MIRROR.:E05TSI                          WED 07/30/97 06:03 Page:118  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #002=TDM$MIRSCHED File=TDM$MIRROR.:E05TSI                          WED 07/30/97 06:03 Page:119  
          MINI XREF LISTING

B$JIT.ACCN
      2428**DCL      2714>>ASSIGN
B$JIT.ERR.MID
      2429**DCL      2429--REDEF
B$JIT.PNR
      2525**DCL      2525--REDEF
B$JIT.SYSID
      2428**DCL      2716>>ASSIGN
B$JIT.UNAME
      2428**DCL      2715>>ASSIGN
B$JIT$
      2403**DCL      2423--IMP-PTR  2714>>ASSIGN   2715>>ASSIGN   2716>>ASSIGN
DCT
      2354**DCL         6--PROC     2647--ENTRY
DCT.DCTX
      2355**DCL      2653>>ASSIGN
DCT.DEVNM
      2354**DCL      2670>>ASSIGN
DCT.DP
      2374**DCL      2381--REDEF    2384--REDEF    2385--REDEF    2387--REDEF    2387--REDEF    2388--REDEF
      2389--REDEF    2389--REDEF
DCT.DP.MIRROR.DCTX
      2379**DCL      2654>>ASSIGN
DCT.DP.MIRROR.FLAG
      2376**DCL      2657>>IF       2661<<ASSIGN   2694<<ASSIGN
DCT.DP.MIRROR.PRI
      2378**DCL      2676>>ASSIGN
DCT.DP.MIRROR.READ
      2377**DCL      2681<<ASSIGN   2685<<ASSIGN   2690<<ASSIGN   2696<<ASSIGN
DCT.DP.MIRROR.STATE
      2378**DCL      2659>>ASSIGN   2665<<ASSIGN   2678>>DOCASE   2695<<ASSIGN
DCT.DP.MIRROR.TOGGLE
PL6.E3A0      #002=TDM$MIRSCHED File=TDM$MIRROR.:E05TSI                          WED 07/30/97 06:03 Page:120  
      2378**DCL      2687<<ASSIGN
DCT.DP.MIRROR.UTS
      2380**DCL      2666<<ASSIGN
DCT.DP.MIRROR.WRITE
      2377**DCL      2682<<ASSIGN   2686<<ASSIGN   2691<<ASSIGN   2697<<ASSIGN
DCT.MPC.IOCHANX
      2382**DCL      2382--REDEF
DCT.SQH$
      2369**DCL      2601>>ASSIGN   2649>>ASSIGN
DCTX
      2409**DCL      2653<<ASSIGN   2705>>ASSIGN   2732<>CALL
EL$MIRROR
      2411**DCL      2719<>CALL     2719--CALL
EL$MIRROR.ACCT
      2412**DCL      2709<<ASSIGN   2714<<ASSIGN
EL$MIRROR.DEVNM.OTHER
      2411**DCL      2673<<ASSIGN   2675<<ASSIGN
EL$MIRROR.DEVNM.THIS
      2411**DCL      2670<<ASSIGN
EL$MIRROR.PRI
      2412**DCL      2676<<ASSIGN
EL$MIRROR.STATE.NEW
      2412**DCL      2668<<ASSIGN
EL$MIRROR.STATE.OLD
      2411**DCL      2659<<ASSIGN   2662<<ASSIGN
EL$MIRROR.SYSID
      2412**DCL      2711<<ASSIGN   2716<<ASSIGN
EL$MIRROR.UNAME
      2412**DCL      2710<<ASSIGN   2715<<ASSIGN
EL$MIRROR.UTS
      2411**DCL      2669<<ASSIGN
EL$MIRROR.VSN
      2411**DCL      2705<<ASSIGN
ELA$SYSLOG
      2398**DCL-ENT  2719--CALL
FM$DEV.USERLIST
PL6.E3A0      #002=TDM$MIRSCHED File=TDM$MIRROR.:E05TSI                          WED 07/30/97 06:03 Page:121  
      2533**DCL      2534--REDEF
FM$DEV.VSN
      2532**DCL      2705>>ASSIGN
FM$SET$
      2404**DCL      2532--IMP-PTR  2705>>ASSIGN
HFC$LOCK
       793**DCL-ENT  2604--CALL
HFC$UNLOCK
       793**DCL-ENT  2702--CALL
JUNK
      2414**DCL      2719<>CALL
MDCT.DEVNM
      2546**DCL      2673>>ASSIGN
MDCT.DP
      2566**DCL      2573--REDEF    2576--REDEF    2577--REDEF    2579--REDEF    2579--REDEF    2580--REDEF
      2581--REDEF    2581--REDEF
MDCT.MPC.IOCHANX
      2574**DCL      2574--REDEF
MDCT$
      2415**DCL      2546--IMP-PTR  2655<<ASSIGN   2671>>IF       2673>>ASSIGN
MDCTX
      2416**DCL      2654<<ASSIGN   2655>>ASSIGN
MSG#
      2417**DCL      2728<<ASSIGN   2730<<ASSIGN   2732<>CALL
N$DCT$
      2070**DCL      2655>>ASSIGN
N$DCT$$
      1936**DCL      2070--IMP-PTR  2655>>ASSIGN
N$FQ$
      1936**DCL      2071--IMP-PTR
N$REQ_INIT.BUFADDR
      1955**DCL      1956--REDEF    1956--REDEF
N$REQ_INIT.DLA.DRELADDR
      1947**DCL      1947--REDEF
N$REQ_INIT.DVE.EOMCHAR
      1984**DCL      1985--REDEF
PL6.E3A0      #002=TDM$MIRSCHED File=TDM$MIRROR.:E05TSI                          WED 07/30/97 06:03 Page:122  
N$REQ_INIT.EAINFO
      1978**DCL      1978--REDEF
N$REQ_INIT.EAINFOX
      1978**DCL      1979--REDEF
N$REQ_INIT.EVNTINFO
      1979**DCL      1979--REDEF
N$REQ_INIT.STATUS
      1960**DCL      1966--REDEF
NEWSTATE
      2393**DCL         6--PROC     2647--ENTRY    2665>>ASSIGN   2668>>ASSIGN   2726>>IF       2732>>CALL
NI$FQ$
      1996**DCL      2072--IMP-PTR
NI$IBUF$
      1996**DCL      2072--IMP-PTR
NI$IMXMBX_INIT.PAGED_BASE
      2006**DCL      2007--REDEF    2007--REDEF
NI$IMXMBX_INIT.SIZE
      2008**DCL      2008--REDEF
NI$REQ_INIT.DCW
      2030**DCL      2033--REDEF
NI$REQ_INIT.DCW.TALLY
      2031**DCL      2031--REDEF
NI$REQ_INIT.IDCW.EXTA
      2033**DCL      2033--REDEF
NI$REQ_INIT.PCW
      2035**DCL      2039--REDEF
NI$REQ_INIT.SEEK
      2040**DCL      2041--REDEF    2042--REDEF
NI$RP$
      2044**DCL      2074--IMP-PTR
NI_MBX_INIT.DCW.CONTROL.AE
      2066**DCL      2066--REDEF
NI_MBX_INIT.LPW.CONTROL.AE
      2062**DCL      2062--REDEF
OCI$MK_WR
      2399**DCL-ENT  2732--CALL
PL6.E3A0      #002=TDM$MIRSCHED File=TDM$MIRROR.:E05TSI                          WED 07/30/97 06:03 Page:123  
SCHED
      2653**LABEL    2607--GOTO
SQH.DOOR
      2594**DCL      2594--REDEF
SQH.GATE
      2594**DCL      2604<>CALL     2702<>CALL
SQH$
      2418**DCL      2594--IMP-PTR  2601<<ASSIGN   2604>>CALL     2649<<ASSIGN   2702>>CALL
S_TIMR
      2405**DCL      2707>>IF
UTS
      2394**DCL         6--PROC     2647--ENTRY    2666>>ASSIGN   2669>>ASSIGN

PL6.E3A0      #003=TDM$MIRFAIL File=TDM$MIRROR.:E05TSI                           WED 07/30/97 06:04 Page:124  
      765        1        /*T***********************************************************/
      766        2        /*T*                                                         */
      767        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      768        4        /*T*                                                         */
      769        5        /*T***********************************************************/
      770        6        TDM$MIRFAIL:    PROC ( DCT, UTS ) ;
      771        7        /*D*
      772        8        NAME:           TDM$MIRFAIL
      773        9
      774       10        CALL:           CALL TDM$MIRFAIL ( DCT [, UTS ] ) ;
      775       11
      776       12        INPUT:          DCT ----- DCT of Mirrored Disk device that failed
      777       13                        UTS ----- UTS value for this failure
      778       14
      779       15        OUTPUT:         DCT.DP.MIRROR
      780       16                        MDCT.DP.MIRROR
      781       17
      782       18        ENVIRONMENT:    Monitor, not privileged, not inhibited.
      783       19                        SQH.GATE locked.
      784       20
      785       21        DESCRIPTION:    This routine processes the failure of a Mirrored
      786       22                        Disk device or the dissolution of a Mirrored Disk
      787       23                        pair.
      788       24                                                                           */
      789       25        /*
      790       26                        Includes
      791       27        */
      792       28        %INCLUDE                HF_LOCK_C ;
      793       42        %INCLUDE                NI_DATA_C ;
      794      155        %INCLUDE                NI_DATA_R ;
      795      592        %INCLUDE                NI_MACROS_C ;
      796      859        /*
      797      860                        Parameters
      798      861        */
      799      862        %NI$DCT                 ( NAME=DCT, STCLASS=PARAM ) ;
      800      910    1   DCL 1 UTS               UBIN WORD ALIGNED PARAM ;
      801      911        /*
PL6.E3A0      #003=TDM$MIRFAIL File=TDM$MIRROR.:E05TSI                           WED 07/30/97 06:04 Page:125  
      802      912                        Entries
      803      913        */
      804      914    1   DCL 1 FMN$AVR           ENTRY(2) ;
      805      915    1   DCL 1 FMN$MRRSWITCH     ENTRY(1) ;
      806      916    1   DCL 1 NID$REQSCHED      ENTRY(1) ;
      807      917    1   DCL 1 NID$REQSCHEDL     ENTRY(1) ;
      808      918    1   DCL 1 NIO$DCWBLD        ENTRY(1) ALTRET ;
      809      919    1   DCL 1 SC_TDMINVMIR      ENTRY CONV(2,0) ;
      810      920    1   DCL 1 SC_TDMNOPMIR      ENTRY CONV(2,0) ;
      811      921    1   DCL 1 SSS$CURTIME       ENTRY(1) ;
      812      922    1   DCL 1 TDM$MIRSCHED      ENTRY(3) ;
      813      923    1   DCL 1 TDM$MIRSCHEDL     ENTRY(3) ;
      814      924        /*
      815      925                        Symrefs
      816      926        */
      817      927    1   DCL 1 NK_MXLOCAL        UBIN SYMREF ;
      818      928        /*
      819      929                        Auto
      820      930        */
      821      931    1   DCL 1 BQ$               PTR ALIGNED AUTO ;
      822      932    1   DCL 1 MDCT$             PTR ALIGNED AUTO ;
      823      933    1   DCL 1 MDCTX             UBIN WORD AUTO ;
      824      934    1   DCL 1 MSQH$             PTR ALIGNED AUTO ;
      825      935    1   DCL 1 REQ$              PTR ALIGNED AUTO ;
      826      936    1   DCL 1 SQ$               PTR ALIGNED AUTO ;
      827      937    1   DCL 1 SQH$              PTR ALIGNED AUTO ;
      828      938    1   DCL 1 TIME              UBIN WORD ALIGNED AUTO ;
      829      939        /*
      830      940                        Based
      831      941        */
      832      942        %NI$DCT                 ( NAME=MDCT, STCLASS="BASED(MDCT$)" ) ;
      833      990        %NI$DQH                 ( NAME=DQH,  STCLASS=BASED          ) ;
      834     1013        %N$REQ                  ( NAME=REQ,  STCLASS="BASED(REQ$)" ) ;
      835     1071        %NI$SQH                 ( NAME=MSQH, STCLASS="BASED(MSQH$)" ) ;
      836     1084        %NI$SQH                 ( NAME=SQH,  STCLASS="BASED(SQH$)"  ) ;
      837     1097
      838     1098        %EJECT ;
PL6.E3A0      #003=TDM$MIRFAIL File=TDM$MIRROR.:E05TSI                           WED 07/30/97 06:04 Page:126  
      839     1099    1   SQH$  = DCT.SQH$ ;
      840     1100
      841     1101    1   IF  ADDR(UTS) = ADDR(NIL)
      842     1102    1   THEN
      843     1103    1       CALL SSS$CURTIME ( TIME ) ;
      844     1104    1   ELSE
      845     1105    1       TIME = UTS ;
      846     1106
      847     1107    1   MDCTX = DCT.DP.MIRROR.DCTX ;
      848     1108    1   IF  MDCTX = 0
      849     1109    1   OR  MDCTX > NK_MXLOCAL
      850     1110    1   THEN
      851     1111        /*S* SCREECH_CODE:  TDM-S$INVMIR-7
      852     1112             TYPE:          SCREECH
      853     1113             MESSAGE:       Invalid Mirrored Disk DCT index.
      854     1114             DESCRIPTION:   The DCT index for the mirror of this Mirrored
      855     1115                            Disk device is invalid.
      856     1116                                                                           */
      857     1117    1       CALL SC_TDMINVMIR ;
      858     1118    1   ELSE
      859     1119    1       MDCT$ = N$DCT$(MDCTX) ;
      860     1120
      861     1121    1   IF  MDCT.DP.MIRROR.STATE ~= %NI_MIRROR_OPER AND
      862     1122    1       MDCT.DP.MIRROR.STATE ~= %NI_MIRROR_WAIT
      863     1123    1   THEN
      864     1124        /*S* SCREECH_CODE:  TDM-S$NOPMIR-7
      865     1125             TYPE:          SCREECH
      866     1126             MESSAGE:       No operational Mirrored Disk device.
      867     1127             DESCRIPTION:   The IO system detected no operational Mirrored Disk device
      868     1128                            in a Mirrored Disk pair.  There is always supposed to be
      869     1129                            one operational Mirrored Disk device for normal Mirrored
      870     1130                            Disk IO.
      871     1131                                                                                   */
      872     1132    1       CALL SC_TDMNOPMIR ;
      873     1133    1   ELSE
      874     1134    1       MSQH$ = MDCT.SQH$ ;
      875     1135
PL6.E3A0      #003=TDM$MIRFAIL File=TDM$MIRROR.:E05TSI                           WED 07/30/97 06:04 Page:127  
      876     1136    1   IF  DCT.DP.MIRROR.PRI
      877     1137    2   THEN DO ;
      878     1138    2       CALL FMN$MRRSWITCH ( DCT.DCTX ) ;
      879     1139    2       DCT.DP.MIRROR.PRI  = '0'B ;
      880     1140    2       MDCT.DP.MIRROR.PRI = '1'B ;
      881     1141    2       END ;
      882     1142
      883     1143    1   CALL TDM$MIRSCHEDL ( DCT, %NI_MIRROR_FAIL,  TIME ) ;
      884     1144
      885     1145        %LOCK  ( G#=MSQH.GATE ) ;
      886     1148
      887     1149    1   IF  MDCT.STATE = %BUSY
      888     1150    2   THEN DO ;
      889     1151    2       REQ$ = MDCT.DQH$->DQH.IO$ ;
      890     1152    2       IF  REQ.COMP = %COMP_MIRROR
      891     1153    3       THEN DO ;
      892     1154    3           REQ.COMP  = %COMP_REG ;
      893     1155    3           REQ.DOMIR = '0'B ;
      894     1156    3           END ;
      895     1157    2       END ;
      896     1158
      897     1159    1   SQ$         = MDCT.SQ$ ;
      898     1160    1   BQ$         = MDCT.DP.BQ$ ;
      899     1161    1   MDCT.SQ$    = ADDR(NIL) ;
      900     1162    1   MDCT.DP.BQ$ = ADDR(NIL) ;
      901     1163
      902     1164    1   CALL REQMOD ( SQ$, MDCT.SQ$ ) ;
      903     1165    1   CALL REQMOD ( BQ$, MDCT.DP.BQ$ ) ;
      904     1166
      905     1167    1   CALL TDM$MIRSCHEDL ( MDCT, %NI_MIRROR_NONE, TIME ) ;
      906     1168    1   MDCT.DP.MIRROR.STATE = %NI_MIRROR_OPER ; /* PIG writes this to the VID */
      907     1169
      908     1170    1   CALL FMN$AVR ( MDCT.DCTX, %NI_AVR_MIRROR ) ;
      909     1171
      910     1172        %LOCK  ( G#=SQH.GATE ) ;
      911     1175
      912     1176    1   SQ$        = DCT.SQ$ ;
PL6.E3A0      #003=TDM$MIRFAIL File=TDM$MIRROR.:E05TSI                           WED 07/30/97 06:04 Page:128  
      913     1177    1   BQ$        = DCT.DP.BQ$ ;
      914     1178    1   DCT.SQ$    = ADDR(NIL) ;
      915     1179    1   DCT.DP.BQ$ = ADDR(NIL) ;
      916     1180
      917     1181    1   CALL REQMOVE ( SQ$ ) ;
      918     1182    1   CALL REQMOVE ( BQ$ ) ;
      919     1183
      920     1184    1   CALL TDM$MIRSCHEDL  ( DCT, %NI_MIRROR_NONE, TIME ) ;
      921     1185    1   DCT.DP.MIRROR.STATE = %NI_MIRROR_FAIL ; /* PIG writes this to the VID */
      922     1186
      923     1187    1   CALL FMN$AVR ( DCT.DCTX,  %NI_AVR_MIRROR ) ;
      924     1188
      925     1189    1   RETURN ;
      926     1190
      927     1191        %EJECT ;
PL6.E3A0      #003=TDM$MIRFAIL File=TDM$MIRROR.:E05TSI                           WED 07/30/97 06:04 Page:129  
      928     1192    1   REQMOD:         PROC ( Q$, P$ ) ;
      929     1193        /*
      930     1194                        Parameters
      931     1195        */
      932     1196    2   DCL 1 Q$                PTR ALIGNED PARAM ;
      933     1197    2   DCL 1 P$                PTR ALIGNED PARAM ;
      934     1198
      935     1199
      936     1200
      937     1201    3   DO  WHILE ( Q$ ~= ADDR(NIL) ) ;
      938     1202            %DEQUEUE ( P#=REQ$, Q#=Q$ ) ;
      939     1209    3       IF  REQ.COMP = %COMP_MIRROR
      940     1210    4       THEN DO ;
      941     1211    4           REQ.COMP  = %COMP_REG ;
      942     1212    4           REQ.DOMIR = '0'B ;
      943     1213    4           END ;
      944     1214            %ENQUEUE ( P#=REQ, Q#=P$ ) ;
      945     1217    3       END ;
      946     1218
      947     1219    2   RETURN ;
      948     1220
      949     1221    2   END REQMOD ;
      950     1222
      951     1223        %EJECT ;
PL6.E3A0      #003=TDM$MIRFAIL File=TDM$MIRROR.:E05TSI                           WED 07/30/97 06:04 Page:130  
      952     1224    1   REQMOVE:        PROC ( Q$ ) ;
      953     1225        /*
      954     1226                        Parameters
      955     1227        */
      956     1228    2   DCL 1 Q$                PTR ALIGNED PARAM ;
      957     1229
      958     1230
      959     1231
      960     1232    3   DO  WHILE ( Q$ ~= ADDR(NIL) ) ;
      961     1233            %DEQUEUE ( P#=REQ$, Q#=Q$ ) ;
      962     1240    3       IF  REQ.COMP = %COMP_MIRROR
      963     1241    4       THEN DO ;
      964     1242    4           REQ.COMP     = %COMP_REG ;
      965     1243    4           REQ.DOMIR    = '0'B ;
      966     1244    4           REQ.DLA.DCTX = MDCTX ;
      967     1245    4           REQ.DCT$     = MDCT$ ;
      968     1246    4           IF  NOT REQ.MIRDONE
      969     1247    5           THEN DO ;
      970     1248    5               CALL NIO$DCWBLD ( REQ ) ;
      971     1249    5               IF  MSQH$ = SQH$
      972     1250    5               THEN
      973     1251    5                   CALL NID$REQSCHEDL ( REQ ) ;
      974     1252    5               ELSE
      975     1253    5                   CALL NID$REQSCHED  ( REQ ) ;
      976     1254    5               END ;
      977     1255    5           ELSE DO ;
      978     1256                    %LOCK    ( G#=NI$RP.GATE ) ;
      979     1259                    %ENQUEUE ( P#=REQ, Q#=NI$RP.RC$ ) ;
      980     1262                    %UNLOCK  ( G#=NI$RP.GATE ) ;
      981     1265    5               END ;
      982     1266    4           END ;
      983     1267    3       ELSE
      984     1268    3           CALL NID$REQSCHEDL ( REQ ) ;
      985     1269    3       END ;
      986     1270
      987     1271    2   RETURN ;
      988     1272
PL6.E3A0      #003=TDM$MIRFAIL File=TDM$MIRROR.:E05TSI                           WED 07/30/97 06:04 Page:131  
      989     1273    2   END REQMOVE ;
      990     1274
      991     1275    1   END TDM$MIRFAIL ;

PL6.E3A0      #003=TDM$MIRFAIL File=TDM$MIRROR.:E05TSI                           WED 07/30/97 06:04 Page:132  
--  Include file information  --

   NI_MACROS_C.:E05TOU  cannot be made into a system file and is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NI_DATA_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure TDM$MIRFAIL.

   Procedure TDM$MIRFAIL requires 285 words for executable code.
   Procedure TDM$MIRFAIL requires 22 words of local(AUTO) storage.

    No errors detected in file TDM$MIRROR.:E05TSI    .

PL6.E3A0      #003=TDM$MIRFAIL File=TDM$MIRROR.:E05TSI                           WED 07/30/97 06:04 Page:133  

 Object Unit name= TDM$MIRFAIL                                File name= TDM$MIRROR.:E05TOU
 UTS= JUL 30 '97 06:04:35.04 WED                              Compiler= PL-6/E31         Sev=      00
 SharedLib= :SHARED_SYSTEM                                    Alt SharedLib=


    ****  Control sections  ****

 Sect   Type Bound  Init  Size OctSiz  Section name(segment info)
    0   Proc  even  none   285    435  TDM$MIRFAIL
    1  RoData even  none     5      5  TDM$MIRFAIL

    ****  Entry defs  ****

                              Check   Calling
                             calling  sequence
  Sect OctLoc Primary Altret sequence   type   Parms  Name
     0      0   yes            yes      Std        2  TDM$MIRFAIL

  ****  Entry refs  ****

         Check        Calling
        calling       sequence
Altret sequence SRef   type   Args  Name
         yes           Std       1 SSS$CURTIME
         yes           Std       1 FMN$MRRSWITCH
         yes           Std       3 TDM$MIRSCHEDL
         yes           Std       2 FMN$AVR
         yes           Std       1 HFC$LOCK
 yes     yes           Std       2 NIM$DEQUEUE
         yes           Std       2 NIM$ENQUEUE
         yes           Std       1 NID$REQSCHEDL
         yes           Std       1 HFC$UNLOCK
 yes     yes           Std       1 NIO$DCWBLD
         yes           Std       1 NID$REQSCHED
                       nStd      0 X66_AUTO_2
                       Std       0 B_CONSPOOL_D
                       nStd      0 X66_ARET
PL6.E3A0      #003=TDM$MIRFAIL File=TDM$MIRROR.:E05TSI                           WED 07/30/97 06:04 Page:134  

  ****  Data refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     SC_TDMINVMIR                          SC_TDMNOPMIR                          N$DCT$$
     N$FQ$                                 NI$FQ$                                NI$IBUF$
     NI$RP$                                NK_MXLOCAL                            B_VECTNIL

  ****  Segment refs  ****

  Flags:  r = read only, s = secondary
Flgs Name                             Flgs Name                             Flgs Name
     ASLENTSID                             ISSID
PL6.E3A0      #003=TDM$MIRFAIL File=TDM$MIRROR.:E05TSI                           WED 07/30/97 06:04 Page:135  


      765        1        /*T***********************************************************/
      766        2        /*T*                                                         */
      767        3        /*T* Copyright (c) Bull HN Information Systems Inc., 1997    */
      768        4        /*T*                                                         */
      769        5        /*T***********************************************************/
      770        6        TDM$MIRFAIL:    PROC ( DCT, UTS ) ;

      6  0 000000   000000 700200 xent  TDM$MIRFAIL  TSX0  ! X66_AUTO_2
         0 000001   000026 000002                    ZERO    22,2

      771        7        /*D*
      772        8        NAME:           TDM$MIRFAIL
      773        9
      774       10        CALL:           CALL TDM$MIRFAIL ( DCT [, UTS ] ) ;
      775       11
      776       12        INPUT:          DCT ----- DCT of Mirrored Disk device that failed
      777       13                        UTS ----- UTS value for this failure
      778       14
      779       15        OUTPUT:         DCT.DP.MIRROR
      780       16                        MDCT.DP.MIRROR
      781       17
      782       18        ENVIRONMENT:    Monitor, not privileged, not inhibited.
      783       19                        SQH.GATE locked.
      784       20
      785       21        DESCRIPTION:    This routine processes the failure of a Mirrored
      786       22                        Disk device or the dissolution of a Mirrored Disk
      787       23                        pair.
      788       24                                                                           */
      789       25        /*
      790       26                        Includes
      791       27        */
      792       28        %INCLUDE                HF_LOCK_C ;
      793       42        %INCLUDE                NI_DATA_C ;
      794      155        %INCLUDE                NI_DATA_R ;
      795      592        %INCLUDE                NI_MACROS_C ;
      796      859        /*
PL6.E3A0      #003=TDM$MIRFAIL File=TDM$MIRROR.:E05TSI                           WED 07/30/97 06:04 Page:136  
      797      860                        Parameters
      798      861        */
      799      862        %NI$DCT                 ( NAME=DCT, STCLASS=PARAM ) ;
      800      910    1   DCL 1 UTS               UBIN WORD ALIGNED PARAM ;
      801      911        /*
      802      912                        Entries
      803      913        */
      804      914    1   DCL 1 FMN$AVR           ENTRY(2) ;
      805      915    1   DCL 1 FMN$MRRSWITCH     ENTRY(1) ;
      806      916    1   DCL 1 NID$REQSCHED      ENTRY(1) ;
      807      917    1   DCL 1 NID$REQSCHEDL     ENTRY(1) ;
      808      918    1   DCL 1 NIO$DCWBLD        ENTRY(1) ALTRET ;
      809      919    1   DCL 1 SC_TDMINVMIR      ENTRY CONV(2,0) ;
      810      920    1   DCL 1 SC_TDMNOPMIR      ENTRY CONV(2,0) ;
      811      921    1   DCL 1 SSS$CURTIME       ENTRY(1) ;
      812      922    1   DCL 1 TDM$MIRSCHED      ENTRY(3) ;
      813      923    1   DCL 1 TDM$MIRSCHEDL     ENTRY(3) ;
      814      924        /*
      815      925                        Symrefs
      816      926        */
      817      927    1   DCL 1 NK_MXLOCAL        UBIN SYMREF ;
      818      928        /*
      819      929                        Auto
      820      930        */
      821      931    1   DCL 1 BQ$               PTR ALIGNED AUTO ;
      822      932    1   DCL 1 MDCT$             PTR ALIGNED AUTO ;
      823      933    1   DCL 1 MDCTX             UBIN WORD AUTO ;
      824      934    1   DCL 1 MSQH$             PTR ALIGNED AUTO ;
      825      935    1   DCL 1 REQ$              PTR ALIGNED AUTO ;
      826      936    1   DCL 1 SQ$               PTR ALIGNED AUTO ;
      827      937    1   DCL 1 SQH$              PTR ALIGNED AUTO ;
      828      938    1   DCL 1 TIME              UBIN WORD ALIGNED AUTO ;
      829      939        /*
      830      940                        Based
      831      941        */
      832      942        %NI$DCT                 ( NAME=MDCT, STCLASS="BASED(MDCT$)" ) ;
      833      990        %NI$DQH                 ( NAME=DQH,  STCLASS=BASED          ) ;
PL6.E3A0      #003=TDM$MIRFAIL File=TDM$MIRROR.:E05TSI                           WED 07/30/97 06:04 Page:137  
      834     1013        %N$REQ                  ( NAME=REQ,  STCLASS="BASED(REQ$)" ) ;
      835     1071        %NI$SQH                 ( NAME=MSQH, STCLASS="BASED(MSQH$)" ) ;
      836     1084        %NI$SQH                 ( NAME=SQH,  STCLASS="BASED(SQH$)"  ) ;
      837     1097
      838     1098        %EJECT ;
PL6.E3A0      #003=TDM$MIRFAIL File=TDM$MIRROR.:E05TSI                           WED 07/30/97 06:04 Page:138  
      839     1099    1   SQH$  = DCT.SQH$ ;

   1099  0 000002   200003 470500                    LDP0    @DCT,,AUTO
         0 000003   000022 236100                    LDQ     18,,PR0
         0 000004   200013 756100                    STQ     SQH$,,AUTO

      840     1100
      841     1101    1   IF  ADDR(UTS) = ADDR(NIL)

   1101  0 000005   200004 236100                    LDQ     @UTS,,AUTO
         0 000006   000001 116000 xsym               CMPQ    B_VECTNIL+1
         0 000007   000017 601000 0                  TNZ     s:1105

      842     1102    1   THEN
      843     1103    1       CALL SSS$CURTIME ( TIME ) ;

   1103  0 000010   200014 631500                    EPPR1   TIME,,AUTO
         0 000011   200022 451500                    STP1    @P$+2,,AUTO
         0 000012   200022 630500                    EPPR0   @P$+2,,AUTO
         0 000013   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000014   000000 701000 xent               TSX1    SSS$CURTIME
         0 000015   000000 011000                    NOP     0
         0 000016   000022 710000 0                  TRA     s:1107

      844     1104    1   ELSE
      845     1105    1       TIME = UTS ;

   1105  0 000017   200004 471500                    LDP1    @UTS,,AUTO
         0 000020   100000 235100                    LDA     0,,PR1
         0 000021   200014 755100                    STA     TIME,,AUTO

      846     1106
      847     1107    1   MDCTX = DCT.DP.MIRROR.DCTX ;

   1107  0 000022   200003 470500                    LDP0    @DCT,,AUTO
         0 000023   000037 236100                    LDQ     31,,PR0
         0 000024   000022 772000                    QRL     18
PL6.E3A0      #003=TDM$MIRFAIL File=TDM$MIRROR.:E05TSI                           WED 07/30/97 06:04 Page:139  
         0 000025   200007 756100                    STQ     MDCTX,,AUTO

      848     1108    1   IF  MDCTX = 0

   1108  0 000026   000032 600000 0                  TZE     s:1117
         0 000027   000000 116000 xsym               CMPQ    NK_MXLOCAL
         0 000030   000035 602000 0                  TNC     s:1119
         0 000031   000035 600000 0                  TZE     s:1119

      849     1109    1   OR  MDCTX > NK_MXLOCAL
      850     1110    1   THEN
      851     1111        /*S* SCREECH_CODE:  TDM-S$INVMIR-7
      852     1112             TYPE:          SCREECH
      853     1113             MESSAGE:       Invalid Mirrored Disk DCT index.
      854     1114             DESCRIPTION:   The DCT index for the mirror of this Mirrored
      855     1115                            Disk device is invalid.
      856     1116                                                                           */
      857     1117    1       CALL SC_TDMINVMIR ;

   1117  0 000032   000000 713400 xsym               CLIMB   SC_TDMINVMIR
         0 000033   000000 600000 xsid               climb   nvectors=         0
         0 000034   000040 710000 0                  TRA     s:1121

      858     1118    1   ELSE
      859     1119    1       MDCT$ = N$DCT$(MDCTX) ;

   1119  0 000035   000000 471400 xsym               LDP1    N$DCT$$
         0 000036   100000 236106                    LDQ     0,QL,PR1
         0 000037   200006 756100                    STQ     MDCT$,,AUTO

      860     1120
      861     1121    1   IF  MDCT.DP.MIRROR.STATE ~= %NI_MIRROR_OPER AND

   1121  0 000040   200006 470500                    LDP0    MDCT$,,AUTO
         0 000041   000036 236100                    LDQ     30,,PR0
         0 000042   007700 316003                    CANQ    4032,DU
         0 000043   000053 600000 0                  TZE     s:1134
PL6.E3A0      #003=TDM$MIRFAIL File=TDM$MIRROR.:E05TSI                           WED 07/30/97 06:04 Page:140  
         0 000044   000036 236100                    LDQ     30,,PR0
         0 000045   007700 376003                    ANQ     4032,DU
         0 000046   000300 116003                    CMPQ    192,DU
         0 000047   000053 600000 0                  TZE     s:1134

      862     1122    1       MDCT.DP.MIRROR.STATE ~= %NI_MIRROR_WAIT
      863     1123    1   THEN
      864     1124        /*S* SCREECH_CODE:  TDM-S$NOPMIR-7
      865     1125             TYPE:          SCREECH
      866     1126             MESSAGE:       No operational Mirrored Disk device.
      867     1127             DESCRIPTION:   The IO system detected no operational Mirrored Disk device
      868     1128                            in a Mirrored Disk pair.  There is always supposed to be
      869     1129                            one operational Mirrored Disk device for normal Mirrored
      870     1130                            Disk IO.
      871     1131                                                                                   */
      872     1132    1       CALL SC_TDMNOPMIR ;

   1132  0 000050   000000 713400 xsym               CLIMB   SC_TDMNOPMIR
         0 000051   000000 600000 xsid               climb   nvectors=         0
         0 000052   000055 710000 0                  TRA     s:1136

      873     1133    1   ELSE
      874     1134    1       MSQH$ = MDCT.SQH$ ;

   1134  0 000053   000022 236100                    LDQ     18,,PR0
         0 000054   200010 756100                    STQ     MSQH$,,AUTO

      875     1135
      876     1136    1   IF  DCT.DP.MIRROR.PRI

   1136  0 000055   200003 470500                    LDP0    @DCT,,AUTO
         0 000056   000036 236100                    LDQ     30,,PR0
         0 000057   020000 316003                    CANQ    8192,DU
         0 000060   000076 600000 0                  TZE     s:1143

      877     1137    2   THEN DO ;

PL6.E3A0      #003=TDM$MIRFAIL File=TDM$MIRROR.:E05TSI                           WED 07/30/97 06:04 Page:141  
      878     1138    2       CALL FMN$MRRSWITCH ( DCT.DCTX ) ;

   1138  0 000061   200003 236100                    LDQ     @DCT,,AUTO
         0 000062   000006 036003                    ADLQ    6,DU
         0 000063   200022 756100                    STQ     @P$+2,,AUTO
         0 000064   200022 630500                    EPPR0   @P$+2,,AUTO
         0 000065   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000066   000000 701000 xent               TSX1    FMN$MRRSWITCH
         0 000067   000000 011000                    NOP     0

      879     1139    2       DCT.DP.MIRROR.PRI  = '0'B ;

   1139  0 000070   200003 470500                    LDP0    @DCT,,AUTO
         0 000071   000000 236000 1                  LDQ     0
         0 000072   000036 356100                    ANSQ    30,,PR0

      880     1140    2       MDCT.DP.MIRROR.PRI = '1'B ;

   1140  0 000073   200006 471500                    LDP1    MDCT$,,AUTO
         0 000074   020000 236003                    LDQ     8192,DU
         0 000075   100036 256100                    ORSQ    30,,PR1

      881     1141    2       END ;

      882     1142
      883     1143    1   CALL TDM$MIRSCHEDL ( DCT, %NI_MIRROR_FAIL,  TIME ) ;

   1143  0 000076   200014 631500                    EPPR1   TIME,,AUTO
         0 000077   200024 451500                    STP1    @P$+4,,AUTO
         0 000100   000001 236000 1                  LDQ     1
         0 000101   200003 235100                    LDA     @DCT,,AUTO
         0 000102   200022 757100                    STAQ    @P$+2,,AUTO
         0 000103   200022 630500                    EPPR0   @P$+2,,AUTO
         0 000104   000021 631400 xsym               EPPR1   B_VECTNIL+17
         0 000105   000000 701000 xent               TSX1    TDM$MIRSCHEDL
         0 000106   000000 011000                    NOP     0

PL6.E3A0      #003=TDM$MIRFAIL File=TDM$MIRROR.:E05TSI                           WED 07/30/97 06:04 Page:142  
      884     1144
      885     1145        %LOCK  ( G#=MSQH.GATE ) ;

   1146  0 000107   200010 630500                    EPPR0   MSQH$,,AUTO
         0 000110   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000111   000000 701000 xent               TSX1    HFC$LOCK
         0 000112   000000 011000                    NOP     0

      886     1148
      887     1149    1   IF  MDCT.STATE = %BUSY

   1149  0 000113   200006 470500                    LDP0    MDCT$,,AUTO
         0 000114   000007 236100                    LDQ     7,,PR0
         0 000115   000077 376007                    ANQ     63,DL
         0 000116   000005 116007                    CMPQ    5,DL
         0 000117   000134 601000 0                  TNZ     s:1159

      888     1150    2   THEN DO ;

      889     1151    2       REQ$ = MDCT.DQH$->DQH.IO$ ;

   1151  0 000120   000023 471500                    LDP1    19,,PR0
         0 000121   100014 236100                    LDQ     12,,PR1
         0 000122   200011 756100                    STQ     REQ$,,AUTO

      890     1152    2       IF  REQ.COMP = %COMP_MIRROR

   1152  0 000123   200011 473500                    LDP3    REQ$,,AUTO
         0 000124   300027 236100                    LDQ     23,,PR3
         0 000125   177000 376007                    ANQ     65024,DL
         0 000126   010000 116007                    CMPQ    4096,DL
         0 000127   000134 601000 0                  TNZ     s:1159

      891     1153    3       THEN DO ;

      892     1154    3           REQ.COMP  = %COMP_REG ;

PL6.E3A0      #003=TDM$MIRFAIL File=TDM$MIRROR.:E05TSI                           WED 07/30/97 06:04 Page:143  
   1154  0 000130   000002 236000 1                  LDQ     2
         0 000131   300027 356100                    ANSQ    23,,PR3

      893     1155    3           REQ.DOMIR = '0'B ;

   1155  0 000132   000031 236000 xsym               LDQ     B_VECTNIL+25
         0 000133   300034 356100                    ANSQ    28,,PR3

      894     1156    3           END ;

      895     1157    2       END ;

      896     1158
      897     1159    1   SQ$         = MDCT.SQ$ ;

   1159  0 000134   000001 236100                    LDQ     1,,PR0
         0 000135   200012 756100                    STQ     SQ$,,AUTO

      898     1160    1   BQ$         = MDCT.DP.BQ$ ;

   1160  0 000136   000030 236100                    LDQ     24,,PR0
         0 000137   200005 756100                    STQ     BQ$,,AUTO

      899     1161    1   MDCT.SQ$    = ADDR(NIL) ;

   1161  0 000140   000001 236000 xsym               LDQ     B_VECTNIL+1
         0 000141   000001 756100                    STQ     1,,PR0

      900     1162    1   MDCT.DP.BQ$ = ADDR(NIL) ;

   1162  0 000142   000001 236000 xsym               LDQ     B_VECTNIL+1
         0 000143   000030 756100                    STQ     24,,PR0

      901     1163
      902     1164    1   CALL REQMOD ( SQ$, MDCT.SQ$ ) ;

   1164  0 000144   200006 236100                    LDQ     MDCT$,,AUTO
PL6.E3A0      #003=TDM$MIRFAIL File=TDM$MIRROR.:E05TSI                           WED 07/30/97 06:04 Page:144  
         0 000145   000001 036003                    ADLQ    1,DU
         0 000146   200020 756100                    STQ     @Q$+1,,AUTO
         0 000147   200012 631500                    EPPR1   SQ$,,AUTO
         0 000150   200017 451500                    STP1    TIME+3,,AUTO
         0 000151   000262 701000 0                  TSX1    REQMOD
         0 000152   000000 011000                    NOP     0

      903     1165    1   CALL REQMOD ( BQ$, MDCT.DP.BQ$ ) ;

   1165  0 000153   200006 236100                    LDQ     MDCT$,,AUTO
         0 000154   000030 036003                    ADLQ    24,DU
         0 000155   200020 756100                    STQ     @Q$+1,,AUTO
         0 000156   200005 630500                    EPPR0   BQ$,,AUTO
         0 000157   200017 450500                    STP0    TIME+3,,AUTO
         0 000160   000262 701000 0                  TSX1    REQMOD
         0 000161   000000 011000                    NOP     0

      904     1166
      905     1167    1   CALL TDM$MIRSCHEDL ( MDCT, %NI_MIRROR_NONE, TIME ) ;

   1167  0 000162   200014 630500                    EPPR0   TIME,,AUTO
         0 000163   200024 450500                    STP0    @P$+4,,AUTO
         0 000164   000003 236000 1                  LDQ     3
         0 000165   200006 235100                    LDA     MDCT$,,AUTO
         0 000166   200022 757100                    STAQ    @P$+2,,AUTO
         0 000167   200022 630500                    EPPR0   @P$+2,,AUTO
         0 000170   000021 631400 xsym               EPPR1   B_VECTNIL+17
         0 000171   000000 701000 xent               TSX1    TDM$MIRSCHEDL
         0 000172   000000 011000                    NOP     0

      906     1168    1   MDCT.DP.MIRROR.STATE = %NI_MIRROR_OPER ; /* PIG writes this to the VID */

   1168  0 000173   200006 470500                    LDP0    MDCT$,,AUTO
         0 000174   000000 236003                    LDQ     0,DU
         0 000175   000036 752120                    STCQ    30,'20'O,PR0

      907     1169
PL6.E3A0      #003=TDM$MIRFAIL File=TDM$MIRROR.:E05TSI                           WED 07/30/97 06:04 Page:145  
      908     1170    1   CALL FMN$AVR ( MDCT.DCTX, %NI_AVR_MIRROR ) ;

   1170  0 000176   000004 236000 1                  LDQ     4
         0 000177   200023 756100                    STQ     @P$+3,,AUTO
         0 000200   200006 236100                    LDQ     MDCT$,,AUTO
         0 000201   000006 036003                    ADLQ    6,DU
         0 000202   200022 756100                    STQ     @P$+2,,AUTO
         0 000203   200022 630500                    EPPR0   @P$+2,,AUTO
         0 000204   000020 631400 xsym               EPPR1   B_VECTNIL+16
         0 000205   000000 701000 xent               TSX1    FMN$AVR
         0 000206   000000 011000                    NOP     0

      909     1171
      910     1172        %LOCK  ( G#=SQH.GATE ) ;

   1173  0 000207   200013 630500                    EPPR0   SQH$,,AUTO
         0 000210   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000211   000000 701000 xent               TSX1    HFC$LOCK
         0 000212   000000 011000                    NOP     0

      911     1175
      912     1176    1   SQ$        = DCT.SQ$ ;

   1176  0 000213   200003 470500                    LDP0    @DCT,,AUTO
         0 000214   000001 236100                    LDQ     1,,PR0
         0 000215   200012 756100                    STQ     SQ$,,AUTO

      913     1177    1   BQ$        = DCT.DP.BQ$ ;

   1177  0 000216   000030 236100                    LDQ     24,,PR0
         0 000217   200005 756100                    STQ     BQ$,,AUTO

      914     1178    1   DCT.SQ$    = ADDR(NIL) ;

   1178  0 000220   000001 236000 xsym               LDQ     B_VECTNIL+1
         0 000221   000001 756100                    STQ     1,,PR0

PL6.E3A0      #003=TDM$MIRFAIL File=TDM$MIRROR.:E05TSI                           WED 07/30/97 06:04 Page:146  
      915     1179    1   DCT.DP.BQ$ = ADDR(NIL) ;

   1179  0 000222   000001 236000 xsym               LDQ     B_VECTNIL+1
         0 000223   000030 756100                    STQ     24,,PR0

      916     1180
      917     1181    1   CALL REQMOVE ( SQ$ ) ;

   1181  0 000224   200012 631500                    EPPR1   SQ$,,AUTO
         0 000225   200017 451500                    STP1    TIME+3,,AUTO
         0 000226   000322 701000 0                  TSX1    REQMOVE
         0 000227   000000 011000                    NOP     0

      918     1182    1   CALL REQMOVE ( BQ$ ) ;

   1182  0 000230   200005 630500                    EPPR0   BQ$,,AUTO
         0 000231   200017 450500                    STP0    TIME+3,,AUTO
         0 000232   000322 701000 0                  TSX1    REQMOVE
         0 000233   000000 011000                    NOP     0

      919     1183
      920     1184    1   CALL TDM$MIRSCHEDL  ( DCT, %NI_MIRROR_NONE, TIME ) ;

   1184  0 000234   200014 630500                    EPPR0   TIME,,AUTO
         0 000235   200024 450500                    STP0    @P$+4,,AUTO
         0 000236   000003 236000 1                  LDQ     3
         0 000237   200003 235100                    LDA     @DCT,,AUTO
         0 000240   200022 757100                    STAQ    @P$+2,,AUTO
         0 000241   200022 630500                    EPPR0   @P$+2,,AUTO
         0 000242   000021 631400 xsym               EPPR1   B_VECTNIL+17
         0 000243   000000 701000 xent               TSX1    TDM$MIRSCHEDL
         0 000244   000000 011000                    NOP     0

      921     1185    1   DCT.DP.MIRROR.STATE = %NI_MIRROR_FAIL ; /* PIG writes this to the VID */

   1185  0 000245   200003 470500                    LDP0    @DCT,,AUTO
         0 000246   000100 236003                    LDQ     64,DU
PL6.E3A0      #003=TDM$MIRFAIL File=TDM$MIRROR.:E05TSI                           WED 07/30/97 06:04 Page:147  
         0 000247   000036 752120                    STCQ    30,'20'O,PR0

      922     1186
      923     1187    1   CALL FMN$AVR ( DCT.DCTX,  %NI_AVR_MIRROR ) ;

   1187  0 000250   000004 236000 1                  LDQ     4
         0 000251   200023 756100                    STQ     @P$+3,,AUTO
         0 000252   200003 236100                    LDQ     @DCT,,AUTO
         0 000253   000006 036003                    ADLQ    6,DU
         0 000254   200022 756100                    STQ     @P$+2,,AUTO
         0 000255   200022 630500                    EPPR0   @P$+2,,AUTO
         0 000256   000020 631400 xsym               EPPR1   B_VECTNIL+16
         0 000257   000000 701000 xent               TSX1    FMN$AVR
         0 000260   000000 011000                    NOP     0

      924     1188
      925     1189    1   RETURN ;

   1189  0 000261   000000 702200 xent               TSX2  ! X66_ARET

      926     1190
      927     1191        %EJECT ;
PL6.E3A0      #003=TDM$MIRFAIL File=TDM$MIRROR.:E05TSI                           WED 07/30/97 06:04 Page:148  
      928     1192    1   REQMOD:         PROC ( Q$, P$ ) ;

   1192  0 000262   200016 741300       REQMOD       STX1  ! TIME+2,,AUTO

      929     1193        /*
      930     1194                        Parameters
      931     1195        */
      932     1196    2   DCL 1 Q$                PTR ALIGNED PARAM ;
      933     1197    2   DCL 1 P$                PTR ALIGNED PARAM ;
      934     1198
      935     1199
      936     1200
      937     1201    3   DO  WHILE ( Q$ ~= ADDR(NIL) ) ;

   1201  0 000263   000314 710000 0                  TRA     s:1217

      938     1202            %DEQUEUE ( P#=REQ$, Q#=Q$ ) ;

   1206  0 000264   200017 236100                    LDQ     @Q$,,AUTO
         0 000265   200023 756100                    STQ     @P$+3,,AUTO
         0 000266   200011 630500                    EPPR0   REQ$,,AUTO
         0 000267   200022 450500                    STP0    @P$+2,,AUTO
         0 000270   200022 630500                    EPPR0   @P$+2,,AUTO
         0 000271   000020 631400 xsym               EPPR1   B_VECTNIL+16
         0 000272   000000 701000 xent               TSX1    NIM$DEQUEUE
         0 000273   000000 011000                    NOP     0

      939     1209    3       IF  REQ.COMP = %COMP_MIRROR

   1209  0 000274   200011 470500                    LDP0    REQ$,,AUTO
         0 000275   000027 236100                    LDQ     23,,PR0
         0 000276   177000 376007                    ANQ     65024,DL
         0 000277   010000 116007                    CMPQ    4096,DL
         0 000300   000305 601000 0                  TNZ     s:1215

      940     1210    4       THEN DO ;

PL6.E3A0      #003=TDM$MIRFAIL File=TDM$MIRROR.:E05TSI                           WED 07/30/97 06:04 Page:149  
      941     1211    4           REQ.COMP  = %COMP_REG ;

   1211  0 000301   000002 236000 1                  LDQ     2
         0 000302   000027 356100                    ANSQ    23,,PR0

      942     1212    4           REQ.DOMIR = '0'B ;

   1212  0 000303   000031 236000 xsym               LDQ     B_VECTNIL+25
         0 000304   000034 356100                    ANSQ    28,,PR0

      943     1213    4           END ;

      944     1214            %ENQUEUE ( P#=REQ, Q#=P$ ) ;

   1215  0 000305   200020 236100                    LDQ     @P$,,AUTO
         0 000306   200011 235100                    LDA     REQ$,,AUTO
         0 000307   200022 757100                    STAQ    @P$+2,,AUTO
         0 000310   200022 630500                    EPPR0   @P$+2,,AUTO
         0 000311   000020 631400 xsym               EPPR1   B_VECTNIL+16
         0 000312   000000 701000 xent               TSX1    NIM$ENQUEUE
         0 000313   000000 011000                    NOP     0

      945     1217    3       END ;

   1217  0 000314   200017 470500                    LDP0    @Q$,,AUTO
         0 000315   000000 236100                    LDQ     0,,PR0
         0 000316   000001 116000 xsym               CMPQ    B_VECTNIL+1
         0 000317   000264 601000 0                  TNZ     s:1206

      946     1218
      947     1219    2   RETURN ;

   1219  0 000320   200016 221300                    LDX1  ! TIME+2,,AUTO
         0 000321   000001 702211                    TSX2  ! 1,X1

      948     1220
      949     1221    2   END REQMOD ;
PL6.E3A0      #003=TDM$MIRFAIL File=TDM$MIRROR.:E05TSI                           WED 07/30/97 06:04 Page:150  
      950     1222
      951     1223        %EJECT ;
PL6.E3A0      #003=TDM$MIRFAIL File=TDM$MIRROR.:E05TSI                           WED 07/30/97 06:04 Page:151  
      952     1224    1   REQMOVE:        PROC ( Q$ ) ;

   1224  0 000322   200016 741300       REQMOVE      STX1  ! TIME+2,,AUTO

      953     1225        /*
      954     1226                        Parameters
      955     1227        */
      956     1228    2   DCL 1 Q$                PTR ALIGNED PARAM ;
      957     1229
      958     1230
      959     1231
      960     1232    3   DO  WHILE ( Q$ ~= ADDR(NIL) ) ;

   1232  0 000323   000427 710000 0                  TRA     s:1269

      961     1233            %DEQUEUE ( P#=REQ$, Q#=Q$ ) ;

   1237  0 000324   200017 236100                    LDQ     @Q$,,AUTO
         0 000325   200023 756100                    STQ     @P$+3,,AUTO
         0 000326   200011 630500                    EPPR0   REQ$,,AUTO
         0 000327   200022 450500                    STP0    @P$+2,,AUTO
         0 000330   200022 630500                    EPPR0   @P$+2,,AUTO
         0 000331   000020 631400 xsym               EPPR1   B_VECTNIL+16
         0 000332   000000 701000 xent               TSX1    NIM$DEQUEUE
         0 000333   000000 011000                    NOP     0

      962     1240    3       IF  REQ.COMP = %COMP_MIRROR

   1240  0 000334   200011 470500                    LDP0    REQ$,,AUTO
         0 000335   000027 236100                    LDQ     23,,PR0
         0 000336   177000 376007                    ANQ     65024,DL
         0 000337   010000 116007                    CMPQ    4096,DL
         0 000340   000423 601000 0                  TNZ     s:1268

      963     1241    4       THEN DO ;

      964     1242    4           REQ.COMP     = %COMP_REG ;
PL6.E3A0      #003=TDM$MIRFAIL File=TDM$MIRROR.:E05TSI                           WED 07/30/97 06:04 Page:152  

   1242  0 000341   000002 236000 1                  LDQ     2
         0 000342   000027 356100                    ANSQ    23,,PR0

      965     1243    4           REQ.DOMIR    = '0'B ;

   1243  0 000343   000031 236000 xsym               LDQ     B_VECTNIL+25
         0 000344   000034 356100                    ANSQ    28,,PR0

      966     1244    4           REQ.DLA.DCTX = MDCTX ;

   1244  0 000345   200007 236100                    LDQ     MDCTX,,AUTO
         0 000346   000025 736000                    QLS     21
         0 000347   000001 676100                    ERQ     1,,PR0
         0 000350   777770 376003                    ANQ     -8,DU
         0 000351   000001 656100                    ERSQ    1,,PR0

      967     1245    4           REQ.DCT$     = MDCT$ ;

   1245  0 000352   200006 236100                    LDQ     MDCT$,,AUTO
         0 000353   200011 470500                    LDP0    REQ$,,AUTO
         0 000354   000002 756100                    STQ     2,,PR0

      968     1246    4           IF  NOT REQ.MIRDONE

   1246  0 000355   200011 470500                    LDP0    REQ$,,AUTO
         0 000356   000034 236100                    LDQ     28,,PR0
         0 000357   100000 316003                    CANQ    32768,DU
         0 000360   000402 601000 0                  TNZ     s:1257

      969     1247    5           THEN DO ;

      970     1248    5               CALL NIO$DCWBLD ( REQ ) ;

   1248  0 000361   200011 630500                    EPPR0   REQ$,,AUTO
         0 000362   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000363   000000 701000 xent               TSX1    NIO$DCWBLD
PL6.E3A0      #003=TDM$MIRFAIL File=TDM$MIRROR.:E05TSI                           WED 07/30/97 06:04 Page:153  
         0 000364   000000 011000                    NOP     0

      971     1249    5               IF  MSQH$ = SQH$

   1249  0 000365   200010 236100                    LDQ     MSQH$,,AUTO
         0 000366   200013 116100                    CMPQ    SQH$,,AUTO
         0 000367   000375 601000 0                  TNZ     s:1253

      972     1250    5               THEN
      973     1251    5                   CALL NID$REQSCHEDL ( REQ ) ;

   1251  0 000370   200011 630500                    EPPR0   REQ$,,AUTO
         0 000371   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000372   000000 701000 xent               TSX1    NID$REQSCHEDL
         0 000373   000000 011000                    NOP     0
         0 000374   000427 710000 0                  TRA     s:1269

      974     1252    5               ELSE
      975     1253    5                   CALL NID$REQSCHED  ( REQ ) ;

   1253  0 000375   200011 630500                    EPPR0   REQ$,,AUTO
         0 000376   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000377   000000 701000 xent               TSX1    NID$REQSCHED
         0 000400   000000 011000                    NOP     0

      976     1254    5               END ;

   1254  0 000401   000427 710000 0                  TRA     s:1269

      977     1255    5           ELSE DO ;

      978     1256                    %LOCK    ( G#=NI$RP.GATE ) ;

   1257  0 000402   000000 630400 xsym               EPPR0   NI$RP$
         0 000403   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000404   000000 701000 xent               TSX1    HFC$LOCK
         0 000405   000000 011000                    NOP     0
PL6.E3A0      #003=TDM$MIRFAIL File=TDM$MIRROR.:E05TSI                           WED 07/30/97 06:04 Page:154  

      979     1259                    %ENQUEUE ( P#=REQ, Q#=NI$RP.RC$ ) ;

   1260  0 000406   000000 236000 xsym               LDQ     NI$RP$
         0 000407   000003 036003                    ADLQ    3,DU
         0 000410   200011 235100                    LDA     REQ$,,AUTO
         0 000411   200022 757100                    STAQ    @P$+2,,AUTO
         0 000412   200022 630500                    EPPR0   @P$+2,,AUTO
         0 000413   000020 631400 xsym               EPPR1   B_VECTNIL+16
         0 000414   000000 701000 xent               TSX1    NIM$ENQUEUE
         0 000415   000000 011000                    NOP     0

      980     1262                    %UNLOCK  ( G#=NI$RP.GATE ) ;

   1263  0 000416   000000 630400 xsym               EPPR0   NI$RP$
         0 000417   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000420   000000 701000 xent               TSX1    HFC$UNLOCK
         0 000421   000000 011000                    NOP     0

      981     1265    5               END ;

      982     1266    4           END ;

   1266  0 000422   000427 710000 0                  TRA     s:1269

      983     1267    3       ELSE
      984     1268    3           CALL NID$REQSCHEDL ( REQ ) ;

   1268  0 000423   200011 630500                    EPPR0   REQ$,,AUTO
         0 000424   000017 631400 xsym               EPPR1   B_VECTNIL+15
         0 000425   000000 701000 xent               TSX1    NID$REQSCHEDL
         0 000426   000000 011000                    NOP     0

      985     1269    3       END ;

   1269  0 000427   200017 470500                    LDP0    @Q$,,AUTO
         0 000430   000000 236100                    LDQ     0,,PR0
PL6.E3A0      #003=TDM$MIRFAIL File=TDM$MIRROR.:E05TSI                           WED 07/30/97 06:04 Page:155  
         0 000431   000001 116000 xsym               CMPQ    B_VECTNIL+1
         0 000432   000324 601000 0                  TNZ     s:1237

      986     1270
      987     1271    2   RETURN ;

   1271  0 000433   200016 221300                    LDX1  ! TIME+2,,AUTO
         0 000434   000001 702211                    TSX2  ! 1,X1

(unnamed)
 Sect OctLoc
   1     000   757777 777777   000003 006000   777777 600777   000006 006000    ................
   1     004   000007 006000                                                    ....
      988     1272
      989     1273    2   END REQMOVE ;
      990     1274
      991     1275    1   END TDM$MIRFAIL ;

PL6.E3A0      #003=TDM$MIRFAIL File=TDM$MIRROR.:E05TSI                           WED 07/30/97 06:04 Page:156  
--  Include file information  --

   NI_MACROS_C.:E05TOU  cannot be made into a system file and is referenced.
   NI$TABLES.:E05TOU  is referenced.
   N$REQ.:E05TOU  is referenced.
   NI_DATA_R.:E05TOU  cannot be made into a system file and is referenced.
   NI_DATA_C.:E05TOU  is referenced.
   HF_LOCK_C.:E05TOU  cannot be made into a system file and is referenced.
      No diagnostics issued in procedure TDM$MIRFAIL.
PL6.E3A0      #003=TDM$MIRFAIL File=TDM$MIRROR.:E05TSI                           WED 07/30/97 06:04 Page:157  

 **** Variables and constants ****

  ****  Auto variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     3-0-0/w PTR         r     1 @DCT                      20-0-0/w PTR         r     1 @P$
    17-0-0/w PTR         r     1 @Q$                       17-0-0/w PTR         r     1 @Q$
     4-0-0/w PTR         r     1 @UTS                       5-0-0/w PTR         r     1 BQ$
    *0-0-0/w STRC(1332)  r     1 DCT                        6-0-0/w PTR         r     1 MDCT$
     7-0-0/w UBIN        r     1 MDCTX                     10-0-0/w PTR         r     1 MSQH$
    *0-0-0/w PTR         r     1 P$                        *0-0-0/w PTR         r     1 Q$
    *0-0-0/w PTR         r     1 Q$                        11-0-0/w PTR         r     1 REQ$
    12-0-0/w PTR         r     1 SQ$                       13-0-0/w PTR         r     1 SQH$
    14-0-0/w UBIN        r     1 TIME                      *0-0-0/w UBIN        r     1 UTS

  ****  SYMREF variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w PTR         r     1 N$DCT$$                    0-0-0/w PTR         r     1 N$FQ$
     0-0-0/w PTR         r     1 NI$FQ$                     0-0-0/w PTR         r     1 NI$IBUF$
     0-0-0/w PTR         r     1 NI$RP$                     0-0-0/w UBIN        r     1 NK_MXLOCAL

  ****  BASED and DCB variables  ****

  ****  Scalars and arrays  ****
OctLoc.c.b A Datatyp(siz) R M Lvl/name                 OctLoc.c.b A Datatyp(siz) R M Lvl/name

     0-0-0/w STRC(648)   r     1 DQH                        0-0-0/w STRC(1332)  r     1 MDCT
     0-0-0/w STRC(252)   r     1 MSQH                       0-0-0/w PTR         r     1 N$DCT$(0:0)
     0-0-0/w STRC(180)   r     1 NI$RP                      0-0-0/d STRC(1080)  r     1 REQ
     0-0-0/w STRC(252)   r     1 SQH

PL6.E3A0      #003=TDM$MIRFAIL File=TDM$MIRROR.:E05TSI                           WED 07/30/97 06:04 Page:158  

   Procedure TDM$MIRFAIL requires 285 words for executable code.
   Procedure TDM$MIRFAIL requires 22 words of local(AUTO) storage.

    No errors detected in file TDM$MIRROR.:E05TSI    .
PL6.E3A0      #003=TDM$MIRFAIL File=TDM$MIRROR.:E05TSI                           WED 07/30/97 06:04 Page:159  
          *** CROSS REFERENCE LISTING ***
**     DENOTES     IDENTIFIER DEFINITION
<<                 IDENTIFIER'S VALUE SET
>>                 IDENTIFIER'S VALUE USED
<>                 IDENTIFIER SET AND/OR USED
--                 IDENTIFIER REFERENCED
PL6.E3A0      #003=TDM$MIRFAIL File=TDM$MIRROR.:E05TSI                           WED 07/30/97 06:04 Page:160  
          MINI XREF LISTING

BQ$
       931**DCL      1160<<ASSIGN   1165<>CALL     1177<<ASSIGN   1182<>CALL
DCT
       871**DCL         6--PROC     1143<>CALL     1184<>CALL
DCT.DCTX
       872**DCL      1138<>CALL     1187<>CALL
DCT.DP
       891**DCL       898--REDEF     901--REDEF     902--REDEF     904--REDEF     904--REDEF     905--REDEF
       906--REDEF     906--REDEF
DCT.DP.BQ$
       891**DCL      1177>>ASSIGN   1179<<ASSIGN
DCT.DP.MIRROR.DCTX
       896**DCL      1107>>ASSIGN
DCT.DP.MIRROR.PRI
       895**DCL      1136>>IF       1139<<ASSIGN
DCT.DP.MIRROR.STATE
       895**DCL      1185<<ASSIGN
DCT.MPC.IOCHANX
       899**DCL       899--REDEF
DCT.SQ$
       871**DCL      1176>>ASSIGN   1178<<ASSIGN
DCT.SQH$
       886**DCL      1099>>ASSIGN
DQH.IO$
      1006**DCL      1151>>ASSIGN
DQH.IOCHANX
      1001**DCL      1002--REDEF
DQH.MBX$
      1010**DCL      1011--REDEF
FMN$AVR
       914**DCL-ENT  1170--CALL     1187--CALL
FMN$MRRSWITCH
PL6.E3A0      #003=TDM$MIRFAIL File=TDM$MIRROR.:E05TSI                           WED 07/30/97 06:04 Page:161  
       915**DCL-ENT  1138--CALL
HFC$LOCK
        41**DCL-ENT  1146--CALL     1173--CALL     1257--CALL
HFC$UNLOCK
        41**DCL-ENT  1263--CALL
MDCT
       951**DCL      1167<>CALL
MDCT.DCTX
       952**DCL      1170<>CALL
MDCT.DP
       971**DCL       978--REDEF     981--REDEF     982--REDEF     984--REDEF     984--REDEF     985--REDEF
       986--REDEF     986--REDEF
MDCT.DP.BQ$
       971**DCL      1160>>ASSIGN   1162<<ASSIGN   1165<>CALL
MDCT.DP.MIRROR.PRI
       975**DCL      1140<<ASSIGN
MDCT.DP.MIRROR.STATE
       975**DCL      1121>>IF       1121>>IF       1168<<ASSIGN
MDCT.DQH$
       967**DCL      1151>>ASSIGN
MDCT.MPC.IOCHANX
       979**DCL       979--REDEF
MDCT.SQ$
       951**DCL      1159>>ASSIGN   1161<<ASSIGN   1164<>CALL
MDCT.SQH$
       966**DCL      1134>>ASSIGN
MDCT.STATE
       961**DCL      1149>>IF
MDCT$
       932**DCL       951--IMP-PTR  1119<<ASSIGN   1121>>IF       1121>>IF       1134>>ASSIGN   1140>>ASSIGN
      1149>>IF       1151>>ASSIGN   1159>>ASSIGN   1160>>ASSIGN   1161>>ASSIGN   1162>>ASSIGN   1164>>CALL
      1165>>CALL     1167>>CALL     1168>>ASSIGN   1170>>CALL     1245>>ASSIGN
MDCTX
       933**DCL      1107<<ASSIGN   1108>>IF       1108>>IF       1119>>ASSIGN   1244>>ASSIGN
MSQH.DOOR
      1080**DCL      1080--REDEF
PL6.E3A0      #003=TDM$MIRFAIL File=TDM$MIRROR.:E05TSI                           WED 07/30/97 06:04 Page:162  
MSQH.GATE
      1080**DCL      1146<>CALL
MSQH$
       934**DCL      1080--IMP-PTR  1134<<ASSIGN   1146>>CALL     1249>>IF
N$DCT$
       587**DCL      1119>>ASSIGN
N$DCT$$
       453**DCL       587--IMP-PTR  1119>>ASSIGN
N$FQ$
       453**DCL       588--IMP-PTR
N$REQ_INIT.BUFADDR
       472**DCL       473--REDEF     473--REDEF
N$REQ_INIT.DLA.DRELADDR
       464**DCL       464--REDEF
N$REQ_INIT.DVE.EOMCHAR
       501**DCL       502--REDEF
N$REQ_INIT.EAINFO
       495**DCL       495--REDEF
N$REQ_INIT.EAINFOX
       495**DCL       496--REDEF
N$REQ_INIT.EVNTINFO
       496**DCL       496--REDEF
N$REQ_INIT.STATUS
       477**DCL       483--REDEF
NI$FQ$
       513**DCL       589--IMP-PTR
NI$IBUF$
       513**DCL       589--IMP-PTR
NI$IMXMBX_INIT.PAGED_BASE
       523**DCL       524--REDEF     524--REDEF
NI$IMXMBX_INIT.SIZE
       525**DCL       525--REDEF
NI$REQ_INIT.DCW
       547**DCL       550--REDEF
NI$REQ_INIT.DCW.TALLY
       548**DCL       548--REDEF
PL6.E3A0      #003=TDM$MIRFAIL File=TDM$MIRROR.:E05TSI                           WED 07/30/97 06:04 Page:163  
NI$REQ_INIT.IDCW.EXTA
       550**DCL       550--REDEF
NI$REQ_INIT.PCW
       552**DCL       556--REDEF
NI$REQ_INIT.SEEK
       557**DCL       558--REDEF     559--REDEF
NI$RP.GATE
       591**DCL      1257<>CALL     1263<>CALL
NI$RP.RC$
       591**DCL      1260<>CALL
NI$RP$
       561**DCL       591--IMP-PTR  1257>>CALL     1260>>CALL     1263>>CALL
NID$REQSCHED
       916**DCL-ENT  1253--CALL
NID$REQSCHEDL
       917**DCL-ENT  1251--CALL     1268--CALL
NIM$DEQUEUE
       616**DCL-ENT  1206--CALL     1237--CALL
NIM$ENQUEUE
       617**DCL-ENT  1215--CALL     1260--CALL
NIO$DCWBLD
       918**DCL-ENT  1248--CALL
NI_MBX_INIT.DCW.CONTROL.AE
       583**DCL       583--REDEF
NI_MBX_INIT.LPW.CONTROL.AE
       579**DCL       579--REDEF
NK_MXLOCAL
       927**DCL      1108>>IF
P$ IN PROCEDURE REQMOD
      1197**DCL      1192--PROC     1215<>CALL
Q$ IN PROCEDURE REQMOD
      1196**DCL      1192--PROC     1201>>DOWHILE  1206<>CALL
Q$ IN PROCEDURE REQMOVE
      1228**DCL      1224--PROC     1232>>DOWHILE  1237<>CALL
REQ
      1022**DCL      1215<>CALL     1248<>CALL     1251<>CALL     1253<>CALL     1260<>CALL     1268<>CALL
PL6.E3A0      #003=TDM$MIRFAIL File=TDM$MIRROR.:E05TSI                           WED 07/30/97 06:04 Page:164  
REQ.BUFADDR
      1031**DCL      1032--REDEF    1032--REDEF
REQ.COMP
      1056**DCL      1152>>IF       1154<<ASSIGN   1209>>IF       1211<<ASSIGN   1240>>IF       1242<<ASSIGN
REQ.DCT$
      1023**DCL      1245<<ASSIGN
REQ.DLA.DCTX
      1022**DCL      1244<<ASSIGN
REQ.DLA.DRELADDR
      1023**DCL      1023--REDEF
REQ.DOMIR
      1066**DCL      1155<<ASSIGN   1212<<ASSIGN   1243<<ASSIGN
REQ.DVE.EOMCHAR
      1060**DCL      1061--REDEF
REQ.EAINFO
      1054**DCL      1054--REDEF
REQ.EAINFOX
      1054**DCL      1055--REDEF
REQ.EVNTINFO
      1055**DCL      1055--REDEF
REQ.MIRDONE
      1067**DCL      1246>>IF
REQ.STATUS
      1036**DCL      1042--REDEF
REQ$
       935**DCL      1022--IMP-PTR  1151<<ASSIGN   1152>>IF       1154>>ASSIGN   1155>>ASSIGN   1206<>CALL
      1209>>IF       1211>>ASSIGN   1212>>ASSIGN   1215>>CALL     1237<>CALL     1240>>IF       1242>>ASSIGN
      1243>>ASSIGN   1244>>ASSIGN   1245>>ASSIGN   1246>>IF       1248>>CALL     1251>>CALL     1253>>CALL
      1260>>CALL     1268>>CALL
REQMOD
      1192**PROC     1164--CALL     1165--CALL
REQMOVE
      1224**PROC     1181--CALL     1182--CALL
SC_TDMINVMIR
       919**DCL-ENT  1117--CALL
SC_TDMNOPMIR
PL6.E3A0      #003=TDM$MIRFAIL File=TDM$MIRROR.:E05TSI                           WED 07/30/97 06:04 Page:165  
       920**DCL-ENT  1132--CALL
SQ$
       936**DCL      1159<<ASSIGN   1164<>CALL     1176<<ASSIGN   1181<>CALL
SQH.DOOR
      1093**DCL      1093--REDEF
SQH.GATE
      1093**DCL      1173<>CALL
SQH$
       937**DCL      1093--IMP-PTR  1099<<ASSIGN   1173>>CALL     1249>>IF
SSS$CURTIME
       921**DCL-ENT  1103--CALL
TDM$MIRSCHEDL
       923**DCL-ENT  1143--CALL     1167--CALL     1184--CALL
TIME
       938**DCL      1103<>CALL     1105<<ASSIGN   1143<>CALL     1167<>CALL     1184<>CALL
UTS
       910**DCL         6--PROC     1101--IF       1105>>ASSIGN
