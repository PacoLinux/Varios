<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
           "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<meta name="GENERATOR" content="TtH 3.05">
 <style type="text/css"><!--
 td div.comp { margin-top: -0.6ex; margin-bottom: -1ex;}
 td div.comb { margin-top: -0.6ex; margin-bottom: -.6ex;}
 td div.hrcomp { line-height: 0.9; margin-top: -0.8ex; margin-bottom: -1ex;}
 td div.norm {line-height:normal;}
 span.roman {font-family: serif; font-style: normal; font-weight: normal;} 
 span.overacc2 {position: relative;  left: .8em; top: -1.2ex;}
 span.overacc1 {position: relative;  left: .6em; top: -1.2ex;} --></style>


   
<title>No Title</title>

    
<title>  Vector Pascal</title>
    
<h1 align="center"> Vector Pascal </h1>

<p>

<h3 align="center">Paul Cockshott and Ken Renfrew </h3>

<p>

<h1>Contents </h1>
I&nbsp;&nbsp;&nbsp;Language Reference Manual<br />&nbsp;<br /> 1012  plus2 minus5  plus3  plus3 minus3   plus2 minus  plus2 minus4  plus2 minus   plus2 minus  plus2 minus4  plus2 minus <em>Paul Cockshott</em><br />
<a href="#tth_chAp1"
>1&nbsp; Elements of the language</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc1.1"
>1.1&nbsp; Alphabet</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc1.1.1"
>1.1.1&nbsp; Base alphabet</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc1.2"
>1.2&nbsp; Reserved words</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc1.3"
>1.3&nbsp; Comments</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc1.4"
>1.4&nbsp; Identifiers</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc1.5"
>1.5&nbsp; Literals</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc1.5.1"
>1.5.1&nbsp; Integer numbers</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc1.5.2"
>1.5.2&nbsp; Real numbers</a><br />

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc1.5.3"
>1.5.3&nbsp; Character strings</a><br />
<a href="#tth_chAp2"
>2&nbsp; Declarations</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc2.1"
>2.1&nbsp; Constants</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc2.1.1"
>2.1.1&nbsp; Array constants</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc2.1.2"
>2.1.2&nbsp; Pre-declared constants</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc2.2"
>2.2&nbsp; Labels</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc2.3"
>2.3&nbsp; Types</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc2.3.1"
>2.3.1&nbsp; Simple types</a><br />





&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc2.3.2"
>2.3.2&nbsp; Structured types</a><br />




&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc2.3.3"
>2.3.3&nbsp; Dynamic types</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc2.4"
>2.4&nbsp; File types</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc2.5"
>2.5&nbsp; Variables</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc2.5.1"
>2.5.1&nbsp; External Variables</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc2.5.2"
>2.5.2&nbsp; Entire Variables</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc2.5.3"
>2.5.3&nbsp; Indexed Variables</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc2.5.4"
>2.5.4&nbsp; Indexed Ranges</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc2.5.5"
>2.5.5&nbsp; Virtual array variables</a><br />

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc2.5.6"
>2.5.6&nbsp; Field Designators</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc2.5.7"
>2.5.7&nbsp; Referenced Variables</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc2.6"
>2.6&nbsp; Procedures and Functions</a><br />

<a href="#tth_chAp3"
>3&nbsp; Algorithms</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.1"
>3.1&nbsp; Expressions</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.1.1"
>3.1.1&nbsp; Mixed type expressions</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.1.2"
>3.1.2&nbsp; Primary expressions</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.1.3"
>3.1.3&nbsp; Unary expressions</a><br />






&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.1.4"
>3.1.4&nbsp; Operator Reduction</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.1.5"
>3.1.5&nbsp; Complex conversion</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.1.6"
>3.1.6&nbsp; Conditional expressions</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.1.7"
>3.1.7&nbsp; Factor</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.1.8"
>3.1.8&nbsp; Multiplicative expressions</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.1.9"
>3.1.9&nbsp; Additive expressions</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.1.10"
>3.1.10&nbsp; Expressions</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.1.11"
>3.1.11&nbsp; Operator overloading</a><br />

&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.2"
>3.2&nbsp; Statements</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.2.1"
>3.2.1&nbsp; Assignment</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.2.2"
>3.2.2&nbsp; Procedure statement</a><br />

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.2.3"
>3.2.3&nbsp; Goto statement</a><br />

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.2.4"
>3.2.4&nbsp; Exit Statement</a><br />

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.2.5"
>3.2.5&nbsp; Compound statement</a><br />

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.2.6"
>3.2.6&nbsp; If statement</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.2.7"
>3.2.7&nbsp; Case statement</a><br />

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.2.8"
>3.2.8&nbsp; With statement</a><br />

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.2.9"
>3.2.9&nbsp; For statement</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.2.10"
>3.2.10&nbsp; While statement</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.2.11"
>3.2.11&nbsp; Repeat statement</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.3"
>3.3&nbsp; Input Output </a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.3.1"
>3.3.1&nbsp; Input</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc3.3.2"
>3.3.2&nbsp; Output </a><br />

<a href="#tth_chAp4"
>4&nbsp; Programs and Units</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc4.1"
>4.1&nbsp; The export of identifiers from units</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc4.1.1"
>4.1.1&nbsp; The export of procedures from libraries.</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc4.1.2"
>4.1.2&nbsp; The export of Operators from units</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc4.2"
>4.2&nbsp; Unit parameterisation and generic functions</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc4.3"
>4.3&nbsp; The invocation of programs and units</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc4.4"
>4.4&nbsp; The compilation of programs and units.</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc4.4.1"
>4.4.1&nbsp; Linking to external libraries</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc4.5"
>4.5&nbsp; Instantiation of parametric units</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc4.5.1"
>4.5.1&nbsp; Direct instantiation</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc4.5.2"
>4.5.2&nbsp; Indirect instantiation</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc4.6"
>4.6&nbsp; The System Unit</a><br />
<a href="#tth_chAp5"
>5&nbsp; Implementation issues</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc5.1"
>5.1&nbsp; Invoking the compiler</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc5.1.1"
>5.1.1&nbsp; Environment variable</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc5.1.2"
>5.1.2&nbsp; Compiler options</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc5.1.3"
>5.1.3&nbsp; Dependencies</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc5.2"
>5.2&nbsp; Calling conventions</a><br />


&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc5.3"
>5.3&nbsp; Array representation</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc5.3.1"
>5.3.1&nbsp; Range checking</a><br />
<a href="#tth_chAp6"
>6&nbsp; Compiler porting tools</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.1"
>6.1&nbsp; Dependencies</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.2"
>6.2&nbsp; Compiler Structure</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.2.1"
>6.2.1&nbsp; Vectorisation</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.2.2"
>6.2.2&nbsp; Porting strategy</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.3"
>6.3&nbsp; ILCG </a><br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.4"
>6.4&nbsp; Supported types</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.4.1"
>6.4.1&nbsp; Data formats</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.4.2"
>6.4.2&nbsp; Typed formats</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.4.3"
>6.4.3&nbsp; Ref types</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.5"
>6.5&nbsp; Supported operations</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.5.1"
>6.5.1&nbsp; Type casts</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.5.2"
>6.5.2&nbsp; Arithmetic</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.5.3"
>6.5.3&nbsp; Memory</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.5.4"
>6.5.4&nbsp;  Assignment </a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.5.5"
>6.5.5&nbsp;  Dereferencing</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.6"
>6.6&nbsp; Machine description</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.6.1"
>6.6.1&nbsp; Registers </a><br />

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.6.2"
>6.6.2&nbsp; Register sets</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.6.3"
>6.6.3&nbsp; Register Arrays</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.6.4"
>6.6.4&nbsp; Register Stacks</a><br />




&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.6.5"
>6.6.5&nbsp; Instruction formats</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.7"
>6.7&nbsp; Grammar of ILCG</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.8"
>6.8&nbsp; ILCG grammar</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.8.1"
>6.8.1&nbsp; Helpers</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.8.2"
>6.8.2&nbsp; Tokens</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc6.8.3"
>6.8.3&nbsp; Non terminal symbols</a><br />
<a href="#tth_chAp7"
>7&nbsp; Sample Machine Descriptions</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.1"
>7.1&nbsp; Basic 386 architecture</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.2"
>7.2&nbsp; The MMX instruction-set</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.3"
>7.3&nbsp; The 486 CPU</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc7.3.1"
>7.3.1&nbsp; Concrete representation</a><br />
II&nbsp;&nbsp;&nbsp;VIPER<br />&nbsp;<br /> 1012  plus2 minus5  plus3  plus3 minus3   plus2 minus  plus2 minus4  plus2 minus   plus2 minus  plus2 minus4  plus2 minus <em>Ken Renfrew</em><br />
<a href="#tth_chAp8"
>8&nbsp; Introduction to VIPER</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.1"
>8.1&nbsp; Rationale</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.1.1"
>8.1.1&nbsp; The Literate Programming Tool.</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.1.2"
>8.1.2&nbsp; The Mathematical Syntax Converter.</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.2"
>8.2&nbsp; A System Overview</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.3"
>8.3&nbsp; Which VIPER to download?</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.4"
>8.4&nbsp; System dependencies</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.5"
>8.5&nbsp; Installing Files</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc8.6"
>8.6&nbsp; Setting up the compiler</a><br />
<a href="#tth_chAp9"
>9&nbsp; VIPER User Guide</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc9.1"
>9.1&nbsp; Setting Up the System</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc9.1.1"
>9.1.1&nbsp; Setting System Dependencies</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc9.1.2"
>9.1.2&nbsp; Personal Set-up</a><br />

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc9.1.3"
>9.1.3&nbsp; Dynamic Compiler Options</a><br />


&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc9.1.4"
>9.1.4&nbsp; VIPER Option Buttons</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc9.2"
>9.2&nbsp; Moving VIPER</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc9.3"
>9.3&nbsp; Programming with VIPER</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc9.3.1"
>9.3.1&nbsp; Single Files</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc9.3.2"
>9.3.2&nbsp; Projects</a><br />


&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc9.3.3"
>9.3.3&nbsp; Embedding  <span class="roman">L</span><sup><span class="roman">A</span></sup><span class="roman">T</span><sub><span class="roman">E</span></sub><span class="roman">X</span> in Vector Pascal</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc9.4"
>9.4&nbsp; Compiling Files in VIPER</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc9.4.1"
>9.4.1&nbsp; Compiling Single Files</a><br />

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc9.4.2"
>9.4.2&nbsp; Compiling Projects</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc9.5"
>9.5&nbsp; Running Programs in VIPER</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc9.6"
>9.6&nbsp; Making VP TE<!--hbox-->X  </a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc9.6.1"
>9.6.1&nbsp; VP TE<!--hbox-->X  Options</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc9.6.2"
>9.6.2&nbsp; VPMath</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc9.7"
>9.7&nbsp;  <span class="roman">L</span><sup><span class="roman">A</span></sup><span class="roman">T</span><sub><span class="roman">E</span></sub><span class="roman">X</span> in VIPER</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc9.8"
>9.8&nbsp; <tt>HTML</tt> in VIPER</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc9.9"
>9.9&nbsp; Writing Code to Generate Good VP TE<!--hbox-->X  </a><br />

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc9.9.1"
>9.9.1&nbsp; Use of Special Comments</a><br />



&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc9.9.2"
>9.9.2&nbsp; Use of Margin Comments</a><br />

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc9.9.3"
>9.9.3&nbsp; Use of Ordinary Pascal Comments</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc9.9.4"
>9.9.4&nbsp; Levels of Detail within Documentation</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc9.9.5"
>9.9.5&nbsp; Mathematical Translation: Motivation and Guidelines</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tth_sEc9.9.6"
>9.9.6&nbsp; LaTeX Packages</a><br />
 

<p>

<h1>Introduction</h1>

<p>
Vector Pascal is a dialect of Pascal designed to make efficient use of the multi-media
instructionsets of recent procesors. It supports data parallel operations and
saturated arithmetic. This manual describes the Vector Pascal language.

<p>
A number of widely used contemporary processors have instructionset extensions
for improved performance in multi-media applications. The aim is to allow operations
to proceed on multiple pixels each clock cycle. Such instructionsets have been
incorporated both in specialist DSP chips like the Texas C62xx[<a href="#Texas" name="CITETexas">35</a>]
and in general purpose CPU chips like the Intel IA32[<a href="#Intel00" name="CITEIntel00">14</a>] or the AMD
K6 [<a href="#AMD" name="CITEAMD">2</a>].

<p>
These instructionset extensions are typically based on the Single Instruction-stream
Multiple Data-stream (SIMD) model in which a single instruction
causes the same mathematical operation to be carried out on several operands,
or pairs of operands at the same time. The level or parallelism supported ranges
from 2 floating point operations at a time on the AMD K6
architecture to 16 byte operations at a time on the intel P4 architecture. Whilst
processor architectures are moving towards greater levels of parallelism, the
most widely used programming languages like C, Java and
Delphi are structured around a model of computation in which
operations take place on a single value at a time. This was appropriate when
processors worked this way, but has become an impediment to programmers seeking
to make use of the performance offered by multi-media instructionsets. The introduction
of SIMD instruction sets[<a href="#IA32" name="CITEIA32">13</a>][<a href="#Peleg97" name="CITEPeleg97">29</a>] to Personal Computers potentially
provides substantial performance increases, but the ability of most programmers
to harness this performance is held back by two factors. The first is the limited
availability of compilers that make effective use of these instructionsets in
a machine independent manner. This remains the case despite the research efforts
to develop compilers for multi-media instructionsets[<a href="#Cheong97" name="CITECheong97">8</a>][<a href="#Leupers99" name="CITELeupers99">26</a>][<a href="#Krall00" name="CITEKrall00">24</a>][<a href="#Sreraman00" name="CITESreraman00">32</a>].
The second is the fact that most popular programming languages were designed
on the word at a time model of the classic von Neumann computer. 

<p>
Vector Pascal aims to provide an efficient and concise notation for programmers
using Multi-Media enhanced CPUs. In doing so it borrows concepts for expressing
data parallelism that have a long history, dating back to Iverson's work on
APL in the early '60s[<a href="#Iverson62" name="CITEIverson62">17</a>]. 

<p>
Define a vector of type <em>T</em> as having type  T[] . Then if we have
a binary operator  <font face="symbol">w</font
>:(T<font face="symbol">Ä</font
>T)<font face="symbol">®</font
> T , in languages derived
from APL we automatically have an operator  <font face="symbol">w</font
>:(T[]<font face="symbol">Ä</font
>T[])<font face="symbol">®</font
> T[] 
 . Thus if  x,y  are arrays of integers  k=x+y  is the array
of integers where  k<sub>i</sub>=x<sub>i</sub>+y<sub>i</sub> .

<p>
The basic concept is simple, there are complications to do with the semantics
of operations between arrays of different lengths and different dimensions,
but Iverson provides a consistent treatment of these. The most recent languages
to be built round this model are J, an interpretive language[<a href="#Jmanual" name="CITEJmanual">19</a>][<a href="#Burke" name="CITEBurke">5</a>][<a href="#Jintro" name="CITEJintro">20</a>],
and F[<a href="#Metcalf96" name="CITEMetcalf96">28</a>] a modernised Fortran. In principle though
any language with array types can be extended in a similar way. Iverson's approach
to data parallelism is machine independent. It can be implemented using scalar
instructions or using the SIMD model. The only difference is speed. 

<p>
Vector Pascal incorporates Iverson's approach to data parallelism. Its aim is
to provide a notation that allows the natural and elegant expression of data
parallel algorithms within a base language that is already familiar to a considerable
body of programmers and combine this with modern compilation techniques. 

<p>
By an elegant algorithm I mean one which is expressed as concisely as possible.
Elegance is a goal that one approaches asymptotically, approaching but never
attaining[<a href="#Chaitin" name="CITEChaitin">7</a>]. APL and J allow the construction of very elegant programs,
but at a cost. An inevitable consequence of elegance is the loss of redundancy.
APL programs are as concise, or even more concise than conventional mathematical
notation[<a href="#Iverson80" name="CITEIverson80">18</a>] and use a special character-set. This makes them hard
for the uninitiated to understand. J attempts to remedy this by restricting
itself to the ASCII character-set, but still looks dauntingly unfamiliar to
programmers brought up on more conventional languages. Both APL and J are interpretive
which makes them ill suited to many of the applications for which SIMD speed
is required. The aim of Vector Pascal is to provide the conceptual gains of
Iverson's notation within a framework familiar to imperative programmers.

<p>
Pascal[<a href="#Jensen" name="CITEJensen">21</a>]was chosen as a base language over the alternatives
of C and Java. C was rejected because notations like <tt>x+y</tt> for <tt>x</tt>
and <tt>y</tt> declared as <tt>int x[4]</tt>, <tt>y[4]</tt>, already have the
meaning of adding the addresses of the arrays together. Java was rejected because
of the difficulty of efficiently transmitting data parallel operations via its
intermediate code to a just in time code generator. 

<p>
Iverson's approach to data parallelism is machine independent. It can be implemented
using scalar instructions or using the SIMD model. The only difference
is speed. Vector Pascal incorporates Iverson's approach to data parallelism.

<p>
<br /><h1>Part 1   <br />Language Reference Manual<br />&nbsp;<br /><font size="+0"><em>Paul Cockshott</em></font></h1><br />

 <h1><a name="tth_chAp1">
Chapter 1 </a><br />Elements of the language</h1>

<p>
 <h2><a name="tth_sEc1.1">
1.1</a>&nbsp;&nbsp;Alphabet</h2>

<p>
Vector Pascal has a base alphabet drawn from the ASCII characterset
which is sufficient to encode all of the grammatical constructs of
the language. It also has an extended alphabet drawn from the Unicode
characterset. The extended alphabet
 can be used to define identifiers using  Russian, Greek, Japanese
or Chinese characters.

<p>
The  Vector Pascal compiler accepts programs encoded  as
UTF-8 encoded unicode files. UTF-8 includes ASCII as a proper subset
so 7-bit ASCII encoded files are  valid.

<p>
     <h3><a name="tth_sEc1.1.1">
1.1.1</a>&nbsp;&nbsp;Base alphabet</h3>
The base alphabet comprises the latin letters <tt>a-z</tt> , the digits <tt>0-9</tt> and the
special symbols  shown in table <a href="#specials">1.1</a>.
The latin letters <tt>A-Z</tt> are treated as synonyms for the corresponding lower case
letters.

<p>

<p>
<a name="tth_tAb1.1">
</a> <center>Table 1.1: Special symbols<a name="specials">
</a></center>

<center> 
<table border="1">
<tr><td align="center">+</td><td align="center">:</td><td align="center">(</td></tr>
<tr><td align="center">-</td><td align="center">'</td><td align="center">)</td></tr>
<tr><td align="center">*</td><td align="center">=</td><td align="center">[</td></tr>
<tr><td align="center">/</td><td align="center">&lt;&#62;</td><td align="center">]</td></tr>
<tr><td align="center">:=</td><td align="center">&lt;</td><td align="center">{</td></tr>
<tr><td align="center">.</td><td align="center">&lt;=</td><td align="center">}</td></tr>
<tr><td align="center">,</td><td align="center">&#62;=</td><td align="center"></td></tr>
<tr><td align="center">;</td><td align="center">&#62;</td><td align="center">..</td></tr>
<tr><td align="center">+:</td><td align="center">@</td><td align="center">*)</td></tr>
<tr><td align="center">-:</td><td align="center">$</td><td align="center">(*</td></tr>
<tr><td align="center">_</td><td align="center">**</td><td align="center"></td></tr></table>

<p>
</center>
<p>

<p>
 <h2><a name="tth_sEc1.2">
1.2</a>&nbsp;&nbsp;Reserved words</h2>
<a name="resw">
</a>
The reserved words are 
<p>
	<tt>ABS, ADDR, AND, ARRAY,</tt>

<p>
	<tt>BEGIN, BYTE2PIXEL,</tt>

<p>
	<tt>CASE, CAST, CDECL, CHR, CONST, COS,</tt>

<p>
	<tt>DISPOSE, DIV, DO, DOWNTO,</tt>

<p>
	<tt>END, ELSE, EXIT, EXTERNAL,</tt>

<p>
	<tt>FALSE, FILE, FOR, FUNCTION,</tt>

<p>
	<tt>GOTO,</tt>

<p>
	<tt>IF, IMPLEMENTATION, IN, INTERFACE, IOTA,</tt>

<p>
	<tt>LABEL, LIBRARY, LN,</tt>

<p>
	<tt>MAX, MIN, MOD,</tt>

<p>
	<tt>NAME, NDX, NEW, NOT,</tt>

<p>
	<tt>OF, OR, ORD, OTHERWISE,</tt>

<p>
	<tt>PACKED, PERM, PIXEL2BYTE,  POW,  PRED,</tt> <br /><tt>PROCEDURE,  PROGRAM,</tt>
<tt>PROTECTED ,</tt>

<p>
	<tt>RDU, READ, READLN, RECORD, REPEAT, ROUND,</tt>

<p>
	<tt>SET, SHL, SHR, SIN, SIZEOF, STRING, SQRT, SUCC,</tt>

<p>
	<tt>TAN, THEN, TO, TRANS, TRUE, TYPE,</tt>

<p>
	<tt>VAR,</tt>

<p>
	<tt>WITH, WHILE, WRITE, WRITELN,</tt>
	<tt>UNIT, UNTIL, USES </tt>


<p>
Reserved words may be written in either lower case or upper case letters, or
any combination of the two. 

<p>
 <h2><a name="tth_sEc1.3">
1.3</a>&nbsp;&nbsp;Comments</h2>

<p>
The comment construct 

<p>
<tt>{</tt> &lt; any sequence of characters not containing ``}''
&#62; <tt>}</tt> 

<p>
may be inserted between any two identifiers, special symbols, numbers or reserved
words without altering the semantics or syntactic correctness of the program.
The bracketing pair <tt>(* *)</tt> may substitute for <tt>{
}</tt>. Where a comment starts with <tt>{</tt> it continues until the next <tt>}</tt>.
Where it starts with <tt>(*</tt> it must be terminated by <tt>*)</tt><a href="#tthFtNtAAB" name="tthFrefAAB"><sup>1</sup></a>.

<p>
 <h2><a name="tth_sEc1.4">
1.4</a>&nbsp;&nbsp;Identifiers</h2>

<p>
Identifiers are used to name values, storage locations, programs, program modules,
types, procedures and functions. An identifier starts with
a letter followed by zero or more letters, digits or the special symbol <tt>_</tt>.
Case is not significant in identifiers.

<p>
 <h2><a name="tth_sEc1.5">
1.5</a>&nbsp;&nbsp;Literals</h2>

<p>
     <h3><a name="tth_sEc1.5.1">
1.5.1</a>&nbsp;&nbsp;Integer numbers</h3>

<p>
Integer numbers are formed of a sequence of decimal digits, thus <tt>1</tt>,
<tt>23</tt>, <tt>9976</tt> etc, or as hexadecimal numbers,
or as numbers of any base between 2 and 36. A hexadecimal number takes the form
of a <tt>$</tt> followed by a sequence of hexadecimal digits thus <tt>$01,
$3ff, $5A</tt>. The letters in a hexadecimal number may be upper or lower case
and drawn from the range <tt>a..f</tt> or <tt>A..F. </tt>

<p>
A based integer is written with the base first followed by a
# character and then a sequence of letters or digits. Thus <tt>2#1101</tt>
is a binary number <tt>8#67</tt> an octal number and <tt>20#7i</tt>
a base 20 number.

<p>
The default precision for integers is 32 bits<a href="#tthFtNtAAC" name="tthFrefAAC"><sup>2</sup></a>.

<p>
<center> 
<table border="1">
<tr><td align="center">&lt;digit sequence&#62;</td><td align="center">&lt;digit&#62; +</td></tr></table>

<p>
</center><center> 
<table border="1">
<tr><td align="center">&lt;decimal integer&#62;</td><td align="center">&lt;digit sequence&#62;</td></tr></table>

<p>
</center><center> 
<table border="1">
<tr><td align="center">&lt;hex integer&#62;</td><td align="center">`$'&lt;hexdigit&#62;+</td></tr></table>

<p>
</center><center> 
<table border="1">
<tr><td align="center">&lt;based integer&#62; </td><td align="center">&lt;digit sequence&#62;'#'&lt;alphanumeric&#62;+</td></tr></table>

<p>
</center><center> 
<table border="1">
<tr><td align="center">&lt;unsigned integer&#62;</td><td align="center">&lt;decimal integer&#62;</td></tr>
<tr><td align="center"></td><td align="center">&lt;hex integer&#62;</td></tr>
<tr><td align="center"></td><td align="center">&lt;based integer&#62;</td></tr></table>


<p>
<a name="tth_tAb1.2">
</a> <center>Table 1.2: The hexadecimal digits of Vector Pascal.</center>
<center> 
<table border="1">
<tr><td align="center">Value</td><td align="center">0</td><td align="center">1</td><td align="center">2</td><td align="center">3</td><td align="center">4</td><td align="center">5</td><td align="center">6</td><td align="center">7</td><td align="center">8</td><td align="center">9</td><td align="center">10</td><td align="center">11</td><td align="center">12</td><td align="center">13</td><td align="center">14</td><td align="center">15</td></tr>
<tr><td align="center">Notation 1</td><td align="center">0</td><td align="center">1</td><td align="center">2</td><td align="center">3</td><td align="center">4</td><td align="center">5</td><td align="center">6</td><td align="center">7</td><td align="center">8</td><td align="center">9</td><td align="center">A</td><td align="center">B</td><td align="center">C</td><td align="center">D</td><td align="center">E</td><td align="center">F</td></tr>
<tr><td align="center">Notation 2</td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">a</td><td align="center">b</td><td align="center">c</td><td align="center">d</td><td align="center">e</td><td align="center">f</td></tr></table>

<p>
</center>.

<p>
 
</center>     <h3><a name="tth_sEc1.5.2">
1.5.2</a>&nbsp;&nbsp;Real numbers</h3>

<p>
Real numbers are supported in floating point notation, thus <tt>14.7</tt>, 
 <tt>&nbsp;9.99e5</tt>, 
<tt>
38E3,</tt> &nbsp;<tt>3.6e-4</tt> are all valid denotations for real numbers. The default
precision for real numbers is also 32 bit, though intermediate calculations
may use higher precision. The choice of 32 bits as the default precision is
influenced by the fact that 32 bit floating point vector operations are well
supported in multi-media instructions.

<p>
<center> 
<table border="1">
<tr><td align="center">&lt;exp&#62;</td><td align="center">`e'</td></tr>
<tr><td align="center"></td><td align="center">`E'</td></tr></table>

<p>
</center><center> 
<table border="1">
<tr><td align="center">&lt;scale factor&#62;</td><td align="center">[&lt;sign&#62;] &lt;unsigned integer&#62;</td></tr></table>

<p>
</center><center> 
<table border="1">
<tr><td align="center">&lt;sign&#62;</td><td align="center">`-'</td></tr>
<tr><td align="center"></td><td align="center">`+'</td></tr></table>

<p>
</center><center> 
<table border="1">
<tr><td align="center">&lt;unsigned real&#62;</td><td align="center">&lt;decimal integer&#62; `.' &lt;digit sequence&#62;</td></tr>
<tr><td align="center"></td><td align="center">&lt;decimal integer&#62;` .' &lt;digit sequence&#62; &lt;exp&#62;&lt;scale factor&#62; </td></tr>
<tr><td align="center"></td><td align="center">&lt;decimal integer&#62;&lt;exp&#62; &lt;scale factor&#62;</td></tr></table>

<p>
</center>
<h4>Fixed point numbers</h4>

<p>
In Vector Pascal pixels are represented as signed fixed point
fractions in the range -1.0 to 1.0. Within this range, fixed point literals
have the same syntactic form as real numbers.

<p>
     <h3><a name="tth_sEc1.5.3">
1.5.3</a>&nbsp;&nbsp;Character strings</h3>

<p>
Sequences of characters enclosed by quotes are called literal
strings. Literal strings consisting of a single character are
constants of the standard type char. If the string is to contain a quote character
this quote character must be written twice.

<p>
<tt><font size="-1">'A' 'x' 'hello' 'John''s house'</font></tt><font size="-1">
<p>
</font>are all valid literal strings. The allowable characters in literal strings are
any of the 7 bit printable ISO characters.

<p>
 <h1><a name="tth_chAp2">
Chapter 2 </a><br />Declarations</h1>

<p>
Vector Pascal is a language supporting nested declaration
contexts. A declaration context is either a program context, and unit interface
or implementation context, or a procedure or function context. A resolution
context determines the meaning of an identifier. Within a resolution context,
identifiers can be declared to stand for constants, types, variables, procedures
or functions. When an identifier is used, the meaning taken on by the identifier
is that given in the closest containing resolution context. Resolution contexts
are any declaration context or a <tt>with</tt> statement context. The ordering
of these contexts when resolving an identifier is:

<p>

<ol type="1"><p>
<li> The declaration context identified by any <tt>with</tt> statements which nest
the current occurrence of the identifier. These <tt>with</tt> statement contexts
are searched from the innermost to the outermost.</li>
<p>
<li> The declaration context of the currently nested procedure
declarations. These procedure contexts are searched from the innermost to the
outermost.</li>
<p>
<li> The declaration context of the current unit or program.</li>
<p>
<li> The interface declaration contexts of the units mentioned in the use list of
the current unit or program. These contexts are searched from the rightmost
unit mentioned in the use list to the leftmost identifier in the use list.</li>
<p>
<li> The interface declaration context of the System unit.</li>
<p>
<li> The pre-declared identifiers of the language.</li>
</ol>

<p>
 <h2><a name="tth_sEc2.1">
2.1</a>&nbsp;&nbsp;Constants</h2>

<p>
A constant definition introduces an identifier as a synonym for a constant. 

<p>
<center> 
<table border="1">
<tr><td align="center">&lt;constant declaration&#62;</td><td align="center">&lt;identifier&#62;=&lt;expression&#62;</td></tr>
<tr><td align="center"></td><td align="center">&lt;identifier&#62;':'&lt;type&#62;'='&lt;typed constant&#62;</td></tr></table>

<p>
</center>Constants can be simple constants or typed constants. A simple constant must
be a constant expression whose value is known at compile time. This restricts
it to expressions for which all component identifiers are other constants, and
for which the permitted operators are given in table<a href="#MMConst">2.1</a>
. This restricts simple constants to be of scalar or string types.

<p>

<p>
<a name="tth_tAb2.1">
</a> <center>Table 2.1: The operators permitted in Vector Pascal constant expressions.<a name="MMConst">
</a></center>
<center> 
<table border="1">
<tr><td align="center">+</td><td align="center">-</td><td align="center">*</td><td align="center">/</td><td align="center">div</td><td align="center">mod</td><td align="center">shr</td><td align="center">shl</td><td align="center">and</td><td align="center">or</td></tr></table>

<p>
</center>
<p>
Typed constants provide the program with initialised variables which may hold
array types.

<p>
<center> 
<table border="1">
<tr><td align="center">&lt;typed constant&#62;</td><td align="center">&lt;expression&#62;</td></tr>
<tr><td align="center"></td><td align="center">&lt;array constant&#62;</td></tr></table>

<p>
</center>     <h3><a name="tth_sEc2.1.1">
2.1.1</a>&nbsp;&nbsp;Array constants</h3>

<p>
Array constants are comma separated lists of constant expressions enclosed by
brackets. Thus 

<p>
<tt>tr:array[1..3] of real =(1.0,1.0,2.0);</tt>

<p>
is a valid array constant declaration, as is:

<p>
<font size="-1"><tt>t2:array[1..2,1..3] of real=((1.0,2.0,4.0),(1.0,3.0,9.0));</tt></font>

<p>
The array constant must structurally
match the type given to the identifier. That is to say it must
match with respect to number of dimensions, length of each dimension, and type
of the array elements.

<p>
<center> 
<table border="1">
<tr><td align="center">&lt;array constant&#62;</td><td align="center">'(' &lt;typed constant&#62; [,&lt;typed constant&#62;]* ')'</td></tr></table>

<p>
</center>     <h3><a name="tth_sEc2.1.2">
2.1.2</a>&nbsp;&nbsp;Pre-declared constants</h3>

<p>

<dl compact="compact">

     
       
      
       <dt><b><tt>maxint</tt></b></dt>
	<dd>The largest supported integer value.</dd>
 <dt><b><tt>pi</tt></b></dt>
	<dd> A real numbered approximation to  <font face="symbol">p</font
></dd>
 <dt><b><tt>maxchar</tt></b></dt>
	<dd> The highest character in the character set.</dd>
 <dt><b><tt>maxstring</tt></b></dt>
	<dd>The maximum number of characters allowed
in a string.</dd>
 <dt><b><tt>maxreal</tt></b></dt>
	<dd>The highest representable real.</dd>
 <dt><b><tt>minreal</tt></b></dt>
	<dd>The smallest representable positive real number.</dd>
 <dt><b><tt>epsreal</tt></b></dt>
	<dd>The smallest real number which when added
to 1.0 yields a value distinguishable from 1.0.</dd>
 <dt><b><tt>maxdouble</tt></b></dt>
	<dd>The highest representable double precision
real number.</dd>
 <dt><b><tt>mindouble</tt></b></dt>
	<dd>The smallest representable positive double
precision real number.</dd>
 <dt><b><tt>complexzero</tt></b></dt>
	<dd>A complex number with zero real and
imaginary parts.</dd>
 <dt><b><tt>complexone</tt></b></dt>
	<dd>A complex number with real part 1 and
imaginary part 0.
</dd>
</dl>

<p>
 <h2><a name="tth_sEc2.2">
2.2</a>&nbsp;&nbsp;Labels</h2>

<p>
Labels are written as digit sequences. Labels must be declared before they are
used. They can be used to label the start of a statement and can be the destination
of a <tt>goto</tt> statement. A <tt>goto</tt> statement must have
as its destination a label declared within the current innermost
declaration context. A statement can be prefixed by a label followed by a colon.

<p>
Example

<p>
<tt>label 99;</tt>

<p>
<tt>begin read(x); if x&#62;9 goto 99; write(x*2);99: end;</tt>

<p>
 <h2><a name="tth_sEc2.3">
2.3</a>&nbsp;&nbsp;Types</h2>

<p>
A type declaration determines the set of values that expressions of this type
may assume and associates with this set an identifier.

<p>
<center> 
<table border="1">
<tr><td align="center">&lt;type&#62;</td><td align="center">&lt;simple type&#62;</td></tr>
<tr><td align="center"></td><td align="center">&lt;structured type&#62;</td></tr>
<tr><td align="center"></td><td align="center">&lt;pointer type&#62;</td></tr></table>

<p>
</center><center> 
<table border="1">
<tr><td align="center">&lt;type definition&#62;</td><td align="center">&lt;identifier&#62;'='&lt;type&#62; </td></tr></table>

<p>
</center>     <h3><a name="tth_sEc2.3.1">
2.3.1</a>&nbsp;&nbsp;Simple types</h3>

<p>
Simple types are either scalar, standard, subrange or dimensioned types.

<p>
<center> 
<table border="1">
<tr><td align="center">&lt;simple type&#62;</td><td align="center">&lt;scalar type&#62;</td></tr>
<tr><td align="center"></td><td align="center">&lt;integral type&#62;</td></tr>
<tr><td align="center"></td><td align="center">&lt;subrange type&#62;</td></tr>
<tr><td align="center"></td><td align="center">&lt;dimensioned type&#62;</td></tr>
<tr><td align="center"></td><td align="center">&lt;floating point type&#62;</td></tr></table>

<p>
</center>
<h4>Scalar types</h4>

<p>
A scalar type defines an ordered set of identifier
by listing these identifiers. The declaration takes the form of a comma separated
list of identifiers enclosed by brackets. The identifiers in the list are declared
simultaneously with the declared scalar type to be constants of this declared
scalar type. Thus 

<pre>
colour = (red,green,blue);
day=(monday,tuesday,wednesday,thursday,
     friday,saturday,sunday);

</pre>
are valid scalar type declarations.

<p>

<h4>Standard types</h4><a name="auxtypes">
</a>

<p>
The following types are provided as standard in Vector Pascal:

<p>
<a name="tth_tAb2.2">
</a> <center>Table 2.2: Categorisation of the standard types.</center>
<center> 
<table border="1">
<tr><td align="center">type</td><td align="center">category</td></tr><tr><td>
<tr><td align="center">real</td><td align="center">floating point</td></tr>
<tr><td align="center">double</td><td align="center">floating point</td></tr>
<tr><td align="center">byte</td><td align="center">integral</td></tr>
<tr><td align="center">pixel</td><td align="center">fixed point</td></tr>
<tr><td align="center">shortint</td><td align="center">integral</td></tr>
<tr><td align="center">word</td><td align="center">integral</td></tr>
<tr><td align="center">integer</td><td align="center">integral</td></tr>
<tr><td align="center">cardinal</td><td align="center">integral</td></tr>
<tr><td align="center">boolean</td><td align="center">scalar</td></tr>
<tr><td align="center">char</td><td align="center">scalar</td></tr></table>

<p>
</center>
<p>

<dl compact="compact">

     
       
      
       <dt><b><tt>integer</tt></b></dt>
	<dd>The numbers are in the range -maxint to +maxint.</dd>
 <dt><b><tt>real</tt></b></dt>
	<dd>These are a subset of the reals constrained by the
IEEE 32 bit floating point format.</dd>
 <dt><b><tt>double</tt></b></dt>
	<dd>These are a subset of the real numbers constrained
by the IEEE 64 bit floating point format.</dd>
 <dt><b><tt>pixel</tt></b></dt>
	<dd>These are represented as fixed point
binary fractions in the range -1.0 to 1.0.</dd>
 <dt><b><tt>boolean</tt></b></dt>
	<dd>These take on the values <tt>(false,true)</tt>
which are ordered such that <tt>true&lt;false</tt>.</dd>
 <dt><b><tt>char</tt></b></dt>
	<dd>These include the characters from <tt>chr(0)</tt>
to <tt>charmax</tt>. All the allowed characters for string literals
are in the type char, but the character-set may include other characters whose
printable form is country specific.</dd>
 <dt><b><tt>pchar</tt></b></dt>
	<dd>Defined as <tt>char</tt>.</dd>
 <dt><b><tt>byte</tt></b></dt>
	<dd>These take on the positive integers between 0 and
255.</dd>
 <dt><b><tt>shortint</tt></b></dt>
	<dd>These take on the signed values between
-128 and 127.</dd>
 <dt><b><tt>word</tt></b></dt>
	<dd>These take on the positive integers from 0 to 65535.</dd>
 <dt><b><tt>cardinal</tt></b></dt>
	<dd>These take on the positive integers form
0 to 4292967295, i.e., the most that can be represented in a 32 bit unsigned
number.</dd>
 <dt><b><tt>longint</tt></b></dt>
	<dd>A 32 bit integer, retained for compatibility
with Turbo Pascal.</dd>
 <dt><b><tt>int64</tt></b></dt>
	<dd>A 64 bit integer.</dd>
 <dt><b><tt>complex</tt></b></dt>
	<dd>A complex number with the real and imaginary
parts held to 32 bit precision.
</dd>
</dl>

<p>

<h4>Subrange types</h4>

<p>
A type may be declared as a subrange of another scalar
or integer type by indicating the largest and smallest value
in the subrange. These values must be constants known at compile time.

<p>
<center> 
<table border="1">
<tr><td align="center">&lt;subrange type&#62;</td><td align="center">&lt;constant&#62; '..' &lt;constant&#62;</td></tr></table>

<p>
</center>Examples: 1..10, 'a'..'f', monday..thursday.

<p>

<h4>Pixels</h4>

<p>
The <em>conceptual model</em> of pixels in Vector Pascal is that they are real
numbers in the range  <font face="symbol">-</font
>1.0..1.0 . As a signed representation it lends itself
to subtraction. As an unbiased representation, it makes the adjustment of contrast
easier. For example, one can reduce contrast 50% simply by multiplying an image
by 0.5 <a href="#tthFtNtAAD" name="tthFrefAAD"><sup>3</sup></a>. Assignment to pixel variables in Vector Pascal is defined to be saturating
- real numbers outside the range  <font face="symbol">-</font
>1..1  are clipped to it. The multiplications
involved in convolution operations fall naturally into place. 

<p>
The <em>implementation model</em> of pixels used in Vector Pascal is of 8 bit
signed integers treated as fixed point binary fractions. All the conversions
necessary to preserve the monotonicity of addition, the range of multiplication
etc, are delegated to the code generator which, where possible, will implement
the semantics using efficient, saturated multi-media arithmetic instructions. 

<p>

<h4>Dimensioned types</h4>

<p>
These provide a means by which floating point types can be specialised to represent
dimensioned numbers as is required in physics calculations. For example:

<p>
<tt>kms =(mass,distance,time);</tt>

<p>
<tt>meter=real of distance;</tt>

<p>
<tt>kilo=real of mass;</tt>

<p>
<tt>second=real of time;</tt>

<p>
<tt>newton=real of mass * distance * time POW -2;</tt>

<p>
<tt>meterpersecond = real of distance *time POW -1;</tt>

<p>
The grammar is given by:

<p>
<center> 
<table border="1">
<tr><td align="center">&lt;dimensioned type&#62;</td><td align="center">&lt;real type&#62; &lt;dimension &#62;['*' &lt;dimension&#62;]*</td></tr></table>

<p>
</center><center> 
<table border="1">
<tr><td align="center">&lt;real type&#62;</td><td align="center">'real'</td></tr>
<tr><td align="center"></td><td align="center">'double'</td></tr></table>

<p>
</center><center> 
<table border="1">
<tr><td align="center">&lt;dimension&#62;</td><td align="center">&lt;identifier&#62; ['POW' [&lt;sign&#62;] &lt;unsigned integer&#62;]</td></tr></table>

<p>
</center>The identifier must be a member of a scalar type, and that
scalar type is then referred to as the basis space of the dimensioned type.
The identifiers of the basis space are referred to as the dimensions
of the dimensioned type. Associated with each dimension of a dimensioned
type there is an integer number referred to as the power of that dimension.
This is either introduced explicitly at type declaration time, or determined
implicitly for the dimensional type of expressions. 

<p>
A value of a dimensioned type is a dimensioned value. Let  log<sub>d</sub>t 
of a dimensioned type  t  be the power to which the dimension  d 
of type  t  is raised. Thus for  t = newton in the example above, and
 d = time,  log<sub>d</sub>t=<font face="symbol">-</font
>2 

<p>
If  x  and  y  are values of dimensioned types
 t<sub>x</sub> and  t<sub>y</sub> respectively, then the following operators are only
permissible if  t<sub>x</sub>=t<sub>y</sub> 

<p>
<center> 
<table border="1">
<tr><td align="center">+</td><td align="center">-</td><td align="center">&lt;</td><td align="center">&#62;</td><td align="center">&lt;&#62;</td><td align="center">=</td><td align="center">&lt;=</td><td align="center">&#62;=</td></tr></table>

<p>
</center>For + and -, the dimensional type of the result is the same
as that of the arguments. The operations 

<p>
<center> 
<table border="1">
<tr><td align="center">*</td><td align="center">/</td></tr></table>

<p>
</center>are permitted if the types  t<sub>x</sub> and  t<sub>y</sub>  share the same basis
space, or if the basis space of one of the types is a subrange of the basis
space of the other.  

<p>
The operation <tt>POW</tt> is permitted between dimensioned types and integers.

<p>

<b>*&nbsp;&nbsp;</b>Dimension deduction rules

<p>

<ol type="1"><p>
<li> If  x=y*z  for  x:t<sub>1</sub>,y:t<sub>2</sub>,z:t<sub>3</sub>  with basis space  B 
then 

<p>

<dl compact="compact">
 <dt><b> <font face="symbol">"</font
><sub>d <font face="symbol">Î</font
> B</sub>log<sub>d</sub>t<sub>1</sub>=log<sub>d</sub>t<sub>2</sub>+log<sub>d</sub>t<sub>3</sub> .</b></dt>
	<dd>&nbsp;</dd>
</dl></li>
<p>
<li> If  x=y/z  for  x:t<sub>1</sub>,y:t<sub>2</sub>,z:t<sub>3</sub>  with basis space  B 
then 

<p>

<dl compact="compact">
 <dt><b> <font face="symbol">"</font
><sub>d <font face="symbol">Î</font
> B</sub>log<sub>d</sub>t<sub>1</sub>=log<sub>d</sub>t<sub>2</sub><font face="symbol">-</font
>log<sub>d</sub>t<sub>3</sub> .</b></dt>
	<dd>&nbsp;</dd>
</dl></li>
<p>
<li> If  x=y  <tt>POW</tt>  z  for  x:t<sub>1</sub>,y:t<sub>2</sub>,z:integer  with
basis space for  t<sub>2</sub> ,  B  then 

<p>

<dl compact="compact">
 <dt><b> <font face="symbol">"</font
><sub>d <font face="symbol">Î</font
> B</sub>log<sub>d</sub>t<sub>1</sub>=log<sub>d</sub>t<sub>2</sub>&times;z .</b></dt>
	<dd>&nbsp;</dd>
</dl></li>
</ol>

<p>
     <h3><a name="tth_sEc2.3.2">
2.3.2</a>&nbsp;&nbsp;Structured types</h3>

<p>

<h4>Static Array types</h4>

<p>
An array type is a structure consisting of a fixed number of elements all of
which are the same type. The type of the elements is referred to as the element
type. The elements of an array value are indicated by bracketed indexing expressions.
The definition of an array type simultaneously defines
the permitted type of indexing expression and the element type. 

<p>
The index type of a static array
must be a scalar or subrange type. This implies
that the bounds of a static array are known at compile time.

<p>
<center> 
<table border="1">
<tr><td align="center">&lt;array type&#62;</td><td align="center">'array' '[' &lt;index type&#62;[,&lt;index type&#62;]* ']' 'of' &lt;type&#62;</td></tr></table>

<p>
</center><center> 
<table border="1">
<tr><td align="center">&lt;index type&#62;</td><td align="center">&lt;subrange type&#62;</td></tr>
<tr><td align="center"></td><td align="center">&lt;scalar type&#62;</td></tr>
<tr><td align="center"></td><td align="center">&lt;integral type&#62;</td></tr></table>

<p>
</center>Examples

<p>
<tt>array[colour] of boolean;</tt>

<p>
<tt>array[1..100] of integer;</tt>

<p>
<tt>array[1..2,4..6] of byte;</tt>

<p>
<tt>array[1..2] of array[4..6] of byte;</tt>

<p>
The notation [<em>b,c</em>] in an array declaration is shorthand for the notation
[<em>b</em>] <tt>of array</tt> [ <em>c</em> ]. The number of dimensions of an
array type is referred to as its rank. Scalar types have rank 0.

<p>

<h4>String types</h4>

<p>
A string type denotes the set of all sequences of characters
up to some finite length and must have the syntactic form:

<p>
<center> 
<table border="1">
<tr><td align="center">&lt;string-type&#62;</td><td align="center">'string[' &lt;integer constant&#62;']'</td></tr>
<tr><td align="center"></td><td align="center">'string'</td></tr></table>

<p>
</center>the integer constant indicates the maximum number of characters that may be
held in the string type. The maximum number of characters that can be held in
any string is indicated by the pre-declared constant <tt>maxstring</tt>. The
type <tt>string</tt> is shorthand for <tt>string[maxstring]</tt>.

<p>

<h4>Record types</h4>

<p>
A record type defines a set of similar data structures. Each member of this
set, a record instance, is a Cartesian product of number of components or <em>fields</em>
specified in the record type definition. Each field has an identifier
and a type. The scope of these identifiers is the record itself.

<p>
A record type may have as a final component a <em>variant
part</em>. The variant part, if a variant part exists, is a union of several variants,
each of which may itself be a Cartesian product of a set of fields. If a variant
part exists there may be a tag field whose value indicates which variant is
assumed by the record instance.

<p>
All field identifiers even if they occur within different variant parts, must
be unique within the record type.

<p>
<center> 
<table border="1">
<tr><td align="center">&lt;record type&#62;</td><td align="center">'record' &lt;field list&#62; 'end'</td></tr></table>

<p>
</center><center> 
<table border="1">
<tr><td align="center">&lt;field list&#62;</td><td align="center">&lt;fixed part&#62;</td></tr>
<tr><td align="center"></td><td align="center">&lt;fixed part&#62;';' &lt;variant part&#62;</td></tr>
<tr><td align="center"></td><td align="center">&lt;variant part&#62;</td></tr></table>

<p>
</center><center> 
<table border="1">
<tr><td align="center">&lt;fixed part&#62;</td><td align="center">&lt;record section&#62; [ ';' &lt;record section.]*</td></tr></table>

<p>
</center><center> 
<table border="1">
<tr><td align="center">&lt;record section&#62;</td><td align="center">&lt;identifier&#62;[',' &lt;identifier&#62;]* ':' &lt;type&#62;</td></tr>
<tr><td align="center"></td><td align="center">&lt;empty&#62;</td></tr></table>

<p>
</center><center> 
<table border="1">
<tr><td align="center">&lt;variant part&#62;</td><td align="center">'case' [&lt;tag field&#62; ':'] &lt;type identifier&#62; 'of'&lt;variant&#62;[';' &lt;variant&#62;]*</td></tr></table>

<p>
</center><center> 
<table border="1">
<tr><td align="center">&lt;variant&#62;</td><td align="center">&lt;constant&#62; [',' &lt;constant&#62;]*':' '(' &lt;field list&#62; ')'</td></tr>
<tr><td align="center"></td><td align="center">&lt;empty&#62;</td></tr></table>

<p>
</center>
<h4>Set types</h4>

<p>
A set type defines the range of values which is the power-set of
its base type. The base type must be a scalar type, a character type, integer
type or a subrange thereof.

<p>
<center> 
<table border="1">
<tr><td align="center">&lt;set type&#62;</td><td align="center">'set' 'of' &lt;base type&#62;</td></tr></table>

<p>
</center>     <h3><a name="tth_sEc2.3.3">
2.3.3</a>&nbsp;&nbsp;Dynamic types</h3>

<p>
Variables declared within the program are accessed by their identifier. These
variables exist throughout the existence of the scope within which they are
declared, be this unit, program or procedure. These variables are assigned storage
locations whose addresses, either absolute or relative to some register, can
be determined at compile time. Such locations a referred to as static<a href="#tthFtNtAAE" name="tthFrefAAE"><sup>4</sup></a>. Storage locations may also be allocated dynamically. Given a type <tt>t</tt>,
the type of a pointer to an instance of type <tt>t</tt> is <tt>t</tt>. 

<p>
A pointer of type <tt>t</tt> can be initialised to point to
a new store location of type t by use of the built in procedure <tt>new</tt>.
Thus if <tt>p:t</tt>,

<p>
<tt>new(p);</tt>

<p>
causes <tt>p</tt> to point at a store location of type <tt>t</tt>.

<p>

<h4>Pointers to dynamic arrays</h4>

<p>
The types pointed to by pointer types can be any of the types mentioned so far,
that is to say, any of the types allowed for static variables.
In addition however, pointer types can be declared to point at dynamic arrays.
A dynamic array is an array whose bounds are determined at run time.

<p>
Pascal 90[<a href="#ISO90" name="CITEISO90">15</a>] introduced the notion of schematic or
parameterised types as a means of creating dynamic arrays. Thus where <tt>r</tt>
is some integral or ordinal type one can write 

<p>
<tt>type z(a,b:r)=array[a..b] of t;</tt>

<p>
If <tt>p:z</tt>, then 

<p>
<tt>new(p,n,m)</tt>

<p>
where <tt>n,m:r</tt> initialises <tt>p</tt> to point to an array of bounds <tt>n..m</tt>.
The bounds of the array can then be accessed as <tt>p.a,
p.b</tt>. Vector Pascal currently allows dynamic but not static
parameterised types.

<p>
 <h2><a name="tth_sEc2.4">
2.4</a>&nbsp;&nbsp;File types</h2>

<p>
A type may be declared to be a file of a type. This form of definition is kept
only for backward compatibility. All file types are treated as being equivalent.
A file type corresponds to a handle to an operating system file. A file variable
must be associated with the operating system file by using the procedures <tt>assign,
rewrite, append</tt>, and <tt>reset</tt> provided by the system unit. A pre-declared
file type <tt>text</tt> exists.

<p>
 <h2><a name="tth_sEc2.5">
2.5</a>&nbsp;&nbsp;Variables</h2>

<p>
Variable declarations consist of a list of identifiers denoting the new variables,
followed by their types.

<p>
<center> 
<table border="1">
<tr><td align="center">&lt;variable declaration&#62;</td><td align="center">&lt;identifier&#62; [',' &lt;identifier&#62;]* ':' &lt;type&#62;&lt;extmod&#62;</td></tr></table>

<p>
</center>Variables are abstractions over values. They can be either simple identifiers,
components or ranges of components of arrays, fields of records or referenced
dynamic variables.

<p>
<center> 
<table border="1">
<tr><td align="center">&lt;variable&#62;</td><td align="center">&lt;identifier&#62;</td></tr>
<tr><td align="center"></td><td align="center">&lt;indexed variable&#62;</td></tr>
<tr><td align="center"></td><td align="center">&lt;indexed range&#62;</td></tr>
<tr><td align="center"></td><td align="center">&lt;field designator&#62;</td></tr>
<tr><td align="center"></td><td align="center">&lt;referenced variable&#62;</td></tr></table>

<p>
</center>Examples

<p>
<tt>x,y:real;</tt>

<p>
<tt>i:integer;</tt>

<p>
<tt>point:real;</tt>

<p>
<tt>dataset:array[1..n]of integer;</tt>

<p>
<tt>twoDdata:array[1..n,4..7] of real;</tt>

<p>
     <h3><a name="tth_sEc2.5.1">
2.5.1</a>&nbsp;&nbsp;External Variables</h3>

<p>
A variable may be declared to be external by appending the external modifier.

<p>
<center> 
<table border="1">
<tr><td align="center">&lt;extmod&#62;</td><td align="center">';' 'external' 'name' &lt;stringlit&#62;</td></tr></table>

<p>
</center>This indicates that the variable is declared in a non Vector Pascal external
library. The name by which the variable is known in the external library is
specified in a string literal. 

<p>
Example

<p>
<tt>count:integer; external name '_count';</tt>

<p>
     <h3><a name="tth_sEc2.5.2">
2.5.2</a>&nbsp;&nbsp;Entire Variables</h3><a name="entire">
</a>

<p>
An entire variable is denoted by its identifier. Examples <tt>x,y,point</tt>, 

<p>
     <h3><a name="tth_sEc2.5.3">
2.5.3</a>&nbsp;&nbsp;Indexed Variables</h3>

<p>
A component of an <em>n</em> dimensional array variable is denoted by the variable
followed by <em>n</em> index expressions in brackets.

<p>
<center> 
<table border="1">
<tr><td align="center">&lt;indexed variable&#62;</td><td align="center">&lt;variable&#62;'[' &lt;expression&#62;[','&lt;expression&#62;]* ']'</td></tr></table>

<p>
</center>The type of the indexing expression must conform to the index type of the array
variable. The type of the indexed variable is the component type of the array.

<p>
Examples

<p>
<tt>twoDdata[2,6]</tt>

<p>
<tt>dataset[i]</tt>

<p>
Given the declaration 

<p>
<tt>a=array[p] of q</tt>

<p>
then the elements of arrays of type <tt>a</tt>, will have type <tt>q</tt> and
will be identified by indices of type <tt>p</tt> thus:

<p>
<tt>b[i]</tt>

<p>
where <tt>i:p</tt>, <tt>b:a</tt>.

<p>
Given the declaration

<p>
<tt>z = string[x]</tt>

<p>
for some integer x <tt>  <font face="symbol">£</font
> maxstring</tt>, then the characters within
strings of type <tt>z</tt> will be identified by indices in
the range <tt>1..x,</tt> thus:

<p>
<tt>y[j]</tt>

<p>
where <tt>y:z</tt>, <tt>j:1..x</tt>.

<p>
     <h3><a name="tth_sEc2.5.4">
2.5.4</a>&nbsp;&nbsp;Indexed Ranges</h3>

<p>
A range of components of an array variable are denoted by the variable followed
by a range expression in brackets.

<p>
<center> 
<table border="1">
<tr><td align="center">&lt;indexed range&#62;</td><td align="center">&lt;variable&#62; '[' &lt;range expression&#62;[',' &lt;range expression&#62;]* ']'</td></tr></table>

<p>
</center><center> 
<table border="1">
<tr><td align="center">&lt;range expression&#62;</td><td align="center">&lt;expression&#62; '..' &lt;expression&#62;</td></tr></table>

<p>
</center>The expressions within the range expression must conform to the
index type of the array variable. The type of a range expression <tt>a[i..j]</tt>
where <tt>a: array[p..q] of t</tt> is <tt>array[0..j-i] of t.</tt>

<p>
Examples:

<p>
<tt>dataset[i..i+2]:=blank;</tt>

<p>
<tt>twoDdata[2..3,5..6]:=twoDdata[4..5,11..12]*0.5;</tt>

<p>
Subranges may be passed in as actual parameters to procedures
whose corresponding formal parameters are declared as variables
of a schematic type. Hence given the following declarations:

<p>
<tt>type image(miny,maxy,minx,maxx:integer)=array[miny..maxy,minx..maxx]
of byte;</tt>

<p>
<tt>procedure invert(var im:image);begin im:=255-im; end;</tt>

<p>
<tt>var screen:array[0..319,0..199] of byte;</tt>

<p>
then the following statement would be valid:

<p>
<tt>invert(screen[40..60,20..30]);</tt>

<p>
     <h3><a name="tth_sEc2.5.5">
2.5.5</a>&nbsp;&nbsp;Virtual array variables</h3>

<p>
If an array variable occurs on the right hand side of an assignment
statement, there is a further form of indexing possible. An array may be indexed
by another array. If <tt>x:array[t0] of t1</tt> and <tt>y:array[t1]
of t2</tt>, then <tt>y[x]</tt> denotes the virtual array of type <tt>array[t0]
of t2</tt> such that <tt>y[x][i]=y[x[i]]</tt>. This construct is
useful for performing permutations. To fully understand the following example
refer to sections <a href="#iota">3.1.3</a>,<a href="#manimplicitindices">3.2.1</a>.

<p>

<b>Example&nbsp;&nbsp;</b>

<p>
Given the declarations

<p>
<tt>const perm:array[0..3] of integer=(3,1,2,0);</tt>

<p>
<tt>var ma,m0:array[0..3] of integer; </tt>

<p>
then the statements

<p>
<tt>m0:= (iota 0)+1;</tt>

<p>
<tt>write('m0=');for j:=0 to 3 do write(m0[j]);writeln;</tt>

<p>
<tt>ma:=m0[perm]; </tt>

<p>
<tt>write('perm=');for j:=0 to 3 do write(perm[j]);writeln; </tt>

<p>
<tt>writeln('ma:=m0[perm]');for j:=0 to 3 do write(ma[j]);writeln;</tt>

<p>
would produce the output 

<p>

<dl compact="compact">
 <dt><b></b></dt>
	<dd>
m0=&nbsp;1&nbsp;2&nbsp;3&nbsp;4

<p>
perm=&nbsp;&nbsp;3&nbsp;1&nbsp;2&nbsp;0&nbsp;

<p>
ma:=m0[perm]&nbsp;

<p>
4&nbsp;2&nbsp;3&nbsp;1
</dd>
</dl>

<p>
     <h3><a name="tth_sEc2.5.6">
2.5.6</a>&nbsp;&nbsp;Field Designators</h3>

<p>
A component of an instance of a record type, or the parameters of an instance
of a schematic type are denoted by the record or schematic type instance followed
by the field or parameter name.

<p>
<center> 
<table border="1">
<tr><td align="center">&lt;field designator&#62;</td><td align="center">&lt;variable&#62;'.'&lt;identifier&#62;</td></tr></table>

<p>
</center>     <h3><a name="tth_sEc2.5.7">
2.5.7</a>&nbsp;&nbsp;Referenced Variables</h3>

<p>
If <tt>p:t</tt>, then <tt>p</tt> denotes
the dynamic variable of type <tt>t</tt> referenced by <tt>p</tt>.

<p>
<center> 
<table border="1">
<tr><td align="center">&lt;referenced variable&#62;</td><td align="center">&lt;variable&#62; ''</td></tr></table>

<p>
</center> <h2><a name="tth_sEc2.6">
2.6</a>&nbsp;&nbsp;Procedures and Functions</h2>

<p>
Procedure and function declarations allow algorithms to be identified by name
and have arguments associated with them so that they may be invoked by procedure
statements or function calls. 

<p>
<center> 
<table border="1">
<tr><td align="center">&lt;procedure declaration&#62;</td><td align="center">&lt;procedure heading&#62;';'[&lt;proc tail&#62;]</td></tr></table>

<p>
</center><center> 
<table border="1">
<tr><td align="center">&lt;proc tail&#62;</td><td align="center">'forward'</td><td align="center">must be followed by definition of procedure body</td></tr><tr><td>
<tr><td align="center"></td><td align="center">'external'</td><td align="center">imports a non Pascal procedure</td></tr>
<tr><td align="center"></td><td align="center">&lt;block&#62;</td><td align="center">procedure implemented here</td></tr></table>

<p>
</center><center> 
<table border="1">
<tr><td align="center">&lt;paramlist&#62;</td><td align="center">'('&lt;formal parameter section&#62;[';'&lt;formal parameter section&#62;]*')'</td></tr></table>

<p>
</center><center> 
<table border="1">
<tr><td align="center">&lt;procedure heading&#62; </td><td align="center">'procedure' &lt;identifier&#62; [&lt;paramlist&#62;]</td></tr>
<tr><td align="center"></td><td align="center">'function'&lt;identifier&#62; [&lt;paramlist&#62;]':'&lt;type&#62;</td></tr></table>

<p>
</center><center> 
<table border="1">
<tr><td align="center">&lt;formal parameter section&#62;</td><td align="center">['var']&lt;identifier&#62;[','&lt;identifier&#62;]':'&lt;type&#62;</td></tr></table>

<p>
</center>The parameters declared in the procedure heading are local to the scope of the
procedure. The parameters in the procedure heading are termed formal
parameters. If the identifiers in a formal parameter section are preceded by
the word <tt>var</tt>, then the formal parameters are termed variable parameters.
The block<a href="#tthFtNtAAF" name="tthFrefAAF"><sup>5</sup></a> of a procedure or function constitutes a scope local to its executable compound
statement. Within a function declaration there must be at least one statement
assigning a value to the function identifier. This assignment determines the
result of a function, but assignment to this identifier does not cause an immediate
return from the function. 

<p>
Function return values can be scalars, pointers, records, strings or sets. Arrays
may not be returned from a function.

<p>

<b>Examples&nbsp;&nbsp;</b>

<p>
The function sba is the mirror image of the abs function.

<p>
<tt>function sba(i:integer):integer; </tt>

<p>
<tt>begin if i&#62;o then sba:=-i else sba:=i end;</tt>

<p>
<tt>type stack:array[0..100] of integer;</tt>

<p>
<tt>procedure push(var s:stack;i:integer);</tt>

<p>
<tt>begin s[s[0]]:=i;s[0]:=s[0]+1; end;</tt>

<p>
 <h1><a name="tth_chAp3">
Chapter 3 </a><br />Algorithms</h1>

<p>
 <h2><a name="tth_sEc3.1">
3.1</a>&nbsp;&nbsp;Expressions</h2>

<p>
An expression is a rule for computing a value by the application of operators
and functions to other values. These operators can be <em>monadic</em> - taking
a single argument, or <em>dyadic</em> - taking two arguments. 

<p>
     <h3><a name="tth_sEc3.1.1">
3.1.1</a>&nbsp;&nbsp;Mixed type expressions</h3>

<p>
The arithmetic operators are defined over the base types integer and real. If
a dyadic operator that can take either real or integer
arguments is applied to arguments one of which is an integer and the other a
real, the integer argument is first implicitly converted to a real before the
operator is applied. Similarly, if a dyadic operator is applied to two integral
numbers of different precision, the number of lower precision is initially converted
to the higher precisions, and the result is of the higher precision. Higher
precision of types <em>t,u</em> is defined such that the type with the greater
precision is the one which can represent the largest range of numbers. Hence
reals are taken to be higher precision than longints even though
the number of significant bits in a real may be less than in a longint.

<p>
When performing mixed type arithmetic between pixels and another numeric data
type, the values of both types are converted to reals before the arithmetic
is performed. If the result of such a mixed type expression is subsequently
assigned to a pixel variable, all values greater than 1.0 are
mapped to 1.0 and all values below -1.0 are mapped to -1.0. 

<p>
     <h3><a name="tth_sEc3.1.2">
3.1.2</a>&nbsp;&nbsp;Primary expressions</h3>

<p>
<center> 
<table border="1">
<tr><td align="center">&lt;primary expression&#62; </td><td align="center">'(' &lt;expression&#62; ')'</td></tr>
<tr><td align="center"></td><td align="center">&lt;literal string&#62;</td></tr>
<tr><td align="center"></td><td align="center">'true'</td></tr>
<tr><td align="center"></td><td align="center">'false'</td></tr>
<tr><td align="center"></td><td align="center">&lt;unsigned integer&#62;</td></tr>
<tr><td align="center"></td><td align="center">&lt;unsigned real&#62;</td></tr>
<tr><td align="center"></td><td align="center">&lt;variable&#62;</td></tr>
<tr><td align="center"></td><td align="center">&lt;constant id&#62;</td></tr>
<tr><td align="center"></td><td align="center">&lt;function call&#62;</td></tr>
<tr><td align="center"></td><td align="center">&lt;set construction&#62;</td></tr></table>

<p>
</center>The most primitive expressions are instances of the literals defined in the
language: literal strings, boolean literals, literal reals and literal integers.
'Salerno', <tt>true</tt>, 12, $ea8f, 1.2e9 are all primary expressions. The
next level of abstraction is provided by symbolic identifiers for values. <tt>X</tt>,
<tt>left</tt>, <tt>a.max</tt>, <tt>p.next</tt>, <tt>z[1]</tt>,
<tt>image[4..200,100..150]</tt> are all primary expressions provided that
the identifiers have been declared as variables or constants.

<p>
An expression surrounded by brackets <tt>( )</tt> is also a primary expression.
Thus if <em>e</em> is an expression so is <tt>(</tt> <em>e</em> <tt>)</tt>. 

<p>
<center> 
<table border="1">
<tr><td align="center">&lt;function call&#62;</td><td align="center">&lt;function id&#62; [ '(' &lt;expression&#62; [,&lt;expression&#62;]* ')' ]</td></tr></table>

<p>
</center><center> 
<table border="1">
<tr><td align="center">&lt;element&#62;</td><td align="center">&lt;expression&#62;</td></tr>
<tr><td align="center"></td><td align="center">&lt;range expression&#62;</td></tr></table>

<p>
</center>Let <em>e</em> be an expression of type  t<sub>1</sub>  and if <tt>f</tt> is an identifier
of type <tt>function( t<sub>1</sub>  ): t<sub>2</sub> </tt>, then
<tt>f(</tt> <em>e</em> <tt>)</tt> is a primary expression of type  t<sub>2</sub> .
A function which takes no parameters is invoked without following its identifier
by brackets. It will be an error if any of the actual parameters supplied to
a function are incompatible with the formal parameters declared for the function.

<p>
<center> 
<table border="1">
<tr><td align="center">&lt;set construction&#62;</td><td align="center">'[' [&lt;element&#62;[,&lt;element&#62;]*] ']'</td></tr></table>

<p>
</center>Finally a primary expression may be a set construction. A set construction is
written as a sequence of zero or more elements enclosed in brackets <tt>[
]</tt> and separated by commas. The elements themselves are either expressions
evaluating to single values or range expressions denoting a sequence of consecutive
values. The type of a set construction is deduced by the compiler from the context
in which it occurs. A set construction occurring on the right hand side of an
assignment inherits the type of the variable to which it is being assigned.
The following are all valid set constructions:

<p>
<tt>[], [1..9], [z..j,9], [a,b,c,]</tt>

<p>
<tt>[]</tt> denotes the empty set.

<p>
     <h3><a name="tth_sEc3.1.3">
3.1.3</a>&nbsp;&nbsp;Unary expressions</h3>

<p>
A unary expression is formed by applying a unary operator to another unary or
primary expression. The unary operators supported are <tt>+, -, *, /,
div, mod, and, or, not,
round, sqrt, sin, cos, tan,
abs, ln, ord, chr, byte2pixel,
pixel2byte, succ, pred, iota,
trans, addr</tt> and <tt>@</tt>.

<p>
Thus the following are valid unary expressions<tt>: -1</tt>, <tt>+b, not true</tt>, <tt>sqrt
abs x</tt>, <tt>sin theta.</tt><a name="primfns">
</a> In standard Pascal some of these operators are treated as
functions,. Syntactically this means that their arguments must be enclosed in
brackets, as in <tt>sin(theta)</tt>. This usage remains syntactically correct
in Vector Pascal. 

<p>
The dyadic operators <tt>+, -, *, /, div, mod , and or</tt> are all extended
to unary context by the insertion of an implicit value under the operation.
Thus just as <tt>-a = 0-a</tt> so too <tt>/2 = 1/2</tt>. For sets the notation
<tt>-s</tt> means the complement of the set <tt>s</tt>. The implicit value inserted
are given below.

<p>
<center> 
<table border="1">
<tr><td align="center">type</td><td align="center">operator<tt>s</tt></td><td align="center"><tt>implicit value</tt></td></tr><tr><td>
<tr><td align="center"><tt>number</tt></td><td align="center"><tt>+,-</tt></td><td align="center">0</td></tr>
<tr><td align="center">string</td><td align="center"><tt>+</tt></td><td align="center">''</td></tr>
<tr><td align="center">set</td><td align="center"><tt>+</tt></td><td align="center">empty set</td></tr>
<tr><td align="center">set</td><td align="center"><tt>-,*</tt></td><td align="center">full-set</td></tr>
<tr><td align="center">number</td><td align="center"><tt>*,/ ,div,mod</tt></td><td align="center">1</td></tr>
<tr><td align="center">number</td><td align="center"><tt>max</tt></td><td align="center">lowest representable number of the type</td></tr>
<tr><td align="center">number</td><td align="center"><tt>min</tt></td><td align="center">highest representable number of the type</td></tr>
<tr><td align="center">boolean</td><td align="center"><tt>and</tt></td><td align="center">true</td></tr>
<tr><td align="center">boolean</td><td align="center"><tt>or</tt> </td><td align="center">false</td></tr></table>

<p>
</center>A unary operator can be applied to an array argument and returns
an array result. Similarly any user declared function over a scalar
type can be applied to an array type and return an array. If <tt>f</tt> is a
function or unary operator mapping from type <tt>r</tt> to type <tt>t</tt> then
if <tt>x</tt> is an array of <tt>r,</tt> and <tt>a</tt> an array of <tt>t</tt>,
then <tt>a:=f(x)</tt> assigns an array of <tt>t</tt> such that <tt>a[i]=f(x[i])</tt>

<p>
<center> 
<table border="1">
<tr><td align="center"><font size="-1">lhs </font></td><td align="center"><font size="-1">rhs</font></td><td><font size="-1">meaning</font></td></tr>
<tr><td align="center"><font size="-1">&lt;unaryop&#62;</font></td><td align="center"><font size="-1">'+'</font></td><td><font size="-1">+x = 0+x identity operator</font></td></tr>
<tr><td align="center"><font size="-1"></font></td><td align="center"><font size="-1">'-'</font></td><td><font size="-1">-x = 0-x, </font></td></tr>
<tr><td align="center"></td><td align="center"></td><td><font size="-1">note: this is defined on integer, real and complex</font></td></tr>
<tr><td align="center"><font size="-1"></font></td><td align="center"><font size="-1">'*'</font></td><td><font size="-1">*x=1*x identity operator</font></td></tr>
<tr><td align="center"><font size="-1"></font></td><td align="center"><font size="-1">'/'</font></td><td><font size="-1">/x=1.0/x </font></td></tr>
<tr><td align="center"></td><td align="center"></td><td><font size="-1">note: this is defined on integer, real and complex</font></td></tr>
<tr><td align="center"><font size="-1"></font></td><td align="center"><font size="-1">'div'</font></td><td><font size="-1">div x =1 div x</font></td></tr>
<tr><td align="center"><font size="-1"></font></td><td align="center"><font size="-1">'mod'</font></td><td><font size="-1">mod x = 1 mod x</font></td></tr>
<tr><td align="center"><font size="-1"></font></td><td align="center"><font size="-1">'and'</font></td><td><font size="-1">and x = true and x</font></td></tr>
<tr><td align="center"><font size="-1"></font></td><td align="center"><font size="-1">'or'</font></td><td><font size="-1">or x = false or x</font></td></tr>
<tr><td align="center"><font size="-1"></font></td><td align="center"><font size="-1">'not'</font></td><td><font size="-1">complements booleans</font></td></tr>
<tr><td align="center"><font size="-1"></font></td><td align="center"><font size="-1">'round'</font></td><td><font size="-1">rounds a real to the closest integer</font></td></tr>
<tr><td align="center"><font size="-1"></font></td><td align="center"><font size="-1">'sqrt'</font></td><td><font size="-1">returns square root as a real number.</font></td></tr>
<tr><td align="center"><font size="-1"></font></td><td align="center"><font size="-1">'sin'</font></td><td><font size="-1">sine of its argument. Argument in radians. Result is real.</font></td></tr>
<tr><td align="center"><font size="-1"></font></td><td align="center"><font size="-1">'cos'</font></td><td><font size="-1">cosine of its argument. Argument in radians. Result is real.</font></td></tr>
<tr><td align="center"><font size="-1"></font></td><td align="center"><font size="-1">'tan'</font></td><td><font size="-1">tangent of its argument. Argument in radians. Result is real.</font></td></tr>
<tr><td align="center"><font size="-1"></font></td><td align="center"><font size="-1">'abs'</font></td><td><font size="-1">if x&lt;0 then abs x = -x else abs x= x</font></td></tr>
<tr><td align="center"><font size="-1"></font></td><td align="center"><font size="-1">'ln'</font></td><td><font size="-1"> log<sub>e</sub>  of its argument. Result is real.</font></td></tr>
<tr><td align="center"><font size="-1"></font></td><td align="center"><font size="-1">'ord'</font></td><td><font size="-1">argument scalar type, returns ordinal </font></td></tr>
<tr><td align="center"></td><td align="center"></td><td><font size="-1">number of the argument.</font></td></tr>
<tr><td align="center"><font size="-1"></font></td><td align="center"><font size="-1">'chr'</font></td><td><font size="-1">converts an integer into a character.</font></td></tr>
<tr><td align="center"><font size="-1"></font></td><td align="center"><font size="-1">'succ'</font></td><td><font size="-1">argument scalar type,</font></td></tr>
<tr><td align="center"></td><td align="center"></td><td><font size="-1">returns the next scalar in the type.</font></td></tr>
<tr><td align="center"><font size="-1"></font></td><td align="center"><font size="-1">'pred'</font></td><td><font size="-1">argument scalar type, </font></td></tr>
<tr><td align="center"></td><td align="center"></td><td><font size="-1">returns the previous scalar in the type.</font></td></tr>
<tr><td align="center"><font size="-1"></font></td><td align="center"><font size="-1">'iota'</font></td><td><font size="-1">iota i returns the ith current index</font></td></tr>
<tr><td align="center"><font size="-1"></font></td><td align="center"><font size="-1">'trans'</font></td><td><font size="-1">transposes a matrix or vector</font></td></tr>
<tr><td align="center"><font size="-1"></font></td><td align="center"><font size="-1">'pixel2byte'</font></td><td><font size="-1">convert pixel in range -1.0..1.0 to byte in range 0..255</font></td></tr>
<tr><td align="center"><font size="-1"></font></td><td align="center"><font size="-1">'byte2pixel'</font></td><td><font size="-1">convert a byte in range 0..255 to a pixel in</font></td></tr>
<tr><td align="center"></td><td align="center"></td><td><font size="-1">the range -1.0..1.0</font></td></tr>
<tr><td align="center"><font size="-1"></font></td><td align="center"><font size="-1">'@','addr'</font></td><td><font size="-1">Given a variable, this returns an</font> </td></tr>
<tr><td align="center"></td><td align="center"></td><td><font size="-1">untyped pointer to the variable.</font></td></tr></table>
<font size="-1">
<p>
</font></center><center> 
<table border="1">
<tr><td align="center">&lt;unary expression&#62;</td><td align="center">&lt;unaryop&#62; &lt;unary expression&#62;</td></tr>
<tr><td align="center"></td><td align="center">'sizeof' '(' &lt;type&#62; ')'</td></tr>
<tr><td align="center"></td><td align="center">&lt;operator reduction&#62;</td></tr>
<tr><td align="center"></td><td align="center">&lt;primary expression&#62;</td></tr>
<tr><td align="center"></td><td align="center">'if'&lt;expression&#62; 'then' &lt;expression&#62; 'else' &lt;expression&#62;</td></tr></table>

<p>
</center>
<h4>sizeof</h4>

<p>
The construct <tt>sizeof(</tt> <em>t</em> <tt>)</tt> where <em>t</em>
is a type, returns the number of bytes occupied by an instance
of the type.

<p>

<h4>iota<a name="iota">
</a></h4>

<p>
The operator iota i returns the ith current implicit index<a href="#tthFtNtAAG" name="tthFrefAAG"><sup>6</sup></a>. 

<p>

<b>Examples&nbsp;&nbsp;</b>

<p>
Thus given the definitions 

<p>
<tt>var v1:array[1..3]of integer; </tt>

<p>
<tt>v2:array[0..4] of integer;</tt>

<p>
then the program fragment

<p>
<tt>v1:=iota 0;</tt>

<p>
<tt>v2:=iota 0 *2;</tt>

<p>
<tt></tt><tt>for i:=1 to 3 do write( v1[i]); writeln; </tt>

<p>
<tt>writeln('v2'); </tt>

<p>
<tt>for i:=0 to 4 do write( v2[i]); writeln; </tt>

<p>
would produce the output

<p>

<dl compact="compact">
 <dt><b></b></dt>
	<dd>
v1

<p>
1&nbsp;2&nbsp;3&nbsp;

<p>
v2&nbsp;

<p>
0&nbsp;2&nbsp;4&nbsp;6&nbsp;8
</dd>
</dl>
whilst given the definitions

<p>
<tt>m1:array[1..3,0..4] of integer;m2:array[0..4,1..3]of integer;</tt>

<p>
then the program fragment 

<p>
<tt>m2:= iota 0 +2*iota 1; </tt>

<p>
<tt>writeln('m2:= iota 0 +2*iota 1 '); </tt>

<p>
<tt>for i:=0 to 4 do begin for j:=1 to 3 do write(m2[i,j]); writeln;
end; </tt>

<p>
would produce the output

<p>

<dl compact="compact">
 <dt><b></b></dt>
	<dd>
m2:=&nbsp;iota&nbsp;0&nbsp;+2*iota&nbsp;1&nbsp;

<p>
2&nbsp;4&nbsp;6&nbsp;

<p>
3&nbsp;5&nbsp;7&nbsp;

<p>
4&nbsp;6&nbsp;8&nbsp;

<p>
5&nbsp;7&nbsp;9&nbsp;

<p>
6&nbsp;8&nbsp;10&nbsp;&nbsp;
</dd>
</dl>
The argument to <tt>iota</tt> must be an integer known at compile
time within the range of implicit indices in the current context. The reserved
word <tt>ndx</tt> is a synonym for <tt>iota</tt>.

<p>

<b>perm&nbsp;&nbsp;</b>

<p>
A generalised permutation of the implicit indices is performed using the syntactic
form: 

<p>

<blockquote><tt>perm</tt><tt>[</tt><tt><i>index-sel[,index-sel]* ]expression </i></tt>
</blockquote>
The <i>index-sel</i>s are integers known at compile time which specify a permutation
on the implicit indices. Thus in  e  evaluated in context <tt>perm</tt><tt>[ i,j,k ] e </tt>,
then: 

<p>

<blockquote><tt>iota 0 = iota</tt> <tt> i, </tt> <tt>iota 1= iota</tt> <tt> j, </tt>
<tt>iota 2= iota</tt> <tt> k </tt>
</blockquote>
This is particularly useful in converting between different image formats. Hardware
frame buffers typically represent images with the pixels in the red, green,
blue, and alpha channels adjacent in memory. For image processing it is convenient
to hold them in distinct planes. The <tt>perm</tt> operator provides a concise
notation for translation between these formats: 
<pre>
type rowindex=0..479;
     colindex=0..639;
var channel=red..alpha;
    screen:array[rowindex,colindex,channel] of pixel;
    img:array[channel,colindex,rowindex] of pixel;
...
screen:=perm[2,0,1]img;

</pre>

<p>
<tt>trans</tt> and <tt>diag</tt> <a name="diag">
</a> provide shorthand
notions for expressions in terms of <tt>perm</tt>. Thus in an assignment
context of rank 2, <tt>trans = perm[1,0]</tt> and <tt>diag = perm[0,0]</tt>. 

<p>

<h4>trans</h4>

<p>
The operator trans transposes a vector or matrix. It achieves
this by cyclic rotation of the implicit indices.
Thus if <tt>trans</tt> <em>e</em> is evaluated in a context with implicit indices 

<p>
<tt>iota</tt> <em>0</em>.. <tt>iota</tt> <em>n </em>

<p>
then the expression e is evaluated in a context with implicit indices 

<p>
<tt>iota</tt>'<em>0</em>.. <tt>iota</tt>'<em>n</em> 

<p>
where 

<p>
<tt>iota</tt>'<em>x</em> = <tt>iota</tt> ( (<em>x+1</em>)<tt>mod</tt> <em>n+1</em>)

<p>
It should be noted that transposition is generalised to arrays of rank greater
than 2.

<p>

<b>Examples&nbsp;&nbsp;</b>

<p>
Given the definitions used above in section <a href="#iota">3.1.3</a>, the program fragment:

<p>
<tt>m1:= (trans v1)*v2; </tt>

<p>
<tt>writeln('(trans v1)*v2'); </tt>

<p>
<tt>for i:=1 to 3 do begin for j:=0 to 4 do write(m1[i,j]); writeln;
end; </tt>

<p>
<tt>m2 := trans m1; </tt>

<p>
<tt>writeln('transpose 1..3,0..4 matrix'); </tt>

<p>
<tt>for i:=0 to 4 do begin for j:=1 to 3 do write(m2[i,j]); writeln;
end;</tt>

<p>
will produce the output:

<p>

<dl compact="compact">
 <dt><b></b></dt>
	<dd>
(trans&nbsp;v1)*v2&nbsp;

<p>
0&nbsp;&nbsp;2&nbsp;&nbsp;4&nbsp;&nbsp;6&nbsp;&nbsp;8&nbsp;

<p>
0&nbsp;&nbsp;4&nbsp;&nbsp;8&nbsp;12&nbsp;16&nbsp;

<p>
0&nbsp;&nbsp;6&nbsp;12&nbsp;18&nbsp;24&nbsp;

<p>
transpose&nbsp;1..3,0..4&nbsp;matrix&nbsp;

<p>
0&nbsp;&nbsp;0&nbsp;&nbsp;0&nbsp;

<p>
2&nbsp;&nbsp;4&nbsp;&nbsp;6&nbsp;

<p>
4&nbsp;&nbsp;8&nbsp;12&nbsp;

<p>
6&nbsp;12&nbsp;18&nbsp;

<p>
8&nbsp;16&nbsp;24
</dd>
</dl>

<p>
     <h3><a name="tth_sEc3.1.4">
3.1.4</a>&nbsp;&nbsp;Operator Reduction</h3>

<p>
Any dyadic operator can be converted to a monadic reduction
operator by the functional . Thus if <tt>a</tt> is an array,
<tt>+a</tt> denotes the sum over the array. More generally  \<font face="symbol">F</font
>x 
for some dyadic operator  <font face="symbol">F</font
> means  x<sub>0</sub><font face="symbol">F</font
>(x<sub>1</sub><font face="symbol">F</font
>..(x<sub>n</sub><font face="symbol">F</font
><font face="symbol">i</font
>)) 
where  <font face="symbol">i</font
> is the implicit value given the operator and the type. Thus
we can write + for  <font face="symbol">å</font
>, * for  <font face="symbol">Õ</font
>
etc. The dot product of two vectors can thus be written as

<p>
<tt>x:= + y*z;</tt>

<p>
instead of

<p>
<tt>x:=0;</tt>

<p>
<tt>for i:=0 to n do x:= x+ y[i]*z[i];</tt>

<p>
A reduction operation takes an argument of rank <em>r</em> and returns
an argument of rank <em>r-1</em> except in the case where its argument is of rank
0, in which case it acts as the identity operation. Reduction is always performed
along the last array dimension of its argument. 

<p>
<center> 
<table border="1">
<tr><td align="center">&lt;operator reduction&#62;</td><td align="center">''&lt;dyadic op&#62; &lt;multiplicative expression&#62;</td></tr></table>

<p>
</center><center> 
<table border="1">
<tr><td align="center">&lt;dyadic op&#62;</td><td align="center">&lt;expop&#62;</td></tr>
<tr><td align="center"></td><td align="center">&lt;multop&#62;</td></tr>
<tr><td align="center"></td><td align="center">&lt;addop&#62;</td></tr></table>

<p>
</center>The reserved word <tt>rdu</tt> is available as a lexical alternative
to , so + is equivalent to <tt>rdu</tt>+.

<p>
     <h3><a name="tth_sEc3.1.5">
3.1.5</a>&nbsp;&nbsp;Complex conversion</h3>

<p>
Complex numbers can be produced from reals using the function
<tt>cmplx</tt>. <tt>cmplx(</tt><em>re,im</em><tt>)</tt> is the complex
number with real part <em>re</em>, and imaginaray part <em>im</em>.

<p>
The real and imaginary parts of a complex number can be obtained by the functions
<tt>re</tt> and <tt>im</tt>. <tt>re</tt>(<em>c</em>) is the real part of the complex
number <em>c</em>. <tt>im</tt>(<em>c</em>) is the imaginary part of the complex
number <em>c</em>.

<p>
     <h3><a name="tth_sEc3.1.6">
3.1.6</a>&nbsp;&nbsp;Conditional expressions</h3>

<p>
The conditional expression allows two different values to be returned depenent
upon a boolean expression.

<p>

<pre>
var a:array[0..63] of real;
... 

a:=if a&#62;0 then a else -a; 

...

</pre>

<p>
The <tt>if</tt> expression can be compiled in two ways: 

<p>

<ol type="1"><p>
<li> Where the two arms of the if expression are parallelisable, the condition and
both arms are evaluated and then merged under a boolean mask. Thus, the above
assignment would be equivalent to: 

<p>
<tt>a:= (a and (a  &gt;  0))or(not (a  &gt;  0) and -a);</tt>

<p>
were the above legal Pascal<a href="#tthFtNtAAH" name="tthFrefAAH"><sup>7</sup></a>.</li>
<p>
<li> If the code is not paralleliseable it is translated as equivalent to a standard
if statement. Thus, the previous example would be equivalent to: 

<p>
<tt>for i:=0 to 63 do if a[i]  &gt;  0 then a[i]:=a[i] else
a[i]:=-a[i];</tt>

<p>
Expressions are non parallelisable if they include function calls.</li>
</ol>
The dual compilation strategy allows the same linguistic construct to be used
in recursive function definitions and parallel data selection. 

<p>
     <h3><a name="tth_sEc3.1.7">
3.1.7</a>&nbsp;&nbsp;Factor</h3>

<p>
A factor is an expression that optionally performs exponentiation. Vector Pascal
supports exponentiation either by integer exponents or by real exponents. A
number <em>x</em> can be raised to an integral power <em>y</em> by using the construction
<em>x</em> <tt>pow</tt> <em>y</em>. A number can be raised to an arbitrary
real power by the <tt>**</tt> operator. The result of <tt>**</tt>
is always real valued.

<p>
<center> 
<table border="1">
<tr><td align="center">&lt;expop&#62;</td><td align="center">'pow'</td></tr>
<tr><td align="center"></td><td align="center">'**'</td></tr></table>

<p>
</center><center> 
<table border="1">
<tr><td align="center">&lt;factor&#62;</td><td align="center">&lt;unary expression&#62; [ &lt;expop&#62; &lt;unary expression&#62;]</td></tr></table>

<p>
</center>     <h3><a name="tth_sEc3.1.8">
3.1.8</a>&nbsp;&nbsp;Multiplicative expressions</h3>

<p>
Multiplicative expressions consist of factors linked by the multiplicative operators
<tt>*, /, div, mod, shr, shl
and</tt>. The use of these operators is summarised in table <a href="#multop">3.1</a>.

<p>

<p>
<a name="tth_tAb3.1">
</a> <center>Table 3.1: Multiplicative operators<a name="multop">
</a></center>
<center> 
<table>
<tr><td align="center"><font size="-1">Operator</font></td><td align="center"><font size="-1">Left</font></td><td align="center"><font size="-1">Right</font></td><td align="center"><font size="-1">Result</font></td><td align="center"><font size="-1">Effect of</font> <em><font size="-1">a</font></em> <tt><font size="-1">op</font></tt> <em><font size="-1">b</font></em><font size="-1"></font></td></tr>
<tr><td align="center"><tt><font size="-1">*</font></tt><font size="-1"></font></td><td align="center"><font size="-1">integer</font></td><td align="center"><font size="-1">integer</font></td><td align="center"><font size="-1">integer</font></td><td align="center"><font size="-1">multiply</font></td></tr>
<tr><td align="center"><font size="-1"></font></td><td align="center"><font size="-1">real</font></td><td align="center"><font size="-1">real</font></td><td align="center"><font size="-1">real</font></td><td align="center"><font size="-1">multiply</font></td></tr>
<tr><td align="center"><font size="-1"></font></td><td align="center"><font size="-1">complex</font></td><td align="center"><font size="-1">complex</font></td><td align="center"><font size="-1">complex</font></td><td align="center"><font size="-1">multiply</font></td></tr>
<tr><td align="center"><tt><font size="-1">/</font></tt><font size="-1"></font></td><td align="center"><font size="-1">integer</font></td><td align="center"><font size="-1">integer</font></td><td align="center"><font size="-1">real</font></td><td align="center"><font size="-1">division</font></td></tr>
<tr><td align="center"><font size="-1"></font></td><td align="center"><font size="-1">real</font></td><td align="center"><font size="-1">real</font></td><td align="center"><font size="-1">real</font></td><td align="center"><font size="-1">division</font></td></tr>
<tr><td align="center"><font size="-1"></font></td><td align="center"><font size="-1">complex</font></td><td align="center"><font size="-1">complex</font></td><td align="center"><font size="-1">complex</font></td><td align="center"><font size="-1">division</font></td></tr>
<tr><td align="center"><tt><font size="-1">div</font></tt><font size="-1"></font></td><td align="center"><font size="-1">integer</font></td><td align="center"><font size="-1">integer</font></td><td align="center"><font size="-1">integer</font></td><td align="center"><font size="-1">division</font></td></tr>
<tr><td align="center"><tt><font size="-1">mod</font></tt><font size="-1"></font></td><td align="center"><font size="-1">integer</font></td><td align="center"><font size="-1">integer</font></td><td align="center"><font size="-1">integer</font></td><td align="center"><font size="-1">remainder</font></td></tr>
<tr><td align="center"><tt><font size="-1">and</font></tt><font size="-1"></font></td><td align="center"><font size="-1">boolean</font></td><td align="center"><font size="-1">boolean</font></td><td align="center"><font size="-1">boolean</font></td><td align="center"><font size="-1">logical and</font></td></tr>
<tr><td align="center"><tt><font size="-1">shr</font></tt><font size="-1"></font></td><td align="center"><font size="-1">integer</font></td><td align="center"><font size="-1">integer</font></td><td align="center"><font size="-1">integer</font></td><td align="center"><font size="-1">shift</font> <em><font size="-1">a</font></em> <font size="-1">by</font> <em><font size="-1">b</font></em> <font size="-1">bits right</font></td></tr>
<tr><td align="center"><tt><font size="-1">shl</font></tt><font size="-1"></font></td><td align="center"><font size="-1">integer</font></td><td align="center"><font size="-1">integer</font></td><td align="center"><font size="-1">integer</font></td><td align="center"><font size="-1">shift</font> <em><font size="-1">a</font></em> <font size="-1">by</font> <em><font size="-1">b</font></em> <font size="-1">bits left</font></td></tr>
<tr><td align="center"><tt><font size="-1">in</font></tt><font size="-1"></font></td><td align="center"><em><font size="-1">t</font></em><font size="-1"></font></td><td align="center"><tt><font size="-1">set of</font></tt> <em><font size="-1">t</font></em><font size="-1"></font></td><td align="center"><font size="-1">boolean</font></td><td align="center"><font size="-1">true if</font> <em><font size="-1">a</font></em> <font size="-1">is member of</font> <em><font size="-1">b</font></em></td></tr></table>
<font size="-1">
<p>
</font></center>
<p>
<center> 
<table border="1">
<tr><td align="center">&lt;multop&#62;</td><td align="center">'*'</td></tr>
<tr><td align="center"></td><td align="center">'/'</td></tr>
<tr><td align="center"></td><td align="center">'div'</td></tr>
<tr><td align="center"></td><td align="center">'shr'</td></tr>
<tr><td align="center"></td><td align="center">'shl'</td></tr>
<tr><td align="center"></td><td align="center">'and'</td></tr>
<tr><td align="center"></td><td align="center">'mod'</td></tr></table>

<p>
</center><center> 
<table border="1">
<tr><td align="center">&lt;multiplicative expression&#62;</td><td align="center">&lt;factor&#62; [ &lt;multop&#62; &lt;factor&#62; ]*</td></tr>
<tr><td align="center"></td><td align="center">&lt;factor&#62;'in'&lt;multiplicative expression&#62;</td></tr></table>

<p>
</center>     <h3><a name="tth_sEc3.1.9">
3.1.9</a>&nbsp;&nbsp;Additive expressions</h3>

<p>
An additive expression allows multiplicative expressions to be combined using
the addition operators <tt>+, -, or, +:,max,
min, -:</tt>, 
<tt>&gt;&lt;</tt>. The additive operations are summarised in table<a href="#addops">3.2</a>
.

<p>

<p>
<a name="tth_tAb3.2">
</a> <center>Table 3.2: Addition operations<a name="addops">
</a></center>
<center> 
<table>
<tr><td align="center"><font size="-1"></font></td><td align="center"><font size="-1">Left</font></td><td align="center"><font size="-1"></font></td><td align="center"><font size="-1">Right</font></td><td align="center"><font size="-1">Result</font></td><td align="center"><font size="-1">Effect of</font> <em><font size="-1">a</font></em> <tt><font size="-1">op</font></tt> <em><font size="-1">b</font></em><font size="-1"></font></td></tr><tr><td>
<tr><td align="center"><tt><font size="-2">+</font></tt><font size="-2"></font></td><td align="center"><font size="-2">integer</font></td><td align="center"><font size="-2"></font></td><td align="center"><font size="-2">integer</font></td><td align="center"><font size="-2">integer</font></td><td align="center"><font size="-2">sum of</font> <em><font size="-2">a</font></em> <font size="-2">and</font> <em><font size="-2">b</font></em><font size="-2"></font></td></tr>
<tr><td align="center"><font size="-2"></font></td><td align="center"><font size="-2">real</font></td><td align="center"><font size="-2"></font></td><td align="center"><font size="-2">real</font></td><td align="center"><font size="-2">real</font></td><td align="center"><font size="-2">sum of</font> <em><font size="-2">a</font></em> <font size="-2">and</font> <em><font size="-2">b</font></em><font size="-2"></font></td></tr>
<tr><td align="center"><font size="-2"></font></td><td align="center"><font size="-2">complex</font></td><td align="center"><font size="-2"></font></td><td align="center"><font size="-2">complex</font></td><td align="center"><font size="-2">complex</font></td><td align="center"><font size="-2">sum of</font> <em><font size="-2">a</font></em> <font size="-2">and</font> <em><font size="-2">b</font></em><font size="-2"></font></td></tr>
<tr><td align="center"><font size="-2"></font></td><td align="center"><font size="-2">set</font></td><td align="center"><font size="-2"></font></td><td align="center"><font size="-2">set</font></td><td align="center"><font size="-2">set</font></td><td align="center"><font size="-2">union of</font> <em><font size="-2">a</font></em> <font size="-2">and</font> <em><font size="-2">b</font></em><font size="-2"></font></td></tr>
<tr><td align="center"><font size="-2"></font></td><td align="center"><font size="-2">string</font></td><td align="center"><font size="-2"></font></td><td align="center"><font size="-2">string</font></td><td align="center"><font size="-2">string</font></td><td align="center"><font size="-2">concatenate</font> <em><font size="-2">a</font></em> <font size="-2">with</font>
<em><font size="-2">b</font></em> <font size="-2">'ac'+'de'='acde'</font></td></tr>
<tr><td align="center"><tt><font size="-2">-</font></tt><font size="-2"></font></td><td align="center"><font size="-2">integer</font></td><td align="center"><font size="-2"></font></td><td align="center"><font size="-2">integer</font></td><td align="center"><font size="-2">integer</font></td><td align="center"><font size="-2">result of subtracting</font> <em><font size="-2">b</font></em> <font size="-2">from</font>
<em><font size="-2">a</font></em><font size="-2"></font></td></tr>
<tr><td align="center"><font size="-2"></font></td><td align="center"><font size="-2">real</font></td><td align="center"><font size="-2"></font></td><td align="center"><font size="-2">real</font></td><td align="center"><font size="-2">real</font></td><td align="center"><font size="-2">result of subtracting</font> <em><font size="-2">b</font></em> <font size="-2">from</font>
<em><font size="-2">a</font></em><font size="-2"></font></td></tr>
<tr><td align="center"><font size="-2"></font></td><td align="center"><font size="-2">complex</font></td><td align="center"><font size="-2"></font></td><td align="center"><font size="-2">complex</font></td><td align="center"><font size="-2">complex</font></td><td align="center"><font size="-2">result of subtracting</font> <em><font size="-2">b</font></em> <font size="-2">from</font>
<em><font size="-2">a</font></em><font size="-2"></font></td></tr>
<tr><td align="center"><font size="-2"></font></td><td align="center"><font size="-2">set</font></td><td align="center"><font size="-2"></font></td><td align="center"><font size="-2">set</font></td><td align="center"><font size="-2">set</font></td><td align="center"><font size="-2">complement of</font> <em><font size="-2">b</font></em> <font size="-2">relative
to</font> <em><font size="-2">a</font></em><font size="-2"></font></td></tr>
<tr><td align="center"><tt><font size="-2">+:</font></tt><font size="-2"></font></td><td align="center"><font size="-2">0..255</font></td><td align="center"><font size="-2"></font></td><td align="center"><font size="-2">0..255</font></td><td align="center"><font size="-2">0..255</font></td><td align="center"><font size="-2">saturated + clipped to 0..255 </font></td></tr>
<tr><td align="center"><font size="-2"></font></td><td align="center"><font size="-2">-128..127</font></td><td align="center"><font size="-2"></font></td><td align="center"><font size="-2">-128..127</font></td><td align="center"><font size="-2">-128..127</font></td><td align="center"><font size="-2">saturated + clipped to -128..127</font></td></tr>
<tr><td align="center"><tt><font size="-2">-:</font></tt><font size="-2"></font></td><td align="center"><font size="-2">0..255</font></td><td align="center"><font size="-2"></font></td><td align="center"><font size="-2">0..255</font></td><td align="center"><font size="-2">0..255</font></td><td align="center"><font size="-2">saturated - clipped to 0..255</font></td></tr>
<tr><td align="center"><font size="-2"></font></td><td align="center"><font size="-2">-128..127</font></td><td align="center"><font size="-2"></font></td><td align="center"><font size="-2">-128..127</font></td><td align="center"><font size="-2">-128..127</font></td><td align="center"><font size="-2">saturated - clipped to -128..127</font></td></tr>
<tr><td align="center"><tt><font size="-2">min</font></tt><font size="-2"></font></td><td align="center"><font size="-2">integer</font></td><td align="center"><font size="-2"></font></td><td align="center"><font size="-2">integer</font></td><td align="center"><font size="-2">integer</font></td><td align="center"><font size="-2">returns the lesser of the numbers</font></td></tr>
<tr><td align="center"></td><td align="center"><font size="-2">real</font></td><td align="center"><font size="-2"></font></td><td align="center"><font size="-2">real</font></td><td align="center"><font size="-2">real</font></td><td align="center"><font size="-2">returns the lesser of the numbers</font></td></tr>
<tr><td align="center"><tt><font size="-2">max</font></tt><font size="-2"></font></td><td align="center"><font size="-2">integer</font></td><td align="center"><font size="-2"></font></td><td align="center"><font size="-2">integer</font></td><td align="center"><font size="-2">integer</font></td><td align="center"><font size="-2">returns the greater of the numbers</font></td></tr>
<tr><td align="center"></td><td align="center"><font size="-2">real</font></td><td align="center"><font size="-2"></font></td><td align="center"><font size="-2">real</font></td><td align="center"><font size="-2">real</font></td><td align="center"><font size="-2">returns the greater of the numbers</font></td></tr>
<tr><td align="center"><tt><font size="-2">or</font></tt><font size="-2"></font></td><td align="center"><font size="-2">boolean</font></td><td align="center"><font size="-2"></font></td><td align="center"><font size="-2">boolean</font></td><td align="center"><font size="-2">boolean</font></td><td align="center"><font size="-2">logical or</font></td></tr>
<tr><td align="center"> <tt>&gt;&lt;</tt></td><td align="center"><font size="-2">set</font></td><td align="center"><font size="-2"></font></td><td align="center"><font size="-2">set</font></td><td align="center"><font size="-2">set</font></td><td align="center"><font size="-2">symetric difference</font></td></tr></table>
<font size="-2">
<p>
</font></center>
<p>
<center> 
<table border="1">
<tr><td align="center"><font size="-2">&lt;addop&#62;</font></td><td align="center"><font size="-2">'+'</font></td></tr>
<tr><td align="center"><font size="-2"></font></td><td align="center"><font size="-2">'-'</font></td></tr>
<tr><td align="center"><font size="-2"></font></td><td align="center"><font size="-2">'or'</font></td></tr>
<tr><td align="center"><font size="-2"></font></td><td align="center"><font size="-2">'max'</font></td></tr>
<tr><td align="center"><font size="-2"></font></td><td align="center"><font size="-2">'min'</font></td></tr>
<tr><td align="center"><font size="-2"></font></td><td align="center"><font size="-2">'+:'</font></td></tr>
<tr><td align="center"><font size="-2"></font></td><td align="center"><font size="-2">'-:'</font></td></tr></table>
<font size="-2">
<p>
</font></center><center> 
<table border="1">
<tr><td align="center"><font size="-2">&lt;additive expression&#62;</font></td><td align="center"><font size="-2">&lt;multiplicative expression&#62; [ &lt;addop&#62; &lt;multiplicative expression&#62;
]*</font></td></tr></table>
<font size="-2">
<p>
</font></center><center> 
<table border="1">
<tr><td align="center"><font size="-2">&lt;expression&#62;</font></td><td align="center"><font size="-2">&lt;additive expression&#62; &lt;relational operator&#62; &lt;expression&#62;</font></td></tr></table>
<font size="-2">
<p>
</font></center>     <h3><a name="tth_sEc3.1.10">
3.1.10</a>&nbsp;&nbsp;Expressions</h3>
An expression can optionally involve the use of  a relational operator
to compare the results of two additive expressions. Relational operators
always return boolean results and are listed in table <a href="#relop">3.3</a>.

<p>
<a name="tth_tAb3.3">
</a> <center>Table 3.3: Relational operators</center><a name="relop">
</a>

<table>
<tr><td align="center"><tt>&lt;</tt></td><td align="center">Less than</td></tr>
<tr><td align="center"><tt>&gt;</tt></td><td align="center">Greater than</td></tr>
<tr><td align="center"><tt>&lt;=</tt></td><td align="center">Less than or equal to</td></tr>
<tr><td align="center"><tt>&gt;=</tt></td><td align="center">Greater than or equal to</td></tr>
<tr><td align="center"><tt>&lt;&gt;</tt> </td><td align="center">Not equal to</td></tr>
<tr><td align="center"><tt>=</tt></td><td align="center">Equal to</td></tr></table>


<p>

<p>
     <h3><a name="tth_sEc3.1.11">
3.1.11</a>&nbsp;&nbsp;Operator overloading</h3>

<p>
The dyadic operators
 can be extended to operate on new types by operator overloading.
Figure <a href="#complex">3.1</a> shows how arithmetic on the type <tt>complex</tt> required
by Extended Pascal [<a href="#ISO90" name="CITEISO90">15</a>] is defined in Vector Pascal. Each operator
is associated with a semantic function and
if it is a non-relational operator,
an identity element. The operator
symbols must be drawn from the set of predefined Vector Pascal operators, and
when expressions involving them are parsed, priorities are inherited from the
predefined operators. The type signature of the operator is deduced from the
type of the function<a href="#tthFtNtAAI" name="tthFrefAAI"><sup>8</sup></a>. 

<p>
<center> 
<table border="1">
<tr><td align="center"><font size="-2">&lt;operator-declaration&#62;</font></td><td align="center"><font size="-2">'operator' 'cast' '=' &lt;identifier&#62;</font></td></tr>
<tr><td align="center"></td><td align="center"><font size="-2">'operator' &lt;dyadicop&#62; '=' &lt;identifier&#62;','&lt;identifier&#62;</font></td></tr>
<tr><td align="center"></td><td align="center"><font size="-2">'operator' &lt;relational operator&#62; '=' &lt;identifier&#62;</font></td></tr></table>
<font size="-2">
<p>
</font></center>
<p>
<a name="tth_fIg3.1">
</a> <font size="-1">***&#175;***&#175;***&#175;***&#175;***&#175;***&#175;***&#175;***&#175;***&#175;***&#175;***&#175;***&#175;***&#175;
<br /><table align="left" border="0"><tr><td width="553">
<tt>interface </tt></td></tr></table><!--hbox-->
<br /><br /><table align="left" border="0"><tr><td width="553">
<tt>type </tt></td></tr></table><!--hbox-->
<br /><br /><table align="left" border="0"><tr><td width="553">
<tt>Complex  = record  data : array [0..1] of  real ;</tt></td></tr></table><!--hbox-->
<br />\&lt;<br /><table align="left" border="0"><tr><td width="553">
<tt>end ;</tt></td></tr></table><!--hbox-->
<br /><br />\&lt;<br /><table align="left" border="0"><tr><td width="553">
<tt>var </tt></td></tr></table><!--hbox-->
<br /><br /><table align="left" border="0"><tr><td width="553">
<tt> complexzero, complexone : complex;</tt></td></tr></table><!--hbox-->
<br /><br />\&lt;<tt>function  real2cmplx 		
( realpart :real ):complex ;</tt> <br />
\&lt;<tt>function  cmplx 			
( realpart ,imag :real ):complex ;</tt> <br />
\&lt;<tt>function  complex_add          	
( A ,B :Complex ):complex ;</tt> <br />
\&lt;<tt>function  complex_conjugate   	
( A :Complex ):complex ;</tt> <br />
\&lt;<tt>function  complex_subtract  	
( A ,B :Complex ):complex ;</tt> <br />
\&lt;<tt>function  complex_multiply  	
( A ,B :Complex ):complex ;</tt> <br />
\&lt;<tt>function  complex_divide  	
( A ,B :Complex ):complex ;</tt> <br />
<br /><table align="left" border="0"><tr><td width="553">
<tt><font size="-1">{	Standard operators on complex numbers 	}</font></tt></td></tr></table><!--hbox-->
<br /><br /><table align="left" border="0"><tr><td width="553">
<tt><font size="-1">{		symbol		function		identity element }</font></tt></td></tr></table><!--hbox-->
<br /><br /><table align="left" border="0"><tr><td width="553">
<tt>operator  	+ 	= 	Complex_add , 		complexzero ;</tt></td></tr></table><!--hbox-->
<br /><br /><table align="left" border="0"><tr><td width="553">
<tt>operator 	/	=	complex_divide ,		complexone ;</tt></td></tr></table><!--hbox-->
<br /><br /><table align="left" border="0"><tr><td width="553">
<tt>operator 	*	=	complex_multiply ,	complexone ;</tt></td></tr></table><!--hbox-->
<br /><br /><table align="left" border="0"><tr><td width="553">
<tt>operator 	-	=	complex_subtract ,	complexzero ;</tt></td></tr></table><!--hbox-->
<br /><br /><table align="left" border="0"><tr><td width="553">
<tt>operator 	cast 	=	real2cmplx  ;</tt></td></tr></table><!--hbox-->
<br /><br /></font>
<center>Figure 3.1: Defining operations on complex numbers</center>

<p>
<a name="complex">
</a><font size="-1">Note that only the function headers are given here as
this code comes from the interface part of the system unit. The function bodies
and the initialisation of the variables complexone and complexzero are handled
in the implementation part of the unit.</font><font size="-1">
<p>
</font>
<p>
 When parsing expressions, the compiler first tries to resolve operations in
terms of the predefined operators of the language, taking into account the standard
mechanisms allowing operators to work on arrays. Only if these fail does it
search for an overloaded operator whose type signature matches the context. 

<p>
In the example in figure <a href="#complex">3.1</a>, complex numbers are defined to be records
containing an array of reals, rather than simply as an array of reals. Had they
been so defined, the operators <tt>+,*,-,/</tt> on reals would have masked
the corresponding operators on complex numbers. 

<p>
The provision of an identity element for complex addition and subtraction ensures
that unary minus, as in  <font face="symbol">-</font
>x  for  x: complex, is well defined, and
correspondingly that unary / denotes complex reciprocal. Overloaded operators
can be used in array maps and array reductions. 

<p>

<h4>Implicit casts</h4>
The Vector Pascal language already contains a number of implicit type
conversions that are context determind. An example is the promotion of
integers to reals in the context of arithmetic expressions. The set of
implicit casts can be added to by declaring an operator to be a cast
as is shown in the line:

<p>
<table align="left" border="0"><tr><td width="553">
<tt><i>operator</i> 	<i>cast</i> 	=	<i>real2cmplx</i>  ;</tt></td></tr></table><!--hbox-->
<br clear="all" /><br />Given an implict cast from type t<sub>0</sub><font face="symbol">®</font
> t<sub>1</sub>,
the function associated with the implicit cast is then called 
on the result
of any expression e:t<sub>0</sub>  whose expression context requires 
it to be of type t<sub>1</sub>.

 <h2><a name="tth_sEc3.2">
3.2</a>&nbsp;&nbsp;Statements</h2>

<p>
<center> 
<table border="1">
<tr><td align="center">&lt;statement&#62;</td><td align="center"><font size="-1">&lt;variable&#62;':='&lt;expression&#62;</font></td></tr>
<tr><td align="center"><font size="-1"></font></td><td align="center"><font size="-1">&lt;procedure statement&#62;</font></td></tr>
<tr><td align="center"><font size="-1"></font></td><td align="center"><font size="-1">&lt;empty statement&#62;</font></td></tr>
<tr><td align="center"><font size="-1"></font></td><td align="center"><font size="-1">'goto' &lt;label&#62;;</font></td></tr>
<tr><td align="center"><font size="-1"></font></td><td align="center"><font size="-1">'exit'['('&lt;expression&#62;')']</font></td></tr>
<tr><td align="center"><font size="-1"></font></td><td align="center"><font size="-1">'begin' &lt;statement&#62;[;&lt;statement&#62;]*'end'</font></td></tr>
<tr><td align="center"><font size="-1"></font></td><td align="center"><font size="-1">'if'&lt;expression&#62;'then'&lt;statement&#62;['else'&lt;statement&#62;]</font></td></tr>
<tr><td align="center"><font size="-1"></font></td><td align="center"><font size="-1">&lt;case statement&#62;</font></td></tr>
<tr><td align="center"><font size="-1"></font></td><td align="center"><font size="-1">'for' &lt;variable&#62;:= &lt;expression&#62; 'to' &lt;expression&#62; 'do' &lt;statement&#62;</font></td></tr>
<tr><td align="center"><font size="-1"></font></td><td align="center"><font size="-1">'for' &lt;variable&#62;:= &lt;expression&#62; 'downto' &lt;expression&#62; 'do' &lt;statement&#62;</font></td></tr>
<tr><td align="center"><font size="-1"></font></td><td align="center"><font size="-1">'repeat' &lt;statement&#62; 'until' &lt;expression&#62;</font></td></tr>
<tr><td align="center"><font size="-1"></font></td><td align="center"><font size="-1">'with' &lt;record variable&#62; 'do' &lt; statement&#62;</font></td></tr>
<tr><td align="center"><font size="-1"></font></td><td align="center"><font size="-1">&lt;io statement&#62;</font></td></tr>
<tr><td align="center"><font size="-1"></font></td><td align="center"><font size="-1">'while' &lt;expression&#62; 'do' &lt;statement&#62;</font></td></tr></table>
<font size="-1">
<p>
</font></center>     <h3><a name="tth_sEc3.2.1">
3.2.1</a>&nbsp;&nbsp;Assignment<a name="assignment">
</a></h3>

<p>
An assignment replaces the current value of a variable by a new value specified
by an expression. The assignment operator is :=.
Standard Pascal allows assignment of whole arrays.
Vector Pascal extends this to allow consistent use of mixed rank
expressions on the right hand side of an assignment. Given

<p>
<tt>r0:real; r1:array[0..7] of real; </tt>

<p>
<tt>r2:array[0..7,0..7] of real</tt>

<p>
then we can write

<p>

<ol type="1"><p>
<li> r<tt>1:= r2[3]; { supported in standard Pascal }</tt></li>
<p>
<li> <tt>r1:= /2; { assign 0.5 to each element of r1 }</tt></li>
<p>
<li> <tt>r2:= r1*3; { assign 1.5 to every element of r2}</tt></li>
<p>
<li> <tt>r1:= + r2; { r1 gets the totals along the rows of r2}</tt></li>
<p>
<li> <tt>r1:= r1+r2[1];{ r1 gets the corresponding elements of row 1 of
r2 added to it}</tt></li>
</ol>
The assignment of arrays is a generalisation of what standard Pascal allows.
Consider the first examples above, they are equivalent to:

<p>

<ol type="1"><p>
<li> <tt>for i:=0 to 7 do r1[i]:=r2[3,i];</tt></li>
<p>
<li> <tt>for i:=0 to 7 do r1[i]:=/2;</tt></li>
<p>
<li> <tt>for i:=0 to 7 do 

<p>
for j:=0 to 7 do r2[i,j]:=r1[j]*3;</tt></li>
<p>
<li> <tt>for i:=0 to 7 do 

<p>
begin 

<p>
&nbsp;t:=0; 

<p>
&nbsp;for j:=7 downto 0 do t:=r2[i,j]+t;

<p>
&nbsp;r1[i]:=t; 

<p>
end;</tt></li>
<p>
<li> <tt>for i:=0 to 7 do r1[i]:=r1[i]+r2[1,i];</tt></li>
</ol>
In other words the compiler has to generate an implicit loop over
the elements of the array being assigned to and over the elements of the array
acting as the data-source. In the above <tt>i,j,t</tt> are assumed to be temporary
variables not referred to anywhere else in the program. The loop variables are
called implicit indices <a name="manimplicitindices">
</a>and
may be accessed using <tt>iota</tt>. 

<p>
The variable on the left hand side of an assignment defines an array
context within which expressions on the right hand side are evaluated. Each
array context has a rank given by the number of dimensions
of the array on the left hand side. A scalar variable has rank
0. Variables occurring in expressions with an array context of rank <em>r</em>
must have <em>r</em> or fewer dimensions. The <em>n</em> bounds of any <em>n</em>
dimensional array variable, with  n <font face="symbol">£</font
> r  occurring within an expression
evaluated in an array context of rank <em>r</em> must match with the rightmost
<em>n</em> bounds of the array on the left hand side of the assignment statement. 

<p>
Where a variable is of lower rank than its array context, the variable is replicated
to fill the array context. This is shown in examples 2
and 3 above. Because the rank of any assignment is constrained by the variable
on the left hand side, no temporary arrays, other than machine registers, need
be allocated to store the intermediate array results of expressions.

<p>
     <h3><a name="tth_sEc3.2.2">
3.2.2</a>&nbsp;&nbsp;Procedure statement</h3>

<p>
A procedure statement executes a named procedure. A procedure
statement may, in the case where the named procedure has formal parameters,
contain a list of actual parameters. These are substituted in place of the formal
parameters contained in the declaration. Parameters may be value parameters
or variable parameters. 

<p>
Semantically the effect of a value parameter is that a copy is taken of the
actual parameter and this copy substituted into the body of
the procedure. Value parameters may be structured values such as records and
arrays. For scalar values, expressions may be passed as actual parameters. Array
expressions are not currently allowed as actual parameters. 

<p>
A variable parameter is passed by reference, and any alteration of the formal
parameter induces a corresponding change in the actual parameter. Actual variable
parameters must be variables.

<p>
<center> 
<table border="1">
<tr><td align="center">&lt;parameter&#62;</td><td align="center">&lt;variable&#62;</td><td align="center">for formal parameters declared as var</td></tr>
<tr><td align="center"></td><td align="center">&lt;expression&#62;</td><td align="center">for other formal parameters </td></tr></table>

<p>
</center><center> 
<table border="1">
<tr><td align="center">&lt;procedure statement&#62;</td><td align="center">&lt;identifier&#62;</td></tr>
<tr><td align="center"></td><td align="center">&lt;identifier&#62; '(' &lt;parameter&#62; [','&lt;parameter&#62;]* ')'</td></tr></table>

<p>
</center>
<b>Examples&nbsp;&nbsp;</b>

<p>

<ol type="1"><p>
<li> <tt>printlist;</tt></li>
<p>
<li> <tt>compare(avec,bvec,result);</tt></li>
</ol>

<p>
     <h3><a name="tth_sEc3.2.3">
3.2.3</a>&nbsp;&nbsp;Goto statement</h3>

<p>
A goto statement transfers control to a labelled statement. The destination
label must be declared in a label declaration. It is illegal to
jump into or out of a procedure.

<p>

<b>Example&nbsp;&nbsp;</b>

<p>
<tt>goto 99;</tt>

<p>
     <h3><a name="tth_sEc3.2.4">
3.2.4</a>&nbsp;&nbsp;Exit Statement</h3>

<p>
An exit statement transfers control to the calling point of the current procedure
or function. If the exit statement is within a function then the exit statement
can have a parameter: an expression whose value is returned from the function.

<p>

<b>Examples&nbsp;&nbsp;</b>

<p>

<ol type="1"><p>
<li> <tt>exit;</tt></li>
<p>
<li> <tt>exit(5);</tt></li>
</ol>

<p>
     <h3><a name="tth_sEc3.2.5">
3.2.5</a>&nbsp;&nbsp;Compound statement</h3>

<p>
A list of statements separated by semicolons may be grouped into a compound
statement by bracketing them with <tt>begin</tt> and <tt>end</tt> .

<p>

<b>Example&nbsp;&nbsp;</b>

<p>
<tt>begin a:=x*3; b:=sqrt a end;</tt>

<p>
     <h3><a name="tth_sEc3.2.6">
3.2.6</a>&nbsp;&nbsp;If statement</h3>

<p>
The basic control flow construct is the if statement. If the boolean expression
between <tt>if</tt> and <tt>then</tt> is true then the
statement following <tt>then</tt> is followed. If it is false and an else part
is present, the statement following <tt>else</tt> is executed. 

<p>
     <h3><a name="tth_sEc3.2.7">
3.2.7</a>&nbsp;&nbsp;Case statement</h3>

<p>
The case statement specifies an expression which is evaluated and
which must be of integral or ordinal type. Dependent upon the value of the expression
control transfers to the statement labelled by the matching constant.

<p>
<center> 
<table border="1">
<tr><td align="center">&lt;case statement&#62;</td><td align="center">'case'&lt;expression&#62;'of'&lt;case actions&#62;'end'</td></tr></table>

<p>
</center><center> 
<table border="1">
<tr><td align="center">&lt;case actions&#62;</td><td align="center">&lt;case list&#62;</td></tr>
<tr><td align="center"></td><td align="center">&lt;case list&#62; 'else' &lt;statement&#62;</td></tr>
<tr><td align="center"></td><td align="center">&lt;case list&#62; 'otherwise' &lt;statement&#62;</td></tr></table>

<p>
</center><center> 
<table border="1">
<tr><td align="center">&lt;case list&#62;</td><td align="center">&lt;case list element&#62;[';'&lt;case list element.]*</td></tr></table>

<p>
</center><center> 
<table border="1">
<tr><td align="center">&lt;case list element&#62;</td><td align="center">&lt;case label&#62;[',' &lt;case label&#62;]':'&lt;statement&#62;</td></tr></table>

<p>
</center><center> 
<table border="1">
<tr><td align="center">&lt;case label&#62;</td><td align="center">&lt;constant&#62;</td></tr>
<tr><td align="center"></td><td align="center">&lt;constant&#62; '..' &lt;constant&#62;</td></tr></table>

<p>
</center>
<b>Examples&nbsp;&nbsp;</b>

<p>
 
<table>
<tr><td><tt>case</tt> i <tt>of</tt></td><td><tt>case</tt> c <tt>of</tt></td></tr>
<tr><td><tt>1:s:=abs s;</tt></td><td><tt>'a':write('A');</tt></td></tr>
<tr><td><tt>2:s:= sqrt s;</tt></td><td><tt>'b','B':write('B');</tt></td></tr>
<tr><td><tt>3: s:=0</tt></td><td><tt>'A','C'..'Z','c'..'z':write(' ');</tt></td></tr>
<tr><td><tt>end</tt></td><td><tt>end</tt></td></tr></table>

<p>
     <h3><a name="tth_sEc3.2.8">
3.2.8</a>&nbsp;&nbsp;With statement</h3>

<p>
Within the component statement of the with statement the fields
of the record variable can be referred to without prefixing them by the name
of the record variable. The effect is to import the component statement into
the scope defined by the record variable declaration so that
the field-names appear as simple variable names.

<p>

<b>Example&nbsp;&nbsp;</b>

<p>
<tt>var s:record x,y:real end;</tt>

<p>
<tt>begin</tt>

<p>
<tt>with s do begin x:=0;y:=1 end ;</tt>

<p>
<tt>end</tt>

<p>
     <h3><a name="tth_sEc3.2.9">
3.2.9</a>&nbsp;&nbsp;For statement</h3>

<p>
A for statement executes its component statement repeatedly under
the control of an iteration variable. The iteration variable
must be of an integral or ordinal type. The variable is either set to count
up through a range or down through a range.

<p>
<tt>for i:= e1 to e2 do s</tt>

<p>
is equivalent to

<p>
<tt>i:=e1; temp:=e2;while i&lt;=temp do s;</tt>

<p>
whilst

<p>
<tt>for i:= e1 downto e2 do s</tt>

<p>
is equivalent to

<p>
<tt>i:=e1; temp:=e2;while i&#62;= temp do s;</tt>

<p>
     <h3><a name="tth_sEc3.2.10">
3.2.10</a>&nbsp;&nbsp;While statement</h3>

<p>
A while statement executes its component statement whilst its
boolean expression is true. The statement

<p>
<tt>while e do s</tt>

<p>
is equivalent to

<p>
<tt>10: if not e then goto 99; s; goto 10; 99:</tt>

<p>
     <h3><a name="tth_sEc3.2.11">
3.2.11</a>&nbsp;&nbsp;Repeat statement</h3>

<p>
A repeat statement executes its component statement at least
once, and then continues to execute the component statement until its component
expression becomes true.

<p>
<tt>repeat s until e</tt>

<p>
is equivalent to

<p>
<tt>10: s;if e then goto 99; goto 10;99:</tt>

<p>
 <h2><a name="tth_sEc3.3">
3.3</a>&nbsp;&nbsp;Input Output </h2>

<p>
<center> 
<table border="1">
<tr><td align="center">&lt;io statement&#62;</td><td align="center">'writeln'[&lt;outparamlist&#62;]</td></tr>
<tr><td align="center"></td><td align="center">'write'&lt;outparamlist&#62;</td></tr>
<tr><td align="center"></td><td align="center">'readln'[&lt;inparamlist&#62;]</td></tr>
<tr><td align="center"></td><td align="center">'read'&lt;inparamlist&#62;</td></tr></table>

<p>
</center><center> 
<table border="1">
<tr><td align="center">&lt;outparamlist&#62;</td><td align="center">'('&lt;outparam&#62;[','&lt;outparam&#62;]*')'</td></tr></table>

<p>
</center><center> 
<table border="1">
<tr><td align="center">&lt;outparam&#62;</td><td align="center">&lt;expression&#62;[':' &lt;expression&#62;] [':'&lt;expression&#62;] </td></tr></table>

<p>
</center><center> 
<table border="1">
<tr><td align="center">&lt;inparamlist&#62;</td><td align="center">'('&lt;variable&#62;[','&lt;variable&#62;]*')'</td></tr></table>

<p>
</center>Input and output are supported from and to the console and also from and to
files. 

<p>
     <h3><a name="tth_sEc3.3.1">
3.3.1</a>&nbsp;&nbsp;Input</h3>

<p>
The basic form of input is the <tt>read</tt> statement. This takes a list of
parameters the first of which may optionally be a file variable. If this file
variable is present it is the input file. In the absence of a leading file variable
the input file is the standard input stream. The parameters take the form of
variables into which appropriate translations of textual representations of
values in the file are read. The statement 

<p>
<tt>read(</tt><em>a,b,c</em><tt>) </tt>

<p>
where <em>a,b,c</em> are non file parameters is exactly equivalent to the sequence
of statements 

<p>
<tt>read(</tt><em>a</em><tt>);read(</tt><em>b</em><tt>);read(</tt><em>c</em><tt>) </tt>

<p>
The <tt>readln</tt> statement has the same effect as the read
statement but finishes by reading a new line from the input file. The representation
of the new line is operating system dependent. The statement 

<p>
<tt>readln(</tt><em>a,b,c</em><tt>) </tt>

<p>
where <em>a,b,c</em> are non file parameters is thus exactly equivalent to the
sequence of statements 

<p>
<tt>read(</tt><em>a</em><tt>);read(</tt><em>b</em><tt>);read(</tt><em>c</em><tt>);readln; </tt>

<p>
Allowed typed for read statements are: integers, reals, strings and enumerated
types.

<p>
     <h3><a name="tth_sEc3.3.2">
3.3.2</a>&nbsp;&nbsp;Output </h3>

<p>
The basic form of output is the <tt>write</tt> statement. This
takes a list of parameters the first of which may optionally be a file variable.
If this file variable is present it is the output file. In the absence of a
leading file variable the output file is the console. The parameters take the
form of expressions whose values whose textual representations are written to
the output file. The statement 

<p>
<tt>write(</tt><em>a,b,c</em><tt>) </tt>

<p>
where <em>a,b,c</em> are non file parameters is exactly equivalent to the sequence
of statements 

<p>
<tt>write(</tt><em>a</em><tt>);write(</tt><em>b</em><tt>);write(</tt><em>c</em><tt>) </tt>

<p>
The <tt>writeln</tt> statement has the same effect as the write
statement but finishes by writing a new line to the output file. The representation
of the new line is operating system dependent. The statement 

<p>
<tt>writeln(</tt><em>a,b,c</em><tt>) </tt>

<p>
where <em>a,b,c</em> are non file parameters is thus exactly equivalent to the
sequence of statements 

<p>
<tt>write(</tt><em>a</em><tt>);write(</tt><em>b</em><tt>);write(</tt><em>c</em><tt>);writeln; </tt>

<p>
Allowed types for write statements are integers, reals, strings and enumerated
types.

<p>

<h4>Parameter formating </h4>

<p>
A non file parameter can be followed by up to two integer expressions prefixed
by colons which specify the field widths to be used in the output. The write
parameters can thus have the following forms: 

<p>
<em>e e</em>:<em>m e</em>:<em>m</em>:<em>n </em>

<p>

<ol type="1"><p>
<li> If <em>e</em> is an integral type its decimal expansion will be written preceeded
by sufficient blanks to ensure that the total textual field width produced is
not less than <em>m</em>.</li>
<p>
<li> If <em>e</em> is a real its decimal expansion will be written preceeded by sufficient
blanks to ensure that the total textual field width produced is not less than
<em>m</em>. If <em>n</em> is present the total number of digits after the decimal
point will be <em>n</em>. If <em>n</em> is omitted then the number will be written
out in exponent and mantissa form with 6 digits after the decimal point</li>
<p>
<li> If <em>e</em> is boolean the strings 'true' or 'false' will be written into a
field of width not less than m.</li>
<p>
<li> If <em>e</em> is a string then the string will be written into a field of width
not less than <em>m</em>.</li>
</ol>

<p>
 <h1><a name="tth_chAp4">
Chapter 4 </a><br />Programs and Units</h1>
<a name="progunit">
</a>
Vector Pascal supports the popular system of separate compilation units
found in Turbo Pascal. A compilation unit can be either
a program, a unit or a library.

<p>
<center> 
<table border="1">
<tr><td align="center">&lt;program&#62;</td><td align="center">'program' &lt;identifier&#62;';'[&lt;uses&#62;';']&lt;block&#62;'.'</td></tr></table>

<p>
</center><center> 
<table border="1">
<tr><td align="center">&lt;invocation&#62;</td><td align="center">&lt;identifier&#62;['(' &lt;type identifier&#62;[','&lt;type identifier&#62;]*')']</td></tr></table>

<p>
</center><center> 
<table border="1">
<tr><td align="center">&lt;uses&#62;</td><td align="center">'uses' &lt;invocation&#62;[','&lt;invocation&#62;]*</td></tr></table>

<p>
</center><center> 
<table border="1"><a name="block">
</a>
<tr><td align="center">&lt;block&#62;</td><td align="center">[&lt;decls&#62;';']*'begin' &lt;statement&#62;[';'&lt;statement&#62;]*'end'</td></tr></table>

<p>
</center><center> 
<table border="1">
<tr><td align="center">&lt;decls&#62;</td><td align="center">'const' &lt;constant declaration&#62;[';'&lt;constant declaration&#62;]*</td></tr>
<tr><td align="center"></td><td align="center">'type'&lt;type definition&#62;[';'&lt;type definition&#62;]*</td></tr>
<tr><td align="center"></td><td align="center">'label' &lt;label&#62;[',' &lt;label&#62;]</td></tr>
<tr><td align="center"></td><td align="center">&lt;procedure declaration&#62;</td></tr>
<tr><td align="center"></td><td align="center">'var' &lt;variable declaration&#62;[ ';' &lt;variable declaration&#62; ]</td></tr></table>

<p>
</center><center> 
<table border="1">
<tr><td align="center">&lt;unit&#62;</td><td align="center">&lt;unit header&#62; &lt;unit body&#62;</td></tr></table>

<p>
</center><center> 
<table border="1">
<tr><td align="center">&lt;unit body&#62;</td><td align="center">'interface'[&lt;uses&#62;][&lt;decls&#62;] 'implementation'&lt;block&#62;'.'</td></tr>
<tr><td align="center"></td><td align="center">'interface'[ &lt;uses&#62;][&lt;decls&#62;] 'in' &lt;invocation&#62; ';'</td></tr></table>

<p>
</center><center> 
<table border="1">
<tr><td align="center">&lt;unit header&#62;</td><td align="center">&lt;unit type&#62;&lt;identifier&#62;</td></tr>
<tr><td align="center"></td><td align="center">'unit' &lt;identifier&#62; '(' &lt;type identifier&#62; [',' &lt;type identifier&#62;]* ')'</td></tr></table>

<p>
</center><center> 
<table border="1">
<tr><td align="center">&lt;unit type&#62;</td><td align="center">'unit'</td></tr>
<tr><td align="center"></td><td align="center">'library'</td></tr></table>

<p>
</center>An executable compilation unit must be declared as a program.
The program can use several other compilation units all of which must be either
units or libraries. The units or libraries that it directly uses are specified
by a list of identifiers in an optional use list at the start of the program.
A unit or library has two declaration portions and an executable block.

<p>
 <h2><a name="tth_sEc4.1">
4.1</a>&nbsp;&nbsp;The export of identifiers from units</h2>

<p>
The first declaration portion is the interface part and is preceded by the reserved
word <tt>interface</tt>.

<p>
The definitions in the interface section of unit files constitute a sequence
of enclosing scopes, such that successive units in the with list ever more closely
contain the program itself. Thus when resolving an identifier, if the identifier
can not be resolved within the program scope, the declaration of the identifier
within the interface section of the rightmost unit in the uses list is taken
as the defining occurrence. It follows that rightmost occurrence of an identifier
definition within the interface parts of units on the uses list overrides all
occurrences in interface parts of units to its left in the uses list.

<p>
The implementation part of a unit consists of declarations,
preceded by the reserved word <tt>implementatio</tt>n
that are private to the unit with the exception that a function or procedure
declared in an interface context can omit the procedure body, provided that
the function or procedure is redeclared in the implementation part of the unit.
In that case the function or procedure heading given in the interface part is
taken to refer to the function or procedure of the same name whose body is declared
in the implementation part. The function or procedure headings sharing the same
name in the interface and implementation parts must correspond with respect
to parameter types, parameter order and, in the case of functions, with respect
to return types.

<p>
A unit may itself contain a use list, which is treated in the same way as the
use lists of a program. That is to say, the use list of a unit makes accessible
identifiers declared within the interface parts of the units named within the
use list to the unit itself.

<p>
     <h3><a name="tth_sEc4.1.1">
4.1.1</a>&nbsp;&nbsp;The export of procedures from libraries.</h3>

<p>
If a compilation unit is prefixed by the reserved word <tt>library</tt> rather
than the words <tt>program</tt> or <tt>unit</tt>, then the procedure and function
declarations in its interface part are made accessible to routines written in
other languages.

<p>
     <h3><a name="tth_sEc4.1.2">
4.1.2</a>&nbsp;&nbsp;The export of Operators from units</h3>

<p>
A unit can declare a type and export operators for that type.

<p>
 <h2><a name="tth_sEc4.2">
4.2</a>&nbsp;&nbsp;Unit parameterisation and generic functions</h2>
Standard Pascal provides es some limited support for polymorphism
in its <tt>read</tt> and <tt>write</tt> functions.
Vector Pascal allows the writing of polymorphic functions and
procedures through the use of parameteric units.

<p>
A unit header can include an optional parameter list. The parameters identifiers which are
interepreted as type names. These can be used to declare polymorphic procedures and
functions, parameterised by these type names.
This is shown in figure <a href="#unit:genericsort">4.1</a>.

<p>

<p>
<a name="tth_fIg4.1">
</a> ***&#175;***&#175;***&#175;***&#175;***&#175;***&#175;***&#175;***&#175;***&#175;***&#175;***&#175;***&#175;***&#175;
<br /><table align="left" border="0"><tr><td width="138">
<font size="-3"></font></td></tr></table><!--hbox-->
\'<br /><table align="left" border="0"><tr><td width="553">
<font face="helvetica"><b>unit</b>  <i>genericsort(t)</i>  ;</font></td></tr></table><!--hbox-->
<br /><br /><table align="left" border="0"><tr><td width="553">
<font face="helvetica"><b>interface</b> </font></td></tr></table><!--hbox-->
<br />\&lt;<br /><table align="left" border="0"><tr><td width="553">
<font face="helvetica"><b>type</b> </font></td></tr></table><!--hbox-->
<br /><br /><table align="left" border="0"><tr><td width="553">
<font face="helvetica"><i>dataarray</i> <i>(</i> <i>n</i> ,<i>m</i> :<i>integer</i> )=<b>array</b> [<i>n</i> ..<i>m</i> ] <b>of</b>  <i>t</i> ;</font></td></tr></table><!--hbox-->
<br />\&lt;<font face="helvetica"><b>procedure</b>  <i>sort</i> <i>(</i> <b>var</b>  <i>a</i> :<i>dataarray</i> );</font> (see Figure <a href="#sec:./genericsortsort">4.2</a> )<br />
<br />
\&lt;<br /><table align="left" border="0"><tr><td width="553">
<font face="helvetica"><b>implementation</b> </font></td></tr></table><!--hbox-->
<br /><br />\&lt;<font face="helvetica"><b>procedure</b>  <i>sort</i> <i>(</i> <b>var</b>  <i>a</i> :<i>dataarray</i> );</font> (see Figure <a href="#sec:./genericsortsort">4.2</a> )<br />
\&lt;<br /><table align="left" border="0"><tr><td width="553">
<font face="helvetica"><b>begin</b> </font></td></tr></table><!--hbox-->
<br />\&lt;<br /><table align="left" border="0"><tr><td width="553">
<font face="helvetica"><b>end</b> .</font></td></tr></table><!--hbox-->
<br />
<center>Figure 4.1: A polymorphic sorting unit.</center><a name="unit:genericsort">
</a>

<p>

<p>

<p>
<a name="tth_fIg4.2">
</a> ***&#175;***&#175;***&#175;***&#175;***&#175;***&#175;***&#175;***&#175;***&#175;***&#175;***&#175;***&#175;***&#175;
<br /><table align="left" border="0"><tr><td width="553">
<font face="helvetica"><b>procedure </b> <font face="helvetica"> <i>sort</i> <i>(</i> </font> <b> var </b> <font face="helvetica"> <i>a</i> :<i>dataarray</i> );</font></font></td></tr></table><!--hbox-->
<br /><br /><table align="left" border="0"><tr><td width="553">
<font face="helvetica"><b>var</b> </font></td></tr></table><!--hbox-->
<br /><br /><table align="left" border="0"><tr><td width="553">
<font face="helvetica">Let <i>i</i>, <i>j</i>  <font face="symbol">Î</font
>  integer;</font></td></tr></table><!--hbox-->
<br /><br /><table align="left" border="0"><tr><td width="553">
<font face="helvetica">Let <i>temp</i>  <font face="symbol">Î</font
>  t;</font></td></tr></table><!--hbox-->
<br />\&lt;<br /><table align="left" border="0"><tr><td width="553">
<font face="helvetica"><b>begin</b> </font></td></tr></table><!--hbox-->
<br /><br /><table align="left" border="0"><tr><td width="553">
<font face="helvetica"><b>for </b> <font face="helvetica"><i>i</i><font face="symbol">¬</font
> <i>a.n</i></font> <b> to </b> <font face="helvetica"><i>a.m</i> - 1</font> <b> do </b> </font></td></tr></table><!--hbox-->
<br /><br /><table align="left" border="0"><tr><td width="553">
<font face="helvetica"><b>for </b> <font face="helvetica"><i>j</i><font face="symbol">¬</font
> <i>a.n</i></font> <b> to </b> <font face="helvetica"><i>a.m</i> - 1</font> <b> do </b> </font></td></tr></table><!--hbox-->
<br />\&lt;<br /><table align="left" border="0"><tr><td width="553">
<font face="helvetica"><b>if </b> <font face="helvetica"><i>a</i><sub><i>j</i></sub>  &gt;  <i>a</i><sub><i>j</i> + 1</sub></font> <b> then </b> <font face="helvetica"><i>begin</i></font> <b> begin </b> </font></td></tr></table><!--hbox-->
<br /><br /><table align="left" border="0"><tr><td width="553">
<font face="helvetica"><i>temp</i><font face="symbol">¬</font
> <i>a</i><sub><i>j</i></sub></font>; </td></tr></table><!--hbox-->
<br /><br /><table align="left" border="0"><tr><td width="553">
<font face="helvetica"><i>a</i><sub><i>j</i></sub> <font face="symbol">¬</font
> <i>a</i><sub><i>j</i> + 1</sub></font>; </td></tr></table><!--hbox-->
<br /><br /><table align="left" border="0"><tr><td width="553">
<font face="helvetica"><i>a</i><sub><i>j</i> + 1</sub> <font face="symbol">¬</font
> <i>temp</i></font>; </td></tr></table><!--hbox-->
<br />\&lt;<br /><table align="left" border="0"><tr><td width="553">
<font face="helvetica"><b>end</b> ;</font></td></tr></table><!--hbox-->
<br />\&lt;\&lt;\&lt;<br /><table align="left" border="0"><tr><td width="553">
<font face="helvetica"><b>end</b> ;</font></td></tr></table><!--hbox-->
<br />
<center>Figure 4.2: procedure sort</center><a name="sec:./genericsortsort">
</a>

<p>

<p>
 <h2><a name="tth_sEc4.3">
4.3</a>&nbsp;&nbsp;The invocation of programs and units</h2>

<p>
Programs and units contain an executable block. The rules for
the execution of these are as follows:

<p>

<ol type="1"><p>
<li> When a program is invoked by the operating system, the units or libraries in
its use list are invoked first followed by the executable block of the program
itself.</li>
<p>
<li> When a unit or library is invoked, the units or libraries in its use list are
invoked first followed by the executable block of the unit or library itself.</li>
<p>
<li> The order of invocation of the units or libraries in a use list is left to right
with the exception provided by rule 4.</li>
<p>
<li> No unit or library may be invoked more than once.</li>
</ol>
Note that rule 4 implies that a unit <em>x</em> to the right of a unit <em>y</em>
within a use list, may be invoked before the unit <em>y,</em> if the unit <em>y</em>
or some other unit to <em>y</em>'s left names <em>x</em> in its use list.

<p>
Note that the executable part of a library will only be invoked if the library
in the context of a Vector Pascal program. If the library is linked to a main
program in some other language, then the library and any units that it uses
will not be invoked. Care should thus be taken to ensure that Vector Pascal
libraries to be called from main programs written in other languages do not
depend upon initialisation code contained within the executable blocks of units.

<p>
 <h2><a name="tth_sEc4.4">
4.4</a>&nbsp;&nbsp;The compilation of programs and units.</h2>

<p>
When the compiler processes the use list of a unit or a program
then, from left to right, for each identifier in the use list it attempts to
find an already compiled unit whose filename prefix is equal to the identifier.
If such a file exists, it then looks for a source file whose
filename prefix is equal to the identifier, and whose suffix
is <tt>.pas</tt>. If such a file exists and is older than the
already compiled file, the already compiled unit, the compiler loads the definitions
contained in the pre-compiled unit. If such a file exists and is newer than
the pre-compiled unit, then the compiler attempts to re-compile the unit source
file. If this recompilation proceeds without the detection of any errors the
compiler loads the definitions of the newly compiled unit. The definitions in
a unit are saved to a file with the suffix <tt>.mpu,</tt> and prefix given by
the unit name. The compiler also generates an assembler file for each unit compiled.

<p>
     <h3><a name="tth_sEc4.4.1">
4.4.1</a>&nbsp;&nbsp;Linking to external libraries</h3>

<p>
It is possible to specify to which external libraries - that is to say libraries
written in another languge, a program should be linked by placing in the main
program linkage directives. For example

<p>
<tt>{$linklib ncurses}</tt>

<p>
would cause the program to be linked to the ncurses library.

<p>
 <h2><a name="tth_sEc4.5">
4.5</a>&nbsp;&nbsp;Instantiation of parametric units</h2>
Instantiation of a parametric unit refers to the process by which the unbound type variables introduced
in the parameter list of the unit are bound to actual types.
In Vector Pascal all instantiation of parametric units and all type polymorphism are resolved
at compile time.
Two mechanisms are provided by which a parametric unit may be instantiated.

     <h3><a name="tth_sEc4.5.1">
4.5.1</a>&nbsp;&nbsp;Direct instantiation</h3>
If a generic unit is invoked in the use list of a program or unit, then the unit name
must be followed by a list of type identifiers. Thus given the generic sort unit
 in figure <a href="#unit:genericsort">4.1</a>, one could instantiate it to sort arrays of reals by
 writing

<p>
 <font face="helvetica"><b>uses </b> <i>genericsort</i>(<i>real</i>);</font>

<p>
 at the head of a program. Following this header, the
 procedure <font face="helvetica"><i>sort</i></font> would be declared as operating
 on arrays of reals.
 
     <h3><a name="tth_sEc4.5.2">
4.5.2</a>&nbsp;&nbsp;Indirect instantiation</h3>
 A named unit file can indirectly instantiate a generic unit where its unit body
 uses the syntax

<p>
'interface' &lt;uses&#62;&lt;decls&#62; 'in' &lt;invocation&#62; ';'

<p>
For example 

<p>
***&#175;***&#175;***&#175;***&#175;***&#175;***&#175;***&#175;***&#175;***&#175;***&#175;***&#175;***&#175;***&#175;
<br /><table align="left" border="0"><tr><td width="553">
<font face="helvetica"><b>unit</b>  <i>intsort</i> ;</font></td></tr></table><!--hbox-->
<br /><br /><table align="left" border="0"><tr><td width="553">
<font face="helvetica"><b>interface</b> </font></td></tr></table><!--hbox-->
<br /><br /><table align="left" border="0"><tr><td width="553">
<font face="helvetica"><b>in </b> <font face="helvetica"><i>genericsort</i> (<i>integer</i>)</font>; </font></td></tr></table><!--hbox-->
<br /><br />would create a named unit to sort integers. The naming of the parametric
units allows more than one instance of a given parametric unit to be used
in a program. The generic sort unit could be used to provide both integer and
real sorting procedures. The different variants of the procedures would be
distinquished by using fully qualified names - e.g., <font face="helvetica"><i> intsort.sort</i></font>.

 <h2><a name="tth_sEc4.6">
4.6</a>&nbsp;&nbsp;The System Unit</h2>
<a name="sysunit">
</a>
All programs and units include by default the unit system.pas as an implicit
member of their with list. This contains declarations of private run time routines
needed by Vector Pascal and also the following user accessible routines.

<p>

<dl compact="compact">

     
       
      
       <dt><b><tt>procedure</tt></b></dt>
	<dd><tt>append(var f:file);</tt> This opens a
file in append mode.</dd>
 <dt><b><tt>procedure</tt></b></dt>
	<dd><tt>assign(var f:file;var fname:string);</tt>
Associates a file name with a file. It does not open the file.</dd>
 <dt><b><tt>procedure</tt></b></dt>
	<dd><tt>blockread(var f:file;var buf;count:integer;
var resultcount:integer);</tt> Trys to read count bytes from the file into the buffer.
Resultcount contains the number actually read.</dd>
 <dt><b><tt>LatexCommand</tt></b></dt>
	<dd><tt>index{blockwrite}procedure
blockwrite(var f:file;var buf;count:integer; var resultcount:integer);</tt> Write
count bytes from the buffer. Resultcount gives the number actually read.</dd>
 <dt><b><tt>procedure</tt></b></dt>
	<dd><tt>close</tt>(var f:file); Closes a file.</dd>
 <dt><b><tt>function</tt></b></dt>
	<dd><tt>eof</tt>(var f:file):boolean; True if we
are at the end of file f.</dd>
 <dt><b><tt>procedure</tt></b></dt>
	<dd><tt>erase</tt>(var f:file); Delete file f.</dd>
 <dt><b><tt>function</tt></b></dt>
	<dd><tt>eoln</tt>(var f:file):boolean; True if at
the end of a line.</dd>
 <dt><b><tt>function</tt></b></dt>
	<dd><tt>exp</tt>(d:real):real; Return  e<sup>x</sup> </dd>
 <dt><b><tt>function</tt></b></dt>
	<dd><tt>filesize</tt>(var f: fileptr):integer;
Return number of bytes in a file.</dd>
 <dt><b><tt>function</tt></b></dt>
	<dd><tt>filepos</tt>(var f:fileptr):integer;
Return current position in a file.</dd>
 <dt><b><tt>procedure</tt></b></dt>
	<dd><tt>freemem(var p:pointer; num:integer);</tt>
Free num bytes of heap store. Called by dispose.</dd>
 <dt><b>bold</b></dt>
	<dd>procedure getmem(var p:pointer; num:integer); Allocate
num bytes of heap. Called by new.</dd>
 <dt><b><tt>procedure</tt></b></dt>
	<dd><tt>gettime(var hour,min,sec,hundredth:integer);</tt>
Return time of day.</dd>
 <dt><b><tt></tt></b></dt>
	<dd>Return the integer part of r as a real.</dd>
 <dt><b><tt>function</tt></b></dt>
	<dd><tt>ioresult:integer;</tt> Returns a code indicating if the
previous file operation completed ok. Zero if no error occurred.</dd>
 <dt><b><tt>function</tt></b></dt>
	<dd><tt>length(var s:string):integer;</tt> Returns
the length of s.</dd>
 <dt><b><tt>procedure</tt></b></dt>
	<dd><tt>pascalexit(code:integer);</tt> Terminate
the program with code.</dd>
 <dt><b><tt></tt></b></dt>
	<dd>Time in 1/100 seconds since program started.</dd>
 <dt><b><tt>function</tt></b></dt>
	<dd><tt>random:integer;</tt> Returns a random
integer.</dd>
 <dt><b><tt>procedure</tt></b></dt>
	<dd><tt>randomize;</tt> Assign a new time
dependent seed to the random number generator.</dd>
 <dt><b><tt>procedure</tt></b></dt>
	<dd><tt>reset(var f:file);</tt> Open a file for
reading.</dd>
 <dt><b><tt>procedure</tt></b></dt>
	<dd><tt>rewrite(var f :file);</tt> Open a file
for writing.</dd>
 <dt><b><tt>function</tt></b></dt>
	<dd><tt>trunc(r:real):integer;</tt> Truncates a real to an integer.
</dd>
</dl>

<p>
 <h1><a name="tth_chAp5">
Chapter 5 </a><br />Implementation issues</h1>

<p>
The compiler is implemented in java to ease portability between operating systems.

<p>
 <h2><a name="tth_sEc5.1">
5.1</a>&nbsp;&nbsp;Invoking the compiler</h2>

<p>
The compiler is invoked with the command <a name="commandline">
</a>

<p>

<dl compact="compact">
 <dt><b></b></dt>
	<dd>
vpc&nbsp;filename
</dd>
</dl>
where filename is the name of a Pascal program or unit. For example

<p>

<dl compact="compact">
 <dt><b></b></dt>
	<dd>
vpc&nbsp;test
</dd>
</dl>
will compile the program test.pas and generate an executable file <tt>test</tt>,
(<tt>test.exe</tt> under windows). 

<p>
The command <tt>vpc</tt> is a shell script which invokes the java runtime system
to execute a <tt>.jar</tt> file containing the compiler classes. Instead of
running vpc the java interpreter can be directly invoked as follows

<p>

<dl compact="compact">
 <dt><b></b></dt>
	<dd>
java&nbsp;-jar&nbsp;mmpc.jar&nbsp;filename
</dd>
</dl>
The <tt>vpc</tt> script sets various compiler options appropriate to the operating
system being used.

<p>
     <h3><a name="tth_sEc5.1.1">
5.1.1</a>&nbsp;&nbsp;Environment variable</h3>

<p>
The environment variable <tt>mmpcdir</tt> must be set to the
directory which contains the <tt>mmpc.jar</tt> file, the runtime
library <tt>rtl.o</tt> and the <tt>system.pas</tt> file.

<p>
     <h3><a name="tth_sEc5.1.2">
5.1.2</a>&nbsp;&nbsp;Compiler options</h3>
<a name="comp:opt">
</a>
The following flags can be supplied to the compiler :

<p>

<dl compact="compact">

     
       
      
       <dt><b><tt>-L</tt></b></dt>
	<dd> Causes a latex listing to be produced of
all files compiled. The level of detail can be controled
using the codes -L1 to -L3, otherwise the maximum detail level is used.</dd>
 <dt><b><tt>-OPTn</tt></b></dt>
	<dd> Sets the optimisation level attempted.
-OPT0 is no optimisation, -OPT3 is the maximum level attempted. 
The default is -OPT1.</dd>
 <dt><b><tt>-Afilename</tt></b></dt>
	<dd>Defines the assembler file to be created.
In the absence of this option the assembler file is <tt>p.asm.</tt></dd>
 <dt><b><tt>-Ddirname</tt></b></dt>
	<dd>Defines the directory in which to find
<tt>rtl.o</tt> and <tt>system.pas</tt>.</dd>
 <dt><b><tt>-BOEHM</tt></b></dt>
	<dd>
Causes the program to be linked with the Boehm conservative garbage
collector.</dd>
 <dt><b><tt>-V</tt></b></dt>
	<dd>Causes the code generator to produce a verbose diagnostic
listing to <tt>foo.lst</tt> when compiling <tt>foo.pas</tt>.</dd>
 <dt><b><tt>-oexefile</tt></b></dt>
	<dd>Causes the linker to output to <tt>exefile</tt>
instead of the default output of <tt>p.exe.</tt></dd>
 <dt><b><tt>-U</tt></b></dt>
	<dd>Defines whether references to external procedures in
the assembler file should be preceded by an under-bar '_'. This is required
for the coff object format but not for elf.</dd>
 <dt><b><tt>-S</tt></b></dt>
	<dd>Suppresses assembly and linking of the program. An assembler
file is still generated.</dd>
 <dt><b><tt>-fFORMAT</tt></b></dt>
	<dd>Specifies the object format to be generated
by the assembler. The object formats currently used are elf when compiling under
Unix or when compiling under windows using the cygwin version of the gcc linker,
or coff when using the djgpp version of the gcc linker. for other formats consult
the NASM documentation.</dd>
 <dt><b><tt>-cpuCGFLAG</tt></b></dt>
	<dd>Specifies the code generator to be used.
Currently the code generators shown in table <a href="#cgs">5.1</a> are supported.</dd>
 <dt><b></b></dt>
	<dd>
<p>
<a name="tth_tAb5.1">
</a> <center>Table 5.1: Code generators supported<a name="cgs">
</a></center>
<center> 
<table border="1">
<tr><td align="center"><tt>CGFLAG</tt></td><td><tt>description</tt></td></tr><tr><td>
<tr><td align="center"><tt>IA32</tt></td><td>generates code for the Intel 486 instruction-set</td></tr>
<tr><td align="center"></td><td>uses the NASM assembler</td></tr>
<tr><td align="center"><tt>Pentium</tt></td><td>generates code for the Intel P6 with MMX instruction-set</td></tr>
<tr><td align="center"></td><td>uses the NASM  assembler</td></tr><tr><td>
<tr><td align="center"><tt>gnuPentium</tt></td><td>generates code for the Intel P6 with MMX instruction-set</td></tr>
<tr><td align="center"></td><td>using the <tt>as</tt>  assembler in the gcc package</td></tr>
<tr><td align="center"><tt>K6</tt></td><td>generates code for the AMD K6 instruction-set, use for Athlon</td></tr>
<tr><td align="center"></td><td>uses the NASM assembler</td></tr>
<tr><td align="center"><tt>P3</tt></td><td>generates code for the Intel PIII processor family<tt></tt></td></tr>
<tr><td align="center"></td><td>uses the NASM assembler</td></tr>
<tr><td align="center"><tt>P4</tt> </td><td>generates code for the Intel PIV family and Athlon XP</td></tr>
<tr><td align="center"></td><td>uses the NASM assembler</td></tr></table>

<p>
</center>
<p>
</dd>
</dl>     <h3><a name="tth_sEc5.1.3">
5.1.3</a>&nbsp;&nbsp;Dependencies</h3>

<p>
The Vector Pascal compiler depends upon a number of other utilities which are
usually pre-installed on Linux systems, and are freely available for Windows
systems.

<p>

<dl compact="compact">

     
       
      
       <dt><b>NASM</b></dt>
	<dd>The net-wide assembler. This is used to convert the output of the code
generator to linkable modules. It is freely available on the web for Windows.
For the Pentium processor it is possible to use the <tt>as</tt> assembler instead.</dd>
 <dt><b>gcc</b></dt>
	<dd>The GNU C Compiler, used to compile the run time library and to link modules
produced by the assembler to the run time library.</dd>
 <dt><b>java</b></dt>
	<dd>The java virtual machine must be available to interpret the compiler.
There are number of java interpreters and just in time compilers are freely available
for Windows.
</dd>
</dl>

<p>
 <h2><a name="tth_sEc5.2">
5.2</a>&nbsp;&nbsp;Calling conventions</h2>

<p>
Procedure parameters are passed using a modified C calling convention to facilitate
calls to external C procedures. Parameters are pushed on to the stack from right
to left. Value parameters are pushed entire onto the stack, var parameters are
pushed as addresses.

<p>

<b>Example &nbsp;&nbsp;</b>

<p>

<dl compact="compact">
 <dt><b></b></dt>
	<dd>
<span class="roman"><tt><font size="-1">unit&nbsp;callconv;</font></tt></span><font size="-1">
<p>
</font><span class="roman"><tt><font size="-1">interface</font></tt></span><font size="-1">
<p>
</font><span class="roman"><tt><font size="-1">type&nbsp;intarr=&nbsp;array[1..8]&nbsp;of&nbsp;integer;</font></tt></span><font size="-1">
<p>
</font><span class="roman"><tt><font size="-1">procedure&nbsp;foo(var&nbsp;a:intarr;&nbsp;b:intarr;&nbsp;c:integer);</font></tt></span><font size="-1">
<p>
</font><span class="roman"><tt><font size="-1">implementation</font></tt></span><font size="-1">
<p>
</font><span class="roman"><tt><font size="-1">procedure&nbsp;foo(var&nbsp;a:intarr;&nbsp;b:intarr;&nbsp;c:integer);</font></tt></span><font size="-1">
<p>
</font><span class="roman"><tt><font size="-1">begin</font></tt></span><font size="-1">
<p>
</font><span class="roman"><tt><font size="-1">end;</font></tt></span><font size="-1">
<p>
</font><span class="roman"><tt><font size="-1">var&nbsp;x,y:intarr;</font></tt></span><font size="-1">
<p>
</font><span class="roman"><tt><font size="-1">begin</font></tt></span><font size="-1">
<p>
</font>&nbsp;<span class="roman"><tt><font size="-1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foo(x,y,3);</font></tt></span><font size="-1">
<p>
</font><span class="roman"><tt><font size="-1">end.</font></tt></span><font size="-1">
<p>
</font></dd>
</dl>This would generate the following code for the procedure foo.

<p>

<dl compact="compact">
 <dt><b></b></dt>
	<dd>
<tt><font size="-2">;&nbsp;procedure&nbsp;generated&nbsp;by&nbsp;code&nbsp;generator&nbsp;class&nbsp;ilcg.tree.PentiumCG</font></tt><font size="-2">
<p>
</font><tt><font size="-2">le8e68de10c5:</font></tt><font size="-2">
<p>
</font><tt><font size="-2">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foo</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">enter&nbsp;&nbsp;&nbsp;spaceforfoo-4*1,1</font></tt><font size="-2">
<p>
</font><tt><font size="-2">;8</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">le8e68de118a:</font></tt><font size="-2">
<p>
</font><tt><font size="-2">spaceforfoo&nbsp;equ&nbsp;4</font></tt><font size="-2">
<p>
</font><tt><font size="-2">;....&nbsp;code&nbsp;for&nbsp;foo&nbsp;goes&nbsp;here</font></tt><font size="-2">
<p>
</font><tt><font size="-2">fooexit:</font></tt><font size="-2">
<p>
</font><tt><font size="-2">leave</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">ret&nbsp;0</font></tt><font size="-2">
<p>
</font></dd>
</dl>and the calling code is

<p>

<dl compact="compact">
 <dt><b></b></dt>
	<dd>
&nbsp;<tt><font size="-2">push&nbsp;DWORD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;push&nbsp;rightmost&nbsp;argument</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">lea&nbsp;esp,[&nbsp;&nbsp;esp-32]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;create&nbsp;space&nbsp;for&nbsp;the&nbsp;array</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">mov&nbsp;DWORD&nbsp;&nbsp;[&nbsp;&nbsp;ebp&nbsp;-52],0&nbsp;&nbsp;;&nbsp;for&nbsp;loop&nbsp;to&nbsp;copy&nbsp;the&nbsp;array</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">le8e68de87fd:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;the&nbsp;loop&nbsp;is&nbsp;</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;unrolled&nbsp;twice&nbsp;and</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">cmp&nbsp;DWORD&nbsp;&nbsp;[&nbsp;&nbsp;ebp-52],&nbsp;7&nbsp;&nbsp;;&nbsp;parallelised&nbsp;to&nbsp;copy&nbsp;</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;16&nbsp;bytes&nbsp;per&nbsp;cycle</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">jg&nbsp;near&nbsp;&nbsp;le8e68de87fe</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">mov&nbsp;ebx,DWORD&nbsp;&nbsp;[&nbsp;&nbsp;ebp&nbsp;&nbsp;-52]</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">imul&nbsp;&nbsp;&nbsp;ebx,&nbsp;&nbsp;&nbsp;&nbsp;4</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">movq&nbsp;MM1,&nbsp;[&nbsp;&nbsp;ebx+&nbsp;le8e68dddaa2-48]</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">movq&nbsp;&nbsp;[&nbsp;&nbsp;esp+ebx],MM1</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">mov&nbsp;eax,DWORD&nbsp;&nbsp;[&nbsp;&nbsp;ebp+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-52]</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">lea&nbsp;ebx,[&nbsp;&nbsp;eax+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2]</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">imul&nbsp;&nbsp;&nbsp;ebx,&nbsp;&nbsp;&nbsp;&nbsp;4</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">movq&nbsp;MM1,&nbsp;[&nbsp;&nbsp;ebx+&nbsp;le8e68dddaa2&nbsp;-48]</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">movq&nbsp;&nbsp;[&nbsp;&nbsp;esp+ebx],MM1</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">lea&nbsp;ebx,[&nbsp;&nbsp;ebp+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-52]</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">add&nbsp;&nbsp;DWORD&nbsp;&nbsp;[&nbsp;ebx],&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">jmp&nbsp;&nbsp;le8e68de87fd</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">le8e68de87fe:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;end&nbsp;of&nbsp;array&nbsp;</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;copying&nbsp;loop</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">push&nbsp;DWORD&nbsp;&nbsp;le8e68dddaa2-32&nbsp;;&nbsp;push&nbsp;the&nbsp;address&nbsp;of&nbsp;the&nbsp;</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;var&nbsp;parameter</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">EMMS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;clear&nbsp;MMX&nbsp;state</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">&nbsp;call&nbsp;le8e68de10c5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;call&nbsp;the&nbsp;local&nbsp;</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;label&nbsp;for&nbsp;foo</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">add&nbsp;esp,&nbsp;40&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;free&nbsp;space&nbsp;on&nbsp;the&nbsp;stack</font></tt><font size="-2">
<p>
</font></dd>
</dl>
<h4>Function results</h4>

<p>
Function results are returned in registers for scalars following the C calling
convention for the operating system on which the compiler is implemented. Records,
strings and sets are returned by the caller passing an implicit parameter containing
the address of a temporary buffer in the calling environment into which the
result can be assigned. Given the following program

<p>
<tt>program</tt>

<p>
<tt>type t1= set of char;</tt>

<p>
<tt>var x,y:t1;</tt>

<p>
<tt>function bar:t1;begin bar:=y;end;</tt>

<p>
<tt>&nbsp;</tt>

<p>
<tt>begin</tt>

<p>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x:=bar;</tt>

<p>
<tt>end.</tt>

<p>
The call of bar would generate

<p>

<dl compact="compact">
 <dt><b></b></dt>
	<dd>
&nbsp;<font size="-2"></font><tt><font size="-2">push&nbsp;ebp</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">add&nbsp;&nbsp;dword[esp]&nbsp;,&nbsp;-128&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;address&nbsp;of&nbsp;buffer&nbsp;on&nbsp;stack</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">call&nbsp;le8eb6156ca8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;call&nbsp;bar&nbsp;to&nbsp;place&nbsp;</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;result&nbsp;in&nbsp;buffer</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">add&nbsp;esp,&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;discard&nbsp;the&nbsp;address</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">mov&nbsp;DWORD&nbsp;&nbsp;[&nbsp;&nbsp;ebp+&nbsp;-132],&nbsp;0;&nbsp;for&nbsp;loop&nbsp;to&nbsp;copy&nbsp;</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;the&nbsp;set&nbsp;16&nbsp;bytes</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">le8eb615d99f:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;at&nbsp;a&nbsp;time&nbsp;into&nbsp;x&nbsp;using&nbsp;the&nbsp;</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;MMX&nbsp;registers</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">cmp&nbsp;DWORD&nbsp;&nbsp;[&nbsp;&nbsp;ebp+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-132],&nbsp;&nbsp;31</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">jg&nbsp;near&nbsp;&nbsp;le8eb615d9910</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">mov&nbsp;ebx,DWORD&nbsp;&nbsp;[&nbsp;&nbsp;ebp+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-132]</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">movq&nbsp;MM1,&nbsp;[&nbsp;&nbsp;ebx+ebp&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-128]</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">movq&nbsp;&nbsp;[&nbsp;&nbsp;ebx+ebp&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-64],MM1</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">mov&nbsp;eax,DWORD&nbsp;&nbsp;[&nbsp;&nbsp;ebp+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-132]</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">lea&nbsp;ebx,[&nbsp;&nbsp;eax+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8]</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">movq&nbsp;MM1,&nbsp;[&nbsp;&nbsp;ebx+ebp&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-128]</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">movq&nbsp;&nbsp;[&nbsp;&nbsp;ebx+ebp&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-64],MM1</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">lea&nbsp;ebx,[&nbsp;&nbsp;ebp+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-132]</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">add&nbsp;&nbsp;DWORD&nbsp;&nbsp;[&nbsp;ebx],&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;16</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">jmp&nbsp;&nbsp;le8eb615d99f</font></tt><font size="-2">
<p>
</font>&nbsp;<tt><font size="-2">le8eb615d9910:</font></tt><font size="-2">
<p>
</font></dd>
</dl> <h2><a name="tth_sEc5.3">
5.3</a>&nbsp;&nbsp;Array representation</h2>

<p>
The maximum number of array dimensions supported in the compiler is 5.

<p>
A static array is represented simply by
the number of bytes required to store the array being allocated in the global
segment or on the stack.

<p>
A dynamic array is always represented on
the heap. Since its rank is known to the compiler
what needs to be stored at run time are the bounds and the means to access it.
For simplicity we make the format of dynamic and conformant arrays the same.
Thus for schema  

<p>
<tt>s(a,b,c,d:integer)= array[a..b,c..d] of integer </tt>

<p>
whose run time bounds are evaluated to be 2..4,3..7 we would have the following
structure:

<p>
<center> 
<table border="1">
<tr><td align="center">address</td><td align="center">field</td><td align="center">value</td></tr><tr><td>
<tr><td align="center">x</td><td align="center">base of data</td><td align="center">address of first integer in the array</td></tr>
<tr><td align="center">x+4</td><td align="center">a</td><td align="center">2</td></tr>
<tr><td align="center">x+8</td><td align="center">b</td><td align="center">4</td></tr>
<tr><td align="center">x+12</td><td align="center">step</td><td align="center">20</td></tr>
<tr><td align="center">x+16</td><td align="center">c</td><td align="center">3</td></tr>
<tr><td align="center">x+20</td><td align="center">d</td><td align="center">7</td></tr></table>

<p>
</center>The base address for a schematic array on the heap, will point at the first
byte after the array header show. For a conformant array, it will point at the
first data byte of the array or array range being passed as a
parameter. The step field specifies the length of an element of the second dimension
in bytes. It is included to allow for the case where we have a conformant
array formal parameter 

<p>
<tt>x:array[a..b:integer,c..d:integer] of integer</tt>

<p>
to which we pass as actual parameter the range 

<p>
<tt>p[2..4,3..7] </tt>

<p>
as actual parameter, where <tt>p:array[1..10,1..10] of integer</tt>

<p>
In this case the base address would point at @p[2,3] and the step would
be 40 - the length of 10 integers.

<p>
     <h3><a name="tth_sEc5.3.1">
5.3.1</a>&nbsp;&nbsp;Range checking</h3>

<p>
When arrays are indexed, the compiler plants run time checks to see if the indices
are within bounds. In many cases the optimiser is able to remove
these checks, but in those cases where it is unable to do so, some performance
degradation can occur. Range checks can be disabled or enabled by the compiler
directives.

<p>
{$r-} { disable range checks }

<p>
{$r+} { enable range checks }

<p>
Performance can be further enhanced by the practice of declaring arrays to have
lower bounds of zero. The optimiser is generally able to generate more efficient
code for zero based arrays.

<p>
 <h1><a name="tth_chAp6">
Chapter 6 </a><br />Compiler porting tools</h1>
<a name="ilcg">
</a>
<a name="porting">
</a>
Vector Pascal is an open-source project. It aims to create
a productive an efficient program development environment for
SIMD programming. In order to validate the concepts it has
been developed initially for the Intel family of processors
running Linux and Microsoft Windows. However it has been intended
from the outset that the technology should be portable to other
families of CPUs. This chapter addresses some of the issues
involved in porting the compiler to new systems.

<p>
 <h2><a name="tth_sEc6.1">
6.1</a>&nbsp;&nbsp;Dependencies</h2>

<p>
The Vector Pascal compiler tool-set can be divided along two axes
as shown in figure <a href="#toolset">6.1</a>. 
<ol type="1"><p>
<li> Tools can be divided into (a) those provided as part of the release , versus (b) tools provided
      as part of the operating environment.
     
<ol type="a"><p>
<li> These are mainly written in Java, the exceptions being a  small run-time
              library in C, a Pascal System unit, and several machine descriptions.</li>
<p>
<li> These are all available as standard under Linux, and Windows versions
              are freely downloadable from the web.</li>
</ol></li>
<p>
<li> Tools can further divided into (a) those required for program preparation
and documentation, (b) code translation tools, and (c) code generator preparation tools.
     
<ol type="a"><p>
<li> The program preparation tools are the VIPER IDE described in Chapter <a href="#vipintro">8</a>,
       along with the standard <span class="roman">L</span><sup><span class="roman">A</span></sup><span class="roman">T</span><sub><span class="roman">E</span></sub><span class="roman">X</span>document prepartion system, DVI viewers, and the
       TTH tool to prepare web enabled versions of Vector Pascal program descriptions.</li>
<p>
<li> The program translation tools are:
            
<ol type="i"><p>
<li> The <tt>ilcg.pascal</tt> Java package which
             contains the Pascal compiler itself and classes to support Pascal type
             declarations. This carries out the first stage of code translation, from
             Pascal to an ILCG tree[<a href="#Cockshott00" name="CITECockshott00">10</a>].</li>
<p>
<li> A set of machine generated code generators for CPUs such as the Pentium,
              the K6 etc. These carry out the second phase of code translation - into
              an assembler file.</li>
<p>
<li> The <tt>ilcg.tree</tt> Java package which supports the internal representation
                   of ILCG trees (see section <a href="#ilcgintro">6.3</a>).</li>
<p>
<li> The Java system which is need to run all of the above.</li>
<p>
<li> An assembler, which is necessary to carry out the third phase
                   of code translation, from an assembler file to a relocatable
                   object file.</li>
<p>
<li> A C compiler and linkage system is needed to compile the C run-time
                   library and to link the relocatable object files into final executables.</li>
<p>
<li> In addition if one wants to alter the reserved words of Vector Pascal
                   or make other lexical changes one needs the JLex lexical analyser
                   generator.</li>
</ol></li>
</ol></li>
</ol>

<p>

<p>
<a name="tth_fIg6.1">
</a> <a href="toolset.eps">Figure</a>

<center>Figure 6.1: Vector Pascal toolset</center><a name="toolset">
</a>

<p>
 <h2><a name="tth_sEc6.2">
6.2</a>&nbsp;&nbsp;Compiler Structure</h2>

<p>

<p>
<a name="tth_fIg6.2">
</a> <table border="0"><tr><td></td><td><table border="0"><tr><td><a href="system.eps">Figure</a>
</td></tr></table><!--vbox-->
</td><td>

<center>Figure 6.2: The translation of Vector Pascal to assembler.</center><a name="system">
</a>
</td></tr></table><!--hboxt-->
<p>
The structure of the  Vector Pascal translation
 system is shown in figure .
The main program class of the compiler <tt>ilcg.Pascal.PascalCompiler.java</tt> translates
the source code of the program into an internal structure called an ILCG tree
[<a href="#Cockshott00" name="CITECockshott00">10</a>]. A machine generated code generator then translates this
into assembler code. An example would be the class ilcg.tree.IA32. An assembler
and linker specified in descendent class of the code generator then translate
the assembler code into an executable file.

<p>
 Consider first the path followed from a source file, the phases that it goes through are

<ul>
<br />i.  The source file (1) is parsed by a java class PascalCompiler.class (2) a   
hand written, recursive descent parser[], and results
in a Java data structure (3), an ILCG tree, which is basically a semantic
tree for the program. 
<br />ii.  The resulting tree is transformed (4) from sequential to parallel form
and  machine independent optimisations are performed.
Since ILCG trees
 are java objects, they can contain methods to self-optimise. Each class
contains for instance a method <tt>eval</tt> which attempts to evaluate a tree at
compile time. Another method <tt>simplify</tt> applies generic machine
independent transpormations to the code. Thus the <tt>simplify</tt>
method of the class <tt>For</tt> can perform loop unrolling,
removal of redundant loops etc. Other methods allow tree walkers
to apply context specific transformations.
<br />iii.  The resulting ilcg tree (7) is walked over by a class that encapsulates
the semantics of the target machine's instructionset (10); for example Pentium.class.
During code generation the tree is futher transformed, as machine
specific register optimisations are performed. 
The output of this process is an assembler file (11).
<br />iv.  This is then fed through an appropriate assembler and linker, assumed
to be externally provided to generate an executable program.</ul>

<p>
     <h3><a name="tth_sEc6.2.1">
6.2.1</a>&nbsp;&nbsp;Vectorisation</h3>

<p>
The parser initially generates serial code for all constructs.
It then interogates the current code generator class to determine
the degree of parallelism possible for the types of operations performed
in a loop, and if these are greater than one, it vectorises the code.

<p>
Given the declaration 

<p>
<b>var v1,v2,v3:array[1..9] of integer;</b>

<p>
then the statement

<p>
<b>v1:=v2+v3;</b>

<p>
would first be translated to the ILCG sequence shown in figure <a href="#seqf">6.3</a>

<p>
<a name="tth_fIg6.3">
</a> 
<pre>
{ var  i;
  for  i=1 to 9 step 1 do {
   v1[^i]:= +(^(v2[^i]),^(v3[^i]));
  };
}

</pre>

<center>Figure 6.3: Sequential form of array assignment</center><a name="seqf">
</a>

<p>
In the example above variable names such as <tt>v1</tt> and <tt>i</tt> have been used
for clarity. In reality <tt>i</tt> would be an addressing expression like:

<p>
<tt> (ref int32)mem(+(^((ref int32)ebp),     -1860))</tt>,

<p>
which encodes both the type and the address of the variable.
The code generator is queried as to the parallelism available on
the type <tt>int32</tt> and, since it is a Pentium with MMX, returns
2.
The loop is then split into two, a portion that can be executed in
parallel and a residual sequential component, resulting in the 
ILCG shown in figure <a href="#parf">6.4</a>.
<p>
<a name="tth_fIg6.4">
</a> 
<pre>
{ var i;  
   for i=    1 to     8 step     2 do {
    (ref int32 vector ( 2 ))mem(+(@v1,*(-(^i,1),4))):=
       +(^((ref int32 vector ( 2 ))mem(+(@v2,*(-(^i,1),4)))), 
         ^((ref int32 vector ( 2 ))mem(+(@v3,*(-(^i,1),4)))));
   };
   for i=    9 to     9 step     1 do {
      v1[^i]:= +(^(v2[^i]),^(v3[^i]));
   };
}

</pre>

<center>Figure 6.4: Parallelised loop</center><a name="parf">
</a>

<p>
In the parallel part of the code, the array subscriptions have been replaced
by explictly cast memory addresses. This coerces the locations from their
original types to the type required by the vectorisation.
Applying the <tt>simplify </tt> method of the For class  the
following generic transformations are performed:

<ol type="1"><p>
<li> The second loop is replaced by a single statement.</li>
<p>
<li> The parallel loop is unrolled twofold.</li>
<p>
<li> The For class is replaced by a sequence of statements with
explicit gotos.</li>
</ol>
The result is shown in figure <a href="#simpf">6.5</a>.
When the <tt>eval</tt> method is invoked, 
constant folding causes the loop test condition
to be evaluated  to

<p>
<tt>if &gt;(^i,8) then	goto leb4af11b47f</tt>.

<p>
<a name="tth_fIg6.5">
</a> 
<pre>
{ var i:
  i:= 1;
  leb4af11b47e:
  if &#62;( 2, 0) then	if &#62;(^i,8) then	goto leb4af11b47f
	                else null
                        fi
         else if &lt;(^i, 8) then	goto leb4af11b47f
         else null
         fi
  fi;
 (ref int32 vector ( 2 ))mem(+(@v1,*(-(^i,1),4))):=
       +(^((ref int32 vector ( 2 ))mem(+(@v2,*(-(^i,1),4)))), 
         ^((ref int32 vector ( 2 ))mem(+(@v3,*(-(^i,1),4)))));
  i:=+(^i,2);
 (ref int32 vector ( 2 ))mem(+(@v1,*(-(^i,1),4))):=
       +(^((ref int32 vector ( 2 ))mem(+(@v2,*(-(^i,1),4)))), 
         ^((ref int32 vector ( 2 ))mem(+(@v3,*(-(^i,1),4)))));
  i:=+(^i,2);
  goto leb4af11b47e;
  leb4af11b47f:
  i:=    9;
  v1[^i]:= +(^(v2[^i]),^(v3[^i]));
}

</pre>

<center>Figure 6.5: After applying <tt>simplify</tt> to the tree</center>
<a name="simpf">
</a> 

<p>

<p>
<a name="tth_fIg6.6">
</a> 
<pre>
 mov DWORD ecx,     1
leb4b08729615: 
 cmp DWORD ecx,      8
 jg near  leb4b08729616
 lea edi,[  ecx-(     1)]; substituting in edi with 3 occurences  
 movq MM1, [  ebp+edi* 4+     -1620]
 paddd MM1, [  ebp+edi* 4+     -1640]
 movq  [  ebp+edi* 4+     -1600],MM1
 lea ecx,[  ecx+     2]
 lea edi,[  ecx-(     1)]; substituting in edi with 3 occurences  
 movq MM1, [  ebp+edi* 4+     -1620]
 paddd MM1, [  ebp+edi* 4+     -1640]
 movq  [  ebp+edi* 4+     -1600],MM1
 lea ecx,[  ecx+     2]
 jmp  leb4b08729615
leb4b08729616:

</pre>

<center>Figure 6.6: The result of matching the parallelised loop against the Pentium
instruction set</center><a name="matchf">
</a>

<p>
     <h3><a name="tth_sEc6.2.2">
6.2.2</a>&nbsp;&nbsp;Porting strategy</h3>
To port the compiler to a new machine, say a G5, it is necessary to 

<p>

<ol type="1"><p>
<li> Write a new machine description <tt>G5.ilc</tt> in ILCG source code.</li>
<p>
<li> Compile this to a code generator in java with the ilcg compiler generator using
a command of the form

<p>

<ol type="a"><p>
<li> <tt>java ilcg.ILCG cpus/G5.ilc ilcg/tree/G5.java G5</tt></li>
</ol></li>
<p>
<li> Write an interface class <tt>ilcg/tree/G5CG</tt> which is a subclass of 
<tt>G5 </tt> and which
invokes the assembler and linker. The linker and assembler used will depend
on the machine but one can assume that at least a <tt>gcc</tt> assembler and
linker will be available. The class <tt>G5CG</tt> must take responsibility to
handle the translation of procedure calls from the abstract form provided
in ILCG to the concrete form required by the G5 processor.</li>
<p>
<li>
The class <tt>G5CG</tt> should also export the method <tt>getparallelism</tt>
which specifies to the vectoriser the degree of parallelism available
for given data types. An example for a P4 is given in figure <a href="#getparallelism">6.7</a>.
Note that although a P4 is potentially capable of performing 16 way 
parallelism on 8 bit operands the measured speed  when doing this 
on is less than that measured for 8 way parallelism. This is due
to the restriction placed on un-aligned loads of 16 byte quantities
in the P4 architecture. For image processing operations aligned accesses
are the exception. Thus when specifying
the degree of parallelism for a processor one should not simply give
the maximal degree supported by the architecture. The maximal level
of parallelism is not necessarily the fastest.</li>
</ol>

<p>
<a name="tth_fIg6.7">
</a> 
<pre>
public int getParallelism(String elementType) 
{   if(elementType.equals(Node.int32)) return 2;
    if(elementType.equals(Node.int16)) return 4;
    if(elementType.equals(Node.int8)) return 8;   
    if(elementType.equals(Node.uint32)) return 2;
    if(elementType.equals(Node.uint16)) return 4;
    if(elementType.equals(Node.uint8)) return 8;  
    if(elementType.equals(Node.ieee32))return 4; 
    if(elementType.equals(Node.ieee64))return 1;  
    return 1; 
} 

</pre>

<center>Figure 6.7: The method getParallelism for a P4 processor.
   </center>
<a name="getparallelism">
</a>

<p>
Sample machine descriptions for the Pentium and 486  are given in chapter <a href="#machines">7</a>
to help
those wishing to port the compiler.  
These are given in the  ILCG machine description language, an outline of which follows.

<p>
 <h2><a name="tth_sEc6.3">
6.3</a>&nbsp;&nbsp;ILCG </h2><a name="ilcgintro">
</a>
The purpose of ILCG (Intermediate Language for Code Generation) is to 
mediate between CPU instruction sets and high level language programs.
It poth provides a representation to which compilers can translate
a variety of source level programming languages and also a notation for
defining the semantics of CPU instructions.

<p>
Its purpose is to act as an input to two types of programs:

<ol type="1"><p>
<li> ILCG structures produced by a HLL compiler are input to 
an automatically constructed code generator,
working on the syntax matching principles described in [<a href="#graham80" name="CITEgraham80">12</a>]. This then
generates equivalent sequences of assembler statements.</li>
<p>
<li> Machine descriptions written as ILCG source files are input to
code-generator-generators which produce java programs which perform function (1)
above.</li>
</ol>
So far one HLL compiler producing ILCG structures as output
exists: the Vector Pascal compiler.
There also exists one code-generator-generator which produces code generators
that use a top-down pattern matching technique analogous to Prolog unification.

<p>
ILCG is   intended to be flexible enough to describe a wide variety of machine
architectures. In particular it can specify both SISD and SIMD instructions and
either stack-based or register-based machines.
 However, it does assume certain
things about the machine:  that certain basic types are supported and that
the machine is addressed at the byte level.

<p>
In ILCG all type conversions, dereferences etc have to be made
absolutely explicit.

<p>
In what follows we will designate terminals of the language in bold thus <b>octet</b>
and nonterminal in sloping font thus <i>word8</i>.

 <h2><a name="tth_sEc6.4">
6.4</a>&nbsp;&nbsp;Supported types</h2>

     <h3><a name="tth_sEc6.4.1">
6.4.1</a>&nbsp;&nbsp;Data formats</h3>
The data in a memory can be distinguished initially in terms of the number of bits
in the individually addressable chunks. The addressable chunks are assumed to be the
powers of two from 3 to 7, so we thus have as allowed formats:<i>word8, word16, word32, word64,
word128</i>.
These are treated as non terminals in the grammar of ILCG.

<p>
When data is being explicitly operated on without regard to its type, we have terminals which
stand for these formats: <b>octet, halfword, word, doubleword, quadword</b>.

     <h3><a name="tth_sEc6.4.2">
6.4.2</a>&nbsp;&nbsp;Typed formats</h3>
Each of these underlying formats can contain information of different types, either
signed or unsigned integers, floats etc.
ILCG allows the following integer types as terminals :<b>
int8, uint8, int16, uint16, int32, uint32, int64, uint64 </b>to stand for signed and
unsigned integers of the appropriate lengths.

<p>
The integers are logically grouped into <i>signed</i> and <i>unsigned</i>.
As non-terminal types they are represented as 
<i>byte, short, integer, long</i> and
<i>ubyte, ushort, uinteger, ulong</i>.

<p>
Floating point numbers are either assumed to be 32 bit or 64 bit with 32 bit numbers
given the nonterminal symbols <i>float,double</i>. If we wish to specify a particular
representation of floats of doubles we can use the terminals <b>ieee32, ieee64</b>.

<p>
     <h3><a name="tth_sEc6.4.3">
6.4.3</a>&nbsp;&nbsp;Ref types</h3>
ILCG uses a simplified version of the Algol-68 reference typing model.
A value can be a reference to another type. Thus an integer when used as
an address of a 64 bit floating point number would be a <b>ref ieee64 </b>.
Ref types include registers. An integer register would be a <b>ref int32</b>
when holding an integer, a <b>ref ref int32</b> when holding the address
of an integer etc.

 <h2><a name="tth_sEc6.5">
6.5</a>&nbsp;&nbsp;Supported operations</h2>

     <h3><a name="tth_sEc6.5.1">
6.5.1</a>&nbsp;&nbsp;Type casts</h3>

<p>
The syntax for the type casts is C style so we have
for example <tt>(ieee64) int32</tt> to represent a conversion
of an 32 bit integer to a 64 bit real. These type casts
act as constraints on the pattern matcher during code 
generation. They do not perform any data transformation.
They are inserted into machine descritions to constrain the
types of the arguments that will be matched for an instruction.
They are also used by compilers to decorate ILCG trees 
in order both to enforce, and to allow limited breaking of, the type rules. 

<p>
     <h3><a name="tth_sEc6.5.2">
6.5.2</a>&nbsp;&nbsp;Arithmetic</h3>
The allowed dyadic arithmetic operations are addition, saturated addition, multiplication,
saturated multiplication,
subtraction, saturated subtraction,
division and remainder with operator symboles <b>+, +:, *, *:, -, -:, div , mod</b>.. 

<p>
The concrete syntax is prefix with bracketing. Thus 
the infix operation  3+5 <font face="symbol">¸</font
>7 would be
represented as <b>+(3 div (5 7))</b>.

     <h3><a name="tth_sEc6.5.3">
6.5.3</a>&nbsp;&nbsp;Memory</h3>
Memory is explicitly represented. All accesses to memory are
represented by array operations on a predefined array <b>mem</b>.
Thus location 100 in memory is represented as <b>mem(100)</b>.
The type of such an expression is <i>address</i>.
It can be cast to a reference type of a given format.
Thus we could have
<b>

<p>
(ref int32)mem(100)
</b>

<p>
     <h3><a name="tth_sEc6.5.4">
6.5.4</a>&nbsp;&nbsp; Assignment </h3>
We have a set of storage  operators corresponding to the
word lengths supported. These  have the form of 
infix operators. The size of the store being performed
depends on the size of the right hand side.
A valid storage statement might be 
<b>

<p>
(ref octet)mem( 299) :=(int8) 99

<p>
</b>The first argument is always a reference and the second 
argument a value of the appropriate format.

<p>
If the left hand side is a format the right hand side
must be a value of the appropriate size.
If the left hand side is an explicit type rather than
a format, the right hand side must have the same type.

     <h3><a name="tth_sEc6.5.5">
6.5.5</a>&nbsp;&nbsp; Dereferencing</h3>
Dereferencing is done explicitly when a value other than a literal is required.
There is a dereference operator, which converts a reference 
into the value that it references.
 A valid load expression might be:
<b>

<p>
(octet)<font face="symbol">­</font
>  ( (ref octet)mem(99))

<p>
</b>The argument to the load operator must be a reference.

<p>
 <h2><a name="tth_sEc6.6">
6.6</a>&nbsp;&nbsp;Machine description</h2>
Ilcg can be used to describe the semantics of machine instructions.
A machine description typically consists of a set of register declarations
followed by a set of instruction formats and a set of operations.
This approach works well only with machines that have an orthogonal
instruction set, ie, those that allow addressing modes and operators
to be combined in an independent manner.

     <h3><a name="tth_sEc6.6.1">
6.6.1</a>&nbsp;&nbsp;Registers </h3>
When entering machine descriptions in ilcg registers can be declared
along with their type hence
<b>

<p>
register word EBX assembles['ebx'] ;

<p>
reserved register word ESP assembles['esp'];

<p>
</b>would declare <b>EBX</b> to be of type <b>ref word</b>.

<p>

<h4>Aliasing</h4>
A register can be declared to be a sub-field of another register,
hence we could write 
<b>

<p>
 alias register octet AL = EAX(0:7) assembles['al']; 

<p>
 alias register octet BL = EBX(0:7) assembles['bl'];

<p>
</b>to indicate that <b>BL</b> occupies the bottom 8 bits of register <b>EBX</b>.
In this notation bit zero is taken to be the least significant bit of a value.
There are assumed to be two pregiven registers <b>FP, GP</b> that
are used by compilers to point to  areas of memory.
These can be aliased to a particular real register.<b>

<p>
register word EBP assembles['ebp'] ;

<p>
alias register word FP = EBP(0:31) assembles ['ebp'];

<p>
</b>Additional registers may be reserved, indicating that the code generator
must not use them to hold temporary values:

<p>
<b>reserved register word ESP assembles['esp'];
</b>

<p>
     <h3><a name="tth_sEc6.6.2">
6.6.2</a>&nbsp;&nbsp;Register sets</h3>
A set of registers that are used in the same way by the instructionset
can be defined.
<b>

<p>
pattern reg means [ EBP<font face="symbol">|</font
> EBX<font face="symbol">|</font
>ESI<font face="symbol">|</font
>EDI<font face="symbol">|</font
>ECX <font face="symbol">|</font
>EAX<font face="symbol">|</font
>EDX<font face="symbol">|</font
>ESP]  ;

<p>
pattern breg means[ AL<font face="symbol">|</font
>AH<font face="symbol">|</font
>BL<font face="symbol">|</font
>BH<font face="symbol">|</font
>CL<font face="symbol">|</font
>CH<font face="symbol">|</font
>DL<font face="symbol">|</font
>DH];
</b>

<p>
All registers in an register set should be of the same length.

<p>
     <h3><a name="tth_sEc6.6.3">
6.6.3</a>&nbsp;&nbsp;Register Arrays</h3>
Some machine designs have regular arrays of registers.
Rather than have these exhaustively enumerated it is convenient to
have a means of providing an array of registers.
This can be declared as:

<p>
<b>register  vector(8)doubleword MM assembles['MM'i] ;

<p>
</b>  This declares the symbol MMX to stand for the entire MMX register
set. It implicitly defines how the register names are to be
printed in the assembly language by defining an indexing variable
i that is used in the assembly language definition.

<p>
We also need a syntax for explicitly identifying individual
registers in the set. This is done by using
the dyadic subscript operator:
<b>

<p>
subscript(MM,2)

<p>
</b>which would be of type <b>ref doubleword</b>.

     <h3><a name="tth_sEc6.6.4">
6.6.4</a>&nbsp;&nbsp;Register Stacks</h3>
Whilst some machines have registers organised as an array,
another class of machines, those oriented around postfix instructionsets,
have register stacks.

<p>
The ilcg syntax allows register stacks to be declared:

<p>
<b>register stack (8)ieee64 FP assembles[ ' '] ;

<p>
</b>Two access operations are supported on stacks:

<p>
<b>PUSH&nbsp;&nbsp;</b> is a void dyadic operator taking a stack of type ref t as first argument
and a value of  type t as the second argument. Thus we might have:
 <b>

<p>
PUSH(FP,<font face="symbol">­</font
>mem(20))
</b>

<p>

<b>POP&nbsp;&nbsp;</b> is a monadic operator returning t on stacks of type t. So we might have
<b>

<p>
mem(20):=POP(FP)
</b> 
In addition there are two predicates on stacks that can be used in pattern pre-conditions.

<p>
<b>FULL&nbsp;&nbsp;</b> is a monadic boolean operator on stacks.

<p>
<b>EMPTY&nbsp;&nbsp;</b> is a monadic boolean operator on stacks.

     <h3><a name="tth_sEc6.6.5">
6.6.5</a>&nbsp;&nbsp;Instruction formats</h3>

<p>
An instruction format is an abstraction over a class of concrete instructions.
It abstracts over particular operations
 and types thereof
whilst specifying how arguments can be combined.
<b>

<p>
instruction pattern 

<p>
RR( operator op, anyreg r1, anyreg r2, int t)

<p>
        means[r1:=(t) op( <font face="symbol">­</font
>((ref t) r1),<font face="symbol">­</font
>((ref t) r2))]    

<p>
	assembles[op ' ' r1 ',' r2];

<p>
</b>In the above example, we specify a register to register instruction format
that uses the first register as a source and a destination whilst the second
register is only a destination. The 
 result is returned in register r1.

<p>
We might however wish to have a more powerful abstraction, which was capable of
taking more abstract apecifications for its arguments. For example, many machines
allow arguments to instructions to be addressing modes that can be either
registers or memory references. For us to be able to specify this in an instruction
format we need to be able to provide grammer non-terminals as arguments
to the instruction formats.

<p>
For example we might want to be able to say

<p>
<b>instruction  pattern 

<p>
RRM(operator op, reg r1, maddrmode rm, int t)

<p>
        means [r1:=(t) op( <font face="symbol">­</font
>((ref t)r1),<font face="symbol">­</font
>((ref t) rm))]

<p>
        assembles[op ' ' r1 ',' rm ] ;</b>

<p>
This implies that addrmode and reg must be non terminals.
Since the non terminals required by different machines will vary, there
must be a means of declaring such non-terminals in ilcg.

<p>
An example would be:

<b>

<p>
  pattern regindirf(reg r) 

<p>
	means[<font face="symbol">­</font
>(r) ]
	assembles[ r ];

<p>
pattern baseplusoffsetf(reg r, signed s) 

<p>
	means[+(  <font face="symbol">­</font
>(r) ,const s)]
	assembles[  r '+' s ];

<p>
pattern addrform means[baseplusoffsetf<font face="symbol">|</font
> regindirf];

<p>
 pattern maddrmode(addrform f) 

<p>
means[mem(f) ] assembles[ '[' f ']' ];

<p>
</b>This gives us a way of including non terminals as parameters to patterns.

<p>
 <h2><a name="tth_sEc6.7">
6.7</a>&nbsp;&nbsp;Grammar of ILCG</h2>
The following grammar is given in Sable [<a href="#sable" name="CITEsable">34</a>] compatible form.
The Sable parser generator is used to generate a parser for ILCG from
this grammar. The ILCG parser then translates a CPU specification into
a tree structure which is then walked by an ILCG-tree-walk-generator
to produce an ILCG-tree-walk Java class specific to that CPU.

<p>
If the ILCG grammar is extended, for example to allow new arithmetic
operators, then the ILCG-tree-walk-generator must itself be modified
to generate translation rules for the new operators.

<p>
<font size="-1">/*

 <h2><a name="tth_sEc6.8">
6.8</a>&nbsp;&nbsp;ILCG grammar</h2>
This is a definition of the grammer of ILCG using the Sable grammar specification
lanaguage. It is input to Sable to generate a parser for machine descriptions in
ilcg

<p>

<pre>
*/




Package ilcg;
/*
</pre>

     <h3><a name="tth_sEc6.8.1">
6.8.1</a>&nbsp;&nbsp;Helpers</h3>
Helpers are regular expressions macros used in the definition of terminal symbols of the grammar.

<pre>*/
Helpers
  letter = [['A'..'Z']+['a'..'z']];
  digit = ['0'..'9'];
  alphanum = [letter+['0'..'9']];
  cr = 13;
  lf = 10;
  tab = 9;
    digit_sequence = digit+;
    fractional_constant = digit_sequence? '.' digit_sequence | digit_sequence '.';
    sign = '+' | '-';
    exponent_part = ('e' | 'E') sign? digit_sequence;
    floating_suffix = 'f' | 'F' | 'l' | 'L';
  eol = cr lf | cr | lf;        // This takes care of different platforms
  not_cr_lf = [[32..127] - [cr + lf]];
  exponent = ('e'|'E');
  quote = ''';
  all =[0..127];
  schar = [all-'''];
  not_star = [all - '*'];
  not_star_slash = [not_star - '/'];
/*
</pre>

     <h3><a name="tth_sEc6.8.2">
6.8.2</a>&nbsp;&nbsp;Tokens</h3>
The tokens section defines the terminal symbols of the grammar.

<pre>
*/
Tokens
  floating_constant = fractional_constant exponent_part? floating_suffix? |
        digit_sequence exponent_part floating_suffix?;
 /* 
</pre>
terminals specifying data formats 
<pre>
*/
 void ='void';
 octet = 'octet'; int8 = 'int8'; uint8 = 'uint8';
 halfword = 'halfword'; int16 = 'int16' ; uint16 = 'uint16' ;
 word = 'word'; int32 = 'int32' ; 
 uint32 = 'uint32' ; ieee32 = 'ieee32';
 doubleword = 'doubleword'; int64 = 'int64' ; 
 uint64 = 'uint64'; ieee64 = 'ieee64';
 quadword = 'quadword';
/*
</pre>
 terminals describing reserved words

<pre>*/
 function= 'function';
 flag = 'flag';
 location = 'loc';
 procedure='instruction';
 returns ='returns';
 label = 'label';
 goto='goto';
 fail ='interrupt';
 for ='for';
 to='to';
 step='step';
 do ='do';
 ref='ref';
 const='const';
 reg= 'register';
 operation = 'operation';
 alias = 'alias';
 instruction = 'instruction';
 address = 'address';
 vector ='vector';
 stack = 'stack';
 sideeffect='sideeffect';
 if ='if';
 reserved='reserved';
 precondition ='precondition';

 instructionset='instructionset';
/* 
</pre>terminals for describing new patterns
<pre> */
 pattern = 'pattern';
 means = 'means';
 assembles = 'assembles'; 

/*
</pre> terminals specifying operators 
<pre>*/
 colon = ':';
 semicolon= ';';
 comma = ',';
 dot = '.' ;
 bra ='(';
 
 ket =')';
 plus = '+';
 satplus = '+:';
 satminus = '-:';
 satmult ='*:';
 map='-&#62;';
 equals = '=';
 le = '&lt;=';
 ge='&#62;=';
 ne='&lt;&#62;';
 shl='&lt;&lt;';
 shr='&#62;&#62;';
 lt='&lt;';
 gt='&#62;';
 minus = '-';
 times = '*';
 exponentiate = '**';
 divide = 'div';
 replicate = 'rep';
 and = 'AND';
 or = 'OR' ;
 xor = 'XOR';
 not = 'NOT';
 sin='SIN';
 cos='COS';
 abs='ABS';
 tan='TAN';
 ln='LN';
 min='MIN';
 max='MAX';
 sqrt='SQRT';
 trunc='TRUNCATE';
 round='ROUND';
 float='FLOAT';
 remainder = 'MOD';
 extend= 'EXTEND';
 store = ':=';
 deref = '^';
 push ='PUSH';
 pop ='POP';
 call='APPLY';
 full='FULL';
 empty='EMPTY';
 subscript='SUBSCRIPT'; 
 intlit = digit+;
 
 vbar = '|';
 sket=']';
 sbra='[';
 end='end';
 typetoken='type';
 mem='mem';
 string = quote schar+ quote;
/*
</pre>

<p>
 identifiers come after reserved words in the grammar 

<pre>

*/
 identifier = letter alphanum*;  
 blank = (' '|cr|lf|tab)+;
 comment = '/*' not_star* '*'+ (not_star_slash not_star* '*'+)* '/';

Ignored Tokens 
	blank,comment;
/*
</pre>
     <h3><a name="tth_sEc6.8.3">
6.8.3</a>&nbsp;&nbsp;Non terminal symbols</h3>
<pre>
*/
Productions
 program = statementlist instructionlist;
 instructionlist =instructionset sbra alternatives sket;
/*
</pre> non terminals specifying data formats 
<pre>*/
 format = {octet} octet| {halfword} halfword |
          {word} word | {doubleword} doubleword |
          {quadword} quadword;
 
 
/*
</pre> non terminals corresponding to type descriptions 
<pre>*/
 reference =   ref type ;
 array = vector bra number ket;
 aggregate={stack} stack bra number ket |{vector}array |{non};
 predeclaredtype =   {format} format|{tformat}tformat ;
 typeprim=	{typeid}  typeid| {predeclaredtype}predeclaredtype;
type= 	{predeclaredtype}predeclaredtype|
	{typeid}  typeid|	
	{array}typeprim array|
 	{cartesian}sbra type cartesian* sket|
	{reftype}reference|		
	{map}bra [arg]:type map [result]:type ket;
 cartesian =  comma type;
 
 tformat = {signed} signed|{unsigned}unsigned|{ieee32}ieee32|{ieee63}ieee64;
 signed = int32 | {int8} int8 | {int16} int16 | {int64} int64;
 unsigned = uint32 | {uint8} uint8 | {uint16} uint16 | 
            {uint64} uint64;
   

/*
</pre> non terminals corresponding to typed values 
<pre>*/
 value = /*{refval}refval |      */
 	{rhs}rhs|
 	{loc}loc|
 	{void}void|
 	{cartval}cartval|
	{dyadic} dyadic bra [left]:value comma [right]:value ket|
	{monadic}monadic bra value ket;
/*
</pre> value corresponding to a cartesian product type e.g. record initialisers 
<pre>*/
 cartval=sbra value carttail* sket;
 carttail = comma value;
/*
</pre> conditions used in defining control structures 
<pre>*/
condition={dyadic} dyadic bra [left]:condition comma [right]:condition ket|
	{monadic}monadic bra condition ket |
	{id}identifier|
	{number}number;
 rhs=	{number}number|
 	{cast}bra type ket value|
 	{const}const identifier |
  	{deref}deref  bra  refval ket;
 
 refval = loc|
 	{refcast} bra type ket loc;
 loc = 	{id}identifier|
 	{memory}mem bra value ket ;
 

/*predeclaredregister = {fp}fp|{gp}gp;*/
 number =  {reallit} optionalsign reallit|
           {integer} optionalsign intlit;
 optionalsign = |{plus}plus|{minus}minus;
 reallit= floating_constant;
/*
</pre> operators 
<pre>*/ 
dyadic  = {plus} plus|
	{minus} minus |
	{identifier} identifier|
	{exp}exponentiate|
 	{times} times |
 	{divide}  divide|
	{replicate} replicate|
 	{lt}lt|
 	{gt}gt|
 	{call}call|
	{le}le|
	{ge}ge|
	{eq}equals|
	{ne}ne|
	{min}min|{max}max|
	{push}push|
	{subscript}subscript|
	{satplus}satplus|
	{satmult}satmult|
	{satminus}satminus|
		{shl}shl|
		{shr}shr|
             	{remainder} remainder|
             	{or}or|
             	{and}and|
             	{xor}xor;
monadic={not}not|{full}full|{empty}empty|{pop}pop|{sin}sin|
		{trunc}trunc|{round}round|{float}float| {extend}extend|
		{cos}cos|{tan}tan|{abs}abs|{sqrt}sqrt |{ln}ln;
/*
</pre> register declaration 
<pre>*/
registerdecl= reservation reg aggregate type identifier assembles sbra string sket  ;
reservation = {reserved}reserved|{unreserved}; 

aliasdecl =
alias reg aggregate type
          [child]:identifier equals [parent]:identifier bra [lowbit]:intlit colon [highbit]:intlit ket
          assembles sbra string sket;
	 
opdecl = operation identifier means operator assembles sbra string sket;
operator = 	{plus}plus|
		{minus}minus|
		{times}times|
		{lt}lt|
		{gt}gt|
		{min}min|
		{max}max|
		{shl}shl|
		{shr}shr|
 		{le}le|
		{ge}ge|
		{eq}equals|
		{ne}ne|
		{divide} divide|
           	{remainder}remainder|
		{or}or|
		{and}and|
		{xor}xor;

/*
</pre> pattern declarations 
<pre>*/
assign =  refval store value ;
meaning = {value}value|
	{assign}assign|
	{goto}goto value|
	{fail}fail value|
	{if}if bra value ket meaning|
	{for} for refval store [start]:value to [stop]:value step [increment]:value do meaning|
  	{loc}location value;
patterndecl = pattern identifier paramlist means sbra meaning sket assemblesto sideeffects precond
               |
              {alternatives} pattern identifier means sbra alternatives sket;

paramlist = bra param paramtail* ket|{nullparam}bra ket;
param = typeid identifier|{typeparam} typetoken identifier|{label}label identifier;
typeid = identifier;
paramtail = comma param;
alternatives = type alts*; 
alts = vbar type;
precond = precondition sbra condition sket|{unconditional};
asideeffect=   sideeffect  returnval;
sideeffects = asideeffect*;
assemblesto=assembles sbra assemblypattern sket;
assemblypattern = assemblertoken*;
assemblertoken = {string} string | {identifier} identifier;
returnval = returns identifier;
/*
</pre> statements 
<pre>*/
statement = {aliasdecl} aliasdecl|
            {registerdecl} registerdecl |	    
		{addressmode} address patterndecl|
		{instructionformat}procedure patterndecl|
		{opdecl}opdecl|
		{flag} flag identifier equals intlit| 
		{typerename}typetoken predeclaredtype     equals identifier|
		{patterndecl} patterndecl;
statementlist = statement semicolon statements*;
statements =  statement  semicolon;


// 
</pre>

<p>
<font size="+0"> <h1><a name="tth_chAp7">
Chapter 7 </a><br />Sample Machine Descriptions</h1><a name="machines">
</a>
 <font size="-1">

 <h2><a name="tth_sEc7.1">
7.1</a>&nbsp;&nbsp;Basic 386 architecture</h2>


 <h2><a name="tth_sEc7.2">
7.2</a>&nbsp;&nbsp;The MMX instruction-set</h2>


 <h2><a name="tth_sEc7.3">
7.3</a>&nbsp;&nbsp;The 486 CPU</h2>


<p>
 <font size="+0">     <h3><a name="tth_sEc7.3.1">
7.3.1</a>&nbsp;&nbsp;Concrete representation</h3>

<p>
<br /><h1>Part 2   <br />VIPER<br />&nbsp;<br /><font size="+0"><em>Ken Renfrew</em></font></h1><br />

<p>

<p>

<p>

<p>
 <h1><a name="tth_chAp8">
Chapter 8 </a><br />Introduction to VIPER</h1><a name="vipintro">
</a>

<p>

<p>

<p>
 <h2><a name="tth_sEc8.1">
8.1</a>&nbsp;&nbsp;Rationale</h2>
When originally developed, Vector Pascal used a command line compiler
operating in the classical Unix fashion. This interface is documented
in section <a href="#commandline">5.1</a>.
However it has been conventional, at least since the release
of UCSD Pascal in the late '70s  for Pascal Compilers to  be provided with
an integrated development environment. The Vector Pascal IDE, provides
the usual capabilities of such environments, but with the additional feature
of   literate programming support.

<p>
     <h3><a name="tth_sEc8.1.1">
8.1.1</a>&nbsp;&nbsp;The Literate Programming Tool.</h3>

<p>
Today's pace of technological development seems to be rising beyond anything that could be conceived only a few decades ago. It is a common ``joke'' that any piece of modern 
technology is six months out of date by the time it reaches the show room. 

<p>
Software development is one of the fastest moving areas of this technological stampede. With development happening at such a rate documentation is often at best a few steps 
behind the reality of the code of any system. Thus anyone attempting to maintain a system is left to their own ingenuity and some out of date documentation.

<p>
The constant updating of this documentation would in fact almost certainly be a more time consuming task than developing the program in the first place and hence time spent in 
this area can often be regarded as non productive time.

<p>
Several attempts have been made at automating this process. The automation process is often termed literate programming. The two most successful of these being 
<tt>web</tt> [<a href="#Knuth" name="CITEKnuth">23</a>]
a development of the <span class="roman">T</span><sub><span class="roman">E</span></sub><span class="roman">X</span> system which is the forefather of <span class="roman">L</span><sup><span class="roman">A</span></sup><span class="roman">T</span><sub><span class="roman">E</span></sub><span class="roman">X</span>
[<a href="#Lamport" name="CITELamport">25</a>] developed by  Leslie Lamport that is so widely used today, and JAVADOC. 
 The JAVADOC system was developed by Sun Microsystems to document programs written in JAVA by  including the document details inside specially marked comments [Sch1].      

<p>
The Vector Pascal literate programming tool will combine these two approaches by allowing the programmer to embed <span class="roman">L</span><sup><span class="roman">A</span></sup><span class="roman">T</span><sub><span class="roman">E</span></sub><span class="roman">X</span> commands with in special comment markers. 
These will still be able to be parsed by a conventional Pascal Compiler allowing the system to be used for conventional Pascal programming.

<p>
The embedding of <span class="roman">L</span><sup><span class="roman">A</span></sup><span class="roman">T</span><sub><span class="roman">E</span></sub><span class="roman">X</span> commands in the program is not compulsory for those wishing to use the tool.  There is a user selectable scale of detail that will be included 
automatically in documentation even from a normal Pascal program. 

<p>
In addition in an attempt to make the programs idiosyncrasies more readable and to present the programs arguments more conventionally there is the option of using a 
``mathematical syntax converter'' which will change some of the more impenetrable code into conventional mathematical symbolism 
<a href="#tthFtNtAAJ" name="tthFrefAAJ"><sup>9</sup></a>. The finished document being written, by the system in <span class="roman">L</span><sup><span class="roman">A</span></sup><span class="roman">T</span><sub><span class="roman">E</span></sub><span class="roman">X</span> to allow straight 
compilation into a postscript or pdf document formats. 

<p>
To further aid the documentation the variables declared with in the program will be cross referenced to their instantiation point allowing a reader to cross reference a variable 
and thus remind themselves of it's exact nature.

<p>
This brief description clearly show the aids that a literate programming tool would bring to the programmer allowing documentation to be both kept up to date and in fact created 
retrospectively from existing code.

<p>

<p>
     <h3><a name="tth_sEc8.1.2">
8.1.2</a>&nbsp;&nbsp;The Mathematical Syntax Converter.</h3>

<p>
A computer program by it's very nature has a structure which allows it to be read by a machine. Modern high level languages have abstracted themselves from this very 
successfully but never the less due to this underlying requirement the syntax of a program language can hide the program's algorithm from a human reader.

<p>
Programmers often use psuedo-code to explain algorithmic arguments. Mathematical notation is usually the most clear and precise way of presenting this argument. The 
mathematical converter allows a developer to use this system to convert the Pascal syntax into something closer to mathematical notation 
<a href="#tthFtNtABA" name="tthFrefABA"><sup>10</sup></a> and much more presentable to the human reader.   

<p>
This feature is unique <a href="#tthFtNtABB" name="tthFrefABB"><sup>11</sup></a> in a programming interface and provides a further level of documentation. 
The documentation of the algorithms involved in the program, which are arguably the program's most valuable assets.

<p>

<p>
 <h2><a name="tth_sEc8.2">
8.2</a>&nbsp;&nbsp;A System Overview</h2>

<p>
As can be seen from the rationale above the system breaks into three main sections. The program editor with the compiler, the literate programming tool and the 
mathematical syntax converter.

<p>
It is hoped that an improvement in performance of the supplied compiler can be achieved by statically loading the compilers class files for all target processors 
<a href="#tthFtNtABC" name="tthFrefABC"><sup>12</sup></a> at start up rather than the dynamic loading currently employed.

<p>
The I.D.E. will follow the traditional approach offering similar facilities to that of many other editors for different languages on the market place.

<p>
Among these facilities are a syntax highlighting (for Vector Pascal, <span class="roman">L</span><sup><span class="roman">A</span></sup><span class="roman">T</span><sub><span class="roman">E</span></sub><span class="roman">X</span> and HTML), a project manager with automatic make file facility, the ability to run a program in the 
environment with redirected input and output, a function 
&amp; procedure finder linked to the source code, a error line highlighter for compilation errors, an external process runner for <span class="roman">L</span><sup><span class="roman">A</span></sup><span class="roman">T</span><sub><span class="roman">E</span></sub><span class="roman">X</span> compilers, <span class="roman">T</span><sub><span class="roman">E</span></sub><span class="roman">X</span> to HTML converters, 
a mini browser to show approximate results of the Literate programming tool etc...

<p>
The Literate programming tool has been described in it's rationale and incorporates the unique mathematical syntax conversion allowing a program to be converted to a 
mathematical argument at literally the touch of a button. 

<p>

<p>
 <h2><a name="tth_sEc8.3">
8.3</a>&nbsp;&nbsp;Which VIPER to download?</h2>

<p>
VIPER is  platform  independent for the operating systems it supports.
 These operating systems are: -

<ul><p>
<li> Linux</li>
<p>
<li> Windows 9x</li>
<p>
<li> Windows NT/2000/XP</li>
</ul>

<p>
The only decision to make on the VIPER download is 
whether the source code is required. 
The source version although much larger contains the source code 
for the VIPER I.D.E. and the Vector Pascal Compiler and all 
files required for a developer to further develop or adapt any of the
 systems within VIPER. 
The class file download provides the required files to have an 
operational VIPER installation.

<p>

<p>
 <h2><a name="tth_sEc8.4">
8.4</a>&nbsp;&nbsp;System dependencies</h2>

<p>
 VIPER depends on several pieces of software all of 
which are freely available to download from various sources.
The vital dependencies are: -

<ul><p>
<li> Java 1.3 or newer.</li>
<p>
<li> The NASM assembler.</li>
<p>
<li> The gcc linker. Included in Linux installations, for Windows use the cygwin or DJGPP versions of the gcc linker.</li>
</ul>

<p>
For full functionality the following systems are also required: -

<ul><p>
<li> A <span class="roman">L</span><sup><span class="roman">A</span></sup><span class="roman">T</span><sub><span class="roman">E</span></sub><span class="roman">X</span>  installation. <span class="roman">L</span><sup><span class="roman">A</span></sup><span class="roman">T</span><sub><span class="roman">E</span></sub><span class="roman">X</span> usually comes with Linux installations. The total MiK<span class="roman">T</span><sub><span class="roman">E</span></sub><span class="roman">X</span> package is recommended for all Windows installations.</li>
<p>
<li> A dvi viewer usually included with a <span class="roman">L</span><sup><span class="roman">A</span></sup><span class="roman">T</span><sub><span class="roman">E</span></sub><span class="roman">X</span>  installation. The YAP viewer included with MiK<span class="roman">T</span><sub><span class="roman">E</span></sub><span class="roman">X</span>  is particularly recommended.</li>
<p>
<li> A <span class="roman">T</span><sub><span class="roman">E</span></sub><span class="roman">X</span> to <tt>HTML</tt> converter. TTH was used in the development of the system.</li>
</ul>

<p>
It is recommended that all the above programs are set-up as per their own 
installation instructions and the appropriate class path established to suit 
the host machines operating system.

<p>

<p>
 <h2><a name="tth_sEc8.5">
8.5</a>&nbsp;&nbsp;Installing Files</h2>

<p>
Assuming the VIPER files have been downloaded to a suitable place on the host machine the actual installation can begin. The only decision that must be made is where to install VIPER. VIPER can be installed anywhere on the host machine provided that there are no spaces in the directory path of the target directory.

<p>
Once this decision has been made the .zip file should be unzipped using a proprietary zip tool (e.g. WinZip, zip magic etc.) to the source directory.

<p>
When the .zip file has been unzipped there will be a directory called VectorPascal in the target directory. VectorPascal is the home directory of the VIPER system. 

<p>
VIPER may be launched by : -

<ul><p>
<li> All installations. Open a shell / DOS window change to the VIPER home directory and type the command <tt>java viper.Viper</tt> taking care of the capital letter.</li>
<p>
<li>  Windows installations. The batch file viper.bat is included in the VIPER home directory; running this will start VIPER. A shortcut to this batch file should be placed on the host machines desktop for the easiest start-up.</li>
<p>
<li> Linux installations. The shell script viper.sh is included in the VIPER home directory; running this will start VIPER.</li>
</ul>

<p>

<p>
 <h2><a name="tth_sEc8.6">
8.6</a>&nbsp;&nbsp;Setting up the compiler</h2>

<p>
VIPER detects the operating system installed at start up and then moves a suitable run time library into the ../VectorPascal/ilcg/Pascal directory where it will be available for the compiler. This is done automatically each time that VIPER is started.

<p>
The compiler options will need to be set-up along with the personal set-up proffered for the installation (see Chapter <a href="#userguide">9</a>). The file type for the linker will need set-up.
These options are: -

<ul><p>
<li> For Linux or Windows using the Cygwin gcc use ``elf''.</li>
<p>
<li> For Windows using the DJGPP linker use ``coff''.</li>
</ul>

<p>
It is important to read through the user guide (see Chapter <a href="#userguide">9</a>) to avoid learning the system the painful way!

<p>

<p>
 <h1><a name="tth_chAp9">
Chapter 9 </a><br />VIPER User Guide</h1><a name="userguide">
</a>

<p>
 <h2><a name="tth_sEc9.1">
9.1</a>&nbsp;&nbsp;Setting Up the System</h2>

<p>
VIPER automatically sets the compiler flags to suit the operating system on the host machine. For those who have used the Vector Pascal 
compiler with a command line interface this means that the -U flag is set for Windows 9x and Windows NT installations, and not set for Linux/UNIX 
installations, the -o flag is set to produce an exe file with the same name as the Pascal source file. The .asm file and .o files are similarly named.
If these flags mean nothing then that is not a problem, either ignore the preceding information or see the Vector Pascal reference manual in the help files
of the VIPER system.

<p>
VIPER cannot however detect the versions of the gcc linker installed, this is left for the user. The -f flag of the compiler tells the compiler the file 
format to be used. To set this go to Set-Up / Compiler Options / Options and click the -f button and enter the file format into the adjacent text field.
The format should be :

<ul><p>
<li>  Linux Installations and Windows installations with Cygwin gcc linker format is <tt>elf</tt></li>
<p>
<li> Windows with DJGPP linker format is <tt>coff</tt></li>
</ul>

<p>
<a name="tth_fIg9.1">
</a> <table border="0"><tr><td></td><td><table border="0"><tr><td><a href="elfcoff.eps">Figure</a>
</td></tr></table><!--vbox-->
</td><td>

<center>Figure 9.1: File Format Entries in Compiler Options</center><a name="fig:elfcoff">
</a>
</td></tr></table><!--hboxt-->
<p>
 The other options on the Compiler options window are: -
 
<ul><p>
<li> Smart (Not Yet Implemented on the V.P. compiler) Serializes / deserializes the code tree for the processor. This allows the 
compiler to `learn' how to quickly respond to a given code segment.</li>
<p>
<li>   S suppresses the assembly and linking of the program (an assembler file is still produced).</li>
<p>
<li> V causes the compiler to produce a verbose output to MyProg.lst when compiling MyProg.pas.</li>
<p>
<li> CPUtag This option is used in conjunction with the -cpu option. It prefixes the .exe file with the name of the cpu for which the 
compiler is set. when this option is used the .exe cannot be run in the I.D.E.</li>
<p>
<li> -cpu This option allow the source file to be compiled to a range of processors. To produce an exe file for a range of processors
the CPUtag should be set. This prevents the exe file being over written by the next compilation for a different processor. Subsequent 
compilations for the same processor, however, will be overwritten. Select the cpu from the list in the drop down menu adjacent to the 
-cpu button.</li>
<p>
<li> -ISO (Not Yet Implemented on the V.P. compiler) Compiles to iso standard Pascal.</li>
</ul>

     <h3><a name="tth_sEc9.1.1">
9.1.1</a>&nbsp;&nbsp;Setting System Dependencies</h3>
VIPER depends on various other systems for full functionality. These are set in Set-Up / Compiler Options / Dependencies 

<p>
<a name="tth_fIg9.2">
</a> <table border="0"><tr><td></td><td><table border="0"><tr><td><a href="dependencies.eps">Figure</a>
</td></tr></table><!--vbox-->
</td><td>

<center>Figure 9.2: Dependencies Window</center><a name="fig:depnd">
</a>
</td></tr></table><!--hboxt-->
<p>
 The fields are: -

<ol type="1"><p>
<li> Source Compiler this option is only editable if the Default Compiler option is not set. This is the command that would run the compiler 
from the VectorPascal directory.</li>
<p>
<li> This is the command required to run <span class="roman">L</span><sup><span class="roman">A</span></sup><span class="roman">T</span><sub><span class="roman">E</span></sub><span class="roman">X</span> this is required for VP<span class="roman">T</span><sub><span class="roman">E</span></sub><span class="roman">X</span>  to work. The recommended option for this field is 
<tt>texi2dvi</tt>.</li>
<p>
<li> DVI viewer The dvi viewer that is to be used to view the <span class="roman">L</span><sup><span class="roman">A</span></sup><span class="roman">T</span><sub><span class="roman">E</span></sub><span class="roman">X</span>  recommended option is YAP (Windows installations).</li>
<p>
<li> Tex to HTML if a converter is installed on the host machine then put the command in this field.</li>
<p>
<li> Tex to PDF enter the command used to convert tex to PDF.</li>
<p>
<li> DVI to PS command to convert DVI files to PostScript (usually dvips).</li>
</ol>

<p>

<p>
     <h3><a name="tth_sEc9.1.2">
9.1.2</a>&nbsp;&nbsp;Personal Set-up</h3>

<p>
Viper allows the user many options to cater for different tastes and programming styles. It is not crucial to the system to set these options but it does 
make for a more comfortable programming environment.

<p>
If your VIPER installation is on a network each user may have a different personal set-up providing each user has a separate home directory. 
VIPER installs a file called <tt>viper.properties</tt> into this directory and updates this file when ever a change is made to the system set-up. 

<p>
<b>NOTE</b>  The individual set-up should not be attempted when multiple files are open. If this is done then no harm comes to the system or 
any of the open files but users may experience difficulty in closing one or more files. The solution is to use Window / Close All to close all the files. 
The system can then be used as normal.

<p>

<h4>Viper Options</h4>
In the Set-up menu there is the Viper Options menu option. In this you will find all the familiar I.D.E. options such as font size and style, icons sizes, 
syntax colours, look and feel etc.

<p>
<a name="tth_fIg9.3">
</a> <table border="0"><tr><td></td><td><table border="0"><tr><td><a href="allviperoptions.eps">Figure</a>
</td></tr></table><!--vbox-->
</td><td>

<center>Figure 9.3: The Viper Option Windows</center><a name="fig:allvipops">
</a>
</td></tr></table><!--hboxt-->
<p>
The different Windows shown above allow the control of the VIPER I.D.E. The individual windows control:  -

<ul><p>
<li> <b>Editor</b> This controls the look and feel (see Colour Plates) the font size and style, the tab size and auto indentation.</li>
<p>
<li> <b>Console</b> This controls the Font style and size and the background colour of the console window.</li>
<p>
<li> <b>Preferences</b> This allows the individual set-up of the menu icon sizes and the tool bar sizes.</li>
<p>
<li> <b>Syntax Colours</b> This allows the Syntax Highlighting colours to be altered to personal taste. These can be adjusted for each 
supported language (Vector Pascal, <span class="roman">L</span><sup><span class="roman">A</span></sup><span class="roman">T</span><sub><span class="roman">E</span></sub><span class="roman">X</span>, HTML) independently.</li>
</ul>

     <h3><a name="tth_sEc9.1.3">
9.1.3</a>&nbsp;&nbsp;Dynamic Compiler Options</h3>
<b>NOTE</b> This is for advanced use only.<br />

<p>
This feature is intended to allow VIPER to handle: -

<ul><p>
<li>  New processors as the class files become available (Dynamic class loading only).</li>
<p>
<li> New options for the compiler / new versions of the compiler.</li>
</ul>
The dynamically created options pages are added in the form of a new tabbed pane to the Compiler Options window.
To create a new options pane the user must: -

<ol type="1"><p>
<li> Open the file ../VectorPascal/viper/resources/dynamicOption.properties</li>
<p>
<li> Edit the file to suit the new options.</li>
<p>
<li> Save the  file.</li>
</ol>

<h4>Editing to add a processor</h4>
In the file dynamicoptions.properties in the ../VectorPascal/viper/resources directory there is a list of the current processors.. This list  can be extended 
simply by adding another to the end of the list. It is best if the list ends with ``others''.

<p>
<b>Note</b>  The appropriate code generator files must be written for the Vector Pascal compiler and placed  in the ../VectorPascal/ilcg/tree  directory.

<h4>Editing to add compiler options</h4>
The dynamicoptions.properties file can be edited to produce a new compiler option. This is done by entering a new line at the end of the file following 
the in the line above. For example: -

<p>
<a name="tth_fIg9.4">
</a> <table border="0"><tr><td></td><td><table border="0"><tr><td><a href="dynamicoptions.eps">Figure</a>
</td></tr></table><!--vbox-->
</td><td>

<center>Figure 9.4: Dynamic Option Window</center><a name="fig:DynamicOptions">
</a>
</td></tr></table><!--hboxt-->
<p>

<pre>
CPUFLAGS: P3:K6:Pentium:IA32
#
#This is to set flags for the compiler
#NB DO NOT EDIT THIS FILE BEFORE AFTER READING THE HELP FILE
#IT IS IMPORTANT THAT THE FIELDS COME IN THE FOLLOWING ORDER
#FLAG(Type:String),DESCRIPTION(Type:String),TEXTFIELD(Type:int),
#BROWSEBUTTON(Type: boolean)
#Any comments must be but in this area.
		
FLAG:DESCRIPTION :TEXTFIELD: BROWSEBUTTON
-TEST:Test description: 20 : true:

</pre>

<p>
     <h3><a name="tth_sEc9.1.4">
9.1.4</a>&nbsp;&nbsp;VIPER Option Buttons</h3>
The VIPER  options are set in their respective panels with the VIPER Option Buttons these have three states: -

<ul><p>
<li> <b>Grey</b>  The item is  not selected.</li>
<p>
<li> <b>Red</b>  The mouse is over the correct areas to select the item.</li>
<p>
<li> <b>Blue</b>  The item is selected.</li>
</ul>

<p>

<p>
 <h2><a name="tth_sEc9.2">
9.2</a>&nbsp;&nbsp;Moving VIPER</h2>

<p>
Ideally VIPER should be installed from the downloaded zip file on any new system. If this is not possible then it is still possible to move 
VIPER onto a new system even if the new host machine has a different operating system.

<p>
Moving a VIPER installation from any Windows host to any other Windows host, or from one Linux installation to another is 
straight forward.

<ol type="1"><p>
<li> Move the entire VectorPascal directory and all sub-directories to the new system.</li>
<p>
<li> Run VIPER and in the File menu click clear recent files and then click clear recent projects.</li>
<p>
<li> Import all projects that have been moved and are to be used on the new system.</li>
</ol>
If the operating systems are  different (i.e. moving from Linux to Windows or vice versa) then the system must be reset: -

<ol type="1"><p>
<li> open a shell/DOS prompt window and change directories to the VectorPascal directory.</li>
<p>
<li> Type <tt> java ViperSystemReset</tt> in the console window.</li>
</ol>
The system is now reset and the new installation of VIPER can be used normally.

<p>

 <h2><a name="tth_sEc9.3">
9.3</a>&nbsp;&nbsp;Programming with VIPER</h2>

<p>
This section assumes that the I.D.E. is now set-up to the user's taste. To open a file click the open file menu option and use the dialogue box to
open the file in the usual way. 

<p>
Familiarity with the basic editing functions of an I.D.E. are assumed.

<p>

     <h3><a name="tth_sEc9.3.1">
9.3.1</a>&nbsp;&nbsp;Single Files</h3>

<p>
The file will open with the syntax highlighter associated with the file suffix of the target file. The file can be edited with all the usual I.D.E. functions.
(Cut, Paste, Copy, Save, Save As, Find and Replace, etc.).

<p>
VIPER features a ``right click menu'' to offer another method of quickly editing files.

<p>
<a name="tth_fIg9.5">
</a> <table border="0"><tr><td></td><td><table border="0"><tr><td><a href="rightclick.eps">Figure</a>
</td></tr></table><!--vbox-->
</td><td>

<center>Figure 9.5: The Right Click Menu</center><a name="fig:rightclick">
</a>
</td></tr></table><!--hboxt-->
<p>
Line numbers can be viewed either by using the statistics on the status bar at the bottom right hand corner of the I.D.E. or by double clicking the dark grey 
panel on the left of the editor window, this line number panel can then be adjusted in size to suit the user's needs.

<p>
A new file can be opened from the file menu. Clicking on the New Document option allows the user to choose between the three types of file that  
VIPER supports (.Pascal, <span class="roman">L</span><sup><span class="roman">A</span></sup><span class="roman">T</span><sub><span class="roman">E</span></sub><span class="roman">X</span>, HTML). A new file is then opened in the editor window. The file is un-named until it has been saved.

<p>
When a file has been changed since it was last saved the name tag at the top of the editor window appears in red, otherwise it is black.

<p>
If the user attempts to close the editor before a file is saved  the option to save the file is offered before the I.D.E. closes.

<p>
If a file has functions and / or procedures the function finder automatically displays these in the left  most editor window. Clicking on the icon 
by a function or procedure takes the editor to the start of that section.

<p>

     <h3><a name="tth_sEc9.3.2">
9.3.2</a>&nbsp;&nbsp;Projects</h3>
The VIPER Project Manager allows the user to construct  software projects in Vector Pascal. 

<p>
An existing project can be opened using the Project / Open Project menu option or icon. The project will then appear in the project window.
The files names are in a tree structure which can be clicked to open the file in the editor window.

<p>
To create a new project the user clicks on the new project icon and the Project properties dialogue box will appear.

<p>
<a name="tth_fIg9.6">
</a> <table border="0"><tr><td></td><td><table border="0"><tr><td><a href="projprop.eps">Figure</a>
</td></tr></table><!--vbox-->
</td><td>

<center>Figure 9.6: The Project Properties Window</center><a name="fig:projprops">
</a>
</td></tr></table><!--hboxt-->
<p>
The text fields are then filled in to create the empty project. The directory path should be the parent directory for the project's  home directory.
This home directory will be given the project's name.

<p>
Once the project has been created the files can be added and removed as required.

<ul><p>
<li> <b>Adding</b> Click the add files icon and enter or browse for the required file. This copies the file to the project directory.</li>
<p>
<li> <b>Removing</b> Highlight the file too be removed and click the remove files icon. <b>Warning</b> This deletes the file from the project
directory.</li>
</ul>

<p>
Other files may be placed in the project directory but if they are not added to the project they will not be a member of the project.

<p>
The makefile for the project is automatically created as ProjectName.mke. The user should not edit either this or the .prj file directly.

<p>

<h4>Importing Projects</h4>
Projects can be imported from other VIPER installations by the import project facility. This can be found in Project / Import Project. Any project coming 
from another VIPER must be imported via this facility.

<p>

<h4>Backing-Up Projects</h4>
 The import project facility can be used to move an existing project to another directory of the same machine. This Back-Up project is not just a
 copy of the project but is fully functional with all the facilities of the VIPER system.

<p>

     <h3><a name="tth_sEc9.3.3">
9.3.3</a>&nbsp;&nbsp;Embedding <span class="roman">L</span><sup><span class="roman">A</span></sup><span class="roman">T</span><sub><span class="roman">E</span></sub><span class="roman">X</span> in Vector Pascal</h3>

<p>
The special comment (*! comment body *)  is used to embed <span class="roman">L</span><sup><span class="roman">A</span></sup><span class="roman">T</span><sub><span class="roman">E</span></sub><span class="roman">X</span> in the Vector Pascal source file. Anything in within these comments will be treated 
as if it were <span class="roman">L</span><sup><span class="roman">A</span></sup><span class="roman">T</span><sub><span class="roman">E</span></sub><span class="roman">X</span> both by the VP<span class="roman">T</span><sub><span class="roman">E</span></sub><span class="roman">X</span>  system and the syntax highlighter. 

<p>
There is no need to put <span class="roman">L</span><sup><span class="roman">A</span></sup><span class="roman">T</span><sub><span class="roman">E</span></sub><span class="roman">X</span>  commands in the special comments unless a specific result is required. (See section <a href="#vptexstyle">9.9</a>)

 <h2><a name="tth_sEc9.4">
9.4</a>&nbsp;&nbsp;Compiling Files in VIPER</h2>

     <h3><a name="tth_sEc9.4.1">
9.4.1</a>&nbsp;&nbsp;Compiling Single Files</h3>

<p>
Assuming the compiler has been set-up the compilation of a file is very simple. Simply click the compile icon (or menu option) and the compiler will
compile the file in the editor window with the options selected. 

<p>
The resulting files are placed in the same directory as the source file and are named the same as the source file with the corresponding suffix.

<p>

<h4>Compiling a file to executable for several processors</h4>

<p>
If a file is to be compiled for several different processors the CPUTAG and -CPU options must be set in the Set-Up / Compiler Options / Options panel.
The file MyProg.pas would then be compiled to ProcessorNameMyProg.exe.  This process can be done for each processor on the available processor 
list.

<p>
<b>Note</b>  A file compiled in this manner cannot be run within the I.D.E.

<p>
     <h3><a name="tth_sEc9.4.2">
9.4.2</a>&nbsp;&nbsp;Compiling Projects</h3>

<p>
Projects can be compiled in two ways: -

<ul><p>
<li> Make a project. This compiles the files that are not up to date but does not compile any file that is up to date.</li>
<p>
<li> Build a project.  This compiles all the files in the project regardless of whether the files are up to date.</li>
</ul>

<p>
The Vector Pascal compiler used in the traditional command line interface mode will check one level of dependency in a project. If there are more 
levels of dependency the VIPER project manager will automatically make a <tt>makefile</tt>  and recursively check all levels of  dependency in 
the project.

<p>
As VIPER compiles a file, the file is opened in the I.D.E. if an error is found compilation stops and the error is highlighted.

 <h2><a name="tth_sEc9.5">
9.5</a>&nbsp;&nbsp;Running Programs in VIPER</h2>

<p>
<b>Note</b> Projects requiring input from the user <b>MUST</b> have the input redirected.

<p>
When a program has been compiled the resulting executable can be run in the I.D.E. by clicking on the Run icon. A redirect input box then appears.
If the program requires input from the user then an input file must be set. This file should contain all the data that the program requires to run to 
completion.

<p>

<p>
<a name="tth_fIg9.7">
</a> <table border="0"><tr><td></td><td><table border="0"><tr><td><a href="runops.eps">Figure</a>
</td></tr></table><!--vbox-->
</td><td>

<center>Figure 9.7: The Run Options Panel</center><a name="fig:run">
</a>
</td></tr></table><!--hboxt-->
<p>
Similarly the output may be redirected. This, however is not compulsory if the output is not redirected the output of the program appears in the console 
window. If the output is redirected then the output is written to the file set-up in the run dialogue window.

<p>

 <h2><a name="tth_sEc9.6">
9.6</a>&nbsp;&nbsp;Making VP<span class="roman">T</span><sub><span class="roman">E</span></sub><span class="roman">X</span></h2>

<p>
Making VP<span class="roman">T</span><sub><span class="roman">E</span></sub><span class="roman">X</span> is as simple as clicking the Build VP<span class="roman">T</span><sub><span class="roman">E</span></sub><span class="roman">X</span>   icon or menu option. If  a project is open then the VP<span class="roman">T</span><sub><span class="roman">E</span></sub><span class="roman">X</span>  is made for the whole 
project, otherwise the VP<span class="roman">T</span><sub><span class="roman">E</span></sub><span class="roman">X</span> is made for the file in the editor window.

<p>

     <h3><a name="tth_sEc9.6.1">
9.6.1</a>&nbsp;&nbsp;VP<span class="roman">T</span><sub><span class="roman">E</span></sub><span class="roman">X</span>Options</h3>

<p>
The level of documentation is set by the user in the VP<span class="roman">T</span><sub><span class="roman">E</span></sub><span class="roman">X</span> Options panel. This panel can be found in the TeX / VP-TeX Options menu item.
There are five levels of detail that can be chosen :-

<ul><p>
<li> Function and Procedure headings only.</li>
<p>
<li> Level 1 plus all special comments.</li>
<p>
<li> Program bodies and interfaces.</li>
<p>
<li> Selected text</li>
<p>
<li> All source code.</li>
</ul>

<p>
In addition to the above options the user can choose whether a contents page is to be included or not. This is set by clicking the create contents page button.

<p>

<p>
<a name="tth_fIg9.8">
</a> <table border="0"><tr><td></td><td><table border="0"><tr><td><a href="vptexoptions.eps">Figure</a>
</td></tr></table><!--vbox-->
</td><td>

<center>Figure 9.8: The VP<span class="roman">T</span><sub><span class="roman">E</span></sub><span class="roman">X</span> Options Panel</center><a name="fig:texops">
</a>
</td></tr></table><!--hboxt-->
<p>

     <h3><a name="tth_sEc9.6.2">
9.6.2</a>&nbsp;&nbsp;VPMath</h3>

<p>
The VPMath system converts Vector Pascal code to mathematical syntax. This makes the program more human readable and in general more concise.

<p>
The VPMath system is invoked automatically when the  VPTeX  is made if the Use Math Converter is set in the Tex/VP-TeX Options menu item.

<p>

 <h2><a name="tth_sEc9.7">
9.7</a>&nbsp;&nbsp;<span class="roman">L</span><sup><span class="roman">A</span></sup><span class="roman">T</span><sub><span class="roman">E</span></sub><span class="roman">X</span>  in VIPER</h2>

<p>
Most of the features of the VIPER editor used in the creation / editing of Vector Pascal files can also be used for creating / editing <span class="roman">L</span><sup><span class="roman">A</span></sup><span class="roman">T</span><sub><span class="roman">E</span></sub><span class="roman">X</span> 
documents.

<p>
Opening a <span class="roman">L</span><sup><span class="roman">A</span></sup><span class="roman">T</span><sub><span class="roman">E</span></sub><span class="roman">X</span>  document in VIPER automatically invokes the <span class="roman">L</span><sup><span class="roman">A</span></sup><span class="roman">T</span><sub><span class="roman">E</span></sub><span class="roman">X</span> syntax highlighter and the Function Methods finder automatically 
changes to a Section /  Sub-Section finder. 

<p>
This allows the user to click on a Section icon in the left hand window and the editor will jump to that section.

<p>

 <h2><a name="tth_sEc9.8">
9.8</a>&nbsp;&nbsp;<tt>HTML</tt> in VIPER</h2>

<p>
VIPER allows the user to edit/write HTML pages. The system for HTML is very straight forward. Create a new HTML file or open an existing file to be
edited. Once the file has been altered click on the run button just as if to run a Vector Pascal executable.

<p>
When a new HTML file is created or an existing one opened the HTML syntax highlighter is automatically loaded.

<p>
The default browser that is installed on the host machine will open with the HTML page displayed.

<p>

 <h2><a name="tth_sEc9.9">
9.9</a>&nbsp;&nbsp;Writing  Code to Generate Good VP<span class="roman">T</span><sub><span class="roman">E</span></sub><span class="roman">X</span></h2> <a name="vptexstyle">
</a>
VPTeX is a tool included in the VIPER Integrated Development Environment for Vector Pascal.  It automatically produces and formats a LaTeX listing of the source file or files on which it is called.  By defining three distinct types of comments, VPTeX also allows the programmer to add extensive descriptions of their code to the listing, creating full LaTeX documentation for their Vector Pascal programs or projects.  Mathematical translation can also be performed on the source code listing to produce a more generic and succinct description of the program's algorithms and structures.

<p>

<b>&nbsp;&nbsp;</b>The three types of comments available are:

<dl compact="compact">
 <dt><b>Special Comments :</b></dt>
	<dd>A special comment is started in the source code with the comment command (*! and terminated with *).  Special comments appear in the LaTeX as running prose and are of most use in giving extensive comments and descriptions of the program.  Special comments can include LaTeX commands, with some limitations, to further imrove the readability of the documentation.</dd>
 <dt><b>Margin Comments :</b></dt>
	<dd>Normal Pascal {...} comments which appear immediately at the end of a line of code are placed in the left-hand margin adjacent to their source code line in the LaTeX documentation.  These are of principal use when a small description of the content of a single line is required.</dd>
 <dt><b>Normal Comments :</b></dt>
	<dd>Normal Pascal {...} comments which appear on a line of their own will appear in the LaTeX in typewriter font.</dd>
</dl>

<p>
     <h3><a name="tth_sEc9.9.1">
9.9.1</a>&nbsp;&nbsp;Use of Special Comments</h3>
As outlined above, special comments are the principal means of describing a program in the documentation.  To maximise the effectiveness of the literate programming facility source code should be written with large amounts of special comments and with the program's documentation in mind.  The ability to include LaTeX command within special comments allows the programmer to directly affect the look of the LaTeX documentation, but there are some limits to the use of LaTeX commands within special comments:

<ul><p>
<li> Do not include any preamble within special comments.  The preamble for the LaTeX documents is automatically produced by VPTeX.</li>
<p>
<li> Always use full text series altering commands such as <tt> \textbf{..}</tt> rather than their shorthand equivalents such as <tt> \bf{...}</tt>.</li>
<p>
<li> Bear in mind that any text entered in special comments must be compilable LaTeX for the documentation to compile.  This means that the following characters are control characters and should not be entered verbatim into special comments; &amp; $ % _ { } ^ &#126; \.</li>
</ul>

<p>

<b>&nbsp;&nbsp;</b>
Special comments can be particularly useful for controlling the structure of your LaTeX document.  The following are guidelines as to how to structure your documentation.

<ul><p>
<li> For an individual program or unit file, the LaTeX document produced by VPTeX will be an article, so sections are the highest level description that can be applied to a block of text.</li>
<p>
<li> It is usually useful to include an introduction to the program at the start of the Pascal source file using the <tt>\section{Introduction}</tt> comand at the start of an opening special comment.</li>
<p>
<li> A special comment containing just a structure command (<tt>\section, \subsection</tt> etc.) can be extremely useful in sectioning off different parts of the source code to add structure to the code listing.  For example, the declarations could be prefaced with <tt>(*! \section{Declarations} *)</tt> or the main program could be prefaced with a similar command.  Each procedure or function is automatically placed within its own section by VPTeX so do not add structuring special comments to these sections of code.</li>
</ul>

<p>

<b>&nbsp;&nbsp;</b>
To produce a well documented program, it is important that special comments are regularly employed to add verbose descriptions of the source code.  It is not uncommon for a LaTeX documentation file to contain many pages of special comments split into sections and subsections between small sections of code.  VPTeX also automatically creates a content page so the structure of your special comments will be reflected in the content page.

<p>

<b>&nbsp;&nbsp;</b>
Note: With the current release of the Vector Pascal compiler, special comments containing *'s other than at the opening (*! and closing *) tags will not compile.

<p>
     <h3><a name="tth_sEc9.9.2">
9.9.2</a>&nbsp;&nbsp;Use of Margin Comments</h3>
Margin comments are useful for providing short descriptions of the purpose of individual lines of code.  If the meaning of a particular code line is especially cryptic, or the significance of the line needs to be emphasised, a  margin comment stating the purpose of that line may be useful.  Please be aware that because margin comments necessarily reside in the left-hand margin of the finished document, lengthy comments will spill onto many lines and break up the flow of the code.  It is advised that margin comments should not be more than 10 or so words, with the other types of comments available if a longer description is required.

<p>

<b>&nbsp;&nbsp;</b>
The VPTeX tool automatically breaks lines following the <font face="helvetica"><b>var</b></font> and <font face="helvetica"><b>const</b></font> keywords. Therefore, the declaration following these keywords will be placed on a new line, but any margin comment for this line will not.  It is recommended that the programmer takes a new line after the <font face="helvetica"><b>var</b></font> and <font face="helvetica"><b>const</b></font> keywords.

<p>
     <h3><a name="tth_sEc9.9.3">
9.9.3</a>&nbsp;&nbsp;Use of Ordinary Pascal Comments</h3>
The function of normal Pascal comments has been superceded in most cases by VPTeX's Special Comments.  However, normal comments can still be useful in a number of circumstances.  The following list details the recommended usage of normal Pascal comments, but the user is, of course, free to make use of them in any circumstances he wishes.

<ul><p>
<li> Firstly, because normal comments are displayed in typewriter font, any spacing within these comments set out by the programmer will be preserved in the documentation.  This is not the case for special comments which are displayed in a serifed, variable width font.  This property of normal comments makes them particulary suitable for laying out tables and arrays simply, although a special comment can make use of LaTeX's ability to typeset tables for a more advanced layout.</li>
<p>
<li> Secondly, normal comments do not break up the flow of a code listing to the same extent as special comments and so are more useful for offering a running commentary on code lines, without the space limitations of margin comments.</li>
<p>
<li> If a comment is reasonably short, the programmer may find that a normal comment will have a better appearance than a special comment. Since special comment are offset from the program listing a small special comment may constitute a waste of the space set aside for it.</li>
</ul>

<p>
     <h3><a name="tth_sEc9.9.4">
9.9.4</a>&nbsp;&nbsp;Levels of Detail within Documentation</h3>
Depending on the sort of documentation you want to produce, VPTeX allows the programmer to specify the detail of their program documentation.  The five levels are:

<ol type="1"><p>
<li> <b>Procedure and Function Headings Only:</b> For documentation of ADT's it is often useful to simply provide a list of the functions and procedures by which a programmer may make use of the ADT.  VPTeX supports this by providing the option to create documentation consisting of only function and procedure headings.  It is advised that a contents page is not included with this level of detail.</li>
<p>
<li> <b>Special Comments with Function and Procedure Headings:</b> To add commentary and descriptions to the above level of detail, option 2 will add any special comments to the documentation.  This allows the programmer to provide descriptions of their procedures and functions and to add structure to the documentation.  A contents page is advised for this level of detail.</li>
<p>
<li> <b>Program Bodies and Unit Interfaces:</b> This level of detail includes all comments.  It is again very useful for documenting ADT's as the interfaces provided by units will be documented, but none of the implementation will be included.  A contents page is recommended.</li>
<p>
<li> <b>Selected Text:</b> Special VPTeX comments commands have been defined to allow the programmer to select which sections of their program to document. The commands are <tt>(*!begin*)</tt> to mark the start of a selected region, and <tt>(*!end*)</tt> to mark the end.  Any text, including special comments, not contained within these tags will be ignored by VPTeX if this level of detail is selected.  The start and end of the main program file will always be included in the documentation regardless of selection.  This feature is of particular use when preparing reports regarding particular sections of code within long projects as only the sections of interest will be documented.  Again, a contents page is recommended.</li>
<p>
<li> <b>All Code and Comments:</b> For a completely documented code listing, of particular use for system maintenance, VPTeX can produce a complete listing of a program or project's source code, including special and normal comments.  A contents page is strongly recommended, particularly for long programs or projects.</li>
</ol>
Note: All levels of detail support margin comments.

<p>
     <h3><a name="tth_sEc9.9.5">
9.9.5</a>&nbsp;&nbsp;Mathematical Translation: Motivation and Guidelines</h3>
VPTeX has the option of automatically translating the program code into conventional mathematical notation.
Complex VectorPascal expressions like:<br /><br />
myVariable:= if (iota 0 div 2 pow (dim-iota 1)) mod 2 = 0 then 1 else -1;<br /><br />
are translated into more tidy and comprehensible mathematical representations like.<br /><br />
<font face="helvetica"><i>myVariable</i><font face="symbol">¬</font
> { 
<table>
<tr><td><table border="0"><tr><td nowrap="nowrap" align="center">
1 </td></tr></table></td><td><table border="0"><tr><td nowrap="nowrap" align="center">
<span class="roman">if</span> <span class="roman">(</span>[(<font face="symbol">i</font
><sub> <span class="roman">0</span> </sub>)/(<span class="roman">2</span><sup><span class="roman">dim</span> <font face="symbol">-</font
> <font face="symbol">i</font
><sub> <span class="roman">1</span> </sub></sup>)]<span class="roman">)</span> <b>mod</b> <span class="roman">2</span> <span class="roman">=</span> <span class="roman">0</span></td></tr></table></td></tr>
<tr><td><table border="0"><tr><td nowrap="nowrap" align="center">
<font face="symbol">-</font
> 1 </td></tr></table></td><td><table border="0"><tr><td nowrap="nowrap" align="center">
<span class="roman">otherwise</span></td></tr></table></td></tr></table>
 </font>;<br /><br />
No action is required to get mathematical translation, so long as it is turned on (VP-TeX Options),
however the benefits of using it increse with the number of mathematical structures in the document.
In particular, the following will benefit from mathematical translation:

<ul><p>
<li>Array indexing/slicing, e.g thisArray<sub>i,j</sub> / thatArray<sub>low..high</sub></li>
<p>
<li>Assignments, e.g. myVarable <font face="symbol">¬</font
> yourVariable</li>
<p>
<li>Reduction operations on arrays, e.g myVariable <font face="symbol">¬</font
> <font face="symbol">å</font
>oneDArray</li>
<p>
<li>Conditional updates (as shown above)</li>
<p>
<li>A number of standard mathematical function such as <font face="symbol">Ö</font>{&nbsp;&nbsp;}</li>
<p>
<li>Mathematical operations, e.g. x<sup>y</sup>,  [&nbsp;a/b], i &times;j</li>
<p>
<li>English names of Greek letters (lower case only), e.g. <font face="symbol">a</font
>, <font face="symbol">b</font
>, <font face="symbol">g</font
>, <font face="symbol">d</font
></li>
</ul>
Mathematical translation is particularly useful if the documentation is for people without knowledge of Pascal or a similar language.
The only time mathematical translation is not advisable is when the reader is maintaining the code itself,
in which case the need for cross reference will usually dominate the need for clarity and conventional notation.

<p>
     <h3><a name="tth_sEc9.9.6">
9.9.6</a>&nbsp;&nbsp;LaTeX Packages</h3>
All VPTeX documents only include packages <tt>graphicx</tt> and <tt>epsfig</tt>.  
These packages are included to allow the programmer to include graphics and 
diagrams to help document their programs.  Any LaTeX commands the programmer
 may wish to use which are specific to other packages cannot be included in 
VPTeX special comments.

<p>

<p>

<p>
<a name="tth_sEcindex"></a>

<h2> Index </h2>

<h2>Bibliography</h2>

<dl compact="compact">
 <dt><a href="#CITEThreeL" name="ThreeL">[1]</a></dt><dd>
3L Limited, Parallel C V2.2, Software Product Description, 1995.

<p>
</dd>
 <dt><a href="#CITEAMD" name="AMD">[2]</a></dt><dd>Advanced Micro Devices, 3DNow! Technology Manual, 1999.
</dd>
 <dt><a href="#CITE2" name="2">[3]</a></dt><dd>Aho, A.V., Ganapathi, M, TJiang S.W.K., Code Generation Using Tree Matching
and Dynamic Programming, ACM Trans, Programming Languages and Systems 11, no.4,
1989, pp.491-516.

<p>
</dd>
 <dt><a href="#CITEblelloch" name="blelloch">[4]</a></dt><dd>
Blelloch, G. E.,  Nesl: A Nested Data-Parallel Language, Carnegie
Mellon University, CMU-CS-95-170, Sept 1995.

<p>
</dd>
 <dt><a href="#CITEBurke" name="Burke">[5]</a></dt><dd>Burke, Chris, J User Manual, ISI, 1995.
</dd>
 <dt><a href="#CITECattel80" name="Cattel80">[6]</a></dt><dd>Cattell R. G. G., Automatic derivation of code generators from machine descriptions,
ACM Transactions on Programming Languages and Systems, 2(2), pp. 173-190, April
1980. 
</dd>
 <dt><a href="#CITEChaitin" name="Chaitin">[7]</a></dt><dd>Chaitin. G., Elegant Lisp Programs, in The Limits of Mathematics, pp. 29-56,
Springer, 1997.
</dd>
 <dt><a href="#CITECheong97" name="Cheong97">[8]</a></dt><dd>Cheong, G., and Lam, M., An Optimizer for Multimedia Instruction Sets, 2nd SUIF
Workshop, Stanford University, August 1997. 
</dd>
 <dt><a href="#CITECherry" name="Cherry">[9]</a></dt><dd> Cherry, G., W., Pascal Programming Structures, Reston Publishing, Reston, 1980.
</dd>
 <dt><a href="#CITECockshott00" name="Cockshott00">[10]</a></dt><dd>Cockshott, Paul, Direct Compilation of High Level Languages for Multi-media
Instruction-sets, Department of Computer Science, University of Glasgow, Nov
2000.

<p>
</dd>
 <dt><a href="#CITEEwing" name="Ewing">[11]</a></dt><dd>
Ewing, A. K., Richardson, H., Simpson, A. D., Kulkarni, R., Writing Data
Parallel Programs with High Performance Fortran, Edinburgh Parallel Computing
Centre, Ver 1.3.1.

<p>
</dd>
 <dt><a href="#CITEgraham80" name="graham80">[12]</a></dt><dd>Susan L. Graham, Table Driven Code Generation, IEEE Computer, Vol 13, No. 8,
August 1980, pp 25..37. 
</dd>
 <dt><a href="#CITEIA32" name="IA32">[13]</a></dt><dd>Intel, Intel Architecture Software Developers Manual Volumes 1 and 2, 1999. 
</dd>
 <dt><a href="#CITEIntel00" name="Intel00">[14]</a></dt><dd>Intel, Willamette Processor Software Developer's Guide, February, 2000. 
</dd>
 <dt><a href="#CITEISO90" name="ISO90">[15]</a></dt><dd>ISO, Extended Pascal ISO 10206:1990, 1991.
</dd>
 <dt><a href="#CITEISO90a" name="ISO90a">[16]</a></dt><dd>ISO, Pascal, ISO 7185:1990, 1991.

<p>
</dd>
 <dt><a href="#CITEIverson62" name="Iverson62">[17]</a></dt><dd>K. E. Iverson, A Programming Language, John Wiley &amp; Sons, Inc., New York (1962),
p. 16. 
</dd>
 <dt><a href="#CITEIverson80" name="Iverson80">[18]</a></dt><dd>Iverson, K. E. . Notation as a tool of thought. Communications of the ACM, 23(8),
444-465, 1980.
</dd>
 <dt><a href="#CITEJmanual" name="Jmanual">[19]</a></dt><dd>Iverson K. E, A personal View of APL, IBM Systems Journal, Vol 30, No 4, 1991. 
</dd>
 <dt><a href="#CITEJintro" name="Jintro">[20]</a></dt><dd>Iverson, Kenneth E., J Introduction and Dictionary, Iverson Software Inc. (ISI),
Toronto, Ontario, 1995. 4, pp 347-361, 2000. 
</dd>
 <dt><a href="#CITEJensen" name="Jensen">[21]</a></dt><dd>Jensen, K., Wirth, N., PASCAL User Manual and Report, Springer 1978.

<p>
</dd>
 <dt><a href="#CITEJohnston" name="Johnston">[22]</a></dt><dd>
Johnston, D., C++ Parallel Systems, ECH: Engineering Computing Newsletter,
No. 55, Daresbury Laboratory/Rutherford Appleton Laboratory, March 1995,pp 6-7.
</dd>
 <dt><a href="#CITEKnuth" name="Knuth">[23]</a></dt><dd> Knuth, D., Computers and Typesetting, Addison Wesley, 1994.
</dd>
 <dt><a href="#CITEKrall00" name="Krall00">[24]</a></dt><dd>
Krall, A., and Lelait, S., Compilation Techniques for Multimedia Processors,
International Journal of Parallel Programming, Vol. 28, No. 4, pp 347-361, 2000. 

<p>
</dd>
 <dt><a href="#CITELamport" name="Lamport">[25]</a></dt><dd> Lamport, L., <span class="roman">L</span><sup><span class="roman">A</span></sup><span class="roman">T</span><sub><span class="roman">E</span></sub><span class="roman">X</span>a document preparation system, Addison Wesley, 1994.

<p>
</dd>
 <dt><a href="#CITELeupers99" name="Leupers99">[26]</a></dt><dd>Leupers, R., Compiler Optimization for Media Processors, EMMSEC 99/Sweden 1999. 

<p>
</dd>
 <dt><a href="#CITEMarx" name="Marx">[27]</a></dt><dd>Marx,  K., 1976,<i>Capital </i>, Volume I, Harmondsworth: Penguin/New Left
Review.

<p>
</dd>
 <dt><a href="#CITEMetcalf96" name="Metcalf96">[28]</a></dt><dd>Metcalf, M., and Reid., J., The F Programming Language, OUP, 1996. 
</dd>
 <dt><a href="#CITEPeleg97" name="Peleg97">[29]</a></dt><dd>Peleg, A., Wilke S., Weiser U., Intel MMX for Multimedia PCs, Comm. ACM, vol
40, no. 1 1997.

<p>
</dd>
 <dt><a href="#CITEShannon" name="Shannon">[30]</a></dt><dd>
Shannon, C., A Mathematical Theory of Communication, The Bell System Technical
Journal, Vol 27, pp 379-423 and 623-656, 1948.

<p>
</dd>
 <dt><a href="#CITESnyder" name="Snyder">[31]</a></dt><dd>
Snyder, L., A Programmer's Guide to ZPL, MIT Press, Cambridge, Mass, 1999.

<p>
</dd>
 <dt><a href="#CITESreraman00" name="Sreraman00">[32]</a></dt><dd>Srereman, N., and Govindarajan, G., A Vectorizing Compiler for Multimedia Extensions,
International Journal of Parallel Programming, Vol. 28, No. 4, pp 363-400, 2000. 

<p>
</dd>
 <dt><a href="#CITEStrachey" name="Strachey">[33]</a></dt><dd>
Strachey, C., Fundamental Concepts of Programming Languages, University of
Oxford, 1967.

<p>
</dd>
 <dt><a href="#CITEsable" name="sable">[34]</a></dt><dd>\' Etienne Gagnon, SABLECC, AN OBJECT-ORIENTED COMPILER FRAMEWORK, School
of Computer Science McGill University, Montreal, March 1998. 
</dd>
 <dt><a href="#CITETexas" name="Texas">[35]</a></dt><dd>Texas Instruments, TMS320C62xx CPU and Instruction Set Reference Guide, 1998.
</dd>
 <dt><a href="#CITEWirth" name="Wirth">[36]</a></dt><dd> Wirth, N., Recollections about the development of Pascal, in <em>
History of Programming Languages-II</em>, ACM-Press, pp 97-111, 1996.</dd>
</dl>
</font></font></font></font><hr /><h3>Footnotes:</h3>

<p>
<a name="tthFtNtAAB"></a><a href="#tthFrefAAB"><sup>1</sup></a>Note this differs from ISO Pascal which allows a comment starting with { to
terminate with *) and vice versa.

<p>
<a name="tthFtNtAAC"></a><a href="#tthFrefAAC"><sup>2</sup></a>The notation used for grammar definition is a tabularised BNF . Each boxed table
defines a production, with the production name in the left column. Each line
in the right column is an alternative for the production. The metasymbol + indicates
one or more repetitions of what immediately preceeds it. The Kleene star *
is used for zero or more repetitions. Terminal symbols are in single quotes.
Sequences in brackets [ ] are optional.

<p>
<a name="tthFtNtAAD"></a><a href="#tthFrefAAD"><sup>3</sup></a>When pixels are represented as integers in the range 0..255, a 50% contrast
reduction has to be expressed as  ((p<font face="symbol">-</font
>128)<font face="symbol">¸</font
>2)+128 .

<p>
<a name="tthFtNtAAE"></a><a href="#tthFrefAAE"><sup>4</sup></a>The Pascal concept of static variables should not be equated with the notion
of static variables in some other languages such as C or Java. In Pascal a variable
is considered static if its offset either relative to the stack base or relative
to the start of the global segment can be determined at compile/link time. In
C a variable is static only if its location relative to the start of the global
segment is known at compile time.

<p>
<a name="tthFtNtAAF"></a><a href="#tthFrefAAF"><sup>5</sup></a>see section <a href="#block">4</a>.

<p>
<a name="tthFtNtAAG"></a><a href="#tthFrefAAG"><sup>6</sup></a>See section <a href="#manimplicitindices">3.2.1</a>.

<p>
<a name="tthFtNtAAH"></a><a href="#tthFrefAAH"><sup>7</sup></a>This compilation strategy requires that true is equivalent to -1 and false to
0. This is typically the representation of booleans returned by vector comparison
instructions on SIMD instruction sets. In Vector Pascal this representation
is used generally and in consequence, <tt>true</tt>  &lt;  <tt>false</tt>.

<p>
<a name="tthFtNtAAI"></a><a href="#tthFrefAAI"><sup>8</sup></a>Vector Pascal allows function results to be of any non-procedural type.

<p>
<a name="tthFtNtAAJ"></a><a href="#tthFrefAAJ"><sup>9</sup></a>Refer to separate section of for the rationale of the maths syntax converter.
<p>
<a name="tthFtNtABA"></a><a href="#tthFrefABA"><sup>10</sup></a>Precise mathematical notation although perhaps desirable is a more complex operation than the time allotted to the project would allow but none the less 
an interesting development for the future.
<p>
<a name="tthFtNtABB"></a><a href="#tthFrefABB"><sup>11</sup></a>Unique to the best of our knowledge at the time of submission.
<p>
<a name="tthFtNtABC"></a><a href="#tthFrefABC"><sup>12</sup></a>Processors currently supported are the Intel 486,Pentuin ,P3 and The Athalon K6.
<br /><br /><hr /><small>File translated from
T<sub><font size="-1">E</font></sub>X
by <a href="http://hutchinson.belmont.ma.us/tth/">
T<sub><font size="-1">T</font></sub>H</a>,
version 3.05.<br />On 14 Oct 2002, 11:52.</small>
</html>
