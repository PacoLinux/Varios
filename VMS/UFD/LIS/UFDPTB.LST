UFDPTB - PARSER	STATE TABLE	MACRO M1110  22-AUG-78 00:40
TABLE OF CONTENTS

     1-    3	TITLE PAGE
     1-   26	MACRO CALLS AND DEFINTIONS
     1-   34	IMPURE DATA
     2-   42	STATE TABLE FOR PARSER
     3-  168	ACTION ROUTINES	FOR THE	COMMAND	LINE PARSER
UFDPTB - PARSER	STATE TABLE	MACRO M1110  22-AUG-78 00:40  PAGE 1


      1						.TITLE	UFDPTB - PARSER	STATE TABLE
      2
      3					.SBTTL	TITLE PAGE
      4
      5					.IDENT	"V0107"
      6
      7					;
      8					; COPYRIGHT  1975,  DIGITAL  EQUIPMENT CORP., MAYNARD,	MASS.
      9					; COPYRIGHT  1974,  DIGITAL  EQUIPMENT CORP., MAYNARD,	MASS.
     10					;
     11					; THIS SOFTWARE	IS FURNISHED TO	PURCHASER UNDER	A LICENSE FOR USE
     12					; ON A SINGLE COMPUTER SYSTEM AND CAN BE COPIED	(WITH INCLUSION
     13					; OF DEC'S COPYRIGHT NOTICE) ONLY FOR USE IN SUCH SYSTEM, EXCEPT
     14					; AS MAY OTHERWISE BE PROVIDED IN WRITING BY DEC.
     15					;
     16					; THE INFORMATION IN THIS DOCUMENT IS SUBJECT TO CHANGE	WITHOUT
     17					; NOTICE AND SHOULD NOT	BE CONSTRUED AS	A COMMITMENT BY	DIGITAL
     18					; EQUIPMENT CORPORATION.
     19					;
     20					; DEC ASSUMES NO RESPONSIBILITY	FOR THE	USE OR RELIABILITY
     21					; OF ITS SOFTWARE ON EQUIPMENT WHICH IS	NOT SUPPLIED BY	DEC.
     22					;
     23					; ANDREW C. GOLDSTEIN  23-JUN-78  14:16
     24
     25
     26					.SBTTL	MACRO CALLS AND DEFINTIONS
     27
     28					; SYSTEM MACRO CALLS
     29
     30						.MCALL	FHDOF$,ISTAT$,STATE$,TRAN$
     31
     32	000000					FHDOF$
     33
     34					.SBTTL	IMPURE DATA
     35
     36	000000					.PSECT	IMPURE,D
     37
     38	000000				GRCNT:	.BLKW	1		; GROUP	COUNTER	FOR PROTECTION PARSE
     39	000002				SAVUIC:	.BLKW	2		; TEMP STORAGE FOR UIC
     40
UFDPTB - PARSER	STATE TABLE	MACRO M1110  22-AUG-78 00:40  PAGE 2
STATE TABLE FOR PARSER

     42					.SBTTL	STATE TABLE FOR PARSER
     43
     44		000074 			LAB	= '<
     45		000076 			RAB	= '>
     46
     47	000006					ISTAT$  .UFDST,.UFDKT
     48					;
     49					; READ OVER COMMAND NAME
     50					;
     51						.GLOBL .PSTRT
     52
     53	000000					STATE$  .PSTRT
     54	000000					TRAN$	40,DEV,SETSP
     55	000000					TRAN$	$ANY,.PSTRT
     56					;
     57					; READ DEVICE AND UNIT NUMBER
     58					;
     59	000000					STATE$  DEV
     60	000000					TRAN$	!LOGNAM,DEV2,SETDEV
     61	000000					TRAN$	$LAMDA,DIR
     62
     63	000000					STATE$	DEV2
     64	000000					TRAN$	':
     65					;
     66					; READ DIRECTORY STRING
     67					;
     68	000000					STATE$	DIR
     69	000000					TRAN$	!UIC,OPTS,MAKUIC
     70	000000					TRAN$	!NAME
     71					;
     72					; SCAN FOR OPTIONS AND END OF LINE
     73					;
     74	000000					STATE$  OPTS
     75	000000					TRAN$	$EOS,$EXIT
     76	000000					TRAN$	'/
     77
     78	000000					STATE$
     79	000000					TRAN$	"UIC",UIC1
     80	000000					TRAN$	"ALLOC",ALC
     81	000000					TRAN$	"PRO",PRO
     82					;
     83					; SET OWNER UIC
     84					;
     85	000000					STATE$  UIC1
     86	000000					TRAN$	'=
     87
     88	000000					STATE$
     89	000000					TRAN$	!UIC,OPTS
     90					;
     91					; SET ALLOCATION
     92					;
     93	000000					STATE$  ALC
     94	000000					TRAN$	'=
     95
     96	000000					STATE$
     97	000000					TRAN$	$DNUMB,,SETALC
     98
UFDPTB - PARSER	STATE TABLE	MACRO M1110  22-AUG-78 00:40  PAGE 2-1
STATE TABLE FOR PARSER

     99	000000					STATE$
    100	000000					TRAN$	'.,OPTS
    101	000000					TRAN$	$LAMDA,OPTS
    102					;
    103					; PROTECTION
    104					;
    105	000000					STATE$  PRO
    106	000000					TRAN$	'=
    107
    108	000000					STATE$
    109	000000					TRAN$	'[,,IGROUP
    110
    111	000000					STATE$  SPRO
    112	000000					TRAN$	'],OPTS,ENDGRP
    113	000000					TRAN$	<',>,SPRO,NXGRP
    114	000000					TRAN$	'R,SPRO,SETRP
    115	000000					TRAN$	'W,SPRO,SETWP
    116	000000					TRAN$	'E,SPRO,SETEP
    117	000000					TRAN$	'D,SPRO,SETDP
    118					;
    119					; READ UIC
    120					;
    121	000000					STATE$  UIC
    122	000000					TRAN$	LAB,UIC0
    123	000000					TRAN$	'[
    124
    125	000000					STATE$	UIC0
    126	000000					TRAN$	$NUMBR,,SETGN
    127
    128	000000					STATE$
    129	000000					TRAN$	<',>
    130
    131	000000					STATE$
    132	000000					TRAN$	$NUMBR,,SETPN
    133
    134	000000					STATE$
    135	000000					TRAN$	RAB,$EXIT,GETUIC
    136	000000					TRAN$	'],$EXIT,GETUIC
    137					;
    138					; READ ALPHA DIRECTORY NAME
    139					;
    140	000000					STATE$  NAME
    141	000000					TRAN$	LAB,NAME1
    142	000000					TRAN$	'[
    143
    144	000000					STATE$  NAME1
    145	000000					TRAN$	$STRNG,,MAKER5
    146
    147	000000					STATE$
    148	000000					TRAN$	'.,NAME1
    149	000000					TRAN$	RAB,$EXIT
    150	000000					TRAN$	'],$EXIT
    151					;
    152					; MATCH	LOGICAL	NAME STRING
    153					;
    154	000000					STATE$  LOGNAM
    155	000000					TRAN$	$STRNG,LNAM1
UFDPTB - PARSER	STATE TABLE	MACRO M1110  22-AUG-78 00:40  PAGE 2-2
STATE TABLE FOR PARSER

    156	000000					TRAN$	'$,LNAM1
    157	000000					TRAN$	'_,LNAM1
    158
    159	000000					STATE$	LNAM1
    160	000000					TRAN$	$STRNG,LNAM1
    161	000000					TRAN$	'$,LNAM1
    162	000000					TRAN$	'_,LNAM1
    163	000000					TRAN$	$LAMDA,$EXIT
    164
    165	000000					STATE$
    166
UFDPTB - PARSER	STATE TABLE	MACRO M1110  22-AUG-78 00:40  PAGE 3
ACTION ROUTINES	FOR THE	COMMAND	LINE PARSER

    168					.SBTTL	ACTION ROUTINES	FOR THE	COMMAND	LINE PARSER
    169
    170	000000					.PSECT	CODE
    171					;
    172					; SET SPACE FLUSH MODE AFTER PASSING COMMAND NAME
    173					;
    174	000000	042767 	000001 	000000G	SETSP:	BIC	#1,.PFLAG
    175	000006	000207 				RETURN
    176					;
    177					; DEVICE NAME
    178					;
    179	000010	016767 	000000G	000000G	SETDEV:	MOV	.PSTCN,$UDEV
    180	000016	016767 	000000G	000002G		MOV	.PSTPT,$UDEV+2
    181	000024	000207 				RETURN
    182					;
    183					; PPN -	GROUP NUMBER
    184					;
    185	000026	016767 	000000G	000004'	SETGN:	MOV	.PNUMB,SAVUIC+2
    186	000034	000403 				BR	TSTPN
    187					;
    188					; PPN -	PROGRAMMER NUMBER
    189					;
    190	000036	016767 	000000G	000002'	SETPN:	MOV	.PNUMB,SAVUIC
    191	000044	005767 	000000G		TSTPN:	TST	.PNUMH		;CHECK IF NUMBER IS IN RANGE
    192	000050	001402 				BEQ	10$		; BRANCH IF OK
    193	000052	062716 	000002 			ADD	#2,(SP)		; OVER 65K - REJECT TRANSITION
    194	000056	000207 			10$:	RETURN
    195					;
    196					; STORE	UIC FOR	REAL ON	SUCCESSFUL MATCH
    197					;
    198	000060	016767 	000002'	000000G	GETUIC:	MOV	SAVUIC,$UUIC
    199	000066	016767 	000004'	000002G		MOV	SAVUIC+2,$UUIC+2
    200	000074	000207 				RETURN
    201					;
    202					; TO HERE FOR ACTION ROUTINE DETECTED SYNTAX ERRORS
    203					;
    204	000076	000167 	000000G		SYNTAX:	JMP	SYNERR
    205					;
    206					; NUMBER OF ENTRIES TO ALLOCATE
    207					;
    208	000102	016767 	000000G	000000G	SETALC:	MOV	.PNUMB,$UALL
    209	000110	000207 				RETURN
    210					;
    211					; CONVERT PPN TO RAD-50	FILE NAME
    212					;
    213	000112	105767 	000001G		MAKUIC:	TSTB	$UUIC+1		; UIC MUST BE LIMITED TO BYTE VALUES
    214	000116	001367 				BNE	SYNTAX
    215	000120	105767 	000003G			TSTB	$UUIC+3		; UIC MUST BE LIMITED TO BYTE VALUES
    216	000124	001364 				BNE	SYNTAX
    217	000126	010546 				MOV	R5,-(SP)
    218	000130	010446 				MOV	R4,-(SP)
    219	000132	010346 				MOV	R3,-(SP)
    220	000134	012702 	000000G			MOV	#STRING,R2	; POINT	TO STRING BUFFER
    221	000140	005003 				CLR	R3		; GET UIC (LOW BYTES OF	EACH HALF)
    222	000142	156703 	000002G			BISB	$UUIC+2,R3
    223	000146	000303 				SWAB	R3
    224	000150	156703 	000000G			BISB	$UUIC,R3
UFDPTB - PARSER	STATE TABLE	MACRO M1110  22-AUG-78 00:40  PAGE 3-1
ACTION ROUTINES	FOR THE	COMMAND	LINE PARSER

    225	000154	012704 	000003 			MOV	#3,R4		; REQUEST NO PUNCTUATION, LEADING ZERS
    226	000160	004767 	000000G			CALL	.PPASC		; CONVERT UIC TO ASCII
    227	000164	012603 				MOV	(SP)+,R3
    228	000166	012604 				MOV	(SP)+,R4
    229	000170	000423 				BR	R50
    230					;
    231					; CONVERT NAME TO RAD-50
    232					;
    233	000172	010546 			MAKER5:	MOV	R5,-(SP)
    234	000174	016700 	000000G			MOV	.PSTPT,R0	; GET ADDRESS OF NAME STRING
    235	000200	016701 	000000G			MOV	.PSTCN,R1	; AND COUNT
    236	000204	060167 	000000G			ADD	R1,$NAMEL	; ACCUMULATE DIRECTORY LENGTH
    237	000210	005267 	000000G			INC	$NAMEL
    238	000214	026727 	000000G	000074 		CMP	$NAMEL,#60.	; LIMIT IS 60 CHARACTERS
    239	000222	101402 				BLOS	20$
    240	000224	000167 	000000G			JMP	NAMLEN
    241	000230	012702 	000000G		20$:	MOV	#STRING,R2	; POINT TO STRING BUFFER
    242	000234	112022 			30$:	MOVB	(R0)+,(R2)+	; COPY	STRING INTO ZERO FILLED	BUFFER
    243	000236	077102 				SOB	R1,30$
    244
    245	000240	020227 	000011G		R50:	CMP	R2,#STRING+9.	; CHECK LENGTH	OF NAME	STRING
    246	000244	101314 				BHI	SYNTAX		; LIMITED TO 9	CHARACTERS
    247	000246	105022 				CLRB	(R2)+		; ZERO	PAD THE	STRING
    248	000250	105022 				CLRB	(R2)+
    249	000252	105022 				CLRB	(R2)+
    250	000254	016705 	000000G			MOV	$NAMEP,R5	; POINT TO NAME BLOCK
    251	000260	026727 	000000G	000010 		CMP	$NAMEC,#8.	; CHECK COUNT OF NAMES	SO FAR
    252	000266	103402 				BLO	40$
    253	000270	000167 	000000G			JMP	NAMLEV
    254	000274	012700 	000000G		40$:	MOV	#STRING,R0	; CHECK COUNT OF NAMES	SO FAR
    255	000300	004767 	000000G			CALL	$CAT5		; CONVERT TO RAD-50
    256	000304	010125 				MOV	R1,(R5)+	; PUT IN NAME
    257	000306	004767 	000000G			CALL	$CAT5		; GET 2ND RAD-50 WORD
    258	000312	010125 				MOV	R1,(R5)+
    259	000314	004767 	000000G			CALL	$CAT5		; GET 3RD RAD-50 WORD
    260	000320	010125 				MOV	R1,(R5)+
    261	000322	010567 	000000G			MOV	R5,$NAMEP	; SET UP FOR NEXT NAME
    262	000326	012605 				MOV	(SP)+,R5
    263	000330	005267 	000000G			INC	$NAMEC
    264	000334	000207 				RETURN
    265					;
    266					; SET PERMISSIONS
    267					; INITIALIZE
    268					;
    269	000336	012767 	000004 	000000'	IGROUP:	MOV	#4,GRCNT
    270					;
    271					; MOVE TO NEXT PERMISSIONS CATEGORY
    272					;
    273	000344	000261 			NXGRP:	SEC			; FORCE ONES
    274	000346	006067 	000000G			ROR	$UPRO
    275	000352	006267 	000000G			ASR	$UPRO		; SHIFT TO NEXT GROUP
    276	000356	006267 	000000G			ASR	$UPRO
    277	000362	006267 	000000G			ASR	$UPRO
    278	000366	005367 	000000'			DEC	GRCNT		; COUNT GROUPS
    279	000372	002641 				BLT	SYNTAX		; TOO MANY IS AN ERROR
    280	000374	000207 				RETURN
    281					;
UFDPTB - PARSER	STATE TABLE	MACRO M1110  22-AUG-78 00:40  PAGE 3-2
ACTION ROUTINES	FOR THE	COMMAND	LINE PARSER

    282					; SET READ PERMIT
    283					;
    284	000376	042767 	010000 	000000G	SETRP:	BIC	#FP.RDV*10000,$UPRO
    285	000404	000207 				RETURN
    286					;
    287					; SET WRITE PERMIT
    288					;
    289	000406	042767 	020000 	000000G	SETWP:	BIC	#FP.WRV*10000,$UPRO
    290	000414	000207 				RETURN
    291					;
    292					; SET EXTEND PERMIT
    293					;
    294	000416	042767 	040000 	000000G	SETEP:	BIC	#FP.EXT*10000,$UPRO
    295	000424	000207 				RETURN
    296					;
    297					; SET DELETE PERMIT
    298					;
    299	000426	042767 	100000 	000000G	SETDP:	BIC	#FP.DEL*10000,$UPRO
    300	000434	000207 				RETURN
    301					;
    302					; END OF PROTECTION SPEC
    303					;
    304	000436	005767 	000000'		ENDGRP:	TST	GRCNT		; CHECK THE GROUP COUNT
    305	000442	001215 				BNE	SYNTAX		; MUST HAVE 4
    306	000444	000207 				RETURN
    307
    308		000001 				.END
UFDPTB - PARSER	STATE TABLE	MACRO M1110  22-AUG-78 00:40  PAGE 3-3
SYMBOL TABLE

ALC     000076R     003	H.UFAT= 000016   	M.MAX = 000011   	SPRO    000122R     003	$NAMEP= ****** GX
DEV     000012R     003	IGROUP  000336R     006	M.RTRV= 000012   	STRING= ****** GX	$NUMBR= 000302
DEV2    000026R     003	I.CRDT= 000031   	M.USE = 000010   	SYNERR= ****** GX	$RAD50= 000316
DIR     000030R     003	I.CRTI= 000040   	NAME    000222R     003	SYNTAX  000076R     006	$STRNG= 000304
ENDGRP  000436R     006	I.DASZ= 000007   	NAME1   000230R     003	S.HDHD= 000056   	$SUBXP= 000310
FP.DEL= 000010   	I.EXDT= 000046   	NAMLEN= ****** GX	S.IDHD= 000056   	$UALL = ****** GX
FP.EXT= 000004   	I.FNAM= 000000   	NAMLEV= ****** GX	S.MPHD= 000012   	$UDEV = ****** GX
FP.RAT= 000001   	I.FTYP= 000006   	NXGRP   000344R     006	TSTPN   000044R     006	$UPRO = ****** GX
FP.RDV= 000001   	I.FVER= 000010   	OPTS    000044R     003	UC.CON= 000200   	$UUIC = ****** GX
FP.WRV= 000002   	I.RVDT= 000014   	PRO     000114R     003	UC.DLK= 000100   	$$$FLG= 177777
GETUIC  000060R     006	I.RVNO= 000012   	RAB   = 000076   	UIC     000166R     003	$$$KEY= 000002
GRCNT   000000R     002	I.RVTI= 000023   	R50     000240R     006	UIC0    000174R     003	$$$STA= 000000
H.CKSM= 000776   	I.TISZ= 000006   	SAVUIC  000002R     002	UIC1    000066R     003	$$$TMP= 000012R     005
H.FCHA= 000014   	LAB   = 000074   	SC.BAD= 000100   	$ALPHA= 000322   	.PFLAG= ****** GX
H.FLEV= 000006   	LNAM1   000264R     003	SC.MDL= 000200   	$ANY  = 000320   	.PNUMB= ****** GX
H.FNUM= 000002   	LOGNAM  000250R     003	SETALC  000102R     006	$BLANK= 000306   	.PNUMH= ****** GX
H.FOWN= 000010   	MAKER5  000172R     006	SETDEV  000010R     006	$CAT5 = ****** GX	.PPASC= ****** GX
H.FPRO= 000012   	MAKUIC  000112R     006	SETDP   000426R     006	$DIGIT= 000324   	.PSTCN= ****** GX
H.FSEQ= 000004   	M.CTSZ= 000006   	SETEP   000416R     006	$DNUMB= 000314   	.PSTPT= ****** GX
H.IDOF= 000000   	M.EFNU= 000002   	SETGN   000026R     006	$EOS  = 000312   	.PSTRT  000000RG    003
H.MPOF= 000001   	M.EFSQ= 000004   	SETPN   000036R     006	$EXIT = 000000   	.UFDKT  000000RG    004
H.PROG= 000010   	M.ERVN= 000001   	SETRP   000376R     006	$LAMDA= 000300   	.UFDST  000000RG    003
H.PROJ= 000011   	M.ESQN= 000000   	SETSP   000000R     006	$NAMEC= ****** GX	...GBL= 000000
H.SCHA= 000015   	M.LBSZ= 000007   	SETWP   000406R     006	$NAMEL= ****** GX	...TPC= 000012
H.UCHA= 000014

. ABS.	000000	   000
      	000000	   001
IMPURE	000006	   002
$STATE	000304	   003
$KTAB 	000006	   004
$KSTR 	000016	   005
CODE  	000446	   006
ERRORS DETECTED:  0

VIRTUAL MEMORY USED:  2224 WORDS  ( 9 PAGES)
DYNAMIC MEMORY:  2772 WORDS  ( 10 PAGES)
ELAPSED TIME:  00:01:04
OBJ$:UFDPTB,LIS$:UFDPTB/-SP=SRC$:UFDPTB
