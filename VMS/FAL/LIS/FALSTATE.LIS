FALSTATE        - STATE TRANSITION PROCESSING                    22-AUG-1978 01:14:52   VAX-11 MACRO X0.3-11               Page   0
TABLE OF CONTENTS   

   (2)      39  DECLARATIONS
   (3)     135  FAL$STATE - STATE TRANSITION
   (4)     204  FAL$STATE_TABLE - FAL STATE TRANSITION TABLE
FALSTATE        - STATE TRANSITION PROCESSING                    22-AUG-1978 01:14:52   VAX-11 MACRO X0.3-11               Page   1
X0.1-13                                                                                                                          (1)

                                     0000     1 	.TITLE	FALSTATE - STATE TRANSITION PROCESSING
                                     0000     2 	.IDENT	/X0.1-13/
                                     0000     3 
                                     0000     4 ;
                                     0000     5 ;			  COPYRIGHT (c) 1977, 1978 BY
                                     0000     6 ;	      DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASS.
                                     0000     7 ;
                                     0000     8 ; THIS SOFTWARE IS FURNISHED UNDER A LICENSE AND MAY BE USED AND  COPIED
                                     0000     9 ; ONLY  IN  ACCORDANCE  WITH  THE  TERMS  OF  SUCH  LICENSE AND WITH THE
                                     0000    10 ; INCLUSION OF THE ABOVE COPYRIGHT NOTICE.  THIS SOFTWARE OR  ANY  OTHER
                                     0000    11 ; COPIES  THEREOF MAY NOT BE PROVIDED OR OTHERWISE MADE AVAILABLE TO ANY
                                     0000    12 ; OTHER PERSON.  NO TITLE TO AND OWNERSHIP OF  THE  SOFTWARE  IS  HEREBY
                                     0000    13 ; TRANSFERRED.
                                     0000    14 ;
                                     0000    15 ; THE INFORMATION IN THIS SOFTWARE IS SUBJECT TO CHANGE  WITHOUT  NOTICE
                                     0000    16 ; AND  SHOULD  NOT  BE  CONSTRUED  AS  A COMMITMENT BY DIGITAL EQUIPMENT
                                     0000    17 ; CORPORATION.
                                     0000    18 ;
                                     0000    19 ; DIGITAL ASSUMES NO RESPONSIBILITY FOR THE USE OR  RELIABILITY  OF  ITS
                                     0000    20 ; SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DIGITAL.
                                     0000    21 ;
                                     0000    22 
                                     0000    23 ;++
                                     0000    24 ; FACILITY: DECNET FILE ACCESS LISTENER (FAL)
                                     0000    25 ;
                                     0000    26 ; ABSTRACT: STATE TRANSITION PROCESSING FOR FAL
                                     0000    27 ;
                                     0000    28 ; ENVIRONMENT:
                                     0000    29 ;
                                     0000    30 ;	THE FAL IMAGE EXECUTES IN THE CONTEXT OF A PROCESS CREATED BY
                                     0000    31 ;	NETACP. IT RUNS IN USER MODE AND REQUIRES NETWORK PRIVILEGE.
                                     0000    32 ;
                                     0000    33 ; AUTHOR: JAMES A. KRYCKA,	CREATION DATE: 16-JUN-77
                                     0000    34 ;
                                     0000    35 ; MODIFICATIONS:
                                     0000    36 ;
                                     0000    37 ;--
FALSTATE        - STATE TRANSITION PROCESSING                    22-AUG-1978 01:14:52   VAX-11 MACRO X0.3-11               Page   2
X0.1-13         DECLARATIONS                                                                                                     (2)

                                     0000    39 	.SBTTL	DECLARATIONS
                                     0000    40 
                                     0000    41 ;
                                     0000    42 ; INCLUDE FILES:
                                     0000    43 ;
                                     0000    44 	$DAPDEF				; DEFINE DAP CONTROL BLOCK SYMBOLS
                                     0000    45 	$FALWRKDEF			; DEFINE FAL WORK AREA SYMBOLS
                                     0000    46 ;	.LIST	MEB
                                     0000    47 ;
                                     0000    48 ; MACROS:
                                     0000    49 ;
                                     0000    50 ;++
                                     0000    51 ; STATE_INIT INITIALIZES THE STATE TRANSITION TABLE.
                                     0000    52 ;	LABEL	= THE GLOBAL SYMBOL TO DENOTE THE START OF THE TABLE.
                                     0000    53 ;--
                                     0000    54 
                                     0000    55 	.MACRO	STATE_INIT	LABEL
                                     0000    56 	.ALIGN	LONG
                                     0000    57 LABEL::
                                     0000    58 COUNT...=0
                                     0000    59 	.ENDM	STATE_INIT
                                     0000    60 
                                     0000    61 ;++
                                     0000    62 ; STATE DEFINES A TRANSFER OF CONTROL POINT IN THE STATE TRANSITION TABLE.
                                     0000    63 ;	NAME	= THE NAME OF THE STATE.
                                     0000    64 ;--
                                     0000    65 
                                     0000    66 	.MACRO	STATE	NAME
                                     0000    67 NAME=COUNT...
                                     0000    68 	.ENDM	STATE
                                     0000    69 
                                     0000    70 ;++
                                     0000    71 ; TRAN DEFINES A STATE TRANSITION TABLE ENTRY.
                                     0000    72 ;	VALUE	= THE VALUE TO COMPARE AGAINST THE STATE VALUE.
                                     0000    73 ;		  (NULL DENOTES THAT STATE VALUE IS A MATCH.)
                                     0000    74 ;	ACTION	= ADDRESS OF OPTIONAL ACTION ROUTINE TO EXECUTE.
                                     0000    75 ;		  (NULL DENOTES NO ACTION ROUTINE TO EXECUTE.)
                                     0000    76 ;	SUCCESS = NAME OF THE STATE TO GOTO ON ACTION ROUITNE SUCCESS.
                                     0000    77 ;		  (IF NO ACTION ROUTINE IS SPECIFIED, THIS PATH IS TAKEN.)
                                     0000    78 ;		  (NULL DENOTES GOTO NEXT TRANSITION ENTRY.)
                                     0000    79 ;	FAILURE	= NAME OF THE STATE TO GOTO ON ACTION ROUTINE FAILURE.
                                     0000    80 ;		  (NULL DENOTES GOTO NEXT TRANSITION ENTRY.)
                                     0000    81 ;--
                                     0000    82 
                                     0000    83 	.MACRO	TRAN	VALUE,ACTION,SUCCESS,FAILURE
                                     0000    84 	.IF B	VALUE
                                     0000    85 	.WORD	M_MATCH
                                     0000    86 	.IFF
                                     0000    87 	.WORD	VALUE@8
                                     0000    88 	.ENDC
                                     0000    89 	.IF B	SUCCESS
                                     0000    90 	.BYTE	COUNT...+1
                                     0000    91 	.IFF
                                     0000    92 	.BYTE	SUCCESS
                                     0000    93 	.ENDC
                                     0000    94 	.IF B	FAILURE
                                     0000    95 	.BYTE	COUNT...+1
FALSTATE        - STATE TRANSITION PROCESSING                    22-AUG-1978 01:14:52   VAX-11 MACRO X0.3-11               Page   3
X0.1-13         DECLARATIONS                                                                                                     (2)

                                     0000    96 	.IFF
                                     0000    97 	.BYTE	FAILURE
                                     0000    98 	.ENDC
                                     0000    99 	.IF B	ACTION
                                     0000   100 	.ADDRESS 0
                                     0000   101 	.IFF
                                     0000   102 	.ADDRESS ACTION
                                     0000   103 	.ENDC
                                     0000   104 	COUNT...=COUNT...+1
                                     0000   105 	.ENDM	TRAN
                                     0000   106 
                                     0000   107 ;++
                                     0000   108 ; STATE_EXIT DEFINES A STATE TRANSITION TABLE ENTRY THE DIRECTS THE
                                     0000   109 ; TRANSITION TABLE PARSER (FAL$STATE) TO EXIT TO ITS CALLER.
                                     0000   110 ;--
                                     0000   111 
                                     0000   112 	.MACRO	STATE_EXIT
                                     0000   113 	.QUAD	M_EXIT
                                     0000   114 	.ENDM	STATE_EXIT
                                     0000   115 
                                     0000   116 ;
                                     0000   117 ; EQUATED SYMBOLS:
                                     0000   118 ;
                                     0000   119 ;	STATE TABLE ENTRY OFFSETS:
                                     0000   120 ;
                           00000000  0000   121 V_MATCH=0
                           00000001  0000   122 M_MATCH=<1@V_MATCH>
                           00000001  0000   123 V_EXIT=1
                           00000002  0000   124 M_EXIT=<1@V_EXIT>
                           00000000  0000   125 FLAGS=0
                           00000001  0000   126 VALUE=1
                           00000002  0000   127 SUCCESS=2
                           00000003  0000   128 FAILURE=3
                           00000004  0000   129 ACTION=4
                                     0000   130 ;
                                     0000   131 ; OWN STORAGE:
                                     0000   132 ;
                                     0000   133 ;	NONE
FALSTATE        - STATE TRANSITION PROCESSING                    22-AUG-1978 01:14:52   VAX-11 MACRO X0.3-11               Page   4
X0.1-13         FAL$STATE - STATE TRANSITION                                                                                     (3)

                                     0000   135 	.SBTTL	FAL$STATE - STATE TRANSITION
                                 00000000   136 	.PSECT	FAL$CODE	NOSHR,EXE,RD,NOWRT,BYTE
                                     0000   137 
                                     0000   138 ;++
                                     0000   139 ; FUNCTIONAL DESCRIPTION:
                                     0000   140 ;
                                     0000   141 ;	NONE
                                     0000   142 ;
                                     0000   143 ; CALLING SEQUENCE:
                                     0000   144 ;
                                     0000   145 ;	BSB/JSB	FAL$STATE
                                     0000   146 ;
                                     0000   147 ; INPUT PARAMETERS:
                                     0000   148 ;
                                     0000   149 ;	R2	ADDRESS OF STATE TRANSITION TABLE
                                     0000   150 ;	R8	ADDRESS OF FAL WORK AREA
                                     0000   151 ;	R9	ADDRESS OF DAP CONTROL BLOCK
                                     0000   152 ;	R10	ADDRESS OF FAB CONTROL BLOCK
                                     0000   153 ;	R11	ADDRESS OF RAB CONTROL BLOCK
                                     0000   154 ;
                                     0000   155 ; IMPLICIT INPUTS:
                                     0000   156 ;
                                     0000   157 ;	FAL$Q_STATE_CTX
                                     0000   158 ;	FAL$B_VALUE
                                     0000   159 ;
                                     0000   160 ; OUTPUT PARAMETERS:
                                     0000   161 ;
                                     0000   162 ;	R0-R7	DESTROYED
                                     0000   163 ;
                                     0000   164 ; IMPLICIT OUTPUTS:
                                     0000   165 ;
                                     0000   166 ;	FAL$Q_STATE_CTX
                                     0000   167 ;	FAL$B_VALUE
                                     0000   168 ;
                                     0000   169 ; COMPLETION CODES:
                                     0000   170 ;
                                     0000   171 ;	NONE
                                     0000   172 ;
                                     0000   173 ; SIDE EFFECTS:
                                     0000   174 ;
                                     0000   175 ;	NONE
                                     0000   176 ;
                                     0000   177 ;--
                                     0000   178 
                                     0000   179 FAL$STATE::				; CONTROL POINT
            53            52     D0  0000   180 	MOVL	R2,R3			; INITIALIZE STATE TRANSITION
                                     0003   181 					;  ENTRY ADDRESS
            63            01     E0  0003   182 10$:	BBS	#V_EXIT,FLAGS(R3),99$	; BRANCH IF END OF TABLE
                          36         0006       
            63            00     E0  0007   183 	BBS	#V_MATCH,FLAGS(R3),20$	; BRANCH IF ANY VALUE IS A MATCH
                          0C         000A       
         10 A8         01 A3     91  000B   184 	CMPB	VALUE(R3),FAL$B_VALUE(R8) ; IS STATE VALUE A MATCH?
                          05     13  0010   185 	BEQL	20$			; BRANCH IF YES
            53            08     C0  0012   186 	ADDL2	#8,R3			; NO, FORM ADDRESS OF NEXT TABLE ENTRY
                          EC     11  0015   187 	BRB	10$			; TRY AGAIN
            54         04 A3     D0  0017   188 20$:	MOVL	ACTION(R3),R4		; GET ADDRESS OF ACTION ROUTINE
                          16     13  001B   189 	BEQL	30$			; BRANCH IF NO ROUTINE SPECIFIED
FALSTATE        - STATE TRANSITION PROCESSING                    22-AUG-1978 01:14:52   VAX-11 MACRO X0.3-11               Page   5
X0.1-13         FAL$STATE - STATE TRANSITION                                                                                     (3)

         08 A8            52     7D  001D   190 	MOVQ	R2,FAL$Q_STATE_CTX(R8)	; SAVE STATE TABLE CONTEXT (R2,R3)
            50            01     D0  0021   191 	MOVL	#1,R0			; SET-UP SUCCESS RETURN STATUS CODE
                          64     16  0024   192 	JSB	(R4)			; EXECUTE ACTION ROUTINE
            52         08 A8     7D  0026   193 	MOVQ	FAL$Q_STATE_CTX(R8),R2	; RESTORE STATE TABLE CONTEXT (R2,R3)
            06            50     E8  002A   194 	BLBS	R0,30$			; BRANCH ON SUCCESS
            54         03 A3     9A  002D   195 	MOVZBL	FAILURE(R3),R4		; GET FAILURE TABLE ENTRY INDEX
                          04     11  0031   196 	BRB	40$			; JOIN COMMON CODE
            54         02 A3     9A  0033   197 30$:	MOVZBL	SUCCESS(R3),R4		; GET SUCCESS TABLE ENTRY INDEX
            53            6244   7E  0037   198 40$:	MOVAQ	(R2)[R4],R3		; COMPUTE ADDRESS OF NEW TABLE ENTRY
                                     003B   199 					;  TAKING ADVANTAGE OF THE FACT THAT
                                     003B   200 					;  EACH ENTRY IS 8 BYTES LONG
                          C6     11  003B   201 	BRB	10$			; START AGAIN
                                 05  003D   202 99$:	RSB				; EXIT
FALSTATE        - STATE TRANSITION PROCESSING                    22-AUG-1978 01:14:52   VAX-11 MACRO X0.3-11               Page   6
X0.1-13         FAL$STATE_TABLE - FAL STATE TRANSITION TABLE                                                                     (4)

                                     003E   204 	.SBTTL	FAL$STATE_TABLE - FAL STATE TRANSITION TABLE
                                 00000000   205 	.PSECT	FAL$STATE_TABLE	SHR,NOEXE,RD,NOWRT,PAGE
                                     0000   206 
                                     0000   207 	STATE_INIT	FAL$STATE_TABLE
                                     0000   208 
                                     0000   209 ;
                                     0000   210 ; INITIALIZATION STATE.
                                     0000   211 ;
                                     0000   212 
                                     0000   213 	STATE	ST0
                                     0000   214 	TRAN	,		FAL$INITIALIZE,	ST1,	ST0
                                     0008   215 
                                     0008   216 ;
                                     0008   217 ; FILE ACCESS SET-UP STATE.
                                     0008   218 ;
                                     0008   219 
                                     0008   220 	STATE	ST1
                                     0008   221 	TRAN	,		FAL$NEXT_MSG,	,	ST1
                                     0010   222 	TRAN	DAP$K_CNF_MSG,	FAL$CNF,	ST1,	ST1
                                     0018   223 	TRAN	DAP$K_ATT_MSG,	FAL$ATT,	ST1,	ST1
                                     0020   224 	TRAN	DAP$K_ACC_MSG,	FAL$ACC,	ST1_1,	ST1
                                     0028   225 	TRAN	,		FAL$OUT_OF_SEQ,	FATAL,	ST1
                                     0030   226 
                                     0030   227 	STATE	ST1_1
                                     0030   228 	TRAN	DAP$K_OPEN,	FAL$OPEN,	ST2,	ST1
                                     0038   229 	TRAN	DAP$K_CREATE,	FAL$CREATE,	ST2,	ST1
                                     0040   230 	TRAN	DAP$K_ERASE,	FAL$ERASE,	ST1,	ST1
                                     0048   231 	TRAN	DAP$K_SUBMIT,	FAL$SUBMIT,	ST2,	ST1
                                     0050   232 	TRAN	DAP$K_EXECUTE,	FAL$EXECUTE,	ST1,	ST1
                                     0058   233 	TRAN	,		FAL$OUT_OF_SEQ,	FATAL,	ST1
                                     0060   234 
                                     0060   235 ;
                                     0060   236 ; RECORD STREAM SET-UP STATE.
                                     0060   237 ;
                                     0060   238 
                                     0060   239 	STATE	ST2
                                     0060   240 	TRAN	,		FAL$NEXT_MSG,	,	ST2
                                     0068   241 	TRAN	DAP$K_CTL_MSG,	FAL$CTL,	ST2_1,	ST2
                                     0070   242 	TRAN	DAP$K_CMP_MSG,	FAL$CMP,	ST2_2,	ST2
                                     0078   243 	TRAN	,		FAL$OUT_OF_SEQ,	FATAL,	ST2
                                     0080   244 
                                     0080   245 	STATE	ST2_1
                                     0080   246 	TRAN	DAP$K_CONNECT,	FAL$CONNECT,	ST3,	ST2
                                     0088   247 	TRAN	,		FAL$OUT_OF_SEQ,	FATAL,	ST2
                                     0090   248 
                                     0090   249 	STATE	ST2_2
                                     0090   250 	TRAN	DAP$K_CLOSE,	FAL$CLOSE,	ST0,	ST2
                                     0098   251 	TRAN	DAP$K_PURGE,	FAL$PURGE,	ST0,	ST2
                                     00A0   252 	TRAN	,		FAL$OUT_OF_SEQ,	FATAL,	ST2
                                     00A8   253 
                                     00A8   254 ;
                                     00A8   255 ; MAIN CONTROL STATE.
                                     00A8   256 ;
                                     00A8   257 
                                     00A8   258 	STATE	ST3
                                     00A8   259 	TRAN	,		FAL$NEXT_MSG,	,	ST3
                                     00B0   260 	TRAN	DAP$K_CTL_MSG,	FAL$CTL,	ST3_1,	ST3
FALSTATE        - STATE TRANSITION PROCESSING                    22-AUG-1978 01:14:52   VAX-11 MACRO X0.3-11               Page   7
X0.1-13         FAL$STATE_TABLE - FAL STATE TRANSITION TABLE                                                                     (4)

                                     00B8   261 	TRAN	DAP$K_CMP_MSG,	FAL$CMP,	ST3_2,	ST3
                                     00C0   262 	TRAN	,		FAL$OUT_OF_SEQ,	FATAL,	ST3
                                     00C8   263 
                                     00C8   264 	STATE	ST3_1
                                     00C8   265 	TRAN	DAP$K_GET_READ,	FAL$MODE,	ST6,	ST4
                                     00D0   266 	TRAN	DAP$K_PUT_WRITE,FAL$MODE,	ST7,	ST5
                                     00D8   267 	TRAN	DAP$K_UPDATE,	FAL$UPDATE,	ST3,	ST3
                                     00E0   268 	TRAN	DAP$K_DELETE,	FAL$DELETE,	ST3,	ST3
                                     00E8   269 	TRAN	DAP$K_REWIND,	FAL$REWIND,	ST3,	ST3
                                     00F0   270 ;	TRAN	DAP$K_TRUNCATE,	FAL$TRUNCATE,	ST3,	ST3
                                     00F0   271 	TRAN	DAP$K_SPACE,	FAL$SPACE,	ST3,	ST3
                                     00F8   272 	TRAN	DAP$K_FIND,	FAL$FIND,	ST3,	ST3
                                     0100   273 	TRAN	,		FAL$OUT_OF_SEQ,	FATAL,	ST3
                                     0108   274 
                                     0108   275 	STATE	ST3_2
                                     0108   276 	TRAN	DAP$K_CLOSE,	FAL$CLOSE,	ST0,	ST3
                                     0110   277 	TRAN	DAP$K_PURGE,	FAL$PURGE,	ST0,	ST3
                                     0118   278 	TRAN	DAP$K_DISCON,	FAL$DISCONNECT,	ST2,	ST3
                                     0120   279 	TRAN	,		FAL$OUT_OF_SEQ,	FATAL,	ST3
                                     0128   280 
                                     0128   281 ;
                                     0128   282 ; RECORD ACCESS MODE RETRIEVAL STATE.
                                     0128   283 ; SEND THE SPECIFIED RECORD/BLOCK TO THE PARTNER PROCESS. ENGAGE IN ERROR
                                     0128   284 ; RECOVERY DIALGOUE ON ENCOUNTERING AN END-OF-FILE OR ON ERROR IN ACCESSING
                                     0128   285 ; THE DATA.
                                     0128   286 ;
                                     0128   287 
                                     0128   288 	STATE	ST4
                                     0128   289 	TRAN	,		FAL$RETRV_REC,	ST3,	ST4A
                                     0130   290 
                                     0130   291 	STATE	ST4A
                                     0130   292 	TRAN	,		FAL$NEXT_MSG,	,	ST4A
                                     0138   293 	TRAN	DAP$K_CMP_MSG,	FAL$CMP,	ST3_2	ST4A
                                     0140   294 	TRAN	DAP$K_CON_MSG,	FAL$CON,	ST4A_1,	ST4A
                                     0148   295 	TRAN	,		FAL$OUT_OF_SEQ,	FATAL,	ST4A
                                     0150   296 
                                     0150   297 	STATE	ST4A_1
                                     0150   298 	TRAN	DAP$K_RETRY,	,		ST4,	FATAL
                                     0158   299 	TRAN	,		FAL$OUT_OF_SEQ,	FATAL,	ST4A
                                     0160   300 
                                     0160   301 ;
                                     0160   302 ; RECORD ACCESS MODE STORAGE STATE.
                                     0160   303 ; STORE EACH RECORD/BLOCK RECEIVED FROM THE PARTNER PROCESS UNTIL DIRECTED
                                     0160   304 ; TO PERFORM ANOTHER FUNCTION. ENGAGE IN ERROR RECOVERY DIALOGUE ON ERROR
                                     0160   305 ; IN STORING THE DATA.
                                     0160   306 ;
                                     0160   307 
                                     0160   308 	STATE	ST5
                                     0160   309 	TRAN	,		FAL$NEXT_MSG,	,	ST5
                                     0168   310 	TRAN	DAP$K_DAT_MSG,	FAL$STORE_REC,	ST5,	ST5A
                                     0170   311 	TRAN	DAP$K_CTL_MSG,	FAL$CTL,	ST3_1,	ST5
                                     0178   312 	TRAN	DAP$K_CMP_MSG,	FAL$CMP,	ST3_2,	ST5
                                     0180   313 	TRAN	,		FAL$OUT_OF_SEQ,	FATAL,	ST5
                                     0188   314 
                                     0188   315 	STATE	ST5A
                                     0188   316 	TRAN	,		FAL$INT_MSG,	,	ST5A
                                     0190   317 	TRAN	DAP$K_CON_MSG,	FAL$CON,	ST5A_1,	ST5A
FALSTATE        - STATE TRANSITION PROCESSING                    22-AUG-1978 01:14:52   VAX-11 MACRO X0.3-11               Page   8
X0.1-13         FAL$STATE_TABLE - FAL STATE TRANSITION TABLE                                                                     (4)

                                     0198   318 	TRAN	,		FAL$OUT_OF_SEQ,	FATAL,	ST5A
                                     01A0   319 
                                     01A0   320 	STATE	ST5A_1
                                     01A0   321 	TRAN	DAP$K_ABORT,	,		ST5A_2,	FATAL
                                     01A8   322 	TRAN	DAP$K_RETRY,	FAL$STORE_REC,	ST5,	ST5A
                                     01B0   323 	TRAN	,		FAL$OUT_OF_SEQ,	FATAL,	ST5A_1
                                     01B8   324 
                                     01B8   325 	STATE	ST5A_2
                                     01B8   326 	TRAN	,		FAL$NEXT_MSG,	,	ST5A_2
                                     01C0   327 	TRAN	DAP$K_CMP_MSG,	FAL$CMP,	ST3_2,	ST5A_2
                                     01C8   328 	TRAN	DAP$K_DAT_MSG,	,		ST5A_2,	FATAL
                                     01D0   329 	TRAN	,		FAL$OUT_OF_SEQ,	FATAL,	ST5A_2
                                     01D8   330 
                                     01D8   331 ;
                                     01D8   332 ; SEQUENTIAL FILE MODE RETRIEVAL STATE.
                                     01D8   333 ; SEND EACH RECORD/BLOCK REMAINING IN THE FILE TO THE PARTNER PROCESS.
                                     01D8   334 ; ENGAGE IN ERROR RECOVERY DIALOGUE ON ENCOUNTERING AN END-OF-FILE, ON
                                     01D8   335 ; ERROR IN ACCESSING THE DATA, OR IF DIRECTED BY PARTNER TO STOP BEFORE
                                     01D8   336 ; THE FUNCTION IS COMPLETED.
                                     01D8   337 ;
                                     01D8   338 
                                     01D8   339 	STATE	ST6
                                     01D8   340 	TRAN	,		FAL$LISTEN,	,	ST6A
                                     01E0   341 	TRAN	,		FAL$RETRV_REC,	ST6,	ST6A
                                     01E8   342 
                                     01E8   343 	STATE	ST6A
                                     01E8   344 	TRAN	,		FAL$NEXT_MSG,	,	ST6A
                                     01F0   345 	TRAN	DAP$K_CMP_MSG,	FAL$CMP,	ST3_2	ST6A
                                     01F8   346 	TRAN	DAP$K_CON_MSG,	FAL$CON,	ST6A_1,	ST6A
                                     0200   347 	TRAN	,		FAL$OUT_OF_SEQ,	FATAL,	ST6A
                                     0208   348 
                                     0208   349 	STATE	ST6A_1
                                     0208   350 	TRAN	DAP$K_RETRY,	,		ST6,	FATAL
                                     0210   351 	TRAN	DAP$K_SKIP_REC,	FAL$ADVANCE,	ST6,	FATAL
                                     0218   352 	TRAN	,		FAL$OUT_OF_SEQ,	FATAL,	ST6A
                                     0220   353 
                                     0220   354 ;
                                     0220   355 ; SEQUENTIAL FILE MODE STORAGE/APPEND STATE.
                                     0220   356 ; STORE EACH RECORD/BLOCK RECEIVED FROM PARTNER PROCESS UNTIL DIRECTED TO
                                     0220   357 ; CLOSE THE FILE. ENGAGE IN ERROR RECOVERY DIALOGUE ON ERROR IN STORING THE
                                     0220   358 ; DATA.
                                     0220   359 ;
                                     0220   360 
                                     0220   361 	STATE	ST7
                                     0220   362 	TRAN	,		FAL$NEXT_MSG,	,	ST7
                                     0228   363 	TRAN	DAP$K_DAT_MSG,	FAL$STORE_REC,	ST7,	ST7A
                                     0230   364 	TRAN	DAP$K_CMP_MSG,	FAL$CMP,	ST3_2,	ST7
                                     0238   365 	TRAN	,		FAL$OUT_OF_SEQ,	FATAL,	ST7
                                     0240   366 
                                     0240   367 	STATE	ST7A
                                     0240   368 	TRAN	,		FAL$INT_MSG,	,	ST7A
                                     0248   369 	TRAN	DAP$K_CON_MSG,	FAL$CON,	ST7A_1,	ST7A
                                     0250   370 	TRAN	,		FAL$OUT_OF_SEQ,	FATAL,	ST7A
                                     0258   371 
                                     0258   372 	STATE	ST7A_1
                                     0258   373 	TRAN	DAP$K_ABORT,	,		ST7A_2,	FATAL
                                     0260   374 	TRAN	DAP$K_RETRY,	FAL$STORE_REC,	ST7,	ST7A
FALSTATE        - STATE TRANSITION PROCESSING                    22-AUG-1978 01:14:52   VAX-11 MACRO X0.3-11               Page   9
X0.1-13         FAL$STATE_TABLE - FAL STATE TRANSITION TABLE                                                                     (4)

                                     0268   375 	TRAN	DAP$K_SKIP_REC,	,		ST7,	FATAL
                                     0270   376 
                                     0270   377 	STATE	ST7A_2
                                     0270   378 	TRAN	,		FAL$NEXT_MSG,	,	ST7A_2
                                     0278   379 	TRAN	DAP$K_CMP_MSG,	FAL$CMP,	ST3_2,	ST7A_2
                                     0280   380 	TRAN	DAP$K_DAT_MSG,	,		ST7A_2,	FATAL
                                     0288   381 	TRAN	,		FAL$OUT_OF_SEQ,	FATAL,	ST7A_2
                                     0290   382 
                                     0290   383 	STATE	FATAL
                                     0290   384 
                                     0290   385 	STATE_EXIT
                                     0298   386 	.END
FALSTATE        - STATE TRANSITION PROCESSING                    22-AUG-1978 01:14:52   VAX-11 MACRO X0.3-11               Page  10
SYMBOL TABLE                                                                                                                     (4)

ACTION         = 00000004            DAP$K_ECONUM_V = 00000002            DAP$M_CBT      = 00800000            
BIT...         = 00000018            DAP$K_ERASE    = 00000004            DAP$M_CIF      = 00010000            
COUNT...       = 00000052            DAP$K_EXECUTE  = 00000008            DAP$M_CTG      = 00000080            
DAP$B_ACCFUNC    00000060            DAP$K_FAC_I    = 00000040            DAP$M_DATATYPE = 00000001            
DAP$B_ACCOPT     00000061            DAP$K_FIND     = 0000000E            DAP$M_DEQ      = 00000800            
DAP$B_BKS        00000048            DAP$K_FIX      = 00000001            DAP$M_DEV      = 00004000            
DAP$B_CMPFUNC    00000080            DAP$K_FLAGS_I  = 00000004            DAP$M_DLK      = 00000010            
DAP$B_CONFUNC    0000007C            DAP$K_FOP_I    = 01020024            DAP$M_DLT      = 00400000            
DAP$B_CTLFUNC    0000006C            DAP$K_GET_READ = 00000001            DAP$M_DMO      = 00002000            
DAP$B_CTLMENU    0000006D            DAP$K_IDX      = 00000020            DAP$M_EMBEDDED = 00000010            
DAP$B_DATATYPE   0000003C            DAP$K_KEY_ACC  = 00000001            DAP$M_FID      = 00001000            
DAP$B_ECONUM     00000029            DAP$K_LSA      = 00000005            DAP$M_FOP      = 00001000            
DAP$B_FAC        00000062            DAP$K_OPEN     = 00000001            DAP$M_FSZ      = 00000100            
DAP$B_FIELD_ID   00000009            DAP$K_PURGE    = 00000003            DAP$M_GET      = 00000002            
DAP$B_FILESYS    00000027            DAP$K_PUT_WRITE= 00000004            DAP$M_IMAGE    = 00000002            
DAP$B_FLAGS      00000021            DAP$K_RAT_I    = 00000020            DAP$M_KEY      = 00000002            
DAP$B_FSZ        00000049            DAP$K_REL      = 00000010            DAP$M_MRN      = 00000200            
DAP$B_LENGTH     00000023            DAP$K_RESPONSE = 00000002            DAP$M_MRS      = 00000020            
DAP$B_MAC_CODE   0000000B            DAP$K_RETRY    = 00000001            DAP$M_MXV      = 00080000            
DAP$B_MSG_TYPE   0000000A            DAP$K_REWIND   = 00000006            DAP$M_NEF      = 00000200            
DAP$B_ORG        0000003D            DAP$K_RFA_ACC  = 00000002            DAP$M_NIL      = 00000040            
DAP$B_OSTYPE     00000026            DAP$K_RMS32    = 00000003            DAP$M_NONFATAL = 00000001            
DAP$B_RAC        0000006E            DAP$K_ROP_I    = 00000802            DAP$M_ORG      = 00000002            
DAP$B_RAT        0000003F            DAP$K_SEQ      = 00000000            DAP$M_POS      = 00000008            
DAP$B_RFM        0000003E            DAP$K_SEQ_ACC  = 00000000            DAP$M_RAC      = 00000001            
DAP$B_SHR        00000063            DAP$K_SEQ_FILE = 00000003            DAP$M_RAT      = 00000008            
DAP$B_SOFTVER    0000002B            DAP$K_SHR_I    = 00000090            DAP$M_RCK      = 00008000            
DAP$B_STREAMID   00000022            DAP$K_SKIP_REC = 00000002            DAP$M_RFM      = 00000004            
DAP$B_TYPE       00000020            DAP$K_SOFTVER_V= 00000001            DAP$M_ROP      = 00000008            
DAP$B_USRNUM     0000002A            DAP$K_SPACE    = 0000000B            DAP$M_RUNSYS   = 00000400            
DAP$B_USRSOFT    0000002C            DAP$K_STM      = 00000004            DAP$M_RWC      = 00000002            
DAP$B_VERNUM     00000028            DAP$K_STS_MSG  = 00000009            DAP$M_RWO      = 00000001            
DAP$C_BLN        000000C0            DAP$K_SUBMIT   = 00000007            DAP$M_SCF      = 00200000            
DAP$K_ABORT    = 00000003            DAP$K_SYSCAP_V = E00660E7            DAP$M_SPL      = 00100000            
DAP$K_ACCOPT_I = 00000008            DAP$K_UDF      = 00000000            DAP$M_SQO      = 00040000            
DAP$K_ACC_MSG  = 00000003            DAP$K_UPDATE   = 00000003            DAP$M_SUP      = 00000100            
DAP$K_ACK_MSG  = 00000006            DAP$K_USRNUM_V = 00000000            DAP$M_TMD      = 00000800            
DAP$K_ATTMENU_I= 0001A000            DAP$K_USRSOFT_V= 00000000            DAP$M_TMP      = 00000400            
DAP$K_ATT_MSG  = 00000002            DAP$K_VAR      = 00000002            DAP$M_WCK      = 00004000            
DAP$K_BLK_FILE = 00000005            DAP$K_VAXVMS   = 00000007            DAP$Q_DCODE_FLG  00000000            
DAP$K_BLK_VBN  = 00000004            DAP$K_VERNUM_V = 00000004            DAP$Q_FILEDATA   00000090            
DAP$K_BLN        000000C0            DAP$K_VFC      = 00000003            DAP$Q_FILESPEC   00000064            
DAP$K_BLS_D    = 00000200            DAP$L_ALQ        00000044            DAP$Q_KEY        00000070            
DAP$K_BUFSIZ_V = 00001100            DAP$L_ATTMENU    00000038            DAP$Q_MSG_BUF1   00000010            
DAP$K_CLOSE    = 00000001            DAP$L_DCODE_STS  00000008            DAP$Q_MSG_BUF2   00000018            
DAP$K_CMP_MSG  = 00000007            DAP$L_DEV        0000005C            DAP$Q_NUMBER     00000088            
DAP$K_CNF_MSG  = 00000001            DAP$L_FOP        00000058            DAP$Q_RFA        0000009C            
DAP$K_CONNECT  = 00000002            DAP$L_FOP2       00000084            DAP$Q_RUNSYS     00000050            
DAP$K_CON_MSG  = 00000005            DAP$L_MRN        0000004C            DAP$Q_SYSCAP     00000030            
DAP$K_CREATE   = 00000002            DAP$L_MSG_MASK   0000000C            DAP$Q_VERSION    00000028            
DAP$K_CTLMENU_I= 00000054            DAP$L_OPERATOR   00000020            DAP$S_TMP1..   = 0000000A            
DAP$K_CTL_MSG  = 00000004            DAP$L_RECNUM     000000A4            DAP$S_TMP2..   = 00000015            
DAP$K_DATATYP_I= 00000084            DAP$L_ROP        00000078            DAP$S_TMP3..   = 00000002            
DAP$K_DAT_MSG  = 00000008            DAP$L_STV        000000A8            DAP$S_TMP4..   = 00000008            
DAP$K_DELETE   = 00000005            DAP$M_ALQ      = 00000040            DAP$V_AFTER_V41= 00000020            
DAP$K_DEV_I    = 04000040            DAP$M_BKS      = 00000080            DAP$V_ALQ      = 00000006            
DAP$K_DISCON   = 00000004            DAP$M_BLS      = 00000010            DAP$V_APPEND   = 0000000D            
FALSTATE        - STATE TRANSITION PROCESSING                    22-AUG-1978 01:14:52   VAX-11 MACRO X0.3-11               Page  11
SYMBOL TABLE                                                                                                                     (4)

DAP$V_ASCII    = 00000000            DAP$V_MRS      = 00000005            FAILURE        = 00000003            
DAP$V_BIO      = 00000005            DAP$V_MSGBLK   = 00000012            FAL$ACC          ********   X   04   
DAP$V_BKS      = 00000007            DAP$V_MXV      = 00000013            FAL$ADVANCE      ********   X   04   
DAP$V_BLK      = 00000003            DAP$V_NEF      = 00000009            FAL$ATT          ********   X   04   
DAP$V_BLS      = 00000004            DAP$V_NIL      = 00000006            FAL$B_VALUE      00000010            
DAP$V_CBT      = 00000017            DAP$V_NONFATAL = 00000000            FAL$CLOSE        ********   X   04   
DAP$V_CIF      = 00000010            DAP$V_ORG      = 00000001            FAL$CMP          ********   X   04   
DAP$V_CR       = 00000001            DAP$V_POS      = 00000003            FAL$CNF          ********   X   04   
DAP$V_CTG      = 00000007            DAP$V_PRIV     = 00000005            FAL$CON          ********   X   04   
DAP$V_DATATYPE = 00000000            DAP$V_PRN      = 00000002            FAL$CONNECT      ********   X   04   
DAP$V_DEL      = 00000002            DAP$V_PUT      = 00000000            FAL$CREATE       ********   X   04   
DAP$V_DEQ      = 0000000B            DAP$V_RAC      = 00000000            FAL$CTL          ********   X   04   
DAP$V_DEV      = 0000000E            DAP$V_RANREC   = 00000006            FAL$C_WRKBLN     00000400            
DAP$V_DEVALL   = 0000000C            DAP$V_RANVBN   = 00000007            FAL$DELETE       ********   X   04   
DAP$V_DEVAVL   = 00000010            DAP$V_RAT      = 00000003            FAL$DISCONNECT   ********   X   04   
DAP$V_DEVCCL   = 00000001            DAP$V_RCK      = 0000000F            FAL$ERASE        ********   X   04   
DAP$V_DEVDIR   = 00000003            DAP$V_RELORG   = 00000002            FAL$EXECUTE      ********   X   04   
DAP$V_DEVDMT   = 0000000B            DAP$V_RFM      = 00000002            FAL$FIND         ********   X   04   
DAP$V_DEVELG   = 00000011            DAP$V_ROP      = 00000003            FAL$INITIALIZE   ********   X   04   
DAP$V_DEVFOD   = 00000007            DAP$V_RUNSYS   = 0000000A            FAL$INT_MSG      ********   X   04   
DAP$V_DEVFOR   = 00000017            DAP$V_RWC      = 00000001            FAL$K_BUFFERSIZ= 00000080            
DAP$V_DEVGEN   = 00000019            DAP$V_RWO      = 00000000            FAL$K_DAP      = 000000C0            
DAP$V_DEVIDV   = 0000000D            DAP$V_SCF      = 00000015            FAL$K_FAB      = 00000050            
DAP$V_DEVMBX   = 00000012            DAP$V_SEQORG   = 00000001            FAL$K_MBXBUF   = 00000040            
DAP$V_DEVMNT   = 0000000A            DAP$V_SEQREC   = 00000005            FAL$K_NAM      = 00000038            
DAP$V_DEVNET   = 00000018            DAP$V_SPL      = 00000014            FAL$K_NCBBUF   = 00000040            
DAP$V_DEVODV   = 0000000E            DAP$V_SQO      = 00000012            FAL$K_RAB      = 00000044            
DAP$V_DEVRCK   = 00000015            DAP$V_STREAMID = 00000000            FAL$K_RESULTSIZ= 00000080            
DAP$V_DEVREC   = 00000000            DAP$V_STSRTN   = 00000011            FAL$K_STB      = 00000020            
DAP$V_DEVRND   = 00000014            DAP$V_STS_RETRV= 00000002            FAL$K_WRKBLN     00000400            
DAP$V_DEVRTM   = 00000013            DAP$V_STS_STORE= 00000001            FAL$LISTEN       ********   X   04   
DAP$V_DEVSDI   = 00000004            DAP$V_SUBMIT   = 0000000E            FAL$L_FAB        00000200            
DAP$V_DEVSHR   = 00000008            DAP$V_SUP      = 00000008            FAL$L_NAM        00000294            
DAP$V_DEVSPL   = 00000009            DAP$V_TMD      = 0000000B            FAL$L_RAB        00000250            
DAP$V_DEVSQD   = 00000005            DAP$V_TMP      = 0000000A            FAL$L_SPARE      0000004C            
DAP$V_DEVSWL   = 0000000F            DAP$V_TMP1..   = 00000001            FAL$L_STB        000000C0            
DAP$V_DEVTRM   = 00000002            DAP$V_TMP2..   = 0000000B            FAL$MODE         ********   X   04   
DAP$V_DEVWCK   = 00000016            DAP$V_TMP3..   = 00000006            FAL$NEXT_MSG     ********   X   04   
DAP$V_DLK      = 00000004            DAP$V_TMP4..   = 00000018            FAL$OPEN         ********   X   04   
DAP$V_DLT      = 00000016            DAP$V_TRN      = 00000004            FAL$OUT_OF_SEQ   ********   X   04   
DAP$V_DMO      = 0000000D            DAP$V_UPD      = 00000003            FAL$PURGE        ********   X   04   
DAP$V_EMBEDDED = 00000004            DAP$V_VAXVMS   = 00000021            FAL$Q_BOUNDS     00000034            
DAP$V_EOF      = 00000000            DAP$V_WCK      = 0000000E            FAL$Q_FLG        00000000            
DAP$V_EXEC     = 00000004            DAP$W_BLS        00000040            FAL$Q_LNKIOSB    0000001C            
DAP$V_FID      = 0000000C            DAP$W_BUFSIZ     00000024            FAL$Q_MBX        0000002C            
DAP$V_FILALL   = 00000000            DAP$W_DEQ        0000004A            FAL$Q_MBXIOSB    00000024            
DAP$V_FOP      = 0000000C            DAP$W_MRS        00000042            FAL$Q_NCB        0000002C            
DAP$V_FOPDLT   = 0000001F            DAP$W_STSCODE    00000098            FAL$Q_RCV        0000003C            
DAP$V_FOPSCF   = 0000001E            DAP$_FILE_CLOS = 00000007            FAL$Q_STATE_CTX  00000008            
DAP$V_FOPSPL   = 0000001D            DAP$_FILE_OPEN = 00000004            FAL$Q_XMT        00000044            
DAP$V_FSZ      = 00000008            DAP$_FILE_XFER = 00000005            FAL$RETRV_REC    ********   X   04   
DAP$V_FTN      = 00000000            DAP$_FORMAT    = 00000008            FAL$REWIND       ********   X   04   
DAP$V_GET      = 00000001            DAP$_INVALID   = 00000009            FAL$SPACE        ********   X   04   
DAP$V_IMAGE    = 00000001            DAP$_MSG_SYNC  = 0000000A            FAL$STATE        00000000 RG    03   
DAP$V_KEY      = 00000001            DAP$_PENDING   = 00000000            FAL$STATE_TABLE  00000000 RG    04   
DAP$V_LENGTH   = 00000001            DAP$_SUCCESS   = 00000001            FAL$STORE_REC    ********   X   04   
DAP$V_MRN      = 00000009            DAP$_UNSUPPORT = 00000002            FAL$SUBMIT       ********   X   04   
FALSTATE        - STATE TRANSITION PROCESSING                    22-AUG-1978 01:14:52   VAX-11 MACRO X0.3-11               Page  12
SYMBOL TABLE                                                                                                                     (4)

FAL$T_BUFFER     00000380            
FAL$T_DAP        00000100            
FAL$T_MBXBUF     00000080            
FAL$T_NCBBUF     00000080            
FAL$T_RESULTANT  00000300            
FAL$UPDATE       ********   X   04   
FAL$V_ATT_MSG  = 00000001            
FAL$V_BLOCK_IO = 00000009            
FAL$V_CNF_MSG  = 00000000            
FAL$V_CONNECT  = 00000002            
FAL$V_EOF      = 0000000A            
FAL$V_FILE_MODE= 00000008            
FAL$V_MBXAST   = 00000012            
FAL$V_RCVAST   = 00000010            
FAL$V_XMTAST   = 00000011            
FAL$W_ACTUALSIZ  00000016            
FAL$W_LNKCHN     00000018            
FAL$W_MAXDAPSIZ  00000014            
FAL$W_MBXCHN     0000001A            
FATAL          = 00000052            
FLAGS          = 00000000            
GBL...         = 00000000            
M_EXIT         = 00000002            
M_MATCH        = 00000001            
ST0            = 00000000            
ST1            = 00000001            
ST1_1          = 00000006            
ST2            = 0000000C            
ST2_1          = 00000010            
ST2_2          = 00000012            
ST3            = 00000015            
ST3_1          = 00000019            
ST3_2          = 00000021            
ST4            = 00000025            
ST4A           = 00000026            
ST4A_1         = 0000002A            
ST5            = 0000002C            
ST5A           = 00000031            
ST5A_1         = 00000034            
ST5A_2         = 00000037            
ST6            = 0000003B            
ST6A           = 0000003D            
ST6A_1         = 00000041            
ST7            = 00000044            
ST7A           = 00000048            
ST7A_1         = 0000004B            
ST7A_2         = 0000004E            
SUCCESS        = 00000002            
VALUE          = 00000001            
V_EXIT         = 00000001            
V_MATCH        = 00000000            


PROGRAM SECTION SYNOPSIS

.  ABS  .        00000000      00     NOPIC   USR   CON   ABS   LCL NOSHR NOEXE NORD  NOWRT BYTE  
. BLANK .        00000000      01     NOPIC   USR   CON   REL   LCL NOSHR   EXE   RD    WRT BYTE  
FALSTATE        - STATE TRANSITION PROCESSING                    22-AUG-1978 01:14:52   VAX-11 MACRO X0.3-11               Page  13
PROGRAM SECTION SYNOPSIS                                                                                                         (4)

$ABS$            00000400      02     NOPIC   USR   CON   ABS   LCL NOSHR   EXE   RD    WRT BYTE  
FAL$CODE         0000003E      03     NOPIC   USR   CON   REL   LCL NOSHR   EXE   RD  NOWRT BYTE  
FAL$STATE_TABLE  00000298      04     NOPIC   USR   CON   REL   LCL   SHR NOEXE   RD  NOWRT PAGE  


THERE WERE NO ERRORS OR WARNINGS.
9170. BYTES LEFT IN FREE MEMORY POOL.
8752. BYTES OF RECLAIMED MEMORY.
OBJ$:FALSTATE,LIS$:FALSTATE/-SP=LIB$:FAL.MLB/ML,SRC$:FALSTATE
21 MLB DIR RDS - 739 GETS TO DEFINE 11 MACROS. 64 INTER. FILE WRITES. 
