EIOBLK	MACRO M1110  22-AUG-78 01:56
TABLE OF CONTENTS

     3-   45	I/O CONTROL BLOCKS
     3-  178	I/O CHANNELS
     3-  199	RECORD BUFFERS
     3-  218	MESSAGE TEXT FILE DSPT
EIOBLK	MACRO M1110  22-AUG-78 01:56  PAGE 3


      1						.TITLE	EIOBLK
      2						.IDENT	/000040/
      3
      4					; COPYRIGHT (C) 1976, 1977,
      5					; DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASS.
      6					;
      7					; THIS SOFTWARE IS  FURNISHED  UNDER A LICENSE  FOR USE ONLY ON A
      8					; SINGLE  COMPUTER  SYSTEM  AND  MAY  BE  COPIED  ONLY  WITH  THE
      9					; INCLUSION OF THE ABOVE  COPYRIGHT NOTICE. THIS SOFTWARE, OR ANY
     10					; OTHER  COPIES  THEREOF,  MAY NOT BE PROVIDED  OR OTHERWISE MADE
     11					; AVAILABLE TO ANY OTHER PERSON EXCEPT FOR USE ON SUCH SYSTEM AND
     12					; TO  ONE  WHO  AGREES  TO  THESE  LICENSE  TERMS.  TITLE TO  AND
     13					; OWNERSHIP OF THE SOFTWARE SHALL AT ALL TIMES REMAIN IN DEC.
     14					;
     15					; THE INFORMATION IN  THIS SOFTWARE IS  SUBJECT TO CHANGE WITHOUT
     16					; NOTICE AND SHOULD NOT  BE CONSTRUED AS  A COMMITMENT BY DIGITAL
     17					; EQUIPMENT CORPORATION.
     18					;
     19					; DEC ASSUMES  NO  RESPONSIBILITY  FOR  THE  USE  OR  RELIABILITY
     20					; OF ITS  SOFTWARE  ON  EQUIPMENT  WHICH IS NOT  SUPPLIED BY DEC.
     21					;
     22					;	MONITOR-DEPENDENT IMPURE STORAGE AREA
     23					;
     24					; WRITTEN BY
     25					;	D. KNIGHT
     26					;
     27
     28					.MCALL	FDBDF$,FDAT$A,FDBK$A,FDRC$A,FDOP$A,FSRSZ$,GCMLB$
     29					.MCALL	QIO$,WTSE$,CSI$ND,CSI$SW,NMBLK$,CSI$,CLEF$,SETF$
     30					;
     31
     32
     33						.NLIST	BEX
     34	000000					.PSECT	$GBL
     35
     36		000014 			FF	=14		; ASCII FORM FEED
     37		000012 			LF	=12		; ASCII LINE FEED
     38		000011 			TAB	=11		; ASCII TAB
     39
     40	000000					CSI$
     41
     42		000050 			INSVSZ	=	S.FNB+10.	;INPUT FILE STATE SAVE AREA SIZE (BYTES)
     43		000036 			OUSVSZ	=	S.FNB		;OUTPUT FILE STATE SAVE AREA SIZE (BYTES)
     44
     45						.SBTTL	I/O CONTROL BLOCKS
     46					;
     47					;
     48					; "GET COMMAND LINE" CONTROL BLOCK
     49					;
     50	000000				CMLBLK::GCMLB$	2,EDT		; 2 LEVELS OF INDIRECT FILES
     51
     52	000430				CSIBLK::.BLKB	C.SIZE
     53						.EVEN
     54					;
     55					; EDITOR LUN USAGE
     56					;   1   - COMMAND I/O  VIA GCML$ AND QIO$
     57					;   2-4 - EDITOR I/O, SEE FDB'S BELOW
EIOBLK	MACRO M1110  22-AUG-78 01:56  PAGE 3-1
I/O CONTROL BLOCKS

     58					;   5	- MESSAGE TEXT FILE
     59					; EDITOR EVENT FLAG USAGE
     60					;   1	- WORK FILE READ
     61					;   2	- WORK FILE WRITE
     62					;   3	- MESSAGE FILE READ
     63					;   4	- COMMAND MESSAGE I/O
     64					;
     65					;  I/O FDB'S
     66					;
     67
     68					;CMDFDB USED ONLY FOR INDIRECT FILES
     69	000504	000000 			INDIR::	.WORD	0+.-.		;INDIRECT FILE FLAG
     70	000506				CMDFDB::FDBDF$
     71	000646					FDAT$A	R.VAR,FD.CR
     72	000646					FDRC$A			;THIS LINE IS NOT RIGHT
     73	000646					FDOP$A	1,,SRCNAM
     74
     75	000646				OFILSP::.BLKB	64.		;OUTPUT FILE SPEC STRING
     76	000746				FILBAK::.BLKB			;NON-ZERO IF BACKUP FILE REQUIRED
     77	000747				CMLFIL::.BLKB			;NON-ZERO IF COMMAND FILE SPEC EXISTS
     78	000750	   001 			CURFIL::.BYTE	1+.-.		; CURRENT OPEN FILE
     79	000751	   001 			MAXFIL::.BYTE	1+.-.		; MAX FILE NUMBER IN USE
     80	000752				OUTFDB::FDBDF$
     81	001112					FDAT$A	R.VAR, FD.CR	; VARIABLE LENGTH RECORDS, IMPLIED CR/LF
     82	001112					FDOP$A	2,CSIBLK+C.DSDS,OUTNAM ; LUN 2
     83
     84	001112				SRCFDB::FDBDF$
     85	001252					FDAT$A	R.VAR
     86	001252					FDRC$A	0,SRCBUF,136.	; MAXIMUM 136 BYTES TO SRCBUF
     87	001252					FDOP$A	3,CSIBLK+C.DSDS,SRCNAM	; LUN 3
     88
     89	001252				WRKFDB::FDBDF$
     90	001412					FDRC$A	FD.RWM		; READ/WRITE MODE I/O
     91	001412					FDBK$A	,512.		; ALL BLOCKS HAVE 512. BYTES
     92	001412					FDOP$A	4,,WRKNAM	; LUN 4
     93
     94	001412				MSGFDB::FDBDF$
     95	001552					FDRC$A	FD.RWM		; READ/WRITE MODE I/O
     96	001552					FDBK$A	,512.,,3,MGIOST
     97	001552					FDOP$A	5,MSG6WD	;LUN 5
     98
     99					;
    100					; DEFAULT FILE NAME BLOCKS
    101					;
    102	001552				OUTNAM::
    103	001552				SRCNAM::NMBLK$	,,,SY,0
    104
    105					;
    106					; COMMAND SWITCHES
    107					;
    108	001610				OUTSWT::CSI$SW	CR,FD.CR,,,NEG	;/CR FORCE IMPLIED CONTROL
    109	001620					CSI$SW	FT,FD.FTN	;/FT FORCES FORTRAN CARRIAGE CONTROL
    110	001630				SRCSWT::CSI$ND			;END OF SWITCH LIST
    111
    112					;
    113					; I/O STATUS BLOCKS
    114					;
EIOBLK	MACRO M1110  22-AUG-78 01:56  PAGE 3-2
I/O CONTROL BLOCKS

    115	001632				MGIOST:	.BLKW	2
    116	001636				RDIOST::.BLKW	2
    117	001642				WTIOST::.BLKW	2
    118
    119					; COMMAND PROMPT CHARACTER
    120	001646	   052 			STAR::	.ASCII	"*"
    121		000001 			STPSCL==.-STAR
    122					;THE FOLLOWING PROMPT MUST BE THE SAME LENGTH AS "STAR"
    123	001647	   077 			QUEST::	.ASCII	"?"
    124						.EVEN
    125		000146'			CMLLEN==CMLBLK+G.CMLD
    126		000150'			CMLADR==CMLBLK+G.CMLD+2
    127
    128					;
    129					; QIO BLOCKS
    130					;
    131
    132	001650				IDPB::	QIO$	IO.RLB,1,4,,IOSB,,<0,0,0,0,0,0>
    133						.IF DF	RSXD
    134	001700				ICDPB::	QIO$	IO.RAL!TF.RNE,1,4,,IOSB,,<0,0,0,0,0,0>
    135	001730				ICBUF::	.BLKW
    136						.IFF
    137					ICBUF::	.BLKW	33.
    138					ICLEN	==	.-ICBUF-2
    139					ICPTR::	.BLKW
    140						.ENDC	;RSXD
    141						.IF DF	RSTS
    142					ICCNT::	.BLKW
    143						.IFF
    144						.IF NDF	RSXD
    145					ICPTR1::.BLKW
    146						.ENDC	;RSXD
    147						.ENDC	;RSTS
    148						.IF DF	VAX
    149	001732				ODPB::	QIO$	IO.WVB,1,4,,IOSB,,<0,0,0,0,0,0>
    150	001762				OCDPB::	QIO$	IO.WAL,1,4,,IOSB,,<0,0,0,0,0,0>
    151						.IFF
    152					ODPB::	QIO$	IO.WAL,1,4,,IOSB,,<0,0,0,0,0,0>
    153						.ENDC	;VAX
    154	002012				QIOATT::QIO$	IO.ATT,1,4,,IOSB,,<0,0,0,0,0,0>
    155						.IF NDF	RSTS
    156						.IF NDF	RSXD
    157					CHGATT::QIO$	IO.ATT!IO.ATA,1,4,,IOSB,,<TIAST>
    158						.ENDC	;RSXD
    159						.ENDC	;RSTS
    160	002042				QIODET::QIO$	IO.DET,1,4,,IOSB,,<0,0,0,0,0,0>
    161	002072				WAIT01::WTSE$	4	;WAIT FOR COMPLETION, EFN=4
    162	002076	000000 	000000 		IOSB::	.WORD	0+.-.,0+.-.
    163
    164					;
    165					; EXIT STATUS CONTROL
    166					;
    167					;	.IF DF	RSTS
    168		000001 			EX$SUC	=	1
    169		000002 			EX$ERR	=	2
    170		000004 			EX$SEV	=	4
    171					;	.ENDC	;RSTS
EIOBLK	MACRO M1110  22-AUG-78 01:56  PAGE 3-3
I/O CONTROL BLOCKS

    172
    173		000002 			ERRERX	==	EX$ERR
    174		000004 			ERRSEV	==	EX$SEV
    175
    176	002102	000001 			EXITST::.WORD	EX$SUC+.-.	;NORMAL EXIT IS SUCCESS
    177
    178						.SBTTL	I/O CHANNELS
    179					;
    180					; EDITOR I/O CHANNELS
    181					;	FIRST WORD IS A STATUS WORD WITH VALUES:
    182					;		0-CHANNEL NOT SPECIFIED
    183					;		1-CHANNEL SPECIFIED, BUT CLOSED
    184					;		3-CHANNEL SPECIFIED, AND OPEN
    185					;	SECOND WORD POINTS TO FDB FOR THE CHANNEL
    186					;
    187	002104	000000 	000752'		OUTCHA::.WORD	.-.,OUTFDB;
    188					;
    189					; DECLARE STORAGE FOR THE FCS BUFFER REGION
    190					; THE EDITOR HAS A MAXIMUM OF 3 SIMULTANEOUSLY OPEN FILES
    191					; REQUIRING BUFFERS WHICH ARE ALLOCATED BY FCS (GET/PUT).
    192					;
    193	002110					FSRSZ$	3
    194
    195					; FORCE LOADING OF $$FSR2 FILE STORAGE REGION CONTROL BLOCKS
    196					;
    197						.GLOBL	.FSRCB,.FSRPT
    198
    199						.SBTTL	RECORD BUFFERS
    200
    201						.EVEN
    202	002110					.PSECT	$GBL
    203	002110	002114'			OUTPTR::.WORD	OUTBUF;
    204	002112				SRCPTR::.BLKW
    205
    206	002114				OUTBUF::.BLKB	140.
    207	002330				OUTEND::
    208		000214 			OUTLEN	==OUTEND-OUTBUF;
    209
    210					;
    211					; SOURCE INPUT BUFFER
    212					;
    213						.EVEN
    214	002330				SRCBUF::.BLKB	136.
    215						.EVEN
    216	002540				SRCLEN::.BLKW
    217
    218						.SBTTL	MESSAGE TEXT FILE DSPT
    219	002542	000002 	002556'		MSG6WD::.WORD	2,MSGDEV
    220	002546	000005 	002560'			.WORD	5,MSGDIR
    221	002552	000012 	002565'			.WORD	10.,MSGFIL
    222	002556	   123 	   131 		MSGDEV::.ASCII	/SY/
    223	002560	   133 	   061 	   054 	MSGDIR:	.ASCII	/[1,2]/
    224	002565	   105 	   104 	   124 	MSGFIL:	.ASCII	/EDTCOM.MSG/
    225						.EVEN
    226
    227		000001 				.END
EIOBLK	MACRO M1110  22-AUG-78 01:56  PAGE 3-4
SYMBOL TABLE

CHR$$ = 000124   	FF    = 000014   	F.RSIZ= 000002   	IO.WAL= ****** GX	Q.IOSB= 000010
CMDFDB  000506RG    002	FILBAK  000746RG    002	F.RTYP= 000000   	IO.WVB= ****** GX	RDIOST  001636RG    002
CMLADR= 000150RG    002	F.ACTL= 000076   	F.SEQN= 000100   	LF    = 000012   	RSXD  = 000001
CMLBLK  000000RG    002	F.ALOC= 000040   	F.SPDV= 000072   	MAXFIL  000751RG    002	R.VAR = ****** GX
CMLFIL  000747RG    002	F.BBFS= 000062   	F.SPUN= 000074   	MGIOST  001632R     002	SIZ$$ = 000002
CMLLEN= 000146RG    002	F.BDB = 000070   	F.STBK= 000036   	MSGDEV  002556RG    002	SRCBUF  002330RG    002
CNT$$ = 000002   	F.BGBC= 000057   	F.UNIT= 000136   	MSGDIR  002560R     002	SRCFDB  001112RG    002
CSIBLK  000430RG    002	F.BKDN= 000026   	F.URBD= 000020   	MSGFDB  001412RG    002	SRCLEN  002540RG    002
CS.DIF= 000002   	F.BKDS= 000020   	F.VBN = 000064   	MSGFIL  002565R     002	SRCNAM  001552RG    002
CS.DVF= 000004   	F.BKEF= 000050   	F.VBSZ= 000060   	MSG6WD  002542RG    002	SRCPTR  002112RG    002
CS.EQU= 000040   	F.BKP1= 000051   	GE.BIF= 177775   	N.DID = 000024   	SRCSWT  001630RG    002
CS.INP= 000001   	F.BKST= 000024   	GE.CLO= 000004   	N.DVNM= 000032   	STAR    001646RG    002
CS.MOR= 000020   	F.BKVB= 000064   	GE.COM= 000001   	N.FID = 000000   	STPSCL= 000001 G
CS.NMF= 000001   	F.CHR = 000075   	GE.CON= 000020   	N.FNAM= 000006   	S.BFHD= 000020
CS.OUT= 000002   	F.CNTG= 000034   	GE.EOF= 177766   	N.FTYP= 000014   	S.FATT= 000016
CS.WLD= 000010   	F.DFNB= 000046   	GE.IND= 000002   	N.FVER= 000016   	S.FDB = 000140
CURFIL  000750RG    002	F.DSPT= 000044   	GE.IOR= 177777   	N.NEXT= 000022   	S.FNAM= 000006
C.CMLD= 000002   	F.DVNM= 000134   	GE.LC = 000010   	N.STAT= 000020   	S.FNB = 000036
C.DEVD= 000006   	F.EFBK= 000010   	GE.MDE= 177774   	N.UNIT= 000034   	S.FNBW= 000017
C.DIRD= 000012   	F.EFN = 000050   	GE.OPR= 177776   	OCDPB   001762RG    002	S.FNTY= 000004
C.DSDS= 000006   	F.EOBB= 000032   	GE.RBG= 177730   	ODPB    001732RG    002	S.FTYP= 000002
C.FILD= 000016   	F.ERR = 000052   	GE.SIZ= 000040   	OFILSP  000646RG    002	S.NFEN= 000020
C.MKW1= 000024   	F.FACC= 000043   	G.CMLD= 000146   	OUSVSZ= 000036   	TAB   = 000011
C.MKW2= 000026   	F.FFBY= 000014   	G.DPRM= 000160   	OUTBUF  002114RG    002	TF.RNE= ****** GX
C.SIZE= 000054   	F.FNAM= 000110   	G.ERR = 000140   	OUTCHA  002104RG    002	VAX   = 000001
C.STAT= 000001   	F.FNB = 000102   	G.ISIZ= 000020   	OUTEND  002330RG    002	WAIT01  002072RG    002
C.SWAD= 000022   	F.FTYP= 000116   	G.LPDL= 000060   	OUTFDB  000752RG    002	WRKFDB  001252RG    002
C.TYPR= 000000   	F.FVER= 000120   	G.MODE= 000141   	OUTLEN= 000214 G 	WRKNAM= ****** GX
ERRERX= 000002 G 	F.HIBK= 000004   	G.PSDS= 000142   	OUTNAM  001552RG    002	WTIOST  001642RG    002
ERRSEV= 000004 G 	F.LUN = 000042   	G.SIZE= 000224   	OUTPTR  002110RG    002	W.TSEF= 000002
EXITST  002102RG    002	F.MBCT= 000054   	ICBUF   001730RG    002	OUTSWT  001610RG    002	$$    = 000000
EX$ERR= 000002   	F.MBC1= 000055   	ICDPB   001700RG    002	QIOATT  002012RG    002	$$$   = 000160R     002
EX$SEV= 000004   	F.MBFG= 000056   	IDPB    001650RG    002	QIODET  002042RG    002	$$$ARG= 000006
EX$SUC= 000001   	F.NRBD= 000024   	INDIR   000504RG    002	QUEST   001647RG    002	$$$OST= 000004
FD.CCL= ****** GX	F.NREC= 000030   	INSVSZ= 000050   	Q.IOAE= 000012   	.FSRCB= ****** G
FD.CR = ****** GX	F.OVBS= 000030   	IOSB    002076RG    002	Q.IOEF= 000006   	.FSRPT= ****** G
FD.FTN= ****** GX	F.RACC= 000016   	IO.ATT= ****** GX	Q.IOFN= 000002   	...PC1= 001412R     002
FD.REC= ****** GX	F.RATT= 000001   	IO.DET= ****** GX	Q.IOLU= 000004   	...PC2= 001606R     002
FD.RWM= ****** GX	F.RCNM= 000034   	IO.RAL= ****** GX	Q.IOPL= 000014   	...PC3= 001412R     002
FD.TTY= ****** GX	F.RCTL= 000017   	IO.RLB= ****** GX	Q.IOPR= 000007   	...TPC= 000020

. ABS.	000000	   000
      	000000	   001
$GBL  	002600	   002
$$FSR1	003060	   003
ERRORS DETECTED:  0

VIRTUAL MEMORY USED:  4510 WORDS  ( 18 PAGES)
DYNAMIC MEMORY:  5940 WORDS  ( 22 PAGES)
ELAPSED TIME:  00:00:35
OBJ$:EIOBLK,LIS$:EIOBLK/-SP=SRC$:VAX,RSXD,EIOBLK
