ETRMIO	MACRO M1110  22-AUG-78 01:56
TABLE OF CONTENTS

     2-  131	CURADR - CURSOR ADDRESSING
     2-  220	ERASEL - ERASE REMAINDER OF LINE
     2-  246	ERASSC - ERASE REMAINDER OF SCREEN
ETRMIO	MACRO M1110  22-AUG-78 01:56  PAGE 2


      1						.TITLE	ETRMIO
      2						.IDENT	/000010/
      3
      4					; COPYRIGHT (C) 1976, 1977,
      5					; DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASS.
      6					;
      7					; THIS SOFTWARE IS  FURNISHED  UNDER A LICENSE  FOR USE ONLY ON A
      8					; SINGLE  COMPUTER  SYSTEM  AND  MAY  BE  COPIED  ONLY  WITH  THE
      9					; INCLUSION OF THE ABOVE  COPYRIGHT NOTICE. THIS SOFTWARE, OR ANY
     10					; OTHER  COPIES  THEREOF,  MAY NOT BE PROVIDED  OR OTHERWISE MADE
     11					; AVAILABLE TO ANY OTHER PERSON EXCEPT FOR USE ON SUCH SYSTEM AND
     12					; TO  ONE  WHO  AGREES  TO  THESE  LICENSE  TERMS.  TITLE TO  AND
     13					; OWNERSHIP OF THE SOFTWARE SHALL AT ALL TIMES REMAIN IN DEC.
     14					;
     15					; THE INFORMATION IN  THIS SOFTWARE IS  SUBJECT TO CHANGE WITHOUT
     16					; NOTICE AND SHOULD NOT  BE CONSTRUED AS  A COMMITMENT BY DIGITAL
     17					; EQUIPMENT CORPORATION.
     18					;
     19					; DEC ASSUMES  NO  RESPONSIBILITY  FOR  THE  USE  OR  RELIABILITY
     20					; OF ITS  SOFTWARE  ON  EQUIPMENT  WHICH IS NOT  SUPPLIED BY DEC.
     21					;
     22					; WRITTEN BY
     23					;	D. KNIGHT
     24					;
     25					; MODULE FUNCTION
     26					;	PRIMITIVE LEVEL TERMINAL I/O FOR EDITOR
     27
     28					;
     29					; THE FOLLOWING ROUTINES DO PRIMITIVE LEVEL I/O FOR ACCESSING
     30					; THE CONSOLE TERMINAL.  ALL OF THESE FUNCTIONS ARE SEPARATE
     31					; FROM THE EDITOR PROPER TO ALLOW EASY ADDITION OF NEW
     32					; FUNCTIONS AND/OR NEW TERMINALS TO THE EDITOR.
     33					;
     34
     35						.MACRO	SOB	REG,ADR
     36						DEC	REG
     37						BNE	ADR
     38						.ENDM	;SOB
     39
     40					;
     41					; TERMINAL SPECIFIC TABLES GO HERE
     42					;
     43					; TERMINAL TYPES
     44					;  NOTE:  ANY NEW TERMINAL TYPE SHOULD BE ADDED AT THE END OF THE
     45					;	  LIST AND "TEND" UPDATED TO REFLECT LARGER TABLE.
     46					;
     47		000000 			HCPY	==	0		;
     48		000001 			LA30	==	1
     49		000002 			LA36	==	2
     50		000003 			VT05	==	3		;HARD COPY ENTRIES MUST ALL PRECEDE VT05
     51		000004 			VT50	==	4
     52		000005 			VT52	==	5
     53		000006 			VT55	==	6
     54		000007 			VT61	==	7
     55		000010 			TEND	==	8.		;END OF TABLE
     56
     57	000000					.PSECT	$GBL
ETRMIO	MACRO M1110  22-AUG-78 01:56  PAGE 2-1


     58
     59					;
     60					; MASTER NAME TABLE - USED BY SET AND SHOW
     61					;	TO SET UP TERMINAL TYPE
     62					;
     63
     64		000002 			TSIZ	==	2		;TABLE ENTRY SIZE
     65	000000				TTYPE::
     66	000000	000042'	000000 			.WORD	HCP,HCPY	;UNDEFINED HARD COPY
     67	000004	000047'	000001 			.WORD	L30,LA30	;LA30
     68	000010	000054'	000002 			.WORD	L36,LA36	;LA36
     69	000014	000061'	000003 			.WORD	V05,VT05	;VT05
     70	000020	000066'	000004 			.WORD	V50,VT50	;VT50
     71	000024	000073'	000005 			.WORD	V52,VT52	;VT52
     72	000030	000100'	000006 			.WORD	V55,VT55	;VT55
     73	000034	000105'	000007 			.WORD	V61,VT61	;VT61
     74	000040	000000 				.WORD	0		;LIST ENDS IN ZERO
     75	000042	   110 	   103 	   120 	HCP:	.ASCIZ	"HCPY"
	000045	   131 	   000
     76	000047	   114 	   101 	   063 	L30:	.ASCIZ	"LA30"
	000052	   060 	   000
     77	000054	   114 	   101 	   063 	L36:	.ASCIZ	"LA36"
	000057	   066 	   000
     78	000061	   126 	   124 	   060 	V05:	.ASCIZ	"VT05"
	000064	   065 	   000
     79	000066	   126 	   124 	   065 	V50:	.ASCIZ	"VT50"
	000071	   060 	   000
     80	000073	   126 	   124 	   065 	V52:	.ASCIZ	"VT52"
	000076	   062 	   000
     81	000100	   126 	   124 	   065 	V55:	.ASCIZ	"VT55"
	000103	   065 	   000
     82	000105	   126 	   124 	   066 	V61:	.ASCIZ	"VT61"
	000110	   061 	   000
     83						.EVEN
     84
     85					;
     86					; TERMINAL SIZE CHARACTERISTICS TABLE
     87					;
     88	000112				TRMSIZ::
     89	000112	   110 	   001 			.BYTE	72.,1.		;UNDEFINED HARDCOPY 72X1
     90	000114	   120 	   001 			.BYTE	80.,1.		;LA30 80X1
     91	000116	   204 	   001 			.BYTE	132.,1.		;LA36 132X1
     92	000120	   110 	   024 			.BYTE	72.,20.		;VT05 72X20
     93	000122	   120 	   014 			.BYTE	80.,12.		;VT50 80X12
     94	000124	   120 	   030 			.BYTE	80.,24.		;VT52 80X24
     95	000126	   120 	   030 			.BYTE	80.,24.		;VT55 80X24
     96	000130	   120 	   030 			.BYTE	80.,24.		;VT61 80X24
     97
     98					;
     99					; LINE TERMINATOR TRANSLATION TABLE
    100					;
    101	000132	   074 	   114 	   106 	TLF::	.ASCIZ	/<LF>/
	000135	   076 	   000
    102	000137	   074 	   126 	   124 	TVT::	.ASCIZ	/<VT>/
	000142	   076 	   000
    103	000144	   074 	   106 	   106 	TFF::	.ASCIZ	/<FF>/
	000147	   076 	   000
ETRMIO	MACRO M1110  22-AUG-78 01:56  PAGE 2-2


    104						.EVEN
    105
    106					;
    107					; TERMINAL TYPE
    108					;
    109	000152	000000 			TRMTYP::.WORD	0+.-.
    110					;
    111					; VT05 PADDING COUNT
    112					;
    113	000154	000000 			FASTVT::.WORD	0+.-.
    114					;
    115					; DEFINED TAB SIZE
    116					;
    117	000156	000010 			TABSIZ::.WORD	8.+.-.
    118					;
    119					; SPECIFIED LINE SIZE
    120					;
    121	000160	000110 			LINSIZ::.WORD	72.+.-.
    122					;
    123					; SPECIFIED NUMBER OF LINES
    124					;
    125	000162	000001 			LINCNT::.WORD	1+.-.
    126					;
    127					; CURRENT LINE POSITION
    128					;
    129	000164				CURPOS::.BLKW
    130
    131						.SBTTL	CURADR - CURSOR ADDRESSING
    132	000000					.PSECT
    133					; CURADR
    134					;
    135					; FUNCTION
    136					;	GENERAL CURSOR ADDRESSING ROUTINE
    137					;
    138					; INPUTS
    139					;	LINE(SP) - LINE POSITION
    140					;	COL(SP) - COLUMN POSITION
    141					;
    142					; OUTPUTS
    143					;	VALUE - NONE.
    144					;
    145
    146		000004 			LINE	=	4
    147		000002 			COL	=	2
    148
    149	000000				CURADR::
    150	000000	026727 	000152'	000003 		CMP	TRMTYP,#VT05	;VT05 IS SPECIAL
    151	000006	001007 				BNE	10$
    152	000010	012746 	000016 			MOV	#16,-(SP)	; CTRL N IS CURSOR
    153	000014	004767 	000000G			CALL	CHROUT		; ADDRESSING FOR VT05
    154						.IF NDF	RSTS
    155	000020	004767 	000000G			CALL	PAD
    156						.ENDC	;RSTS
    157	000024	000413 				BR	60$		; HANDLE THE REST LIKE A VT52
    158	000026	026727 	000152'	000004 	10$:	CMP	TRMTYP,#VT50	;VT50 IS EVEN MORE SO
    159	000034	001003 				BNE	50$		;ALL OTHERS ARE VERY SIMPLE
    160	000036	004767 	000056 			CALL	CURV50		;VT50 CURSOR POSITIONING
ETRMIO	MACRO M1110  22-AUG-78 01:56  PAGE 2-3
CURADR - CURSOR ADDRESSING

    161	000042	000425 				BR	90$
    162	000044	012746 	000131 		50$:	MOV	#'Y,-(SP)	;ESC Y IS START OF ADDRESS
    163	000050	004767 	000000G			CALL	CHRESC
    164	000054	016616 	000006 		60$:	MOV	LINE+2(SP),(SP)	;GET LINE DESIRED
    165	000060	062716 	000037 			ADD	#31.,(SP)	;GET DESIRED HARDWARE OFFSET
    166	000064	004767 	000000G			CALL	CHROUT		;SEND LINE POSITION
    167						.IF NDF	RSTS
    168	000070	004767 	000000G			CALL	PAD		;VT05 PADDING IS VERY WEIRD
    169						.ENDC	;RSTS
    170	000074	016616 	000004 			MOV	COL+2(SP),(SP)	;GET COLUMN DESIRED
    171	000100	062716 	000040 			ADD	#32.,(SP)	;AND ITS OFFSET
    172	000104	004767 	000000G			CALL	CHROUT
    173						.IF NDF	RSTS
    174	000110	004767 	000000G			CALL	PAD		;GENERATE FILLER TO SLOW DOWN VT05 TUBE
    175						.ENDC	;RSTS
    176	000114	005726 				TST	(SP)+
    177	000116	000207 			90$:	RETURN
    178
    179					;
    180					; THE VT50 HAS NO DIRECT CURSOR ADDRESSING
    181					; SO IT MUST BE SIMULATED IN THE FOLLOWING CLUMSY FASHION.
    182					;
    183
    184	000120	010146 			CURV50:	MOV	R1,-(SP)
    185	000122	016701 	000000G			MOV	SCREEN,R1	;GET CURRENT LINE
    186	000126	016600 	000010 			MOV	LINE+4(SP),R0	; AND THE DESTINATION LINE
    187	000132	020001 				CMP	R0,R1		;LOOK FOR REVERSE (UPWARDS) MOVEMENT
    188	000134	002011 				BGE	10$		;NOT SO
    189	000136	160001 				SUB	R0,R1		;GET AMOUNT OF MOVEMENT
    190	000140	012746 	000101 		5$:	MOV	#'A,-(SP)	;ESC A
    191	000144	004767 	000000G			CALL	CHRESC		; IS CURSOR UP
    192	000150	005726 				TST	(SP)+
    193	000152					SOB	R1,5$		;MOVE AS MANY AS ARE REQUIRED UPWARDS
    194	000156	000411 				BR	20$
    195	000160	003410 			10$:	BLE	20$		;NO FORWARD MOTION REQUIRED
    196	000162	160100 				SUB	R1,R0		;GET HOW MANY TO MOVE FORWARD (DOWN)
    197	000164	012746 	000012 		15$:	MOV	#10.,-(SP)	; <LF> WORKS LIKE
    198	000170	004767 	000000G			CALL	CHROUT		; CURSOR DOWN
    199	000174	005726 				TST	(SP)+
    200	000176					SOB	R0,15$		;MOVE AT LEAST ONCE
    201	000202	016701 	000002G		20$:	MOV	SCREEN+2,R1	;NOW GET THE CURRENT COLUMN
    202	000206	016600 	000006 			MOV	COL+4(SP),R0	; AND THE DESTINATION COLUMN
    203	000212	020001 				CMP	R0,R1		;MOVE LEFT?
    204	000214	002011 				BGE	30$		;NO
    205	000216	160001 				SUB	R0,R1		;YES, FIND OUT HOW FAR
    206	000220	012746 	000010 		25$:	MOV	#8.,-(SP)	;BACKSPACE WORKS LIKE CURSOR LEFT
    207	000224	004767 	000000G			CALL	CHROUT
    208	000230	005726 				TST	(SP)+
    209	000232					SOB	R1,25$		;LOOP UNTIL POSITION ASSURED
    210	000236	000411 				BR	40$
    211	000240	003410 			30$:	BLE	40$		;MOVE RIGHT?
    212	000242	160100 				SUB	R1,R0		;YES, FIND OUT DISTANCE TO MOVE
    213	000244	012746 	000103 		35$:	MOV	#'C,-(SP)	;ESC C IS CURSOR RIGHT
    214	000250	004767 	000000G			CALL	CHRESC
    215	000254	005726 				TST	(SP)+
    216	000256					SOB	R0,35$
    217	000262	012601 			40$:	MOV	(SP)+,R1
ETRMIO	MACRO M1110  22-AUG-78 01:56  PAGE 2-4
CURADR - CURSOR ADDRESSING

    218	000264	000207 				RETURN			;RETURN WITH NEW CURSOR POSITION
    219
    220						.SBTTL	ERASEL - ERASE REMAINDER OF LINE
    221					; ERASEL
    222					;
    223					; FUNCTION
    224					;	ERASE THE REMAINDER OF A LINE
    225					;
    226					; INPUTS
    227					;	TRMTYP - TYPE OF TERMINAL IN USE
    228					;
    229					; OUTPUTS
    230					;	VALUE - NONE.
    231					;
    232	000266				ERASEL::
    233	000266	026727 	000152'	000003 		CMP	TRMTYP,#VT05	;VT05 IS THE ONLY SPECIAL VARIATION SO FAR
    234	000274	001007 				BNE	10$		;HANDLE ALL OTHERS THE SAME
    235	000276	012746 	000036 			MOV	#36,-(SP)	;CTRL ^ ERASES LINE
    236	000302	004767 	000000G			CALL	CHROUT		;OUTPUT ERASE
    237						.IF NDF	RSTS
    238	000306	004767 	000000G			CALL	PAD		;PUT OUT FILLER TO KEEP SCREEN STRAIGHT
    239						.ENDC	;RSTS
    240	000312	000404 				BR	20$
    241	000314	012746 	000113 		10$:	MOV	#'K,-(SP)	;ESCAPE K
    242	000320	004767 	000000G			CALL	CHRESC		;ERASES LINE ON ALL OTHERS
    243	000324	005726 			20$:	TST	(SP)+		;DISCARD SCRATCH
    244	000326	000207 				RETURN
    245
    246						.SBTTL	ERASSC - ERASE REMAINDER OF SCREEN
    247					; ERASSC
    248					;
    249					; FUNCTION
    250					;	ERASE REMAINDER OF SCREEN
    251					;
    252					; INPUTS
    253					;	TRMTYP - WHAT KIND OF TERMINAL
    254					;
    255					; OUTPUTS
    256					;	VALUE - NONE.
    257					;
    258	000330				ERASSC::
    259	000330	026727 	000152'	000003 		CMP	TRMTYP,#VT05	;VT05 IS ONLY SPECIAL CASE
    260	000336	001007 				BNE	10$		;ALL OTHERS ARE SIMILAR
    261	000340	012746 	000037 			MOV	#37,-(SP)	;CTRL _ IS ERASE
    262	000344	004767 	000000G			CALL	CHROUT		; FUNCTION
    263						.IF NDF	RSTS
    264	000350	004767 	000000G			CALL	PAD		;FILLER TO LET SCREEN STABILIZE
    265						.ENDC	;RSTS
    266	000354	000404 				BR	20$
    267	000356	012746 	000112 		10$:	MOV	#'J,-(SP)	;ESC J ERASES ON ALL OTHERS
    268	000362	004767 	000000G			CALL	CHRESC
    269	000366	005726 			20$:	TST	(SP)+
    270	000370	000207 				RETURN
    271
    272		000001 				.END
ETRMIO	MACRO M1110  22-AUG-78 01:56  PAGE 2-5
SYMBOL TABLE

CHRESC= ****** GX	FASTVT  000154RG    002	L30     000047R     002	TLF     000132RG    002	VT52  = 000005 G
CHROUT= ****** GX	HCP     000042R     002	L36     000054R     002	TRMSIZ  000112RG    002	VT55  = 000006 G
COL   = 000002   	HCPY  = 000000 G 	PAD   = ****** GX	TRMTYP  000152RG    002	VT61  = 000007 G
CURADR  000000RG 	LA30  = 000001 G 	RSXD  = 000001   	TSIZ  = 000002 G 	V05     000061R     002
CURPOS  000164RG    002	LA36  = 000002 G 	SCREEN= ****** GX	TTYPE   000000RG    002	V50     000066R     002
CURV50  000120R  	LINCNT  000162RG    002	TABSIZ  000156RG    002	TVT     000137RG    002	V52     000073R     002
ERASEL  000266RG 	LINE  = 000004   	TEND  = 000010 G 	VT05  = 000003 G 	V55     000100R     002
ERASSC  000330RG 	LINSIZ  000160RG    002	TFF     000144RG    002	VT50  = 000004 G 	V61     000105R     002

. ABS.	000000	   000
      	000372	   001
$GBL  	000166	   002
ERRORS DETECTED:  0

VIRTUAL MEMORY USED:  392 WORDS  ( 2 PAGES)
DYNAMIC MEMORY:  2772 WORDS  ( 10 PAGES)
ELAPSED TIME:  00:00:06
OBJ$:ETRMIO,LIS$:ETRMIO/-SP=SRC$:RSXD,ETRMIO
