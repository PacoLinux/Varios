
; Bliss-32 7.352	Saturday 22-AUG-1978 04:52:29	DBB3:[LINKER.SRC]LNKNXTOBJ.B32;6				Page 1
; Digital Equipment Corporation
;
;00100  0001	MODULE LNK_NXTOBJ (IDENT='X01.05') =
;00200  0002	
;00300  0003	BEGIN
;00400  0004	!
;00500  0005	!
;00600  0006	! Copyright (C) 1976, 1977, 1978
;00700  0007	! Digital Equipment Corporation,  Maynard, Massachusetts  01754
;00800  0008	!
;00900  0009	! This software is furnished under a license for use only on  a
;01000  0010	! single computer system and may be copied only with the inclu-
;01100  0011	! sion of the above copyright notice.  This  software,  or  any
;01200  0012	! other  copies  thereof, may not be provided or otherwise made
;01300  0013	! available to any other person except for use on  such  system
;01400  0014	! and  to  one who agrees to these license terms.  Title to and
;01500  0015	! ownership of the software shall at all times remain in DEC.
;01600  0016	!
;01700  0017	! The information in this software is subject to change without
;01800  0018	! notice and should not be construed as a commitment by Digital
;01900  0019	! Equipment Corporation.
;02000  0020	!
;02100  0021	! DEC assumes no responsibility for the use or  reliability  of
;02200  0022	! its software on equipment which is not supplied by DEC.
;02300  0023	!
;02400  0024	!
;02500  0025	!
;02600  0026	!
;02700  0027	!
;02800  0028	!++
;02900  0029	!
;03000  0030	! MODULE: LNK_NXTOBJ
;03100  0031	!
;03200  0032	! FACILITY: LINKER
;03300  0033	!
;03400  0034	! ABSTRACT: FIND NEXT OBJECT MODULE (AND OPEN FILE) FOR PASS 2.
;03500  0035	!
;03600  0036	! HISTORY:
;03700  0037	!
;03800  0038	!	VERSION: X01.00
;03900  0039	!
;04000  0040	!	AUTHOR: T.J. PORTER 11-APR-77
;04100  0041	!
;04200  0042	!	MODIFICATIONS:
;04300  0043	!
;04400  0044	! NO.	DATE		PROGRAMMER	PURPOSE
;04500  0045	! ---	----		----------	-------
;04600  0046	! 001	14-JUN-77	T.J. PORTER	OBJECT LIBRARIES
;04700  0047	! 002	15-DEC-77	T.J. PORTER	SHAREABLE IMAGES
;04800  0048	! 003	30-MAR-78	T.J. PORTER	BUG FIX:- GET BY RFA IF IN A
;04900  0049	!						CONCATENATED OBJ AND PREVIOUS MODULE
;05000  0050	!						HAD NO BINARY.
;05010  0051	! 004	21-APR-78	T.J. PORTER	REQUIRE FILE CLEAN UP
;05020  0052	! 005	24-APR-78	T.J. PORTER	DETECT AND REPORT EMPTY FILES
;05100  0053	!--

; Bliss-32 7.352	Saturday 22-AUG-1978 04:52:29	DBB3:[LINKER.SRC]LNKNXTOBJ.B32;6				Page 2
; Digital Equipment Corporation
;
;05200  0054	     
;05300  0055	!
;05400  0056	!++
;05500  0057	!
;05600  0058	! FUNCTIONAL DESCRIPTION:
;05700  0059	!
;05800  0060	!
;05900  0061	!	THIS MODULE CONTAINS THE ROUTINE TO ACQUIRE THE NEXT
;06000  0062	!	OBJECT MODULE DESCRIPTOR AND ENSURE THAT THE FILE IS OPEN
;06100  0063	!	(AT CORRECT PLACE) READY FOR PASS 2 TO READ RECORDS
;06200  0064	!	SEQUENTIALLY FROM IT.
;06300  0065	!		THIS IS DONE BY FOLLOWING DOWN THE SINGLY LINKED
;06400  0066	!	LIST OF OBJECT MODULE DESCRIPTORS TO THE END, THEN PROCEEDING
;06500  0067	!	TO THE NEXT FILE IN SEQUENCE, OPENING IT AND FOLLOWING
;06600  0068	!	DOWN THE LIST.
;06700  0069	!		CALLING SEQUENCE:-
;06800  0070	!			LNK$NXTOBJMOD (OBMODESC)
;06900  0071	!
;07000  0072	!		WHERE OBMODESC IS THE ADDRESS OF A CELL IN WHICH
;07100  0073	!	TO PLACE THE ADDRESS OF THE DESCRIPTOR OF THE NEXT OBJECT
;07200  0074	!	MODULE.
;07300  0075	!		ROUTINE HAS VALUE FALSE WHEN NO MORE
;07400  0076	!	MODULES ARE AVAILABLE IN THE LAST FILE.
;07500  0077	!
;07600  0078	!--
;07700  0079	!
;07800  0080	LIBRARY
;07900  0081		'SYS$LIBRARY:STARLET.L32';				! SYSTEM USER DATA STRUCTURES
;08000  0082	REQUIRE
;08100  0083		'PREFIX';				! MACROS ETC.
;08200  0275	REQUIRE
;08300  0276		'DATBAS';				! INTERNAL DATA BASE DEFINITION
;08400  0508	!
;08410  0509	EXTERNAL LITERAL
;08420  0510		ERM$C_EMPTYFILE : BYTLIT,				! FILE CONTAINS NO MODULES
;08425  0511		SEV$C_DIAG : SHORT;
;08430  0512	!
;08500  0513	EXTERNAL ROUTINE	
;08510  0514		LNK$ERRMSG,						! REPORT ERRORS
;08600  0515		LNK$NXTFIL,						! OPEN NEXT FILE
;08700  0516		LNK$POINTOBJ;						! POINT TO A MODULE IN LIBRARY
;08800  0517	!
;08900  0518	EXTERNAL
;09000  0519		LNK$GL_CURFIL : REF BLOCK[,BYTE];			! POINTER TO CURRENT FILE.
;09100  0520	!
;09200  0521	OWN
;09300  0522		CUROBMODESC : REF BLOCK[,BYTE];				! POINTER TO CURRENT OBJ.
;09400  0523	!
;09500  0524	GLOBAL ROUTINE LNK$NXTOBJMOD(OBMODESC)=
;09600  0525	BEGIN
;09700  0526	!
;09800  0527	!	IF THE END OF A LIST OF OBJECT MODULE DESCRIPTORS (OR
;09900  0528	!	FIRST CALL) OPEN NEXT FILE. ON SUBSEQUENT CALLS FOLLOW DOWN
;10000  0529	!	CURRENT LIST. FINALLY RETURN VALUE FALSE
;10100  0530	!

; Bliss-32 7.352	Saturday 22-AUG-1978 04:52:29	DBB3:[LINKER.SRC]LNKNXTOBJ.B32;6				Page 2-1
; Digital Equipment Corporation
;
;10200  0531	LOCAL
;10300  0532		LSTOBMODESC : REF BLOCK[,BYTE];				! POINTER TO PREVIOUS OBJ MOD. DESCRIPTOR
;10400  0533	!
;10500  0534	IF (LSTOBMODESC = .CUROBMODESC) NEQ 0				! IF THERE WAS ONE
;10600  0535	THEN CUROBMODESC = .CUROBMODESC[OMD$L_NXTOMD];			! BEFORE, GET THE ONE
;10700  0536	WHILE (.CUROBMODESC EQL 0) DO					! IT POINTS TO IF THERE
;10800  0537	BEGIN								! IS NO LONGER A DESCRIPTOR
;10900  0538		LSTOBMODESC = 0;					! RESET THE LAST OBJECT DESCRIPTOR
;11000  0539		IF NOT LNK$NXTFIL()					! OPEN NEXT FILE
;11100  0540		THEN BEGIN						! AND ALL DONE IF NO MORE
;11200  0541			LNK$GL_CURFIL = 0;
;11300  0542			RETURN FALSE;
;11400  0543		     END;
;11500  0544		IF (CUROBMODESC = .LNK$GL_CURFIL[FDB$L_OMDLST]) EQL 0	! OTHERWISE GET THE FIRST MODULE
;11510  0545		THEN BEGIN						! BUT IF THERE IS NONE
;11520  0546			BIND AUXFNB = LNK$GL_CURFIL[FDB$AL_AUXFNB]	! POINT TO THE AUXILIARY FILE NAME
;11530  0547						: BLOCK[,BYTE];		! BLOCK
;11540  0548			LNK$ERRMSG(ERM$C_EMPTYFILE,SEV$C_DIAG,		! AND OUTPUT THE MESSAGE
;11550  0549				.AUXFNB[NAM$B_RSL],.AUXFNB[NAM$L_RSA]);
;11560  0550		     END;
;11600  0551	     END;
;11700  0552	IF (.LNK$GL_CURFIL[FDB$B_FILFLGS] AND LNK$M_LIBR) NEQ 0		! IF A LIBRARY FILE
;11800  0553	OR (.CUROBMODESC[OMD$B_FLAGS] AND OMD$M_SHRIMG) NEQ 0		! AND/OR A SHAREABLE IMAGE
;11900  0554	OR ( (.LSTOBMODESC NEQ 0)					! OR THIS IS NOT THE FIRST IN A CONCATENATED
;12000  0555		AND (LSTOBMODESC[OMD$B_FLAGS] AND OMD$M_NOBIN) NEQ 0)	! OBJ BUT IS PRECEDED BY A MODULE WITH NO BINARY
;12100  0556	THEN LNK$POINTOBJ(CUROBMODESC[OMD$L_MODVBN]);			! POINT TO THE MODULE
;12200  0557	.OBMODESC = .CUROBMODESC;					! RETURN NEW DESCRIPTOR
;12300  0558	RETURN TRUE;							! AND SUCCESS
;12400  0559	END;


							    .TITLE  LNK_NXTOBJ
							    .IDENT  \X01.05\

							    .PSECT  $OWN$,NOEXE,2

					      00000 CUROBMODESC:
							    .BLKB   4

						    SYM$C_MAXLNG==	15
						    FDB$C_SIZE==	75
						    LNK$S_NEWUDF==	0
						    LNK$S_LIBR==	1
						    LNK$S_SHR==		2
						    LNK$S_SELSER==	3
						    LNK$S_OPTION==	4
						    LNK$S_DEBUGER==	5
						    LNK$S_LIBEXTR==	6
						    LNK$S_LIBSRCH==	7
						    LNK$M_NEWUDF==	1
						    LNK$M_LIBR==	2
						    LNK$M_SHR==		4
						    LNK$M_SELSER==	8
						    LNK$M_OPTION==	16
						    LNK$M_DEBUGER==	32

; Bliss-32 7.352	Saturday 22-AUG-1978 04:52:29	DBB3:[LINKER.SRC]LNKNXTOBJ.B32;6				Page 2-2
; Digital Equipment Corporation
;
						    LNK$M_LIBEXTR==	64
						    LNK$M_LIBSRCH==	128
						    PMT$L_PSCDES==	0
						    PMT$L_MODCON==	1
						    PMT$L_SYMLST==	1
						    PMT$C_SIZE==	8
						    OMD$C_SIZE==	2080
						    OMD$M_NOPSCT==	1
						    OMD$S_NOPSCT==	0
						    OMD$M_NOBIN==	2
						    OMD$S_NOBIN==	1
						    OMD$M_SHRIMG==	4
						    OMD$S_SHRIMG==	2
						    OMD$M_SELSER==	8
						    OMD$S_SELSER==	3
						    OMD$M_MAPMOD==	16
						    OMD$S_MAPMOD==	4
						    OMD$M_DEBUGER==	32
						    OMD$S_DEBUGER==	5
						    PSC$C_SIZE==	43
						    MPC$C_SIZE==	17
						    LID$C_SIZE==	4
						    CLU$C_SIZE==	55
						    CLU$S_BASED==	0
						    CLU$S_SYMBAS==	1
						    CLU$S_SHRIMG==	2
						    CLU$S_PIC==		3
						    CLU$S_COPY==	4
						    CLU$S_OPEN==	5
						    CLU$S_PENDING==	6
						    FVM$C_SIZE==	12
							    .GLOBL  ERM$C_EMPTYFILE, SEV$C_DIAG, LNK$ERRMSG, LNK$NXTFIL
							    .GLOBL  LNK$POINTOBJ, LNK$GL_CURFIL

							    .PSECT  $CODE$,NOWRT,2

					 0C04 00000 	    .ENTRY  LNK$NXTOBJMOD, Save R2,R10,R11			      ; 0524
		         5A	0000G  CF  9E 00002 	    MOVAB   LNK$GL_CURFIL, R10					      ;
		         5B	0000'  CF  9E 00007 	    MOVAB   CUROBMODESC, R11					      ;
		         52	       6B  D0 0000C 	    MOVL    CUROBMODESC, LSTOBMODESC				      ; 0534
				       03  13 0000F 	    BEQL    1$							      ;
		         7B	       9B  D0 00011 	    MOVL    @CUROBMODESC, CUROBMODESC				      ; 0535
				       6B  D5 00014 1$:     TSTL    CUROBMODESC						      ; 0536
				       2F  12 00016 	    BNEQ    3$							      ;
				       52  D4 00018 	    CLRL    LSTOBMODESC						      ; 0538
		  0000G  CF	       00  FB 0001A 	    CALLS   #0, LNK$NXTFIL					      ; 0539
		         04	       50  E8 0001F 	    BLBS    R0, 2$						      ;
				       6A  D4 00022 	    CLRL    LNK$GL_CURFIL					      ; 0541
				       4E  11 00024 	    BRB     6$							      ; 0542
		         50	       6A  D0 00026 2$:     MOVL    LNK$GL_CURFIL, R0					      ; 0544
		         6B	  04   A0  D0 00029 	    MOVL    4(R0), CUROBMODESC					      ;
				       E5  12 0002D 	    BNEQ    1$							      ;
		         50	       13  C0 0002F 	    ADDL2   #19, R0						      ; 0546
				  04   A0  DD 00032 	    PUSHL   4(R0)						      ; 0548
		         7E	  03   A0  9A 00035 	    MOVZBL  3(R0), -(SP)					      ;

; Bliss-32 7.352	Saturday 22-AUG-1978 04:52:29	DBB3:[LINKER.SRC]LNKNXTOBJ.B32;6				Page 2-3
; Digital Equipment Corporation
;
		         7E	       00  9A 00039 	    MOVZBL  #SEV$C_DIAG, -(SP)					      ;
		         7E	  00G  8F  9A 0003C 	    MOVZBL  #ERM$C_EMPTYFILE, -(SP)				      ;
		  0000G  CF	       04  FB 00040 	    CALLS   #4, LNK$ERRMSG					      ;
				       CD  11 00045 	    BRB     1$							      ; 0536
		         50	       6A  D0 00047 3$:     MOVL    LNK$GL_CURFIL, R0					      ; 0552
	   14	    0A   A0	       01  E0 0004A 	    BBS     #1, 10(R0), 4$					      ;
		         50	       6B  D0 0004F 	    MOVL    CUROBMODESC, R0					      ; 0553
	   0C	    0F   A0	       02  E0 00052 	    BBS     #2, 15(R0), 4$					      ;
				       52  D5 00057 	    TSTL    LSTOBMODESC						      ; 0554
				       11  13 00059 	    BEQL    5$							      ;
	   50	         52	       0F  C1 0005B 	    ADDL3   #15, LSTOBMODESC, R0				      ; 0555
	   09	         50	       01  E1 0005F 	    BBC     #1, R0, 5$						      ;
	   7E	         6B	       08  C1 00063 4$:     ADDL3   #8, CUROBMODESC, -(SP)				      ; 0556
		  0000G  CF	       01  FB 00067 	    CALLS   #1, LNK$POINTOBJ					      ;
		    04   BC	       6B  D0 0006C 5$:     MOVL    CUROBMODESC, @OBMODESC				      ; 0557
		         50	       01  D0 00070 	    MOVL    #1, R0						      ; 0558
					   04 00073 	    RET     							      ;
				       50  D4 00074 6$:     CLRL    R0							      ; 0524
					   04 00076 	    RET     							      ;

; Routine Size:  119 bytes


;12500  0560	END ELUDOM






;				       PSECT SUMMARY
;
;	Name		 Bytes			       Attributes
;
;  $OWN$          	     4    WRT,  RD ,NOEXE,NOSHR,  LCL,  REL,  CON,NOPIC,ALIGN(2)
;  $CODE$         	   119  NOWRT,  RD ,  EXE,NOSHR,  LCL,  REL,  CON,NOPIC,ALIGN(2)




;				LIBRARY STATISTICS
;
;					     -------- Symbols --------    Blocks
;	File				     Total    Loaded   Percent      Read
;
;  DBA4:[SYSLIB]STARLET.L32;1		      2688         3         0       109





; Size:		119 code + 4 data bytes
; Run Time:	00:13.2
; Elapsed Time:	00:15.2
; Memory Used:	177 pages

; Bliss-32 7.352	Saturday 22-AUG-1978 04:52:29									Page 2-4
; Digital Equipment Corporation
;
; Compilation Complete
