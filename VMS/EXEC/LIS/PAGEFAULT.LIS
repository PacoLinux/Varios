PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page   0
TABLE OF CONTENTS   

   (1)    3100  HISTORY			; DETAILED
   (2)     100  DECLARATIONS
   (3)     100  PAGE FAULT HANDLER
   (4)     100  SYSTEM PAGE FAULT, ESTABLISH PAGE TYPE
   (5)     100  EXECEPTION ENTRY POINT - PAGE TYPE DISPATCHER
   (6)     100  PAGE FILE, SECTION TABLE INDEX, OR GLOBAL PAGE
   (7)     100  PAGE NOT RESIDENT, QUEUE A READ REQUEST
   (8)     100  FORM A CLUSTER OF PAGES TO READ
   (9)     100  DEMAND ZERO PAGE
   (10)    100  FREE, MODIFIED, OR BAD PAGE LIST, RELEASE PENDI
   (11)    100  SCANDEADPT - SCAN A DEAD PAGE TABLE FOR TRANSIT
   (12)    100  WSLEPFN - FETCH PFN FROM WORKING SET LIST ENTRY
   (13)    100  FREWSLE - FREE A WORKING SET LIST ENTRY
   (15)    100  DELWSLEX - DELETE WORKING SET LIST ENTRY BY IND
   (17)    100  ININEWPFN - ALLOCATE AND INIT A NEW PFN
   (19)    100  MAKEWSLE - MAKE A WORKING SET LIST ENTRY
   (21)    100  LOCKPGTB - LOCK PAGE TABLE
   (22)    100  INCPTREF - INCREMENT PAGE TABLE REFERENCE COUNT
   (24)    100  DECPTREF - DECREMENT PAGE TABLE REFERENCE COUNT
   (26)    100  DECPHDREF - DECREMENT PROCESS HEADER REFERENCE 
   (27)    100  INIBLDPKT - INIT FOR CALLING BUILDPKT
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page   1
X0425                                                                                                                            (1)

                                     0000   100 	.TITLE	PAGEFAULT - TRANSLATION NOT VALID EXCEPTION HANDLER
                                     0000   200 	.IDENT	/X0425/
                                     0000   300 ;
                                     0000   400 ; COPYRIGHT (C) 1978
                                     0000   500 ; DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASSACHUSETTS 01754
                                     0000   600 ;
                                     0000   700 ; THIS SOFTWARE IS FURNISHED  UNDER A LICENSE FOR USE ONLY ON A SINGLE
                                     0000   800 ; COMPUTER  SYSTEM AND  MAY BE  COPIED ONLY WITH  THE INCLUSION OF THE
                                     0000   900 ; ABOVE COPYRIGHT NOTICE.  THIS SOFTWARE, OR ANY OTHER COPIES THEREOF,
                                     0000  1000 ; MAY NOT BE PROVIDED OR  OTHERWISE MADE AVAILABLE TO ANY OTHER PERSON
                                     0000  1100 ; EXCEPT FOR USE ON SUCH SYSTEM AND TO ONE WHO AGREES TO THESE LICENSE
                                     0000  1200 ; TERMS.  TITLE TO AND  OWNERSHIP OF THE  SOFTWARE  SHALL AT ALL TIMES
                                     0000  1300 ; REMAIN IN DEC.
                                     0000  1400 ;
                                     0000  1500 ; THE INFORMATION IN THIS SOFTWARE IS SUBJECT TO CHANGE WITHOUT NOTICE
                                     0000  1600 ; AND SHOULD  NOT BE CONSTRUED  AS A COMMITMENT  BY DIGITAL  EQUIPMENT
                                     0000  1700 ; CORPORATION.
                                     0000  1800 ;
                                     0000  1900 ; DEC ASSUMES  NO  RESPONSIBILITY  FOR  THE USE OR  RELIABILITY OF ITS
                                     0000  2000 ; SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DEC.
                                     0000  2100 
                                     0000  2200 ;++
                                     0000  2300 ; FACILITY:	EXECUTIVE, TRANSLATION NOT VALID EXCEPTION HANDLER
                                     0000  2400 ;
                                     0000  2500 ; ABSTRACT:
                                     0000  2600 ;
                                     0000  2700 ; ENVIRONMENT:
                                     0000  2800 ;
                                     0000  2900 ;--
                                     0000  3000 ;
                                     0000  3100 	.SBTTL	HISTORY			; DETAILED
                                     0000  3200 ;
                                     0000  3300 ; AUTHOR: PETER H. LIPMAN	, CREATION DATE: 14-SEP-76
                                     0000  3400 ;
                                     0000  3500 ; MODIFIED BY:
                                     0000  3600 ;	, : VERSION
                                     0000  3700 ; 01	 -
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page   2
X0425           DECLARATIONS                                                                                                     (2)

                                     0000   100 	.SBTTL	DECLARATIONS
                                     0000   200 ;
                                     0000   300 ; INCLUDE FILES:
                                     0000   400 ;
                                     0000   500 	$CADEF				;CONDITIONAL ASSEMBLY DEFINITIONS
                                     0000   600 	$IPLDEF				;PROCESSOR PRIORITY LEVEL DEFINITIONS
                                     0000   700 	$IRPDEF				;I/O REQUEST PACKET DEFINITIONS
                                     0000   800 	$PCBDEF				;PROCESS CONTROL BLOCK DEFINITIONS
                                     0000   900 	$PHDDEF				;PROCESS HEADER DEFINTIONS
                                     0000  1000 	$PRDEF				;PROCESSOR REGISTER DEFINITIONS
                                     0000  1100 	$PFLDEF				;PAGE FILE CONTROL BLOCK DEFINITIONS
                                     0000  1200 	$PFNDEF				;PFN DATA BASE DEFINITIONS
                                     0000  1300 	$PSLDEF				;PROCESSOR STATUS LONG WORD DEFINITIONS
                                     0000  1400 	$PTEDEF				;PAGE TABLE ENTRY OFFSETS
                                     0000  1500 	$RSNDEF				;RESOURCE NAME DEFINITIONS
                                     0000  1600 	$SECDEF				;SECTION TABLE DEFINITIONS
                                     0000  1700 	$SSDEF				;SYSTEM STATUS DEFINITIONS
                                     0000  1800 	$VADEF				;VIRTUAL ADDRESS VIELDS
                                     0000  1900 	$WQHDEF				;WAIT QUEUE HEADER DEFINITIONS
                                     0000  2000 	$WSLDEF				;WORKING SET LIST DEFINITIONS
                                     0000  2100 ;
                                     0000  2200 ; EXTERNAL SYMBOLS:
                                     0000  2300 ;
                                     0000  2400 
                                     0000  2500 ;
                                     0000  2600 ; MACROS:
                                     0000  2700 ;
                                     0000  2800 
                                     0000  2900 ;
                                     0000  3000 ; EQUATED SYMBOLS:
                                     0000  3100 ;
                                     0000  3200 	$OFFSET <4*6>,POSITIVE,<-
                                     0000  3300 	FLTCTL,-			;OFFSET TO FAULT CONTROL BITS
                                     0000  3400 	FLTVA,-				;OFFSET TO FAULT VIRTUAL ADDRESS
                                     0000  3500 	FLTPC,-				;OFFSET TO FAULT PC
                                     0000  3600 	FLTPSL-				;OFFSET TO FAULT PSL
                                     0000  3700 	>
                                     0018       FLTCTL:
                                     001C       FLTVA:
                                     0020       FLTPC:
                                     0024       FLTPSL:
                                     0000  3800 
                                     0000  3900 	$VIELD	PGF,0,<-		;DEFINE PAGE FAULT CONTROL BITS
                                     0000  4000 		LENVIO,-		;LENGTH VIOLATION
                                     0000  4100 		PGTBFLT,-		;PAGE TABLE FAULT
                                     0000  4200 		WRTACC-			;REFERENCE WAS WRITE OR MODIFY
                                     0000  4300 	>
                                     0000  4400 ;
                                     0000  4500 ; OFFSETS INTO I/O PACKET WHILE BEING USED AS SCRATCH STORAGE FOR CLUSTERING
                                     0000  4600 ;
                                     0000  4700 	$OFFSET	0,POSITIVE,<-
                                     0000  4800 		PTEDAT,-		;MASTER PTE CONTENTS
                                     0000  4900 		SVAPTE,-		;MASTER PTE ADDRESS
                                     0000  5000 		SIZE_TYPE,-		;RESERVED FOR SIZE AND TYPE
                                     0000  5100 		VA,-			;VIRTUAL ADDRESS
                                     0000  5200 		AST,-			;AST INFO
                                     0000  5300 		ASTPRM,-		; AND PARAMETER
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page   3
X0425           DECLARATIONS                                                                                                     (2)

                                     0000  5400 		GPTX,-			;PROCESS PTE CONTENT FOR GLOBAL PAGE
                                     0000  5500 		GPTX_PTE,-		;PROCESS PTE ADR FOR GLOBAL PAGE
                                     0000  5600 		<CLUSTER,1>,-		;DESIRED CLUSTER SIZE
                                     0000  5700 		<COUNT,1>,-		;CURRENT COUNT OF PAGES
                                     0000  5800 		<STATE,1>,-		;SAVED PFN_STATE BYTE
                                     0000  5900 		<PRI,1>,-		;PRIORITY OF I/O TRANSFER
                                     0000  6000 		BAK,-			;PFN BACKING STORE ADDRESS
                                     0000  6100 		INC1,-			;+ OR - 1
                                     0000  6200 		INC4,-			;+ OR - 4
                                     0000  6300 		INC512,-		;+ OR - 512
                                     0000  6400 		VBN,-			;VIRTUAL BLOCK NUMBER
                                     0000  6500 		WINDOW,-		;WINDOW CONTROL BLOCK ADR
                                     0000  6600 		FP_SAV,-		;SAVED FP
                                     0000  6700 		<PCB_SAV,8>,-		;SAVED PCB, PHD ADDRESS
                                     0000  6750 		PHVREFCADR,-		;PROCESS HEADER REFERENCE COUNT ADDRESS
                                     0000  6800 		<CLU_SCRATCH_SIZ,0>-	;SIZE OF THIS SCRATCH AREA
                                     0000  6900 		>
                                     0000       PTEDAT:
                                     0004       SVAPTE:
                                     0008       SIZE_TYPE:
                                     000C       VA:
                                     0010       AST:
                                     0014       ASTPRM:
                                     0018       GPTX:
                                     001C       GPTX_PTE:
                                     0020       CLUSTER:
                                     0021       COUNT:
                                     0022       STATE:
                                     0023       PRI:
                                     0024       BAK:
                                     0028       INC1:
                                     002C       INC4:
                                     0030       INC512:
                                     0034       VBN:
                                     0038       WINDOW:
                                     003C       FP_SAV:
                                     0040       PCB_SAV:
                                     0048       PHVREFCADR:
                                     004C       CLU_SCRATCH_SIZ:
                                     0000  7000 
                                     0000  7100 	ASSUME	CLU_SCRATCH_SIZ LE IRP$C_LENGTH
                                     0000  7200 	ASSUME	SIZE_TYPE EQ IRP$W_SIZE
                                     0000  7300 	ASSUME	AST EQ IRP$L_AST
                                     0000  7400 	ASSUME	ASTPRM EQ IRP$L_ASTPRM
                                     0000  7500 	ASSUME	PRI EQ IRP$B_PRI
                                     0000  7600 ;
                                     0000  7700 ; OWN STORAGE:
                                     0000  7800 ;
                                 00000000  7900 	.PSECT	$$$210,LONG
                                     0000  8000 ;
                                     0000  8100 ; STATISTICS
                                     0000  8200 ;
                                     0000  8300 PMS$GL_FAULTS::
                           00000004  0000  8400 	.BLKL	1			;COUNT OF PAGE FAULTS
                                     0004  8500 PMS$GL_RDFLTS::				;OBSOLETE NAME
                                     0004  8600 PMS$GL_PREADS::
                           00000008  0004  8700 	.BLKL	1			;PAGE READS
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page   4
X0425           DECLARATIONS                                                                                                     (2)

                                     0008  8800 PMS$GL_PREADIO::
                           0000000C  0008  8900 	.BLKL	1			;I/O REQUESTS TO READ THE PAGES
                                     000C  9000 PMS$GL_PWRITES::
                           00000010  000C  9100 	.BLKL	1			;MODIFIED PAGES WRITTEN
                                     0010  9200 PMS$GL_PWRITIO::
                           00000014  0010  9300 	.BLKL	1			;I/O REQUESTS TO WRITE THE MODIFIED PAGES
                                     0014  9400 PMS$GL_DZROFLTS::
                           00000018  0014  9500 	.BLKL	1			;DEMAND ZERO PAGE FAULTS
                                     0018  9600 PMS$AL_TRANSFLT::
                           00000038  0018  9700 	.BLKL	<1@PFN$S_LOC>		;PAGE FAULTS OUT OF TRANSITION STATES
                                     0038  9800 PMS$GL_DPTSCN::
                           0000003C  0038  9900 	.BLKL	1			;DEAD PAGE TABLE SCANS
                                     003C 10000 PMS$GL_REFERFLT::
                           00000040  003C 10100 	.BLKL	1			;REFERENCE FAULT COUNT
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page   5
X0425           PAGE FAULT HANDLER                                                                                               (3)

                                     0040   100 	.SBTTL	PAGE FAULT HANDLER
                                     0040   200 
                                     0040   300 ;++
                                     0040   400 ; FUNCTIONAL DESCRIPTION:
                                     0040   500 ;
                                     0040   600 ;
                                     0040   700 ; CALLING SEQUENCE:
                                     0040   800 ;	NONE
                                     0040   900 ;
                                     0040  1000 ;
                                     0040  1100 ; INPUT PARAMETERS:
                                     0040  1200 ;	NONE
                                     0040  1300 ;
                                     0040  1400 ; IMPLICIT INPUTS:
                                     0040  1500 ;	NONE
                                     0040  1600 ;
                                     0040  1700 ; OUTPUT PARAMETERS:
                                     0040  1800 ;	NONE
                                     0040  1900 ;
                                     0040  2000 ; IMPLICIT OUTPUTS:
                                     0040  2100 ;	NONE
                                     0040  2200 ;
                                     0040  2300 ; COMPLETION CODES:
                                     0040  2400 ;	NONE
                                     0040  2500 ;
                                     0040  2600 ; SIDE EFFECTS:
                                     0040  2700 ;	NONE
                                     0040  2800 ;
                                     0040  2900 ;--
                                     0040  3000 
                                     0040  3001 ;
                                     0040  3002 ; **********************************************************************
                                     0040  3003 ;
                                     0040  3004 ; **************** THIS ENTIRE MODULE MUST BE RESIDENT *****************
                                     0040  3005 ;
                                 00000000  3006 	.PSECT	$MMG$COD,LONG
                                     0000  3007 ;
                                     0000  3008 ; **********************************************************************
                                     0000  3009 ;
                                     0000  3600 	.LIST	MEB
                                     0000  3610 
                                     0000  3700 IPLHI:	BUG_CHECK PGFIPLHI,FATAL	;IPL TOO HIGH FOR PAGE FAULT
                               FEFF  0000       		.WORD	^XFEFF
                               0004' 0002       		.IIF IDN <FATAL>,<FATAL> , .WORD	BUG$_PGFIPLHI!4
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page   6
X0425           SYSTEM PAGE FAULT, ESTABLISH PAGE TYPE                                                                           (4)

                                     0004   100 	.SBTTL	SYSTEM PAGE FAULT, ESTABLISH PAGE TYPE
                                     0004   200 
                                     0004   300 	.ENABL	LSB
                                     0004   400 ;
                                     0004   500 ; BAD SYSTEM PAGE - PROCESS HEADER OR PAGE TABLE PAGE FOR ANOTHER PROCESS
                                     0004   600 ;
                                     0004   700 BADSYSPAG:
                          069F   31  0004  1100 	BRW	ACVIOLAT		;FAKE AN ACCESS VIOLATION
                                     0007  1200 ;
                                     0007  1300 ; SEE IF PAGE IS A GLOBAL PAGE TABLE PAGE, OTHERWISE ERROR
                                     0007  1400 ;
                                     0007  1500 GPGTBL:
   00000000'EF            50     B1  0007  1600 	CMPW	R0,SGN$GL_BALSETCT	;SYSTEM BALANCE SET SLOT?
                          F4     19  000E  1700 	BLSS	BADSYSPAG		;BRANCH IF NOT
       0000'CF            52     D1  0010  1800 	CMPL	R2,W^MMG$GL_MAXGPTE	;LEGAL GPTE ADDRESS
                          ED     1E  0015  1900 	BGEQU	BADSYSPAG
            52            0A     90  0017  2000 	MOVB	#WSL$C_GPGTBL,R2	;PAGE IS GLOBAL PAGE TABLE
                          2E     11  001A  2100 	BRB	50$
                                     001C  2110 ;
                                     001C  2120 ; PAGE IS NOT SYSTEM PAGE TYPE, COULD BE GLOBAL PAGE TABLE, PROCESS PAGE TABLE
                                     001C  2125 ; OR PROCESS HEADER PAGE
                                     001C  2130 ;
                                     001C  2140 NOTSYSTEM:
            50         F7 8F     78  001C  2145 	ASHL	#-9,R0,R0		;SCALE VA DIFFERENCE TO PAGE NUMBER
                          50         0020       
            55         64 A4     D0  0021  2150 	MOVL	PCB$L_PHD(R4),R5	;ADDRESS OF PROCESS HEADER
            50       0000'CF     C6  0025  2160 	DIVL	W^SWP$GL_BSLOTSZ,R0	;PROCESS HEADER INDEX
         46 A5            50     B1  002A  2170 	CMPW	R0,PHD$W_PHVINDEX(R5)	;THIS PROCESS' HEADER?
                          D7     12  002E  2180 	BNEQ	GPGTBL			;BRANCH IF NOT, MAYBE GLOBAL PAGE TABLE
            52            08     90  0030  2190 	MOVB	#WSL$C_PPGTBL,R2	;ASSUME PROCESS PAGE TABLE
                          1E     11  0033  2230 	BRB	70$
                                     0035  2300 ;
                                     0035  2350 ; PAGE FAULT MONITORING ENABLED FOR THIS PROCESS
                                     0035  2400 ;
                                     0035  2450 PGFMONITOR:
                          FFC8'  30  0035  2500 	BSBW	PFM$MON			;CALL THE RECORDING ROUTINE
                          5B     11  0038  2550 	BRB	PGFMONITOR1		;RETURN IN LINE
                                     003A  2700 ;
                                     003A  2800 ; PAGE FAULT FOR SYSTEM SPACE VIRTUAL ADDRESS
                                     003A  2900 ;	R2 = FAULT VA, LOW BITS CLEARED
                                     003A  3000 ;	R4 = PROCESS PCB ADDRESS
                                     003A  3100 ;
                                     003A  3200 SYSTEMSPACE:
            15            09     EF  003A  3300 	EXTZV	#VA$V_VPN,#VA$S_VPN,R2,R3 ;PAGE NUMBER IN SYSTEM SPACE
            53            52         003D       
            52       0000'CF     C3  003F  3400 	SUBL3	W^SWP$GL_BALBASE,R2,R0 ;ABOVE BASE OF BALANCE SET SLOTS?
                          50         0044       
                          D5     18  0045  3500 	BGEQ	NOTSYSTEM		;BRANCH IF NOT SYSTEM PAGE TYPE
            52            02     90  0047  4500 40$:	MOVB	#WSL$C_SYSTEM,R2	;SYSTEM PAGE
            54       0000'CF     DE  004A  4600 50$:	MOVAL	W^MMG$AL_SYSPCB,R4	;ADDRESS OF SYSTEM PCB
            55         64 A4     D0  004F  4700 	MOVL	PCB$L_PHD(R4),R5	;ADDRESS OF SYSTEM PROCESS HEADER
            53       0000'DF43   DE  0053  4800 70$:	MOVAL	@W^MMG$GL_SPTBASE[R3],R3 ;ADDRESS OF PAGE TABLE ENTRY
                          51     11  0059  4900 	BRB	GETPAGELOC
                                     005B  5000 
                                     005B  5100 ;
                                     005B  5200 ; THIS IS A PROCESS PAGE TABLE FAULT
                                     005B  5300 ;
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page   7
X0425           SYSTEM PAGE FAULT, ESTABLISH PAGE TYPE                                                                           (4)

                                     005B  5400 PPGTBL:
            53   000001FF 8F     CB  005B  5600 	BICL3	#^X1FF,R3,R2		;R2 = FAULT VA
                          52         0062       
                          D5     11  0063  5700 	BRB	SYSTEMSPACE
                                     0065  5800 
                                     0065  7000 	.DSABL	LSB
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page   8
X0425           EXECEPTION ENTRY POINT - PAGE TYPE DISPATCHER                                                                    (5)

                                     0065   100 	.SBTTL	EXECEPTION ENTRY POINT - PAGE TYPE DISPATCHER
                                     0065   200 
                                     0065   300 	.ALIGN	LONG
                                     0068   400 MMG$PAGEFAULT::
            7E            54     7D  0068   500 	MOVQ	R4,-(SP)		;SAVE R4, R5
            05            10     ED  006B   600 	CMPZV	#PSL$V_IPL,#PSL$S_IPL,<12+8>(SP),#IPL$_ASTDEL ;CHECK FAULT IPL
            02         14 AE         006E       
                          8D     14  0071   700 	BGTR	IPLHI			;BRANCH IF IPL IS TOO HIGH
            7E            52     7D  0073   800 	MOVQ	R2,-(SP)		;SAVE R2, R3
                                     0076   900 	SETIPL	#IPL$_SYNCH		;LOCK THE DATA BASE
            12            07     DA  0076       		MTPR	#IPL$_SYNCH,S^#PR$_IPL
            54       0000'CF     D0  0079  1000 	MOVL	W^SCH$GL_CURPCB,R4	;R4 = ADDRESS OF PCB
            7E            50     7D  007E  1100 	MOVQ	R0,-(SP)		;SAVE R0, R1
         1C AE   000001FF 8F     CB  0081  1200 	BICL3	#^X1FF,FLTVA(SP),R2	;R2 = VA OF FAULT (LOW BITS CLEAR)
                          52         0089       
                          AE     19  008A  1300 	BLSS	SYSTEMSPACE		;BRANCH IF SYSTEM SPACE ADDRESS
            55         64 A4     D0  008C  1400 	MOVL	PCB$L_PHD(R4),R5	;R5 = ADDRESS OF HEADER
         3A A5            00     E0  0090  1500 	BBS	#PHD$V_PFMFLG,PHD$W_FLAGS(R5),PGFMONITOR ;BRANCH IF PAGE FAULT MONITORING
                          A0         0094       
                                     0095  1600 PGFMONITOR1:
            15            09     EF  0095  1700 	EXTZV	#VA$V_VPN,#VA$S_VPN,R2,R3 ;VIRTUAL PAGE IN P0 OR P1 SPACE
            53            52         0098       
            52            1E     E1  009A  1800 	BBC	#VA$V_P1,R2,20$		;BRANCH IF P0 SPACE
                          08         009D       
            53       00D0 D543   DE  009E  1900 	MOVAL	@PHD$L_P1BR(R5)[R3],R3	;GET SYS VIRT ADR OF PTE FOR P1 SPACE
                          06     11  00A4  2000 	BRB	GETPAGELOC
            53       00C8 D543   DE  00A6  2100 20$:	MOVAL	@PHD$L_P0BR(R5)[R3],R3	;GET SYS VIRT ADR OF PTE FOR P0 SPACE
                                     00AC  2200 ;
                                     00AC  2300 ; R2 = VA (LOW BITS = PAGTYP), R3 = SVAPTE
                                     00AC  2400 ;
                                     00AC  2500 GETPAGELOC:
            15            09     EF  00AC  2600 	EXTZV	#VA$V_VPN,#VA$S_VPN,R3,R0 ;INDEX TO SPT ENTRY
            50            53         00AF       
            51       0000'DF40   DE  00B1  2700 	MOVAL	@W^MMG$GL_SPTBASE[R0],R1 ;ADDRESS OF SPTE FOR PAGE TABLE
                          61     D5  00B7  2750 	TSTL	(R1)			;IS SPTE VALID?
                          A0     18  00B9  2800 	BGEQ	PPGTBL			;BRANCH IF NOT, FAULT IT
            63   7B800000 8F     CB  00BB  3500 	BICL3	#^C<PTE$M_VALID		-;CHECK VALID BIT
                          50         00C2       
                                     00C3  3600 		! PTE$M_TYP1 ! PTE$M_TYP0 -;GET PTE TYPE BITS
                                     00C3  3700 		! PTE$M_PGFLVB>,(R3),R0	;AND PFN/PAGE FILE VBN BITS TO R0
                          25     15  00C3  3800 	BLEQ	20$			;BRANCH IF DEMAND ZERO OR VALID
            50   04400000 8F     D3  00C5  3900 	BITL	#<PTE$M_TYP1 ! PTE$M_TYP0>,R0 ;IF BOTH ZERO, THEN TRANSITION
                          1E     12  00CC  4000 	BNEQ	30$			;BRANCH IF NOT TRANSITION PAGE
                          00     ED  00CE  4100 	CMPZV	#PFN$V_LOC,#PFN$S_LOC,-	;ACTIVE TRANSITION PAGE
       0000'DF40          03         00D0  4200 		@W^PFN$AB_STATE[R0],#PFN$C_ACTIVE ;IS FAULT BACK OF
                          07         00D5       
                                     00D6  4300 					;PARTIALLY DISCARDED PAGE
                                     00D6  4400 					;WORKING SET LIST ENTRY IS STILL VALID
                          14     12  00D6  4500 	BNEQ	30$			;BRANCH IF NOT ACTIVE
                                     00D8  4600 
                           00000002  00D8  4700 	.IF	GT,CA$_MEASURE
                     003C'CF     D6  00D8  4800 	INCL	W^PMS$GL_REFERFLT	;COUNT REFERENCE FAULTS SYSTEM WIDE
                       14 A5     D6  00DC  4850 	INCL	PHD$L_REFERFLT(R5)	;AND PER PROCESS
                                     00DF  4900 	.ENDC
                                     00DF  5000 
         03 A3         80 8F     88  00DF  5100 	BISB	#PTE$M_VALID@-24,3(R3)	;JUST SET VALID BIT
                          3F     BA  00E4  5200 10$:	POPR	#^M<R0,R1,R2,R3,R4,R5>	;RESTORE REGISTERS
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page   9
X0425           EXECEPTION ENTRY POINT - PAGE TYPE DISPATCHER                                                                    (5)

            5E            08     C0  00E6  5300 	ADDL	#8,SP			;CLEAN OFF FAULT PARAMETERS
                                 02  00E9  5400 	REI				;AND RETURN TO FAULTING INSTRUCTION
                                     00EA  5500 
                          F8     19  00EA  5600 20$:	BLSS	10$			;BRANCH IF PAGE IS ALREADY VALID
                                     00EC  5610 ;
                                     00EC  5620 ; R0 = TYP1 ! TYP0 ! PGFLVB,  VALID IS KNOWN TO BE OFF AT THIS POINT
                                     00EC  5630 ; R1 = SPT ENTRY ADDRESS FOR PAGE TABLE PAGE
                                     00EC  5640 ; R2 = VA (LOW BITS = PAGTYP)
                                     00EC  5650 ; R3 = SVAPTE
                                     00EC  5660 ;
                                     00EC  5700 30$:
                           00000002  00EC  5720 	.IF	GT,CA$_MEASURE
                     0000'CF     D6  00EC  5730 	INCL	W^PMS$GL_FAULTS		;COUNT ALL THE PAGE FAULTS
                       4C A5     D6  00F0  5740 	INCL	PHD$L_PAGEFLTS(R5)	;COUNT PROCESS' PAGE FAULTS
                                     00F3  5750 	.ENDC
                                     00F3  5760 
                          0E     BB  00F3  5790 	PUSHR	#^M<R1,R2,R3>		;SAVE REGISTERS
                          06C7   30  00F5  5800 	BSBW	MMG$FREWSLE		;FREE A WORKING SET LIST ENTRY
            3F            50     E9  00F8  5900 	BLBC	R0,RSRCWAIT_3		;BRANCH IF HAVE TO WAIT
                                     00FB  6020 ;
                                     00FB  6030 ; ***** ALL POINTS DISPATCHED TO FROM HERE MUST REMEMBER THAT
                                     00FB  6040 ; ***** 0(SP) = VA (LOW BITS = PAGTYP), 4(SP) = SVAPTE
                                     00FB  6050 ;
            53         08 AE     D0  00FB  6090 	MOVL	8(SP),R3		;SVAPTE
                                     00FF  6120 ;
                                     00FF  6130 ; MUST RECHECK VALIDITY OF PAGE TABLE PAGE, SINCE FREWSLE MIGHT HAVE DISCARDED IT
                                     00FF  6140 ;
                          9E     D5  00FF  6150 	TSTL	@(SP)+			;IS PAGE TABLE PAGE VALID?
                          3D     18  0101  6160 	BGEQ	PPGTBL_2		;NO, GO FAULT THE PAGE TABLE
                                     0103  6170 ;
                                     0103  6180 ; MUST FETCH PAGE TABLE ENTRY CONTENTS AGAIN SINCE DEAD PAGE TABLE SCAN
                                     0103  6190 ; IN FREWSLE MIGHT HAVE DISCARDED THE PAGE.  NOTE THAT VALID IS KNOWN 0.
                                     0103  6200 ;
            63   7B800000 8F     CB  0103  6210 	BICL3	#^C<PTE$M_VALID ! -	;FETCH VALID BIT
                          50         010A       
                                     010B  6220 		PTE$M_TYP1 ! PTE$M_TYP0 !- ;PTE TYPE BITS
                                     010B  6230 		PTE$M_PGFLVB>,(R3),R0	;AND PGFLVB, GPTX, SECX, PFN
                          2A     13  010B  6240 	BEQL	DZRO_PTE_0		;BRANCH IF PAGE IS DEMAND ZERO
                                     010D  6900 ;
                                     010D  6910 ; FORM R1 = 4 BIT SIGN EXTENDED VIELD LOW BIT = TYP0, SIGN = TYP1
                                     010D  6920 ;
            05            16     EE  010D  7000 	EXTV	#PTE$V_TYP0,#<PTE$V_TYP1+1-PTE$V_TYP0>,R0,R1
            51            50         0110       
                          47     12  0112  7100 	BNEQ	NOTRANSITION		;BRANCH IF NOT TRANSITION PAGE
                                     0114  7200 ;
                                     0114  7300 ; THIS IS A PAGE IN TRANSITION
                                     0114  7400 ; R0 = PFN, R2 = VA (LOW BITS = PAGTYP), R3 = SVAPTE
                                     0114  7500 ;
                                     0114  7600 TRANSITION:
            03            00     EF  0114  7700 	EXTZV	#PFN$V_LOC,#PFN$S_LOC,@W^PFN$AB_STATE[R0],R2 ;PAGE LOCATION
            52       0000'DF40       0117       
                                     011C  7800 
                           00000002  011C  7900 	.IF	GT,CA$_MEASURE
                     0018'CF42   D6  011C  8000 	INCL	W^PMS$AL_TRANSFLT[R2]	;COUNT VARIOUS TRANSITION FAULTS
                                     0121  8100 	.ENDC
                                     0121  8200 	
                                     0121  8300 	CASE	R2,<-
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  10
X0425           EXECEPTION ENTRY POINT - PAGE TYPE DISPATCHER                                                                    (5)

                                     0121  8400 		PFNLIST,-		;ON THE FREE PAGE LIST
                                     0121  8500 		PFNLIST,-		;ON THE MODIFIED PAGE LIST
                                     0121  8600 		PFNLIST,-		;ON THE BAD PAGE LIST
                                     0121  8700 		RELEASEPEND,-		;RELEASE PENDING
                                     0121  8800 		READERR,-		;PAGE READ ERROR
                                     0121  8900 		WRITEINPROG,-		;PAGE WRITE IN PROGRESS
                                     0121  9000 		READINPROG-		;PAGE READ IN PROGRESS
                                     0121  9100 	>
            00            52     AF  0121       	CASEW	R2,#0,S^#<<30001$-30000$>/2>-1
                          06'        0124       
                                     0125       30000$:
                               04CC' 0125       	.WORD	PFNLIST-30000$
                               04CC' 0127       	.WORD	PFNLIST-30000$
                               04CC' 0129       	.WORD	PFNLIST-30000$
                               04CF' 012B       	.WORD	RELEASEPEND-30000$
                               051B' 012D       	.WORD	READERR-30000$
                               04CF' 012F       	.WORD	WRITEINPROG-30000$
                               024B' 0131       	.WORD	READINPROG-30000$
                                     0133       30001$:
                                     0133  9200 LOCBAD:	BUG_CHECK PGFLOCBAD,FATAL	;BAD PAGE LOCATION FIELD
                               FEFF  0133       		.WORD	^XFEFF
                               0004' 0135       		.IIF IDN <FATAL>,<FATAL> , .WORD	BUG$_PGFLOCBAD!4
                                     0137  9300 
                                     0137  9400 DZRO_PTE_0:
                          03F3   31  0137  9600 	BRW	DZRO_PTE
                                     013A  9700 RSRCWAIT_3:
            5E            0C     C0  013A  9800 	ADDL	#3*4,SP			;CLEAN OFF 3 LONG WORDS
                          022C   31  013D  9900 	BRW	RESOURCEWAIT		;AND GO WAIT FOR A RESOURCE
                                     0140 10000 PPGTBL_2:
                          03     BA  0140 10100 	POPR	#^M<R0,R1>		;CLEAN OFF 2 LONG WORDS, SCRATCH R0,R1
                          FF16   31  0142 10200 	BRW	PPGTBL			;FAULT A PROCESS PAGE TABLE
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  11
X0425           PAGE FILE, SECTION TABLE INDEX, OR GLOBAL PAGE                                                                   (6)

                                     0145   100 	.SBTTL	PAGE FILE, SECTION TABLE INDEX, OR GLOBAL PAGE
                                     0145   200 ;
                                     0145   300 ; GLOBAL PAGE, MASTER PTE VALID.
                                     0145   400 ; R0 = MASTER PTE CONTENTS (VALID, MODIFY AND PFN BITS)
                                     0145   500 ; 0(SP) = PROCESS VA (LOW BITS = PAGTYP), 4(SP) = SLAVE PTE ADDRESS
                                     0145   600 ;
                                     0145   700 GBLVALID:
            52            6E     7D  0145   800 	MOVQ	(SP),R2			;R2=VA (LOW BITS = PAGTYP), R3=SVAPTE
                          50     DD  0148   900 	PUSHL	R0			;SAVE MASTER PTE
            15            00     EF  014A  1000 	EXTZV	#PTE$V_PFN,#PTE$S_PFN,R0,R0 ;PAGE FRAME NUMBER
            50            50         014D       
                          085B   30  014F  1100 	BSBW	MMG$MAKEWSLE		;MAKE A WORKING SET LIST ENTRY
                          0E     BA  0152  1200 	POPR	#^M<R1,R2,R3>		;R1=MASTER PTE, R2=VA, R3=SVAPTE
                          04D0   31  0154  1300 	BRW	SETSLAVEPTE		;SET PROCESS' PTE AND EXIT
                                     0157  1400 ;
                                     0157  1500 ; BAD MASTER PAGE TABLE ENTRY FORMAT FOR A GLOBAL PAGE
                                     0157  1600 ;
                                     0157  1700 GBLBAD:	BUG_CHECK PGFGBLBAD,FATAL	;BAD MASTER PTE FORMAT FOR GLOBAL PAGE
                               FEFF  0157       		.WORD	^XFEFF
                               0004' 0159       		.IIF IDN <FATAL>,<FATAL> , .WORD	BUG$_PGFGBLBAD!4
                                     015B  2300 ;
                                     015B  2400 ; PAGE IS NOT A TRANSITION OR DEMAND ZERO PAGE
                                     015B  2500 ; R0 = LOW 23 BITS OF PTE AND TYPE BITS (PAGE FILE VBN, GPTX OR STX)
                                     015B  2600 ; R1 = RESULT OF EXTV ABOVE, CONDITION CODES SET FROM EXTV
                                     015B  2700 ; 0(SP) = VA (LOW BITS = PAGTYP), 4(SP) = SVAPTE
                                     015B  2800 ;
                                     015B  2900 NOTRANSITION:
                          7A     19  015B  3000 	BLSS	NOTGLOBAL		;BRANCH IF TYP1 SET, NOT A GLOBAL PAGE
            50            16     E5  015D  3100 	BBCC	#PTE$V_TYP0,R0,10$	;LEAVE JUST GLOBAL PAGE TABLE INDEX
                          00         0160       
            53       0000'DF40   DE  0161  3150 10$:	MOVAL	@W^MMG$GL_GPTBASE[R0],R3 ;ADDRESS OF MASTER PTE
            63            0A     9C  0167  3200 	ROTL	#<32-<PTE$V_OWN-WSL$V_PAGTYP>>,(R3),R1 ;OWNER FIELD TO LOW BITS
                          51         016A       
                                     016B  3250 ;
                                     016B  3300 ; MASTER PTE OWNER FIELD CONTAINS THE VALUE PFN$C_GLOBAL OR PFN$C_GBLWRT
                                     016B  3350 ;
            51         F1 8F     8B  016B  3500 	BICB3	#^C<WSL$M_PAGTYP>,R1,(SP) ;SET PAGE TYPE FIELD
                          6E         016F       
            63   7B800000 8F     CB  0170  3800 	BICL3	#^C<PTE$M_VALID ! -	;GET THE VALID BIT
                          50         0177       
                                     0178  3900 		PTE$M_TYP1 ! PTE$M_TYP0 ! - ;THE PTE TYPE BITS
                                     0178  4000 		PTE$M_PGFLVB>,(R3),R0	;AND PAGE FILE VBN, OR STX
                          CB     19  0178  4100 	BLSS	GBLVALID		;BRANCH IF MASTER PTE IS VALID
                          DB     13  017A  4200 	BEQL	GBLBAD			;ERROR IF MASTER PTE IS DEMAND ZERO
            05            16     EE  017C  4300 	EXTV	#PTE$V_TYP0,#<PTE$V_TYP1+1-PTE$V_TYP0>,R0,R1
            51            50         017F       
                                     0181  4400 ;
                                     0181  4500 ; R1 = 0 IF TYP1 AND TYP0 ARE BOTH ZERO
                                     0181  4600 ; R1 = NEGATIVE IF TYP1 IS SET
                                     0181  4700 ; R1<0> = 1 IF TYP0 IS SET
                                     0181  4800 ;
                          91     13  0181  4900 	BEQL	TRANSITION		;BRANCH IF GLOBAL TRANSITION
                          D2     14  0183  5000 	BGTR	GBLBAD			;BRANCH IF GLOBAL AGAIN, ERROR
                                     0185  5100 ;
                                     0185  5200 ; MASTER PAGE TABLE ENTRY IS A SECTION OR PAGE FILE ADDRESS
                                     0185  5300 ;
            08            51     E9  0185  5400 20$:	BLBC	R1,30$			;BRANCH IF PAGE FILE
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  12
X0425           PAGE FILE, SECTION TABLE INDEX, OR GLOBAL PAGE                                                                   (6)

            50            11     E0  0188  5450 	BBS	#PTE$V_DZRO,R0,GBLDZRO	;BRANCH IF DEMAND ZERO GLOBAL SECTION
                          45         018B       
            50            10     E0  018C  5500 	BBS	#PTE$V_CRF,R0,GBLCRF	;BRANCH IF COPY ON REFERENCE
                          06         018F       
                                     0190  5800 ;
                                     0190  5900 ; GLOBAL SECTION (NOT CRF OR DZRO) OR PAGE FILE BACKING STORE ADR
                                     0190  6000 ;
            50         04 AE     D0  0190  6100 30$:	MOVL	4(SP),R0		;SAVE SLAVE PTE ADR INDICATING GLOBAL
                          4A     11  0194  6300 	BRB	GBLNOTRESIDENT		;
                                     0196  6310 ;
                                     0196  6320 ; GLOBAL COPY ON REFERENCE PAGE
                                     0196  6330 ;
                                     0196  6340 GBLCRF:
                          6E     94  0196  6400 	CLRB	(SP)			;SAY PAGE IS PROCESS PAGE
            50            53     D0  0198  6500 	MOVL	R3,R0			;MASTER PTE ADDRESS
                          43     11  019B  6600 	BRB	GBLNOTRESIDENT		;
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  13
X0425           PAGE NOT RESIDENT, QUEUE A READ REQUEST                                                                          (7)

                                     019D   100 	.SBTTL	PAGE NOT RESIDENT, QUEUE A READ REQUEST
                                     019D   600 	.ENABL	LSB
                                     019D   700 
                                     019D  1100 ;
                                     019D  1200 ; MUST WAIT FOR AN I/O REQUEST PACKET
                                     019D  1300 ;
                                     019D  1400 IRPWAIT_3:
                          02     BA  019D  1500 	POPR	#^M<R1>			;CLEAN OFF 1 LONG WORD
            51            03     9A  019F  1600 	MOVZBL	#RSN$_NPDYNMEM,R1	;NON PAGED DYNAMIC MEMORY RESOURCE NUMBER
                          0C     BA  01A2  1700 10$:	POPR	#^M<R2,R3>		;CLEAN OFF 2 LONG WORDS
                          01C5   31  01A4  1800 	BRW	RESOURCEWAIT		;WAIT FOR RESOURCE IN R1
                                     01A7  1805 ;
                                     01A7  1810 ; THIS PAGE READ WOULD EXCEED THIS PROCESS' DIRECT I/O QUOTA.
                                     01A7  1815 ; WAIT UNTIL SOME OF HIS OUTSTANDING I/O COMPLETES.
                                     01A7  1820 ;
                                     01A7  1825 DIOCNTWAIT_2:
            51            01     9A  01A7  1830 	MOVZBL	#RSN$_ASTWAIT,R1	;AST WAIT RESOURCE NUMBER
                          F6     11  01AA  1835 	BRB	10$
                                     01AC  1900 
                                     01AC  2000 	.DSABL	LSB
                                     01AC  2100 
                                     01AC  2200 ;
                                     01AC  2300 ; NO I/O PACKETS ON THE SIDE LIST, MUST ALLOCATE ONE FROM NON-PAGED POOL
                                     01AC  2350 ; 0(SP) = PLACE TO STORE ADDRESS OF PACKET, TOTAL OF 3 LONG WORDS ON STACK
                                     01AC  2400 ;
                                     01AC  2500 GET_IRP:
            6E            50     D0  01AC  2600 	MOVL	R0,(SP)			;SAVE REGISTER
            51         4C 8F     9A  01AF  2700 	MOVZBL	#IRP$C_LENGTH,R1	;SIZE OF I/O PACKET
                          FE4A'  30  01B3  2800 	BSBW	EXE$ALONONPAGED		;ALLOCATE THE PACKET
            E4            50     E9  01B6  2900 	BLBC	R0,IRPWAIT_3		;BRANCH IF NONE AVAILABLE
                          01     BA  01B9  3000 	POPR	#^M<R0>			;RESTORE SAVED REGISTER
                          52     DD  01BB  3100 	PUSHL	R2			;I/O PACKET ADDRESS
                          6A     11  01BD  3200 	BRB	GOT_IRP			;REJOIN THE MAIN FLOW
                                     01BF  3300 ;
                                     01BF  3400 ; MUST WAIT FOR A FREE PAGE, 5 LONG WORDS ON STACK, FIRST 2 ARE GARBAGE
                                     01BF  3500 ; 8(SP) = I/O REQUEST PACKET ADDRESS TO BE DEALLOCATED, LAST 2 ARE SCRATCH
                                     01BF  3600 ;
                                     01BF  3700 FREPAGWAIT_5:
                          03     BA  01BF  3800 	POPR	#^M<R0,R1>		;SCRATCH R0,R1
                          07     BA  01C1  3900 	POPR	#^M<R0,R1,R2>		;I/O PACKET ADDRESS TO R0
         08 A0         4C 8F     9B  01C3  4000 	MOVZBW	#IRP$C_LENGTH,IRP$W_SIZE(R0) ;SET SIZE OF PACKET
                          FE35'  30  01C8  4100 	BSBW	EXE$DEANONPAGED		;AND DEALLOCATE IT
                          0197   31  01CB  4200 	BRW	FREEPAGEWAIT
                                     01CE  4300 ;
                                     01CE  4400 ; DEMAND ZERO PROCESS SECTION PAGE
                                     01CE  4500 ;
                                     01CE  4600 DZRO_PROC_SEC:
                          035C   31  01CE  4700 	BRW	DZRO_PTE
                                     01D1  4800 ;
                                     01D1  4900 ; DEMAND ZERO GLOBAL SECTION PAGE
                                     01D1  5000 ;
                                     01D1  5100 GBLDZRO:
            51            63     D0  01D1  5150 	MOVL	(R3),R1			;MASTER PTE CONTENTS
                          035A   31  01D4  5200 	BRW	DZRO_GBL_SEC
                                     01D7  5300 
                                     01D7  5400 ;
                                     01D7  5500 ; PAGE IS NOT A GLOBAL PAGE
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  14
X0425           PAGE NOT RESIDENT, QUEUE A READ REQUEST                                                                          (7)

                                     01D7  5600 ; R1<31>=TYP1, R1<0>=TYP0, R0 = TYP1 ! TYP0 ! PGFLVB
                                     01D7  5700 ;
                                     01D7  5800 NOTGLOBAL:
            04            51     E9  01D7  5900 	BLBC	R1,10$			;BRANCH IF NOT SECTION PAGE
            50            11     E0  01DA  6000 	BBS	#PTE$V_DZRO,R0,DZRO_PROC_SEC ;BRANCH IF DEMAND ZERO PROCESS SECTION
                          F0         01DD       
                          50     D4  01DE  6100 10$:	CLRL	R0			;INDICATE NO SLAVE PAGE TABLE ENTRY
                                     01E0  6200 ;
                                     01E0  6210 ; 0(SP) = VA (LOW BITS = PAGTYP), 4(SP) = SVAPTE (SLAVE IF GLOBAL)
                                     01E0  6220 ; R0	= MASTER PTE ADDRESS IF GLOBAL CRF
                                     01E0  6230 ;	= SLAVE PTE ADDRESS IF GLOBAL NOT CRF
                                     01E0  6240 ;	= 0 IF NOT GLOBAL
                                     01E0  6250 ;
                                     01E0  6260 GBLNOTRESIDENT:
            01         39 A5     91  01E0  6270 	CMPB	PHD$B_PGTBPFC(R5),#1	;IF CLUSTERING PAGE TABLE PAGES
                          32     15  01E4  6280 	BLEQ	40$
            15            09     EF  01E6  6290 	EXTZV	#VA$V_VPN,#VA$S_VPN,4(SP),R2 ;SEE IF ADJACENT PAGE TABLES
            52         04 AE         01E9       
            51       0000'DF42   DE  01EC  6300 	MOVAL	@W^MMG$GL_SPTBASE[R2],R1 ;NEED TO BE FAULTED, GET SPT ENTRY ADR
            71   847FFFFF 8F     D3  01F2  6310 	BITL	#<PTE$M_VALID ! -
                                     01F9  6320 		PTE$M_TYP1 ! PTE$M_TYP0 ! -
                                     01F9  6330 		PTE$M_PGFLVB>,-(R1)	;CHECK PREVIOUS SPT ENTRY
                          0E     14  01F9  6340 	BGTR	10$			;BRANCH IF NOT VALID, NOT DZRO
         08 A1   847FFFFF 8F     D3  01FB  6350 	BITL	#<PTE$M_VALID ! -
                                     0203  6360 		PTE$M_TYP1 ! PTE$M_TYP0 ! -
                                     0203  6370 		PTE$M_PGFLVB>,8(R1)	;CHECK NEXT SPT ENTRY
                          13     15  0203  6380 	BLEQ	40$			;BRANCH IF IT IS VALID
                                     0205  6390 ;
                                     0205  6400 ; NEXT PAGE TABLE NEEDS TO BE FAULTED
                                     0205  6410 ;
                          52     D6  0205  6420 	INCL	R2			;SET NEXT SPT INDEX
                          02     11  0207  6430 	BRB	20$
                                     0209  6440 ;
                                     0209  6450 ; PREVIOUS PAGE TABLE NEEDS TO BE FAULTED
                                     0209  6460 ;
                          52     D7  0209  6470 10$:	DECL	R2			;SET PREVIOUS SPT INDEX
            52            09     9C  020B  6480 20$:	ROTL	#9,R2,R2		;TURN SPT INDEX BACK INTO
                          52         020E       
            52            1F     E2  020F  6490 	BBSS	#VA$V_SYSTEM,R2,30$	;SYSTEM VIRTUAL ADDRESS
                          00         0212       
                          03     BA  0213  6500 30$:	POPR	#^M<R0,R1>		;CLEAN STACK SCRATCH R0,R1
                          FE22   31  0215  6510 	BRW	SYSTEMSPACE		;GO FAULT THE PAGE TABLE
            51       0000'CF     D0  0218  6810 40$:	MOVL	W^SCH$GL_CURPCB,R1	;COULD HAVE SYSTEM PCB IN R4
                       44 A1     B5  021D  6820 	TSTW	PCB$W_DIOCNT(R1)	;ENOUGH DIRECT I/O QUOTA FOR THIS READ?
                                     0220  6830 					;NOTE THAT BUILDPKT WILL CHARGE THE READ
                          85     15  0220  6840 	BLEQ	DIOCNTWAIT_2		;BRANCH IF NO, MUST WAIT.
            7E       0000'DF     0F  0222  6900 	REMQUE	@W^IOC$GL_IRPFL,-(SP)	;GET AN I/O PACKET FROM THE SIDE LIST
                          83     1D  0227  7000 	BVS	GET_IRP			;BRANCH IF NEED TO GET ONE FROM THE POOL
                                     0229  7100 ;
                                     0229  7200 ; R0	= MASTER PTE ADDRESS IF GLOBAL CRF
                                     0229  7300 ;	= SLAVE PTE ADDRESS IF GLOBAL NOT CRF
                                     0229  7400 ;	= 0 IF NOT GLOBAL
                                     0229  7510 ; 0(SP) = I/O REQUEST PACKET ADDRESS
                                     0229  7600 ;
                                     0229  7700 GOT_IRP:
            52         04 AE     7D  0229  7800 	MOVQ	4(SP),R2		;R2=VA (LOW BITS = PAGTYP), R3=SVAPTE
                          7E     D4  022D  8000 	CLRL	-(SP)			;INIT CRF INDICATOR TO "NOT CRF PAGE"
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  15
X0425           PAGE NOT RESIDENT, QUEUE A READ REQUEST                                                                          (7)

                          50     DD  022F  8100 	PUSHL	R0			;SAVE GLOBAL, GBLCRF INDICATOR
                          073B   30  0231  8200 	BSBW	MMG$ININEWPFN		;ALLOCATE AND INIT A NEW PFN
                          50     D5  0234  8300 	TSTL	R0			;PFN ALLOCATED SUCCESSFULLY?
                          87     19  0236  8400 	BLSS	FREPAGWAIT_5		;BRANCH IF NOT, MUST WAIT
            53       0000'DF40   D0  0238  8500 	MOVL	@W^PFN$AL_PTE[R0],R3	;GET MASTER PTE ADDRESS
                                     023E  8525 					;SAME AS SLAVE UNLESS GLOBAL
         10 AE            53     D0  023E  8550 	MOVL	R3,16(SP)		;SAVE FOR LATER USE
                     0000'DF40   B6  0242  8700 	INCW	@W^PFN$AW_REFCNT[R0]	;2ND REFERENCE FOR PAGE I/O
                                     0247  8800 ;
                                     0247  8900 ; FORM R2 = BACKING STORE ADDRESS
                                     0247  9000 ; 0(SP)  = MASTER PAGE TABLE ENTRY ADDRESS IF GLOBAL CRF
                                     0247  9100 ;	 = SLAVE  PAGE TABLE ENTRY ADDRESS IF GLOBAL NOT CRF
                                     0247  9200 ;	 = 0 IF NOT GLOBAL PAGE
                                     0247  9300 ; 4(SP)  = 0 INITIALIZED TO "NOT COPY ON REFERENCE"
                                     0247  9400 ;	  SET THIS TO CORRECT BACKING STORE ADDRESS IF CRF PAGE
                                     0247  9500 ; 8(SP)  = I/O REQUEST PACKET ADDRESS
                                     0247  9520 ; 12(SP) = VIRTUAL ADDRESS (LOW BITS = PAGTYP)
                                     0247  9540 ; 16(SP) = SVAPTE, GLOBAL IF NOT GBL CRF, PROCESS IF NOT GBL OR IF GBL CRF
                                     0247  9600 ;
            63   867FFFFF 8F     CB  0247  9700 	BICL3	#^C<PTE$M_PROT ! PTE$M_OWN>,(R3),R1 ;R1 = PROT AND OWN
                          51         024E       
            63            51     CB  024F  9800 	BICL3	R1,(R3),R2		;R2 = TYP1 ! TYP0 ! PGFLVB
                          52         0252       
            51            50     C9  0253  9900 	BISL3	R0,R1,(R3)		;PTE = PROT ! OWN ! PFN = TRANSITION PTE
                          63         0256       
            52            1A     E4  0257 10000 	BBSC	#PTE$V_TYP1,R2,20$	;BRANCH IF PAGE FILE OR SECTION
                          14         025A       
                                     025B 10100 ;
                                     025B 10200 ; GLOBAL COPY ON REFERENCE PAGE
                                     025B 10300 ;
            53            8E     D0  025B 10400 	MOVL	(SP)+,R3		;GET MASTER PAGE TABLE ENTRY ADDRESS
            52   00800000 8F     C9  025E 10500 	BISL3	#PFN$M_GBLBAK,R2,(SP)	;GBL BACKING STORE ADR IN CRF INDICATOR
                          6E         0265       
                          63     DD  0266 10600 	PUSHL	(R3)			;SAVE MASTER PAGE TABLE ENTRY CONTENTS
            17            00     EF  0268 10700 	EXTZV	#PFN$V_BAK,#PFN$S_BAK,(R3),R2 ;GET ADR FROM MASTER PTE
            52            63         026B       
                          0C     11  026D 10800 	BRB	25$			;TO COPY ON REFERENCE SECTION LOGIC
                                     026F 10900 ;
                                     026F 11000 ; PAGE FILE OR SECTION ADDRESS
                                     026F 11100 ;
            52            16     E1  026F 11200 20$:	BBC	#PTE$V_TYP0,R2,40$	;BRANCH IF PAGING FILE
                          18         0272       
            52            10     E1  0273 11300 	BBC	#PTE$V_CRF,R2,50$	;BRANCH IF NOT CRF
                          18         0276       
                                     0277 11400 ;
                                     0277 11500 ; COPY ON REFERENCE SECTION TABLE ENTRY
                                     0277 11600 ;
         04 AE            52     D0  0277 11700 	MOVL	R2,4(SP)		;SAVE BACKING ADDRESS IN CRF INDICATOR
                                 D0  027B 11800 25$:	MOVL	PHD$L_PAGFIL(R5),-	;NULL PAGE FILE ADDRESS
       0000'DF40       1C A5         027C 11900 		@W^PFN$AL_BAK[R0]	;"NOT YET ALLOCATED" PAGING FILE ADR
                                 88  0282 12000 	BISB	#<PFN$M_MODIFY ! PFN$C_RDINPROG>,-
       0000'DF40       86 8F         0283 12100 		@W^PFN$AB_STATE[R0]	;FORCE MODIFY BIT, READ IN PROGRESS
                          10     11  0289 12200 	BRB	60$
                                     028B 12300 ;
                                     028B 12400 ; PAGING FILE BACKING STORE ADDRESS
                                     028B 12500 ;
            52         1C A5     C8  028B 12600 40$:	BISL	PHD$L_PAGFIL(R5),R2	;SET PAGE FILE INDEX
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  16
X0425           PAGE NOT RESIDENT, QUEUE A READ REQUEST                                                                          (7)

                                     028F 12800 ;
                                     028F 12900 ; SECTION TABLE BACKING STORE ADDRESS
                                     028F 13000 ;
       0000'DF40          06     88  028F 13100 50$:	BISB	#PFN$C_RDINPROG,@W^PFN$AB_STATE[R0] ;READ IN PROGRESS
       0000'DF40          52     D0  0295 13200 	MOVL	R2,@W^PFN$AL_BAK[R0]	;STORE BACKING STORE ADDRESS
                                     029B 13300 ;
                                     029B 13400 ; R0 = PFN
                                     029B 13500 ; R2 = BACKING STORE ADDRESS
                                     029B 13600 ; R3 = PAGE TABLE ENTRY ADDRESS, PROCESS ADR IF NOT GLOBAL,
                                     029B 13700 ;	GLOBAL ADDRESS IF GLOBAL OR GLOBAL CRF
                                     029B 13800 ; R4 = PROCESS PCB IF PROCESS PAGE, PROCESS PAGE TABLE, OR GLOBAL PAGE,
                                     029B 13850 ;    = SYSTEM PCB IF SYSTEM PAGE OR GLOBAL PAGE TABLE
                                     029B 13900 ; R5 = PROCESS HEADER ADDRESS CORRESPONDING TO THE ABOVE PCB ADDRESS
                                     029B 14000 ; 0(SP)  = MASTER PTE CONTENTS IF GLOBAL CRF (>0)
                                     029B 14100 ;	 = SLAVE PTE ADDRESS IF GLOBAL NOT CRF (<0)
                                     029B 14200 ;	 = 0 IF NOT GLOBAL
                                     029B 14300 ; 4(SP)  = 0 IF PAGE IS NOT COPY ON REFERENCE
                                     029B 14400 ;	 = BACKING STORE ADDRESS (FOR GBL CRF TOO) IF CRF PAGE
                                     029B 14500 ; 8(SP)  = I/O REQUEST PACKET ADDRESS
                                     029B 14533 ; 12(SP) = VIRTUAL ADDRESS (LOW BITS = PAGTYP)
                                     029B 14566 ; 16(SP) = SVAPTE, GLOBAL IF NOT GBL CRF, PROCESS IF NOT GBL OR IF GBL CRF
                                     029B 14600 ;
            51         08 AE     D0  029B 14610 60$:	MOVL	8(SP),R1		;ADDRESS OF I/O REQUEST PACKET
         3C A1            5D     D0  029F 14620 	MOVL	FP,FP_SAV(R1)		;SAVE A REGISTER
            5D            51     D0  02A3 14630 	MOVL	R1,FP			;USE THIS FOR CLUSTER CONTEXT
         40 AD            54     7D  02A6 14640 	MOVQ	R4,PCB_SAV(FP)		;SAVE PCB, PHD ADDRESSES
                          6E     D5  02AA 14700 	TSTL	(SP)			;LESS THAN 0 IF GLOBAL PAGE
                          0E     13  02AC 14800 	BEQL	70$			;BRANCH IF NOT GLOBAL PAGE
                          07     14  02AE 14820 	BGTR	65$			;BRANCH IF GLOBAL CRF
            54   00000000'EF     DE  02B0 14840 	MOVAL	L^MMG$AL_SYSPCB,R4	;USE SYSTEM PCB FOR GLOBAL PAGES
                                     02B7 14860 					;WANT THE PRIORITY FROM IT
            55       0000'DF     DE  02B7 14900 65$:	MOVAL	@W^MMG$GL_SYSPHD,R5	;SYSTEM PROCESS HEADER ADDRESS
                                     02BC 15000 ;
                                     02BC 15100 ; IF THE BACKING STORE ADDRESS IN R2 IS A GLOBAL ADDRESS, THEN R3 IS THE MASTER PTE
                                     02BC 15200 ; AND R5 IS THE SYSTEM PROCESS HEADER, OTHERWISE R3 IS THE PROCESS PTE
                                     02BC 15300 ; ADDRESS AND R5 IS THE PROCESS HEADER ADDRESS.
                                     02BC 15400 ;
            6D            52     7D  02BC 15500 70$:	MOVQ	R2,PTEDAT(FP)		;SAVE PTE DATA, AND ADDRESS
                                     02BF 15600 
                                     02BF 15700 	ASSUME	ASTPRM EQ AST+4
         10 AD            8E     7D  02BF 15800 	MOVQ	(SP)+,AST(FP)		;STORE PARAMETERS TO IOPOST IN IRP
                                     02C3 15810 ;
                                     02C3 15820 ; FETCH THE TRANSFER PRIORITY FROM PROCESS PCB IF PROCESS PAGE,
                                     02C3 15825 ; PROCESS PAGE TABLE, OR GLOBAL CRF PAGE.  USE SYSTEM PRIORITY
                                     02C3 15832 ; IF SYSTEM PAGE, GLOBAL PAGE, OR GLOBAL PAGE TABLE.
                                     02C3 15850 ;
         23 AD         33 A4     90  02C3 15900 	MOVB	PCB$B_PRIB(R4),PRI(FP)	;STORE PRIORITY OF TRANSFER IN IRP
         24 AD       0000'DF40   D0  02C8 15920 	MOVL	@W^PFN$AL_BAK[R0],BAK(FP) ;SAVE BACKING STORE ADDRESS
                                 8B  02CF 15940 	BICB3	#^C<PFN$M_MODIFY ! PFN$M_LOC>,- ;AND STATE BYTE INFORMATION
       0000'DF40       78 8F         02D0 15960 		@W^PFN$AB_STATE[R0],STATE(FP) ;FROM PFN DATA OF FIRST PAGE
                       22 AD         02D6       
                          6E     D4  02D8 15965 	CLRL	(SP)			;THROUGH WITH IRP ADDRESS, USE FOR SCRATCH
                                     02DA 15970 					;WILL BE PAGE TABLE FAULT CLUSTER IF PPGTBL
                       48 AD     D4  02DA 15975 	CLRL	PHVREFCADR(FP)		;ADDRESS OF PROCESS HEADER REF CNT IF PPGTBL
                                     02DD 15980 
                                     02DD 15985 	ASSUME	PFN$C_PROCESS EQ 0
                                     02DD 15990 	ASSUME	PFN$C_SYSTEM  EQ 1
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  17
X0425           PAGE NOT RESIDENT, QUEUE A READ REQUEST                                                                          (7)

                                     02DD 16000 	ASSUME	PFN$C_GLOBAL  EQ 2
                                     02DD 16010 	ASSUME	PFN$C_GBLWRT  EQ 3
                                     02DD 16020 	ASSUME	PFN$C_PPGTBL  EQ 4
                                     02DD 16030 	ASSUME	PFN$C_GPGTBL  EQ 5
                          01     ED  02DD 16040 	CMPZV	#WSL$V_PAGTYP,#WSL$S_PAGTYP,- ;IF PAGE TABLE PAGE
         04 AE            03         02DF 16050 		4(SP),#PFN$C_PPGTBL	;THEN SEPARATE CLUSTER FACTOR
                          04         02E2       
                          1B     19  02E3 16060 	BLSS	90$			;BRANCH IF NOT PAGE TABLE
                          16     14  02E5 16070 	BGTR	80$			;BRANCH IF GLOBAL PAGE TABLE
                                     02E7 16080 ;
                                     02E7 16090 ; MUST RECORD A PROCESS HEADER REFERENCE FOR PAGE READ OF PROCESS HEADER PAGE
                                     02E7 16100 ;
            51         46 A5     3C  02E7 16110 	MOVZWL	PHD$W_PHVINDEX(R5),R1	;PROCESS HEADER VECTOR INDEX
            51       0000'DF41   3E  02EB 16120 	MOVAW	@W^PHV$GL_REFCBAS[R1],R1 ;ADDRESS OF PROCESS HEADER REF CNT
                          61     B6  02F1 16125 	INCW	(R1)			;COUNT ANOTHER REFERENCE
         48 AD            51     D0  02F3 16130 	MOVL	R1,PHVREFCADR(FP)	;SAVE ADDRESS FOR CLUSTERING CODE
            6E         39 A5     90  02F7 16135 	MOVB	PHD$B_PGTBPFC(R5),(SP)	;GET PAGE TABLE CLUSTER FACTOR
                          03     12  02FB 16140 	BNEQ	90$			;BRANCH IF SPECIFIED
            6E            01     D0  02FD 16160 80$:	MOVL	#1,(SP)			;INDICATE NO CLUSTERING
                          07C8   30  0300 16300 90$:	BSBW	MMG$INIBLDPKT		;SET UP REGISTERS TO CALL BUILDPKT
       0000'CF   00000000'8F     E0  0303 16315 	BBS	#EXE$V_NOCLUSTER,W^EXE$GL_FLAGS,110$ ;BRANCH IF CLUSTERING DISABLED
                          23         030C       
            54         40 AD     7D  030D 16320 	MOVQ	PCB_SAV(FP),R4		;RECOVER PCB, PHD ADDRESSES
                                     0311 16330 
                                     0311 16340 	ASSUME	SEC$B_PFC EQ PFL$B_PFC
         01 AE         0B A1     90  0311 16350 	MOVB	SEC$B_PFC(R1),1(SP)	;PAGE FAULT CLUSTER FROM
                                     0316 16360 					;SECTION OR PAGE FILE CONTROL BLOCK
            51            6E     9A  0316 16365 	MOVZBL	(SP),R1			;SEE IF PAGE TABLE CLUSTER SPECIFIED
                          0A     14  0319 16370 	BGTR	100$			;BRANCH IF SPECIFIED
            51         01 AE     9A  031B 16372 	MOVZBL	1(SP),R1		;SEE IF PAGE FILE OR SECTION TABLE
                                     031F 16374 					;CLUSTER WAS SPECIFIED
                          04     14  031F 16376 	BGTR	100$			;BRANCH IF IT WAS
            51         38 A5     9A  0321 16380 	MOVZBL	PHD$B_DFPFC(R5),R1	;DEFAULT FROM PROCESS HEADER
                                     0325 16390 					;PROCESS IF PROCESS OR GLOBAL PAGE
                                     0325 16400 					;SYSTEM IF SYSTEM PAGE
            01            51     D1  0325 16420 100$:	CMPL	R1,#1			;CLUSTER OF 1?
                          06     15  0328 16425 	BLEQ	110$			;BRANCH IF YES
            5E            04     C0  032A 16427 	ADDL	#4,SP			;CLEAN OFF CLUSTER FACTOR SCRATCH
                          0092   31  032D 16430 	BRW	TRY_TO_CLUSTER		;GO TRY TO CLUSTER
            51            01     D0  0330 16440 110$:	MOVL	#1,R1			;ONE PAGE READ
            5E            08     C0  0333 16450 	ADDL	#8,SP			;CLEAN OFF VIRTUAL ADDRESS
            53            8E     D0  0336 16460 	MOVL	(SP)+,R3		;SVAPTE FROM PFN$AL_PTE
                                     0339 16462 ;
                                     0339 16464 ; R0 = VBN, R1 = PAGE COUNT, R2 = WINDOW, R3 = SVAPTE, FP = IRP
                                     0339 16466 ;
                                     0339 16470 QUEUE_PAGE_READ:
                                     0339 16480 
                           00000002  0339 16490 	.IF	GT,CA$_MEASURE
                     0008'CF     D6  0339 16500 	INCL	W^PMS$GL_PREADIO	;COUNT PAGE READ I/O REQUESTS
       0004'CF            51     C0  033D 16510 	ADDL	R1,W^PMS$GL_PREADS	;AND THE NUMBER OF PAGES READ
                                     0342 16520 	.ENDC
                                     0342 16530 
            51            09     78  0342 16540 	ASHL	#9,R1,R1		;FORM BYTE COUNT TO TRANSFER
                          51         0345       
            55            5D     D0  0346 16550 	MOVL	FP,R5			;I/O PACKET ADDRESS
            5D         3C A5     D0  0349 16560 	MOVL	FP_SAV(R5),FP		;RESTORE SAVED REGISTER
            54       0000'CF     D0  034D 17100 	MOVL	W^SCH$GL_CURPCB,R4	;MUST HAVE PROCESS PCB NOW
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  18
X0425           PAGE NOT RESIDENT, QUEUE A READ REQUEST                                                                          (7)

                                     0352 17110 ;
                                     0352 17120 ; R0 = VBN
                                     0352 17130 ; R1 = NUMBER OF BYTES TO READ
                                     0352 17140 ; R2 = WINDOW ADDRESS
                                     0352 17150 ; R3 = SVAPTE (MASTER IF GLOBAL, SLAVE IF GLOBAL CRF)
                                     0352 17160 ; R4 = PROCESS PCB ADDRESS
                                     0352 17170 ; R5 = I/O REQUEST PACKET ADDRESS
                                     0352 17180 ;
                                     0352 17300 ; IRP$L_AST(R5)
                                     0352 17400 ;    = MASTER PTE CONTENTS IF GLOBAL CRF (>0)
                                     0352 17500 ;    = SLAVE PTE ADDRESS IF GLOBAL NOT CRF (<0)
                                     0352 17600 ;    = 0 IF NOT GLOBAL
                                     0352 17700 ; IRP$L_ASTPRM(R5)
                                     0352 17800 ;    = BACKING STORE ADDRESS IF CRF PAGE (GBLBAK SET IF GBL CRF)
                                     0352 17900 ;    = 0 IF NOT CRF PAGE
                                     0352 17950 ; IRP$B_PRI(R5) = DESIRED TRANSFER PRIORITY
                                     0352 18000 ;
                          FCAB'  30  0352 18100 	BSBW	EXE$BUILDPKTR		;BUILD AND QUEUE THE I/O PACKET
                                     0355 18700 ;
                                     0355 18800 ; THE FOLLOWING WAITS THE PROCESS AT THE FAULTING MODE
                                     0355 18900 ;
                                     0355 19000 PROCPAG:
            50       0000'CF     7E  0355 19050 	MOVAQ	W^SCH$GQ_PFWQ,R0	;PAGE FAULT WAIT QUEUE ADDRESS
                          44     10  035A 19100 	BSBB	MMG$PGFLTWAIT_1		;PUT PROCESS ON PAGE FAULT WAIT QUEUE
                                     035C 19200 PGFEXIT:
                          3F     BA  035C 19300 	POPR	#^M<R0,R1,R2,R3,R4,R5>	;RESTORE REGISTERS SAVED BY PAGE FAULT
            5E            08     C0  035E 19400 	ADDL	#8,SP			;CLEAN OFF THE EXCEPTION PARAMETERS
                                     0361 19500 ;
                                     0361 19600 ; STACK NOW CONTAINS JUST THE FAULT PC, PSL PAIR
                                     0361 19700 ;
                                     0361 19800 MMG$SVPCTX::
                                 07  0361 19900 	SVPCTX				;SAVE PROCESS CONTEXT
                          FC9B'  31  0362 20000 	BRW	SCH$SCHED		;AND GO RESCHEDULE
                                     0365 20100 ;
                                     0365 20200 ; NO FREE PAGES AVAILABLE ON THE FREE PAGE LIST, MUST WAIT
                                     0365 20300 ;
                                     0365 20400 FREEPAGEWAIT:
            50       0000'CF     7E  0365 20500 	MOVAQ	W^SCH$GQ_FPGWQ,R0	;WAIT ON FREE PAGE WAIT QUEUE
                          1A     11  036A 20600 	BRB	FREEPAGEWAIT1
                                     036C 20800 ;
                                     036C 20900 ; WAIT FOR RESOURCE IN R1 TO BECOME AVAILABLE
                                     036C 21000 ;
                                     036C 21100 RESOURCEWAIT:
                          1C     10  036C 21200 	BSBB	MMG$RESRCWAIT		;SET UP TO WAIT FOR THE RESOURCES
                          EC     11  036E 21300 	BRB	PGFEXIT			;AND EXIT TO THE SCHEDULER
                                     0370 21400 ;
                                     0370 21500 ; FAULT FOR PAGE WHICH IS ALREADY ON THE WAY INTO MEMORY
                                     0370 21600 ;
                                     0370 21700 READINPROG:
                          0C     BA  0370 21800 	POPR	#^M<R2,R3>		;R2=VA (LOW BITS = PAGTYP), R3=SVAPTE
                                     0372 21900 	ASSUME	PFN$C_PROCESS EQ 0
       0000'DF40          07     93  0372 22000 	BITB	#PFN$M_PAGTYP,@W^PFN$AB_TYPE[R0] ;PROCESS PAGE?
                          DB     13  0378 22100 	BEQL	PROCPAG			;BRANCH IF YES
       0000'DF40          04     E2  037A 22200 	BBSS	#PFN$V_COLLISION,@W^PFN$AB_TYPE[R0],10$ ;COLLISION OCCURRED
                          00         0380       
                                     0381 22300 10$:
            50       0000'CF     7E  0381 22400 	MOVAQ	W^SCH$GQ_COLPGWQ,R0	;COLLISION PAGE WAIT QUEUE
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  19
X0425           PAGE NOT RESIDENT, QUEUE A READ REQUEST                                                                          (7)

                                     0386 22450 FREEPAGEWAIT1:
                          18     10  0386 22500 	BSBB	MMG$PGFLTWAIT_1		;PLACE PROCESS ON THE COLLISION QUEUE
                          D2     11  0388 22600 	BRB	PGFEXIT			;EXIT TO THE SCEDULER
                                     038A 22700 ;
                                     038A 22800 ; WAIT FOR RESOURCE IN R1 TO BECOME AVAILABLE
                                     038A 22900 ; R0,R1,R2,R3 ALTERED, R4 RETURNED WITH CURRENT PCB ADDRESS
                                     038A 23000 ;
                                     038A 23100 	.ENABL	LSB
                                     038A 23200 MMG$RESRCWAIT::
            54       0000'CF     D0  038A 23300 	MOVL	W^SCH$GL_CURPCB,R4	;R4 = CURRENT PCB ADDRESS
         4C A4            51     D0  038F 23400 	MOVL	R1,PCB$L_EFWM(R4) 	;SET RESOURCE NEEDED
       0000'CF            51     E6  0393 23500 	BBSSI	R1,W^SCH$GL_RESMASK,10$ ;NOTE SOMEONE WAITING
                          00         0398       
                                     0399 23600 10$:
            50       0000'CF     7E  0399 23700 	MOVAQ	W^SCH$GQ_MWAIT,R0	;WAIT ON MISCELLANEOUS QUEUE
                          05     11  039E 23800 	BRB	20$			;GO WAIT THIS PROCESS
                                     03A0 24100 MMG$PGFLTWAIT_1:
            54       0000'CF     D0  03A0 24200 	MOVL	W^SCH$GL_CURPCB,R4	;MUST WAIT THE PROCESS PCB
                                     03A5 24250 MMG$PGFLTWAIT::
                                     03A5 24300 20$:
                       08 A0     B6  03A5 24400 	INCW	WQH$W_WQCNT(R0)		;COUNT THIS PROCESS WAITING
            60            64     0E  03A8 24500 	INSQUE	(R4),(R0)		;QUEUE THIS PCB
         30 A4         0A A0     B0  03AB 24600 	MOVW	WQH$W_WQSTATE(R0),PCB$W_STATE(R4) ;SET WAIT STATE IN PCB
         2C A4       0002'CF     D0  03B0 24700 	MOVL	W^EXE$GQ_SYSTIME+2,PCB$L_WTIME(R4) ;SAVE TIME AT START OF WAIT
         28 A4            11     E5  03B6 24800 	BBCC	#PCB$V_ASTPEN,PCB$L_STS(R4),30$ ;RESET AST PENDING, BRANCH IF WAS CLEAR
                          06         03BA       
                                     03BB 24900 ;
                                     03BB 25000 ; MUST REPORT THE EVENT FOR THE AST BEFORE WAITING THE PROCESS
                                     03BB 25100 ;
                          52     D4  03BB 25200 	CLRL	R2			;NULL PRIORITY INCREMENT CLASS
                                     03BD 25300 	RPTEVT	AST			;REPORT THE EVENT
                          FC40'  30  03BD       		BSBW	SCH$RSE
                                 00' 03C0       		.BYTE	EVT$_AST
                                 05  03C1 25400 30$:	RSB
                                     03C2 25500 
                                     03C2 25600 	.DSABL	LSB
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  20
X0425           FORM A CLUSTER OF PAGES TO READ                                                                                  (8)

                                     03C2   100 	.SBTTL	FORM A CLUSTER OF PAGES TO READ
                                     03C2   200 ;
                                     03C2   300 ; R0 = VBN IN FILE OF FIRST PAGE TO READ
                                     03C2   400 ; R1 = DESIRED CLUSTER SIZE
                                     03C2   500 ; R2 = WINDOW CONTROL BLOCK ADDRESS
                                     03C2   600 ; R4 = PCB ADDRESS, PROCESS IF PROCESS OR GLOBAL PAGE, SYSTEM IF SYSTEM PAGE
                                     03C2   700 ; R5 = PHD ADDRESS, PROCESS IF PROCESS OR GLOBAL PAGE, SYSTEM IF SYSTEM PAGE
                                     03C2   800 ; FP = I/O REQUEST PACKET ADDRESS
                                     03C2   900 ; 0(SP) = VIRTUAL ADDRESS (LOW BITS = PAGTYP)
                                     03C2  1000 ; 4(SP) = SVAPTE FROM PFN$AL_PTE
                                     03C2  1100 ;
                                     03C2  1120 
                                     03C2  1140 	.ENABL	LSB
                                     03C2  1160 
                                     03C2  1200 TRY_TO_CLUSTER:
         0C AD            8E     D0  03C2  1300 	MOVL	(SP)+,VA(FP)		;SAVE VIRTUAL ADDRESS
         34 AD            50     D0  03C6  1400 	MOVL	R0,VBN(FP)		;SET VIRTUAL BLOCK NUMBER
                                     03CA  1500 
                                     03CA  1600 	ASSUME	COUNT EQ CLUSTER+1
            51       0100 8F     A9  03CA  1700 	BISW3	#^X0100,R1,CLUSTER(FP)	;SET COUNT AND CLUSTER
                       20 AD         03CF       
         38 AD            52     D0  03D1  1800 	MOVL	R2,WINDOW(FP)		;WINDOW ADDRESS
                                     03D5  1810 ;
                                     03D5  1820 ; PUT PTEDAT INTO FORM OF TYP1 ! TYP0 ! PGFLVB
                                     03D5  1830 ;
                                     03D5  1840 	ASSUME	PFN$V_PGFLX GE 24
                                     03D5  1850 	ASSUME	PTE$V_TYP1 GE 24
         03 AD            04     90  03D5  1860 	MOVB	#PTE$M_TYP1@-24,PTEDAT+3(FP) ;TURN TYP1 BACK ON, CLEAR PAGE FILE INDEX
            53         10 AD     D0  03D9  1900 	MOVL	AST(FP),R3		;PROCESS PTE ADR IF GBL NOT CRF
                          18     13  03DD  2000 	BEQL	30$			;BRANCH IF NOT GLOBAL PAGE
                          0C     19  03DF  2100 	BLSS	10$			;BRANCH IF GBL NOT CRF
                                     03E1  2200 ;
                                     03E1  2300 ; GLOBAL COPY ON REFERENCE PAGE
                                     03E1  2400 ;
            53            6E     D0  03E1  2500 	MOVL	(SP),R3			;PROCESS PTE ADR WHEN GBL CRF
            52         14 AD     D0  03E4  2600 	MOVL	ASTPRM(FP),R2		;GPTX PTE CONTENTS FOR THIS CASE
                          06     11  03E8  2700 	BRB	20$
                                     03EA  2710 
                                     03EA  2720 CLU_END1:
                          00EB   31  03EA  2730 	BRW	CLU_END
                                     03ED  2740 
                                     03ED  2800 ;
                                     03ED  2900 ; GLOBAL PAGE NOT COPY ON REFERENCE
                                     03ED  3000 ;
            52            63     D0  03ED  3100 10$:	MOVL	(R3),R2			;GPTX FROM PROCESS PTE
            52   FB800000 8F     CA  03F0  3200 20$:	BICL	#^C<PTE$M_TYP1 ! PTE$M_TYP0 !- ;ISOLATE PAGE TYPE
                                     03F7  3300 		PTE$M_GPTX>,R2		;AND GPTX BITS
                                     03F7  3400 
                                     03F7  3500 	ASSUME	GPTX_PTE EQ GPTX+4
         18 AD            52     7D  03F7  3600 30$:	MOVQ	R2,GPTX(FP)		;SET GPTX AND GPTX_PTE
         28 AD            01     D0  03FB  3700 	MOVL	#1,INC1(FP)		;INIT TO SCAN FORWARDS
                                     03FF  3710 
                                     03FF  3720 	.DSABL	LSB
                                     03FF  3730 
                                     03FF  3800 CLU_INI_INC:
         28 AD            02     78  03FF  3900 	ASHL	#2,INC1(FP),INC4(FP)	;+ OR - 4
                       2C AD         0403       
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  21
X0425           FORM A CLUSTER OF PAGES TO READ                                                                                  (8)

         28 AD            09     78  0405  4000 	ASHL	#9,INC1(FP),INC512(FP)	;+ OR - 512
                       30 AD         0409       
                                     040B  4100 CLU_NXT:
         04 AD         2C AD     C1  040B  4200 	ADDL3	INC4(FP),SVAPTE(FP),R3	;NEXT PTE TO CHECK
                          53         0410       
         04 AD            53     D0  0411  4300 	MOVL	R3,SVAPTE(FP)		;UPDATE CONTEXT
            6D            16     E0  0415  4400 	BBS	#PTE$V_TYP0,PTEDAT(FP),20$ ;BRANCH IF SECTION ADDRESS
                          04         0418       
            6D         28 AD     C0  0419  4500 	ADDL	INC1(FP),PTEDAT(FP)	;INCREMENT PAGE FILE ADDRESS
            15            09     EF  041D  4600 20$:	EXTZV	#VA$V_VPN,#VA$S_VPN,R3,R1 ;CHECK THAT PTE IS RESIDENT
            51            53         0420       
                     0000'DF41   D5  0422  4700 	TSTL	@W^MMG$GL_SPTBASE[R1]	;BY MAKING SURE ITS SPTE IS VALID
                          C1     18  0427  4800 	BGEQ	CLU_END1		;BRANCH IF IT ISN'T
            63   7B800000 8F     CB  0429  4900 	BICL3	#^C<PTE$M_VALID !-	;GET VALID BIT
                          50         0430       
                                     0431  5000 		PTE$M_TYP1 ! PTE$M_TYP0 ! -;PAGE TYPE BITS
                                     0431  5100 		PTE$M_PGFLVB>,(R3),R0	;AND PAGE FILE/GPTX BITS FROM PTE
            6D            50     D1  0431  5200 	CMPL	R0,PTEDAT(FP)		;MUST AGREE IF THIS PAGE IS IN THE CLUSTER
                          B4     12  0434  5300 	BNEQ	CLU_END1		;BRANCH IF AT END OF CLUSTER
                       1C AD     D5  0436  5400 	TSTL	GPTX_PTE(FP)		;WAS THAT THE MASTER PTE FOR A GLOBAL?
                          29     13  0439  5500 	BEQL	60$			;BRANCH IF NO, IT WAS PROCESS PTE
                                     043B  5600 ;
                                     043B  5700 ; MUST TEST THAT PROCESS PTE POINTS AT THE GPTX
                                     043B  5800 ;
         1C AD         2C AD     C1  043B  5900 	ADDL3	INC4(FP),GPTX_PTE(FP),R3 ;NEXT PROCESS PTE ADR
                          53         0440       
            15            09     EF  0441  6200 	EXTZV	#VA$V_VPN,#VA$S_VPN,R3,R1 ;CHECK THAT THIS PTE IS ACCESSIBLE
            51            53         0444       
                     0000'DF41   D5  0446  6300 	TSTL	@W^MMG$GL_SPTBASE[R1]	;BY MAKING SURE ITS SPTE IS VALID
                          9D     18  044B  6400 	BGEQ	CLU_END1		;BRANCH IF IT ISN'T
            63   7B800000 8F     CB  044D  6500 	BICL3	#^C<PTE$M_VALID ! -	;GET VALID BIT
                          50         0454       
                                     0455  6600 		PTE$M_TYP1 ! PTE$M_TYP0 ! -;PAGE TYPE BITS
                                     0455  6700 		PTE$M_PGFLVB>,(R3),R0	;AND PGFLVB/GPTX FROM PTE
         18 AD         28 AD     C1  0455  6750 	ADDL3	INC1(FP),GPTX(FP),R2	;NEXT GLOBAL PAGE TABLE INDEX
                          52         045A       
            52            50     D1  045B  6800 	CMPL	R0,R2			;IN THE CLUSTER?
                          8A     12  045E  6900 	BNEQ	CLU_END1		;BRANCH IF NOT
                                     0460  6910 
                                     0460  6920 	ASSUME	GPTX_PTE EQ GPTX+4
         18 AD            52     7D  0460  6940 	MOVQ	R2,GPTX(FP)		;UPDATE GPTX
                                     0464  7000 ;
                                     0464  7050 ; R1 = SPT INDEX FOR PAGE TABLE PAGE
                                     0464  7100 ; R3 = PROCESS PTE ADDRESS
                                     0464  7200 ;
                          0A     BB  0464  7300 60$:	PUSHR	#^M<R1,R3>		;SAVE PROCESS PTE ADR, SPT INDEX
                          0356   30  0466  7400 	BSBW	MMG$FREWSLE		;GET A FREE WORKING SET LIST ENTRY
            52            8E     7D  0469  7500 	MOVQ	(SP)+,R2		;RESTORE PROCESS PTE ADR, SPT INDEX
            67            50     E9  046C  7600 	BLBC	R0,CLU_END_RESRC1	;IF CANNOT GET ONE, END THE CLUSTER
                                     046F  7610 ;
                                     046F  7620 ; MUST CHECK THE SPT ENTRY FOR PROCESS PAGE TABLE IS STILL VALID
                                     046F  7630 ; FREWSLE MIGHT HAVE DISCARDED IT FROM THE WORKING SET.
                                     046F  7640 ;
                     0000'DF42   D5  046F  7650 	TSTL	@W^MMG$GL_SPTBASE[R2]	;IS SPT ENTRY FOR PT STILL VALID
                          7C     18  0474  7660 	BGEQ	CLU_END_RESRC		;BRANCH IF NOT
         0C AD         30 AD     C1  0476  7700 	ADDL3	INC512(FP),VA(FP),R2	;NEXT VIRTUAL ADDRESS
                          52         047B       
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  22
X0425           FORM A CLUSTER OF PAGES TO READ                                                                                  (8)

         0C AD            52     D0  047C  7800 	MOVL	R2,VA(FP)		;UPDATE THE CONTEXT
                          04EC   30  0480  7900 	BSBW	MMG$ININEWPFN		;ALLOC AND INIT A PFN
                          50     D5  0483  8000 	TSTL	R0			;IF NO PFN'S AVAILABLE
                          6B     19  0485  8100 	BLSS	CLU_END_RESRC		;THEN END THE CLUSTER
                       21 AD     96  0487  8200 	INCB	COUNT(FP)		;COUNT ANOTHER PAGE IN THE CLUSTER
            51         48 AD     D0  048A  8210 	MOVL	PHVREFCADR(FP),R1	;PROCESS HEADER REF CNT ADR
                                     048E  8220 					;IF THIS IS A PROCESS PAGE TABLE PAGE
                          02     13  048E  8230 	BEQL	70$			;BRANCH IF NOT A PROCESS PAGE TABLE PAGE
                          61     B6  0490  8240 	INCW	(R1)			;COUNT ANOTHER PROCESS HEADER REFERENCE
            53       0000'DF40   D0  0492  8300 70$:	MOVL	@W^PFN$AL_PTE[R0],R3	;PROCESS PTE ADR IF NOT GLOBAL OR IF GBL CRF
                                     0498  8400 					;GLOBAL PTE ADR IF GLOBAL NOT CRF
                     0000'DF40   B6  0498  8450 	INCW	@W^PFN$AW_REFCNT[R0]	;SECOND REFERENCE FOR I/O IN PROGRESS
            63   867FFFFF 8F     CB  049D  8500 	BICL3	#^C<PTE$M_PROT ! PTE$M_OWN>,(R3),R1 ;PROTECTION AND OWNER FIELDS
                          51         04A4       
            51            50     C9  04A5  8600 	BISL3	R0,R1,(R3)		;FORM TRANSITION PTE FORMAT
                          63         04A8       
            52         24 AD     D0  04A9  8700 	MOVL	BAK(FP),R2		;BACKING STORE FROM PREV PFN
            52            16     E0  04AD  8800 	BBS	#PTE$V_TYP0,R2,80$	;BRANCH IF SECTION ADDRESS
                          0E         04B0       
            52            09     78  04B1  8900 	ASHL	#32-PFN$S_BAK,R2,R1	;IF NOT A NULL PAGE FILE ADDRESS
                          51         04B4       
                          08     13  04B5  9000 	BEQL	80$
            52         28 AD     C0  04B7  9100 	ADDL	INC1(FP),R2		;THEN INCREMENT THE ADDRESS
         24 AD            52     D0  04BB  9200 	MOVL	R2,BAK(FP)		;AND UPDATE THE CONTEXT
       0000'DF40          52     D0  04BF  9300 80$:	MOVL	R2,@W^PFN$AL_BAK[R0]	;SET BACKING STORE ADR FOR THIS PFN
       0000'DF40       22 AD     88  04C5  9400 	BISB	STATE(FP),@W^PFN$AB_STATE[R0] ;USE STATE FROM PREV PFN
         20 AD         21 AD     91  04CC  9500 	CMPB	COUNT(FP),CLUSTER(FP)	;IS CLUSTER FULL?
                          1F     18  04D1  9550 	BGEQ	CLU_END_RESRC		;BRANCH IF YES, QUEUE THE READ
                          FF35   31  04D3  9600 	BRW	CLU_NXT			;NO, TRY FOR ANOTHER PAGE
                                     04D6  9610 CLU_END_RESRC1:
                          1A     11  04D6  9620 	BRB	CLU_END_RESRC
                                     04D8  9800 ;
                                     04D8  9900 ; END OF CLUSTER
                                     04D8 10000 ;
                                     04D8 10100 CLU_END:
            01         21 AD     91  04D8 10200 	CMPB	COUNT(FP),#1		;IF AT LEAST 2 PAGES IN CLUSTER
                          14     14  04DC 10300 	BGTR	CLU_END_RESRC		;THEN READ THE CLUSTER
         28 AD         28 AD     CE  04DE 10400 	MNEGL	INC1(FP),INC1(FP)	;OTHERWISE TRY TO SCAN BACKWARDS
                          0D     14  04E3 10500 	BGTR	CLU_END_RESRC		;UNLESS ALREADY TRIED THAT
         04 AD            04     C2  04E5 10510 	SUBL	#4,SVAPTE(FP)		;BACK TO STARTING SVAPTE
            6D            16     E0  04E9 10520 	BBS	#PTE$V_TYP0,PTEDAT(FP),20$ ;BRANCH IF SECTION PAGE
                          02         04EC       
                          6D     D7  04ED 10530 	DECL	PTEDAT(FP)		;BACK TO ORIG PAGE FILE VBN
                          FF0D   31  04EF 10600 20$:	BRW	CLU_INI_INC
                                     04F2 10700 ;
                                     04F2 10800 ; SET UP TO DO THE PAGE READ
                                     04F2 10900 ;
                                     04F2 11000 CLU_END_RESRC:
            53            8E     D0  04F2 11100 	MOVL	(SP)+,R3		;GET PTE ADR OF FIRST PFN IN CLUSTER
            50         34 AD     D0  04F5 11200 	MOVL	VBN(FP),R0		;AND ITS ASSOCIATED VBN IN THE FILE
            51         21 AD     9A  04F9 11300 	MOVZBL	COUNT(FP),R1		;NUMBER OF PAGES IN THE CLUSTER
                       28 AD     D5  04FD 11400 	TSTL	INC1(FP)		;IF CLUSTER WENT BACKWARDS
                          1E     14  0500 11500 	BGTR	20$
            01            51     C3  0502 11600 	SUBL3	R1,#1,R2		;-(COUNT-1)
                          52         0505       
            50            52     C0  0506 11700 	ADDL	R2,R0			;ADJUST FILE VBN
            53            6342   DE  0509 11800 	MOVAL	(R3)[R2],R3		;AND PTE ADR
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  23
X0425           FORM A CLUSTER OF PAGES TO READ                                                                                  (8)

            54         10 AD     D0  050D 11820 	MOVL	AST(FP),R4		;PROCESS PTE ADDRESS FOR GLOBAL PAGE?
                          0D     13  0511 11825 	BEQL	20$			;BRANCH IF NOT GLOBAL
                          06     19  0513 11830 	BLSS	10$			;BRANCH IF GLOBAL BUT NOT CRF
         14 AD            52     C0  0515 11835 	ADDL	R2,ASTPRM(FP)		;ADJUST GLOBAL BACKING STORE ADDRESS
                          05     11  0519 11840 	BRB	20$
         10 AD            6442   DE  051B 11860 10$:	MOVAL	(R4)[R2],AST(FP)	;ADJUST PROCESS PTE ADDRESS FOR GLOBAL PAGE
            52         38 AD     D0  0520 11900 20$:	MOVL	WINDOW(FP),R2		;GET WINDOW ADDRESS
                          FE12   31  0524 12000 	BRW	QUEUE_PAGE_READ		;GO QUEUE THE PAGE READ
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  24
X0425           DEMAND ZERO PAGE                                                                                                 (9)

                                     0527   100 	.SBTTL	DEMAND ZERO PAGE
                                     0527   200 ;
                                     0527   300 ; MUST WAIT FOR FREE PAGES TO BECOME AVAILABLE
                                     0527   400 ;
                                     0527   500 DZROFPGWAIT_5:
            5E            14     C0  0527   600 	ADDL	#<5*4>,SP		;CLEAN OFF 5 LONG WORDS
                          FE38   31  052A   700 	BRW	FREEPAGEWAIT		;AND GO WAIT FOR A FREE PAGE
                                     052D  1400 ;
                                     052D  1500 ; THIS IS A DEMAND ZERO FORMAT PAGE TABLE ENTRY, R0 = 0
                                     052D  1600 ;
                                     052D  1650 DZRO_PTE:
                          53     D4  052D  1700 	CLRL	R3			;NO GLOBAL MASTER PTE ADDRESS
                          51     D4  052F  1750 	CLRL	R1			;NO MASTER PTE CONTENTS
                                     0531  1800 ;
                                     0531  1900 ; R0 = BACKING STORE ADDRESS, TYP1 ! TYP0 ! PGFLVB
                                     0531  1950 ; R1 = MASTER PAGE TABLE ENTRY CONTENTS IF GLOBAL, 0 IF NOT
                                     0531  2000 ; R3 = GLOBAL PAGE TABLE ENTRY ADDRESS IF GLOBAL, 0 IF NOT
                                     0531  2100 ; 0(SP) = FAULT VA (LOW BITS = PAGTYP)
                                     0531  2200 ; 4(SP) = CORRESPONDING SVAPTE
                                     0531  2300 ;
                                     0531  2400 DZRO_GBL_SEC:
                          0B     BB  0531  2500 	PUSHR	#^M<R0,R1,R3>		;SAVE GBL PTE ADR, GBL PTE CONTENTS,
                                     0533  2550 					;AND BACKING STORE ADDRESS
            52         0C AE     7D  0533  2600 	MOVQ	12(SP),R2		;R2=VA, R3=SVAPTE
                          0435   30  0537  2700 	BSBW	MMG$ININEWPFN		;ALLOCATE AND INIT A PFN
                          50     D5  053A  2800 	TSTL	R0			;SEE IF A PFN WAS ALLOCATED
                          E9     19  053C  2900 	BLSS	DZROFPGWAIT_5		;BRANCH IF HAVE TO WAIT
       0000'DF40          07     88  053E  3000 	BISB	#PFN$C_ACTIVE,@W^PFN$AB_STATE[R0] ;MARK PAGE ACTIVE
            52         1C A5     D0  0544  3100 	MOVL	PHD$L_PAGFIL(R5),R2	;ASSUME NULL PAGE FILE BACKING STORE
            51            8E     D0  0548  3200 	MOVL	(SP)+,R1		;GET BACKING STORE ADDRESS
                          0C     13  054B  3300 	BEQL	20$			;BRANCH IF DEMAND ZERO FORMAT
            51            10     E0  054D  3400 	BBS	#PTE$V_CRF,R1,20$	;BRANCH IF DZRO, CRF SECTION
                          08         0550       
            51   FF820000 8F     CB  0551  3500 	BICL3	#<PTE$M_DZRO ! ^C<PFN$M_BAK>>,R1,R2 ;BACKING STORE ADR
                          52         0558       
                                     0559  3600 					;WITH DZRO SHUT OFF
       0000'DF40          52     D0  0559  3700 20$:	MOVL	R2,@W^PFN$AL_BAK[R0]	;STORE THE BACKING STORE ADDRESS
                                     055F  3800 ;
                                     055F  3810 ;  0(SP) = MASTER PTE CONTENTS IF GLOBAL, 0 IF NOT
                                     055F  3820 ;  4(SP) = MASTER PTE ADDRESS  IF GLOBAL, 0 IF NOT
                                     055F  3830 ;  8(SP) = VIRTUAL ADDRESS (LOW BITS = PAGE TYPE)
                                     055F  3840 ; 12(SP) = SYSTEM VIRTUAL ADDRESS OF PROCESS PAGE TABLE ENTRY
                                     055F  3850 ;
            52         08 AE     7D  055F  4300 	MOVQ	8(SP),R2		;R2=VA (LOW BITS = PAGTYP), R3=SVAPTE
                 867FFFFF 8F     CB  0563  4400 	BICL3	#^C<PTE$M_PROT ! PTE$M_OWN>, -
            7E            63         0569  4450 		(R3),-(SP)		;PROTECTION AND OWNER FROM PTE
            50   94000000 8F     C9  056B  4500 	BISL3	#<PTE$M_VALID ! PTE$C_KW ! -
                          63         0572       
                                     0573  4530 		PTE$M_MODIFY>,R0,(R3)	;MAKE PAGE KERNEL WRITE FOR ZEROING
            53            55     C3  0573  4600 	SUBL3	R5,R3,-(SP)		;SAVE BYTE INDEX TO PTE
                          7E         0576       
                                     0577  4650 	SETIPL	#IPL$_ASTDEL		;SWAPPABLE WHILE ZEROING THE PAGE
            12            02     DA  0577       		MTPR	#IPL$_ASTDEL,S^#PR$_IPL
                                     057A  4700 
                           00000002  057A  4800 	.IF	GT,CA$_MEASURE
                     0014'CF     D6  057A  4900 	INCL	W^PMS$GL_DZROFLTS	;COUNT DEMAND ZERO PAGE FAULTS
                                     057E  5000 	.ENDC
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  25
X0425           DEMAND ZERO PAGE                                                                                                 (9)

                                     057E  5100 
                                     057E  5110 ;
                                     057E  5120 ; ***** BE AWARE THAT THE FOLLOWING CLRB ASSUMES THAT BIT 8 IS NOT
                                     057E  5130 ; ***** IN USE FOR ANY OF THE PAGE TYPE FLAGS, ETC.
                                     057E  5140 ;
                          52     94  057E  5200 	CLRB	R2			;CLEAR OUT THE PAGE TYPE
            64            00     2C  0580  5300 	MOVC5	#0,(R4),#0,#^X200,(R2)	;ZERO THE PAGE, PCB ADDRESS TO R1
       0200 8F            00         0583       
                          62         0587       
            54            51     D0  0588  5400 	MOVL	R1,R4			;RECOVER PCB ADDRESS
                                     058B  5500 	SETIPL	#IPL$_SYNCH		;NOT SWAPPABLE WHILE COMPLETING THE FAULT
            12            07     DA  058B       		MTPR	#IPL$_SYNCH,S^#PR$_IPL
            8E         64 A4     C1  058E  5700 	ADDL3	PCB$L_PHD(R4),(SP)+,R3	;RE-BIAS BYTE INDEX TO PTE TO GET SVAPTE
                          53         0592       
            63   7BE00000 8F     CB  0593  5800 	BICL3	#^C<PTE$M_VALID ! PTE$M_MODIFY ! -
                          50         059A       
                                     059B  5900 		PTE$M_PFN>,(R3),R0	;EVEN PFN MIGHT HAVE CHANGED
            8E            50     C9  059B  6000 	BISL3	R0,(SP)+,(R3)		;SET PTE WITH CORRECT PROT AND OWNER
                          63         059E       
                                     059F  6100 	INVALID	8(SP),R2		;INVALIDATE TRANSLATION BUFFER
            52         08 AE     D0  059F       		MOVL	8(SP),R2
            3A            52     DA  05A3       		MTPR	R2,S^#PR$_TBIS
            51            6E     7D  05A6  6200 	MOVQ	(SP),R1			;SEE IF DZRO GLOBAL
                          3D     13  05A9  6300 	BEQL	60$			;BRANCH IF NOT, BOTH ARE ZERO
            62            51     D1  05AB  6400 	CMPL	R1,(R2)			;STILL THE SAME PTE CONTENT?
                          2D     13  05AE  6500 	BEQL	40$			;BRANCH IF YES, NO RACE TO ZERO THE PAGE
                                     05B0  6600 ;
                                     05B0  6610 ; MORE THAN ONE PROCESS STARTED TO ZERO THIS GLOBAL DEMAND ZERO PAGE
                                     05B0  6620 ; THIS PROCESS LOST THE RACE, CLEAN UP AND REFAULT.
                                     05B0  6630 ;
            15            00     EF  05B0  6700 	EXTZV	#PTE$V_PFN,#PTE$S_PFN,R0,R0 ;ISOLATE THE PFN
            50            50         05B3       
            6E            50     D0  05B5  6800 	MOVL	R0,(SP)			;AND SAVE IT
            55         64 A4     D0  05B8  6850 	MOVL	PCB$L_PHD(R4),R5	;GET PROCESS HEADER ADDRESS
                     0000'DF40   B6  05BC  6900 	INCW	@W^PFN$AW_REFCNT[R0]	;RELEASE WSLE AND SHRCNT, BUT NOT PFN
            51         10 A5     3C  05C1  7000 	MOVZWL	PHD$W_WSNEXT(R5),R1	;WORKING SET LIST INDEX
            52         08 AE     D0  05C5  7050 	MOVL	8(SP),R2		;VIRTUAL ADDRESS (LOW BITS = PAGTYP)
                          01AB   30  05C9  7100 	BSBW	MMG$FREWSLX		;FREE THE WORKING SET LIST ENTRY
            04            50     E8  05CC  7200 	BLBS	R0,30$			;BRANCH IF SUCCESSFUL
                                     05CF  7210 ;
                                     05CF  7220 ; FREWSLX COULD ONLY RETURN FAILURES STATUS IF PAGE FILE BACKING STORE
                                     05CF  7230 ; NEEDED TO BE RESERVED AND THERE WAS NONE AVAILABLE.  THIS PAGE ALREADY
                                     05CF  7240 ; HAS BACKING STORE, SO THIS CANNOT HAPPEN.
                                     05CF  7250 ;
                                     05CF  7260 	BUG_CHECK FREWSLX,FATAL
                               FEFF  05CF       		.WORD	^XFEFF
                               0004' 05D1       		.IIF IDN <FATAL>,<FATAL> , .WORD	BUG$_FREWSLX!4
                                     05D3  7280 
                          09     BA  05D3  7300 30$:	POPR	#^M<R0,R3>		;GET PFN AND MASTER PTE ADDRESS
                          FA28'  30  05D5  7400 	BSBW	MMG$RLPFNSAVPTE		;RELEASE PFN, SAVE PTE CONTENTS
            5E            08     C0  05D8  7500 	ADDL	#8,SP			;CLEAN OFF VA, PROCESS PTE
                          0E     11  05DB  7600 	BRB	PGFCOMPLETE
                                     05DD  7700 ;
                                     05DD  7800 ; GLOBAL DEMAND ZERO PAGE, MAKE MASTER PTE VALID TOO
                                     05DD  7900 ;
            51   867FFFFF 8F     CA  05DD  8000 40$:	BICL	#^C<PTE$M_PROT ! PTE$M_OWN>,R1 ;MASTER PTE PROTECTION AND OWNER
            51            50     C9  05E4  8100 	BISL3	R0,R1,(R2)		;SET MASTER PTE VALID
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  26
X0425           DEMAND ZERO PAGE                                                                                                 (9)

                          62         05E7       
            5E            10     C0  05E8  8200 60$:	ADDL	#4*4,SP			;CLEAN OFF 4 LONG WORDS
                                     05EB 15400 PGFCOMPLETE:
                          3F     BA  05EB 15500 	POPR	#^M<R0,R1,R2,R3,R4,R5>	;RESTORE THE REGISTERS
            5E            08     C0  05ED 15600 	ADDL	#8,SP			;CLEAN OFF THE EXCEPTION PARAMETERS
                                 02  05F0 15700 	REI				;AND RETURN FROM THE EXCEPTION
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  27
X0425           FREE, MODIFIED, OR BAD PAGE LIST, RELEASE PENDI                                                                 (10)

                                     05F1   100 	.SBTTL	FREE, MODIFIED, OR BAD PAGE LIST, RELEASE PENDING
                                     05F1  1800 ;
                                     05F1  1900 ; THIS IS A FAULT OFF THE FREE, MODIFIED, OR BAD PAGE LISTS
                                     05F1  2000 ; R0 = PFN, R2 = LISTID,
                                     05F1  2050 ; 0(SP) = VA (LOW BITS = PAGTYP), 4(SP) = SVAPTE
                                     05F1  2100 ;
                                     05F1  2200 	.ENABL	LSB
                                     05F1  2300 PFNLIST:
                          FA0C'  30  05F1  3000 	BSBW	MMG$REMPFN		;REMOVE PFN FROM LIST
                                     05F4  3050 WRITEINPROG:
                                     05F4  3100 RELEASEPEND:
            52            6E     7D  05F4  3200 	MOVQ	(SP),R2			;R2 = VA, R3 = SVAPTE
                          03B3   30  05F7  3300 	BSBW	MMG$MAKEWSLE		;MAKE A WORKING SET LIST ENTRY
            52            8E     7D  05FA  3350 	MOVQ	(SP)+,R2		;R2=VA, R3=SVAPTE
                                     05FD  3400 ;
                                     05FD  3500 ; SET PAGE ACTIVE AND VALID
                                     05FD  3600 ;
            51       0000'DF40   D0  05FD  3700 	MOVL	@W^PFN$AL_PTE[R0],R1	;GET MASTER PTE ADDRESS
                                     0603  3720 
                                     0603  3740 	ASSUME	PFN$V_DELCON EQ PFN$V_LOC+PFN$S_LOC+1 ;DELCON IS 2ND BIT TO LEFT OF LOC
                                     0603  3760 					;BIT IN BETWEEN IS FOR LOC EXPANSION
            00            07     F0  0603  3800 	INSV	#PFN$C_ACTIVE,#PFN$V_LOC,#PFN$S_LOC+2,- ;SET PAGE ACTIVE
                                     0606       
       0000'DF40          05         0606  3850 		@W^PFN$AB_STATE[R0]	;AND CLEAR DELCON
            61            1F     E2  060B  3900 	BBSS	#PTE$V_VALID,(R1),50$	;SET VALID BIT
                          00         060E       
            04            52     91  060F  5000 50$:	CMPB	R2,#WSL$C_GLOBAL	;GLOBAL OR PAGE TABLE PAGE?
                          06     18  0612  5100 	BGEQ	100$			;BRANCH IF YES
                          3F     BA  0614  6100 60$:	POPR	#^M<R0,R1,R2,R3,R4,R5>	;RESTORE SAVED REGISTERS
            5E            08     C0  0616  6200 	ADDL	#8,SP			;CLEAN OFF THE EXCEPTION PARAMETERS
                                 02  0619  6300 	REI				;AND RETURN FROM FAULT
                                     061A  6355 ;
                                     061A  6360 ; GLOBAL PAGE OR PAGE TABLE PAGE
                                     061A  6365 ;
            08            52     91  061A  6370 100$:	CMPB	R2,#WSL$C_PPGTBL	;PROCESS PAGE TABLE PAGE?
                          16     18  061D  6380 	BGEQ	120$			;BRANCH IF PROCESS OR GLOBAL PAGE TABLE
                                     061F  6390 ;
                                     061F  6400 ; GLOBAL PAGE
                                     061F  6410 ;
            61   7BE00000 8F     CB  061F  6420 	BICL3	#^C<PTE$M_VALID ! PTE$M_MODIFY ! PTE$M_PFN>,(R1),R1 ;MASTER PTE
                          51         0626       
                                     0627  6430 ;
                                     0627  6440 ; R1 = VALID AND PFN BITS TO STORE INTO SLAVE PTE
                                     0627  6450 ; R3 = SLAVE PTE ADDRESS
                                     0627  6460 ;
                                     0627  6470 SETSLAVEPTE:
            63   867FFFFF 8F     CB  0627  6480 	BICL3	#^C<PTE$M_PROT ! PTE$M_OWN>,(R3),R2 ;PROTECTION AND OWNER FROM SLAVE PTE
                          52         062E       
            52            51     C9  062F  6490 	BISL3	R1,R2,(R3)		;STORE THE NEW SLAVE PTE
                          63         0632       
                          DF     11  0633  6500 	BRB	60$			;AND EXIT THROUGH COMMON CODE
                                     0635  6510 ;
                                     0635  6520 ; PROCESS OR GLOBAL PAGE TABLE
                                     0635  6530 ;
                          DD     14  0635  6540 120$:	BGTR	60$			;BRANCH IF GLOBAL PAGE TABLE
                          51     DD  0637  6550 	PUSHL	R1			;SAVE REGISTER AROUND THE CALL
                          0480   30  0639  6560 	BSBW	MMG$DECPHDREF		;ONE LESS LOCK ON HDR SPTE
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  28
X0425           FREE, MODIFIED, OR BAD PAGE LIST, RELEASE PENDI                                                                 (10)

                          02     BA  063C  6570 	POPR	#^M<R1>			;RESTOR REGISTER
                          D4     11  063E  6580 	BRB	60$			;AND EXIT THROUGH COMMON CODE
                                     0640  6590 
                                     0640  6680 	.DSABL	LSB
                                     0640  6690 ;
                                     0640  6700 ; FAILED TO READ THE DESIRED PAGE, RELEASE THE PFN AND ISSUE AN EXCEPTION
                                     0640  6800 ; R0    = PAGE FRAME NUMBER
                                     0640  6810 ; R4    = PROCESS CONTROL BLOCK ADDRESS
                                     0640  6820 ; R5    = SYSTEM ADDRESS OF PROCESS HEADER
                                     0640  6830 ; 0(SP) = VIRTUAL ADDRESS (LOW BITS = PAGE TYPE)
                                     0640  6840 ; 4(SP) = SYSTEM VIRTUAL ADDRESS OF PAGE TABLE ENTRY
                                     0640  6900 ;
                                     0640  7000 READERR:
                          0C     BA  0640  7050 	POPR	#^M<R2,R3>		;R2=VA (LOW BITS = PAGTYP), R3=SVAPTE
            51       0000'DF40   3C  0642  7060 	MOVZWL	@W^PFN$AW_WSLX[R0],R1	;GET WORKING SET LIST INDEX IF NOT GLOBAL
                                     0648  7070 
                                     0648  7080 	ASSUME	PFN$C_PROCESS EQ 0
                                     0648  7090 	ASSUME	PFN$C_SYSTEM  EQ 1
                                     0648  7100 	ASSUME	PFN$C_GLOBAL  EQ 2
                                     0648  7110 	ASSUME	PFN$C_GBLWRT  EQ 3
                                     0648  7120 	ASSUME	PFN$C_PPGTBL  EQ 4
                                     0648  7130 	ASSUME	PFN$C_GPGTBL  EQ 5
            03            01     EC  0648  7140 	CMPV	#WSL$V_PAGTYP,#WSL$S_PAGTYP,R2,#PFN$C_GLOBAL ;IS PAGE GLOBAL?
            02            52         064B       
                          18     19  064D  7150 	BLSS	20$			;BRANCH IF NOT
                                     064F  7160 ;
                                     064F  7170 ; GLOBAL PAGE DOES NOT HAVE WORKING SET LIST INDEX IN WSLX ARRAY
                                     064F  7180 ; MUST SCAN THE PROCESS' WORKING SET LIST FOR THE VIRTUAL ADDRESS
                                     064F  7190 ;
            53            55     C2  064F  7200 	SUBL	R5,R3			;UNBIAS SVAPTE, COULD BE SWAPPED HERE
            55   00000000'9F     D0  0652  7210 	MOVL	@#CTL$GL_PHD,R5		;USE P1 SPACE HEADER WINDOW
                          F9A4'  30  0659  7230 	BSBW	MMG$SCNWSLX		;SCAN FOR THE WORKING SET LIST INDEX
                                     065C  7240 ;
                                     065C  7250 ; COULD HAVE BEEN SWAPPED IN THE ABOVE ROUTINE, BUT IPL IS BACK AT SYNCH NOW
                                     065C  7260 ;
            55         64 A4     D0  065C  7270 	MOVL	PCB$L_PHD(R4),R5	;RECOVER SYSTEM ADDRESS OF PHD
            53            55     C0  0660  7280 	ADDL	R5,R3			;REBIAS PTE ADDRESS
                          51     D5  0663  7290 	TSTL	R1			;SEE IF FOUND WORKING SET LIST ENTRY
                          3C     13  0665  7300 	BEQL	40$			;IF NOT, PAGE WENT AWAY OR SOME OTHER
                                     0667  7310 					;PROCESS WAS THE ORIGINATOR OF THE I/O
            52            6541   D0  0667  7320 20$:	MOVL	(R5)[R1],R2		;FETCH WORKING SET LIST ENTRY
                          0C     BB  066B  7325 	PUSHR	#^M<R2,R3>		;SAVE VIRTUAL ADDRESS AND PTE ADDRESS
                          0107   30  066D  7330 	BSBW	MMG$FREWSLX		;FREE THIS WORKING SET LIST ENTRY
                          0C     BA  0670  7335 	POPR	#^M<R2,R3>		;RECOVER VA AND SVAPTE
            04            50     E8  0672  7340 	BLBS	R0,30$			;BRANCH IF SUCCESSFUL
                                     0675  7350 ;
                                     0675  7360 ; FREWSLX CAN ONLY FAIL IF PAGE FILE NEEDED TO BE ALLOCATED AND IT COULDN'T BE
                                     0675  7370 ; THIS CASE IS NOT POSSIBLE HERE.
                                     0675  7380 ;
                                     0675  7390 	BUG_CHECK FREWSLX,FATAL
                               FEFF  0675       		.WORD	^XFEFF
                               0004' 0677       		.IIF IDN <FATAL>,<FATAL> , .WORD	BUG$_FREWSLX!4
                                     0679  7400 ;
                                     0679  7410 ; IF THIS PAGE FAULT IS FROM USER OR SUPER MODE THEN ISSUE A
                                     0679  7420 ; PAGE READ ERROR EXCEPTION.
                                     0679  7430 ;
                          18     ED  0679  7440 30$:	CMPZV	#PSL$V_CURMOD,#PSL$S_CURMOD,- ;IF FAULTING MODE IS
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  29
X0425           FREE, MODIFIED, OR BAD PAGE LIST, RELEASE PENDI                                                                 (10)

         24 AE            02         067B  7450 		FLTPSL(SP),#PSL$C_SUPER	;USER OR SUPER
                          02         067E       
                          22     18  067F  7460 	BGEQ	40$			;THEN PAGE READ ERROR EXCEPTION
                                     0681  7470 ;
                                     0681  7480 ; THIS IS A BAD SITUATION NOW, AN EXCEPTION IN EXEC OR KERNEL MODE WILL
                                     0681  7490 ; CRASH THE SYSTEM.  IF THIS PAGE IS OWNED BY USER OR SUPER THEN TRY
                                     0681  7500 ; SUBSTITUTING A PAGE OF ZEROS.  THIS SHOULD SATISFY THE SYSTEM CODE WHICH
                                     0681  7510 ; IS ACCESSING THE PROCESS PAGE SINCE IT IS PARANOID ABOUT USER SUPPLIED
                                     0681  7520 ; DATA.  THE NEW PAGE WILL BE EXEC READ WRITE BUT OWNED BY THE ORIGINAL
                                     0681  7530 ; OWNER.  THIS WILL RESULT IN AN ACCESS VIOLATION WHEN THE PAGE IS TOUCHED
                                     0681  7540 ; IN USER OR SUPER MODE.
                                     0681  7550 ;
            02            17     EF  0681  7560 	EXTZV	#PTE$V_OWN,#PTE$S_OWN,(R3),R0 ;GET THE PAGE OWNER
            50            63         0684       
            02            50     D1  0686  7570 	CMPL	R0,#PSL$C_SUPER		;OWNED BY USER OR SUPER?
                          18     19  0689  7580 	BLSS	40$			;BRANCH IF NOT, READ ERROR FOR
                                     068B  7590 					;A CRUCIAL PAGE, ISSUE THE PAGE
                                     068B  7600 					;READ ERROR EXCEPTION, DOWN WE GO.
                                     068B  7610 	SETIPL	#IPL$_ASTDEL		;LOWEST POSSIBLE FAULT IPL
            12            02     DA  068B       		MTPR	#IPL$_ASTDEL,S^#PR$_IPL
                                     068E  7620 ;
                                     068E  7630 ; FORM ARGUMENT LIST FOR CRETVA
                                     068E  7640 ;
                          52     DD  068E  7650 	PUSHL	R2			;VIRTUAL ADDRESS TO CREATE
                          05     BB  0690  7660 	PUSHR	#^M<R0,R2>		;ANOTHER COPY OF ADR TO FORM RANGE
                                     0692  7670 					;ACCESS MODE PARAMETER
         01 AE            00'    90  0692  7680 	MOVB	S^#PRT$C_EW,1(SP)	;SET DESIRED PAGE PROTECTION
                          00     DD  0696  7690 	PUSHL	#0			;NULL RETURN ADDRESS
                       08 AE     DF  0698  7700 	PUSHAL	8(SP)			;ADDRESS OF RANGE TO CREATE
       0000'CF            05     FB  069B  7710 	CALLS	#5,W^MMG$CRETVA		;KERNEL MODE ENTRY TO CRETVA
                                     06A0  7720 					;PRESERVES IPL
                                     06A0  7730 					;STRIP OFF INPUT RANGE WHEN DONE
                          FF48   31  06A0  7740 	BRW	PGFCOMPLETE		;FAULT THIS PAGE FROM SCRATCH
                       1A AE     B6  06A3  7820 40$:	INCW	FLTCTL+2(SP)		;INDICATE PAGE READ ERROR
                                     06A6  7840 ACVIOLAT:
            50         26 AE     3C  06A6  7900 	MOVZWL	FLTPSL+2(SP),R0		;GET IPL FROM FAULT PSL
                                     06AA  8000 	ENBINT	R0			;AND RESTORE IT
            12            50     DA  06AA       		MTPR	R0,S^#PR$_IPL
                          3F     BA  06AD  8100 	POPR	#^M<R0,R1,R2,R3,R4,R5>	;RESTORE REGISTERS SAVED BY PAGE FAULT
            6E            10     E5  06AF  8150 	BBCC	#16,(SP),10$		;BRANCH IF ACCESS VIOLATION
                          03         06B2       
                          F94A'  31  06B3  8200 	BRW	EXE$PAGRDERR		;ISSUE THE EXCEPTION
                          F947'  31  06B6  8300 10$:	BRW	EXE$ACVIOLAT		;ACCESS VIOATION
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  30
X0425           SCANDEADPT - SCAN A DEAD PAGE TABLE FOR TRANSIT                                                                 (11)

                                     06B9   100 	.SBTTL	SCANDEADPT - SCAN A DEAD PAGE TABLE FOR TRANSITION PAGES
                                     06B9   200 ;
                                     06B9   300 ; INPUTS:
                                     06B9   310 ;
                                     06B9   350 ;	R2 = VIRTUAL ADDRESS OF PAGE TABLE (LOW BITS = PAGE TYPE)
                                     06B9   500 ;	R5 = PROCESS HEADER ADDRESS
                                     06B9   600 ;	IPL = SYNCH
                                     06B9   700 ;
                                     06B9   800 ; OUTPUTS:
                                     06B9   900 ;
                                     06B9  1000 ;	NONE
                                     06B9  1100 ;
                                     06B9  1200 SCANDEADPT:
            52       00C8 C5     C3  06B9  1300 	SUBL3	PHD$L_P0BR(R5),R2,R0	;BYTE OFFSET FROM FIRST P0 PAGE TABLE
                          50         06BE       
                          50     19  06BF  1350 	BLSS	50$			;BRANCH IF PROCESS HEADER PAGE
            50         F7 8F     78  06C1  1400 	ASHL	#-9,R0,R0		;FORM PAGE NUMBER
                          50         06C5       
            55         68 A5     C1  06C6  1500 	ADDL3	PHD$L_PTWSLEVAL(R5),R5,R3 ;BASE ADR OF BYTE ARRAY OF COUNTS
                          53         06CA       
                                     06CB  1600 					;OF VALID WSLE'S IN EACH PAGE TABLE
                          6340   95  06CB  1700 	TSTB	(R3)[R0]		;IS THIS A DEAD PAGE TABLE
                          41     18  06CE  1800 	BGEQ	50$			;BRANCH IF NOT
                                     06D0  1810 
                           00000002  06D0  1820 	.IF	GT,CA$_MEASURE
                     0038'CF     D6  06D0  1830 	INCL	W^PMS$GL_DPTSCN		;COUNT THESE SCANS
                                     06D4  1840 	.ENDC
                                     06D4  1850 
            15            09     EF  06D4  1900 	EXTZV	#VA$V_VPN,#VA$S_VPN,R2,R0 ;PAGE NUMBER OF THE PT IN SYSTEM SPACE
            50            52         06D7       
                                 CB  06D9  2000 	BICL3	#^C<PTE$M_VALID ! PTE$M_PFN>,- ;GET PFN AND VALID BIT
       0000'DF40 7FE00000 8F         06DA  2100 		@W^MMG$GL_SPTBASE[R0],R0	;FROM SPT ENTRY FOR THE PAGE TABLE
                          50         06E3       
            50            1F     E5  06E4  2200 	BBCC	#PTE$V_VALID,R0,40$	;CLEAR VALID BRANCH IF IT WAS CLEAR
                          25         06E7       
            7E       0000'DF40   3C  06E8  2300 	MOVZWL	@W^PFN$AW_SHRCNT[R0],-(SP) ;NUMBER OF TRANSITION PAGES
                          1D     13  06EE  2400 	BEQL	40$			;IF NONE, INCONSISTENT
            52       01FF 8F     AA  06F0  2500 	BICW	#VA$M_BYTE,R2		;START SCANNING PT AT BEGINNING
            53         80 8F     9A  06F5  2600 	MOVZBL	#128,R3			;AT MOST 128 PTE'S
            82   7BA00000 8F     CB  06F9  2700 20$:	BICL3	#^C<PTE$M_VALID ! -	;GET THE VALID BIT
                          50         0700       
                                     0701  2800 		PTE$M_TYP1 ! PTE$M_TYP0 ! - ;PTE TYPE BITS
                                     0701  2900 		PTE$M_PFN>,(R2)+,R0	;AND THE PFN FROM THE PTE
                          07     13  0701  2950 	BEQL	30$			;BRANCH IF DEMAND ZERO PAGE
            50         EA 8F     78  0703  3000 	ASHL	#-PTE$V_TYP0,R0,R1	;VALID, TYP1, TYP0 ALL 0 IF TRANSITION
                          51         0707       
                          08     13  0708  3100 	BEQL	60$			;BRANCH IF TRANSITION PAGE
            EC            53     F5  070A  3200 30$:	SOBGTR	R3,20$			;LOOP THROUGH THE PAGE TABLE
                                     070D  3300 40$:	BUG_CHECK SCANDEADPT,FATAL	;SPT ENTRY FOR PAGE TABLE NOT VALID
                               FEFF  070D       		.WORD	^XFEFF
                               0004' 070F       		.IIF IDN <FATAL>,<FATAL> , .WORD	BUG$_SCANDEADPT!4
                                 05  0711  3350 50$:	RSB
                                     0712  3400 					;SHRCNT FOR PAGE TABLE IS 0
                                     0712  3500 					;DIDN'T FIND SHRCNT TRANSITION PAGES
                                     0712  3600 					;BEFORE RUNNING OFF THE END OF THE PT
                                     0712  3700 ;
                                     0712  3800 ; THIS IS A TRANSITION PAGE
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  31
X0425           SCANDEADPT - SCAN A DEAD PAGE TABLE FOR TRANSIT                                                                 (11)

                                     0712  3900 ;
                          0C     BB  0712  4000 60$:	PUSHR	#^M<R2,R3>		;SAVE THESE REGISTERS
                          00     EF  0714  4050 	EXTZV	#PFN$V_PAGTYP,#PFN$S_PAGTYP,- ;GET PAGE LOCATION
       0000'DF40          03         0716  4100 		@W^PFN$AB_STATE[R0],R2	;FROM THE STATE BYTE
                          52         071B       
            01            52     D1  071C  4200 	CMPL	R2,#PFN$C_MFYPAGLST	;ON MODIFIED OR FREE PAGE LIST
                          1E     14  071F  4300 	BGTR	90$			;BRANCH IF NOT ON EITHER
                          0E     13  0721  4400 	BEQL	80$			;BRANCH IF ON MODIFIED PAGE LIST
                                     0723  4420 ;
                                     0723  4440 ; PAGE IS ON THE FREE PAGE LIST
                                     0723  4460 ;
                          F8DA'  30  0723  4500 	BSBW	MMG$REMPFN		;ON FREE LIST, REMOVE IT
       0000'DF40          10     88  0726  4600 	BISB	#PFN$M_DELCON,@W^PFN$AB_STATE[R0] ;FORCE DELETE CONTENTS
                          F8D1'  30  072C  4700 	BSBW	MMG$RELPFN		;AND RELEASE THE PAGE
                          0E     11  072F  4800 	BRB	90$
                                     0731  4900 ;
                                     0731  5000 ; PAGE IS ON MODIFIED PAGE LIST
                                     0731  5100 ;
       0000'DF40          10     88  0731  5200 80$:	BISB	#PFN$M_DELCON,@W^PFN$AB_STATE[R0] ;DELETE CONTENTS AFTER WRITING
                     0000'CF     D4  0737  5250 	CLRL	W^SCH$GL_MFYLIM		;MAKE SURE IT'S WRITTEN SOON
                     0000'CF     D4  073B  5275 	CLRL	W^SCH$GL_MFYLOLIM	;
                          0C     BA  073F  5300 90$:	POPR	#^M<R2,R3>		;RESTORE SAVE REGISTERS
            C6            6E     F5  0741  5400 	SOBGTR	(SP),30$		;COUNT DOWN THE TRANSITION COUNT
                          01     BA  0744  5500 	POPR	#^M<R0>			;CLEAN OFF THE EXHAUSTED COUNT
                                 05  0746  5600 	RSB
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  32
X0425           WSLEPFN - FETCH PFN FROM WORKING SET LIST ENTRY                                                                 (12)

                                     0747   100 	.SBTTL	WSLEPFN - FETCH PFN FROM WORKING SET LIST ENTRY
                                     0747   200 ;
                                     0747   300 ; CALLING SEQUENCE:
                                     0747   400 ;
                                     0747   500 ;	BSBW	MMG$WSLEPFN
                                     0747   600 ;
                                     0747   700 ; INPUTS:
                                     0747   800 ;
                                     0747   900 ;	R3 = SYSTEM VIRTUAL ADDRESS OF PAGE TABLE ENTRY
                                     0747  1000 ;	     FOR A PAGE THAT IS IN THE WORKING SET LIST
                                     0747  1100 ;
                                     0747  1200 ; OUTPUTS:
                                     0747  1300 ;
                                     0747  1400 ;	R0 = PFN
                                     0747  1500 ;	R2,R3 PRESERVED
                                     0747  1600 ;
                                     0747  1700 WSLEPFNMSK:
                           7B800000  0747  1800 	.LONG	^C<PTE$M_VALID ! PTE$M_TYP0 ! PTE$M_TYP1 ! PTE$M_PGFLVB>
                                     074B  1900 
                                     074B  1920 	.ENABL	LSB
                                     074B  1940 
                                     074B  2000 MMG$WSLEPFN::
            63         F9 AF     CB  074B  2100 	BICL3	B^WSLEPFNMSK,(R3),R0	;GET VALID, TYP0, TYP1, PFN/GPTX
                          50         074F       
            50         EA 8F     78  0750  2200 	ASHL	#-PTE$V_TYP0,R0,R1	;SEE IF TRANSITION OR VALID PAGE
                          51         0754       
                          06     14  0755  2300 	BGTR	30$			;BRANCH IF NEITHER
            15            00     EF  0757  2400 10$:	EXTZV	#PTE$V_PFN,#PTE$S_PFN,R0,R0 ;GET PFN
            50            50         075A       
                                 05  075C  2500 20$:	RSB				;AND RETURN
                                     075D  2600 30$:
                                     075D  2700 ;
                                     075D  2800 ; INPUTS:
                                     075D  2900 ;
                                     075D  3000 ;	R0 = PAGE TABLE ENTRY WITH TYP0, TYP1 AND GPTX BITS
                                     075D  3100 ;	R1 = RESULT OF SHIFTING R0 BY -PTE$V_TYP0
                                     075D  3110 ;	   = 1 IF PAGE IS GLOBAL
                                     075D  3120 ;	   > 1 IF PAGE TYPE IS INVALID FOR THIS CONTEXT
                                     075D  3200 ;
                                     075D  3300 ; OUTPUTS:
                                     075D  3400 ;
                                     075D  3500 ;	R0 = PFN IF GLOBAL PAGE IN TRANSITION
                                     075D  3600 ;	BUGCHK IF NOT
                                     075D  3700 ;
                                     075D  3800 FRE_GBLTRANS1:
            13            51     F5  075D  3900 	SOBGTR	R1,WSLVANVAL		;BRANCH IF NOT GLOBAL FORMAT
            50            16     E5  0760  4000 	BBCC	#PTE$V_TYP0,R0,WSLVANVAL ;CLEAR TYP0, MUST HAVE BEEN SET
                          0F         0763       
       0000'DF40       E0 AF     CB  0764  4100 	BICL3	B^WSLEPFNMSK,@W^MMG$GL_GPTBASE[R0],R0 ;FETCH MASTER PTE
                          50         076B       
            50         EA 8F     78  076C  4200 	ASHL	#-PTE$V_TYP0,R0,R1	;MAKE SURE THIS IS IN TRANSITION
                          51         0770       
                          E9     13  0771  4300 	BEQL	20$			;BRANCH IF IT IS, R0 = PFN
                                     0773  4400 WSLVANVAL:
                                     0773  4500 	BUG_CHECK WSLVANVAL,FATAL	;WORKING SET LIST ENTRY VIRTUAL
                               FEFF  0773       		.WORD	^XFEFF
                               0004' 0775       		.IIF IDN <FATAL>,<FATAL> , .WORD	BUG$_WSLVANVAL!4
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  33
X0425           WSLEPFN - FETCH PFN FROM WORKING SET LIST ENTRY                                                                 (12)

                                     0777  4600 					;ADDRESS IS NOT VALID
                                     0777  4700 	.DSABL	LSB
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  34
X0425           FREWSLE - FREE A WORKING SET LIST ENTRY                                                                         (13)

                                     0777   100 	.SBTTL	FREWSLE - FREE A WORKING SET LIST ENTRY
                                     0777   200 ;++
                                     0777   300 ; FUNCTIONAL DESCRIPTION:
                                     0777   400 ;
                                     0777   500 ;	THIS ROUTINE CHOOSES A WORKING SET LIST ENTRY, RELEASES THE
                                     0777   600 ; PAGE WHICH OCCUPIES IT (IF ANY), MARKS THE ENTRY AVAILABLE, AND
                                     0777   700 ; LEAVES THE WSNEXT POINTER POINTING TO THE AVAILABLE ENTRY.
                                     0777   800 ;	IN RELEASING A PAGE, IF ITS BACKING STORE ADDRESS IS A
                                     0777   900 ; "NOT YET ALLOCATED" PAGING FILE ADDRESS, THEN A PAGING FILE VBN
                                     0777  1000 ; IS ALLOCATED AT THIS TIME.  IT IS POSSIBLE THAT NO VBN'S ARE AVAILABLE
                                     0777  1100 ; AND THUS THIS ROUTINE CAN RETURN UNSUCCESSFULLY.
                                     0777  1200 ;
                                     0777  1300 ; CALLING SEQUENCE:
                                     0777  1400 ;
                                     0777  1500 ;	BSBW	MMG$FREWSLE
                                     0777  1600 ;
                                     0777  1700 ; INPUT PARAMETERS:
                                     0777  1800 ;
                                     0777  1900 ;	R4 = PCB ADDRESS
                                     0777  2000 ;	R5 = PROCESS HEADER ADDRESS - MAY BE P1 SPACE ADDRESS
                                     0777  2100 ;		IF WORKING WITH PROCESS WORKING SET LIST
                                     0777  2200 ;	IPL = SYNCH
                                     0777  2300 ;
                                     0777  2400 ; IMPLICIT INPUTS:
                                     0777  2500 ;	NONE
                                     0777  2600 ;
                                     0777  2700 ; OUTPUT PARAMETERS:
                                     0777  2800 ;
                                     0777  2900 ;	IF SUCCESSFUL
                                     0777  3000 ;		R0 LOW BIT IS SET
                                     0777  3100 ;	IF NOT SUCCESSFUL
                                     0777  3200 ;		R0 LOW BIT IS CLEAR AND
                                     0777  3300 ;		R1 = RESOURCE TO WAIT FOR (#RSN$_XXXXX)
                                     0777  3400 ;
                                     0777  3500 ; IMPLICIT OUTPUTS:
                                     0777  3600 ;
                                     0777  3700 ;	IF A WORKING SET ENTRY WAS FREED,  IT IS PLACED ON THE FREE LIST
                                     0777  3800 ;
                                     0777  3900 ; COMPLETION CODES:
                                     0777  4000 ;	NONE
                                     0777  4100 ;
                                     0777  4200 ; SIDE EFFECTS:
                                     0777  4300 ;	NONE
                                     0777  4400 ;
                                     0777  4500 ;--
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  35
X0425           FREWSLE - FREE A WORKING SET LIST ENTRY                                                                         (14)

                                     0777   100 ;
                                     0777   110 ; INPUTS:
                                     0777   120 ;
                                     0777   130 ;	R1  = WORKING SET LIST INDEX
                                     0777   140 ;	R2  = VIRTUAL ADDRESS (LOW BITS  = PAGE TYPE)
                                     0777   150 ;	R3  = SYSTEM VIRTUAL ADDRESS OF PAGE TABLE ENTRY
                                     0777   160 ;	R4  = PROCESS CONTROL BLOCK ADDRESS
                                     0777   170 ;	R5  = PROCESS HEADER ADDRESS
                                     0777   180 ;	IPL = SYNCH
                                     0777   190 ;
                                     0777   200 ; OUTPUTS:
                                     0777   210 ;
                                     0777   220 ;	R0 = STATUS
                                     0777   230 ;	R1 = RESOURCE TO WAIT FOR IF NOT SUCCESSFUL
                                     0777   240 ;
                                     0777   400 MMG$FREWSLX::
                          01     DD  0777   500 	PUSHL	#1			;SAVED SVAPTE OF 1ST RELEASABLE ENTRY
                                     0779   600 					;INDICATES THAT NO ENTRIES SHOULD BE SKIPPED
                          7E     7C  0779   700 	CLRQ	-(SP)			;SAVED WSLX OF 1ST RELEASABLE ENTRY
                                     077B   800 					;AND MAX SKIP COUNT, NO SKIPPING
                          51     DD  077B   900 	PUSHL	R1			;SAVE WORKING SET LIST INDEX
                          78     11  077D  1000 	BRB	FRE_FREWSLE1
                                     077F  1100 
                                     077F  1200 LCKWSLE_NOTPGTB:
                                     077F  1300 	BUG_CHECK BADLCKWSLE,FATAL	;LOCKED WORKING SET LIST ENTRY NOT PAGE TABLE
                               FEFF  077F       		.WORD	^XFEFF
                               0004' 0781       		.IIF IDN <FATAL>,<FATAL> , .WORD	BUG$_BADLCKWSLE!4
                                     0783  1400 ;
                                     0783  1500 ; THIS IS A LOCKED PAGE IN THE DYNAMIC PORTION OF THE WORKING SET LIST
                                     0783  1600 ; IT MUST BE A PAGE TABLE PAGE, NOTE THE CONDITION CODES ARE STILL SET
                                     0783  1700 ; FROM THE FETCH OF THE WORKING SET LIST ENTRY.
                                     0783  1800 ;
                                     0783  1900 LOCKED_WSLE:
                          FA     18  0783  2000 	BGEQ	LCKWSLE_NOTPGTB		;BRANCH IF THIS IS NOT A PAGE TABLE
         70 A5         6E A5     A3  0785  2100 	SUBW3	PHD$W_PTCNTVAL(R5),PHD$W_PTCNTACT(R5),R0 ;ACTIVE PAGE TABLES
                          50         078A       
                                     078B  2200 					;THAT DON'T CONTAIN VALID WSLE'S
                                     078B  2300 					;ARE "DEAD PAGE TABLES"
                          49     15  078B  2400 	BLEQ	FRE_NXTWSLE		;BRANCH IF NO DEAD PAGE TABLES
         76 A5            50     B1  078D  2500 	CMPW	R0,PHD$W_EXTDYNWS(R5)	;ARE DEAD PT'S ENCROACHING ON THE
                                     0791  2600 					;DYNAMIC WORKING SET TOO MUCH?
                          43     15  0791  2700 	BLEQ	FRE_NXTWSLE		;BRANCH IF ENOUGH EXTRA DYNAMIC
                                     0793  2800 					;WSLE'S TO MAKE UP FOR DEAD PAGE TABLES
                          FF23   30  0793  2900 	BSBW	SCANDEADPT		;SCAN THE DEAD PAGE TABLE TO RID
                                     0796  3000 					;IT OF TRANSITION PAGES.
                          35     11  0796  3100 	BRB	FRE_FIRSTWSLE		;AND THEN GET A FREE WORKING SET LIST ENTRY
                                     0798  3200 
                                     0798  3300 WSLENOVAL:
                                     0798  3400 	BUG_CHECK WSLENOVAL,FATAL	;WSL ENTRY NOT VALID
                               FEFF  0798       		.WORD	^XFEFF
                               0004' 079A       		.IIF IDN <FATAL>,<FATAL> , .WORD	BUG$_WSLENOVAL!4
                                     079C  3500 
                                     079C  3600 ;
                                     079C  3700 ; THIS WORKING SET LIST ENTRY POINTED TO A PAGE WITH A PAGE TABLE ENTRY
                                     079C  3800 ; WHICH IS NEITHER VALID NOR IN TRANSITION.  THIS PAGE MUST BE A GLOBAL
                                     079C  3900 ; PAGE ON THE WAY IN TO MEMORY.  THE GLOBAL PTE MUST BE IN TRANSITION.
                                     079C  4000 ;
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  36
X0425           FREWSLE - FREE A WORKING SET LIST ENTRY                                                                         (14)

                                     079C  4100 FRE_GBLTRANS:
                          BF     10  079C  4200 	BSBB	FRE_GBLTRANS1		;GET PFN IF PAGE IS GLOBAL TRANSITION
                          6F     11  079E  4300 	BRB	FRE_TRANS		;AND REJOIN MAIN FLOW
                                     07A0  5000 ;
                                     07A0  5010 ; FOUND AN EMPTY WORKING SET LIST ENTRY, CHECK WHETHER THERE IS A
                                     07A0  5020 ; NEW PEAK WORKING SET SIZE.
                                     07A0  5030 ;
                                     07A0  5700 FRE_EMPTY:
         3A A5            02     E1  07A0  5710 	BBC	#PHD$V_WSPEAKCHK,PHD$W_FLAGS(R5),10$ ;BRANCH IF CANNOT BE
                          17         07A4       
                                     07A5  5720 					;ABOVE PREVIOUS PEAK WORKING SET SIZE
         38 A4         3A A4     A1  07A5  5730 	ADDW3	PCB$W_PPGCNT(R4),PCB$W_GPGCNT(R4),R0 ;PAGE COUNT CURRENTLY IN USE
                          50         07AA       
   00000000'GF            50     B1  07AB  5740 	CMPW	R0,G^CTL$GL_WSPEAK	;ABOVE PREVIOUS RECORDED PEAK?
                          08     1F  07B2  5750 	BLSSU	10$			;BRANCH IF NOT
            50            01     A1  07B4  5760 	ADDW3	#1,R0,G^CTL$GL_WSPEAK	;YES, NEW PEAK INCLUDES THE PAGE
                 00000000'GF         07B7       
                                     07BC  5770 					;ABOUT TO BE ADDED TO THE WORKING SET
                          0116   31  07BC  5800 10$:	BRW	FRE_SUCCESS
                                     07BF  5900 
                                     07BF  6000 MMG$FREWSLE::
                          7E     7C  07BF  6100 	CLRQ	-(SP)			;SAVED WSLX, PTEADR OF 1ST RELEASABLE WSLE
            7E   00000000'EF     32  07C1  6200 	CVTWL	SGN$GW_WSLMXSKP,-(SP)	;MAX NUMBER OF ENTRIES TO BE WILLING TO SKIP
                          03     14  07C8  6300 	BGTR	FRE_FIRSTWSLE		;BRANCH IF SKIPPING ENABLE
                       08 AE     D6  07CA  6400 	INCL	8(SP)			;DISABLE SKIP CONTEXT
                                     07CD  6500 FRE_FIRSTWSLE:
            51         10 A5     3C  07CD  6600 	MOVZWL	PHD$W_WSNEXT(R5),R1	;INDEX TO NEXT CANDIDATE TO DISCARD
                          6541   D5  07D1  6700 	TSTL	(R5)[R1]		;IF ALREADY FREE
                          CA     13  07D4  6800 	BEQL	FRE_EMPTY		;USE THIS ENTRY
                                     07D6  6900 FRE_NXTWSLE:
            01         12 A5     3D  07D6  7000 	ACBW	PHD$W_WSLAST(R5),#1,R1,10$ ;OTHERWISE POINT TO NEXT ENTRY
            0004          51         07DA       
            51         0E A5     B0  07DD  7100 	MOVW	PHD$W_WSDYN(R5),R1	;BACK TO THE TOP
         10 A5            51     B0  07E1  7200 10$:	MOVW	R1,PHD$W_WSNEXT(R5)	;UPDATE NEXT POINTER
            52            6541   D0  07E5  7300 	MOVL	(R5)[R1],R2		;R2 = VA FROM WSLE
                          B5     13  07E9  7400 	BEQL	FRE_EMPTY		;BRANCH IF FREE ENTRY
            AA            52     E9  07EB  7500 	BLBC	R2,WSLENOVAL		;BRANCH IF ENTRY NOT VALID
            52            05     E0  07EE  7600 	BBS	#WSL$V_WSLOCK,R2,LOCKED_WSLE ;SKIP ENTRY IF IT IS LOCKED
                          91         07F1       
                                     07F2  7610 					;CONDITION CODES STILL SET FROM LOAD OF R2
                          51     DD  07F2  7700 	PUSHL	R1			;SAVE WORKING SET LIST INDEX
                          F809'  30  07F4  7800 	BSBW	MMG$SVAPTECHK		;RETURN R3 = SYS VA OF PAGE TABLE ENTRY
                                     07F7  7900 					;OK FOR PROCESS PAGE TABLES AND
                                     07F7  8000 					;PROCESS HEADER PAGES WITH PROCESS PCB ADR
                                     07F7  8100 ;
                                     07F7  8200 ; R2 = VA FROM WSLE, R3 = SVAPTE, R4 = PCB, R5 = PHD
                                     07F7  8300 ; 0(SP)  = SAVED WSLX
                                     07F7  8400 ; 4(SP)  = MAX SKIP COUNT TO KEEP FROM PROCESSING TOO MANY ENTRIES
                                     07F7  8500 ; 8(SP)  = SLOT FOR SAVED WSLX OF FIRST RELEASABLE WSLE
                                     07F7  8600 ;	 = ZERO IF CURRENT REGISTER CONTEXT IS WSLE TO RELEASE
                                     07F7  8700 ; 12(SP) = SLOT FOR SAVED SVAPTE OF FIRST RELEASABLE WSLE
                                     07F7  8800 ;	 = GREATER THAN 0 IF SKIPPING ENTRIES IS DISABLED
                                     07F7  8900 ;
                                     07F7  9000 FRE_FREWSLE1:
            50            63     D0  07F7  9100 	MOVL	(R3),R0			;GET PTE CONTENTS
                          50     DD  07FA  9200 	PUSHL	R0			;AND SAVE IT
                                     07FC  9300 
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  37
X0425           FREWSLE - FREE A WORKING SET LIST ENTRY                                                                         (14)

                                     07FC  9400 	ASSUME PTE$V_MODIFY EQ PTE$V_TYP1
            50   7B800000 8F     CB  07FC  9500 	BICL3	#^C<PTE$M_VALID ! -	;FETCH VALID BIT
                          50         0803       
                                     0804  9600 		PTE$M_TYP1 ! PTE$M_TYP0 ! - ;PTE TYPE BITS
                                     0804  9700 		PTE$M_GPTX>,R0,R0	;AND PFN/GPTX FROM PAGE TABLE ENTRY
            50            1F     E4  0804  9800 	BBSC	#PTE$V_VALID,R0,FRE_VALID ;BRANCH IF PTE VALID
                          15         0807       
                                     0808  9900 					;CLEAR VALID BIT IN R0
                                     0808 10000 ;
                                     0808 10100 ; PAGE TABLE ENTRY NOT VALID,
                                     0808 10200 ;	PAGE IN TRANSITION AND ACTIVE IS TO BE RELEASED
                                     0808 10300 ;	PAGE IN TRANSITION AND READINPROG IS TO BE SKIPPED
                                     0808 10400 ;	GLOBAL PTE POINTING TO TRANSITION PTE IS TO BE SKIPPED
                                     0808 10500 ;
            50         EA 8F     78  0808 10600 	ASHL	#-PTE$V_TYP0,R0,R1	;IF EITHER TYP1 OR TYP0 IS SET
                          51         080C       
                          8D     12  080D 10700 	BNEQ	FRE_GBLTRANS		;THEN CHECK FOR GLOBAL READ IN PROGRESS
                                     080F 10800 ;
                                     080F 10900 ; PAGE IN IN TRANSITION
                                     080F 11000 ;
                                     080F 11100 FRE_TRANS:
                                     080F 11200 	ASSUME	PFN$C_ACTIVE EQ 7	;ALL BITS SET
            07       0000'DF40   8B  080F 11300 	BICB3	@W^PFN$AB_STATE[R0],#PFN$C_ACTIVE,R1 ;0 IF ACTIVE
                          51         0815       
                          4B     13  0816 11400 	BEQL	FRE_RELEASE		;RELEASE ACTIVE PAGE
                                     0818 11500 					;WASN'T REFAULTED SINCE MADE INVALID
                          16     11  0818 11600 	BRB	FRE_TRY_SKIP		;SKIP READ IN PROGRESS PAGES
                                     081A 16020 FRE_ALLOCPGFL1:
                          00D1   31  081A 16040 	BRW	FRE_ALLOCPGFL
                                     081D 16100 ;
                                     081D 16200 ; 0(SP)  = SAVED PTE CONTENTS
                                     081D 16300 ; 4(SP)  = WSLX OF CURRENT WORKING SET LIST ENTRY
                                     081D 16400 ; 8(SP)  = SKIP COUNT
                                     081D 16500 ; 12(SP) = SAVED WORKING SET LIST INDEX OF FIRST RELEASABLE WSLE IF NOT 0
                                     081D 16600 ; 16(SP) = SAVED PTE ADDRESS OF 1ST RELEASABE WSLE IF NEGATIVE
                                     081D 16700 ;
                                     081D 16800 ; THIS IS A VALID PAGE TABLE ENTRY, PUT IT IN TRANSITION ACTIVE STATE
                                     081D 16900 ; CHOOSE ANOTHER ENTRY TO RELEASE (UNLESS SKIPPED TOO MANY)
                                     081D 17000 ; IF THIS PAGE IS HEAVILY USED, IT WILL BE REFAULTED AND WILL NOT LEAVE
                                     081D 17100 ; THE WORKING SET THE NEXT TIME IT IS LOOKED AT EITHER.
                                     081D 17200 ;
                                     081D 17300 FRE_VALID:
            50            1A     E5  081D 17400 	BBCC	#PTE$V_MODIFY,R0,20$	;CLR MODIFY IN R0, BRANCH IF CLEAR
                          07         0820       
       0000'DF40       80 8F     88  0821 17500 	BISB	#PFN$M_MODIFY,@W^PFN$AB_STATE[R0] ;RECORD MODIFY BIT
         03 A3         84 8F     8A  0828 17600 20$:	BICB	#<PTE$M_VALID ! PTE$M_MODIFY>@-24,3(R3) ;RESET VALID AND MODIFY
                                     082D 17700 					;LEAVING TRANSITION PAGE FOR I/O TO SEE
                                     082D 17800 	INVALID	R2			;INVALIDATE TRANSLATION BUFFER
            3A            52     DA  082D       		MTPR	R2,S^#PR$_TBIS
                                     0830 17900 FRE_TRY_SKIP:
                       10 AE     D5  0830 18000 	TSTL	16(SP)			;ALREADY SAVED CONTEXT FOR
                                     0833 18100 					;FIRST RELEASABLE WSLE?
                          09     12  0833 18200 	BNEQ	10$			;NEGATIVE IF YES, GREATER IF DISABLED
         0C AE         04 AE     D0  0835 18300 	MOVL	4(SP),12(SP)		;RECORD WORKING SET LIST INDEX
         10 AE            53     D0  083A 18400 	MOVL	R3,16(SP)		;AND SVAPTE
                       08 AE     D7  083E 18500 10$:	DECL	8(SP)			;SKIPPED ENOUGH?
                          05     19  0841 18600 	BLSS	20$			;YES, TOO MUCH SCANNING
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  38
X0425           FREWSLE - FREE A WORKING SET LIST ENTRY                                                                         (14)

                                     0843 18700 					;CAN COST MORE THAN IT IS WORTH
            50            8E     7D  0843 18800 	MOVQ	(SP)+,R0		;GET WSLX BACK IN R1, CLEAN STACK
                          8E     11  0846 18900 	BRB	FRE_NXTWSLE		;CHOOSE ANOTHER WORKING SET LIST ENTRY
            51         0C AE     D0  0848 19000 20$:	MOVL	12(SP),R1		;WORKING SET LIST INDEX OF 1ST
                                     084C 19100 					;RELEASABLE WORKING SET LIST ENTRY
                          15     13  084C 19200 	BEQL	30$			;BRANCH IF CURRENT ONE IS IT
         04 AE            51     D0  084E 19300 	MOVL	R1,4(SP)		;RECORD CURRENT WSLX
         10 A5            51     B0  0852 19350 	MOVW	R1,PHD$W_WSNEXT(R5)	;MOVE WSNEXT BACK TOO
            52            6541   D0  0856 19400 	MOVL	(R5)[R1],R2		;GET VA AND PAGTYP BITS
            53         10 AE     D0  085A 19500 	MOVL	16(SP),R3		;RECOVER SVAPTE
            15            00     EF  085E 19600 	EXTZV	#PTE$V_PFN,#PTE$S_PFN,(R3),R0 ;AND PAGE FRAME NUMBER
            50            63         0861       
                                     0863 19700 30$:
                                     0863 19800 ;
                                     0863 19900 ; RELEASE THIS WORKING SET LIST ENTRY
                                     0863 20000 ;
                                     0863 20100 FRE_RELEASE:
       0000'DF40          09     78  0863 20500 	ASHL	#32-PFN$S_BAK,@W^PFN$AL_BAK[R0],R1 ;NEED TO ALLOCATE PAGE FILE?
                          51         0869       
                          AE     13  086A 20600 	BEQL	FRE_ALLOCPGFL1		;BRANCH IF YES
                                     086C 20700 ;
                                     086C 20800 ; PFN$AL_BAK[R0] IS ALL SET UP, R0 = PFN, R2 = VA, R3 = SVAPTE (SLAVE IF GBL)
                                     086C 20900 ;
                                     086C 21000 ; 0(SP)  = SAVED PTE CONTENTS
                                     086C 21100 ; 4(SP)  = WSLX OF CURRENT WORKING SET LIST ENTRY
                                     086C 21200 ; 8(SP)  = SKIP COUNT
                                     086C 21300 ; 12(SP) = SAVED WORKING SET LIST INDEX OF FIRST RELEASABLE WSLE IF NOT 0
                                     086C 21400 ; 16(SP) = SAVED PTE ADDRESS OF 1ST RELEASABE WSLE IF NEGATIVE
                                     086C 21500 ;
                                     086C 21600 FRE_NOTMODIFIED:
            5E            04     C0  086C 21700 	ADDL	#4,SP			;CLEAN OFF SAVED PTE CONTENTS
                                     086F 21800 
                                     086F 21900 	ASSUME	PFN$C_PROCESS EQ 0
                                     086F 22000 	ASSUME	PFN$C_SYSTEM  EQ 1
                                     086F 22100 	ASSUME	PFN$C_GLOBAL  EQ 2
                                     086F 22200 	ASSUME	PFN$C_GBLWRT  EQ 3
                                     086F 22300 	ASSUME	PFN$C_PPGTBL  EQ 4
                                     086F 22400 	ASSUME	PFN$C_GPGTBL  EQ 5
                                     086F 22500 
            03            01     EC  086F 22600 	CMPV	#WSL$V_PAGTYP,#WSL$S_PAGTYP,R2,#PFN$C_GLOBAL ;GLOBAL PAGE?
            02            52         0872       
                          37     1F  0874 22700 	BLSSU	70$			;BRANCH IF PROCESS OR SYSTEM
                          25     19  0876 22800 	BLSS	66$			;BRANCH IF PROCESS OR GLOBAL PAGE TABLE
                                     0878 22900 ;
                                     0878 23000 ; GLOBAL PAGE - MAKE SLAVE PTE INTO GLOBAL FORMAT
                                     0878 23100 ;
       0000'DF40     0000'CF     C3  0878 23200 	SUBL3	W^MMG$GL_GPTBASE,@W^PFN$AL_PTE[R0],R1 ;BYTE INDEX TO GPTE
                          51         0880       
            51            1E     9C  0881 23300 	ROTL	#32-2,R1,R1		;GLOBAL PAGE TABLE INDEX
                          51         0884       
                                     0885 23400 	ASSUME	PTE$V_TYP0 EQ PTE$S_GPTX ;TYP0 ADJACENT TO GPTX FIELD
            51            16     E2  0885 23500 	BBSS	#PTE$V_TYP0,R1,63$	;SET TYP0 BIT FOR GLOBAL FORMAT
                          00         0888       
            00            51     F0  0889 23600 63$:	INSV	R1,#PTE$V_GPTX,#PTE$S_GPTX+1,(R3) ;STORE GPTX + TYP0 IN PTE
            63            17         088C       
                                     088E 23700 					;CHANGING FROM TRANSITION TO GLOBAL
                          01C4   30  088E 23800 	BSBW	MMG$DECPTREF		;SLAVE PTE NO LONGER LOCKED
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  39
X0425           FREWSLE - FREE A WORKING SET LIST ENTRY                                                                         (14)

                                     0891 23900 	DECSHR	GTR=140$,EQL=70$	;ONE LESS SHARER, BRANCH IF STILL IN USE
                     0000'DF40   B7  0891       		DECW	@W^PFN$AW_SHRCNT[R0]
                          15     13  0896       		BEQL	70$
                          36     14  0898       		BGTR	140$
                          F763'  30  089A       		BSBW	MMG$SHRCNTNEG
                                     089D 24000 ;
                                     089D 24100 ; PROCESS OR GLOBAL PAGE TABLE
                                     089D 24200 ;
            03            01     ED  089D 24300 66$:	CMPZV	#WSL$V_PAGTYP,#WSL$S_PAGTYP,R2,#PFN$C_PPGTBL ;PROCESS PAGE TABLE?
            04            52         08A0       
                          09     12  08A2 24400 	BNEQ	70$			;BRANCH IF NO
            51         46 A5     3C  08A4 24500 	MOVZWL	PHD$W_PHVINDEX(R5),R1	;PROCESS HEADER VECTOR INDEX
                     0000'DF41   B6  08A8 24600 	INCW	@W^PHV$GL_REFCBAS[R1]	;ADD A PROCESS HEADER REFERENCE
                                     08AD 24700 					;WHEN PROCESS PAGE TABLE IS PUT
                                     08AD 24800 					;INTO TRANSITION STATE
                                     08AD 24900 70$:	DECREF	EQL=100$		;COUNT ONE LESS WSL REF
                     0000'DF40   B7  08AD       		DECW	@W^PFN$AW_REFCNT[R0]
                          19     13  08B2       		BEQL	100$
                          03     18  08B4       		BGEQ	30003$
                          F747'  30  08B6       		BSBW	MMG$REFCNTNEG
                                     08B9       30003$:
                                     08B9 25000 ;
                                     08B9 25100 ; OTHER REFERENCES OUTSTANDING, COULD BE DIRECT I/O, PAGING I/O
                                     08B9 25200 ; IF CURRENT PAGE STATE IS "ACTIVE" CHANGE IT TO "RELEASE PENDING" WHICH
                                     08B9 25300 ; IF REFAULTED WILL BE TRANSFORMED BACK TO ACTIVE.
                                     08B9 25400 ; LEAVE "READ IN PROGRESS" STATE AS IS.
                                     08B9 25500 ;
            03            00     ED  08B9 25600 	CMPZV	#PFN$V_LOC,#PFN$S_LOC,@W^PFN$AB_STATE[R0],#PFN$C_ACTIVE
            07       0000'DF40       08BC       
                                     08C1 25700 					;UNLESS STATE IS "ACTIVE"
                          0D     12  08C1 25800 	BNEQ	140$			;LEAVE IT AS IT WAS
            00            03     F0  08C3 25900 	INSV	#PFN$C_RELPEND,#PFN$V_LOC,#PFN$S_LOC,@W^PFN$AB_STATE[R0]
       0000'DF40          03         08C6       
                                     08CB 26000 					;OTHERWISE SET RELEASE PENDING STATE
                          03     11  08CB 26100 	BRB	140$
                                     08CD 26200 ;
                                     08CD 26300 ; R0 = PFN, REFCNT = 0, R2 = VA, R3 = SVAPTE
                                     08CD 26400 ;
                                     08CD 26500 
                          F730'  30  08CD 26600 100$:	BSBW	MMG$RELPFN		;REFCNT = 0, RELEASE PFN
            51            8E     D0  08D0 26700 140$:	MOVL	(SP)+,R1		;RECOVER SAVED WSLX
                          50     10  08D3 26800 	BSBB	MMG$DELWSLEX		;DELETE WORKING SET LIST ENTRY (BY INDEX)
                                     08D5 26900 FRE_SUCCESS:
            5E            0C     C0  08D5 27000 	ADDL	#3*4,SP			;CLEAN STACK
            50            01     3C  08D8 27100 	MOVZWL	S^#SS$_NORMAL,R0	;SUCCESSFUL RETURN INDICATION
                                 05  08DB 27200 	RSB
                                     08DC 27300 ;
                                     08DC 27400 ; FAILED TO ALLOCATE PAGE FILE BECAUSE THE PAGE FILE HASN'T BEEN INITIALIZED
                                     08DC 27500 ; THIS IS A SYSTEM BOOTING PROBLEM AND IS HANDLED BY NOT DISCARDING PAGES
                                     08DC 27600 ; WHICH NEED PAGE FILE UNTIL SUCH TIME AS IT IS INITIALIZED. CHOOSE ANOTHER PAGE.
                                     08DC 27700 ;
                                     08DC 27800 FRE_PGFLNOTINI:
                          FEE0   31  08DC 27900 	BRW	MMG$FREWSLE
                                     08DF 28000 GPGNULPGFL:
                                     08DF 28100 	BUG_CHECK GPGNULPGFL,FATAL	;NULL PAGE FILE ILLEGAL FOR GLOBAL
                               FEFF  08DF       		.WORD	^XFEFF
                               0004' 08E1       		.IIF IDN <FATAL>,<FATAL> , .WORD	BUG$_GPGNULPGFL!4
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  40
X0425           FREWSLE - FREE A WORKING SET LIST ENTRY                                                                         (14)

                                     08E3 28110 ;
                                     08E3 28120 ; NULL PAGE FILE BACKING STORE ADDRESS, BUT PAGE IS NOT MODIFIED
                                     08E3 28130 ;
                                     08E3 28140 NULLPGFL_NOMFY:
                                     08E3 28150 	BUG_CHECK MFYNULPGFL,CONTINUE
                               FEFF  08E3       		.WORD	^XFEFF
                               0000' 08E5       		.IIF DIF <CONTINUE>,<FATAL> , .WORD	BUG$_MFYNULPGFL
       0000'DF40       80 8F     88  08E7 28160 	BISB	#PFN$M_MODIFY,@W^PFN$AB_STATE[R0] ;FORCE MODIFY BIT AND CONTINUE
                                     08EE 28200 ;
                                     08EE 28300 ; PAGE WITH "NOT YET ALLOCATED" PAGE FILE BACKING STORE ADDRESS.
                                     08EE 28400 ; ALLOCATE A PAGE FILE VBN AND SET UP THE BACKING STORE ADDRESS
                                     08EE 28500 ;
                                     08EE 28600 FRE_ALLOCPGFL:
                                     08EE 28610 	ASSUME	PFN$V_MODIFY EQ 7
                     0000'DF40   95  08EE 28620 	TSTB	@W^PFN$AB_STATE[R0]	;PAGE MODIFIED?
                          EE     18  08F3 28630 	BGEQ	NULLPGFL_NOMFY		;BRANCH IF NOT
            03            01     EC  08F5 28700 	CMPV	#WSL$V_PAGTYP,#WSL$S_PAGTYP,R2,#PFN$C_GLOBAL ;GLOBAL PAGE?
            02            52         08F8       
                          E3     18  08FA 28800 	BGEQ	GPGNULPGFL		;NULL PAGING FILE FOR GLOBAL PAGE
                                     08FC 28900 					;NOT READY FOR 'NO PAGE FILE AVAILABLE'
                          0D     BB  08FC 29000 	PUSHR	#^M<R0,R2,R3>		;SAVE PFN, VA, SVAPTE
            51         1F A5     9A  08FE 29100 	MOVZBL	PHD$B_PAGFIL(R5),R1	;R1 = PAGE FILE INDEX
                          F6FB'  30  0902 29300 	BSBW	MMG$RSRVPAGFIL		;RESERVE A PAGE FILE VBN
            51            50     D0  0905 29400 	MOVL	R0,R1			;R1 = VBN IF ALLOCATED
                          0D     BA  0908 29500 	POPR	#^M<R0,R2,R3>		;RESTORE PFN, VA, SVAPTE
                                     090A 29600 					;PRESERVING CONDITION CODES
                          09     15  090A 29700 	BLEQ	30$			;BRANCH IF FAILED TO ALLOCATE ONE
       0000'DF40          51     C8  090C 29800 	BISL	R1,@W^PFN$AL_BAK[R0]	;PUT PAGE FILE VBN IN BACKING STORE ADR
                          FF57   31  0912 29900 	BRW	FRE_NOTMODIFIED
            63            8E     D0  0915 30000 30$:	MOVL	(SP)+,(R3)		;RESTORE ORIGINAL PTE CONTENTS
                                     0918 30100 ;
                                     0918 30200 ; IF THE PAGING FILE WAS EMPTY BECAUSE IT HADN'T BEEN INITIALIZED YET
                                     0918 30300 ; THEN R1 = 0, OTHERWISE IT IS NEGATIVE.  IF THE PAGING FILE IS NOT
                                     0918 30400 ; YET INITIALIZED, THEN SIMPLY CHOOSE ANOTHER PAGE TO LEAVE THE WORKING
                                     0918 30500 ; SET LIST, OTHERWISE, RETURN THE ERROR AND WAIT.
                                     0918 30600 ;
            5E            10     C0  0918 30700 	ADDL	#4*4,SP			;CLEAN UP THE STACK
            51            1F     E1  091B 30800 	BBC	#31,R1,FRE_PGFLNOTINI	;BRANCH IF PAGE FILE NOT INITIALIZED
                          BD         091E       
            51            04     3C  091F 30900 	MOVZWL	#RSN$_PGFILE,R1		;R1 = RESOURCE TO WAIT FOR
                          50     D4  0922 31000 	CLRL	R0			;RETURN FAILURE INDICATION
                                     0924 31100 ;
                                     0924 31200 ; NOTE THAT WSNEXT IS NOT BEING BACKED UP, AND THE NEXT ATTEMPT TO FREE
                                     0924 31300 ; A WORKING SET LIST ENTRY WILL CHOOSE ANOTHER.  THIS SHOULD TEND TO REDUCE
                                     0924 31400 ; THE PRESSURE ON THE PAGE FILE WHICH HAS LITTLE OR NO SPACE LEFT.
                                     0924 31500 ;
                                 05  0924 31600 	RSB				;RETURN RESOURCE TO WAIT FOR IN R1
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  41
X0425           DELWSLEX - DELETE WORKING SET LIST ENTRY BY IND                                                                 (15)

                                     0925   100 	.SBTTL	DELWSLEX - DELETE WORKING SET LIST ENTRY BY INDEX
                                     0925   200 ;++
                                     0925   300 ; FUNCTIONAL DESCRIPTION:
                                     0925   400 ;
                                     0925   500 ;	THIS ROUTINE DELETES THE WORKING SET LIST ENTRY INDEXED BY
                                     0925   600 ; R1, AND PLACES THE WORKING SET LIST ENTRY ON THE FREE LIST.
                                     0925   700 ;
                                     0925   800 ; CALLING SEQUENCE:
                                     0925   900 ;
                                     0925  1000 ;	BSBW	MMG$DELWSLEX
                                     0925  1200 ;	BSBW	MMG$DELWSLEPPG
                                     0925  1300 ;
                                     0925  1400 ; INPUT PARAMETERS:
                                     0925  1500 ;
                                     0925  1600 ;	R1 = WORKING SET LIST INDEX
                                     0925  1650 ;	R2 = VIRTUAL ADDRESS IF ENTERING AT DELWSLEPPG
                                     0925  1700 ;	R4 = PROCESS CONTROL BLOCK ADDRESS
                                     0925  1800 ;	R5 = PROCESS HEADER ADDRESS
                                     0925  1900 ;
                                     0925  2000 ; IMPLICIT INPUTS:
                                     0925  2100 ;
                                     0925  2200 ;	NONE
                                     0925  2300 ;
                                     0925  2400 ; OUTPUT PARAMETERS:
                                     0925  2500 ;
                                     0925  2600 ;	R0 PRESERVED
                                     0925  2900 ;
                                     0925  3000 ; IMPLICIT OUTPUTS:
                                     0925  3100 ;
                                     0925  3200 ;	NONE
                                     0925  3300 ;
                                     0925  3400 ; COMPLETION CODES:
                                     0925  3500 ;
                                     0925  3600 ;	NONE
                                     0925  3700 ;
                                     0925  3800 ; SIDE EFFECTS:
                                     0925  3900 ;
                                     0925  4000 ;	NONE
                                     0925  4100 ;
                                     0925  4200 ;--
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  42
X0425           DELWSLEX - DELETE WORKING SET LIST ENTRY BY IND                                                                 (16)

                                     0925   100 	.ENABL	LSB
                                     0925   200 
                                     0925   300 MMG$DELWSLEX::
            52            6541   D0  0925   400 	MOVL	(R5)[R1],R2		;FETCH WORKING SET LIST ENTRY
            03            01     EF  0929   500 	EXTZV	#WSL$V_PAGTYP,#WSL$S_PAGTYP,R2,R3  ;GET THE PAGE TYPE
            53            52         092C       
                                     092E   600 	CASE	R3,<-			;AND DISPATCH ON IT
                                     092E   700 		30$,-			;PROCESS PAGE
                                     092E   800 		50$,-			;SYSTEM PAGE
                                     092E   900 		10$,-			;GLOBAL READ ONLY
                                     092E  1000 		10$,-			;GLOBAL WRITABLE
                                     092E  1100 		45$,-			;PROCESS PAGE TABLE
                                     092E  1200 		50$  >			;GLOBAL PAGE TABLE
            00            53     AF  092E       	CASEW	R3,#0,S^#<<30005$-30004$>/2>-1
                          05'        0931       
                                     0932       30004$:
                               0017' 0932       	.WORD	30$-30004$
                               001C' 0934       	.WORD	50$-30004$
                               0010' 0936       	.WORD	10$-30004$
                               0010' 0938       	.WORD	10$-30004$
                               0019' 093A       	.WORD	45$-30004$
                               001C' 093C       	.WORD	50$-30004$
                                     093E       30005$:
                                     093E  1300 	BUG_CHECK DELWSLEX,FATAL	;BAD PAGE TYPE
                               FEFF  093E       		.WORD	^XFEFF
                               0004' 0940       		.IIF IDN <FATAL>,<FATAL> , .WORD	BUG$_DELWSLEX!4
                                     0942  1400 ;
                                     0942  1500 ; GLOBAL PAGE, READ ONLY OR WRITABLE
                                     0942  1600 ;
                          0E     10  0942  1700 10$:	BSBB	DECVALWSLECNT		;DEC VALID WORKING SET LIST ENTRY COUNT
                       38 A4     B7  0944  1750 	DECW	PCB$W_GPGCNT(R4)	;ONE LESS GLOBAL PAGE IN WORKING SET
                          05     11  0947  1800 	BRB	50$
                                     0949  2400 ;
                                     0949  2500 ; PROCESS PAGE, R2 = VIRTUAL ADDRESS
                                     0949  2600 ;
                                     0949  2700 MMG$DELWSLEPPG::
                          07     10  0949  2800 30$:	BSBB	DECVALWSLECNT		;DECREMENT VALID WORKING SET LIST ENTRY CNT
                       3A A4     B7  094B  3600 45$:	DECW	PCB$W_PPGCNT(R4)	;ONE LESS PROCESS PAGE IN WORKING SET
                          6541   D4  094E  3700 50$:	CLRL	(R5)[R1]		;FREE THE WORKING SET LIST ENTRY
                                 05  0951  3800 	RSB
                                     0952  3900 
                                     0952  4000 	.DSABL	LSB
                                     0952  4010 
                                     0952  4020 DECVALWSLECNT:
            55         68 A5     C1  0952  4100 	ADDL3	PHD$L_PTWSLEVAL(R5),R5,R3 ;BASE ADR OF BYTE ARRAY OF COUNTS OF
                          53         0956       
                                     0957  4200 					;VALID WSLE'S IN EACH PAGE TABLE
            0F            10     EE  0957  4300 	EXTV	#VA$V_VPN+7,#VA$S_VPN+1-7,R2,R2 ;BITS 16:30 OF VA SIGN EXTENDED
            52            52         095A       
                          05     18  095C  4400 	BGEQ	10$			;BRANCH IF P0 SPACE
            53       0000'CF     C0  095E  4500 	ADDL	W^SGN$GL_PTPAGCNT,R3	;END ADDRESS OF BYTE ARRAY
                          6342   97  0963  4600 10$:	DECB	(R3)[R2]		;ONE LESS VALID WSLE IN THIS PAGE TABLE
                          03     18  0966  4700 	BGEQ	20$			;BRANCH IF PT STILL HAS OTHER VALID WSLE'S
                       6E A5     B7  0968  4800 	DECW	PHD$W_PTCNTVAL(R5)	;ONE LESS PT WITH VALID WSLE'S
                                 05  096B  4900 20$:	RSB
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  43
X0425           ININEWPFN - ALLOCATE AND INIT A NEW PFN                                                                         (17)

                                     096C   100 	.SBTTL	ININEWPFN - ALLOCATE AND INIT A NEW PFN
                                     096C   200 ;++
                                     096C   300 ; FUNCTIONAL DESCRIPTION:
                                     096C   400 ;
                                     096C   500 ;	ALLOCATE A NEW PFN AND INITIALIZE THE PFN DATA BASE FOR IT
                                     096C   600 ; AND MAKE A WORKING SET LIST ENTRY.
                                     096C   700 ;
                                     096C   800 ; CALLING SEQUENCE:
                                     096C   900 ;
                                     096C  1000 ;	BSBW	MMG$ININEWPFN		;ALLOCATE AND INIT NEW PFN
                                     096C  1100 ;
                                     096C  1200 ; INPUT PARAMETERS:
                                     096C  1300 ;
                                     096C  1400 ;	R2 = FAULT VA (LOW BITS = PAGTYP)
                                     096C  1500 ;	R3 = SVAPTE (SLAVE IF GLOBAL)
                                     096C  1600 ;	R4 = PCB ADDRESS (PROCESS IF GLOBAL)
                                     096C  1700 ;	R5 = PROCESS HEADER ADDRESS (PROCESS IF GLOBAL)
                                     096C  1800 ;
                                     096C  1900 ; IMPLICIT INPUTS:
                                     096C  2000 ;
                                     096C  2100 ;	NONE
                                     096C  2200 ;
                                     096C  2300 ; OUTPUT PARAMETERS:
                                     096C  2400 ;
                                     096C  2500 ;	R0 = PFN, OR NEGATIVE IF NONE AVAILABLE
                                     096C  2800 ;
                                     096C  2900 ; IMPLICIT OUTPUTS:
                                     096C  3000 ;
                                     096C  3100 ;	NONE
                                     096C  3200 ;
                                     096C  3300 ; COMPLETION CODES:
                                     096C  3400 ;
                                     096C  3500 ;	NONE
                                     096C  3600 ;
                                     096C  3700 ; SIDE EFFECTS:
                                     096C  3800 ;
                                     096C  3900 ;	NONE
                                     096C  4000 ;
                                     096C  4100 ;--
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  44
X0425           ININEWPFN - ALLOCATE AND INIT A NEW PFN                                                                         (18)

                                     096C   100 ININEWPFNWAIT:
                          2C     BA  096C   200 	POPR	#^M<R2,R3,R5>		;RESTORE SAVED REGISTERS
                                 05  096E   300 	RSB				;AND RETURN NO FREE PAGES INDICATION
                                     096F   400 
                                     096F   500 MMG$ININEWPFN::
                          2C     BB  096F   600 	PUSHR	#^M<R2,R3,R5>		;SAVE PHD, SVAPTE, VA
                          F68C'  30  0971   700 	BSBW	MMG$ALLOCPFN		;ALLOCATE A NEW PFN
            50            1F     E0  0974   800 	BBS	#31,R0,ININEWPFNWAIT	;BRANCH IF NONE AVAILABLE
                          F4         0977       
            52            6E     7D  0978   900 	MOVQ	(SP),R2			;R2=VA, R3=SVAPTE
            03            01     EC  097B  1000 	CMPV	#WSL$V_PAGTYP,#WSL$S_PAGTYP,R2,#PFN$C_GLOBAL ;GLOBAL PAGE?
            02            52         097E       
                          10     19  0980  1100 	BLSS	40$			;BRANCH IF NOT
            16            00     EF  0982  1800 	EXTZV	#PTE$V_GPTX,#PTE$S_GPTX,(R3),R3 ;GLOBAL PAGE TABLE INDEX
            53            63         0985       
            53       0000'DF43   DE  0987  1900 	MOVAL	@W^MMG$GL_GPTBASE[R3],R3	;SVAPTE OF MASTER
            55       0000'DF     DE  098D  2000 	MOVAL	@W^MMG$GL_SYSPHD,R5	;SYSTEM PROCESS HEADER ADR FOR GLOBAL
            52            1F     E0  0992  2020 40$:	BBS	#VA$V_SYSTEM,R2,50$	;DON'T COUNT PT REF FOR SYSTEM PAGE
                          03         0995       
                          007E   30  0996  2060 	BSBW	MMG$INCPTREF		;LOCK PAGE TABLE ENTRY (NOT FOR SYSTEM)
       0000'DF40          53     D0  0999  2100 50$:	MOVL	R3,@W^PFN$AL_PTE[R0]	;STORE PTE ADDRESS
                                     099F  2120 	ASSUME	PFN$V_PAGTYP EQ 0
            52            1F     9C  099F  2150 	ROTL	#<32-WSL$V_PAGTYP>,R2,R2 ;POSITION PAGE TYPE FIELD
                          52         09A2       
            52         F8 8F     8B  09A3  2200 	BICB3	#^C<PFN$M_PAGTYP>,R2,@W^PFN$AB_TYPE[R0] ;SET PAGE TYPE
                     0000'DF40       09A7       
                          2C     BA  09AB  2400 	POPR	#^M<R2,R3,R5>		;R2=VA, R3=SVAPTE, R5=PHD
                                     09AD  2500 ;
                                     09AD  2600 ; FALL THROUGH TO MMG$MAKEWSLE
                                     09AD  2700 ;
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  45
X0425           MAKEWSLE - MAKE A WORKING SET LIST ENTRY                                                                        (19)

                                     09AD   100 	.SBTTL	MAKEWSLE - MAKE A WORKING SET LIST ENTRY
                                     09AD   200 ;++
                                     09AD   300 ; FUNCTIONAL DESCRIPTION:
                                     09AD   400 ;
                                     09AD   500 ;	THIS ROUTINE ENTERS SPECIFIED VIRTUAL ADDRESS INTO THE WORKING
                                     09AD   600 ; SET LIST.  IT ASSUMES THAT THERE IS A FREE WORKING SET LIST ENTRY ON THE
                                     09AD   700 ; FREE LIST.  IF THE PAGE IS A GLOBAL PAGE THE SLAVE PAGE TABLE ENTRY IS
                                     09AD   800 ; LOCKED AT THIS TIME AND THE SHRCNT AND/OR REFCNT IS INCREMENTED.
                                     09AD   900 ; THIS ROUTINE ALSO KEEPS THE ACTIVE PAGE COUNTERS IN THE PCB (PPGCNT, GPGCNT).
                                     09AD  1000 ;
                                     09AD  1100 ;
                                     09AD  1200 ; CALLING SEQUENCE:
                                     09AD  1300 ;
                                     09AD  1400 ;	BSBW	MMG$MAKEWSLE
                                     09AD  1500 ;
                                     09AD  1600 ; INPUT PARAMETERS:
                                     09AD  1700 ;
                                     09AD  1800 ;	R0 = PAGE FRAME NUMBER
                                     09AD  1900 ;	R2 = VA (LOW BITS = PAGTYP)
                                     09AD  2000 ;	R3 = SVAPTE (SLAVE IF GLOBAL)
                                     09AD  2100 ;	R4 = PCB ADDRESS (PROCESS IF GLOBAL)
                                     09AD  2200 ;	R5 = PHD ADDRESS (PROCESS IF GLOBAL)
                                     09AD  2300 ;
                                     09AD  2400 ; IMPLICIT INPUTS:
                                     09AD  2500 ;
                                     09AD  2600 ;	FREE WORKING SET LIST CONTAINS AT LEAST ONE ENTRY
                                     09AD  2700 ;
                                     09AD  2800 ; OUTPUT PARAMETERS:
                                     09AD  2900 ;
                                     09AD  3000 ;	R0 = PFN PRESERVED
                                     09AD  3300 ;
                                     09AD  3400 ; IMPLICIT OUTPUTS:
                                     09AD  3500 ;
                                     09AD  3600 ;	NONE
                                     09AD  3700 ;
                                     09AD  3800 ; COMPLETION CODES:
                                     09AD  3900 ;
                                     09AD  4000 ;	NONE
                                     09AD  4100 ;
                                     09AD  4200 ; SIDE EFFECTS:
                                     09AD  4300 ;
                                     09AD  4400 ;	NONE
                                     09AD  4500 ;
                                     09AD  4600 ;--
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  46
X0425           MAKEWSLE - MAKE A WORKING SET LIST ENTRY                                                                        (20)

                                     09AD   100 MMG$MAKEWSLE::
            51         10 A5     3C  09AD   110 	MOVZWL	PHD$W_WSNEXT(R5),R1	;WSLX FOR FREE ENTRY
                                     09B1   120 
                                     09B1   130 	ASSUME	WSL$V_VALID EQ 0
            1A            6541   E8  09B1   140 	BLBS	(R5)[R1],20$		;BRANCH IF ENTRY BUSY, ERROR
            52            01     C9  09B5   150 	BISL3	#WSL$M_VALID,R2,(R5)[R1] ;STORE NEW WSLE
                          6541       09B8       
                                     09BA   160 
            03            01     EF  09BA   200 	EXTZV	#WSL$V_PAGTYP,#WSL$S_PAGTYP,R2,R1 ;EXTRACT THE PAGE TYPE
            51            52         09BD       
                                     09BF   300 	CASE	R1,<-			;AND DISPATCH ON IT
                                     09BF   400 		50$,-			;PROCESS PAGE
                                     09BF   500 		70$,-			;SYSTEM PAGE
                                     09BF   600 		30$,-			;GLOBAL READ ONLY
                                     09BF   700 		30$,-			;GLOBAL WRITABLE
                                     09BF   800 		70$,-			;PROCESS PAGE TABLE
                                     09BF   900 		70$  >			;GLOBAL PAGE TABLE
            00            51     AF  09BF       	CASEW	R1,#0,S^#<<30007$-30006$>/2>-1
                          05'        09C2       
                                     09C3       30006$:
                               0022' 09C3       	.WORD	50$-30006$
                               0024' 09C5       	.WORD	70$-30006$
                               0010' 09C7       	.WORD	30$-30006$
                               0010' 09C9       	.WORD	30$-30006$
                               0024' 09CB       	.WORD	70$-30006$
                               0024' 09CD       	.WORD	70$-30006$
                                     09CF       30007$:
                                     09CF  1000 20$:	BUG_CHECK MAKEWSLE,FATAL	;BAD PAGE TYPE OR 
                               FEFF  09CF       		.WORD	^XFEFF
                               0004' 09D1       		.IIF IDN <FATAL>,<FATAL> , .WORD	BUG$_MAKEWSLE!4
                                     09D3  1100 					;WSNEXT POINTS TO VALID WSLE
                                     09D3  1200 ;
                                     09D3  1300 ; GLOBAL PAGE, READ ONLY OR WRITABLE
                                     09D3  1400 ;
                          42     10  09D3  1500 30$:	BSBB	MMG$INCPTREF		;LOCK THE SLAVE PAGE TABLE ENTRY
                          20     10  09D5  1550 	BSBB	INCVALWSLECNT		;INC VALID WORKING SET LIST ENTRY COUNT
                       38 A4     B6  09D7  1600 	INCW	PCB$W_GPGCNT(R4)	;ANOTHER GLOBAL PAGE IN WORKING SET LIST
            01            01     3D  09DA  1700 	ACBW	#1,#1,@W^PFN$AW_SHRCNT[R0],80$ ;COUNT SHARER, BRANCH IF FIRST
            000E     0000'DF40       09DD       
                          11     11  09E3  1800 	BRB	90$
                                     09E5  2400 ;
                                     09E5  2500 ; PROCESS PAGE
                                     09E5  2600 ;
                          10     10  09E5  2700 50$:	BSBB	INCVALWSLECNT		;INC VALID WORKING SET LIST ENTRY COUNT
                       3A A4     B6  09E7  3500 70$:	INCW	PCB$W_PPGCNT(R4)	;ONE MORE ACTIVE PROCESS PAGE IN WSL
       0000'DF40       10 A5     B0  09EA  3600 	MOVW	PHD$W_WSNEXT(R5),@W^PFN$AW_WSLX[R0] ;SET INDEX TO WSLE
                                     09F1  3700 					;ONLY FOR PRIVATE PAGES
                                     09F1  3800 
                     0000'DF40   B6  09F1  3900 80$:	INCW	@W^PFN$AW_REFCNT[R0]	;ANOTHER REFERENCE FOR THE PAGE
                                 05  09F6  4500 90$:	RSB
                                     09F7  4520 
                                     09F7  4540 INCVALWSLECNT:
            55         68 A5     C1  09F7  4600 	ADDL3	PHD$L_PTWSLEVAL(R5),R5,R3 ;BASE ADR OF BYTE ARRAY OF COUNTS OF
                          53         09FB       
                                     09FC  4700 					;VALID WSLE'S IN EACH PAGE TABLE
            0F            10     EE  09FC  4800 	EXTV	#VA$V_VPN+7,#VA$S_VPN+1-7,R2,R2 ;BITS 16:30 OF VA SIGN EXTENDED
            52            52         09FF       
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  47
X0425           MAKEWSLE - MAKE A WORKING SET LIST ENTRY                                                                        (20)

                          05     18  0A01  4900 	BGEQ	10$			;BRANCH IF P0 SPACE
            53       0000'CF     C0  0A03  5000 	ADDL	W^SGN$GL_PTPAGCNT,R3	;BASE ADR TO NEGATIVE INDEX FROM
                          6342   96  0A08  5100 10$:	INCB	(R3)[R2]		;ANOTHER VALID WSLE IN THIS PAGE TABLE
                          03     14  0A0B  5200 	BGTR	20$			;BRANCH IF NOT THE FIRST
                       6E A5     B6  0A0D  5300 	INCW	PHD$W_PTCNTVAL(R5)	;ANOTHER PAGE TABLE WITH VALID WSLE'S
                                 05  0A10  5400 20$:	RSB
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  48
X0425           LOCKPGTB - LOCK PAGE TABLE                                                                                      (21)

                                     0A11   100 	.SBTTL	LOCKPGTB - LOCK PAGE TABLE
                                     0A11   200 ;++
                                     0A11   300 ; FUNCTIONAL DESCRIPTION:
                                     0A11   400 ;
                                     0A11   410 ;	LOCKPGTB TAKES A VIRTUAL ADDRESS, REFERENCES AND
                                     0A11   420 ;	LOCKS THE ASSOCIATED PAGE TABLE, AND RETURNS THE SYSTEM
                                     0A11   430 ;	VIRTUAL ADDRESS OF THE PAGE TABLE ENTRY.  IT IS CALLED
                                     0A11   440 ;	WITH IPL = ASTDEL OR LOWER AND RETURNS WITH IPL = SYNCH.
                                     0A11   500 ;
                                     0A11   600 ; CALLING SEQUENCE:
                                     0A11   700 ;
                                     0A11   800 ;	BSBW	MMG$LOCKPGTB
                                     0A11   900 ;
                                     0A11  1000 ; INPUT PARAMETERS:
                                     0A11  1100 ;
                                     0A11  1200 ;	R2 = VIRTUAL ADDRESS
                                     0A11  1210 ;	R4 = PROCESS CONTROL BLOCK ADDRESS
                                     0A11  1220 ;	R5 = PROCESS HEADER ADDRESS (P1 SPACE IF PROCESS PCB,
                                     0A11  1230 ;		SYSTEM SPACE OF SYSTEM PCB)
                                     0A11  1240 ;	IPL = ASTDEL OR LOWER
                                     0A11  1300 ;
                                     0A11  1400 ; IMPLICIT INPUTS:
                                     0A11  1500 ;
                                     0A11  1600 ;	NONE
                                     0A11  1700 ;
                                     0A11  1800 ; OUTPUT PARAMETERS:
                                     0A11  1900 ;
                                     0A11  2000 ;	R2 PRESERVED
                                     0A11  2010 ;	R3 = SYSTEM VIRTUAL ADDRESS OF PAGE TABLE ENTRY
                                     0A11  2020 ;	IPL = SYNCH
                                     0A11  2100 ;
                                     0A11  2200 ; IMPLICIT OUTPUTS:
                                     0A11  2300 ;
                                     0A11  2400 ;	PAGE TABLE LOCKED VIA INCPTREF
                                     0A11  2500 ;
                                     0A11  2600 ; COMPLETION CODES:
                                     0A11  2700 ;
                                     0A11  2800 ;	NONE
                                     0A11  2900 ;
                                     0A11  3000 ; SIDE EFFECTS:
                                     0A11  3100 ;
                                     0A11  3200 ;	NONE
                                     0A11  3300 ;
                                     0A11  3400 ;--
                                     0A11  3500 
                                     0A11  3600 MMG$LOCKPGTB::
                          F5EC'  30  0A11  3700 	BSBW	MMG$PTEREF		;REFERENCE PTE, GET SVAPTE
                                     0A14  3800 					;RETURNS AT IPL=SYNCH
            3A            50     E9  0A14  3900 	BLBC	R0,INCPTREFBUG		;BRANCH IF LENGTH VIOLATION
                                     0A17  4000 ;
                                     0A17  4100 ; FALL THROUGH TO MMG$INCPTREF
                                     0A17  4200 ;
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  49
X0425           INCPTREF - INCREMENT PAGE TABLE REFERENCE COUNT                                                                 (22)

                                     0A17   100 	.SBTTL	INCPTREF - INCREMENT PAGE TABLE REFERENCE COUNT
                                     0A17   200 ;++
                                     0A17   300 ; FUNCTIONAL DESCRIPTION:
                                     0A17   400 ;
                                     0A17   500 ;	THIS ROUTINE ACCEPTS THE ADDRESS OF A PAGE TABLE ENTRY AND
                                     0A17   600 ; LOCKS THE ASSOCIATED PAGE TABLE INTO MEMORY.  IT ALSO MAINTAINS THE
                                     0A17   700 ; COUNT OF SUCH LOCKED PAGE TABLES IN THE PROCESS HEADER VECTOR.
                                     0A17   800 ;
                                     0A17   900 ; CALLING SEQUENCE:
                                     0A17  1000 ;
                                     0A17  1100 ;	BSBW	MMG$INCPTREF
                                     0A17  1200 ;
                                     0A17  1300 ; INPUT PARAMETERS:
                                     0A17  1400 ;
                                     0A17  1500 ;	R3 = SYSTEM VIRTUAL ADDRESS OF PAGE TABLE ENTRY (MASTER IF GLOBAL)
                                     0A17  1600 ;	R5 = PROCESS HEADER ADDRESS (SYSTEM IF GLOBAL)
                                     0A17  1700 ;
                                     0A17  1800 ; IMPLICIT INPUTS:
                                     0A17  1900 ;
                                     0A17  2000 ;	NONE
                                     0A17  2100 ;
                                     0A17  2200 ; OUTPUT PARAMETERS:
                                     0A17  2300 ;
                                     0A17  2400 ;	R0,R2,R3 PRESERVED
                                     0A17  2500 ;
                                     0A17  2600 ; IMPLICIT OUTPUTS:
                                     0A17  2700 ;
                                     0A17  2800 ;	NONE
                                     0A17  2900 ;
                                     0A17  3000 ; COMPLETION CODES:
                                     0A17  3100 ;
                                     0A17  3200 ;	NONE
                                     0A17  3300 ;
                                     0A17  3400 ; SIDE EFFECTS:
                                     0A17  3500 ;
                                     0A17  3600 ;	NONE
                                     0A17  3700 ;
                                     0A17  3800 ;--
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  50
X0425           INCPTREF - INCREMENT PAGE TABLE REFERENCE COUNT                                                                 (23)

                                     0A17   100 MMG$INCPTREF::
            15            09     EF  0A17   200 	EXTZV	#VA$V_VPN,#VA$S_VPN,R3,R1 ;GET PAGE NUMBER OF PT CONTAINING THIS PTE
            51            53         0A1A       
                                     0A1C   300 ;
                                     0A1C   400 ; ***** WARNING ***** THE FOLLOWING DEPENDS ON GPTBASE = SPTBASE
                                     0A1C   500 ;
            51       0000'DF41   D0  0A1C   600 	MOVL	@W^MMG$GL_SPTBASE[R1],R1	;PTE FOR PAGE TABLE
                          2D     18  0A22   700 	BGEQ	20$			;DISASTER IF NOT VALID
            15            00     EF  0A24   800 	EXTZV	#PTE$V_PFN,#PTE$S_PFN,R1,R1 ;PAGE FRAME NUMBER
            51            51         0A27       
       0000'CF            51     D1  0A29   850 	CMPL	R1,W^MMG$GL_MAXPFN	; IS THERE PFN DATABASE?
                          09     14  0A2E   875 	BGTR	5$			; NO, SKIP INCREMENT
            01            01     3D  0A30   900 	ACBW	#1,#1,@W^PFN$AW_SHRCNT[R1],10$ ;INC SHRCNT, BRANCH IF FIRST PTE
            0001     0000'DF41       0A33       
                                 05  0A39  1000 5$:	RSB
                                     0A3A  1010 ;
                                     0A3A  1020 ; SHARE COUNT JUST WENT FROM 0 TO 1 INDICATING THAT THE FIRST ACTIVE
                                     0A3A  1030 ; PAGE TABLE ENTRY WAS JUST PLACED IN THE PAGE TABLE
                                     0A3A  1070 ;
                                     0A3A  1080 ; ASSUMPTION HERE IS THAT THIS ROUTINE IS NOT CALLED FOR SYSTEM PAGE TABLES
                                     0A3A  1090 ; THIS IS EITHER A PROCESS OR GLOBAL PAGE TABLE.
                                     0A3A  1100 ;
            51       0000'DF41   3C  0A3A  1110 10$:	MOVZWL	@W^PFN$AW_WSLX[R1],R1	;WORKING SET LIST INDEX
            6541          20     C8  0A40  1120 	BISL	#WSL$M_WSLOCK,(R5)[R1]	;SET WORKING SET LOCKDOWN BIT
                       70 A5     B6  0A44  1130 	INCW	PHD$W_PTCNTACT(R5)	;ANOTHER ACTIVE PAGE TABLE
            51         46 A5     3C  0A47  1190 	MOVZWL	PHD$W_PHVINDEX(R5),R1	;PROCESS HEADER VECTOR INDEX
                     0000'DF41   B6  0A4B  1200 	INCW	@W^PHV$GL_REFCBAS[R1]	;COUNT ANOTHER PAGE TABLE LOCKED
                                 05  0A50  1300 	RSB
                                     0A51  1400 ;
                                     0A51  1500 ; PAGE TABLE PAGE WAS NOT VALID
                                     0A51  1600 ;
                                     0A51  1700 20$:
                                     0A51  1800 INCPTREFBUG:
                                     0A51  1900 	BUG_CHECK INCPTREF,FATAL	;PAGE TABLE NOT VALID
                               FEFF  0A51       		.WORD	^XFEFF
                               0004' 0A53       		.IIF IDN <FATAL>,<FATAL> , .WORD	BUG$_INCPTREF!4
                                     0A55  2000 					;LENGTH VIOLATION FROM LOCKPGTB
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  51
X0425           DECPTREF - DECREMENT PAGE TABLE REFERENCE COUNT                                                                 (24)

                                     0A55   100 	.SBTTL	DECPTREF - DECREMENT PAGE TABLE REFERENCE COUNT
                                     0A55   200 ;++
                                     0A55   300 ; FUNCTIONAL DESCRIPTION:
                                     0A55   400 ;
                                     0A55   500 ;	THIS ROUTINE DECREMENTS THE REFERENCE COUNT FOR THE PAGE TABLE
                                     0A55   600 ; CONTAINING THE PAGE TABLE ENTRY ADDRESSED BY R3.  IF THE RESULTING REFERENCE
                                     0A55   700 ; COUNT INDICATES THAT NO MORE PAGE TABLE ENTRIES ARE IN USE, THE PROCESS
                                     0A55   800 ; HEADER VECTOR REFERENCE COUNT IS DECREMENTED AS WELL INDICATING A
                                     0A55   900 ; FREE PAGE TABLE
                                     0A55  1000 ;
                                     0A55  1100 ; CALLING SEQUENCE:
                                     0A55  1200 ;
                                     0A55  1300 ;	BSBW	MMG$DECPTREF
                                     0A55  1400 ;
                                     0A55  1500 ; INPUT PARAMETERS:
                                     0A55  1600 ;
                                     0A55  1700 ;	R3 = SYSTEM VIRTUAL ADDRESS OF PAGE TABLE ENTRY
                                     0A55  1800 ;
                                     0A55  1900 ; IMPLICIT INPUTS:
                                     0A55  2000 ;
                                     0A55  2100 ;	NONE
                                     0A55  2200 ;
                                     0A55  2300 ; OUTPUT PARAMETERS:
                                     0A55  2400 ;
                                     0A55  2500 ;	R0,R2,R3 PRESERVED
                                     0A55  2600 ;
                                     0A55  2700 ; IMPLICIT OUTPUTS:
                                     0A55  2800 ;
                                     0A55  2900 ;	NONE
                                     0A55  3000 ;
                                     0A55  3100 ; COMPLETION CODES:
                                     0A55  3200 ;
                                     0A55  3300 ;	NONE
                                     0A55  3400 ;
                                     0A55  3500 ; SIDE EFFECTS:
                                     0A55  3600 ;
                                     0A55  3700 ;	NONE
                                     0A55  3800 ;
                                     0A55  3900 ;--
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  52
X0425           DECPTREF - DECREMENT PAGE TABLE REFERENCE COUNT                                                                 (25)

                                     0A55  4000 MMG$DECPTREF::
            15            09     EF  0A55  4100 	EXTZV	#VA$V_VPN,#VA$S_VPN,R3,R1 ;INDEX TO SPT ENTRY FOR PAGE TABLE
            51            53         0A58       
            51       0000'DF41   D0  0A5A  4200 	MOVL	@W^MMG$GL_SPTBASE[R1],R1	;PTE FOR PAGE TABLE
                          56     18  0A60  4300 	BGEQ	40$			;BRANCH IF NOT VALID, ERROR
            15            00     EF  0A62  4400 	EXTZV	#PTE$V_PFN,#PTE$S_PFN,R1,R1 ;PAGE FRAME NUMBER FOR PAGE TABLE
            51            51         0A65       
       0000'CF            51     D1  0A67  4405 	CMPL	R1,W^MMG$GL_MAXPFN	;IS THERE PFN DATA BASE FOR THIS PAGE?
                          49     14  0A6C  4410 	BGTR	20$			;NO, SKIP DECREMENT
                                     0A6E  4500 	DECSHR	PFN=R1,GTR=20$		;ONE LESS ACTIVE PTE IN THIS PT
                     0000'DF41   B7  0A6E       		DECW	@W^PFN$AW_SHRCNT[R1]
                          42     14  0A73       		BGTR	20$
                          03     18  0A75       		BGEQ	30008$
                          F586'  30  0A77       		BSBW	MMG$SHRCNTNEG
                                     0A7A       30008$:
                                     0A7A  4600 ;
                                     0A7A  4700 ; SHARE COUNT JUST WENT TO 0, THIS PAGE TABLE IS NO LONGER REQUIRED
                                     0A7A  4800 ; TO REMAIN RESIDENT
                                     0A7A  4850 ; R1 = PFN FOR PAGE TABLE PAGE
                                     0A7A  4900 ;
                          50     DD  0A7A  4920 	PUSHL	R0			;SAVE THIS REGISTER
            50       0000'DF41   3C  0A7C  4940 	MOVZWL	@W^PFN$AW_WSLX[R1],R0	;USE IT TO HOLD THE WORKING SET LIST INDEX
            51       0000'DF     DE  0A82  4950 	MOVAL	@W^MMG$GL_SYSPHD,R1	;ADDRESS OF SYSTEM HEADER
            51            53     D1  0A87  4960 	CMPL	R3,R1			;PTE ADR IN SYSTEM HEADER?
                          20     1E  0A8A  4980 	BGEQU	10$			;BRANCH IF YES, GLOBAL PAGE TABLE
            53       0000'CF     C3  0A8C  5000 	SUBL3	W^SWP$GL_BALBASE,R3,R1	;ADR RELATIVE TO BEGIN OF BAL SET
                          51         0A91       
            51       0000'CF     C6  0A92  5020 	DIVL	W^SWP$GL_BSLOTSZ,R1	;PROCESS HEADER INDEX
            51         F7 8F     78  0A97  5030 	ASHL	#-9,R1,R1		;DIVIDE BY PAGE SIZE
                          51         0A9B       
                          22     10  0A9C  5040 	BSBB	MMG$DECPHDREF1		;DECREMENT PROCESS HEADER REFERENCE COUNT
            51       0000'CF     C4  0A9E  5060 	MULL	W^SWP$GL_BSLOTSZ,R1	;CONVERT PROCESS HEADER INDEX
            51            09     9C  0AA3  5070 	ROTL	#9,R1,R1		;MULL BY PAGE SIZE
                          51         0AA6       
            51       0000'CF     C0  0AA7  5080 	ADDL	W^SWP$GL_BALBASE,R1	;TO PROCESS HEADER ADDRESS
            6140          20     CA  0AAC  5100 10$:	BICL	#WSL$M_WSLOCK,(R1)[R0]	;SHUT OFF WORKING SET LOCK
                       70 A1     B7  0AB0  5110 	DECW	PHD$W_PTCNTACT(R1)	;ONE LESS ACTIVE PAGE TABLE
                          03     19  0AB3  5115 	BLSS	40$			;BRANCH IF ERROR
                          01     BA  0AB5  5120 	POPR	#^M<R0>			;RESTORE SAVED REGISTER
                                 05  0AB7  5140 20$:	RSB				;AND RETURN
                                     0AB8  6000 ;
                                     0AB8  6100 ; PAGE TABLE PTE NOT VALID, OR PAGE TABLE REFERENCE COUNT IS BAD
                                     0AB8  6150 ; OR PTCNTACT WENT NEGATIVE
                                     0AB8  6200 ;
                                     0AB8  6300 40$:	BUG_CHECK DECPTREF,FATAL	;ERROR IN DECPTREF
                               FEFF  0AB8       		.WORD	^XFEFF
                               0004' 0ABA       		.IIF IDN <FATAL>,<FATAL> , .WORD	BUG$_DECPTREF!4
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  53
X0425           DECPHDREF - DECREMENT PROCESS HEADER REFERENCE                                                                  (26)

                                     0ABC   100 	.SBTTL	DECPHDREF - DECREMENT PROCESS HEADER REFERENCE COUNT
                                     0ABC   200 ;++
                                     0ABC   300 ; FUNCTIONAL DESCRIPTION:
                                     0ABC   400 ;
                                     0ABC   410 ;	DECPHDREF REDUCES THE PROCESS HEADER REFERENCE COUNT AND INFORMS
                                     0ABC   420 ;	THE SWAPPER IF THE COUNT GOES TO ZERO.  THIS COUNT IS RAISED ONCE
                                     0ABC   430 ;	FOR EACH REASON THAT A GIVEN SPT ENTRY IS BUSY NOT COUNTING THE
                                     0ABC   440 ;	WORKING SET LIST ENTRY REFERENCE.  THE FOLLOWING ARE REASONS WHY
                                     0ABC   450 ;	THE REFERENCE COUNT IS INCREASED FOR A GIVEN PAGE TABLE PAGE.
                                     0ABC   460 ;		1. PLACED ON THE FREE OR MODIFIED LIST
                                     0ABC   470 ;		2. READ OR WRITE IN PROGRESS
                                     0ABC   480 ;		3. SHARE COUNT IS ABOVE 0, I.E. IT CONTAINS ACTIVE PTE'S
                                     0ABC   490 ;	THE REFERENCE COUNT IS DECREASED UNDER THE FOLLOWING CONDITIONS:
                                     0ABC   500 ;		1. SHARE COUNT DECREASED FROM 1 TO 0, I.E. LAST PTE GONE
                                     0ABC   510 ;		2. READ OR WRITE COMPLETE
                                     0ABC   520 ;		3. PAGE CONTENTS DELETED (DELCONPFN)
                                     0ABC   530 ;		4. FAULTED OUT OF TRANSITION STATE
                                     0ABC   540 ;
                                     0ABC   600 ; CALLING SEQUENCE:
                                     0ABC   700 ;
                                     0ABC   800 ;	BSBW	MMG$DECPHDREF		;R5 = PROCESS HEADER ADDRESS
                                     0ABC   850 ;	BSBW	MMG$DECPHDREF1		;R1 = PROCESS HEADER VECTOR INDEX
                                     0ABC   900 ;
                                     0ABC  1000 ; INPUT PARAMETERS:
                                     0ABC  1100 ;
                                     0ABC  1180 ;	DECPHDREF
                                     0ABC  1200 ;		R5 = PROCESS HEADER ADDRESS FOR PAGE TABLE PAGE
                                     0ABC  1220 ;
                                     0ABC  1240 ;	DECPHDREF1
                                     0ABC  1260 ;		R1 = PROCESS HEADER VECTOR INDEX
                                     0ABC  1280 ;
                                     0ABC  1400 ; IMPLICIT INPUTS:
                                     0ABC  1500 ;
                                     0ABC  1600 ;	NONE
                                     0ABC  1700 ;
                                     0ABC  1800 ; OUTPUT PARAMETERS:
                                     0ABC  1900 ;
                                     0ABC  1980 ;	DECPHDREF
                                     0ABC  2000 ;		ONLY R1 ALTERED
                                     0ABC  2020 ;
                                     0ABC  2040 ;	DECPHDREF1
                                     0ABC  2060 ;		ALL REGISTERS PRESERVED
                                     0ABC  2080 ;
                                     0ABC  2200 ; IMPLICIT OUTPUTS:
                                     0ABC  2300 ;
                                     0ABC  2400 ;	NONE
                                     0ABC  2500 ;
                                     0ABC  2600 ; COMPLETION CODES:
                                     0ABC  2700 ;
                                     0ABC  2800 ;	NONE
                                     0ABC  2900 ;
                                     0ABC  3000 ; SIDE EFFECTS:
                                     0ABC  3100 ;
                                     0ABC  3200 ;	NONE
                                     0ABC  3300 ;
                                     0ABC  3400 ;--
                                     0ABC  3500 
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  54
X0425           DECPHDREF - DECREMENT PROCESS HEADER REFERENCE                                                                  (26)

                                     0ABC  3600 MMG$DECPHDREF::
            51         46 A5     3C  0ABC  3700 	MOVZWL	PHD$W_PHVINDEX(R5),R1	;PROCESS HEADER VECTOR INDEX
                                     0AC0  3750 MMG$DECPHDREF1::
                     0000'DF41   B7  0AC0  3800 	DECW	@W^PHV$GL_REFCBAS[R1]	;COUNT ONE LESS REFERENCE
                          01     13  0AC5  3900 	BEQL	10$			;BRANCH IF THAT WAS THE LAST REFERENCE
                                 05  0AC7  3920 	RSB
                          F535'  31  0AC8  4000 10$:	BRW	SCH$SWPWAKE		;INFORM THE SWAPPER, HEADER MAY GO
                                     0ACB  4100 					;AND RETURN TO THIS ROUTINE'S CALLER
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  55
X0425           INIBLDPKT - INIT FOR CALLING BUILDPKT                                                                           (27)

                                     0ACB   100 	.SBTTL	INIBLDPKT - INIT FOR CALLING BUILDPKT
                                     0ACB   200 ;++
                                     0ACB   300 ; FUNCTIONAL DESCRIPTION:
                                     0ACB   400 ;
                                     0ACB   500 ;	THIS ROUTINE SETS UP R0-R2 FOR A SINGLE PAGE READ/WRITE
                                     0ACB   600 ; TO THE ADDRESS SPECIFIED BY THE BACKING STORE ADDRESS.
                                     0ACB   700 ;
                                     0ACB   800 ; CALLING SEQUENCE:
                                     0ACB   900 ;
                                     0ACB  1000 ;	BSBW	MMG$INIBLDPKT
                                     0ACB  1100 ;
                                     0ACB  1200 ; INPUT PARAMETERS:
                                     0ACB  1300 ;
                                     0ACB  1400 ;	R2 = BACKING STORE ADDRESS
                                     0ACB  1500 ;	R3 = PAGE TABLE ENTRY ADDRESS (MASTER IF GLOBAL)
                                     0ACB  1600 ;	R5 = PROCESS HEADER ADDRESS (SYSTEM HEADER IF GLOBAL PAGE)
                                     0ACB  1610 ;		THIS IS ONLY USED FOR SECTION TYPE BACKING STORE ADDRESSES
                                     0ACB  1620 ;		IF THE BACKING STORE ADDRESS IN R2 IS KNOWN TO BE A 
                                     0ACB  1630 ;		PAGING FILE ADDRESS, THEN IT SELF DESCRIBES AND THIS
                                     0ACB  1640 ;		PARAMETER IS IGNORED.
                                     0ACB  1700 ;
                                     0ACB  1800 ; IMPLICIT INPUTS:
                                     0ACB  1900 ;
                                     0ACB  2000 ;	NONE
                                     0ACB  2100 ;
                                     0ACB  2200 ; OUTPUT PARAMETERS:
                                     0ACB  2300 ;
                                     0ACB  2400 ;	R0 = VIRTUAL BLOCK NUMBER
                                     0ACB  2450 ;	R1 = SECTION OR PAGE FILE CONTROL BLOCK ADDRESS
                                     0ACB  2500 ;	R2 = WINDOW ADDRESS
                                     0ACB  2550 ;	R3 = PAGE TABLE ENTRY ADDRESS (PRESERVED)
                                     0ACB  2900 ;
                                     0ACB  3000 ; IMPLICIT OUTPUTS:
                                     0ACB  3100 ;
                                     0ACB  3200 ;	NONE
                                     0ACB  3300 ;
                                     0ACB  3400 ; COMPLETION CODES:
                                     0ACB  3500 ;
                                     0ACB  3600 ;	NONE
                                     0ACB  3700 ;
                                     0ACB  3800 ; SIDE EFFECTS:
                                     0ACB  3900 ;
                                     0ACB  4000 ;	NONE
                                     0ACB  4100 ;
                                     0ACB  4200 ;--
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  56
X0425           INIBLDPKT - INIT FOR CALLING BUILDPKT                                                                           (28)

                                     0ACB   100 MMG$INIBLDPKT::
            52            17     E0  0ACB   300 	BBS	#PFN$V_GBLBAK,R2,10$	;NOT AN I/O ADDRESS IF GBL BAK
                          16         0ACE       
            52            16     E0  0ACF   400 	BBS	#PTE$V_TYP0,R2,20$	;BRANCH IF SECTION ADDRESS
                          16         0AD2       
            08            18     EF  0AD3   500 	EXTZV	#PFN$V_PGFLX,#PFN$S_PGFLX,R2,R1 ;PAGE FILE INDEX
            51            52         0AD6       
            51       0000'DF41   D0  0AD8   600 	MOVL	@W^MMG$GL_PAGSWPVC[R1],R1 ;PAGE FILE CONTROL BLOCK ADDRESS
            16            00     EF  0ADE   800 	EXTZV	#PTE$V_PGFLVB,#PTE$S_PGFLVB,R2,R0 ;PAGE FILE VBN
            50            52         0AE1       
                          24     12  0AE3   900 	BNEQ	40$			;BRANCH IF GOOD VBN
                                     0AE5  1000 ;
                                     0AE5  1100 ; INVALID BACKING STORE ADDRESS FOR I/O
                                     0AE5  1200 ;
                                     0AE5  1300 10$:	BUG_CHECK IVBAKADIO,FATAL	;INVALID BACKING STORE ADR FOR I/O
                               FEFF  0AE5       		.WORD	^XFEFF
                               0004' 0AE7       		.IIF IDN <FATAL>,<FATAL> , .WORD	BUG$_IVBAKADIO!4
                                     0AE9  1400 ;
                                     0AE9  1500 ; SECTION TABLE BACKING STORE ADDRESS
                                     0AE9  1600 ;
            52            52     32  0AE9  1700 20$:	CVTWL	R2,R2			;SECTION TABLE INDEX
            55         20 A5     C1  0AEC  1750 	ADDL3	PHD$L_PSTBASOFF(R5),R5,R1 ;SECTION TABLE BASE ADDRESS
                          51         0AF0       
            51            6142   DE  0AF1  1800 	MOVAL	(R1)[R2],R1		;SECTION TABLE ENTRY ADDRESS
            53       00C8 C5     C3  0AF5  1900 	SUBL3	PHD$L_P0BR(R5),R3,R0	;BYTE OFFSET FROM BASE OF PAGE TABLE
                          50         0AFA       
            50         FE 8F     78  0AFB  2000 	ASHL	#-2,R0,R0		;LONG WORD INDEX FROM PAGTBL BASE
                          50         0AFF       
            16            00     EF  0B00  2100 	EXTZV	#SEC$V_VPX,#SEC$S_VPX,SEC$L_VPXPFC(R1),R2 ;VIRTUAL PAGE NUMBER
            52         08 A1         0B03       
            50            52     C2  0B06  2200 	SUBL	R2,R0			;RELATIVE PAGE IN SECTION
                                     0B09  2300 40$:
                                     0B09  2400 	ASSUME	SEC$L_VBN EQ PFL$L_VBN
                                     0B09  2500 	ASSUME	SEC$L_WINDOW EQ PFL$L_WINDOW
            50         10 A1     C0  0B09  2600 	ADDL	SEC$L_VBN(R1),R0	;FORM FILE VBN
            52         0C A1     D0  0B0D  2700 	MOVL	SEC$L_WINDOW(R1),R2	;FILE WINDOW
                                 05  0B11  3000 	RSB
                                     0B12  3100 
                                     0B12  3200 
                                     0B12  3300 	.END
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  57
SYMBOL TABLE                                                                                                                    (28)

ACVIOLAT         000006A6 R     04   FREEPAGEWAIT     00000365 R     04   IRP$L_DIAGBUF    00000044            
AST              00000010            FREEPAGEWAIT1    00000386 R     04   IRP$L_IOQBL      00000004            
ASTPRM           00000014            FREPAGWAIT_5     000001BF R     04   IRP$L_IOQFL      00000000            
BADSYSPAG        00000004 R     04   FRE_ALLOCPGFL    000008EE R     04   IRP$L_IOSB       00000024            
BAK              00000024            FRE_ALLOCPGFL1   0000081A R     04   IRP$L_IOST1      00000034            
BIT...         = 00000003            FRE_EMPTY        000007A0 R     04   IRP$L_IOST2      00000038            
BUG$_BADLCKWSLE  ********   X   04   FRE_FIRSTWSLE    000007CD R     04   IRP$L_MEDIA      00000034            
BUG$_DECPTREF    ********   X   04   FRE_FREWSLE1     000007F7 R     04   IRP$L_PID        0000000C            
BUG$_DELWSLEX    ********   X   04   FRE_GBLTRANS     0000079C R     04   IRP$L_SEGVBN     00000040            
BUG$_FREWSLX     ********   X   04   FRE_GBLTRANS1    0000075D R     04   IRP$L_SEQNUM     00000048            
BUG$_GPGNULPGFL  ********   X   04   FRE_NOTMODIFIED  0000086C R     04   IRP$L_SVAPTE     0000002C            
BUG$_INCPTREF    ********   X   04   FRE_NXTWSLE      000007D6 R     04   IRP$L_TT_TERM    00000038            
BUG$_IVBAKADIO   ********   X   04   FRE_PGFLNOTINI   000008DC R     04   IRP$L_UCB        0000001C            
BUG$_MAKEWSLE    ********   X   04   FRE_RELEASE      00000863 R     04   IRP$L_WIND       00000018            
BUG$_MFYNULPGFL  ********   X   04   FRE_SUCCESS      000008D5 R     04   IRP$M_BUFIO    = 00000001            
BUG$_PGFGBLBAD   ********   X   04   FRE_TRANS        0000080F R     04   IRP$M_CHAINED  = 00000020            
BUG$_PGFIPLHI    ********   X   04   FRE_TRY_SKIP     00000830 R     04   IRP$M_COMPLX   = 00000008            
BUG$_PGFLOCBAD   ********   X   04   FRE_VALID        0000081D R     04   IRP$M_DIAGBUF  = 00000080            
BUG$_SCANDEADPT  ********   X   04   GBL...         = 00000000            IRP$M_FUNC     = 00000002            
BUG$_WSLENOVAL   ********   X   04   GBLBAD           00000157 R     04   IRP$M_MBXIO    = 00000400            
BUG$_WSLVANVAL   ********   X   04   GBLCRF           00000196 R     04   IRP$M_PAGIO    = 00000004            
CA$_MEASURE    = 00000002            GBLDZRO          000001D1 R     04   IRP$M_PHYSIO   = 00000100            
CA$_MEASURE_IOT= 00000004            GBLNOTRESIDENT   000001E0 R     04   IRP$M_PRIVIO   = 00000200            
CA$_SIMULATOR  = 00000001            GBLVALID         00000145 R     04   IRP$M_SWAPIO   = 00000040            
CLUSTER          00000020            GETPAGELOC       000000AC R     04   IRP$M_VIRTUAL  = 00000010            
CLU_END          000004D8 R     04   GET_IRP          000001AC R     04   IRP$Q_NT_PRVMSK  0000003C            
CLU_END1         000003EA R     04   GOT_IRP          00000229 R     04   IRP$S_FCODE    = 00000006            
CLU_END_RESRC    000004F2 R     04   GPGNULPGFL       000008DF R     04   IRP$S_FMOD     = 0000000A            
CLU_END_RESRC1   000004D6 R     04   GPGTBL           00000007 R     04   IRP$S_MODE     = 00000002            
CLU_INI_INC      000003FF R     04   GPTX             00000018            IRP$V_BUFIO    = 00000000            
CLU_NXT          0000040B R     04   GPTX_PTE         0000001C            IRP$V_CHAINED  = 00000005            
CLU_SCRATCH_SIZ  0000004C            INC1             00000028            IRP$V_COMPLX   = 00000003            
COUNT            00000021            INC4             0000002C            IRP$V_DIAGBUF  = 00000007            
CTL$GL_PHD       ********   X   04   INC512           00000030            IRP$V_FCODE    = 00000000            
CTL$GL_WSPEAK    ********   X   04   INCPTREFBUG      00000A51 R     04   IRP$V_FMOD     = 00000006            
DECVALWSLECNT    00000952 R     04   INCVALWSLECNT    000009F7 R     04   IRP$V_FUNC     = 00000001            
DIOCNTWAIT_2     000001A7 R     04   ININEWPFNWAIT    0000096C R     04   IRP$V_MBXIO    = 0000000A            
DIR...         = 00000001            IOC$GL_IRPFL     ********   X   04   IRP$V_MODE     = 00000000            
DZROFPGWAIT_5    00000527 R     04   IPL$_ASTDEL    = 00000002            IRP$V_PAGIO    = 00000002            
DZRO_GBL_SEC     00000531 R     04   IPL$_HWCLK     = 00000018            IRP$V_PHYSIO   = 00000008            
DZRO_PROC_SEC    000001CE R     04   IPL$_IOPOST    = 00000004            IRP$V_PRIVIO   = 00000009            
DZRO_PTE         0000052D R     04   IPL$_MAILBOX   = 0000000B            IRP$V_SWAPIO   = 00000006            
DZRO_PTE_0       00000137 R     04   IPL$_POWER     = 0000001F            IRP$V_VIRTUAL  = 00000004            
EVT$_AST         ********   X   04   IPL$_QUEUEAST  = 00000006            IRP$W_ABCNT      0000003C            
EXE$ACVIOLAT     ********   X   04   IPL$_SCHED     = 00000003            IRP$W_BCNT       00000032            
EXE$ALONONPAGED  ********   X   04   IPL$_SYNCH     = 00000007            IRP$W_BOFF       00000030            
EXE$BUILDPKTR    ********   X   04   IPL$_TIMER     = 00000007            IRP$W_CHAN       00000028            
EXE$DEANONPAGED  ********   X   04   IPLHI            00000000 R     04   IRP$W_FUNC       00000020            
EXE$GL_FLAGS     ********   X   04   IRP$B_CARCON     00000038            IRP$W_OBCNT      0000003E            
EXE$GQ_SYSTIME   ********   X   04   IRP$B_EFN        00000022            IRP$W_SIZE       00000008            
EXE$PAGRDERR     ********   X   04   IRP$B_PRI        00000023            IRP$W_STS        0000002A            
EXE$V_NOCLUSTER  ********   X   04   IRP$B_RMOD       0000000B            IRP$W_TT_PRMPT   0000003C            
FLTCTL           00000018            IRP$B_TYPE       0000000A            IRPWAIT_3        0000019D R     04   
FLTPC            00000020            IRP$C_LENGTH     0000004C            LCKWSLE_NOTPGTB  0000077F R     04   
FLTPSL           00000024            IRP$K_LENGTH     0000004C            LOCBAD           00000133 R     04   
FLTVA            0000001C            IRP$L_AST        00000010            LOCKED_WSLE      00000783 R     04   
FP_SAV           0000003C            IRP$L_ASTPRM     00000014            MMG$ALLOCPFN     ********   X   04   
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  58
SYMBOL TABLE                                                                                                                    (28)

MMG$AL_SYSPCB    ********   X   04   PCB$L_PID        00000060            PFL$L_BITMAP     00000000            
MMG$CRETVA       ********   X   04   PCB$L_PQB        0000004C            PFL$L_BITMAPSIZ  00000014            
MMG$DECPHDREF    00000ABC RG    04   PCB$L_SQBL       00000004            PFL$L_FREPAGCNT  00000018            
MMG$DECPHDREF1   00000AC0 RG    04   PCB$L_SQFL       00000000            PFL$L_RESERVCNT  0000001C            
MMG$DECPTREF     00000A55 RG    04   PCB$L_STS        00000028            PFL$L_STARTBYTE  00000004            
MMG$DELWSLEPPG   00000949 RG    04   PCB$L_UIC        00000020            PFL$L_VBN        00000010            
MMG$DELWSLEX     00000925 RG    04   PCB$L_WSSWP      00000024            PFL$L_WINDOW     0000000C            
MMG$FREWSLE      000007BF RG    04   PCB$L_WTIME      0000002C            PFL$W_SIZE       00000008            
MMG$FREWSLX      00000777 RG    04   PCB$T_LNAME      0000006C            PFM$MON          ********   X   04   
MMG$GL_GPTBASE   ********   X   04   PCB$V_ASTPEN   = 00000011            PFN$AB_STATE     ********   X   04   
MMG$GL_MAXGPTE   ********   X   04   PCB$V_BATCH    = 0000000E            PFN$AB_TYPE      ********   X   04   
MMG$GL_MAXPFN    ********   X   04   PCB$V_DELPEN   = 00000001            PFN$AL_BAK       ********   X   04   
MMG$GL_PAGSWPVC  ********   X   04   PCB$V_FORCPEN  = 00000002            PFN$AL_PTE       ********   X   04   
MMG$GL_SPTBASE   ********   X   04   PCB$V_HIBER    = 00000013            PFN$AW_REFCNT    ********   X   04   
MMG$GL_SYSPHD    ********   X   04   PCB$V_INQUAN   = 00000003            PFN$AW_SHRCNT    ********   X   04   
MMG$INCPTREF     00000A17 RG    04   PCB$V_LOGIN    = 00000014            PFN$AW_WSLX      ********   X   04   
MMG$INIBLDPKT    00000ACB RG    04   PCB$V_NETWRK   = 00000015            PFN$C_ACTIVE   = 00000007            
MMG$ININEWPFN    0000096F RG    04   PCB$V_NOACNT   = 0000000F            PFN$C_BADPAGLST= 00000002            
MMG$LOCKPGTB     00000A11 RG    04   PCB$V_NODELET  = 00000017            PFN$C_FREPAGLST= 00000000            
MMG$MAKEWSLE     000009AD RG    04   PCB$V_PHDRES   = 00000012            PFN$C_GBLWRT   = 00000003            
MMG$PAGEFAULT    00000068 RG    04   PCB$V_PSWAPM   = 00000004            PFN$C_GLOBAL   = 00000002            
MMG$PGFLTWAIT    000003A5 RG    04   PCB$V_PWRAST   = 00000016            PFN$C_GPGTBL   = 00000005            
MMG$PGFLTWAIT_1  000003A0 R     04   PCB$V_RES      = 00000000            PFN$C_MFYPAGLST= 00000001            
MMG$PTEREF       ********   X   04   PCB$V_RESPEN   = 00000005            PFN$C_PPGTBL   = 00000004            
MMG$REFCNTNEG    ********   X   04   PCB$V_SSFEXC   = 00000006            PFN$C_PROCESS  = 00000000            
MMG$RELPFN       ********   X   04   PCB$V_SSFEXCE  = 00000007            PFN$C_RDERR    = 00000004            
MMG$REMPFN       ********   X   04   PCB$V_SSFEXCS  = 00000008            PFN$C_RDINPROG = 00000006            
MMG$RESRCWAIT    0000038A RG    04   PCB$V_SSFEXCU  = 00000009            PFN$C_RELPEND  = 00000003            
MMG$RLPFNSAVPTE  ********   X   04   PCB$V_SSRWAIT  = 0000000A            PFN$C_SYSTEM   = 00000001            
MMG$RSRVPAGFIL   ********   X   04   PCB$V_SUSPEN   = 0000000B            PFN$C_WRTINPROG= 00000005            
MMG$SCNWSLX      ********   X   04   PCB$V_SWPVBN   = 00000010            PFN$M_BADPAG   = 00000020            
MMG$SHRCNTNEG    ********   X   04   PCB$V_WAKEPEN  = 0000000C            PFN$M_BAK      = 007FFFFF            
MMG$SVAPTECHK    ********   X   04   PCB$V_WALL     = 0000000D            PFN$M_COLLISION= 00000010            
MMG$SVPCTX       00000361 RG    04   PCB$W_APTCNT     00000034            PFN$M_DELCON   = 00000010            
MMG$WSLEPFN      0000074B RG    04   PCB$W_ASTCNT     0000003C            PFN$M_GBLBAK   = 00800000            
NOTGLOBAL        000001D7 R     04   PCB$W_BIOCNT     0000003E            PFN$M_LOC      = 00000007            
NOTRANSITION     0000015B R     04   PCB$W_BIOLM      00000040            PFN$M_MODIFY   = 00000080            
NOTSYSTEM        0000001C R     04   PCB$W_BYTCNT     00000042            PFN$M_PAGTYP   = 00000007            
NULLPGFL_NOMFY   000008E3 R     04   PCB$W_BYTLM      00000068            PFN$M_PGFLX    = FF000000            
PCB$B_ASTACT     0000000C            PCB$W_DIOCNT     00000044            PFN$M_RPTEVT   = 00000040            
PCB$B_ASTEN      0000000D            PCB$W_DIOLM      00000046            PFN$S_BAK      = 00000017            
PCB$B_PRI        0000000B            PCB$W_FILCNT     00000048            PFN$S_GBLBAK   = 00000001            
PCB$B_PRIB       00000033            PCB$W_GPGCNT     00000038            PFN$S_LOC      = 00000003            
PCB$B_TYPE       0000000A            PCB$W_GRP        00000022            PFN$S_PAGTYP   = 00000003            
PCB$B_WEFC       00000032            PCB$W_MEM        00000020            PFN$S_PGFLX    = 00000008            
PCB$C_LENGTH     0000007C            PCB$W_MTXCNT     0000000E            PFN$V_BADPAG   = 00000005            
PCB$K_LENGTH     0000007C            PCB$W_PPGCNT     0000003A            PFN$V_BAK      = 00000000            
PCB$L_ASTQBL     00000014            PCB$W_PRCCNT     0000006A            PFN$V_COLLISION= 00000004            
PCB$L_ASTQFL     00000010            PCB$W_SIZE       00000008            PFN$V_DELCON   = 00000004            
PCB$L_EFC2P      00000058            PCB$W_STATE      00000030            PFN$V_GBLBAK   = 00000017            
PCB$L_EFC3P      0000005C            PCB$W_TMBU       00000036            PFN$V_LOC      = 00000000            
PCB$L_EFCS       00000050            PCB$W_TQCNT      0000004A            PFN$V_MODIFY   = 00000007            
PCB$L_EFCU       00000054            PCB_SAV          00000040            PFN$V_PAGTYP   = 00000000            
PCB$L_EFWM       0000004C            PFL$B_PFC        0000000B            PFN$V_PGFLX    = 00000018            
PCB$L_OWNER      0000001C            PFL$B_TYPE       0000000A            PFN$V_RPTEVT   = 00000006            
PCB$L_PHD        00000064            PFL$C_LENGTH     00000020            PFNLIST          000005F1 R     04   
PCB$L_PHYPCB     00000018            PFL$K_LENGTH     00000020            PGF$V_LENVIO   = 00000000            
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  59
SYMBOL TABLE                                                                                                                    (28)

PGF$V_PGTBFLT  = 00000001            PHD$Q_PRIVMSK    00000000            PR$_ISP        = 00000004            
PGF$V_WRTACC   = 00000002            PHD$S_ASTLVL   = 00000008            PR$_KSP        = 00000000            
PGFCOMPLETE      000005EB R     04   PHD$S_P0LR     = 00000018            PR$_MAPEN      = 00000038            
PGFEXIT          0000035C R     04   PHD$V_ASTLVL   = 00000018            PR$_NICR       = 00000019            
PGFMONITOR       00000035 R     04   PHD$V_DALCSTX  = 00000001            PR$_P0BR       = 00000008            
PGFMONITOR1      00000095 R     04   PHD$V_P0LR     = 00000000            PR$_P0LR       = 00000009            
PHD$B_ASTLVL     000000CF            PHD$V_PFMFLG   = 00000000            PR$_P1BR       = 0000000A            
PHD$B_DFPFC      00000038            PHD$V_WSPEAKCHK= 00000002            PR$_P1LR       = 0000000B            
PHD$B_PAGFIL     0000001F            PHD$W_ASTLM      00000044            PR$_PCBB       = 00000010            
PHD$B_PGTBPFC    00000039            PHD$W_BAK        00000048            PR$_PME        = 0000003D            
PHD$C_LENGTH     00000118            PHD$W_DFWSCNT    0000001A            PR$_RXCS       = 00000020            
PHD$C_PHDPAGCTX= 00000008            PHD$W_EMPTPG     000000D8            PR$_RXDB       = 00000021            
PHD$K_LENGTH     00000118            PHD$W_EXTDYNWS   00000076            PR$_SBIER      = 00000034            
PHD$L_BIOCNT     00000054            PHD$W_FILLM      00000060            PR$_SBIFS      = 00000030            
PHD$L_CPULIM     00000058            PHD$W_FLAGS      0000003A            PR$_SBIMT      = 00000033            
PHD$L_CPUTIM     0000003C            PHD$W_PHVINDEX   00000046            PR$_SBIQC      = 00000036            
PHD$L_DIOCNT     00000050            PHD$W_PRCLM      00000042            PR$_SBIS       = 00000031            
PHD$L_ESP        0000007C            PHD$W_PST        00000020            PR$_SBISC      = 00000032            
PHD$L_FREP0VA    00000028            PHD$W_PSTBASMAX  0000004A            PR$_SBITA      = 00000035            
PHD$L_FREP1VA    00000030            PHD$W_PSTFREE    00000026            PR$_SBR        = 0000000C            
PHD$L_FREPTECNT  0000002C            PHD$W_PSTLAST    00000024            PR$_SCBB       = 00000011            
PHD$L_KSP        00000078            PHD$W_PTCNTACT   00000070            PR$_SID        = 0000003E            
PHD$L_P0BR       000000C8            PHD$W_PTCNTLCK   0000006C            PR$_SIRR       = 00000014            
PHD$L_P0LRASTL   000000CC            PHD$W_PTCNTMAX   00000072            PR$_SISR       = 00000015            
PHD$L_P1BR       000000D0            PHD$W_PTCNTVAL   0000006E            PR$_SLR        = 0000000D            
PHD$L_P1LR       000000D4            PHD$W_QUANT      00000040            PR$_SSP        = 00000002            
PHD$L_PAGEFLTS   0000004C            PHD$W_TQLM       00000062            PR$_TBIA       = 00000039            
PHD$L_PAGFIL     0000001C            PHD$W_WSAUTH     0000000A            PR$_TBIS       = 0000003A            
PHD$L_PC         000000C0            PHD$W_WSDYN      0000000E            PR$_TODR       = 0000001B            
PHD$L_PCB        00000078            PHD$W_WSFLUID    00000074            PR$_TXCS       = 00000022            
PHD$L_PGFLCNT    00000034            PHD$W_WSLAST     00000012            PR$_TXDB       = 00000023            
PHD$L_PGFLQUOTA  0000005C            PHD$W_WSLIST     00000008            PR$_USP        = 00000003            
PHD$L_PSL        000000C4            PHD$W_WSLOCK     0000000C            PR$_WCSA       = 0000002C            
PHD$L_PSTBASOFF  00000020            PHD$W_WSLX       0000004A            PR$_WCSD       = 0000002D            
PHD$L_PTWSLELCK  00000064            PHD$W_WSNEXT     00000010            PRI              00000023            
PHD$L_PTWSLEVAL  00000068            PHD$W_WSQUOTA    00000018            PROCPAG          00000355 R     04   
PHD$L_R0         00000088            PHV$GL_REFCBAS   ********   X   04   PRT$C_EW         ********   X   04   
PHD$L_R1         0000008C            PHVREFCADR       00000048            PSL$C_EXEC     = 00000001            
PHD$L_R10        000000B0            PMS$AL_TRANSFLT  00000018 RG    03   PSL$C_KERNEL   = 00000000            
PHD$L_R11        000000B4            PMS$GL_DPTSCN    00000038 RG    03   PSL$C_SUPER    = 00000002            
PHD$L_R12        000000B8            PMS$GL_DZROFLTS  00000014 RG    03   PSL$C_USER     = 00000003            
PHD$L_R13        000000BC            PMS$GL_FAULTS    00000000 RG    03   PSL$M_CM       = 80000000            
PHD$L_R2         00000090            PMS$GL_PREADIO   00000008 RG    03   PSL$M_CURMOD   = 03000000            
PHD$L_R3         00000094            PMS$GL_PREADS    00000004 RG    03   PSL$M_DV       = 00000080            
PHD$L_R4         00000098            PMS$GL_PWRITES   0000000C RG    03   PSL$M_FPD      = 08000000            
PHD$L_R5         0000009C            PMS$GL_PWRITIO   00000010 RG    03   PSL$M_FU       = 00000040            
PHD$L_R6         000000A0            PMS$GL_RDFLTS    00000004 RG    03   PSL$M_IPL      = 001F0000            
PHD$L_R7         000000A4            PMS$GL_REFERFLT  0000003C RG    03   PSL$M_IS       = 04000000            
PHD$L_R8         000000A8            PPGTBL           0000005B R     04   PSL$M_IV       = 00000020            
PHD$L_R9         000000AC            PPGTBL_2         00000140 R     04   PSL$M_PRVMOD   = 00C00000            
PHD$L_REFERFLT   00000014            PR$_ACCR       = 00000029            PSL$M_SAFBITS  = 000037FF            
PHD$L_SSP        00000080            PR$_ACCS       = 00000028            PSL$M_TBIT     = 00000010            
PHD$L_USP        00000084            PR$_ASTLVL     = 00000013            PSL$M_TP       = 40000000            
PHD$L_WSL        00000118            PR$_ESP        = 00000001            PSL$S_CURMOD   = 00000002            
PHD$M_DALCSTX  = 00000002            PR$_ICCS       = 00000018            PSL$S_IPL      = 00000005            
PHD$M_PFMFLG   = 00000001            PR$_ICR        = 0000001A            PSL$S_PRVMOD   = 00000002            
PHD$M_WSPEAKCHK= 00000004            PR$_IPL        = 00000012            PSL$V_CM       = 0000001F            
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  60
SYMBOL TABLE                                                                                                                    (28)

PSL$V_CURMOD   = 00000018            PTE$V_TYP1     = 0000001A            SEC$S_SYSGBL   = 00000001            
PSL$V_DV       = 00000007            PTE$V_VALID    = 0000001F            SEC$S_VPX      = 00000016            
PSL$V_FPD      = 0000001B            PTE$V_WRT      = 00000012            SEC$S_WRT      = 00000001            
PSL$V_FU       = 00000006            PTEDAT           00000000            SEC$V_AMOD     = 00000008            
PSL$V_IPL      = 00000010            QUEUE_PAGE_READ  00000339 R     04   SEC$V_CRF      = 00000001            
PSL$V_IS       = 0000001A            READERR          00000640 R     04   SEC$V_DZRO     = 00000002            
PSL$V_IV       = 00000005            READINPROG       00000370 R     04   SEC$V_GBL      = 00000000            
PSL$V_PRVMOD   = 00000016            RELEASEPEND      000005F4 R     04   SEC$V_PERM     = 0000000E            
PSL$V_TBIT     = 00000004            RESOURCEWAIT     0000036C R     04   SEC$V_PFC      = 00000018            
PSL$V_TP       = 0000001E            RSN$_ASTWAIT   = 00000001            SEC$V_SYSGBL   = 0000000F            
PTE$C_EOWN     = 00800000            RSN$_BRKTHRU   = 00000006            SEC$V_VPX      = 00000000            
PTE$C_ER       = 38000000            RSN$_IACLOCK   = 00000007            SEC$V_WRT      = 00000003            
PTE$C_ERKW     = 30000000            RSN$_MAILBOX   = 00000002            SEC$W_FLAGS      00000014            
PTE$C_EW       = 28000000            RSN$_NPDYNMEM  = 00000003            SEC$W_SECXBL     00000006            
PTE$C_KOWN     = 00000000            RSN$_PGDYNMEM  = 00000005            SEC$W_SECXFL     00000004            
PTE$C_KR       = 18000000            RSN$_PGFILE    = 00000004            SETSLAVEPTE      00000627 R     04   
PTE$C_KW       = 10000000            RSRCWAIT_3       0000013A R     04   SGN$GL_BALSETCT  ********   X   04   
PTE$C_NA       = 00000000            SAVABS...      = 0000004C            SGN$GL_PTPAGCNT  ********   X   04   
PTE$C_SOWN     = 01000000            SCANDEADPT       000006B9 R     04   SGN$GW_WSLMXSKP  ********   X   04   
PTE$C_SR       = 58000000            SCH$GL_CURPCB    ********   X   04   SIZE_TYPE        00000008            
PTE$C_SREW     = 48000000            SCH$GL_MFYLIM    ********   X   04   SS$_ABORT      = 0000002C            
PTE$C_SRKW     = 50000000            SCH$GL_MFYLOLIM  ********   X   04   SS$_ACCONFLICT = 00000800            
PTE$C_SW       = 40000000            SCH$GL_RESMASK   ********   X   04   SS$_ACCVIO     = 0000000C            
PTE$C_UOWN     = 01800000            SCH$GQ_COLPGWQ   ********   X   04   SS$_ACPVAFUL   = 000002FC            
PTE$C_UR       = 78000000            SCH$GQ_FPGWQ     ********   X   04   SS$_ARTRES     = 00000474            
PTE$C_UREW     = 68000000            SCH$GQ_MWAIT     ********   X   04   SS$_ASTFLT     = 0000040C            
PTE$C_URKW     = 70000000            SCH$GQ_PFWQ      ********   X   04   SS$_BADATTRIB  = 00000034            
PTE$C_URSW     = 60000000            SCH$RSE          ********   X   04   SS$_BADCHKSUM  = 00000808            
PTE$C_UW       = 20000000            SCH$SCHED        ********   X   04   SS$_BADESCAPE  = 0000003C            
PTE$M_CRF      = 00010000            SCH$SWPWAKE      ********   X   04   SS$_BADFILEHDR = 00000810            
PTE$M_DZRO     = 00020000            SEC$B_AMOD       00000015            SS$_BADFILENAME= 00000818            
PTE$M_GPTX     = 003FFFFF            SEC$B_PFC        0000000B            SS$_BADFILEVER = 00000820            
PTE$M_MODIFY   = 04000000            SEC$C_LENGTH     00000020            SS$_BADIMGHDR  = 00000044            
PTE$M_OWN      = 01800000            SEC$K_LENGTH     00000020            SS$_BADIRECTORY= 00000828            
PTE$M_PFN      = 001FFFFF            SEC$K_MATALL   = 00000000            SS$_BADPARAM   = 00000014            
PTE$M_PGFLVB   = 003FFFFF            SEC$K_MATEQU   = 00000001            SS$_BADSTACK   = 000002B4            
PTE$M_PROT     = 78000000            SEC$K_MATLEQ   = 00000002            SS$_BEGOFFILE  = 00000938            
PTE$M_TYP0     = 00400000            SEC$L_CCB        00000000            SS$_BLOCKCNTERR= 00000940            
PTE$M_TYP1     = 04000000            SEC$L_GSD        00000000            SS$_BREAK      = 00000414            
PTE$M_VALID    = 80000000            SEC$L_PAGCNT     0000001C            SS$_BUFBYTALI  = 0000030C            
PTE$M_WRT      = 00040000            SEC$L_REFCNT     00000018            SS$_BUFFEROVF  = 00000601            
PTE$S_GPTX     = 00000016            SEC$L_VBN        00000010            SS$_BUGCHECK   = 000002A4            
PTE$S_OWN      = 00000002            SEC$L_VPXPFC     00000008            SS$_CANCEL     = 00000830            
PTE$S_PFN      = 00000015            SEC$L_WINDOW     0000000C            SS$_CHANINTLK  = 0000004C            
PTE$S_PGFLVB   = 00000016            SEC$M_AMOD     = 00000300            SS$_CLIFRCEXT  = 00000980            
PTE$S_PROT     = 00000004            SEC$M_CRF      = 00000002            SS$_CMODSUPR   = 0000041C            
PTE$S_STX      = 00000010            SEC$M_DZRO     = 00000004            SS$_CMODUSER   = 00000424            
PTE$V_CRF      = 00000010            SEC$M_GBL      = 00000001            SS$_COMPAT     = 0000042C            
PTE$V_DZRO     = 00000011            SEC$M_PERM     = 00004000            SS$_CONTINUE   = 00000001            
PTE$V_GPTX     = 00000000            SEC$M_SYSGBL   = 00008000            SS$_CONTROLC   = 00000651            
PTE$V_MODIFY   = 0000001A            SEC$M_WRT      = 00000008            SS$_CONTROLO   = 00000609            
PTE$V_OWN      = 00000017            SEC$S_AMOD     = 00000002            SS$_CONTROLY   = 00000611            
PTE$V_PFN      = 00000000            SEC$S_CRF      = 00000001            SS$_CREATED    = 00000619            
PTE$V_PGFLVB   = 00000000            SEC$S_DZRO     = 00000001            SS$_CTRLERR    = 00000054            
PTE$V_PROT     = 0000001B            SEC$S_GBL      = 00000001            SS$_DATACHECK  = 0000005C            
PTE$V_STX      = 00000000            SEC$S_PERM     = 00000001            SS$_DATAOVERUN = 00000838            
PTE$V_TYP0     = 00000016            SEC$S_PFC      = 00000008            SS$_DEBUG      = 0000046C            
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  61
SYMBOL TABLE                                                                                                                    (28)

SS$_DECOVF     = 000004A4            SS$_INSFRAME   = 0000012C            SS$_OPCDEC     = 0000043C            
SS$_DEVACTIVE  = 000002C4            SS$_INSFWSL    = 0000011C            SS$_OPINCOMPL  = 000002D4            
SS$_DEVALLOC   = 00000840            SS$_INTDIV     = 00000484            SS$_PAGOWNVIO  = 000001EC            
SS$_DEVALRALLOC= 00000641            SS$_INTOVF     = 0000047C            SS$_PAGRDERR   = 00000444            
SS$_DEVASSIGN  = 00000848            SS$_IVADDR     = 00000134            SS$_PARITY     = 000001F4            
SS$_DEVFOREIGN = 00000064            SS$_IVCHAN     = 0000013C            SS$_PARTESCAPE = 000001FC            
SS$_DEVICEFULL = 00000850            SS$_IVCHNLSEC  = 0000026C            SS$_PFMBSY     = 00000204            
SS$_DEVMOUNT   = 0000006C            SS$_IVDEVNAM   = 00000144            SS$_PLHLDR     = 00000404            
SS$_DEVNOTALLOC= 00000858            SS$_IVGSDNAM   = 0000014C            SS$_PSTFULL    = 0000020C            
SS$_DEVNOTMBX  = 00000074            SS$_IVLOGNAM   = 00000154            SS$_RADRMOD    = 0000044C            
SS$_DEVNOTMOUNT= 0000007C            SS$_IVLOGTAB   = 0000015C            SS$_REJECT     = 00000294            
SS$_DEVOFFLINE = 00000084            SS$_IVPROTECT  = 000002F4            SS$_REMOTE     = 00000649            
SS$_DIRFULL    = 00000860            SS$_IVQUOTAL   = 00000164            SS$_RESIGNAL   = 00000918            
SS$_DRVERR     = 0000008C            SS$_IVSECFLG   = 0000016C            SS$_RESULTOVF  = 00000214            
SS$_DUPFILENAME= 00000868            SS$_IVSECIDCTL = 000002E4            SS$_ROPRAND    = 00000454            
SS$_DUPLNAM    = 00000094            SS$_IVSSRQ     = 00000174            SS$_SECTBLFUL  = 0000021C            
SS$_ENDOFFILE  = 00000870            SS$_IVSTSFLG   = 0000017C            SS$_SSFAIL     = 0000045C            
SS$_ENDOFTAPE  = 00000878            SS$_IVTIME     = 00000184            SS$_SUBRNG     = 000004AC            
SS$_ENDOFUSRLBL= 00000970            SS$_LCKPAGFUL  = 000000D4            SS$_SUPERSEDE  = 00000631            
SS$_EXQUOTA    = 0000001C            SS$_LENVIO     = 0000018C            SS$_TAPEPOSLOST= 00000224            
SS$_EXTIDXFILE = 00000880            SS$_LKWSETFUL  = 00000194            SS$_TBIT       = 00000464            
SS$_FCPREADERR = 00000888            SS$_MBFULL     = 000008D8            SS$_TIMEOUT    = 0000022C            
SS$_FCPREPSTN  = 00000988            SS$_MBTOOSML   = 0000019C            SS$_TOOMANYVER = 00000990            
SS$_FCPREWNDERR= 00000890            SS$_MCHECK     = 000002BC            SS$_TOOMUCHDATA= 0000029C            
SS$_FCPSPACERR = 00000898            SS$_MEDOFL     = 000001A4            SS$_UNASEFC    = 00000234            
SS$_FCPWRITERR = 000008A0            SS$_MSGNOTFND  = 00000621            SS$_UNSAFE     = 0000023C            
SS$_FILACCERR  = 0000009C            SS$_MTLBLLONG  = 00000304            SS$_UNWIND     = 00000920            
SS$_FILALRACC  = 000000A4            SS$_MUSTCLOSEFL= 00000948            SS$_UNWINDING  = 00000928            
SS$_FILELOCKED = 000008A8            SS$_NOAQB      = 00000314            SS$_VASFULL    = 00000244            
SS$_FILENUMCHK = 000008B0            SS$_NODATA     = 000001AC            SS$_VECINUSE   = 0000024C            
SS$_FILESEQCHK = 000008B8            SS$_NOHANDLER  = 000008F8            SS$_VOLINV     = 00000254            
SS$_FILESTRUCT = 000008C0            SS$_NOHOMEBLK  = 000008E0            SS$_WAITUSRLBL = 00000950            
SS$_FILNOTACC  = 000000AC            SS$_NOIOCHAN   = 000001B4            SS$_WASCLR     = 00000001            
SS$_FILNOTCNTG = 000002AC            SS$_NOLINKS    = 0000027C            SS$_WASECC     = 00000639            
SS$_FILNOTEXP  = 000000B4            SS$_NOLOGNAM   = 000001BC            SS$_WASSET     = 00000009            
SS$_FLTDIV     = 00000494            SS$_NOMBX      = 00000274            SS$_WRITLCK    = 0000025C            
SS$_FLTOVF     = 0000048C            SS$_NOMOREFILES= 00000930            SS$_WRONGACP   = 0000031C            
SS$_FLTUND     = 0000049C            SS$_NONEXDRV   = 000001C4            STATE            00000022            
SS$_FORMAT     = 000000BC            SS$_NONEXPR    = 000008E8            SVAPTE           00000004            
SS$_GPTFULL    = 000000C4            SS$_NONLOCAL   = 000008F0            SWP$GL_BALBASE   ********   X   04   
SS$_GSDFULL    = 000000CC            SS$_NOPRIV     = 00000024            SWP$GL_BSLOTSZ   ********   X   04   
SS$_HANGUP     = 000002CC            SS$_NORMAL     = 00000001            SYSTEMSPACE      0000003A R     04   
SS$_HEADERFULL = 000008C8            SS$_NOSIGNAL   = 00000900            TMP...         = 00000001            
SS$_IDXFILEFULL= 000008D0            SS$_NOSOLICIT  = 00000284            TRANSITION       00000114 R     04   
SS$_ILLBLKNUM  = 000000DC            SS$_NOSUCHDEV  = 00000908            TRY_TO_CLUSTER   000003C2 R     04   
SS$_ILLCNTRFUNC= 000000E4            SS$_NOSUCHFILE = 00000910            VA               0000000C            
SS$_ILLEFC     = 000000EC            SS$_NOSUCHNODE = 0000028C            VA$M_BYTE      = 000001FF            
SS$_ILLIOFUNC  = 000000F4            SS$_NOSUCHSEC  = 00000978            VA$M_P1        = 40000000            
SS$_ILLLBLAST  = 00000968            SS$_NOTAPEOP   = 00000264            VA$M_SYSTEM    = 80000000            
SS$_ILLPAGCNT  = 000000FC            SS$_NOTFILEDEV = 000001CC            VA$M_VPG       = FFFFFE00            
SS$_ILLSEQOP   = 000002DC            SS$_NOTINTBLSZ = 000001D4            VA$M_VPN       = 3FFFFE00            
SS$_ILLSER     = 00000104            SS$_NOTLABELMT = 000001DC            VA$S_BYTE      = 00000009            
SS$_ILLUSRLBLRD= 00000958            SS$_NOTMODIFIED= 00000659            VA$S_VPG       = 00000017            
SS$_ILLUSRLBLWT= 00000960            SS$_NOTNETDEV  = 000002EC            VA$S_VPN       = 00000015            
SS$_INCVOLLABEL= 0000010C            SS$_NOTRAN     = 00000629            VA$V_BYTE      = 00000000            
SS$_INSFARG    = 00000114            SS$_NOTSQDEV   = 000001E4            VA$V_P1        = 0000001E            
SS$_INSFMEM    = 00000124            SS$_OPCCUS     = 00000434            VA$V_SYSTEM    = 0000001F            
PAGEFAULT       - TRANSLATION NOT VALID EXCEPTION HANDLER        21-AUG-1978 20:01:53   VAX-11 MACRO X0.3-11               Page  62
SYMBOL TABLE                                                                                                                    (28)

VA$V_VPG       = 00000009            
VA$V_VPN       = 00000009            
VBN              00000034            
WINDOW           00000038            
WQH$C_LENGTH     0000000C            
WQH$K_LENGTH     0000000C            
WQH$L_WQBL       00000004            
WQH$L_WQFL       00000000            
WQH$W_WQCNT      00000008            
WQH$W_WQSTATE    0000000A            
WRITEINPROG      000005F4 R     04   
WSL$C_GBLWRT   = 00000006            
WSL$C_GLOBAL   = 00000004            
WSL$C_GPGTBL   = 0000000A            
WSL$C_LENGTH   = 00000004            
WSL$C_PPGTBL   = 00000008            
WSL$C_PROCESS  = 00000000            
WSL$C_SYSTEM   = 00000002            
WSL$M_GOODPAGE = 00000040            
WSL$M_MODIFY   = 00000100            
WSL$M_PAGTYP   = 0000000E            
WSL$M_PFNLOCK  = 00000010            
WSL$M_VALID    = 00000001            
WSL$M_WSLOCK   = 00000020            
WSL$S_PAGTYP   = 00000003            
WSL$V_GOODPAGE = 00000006            
WSL$V_MODIFY   = 00000008            
WSL$V_PAGTYP   = 00000001            
WSL$V_PFNLOCK  = 00000004            
WSL$V_VALID    = 00000000            
WSL$V_WSLOCK   = 00000005            
WSLENOVAL        00000798 R     04   
WSLEPFNMSK       00000747 R     04   
WSLVANVAL        00000773 R     04   


PROGRAM SECTION SYNOPSIS

.  ABS  .        00000000      00     NOPIC   USR   CON   ABS   LCL NOSHR NOEXE NORD  NOWRT BYTE  
. BLANK .        00000000      01     NOPIC   USR   CON   REL   LCL NOSHR   EXE   RD    WRT BYTE  
$ABS$            0000011C      02     NOPIC   USR   CON   ABS   LCL NOSHR   EXE   RD    WRT BYTE  
$$$210           00000040      03     NOPIC   USR   CON   REL   LCL NOSHR   EXE   RD    WRT LONG  
$MMG$COD         00000B12      04     NOPIC   USR   CON   REL   LCL NOSHR   EXE   RD    WRT LONG  


THERE WERE NO ERRORS OR WARNINGS.
3138. BYTES LEFT IN FREE MEMORY POOL.
84. BYTES OF RECLAIMED MEMORY.
OBJ$:PAGEFAULT,LIS$:PAGEFAULT/-SP=EXECML$/ML,SRC$:PAGEFAULT
23 MLB DIR RDS - 1197 GETS TO DEFINE 36 MACROS. 115 INTER. FILE WRITES. 
