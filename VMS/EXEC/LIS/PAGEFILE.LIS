PAGEFILE        - ALLOCATE / DEALLOCATE PAGING FILE              21-AUG-1978 20:03:12   VAX-11 MACRO X0.3-11               Page   0
TABLE OF CONTENTS   

   (1)    3800  HISTORY			; DETAILED
   (1)    4700  DECLARATIONS
   (2)     100  RSRVPAGFIL - RESERVE A PAGE OF PAGING FILE
   (3)     100  ALCPAGFIL - ALLOCATE A PAGING FILE PAGE
   (4)     100  DALCPAGFIL - DEALLOCATE PAGE IN PAGING FILE
PAGEFILE        - ALLOCATE / DEALLOCATE PAGING FILE              21-AUG-1978 20:03:12   VAX-11 MACRO X0.3-11               Page   1
X0107                                                                                                                            (1)

                                     0000   100 	.TITLE	PAGEFILE - ALLOCATE / DEALLOCATE PAGING FILE
                                     0000   200 	.IDENT	/X0107/
                                     0000   300 ;
                                     0000   400 ; COPYRIGHT (C) 1978
                                     0000   500 ; DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASSACHUSETTS 01754
                                     0000   600 ;
                                     0000   700 ; THIS SOFTWARE IS FURNISHED  UNDER A LICENSE FOR USE ONLY ON A SINGLE
                                     0000   800 ; COMPUTER  SYSTEM AND  MAY BE  COPIED ONLY WITH  THE INCLUSION OF THE
                                     0000   900 ; ABOVE COPYRIGHT NOTICE.  THIS SOFTWARE, OR ANY OTHER COPIES THEREOF,
                                     0000  1000 ; MAY NOT BE PROVIDED OR  OTHERWISE MADE AVAILABLE TO ANY OTHER PERSON
                                     0000  1100 ; EXCEPT FOR USE ON SUCH SYSTEM AND TO ONE WHO AGREES TO THESE LICENSE
                                     0000  1200 ; TERMS.  TITLE TO AND  OWNERSHIP OF THE  SOFTWARE  SHALL AT ALL TIMES
                                     0000  1300 ; REMAIN IN DEC.
                                     0000  1400 ;
                                     0000  1500 ; THE INFORMATION IN THIS SOFTWARE IS SUBJECT TO CHANGE WITHOUT NOTICE
                                     0000  1600 ; AND SHOULD  NOT BE CONSTRUED  AS A COMMITMENT  BY DIGITAL  EQUIPMENT
                                     0000  1700 ; CORPORATION.
                                     0000  1800 ;
                                     0000  1900 ; DEC ASSUMES  NO  RESPONSIBILITY  FOR  THE USE OR  RELIABILITY OF ITS
                                     0000  2000 ; SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DEC.
                                     0000  2100 
                                     0000  2200 ;++
                                     0000  2300 ; FACILITY:	EXECUTIVE, MEMORY MANAGEMENT SUBROUTINES
                                     0000  2400 ;
                                     0000  2500 ; ABSTRACT:
                                     0000  2600 ;
                                     0000  2700 ;	THIS MODULE CONTAINS THE ROUTINES FOR ALLOCATING AND DEALLOCATING
                                     0000  2800 ;	PAGES FROM A PAGING FILE.
                                     0000  2900 ;
                                     0000  3000 ; ENVIRONMENT:
                                     0000  3100 ;
                                     0000  3200 ;	THESE ROUTINES RUN IN KERNEL MODE AND MUST BE CALLED WITH
                                     0000  3300 ;	IPL AT SYNCH OR HIGHER.
                                     0000  3400 ;
                                     0000  3500 ;--
                                     0000  3600 ;
                                     0000  3700 ;	.PAGE
                                     0000  3800 	.SBTTL	HISTORY			; DETAILED
                                     0000  3900 ;
                                     0000  4000 ; AUTHOR: PETER H. LIPMAN	, CREATION DATE: 29-OCT-76
                                     0000  4100 ;
                                     0000  4200 ; MODIFIED BY:
                                     0000  4300 ;	, : VERSION
                                     0000  4400 ; 01	 -
                                     0000  4500 
PAGEFILE        - ALLOCATE / DEALLOCATE PAGING FILE              21-AUG-1978 20:03:12   VAX-11 MACRO X0.3-11               Page   2
X0107           DECLARATIONS                                                                                                     (1)

                                     0000  4700 	.SBTTL	DECLARATIONS
                                     0000  4800 
                                     0000  4900 ;
                                     0000  5000 ; INCLUDE FILES:
                                     0000  5100 ;
                                     0000  5200 	$PFLDEF				;PAGE FILE CONTROL BLOCK DEFINITIONS
                                     0000  5250 	$PTEDEF				;PAGE TABLE ENTRY DEFINITIONS
                                     0000  5300 	$RSNDEF				;RESOURCE NAME DEFINITIONS
                                     0000  5400 ;
                                     0000  5500 ; EXTERNAL SYMBOLS:
                                     0000  5600 ;
                                     0000  5700 
                                     0000  5800 ;
                                     0000  5900 ; MACROS:
                                     0000  6000 ;
                                     0000  6100 
                                     0000  6200 ;
                                     0000  6300 ; EQUATED SYMBOLS:
                                     0000  6400 ;
                                     0000  6500 ;
                                     0000  6600 ; OWN STORAGE:
                                     0000  6700 ;
                                     0000  6800 ;
                                     0000  6900 ; **********************************************************************
                                     0000  7000 ;
                                     0000  7100 ; **************** THIS ENTIRE MODULE MUST BE RESIDENT *****************
                                     0000  7200 ;
                                 00000000  7300 	.PSECT	$MMGCOD
                                     0000  7400 ;
                                     0000  7500 ; **********************************************************************
                                     0000  7600 ;
PAGEFILE        - ALLOCATE / DEALLOCATE PAGING FILE              21-AUG-1978 20:03:12   VAX-11 MACRO X0.3-11               Page   3
X0107           RSRVPAGFIL - RESERVE A PAGE OF PAGING FILE                                                                       (2)

                                     0000   100 	.SBTTL	RSRVPAGFIL - RESERVE A PAGE OF PAGING FILE
                                     0000   200 
                                     0000   300 ;++
                                     0000   400 ; FUNCTIONAL DESCRIPTION:
                                     0000   500 ;
                                     0000   600 ;	THIS ROUTINE RESERVES A SINGLE PAGE OF PAGE FILE SPACE AND
                                     0000   610 ;	RETURNS THE HIGHEST PAGE FILE VBN.
                                     0000   700 ;
                                     0000   800 ; CALLING SEQUENCE:
                                     0000   900 ;
                                     0000  1000 ;	BSBW	MMG$RSRVPAGFIL
                                     0000  1100 ;
                                     0000  1200 ; INPUT PARAMETERS:
                                     0000  1300 ;
                                     0000  1400 ;	R1 = PAGE FILE INDEX
                                     0000  1500 ;
                                     0000  1600 ; IMPLICIT INPUTS:
                                     0000  1650 ;
                                     0000  1700 ;	NONE
                                     0000  1800 ;
                                     0000  1900 ; OUTPUT PARAMETERS:
                                     0000  2000 ;
                                     0000  2100 ;	R0 = LARGEST POSSIBLE PAGE FILE VBN (PTE$M_PGFLVB) IF SUCCESSFUL
                                     0000  2200 ;	   = NEGATIVE IF PAGE FILE EMPTY AND INITIALIZED
                                     0000  2300 ;	   = 0 IF PAGE FILE EMPTY AND NOT INITIALIZED
                                     0000  2400 ;
                                     0000  2500 ; IMPLICIT OUTPUTS:
                                     0000  2550 ;
                                     0000  2600 ;	NONE
                                     0000  2700 ;
                                     0000  2800 ; COMPLETION CODES:
                                     0000  2850 ;
                                     0000  2900 ;	NONE
                                     0000  3000 ;
                                     0000  3100 ; SIDE EFFECTS:
                                     0000  3150 ;
                                     0000  3200 ;	NONE
                                     0000  3300 ;
                                     0000  3400 ;--
                                     0000  3500 
                                     0000  3600 MMG$RSRVPAGFIL::
            51       0000'DF41   D0  0000  3700 	MOVL	@W^MMG$GL_PAGSWPVC[R1],R1 ;GET ADDRESS OF PAGE FILE CONTROL BLOCK
                       1C A1     D7  0006  3800 	DECL	PFL$L_RESERVCNT(R1)	;TRY TO RESERVE A PAGE
                          08     19  0009  3900 	BLSS	20$			;BRANCH IF LAST ONE OR NONE LEFT
            50   003FFFFF 8F     D0  000B  4000 10$:	MOVL	#PTE$M_PGFLVB,R0	;RETURN VBN -1
                                 05  0012  4100 	RSB
                                     0013  4200 ;
                                     0013  4300 ; RESERVATION COUNT JUST WENT EMPTY OR WAS ALREADY EMPTY, SEE WHICH
                                     0013  4400 ;
            50         1C A1     D2  0013  4500 20$:	MCOML	PFL$L_RESERVCNT(R1),R0	;IS IT NOW -1?
                          F2     13  0017  4600 	BEQL	10$			;BRANCH IF YES, SUCCESSFULLY RESERVED
                       1C A1     D6  0019  4700 	INCL	PFL$L_RESERVCNT(R1)	;SET IT BACK TO WHERE IT WAS
                                     001C  4800 RESERV_EMPTY:
            50         0C A1     D0  001C  4900 	MOVL	PFL$L_WINDOW(R1),R0	;RETURN FAILURE INDICATION
                                 05  0020  5000 	RSB
PAGEFILE        - ALLOCATE / DEALLOCATE PAGING FILE              21-AUG-1978 20:03:12   VAX-11 MACRO X0.3-11               Page   4
X0107           ALCPAGFIL - ALLOCATE A PAGING FILE PAGE                                                                          (3)

                                     0021   100 	.SBTTL	ALCPAGFIL - ALLOCATE A PAGING FILE PAGE
                                     0021   200 
                                     0021   300 ;++
                                     0021   400 ; FUNCTIONAL DESCRIPTION:
                                     0021   500 ;
                                     0021   600 ;	THIS ROUTINE ALLOCATES A CLUSTER OF PAGES FROM THE SPECIFIED PAGING FILE.
                                     0021   700 ;
                                     0021   800 ; CALLING SEQUENCE:
                                     0021   900 ;
                                     0021  1000 ;	BSBW	MMG$ALCPAGFIL
                                     0021  1100 ;
                                     0021  1200 ; INPUT PARAMETERS:
                                     0021  1300 ;
                                     0021  1400 ;	R1 = PAGE FILE INDEX
                                     0021  1450 ;	R2 = NO. OF PAGES DESIRED, (NOTE: 32 PAGE RESTRICTION IS LIFTED)
                                     0021  1500 ;
                                     0021  1600 ; IMPLICIT INPUTS:
                                     0021  1650 ;
                                     0021  1700 ;	NONE
                                     0021  1800 ;
                                     0021  1900 ; OUTPUT PARAMETERS:
                                     0021  2000 ;
                                     0021  2100 ;	R0 = PAGE FILE VBN (GREATER THAN 0) IF SUCCESSFUL
                                     0021  2200 ;	   = NEGATIVE IF PAGE FILE EMPTY AND INITIALIZED
                                     0021  2300 ;	   = 0 IF PAGE FILE EMPTY AND NOT INITIALIZED
                                     0021  2350 ;	R2 = NUMBER OF PAGES ALLOCATED
                                     0021  2400 ;
                                     0021  2500 ; IMPLICIT OUTPUTS:
                                     0021  2550 ;
                                     0021  2600 ;	NONE
                                     0021  2700 ;
                                     0021  2800 ; COMPLETION CODES:
                                     0021  2850 ;
                                     0021  2900 ;	NONE
                                     0021  3000 ;
                                     0021  3100 ; SIDE EFFECTS:
                                     0021  3150 ;
                                     0021  3200 ;	NONE
                                     0021  3300 ;
                                     0021  3400 ;--
                                     0021  3500 
                                     0021  4000 MMG$ALCPAGFIL::
            51       0000'DF41   D0  0021  4100 	MOVL	@W^MMG$GL_PAGSWPVC[R1],R1 ;GET PAGE FILE CONTROL BLOCK ADDRESS
                                     0027  4200 ;
                                     0027  4300 ; R1 = THE PAGE FILE CONTROL BLOCK BASE ADDRESS UNTIL STATED OTHERWISE.
                                     0027  4310 ;
         1C A1            52     D1  0027  4320 	CMPL	R2,PFL$L_RESERVCNT(R1)	;ENOUGH PAGES NOT ALREADY RESERVED?
                          07     15  002B  4330 	BLEQ	5$			;BRANCH IF YES
         1C A1            01     C1  002D  4340 	ADDL3	#1,PFL$L_RESERVCNT(R1),R2 ;MAY ONLY ALLOCATE WHAT IS NOT RESERVED
                          52         0031       
                          E8     13  0032  4350 	BEQL	RESERV_EMPTY		;BRANCH IF NOTHING LEFT AT ALL
         04 A1            03     78  0034  4500 5$:	ASHL	#3,PFL$L_STARTBYTE(R1),R0 ;R0 = BIT # TO START AT
                          50         0038       
            08            50     EA  0039  4600 10$:	FFS	R0,#8,@PFL$L_BITMAP(R1),R0 ;ANY BITS SET IN THIS BYTE?
            50         00 B1         003C       
                          61     13  003F  4620 	BEQL	40$			;BRANCH IF NO
                          50     DD  0041  4640 	PUSHL	R0			;SAVE STARTING BIT NUMBER
PAGEFILE        - ALLOCATE / DEALLOCATE PAGING FILE              21-AUG-1978 20:03:12   VAX-11 MACRO X0.3-11               Page   5
X0107           ALCPAGFIL - ALLOCATE A PAGING FILE PAGE                                                                          (3)

            20            52     D1  0043  4660 14$:	CMPL	R2,#32			;IF NEED LESS THAN A LONG WORD WORTH
                          22     19  0046  4680 	BLSS	22$			;GO FIND THE FIRST CLEAR BIT
            20            50     EC  0048  4700 	CMPV	R0,#32,@PFL$L_BITMAP(R1),#-1 ;NEXT 32 BITS ALL ONES?
   FFFFFFFF 8F         00 B1         004B       
                          13     12  0052  4720 	BNEQ	20$			;BRANCH IF NOT, MUST FIND FIRST CLEAR
            50            00     F0  0054  4740 	INSV	#0,R0,#32,@PFL$L_BITMAP(R1) ;ALLOCATE THAT GROUP
         00 B1            20         0057       
            50            20     C0  005A  4760 	ADDL	#32,R0			;ADVANCE THE BIT POINTER
            52            20     C2  005D  4780 	SUBL	#32,R2			;THAT MANY FEWER BLOCKS TO BE ALLOCATED
                          E1     14  0060  4800 	BGTR	14$			;BRANCH IF STILL MORE TO ALLOCATE
            53            50     D0  0062  4810 	MOVL	R0,R3			;ADDRESS OF FIRST BIT NOT ALLOCATED
                          13     11  0065  4820 	BRB	26$
            52            20     D0  0067  4830 20$:	MOVL	#32,R2			;MAXIMUM NO. OF BITS TO SCAN OVER
            52            50     EB  006A  4900 22$:	FFC	R0,R2,@PFL$L_BITMAP(R1),R3 ;FIND FIRST CLEAR UP TO CLUSTER SIZE
            53         00 B1         006D       
            53            50     C3  0070  4950 	SUBL3	R0,R3,R2		;NUMBER OF SEQUENTIAL BITS THAT WERE SET
                          52         0073       
            50            00     F0  0074  5000 	INSV	#0,R0,R2,@PFL$L_BITMAP(R1) ;CLEAR THEM ALL
         00 B1            52         0077       
                          01     BA  007A  5010 26$:	POPR	#^M<R0>			;RECOVER STARTING BIT NUMBER
            53            50     C3  007C  5020 	SUBL3	R0,R3,R2		;TOTAL NUMBER OF BLOCKS ALLOCATED
                          52         007F       
         18 A1            52     C2  0080  5050 	SUBL	R2,PFL$L_FREPAGCNT(R1)	;UPDATE COUNT OF AVAILABLE PAGES
         1C A1            52     C2  0084  5060 	SUBL	R2,PFL$L_RESERVCNT(R1)	;ALSO OF PAGES THAT MAY BE RESERVED
                          50     D6  0088  5200 	INCL	R0			;VBN'S NEED TO BE BASED AT 1
            53         FD 8F     78  008A  5300 	ASHL	#-3,R3,PFL$L_STARTBYTE(R1) ;UPDATE STARTING BYTE
                       04 A1         008E       
         14 A1         04 A1     D1  0090  5400 	CMPL	PFL$L_STARTBYTE(R1),PFL$L_BITMAPSIZ(R1) ;WRAP AROUND BIT MAP?
                          0A     19  0095  5500 	BLSS	30$			;BRANCH IF NO
                          47     14  0097  5600 	BGTR	BADALLOC		;BRANCH IF BAD PAGE ALLOCATED
            53            07     D3  0099  5700 	BITL	#7,R3			;LAST PAGE IN PAGE FILE?
                          42     12  009C  5800 	BNEQ	BADALLOC		;BRANCH IF NO, BAD PAGE ALLOCATED
                       04 A1     D4  009E  5900 	CLRL	PFL$L_STARTBYTE(R1)	;WRAP AROUND THE PAGE FILE
                                     00A1  6000 30$:
                                 05  00A1  6100 	RSB
                                     00A2  6200 ;
                                     00A2  6300 ; R0 = BIT POSITION OF 1ST BIT IN THE NEXT BYTE, SCAN FOR NON ZERO BYTE
                                     00A2  6400 ;
                          52     DD  00A2  6500 40$:	PUSHL	R2			;SAVE CLUSTER SIZE
            53            51     D0  00A4  6600 	MOVL	R1,R3			;PAGE FILE CONTROL BLOCK
                                     00A7  6700 ;
                                     00A7  6800 ; R3 = PAGE FILE CONTROL BLOCK BASE ADDRESS FOR THE REST OF THE PAGE
                                     00A7  6900 ;
            50         FD 8F     78  00A7  7000 	ASHL	#-3,R0,R2		;R2 = BYTE OFFSET TO 1ST BYTE TO SCAN
                          52         00AB       
         14 A3            52     C3  00AC  7100 	SUBL3	R2,PFL$L_BITMAPSIZ(R3),R0 ;R0 = COUNT OF BYTES REMAINING
                          50         00B0       
                          0A     15  00B1  7200 	BLEQ	50$			;BRANCH IF NO BYTE LEFT
            52            63     C1  00B3  7300 	ADDL3	PFL$L_BITMAP(R3),R2,R1	;R1 = ADR TO START SCAN
                          51         00B6       
            50            00     3B  00B7  7400 	SKPC	#0,R0,(R1)		;SCAN FOR NON-ZERO BYTE
                          61         00BA       
                          14     12  00BB  7500 	BNEQ	70$			;BRANCH IF FOUND ONE
                                     00BD  7600 ;
                                     00BD  7700 ; DIDN'T FIND ANY AVAILABLE BITS IN LAST PART OF BITMAP
                                     00BD  7800 ; R2 = NO. OF BYTES TO SCAN FROM THE FRONT
                                     00BD  7900 ;
PAGEFILE        - ALLOCATE / DEALLOCATE PAGING FILE              21-AUG-1978 20:03:12   VAX-11 MACRO X0.3-11               Page   6
X0107           ALCPAGFIL - ALLOCATE A PAGING FILE PAGE                                                                          (3)

                                     00BD  8000 50$:
            52            00     3B  00BD  8100 	SKPC	#0,R2,@PFL$L_BITMAP(R3)	;TRY AGAIN FROM THE TOP
                       00 B3         00C0       
                          0D     12  00C2  8200 	BNEQ	70$			;BRANCH IF FOUND ONE
                                     00C4  8300 ;
                                     00C4  8400 ; PAGE FILE IS EMPTY
                                     00C4  8500 ;
                          01     BA  00C4  8550 	POPR	#^M<R0>			;CLEAN OFF SAVED CLUSTER
            50         18 A3     D2  00C6  8600 	MCOML	PFL$L_FREPAGCNT(R3),R0	;CONSISTENT COUNT?
                          18     12  00CA  8700 	BNEQ	BADFRECNT		;BRANCH IF NOT
            50         0C A3     D0  00CC  8800 	MOVL	PFL$L_WINDOW(R3),R0	;RETURN NEGATIVE IF INITIALIZED
                                     00D0  8900 					;OR 0 IF NOT
                                 05  00D0  9000 	RSB
                                     00D1  9100 ;
                                     00D1  9200 ; R1 = BYTE ADDRESS OF NON ZERO BYTE
                                     00D1  9300 ;
                                     00D1  9400 70$:
            51            63     C2  00D1  9500 	SUBL	PFL$L_BITMAP(R3),R1	;R1 = BYTE OFFSET TO 1ST NON-ZERO BYTE
            51            03     78  00D4  9600 	ASHL	#3,R1,R0		;R0 = BIT # OF THE BYTE
                          50         00D7       
            51            53     D0  00D8  9700 	MOVL	R3,R1			;BACK TO PAGE FILE CONTROL BLOCK IN R1
                          04     BA  00DB  9750 	POPR	#^M<R2>			;RECOVER CLUSTER SIZE
                          FF59   31  00DD  9800 	BRW	10$
                                     00E0  9850 
                                     00E0  9900 BADALLOC:
                                     00E0 10000 	BUG_CHECK BADPAGFILA,FATAL	;BAD PAGE FILE ADDRESS ALLOCATED
                                     00E4 10100 BADFRECNT:
                                     00E4 10200 	BUG_CHECK IFREPAGCNT,FATAL	;INCONSISTENT FREE PAGE COUNT
PAGEFILE        - ALLOCATE / DEALLOCATE PAGING FILE              21-AUG-1978 20:03:12   VAX-11 MACRO X0.3-11               Page   7
X0107           DALCPAGFIL - DEALLOCATE PAGE IN PAGING FILE                                                                      (4)

                                     00E8   100 	.SBTTL	DALCPAGFIL - DEALLOCATE PAGE IN PAGING FILE
                                     00E8   200 
                                     00E8   300 ;++
                                     00E8   400 ; FUNCTIONAL DESCRIPTION:
                                     00E8   500 ;
                                     00E8   600 ;	THIS ROUTINE DEALLOCATES A SPECIFIED PAGE IN THE SPECIFIED
                                     00E8   700 ;	PAGING FILE.
                                     00E8   800 ;
                                     00E8   900 ; CALLING SEQUENCE:
                                     00E8  1000 ;
                                     00E8  1100 ;	BSBW	MMG$DALCPAGFIL
                                     00E8  1200 ;
                                     00E8  1300 ; INPUT PARAMETERS:
                                     00E8  1400 ;
                                     00E8  1500 ;	R0 = PAGE FILE VBN TO DEALLOCATE
                                     00E8  1550 ;	   = PTE$M_PGFLVB (LARGEST POSSIBLE VBN) IF ONLY "UNRESERVING"
                                     00E8  1600 ;	R1 = PAGE FILE INDEX
                                     00E8  1700 ;
                                     00E8  1800 ; IMPLICIT INPUTS:
                                     00E8  1900 ;	NONE
                                     00E8  2000 ;
                                     00E8  2100 ; OUTPUT PARAMETERS:
                                     00E8  2200 ;	NONE
                                     00E8  2300 ;
                                     00E8  2400 ; IMPLICIT OUTPUTS:
                                     00E8  2500 ;
                                     00E8  2600 ;	IF THE SPECIFIED PAGING FILE BECOMES NON-EMPTY, THE RESOURCE
                                     00E8  2700 ;	AVAILABLE SIGNAL IS ISSUED FOR THE RSN$_PGFILE RESOURCE
                                     00E8  2800 ;
                                     00E8  2900 ; COMPLETION CODES:
                                     00E8  3000 ;	NONE
                                     00E8  3100 ;
                                     00E8  3200 ; SIDE EFFECTS:
                                     00E8  3300 ;	NONE
                                     00E8  3400 ;
                                     00E8  3500 ;--
                                     00E8  3600 
                                     00E8  3700 MMG$DALCPAGFIL::
            51       0000'DF41   D0  00E8  3800 	MOVL	@W^MMG$GL_PAGSWPVC[R1],R1 ;GET BASE ADDRESS FROM INDEX
            50   003FFFFF 8F     D1  00EE  3820 	CMPL	#PTE$M_PGFLVB,R0	;JUST GIVING BACK A RESERVATION?
                          1F     13  00F5  3840 	BEQL	20$			;BRANCH IF YES
                          50     D7  00F7  3900 	DECL	R0			;BIT # IS BASE 0
            50         FD 8F     78  00F9  4000 	ASHL	#-3,R0,R2		;BYTE # IN BIT MAP
                          52         00FD       
         14 A1            52     D1  00FE  4100 	CMPL	R2,PFL$L_BITMAPSIZ(R1)	;LEGAL PAGE FILE VBN?
                          05     1E  0102  4200 	BGEQU	5$			;BRANCH IF ILLEGAL
         00 B1            50     E3  0104  4300 	BBCS	R0,@PFL$L_BITMAP(R1),10$ ;FREE THE PAGE AND BRANCH
                          04         0108       
                                     0109  4400 5$:
                                     0109  4500 	BUG_CHECK BADPAGFILD,FATAL	;BAD PAGE FILE ADDRESS DEALLOCATED
                                     010D  4600 10$:
                       18 A1     D6  010D  4700 	INCL	PFL$L_FREPAGCNT(R1)	;COUNT ANOTHER FREE PAGE
                          04     12  0110  4800 	BNEQ	20$			;BRANCH IF THIS IS NOT THE 1ST PAGE
         04 A1            52     D0  0112  4900 	MOVL	R2,PFL$L_STARTBYTE(R1)	;NOTE WHERE THE ONLY VBN IS
                       1C A1     D6  0116  4920 20$:	INCL	PFL$L_RESERVCNT(R1)	;ONE LESS RESERVED PAGE
                          01     13  0119  4940 	BEQL	30$			;BRANCH IF RESERVATION COUNTER
                                     011B  4960 					;JUST WENT FROM EMPTY TO NOT EMPTY
PAGEFILE        - ALLOCATE / DEALLOCATE PAGING FILE              21-AUG-1978 20:03:12   VAX-11 MACRO X0.3-11               Page   8
X0107           DALCPAGFIL - DEALLOCATE PAGE IN PAGING FILE                                                                      (4)

                                 05  011B  4980 	RSB
            50            04     D0  011C  5000 30$:	MOVL	#RSN$_PGFILE,R0		;PAGE FILE AVAILBLE
                          FEDE'  31  011F  5100 	BRW	SCH$RAVAIL		;SIGNAL RESOURCE AVAILABLE
                                     0122  5200 					;AND RETURN TO CALLER OF THIS ROUTINE
                                     0122  5400 
                                     0122  5500 
                                     0122  5600 
                                     0122  5700 	.END
PAGEFILE        - ALLOCATE / DEALLOCATE PAGING FILE              21-AUG-1978 20:03:12   VAX-11 MACRO X0.3-11               Page   9
SYMBOL TABLE                                                                                                                     (4)

BADALLOC         000000E0 R     03   PTE$S_PGFLVB   = 00000016            
BADFRECNT        000000E4 R     03   PTE$S_PROT     = 00000004            
BIT...         = 00000008            PTE$S_STX      = 00000010            
BUG$_BADPAGFILA  ********   X   03   PTE$V_CRF      = 00000010            
BUG$_BADPAGFILD  ********   X   03   PTE$V_DZRO     = 00000011            
BUG$_IFREPAGCNT  ********   X   03   PTE$V_GPTX     = 00000000            
GBL...         = 00000000            PTE$V_MODIFY   = 0000001A            
MMG$ALCPAGFIL    00000021 RG    03   PTE$V_OWN      = 00000017            
MMG$DALCPAGFIL   000000E8 RG    03   PTE$V_PFN      = 00000000            
MMG$GL_PAGSWPVC  ********   X   03   PTE$V_PGFLVB   = 00000000            
MMG$RSRVPAGFIL   00000000 RG    03   PTE$V_PROT     = 0000001B            
PFL$B_PFC        0000000B            PTE$V_STX      = 00000000            
PFL$B_TYPE       0000000A            PTE$V_TYP0     = 00000016            
PFL$C_LENGTH     00000020            PTE$V_TYP1     = 0000001A            
PFL$K_LENGTH     00000020            PTE$V_VALID    = 0000001F            
PFL$L_BITMAP     00000000            PTE$V_WRT      = 00000012            
PFL$L_BITMAPSIZ  00000014            RESERV_EMPTY     0000001C R     03   
PFL$L_FREPAGCNT  00000018            RSN$_ASTWAIT   = 00000001            
PFL$L_RESERVCNT  0000001C            RSN$_BRKTHRU   = 00000006            
PFL$L_STARTBYTE  00000004            RSN$_IACLOCK   = 00000007            
PFL$L_VBN        00000010            RSN$_MAILBOX   = 00000002            
PFL$L_WINDOW     0000000C            RSN$_NPDYNMEM  = 00000003            
PFL$W_SIZE       00000008            RSN$_PGDYNMEM  = 00000005            
PTE$C_EOWN     = 00800000            RSN$_PGFILE    = 00000004            
PTE$C_ER       = 38000000            SCH$RAVAIL       ********   X   03   
PTE$C_ERKW     = 30000000            
PTE$C_EW       = 28000000            
PTE$C_KOWN     = 00000000            
PTE$C_KR       = 18000000            
PTE$C_KW       = 10000000            
PTE$C_NA       = 00000000            
PTE$C_SOWN     = 01000000            
PTE$C_SR       = 58000000            
PTE$C_SREW     = 48000000            
PTE$C_SRKW     = 50000000            
PTE$C_SW       = 40000000            
PTE$C_UOWN     = 01800000            
PTE$C_UR       = 78000000            
PTE$C_UREW     = 68000000            
PTE$C_URKW     = 70000000            
PTE$C_URSW     = 60000000            
PTE$C_UW       = 20000000            
PTE$M_CRF      = 00010000            
PTE$M_DZRO     = 00020000            
PTE$M_GPTX     = 003FFFFF            
PTE$M_MODIFY   = 04000000            
PTE$M_OWN      = 01800000            
PTE$M_PFN      = 001FFFFF            
PTE$M_PGFLVB   = 003FFFFF            
PTE$M_PROT     = 78000000            
PTE$M_TYP0     = 00400000            
PTE$M_TYP1     = 04000000            
PTE$M_VALID    = 80000000            
PTE$M_WRT      = 00040000            
PTE$S_GPTX     = 00000016            
PTE$S_OWN      = 00000002            
PTE$S_PFN      = 00000015            
PAGEFILE        - ALLOCATE / DEALLOCATE PAGING FILE              21-AUG-1978 20:03:12   VAX-11 MACRO X0.3-11               Page  10
PROGRAM SECTION SYNOPSIS                                                                                                         (4)



PROGRAM SECTION SYNOPSIS

.  ABS  .        00000000      00     NOPIC   USR   CON   ABS   LCL NOSHR NOEXE NORD  NOWRT BYTE  
. BLANK .        00000000      01     NOPIC   USR   CON   REL   LCL NOSHR   EXE   RD    WRT BYTE  
$ABS$            00000020      02     NOPIC   USR   CON   ABS   LCL NOSHR   EXE   RD    WRT BYTE  
$MMGCOD          00000122      03     NOPIC   USR   CON   REL   LCL NOSHR   EXE   RD    WRT BYTE  


THERE WERE NO ERRORS OR WARNINGS.
24056. BYTES LEFT IN FREE MEMORY POOL.
652. BYTES OF RECLAIMED MEMORY.
OBJ$:PAGEFILE,LIS$:PAGEFILE/-SP=EXECML$/ML,SRC$:PAGEFILE
2 MLB DIR RDS - 187 GETS TO DEFINE 13 MACROS. 12 INTER. FILE WRITES. 
