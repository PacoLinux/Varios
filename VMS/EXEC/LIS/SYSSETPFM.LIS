SYSSETPFM       - SET PAGE FAULT MONITORING                      21-AUG-1978 20:42:28   VAX-11 MACRO X0.3-11               Page   0
TABLE OF CONTENTS   

   (2)      45  DECLARATIONS
   (3)     131  SYSSETPFM - Initialize Page Fault Monitoring
   (4)     291  CLEANUP - Termination Processing
   (5)     347  PFM$PURGE - Return all buffers to pool
   (6)     433  PFM$MON - Resident Monitoring Code
   (7)     511  ALLPMBLST - Allocate list of control block addr
SYSSETPFM       - SET PAGE FAULT MONITORING                      21-AUG-1978 20:42:28   VAX-11 MACRO X0.3-11               Page   1
01                                                                                                                               (1)

                                     0000     1 
                                     0000     2 	.TITLE  SYSSETPFM - SET PAGE FAULT MONITORING
                                     0000     3 	.IDENT	/01/
                                     0000     4 
                                     0000     5 ;
                                     0000     6 ; COPYRIGHT (C) 1978
                                     0000     7 ; DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASSACHUSETTS 01754
                                     0000     8 ;
                                     0000     9 ; THIS SOFTWARE IS FURNISHED  UNDER A LICENSE FOR USE ONLY ON A SINGLE
                                     0000    10 ; COMPUTER  SYSTEM AND  MAY BE  COPIED ONLY WITH  THE INCLUSION OF THE
                                     0000    11 ; ABOVE COPYRIGHT NOTICE.  THIS SOFTWARE, OR ANY OTHER COPIES THEREOF,
                                     0000    12 ; MAY NOT BE PROVIDED OR  OTHERWISE MADE AVAILABLE TO ANY OTHER PERSON
                                     0000    13 ; EXCEPT FOR USE ON SUCH SYSTEM AND TO ONE WHO AGREES TO THESE LICENSE
                                     0000    14 ; TERMS.  TITLE TO AND  OWNERSHIP OF THE  SOFTWARE  SHALL AT ALL TIMES
                                     0000    15 ; REMAIN IN DEC.
                                     0000    16 ;
                                     0000    17 ; THE INFORMATION IN THIS SOFTWARE IS SUBJECT TO CHANGE WITHOUT NOTICE
                                     0000    18 ; AND SHOULD  NOT BE CONSTRUED  AS A COMMITMENT  BY DIGITAL  EQUIPMENT
                                     0000    19 ; CORPORATION.
                                     0000    20 ;
                                     0000    21 ; DEC ASSUMES  NO  RESPONSIBILITY  FOR  THE USE OR  RELIABILITY OF ITS
                                     0000    22 ; SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DEC.
                                     0000    23 
                                     0000    24 ;++
                                     0000    25 ; FACILITY: Measurement System Service
                                     0000    26 ;
                                     0000    27 ; ABSTRACT:
                                     0000    28 ;
                                     0000    29 ;	This module enables a page fault monitoring service within the
                                     0000    30 ;	operating system.  A file is created in which fault information
                                     0000    31 ;	will be stored for post processing.  On each page fault, the
                                     0000    32 ;	virtual address and the PC are saved in a buffer to be output
                                     0000    33 ;	to the file.
                                     0000    34 ;
                                     0000    35 ; ENVIRONMENT: Kernel Mode
                                     0000    36 ;
                                     0000    37 ; AUTHOR: Henry M. Levy	, CREATION DATE: 7-May-1977
                                     0000    38 ;
                                     0000    39 ; MODIFIED BY:
                                     0000    40 ;
                                     0000    41 ;	, : VERSION
                                     0000    42 ; 01	- DYNAMICALLY ALLOCATE PMB, 17-JULY-1978, HML
                                     0000    43 ;--
SYSSETPFM       - SET PAGE FAULT MONITORING                      21-AUG-1978 20:42:28   VAX-11 MACRO X0.3-11               Page   2
01              DECLARATIONS                                                                                                     (2)

                                     0000    45 	.SBTTL	DECLARATIONS
                                     0000    46 ;
                                     0000    47 ; INCLUDE FILES:
                                     0000    48 ;
                                     0000    49 
                                     0000    50 ;
                                     0000    51 ; MACROS:
                                     0000    52 ;
                                     0000    53 
                                     0000    54 	$IODEF				; define I/O function codes
                                     0000    55 	$IPLDEF				; define interrupt priority levels
                                     0000    56 	$PCBDEF				; define process control block
                                     0000    57 	$PHDDEF				; define process header
                                     0000    58 	$PMBDEF				; define page fault monitor control block
                                     0000    59 	$PQLDEF				; define process quota codes
                                     0000    60 	$PRDEF				; define processor registers
                                     0000    61 	$SGNDEF				; define system parameters
                                     0000    62 	$SSDEF				; define service status codes
                                     0000    63 
                                     0000    64 	.MACRO	$QUOTA	NAME=LISTEND,VALUE=0
                                     0000    65 	.BYTE	PQL$_'NAME
                                     0000    66 	.LONG	VALUE
                                     0000    67 	.ENDM	$QUOTA
                                     0000    68 
                                     0000    69 ;
                                     0000    70 ; EQUATED SYMBOLS:
                                     0000    71 ;
                                     0000    72 
                           00000005  0000    73 BUFCNT = 5				; number of buffers to allocate
                           0000020C  0000    74 BUFSIZ = 512+12				; size of buffers
                           00000038  0000    75 FAULTVA = <4*7>+4+<6*4>			; offset to va of faulting instruction
                           0000003C  0000    76 FAULTPC = <4*7>+8+<6*4>			; offset to pc of faulting instruction
                           00000014  0000    77 WSSIZE = 20				; size of working set
                                     0000    78 
                                     0000    79 ;
                                     0000    80 ; OWN STORAGE:
                                     0000    81 ;
                                     0000    82 
                                     0000    83 
                                 00000000    84 	.PSECT	$$$215,LONG
                                     0000    85 ;
                                     0000    86 ; PMBLST is a list of pointers to page fault monitor control blocks.
                                     0000    87 ; There can be one entry for each process in the system and the list is
                                     0000    88 ; indexed by process index.  This allows the created subprocess to find
                                     0000    89 ; its queue header in the PMB by using the process index of its creator.
                                     0000    90 ;
                                     0000    91 
                                     0000    92 ;
                                     0000    93 ; do not change order
                                     0000    94 ;
                                     0000    95 
                                     0000    96 PFM$GL_SIZE::				; size of allocated block
                           00000000  0000    97 	.LONG	0
                                     0004    98 PFM$GL_PMBLST::				; pointer to PMB list
                           00000000  0004    99 	.LONG	0
                                     0008   100 PFMCOUNT:
                           FFFFFFFF  0008   101 	.LONG	-1			; number of processes using monitor
SYSSETPFM       - SET PAGE FAULT MONITORING                      21-AUG-1978 20:42:28   VAX-11 MACRO X0.3-11               Page   3
01              DECLARATIONS                                                                                                     (2)

                                     000C   102 
                                 00000000   103 	.PSECT	YEXEPAGED,LONG
                                     0000   104 
                                     0000   105 ;
                                     0000   106 ; Data for creation of subprocess to output filled
                                     0000   107 ; buffers to disk file.
                                     0000   108 ;
                                     0000   109 
                                     0000   110 PFMFILWRT:				; subprocess image name descriptor
                           00000018' 0000   111 	.LONG	20$-10$
                           00000008' 0004   112 	.LONG	10$
50 3A 4D 45 54 53 59 53 24 53 59 53  0008   113 10$:	.ASCII	/SYS$SYSTEM:PFMFILWRT.EXE/
45 58 45 2E 54 52 57 4C 49 46 4D 46  0014       
                                     0020   114 20$:
                                     0020   115 PFMQUOTA:				; subprocess quota name
                                     0020   116 	$QUOTA	CPULM,0			; infinite CPU time
                                     0025   117 	$QUOTA	BYTLM,1024		; byte limit for buffered I/O
                                     002A   118 	$QUOTA	FILLM,1			; open file count limit
                                     002F   119 	$QUOTA	PGFLQUOTA,256		; paging file quota
                                     0034   120 	$QUOTA	PRCLM,0			; no subprocesses
                                     0039   121 	$QUOTA	TQELM,1			; timer queue entry
                                     003E   122 	$QUOTA	LISTEND			; end of list
                                     0043   123 FILWRT:					; subprocess process name
                           00000009' 0043   124 	.LONG	20$-10$
                           0000004B' 0047   125 	.LONG	10$
         54 52 57 4C 49 46 4D 46 50  004B   126 10$:	.ASCII	/PFMFILWRT/
                                     0054   127 20$:
                                     0054   128 FILWRTPRV:				; subprocess privilege vector
                  FFFFFFFF FFFFFFFF  0054   129 	.LONG	-1,-1			; all privileges
SYSSETPFM       - SET PAGE FAULT MONITORING                      21-AUG-1978 20:42:28   VAX-11 MACRO X0.3-11               Page   4
01              SYSSETPFM - Initialize Page Fault Monitoring                                                                     (3)

                                     005C   131 	.SBTTL	SYSSETPFM - Initialize Page Fault Monitoring
                                     005C   132 	.LIST	MEB
                                     005C   133 ;++
                                     005C   134 ; FUNCTIONAL DESCRIPTION:
                                     005C   135 ;
                                     005C   136 ;	Page fault monitoring initialization.  Buffers are allocated from
                                     005C   137 ;	the nonpaged pool and queued for use by the monitor.  A subprocess
                                     005C   138 ;	is created which outputs buffers which have been filled.
                                     005C   139 ;	When the process calls SETPFM to turn off monitoring, all
                                     005C   140 ;	buffers are returned to the system and the subprocess is
                                     005C   141 ;	deleted.  In case of abnormal termination, the buffers
                                     005C   142 ;	are returned by SYSRUNDWN.
                                     005C   143 ;
                                     005C   144 ; CALLING SEQUENCE:
                                     005C   145 ;
                                     005C   146 ;	CALLS/CALLG
                                     005C   147 ;
                                     005C   148 ; INPUT PARAMETERS:
                                     005C   149 ;
                                     005C   150 ;	PFMFLG - low bit set -> begin page fault monitoring
                                     005C   151 ;		 low bit clear -> turn off monitoring
                                     005C   152 ;
                                     005C   153 ; IMPLICIT INPUTS:
                                     005C   154 ;
                                     005C   155 ;	none
                                     005C   156 ;
                                     005C   157 ; OUTPUT PARAMETERS:
                                     005C   158 ;
                                     005C   159 ;	none
                                     005C   160 ;
                                     005C   161 ; IMPLICIT OUTPUTS:
                                     005C   162 ;
                                     005C   163 ;	none
                                     005C   164 ;
                                     005C   165 ; COMPLETION CODES:
                                     005C   166 ;
                                     005C   167 ;	SS$_NORMAL - service successful
                                     005C   168 ;	SS$_EXQUOTA - process does not have sufficient buffered I/O
                                     005C   169 ;		     limit
                                     005C   170 ;	SS$_INSFMEM - not enough dynamic memory was available 
                                     005C   171 ;		      for buffering
                                     005C   172 ;
                                     005C   173 ; SIDE EFFECTS:
                                     005C   174 ;
                                     005C   175 ;	none
                                     005C   176 ;
                                     005C   177 ;--
                                     005C   178 
                                     005C   179 
                                     005C   180 
                                 0000005C   181 	.PSECT	YEXEPAGED
                                     005C   182 EXE$SETPFM::
                                     005C   183 
                               01FC  005C   184 	.WORD	^M<R2,R3,R4,R5,R6,R7,R8> ; register save mask
            50       0104 8F     3C  005E   185 	MOVZWL	#SS$_ILLSER,R0		; not yet available for rel. 1
                                 04  0063   186 	RET				; return to caller
            51   00000000'EF     3C  0064   187 	MOVZWL	SGN$GW_MAXPRCCT,R1	; compute PMB size for allocation
SYSSETPFM       - SET PAGE FAULT MONITORING                      21-AUG-1978 20:42:28   VAX-11 MACRO X0.3-11               Page   5
01              SYSSETPFM - Initialize Page Fault Monitoring                                                                     (3)

            51            04     C4  006B   188 	MULL	#4,R1			; 
                 0000005C'EF     16  006E   189 	JSB	PFM$ALLPMBLST		; allocate PMBLST if needed
            03            50     E8  0074   190 	BLBS	R0,5$			; continue if success
                          00FA   31  0077   191 	BRW	80$			; else take error path
                                     007A   192 5$:
            54   00000000'EF     D0  007A   193 	MOVL	SCH$GL_CURPCB,R4	; get our PCB address
            50         60 A4     3C  0081   194 	MOVZWL	PCB$L_PID(R4),R0	; get current process index
            57   00000004'FF40   DE  0085   195 	MOVAL	@PFM$GL_PMBLST[R0],R7	; load address of PMB pointer slot
            58   00000000'9F     D0  008D   196 	MOVL	@#CTL$GL_PHD,R8		; load process header address
            03         04 AC     E8  0094   197 	BLBS	4(AP),10$		; branch if initialization call
                          00DE   31  0098   198 	BRW	CLEANUP			; else close up 
                                     009B   199 10$:
                          67     D5  009B   200 	TSTL	(R7)			; see if block already allocated
                          06     13  009D   201 	BEQL	20$			; branch if not
            50       0204 8F     3C  009F   202 	MOVZWL	#SS$_PFMBSY,R0		; else already in use
                                 04  00A4   203 	RET
                                     00A5   204 
                                     00A5   205 ;
                                     00A5   206 ; Check that process has sufficient buffered I/O quota for
                                     00A5   207 ; the data buffers.  Allocate Page Fault Monitor Control Block (PMB)
                                     00A5   208 ; and link to PMBLST.
                                     00A5   209 ;
                                     00A5   210 
                                     00A5   211 20$:
            55            05     3C  00A5   212 	MOVZWL	#BUFCNT,R5		; number of data buffers to allocate
            51            21     3C  00A8   213 	MOVZWL	#PMB$C_LENGTH,R1	; get length of PMB block to allocate
                          1C     DD  00AB   214 	PUSHL	#SS$_EXQUOTA		; stack no quota error code
                                     00AD   215 	SETIPL	#IPL$_ASTDEL		; go to AST delivery level
            12            02     DA  00AD       		MTPR	#IPL$_ASTDEL,S^#PR$_IPL
                                     00B0   216 
                                     00B0   217 ;
                                     00B0   218 ; Process should have enough quota for data buffers and subprocess to
                                     00B0   219 ; be created, plus some left over.
                                     00B0   220 ;
                                     00B0   221 
         42 A4       0F3C 8F     B1  00B0   222 	CMPW	#<BUFSIZ*BUFCNT>+1024+256,PCB$W_BYTCNT(R4) ; does process have quota left?
                          0E     1A  00B6   223 	BGTRU	30$			; error if not
            6E       0124 8F     3C  00B8   224 	MOVZWL	#SS$_INSFMEM,(SP)	; assume memory not available
                 00000000'EF     16  00BD   225 	JSB	EXE$ALLOCBUF		; allocate control block
            06            50     E8  00C3   226 	BLBS	R0,40$			; check that memory available
                                     00C6   227 30$:	SETIPL	#0			; error, exit at IPL 0
            12            00     DA  00C6       		MTPR	#0,S^#PR$_IPL
                          0114   31  00C9   228 	BRW	EXIT			; take error exit
            56            52     D0  00CC   229 40$:	MOVL	R2,R6			; copy PMB block address
            67            56     D0  00CF   230 	MOVL	R6,(R7)			; insert PMB address in PMBLST slot
                                     00D2   231 
                                     00D2   232 ;
                                     00D2   233 ; Initialize queue headers in PMB and allocate and queue data buffers.
                                     00D2   234 ;
                                     00D2   235 
            50         0C A6     9E  00D2   236 	MOVAB	PMB$Q_HDR(R6),R0	; get queue header address
            60            60     DE  00D6   237 	MOVAL	(R0),(R0)		; init empty queue flink
            80            80     DE  00D9   238 	MOVAL	(R0)+,(R0)+		; init empty queue blink
            60            60     DE  00DC   239 	MOVAL	(R0),(R0)		; init subprocess queue flink
            60            80     DE  00DF   240 	MOVAL	(R0)+,(R0)		; init subprocess queue blink
                          66     D4  00E2   241 	CLRL	PMB$L_CURBUF(R6)	; note no current buffer
                                     00E4   242 
SYSSETPFM       - SET PAGE FAULT MONITORING                      21-AUG-1978 20:42:28   VAX-11 MACRO X0.3-11               Page   6
01              SYSSETPFM - Initialize Page Fault Monitoring                                                                     (3)

                                     00E4   243 50$:
            51       020C 8F     3C  00E4   244 	MOVZWL	#BUFSIZ,R1		; get size of buffer to allocate
                 00000000'EF     16  00E9   245 	JSB	EXE$ALLOCBUF		; allocate buffer
            D4            50     E9  00EF   246 	BLBC	R0,30$			; take error path if no memory available
         0C A6            62     0E  00F2   247 	INSQUE	(R2),PMB$Q_HDR(R6)	; queue on empty buffer list
            EB            55     F5  00F6   248 	SOBGTR	R5,50$			; back for more buffers
         42 A4       0A3C 8F     A2  00F9   249 	SUBW	#BUFSIZ*BUFCNT,PCB$W_BYTCNT(R4) ; adjust quota
                                     00FF   250 	SETIPL	#0			; drop back to IPL 0
            12            00     DA  00FF       		MTPR	#0,S^#PR$_IPL
                                     0102   251 
                                     0102   252 ;
                                     0102   253 ; Create a termination mailbox for the subprocess.
                                     0102   254 ;
                                     0102   255 
                                     0102   256 	$CREMBX_S CHAN=PMB$W_MBXCHN(R6),MAXMSG=#120,- ; create termination mailbox
                                     0102   257 		BUFQUO=#120,PROMSK=#0
                          00     DD  0102       		PUSHL	#0
                          7E     7C  0104       		CLRQ	-(SP)
                 00000078 8F     DD  0106       		PUSHL	#120
                 00000078 8F     DD  010C       		PUSHL	#120
                       0A A6     3F  0112       		PUSHAW	PMB$W_MBXCHN(R6)
                          00     DD  0115       		PUSHL	#0
   00000000'GF            07     FB  0117       		CALLS	#7,G^SYS$CREMBX
            53            50     E9  011E   258 60$:	BLBC	R0,80$			; check return status
            5E            10     C2  0121   259 	SUBL	#16,SP			; buffer space for GETCHN on stack
                          5E     DD  0124   260 	PUSHL	SP			; build descriptor for buffer
                          10     DD  0126   261 	PUSHL	#16			; length of buffer
            52            6E     DE  0128   262 	MOVAL	(SP),R2			; get descriptor address
                                     012B   263 	$GETCHN_S CHAN=PMB$W_MBXCHN(R6),PRIBUF=(R2) ; get mailbox unit #
                          00     DD  012B       		PUSHL	#0
                          00     DD  012D       		PUSHL	#0
                          62     7F  012F       		PUSHAQ	(R2)
                          00     DD  0131       		PUSHL	#0
            7E         0A A6     3C  0133       		MOVZWL	PMB$W_MBXCHN(R6),-(SP)
   00000000'GF            05     FB  0137       		CALLS	#5,G^SYS$GETCHN
                                     013E   264 
                                     013E   265 ;
                                     013E   266 ; Create subprocess at higher priority, with fill privilege and
                                     013E   267 ; termination mailbox
                                     013E   268 ;
                                     013E   269 
                                     013E   270 	$CREPRC_S	PIDADR=PMB$L_PID(R6),- ; pid of created process
                                     013E   271 			IMAGE=PFMFILWRT,-
                                     013E   272 			PRCNAM=FILWRT,-
                                     013E   273 			PRVADR=FILWRTPRV,-
                                     013E   274 			BASPRI=#7,-
                                     013E   275 			QUOTA=PFMQUOTA,-
                                     013E   276 			MBXUNT=8+12(R2),- ; unit from get channel information
                                     013E   277 			STSFLG=#4	; disable swapping
                          04     DD  013E       		PUSHL	#4
            7E         14 A2     3C  0140       		MOVZWL	8+12(R2),-(SP)
                          00     DD  0144       		PUSHL	#0
                          07     DD  0146       		PUSHL	#7
                     FEF7 CF     7F  0148       		PUSHAQ	FILWRT
                     FED0 CF     DF  014C       		PUSHAL	PFMQUOTA
                     FF00 CF     7F  0150       		PUSHAQ	FILWRTPRV
                          00     DD  0154       		PUSHL	#0
SYSSETPFM       - SET PAGE FAULT MONITORING                      21-AUG-1978 20:42:28   VAX-11 MACRO X0.3-11               Page   7
01              SYSSETPFM - Initialize Page Fault Monitoring                                                                     (3)

                          00     DD  0156       		PUSHL	#0
                          00     DD  0158       		PUSHL	#0
                     FEA2 CF     7F  015A       		PUSHAQ	PFMFILWRT
                       1C A6     DF  015E       		PUSHAL	PMB$L_PID(R6)
   00000000'GF            0C     FB  0161       		CALLS	#12,G^SYS$CREPRC
            09            50     E9  0168   278 	BLBC	R0,80$			; check for error
                                     016B   279 
                                     016B   280 ;
                                     016B   281 ; Turn on monitoring bit in process header before exiting
                                     016B   282 ;
                                     016B   283 
            50            01     3C  016B   284 	MOVZWL	#SS$_NORMAL,R0		; successful completion
         3A A8            00     E2  016E   285 	BBSS	#PHD$V_PFMFLG,PHD$W_FLAGS(R8),70$ ; turn on monitoring
                          00         0172       
                                 04  0173   286 70$:	RET				; return to caller
                                     0174   287 
                          50     DD  0174   288 80$:	PUSHL	R0			; save status code
                          0061   31  0176   289 	BRW	RETQUO			; return quota and exit
SYSSETPFM       - SET PAGE FAULT MONITORING                      21-AUG-1978 20:42:28   VAX-11 MACRO X0.3-11               Page   8
01              CLEANUP - Termination Processing                                                                                 (4)

                                     0179   291 	.SBTTL	CLEANUP - Termination Processing
                                     0179   292 ;++
                                     0179   293 ;
                                     0179   294 ; FUNCTIONAL DESCRIPTION:
                                     0179   295 ;
                                     0179   296 ;	Cleanup routine called to terminate page fault monitoring.  If
                                     0179   297 ;	there is a current buffer, the next entry is zeroed to note the
                                     0179   298 ;	end of valid data, and the buffer is placed on the end of
                                     0179   299 ;	the subprocess queue.  The subprocess is forced to exit, and its
                                     0179   300 ;	termination handler outputs all buffers and closes the file.  Then
                                     0179   301 ;	all buffers are returned to the nonpaged pool.
                                     0179   302 ;
                                     0179   303 ; INPUTS:
                                     0179   304 ;
                                     0179   305 ;	R4 = process PCB address
                                     0179   306 ;	R7 = address of pointer in PMBLST to control block
                                     0179   307 ;	R8 = process header address
                                     0179   308 ;
                                     0179   309 ;--
                                     0179   310 
                                     0179   311 CLEANUP:
                          01     DD  0179   312 	PUSHL	#SS$_NORMAL		; assume normal termination
         3A A8            00     E4  017B   313 	BBSC	#PHD$V_PFMFLG,PHD$W_FLAGS(R8),10$ ; check that monitor in use, branch if so
                          00         017F       
                                     0180   314 10$:
            56            67     D0  0180   315 	MOVL	(R7),R6			; get control block address
                          5B     13  0183   316 	BEQL	EXIT			; exit if nothing allocated
                                     0185   317 	SETIPL	#IPL$_ASTDEL		; lock moving of buffer
            12            02     DA  0185       		MTPR	#IPL$_ASTDEL,S^#PR$_IPL
            50            66     D0  0188   318 	MOVL	PMB$L_CURBUF(R6),R0	; get current buffer address
                          11     13  018B   319 	BEQL	20$			; branch if no buffer
                          80     D4  018D   320 	CLRL	(R0)+			; insert zero entry in buffer
         04 A6   0000020C 8F     C3  018F   321 	SUBL3	#BUFSIZ,PMB$L_BUFEND(R6),R0 ; compute buffer start address
                          50         0197       
         18 B6            60     0E  0198   322 	INSQUE	(R0),@PMB$Q_SBPHDR+4(R6) ; insert at end of subprocess queue
                          66     D4  019C   323 	CLRL	PMB$L_CURBUF(R6)	; note buffer no longer there
                                     019E   324 20$:
                                     019E   325 	SETIPL	#0			; return to IPL 0
            12            00     DA  019E       		MTPR	#0,S^#PR$_IPL
                                     01A1   326 	$FORCEX_S PIDADR=PMB$L_PID(R6)	; force subprocess to exit
                          00     DD  01A1       		PUSHL	#0
                          00     DD  01A3       		PUSHL	#0
                       1C A6     DF  01A5       		PUSHAL	PMB$L_PID(R6)
   00000000'GF            03     FB  01A8       		CALLS	#3,G^SYS$FORCEX
            1D            50     E9  01AF   327 	BLBC	R0,30$			; don't wait for message if force failed
                                     01B2   328 	$QIOW_S	CHAN=PMB$W_MBXCHN(R6),FUNC=#IO$_READVBLK,-
                                     01B2   329 		P1=PMB$L_PID(R6),-	; buffer four bytes of termination
                                     01B2   330 		P2=#4			; ...message in unneeded PID slot
                          7E     7C  01B2       		CLRQ	-(SP)
                          7E     7C  01B4       		CLRQ	-(SP)
                          04     DD  01B6       		PUSHL	#4
                       1C A6     DF  01B8       		PUSHAL	PMB$L_PID(R6)
                          7E     7C  01BB       		CLRQ	-(SP)
                          00     DD  01BD       		PUSHL	#0
            7E            31     3C  01BF       		MOVZWL	#IO$_READVBLK,-(SP)
            7E         0A A6     3C  01C2       		MOVZWL	PMB$W_MBXCHN(R6),-(SP)
                          00     DD  01C6       		PUSHL	#0
SYSSETPFM       - SET PAGE FAULT MONITORING                      21-AUG-1978 20:42:28   VAX-11 MACRO X0.3-11               Page   9
01              CLEANUP - Termination Processing                                                                                 (4)

   00000000'GF            0C     FB  01C8       		CALLS	#12,G^SYS$QIOW
                                     01CF   331 30$:
                                     01CF   332 	$DASSGN_S CHAN=PMB$W_MBXCHN(R6)	; release mailbox
            7E         0A A6     3C  01CF       		MOVZWL	PMB$W_MBXCHN(R6),-(SP)
   00000000'GF            01     FB  01D3       		CALLS	#1,G^SYS$DASSGN
                                     01DA   333 
                                     01DA   334 ;
                                     01DA   335 ; Return buffered I/O quota to system.  Call purge to return any
                                     01DA   336 ; system memory still held.
                                     01DA   337 ;
                                     01DA   338 
                                     01DA   339 RETQUO:
         42 A4       0A3C 8F     A0  01DA   340 	ADDW	#BUFSIZ*BUFCNT,PCB$W_BYTCNT(R4) ; return buffered I/O quota
                                     01E0   341 EXIT:
                          03     10  01E0   342 	BSBB	PFM$PURGE		; return buffers
                          01     BA  01E2   343 	POPR	#^M<R0>			; restore status code
                                 04  01E4   344 	RET				; return to caller
                                     01E5   345 
SYSSETPFM       - SET PAGE FAULT MONITORING                      21-AUG-1978 20:42:28   VAX-11 MACRO X0.3-11               Page  10
01              PFM$PURGE - Return all buffers to pool                                                                           (5)

                                     01E5   347 	.SBTTL	PFM$PURGE - Return all buffers to pool
                                     01E5   348 
                                     01E5   349 ;++
                                     01E5   350 ;
                                     01E5   351 ; FUNCTIONAL DESCRIPTION:
                                     01E5   352 ;
                                     01E5   353 ;	All data buffers and the control block are returned to
                                     01E5   354 ;	the pool.  Routine is called by internal cleanup and by
                                     01E5   355 ;	SYSRUNDWN to ensure that all buffer space is deallocated.
                                     01E5   356 ;	If this is the only user, deallocate PMBLST.
                                     01E5   357 ;
                                     01E5   358 ; CALLING SEQUENCE:
                                     01E5   359 ;
                                     01E5   360 ;	BSB/JSB
                                     01E5   361 ;
                                     01E5   362 ; INPUTS:
                                     01E5   363 ;
                                     01E5   364 ;	none
                                     01E5   365 ;
                                     01E5   366 ; IMPLICIT INPUTS:
                                     01E5   367 ;
                                     01E5   368 ;	PFM$AL_PMBLST - pfm data base list
                                     01E5   369 ;
                                     01E5   370 ; OUTPUTS:
                                     01E5   371 ;
                                     01E5   372 ;	none
                                     01E5   373 ;
                                     01E5   374 ; IMPLICIT OUTPUTS:
                                     01E5   375 ;
                                     01E5   376 ;	none
                                     01E5   377 ;
                                     01E5   378 ; SIDE EFFECTS:
                                     01E5   379 ;
                                     01E5   380 ;	none - all registers preserved
                                     01E5   381 ;
                                     01E5   382 ; ROUTINE VALUE:
                                     01E5   383 ;
                                     01E5   384 ;	none
                                     01E5   385 ;--
                                     01E5   386 
                                     01E5   387 
                                     01E5   388 PFM$PURGE::
                          3F     BB  01E5   389 	PUSHR	#^M<R0,R1,R2,R3,R4,R5>	; save registers
            50   00000000'EF     D0  01E7   390 	MOVL	SCH$GL_CURPCB,R0	; get our PCB address
            54         60 A0     3C  01EE   391 	MOVZWL	PCB$L_PID(R0),R4	; get process index
            51   00000004'EF     D0  01F2   392 	MOVL	PFM$GL_PMBLST,R1	; get address of PMB list
                          60     13  01F9   393 	BEQL	40$			; exit if none there
                                     01FB   394 	DSBINT	#IPL$_SCHED		; stop context switch
            7E            12     DB  01FB       		MFPR	S^#PR$_IPL,-(SP)
            12            03     DA  01FE       		MTPR	#IPL$_SCHED,S^#PR$_IPL
            55            6144   D0  0201   395 	MOVL	(R1)[R4],R5		; get PMB block address
                          6144   D4  0205   396 	CLRL	(R1)[R4]		; zero slot
                 00000008'EF     D7  0208   397 	DECL	PFMCOUNT		; one less process
                          0C     18  020E   398 	BGEQ	5$			; continue if not last one
         08 A1   00000000'EF     B0  0210   399 	MOVW	PFM$GL_SIZE,PMB$W_SIZE(R1) ; insert size in block
                          44     10  0218   400 	BSBB	50$			; deallocate block
                          61     D4  021A   401 	CLRL	(R1)			; note none there
SYSSETPFM       - SET PAGE FAULT MONITORING                      21-AUG-1978 20:42:28   VAX-11 MACRO X0.3-11               Page  11
01              PFM$PURGE - Return all buffers to pool                                                                           (5)

                                     021C   402 5$:	ENBINT				; restore IPL
            12            8E     DA  021C       		MTPR	(SP)+,S^#PR$_IPL
            50   00000000'EF     D0  021F   403 	MOVL	SCH$GL_CURPCB,R0	; get our pcb address
                          55     D5  0226   404 	TSTL	R5			; was there a PMB
                          31     13  0228   405 	BEQL	40$			; exit if not
                                     022A   406 	DSBINT	#IPL$_ASTDEL		; go to ast delivery level
            7E            12     DB  022A       		MFPR	S^#PR$_IPL,-(SP)
            12            02     DA  022D       		MTPR	#IPL$_ASTDEL,S^#PR$_IPL
                          65     D5  0230   407 	TSTL	PMB$L_CURBUF(R5)	; check if current buffer there
                          0B     13  0232   408 	BEQL	10$			; branch if none there
         04 A5   0000020C 8F     C3  0234   409 	SUBL3	#BUFSIZ,PMB$L_BUFEND(R5),R0 ; else compute buffer address
                          50         023C       
                          1F     10  023D   410 	BSBB	50$			; return to system
            50         0C B5     0F  023F   411 10$:	REMQUE	@PMB$Q_HDR(R5),R0	; remove buffer from queue
                          04     1D  0243   412 	BVS	20$			; exit if none there
                          17     10  0245   413 	BSBB	50$			; return buffer
                          F6     11  0247   414 	BRB	10$			; go back for more buffers
            50         14 B5     0F  0249   415 20$:	REMQUE	@PMB$Q_SBPHDR(R5),R0	; check that subprocess queue is clear
                          04     1D  024D   416 	BVS	30$			; exit if no entry
                          0D     10  024F   417 	BSBB	50$			; else return buffer to system pool
                          F6     11  0251   418 	BRB	20$			; check for any more
            50            55     D0  0253   419 30$:	MOVL	R5,R0			; get back PMB block address
                          06     10  0256   420 	BSBB	50$			; deallocate control block
                                     0258   421 	ENBINT				; restore IPL
            12            8E     DA  0258       		MTPR	(SP)+,S^#PR$_IPL
                          3F     BA  025B   422 40$:	POPR	#^M<R0,R1,R2,R3,R4,R5>	; restore registers
                                 05  025D   423 	RSB				; return to caller
                                     025E   424 
                                     025E   425 ;
                                     025E   426 ; Return buffer to pool.
                                     025E   427 ;
                                     025E   428 
                                     025E   429 50$:
                 00000000'EF     16  025E   430 	JSB	EXE$DEANONPAGED		; deallocate memory
                                 05  0264   431 	RSB
SYSSETPFM       - SET PAGE FAULT MONITORING                      21-AUG-1978 20:42:28   VAX-11 MACRO X0.3-11               Page  12
01              PFM$MON - Resident Monitoring Code                                                                               (6)

                                     0265   433 	.SBTTL	PFM$MON - Resident Monitoring Code
                                     0265   434 
                                     0265   435 ;++
                                     0265   436 ;
                                     0265   437 ; FUNCTIONAL DESCRIPTION:
                                     0265   438 ;
                                     0265   439 ;	Resident code called by memory management to record
                                     0265   440 ;	page fault PC and VA.  Data is inserted into a buffer.
                                     0265   441 ;	When the buffer is full, it is queued for a cooperating
                                     0265   442 ;	process which outputs the data to disk.
                                     0265   443 ;
                                     0265   444 ; CALLING SEQUENCE:
                                     0265   445 ;
                                     0265   446 ;	BSB/JSB
                                     0265   447 ;
                                     0265   448 ; INPUTS:
                                     0265   449 ;
                                     0265   450 ;	none
                                     0265   451 ;
                                     0265   452 ; IMPLICIT INPUTS:
                                     0265   453 ;
                                     0265   454 ;	none
                                     0265   455 ;
                                     0265   456 ; OUTPUTS:
                                     0265   457 ;
                                     0265   458 ;	none
                                     0265   459 ;
                                     0265   460 ; IMPLICIT OUTPUTS:
                                     0265   461 ;
                                     0265   462 ;	none
                                     0265   463 ;
                                     0265   464 ; ROUTINE VALUE:
                                     0265   465 ;
                                     0265   466 ;	none
                                     0265   467 ;
                                     0265   468 ; SIDE EFFECTS:
                                     0265   469 ;
                                     0265   470 ;	none
                                     0265   471 ;--
                                     0265   472 
                                     0265   473 
                                 00000000   474 	.PSECT	AEXENONPAGED,LONG
                                     0000   475 PFM$MON::
                          3F     BB  0000   476 	PUSHR	#^M<R0,R1,R2,R3,R4,R5>	; save registers
            55   00000000'EF     D0  0002   477 	MOVL	SCH$GL_CURPCB,R5	; get pcb address
            55         60 A5     3C  0009   478 	MOVZWL	PCB$L_PID(R5),R5	; get process index
            55   00000004'FF45   D0  000D   479 	MOVL	@PFM$GL_PMBLST[R5],R5	; get PMB address
            51            65     D0  0015   480 	MOVL	PMB$L_CURBUF(R5),R1	; get buffer address
                          04     12  0018   481 	BNEQ	10$			; branch if buffer exists
                          30     10  001A   482 	BSBB	GETBUF			; try to get next buffer
                          2B     1D  001C   483 	BVS	30$			; exit if none there, lose data
            81         3C AE     D0  001E   484 10$:	MOVL	FAULTPC(SP),(R1)+	; insert pc of instruction
            81         38 AE     D0  0022   485 	MOVL	FAULTVA(SP),(R1)+	; insert va which faulted
         04 A5            51     D1  0026   486 	CMPL	R1,PMB$L_BUFEND(R5)	; check for end of buffer
                          1A     1F  002A   487 	BLSSU	20$			; branch if ok
                                     002C   488 
                                     002C   489 ;
SYSSETPFM       - SET PAGE FAULT MONITORING                      21-AUG-1978 20:42:28   VAX-11 MACRO X0.3-11               Page  13
01              PFM$MON - Resident Monitoring Code                                                                               (6)

                                     002C   490 ; Buffer is full, queue it and wake the writing process
                                     002C   491 ;
                                     002C   492 
         04 A5   0000020C 8F     C3  002C   493 	SUBL3	#BUFSIZ,PMB$L_BUFEND(R5),R1 ; compute buffer start address
                          51         0034       
         18 B5            61     0E  0035   494 	INSQUE	(R1),@PMB$Q_SBPHDR+4(R5) ; insert buffer at end of write queue
            51         1C A5     D0  0039   495 	MOVL	PMB$L_PID(R5),R1	; get params to wake up other
                          FFC0'  30  003D   496 	BSBW	W^SCH$WAKE		;   process
                          65     D4  0040   497 	CLRL	PMB$L_CURBUF(R5)	; note no buffer there now
                          08     10  0042   498 	BSBB	GETBUF			; pick up next buffer
                          03     1D  0044   499 	BVS	30$			; exit if none available
            65            51     D0  0046   500 20$:	MOVL	R1,PMB$L_CURBUF(R5)	; save current buffer pointer
                          3F     BA  0049   501 30$:	POPR	#^M<R0,R1,R2,R3,R4,R5>	; restore registers
                                 05  004B   502 	RSB
                                     004C   503 
                                     004C   504 GETBUF:					; get next buffer from queue
            51         0C B5     0F  004C   505 	REMQUE	@PMB$Q_HDR(R5),R1	; dequeue next buffer
                          09     1D  0050   506 	BVS	10$			; leave with V set if none there
         04 A5       020C C1     DE  0052   507 	MOVAL	BUFSIZ(R1),PMB$L_BUFEND(R5) ; save buffer end address
            51            0C     C0  0058   508 	ADDL	#12,R1			; skip buffer header part, clear V bit
                                 05  005B   509 10$:	RSB				; return with V set or clear
SYSSETPFM       - SET PAGE FAULT MONITORING                      21-AUG-1978 20:42:28   VAX-11 MACRO X0.3-11               Page  14
01              ALLPMBLST - Allocate list of control block addr                                                                  (7)

                                     005C   511 	.SBTTL	ALLPMBLST - Allocate list of control block addresses
                                     005C   512 
                                     005C   513 ;++
                                     005C   514 ;
                                     005C   515 ; FUNCTIONAL DESCRIPTION:
                                     005C   516 ;
                                     005C   517 ;	Check to see if PMBLST has already been created, and exit if
                                     005C   518 ;	so, else create the list and store its address and length.
                                     005C   519 ;
                                     005C   520 ; CALLING SEQUENCE:
                                     005C   521 ;
                                     005C   522 ;	JSB/BSB
                                     005C   523 ;
                                     005C   524 ; INPUTS:
                                     005C   525 ;
                                     005C   526 ;	R1 = number of bytes to allocate for PMBLST
                                     005C   527 ;
                                     005C   528 ; IMPLICIT INPUTS:
                                     005C   529 ;
                                     005C   530 ;	PFMCOUNT - number of processes using monitoring (begins at -1)
                                     005C   531 ;
                                     005C   532 ; OUTPUTS:
                                     005C   533 ;
                                     005C   534 ;	none
                                     005C   535 ;
                                     005C   536 ; IMPLICIT OUTPUTS:
                                     005C   537 ;
                                     005C   538 ;	PFMCOUNT - incremented
                                     005C   539 ; 	PFM$GL_SIZE - size of PMB if allocated
                                     005C   540 ;	PFM$GL_PFMLST - address of list if allocated
                                     005C   541 ;
                                     005C   542 ; ROUTINE VALUE:
                                     005C   543 ;
                                     005C   544 ;	R0 = 1 -> success
                                     005C   545 ;	     0 -> allocation failure
                                     005C   546 ;
                                     005C   547 ; SIDE EFFECTS:
                                     005C   548 ;
                                     005C   549 ;	R0 - R5 destroyed
                                     005C   550 ;--
                                     005C   551 
                                     005C   552 PFM$ALLPMBLST:
                                     005C   553 
                                     005C   554 	SETIPL	#IPL$_SCHED		; stop context switching
            12            03     DA  005C       		MTPR	#IPL$_SCHED,S^#PR$_IPL
                 00000008'EF     D6  005F   555 	INCL	PFMCOUNT		; one more process
                          19     12  0065   556 	BNEQ	20$			; branch if not first process
                 00000000'EF     16  0067   557 	JSB	EXE$ALONONPAGED		; else allocate control block
            13            50     E9  006D   558 	BLBC	R0,30$			; exit on error
   00000000'EF            51     7D  0070   559 	MOVQ	R1,PFM$GL_SIZE		; store size and address
                                     0077   560 10$:	SETIPL	#0			; restore IPL
            12            00     DA  0077       		MTPR	#0,S^#PR$_IPL
            6E            00     2C  007A   561 	MOVC5	#0,(SP),#0,R1,(R2)	; zero array
            51            00         007D       
                          62         007F       
            50            01     9A  0080   562 20$:	MOVZBL	#1,R0			; set success code
                                     0083   563 30$:	SETIPL	#0			; restore IPL
SYSSETPFM       - SET PAGE FAULT MONITORING                      21-AUG-1978 20:42:28   VAX-11 MACRO X0.3-11               Page  15
01              ALLPMBLST - Allocate list of control block addr                                                                  (7)

            12            00     DA  0083       		MTPR	#0,S^#PR$_IPL
                                 05  0086   564 	RSB				; exit with status code
                                     0087   565 
                                     0087   566 
                                     0087   567 	.END
SYSSETPFM       - SET PAGE FAULT MONITORING                      21-AUG-1978 20:42:28   VAX-11 MACRO X0.3-11               Page  16
SYMBOL TABLE                                                                                                                     (7)

$$T1           = 00000001            IO$V_ABORT     = 00000008            IO$_READPRESET = 00000019            
BIT...         = 00000000            IO$V_ACCESS    = 00000006            IO$_READPROMPT = 00000037            
BUFCNT         = 00000005            IO$V_ATTNAST   = 00000008            IO$_READTRACKD = 00000010            
BUFSIZ         = 0000020C            IO$V_BINARY    = 00000006            IO$_READVBLK   = 00000031            
CLEANUP          00000179 R     04   IO$V_CANCTRLO  = 00000006            IO$_RECAL      = 00000003            
CTL$GL_PHD       ********   X   04   IO$V_COMMOD    = 00000006            IO$_RELEASE    = 00000005            
EXE$ALLOCBUF     ********   X   04   IO$V_CREATE    = 00000007            IO$_RETCENTER  = 00000007            
EXE$ALONONPAGED  ********   X   05   IO$V_CTRLCAST  = 00000008            IO$_REWIND     = 00000024            
EXE$DEANONPAGED  ********   X   04   IO$V_CTRLYAST  = 00000007            IO$_REWINDOFF  = 00000022            
EXE$SETPFM       0000005C RG    04   IO$V_CVTLOW    = 00000008            IO$_SEARCH     = 00000009            
EXIT             000001E0 R     04   IO$V_DATACHECK = 0000000E            IO$_SEEK       = 00000002            
FAULTPC        = 0000003C            IO$V_DELETE    = 00000008            IO$_SENSECHAR  = 0000001B            
FAULTVA        = 00000038            IO$V_DMOUNT    = 0000000A            IO$_SENSEMODE  = 00000027            
FILWRT           00000043 R     04   IO$V_DSABLMBX  = 0000000A            IO$_SETCHAR    = 0000001A            
FILWRTPRV        00000054 R     04   IO$V_ENABLMBX  = 00000007            IO$_SETMODE    = 00000023            
GBL...         = 00000000            IO$V_FCODE     = 00000000            IO$_SKIPFILE   = 00000025            
GETBUF           0000004C R     05   IO$V_HANGUP    = 00000009            IO$_SKIPRECORD = 00000026            
IO$M_ABORT     = 00000100            IO$V_INHERLOG  = 0000000B            IO$_SPACEFILE  = 00000002            
IO$M_ACCESS    = 00000040            IO$V_INHEXTGAP = 0000000C            IO$_SPACERECORD= 00000009            
IO$M_ATTNAST   = 00000100            IO$V_INHRETRY  = 0000000F            IO$_STARTSPNDL = 00000019            
IO$M_BINARY    = 00000040            IO$V_INHSEEK   = 0000000C            IO$_UNLOAD     = 00000001            
IO$M_CANCTRLO  = 00000040            IO$V_INTERRUPT = 00000006            IO$_VIRTUAL    = 0000003F            
IO$M_COMMOD    = 00000040            IO$V_INTSKIP   = 00000008            IO$_WRITECHECK = 0000000A            
IO$M_CREATE    = 00000080            IO$V_MOUNT     = 00000009            IO$_WRITECHECKH= 00000018            
IO$M_CTRLCAST  = 00000100            IO$V_NOECHO    = 00000006            IO$_WRITEHEAD  = 0000000D            
IO$M_CTRLYAST  = 00000080            IO$V_NOFILTR   = 00000009            IO$_WRITELBLK  = 00000020            
IO$M_CVTLOW    = 00000100            IO$V_NOFORMAT  = 00000008            IO$_WRITEMARK  = 0000001C            
IO$M_DATACHECK = 00004000            IO$V_NOW       = 00000006            IO$_WRITEOF    = 00000028            
IO$M_DELETE    = 00000100            IO$V_NOWAIT    = 00000007            IO$_WRITEPBLK  = 0000000B            
IO$M_DMOUNT    = 00000400            IO$V_PACKED    = 00000007            IO$_WRITETRACKD= 0000000F            
IO$M_DSABLMBX  = 00000400            IO$V_PURGE     = 0000000B            IO$_WRITEVBLK  = 00000030            
IO$M_ENABLMBX  = 00000080            IO$V_READATTN  = 00000007            IPL$_ASTDEL    = 00000002            
IO$M_FCODE     = 0000003F            IO$V_REVERSE   = 00000006            IPL$_HWCLK     = 00000018            
IO$M_HANGUP    = 00000200            IO$V_SHUTDOWN  = 00000007            IPL$_IOPOST    = 00000004            
IO$M_INHERLOG  = 00000800            IO$V_STARTUP   = 00000006            IPL$_MAILBOX   = 0000000B            
IO$M_INHEXTGAP = 00001000            IO$V_SYNCH     = 00000009            IPL$_POWER     = 0000001F            
IO$M_INHRETRY  = 00008000            IO$V_TIMED     = 00000007            IPL$_QUEUEAST  = 00000006            
IO$M_INHSEEK   = 00001000            IO$V_TRMNOECHO = 0000000C            IPL$_SCHED     = 00000003            
IO$M_INTERRUPT = 00000040            IO$V_WRTATTN   = 00000008            IPL$_SYNCH     = 00000007            
IO$M_INTSKIP   = 00000100            IO$_ACCESS     = 00000032            IPL$_TIMER     = 00000007            
IO$M_MOUNT     = 00000200            IO$_ACPCONTROL = 00000038            PCB$B_ASTACT     0000000C            
IO$M_NOECHO    = 00000040            IO$_CREATE     = 00000033            PCB$B_ASTEN      0000000D            
IO$M_NOFILTR   = 00000200            IO$_DEACCESS   = 00000034            PCB$B_PRI        0000000B            
IO$M_NOFORMAT  = 00000100            IO$_DELETE     = 00000035            PCB$B_PRIB       00000033            
IO$M_NOW       = 00000040            IO$_DIAGNOSE   = 0000001D            PCB$B_TYPE       0000000A            
IO$M_NOWAIT    = 00000080            IO$_DRVCLR     = 00000004            PCB$B_WEFC       00000032            
IO$M_PACKED    = 00000080            IO$_ERASETAPE  = 00000006            PCB$C_LENGTH     0000007C            
IO$M_PURGE     = 00000800            IO$_LOGICAL    = 0000002F            PCB$K_LENGTH     0000007C            
IO$M_READATTN  = 00000080            IO$_MODIFY     = 00000036            PCB$L_ASTQBL     00000014            
IO$M_REVERSE   = 00000040            IO$_MOUNT      = 00000039            PCB$L_ASTQFL     00000010            
IO$M_SHUTDOWN  = 00000080            IO$_NOP        = 00000000            PCB$L_EFC2P      00000058            
IO$M_STARTUP   = 00000040            IO$_OFFSET     = 00000006            PCB$L_EFC3P      0000005C            
IO$M_SYNCH     = 00000200            IO$_PACKACK    = 00000008            PCB$L_EFCS       00000050            
IO$M_TIMED     = 00000080            IO$_PHYSICAL   = 0000001F            PCB$L_EFCU       00000054            
IO$M_TRMNOECHO = 00001000            IO$_READHEAD   = 0000000E            PCB$L_EFWM       0000004C            
IO$M_WRTATTN   = 00000100            IO$_READLBLK   = 00000021            PCB$L_OWNER      0000001C            
IO$S_FCODE     = 00000006            IO$_READPBLK   = 0000000C            PCB$L_PHD        00000064            
SYSSETPFM       - SET PAGE FAULT MONITORING                      21-AUG-1978 20:42:28   VAX-11 MACRO X0.3-11               Page  17
SYMBOL TABLE                                                                                                                     (7)

PCB$L_PHYPCB     00000018            PFM$PURGE        000001E5 RG    04   PHD$S_P0LR     = 00000018            
PCB$L_PID        00000060            PFMCOUNT         00000008 R     03   PHD$V_ASTLVL   = 00000018            
PCB$L_PQB        0000004C            PFMFILWRT        00000000 R     04   PHD$V_DALCSTX  = 00000001            
PCB$L_SQBL       00000004            PFMQUOTA         00000020 R     04   PHD$V_P0LR     = 00000000            
PCB$L_SQFL       00000000            PHD$B_ASTLVL     000000CF            PHD$V_PFMFLG   = 00000000            
PCB$L_STS        00000028            PHD$B_DFPFC      00000038            PHD$V_WSPEAKCHK= 00000002            
PCB$L_UIC        00000020            PHD$B_PAGFIL     0000001F            PHD$W_ASTLM      00000044            
PCB$L_WSSWP      00000024            PHD$B_PGTBPFC    00000039            PHD$W_BAK        00000048            
PCB$L_WTIME      0000002C            PHD$C_LENGTH     00000118            PHD$W_DFWSCNT    0000001A            
PCB$T_LNAME      0000006C            PHD$C_PHDPAGCTX= 00000008            PHD$W_EMPTPG     000000D8            
PCB$V_ASTPEN   = 00000011            PHD$K_LENGTH     00000118            PHD$W_EXTDYNWS   00000076            
PCB$V_BATCH    = 0000000E            PHD$L_BIOCNT     00000054            PHD$W_FILLM      00000060            
PCB$V_DELPEN   = 00000001            PHD$L_CPULIM     00000058            PHD$W_FLAGS      0000003A            
PCB$V_FORCPEN  = 00000002            PHD$L_CPUTIM     0000003C            PHD$W_PHVINDEX   00000046            
PCB$V_HIBER    = 00000013            PHD$L_DIOCNT     00000050            PHD$W_PRCLM      00000042            
PCB$V_INQUAN   = 00000003            PHD$L_ESP        0000007C            PHD$W_PST        00000020            
PCB$V_LOGIN    = 00000014            PHD$L_FREP0VA    00000028            PHD$W_PSTBASMAX  0000004A            
PCB$V_NETWRK   = 00000015            PHD$L_FREP1VA    00000030            PHD$W_PSTFREE    00000026            
PCB$V_NOACNT   = 0000000F            PHD$L_FREPTECNT  0000002C            PHD$W_PSTLAST    00000024            
PCB$V_NODELET  = 00000017            PHD$L_KSP        00000078            PHD$W_PTCNTACT   00000070            
PCB$V_PHDRES   = 00000012            PHD$L_P0BR       000000C8            PHD$W_PTCNTLCK   0000006C            
PCB$V_PSWAPM   = 00000004            PHD$L_P0LRASTL   000000CC            PHD$W_PTCNTMAX   00000072            
PCB$V_PWRAST   = 00000016            PHD$L_P1BR       000000D0            PHD$W_PTCNTVAL   0000006E            
PCB$V_RES      = 00000000            PHD$L_P1LR       000000D4            PHD$W_QUANT      00000040            
PCB$V_RESPEN   = 00000005            PHD$L_PAGEFLTS   0000004C            PHD$W_TQLM       00000062            
PCB$V_SSFEXC   = 00000006            PHD$L_PAGFIL     0000001C            PHD$W_WSAUTH     0000000A            
PCB$V_SSFEXCE  = 00000007            PHD$L_PC         000000C0            PHD$W_WSDYN      0000000E            
PCB$V_SSFEXCS  = 00000008            PHD$L_PCB        00000078            PHD$W_WSFLUID    00000074            
PCB$V_SSFEXCU  = 00000009            PHD$L_PGFLCNT    00000034            PHD$W_WSLAST     00000012            
PCB$V_SSRWAIT  = 0000000A            PHD$L_PGFLQUOTA  0000005C            PHD$W_WSLIST     00000008            
PCB$V_SUSPEN   = 0000000B            PHD$L_PSL        000000C4            PHD$W_WSLOCK     0000000C            
PCB$V_SWPVBN   = 00000010            PHD$L_PSTBASOFF  00000020            PHD$W_WSLX       0000004A            
PCB$V_WAKEPEN  = 0000000C            PHD$L_PTWSLELCK  00000064            PHD$W_WSNEXT     00000010            
PCB$V_WALL     = 0000000D            PHD$L_PTWSLEVAL  00000068            PHD$W_WSQUOTA    00000018            
PCB$W_APTCNT     00000034            PHD$L_R0         00000088            PMB$B_OVRRUN     00000020            
PCB$W_ASTCNT     0000003C            PHD$L_R1         0000008C            PMB$C_LENGTH     00000021            
PCB$W_BIOCNT     0000003E            PHD$L_R10        000000B0            PMB$K_LENGTH     00000021            
PCB$W_BIOLM      00000040            PHD$L_R11        000000B4            PMB$L_BUFEND     00000004            
PCB$W_BYTCNT     00000042            PHD$L_R12        000000B8            PMB$L_CURBUF     00000000            
PCB$W_BYTLM      00000068            PHD$L_R13        000000BC            PMB$L_PID        0000001C            
PCB$W_DIOCNT     00000044            PHD$L_R2         00000090            PMB$Q_HDR        0000000C            
PCB$W_DIOLM      00000046            PHD$L_R3         00000094            PMB$Q_SBPHDR     00000014            
PCB$W_FILCNT     00000048            PHD$L_R4         00000098            PMB$W_MBXCHN     0000000A            
PCB$W_GPGCNT     00000038            PHD$L_R5         0000009C            PMB$W_SIZE       00000008            
PCB$W_GRP        00000022            PHD$L_R6         000000A0            PQL$_ASTLM     = 00000001            
PCB$W_MEM        00000020            PHD$L_R7         000000A4            PQL$_BIOLM     = 00000002            
PCB$W_MTXCNT     0000000E            PHD$L_R8         000000A8            PQL$_BYTLM     = 00000003            
PCB$W_PPGCNT     0000003A            PHD$L_R9         000000AC            PQL$_CPULM     = 00000004            
PCB$W_PRCCNT     0000006A            PHD$L_REFERFLT   00000014            PQL$_DIOLM     = 00000005            
PCB$W_SIZE       00000008            PHD$L_SSP        00000080            PQL$_FILLM     = 00000006            
PCB$W_STATE      00000030            PHD$L_USP        00000084            PQL$_LENGTH    = 0000000C            
PCB$W_TMBU       00000036            PHD$L_WSL        00000118            PQL$_LISTEND   = 00000000            
PCB$W_TQCNT      0000004A            PHD$M_DALCSTX  = 00000002            PQL$_PGFLQUOTA = 00000007            
PFM$ALLPMBLST    0000005C R     05   PHD$M_PFMFLG   = 00000001            PQL$_PRCLM     = 00000008            
PFM$GL_PMBLST    00000004 RG    03   PHD$M_WSPEAKCHK= 00000004            PQL$_TQELM     = 00000009            
PFM$GL_SIZE      00000000 RG    03   PHD$Q_PRIVMSK    00000000            PQL$_WSDEFAULT = 0000000B            
PFM$MON          00000000 RG    05   PHD$S_ASTLVL   = 00000008            PQL$_WSQUOTA   = 0000000A            
SYSSETPFM       - SET PAGE FAULT MONITORING                      21-AUG-1978 20:42:28   VAX-11 MACRO X0.3-11               Page  18
SYMBOL TABLE                                                                                                                     (7)

PR$_ACCR       = 00000029            SGN$C_PAGEDYN  = 00004000            SS$_DRVERR     = 0000008C            
PR$_ACCS       = 00000028            SGN$C_PHYPAGCNT= 00001000            SS$_DUPFILENAME= 00000868            
PR$_ASTLVL     = 00000013            SGN$C_SFTMAX   = 00000003            SS$_DUPLNAM    = 00000094            
PR$_ESP        = 00000001            SGN$C_SYSDWSCNT= 00000028            SS$_ENDOFFILE  = 00000870            
PR$_ICCS       = 00000018            SGN$C_SYSVECPGS= 00000003            SS$_ENDOFTAPE  = 00000878            
PR$_ICR        = 0000001A            SGN$C_SYSWSCNT = 00000060            SS$_ENDOFUSRLBL= 00000970            
PR$_IPL        = 00000012            SGN$GW_MAXPRCCT  ********   X   04   SS$_EXQUOTA    = 0000001C            
PR$_ISP        = 00000004            SS$_ABORT      = 0000002C            SS$_EXTIDXFILE = 00000880            
PR$_KSP        = 00000000            SS$_ACCONFLICT = 00000800            SS$_FCPREADERR = 00000888            
PR$_MAPEN      = 00000038            SS$_ACCVIO     = 0000000C            SS$_FCPREPSTN  = 00000988            
PR$_NICR       = 00000019            SS$_ACPVAFUL   = 000002FC            SS$_FCPREWNDERR= 00000890            
PR$_P0BR       = 00000008            SS$_ARTRES     = 00000474            SS$_FCPSPACERR = 00000898            
PR$_P0LR       = 00000009            SS$_ASTFLT     = 0000040C            SS$_FCPWRITERR = 000008A0            
PR$_P1BR       = 0000000A            SS$_BADATTRIB  = 00000034            SS$_FILACCERR  = 0000009C            
PR$_P1LR       = 0000000B            SS$_BADCHKSUM  = 00000808            SS$_FILALRACC  = 000000A4            
PR$_PCBB       = 00000010            SS$_BADESCAPE  = 0000003C            SS$_FILELOCKED = 000008A8            
PR$_PME        = 0000003D            SS$_BADFILEHDR = 00000810            SS$_FILENUMCHK = 000008B0            
PR$_RXCS       = 00000020            SS$_BADFILENAME= 00000818            SS$_FILESEQCHK = 000008B8            
PR$_RXDB       = 00000021            SS$_BADFILEVER = 00000820            SS$_FILESTRUCT = 000008C0            
PR$_SBIER      = 00000034            SS$_BADIMGHDR  = 00000044            SS$_FILNOTACC  = 000000AC            
PR$_SBIFS      = 00000030            SS$_BADIRECTORY= 00000828            SS$_FILNOTCNTG = 000002AC            
PR$_SBIMT      = 00000033            SS$_BADPARAM   = 00000014            SS$_FILNOTEXP  = 000000B4            
PR$_SBIQC      = 00000036            SS$_BADSTACK   = 000002B4            SS$_FLTDIV     = 00000494            
PR$_SBIS       = 00000031            SS$_BEGOFFILE  = 00000938            SS$_FLTOVF     = 0000048C            
PR$_SBISC      = 00000032            SS$_BLOCKCNTERR= 00000940            SS$_FLTUND     = 0000049C            
PR$_SBITA      = 00000035            SS$_BREAK      = 00000414            SS$_FORMAT     = 000000BC            
PR$_SBR        = 0000000C            SS$_BUFBYTALI  = 0000030C            SS$_GPTFULL    = 000000C4            
PR$_SCBB       = 00000011            SS$_BUFFEROVF  = 00000601            SS$_GSDFULL    = 000000CC            
PR$_SID        = 0000003E            SS$_BUGCHECK   = 000002A4            SS$_HANGUP     = 000002CC            
PR$_SIRR       = 00000014            SS$_CANCEL     = 00000830            SS$_HEADERFULL = 000008C8            
PR$_SISR       = 00000015            SS$_CHANINTLK  = 0000004C            SS$_IDXFILEFULL= 000008D0            
PR$_SLR        = 0000000D            SS$_CLIFRCEXT  = 00000980            SS$_ILLBLKNUM  = 000000DC            
PR$_SSP        = 00000002            SS$_CMODSUPR   = 0000041C            SS$_ILLCNTRFUNC= 000000E4            
PR$_TBIA       = 00000039            SS$_CMODUSER   = 00000424            SS$_ILLEFC     = 000000EC            
PR$_TBIS       = 0000003A            SS$_COMPAT     = 0000042C            SS$_ILLIOFUNC  = 000000F4            
PR$_TODR       = 0000001B            SS$_CONTINUE   = 00000001            SS$_ILLLBLAST  = 00000968            
PR$_TXCS       = 00000022            SS$_CONTROLC   = 00000651            SS$_ILLPAGCNT  = 000000FC            
PR$_TXDB       = 00000023            SS$_CONTROLO   = 00000609            SS$_ILLSEQOP   = 000002DC            
PR$_USP        = 00000003            SS$_CONTROLY   = 00000611            SS$_ILLSER     = 00000104            
PR$_WCSA       = 0000002C            SS$_CREATED    = 00000619            SS$_ILLUSRLBLRD= 00000958            
PR$_WCSD       = 0000002D            SS$_CTRLERR    = 00000054            SS$_ILLUSRLBLWT= 00000960            
RETQUO           000001DA R     04   SS$_DATACHECK  = 0000005C            SS$_INCVOLLABEL= 0000010C            
SCH$GL_CURPCB    ********   X   04   SS$_DATAOVERUN = 00000838            SS$_INSFARG    = 00000114            
SCH$WAKE         ********   X   05   SS$_DEBUG      = 0000046C            SS$_INSFMEM    = 00000124            
SGN$C_BALSETCNT= 00000018            SS$_DECOVF     = 000004A4            SS$_INSFRAME   = 0000012C            
SGN$C_DFWSCNT  = 00000064            SS$_DEVACTIVE  = 000002C4            SS$_INSFWSL    = 0000011C            
SGN$C_DFWSQUOTA= 00000078            SS$_DEVALLOC   = 00000840            SS$_INTDIV     = 00000484            
SGN$C_GBLSECCNT= 00000028            SS$_DEVALRALLOC= 00000641            SS$_INTOVF     = 0000047C            
SGN$C_MAXGPGCNT= 00000800            SS$_DEVASSIGN  = 00000848            SS$_IVADDR     = 00000134            
SGN$C_MAXPAGCNT= 00004000            SS$_DEVFOREIGN = 00000064            SS$_IVCHAN     = 0000013C            
SGN$C_MAXPGFL  = 00001000            SS$_DEVICEFULL = 00000850            SS$_IVCHNLSEC  = 0000026C            
SGN$C_MAXPSTCNT= 00000005            SS$_DEVMOUNT   = 0000006C            SS$_IVDEVNAM   = 00000144            
SGN$C_MAXVPGCNT= 00002000            SS$_DEVNOTALLOC= 00000858            SS$_IVGSDNAM   = 0000014C            
SGN$C_MAXWSCNT = 00000400            SS$_DEVNOTMBX  = 00000074            SS$_IVLOGNAM   = 00000154            
SGN$C_MINWSCNT = 0000000A            SS$_DEVNOTMOUNT= 0000007C            SS$_IVLOGTAB   = 0000015C            
SGN$C_NPAGEDYN = 00006800            SS$_DEVOFFLINE = 00000084            SS$_IVPROTECT  = 000002F4            
SGN$C_NPROCS   = 00000040            SS$_DIRFULL    = 00000860            SS$_IVQUOTAL   = 00000164            
SYSSETPFM       - SET PAGE FAULT MONITORING                      21-AUG-1978 20:42:28   VAX-11 MACRO X0.3-11               Page  19
SYMBOL TABLE                                                                                                                     (7)

SS$_IVSECFLG   = 0000016C            SS$_RESULTOVF  = 00000214            
SS$_IVSECIDCTL = 000002E4            SS$_ROPRAND    = 00000454            
SS$_IVSSRQ     = 00000174            SS$_SECTBLFUL  = 0000021C            
SS$_IVSTSFLG   = 0000017C            SS$_SSFAIL     = 0000045C            
SS$_IVTIME     = 00000184            SS$_SUBRNG     = 000004AC            
SS$_LCKPAGFUL  = 000000D4            SS$_SUPERSEDE  = 00000631            
SS$_LENVIO     = 0000018C            SS$_TAPEPOSLOST= 00000224            
SS$_LKWSETFUL  = 00000194            SS$_TBIT       = 00000464            
SS$_MBFULL     = 000008D8            SS$_TIMEOUT    = 0000022C            
SS$_MBTOOSML   = 0000019C            SS$_TOOMANYVER = 00000990            
SS$_MCHECK     = 000002BC            SS$_TOOMUCHDATA= 0000029C            
SS$_MEDOFL     = 000001A4            SS$_UNASEFC    = 00000234            
SS$_MSGNOTFND  = 00000621            SS$_UNSAFE     = 0000023C            
SS$_MTLBLLONG  = 00000304            SS$_UNWIND     = 00000920            
SS$_MUSTCLOSEFL= 00000948            SS$_UNWINDING  = 00000928            
SS$_NOAQB      = 00000314            SS$_VASFULL    = 00000244            
SS$_NODATA     = 000001AC            SS$_VECINUSE   = 0000024C            
SS$_NOHANDLER  = 000008F8            SS$_VOLINV     = 00000254            
SS$_NOHOMEBLK  = 000008E0            SS$_WAITUSRLBL = 00000950            
SS$_NOIOCHAN   = 000001B4            SS$_WASCLR     = 00000001            
SS$_NOLINKS    = 0000027C            SS$_WASECC     = 00000639            
SS$_NOLOGNAM   = 000001BC            SS$_WASSET     = 00000009            
SS$_NOMBX      = 00000274            SS$_WRITLCK    = 0000025C            
SS$_NOMOREFILES= 00000930            SS$_WRONGACP   = 0000031C            
SS$_NONEXDRV   = 000001C4            SYS$CREMBX       ********   X   04   
SS$_NONEXPR    = 000008E8            SYS$CREPRC       ********   X   04   
SS$_NONLOCAL   = 000008F0            SYS$DASSGN       ********   X   04   
SS$_NOPRIV     = 00000024            SYS$FORCEX       ********   X   04   
SS$_NORMAL     = 00000001            SYS$GETCHN       ********   X   04   
SS$_NOSIGNAL   = 00000900            SYS$QIOW         ********   X   04   
SS$_NOSOLICIT  = 00000284            WSSIZE         = 00000014            
SS$_NOSUCHDEV  = 00000908            
SS$_NOSUCHFILE = 00000910            
SS$_NOSUCHNODE = 0000028C            
SS$_NOSUCHSEC  = 00000978            
SS$_NOTAPEOP   = 00000264            
SS$_NOTFILEDEV = 000001CC            
SS$_NOTINTBLSZ = 000001D4            
SS$_NOTLABELMT = 000001DC            
SS$_NOTMODIFIED= 00000659            
SS$_NOTNETDEV  = 000002EC            
SS$_NOTRAN     = 00000629            
SS$_NOTSQDEV   = 000001E4            
SS$_OPCCUS     = 00000434            
SS$_OPCDEC     = 0000043C            
SS$_OPINCOMPL  = 000002D4            
SS$_PAGOWNVIO  = 000001EC            
SS$_PAGRDERR   = 00000444            
SS$_PARITY     = 000001F4            
SS$_PARTESCAPE = 000001FC            
SS$_PFMBSY     = 00000204            
SS$_PLHLDR     = 00000404            
SS$_PSTFULL    = 0000020C            
SS$_RADRMOD    = 0000044C            
SS$_REJECT     = 00000294            
SS$_REMOTE     = 00000649            
SS$_RESIGNAL   = 00000918            
SYSSETPFM       - SET PAGE FAULT MONITORING                      21-AUG-1978 20:42:28   VAX-11 MACRO X0.3-11               Page  20
PROGRAM SECTION SYNOPSIS                                                                                                         (7)



PROGRAM SECTION SYNOPSIS

.  ABS  .        00000000      00     NOPIC   USR   CON   ABS   LCL NOSHR NOEXE NORD  NOWRT BYTE  
. BLANK .        00000000      01     NOPIC   USR   CON   REL   LCL NOSHR   EXE   RD    WRT BYTE  
$ABS$            0000011C      02     NOPIC   USR   CON   ABS   LCL NOSHR   EXE   RD    WRT BYTE  
$$$215           0000000C      03     NOPIC   USR   CON   REL   LCL NOSHR   EXE   RD    WRT LONG  
YEXEPAGED        00000265      04     NOPIC   USR   CON   REL   LCL NOSHR   EXE   RD    WRT LONG  
AEXENONPAGED     00000087      05     NOPIC   USR   CON   REL   LCL NOSHR   EXE   RD    WRT LONG  


THERE WERE NO ERRORS OR WARNINGS.
7352. BYTES LEFT IN FREE MEMORY POOL.
2820. BYTES OF RECLAIMED MEMORY.
OBJ$:SYSSETPFM,LIS$:SYSSETPFM/-SP=EXECML$/ML,SRC$:SYSSETPFM
20 MLB DIR RDS - 1028 GETS TO DEFINE 30 MACROS. 76 INTER. FILE WRITES. 
