SYSCREDEL       - SYSTEM SERVICE CREATE & DELETE PAGE            21-AUG-1978 20:22:37   VAX-11 MACRO X0.3-11               Page   0
TABLE OF CONTENTS   

   (1)    3300  HISTORY			; DETAILED
   (2)     100  DECLARATIONS
   (3)     100  EXPREG - EXPAND PROGRAM/CONTROL REGION
   (5)     100  CREPAGINI - INITIALIZE FOR CREATING DEMAND ZERO
   (6)     100  CRETVA - CREATE PAGES AT SPECIFIED VIRTUAL ADDR
   (8)     100  CNTREG - CONTRACT PROGRAM/CONTROL REGION
   (10)    100  - INPUT RANGE, RETURN RANGE, SCRATCH AREA INITI
   (12)    100  RETRANGE - RETURN RANGE OF PAGES
   (14)    100  DELTVA - DELETE VIRTUAL ADDRESS SPACE PAGES
   (16)    100  CREDEL - CREATE/DELETE COMMON LOOP
   (17)    100  CREPAG - CREATE A SINGLE PAGE
   (19)    100  EXPANDCHK - EXPAND REGION CHECKING FOR SPACE AV
   (20)    100  UPDATPTCNT - UPDATE (MAX) PAGE TABLE COUNT
   (21)    100  DELPAG - DELETE A SINGLE PAGE
   (23)    100  CONTRACT - ADJUST THE LENGTH OF THE SPECIFIED R
   (24)    100  PAGETYPE - CALCULATE PAGE TYPE
SYSCREDEL       - SYSTEM SERVICE CREATE & DELETE PAGE            21-AUG-1978 20:22:37   VAX-11 MACRO X0.3-11               Page   1
X0310                                                                                                                            (1)

                                     0000   100 	.TITLE	SYSCREDEL - SYSTEM SERVICE CREATE & DELETE PAGE
                                     0000   200 	.IDENT	/X0310/
                                     0000   300 ;
                                     0000   400 ; COPYRIGHT (C) 1978
                                     0000   500 ; DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASSACHUSETTS 01754
                                     0000   600 ;
                                     0000   700 ; THIS SOFTWARE IS FURNISHED  UNDER A LICENSE FOR USE ONLY ON A SINGLE
                                     0000   800 ; COMPUTER  SYSTEM AND  MAY BE  COPIED ONLY WITH  THE INCLUSION OF THE
                                     0000   900 ; ABOVE COPYRIGHT NOTICE.  THIS SOFTWARE, OR ANY OTHER COPIES THEREOF,
                                     0000  1000 ; MAY NOT BE PROVIDED OR  OTHERWISE MADE AVAILABLE TO ANY OTHER PERSON
                                     0000  1100 ; EXCEPT FOR USE ON SUCH SYSTEM AND TO ONE WHO AGREES TO THESE LICENSE
                                     0000  1200 ; TERMS.  TITLE TO AND  OWNERSHIP OF THE  SOFTWARE  SHALL AT ALL TIMES
                                     0000  1300 ; REMAIN IN DEC.
                                     0000  1400 ;
                                     0000  1500 ; THE INFORMATION IN THIS SOFTWARE IS SUBJECT TO CHANGE WITHOUT NOTICE
                                     0000  1600 ; AND SHOULD  NOT BE CONSTRUED  AS A COMMITMENT  BY DIGITAL  EQUIPMENT
                                     0000  1700 ; CORPORATION.
                                     0000  1800 ;
                                     0000  1900 ; DEC ASSUMES  NO  RESPONSIBILITY  FOR  THE USE OR  RELIABILITY OF ITS
                                     0000  2000 ; SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DEC.
                                     0000  2100 
                                     0000  2200 ;++
                                     0000  2300 ; FACILITY:	EXECUTIVE, MEMORY MANAGEMENT SERVICES
                                     0000  2400 ;
                                     0000  2500 ; ABSTRACT:	SYSCREPAG IMPLEMENTS THE SERVICES WHICH CREATE NEW
                                     0000  2600 ;	DEMAND ZERO PAGES IN THE VIRTUAL ADDRESS SPACE OF THE CALLER.
                                     0000  2700 ;
                                     0000  2800 ; ENVIRONMENT:	THESE SERVICES RUN IN KERNEL MODE WITH THE MEMORY
                                     0000  2900 ;	MANAGEMENT DATA BASE LOCKED WHEN NECESSARY.
                                     0000  3000 ;
                                     0000  3100 ;--
                                     0000  3200 ;
                                     0000  3300 	.SBTTL	HISTORY			; DETAILED
                                     0000  3400 ;
                                     0000  3500 ; AUTHOR: PETER H. LIPMAN	, CREATION DATE: 9-SEP-76
                                     0000  3600 ;
                                     0000  3700 ; MODIFIED BY:
                                     0000  3800 ;	, : VERSION
                                     0000  3900 ; 01	 -
SYSCREDEL       - SYSTEM SERVICE CREATE & DELETE PAGE            21-AUG-1978 20:22:37   VAX-11 MACRO X0.3-11               Page   2
X0310           DECLARATIONS                                                                                                     (2)

                                     0000   100 	.SBTTL	DECLARATIONS
                                     0000   200 ;
                                     0000   300 ; INCLUDE FILES:
                                     0000   400 ;
                                     0000   900 	$IPLDEF				;PROCESSOR PRIORITY LEVELS
                                     0000   950 	$IRPDEF				;I/O REQUEST PACKET DEFINITIONS
                                     0000  1000 	$PCBDEF				;PROCESS CONTROL BLOCK DEFINTIONS
                                     0000  1100 	$PFNDEF				;PAGE FRAME NUMBER DATA BASE
                                     0000  1200 	$PHDDEF				;PROCESS HEADER DEFINITIONS
                                     0000  1300 	$PRDEF				;PROCESSOR REGISTER DEFINTIONS
                                     0000  1600 	$PTEDEF				;PAGE TABLE ENTRY DEFINITIONS
                                     0000  1700 	$RSNDEF				;RESOURCE WAIT NUMBER DEFINIONS
                                     0000  1800 	$SSDEF				;SYSTEM STATUS CODE DEFINTIONS
                                     0000  1900 	$VADEF				;VIRTUAL ADDRESS VIELDS
                                     0000  2100 	$WSLDEF				;WORKING SET LIST ENTRY DEFINTIONS
                                     0000  2200 ;
                                     0000  2300 ; EXTERNAL SYMBOLS:
                                     0000  2400 ;
                                     0000  2500 ;
                                     0000  2600 ; MACROS:
                                     0000  2700 ;
                                     0000  2800 ;
                                     0000  2900 ; EQUATED SYMBOLS:
                                     0000  3000 ;
                                     0000  3100 ; OFFSET FROM AP
                                     0000  3200 ;
                           00000004  0000  3300 	INADR		= 4		;OFFSET TO INPUT RANGE
                           00000004  0000  3400 	PAGCNT		= 4		;OFFSET TO PAGE COUNT
                           00000008  0000  3500 	RETADR		= 8		;OFFSET TO RETURN RANGE
                           0000000C  0000  3600 	ACMODE		= 12		;ACCESS MODE
                           00000010  0000  3700 	REGION		= 16		;OFFSET TO REGION
                                     0000  4900 ;
                                     0000  5000 ; OFFSET FROM FP
                                     0000  5100 ;
                           FFFFFFFC  0000  5200 	CDL$L_MAXACMODE == -4		;MAXIMIZED ACCESS MODE
                                     0000  5210 
                                     0000  5220 	$GBLINI	GLOBAL
                                     0000  5230 	$VIELD	CDL,8,<-		;BITS IN SECOND BYTE OF MACACMODE
                                     0000  5240 		<CHGPAGFIL,,M>,-	;CHARGE PAGE FILE FOR THIS PTE
                                     0000  5250 		<DELGBLDON,,M>,-	;ALREADY DELETED GLOBAL PAGES IN THE RANGE
                                     0000  5270 		>
                                     0000  5280 	$GBLINI
                                     0000  5290 
                           FFFFFFF8  0000  5300 	CDL$L_CALLEDIPL	== -8		;SAVED CALLER'S IPL
                           FFFFFFF4  0000  5400 	CDL$L_SAVRETADR == -12		;SAVE RETURN ADDRESS RANGE
                           FFFFFFF0  0000  5500 	CDL$L_PAGESUBR	== -16		;PER PAGE SUBROUTINE
                           FFFFFFEC  0000  5550 	CDL$L_SVSTARTVA	== -20		;SAVED STARTING VIRTUAL ADDRESS
                           00000014  0000  5600 	CDL$C_LENGTH	== 20		;SIZE OF THIS SCRATCH AREA
                                     0000  5700 ;
                                     0000  5800 ; OWN STORAGE:
                                     0000  5900 ;
SYSCREDEL       - SYSTEM SERVICE CREATE & DELETE PAGE            21-AUG-1978 20:22:37   VAX-11 MACRO X0.3-11               Page   3
X0310           EXPREG - EXPAND PROGRAM/CONTROL REGION                                                                           (3)

                                     0000   100 	.SBTTL	EXPREG - EXPAND PROGRAM/CONTROL REGION
                                     0000   200 
                                     0000   300 ;++
                                     0000   400 ; FUNCTIONAL DESCRIPTION:
                                     0000   500 ;
                                     0000   600 ;	THE EXPAND REGION SYSTEM SERVICE EXPANDS THE PROGRAM REGION (REGION = 0)
                                     0000   700 ;	OR THE CONTROL REGION (REGION = 1) OF THE PROCESS SPACE BY THE
                                     0000   800 ;	NUMBER OF PAGES SPECIFIED IN THE PAGCNT PARAMETER.  THE NEW PAGES
                                     0000   900 ;	ARE DEMAND ZERO PAGES OWNED BY THE MODE OF THE CALLER WITH
                                     0000  1000 ;	READ/WRITE PROTECTION FOR THE CALLING MODE AND ALL MORE PRIVILEGED MODES.
                                     0000  1100 ;
                                     0000  1200 ; CALLING SEQUENCE:
                                     0000  1300 ;
                                     0000  1400 ;	CALLG	ARGLIST,@#SYS$EXPREG
                                     0000  1500 ;
                                     0000  1600 ; INPUT PARAMETERS:
                                     0000  1700 ;
                                     0000  1800 ;	PAGCNT(AP) = NUMBER OF PAGES TO ADD TO THE REGION
                                     0000  1900 ;	RETADR(AP) = ADDRESS OF A 2 LONGWORD ARRAY INTO WHICH IS RETURNED
                                     0000  2000 ;		THE STARTING AND ENDING VIRTUAL ADDRESSES (INCLUSIVE)
                                     0000  2100 ;		OF THE PAGES JUST CREATED
                                     0000  2200 ;	ACMODE(AP) = THE ACCESS MODE (MAXIMIZED WITH THE CALLERS MODE
                                     0000  2300 ;		USED AS THE OWNER OF THE NEW PAGE(S)
                                     0000  2400 ;	REGION(AP) = THE INDICATOR FOR WHICH REGION TO EXPAND
                                     0000  2500 ;		0 = PROGRAM REGION
                                     0000  2600 ;		1 = CONTROL REGION
                                     0000  2700 ;
                                     0000  2800 ; IMPLICIT INPUTS:
                                     0000  2900 ;
                                     0000  3000 ;	CURRENT PCB LOCATED VIA SCH$GL_CURPCB
                                     0000  3100 ;	PROCESS HEADER AS SPECIFIED IN PCB$L_PHD OF THE PCB
                                     0000  3200 ;
                                     0000  3300 ; OUTPUT PARAMETERS:
                                     0000  3400 ;
                                     0000  3500 ;	R0 = SYSTEM STATUS CODE
                                     0000  3600 ;
                                     0000  3700 ; IMPLICIT OUTPUTS:
                                     0000  3800 ;
                                     0000  3900 ;	NONE
                                     0000  4000 ;
                                     0000  4100 ; COMPLETION CODES:
                                     0000  4200 ;
                                     0000  4300 ;	SS$_NORMAL			;SUCCESSFUL COMPLETION
                                     0000  4400 ;	SS$_ACCVIO			;RETURN ADDRESS RANGE INACCESSIBLE
                                     0000  4500 ;	SS$_VASFULL			;VIRTUAL ADDRESS SPACE FULL
                                     0000  4600 ;	SS$_ILLPAGCNT			;ILLEGAL PAGE COUNT PARAMETER
                                     0000  4700 ;
                                     0000  4800 ; SIDE EFFECTS:
                                     0000  4900 ;
                                     0000  5000 ;	NONE
                                     0000  5100 ;
                                     0000  5200 ;--
SYSCREDEL       - SYSTEM SERVICE CREATE & DELETE PAGE            21-AUG-1978 20:22:37   VAX-11 MACRO X0.3-11               Page   4
X0310           EXPREG - EXPAND PROGRAM/CONTROL REGION                                                                           (4)

                                     0000   100 ;
                                     0000   200 ; **********************************************************************
                                     0000   300 ;
                                     0000   400 ; **************** THE FOLLOWING CODE MAY BE PAGED *****************
                                     0000   500 ;
                                 00000000   600 	.PSECT	Y$EXEPAGED
                                     0000   700 ;
                                     0000   800 ; **********************************************************************
                                     0000   900 ;
                                     0000  1000 
                                     0000  1100 	.ENABL	LSB
                                     0000  1200 
            50       00FC 8F     3C  0000  1300 5$:	MOVZWL	#SS$_ILLPAGCNT,R0	;ILLEGAL PAGE COUNT PARAM
                                 04  0005  1400 	RET
                                     0006  1500 
                               01FC' 0006  1600 	.ENTRY	EXE$EXPREG,^M<R2,R3,R4,R5,R6,R7,R8>
                                     0008  1700 
            5E            14     C2  0008  1800 	SUBL	#CDL$C_LENGTH,SP	;RESERVE SCRATCH AREA
                          00D2   30  000B  1900 	BSBW	MMG$RETADRINI		;INIT RETURN RANGE AND SCRATCH AREA
                          2F     10  000E  2000 	BSBB	MMG$CREPAGINI		;INIT FOR CREATING DZRO PAGES
         04 AC            01     C3  0010  2100 	SUBL3	#1,PAGCNT(AP),R1	;R1=# PAGES TO BE ALLOCATED - 1
                          51         0014       
                          E9     19  0015  2200 	BLSS	5$			;BRANCH IF BAD PAGE COUNT
            51            09     78  0017  2300 	ASHL	#9,R1,R1		;EXPRESS AS BYTES
                          51         001A       
                                     001B  2400 ;
                                     001B  2500 ; ***** LOCK THE PROCESS HEADER HERE
                                     001B  2600 ;
                                     001B  2700 	SETIPL	#IPL$_ASTDEL		;NO AST'S WHILE MODIFYING PHD
            55   00000000'9F     D0  001E  2800 	MOVL	@#CTL$GL_PHD,R5		;R5=PHD ADR
            0A         10 AC     E8  0025  2900 	BLBS	REGION(AP),10$		;BRANCH IF P1 SPACE
            52         28 A5     D0  0029  3000 	MOVL	PHD$L_FREP0VA(R5),R2	;STARTVA=1ST FREE P0 SPACE PAGE
            52            51     C1  002D  3100 	ADDL3	R1,R2,R3		;R3=ENDVA (INCLUSIVE)
                          53         0030       
                          08     11  0031  3200 	BRB	15$			;TO THE COMMON CREATE CODE
            52         30 A5     D0  0033  3300 10$:	MOVL	PHD$L_FREP1VA(R5),R2	;STARVA=1ST FREE P1 SPACE PAGE
            52            51     C3  0037  3400 	SUBL3	R1,R2,R3		;R3=ENDVA (INCLUSIVE)
                          53         003A       
                                     003B  3500 15$:
                          0044   30  003B  3600 	BSBW	MMG$CRECOM2		;TO THE COMMON CREATE CODE
                                 04  003E  3700 	RET
                                     003F  3800 
                                     003F  3900 	.DSABL	LSB
SYSCREDEL       - SYSTEM SERVICE CREATE & DELETE PAGE            21-AUG-1978 20:22:37   VAX-11 MACRO X0.3-11               Page   5
X0310           CREPAGINI - INITIALIZE FOR CREATING DEMAND ZERO                                                                  (5)

                                     003F   100 	.SBTTL	CREPAGINI - INITIALIZE FOR CREATING DEMAND ZERO PAGES
                                     003F   200 
                                     003F   300 ;
                                     003F   400 ; INPUTS:
                                     003F   500 ;
                                     003F   600 ;	CDL$L_MAXACMODE(FP) CONTAINS THE MAXIMIZED ACCESS MODE
                                     003F   700 ;
                                     003F   800 ; OUTPUTS:
                                     003F   900 ;
                                     003F  1000 ;	R6 = ADDRESS OF CREPAG SUBROUTINE TO BE CALLED
                                     003F  1100 ;	R8 = DEMAND ZERO PAGE TABLE ENTRY FOR SPECIFIED ACCESS MODE
                                     003F  1200 ;
                                     003F  1300 ;
                                     003F  1400 ; **********************************************************************
                                     003F  1500 ;
                                     003F  1600 ; **************** THE FOLLOWING CODE MAY BE PAGED *****************
                                     003F  1700 ;
                                 0000003F  1800 	.PSECT	Y$EXEPAGED
                                     003F  1900 ;
                                     003F  2000 ; **********************************************************************
                                     003F  2100 ;
                                     003F  2200 MMG$CREPAGINI:
            56       01F8'CF     DE  003F  2300 	MOVAL	W^MMG$CREPAG,R6		;ADR OF INITITAL DELETE SCANNER FOR CREATE
            58         FC AD     9A  0044  2400 	MOVZBL	CDL$L_MAXACMODE(FP),R8	;ACCESS MODE OF WRITER/OWNER
         FC AD            08     E2  0048  2450 	BBSS	#CDL$V_CHGPAGFIL,CDL$L_MAXACMODE(FP),10$ ;CHARGE PAGE FILE QUOTA
                          00         004C       
            58         57'AF48   9A  004D  2500 10$:	MOVZBL	B^MMG$AB_DZRO[R8],R8	;PROTECTION AND OWNER FIELDS
            58            17     78  0052  2600 	ASHL	#PTE$V_OWN,R8,R8	;SHIFT INTO POSITION
                          58         0055       
                                 05  0056  2700 	RSB
                                     0057  2800 
                                     0057  2900 MMG$AB_DZRO:
                                 20  0057  3000 	.BYTE	<PTE$C_KW ! PTE$C_KOWN>@-PTE$V_OWN ;KERNEL
                                 51  0058  3100 	.BYTE	<PTE$C_EW ! PTE$C_EOWN>@-PTE$V_OWN ;EXEC
                                 82  0059  3200 	.BYTE	<PTE$C_SW ! PTE$C_SOWN>@-PTE$V_OWN ;SUPER
                                 43  005A  3300 	.BYTE	<PTE$C_UW ! PTE$C_UOWN>@-PTE$V_OWN ;USER
SYSCREDEL       - SYSTEM SERVICE CREATE & DELETE PAGE            21-AUG-1978 20:22:37   VAX-11 MACRO X0.3-11               Page   6
X0310           CRETVA - CREATE PAGES AT SPECIFIED VIRTUAL ADDR                                                                  (6)

                                     005B   100 	.SBTTL	CRETVA - CREATE PAGES AT SPECIFIED VIRTUAL ADDRES
                                     005B   200 
                                     005B   300 ;++
                                     005B   400 ; FUNCTIONAL DESCRIPTION:
                                     005B   500 ;	THE CREATE VIRTUAL ADDRESS SPACE SYSTEM SERVICE CREATES NEW DEMAND
                                     005B   600 ;	ZERO PAGES IN THE SPECIFIED RANGE OF VIRTUAL ADDRESSES.
                                     005B   700 ;	IF ANY PAGES ALREADY EXIST IN THE RANGE, THEY ARE DELETED
                                     005B   800 ;	THE NEW PAGES ARE READ/WRITE TO THE CALLING MODE AND ALL MORE
                                     005B   900 ;	PRIVILEGED MODES.
                                     005B  1000 ;
                                     005B  1100 ; CALLING SEQUENCE:
                                     005B  1150 ;
                                     005B  1200 ;	CALLG	ARGLIST,@#SYS$CRETVA
                                     005B  1250 ;	CALLG	ARGLIST,MMG$CRETVA	;PRIVILEGED, NON VECTORED ENTRY POINT
                                     005B  1260 ;					;ACCEPTS DESIRED PAGE PROTECTION IN ACMODE+1
                                     005B  1270 ;					;PRESERVES IPL IF LEQ ASTDEL
                                     005B  1300 ;
                                     005B  1400 ;
                                     005B  1500 ; INPUT PARAMETERS:
                                     005B  1600 ;
                                     005B  1700 ;	INADR(AP) = ADDRESS OF 2 LONG WORDS THE 1ST OF WHICH SPECIFIES
                                     005B  1800 ;		THE STARTING VIRTUAL ADDRESS TO CREATE, THE 2ND SPECIFIES
                                     005B  1900 ;		THE ENDING VIRTUAL ADDRESS TO CREATE (INCLUSIVE).
                                     005B  2000 ;	RETADR(AP) = ADDRESS OF A 2 LONGWORD ARRAY INTO WHICH IS RETURNED
                                     005B  2100 ;		THE STARTING AND ENDING VIRTUAL ADDRESSES (INCLUSIVE)
                                     005B  2200 ;		OF THE PAGES JUST CREATED
                                     005B  2300 ;	ACMODE(AP) = THE ACCESS MODE (MAXIMIZED WITH CALLING MODE)
                                     005B  2400 ;		USED AS THE OWNER OF THE NEW PAGE(S)
                                     005B  2410 ;	ACMODE+1(AP) = THE PROTECTION TO USE FOR THE NEW PAGE WHEN
                                     005B  2420 ;		CALLED AT THE PRIVILEGED MMG$CRETVA ENTRY POINT
                                     005B  2500 ;
                                     005B  2600 ; IMPLICIT INPUTS:
                                     005B  2700 ;
                                     005B  2800 ;	NONE
                                     005B  2900 ;
                                     005B  3000 ; OUTPUT PARAMETERS:
                                     005B  3100 ;
                                     005B  3200 ;	R0 = SYSTEM STATUS CODE
                                     005B  3300 ;
                                     005B  3400 ; IMPLICIT OUTPUTS:
                                     005B  3500 ;
                                     005B  3600 ;	NONE
                                     005B  3700 ;
                                     005B  3800 ; COMPLETION CODES:
                                     005B  3900 ;
                                     005B  4000 ;	SS$_NORMAL			;SUCCESSFUL COMPLETION
                                     005B  4100 ;	SS$_ACCVIO			;ACCESS VIOLATION
                                     005B  4200 ;	SS$_NOPRIV			;NO PRIVILEGE TO CREATE/DELETE PAGE
                                     005B  4300 ;	SS$_VASFULL			;VIRTUAL ADDRESS SPACE FULL
                                     005B  4400 ;
                                     005B  4500 ; SIDE EFFECTS:
                                     005B  4600 ;
                                     005B  4700 ;	NONE
                                     005B  4800 ;
                                     005B  4900 ;--
SYSCREDEL       - SYSTEM SERVICE CREATE & DELETE PAGE            21-AUG-1978 20:22:37   VAX-11 MACRO X0.3-11               Page   7
X0310           CRETVA - CREATE PAGES AT SPECIFIED VIRTUAL ADDR                                                                  (7)

                                     005B   100 ;
                                     005B   110 ; **********************************************************************
                                     005B   120 ;
                                     005B   130 ; **************** THE FOLLOWING CODE MAY BE PAGED *****************
                                     005B   140 ;
                                 0000005B   150 	.PSECT	Y$EXEPAGED
                                     005B   160 ;
                                     005B   170 ; **********************************************************************
                                     005B   180 ;
                                     005B   185 
                                     005B   190 	.ENABL	LSB
                                     005B   195 
                                     005B   200 MMG$CRETVA::
                               01FC  005B   300 	.WORD	^M<R2,R3,R4,R5,R6,R7,R8>
            57         0D AC     9A  005D   400 	MOVZBL	ACMODE+1(AP),R7		;PICK UP DESIRED PAGE PROTECTION IF SPECIFIED
                          04     11  0061   500 	BRB	10$
                                     0063   600 
                               01FC' 0063  1000 	.ENTRY	EXE$CRETVA,^M<R2,R3,R4,R5,R6,R7,R8>
                                     0065  1100 
                          57     D4  0065  1150 	CLRL	R7			;NO PAGE PROTECTION SPECIFIED
            5E            14     C2  0067  1200 10$:	SUBL	#CDL$C_LENGTH,SP	;RESERVE SCRATCH AREA
                          65     10  006A  1300 	BSBB	MMG$INADRINI		;GET INPUT RANGE TO R4, R5
                                     006C  1400 					;INIT RETURN RANGE AND SCRATCH AREA
                          D1     10  006C  1500 	BSBB	MMG$CREPAGINI		;INIT FOR CREATING DZRO PAGES
                          57     D5  006E  1510 	TSTL	R7			;PAGE PROTECTION SPECIFIED?
                          05     13  0070  1520 	BEQL	20$			;BRANCH IF NOT
            1B            57     F0  0072  1530 	INSV	R7,#PTE$V_PROT,#PTE$S_PROT,R8 ;SET DESIRED PAGE PROTECTION
            58            04         0075       
                          03     10  0077  1600 20$:	BSBB	CRECOM3
                                 04  0079  1700 	RET
                                     007A  1710 
                                     007A  1720 	.DSABL	LSB
                                     007A  1800 ;
                                     007A  1900 ; R6 = SUBROUTINE ADDRESS OF CREPAG OR SETPRTPAG
                                     007A  2000 ; IF THIS IS THE SET PROTECTION SERVICE, R8 = NEW PROTECTION
                                     007A  2100 ; ENTERED VIA BSBB MMG$CRECOM1
                                     007A  2200 ;
                                     007A  2300 MMG$CRECOM1::
                          55     10  007A  2400 	BSBB	MMG$INADRINI		;GET INPUT RANGE TO R4, R5
                                     007C  2500 					;INIT RETURN RANGE AND SCRATCH AREA
                                     007C  2600 CRECOM3:
            52            54     7D  007C  2700 	MOVQ	R4,R2			;R2 = START OF RANGE, R3 = END
                                     007F  2800 ;
                                     007F  2900 ; OPERATE ON PAGES STARTING WITH THE ADDRESS IN R2 ENDING WITH THE
                                     007F  3000 ; ADDRESS IN R3 INCLUSIVE.
                                     007F  3100 ;
                                     007F  3200 ;
                                     007F  3300 ; ***** LOCK THE PROCESS HEADER HERE
                                     007F  3400 ;
                                     007F  3500 	SETIPL	#IPL$_ASTDEL		;NO AST'S WHILE MODIFYING PHD
                                     0082  3600 ;
                                     0082  3700 ; R2 = STARTING VA, R3 = ENDING VA
                                     0082  3800 ; R6 = SUBROUTINE TO CALL, R8 = PROTECTION
                                     0082  3900 ; ALTERNATE ENTRY POINT ENTERED VIA BSBB MMG$CRECOM2
                                     0082  4000 ;
                                     0082  4100 MMG$CRECOM2::
                          00EE   30  0082  4200 	BSBW	MMG$CREDEL		;COMMON CREATE/DELETE LOOP
SYSCREDEL       - SYSTEM SERVICE CREATE & DELETE PAGE            21-AUG-1978 20:22:37   VAX-11 MACRO X0.3-11               Page   8
X0310           CRETVA - CREATE PAGES AT SPECIFIED VIRTUAL ADDR                                                                  (7)

                                     0085  4300 	ENBINT	CDL$L_CALLEDIPL(FP)	;RESTORE CALLER'S IPL
                          71     10  0089  4400 	BSBB	MMG$RETRANGE		;RETURN RANGE OPERATED ON
                                 05  008B  4500 	RSB				;AND RETURN
SYSCREDEL       - SYSTEM SERVICE CREATE & DELETE PAGE            21-AUG-1978 20:22:37   VAX-11 MACRO X0.3-11               Page   9
X0310           CNTREG - CONTRACT PROGRAM/CONTROL REGION                                                                         (8)

                                     008C   100 	.SBTTL	CNTREG - CONTRACT PROGRAM/CONTROL REGION
                                     008C   200 ;++
                                     008C   300 ; FUNCTIONAL DESCRIPTION:
                                     008C   400 ;
                                     008C   500 ;
                                     008C   600 ; CALLING SEQUENCE:
                                     008C   700 ;
                                     008C   800 ;	CALLG	ARGLIST,@#SYS$CNTREG
                                     008C   900 ;
                                     008C  1000 ;
                                     008C  1100 ; INPUT PARAMETERS:
                                     008C  1200 ;
                                     008C  1300 ;	PAGCNT(AP)	=	NUMBER OF PAGES TO DELETE
                                     008C  1400 ;	RETADR(AP)	=	RETURN ADDRES RANGE OF PAGES DELETED
                                     008C  1500 ;	ACMODE(AP)	=	ACCESS MODE TO CHECK AGAINST PAGE OWNER
                                     008C  1600 ;	REGION(AP)	=	0 FOR PROGRAM REGION
                                     008C  1700 ;			=	1 FOR CONTROL REGION
                                     008C  1800 ;
                                     008C  1900 ; IMPLICIT INPUTS:
                                     008C  2000 ;	NONE
                                     008C  2100 ;
                                     008C  2200 ; OUTPUT PARAMETERS:
                                     008C  2300 ;
                                     008C  2400 ;	R0 = SYSTEM STATUS CODE
                                     008C  2500 ;
                                     008C  2600 ; IMPLICIT OUTPUTS:
                                     008C  2700 ;	NONE
                                     008C  2800 ;
                                     008C  2900 ; COMPLETION CODES:
                                     008C  3000 ;
                                     008C  3100 ;	SS$_NORMAL			;SUCCESSFUL COMPLETION
                                     008C  3200 ;	SS$_ACCVIO			;ACCESS VIOLATION
                                     008C  3300 ;	SS$_ILLPAGCNT			;ILLEGAL PAGE COUNT
                                     008C  3400 ;	SS$_PAGOWNVIO			;PAGE OWNER VIOLATION
                                     008C  3500 ;
                                     008C  3600 ; SIDE EFFECTS:
                                     008C  3700 ;	NONE
                                     008C  3800 ;
                                     008C  3900 ;--
SYSCREDEL       - SYSTEM SERVICE CREATE & DELETE PAGE            21-AUG-1978 20:22:37   VAX-11 MACRO X0.3-11               Page  10
X0310           CNTREG - CONTRACT PROGRAM/CONTROL REGION                                                                         (9)

                                     008C   100 ;
                                     008C   200 ; **********************************************************************
                                     008C   300 ;
                                     008C   400 ; **************** THE FOLLOWING CODE MAY BE PAGED *****************
                                     008C   500 ;
                                 0000008C   600 	.PSECT	Y$EXEPAGED
                                     008C   700 ;
                                     008C   800 ; **********************************************************************
                                     008C   900 ;
                               00FC' 008C  1000 	.ENTRY	EXE$CNTREG,^M<R2,R3,R4,R5,R6,R7>
                                     008E  1100 
            5E            14     C2  008E  1200 	SUBL	#CDL$C_LENGTH,SP	;RESERVE SCRATCH AREA
                          4D     10  0091  1300 	BSBB	MMG$RETADRINI		;INIT RETURN RANGE AND SCRATCH AREA
         04 AC            01     C3  0093  1400 	SUBL3	#1,PAGCNT(AP),R1	;R1=DESIRED PAGE COUNT - 1
                          51         0097       
                          31     19  0098  1500 	BLSS	20$			;BRANCH IF BAD PAGE COUNT
            51            09     78  009A  1600 	ASHL	#9,R1,R1		;FORM BYTE COUNT
                          51         009D       
                                     009E  1700 ;
                                     009E  1800 ; ***** LOCK THE PROCESS HEADER HERE
                                     009E  1900 ;
                                     009E  2000 	SETIPL	#IPL$_ASTDEL		;NO AST'S WHILE MODIFYING THE PHD
            55   00000000'9F     D0  00A1  2100 	MOVL	@#CTL$GL_PHD,R5		;R5=PROCESS HEADER
            0F         10 AC     E8  00A8  2200 	BLBS	REGION(AP),10$		;BRANCH IF CONTROL REGION
                                     00AC  2300 ;
                                     00AC  2400 ; FORM R2 = THE FIRST ADDRESS TO DELETE, AND R3 = THE LAST ADDRESS
                                     00AC  2500 ; DELETE STARTING FROM THE END OF THE REGION
                                     00AC  2600 ;
         28 A5   00000200 8F     C3  00AC  2700 	SUBL3	#^X200,PHD$L_FREP0VA(R5),R2 ;LAST ADR IN P0 SPACE
                          52         00B4       
            52            51     C3  00B5  2800 	SUBL3	R1,R2,R3		;END OF RANGE TO DELETE
                          53         00B8       
                          0D     11  00B9  2900 	BRB	15$			;TO THE COMMON DELETE CODE
         30 A5   00000200 8F     C1  00BB  3000 10$:	ADDL3	#^X200,PHD$L_FREP1VA(R5),R2 ;END OF P1 SPACE
                          52         00C3       
            52            51     C1  00C4  3100 	ADDL3	R1,R2,R3		;END OF RANGE TO DELETE
                          53         00C7       
                          008A   31  00C8  3200 15$:	BRW	DELCOM			;TO THE COMMON DELETE CODE
            50       00FC 8F     3C  00CB  3300 20$:	MOVZWL	#SS$_ILLPAGCNT,R0	;ILLEGAL PAGE COUNT
                                 04  00D0  3400 	RET
SYSCREDEL       - SYSTEM SERVICE CREATE & DELETE PAGE            21-AUG-1978 20:22:37   VAX-11 MACRO X0.3-11               Page  11
X0310           - INPUT RANGE, RETURN RANGE, SCRATCH AREA INITI                                                                 (10)

                                     00D1   100 	.SBTTL - INPUT RANGE, RETURN RANGE, SCRATCH AREA INITIALIZATION
                                     00D1   200 ;++
                                     00D1   300 ; FUNCTIONAL DESCRIPTION:
                                     00D1   400 ;
                                     00D1   500 ;	GET THE INPUT RANGE, INITIALIZE THE RETURN RANGE, AND INITIALIZE
                                     00D1   600 ; THE SCRATCH AREA WHICH IS ASSUMED TO ALREADY BE RESERVED ON THE STACK.
                                     00D1   700 ;
                                     00D1   800 ; CALLING SEQUENCE:
                                     00D1   900 ;
                                     00D1  1000 ;	BSBW	MMG$INADRINI		;GET INPUT RANGE AND FALL INTO RETADRINI
                                     00D1  1100 ;	BSBW	MMG$RETADRINI		;INIT RETURN RANGE AND SCRATCH AREA
                                     00D1  1200 ;
                                     00D1  1300 ; INPUT PARAMETERS:
                                     00D1  1400 ;
                                     00D1  1500 ;	NONE
                                     00D1  1600 ;
                                     00D1  1700 ; IMPLICIT INPUTS:
                                     00D1  1800 ;
                                     00D1  1900 ;	CDL$C_LENGTH BYTES RESERVED ON TOP OF STACK AND ADDRESSED  BY FP
                                     00D1  2000 ;
                                     00D1  2100 ; OUTPUT PARAMETERS:
                                     00D1  2200 ;
                                     00D1  2300 ;	R4, R5 CONTAIN THE INPUT RANGE IF ENTERED AT INADRINI
                                     00D1  2400 ;	RSB TO CALLER IF SUCCESSFUL, RET WITH STATUS IN R0 IF ERROR
                                     00D1  2500 ;	CDL$L_MAXACMODE(FP)	=	MAXIMIZED ACCESS MODE
                                     00D1  2600 ;	CDL$L_CALLEDIPL(FP)	=	CALLERS IPL
                                     00D1  2700 ;	CDL$L_SAVRETADR(FP)	=	RETURN ADDRESS SPECIFIED BY USER
                                     00D1  2800 ;	USER SPECIFIED RETURN RANGE INITIALIZED TO -1,-1
                                     00D1  2900 ;
                                     00D1  3000 ; IMPLICIT OUTPUTS:
                                     00D1  3100 ;
                                     00D1  3200 ;	NONE
                                     00D1  3300 ;
                                     00D1  3400 ; COMPLETION CODES:
                                     00D1  3500 ;
                                     00D1  3600 ;	SS$_ACCVIO			;ACCESS VIOLATION
                                     00D1  3700 ;
                                     00D1  3800 ; SIDE EFFECTS:
                                     00D1  3900 ;
                                     00D1  4000 ;	NONE
                                     00D1  4100 ;
                                     00D1  4200 ;--
SYSCREDEL       - SYSTEM SERVICE CREATE & DELETE PAGE            21-AUG-1978 20:22:37   VAX-11 MACRO X0.3-11               Page  12
X0310           - INPUT RANGE, RETURN RANGE, SCRATCH AREA INITI                                                                 (11)

                                     00D1   100 ;
                                     00D1   200 ; **********************************************************************
                                     00D1   300 ;
                                     00D1   400 ; **************** THE FOLLOWING CODE MAY BE PAGED *****************
                                     00D1   500 ;
                                 000000D1   600 	.PSECT	Y$EXEPAGED
                                     00D1   700 ;
                                     00D1   800 ; **********************************************************************
                                     00D1   900 ;
                                     00D1  1000 MMG$INADRINI::
            54         04 AC     D0  00D1  1100 	MOVL	INADR(AP),R4		;GET ADDRESS OF INPUT RANGE
                          35     13  00D5  1150 	BEQL	ACCVIO			;ERROR IF NO ADDRESS RANGE SPECIFIED
                                     00D7  1200 	IFNORD	#8,(R4),ACCVIO		;BRANCH IF RANGE IS INACCESSIBLE
            54            64     7D  00DD  1300 	MOVQ	(R4),R4			;GET THE INPUT RANGE
                                     00E0  1400 MMG$RETADRINI::
            02            00     EF  00E0  1500 	EXTZV	#0,#2,ACMODE(AP),R0	;GET CALLER SPECIFIED ACCESS MODE
            50         0C AC         00E3       
                          FF17'  30  00E6  1600 	BSBW	EXE$MAXACMODE		;MAXIMIZE WITH PREVIOUS
         FC AD            50     D0  00E9  1700 	MOVL	R0,CDL$L_MAXACMODE(FP)	;AND SAVE RESULT IN THE SCRATCH AREA
                                     00ED  1800 	SAVIPL	CDL$L_CALLEDIPL(FP)	;STORE CALLER'S IPL
         F4 AD         08 AC     D0  00F1  1900 	MOVL	RETADR(AP),CDL$L_SAVRETADR(FP) ;GET THE RETURN ADDRESS
            51            01     CE  00F6  2000 	MNEGL	#1,R1			;INIT THE RANGE TO -1, -1
            52            51     D0  00F9  2100 	MOVL	R1,R2
                                     00FC  2200 ;
                                     00FC  2300 ; FALL THROUGH TO MMG$RETRANGE
                                     00FC  2400 ;
SYSCREDEL       - SYSTEM SERVICE CREATE & DELETE PAGE            21-AUG-1978 20:22:37   VAX-11 MACRO X0.3-11               Page  13
X0310           RETRANGE - RETURN RANGE OF PAGES                                                                                (12)

                                     00FC   100 	.SBTTL	RETRANGE - RETURN RANGE OF PAGES
                                     00FC   200 ;++
                                     00FC   300 ; FUNCTIONAL DESCRIPTION:
                                     00FC   400 ;
                                     00FC   500 ;	THIS ROUTINE RETURNS THE RANGE OF PAGES OPERATED ON TO THE
                                     00FC   600 ; USER SPECIFIED ADDRESS.  A ZERO ADDRESS INDICATES NO RETURN RANGE
                                     00FC   700 ; AND THE ADDRESS IS PROBED FOR WRITING 8 BYTES.
                                     00FC   800 ;
                                     00FC   900 ; CALLING SEQUENCE:
                                     00FC  1000 ;
                                     00FC  1100 ;	BSBW	MMG$RETRANGE
                                     00FC  1200 ;
                                     00FC  1300 ; INPUT PARAMETERS:
                                     00FC  1400 ;
                                     00FC  1500 ;	R1, R2 = RANGE OF ADDRESSES TO BE RETURNED
                                     00FC  1600 ;
                                     00FC  1700 ; IMPLICIT INPUTS:
                                     00FC  1800 ;
                                     00FC  1900 ;	CDL$L_SAVRETADR(FP) = THE USER SPECIFIED RETURN ADDRESS
                                     00FC  2000 ;
                                     00FC  2100 ; OUTPUT PARAMETERS:
                                     00FC  2200 ;
                                     00FC  2300 ;	RETURNS VIA RSB IF NO ERROR
                                     00FC  2400 ;	RETURNS VIA RET WITH ERROR CODE IN R0 IF ACCESS VIOLATION
                                     00FC  2500 ;	R0 PRESERVED
                                     00FC  2600 ;
                                     00FC  2700 ; IMPLICIT OUTPUTS:
                                     00FC  2800 ;
                                     00FC  2900 ;	NONE
                                     00FC  3000 ;
                                     00FC  3100 ; COMPLETION CODES:
                                     00FC  3200 ;
                                     00FC  3300 ;	SS$_ACCVIO			ACCESS VIOLATION IF CAN'T WRITE RANGE
                                     00FC  3400 ;
                                     00FC  3500 ; SIDE EFFECTS:
                                     00FC  3600 ;
                                     00FC  3700 ;	NONE
                                     00FC  3800 ;
                                     00FC  3900 ;--
SYSCREDEL       - SYSTEM SERVICE CREATE & DELETE PAGE            21-AUG-1978 20:22:37   VAX-11 MACRO X0.3-11               Page  14
X0310           RETRANGE - RETURN RANGE OF PAGES                                                                                (13)

                                     00FC   100 ;
                                     00FC   200 ; **********************************************************************
                                     00FC   300 ;
                                     00FC   400 ; **************** THE FOLLOWING CODE MAY BE PAGED *****************
                                     00FC   500 ;
                                 000000FC   600 	.PSECT	Y$EXEPAGED
                                     00FC   700 ;
                                     00FC   800 ; **********************************************************************
                                     00FC   900 ;
                                     00FC  1000 MMG$RETRANGE:
            53         F4 AD     D0  00FC  1100 	MOVL	CDL$L_SAVRETADR(FP),R3	;USER SPECIFIED RETURN ADR
                          09     13  0100  1200 	BEQL	20$			;BRANCH IF NONE SPECIFIED
                                     0102  1300 	IFNOWRT	#8,(R3),ACCVIO		;BRANCH IF NOT WRITABLE
            63            51     7D  0108  1400 	MOVQ	R1,(R3)			;RETURN THE RANGE
                                     010B  1500 20$:
                                 05  010B  1600 	RSB
                                     010C  1700 ;
                                     010C  1800 ; ACCESS VIOLATION
                                     010C  1900 ;
                                     010C  2000 ACCVIO:
            50            0C     3C  010C  2100 	MOVZWL	#SS$_ACCVIO,R0		;SET ACCESS VIOLATION CODE
                                 04  010F  2200 	RET				;AND RETURN IT
SYSCREDEL       - SYSTEM SERVICE CREATE & DELETE PAGE            21-AUG-1978 20:22:37   VAX-11 MACRO X0.3-11               Page  15
X0310           DELTVA - DELETE VIRTUAL ADDRESS SPACE PAGES                                                                     (14)

                                     0110   100 	.SBTTL	DELTVA - DELETE VIRTUAL ADDRESS SPACE PAGES
                                     0110   200 ;++
                                     0110   300 ; FUNCTIONAL DESCRIPTION:
                                     0110   400 ;
                                     0110   500 ;	DELTVA DELETES PAGES STARTING WITH THE SECOND ADDRESS FROM INADR
                                     0110   600 ;	ENDING WITH THE FIRST ADR IN INADR. THE SPECIFIED ACCESS MODE
                                     0110   700 ;	(MAXIMIZED WITH THE CALLER'S MODE) IS CHECKED AGAINST THE
                                     0110   800 ;	OWNER OF EACH PAGE AND MUST BE AT LEAST AS PRIVILEGED. 
                                     0110   900 ;	EACH PAGE IS MADE INACCESSIBLE.
                                     0110  1000 ;
                                     0110  1100 ; CALLING SEQUENCE:
                                     0110  1200 ;
                                     0110  1300 ;	CALLG	ARGLIST,@#SYS$DELTVA
                                     0110  1400 ;
                                     0110  1500 ;
                                     0110  1600 ; INPUT PARAMETERS:
                                     0110  1700 ;
                                     0110  1800 ;	INADR(AP)	=	INPUT RANGE OF ADDRESSES
                                     0110  1900 ;	RETADR(AP)	=	RETURN RANGE OF ADDRESSES
                                     0110  2000 ;	ACMODE(AP)	=	ACCESS MODE TO USE FOR CHECK OF DELETE PRIV
                                     0110  2100 ;
                                     0110  2200 ; IMPLICIT INPUTS:
                                     0110  2300 ;	NONE
                                     0110  2400 ;
                                     0110  2500 ; OUTPUT PARAMETERS:
                                     0110  2600 ;
                                     0110  2700 ;	R0 = SYSTEM STATUS CODE
                                     0110  2800 ;
                                     0110  2900 ; IMPLICIT OUTPUTS:
                                     0110  3000 ;
                                     0110  3100 ;	NONE
                                     0110  3200 ;
                                     0110  3300 ; COMPLETION CODES:
                                     0110  3400 ;
                                     0110  3500 ;	SS$_NORMAL			;SUCCESSFUL COMPLETION
                                     0110  3600 ;	SS$_ACCVIO			;ACCESS VIOLATION
                                     0110  3700 ;	SS$_PAGOWNVIO			;PAGE OWNER VIOLATION
                                     0110  3800 ;	SS$_NOPRIV			;NO PRIVILEGE, TRIED TO DELETE SYS PAGE
                                     0110  3900 ;
                                     0110  4000 ; SIDE EFFECTS:
                                     0110  4100 ;	NONE
                                     0110  4200 ;
                                     0110  4300 ;--
SYSCREDEL       - SYSTEM SERVICE CREATE & DELETE PAGE            21-AUG-1978 20:22:37   VAX-11 MACRO X0.3-11               Page  16
X0310           DELTVA - DELETE VIRTUAL ADDRESS SPACE PAGES                                                                     (15)

                                     0110   100 ;
                                     0110   200 ; **********************************************************************
                                     0110   300 ;
                                     0110   400 ; **************** THE FOLLOWING CODE MAY BE PAGED *****************
                                     0110   500 ;
                                 00000110   600 	.PSECT	Y$EXEPAGED
                                     0110   700 ;
                                     0110   800 ; **********************************************************************
                                     0110   900 ;
                               00FC' 0110  1000 	.ENTRY	EXE$DELTVA,^M<R2,R3,R4,R5,R6,R7>
                                     0112  1100 
            5E            14     C2  0112  1200 	SUBL	#CDL$C_LENGTH,SP	;RESERVE SCRATCH AREA
                          BA     10  0115  1300 	BSBB	MMG$INADRINI		;GET INPUT RANGE TO R4, R5
                                     0117  1400 					;INIT RETURN RANGE AND SCRATCH AREA
            52            55     D0  0117  1500 	MOVL	R5,R2			;DELETE FROM THE 2ND ADDRESS
            53            54     D0  011A  1600 	MOVL	R4,R3			;THROUGH THE FIRST
                                     011D  1700 ;
                                     011D  1800 ; ***** LOCK THE PROCESS HEADER HERE
                                     011D  1900 ;
                                     011D  2000 	SETIPL	#IPL$_ASTDEL		;NO AST'S WHILE MODIFYING THE PHD
            55   00000000'9F     D0  0120  2010 	MOVL	@#CTL$GL_PHD,R5		;ADDRESS OF PROCESS HEADER
            52            1E     E0  0127  2020 	BBS	#VA$V_P1,R2,10$		;BRANCH IF P1 SPACE ADDRESS
                          13         012A       
                                     012B  2030 ;
                                     012B  2040 ; P0 SPACE ADDRESS
                                     012B  2050 ;
         28 A5            52     D1  012B  2060 	CMPL	R2,PHD$L_FREP0VA(R5)	;FIRST ADDRESS WITHIN REGION
                          24     1F  012F  2070 	BLSSU	20$			;BRANCH IF YES
         28 A5            53     D1  0131  2080 	CMPL	R3,PHD$L_FREP0VA(R5)	;IF SECOND ADDRESS IS ALSO BEYOND END
                          1E     1E  0135  2090 	BGEQU	20$			;THEN FORGET ADJUSTING THE RANGE
         28 A5            01     C3  0137  2100 	SUBL3	#1,PHD$L_FREP0VA(R5),R2	;START WITH FIRST EXISTING PAGE
                          52         013B       
                          17     11  013C  2110 	BRB	20$
                                     013E  2120 ;
                                     013E  2130 ; P1 SPACE ADDRESS
                                     013E  2140 ;
         30 A5   000001FF 8F     C1  013E  2145 10$:	ADDL3	#^X1FF,PHD$L_FREP1VA(R5),R0 ;FIRST BYTE ADR NOT IN P1 SPACE
                          50         0146       
            52            50     D1  0147  2150 	CMPL	R0,R2			;FIRST ADDRESS WITHIN REGION
                          09     1F  014A  2160 	BLSSU	20$			;BRANCH IF YES
            53            50     D1  014C  2170 	CMPL	R0,R3			;IF SECOND ADDRESS IS ALSO BEYOND END
                          04     1E  014F  2180 	BGEQU	20$			;THEN FORGET ADJUSTING THE RANGE
            50            01     C1  0151  2190 	ADDL3	#1,R0,R2		;START WITH FIRST PAGE IN REGION
                          52         0154       
                                     0155  2200 20$:
                                     0155  2280 ;
                                     0155  2290 ; 0(SP) = SAVED CALLER'S IPL, R2 = STARTING VA, R3 = ENDING VA
                                     0155  2300 ; R6 = SUBROUTINE TO CALL
                                     0155  2400 ;
                                     0155  2500 DELCOM:
            56   00000041'EF     DE  0155  2600 	MOVAL	L^MMG$DELPAG,R6		;R6 = ADR OF INITIAL DELETE SCANNER
                                     015C  2700 					;CALLED TO SCAN WORKING SET LIST
            53            52     C3  015C  2800 	SUBL3	R2,R3,-(SP)		;SAVE WHETHER STARTVA = ENDVA
                          7E         015F       
                          11     10  0160  2900 	BSBB	MMG$CREDEL		;DO THE DELETION
                          8E     D5  0162  3000 	TSTL	(SP)+			;IF STARTVA WAS = ENDVA
                          06     13  0164  3100 	BEQL	10$			;SKIP THE RETURN RANGE EXCHANGE
SYSCREDEL       - SYSTEM SERVICE CREATE & DELETE PAGE            21-AUG-1978 20:22:37   VAX-11 MACRO X0.3-11               Page  17
X0310           DELTVA - DELETE VIRTUAL ADDRESS SPACE PAGES                                                                     (15)

            52            51     7D  0166  3200 	MOVQ	R1,R2			;EXCHANGE R1 AND R2
            51            53     D0  0169  3300 	MOVL	R3,R1			;VIA R3
                                     016C  3400 10$:
                                     016C  3500 	ENBINT	CDL$L_CALLEDIPL(FP)	;RESTORE CALLER'S IPL
                          8A     10  0170  3600 	BSBB	MMG$RETRANGE		;RETURN THE RANGE DELETED
                                 04  0172  3700 	RET				;AND EXIT
SYSCREDEL       - SYSTEM SERVICE CREATE & DELETE PAGE            21-AUG-1978 20:22:37   VAX-11 MACRO X0.3-11               Page  18
X0310           CREDEL - CREATE/DELETE COMMON LOOP                                                                              (16)

                                     0173   100 	.SBTTL	CREDEL - CREATE/DELETE COMMON LOOP
                                     0173   200 ;
                                     0173   300 ; INPUTS
                                     0173   400 ;	R2 = FIRST ADDRESS TO CREATE/DELETE/SET PROTECTION
                                     0173   500 ;	R3 = LAST ADDRESS TO CREATE/DELETE/SET PROTECTION
                                     0173   600 ;	R6 = SUBROUTINE TO CALL
                                     0173   700 ;		CREPAG, DELPAG, SETPRTPAG, LKWSETPAG, ULWSETPAG
                                     0173   800 ;	R7 = SAVED AND READY TO USE AS LOOP INCREMENT
                                     0173   900 ;	R8 = NEW PAGE PROTECTION IF THIS IS SETPRT
                                     0173  1000 ;	CDL$L_MAXACMODE(FP) = MAXIMIZED ACCESS MODE
                                     0173  1100 ;
                                     0173  1200 ; OUTPUTS:
                                     0173  1300 ;	R0 = COMPLETION CODE
                                     0173  1400 ;	R1 = FIRST ADDRESS CREATED/DELETED
                                     0173  1500 ;	R2 = LAST ADDRESS CREATED/DELETED
                                     0173  1600 ;	R4 = PCB ADDRESS
                                     0173  1700 ;	R5 = PROCESS HEADER ADDRESS IN P1 SPACE
                                     0173  1800 ;	R6,R7 ALTERED
                                     0173  1900 ;
                                     0173  2000 ;
                                     0173  2100 ; **********************************************************************
                                     0173  2200 ;
                                     0173  2300 ; **************** THE FOLLOWING CODE MAY BE PAGED *****************
                                     0173  2400 ;
                                 00000173  2500 	.PSECT	Y$EXEPAGED
                                     0173  2600 ;
                                     0173  2700 ; **********************************************************************
                                     0173  2800 ;
                                     0173  2900 MMG$CREDEL:
         F0 AD            56     D0  0173  3000 	MOVL	R6,CDL$L_PAGESUBR(FP)	;ADDRESS OF PER/PAGE SUBROUTINE
            01            09     78  0177  3100 	ASHL	#9,#1,R7		;ADDRESS INCREMENT IF GOING FORWARDS
                          57         017A       
            53         F7 8F     78  017B  3200 	ASHL	#-9,R3,R6		;HIGH VIRTUAL PAGE NUMBER
                          56         017F       
                          5D     19  0180  3300 	BLSS	55$			;BRANCH IF SYSTEM SPACE
            52         F7 8F     78  0182  3400 	ASHL	#-9,R2,R0		;LOW VIRTUAL PAGE NUMBER
                          50         0186       
                          56     19  0187  3500 	BLSS	55$			;BRANCH IF SYSTEM SPACE
            56            50     C2  0189  3600 	SUBL	R0,R6			;NUMBER OF PAGES BASE 0
                                     018C  3700 ;
                                     018C  3800 ; THE FOLLOWING COMPARE MUST BE DONE WITH R2, R3 EXACTLY AS THEY
                                     018C  3900 ; CAME FROM THE CALLER SO THAT A RANGE OF 205,204 WILL YIELD A RETURN
                                     018C  4000 ; RANGE OF 3FF,200 INSTEAD OF 200,3FF.
                                     018C  4100 ;
            53            52     D1  018C  4200 	CMPL	R2,R3			;GOING FORWARDS IN THE ADDRESS SPACE?
                          0C     1F  018F  4300 	BLSSU	10$			;BRANCH IF YES
                          04     1A  0191  4400 	BGTRU	5$			;BRANCH IF BACKWARDS
            52            1E     E1  0193  4500 	BBC	#VA$V_P1,R2,10$		;IF EQUAL, THEN FORWARD FOR P0
                          06         0196       
                                     0197  4600 					;BACKWARDS FOR P1
            56            56     CE  0197  4700 5$:	MNEGL	R6,R6			;NO, BACKWARDS, MAKE PAGE COUNT POSITIVE
            57            57     CE  019A  4800 	MNEGL	R7,R7			;ADDRESS INCREMENT = -^X200
            50            09     78  019D  4900 10$:	ASHL	#9,R0,R2		;NORMALIZED STARTING VA
                          52         01A0       
         EC AD            52     D0  01A1  5000 	MOVL	R2,CDL$L_SVSTARTVA(FP)	;SAVE STARTING VA
            54   00000000'EF     D0  01A5  5100 	MOVL	L^SCH$GL_CURPCB,R4	;PROCESS CONTROL BLOCK ADDRESS
            55   00000000'9F     D0  01AC  5200 	MOVL	@#CTL$GL_PHD,R5		;PROCESS HEADER ADDRESS
SYSCREDEL       - SYSTEM SERVICE CREATE & DELETE PAGE            21-AUG-1978 20:22:37   VAX-11 MACRO X0.3-11               Page  19
X0310           CREDEL - CREATE/DELETE COMMON LOOP                                                                              (16)

            50         FC AD     D0  01B3  5300 30$:	MOVL	CDL$L_MAXACMODE(FP),R0	;ACCESS MODE
                                     01B7  5400 ;
                                     01B7  5500 ; EACH OF THE PER PAGE SUBROUTINES IS CALLED WITH THE FOLLOWING REGISTERS
                                     01B7  5600 ;	R0 = ACCESS MODE
                                     01B7  5700 ;	R2 = VIRTUAL ADDRESS OF PAGE TO OPERATE ON (LOW 9 BITS CLEAR)
                                     01B7  5800 ;	R4 = PROCESS CONTROL BLOCK ADDRESS
                                     01B7  5900 ;	R5 = PROCESS HEADER ADDRESS (P1 SPACE)
                                     01B7  6000 ;	R6 = NUMBER OF PAGES - 1 LEFT TO PROCESS (INCLUDING THE ONE IN R2)
                                     01B7  6100 ;	R7 = +^X200 IF GOING FORWARD IN ADDRESS SPACE
                                     01B7  6200 ;	   = -^X200 IF GOING BACKWARDS IN ADDRESS SPACE
                                     01B7  6300 ;
                                     01B7  6400 ; ALL ROUTINES ARE EXPECTED TO PRESERVE R2, R4, R5, R6, R7, BUT IT IS
                                     01B7  6500 ; OK FOR A ROUTINE TO DO MORE THAN ONE PAGE BY ADDING R7 TO R2 FOR EACH
                                     01B7  6600 ; AND DECREMENTING R6.
                                     01B7  6700 ;
                       F0 BD     16  01B7  6800 	JSB	@CDL$L_PAGESUBR(FP)	;CALL THE PER-PAGE ROUTINE
            06            50     E9  01BA  6900 	BLBC	R0,40$			;BRANCH IF ERROR CONDITION
            52            57     C0  01BD  7000 	ADDL	R7,R2			;NEXT VIRTUAL ADDRESS
            F0            56     F4  01C0  7100 	SOBGEQ	R6,30$			;LOOP THROUGH THE PAGES
            51         EC AD     D0  01C3  7200 40$:	MOVL	CDL$L_SVSTARTVA(FP),R1	;RECOVER STARTING VIRTUAL ADDRESS
            52            51     D1  01C7  7300 	CMPL	R1,R2			;ANY PAGES SUCCESSFULLY PROCESSED?
                          16     13  01CA  7400 	BEQL	60$			;BRANCH IF NO
            52            57     C2  01CC  7500 	SUBL	R7,R2			;BACK TO LAST PAGE PROCESSED
            57            1F     E0  01CF  7600 	BBS	#31,R7,45$		;BRANCH IF GOING BACKWARDS
                          06         01D2       
            52       01FF 8F     A8  01D3  7700 	BISW	#^X1FF,R2		;ENDVA IS END OF PAGE
                                 05  01D8  7800 	RSB
            51       01FF 8F     A8  01D9  7900 45$:	BISW	#^X1FF,R1		;ENDVA IS END OF PAGE
                                 05  01DE  8000 	RSB
            50            24     3C  01DF  8100 55$:	MOVZWL	#SS$_NOPRIV,R0		;NO PRIVILEGE
                       F4 AD     D4  01E2  8200 60$:	CLRL	CDL$L_SAVRETADR(FP)	;NULL RETURN ADR FOR NULL RANGE
                                 05  01E5  8300 	RSB
SYSCREDEL       - SYSTEM SERVICE CREATE & DELETE PAGE            21-AUG-1978 20:22:37   VAX-11 MACRO X0.3-11               Page  20
X0310           CREPAG - CREATE A SINGLE PAGE                                                                                   (17)

                                     01E6   100 	.SBTTL	CREPAG - CREATE A SINGLE PAGE
                                     01E6   200 
                                     01E6   300 ;++
                                     01E6   400 ; FUNCTIONAL DESCRIPTION:
                                     01E6   500 ;	CREPAG CREATES ONE PAGE IN THE P0 OR P1 PAGE TABLE.  IF NECESSARY
                                     01E6   600 ; THE PAGE TABLE IS EXTENDED, WHICH CAN FAIL WHEN THERE ARE NO PTE'S 
                                     01E6   700 ; AVAILABLE.  THE PTE IS DELETED IF NECESSARY AND IS THEN SET
                                     01E6   800 ; TO THE VALUE SPECIFIED.
                                     01E6   900 ;
                                     01E6  1000 ; CALLING SEQUENCE:
                                     01E6  1100 ;
                                     01E6  1200 ;	BSBW	MMG$CREPAG
                                     01E6  1300 ;
                                     01E6  1400 ; INPUT PARAMETERS:
                                     01E6  1500 ;
                                     01E6  1600 ;	R0 = MODE FOR CREATING NEW PAGE IN LOW BYTE
                                     01E6  1620 ;	     CDL$V_CHGPAGFIL SET IF CHARGING PAGE FILE QUOTA FOR THIS PAGE
                                     01E6  1700 ;	R2 = VIRTUAL ADDRESS OF PAGE TO CREATE (LOW 9 BITS = 0)
                                     01E6  1800 ;	R4 = PCB ADDRESS
                                     01E6  1900 ;	R5 = PROCESS HEADER ADDRESS - P1 OR SYSTEM SPACE
                                     01E6  2000 ;	R6 = COUNT - 1 OF PAGES REMAINING TO PROCESS INCLUDING THIS ONE
                                     01E6  2100 ;	R7 = +^X200 IF GOING FORWARDS, -^X200 IF GOING BACKWARDS
                                     01E6  2200 ;	R8 = NEW CONTENTS OF PAGE TABLE ENTRY
                                     01E6  2300 ;
                                     01E6  2400 ;	THE CURRENT IPL MUST BE AT ASTDEL
                                     01E6  2500 ;
                                     01E6  2600 ; IMPLICIT INPUTS:
                                     01E6  2700 ;	NONE
                                     01E6  2800 ;
                                     01E6  2900 ; OUTPUT PARAMETERS:
                                     01E6  3000 ;
                                     01E6  3100 ;	R0 = ERROR STATUS CODE
                                     01E6  3200 ;	R2 PRESERVED
                                     01E6  3300 ;
                                     01E6  3400 ; IMPLICIT OUTPUTS:
                                     01E6  3500 ;
                                     01E6  3600 ;	PTE CORRESPONDING TO SPECIFIED VIRTUAL ADDRESS IS DELETED AND
                                     01E6  3700 ;	THE DESIRED PTE IS STORED
                                     01E6  3800 ;
                                     01E6  3900 ;	IF PAGE TABLE EXPANSION IS NECESSARY THEN THE FOLLOWING 
                                     01E6  4000 ;	ARE AFFECTED:
                                     01E6  4100 ;
                                     01E6  4200 ;	PHD$L_FREP0VA OR PHD$L_FREP1VA	;1ST FREE PAGE AT END OF P0/P1 PAGE TABLE
                                     01E6  4300 ;	PHD$L_P0LRASTL OR PHD$L_P1LR	;LENGTH OF PT IN HARDWARE PCB
                                     01E6  4400 ;	PR$_P0LR OR PR$_P1LR		;LENGTH OF PT IN PROCESSOR REG
                                     01E6  4500 ;	PHD$L_FREPTECNT			;FREE PTE COUNTER
                                     01E6  4600 ;
                                     01E6  4700 ; COMPLETION CODES:
                                     01E6  4800 ;
                                     01E6  4900 ;	SS$_NORMAL			;SUCCESSFUL COMPLETION
                                     01E6  5000 ;	SS$_VASFULL			;VIRTUAL ADDRESS SPACE FULL
                                     01E6  5100 ;
                                     01E6  5200 ; SIDE EFFECTS:
                                     01E6  5300 ;	NONE
                                     01E6  5400 ;
                                     01E6  5500 ;--
SYSCREDEL       - SYSTEM SERVICE CREATE & DELETE PAGE            21-AUG-1978 20:22:37   VAX-11 MACRO X0.3-11               Page  21
X0310           CREPAG - CREATE A SINGLE PAGE                                                                                   (18)

                                     01E6   100 ;
                                     01E6   200 ; **********************************************************************
                                     01E6   300 ;
                                     01E6   400 ; **************** THE FOLLOWING CODE MAY BE PAGED *****************
                                     01E6   500 ;
                                 000001E6   600 	.PSECT	Y$EXEPAGED
                                     01E6   700 ;
                                     01E6   800 ; **********************************************************************
                                     01E6   900 ;
                                     01E6  1000 	.ENABL	LSB
                                     01E6  1100 
                                     01E6  1200 ;
                                     01E6  1300 ; PAGE TABLE ENTRY IS NOT EMPTY, MUST DELETE THE PAGE FIRST
                                     01E6  1400 ;
                                     01E6  1500 DELETEFIRST:
            50         04 AE     9A  01E6  1600 	MOVZBL	4(SP),R0		;ACCESS MODE
                 00000041'EF     16  01EA  1700 	JSB	MMG$DELPAG		;DELETE THE PAGE
            4B            50     E9  01F0  1800 	BLBC	R0,35$			;BRANCH IF ERROR
                          03     BA  01F3  1900 	POPR	#^M<R0,R1>		;R1 = ACCESS MODE
            50            51     D0  01F5  2000 	MOVL	R1,R0			;PLACE IT IN R0
                                     01F8  2100 ;
                                     01F8  2200 ; FALL THROUGH TO CREPAG
                                     01F8  2300 ;
                                     01F8  2400 MMG$CREPAG::
                          50     DD  01F8  2500 	PUSHL	R0			;SAVE ACCESS MODE
            52            1E     E1  01FA  2600 	BBC	#VA$V_P1,R2,20$		;BRANCH IF P0 SPACE
                          17         01FD       
                                     01FE  2700 ;
                                     01FE  2800 ; P1 SPACE
                                     01FE  2900 ;
            53       00D0 C5     DE  01FE  3000 	MOVAL	PHD$L_P1BR(R5),R3	;ADR OF POINTER TO P1PT
         30 A5            52     C3  0203  3100 	SUBL3	R2,PHD$L_FREP1VA(R5),-(SP) ;BEYOND END OF REGION?
                          7E         0207       
                          43     19  0208  3200 	BLSS	80$			;BRANCH IF NOT
                                     020A  3300 ;
                                     020A  3400 ; 0(SP) = NO. OF BYTES BEYOND P1VA (INTEGRAL NO. OF PAGES)
                                     020A  3500 ;	NOTE THAT THIS IS ^X200 SHORT OF WHAT MUST BE ADDED TO REGION
                                     020A  3600 ;
            56            57     C5  020A  3700 	MULL3	R7,R6,R1		;NO. OF BYTES LEFT TO PROCESS
                          51         020D       
                                     020E  3800 					;+ IF GOING FORWARDS, - IF GOING BACKWARDS
                          30     18  020E  3900 	BGEQ	40$			;BRANCH IF EXPANSION IS NOT IN THE
                                     0210  3950 					;NATURAL GROWTH DIRECTION OF THE REGION
            51            51     CE  0210  4000 	MNEGL	R1,R1			;NO. OF BYTES TO ADD TO SIZE OF REGION
                          12     11  0213  4050 	BRB	30$			;TRY TO EXPAND TO FIT LAST PAGE
                                     0215  4100 ;
                                     0215  4200 ; P0 SPACE
                                     0215  4300 ;
            53       00C8 C5     DE  0215  4400 20$:	MOVAL	PHD$L_P0BR(R5),R3	;ADR OF POINTER TO P0PT
            52         28 A5     C3  021A  4500 	SUBL3	PHD$L_FREP0VA(R5),R2,-(SP) ;BEYOND END OF REGION?
                          7E         021E       
                          2C     19  021F  4600 	BLSS	80$			;BRANCH IF NOT
                                     0221  4700 ;
                                     0221  4800 ; 0(SP) = NO. OF BYTES BEYOND P0VA (INTEGRAL NO. OF PAGES)
                                     0221  4900 ;	NOTE THAT THIS IS ^X200 SHORT OF WHAT MUST BE ADDED TO REGION
                                     0221  5000 ;
            56            57     C5  0221  5100 	MULL3	R7,R6,R1		;NO. OF BYTE LEFT TO BE CREATED
SYSCREDEL       - SYSTEM SERVICE CREATE & DELETE PAGE            21-AUG-1978 20:22:37   VAX-11 MACRO X0.3-11               Page  22
X0310           CREPAG - CREATE A SINGLE PAGE                                                                                   (18)

                          51         0224       
                                     0225  5200 					;+ IF GOING FORWARD, - IF GOING BACKWARDS
                          19     15  0225  5300 	BLEQ	40$			;BRANCH IF NOT FORWARD
                                     0227  5400 ;
                                     0227  5500 ; TRY EXPANDING REGION TO FIT LAST PAGE TO BE CREATED
                                     0227  5600 ; CREATION IS IN THE DIRECTION OF THE EXPANDING REGION
                                     0227  5700 ;
            51            6E     C0  0227  5800 30$:	ADDL	(SP),R1			;AMOUNT EVENTUALLY NEEDED TO EXPAND BY
            51       0200 C1     DE  022A  5900 	MOVAL	^X200(R1),R1		;
                          5B     10  022F  6000 	BSBB	EXPANDCHK		;TRY EXPANDING BY THAT MUCH
            19            50     E8  0231  6100 	BLBS	R0,80$			;BRANCH IF REGION EXPANDED
                                     0234  6200 ;
                                     0234  6300 ; CAN'T EXPAND REGION BY THE FULL AMOUNT THAT WILL BE NEEDED
                                     0234  6400 ; SO EXPAND BY WHAT IS LEFT UNLESS THAT'S NOT ENOUGH FOR THE CURRENT PAGE
                                     0234  6500 ;
         2C A5            09     9C  0234  6600 	ROTL	#9,PHD$L_FREPTECNT(R5),R1 ;SPACE LEFT FOR EXPANDING
                          51         0238       
            6E            51     D1  0239  6700 	CMPL	R1,(SP)			;EXPAND BY SPACE REMAINING UNLESS
                                     023C  6800 					;MORE IS NEEDED FOR THIS PAGE
                          0A     14  023C  6900 	BGTR	50$			;BRANCH IF THERE'S ENOUGH
                          40     11  023E  7000 35$:	BRB	90$			;OTHERWISE VIRTUAL ADR SPACE FULL
                                     0240  7100 ;
                                     0240  7200 ; JUST EXPAND FOR THIS PAGE
                                     0240  7300 ;
            6E   00000200 8F     C1  0240  7400 40$:	ADDL3	#^X200,(SP),R1		;AMOUNT NEEDED FOR THIS PAGE
                          51         0247       
                          42     10  0248  7500 50$:	BSBB	EXPANDCHK		;TRY EXPANDING BY THIS AMOUNT
            33            50     E9  024A  7600 	BLBC	R0,90$			;BRANCH IF NO ROOM
                                     024D  7700 ;
                                     024D  7800 ; 0(SP) = GARBAGE, 4(SP) = ACCESS MODE, 5(SP) NONZERO IF CHARGING PAGE FILE QUOTA
                                     024D  7900 ; R2 = VA, R3 = ADDRESS OF POINTER TO APPROPRIATE PAGE TABLE
                                     024D  8000 ;
            15            09     EF  024D  8100 80$:	EXTZV	#VA$V_VPN,#VA$S_VPN,R2,R1 ;VIRTUAL PAGE NUMBER
            51            52         0250       
                       00 B341   D5  0252  8200 	TSTL	@(R3)[R1]		;PTE EMPTY?
                          8E     12  0256  8300 	BNEQ	DELETEFIRST		;BRANCH IF NO, MUST DELETE IT
         04 AE            08     E1  0258  8310 	BBC	#CDL$V_CHGPAGFIL,4(SP),85$ ;BRANCH IF NOT CHARGING FOR PAGE FILE
                          1B         025C       
                       34 A5     D7  025D  8330 	DECL	PHD$L_PGFLCNT(R5)	;CHARGE A PAGE FILE PAGE
                          22     19  0260  8340 	BLSS	100$			;BRANCH IF OVER QUOTA
         5C A5         34 A5     C3  0262  8350 	SUBL3	PHD$L_PGFLCNT(R5),PHD$L_PGFLQUOTA(R5),R0 ;PAGE FILE PAGES IN USE
                          50         0267       
   00000000'GF            50     D1  0268  8360 	CMPL	R0,G^CTL$GL_VIRTPEAK	;MAINTAIN MAX PAGE FILE USED
                          07     1F  026F  8370 	BLSSU	85$
   00000000'GF            50     D0  0271  8380 	MOVL	R0,G^CTL$GL_VIRTPEAK	;SET NEW PEAK VALUE
         00 B341          58     D0  0278  8400 85$:	MOVL	R8,@(R3)[R1]		;STORE NEW PTE
            50            01     3C  027D  8500 	MOVZWL	#SS$_NORMAL,R0		;INDICATE SUCCESSFUL COMPLETION
            5E            08     C0  0280  8600 90$:	ADDL	#2*4,SP			;CLEAN OFF STACK
                                 05  0283  8700 	RSB
                                     0284  8710 ;
                                     0284  8720 ; EXCEEDED PAGE FILE QUOTA
                                     0284  8730 ;
                       34 A5     D6  0284  8740 100$:	INCL	PHD$L_PGFLCNT(R5)	;RESTORE CORRECT COUNT
            50            1C     3C  0287  8750 	MOVZWL	#SS$_EXQUOTA,R0		;EXCEEDED QUOTA
                          F4     11  028A  8760 	BRB	90$			;RETURN THE ERROR
                                     028C  8800 
                                     028C  8900 	.DSABL	LSB
SYSCREDEL       - SYSTEM SERVICE CREATE & DELETE PAGE            21-AUG-1978 20:22:37   VAX-11 MACRO X0.3-11               Page  23
X0310           EXPANDCHK - EXPAND REGION CHECKING FOR SPACE AV                                                                 (19)

                                     028C   100 	.SBTTL	EXPANDCHK - EXPAND REGION CHECKING FOR SPACE AVAILABLE
                                     028C   200 
                                     028C   300 ;
                                     028C   400 ; INPUTS:
                                     028C   500 ;
                                     028C   600 ;	R1 = NO. OF BYTES TO EXPAND BY (INTEGRAL NO. OF PAGES)
                                     028C   700 ;	R2 = VIRTUAL ADDRESS (PROVIDING THE P0/P1 SPACE INDICATOR)
                                     028C   800 ;	R5 = PROCESS HEADER ADDRESS
                                     028C   900 ;
                                     028C  1000 ; OUTPUTS:
                                     028C  1100 ;
                                     028C  1200 ;	R0 = STATUS CODE
                                     028C  1300 ;		SS$_NORMAL FOR SUCCESSFUL
                                     028C  1400 ;		SS$_VASFULL FOR VIRTUAL ADDRESS SPACE FULL
                                     028C  1500 ;		SS$_INSFWSL FOR INSUFFICIENT WORKING SET LIMIT
                                     028C  1600 ;	R2, R3 PRESERVED
                                     028C  1700 ;
                                     028C  1800 ;
                                     028C  1900 ; **********************************************************************
                                     028C  2000 ;
                                     028C  2100 ; **************** THE FOLLOWING CODE MAY BE PAGED *****************
                                     028C  2200 ;
                                 0000028C  2300 	.PSECT	Y$EXEPAGED
                                     028C  2400 ;
                                     028C  2500 ; **********************************************************************
                                     028C  2600 ;
                                     028C  2700 EXPANDCHK:
            51         F7 8F     78  028C  2800 	ASHL	#-9,R1,R0		;NUMBER OF PAGES REQUIRED
                          50         0290       
         2C A5            50     C2  0291  2900 	SUBL	R0,PHD$L_FREPTECNT(R5)	;ENOUGH FREE PAGE TABLE ENTRIES
                          2C     19  0295  3000 	BLSS	40$			;BRANCH IF NOT
            52            1E     E0  0297  3100 	BBS	#VA$V_P1,R2,20$		;BRANCH IF P1 SPACE ADDRESS
                          10         029A       
                                     029B  3200 ;
                                     029B  3300 ; P0 SPACE ADDRESS
                                     029B  3400 ;
       00CC C5            50     C0  029B  3500 	ADDL	R0,PHD$L_P0LRASTL(R5)	;ADJUST LENGTH OF REGION
         28 A5            51     C0  02A0  3600 	ADDL	R1,PHD$L_FREP0VA(R5)	;AND NEXT FREE P0 VIRTUAL ADDRESS
                                     02A4  3700 	LDP0LR	PHD$L_P0LRASTL(R5)	;ADJUST HARDWARE LENGTH REGISTER
            09       00CC C5     DA  02A4       		MTPR	PHD$L_P0LRASTL(R5),S^#PR$_P0LR
                          0E     11  02A9  3800 	BRB	30$			;EXIT THROUGH COMMON CODE
                                     02AB  3900 ;
                                     02AB  4000 ; P1 SPACE ADDRESS
                                     02AB  4100 ;
       00D4 C5            50     C2  02AB  4200 20$:	SUBL	R0,PHD$L_P1LR(R5)	;ADJUST LENGTH OF REGION
         30 A5            51     C2  02B0  4300 	SUBL	R1,PHD$L_FREP1VA(R5)	;AND NEXT FREE P1 VIRTUAL ADR
                                     02B4  4400 	LDP1LR	PHD$L_P1LR(R5)		;AND HARDWARE LENGTH REGISTER
            0B       00D4 C5     DA  02B4       		MTPR	PHD$L_P1LR(R5),S^#PR$_P1LR
                          18     10  02B9  4500 30$:	BSBB	UPDATPTCNT		;UPDATE MAX PAGE TABLE COUNT
                          51     B5  02BB  4600 	TSTW	R1			;IF NOT ENOUGH DYNAMIC WSLE'S LEFT
                          0E     19  02BD  4700 	BLSS	50$			;THEN TOO MUCH VA SPACE FOR WS LIMIT
            50            01     3C  02BF  4800 	MOVZWL	#SS$_NORMAL,R0		;SUCCESSFUL COMPLETION CODE
                                 05  02C2  4900 	RSB
                                     02C3  5000 ;
                                     02C3  5100 ; NOT ENOUGH ROOM IN VIRTUAL ADDRESS SPACE FOR SPECFIED EXPANSION
                                     02C3  5200 ;
         2C A5            50     C0  02C3  5300 40$:	ADDL	R0,PHD$L_FREPTECNT(R5)	;FIX UP FREE PAGE TABLE ENTRY COUNTER
SYSCREDEL       - SYSTEM SERVICE CREATE & DELETE PAGE            21-AUG-1978 20:22:37   VAX-11 MACRO X0.3-11               Page  24
X0310           EXPANDCHK - EXPAND REGION CHECKING FOR SPACE AV                                                                 (19)

            50       0244 8F     3C  02C7  5400 	MOVZWL	#SS$_VASFULL,R0		;RETURN 'VIRTUAL ADDRESS SPACE FULL'
                                 05  02CC  5500 	RSB
                                     02CD  5600 ;
                                     02CD  5700 ; ADDITION OF DESIRED VIRTUAL ADDRESS SPACE WILL RESULT IN TOO FEW
                                     02CD  5800 ; DYNAMIC PAGES IN THE WORKING SET LIST.  REFUSE TO ADD THE SPACE.
                                     02CD  5900 ;
            50       011C 8F     3C  02CD  6000 50$:	MOVZWL	#SS$_INSFWSL,R0		;INSUFFICIENT WORKING SET LIMIT
                                 05  02D2  6100 	RSB
SYSCREDEL       - SYSTEM SERVICE CREATE & DELETE PAGE            21-AUG-1978 20:22:37   VAX-11 MACRO X0.3-11               Page  25
X0310           UPDATPTCNT - UPDATE (MAX) PAGE TABLE COUNT                                                                      (20)

                                     02D3   100 	.SBTTL	UPDATPTCNT - UPDATE (MAX) PAGE TABLE COUNT
                                     02D3   200 
                                     02D3   300 ; FUNCTIONAL DESCRIPTION:
                                     02D3   400 ;
                                     02D3   500 ;	THIS ROUTINE CALCULATES THE MAXIMUM NUMBER OF PAGE TABLES THAT
                                     02D3   600 ; MAY BE REQUIRED TO SUPPORT THE VIRTUAL ADDRESS SPACE CURRENTLY CREATED.
                                     02D3   700 ; THE CALCULATION IS BASED SOLELY ON THE CURRENT SETTINGS FOR THE ENDS
                                     02D3   800 ; OF P0 AND P1 SPACE, HOLES IN THE ADDRESS SPACE ARE NOT DEALT WITH.
                                     02D3   900 ;
                                     02D3  1000 ; INPUTS:
                                     02D3  1100 ;
                                     02D3  1200 ;	R5 = PROCESS HEADER ADDRESS (P1 SPACE IF PROCESS)
                                     02D3  1300 ;
                                     02D3  1400 ; OUTPUTS:
                                     02D3  1500 ;
                                     02D3  1600 ;	R1 = WORD CONTAINING EXTRA DYNAMIC WORKING SET LIST ENTRY COUNT
                                     02D3  1700 ;	R2,R3 PRESERVED
                                     02D3  1800 ;
                                     02D3  1900 ; **********************************************************************
                                     02D3  2000 ;
                                     02D3  2100 ; **************** THE FOLLOWING CODE MAY BE PAGED *****************
                                     02D3  2200 ;
                                 000002D3  2300 	.PSECT	Y$EXEPAGED
                                     02D3  2400 ;
                                     02D3  2500 ; **********************************************************************
                                     02D3  2600 ;
                                     02D3  2700 UPDATPTCNT:
            07            00     EF  02D3  2800 	EXTZV	#0,#7,PHD$L_P0LRASTL(R5),R0 ;NO. OF ENTRIES TO FILL LAST P0PT
            50       00CC C5         02D6       
         2C A5            50     C3  02DA  2900 	SUBL3	R0,PHD$L_FREPTECNT(R5),R0 ;NO. OF FREE PTE'S STARTING
                          50         02DE       
                                     02DF  3000 					;AT THE NEXT PAGE TABLE BOUNDARY
            50         F9 8F     78  02DF  3100 	ASHL	#-7,R0,R0		;TRUNCATED DIVIDE BY 128 YIELDS
                          50         02E3       
                                     02E4  3200 					;COUNT OF EMPTY PAGE TABLES
                          02     18  02E4  3300 	BGEQ	10$			;BRANCH IF SOME EMPTY PAGE TABLES
                          50     D4  02E6  3400 	CLRL	R0			;NO EMPTY PAGE TABLES
   00000000'EF            50     A3  02E8  3500 10$:	SUBW3	R0,SGN$GL_PTPAGCNT,PHD$W_PTCNTMAX(R5) ;SET MAX PAGE TABLE COUNT
                       72 A5         02EF       
                 00000000'EF     17  02F1  3600 	JMP	MMG$EXTRADYNWS		;COMPUTE AND RETURN EXTRA DYNAMIC WSLE COUNT
SYSCREDEL       - SYSTEM SERVICE CREATE & DELETE PAGE            21-AUG-1978 20:22:37   VAX-11 MACRO X0.3-11               Page  26
X0310           DELPAG - DELETE A SINGLE PAGE                                                                                   (21)

                                     02F7   100 	.SBTTL	DELPAG - DELETE A SINGLE PAGE
                                     02F7   200 ;++
                                     02F7   300 ; FUNCTIONAL DESCRIPTION:
                                     02F7   400 ;
                                     02F7   500 ;	THIS ROUTINE DELETES THE PAGE SPECIFIED, CLEARING ITS PAGE TABLE
                                     02F7   600 ; ENTRY.  IF THIS IS THE LAST PAGE OF THE RANGE TO BE DELETED OR IF
                                     02F7   700 ; IT RESULTS IN A LENGTH VIOLATION, THEN THE CONTRACT REGION LOGIC IS CALLED.
                                     02F7   800 ;
                                     02F7   900 ; CALLING SEQUENCE:
                                     02F7  1000 ;
                                     02F7  1100 ;	BSBW	MMG$DELPAG
                                     02F7  1200 ;
                                     02F7  1300 ;
                                     02F7  1400 ; INPUT PARAMETERS:
                                     02F7  1500 ;
                                     02F7  1600 ;	R0 = ACCESS MODE TO CHECK AGAINST PAGE OWNER
                                     02F7  1610 ;	     CDL$V_DELGBLDON SET IF ALREADY HAVE DONE A PURGE OF THE GLOBAL
                                     02F7  1620 ;		PAGES IN THE SPECIFIED ADDRESS RANGE
                                     02F7  1700 ;	R2 = VIRTUAL ADDRESS (LOW 9 BITS = 0)
                                     02F7  1800 ;	R4 = PCB ADDRESS
                                     02F7  1900 ;	R5 = PROCESS HEADER ADDRESS - P1 OR SYSTEM SPACE
                                     02F7  2000 ;	R6 = COUNT - 1 OF PAGES REMAINING TO  BE DELETED INCLUDING THIS ONE
                                     02F7  2100 ;	R7 = +^X200 IF GOING FORWARD IN ADDRESS SPACE
                                     02F7  2200 ;	   = -^X200 IF GOING BACKWARDS IN ADDRESS SPACE
                                     02F7  2300 ;	IPL = ASTLVL
                                     02F7  2400 ;
                                     02F7  2500 ; IMPLICIT INPUTS:
                                     02F7  2600 ;	NONE
                                     02F7  2700 ;
                                     02F7  2800 ; OUTPUT PARAMETERS:
                                     02F7  2900 ;
                                     02F7  3000 ;	R0 = STATUS CODE
                                     02F7  3100 ;	R2 PRESERVED
                                     02F7  3200 ;
                                     02F7  3300 ; IMPLICIT OUTPUTS:
                                     02F7  3400 ;	NONE
                                     02F7  3500 ;
                                     02F7  3600 ; COMPLETION CODES:
                                     02F7  3700 ;
                                     02F7  3800 ;	SS$_NORMAL			;SUCCESSFUL RETURN
                                     02F7  3900 ;	SS$_PAGOWNVIO			;PAGE OWNER VIOLATION
                                     02F7  4000 ;
                                     02F7  4100 ; SIDE EFFECTS:
                                     02F7  4200 ;	NONE
                                     02F7  4300 ;
                                     02F7  4400 ;--
SYSCREDEL       - SYSTEM SERVICE CREATE & DELETE PAGE            21-AUG-1978 20:22:37   VAX-11 MACRO X0.3-11               Page  27
X0310           DELPAG - DELETE A SINGLE PAGE                                                                                   (22)

                                     02F7   100 ;
                                     02F7   200 ; **********************************************************************
                                     02F7   300 ;
                                     02F7   400 ; **************** THE FOLLOWING CODE MUST BE RESIDENT *****************
                                     02F7   500 ;
                                 00000000   600 	.PSECT	$MMGCOD
                                     0000   700 ;
                                     0000   800 ; **********************************************************************
                                     0000   900 ;
                                     0000  1000 ;
                                     0000  1100 ; LENGTH VIOLATION FOR THIS VIRTUAL ADDRESS
                                     0000  1200 ;
                                     0000  1300 DELPAGLENVIO:
                          56     D4  0000  1400 	CLRL	R6			;OTHERWISE, FAKE RANGE COMPLETED
                          01FE   31  0002  1500 	BRW	DELPAGLAST		;CONTRACT THE REGION IF POSSIBLE
                                     0005  1560 					;CHECK FOR LAST IN RANGE
                                     0005  1600 BRDELPAGSUCCESS:
                          01F0   31  0005  1700 	BRW	DELPAGSUCCESS
                                     0008  1800 BRDELPAGRET:
                          01F0   31  0008  1900 	BRW	DELPAGRET
                                     000B  2000 ;
                                     000B  2100 ; PAGE LOCKED IN WORKING SET
                                     000B  2200 ;
                                     000B  2300 DELPAGLOCKED:
         0C A5            51     B1  000B  2400 	CMPW	R1,PHD$W_WSLOCK(R5)	;IF PERMANENT PAGE, SUCCESSFUL NOP
                          F4     1F  000F  2500 	BLSSU	BRDELPAGSUCCESS		;ALLOWING SWAPPER TO USE DELTVA
            50            6E     9A  0011  2600 	MOVZBL	(SP),R0			;RECOVER ACCESS MODE
                                     0014  2700 	ENBINT	4(SP)			;RESTORE IPL TO THAT OF CALLER
                          58     DD  0018  2800 	PUSHL	R8			;SAVE R8 AROUND THE FOLLOWING CALL
            58   00090030 8F     D0  001A  2900 	MOVL	#<SS$_WASSET @16 !-	;SET PARAMETER TO UNLOCK THE
                                     0021  2910 		WSL$M_WSLOCK ! WSL$M_PFNLOCK>,R8 ;WORKING SET LIST ENTRY
                          FFDC'  30  0021  3000 	BSBW	MMG$LCKULKPAG		;UNLOCK THE PAGE FROM THE WORKING SET
                     0100 8F     BA  0024  3100 	POPR	#^M<R8>			;RESTORE R8
            DD            50     E9  0028  3200 	BLBC	R0,BRDELPAGRET		;BRANCH IF ERROR
                          0127   31  002B  3300 	BRW	DELAGAIN		;GO RESTART DELPAG FROM THE TOP
                                     002E  3400 
                                     002E  3500 ;
                                     002E  3600 ; R1 = PAGE TYPE AND IS KNOWN NOT TO BE ZERO
                                     002E  3700 ;
                                     002E  3800 
                                     002E  3900 DELPAGNOTPROCES:
                                     002E  4000 	ASSUME	PFN$C_SYSTEM EQ 1
                                     002E  4100 	ASSUME	PFN$C_PPGTBL EQ 4	;NEGATIVE FIELD VALUE
                          51     D7  002E  4200 	DECL	R1			;IF 1 OR NEGATIVE
                          D3     15  0030  4300 	BLEQ	BRDELPAGSUCCESS		;THEN, SUCCESSFUL NOP
                                     0032  4400 					;ALLOWING SWAPPER TO USE DELTVA
                                     0032  4500 DELGBLRDINPROG:
                          0B     BA  0032  4600 	POPR	#^M<R0,R1,R3>		;R0=ACCESS MODE, R1=SAVED IPL
                                     0034  4650 					;CLEAN OFF SAVED PSL INTO R3
                                     0034  4700 	ENBINT	R1			;BACK TO CALLER'S IPL
                          58     DD  0037  4800 	PUSHL	R8			;SAVE THIS REGISTER
                          58     D4  0039  4850 	CLRL	R8			;SCANNING FOR GLOBAL PAGES
                          FFC2'  30  003B  4900 	BSBW	MMG$PURGWSSCN		;DELETE GLOBAL PAGES IN THE ADDRESS RANGE
                                     003E  5000 					;FROM THE WORKING SET LIST
            58            8E     D0  003E  5050 	MOVL	(SP)+,R8		;RESTORE R8
                                     0041  5100 ;
                                     0041  5200 ; FALL THROUGH TO DELPAG
SYSCREDEL       - SYSTEM SERVICE CREATE & DELETE PAGE            21-AUG-1978 20:22:37   VAX-11 MACRO X0.3-11               Page  28
X0310           DELPAG - DELETE A SINGLE PAGE                                                                                   (22)

                                     0041  5300 ;
                                     0041  5310 
                                     0041  5320 	.ENABL	LSB
                                     0041  5330 
                                     0041  5400 MMG$DELPAG:
                          7E     DC  0041  5500 	MOVPSL	-(SP)			;SAVE PSL
                                     0043  5600 	SAVIPL				;PUSH CALLER'S IPL
                          50     DD  0046  5700 	PUSHL	R0			;SAVE ACCESS MODE
                          FFB5'  30  0048  5800 	BSBW	MMG$PTEREF		;REFERENCE PTE, RETURN SVAPTE
                                     004B  5900 					;RETURNS AT IPL=SYNCH
            B2            50     E9  004B  6000 	BLBC	R0,DELPAGLENVIO		;BRANCH IF LENGTH VIOLATION
                                     004E  6100 ;
                                     004E  6200 ; R3 = SYSTEM VIRTUAL ADDRESS OF PAGE TABLE ENTRY
                                     004E  6300 ;
            51            63     D0  004E  6400 	MOVL	(R3),R1			;FETCH PAGE TABLE ENTRY
                          B2     13  0051  6500 	BEQL	BRDELPAGSUCCESS		;BRANCH IF ALREADY DELETED
            50            6E     9A  0053  6600 	MOVZBL	(SP),R0			;ACCESS MODE
                          0202   30  0056  6700 	BSBW	MMG$PAGETYPE		;CHECK ACCESS, RETURN PAGE TYPE
            AC            50     E9  0059  6800 	BLBC	R0,BRDELPAGRET		;BRANCH IF PAGE OWNER VIOLATION
                                     005C  6900 ;
                                     005C  7000 ; R1 <0:7> PAGE TYPE TO CASE ON (TYP0*2 + TYP1)
                                     005C  7100 ; R2 = VA, R3 = SVAPTE, IPL = SYNCH
                                     005C  7200 ; 0(SP) = ACCESS MODE, 4(SP) = SAVED IPL, 8(SP) = SAVED PSL
                                     005C  7300 ;
            16            00     EF  005C  7400 	EXTZV	#PTE$V_PGFLVB,#PTE$S_PGFLVB,(R3),R0 ;PFN, PGFLVB, GPTX, OR SECTION
            50            63         005F       
                                     0061  7500 	CASE	TYPE=B, SRC=R1, DISPLIST=<- ;DISPATCH ON THE PTE TYPE
                                     0061  7600 		DELTRANS,-		;PAGE IN TRANSITION (OR DZRO)
                                     0061  7700 		DELPAGFIL,-		;PAGING FILE
                                     0061  7800 		DELGLOBAL,-		;GLOBAL PAGE
                                     0061  7900 		DELSTX-			;SECTION TABLE INDEX
                                     0061  8000 	>
                                     006D  8100 ;
                                     006D  8200 ; FALL THROUGH THE CASE STATEMENT FOR VALID PAGE TABLE ENTRY
                                     006D  8300 ;
                                     006D  8350 DELVALID:
            03            00     EE  006D  8400 	EXTV	#PFN$V_PAGTYP,#PFN$S_PAGTYP, - ;GET PAGE TYPE
                                     0070       
            51       0000'DF40       0070  8500 		@W^PFN$AB_TYPE[R0],R1
                                     0075  8600 	ASSUME	PFN$C_PROCESS EQ 0
                          B7     12  0075  8700 	BNEQ	DELPAGNOTPROCES	;BRANCH IF NOT PROCESS PAGE
                                     0077  8800 ;
                                     0077  8900 ; CHECK TO SEE THAT PAGE IS NOT LOCKED IN THE WORKING SET
                                     0077  9000 ;
            51       0000'DF40   3C  0077  9100 	MOVZWL	@W^PFN$AW_WSLX[R0],R1	;INDEX TO WORKING SET LIST ENTRY
            6541          30     D3  007D  9200 	BITL	#<WSL$M_WSLOCK ! WSL$M_PFNLOCK>,(R5)[R1] ;LOCKED OR PERMANENT PAGE?
                          88     12  0081  9300 	BNEQ	DELPAGLOCKED		;BRANCH IF YES
            01       0000'DF40   B1  0083  9400 	CMPW	@W^PFN$AW_REFCNT[R0],#1	;MUST WAIT IF REFERENCE COUNT IS UP
                          5C     14  0089  9500 	BGTR	90$			;INDICATING I/O IN PROGRESS
            63            1A     E0  008B  9600 	BBS	#PTE$V_MODIFY,(R3),40$	;BRANCH IF PAGE MODIFIED
                          07         008E       
       0000'DF40          07     E1  008F  9650 	BBC	#PFN$V_MODIFY,@W^PFN$AB_STATE[R0],60$ ;BRANCH IF PAGE NOT MODIFIED
                          0C         0095       
       0000'DF40          09     9C  0096  9700 40$:	ROTL	#<31-PTE$V_TYP0>,@W^PFN$AL_BAK[R0],R1 ;SECTION BACKING STORE?
                          51         009C       
                          03     18  009D  9720 	BGEQ	60$			;BRANCH IF NOT
                          016C   31  009F  9800 	BRW	DELPAG_WRTBAK		;MUST WRITE THIS PAGE BACK
SYSCREDEL       - SYSTEM SERVICE CREATE & DELETE PAGE            21-AUG-1978 20:22:37   VAX-11 MACRO X0.3-11               Page  29
X0310           DELPAG - DELETE A SINGLE PAGE                                                                                   (22)

                                     00A2  9900 DELPAG_WRTDONE:
       0000'DF40       80 8F     8B  00A2 10400 60$:	BICB3	#PFN$M_MODIFY,@W^PFN$AB_STATE[R0],R1 ;FETCH ALL BUT MODIFY BIT
                          51         00A9       
            51            10     89  00AA 10500 	BISB3	#PFN$M_DELCON,R1,@W^PFN$AB_STATE[R0] ;SET DELCON, CLEAR MODIFY
                     0000'DF40       00AD       
         03 A3         84 8F     8A  00B1 10600 	BICB	#<PTE$M_VALID ! PTE$M_MODIFY>@-24,3(R3) ;MAKE PTE INTO TRANSITION FORMAT
                                     00B6 10700 	INVALID	R2			;AND INVALIDATE THE TRANSLATION BUFFER
                          52     DD  00B9 10800 	PUSHL	R2			;SAVE VA
            51       0000'DF40   3C  00BB 10900 	MOVZWL	@W^PFN$AW_WSLX[R0],R1	;GET WORKING SET LIST INDEX
            6541          52     CD  00C1 11000 	XORL3	R2,(R5)[R1],R3		;HIGH VA BITS MUST AGREE
                          53         00C5       
            53         F7 8F     78  00C6 11100 	ASHL	#-VA$S_BYTE,R3,R3	;SHIFT OUT THE ONES THAT MAY DIFFER
                          53         00CA       
                          14     12  00CB 11200 	BNEQ	WSLXVANOMAT		;AND BRANCH IF HIGH BITS DISAGREE
                          FF30'  30  00CD 11300 	BSBW	MMG$DELWSLEPPG		;DELETE WORKING SET LIST ENTRY
                                     00D0 11400 					;FOR PRCESS PAGE
                                     00D0 11500 ;
                                     00D0 11600 ; IF THE PAGE WAS QUEUED FOR WRITING, THEN THE REFERENCE COUNT WILL BE UP
                                     00D0 11700 ;
                                     00D0 11800 	DECREF	GTR=80$			;ONE LESS REF WITH WSLE RELEASED
                          FF21'  30  00DC 11900 	BSBW	MMG$RELPFN		;WILL RESULT IN PTE CONTAINING ITS
                                     00DF 12000 					;BACKING STORE FORMAT
                          4D     11  00DF 12200 	BRB	DELAGAIN1		;GO DELETE THE PTE
                                     00E1 12210 ;
                                     00E1 12220 ; WORKING SET LIST ENTRY AND VIRTUAL ADDRESS DISAGREE
                                     00E1 12230 ;
                                     00E1 12235 WSLXVANOMAT:
                                     00E1 12240 	BUG_CHECK WSLXVANMAT,FATAL
                                     00E5 12300 ;
                                     00E5 12400 ; I/O IN PROGRESS ON THIS PAGE, MUST WAIT
                                     00E5 12500 ;
                                     00E5 12550 DELPAGIOWAIT1:
                          04     BA  00E5 12600 80$:	POPR	#^M<R2>			;RESTORE SAVED VA
                          07     11  00E7 12700 90$:	BRB	DELPAGIOWAIT		;WAIT FOR I/O COMPLETION
                                     00E9 13110 
                                     00E9 13120 	.DSABL	LSB
                                     00E9 13200 ;
                                     00E9 13300 ; WAIT FOR I/O TO COMPLETE OR RESOURCE TO BECOME AVAILABLE
                                     00E9 13400 ; 0(SP) = SAVED ACCESS MODE, TO BE RESTORED TO R0
                                     00E9 13500 ; 8(SP) = PSL AT ENTRY TO DELPAG
                                     00E9 13600 ; R2, R4, R5, R6, R7, R8 AS THEY WERE ON ENTRY TO DELPAG
                                     00E9 13700 ; R1 = RESOURCE TO WAIT FOR
                                     00E9 13800 ;
                                     00E9 13900 	.ENABL	LSB
                                     00E9 14000 DELPAGRESWAIT:
                          52     DD  00E9 14050 	PUSHL	R2			;SAVE VIRTUAL ADDRESS
                          FF12'  30  00EB 14100 	BSBW	MMG$RESRCWAIT		;SET UP TO WAIT FOR THE RESOURCE
                          11     11  00EE 14200 	BRB	10$
                                     00F0 14300 
                                     00F0 14310 ;
                                     00F0 14320 ; R0 = PAGE FRAME NUMBER
                                     00F0 14330 ;
                                     00F0 14400 DELPAGIOWAIT:
       0000'DF40       40 8F     88  00F0 14410 	BISB	#PFN$M_RPTEVT,@W^PFN$AB_TYPE[R0] ;WAKE THIS PROCESS ON I/O COMPLETE
                                     00F7 14420 					;DELCONPFN WILL CLEAR THIS BIT
                          52     DD  00F7 14435 	PUSHL	R2			;SAVE VIRTUAL ADDRESS
            50       0000'CF     7E  00F9 14450 	MOVAQ	W^SCH$GQ_PFWQ,R0	;PAGE FAULT WAIT QUEUE HEAD
SYSCREDEL       - SYSTEM SERVICE CREATE & DELETE PAGE            21-AUG-1978 20:22:37   VAX-11 MACRO X0.3-11               Page  30
X0310           DELPAG - DELETE A SINGLE PAGE                                                                                   (22)

                          FEFF'  30  00FE 14500 	BSBW	MMG$PGFLTWAIT		;SET UP TO WAIT ON PAGE FAULT WAIT QUEUE
                          04     BA  0101 14600 10$:	POPR	#^M<R2>			;RESTORE SAVED VIRTUAL ADDRESS
                          01     BA  0103 14700 	POPR	#^M<R0>			;R0 = SAVED ACCESS MODE
            6E       FF38 CF     DE  0105 14800 	MOVAL	W^MMG$DELPAG,(SP)	;STORE PC TO RESTART AT
                          FEF3'  31  010A 14900 	BRW	MMG$SVPCTX		;AND EXIT TO SCHEDULER
                                     010D 15000 
                                     010D 15100 	.DSABL LSB
                                     010D 15130 ;
                                     010D 15140 ; TRANSITION PAGE ON FREE, MODIFIED OR BAD PAGE LIST
                                     010D 15150 ; R0 = PFN, R1 = LIST ID
                                     010D 15180 ;
                                     010D 15190 MFY_OR_FRELST:
                          52     DD  010D 15195 	PUSHL	R2			;SAVE VA
            52            51     D0  010F 15200 	MOVL	R1,R2			;GET LIST ID
                          17     13  0112 15205 	BEQL	20$			;BRANCH IF FREE LIST
            0D            52     E9  0114 15207 	BLBC	R2,10$			;BRANCH IF BAD PAGE LIST
       0000'DF40          09     9C  0117 15210 	ROTL	#<31-PTE$V_TYP0>,@W^PFN$AL_BAK[R0],R1 ;TYP0 BIT TO SIGN BIT
                          51         011D       
                          04     18  011E 15215 	BGEQ	10$			;BRANCH IF NOT SECTION PAGE (TYP0=0)
                          04     BA  0120 15220 	POPR	#^M<R2>			;RECOVER SAVED VA
                          2B     11  0122 15225 	BRB	DELFAULT		;AND FAULT THE SECTION PAGE
       0000'DF40       80 8F     8A  0124 15230 10$:	BICB	#PFN$M_MODIFY,@W^PFN$AB_STATE[R0] ;OTHERWISE SKIP THE WRITE
                          FED2'  30  012B 15240 20$:	BSBW	MMG$DELPFNLST		;REMOVE PAGE FROM LIST AND DELETE CONTENTS
                                     012E 15250 DELAGAIN1:
                          04     BA  012E 15260 	POPR	#^M<R2>			;RECOVER SAVED VA
                          23     11  0130 15270 	BRB	DELAGAIN
                                     0132 15600 ;
                                     0132 15610 ; THIS IS A PAGE IN TRANSITION OR A DEMAND ZERO PAGE
                                     0132 15620 ; R0 = PFN, R2 = VA, R3 = SVAPTE
                                     0132 15630 ;
                                     0132 15640 DELTRANS:
                          50     D5  0132 15700 	TSTL	R0			;ZERO PFN INDICATES DEMAND ZERO PAGE
                          39     13  0134 15800 	BEQL	BRBINCPGFLCNT		;BRANCH IF IT IS
                                     0136 15820 
                                     0136 15840 	ASSUME	PFN$C_FREPAGLST EQ 0
                                     0136 15841 	ASSUME	PFN$C_MFYPAGLST EQ 1
                                     0136 15842 	ASSUME	PFN$C_BADPAGLST EQ 2
                                     0136 15843 	ASSUME	PFN$C_RELPEND   EQ 3
                                     0136 15844 	ASSUME	PFN$C_RDERR     EQ 4	;-4
                                     0136 15845 	ASSUME	PFN$C_WRTINPROG EQ 5	;-3
                                     0136 15846 	ASSUME	PFN$C_RDINPROG  EQ 6	;-2
                                     0136 15847 	ASSUME	PFN$C_ACTIVE    EQ 7	;-1
                                     0136 15848 
                          00     EE  0136 15860 	EXTV	#PFN$V_LOC,#PFN$S_LOC,-	;GET PAGE'S LOCATION
       0000'DF40          03         0138 15865 		@W^PFN$AB_STATE[R0],R1
                          51         013D       
                                     013E 15900 	CASE	R1,<-
                                     013E 15910 		DELPAGIOWAIT,-		;-3 = 5 = WRITE IN PROGRESS
                                     013E 15920 		DELFAULT,-		;-2 = 6 = READ IN PROGRESS
                                     013E 15930 		DELVALID,-		;-1 = 7 = ACTIVE
                                     013E 15940 		MFY_OR_FRELST,-		;FREE PAGE LIST
                                     013E 15950 		MFY_OR_FRELST,-		;MODIFIED PAGE LIST
                                     013E 15955 		MFY_OR_FRELST-		;BAD PAGE LIST
                                     013E 15960 		>,TYPE=B,LIMIT=#-3
                                     014F 16225 DELFAULT:
                                     014F 16250 	ENBINT	4(SP)			;OTHERWISE RESTORE IPL
                                     0153 16300 ;
SYSCREDEL       - SYSTEM SERVICE CREATE & DELETE PAGE            21-AUG-1978 20:22:37   VAX-11 MACRO X0.3-11               Page  31
X0310           DELPAG - DELETE A SINGLE PAGE                                                                                   (22)

                                     0153 16400 ; FAULT THE PAGE OUT OF THE TRANSITION STATE
                                     0153 16600 ;
                          62     95  0153 16700 	TSTB	(R2)			;REFERENCE THE PAGE
                                     0155 16800 DELAGAIN:
                          01     BA  0155 16900 	POPR	#^M<R0>			;RESTORE R0 = ACCESS MODE
                                     0157 17000 	ENBINT				;POP AND RESTORE SAVED IPL
            5E            04     C0  015A 17100 	ADDL	#4,SP			;CLEAN OFF SAVED PSL
                          FEE1   31  015D 17200 	BRW	MMG$DELPAG		;RESTART THE ROUTINE FROM THE TOP
                                     0160 17300 ;
                                     0160 17400 ; THIS IS A PAGE FILE PTE
                                     0160 17500 ; R0 = PAGE FILE VBN
                                     0160 17600 ;
                                     0160 17700 DELPAGFIL:
                          50     D5  0160 17800 	TSTL	R0			;NULL PAGE FILE VBN?
                          0B     13  0162 17900 	BEQL	BRBINCPGFLCNT		;BRANCH IF YES
                          0C     BB  0164 18000 	PUSHR	#^M<R2,R3>		;SAVE VA, SVAPTE
            51         1F A5     9A  0166 18100 	MOVZBL	PHD$B_PAGFIL(R5),R1	;PAGE FILE INDEX IN R1
                          FE93'  30  016A 18200 	BSBW	MMG$DALCPAGFIL		;DEALLOCATE THE PAGING FILE VBN
                          0C     BA  016D 18300 	POPR	#^M<R2,R3>		;RESTORE R2 = VA, R3 = SVAPTE
                                     016F 18400 BRBINCPGFLCNT:
                          7E     11  016F 18500 	BRB	INCPGFLCNT		;GO DELETE THE PTE
                                     0171 18550 DELFAULT1:
                          DC     11  0171 18575 	BRB	DELFAULT
                                     0173 18600 ;
                                     0173 18700 ; THIS IS A GLOBAL PTE
                                     0173 18800 ; R0 = GLOBAL PAGE TABLE INDEX
                                     0173 18900 ;
                                     0173 19000 DELGLOBAL:
       0000'DF40 7B800000 8F     CB  0173 19100 	BICL3	#^C<PTE$M_VALID ! -	;VALID BIT
                          51         017D       
                                     017E 19200 		PTE$M_TYP1 ! PTE$M_TYP0 ! - ;PAGE TYPE BITS
                                     017E 19300 		PTE$M_PGFLVB>,@W^MMG$GL_GPTBASE[R0],R1 ;ETC, FROM MASTER PTE
                          24     19  017E 19400 	BLSS	20$			;BRANCH IF MASTER PTE IS VALID
            51         EA 8F     78  0180 19500 	ASHL	#-PTE$V_TYP0,R1,R0	;LEAVE ONLY THE TYPE BITS
                          50         0184       
                          09     13  0185 19600 	BEQL	15$			;BRANCH IF MASTER PTE IN TRANSITION
                                     0187 19700 	ASSUME	<PTE$V_TYP1-PTE$V_TYP0> LE 7
            50            11     8C  0187 19800 	XORB	#<PTE$M_TYP1 ! PTE$M_TYP0>@-PTE$V_TYP0,R0 ;BOTH SET?
                          2A     13  018A 19900 	BEQL	30$			;BRANCH IF YES, SECTION ADDRESS
                                     018C 20000 10$:	BUG_CHECK IVGBLTYP,FATAL	;INVALID GLOBAL MASTER PTE TYPE
                          51     DD  0190 20050 15$:	PUSHL	R1			;SAVE MASTER PTE PFN
                          00     EE  0192 20100 	EXTV	#PFN$V_LOC,#PFN$S_LOC,-	;IF PAGE IS READ IN PROGRESS
       0000'DF41          03         0194 20200 		@W^PFN$AB_STATE[R1],R1	;READ ERROR, OR ACTIVE BUT NOT VALID
                          51         0199       
                                     019A 20210 					;THEN MUST SEE IF THERE IS A WSLE
                          06     18  019A 20300 	BGEQ	18$			;BRANCH IF ON PFN LIST OR RELPEND
            51         FD 8F     91  019C 20350 	CMPB	#<PFN$C_WRTINPROG ! <<-1>@PFN$S_LOC>>,R1 ; IF NOT WRITE IN PROGRESS
                          32     12  01A0 20400 	BNEQ	40$			;THEN READ IN PROG, READ ERR, ACTIVE
                          02     BA  01A2 20450 18$:	POPR	#^M<R1>			;RECOVER MASTER PTE PFN
            15            00     EF  01A4 20500 20$:	EXTZV	#PTE$V_PFN,#PTE$S_PFN,R1,R1 ;PFN FROM VALID OR TRANSITION PTE
            51            51         01A7       
            51       0000'DF41   D0  01A9 20600 	MOVL	@W^PFN$AL_BAK[R1],R1	;BACKING STORE ADDRESS
            02            16     ED  01AF 20700 	CMPZV	#PTE$V_TYP0,#2,R1,#1	;MUST BE SECTION TABLE
            01            51         01B2       
                          D6     12  01B4 20800 	BNEQ	10$			;BRANCH IF NOT
            51            11     E0  01B6 20810 30$:	BBS	#PTE$V_DZRO,R1,DELFAULT	;FAULT IF DEMAND ZERO
                          95         01B9       
SYSCREDEL       - SYSTEM SERVICE CREATE & DELETE PAGE            21-AUG-1978 20:22:37   VAX-11 MACRO X0.3-11               Page  32
X0310           DELPAG - DELETE A SINGLE PAGE                                                                                   (22)

            51            10     E1  01BA 20815 	BBC	#PTE$V_CRF,R1,35$	;BRANCH IF NOT COPY ON REFERENCE SECTION
                          03         01BD       
                       34 A5     D6  01BE 20820 	INCL	PHD$L_PGFLCNT(R5)	;ONE LESS PAGE FILE PAGE CHARGED
            51            51     32  01C1 20900 35$:	CVTWL	R1,R1			;ISOLATE GLOBAL SECTION TABLE INDEX
                          24     BB  01C4 21000 	PUSHR	#^M<R2,R5>		;SAVE THESE
            55   00000000'FF     DE  01C6 21100 	MOVAL	@L^MMG$GL_SYSPHD,R5	;ADDRESS OF SYSTEM HEADER
                          FE30'  30  01CD 21200 	BSBW	MMG$DECSECREF		;COUNT ONE LESS SECTION REFERENCE
                          24     BA  01D0 21300 	POPR	#^M<R2,R5>		;RESTORE SAVED REGISTERS
                          1E     11  01D2 21400 	BRB	DELPTE			;FINISH DELETING THE PAGE TABLE ENTRY
                          02     BA  01D4 21450 40$:	POPR	#^M<R1>			;CLEAN OFF MASTER PTE PFN
            6E            09     E2  01D6 21460 	BBSS	#CDL$V_DELGBLDON,(SP),20$ ;IF ALREADY DELETED THESE GLOBAL
                          CA         01D9       
                                     01DA 21470 					;WSLE'S, THEN DON'T DO IT AGAIN
                          FE55   31  01DA 21500 	BRW	DELGBLRDINPROG		;GO DO THE DELGBL SCAN
                                     01DD 21600 ;
                                     01DD 21700 ; THIS IS A PROCESS SECTION PAGE
                                     01DD 21800 ; R0 = SECTION INDEX AND FLAGS
                                     01DD 21900 ;
                                     01DD 22000 DELSTX:					;PROCESS SECTION PAGE
            50            11     E0  01DD 22050 	BBS	#PTE$V_DZRO,R0,DELFAULT1 ;FAULT IF DEMAND ZERO
                          90         01E0       
            51            50     32  01E1 22100 	CVTWL	R0,R1			;SECTION INDEX
                          52     DD  01E4 22200 	PUSHL	R2			;SAVE VA
                          FE17'  30  01E6 22300 	BSBW	MMG$DECSECREF		;DECREASE SECTION REFERENCE COUNT
                          04     BA  01E9 22400 	POPR	#^M<R2>			;RECOVER SAVED VA
            50            10     E1  01EB 22410 	BBC	#PTE$V_CRF,R0,DELPTE	;BRANCH IF NOT CRF SECTION
                          03         01EE       
                                     01EF 22420 INCPGFLCNT:
                       34 A5     D6  01EF 22430 	INCL	PHD$L_PGFLCNT(R5)	;ONE LESS PAGE FILE PAGE CHARGED
                                     01F2 22500 ;
                                     01F2 22600 ; FALL THROUGH TO DELPTE
                                     01F2 22700 ;
                                     01F2 22800 DELPTE:
                          63     D4  01F2 22900 	CLRL	(R3)			;JUST ZERO THE PTE
                          56     D5  01F4 23000 	TSTL	R6			;LAST PAGE OF THE RANGE?
                          0B     13  01F6 23100 	BEQL	DELPAGLAST		;YES, GO CONTRACT THE REGION
                                     01F8 23200 
                                     01F8 23300 DELPAGSUCCESS:
            50            01     3C  01F8 23400 	MOVZWL	#SS$_NORMAL,R0		;SUCCESS RETURN
                                     01FB 23500 ;
                                     01FB 23600 ; 0(SP) = ACCESS MODE, 4(SP) = IPL TO RESTORE, 8(SP) = SAVED PSL
                                     01FB 23700 ;
                                     01FB 23800 DELPAGRET:
                                     01FB 23900 	ENBINT	4(SP)			;RESTORE SAVED IPL
            5E            0C     C0  01FF 24000 	ADDL	#12,SP			;ADJUST THE STACK
                                 05  0202 24100 	RSB				;AND RETURN
                                     0203 24200 ;
                                     0203 24300 ; LAST PAGE OF THE DELETE RANGE
                                     0203 24400 ;
                                     0203 24500 DELPAGLAST:
                                     0203 24600 	SETIPL	#IPL$_ASTDEL		;NO NEED FOR SYNCH HERE
                 000002F7'EF     16  0206 24700 	JSB	MMG$CONTRACT		;CONTRACT REGION IF POSSIBLE
                          EA     11  020C 24800 	BRB	DELPAGSUCCESS		;AND EXIT SUCCESSFULLY
                                     020E 24900 ;
                                     020E 25000 ; MUST WRITE SECTION PAGE BACK TO DISK BEFORE DELETE
                                     020E 25100 ; 0(SP) = SAVED ACCESS MODE
                                     020E 25200 ; 8(SP) = SAVED PSL AT ENTRY TO DELPAG
SYSCREDEL       - SYSTEM SERVICE CREATE & DELETE PAGE            21-AUG-1978 20:22:37   VAX-11 MACRO X0.3-11               Page  33
X0310           DELPAG - DELETE A SINGLE PAGE                                                                                   (22)

                                     020E 25300 ;
                                     020E 25400 DELPAG_WRTBAK:
                          0D     BB  020E 25500 	PUSHR	#^M<R0,R2,R3>		;SAVE SOME REGISTERS
                       44 A4     B5  0210 25600 	TSTW	PCB$W_DIOCNT(R4)	;EXHAUSTED DIRECT I/O QUOTA?
                          3E     13  0213 25700 	BEQL	40$			;BRANCH IF YES, WAIT FOR SOME TO COMPLETE
            52       0000'DF     0F  0215 25800 	REMQUE	@W^IOC$GL_IRPFL,R2	;GET AN I/O PACKET FROM THE SIDE LIST
                          0D     1C  021A 25900 	BVC	20$			;BRANCH IF GOT ONE
            51         4C 8F     9A  021C 26000 	MOVZBL	#IRP$C_LENGTH,R1	;SIZE OF PACKET TO ALLOCATE
                          FDDD'  30  0220 26100 	BSBW	EXE$ALONONPAGED		;ALLOCATE IT FROM NON-PAGED POOL
            51            03     9A  0223 26200 	MOVZBL	#RSN$_NPDYNMEM,R1	;IN ANTICIPATION OF ALLOCATION FAILURE
            2D            50     E9  0226 26300 	BLBC	R0,60$			;BRANCH IF MUST WAIT FOR A PACKET
            51            52     D0  0229 26320 20$:	MOVL	R2,R1			;I/O PACKET ADDRESS TO R1
                          0D     BA  022C 26340 	POPR	#^M<R0,R2,R3>		;R0=PFN, R2=VA, R3=SVAPTE
         08 A1         4C 8F     9B  022E 26400 	MOVZBW	#IRP$C_LENGTH,IRP$W_SIZE(R1) ;SET SIZE FIELD
                                     0233 26500 					;TYPE FIELD FILLED IN BY WRTPGSBAK
         0B A1            6E     90  0233 26600 	MOVB	(SP),IRP$B_RMOD(R1)	;REQUESTING MODE FROM ACCESS MODE PARAM
         40 A1            52     D0  0237 26620 	MOVL	R2,IRP$L_SEGVBN(R1)	;SAVE STARTING VA FOR SCAN
                          0D     BB  023B 26640 	PUSHR	#^M<R0,R2,R3>		;PRESERVE THESE ACROSS THE CALL
            52       0000'DF40   D0  023D 26900 	MOVL	@W^PFN$AL_BAK[R0],R2	;BACKING STORE ADDRESS IN R2
                          FDBA'  30  0243 27100 	BSBW	MMG$WRTPGSBAK		;WRITE A CLUSTER OF PAGES BACK
                          0D     BA  0246 27200 	POPR	#^M<R0,R2,R3>		;RESTORE SAVED REGISTERS
            00            05     F0  0248 27300 	INSV	#PFN$C_WRTINPROG,#PFN$V_LOC,#PFN$S_LOC,-
                                     024B       
       0000'DF40          03         024B 27400 		@W^PFN$AB_STATE[R0]	;FORCE THIS PAGE TO WRITE IN PROGRESS
                          FE4F   31  0250 27450 	BRW	DELPAG_WRTDONE
                                     0253 27500 ;
                                     0253 27600 ; DIRECT I/O QUOTA EXCEEDED, MUST WAIT FOR A DIRECT I/O TO COMPLETE
                                     0253 27700 ;
            51            01     9A  0253 27800 40$:	MOVZBL	#RSN$_ASTWAIT,R1	;WAIT FOR AN AST TO OCCUR
                                     0256 27900 ;
                                     0256 28000 ; UNABLE TO WRITE SECTION PAGE BACK, MUST WAIT FOR RESOURCE IN R1
                                     0256 28100 ;
                          0D     BA  0256 28200 60$:	POPR	#^M<R0,R2,R3>		;R0=PFN, R2=VA, R3=SVAPTE
                          FE8E   31  0258 28300 	BRW	DELPAGRESWAIT		;GO WAIT FOR THE RESOURCE
SYSCREDEL       - SYSTEM SERVICE CREATE & DELETE PAGE            21-AUG-1978 20:22:37   VAX-11 MACRO X0.3-11               Page  34
X0310           CONTRACT - ADJUST THE LENGTH OF THE SPECIFIED R                                                                 (23)

                                     025B   100 	.SBTTL	CONTRACT - ADJUST THE LENGTH OF THE SPECIFIED REGION
                                     025B   200 
                                     025B   300 ;
                                     025B   400 ; INPUTS:
                                     025B   500 ;
                                     025B   600 ;	R2 = VIRTUAL ADDRESS (USED ONLY TO SPECIFY P0/P1 SPACE)
                                     025B   700 ;	R4 = PROCESS CONTROL BLOCK ADDRESS
                                     025B   800 ;	R5 = PROCESS HEADER ADDRESS (P1 SPACE REQUIRED)
                                     025B   900 ;	IPL = ASTDEL
                                     025B  1000 ;
                                     025B  1100 ; OUTPUTS:
                                     025B  1200 ;
                                     025B  1300 ;	R2 PRESERVED
                                     025B  1400 ;
                                     025B  1500 ;
                                     025B  1600 ; **********************************************************************
                                     025B  1700 ;
                                     025B  1800 ; **************** THE FOLLOWING CODE MAY BE PAGED *****************
                                     025B  1900 ;
                                 000002F7  2000 	.PSECT	Y$EXEPAGED
                                     02F7  2100 ;
                                     02F7  2200 ; **********************************************************************
                                     02F7  2300 ;
                                     02F7  2400 MMG$CONTRACT:
                          52     DD  02F7  2500 	PUSHL	R2			;SAVE VIRTUAL ADDRESS
                          FD04'  30  02F9  2600 	BSBW	MMG$DALCSTXSCN		;SEE IF ANY SECTIONS TO DEALLOCATE
                          04     BA  02FC  2700 	POPR	#^M<R2>			;RESTORE VIRTUAL ADDRESS
            50            01     CE  02FE  2800 	MNEGL	#1,R0			;INITIAL COUNT OF PAGES TO REDUCE THE REGION BY
            52            1E     E0  0301  2900 	BBS	#VA$V_P1,R2,40$		;BRANCH IF P1 SPACE
                          14         0304       
                                     0305  3000 ;
                                     0305  3100 ; P0 SPACE
                                     0305  3200 ;
                          09     EE  0305  3300 	EXTV	#VA$V_VPN,#VA$S_VPN+1,-	;GET VIRTUAL PAGE NUMBER
         28 A5            16         0307  3400 		PHD$L_FREP0VA(R5),R3	;OF FIRST FREE PAGE IN P0 SPACE
                          53         030A       
            53   00000000'EF     C0  030B  3500 	ADDL	SGN$GL_PHDLWCNT,R3	;AND FORM PAGE TABLE INDEX
                          50     DD  0312  3600 	PUSHL	R0			;-1 FOR GOING BACKWARDS THROUGH PTE'S
            51            09     DB  0314  3700 	MFPR	#PR$_P0LR,R1		;NUMBER OF PAGES IN P0 SPACE
                          21     11  0317  3800 	BRB	70$			;START SCAN OF ZERO PTE'S
                                     0319  3900 ;
                                     0319  4000 ; P1 SPACE
                                     0319  4100 ;
                          09     EE  0319  4200 40$:	EXTV	#VA$V_VPN,#VA$S_VPN+1,-	;VIRTUAL PAGE NO.
         30 A5            16         031B  4300 		PHD$L_FREP1VA(R5),R3	;0F FIRST FREE PAGE IN P1 SPACE
                          53         031E       
            53   00000000'EF     C0  031F  4400 	ADDL	SGN$GL_P1LWCNT,R3	;FORM PT INDEX
                          01     DD  0326  4500 	PUSHL	#1			;+1 FOR GOING FORWARD THROUGH PTE'S
   00200000 8F       00D4 C5     C3  0328  4600 	SUBL3	PHD$L_P1LR(R5),#1@21,R1	;NO. OF PAGES IN P1 SPACE
                          51         0331       
                          06     11  0332  4700 	BRB	70$			;START SCANNING FOR ZERO PTE'S
                                     0334  4800 ;
                                     0334  4900 ; 0(SP) = +1 IF GOING FORWARD IN PTE'S (P1 SPACE)
                                     0334  5000 ;	= -1 IF GOING BACKWARDS IN PTE'S (P0 SPACE)
                                     0334  5100 ; R0 = -1 WITH LOOP ENTERED AT 70$
                                     0334  5200 ; R1 = MAX NUMBER OF PAGE TABLE ENTRIES TO SCAN (POSSIBLY 0)
                                     0334  5300 ; R3 = PTE INDEX FOR THE FIRST NON-EXISTING PAGE IN THE REGION
SYSCREDEL       - SYSTEM SERVICE CREATE & DELETE PAGE            21-AUG-1978 20:22:37   VAX-11 MACRO X0.3-11               Page  35
X0310           CONTRACT - ADJUST THE LENGTH OF THE SPECIFIED R                                                                 (23)

                                     0334  5400 ;
                       64 B443   D5  0334  5500 60$:	TSTL	@PCB$L_PHD(R4)[R3]	;DELETED PAGE TABLE ENTRY?
                          07     12  0338  5600 	BNEQ	80$			;BRANCH IF NOT
            53            6E     C0  033A  5700 70$:	ADDL	(SP),R3			;NEXT PAGE TABLE INDEX
            50            51     F2  033D  5800 	AOBLSS	R1,R0,60$		;TEST NEXT PTE
                          F3         0340       
                                     0341  5900 ;
                                     0341  6000 ; R0 = NUMBER OF PAGES TO CONTRACT THE REGION BY, POSSIBLY 0
                                     0341  6100 ;
         2C A5            50     C0  0341  6200 80$:	ADDL	R0,PHD$L_FREPTECNT(R5)	;THAT MANY MORE FREE PAGE TABLE ENTRIES
            50            09     9C  0345  6300 	ROTL	#9,R0,R1		;NO. OF BYTES TO CONTRACT REGION BY
                          51         0348       
                          8E     D5  0349  6400 	TSTL	(SP)+			;CLEAN OFF PTE SCAN DIRECTION
                          12     14  034B  6500 	BGTR	90$			;BRANCH IF P1 SPACE
                                     034D  6600 ;
                                     034D  6700 ; P0 SPACE
                                     034D  6800 ;
       00CC C5            50     C2  034D  6900 	SUBL	R0,PHD$L_P0LRASTL(R5)	;ADJUST NO. OF PAGES
         28 A5            51     C2  0352  7000 	SUBL	R1,PHD$L_FREP0VA(R5)	;ADJUST FIRST FREE P0 SPACE VIRT ADR
                          1B     19  0356  7100 	BLSS	120$			;ERROR IF NOT STILL P0 SPACE
                                     0358  7200 	LDP0LR	PHD$L_P0LRASTL(R5)	;LOAD HARDWARE P0 SPACE LENGTH REGISTER
            09       00CC C5     DA  0358       		MTPR	PHD$L_P0LRASTL(R5),S^#PR$_P0LR
                          10     11  035D  7300 	BRB	100$
                                     035F  7400 ;
                                     035F  7500 ; P1 SPACE
                                     035F  7600 ;
       00D4 C5            50     C0  035F  7700 90$:	ADDL	R0,PHD$L_P1LR(R5)	;UPDATE P1 LENGTH
         30 A5            51     C0  0364  7800 	ADDL	R1,PHD$L_FREP1VA(R5)	;AND FIRST FREE P1 VIRT ADR
                          09     19  0368  7900 	BLSS	120$			;ERROR IF NOT STILL P1 SPACE
                                     036A  8000 	LDP1LR	PHD$L_P1LR(R5)		;UPDATE HARDWARE P1 LENGTH REGISTER
            0B       00D4 C5     DA  036A       		MTPR	PHD$L_P1LR(R5),S^#PR$_P1LR
                          FF61   30  036F  8100 100$:	BSBW	UPDATPTCNT		;UPDATE MAX PAGE TABLE COUNT
                                 05  0372  8200 	RSB
                                     0373  8300 ;
                                     0373  8400 ; FREE P0/P1 VIRTUAL ADDRESS IS FOULED UP
                                     0373  8500 ;
                                     0373  8600 120$:	BUG_CHECK CONTRACT,FATAL	;BAD FREP0VA OR FREP1VA
SYSCREDEL       - SYSTEM SERVICE CREATE & DELETE PAGE            21-AUG-1978 20:22:37   VAX-11 MACRO X0.3-11               Page  36
X0310           PAGETYPE - CALCULATE PAGE TYPE                                                                                  (24)

                                     0377   100 	.SBTTL	PAGETYPE - CALCULATE PAGE TYPE
                                     0377   200 
                                     0377   300 ;
                                     0377   400 ; INPUTS:
                                     0377   500 ;
                                     0377   600 ;	R0 = ACCESS MODE FOR PAGE OWNER CHECK
                                     0377   700 ;	R1 = PAGE TABLE ENTRY CONTENTS (NOT 0)
                                     0377   800 ;
                                     0377   900 ; OUTPUTS:
                                     0377  1000 ;
                                     0377  1100 ;	R0 = STATUS CODE
                                     0377  1200 ;		SS$_NORMAL IF SUCCESSFUL
                                     0377  1300 ;		SS$_PAGOWNVIO IF CAN'T OPERATE ON THIS PAGE
                                     0377  1400 ;	R1 = PAGE TYPE CODE IN LOW BYTE
                                     0377  1500 ;		0 = TRANSITION
                                     0377  1600 ;		1 = PAGE FILE
                                     0377  1700 ;		2 = GLOBAL
                                     0377  1800 ;		3 = SECTION INDEX
                                     0377  1900 ;		4 = VALID
                                     0377  2000 ;
                                     0377  2100 ;
                                     0377  2200 ; **********************************************************************
                                     0377  2300 ;
                                     0377  2400 ; **************** THE FOLLOWING CODE MUST BE RESIDENT *****************
                                     0377  2500 ;
                                 0000025B  2600 	.PSECT	$MMGCOD
                                     025B  2700 ;
                                     025B  2800 ; **********************************************************************
                                     025B  2900 ;
                                     025B  3000 MMG$PAGETYPE::
            02            17     ED  025B  3100 	CMPZV	#PTE$V_OWN,#PTE$S_OWN,R1,R0 ;PAGE OWNER OK?
            50            51         025E       
                          19     19  0260  3200 	BLSS	20$			;BRANCH IF NO
            50            01     3C  0262  3300 	MOVZWL	#SS$_NORMAL,R0		;SUCCESSFUL COMPLETION
            51            1F     E1  0265  3400 	BBC	#PTE$V_VALID,R1,10$	;BRANCH IF PAGE NOT VALID
                          04         0268       
            51            04     D0  0269  3500 	MOVL	#4,R1			;CODE FOR VALID PAGE
                                 05  026C  3600 	RSB
            05            16     EE  026D  3700 10$:	EXTV	#PTE$V_TYP0,#<PTE$V_TYP1+1-PTE$V_TYP0>,R1,R1
            51            51         0270       
                                     0272  3800 ;
                                     0272  3900 ; LOW BIT = TYP0, SIGN BIT = TYP1
                                     0272  4000 ;
            51            01     9C  0272  4100 	ROTL	#1,R1,R1		;BIT 0 = TYP1, BIT 1 = TYP0
                          51         0275       
            51         FC 8F     8A  0276  4200 	BICB	#^C<3>,R1		;CLEAR REST OF THE BYTE
                                 05  027A  4300 	RSB				;AND RETURN THE PAGE TYPE
                                     027B  4400 ;
                                     027B  4500 ; PAGE OWNER VIOLATION
                                     027B  4600 ;
            50       01EC 8F     3C  027B  4700 20$:	MOVZWL	#SS$_PAGOWNVIO,R0	;PAGE OWNER VIOLATION
                                 05  0280  4800 	RSB
                                     0281  4900 
                                     0281  5000 
                                     0281  5100 
                                     0281  5200 	.END
SYSCREDEL       - SYSTEM SERVICE CREATE & DELETE PAGE            21-AUG-1978 20:22:37   VAX-11 MACRO X0.3-11               Page  37
SYMBOL TABLE                                                                                                                    (24)

ACCVIO           0000010C R     03   IPL$_ASTDEL    = 00000002            IRP$V_PHYSIO   = 00000008            
ACMODE         = 0000000C            IPL$_HWCLK     = 00000018            IRP$V_PRIVIO   = 00000009            
BIT...         = 0000000A            IPL$_IOPOST    = 00000004            IRP$V_SWAPIO   = 00000006            
BRBINCPGFLCNT    0000016F R     04   IPL$_MAILBOX   = 0000000B            IRP$V_VIRTUAL  = 00000004            
BRDELPAGRET      00000008 R     04   IPL$_POWER     = 0000001F            IRP$W_ABCNT      0000003C            
BRDELPAGSUCCESS  00000005 R     04   IPL$_QUEUEAST  = 00000006            IRP$W_BCNT       00000032            
BUG$_CONTRACT    ********   X   03   IPL$_SCHED     = 00000003            IRP$W_BOFF       00000030            
BUG$_IVGBLTYP    ********   X   04   IPL$_SYNCH     = 00000007            IRP$W_CHAN       00000028            
BUG$_WSLXVANMAT  ********   X   04   IPL$_TIMER     = 00000007            IRP$W_FUNC       00000020            
CDL$C_LENGTH   = 00000014  G         IRP$B_CARCON     00000038            IRP$W_OBCNT      0000003E            
CDL$L_CALLEDIPL= FFFFFFF8  G         IRP$B_EFN        00000022            IRP$W_SIZE       00000008            
CDL$L_MAXACMODE= FFFFFFFC  G         IRP$B_PRI        00000023            IRP$W_STS        0000002A            
CDL$L_PAGESUBR = FFFFFFF0  G         IRP$B_RMOD       0000000B            IRP$W_TT_PRMPT   0000003C            
CDL$L_SAVRETADR= FFFFFFF4  G         IRP$B_TYPE       0000000A            MFY_OR_FRELST    0000010D R     04   
CDL$L_SVSTARTVA= FFFFFFEC  G         IRP$C_LENGTH     0000004C            MMG$AB_DZRO      00000057 R     03   
CDL$M_CHGPAGFIL= 00000100  G         IRP$K_LENGTH     0000004C            MMG$CONTRACT     000002F7 R     03   
CDL$M_DELGBLDON= 00000200  G         IRP$L_AST        00000010            MMG$CRECOM1      0000007A RG    03   
CDL$V_CHGPAGFIL= 00000008  G         IRP$L_ASTPRM     00000014            MMG$CRECOM2      00000082 RG    03   
CDL$V_DELGBLDON= 00000009  G         IRP$L_DIAGBUF    00000044            MMG$CREDEL       00000173 R     03   
CRECOM3          0000007C R     03   IRP$L_IOQBL      00000004            MMG$CREPAG       000001F8 RG    03   
CTL$GL_PHD       ********   X   03   IRP$L_IOQFL      00000000            MMG$CREPAGINI    0000003F R     03   
CTL$GL_VIRTPEAK  ********   X   03   IRP$L_IOSB       00000024            MMG$CRETVA       0000005B RG    03   
DELAGAIN         00000155 R     04   IRP$L_IOST1      00000034            MMG$DALCPAGFIL   ********   X   04   
DELAGAIN1        0000012E R     04   IRP$L_IOST2      00000038            MMG$DALCSTXSCN   ********   X   03   
DELCOM           00000155 R     03   IRP$L_MEDIA      00000034            MMG$DECSECREF    ********   X   04   
DELETEFIRST      000001E6 R     03   IRP$L_PID        0000000C            MMG$DELPAG       00000041 R     04   
DELFAULT         0000014F R     04   IRP$L_SEGVBN     00000040            MMG$DELPFNLST    ********   X   04   
DELFAULT1        00000171 R     04   IRP$L_SEQNUM     00000048            MMG$DELWSLEPPG   ********   X   04   
DELGBLRDINPROG   00000032 R     04   IRP$L_SVAPTE     0000002C            MMG$EXTRADYNWS   ********   X   03   
DELGLOBAL        00000173 R     04   IRP$L_TT_TERM    00000038            MMG$GL_GPTBASE   ********   X   04   
DELPAGFIL        00000160 R     04   IRP$L_UCB        0000001C            MMG$GL_SYSPHD    ********   X   04   
DELPAGIOWAIT     000000F0 R     04   IRP$L_WIND       00000018            MMG$INADRINI     000000D1 RG    03   
DELPAGIOWAIT1    000000E5 R     04   IRP$M_BUFIO    = 00000001            MMG$LCKULKPAG    ********   X   04   
DELPAGLAST       00000203 R     04   IRP$M_CHAINED  = 00000020            MMG$PAGETYPE     0000025B RG    04   
DELPAGLENVIO     00000000 R     04   IRP$M_COMPLX   = 00000008            MMG$PGFLTWAIT    ********   X   04   
DELPAGLOCKED     0000000B R     04   IRP$M_DIAGBUF  = 00000080            MMG$PTEREF       ********   X   04   
DELPAGNOTPROCES  0000002E R     04   IRP$M_FUNC     = 00000002            MMG$PURGWSSCN    ********   X   04   
DELPAGRESWAIT    000000E9 R     04   IRP$M_MBXIO    = 00000400            MMG$REFCNTNEG    ********   X   04   
DELPAGRET        000001FB R     04   IRP$M_PAGIO    = 00000004            MMG$RELPFN       ********   X   04   
DELPAGSUCCESS    000001F8 R     04   IRP$M_PHYSIO   = 00000100            MMG$RESRCWAIT    ********   X   04   
DELPAG_WRTBAK    0000020E R     04   IRP$M_PRIVIO   = 00000200            MMG$RETADRINI    000000E0 RG    03   
DELPAG_WRTDONE   000000A2 R     04   IRP$M_SWAPIO   = 00000040            MMG$RETRANGE     000000FC R     03   
DELPTE           000001F2 R     04   IRP$M_VIRTUAL  = 00000010            MMG$SVPCTX       ********   X   04   
DELSTX           000001DD R     04   IRP$Q_NT_PRVMSK  0000003C            MMG$WRTPGSBAK    ********   X   04   
DELTRANS         00000132 R     04   IRP$S_FCODE    = 00000006            PAGCNT         = 00000004            
DELVALID         0000006D R     04   IRP$S_FMOD     = 0000000A            PCB$B_ASTACT     0000000C            
EXE$ALONONPAGED  ********   X   04   IRP$S_MODE     = 00000002            PCB$B_ASTEN      0000000D            
EXE$CNTREG       0000008C RG    03   IRP$V_BUFIO    = 00000000            PCB$B_PRI        0000000B            
EXE$CRETVA       00000063 RG    03   IRP$V_CHAINED  = 00000005            PCB$B_PRIB       00000033            
EXE$DELTVA       00000110 RG    03   IRP$V_COMPLX   = 00000003            PCB$B_TYPE       0000000A            
EXE$EXPREG       00000006 RG    03   IRP$V_DIAGBUF  = 00000007            PCB$B_WEFC       00000032            
EXE$MAXACMODE    ********   X   03   IRP$V_FCODE    = 00000000            PCB$C_LENGTH     0000007C            
EXPANDCHK        0000028C R     03   IRP$V_FMOD     = 00000006            PCB$K_LENGTH     0000007C            
GBL...         = 00000000            IRP$V_FUNC     = 00000001            PCB$L_ASTQBL     00000014            
INADR          = 00000004            IRP$V_MBXIO    = 0000000A            PCB$L_ASTQFL     00000010            
INCPGFLCNT       000001EF R     04   IRP$V_MODE     = 00000000            PCB$L_EFC2P      00000058            
IOC$GL_IRPFL     ********   X   04   IRP$V_PAGIO    = 00000002            PCB$L_EFC3P      0000005C            
SYSCREDEL       - SYSTEM SERVICE CREATE & DELETE PAGE            21-AUG-1978 20:22:37   VAX-11 MACRO X0.3-11               Page  38
SYMBOL TABLE                                                                                                                    (24)

PCB$L_EFCS       00000050            PCB$W_TQCNT      0000004A            PHD$L_FREP0VA    00000028            
PCB$L_EFCU       00000054            PFN$AB_STATE     ********   X   04   PHD$L_FREP1VA    00000030            
PCB$L_EFWM       0000004C            PFN$AB_TYPE      ********   X   04   PHD$L_FREPTECNT  0000002C            
PCB$L_OWNER      0000001C            PFN$AL_BAK       ********   X   04   PHD$L_KSP        00000078            
PCB$L_PHD        00000064            PFN$AW_REFCNT    ********   X   04   PHD$L_P0BR       000000C8            
PCB$L_PHYPCB     00000018            PFN$AW_WSLX      ********   X   04   PHD$L_P0LRASTL   000000CC            
PCB$L_PID        00000060            PFN$C_ACTIVE   = 00000007            PHD$L_P1BR       000000D0            
PCB$L_PQB        0000004C            PFN$C_BADPAGLST= 00000002            PHD$L_P1LR       000000D4            
PCB$L_SQBL       00000004            PFN$C_FREPAGLST= 00000000            PHD$L_PAGEFLTS   0000004C            
PCB$L_SQFL       00000000            PFN$C_GBLWRT   = 00000003            PHD$L_PAGFIL     0000001C            
PCB$L_STS        00000028            PFN$C_GLOBAL   = 00000002            PHD$L_PC         000000C0            
PCB$L_UIC        00000020            PFN$C_GPGTBL   = 00000005            PHD$L_PCB        00000078            
PCB$L_WSSWP      00000024            PFN$C_MFYPAGLST= 00000001            PHD$L_PGFLCNT    00000034            
PCB$L_WTIME      0000002C            PFN$C_PPGTBL   = 00000004            PHD$L_PGFLQUOTA  0000005C            
PCB$T_LNAME      0000006C            PFN$C_PROCESS  = 00000000            PHD$L_PSL        000000C4            
PCB$V_ASTPEN   = 00000011            PFN$C_RDERR    = 00000004            PHD$L_PSTBASOFF  00000020            
PCB$V_BATCH    = 0000000E            PFN$C_RDINPROG = 00000006            PHD$L_PTWSLELCK  00000064            
PCB$V_DELPEN   = 00000001            PFN$C_RELPEND  = 00000003            PHD$L_PTWSLEVAL  00000068            
PCB$V_FORCPEN  = 00000002            PFN$C_SYSTEM   = 00000001            PHD$L_R0         00000088            
PCB$V_HIBER    = 00000013            PFN$C_WRTINPROG= 00000005            PHD$L_R1         0000008C            
PCB$V_INQUAN   = 00000003            PFN$M_BADPAG   = 00000020            PHD$L_R10        000000B0            
PCB$V_LOGIN    = 00000014            PFN$M_BAK      = 007FFFFF            PHD$L_R11        000000B4            
PCB$V_NETWRK   = 00000015            PFN$M_COLLISION= 00000010            PHD$L_R12        000000B8            
PCB$V_NOACNT   = 0000000F            PFN$M_DELCON   = 00000010            PHD$L_R13        000000BC            
PCB$V_NODELET  = 00000017            PFN$M_GBLBAK   = 00800000            PHD$L_R2         00000090            
PCB$V_PHDRES   = 00000012            PFN$M_LOC      = 00000007            PHD$L_R3         00000094            
PCB$V_PSWAPM   = 00000004            PFN$M_MODIFY   = 00000080            PHD$L_R4         00000098            
PCB$V_PWRAST   = 00000016            PFN$M_PAGTYP   = 00000007            PHD$L_R5         0000009C            
PCB$V_RES      = 00000000            PFN$M_PGFLX    = FF000000            PHD$L_R6         000000A0            
PCB$V_RESPEN   = 00000005            PFN$M_RPTEVT   = 00000040            PHD$L_R7         000000A4            
PCB$V_SSFEXC   = 00000006            PFN$S_BAK      = 00000017            PHD$L_R8         000000A8            
PCB$V_SSFEXCE  = 00000007            PFN$S_GBLBAK   = 00000001            PHD$L_R9         000000AC            
PCB$V_SSFEXCS  = 00000008            PFN$S_LOC      = 00000003            PHD$L_REFERFLT   00000014            
PCB$V_SSFEXCU  = 00000009            PFN$S_PAGTYP   = 00000003            PHD$L_SSP        00000080            
PCB$V_SSRWAIT  = 0000000A            PFN$S_PGFLX    = 00000008            PHD$L_USP        00000084            
PCB$V_SUSPEN   = 0000000B            PFN$V_BADPAG   = 00000005            PHD$L_WSL        00000118            
PCB$V_SWPVBN   = 00000010            PFN$V_BAK      = 00000000            PHD$M_DALCSTX  = 00000002            
PCB$V_WAKEPEN  = 0000000C            PFN$V_COLLISION= 00000004            PHD$M_PFMFLG   = 00000001            
PCB$V_WALL     = 0000000D            PFN$V_DELCON   = 00000004            PHD$M_WSPEAKCHK= 00000004            
PCB$W_APTCNT     00000034            PFN$V_GBLBAK   = 00000017            PHD$Q_PRIVMSK    00000000            
PCB$W_ASTCNT     0000003C            PFN$V_LOC      = 00000000            PHD$S_ASTLVL   = 00000008            
PCB$W_BIOCNT     0000003E            PFN$V_MODIFY   = 00000007            PHD$S_P0LR     = 00000018            
PCB$W_BIOLM      00000040            PFN$V_PAGTYP   = 00000000            PHD$V_ASTLVL   = 00000018            
PCB$W_BYTCNT     00000042            PFN$V_PGFLX    = 00000018            PHD$V_DALCSTX  = 00000001            
PCB$W_BYTLM      00000068            PFN$V_RPTEVT   = 00000006            PHD$V_P0LR     = 00000000            
PCB$W_DIOCNT     00000044            PHD$B_ASTLVL     000000CF            PHD$V_PFMFLG   = 00000000            
PCB$W_DIOLM      00000046            PHD$B_DFPFC      00000038            PHD$V_WSPEAKCHK= 00000002            
PCB$W_FILCNT     00000048            PHD$B_PAGFIL     0000001F            PHD$W_ASTLM      00000044            
PCB$W_GPGCNT     00000038            PHD$B_PGTBPFC    00000039            PHD$W_BAK        00000048            
PCB$W_GRP        00000022            PHD$C_LENGTH     00000118            PHD$W_DFWSCNT    0000001A            
PCB$W_MEM        00000020            PHD$C_PHDPAGCTX= 00000008            PHD$W_EMPTPG     000000D8            
PCB$W_MTXCNT     0000000E            PHD$K_LENGTH     00000118            PHD$W_EXTDYNWS   00000076            
PCB$W_PPGCNT     0000003A            PHD$L_BIOCNT     00000054            PHD$W_FILLM      00000060            
PCB$W_PRCCNT     0000006A            PHD$L_CPULIM     00000058            PHD$W_FLAGS      0000003A            
PCB$W_SIZE       00000008            PHD$L_CPUTIM     0000003C            PHD$W_PHVINDEX   00000046            
PCB$W_STATE      00000030            PHD$L_DIOCNT     00000050            PHD$W_PRCLM      00000042            
PCB$W_TMBU       00000036            PHD$L_ESP        0000007C            PHD$W_PST        00000020            
SYSCREDEL       - SYSTEM SERVICE CREATE & DELETE PAGE            21-AUG-1978 20:22:37   VAX-11 MACRO X0.3-11               Page  39
SYMBOL TABLE                                                                                                                    (24)

PHD$W_PSTBASMAX  0000004A            PR$_WCSA       = 0000002C            RSN$_MAILBOX   = 00000002            
PHD$W_PSTFREE    00000026            PR$_WCSD       = 0000002D            RSN$_NPDYNMEM  = 00000003            
PHD$W_PSTLAST    00000024            PTE$C_EOWN     = 00800000            RSN$_PGDYNMEM  = 00000005            
PHD$W_PTCNTACT   00000070            PTE$C_ER       = 38000000            RSN$_PGFILE    = 00000004            
PHD$W_PTCNTLCK   0000006C            PTE$C_ERKW     = 30000000            SCH$GL_CURPCB    ********   X   03   
PHD$W_PTCNTMAX   00000072            PTE$C_EW       = 28000000            SCH$GQ_PFWQ      ********   X   04   
PHD$W_PTCNTVAL   0000006E            PTE$C_KOWN     = 00000000            SGN$GL_P1LWCNT   ********   X   03   
PHD$W_QUANT      00000040            PTE$C_KR       = 18000000            SGN$GL_PHDLWCNT  ********   X   03   
PHD$W_TQLM       00000062            PTE$C_KW       = 10000000            SGN$GL_PTPAGCNT  ********   X   03   
PHD$W_WSAUTH     0000000A            PTE$C_NA       = 00000000            SS$_ABORT      = 0000002C            
PHD$W_WSDYN      0000000E            PTE$C_SOWN     = 01000000            SS$_ACCONFLICT = 00000800            
PHD$W_WSFLUID    00000074            PTE$C_SR       = 58000000            SS$_ACCVIO     = 0000000C            
PHD$W_WSLAST     00000012            PTE$C_SREW     = 48000000            SS$_ACPVAFUL   = 000002FC            
PHD$W_WSLIST     00000008            PTE$C_SRKW     = 50000000            SS$_ARTRES     = 00000474            
PHD$W_WSLOCK     0000000C            PTE$C_SW       = 40000000            SS$_ASTFLT     = 0000040C            
PHD$W_WSLX       0000004A            PTE$C_UOWN     = 01800000            SS$_BADATTRIB  = 00000034            
PHD$W_WSNEXT     00000010            PTE$C_UR       = 78000000            SS$_BADCHKSUM  = 00000808            
PHD$W_WSQUOTA    00000018            PTE$C_UREW     = 68000000            SS$_BADESCAPE  = 0000003C            
PR$_ACCR       = 00000029            PTE$C_URKW     = 70000000            SS$_BADFILEHDR = 00000810            
PR$_ACCS       = 00000028            PTE$C_URSW     = 60000000            SS$_BADFILENAME= 00000818            
PR$_ASTLVL     = 00000013            PTE$C_UW       = 20000000            SS$_BADFILEVER = 00000820            
PR$_ESP        = 00000001            PTE$M_CRF      = 00010000            SS$_BADIMGHDR  = 00000044            
PR$_ICCS       = 00000018            PTE$M_DZRO     = 00020000            SS$_BADIRECTORY= 00000828            
PR$_ICR        = 0000001A            PTE$M_GPTX     = 003FFFFF            SS$_BADPARAM   = 00000014            
PR$_IPL        = 00000012            PTE$M_MODIFY   = 04000000            SS$_BADSTACK   = 000002B4            
PR$_ISP        = 00000004            PTE$M_OWN      = 01800000            SS$_BEGOFFILE  = 00000938            
PR$_KSP        = 00000000            PTE$M_PFN      = 001FFFFF            SS$_BLOCKCNTERR= 00000940            
PR$_MAPEN      = 00000038            PTE$M_PGFLVB   = 003FFFFF            SS$_BREAK      = 00000414            
PR$_NICR       = 00000019            PTE$M_PROT     = 78000000            SS$_BUFBYTALI  = 0000030C            
PR$_P0BR       = 00000008            PTE$M_TYP0     = 00400000            SS$_BUFFEROVF  = 00000601            
PR$_P0LR       = 00000009            PTE$M_TYP1     = 04000000            SS$_BUGCHECK   = 000002A4            
PR$_P1BR       = 0000000A            PTE$M_VALID    = 80000000            SS$_CANCEL     = 00000830            
PR$_P1LR       = 0000000B            PTE$M_WRT      = 00040000            SS$_CHANINTLK  = 0000004C            
PR$_PCBB       = 00000010            PTE$S_GPTX     = 00000016            SS$_CLIFRCEXT  = 00000980            
PR$_PME        = 0000003D            PTE$S_OWN      = 00000002            SS$_CMODSUPR   = 0000041C            
PR$_RXCS       = 00000020            PTE$S_PFN      = 00000015            SS$_CMODUSER   = 00000424            
PR$_RXDB       = 00000021            PTE$S_PGFLVB   = 00000016            SS$_COMPAT     = 0000042C            
PR$_SBIER      = 00000034            PTE$S_PROT     = 00000004            SS$_CONTINUE   = 00000001            
PR$_SBIFS      = 00000030            PTE$S_STX      = 00000010            SS$_CONTROLC   = 00000651            
PR$_SBIMT      = 00000033            PTE$V_CRF      = 00000010            SS$_CONTROLO   = 00000609            
PR$_SBIQC      = 00000036            PTE$V_DZRO     = 00000011            SS$_CONTROLY   = 00000611            
PR$_SBIS       = 00000031            PTE$V_GPTX     = 00000000            SS$_CREATED    = 00000619            
PR$_SBISC      = 00000032            PTE$V_MODIFY   = 0000001A            SS$_CTRLERR    = 00000054            
PR$_SBITA      = 00000035            PTE$V_OWN      = 00000017            SS$_DATACHECK  = 0000005C            
PR$_SBR        = 0000000C            PTE$V_PFN      = 00000000            SS$_DATAOVERUN = 00000838            
PR$_SCBB       = 00000011            PTE$V_PGFLVB   = 00000000            SS$_DEBUG      = 0000046C            
PR$_SID        = 0000003E            PTE$V_PROT     = 0000001B            SS$_DECOVF     = 000004A4            
PR$_SIRR       = 00000014            PTE$V_STX      = 00000000            SS$_DEVACTIVE  = 000002C4            
PR$_SISR       = 00000015            PTE$V_TYP0     = 00000016            SS$_DEVALLOC   = 00000840            
PR$_SLR        = 0000000D            PTE$V_TYP1     = 0000001A            SS$_DEVALRALLOC= 00000641            
PR$_SSP        = 00000002            PTE$V_VALID    = 0000001F            SS$_DEVASSIGN  = 00000848            
PR$_TBIA       = 00000039            PTE$V_WRT      = 00000012            SS$_DEVFOREIGN = 00000064            
PR$_TBIS       = 0000003A            REGION         = 00000010            SS$_DEVICEFULL = 00000850            
PR$_TODR       = 0000001B            RETADR         = 00000008            SS$_DEVMOUNT   = 0000006C            
PR$_TXCS       = 00000022            RSN$_ASTWAIT   = 00000001            SS$_DEVNOTALLOC= 00000858            
PR$_TXDB       = 00000023            RSN$_BRKTHRU   = 00000006            SS$_DEVNOTMBX  = 00000074            
PR$_USP        = 00000003            RSN$_IACLOCK   = 00000007            SS$_DEVNOTMOUNT= 0000007C            
SYSCREDEL       - SYSTEM SERVICE CREATE & DELETE PAGE            21-AUG-1978 20:22:37   VAX-11 MACRO X0.3-11               Page  40
SYMBOL TABLE                                                                                                                    (24)

SS$_DEVOFFLINE = 00000084            SS$_IVPROTECT  = 000002F4            SS$_REMOTE     = 00000649            
SS$_DIRFULL    = 00000860            SS$_IVQUOTAL   = 00000164            SS$_RESIGNAL   = 00000918            
SS$_DRVERR     = 0000008C            SS$_IVSECFLG   = 0000016C            SS$_RESULTOVF  = 00000214            
SS$_DUPFILENAME= 00000868            SS$_IVSECIDCTL = 000002E4            SS$_ROPRAND    = 00000454            
SS$_DUPLNAM    = 00000094            SS$_IVSSRQ     = 00000174            SS$_SECTBLFUL  = 0000021C            
SS$_ENDOFFILE  = 00000870            SS$_IVSTSFLG   = 0000017C            SS$_SSFAIL     = 0000045C            
SS$_ENDOFTAPE  = 00000878            SS$_IVTIME     = 00000184            SS$_SUBRNG     = 000004AC            
SS$_ENDOFUSRLBL= 00000970            SS$_LCKPAGFUL  = 000000D4            SS$_SUPERSEDE  = 00000631            
SS$_EXQUOTA    = 0000001C            SS$_LENVIO     = 0000018C            SS$_TAPEPOSLOST= 00000224            
SS$_EXTIDXFILE = 00000880            SS$_LKWSETFUL  = 00000194            SS$_TBIT       = 00000464            
SS$_FCPREADERR = 00000888            SS$_MBFULL     = 000008D8            SS$_TIMEOUT    = 0000022C            
SS$_FCPREPSTN  = 00000988            SS$_MBTOOSML   = 0000019C            SS$_TOOMANYVER = 00000990            
SS$_FCPREWNDERR= 00000890            SS$_MCHECK     = 000002BC            SS$_TOOMUCHDATA= 0000029C            
SS$_FCPSPACERR = 00000898            SS$_MEDOFL     = 000001A4            SS$_UNASEFC    = 00000234            
SS$_FCPWRITERR = 000008A0            SS$_MSGNOTFND  = 00000621            SS$_UNSAFE     = 0000023C            
SS$_FILACCERR  = 0000009C            SS$_MTLBLLONG  = 00000304            SS$_UNWIND     = 00000920            
SS$_FILALRACC  = 000000A4            SS$_MUSTCLOSEFL= 00000948            SS$_UNWINDING  = 00000928            
SS$_FILELOCKED = 000008A8            SS$_NOAQB      = 00000314            SS$_VASFULL    = 00000244            
SS$_FILENUMCHK = 000008B0            SS$_NODATA     = 000001AC            SS$_VECINUSE   = 0000024C            
SS$_FILESEQCHK = 000008B8            SS$_NOHANDLER  = 000008F8            SS$_VOLINV     = 00000254            
SS$_FILESTRUCT = 000008C0            SS$_NOHOMEBLK  = 000008E0            SS$_WAITUSRLBL = 00000950            
SS$_FILNOTACC  = 000000AC            SS$_NOIOCHAN   = 000001B4            SS$_WASCLR     = 00000001            
SS$_FILNOTCNTG = 000002AC            SS$_NOLINKS    = 0000027C            SS$_WASECC     = 00000639            
SS$_FILNOTEXP  = 000000B4            SS$_NOLOGNAM   = 000001BC            SS$_WASSET     = 00000009            
SS$_FLTDIV     = 00000494            SS$_NOMBX      = 00000274            SS$_WRITLCK    = 0000025C            
SS$_FLTOVF     = 0000048C            SS$_NOMOREFILES= 00000930            SS$_WRONGACP   = 0000031C            
SS$_FLTUND     = 0000049C            SS$_NONEXDRV   = 000001C4            TMP...         = 00000001            
SS$_FORMAT     = 000000BC            SS$_NONEXPR    = 000008E8            UPDATPTCNT       000002D3 R     03   
SS$_GPTFULL    = 000000C4            SS$_NONLOCAL   = 000008F0            VA$M_BYTE      = 000001FF            
SS$_GSDFULL    = 000000CC            SS$_NOPRIV     = 00000024            VA$M_P1        = 40000000            
SS$_HANGUP     = 000002CC            SS$_NORMAL     = 00000001            VA$M_SYSTEM    = 80000000            
SS$_HEADERFULL = 000008C8            SS$_NOSIGNAL   = 00000900            VA$M_VPG       = FFFFFE00            
SS$_IDXFILEFULL= 000008D0            SS$_NOSOLICIT  = 00000284            VA$M_VPN       = 3FFFFE00            
SS$_ILLBLKNUM  = 000000DC            SS$_NOSUCHDEV  = 00000908            VA$S_BYTE      = 00000009            
SS$_ILLCNTRFUNC= 000000E4            SS$_NOSUCHFILE = 00000910            VA$S_VPG       = 00000017            
SS$_ILLEFC     = 000000EC            SS$_NOSUCHNODE = 0000028C            VA$S_VPN       = 00000015            
SS$_ILLIOFUNC  = 000000F4            SS$_NOSUCHSEC  = 00000978            VA$V_BYTE      = 00000000            
SS$_ILLLBLAST  = 00000968            SS$_NOTAPEOP   = 00000264            VA$V_P1        = 0000001E            
SS$_ILLPAGCNT  = 000000FC            SS$_NOTFILEDEV = 000001CC            VA$V_SYSTEM    = 0000001F            
SS$_ILLSEQOP   = 000002DC            SS$_NOTINTBLSZ = 000001D4            VA$V_VPG       = 00000009            
SS$_ILLSER     = 00000104            SS$_NOTLABELMT = 000001DC            VA$V_VPN       = 00000009            
SS$_ILLUSRLBLRD= 00000958            SS$_NOTMODIFIED= 00000659            WSL$C_GBLWRT   = 00000006            
SS$_ILLUSRLBLWT= 00000960            SS$_NOTNETDEV  = 000002EC            WSL$C_GLOBAL   = 00000004            
SS$_INCVOLLABEL= 0000010C            SS$_NOTRAN     = 00000629            WSL$C_GPGTBL   = 0000000A            
SS$_INSFARG    = 00000114            SS$_NOTSQDEV   = 000001E4            WSL$C_LENGTH   = 00000004            
SS$_INSFMEM    = 00000124            SS$_OPCCUS     = 00000434            WSL$C_PPGTBL   = 00000008            
SS$_INSFRAME   = 0000012C            SS$_OPCDEC     = 0000043C            WSL$C_PROCESS  = 00000000            
SS$_INSFWSL    = 0000011C            SS$_OPINCOMPL  = 000002D4            WSL$C_SYSTEM   = 00000002            
SS$_INTDIV     = 00000484            SS$_PAGOWNVIO  = 000001EC            WSL$M_GOODPAGE = 00000040            
SS$_INTOVF     = 0000047C            SS$_PAGRDERR   = 00000444            WSL$M_MODIFY   = 00000100            
SS$_IVADDR     = 00000134            SS$_PARITY     = 000001F4            WSL$M_PAGTYP   = 0000000E            
SS$_IVCHAN     = 0000013C            SS$_PARTESCAPE = 000001FC            WSL$M_PFNLOCK  = 00000010            
SS$_IVCHNLSEC  = 0000026C            SS$_PFMBSY     = 00000204            WSL$M_VALID    = 00000001            
SS$_IVDEVNAM   = 00000144            SS$_PLHLDR     = 00000404            WSL$M_WSLOCK   = 00000020            
SS$_IVGSDNAM   = 0000014C            SS$_PSTFULL    = 0000020C            WSL$S_PAGTYP   = 00000003            
SS$_IVLOGNAM   = 00000154            SS$_RADRMOD    = 0000044C            WSL$V_GOODPAGE = 00000006            
SS$_IVLOGTAB   = 0000015C            SS$_REJECT     = 00000294            WSL$V_MODIFY   = 00000008            
SYSCREDEL       - SYSTEM SERVICE CREATE & DELETE PAGE            21-AUG-1978 20:22:37   VAX-11 MACRO X0.3-11               Page  41
SYMBOL TABLE                                                                                                                    (24)

WSL$V_PAGTYP   = 00000001            
WSL$V_PFNLOCK  = 00000004            
WSL$V_VALID    = 00000000            
WSL$V_WSLOCK   = 00000005            
WSLXVANOMAT      000000E1 R     04   


PROGRAM SECTION SYNOPSIS

.  ABS  .        00000000      00     NOPIC   USR   CON   ABS   LCL NOSHR NOEXE NORD  NOWRT BYTE  
. BLANK .        00000000      01     NOPIC   USR   CON   REL   LCL NOSHR   EXE   RD    WRT BYTE  
$ABS$            0000011C      02     NOPIC   USR   CON   ABS   LCL NOSHR   EXE   RD    WRT BYTE  
Y$EXEPAGED       00000377      03     NOPIC   USR   CON   REL   LCL NOSHR   EXE   RD    WRT BYTE  
$MMGCOD          00000281      04     NOPIC   USR   CON   REL   LCL NOSHR   EXE   RD    WRT BYTE  


THERE WERE NO ERRORS OR WARNINGS.
8126. BYTES LEFT IN FREE MEMORY POOL.
726. BYTES OF RECLAIMED MEMORY.
OBJ$:SYSCREDEL,LIS$:SYSCREDEL/-SP=EXECML$/ML,SRC$:SYSCREDEL
20 MLB DIR RDS - 1020 GETS TO DEFINE 32 MACROS. 84 INTER. FILE WRITES. 
