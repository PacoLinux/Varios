SCHED           RESCHEDULING INTERRUPT HANDLER                   21-AUG-1978 20:09:54   VAX-11 MACRO X0.3-11               Page   0
TABLE OF CONTENTS   

   (1)    3200  SCH$RESCHED RESCHEDULING INTERRUPT HANDLER
SCHED           RESCHEDULING INTERRUPT HANDLER                   21-AUG-1978 20:09:54   VAX-11 MACRO X0.3-11               Page   1
X01                                                                                                                              (1)

                                     0000   100 	.TITLE	SCHED RESCHEDULING INTERRUPT HANDLER
                                     0000   200 	.IDENT	/X01/
                                     0000   300 ; COPYRIGHT (C) 1977
                                     0000   400 ; DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASS.
                                     0000   500 ;
                                     0000   600 ; THIS SOFTWARE IS FURNISHED UNDER  A LICENSE FOR USE ONLY  ON  A
                                     0000   700 ; SINGLE COMPUTER SYSTEM AND MAY BE  COPIED ONLY WITH  THE INCLU-
                                     0000   800 ; SION OF  THE  ABOVE  COPYRIGHT NOTICE.  THIS SOFTWARE,  OR  ANY
                                     0000   900 ; OTHER COPIES THEREOF, MAY NOT BE  PROVIDED  OR  OTHERWISE  MADE
                                     0000  1000 ; AVAILABLE TO ANY OTHER PERSON EXCEPT  FOR  USE  ON  SUCH SYSTEM
                                     0000  1100 ; AND TO  ONE WHO AGREES  TO  THESE LICENSE  TERMS.  TITLE TO AND
                                     0000  1200 ; OWNERSHIP OF THE SOFTWARE SHALL AT ALL TIMES REMAIN IN DEC.
                                     0000  1300 ;
                                     0000  1400 ; THE INFORMATION IN THIS SOFTWARE  IS  SUBJECT TO CHANGE WITHOUT
                                     0000  1500 ; NOTICE AND SHOULD NOT BE CONSTRUED  AS  A COMMITMENT BY DIGITAL
                                     0000  1600 ; EQUIPMENT CORPORATION.
                                     0000  1700 ;
                                     0000  1800 ; DEC ASSUMES NO RESPONSIBILITY FOR THE USE OR RELIABILITY OF ITS
                                     0000  1900 ; SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DEC.
                                     0000  2000 ;
                                     0000  2100 ; INCLUDE FILES:
                                     0000  2200 
                                     0000  2400 	$DYNDEF				;STRUCTURE TYPE CODE DEFINITIONS
                                     0000  2500 	$IPLDEF				;INTERRUPT PRIORITY LEVEL DEFINITIONS
                                     0000  2600 	$PCBDEF				;PCB DEFINITIONS
                                     0000  2700 	$PHDDEF				;PHD DEFINITIONS
                                     0000  2800 	$PRDEF				;PROCESSOR REGISTER DEFINITIONS
                                     0000  2900 	$STATEDEF			;STATE DEFINITIONS
                                 00000000  3000 	.PSECT	AEXENONPAGED,LONG	; NONPAGED EXEC
SCHED           RESCHEDULING INTERRUPT HANDLER                   21-AUG-1978 20:09:54   VAX-11 MACRO X0.3-11               Page   2
X01             SCH$RESCHED RESCHEDULING INTERRUPT HANDLER                                                                       (1)

                                     0000  3200 	.SBTTL	SCH$RESCHED RESCHEDULING INTERRUPT HANDLER
                                     0000  3300 ;++
                                     0000  3400 ; SCH$RESCHED - RESCHEDULING INTERRUPT HANDLER
                                     0000  3500 ;
                                     0000  3600 ; THIS ROUTINE IS ENTERED VIA THE IPL 3 RESCHEDULING INTERRUPT.
                                     0000  3700 ; THE VECTOR FOR THIS INTERRUPT IS CODED TO CAUSE EXECUTION
                                     0000  3800 ; ON THE KERNEL STACK.
                                     0000  3900 ;
                                     0000  4000 ; ENVIRONMENT:
                                     0000  4100 ;	IPL=3 MODE=KERNEL IS=0
                                     0000  4200 ; INPUT:
                                     0000  4300 ;	00(SP)=PC AT RESCHEDULE INTERRUPT
                                     0000  4400 ;	04(SP)=PSL AT INTERRUPT.
                                     0000  4500 ;--
                                     0000  4600 SCH$RESCHED::				;RESCHEDULE INTERRUPT HANDLER
                                     0000  4700 	SETIPL	#IPL$_SYNCH		;SYNCHRONIZE SCHEDULER WITH EVENT REPORTING
                                 07  0003  4800 	SVPCTX				;SAVE CONTEXT OF PROCESS
            51       0000'CF     D0  0004  4900 	MOVL	W^SCH$GL_CURPCB,R1	;GET ADDRESS OF CURRENT PCB
            52         0B A1     9A  0009  5000 	MOVZBL	PCB$B_PRI(R1),R2	;CURRENT PRIORITY
       0000'CF            52     E2  000D  5100 	BBSS	R2,W^SCH$GL_COMQS,10$	;MARK QUEUE NON-EMPTY
                          00         0012       
         30 A1            0C     B0  0013  5200 10$:	MOVW	#SCH$C_COM,PCB$W_STATE(R1) ;SET STATE TO RES COMPUTE
            53       0000'CF42   7E  0017  5300 	MOVAQ	W^SCH$AQ_COMT[R2],R3	;COMPUTE ADDRESS OF QUEUE
            93            61     0E  001D  5400 	INSQUE	(R1),@(R3)+		;INSERT AT TAIL OF QUEUE
                                     0020  5500 
                                     0020  5600 ;+
                                     0020  5700 ; SCH$SCHED - SCHEDULE NEW PROCESS FOR EXECUTION
                                     0020  5800 ;
                                     0020  5900 ; THIS ROUTINE SELECTS THE HIGHEST PRIORITY EXECUTABLE PROCESS
                                     0020  6000 ; AND PLACES IT IN EXECUTION.
                                     0020  6100 ;-
                                     0020  6200 SCH$SCHED::				;SCHEDULE FOR EXECUTION
                                     0020  6300 	SETIPL	#IPL$_SYNCH		;SYNCHRONIZE SCHEDULER WITH EVENT REPORTING
            20            00     EA  0023  6400 	FFS	#0,#32,W^SCH$GL_COMQS,R2	;FIND FIRST FULL STATE
            52       0000'CF         0026       
                          3D     13  002A  6500 	BEQL	SCH$IDLE		;NO EXECUTABLE PROCESS??
            53       0000'CF42   7E  002C  6600 	MOVAQ	W^SCH$AQ_COMH[R2],R3	;COMPUTE QUEUE HEAD ADDRESS
            54            93     0F  0032  6700 	REMQUE	@(R3)+,R4		;GET HEAD OF QUEUE
                          3C     1D  0035  6800 	BVS	QEMPTY			;BR IF QUEUE WAS EMPTY (BUG CHECK)
                          06     12  0037  6900 	BNEQ	20$			;QUEUE NOT EMPTY
       0000'CF            52     E5  0039  7000 	BBCC	R2,W^SCH$GL_COMQS,20$	;SET QUEUE EMPTY
                          00         003E       
                                     003F  7100 20$:					;
         0A A4            0C     91  003F  7200 	CMPB	#DYN$C_PCB,PCB$B_TYPE(R4)  ;MUST BE A PROCESS CONTROL BLOCK
                          2E     12  0043  7300 	BNEQ	QEMPTY			;OTHERWISE FATAL ERROR
         30 A4            0E     B0  0045  7400 	MOVW	#SCH$C_CUR,PCB$W_STATE(R4) ;SET STATE TO CURRENT
       0000'CF            54     D0  0049  7500 	MOVL	R4,W^SCH$GL_CURPCB	;NOTE CURRENT PCB LOC
         0B A4         33 A4     91  004E  7600 	CMPB	PCB$B_PRIB(R4),PCB$B_PRI(R4) ;CHECK FOR BASE
                                     0053  7700 					;PRIORITY=CURRENT
                          08     13  0053  7800 	BEQL	30$			;YES, DONT FLOAT PRIORITY
         0B A4            04     E1  0055  7900 	BBC	#4,PCB$B_PRI(R4),30$	;DONT FLOAT REAL TIME PRIORITY
                          03         0059       
                       0B A4     96  005A  8000 	INCB	PCB$B_PRI(R4)		;MOVE TOWARD BASE PRIO
       0000'CF         0B A4     90  005D  8100 30$:	MOVB	PCB$B_PRI(R4),W^SCH$GB_PRI	;SET GLOBAL PRIORITY
            10         18 A4     DA  0063  8200 	MTPR	PCB$L_PHYPCB(R4),#PR$_PCBB 	;SET PCB BASE PHYS ADDR
                                 06  0067  8300 	LDPCTX				;RESTORE CONTEXT
                                 02  0068  8400 	REI				;NORMAL RETURN
SCHED           RESCHEDULING INTERRUPT HANDLER                   21-AUG-1978 20:09:54   VAX-11 MACRO X0.3-11               Page   3
X01             SCH$RESCHED RESCHEDULING INTERRUPT HANDLER                                                                       (1)

                                     0069  8500 
                                     0069  8550 SCH$IDLE:				;NO ACTIVE, EXECUTABLE PROCESS
                                     0069  8555 	SETIPL	#IPL$_SCHED		;DROP IPL TO SCHEDULING LEVEL
       0000'CF            20     90  006C  8557 	MOVB	#32,W^SCH$GB_PRI	;SET PRIORITY TO -1(32) TO SIGNAL IDLE
                          AD     11  0071  8560 	BRB	SCH$SCHED		;AND TRY AGAIN
                                     0073  8600 
                                     0073  8700 QEMPTY:	BUG_CHECK QUEUEMPTY,FATAL	;SCHEDULING QUEUE EMPTY
                                     0077  8800 
                                     0077  8900 	.END
SCHED           RESCHEDULING INTERRUPT HANDLER                   21-AUG-1978 20:09:54   VAX-11 MACRO X0.3-11               Page   4
SYMBOL TABLE                                                                                                                     (1)

BIT...         = 0000000F            PCB$K_LENGTH     0000007C            PCB$W_PPGCNT     0000003A            
BUG$_QUEUEMPTY   ********   X   03   PCB$L_ASTQBL     00000014            PCB$W_PRCCNT     0000006A            
DYN$C_ACB      = 00000002            PCB$L_ASTQFL     00000010            PCB$W_SIZE       00000008            
DYN$C_ADP      = 00000001            PCB$L_EFC2P      00000058            PCB$W_STATE      00000030            
DYN$C_AQB      = 00000003            PCB$L_EFC3P      0000005C            PCB$W_TMBU       00000036            
DYN$C_BRDCST   = 0000001A            PCB$L_EFCS       00000050            PCB$W_TQCNT      0000004A            
DYN$C_BUFIO    = 00000013            PCB$L_EFCU       00000054            PHD$B_ASTLVL     000000CF            
DYN$C_CEB      = 00000004            PCB$L_EFWM       0000004C            PHD$B_DFPFC      00000038            
DYN$C_CRB      = 00000005            PCB$L_OWNER      0000001C            PHD$B_PAGFIL     0000001F            
DYN$C_CXB      = 0000001B            PCB$L_PHD        00000064            PHD$B_PGTBPFC    00000039            
DYN$C_DDB      = 00000006            PCB$L_PHYPCB     00000018            PHD$C_LENGTH     00000118            
DYN$C_DPT      = 0000001E            PCB$L_PID        00000060            PHD$C_PHDPAGCTX= 00000008            
DYN$C_FCB      = 00000007            PCB$L_PQB        0000004C            PHD$K_LENGTH     00000118            
DYN$C_FRK      = 00000008            PCB$L_SQBL       00000004            PHD$L_BIOCNT     00000054            
DYN$C_GSD      = 00000015            PCB$L_SQFL       00000000            PHD$L_CPULIM     00000058            
DYN$C_IDB      = 00000009            PCB$L_STS        00000028            PHD$L_CPUTIM     0000003C            
DYN$C_IRP      = 0000000A            PCB$L_UIC        00000020            PHD$L_DIOCNT     00000050            
DYN$C_JPB      = 0000001F            PCB$L_WSSWP      00000024            PHD$L_ESP        0000007C            
DYN$C_KFH      = 00000026            PCB$L_WTIME      0000002C            PHD$L_FREP0VA    00000028            
DYN$C_KFI      = 00000018            PCB$T_LNAME      0000006C            PHD$L_FREP1VA    00000030            
DYN$C_LOG      = 0000000B            PCB$V_ASTPEN   = 00000011            PHD$L_FREPTECNT  0000002C            
DYN$C_MTL      = 00000019            PCB$V_BATCH    = 0000000E            PHD$L_KSP        00000078            
DYN$C_MVL      = 00000016            PCB$V_DELPEN   = 00000001            PHD$L_P0BR       000000C8            
DYN$C_NDB      = 0000001C            PCB$V_FORCPEN  = 00000002            PHD$L_P0LRASTL   000000CC            
DYN$C_NET      = 00000017            PCB$V_HIBER    = 00000013            PHD$L_P1BR       000000D0            
DYN$C_PBH      = 00000020            PCB$V_INQUAN   = 00000003            PHD$L_P1LR       000000D4            
DYN$C_PCB      = 0000000C            PCB$V_LOGIN    = 00000014            PHD$L_PAGEFLTS   0000004C            
DYN$C_PDB      = 00000021            PCB$V_NETWRK   = 00000015            PHD$L_PAGFIL     0000001C            
DYN$C_PFL      = 00000023            PCB$V_NOACNT   = 0000000F            PHD$L_PC         000000C0            
DYN$C_PIB      = 00000022            PCB$V_NODELET  = 00000017            PHD$L_PCB        00000078            
DYN$C_PQB      = 0000000D            PCB$V_PHDRES   = 00000012            PHD$L_PGFLCNT    00000034            
DYN$C_PTR      = 00000025            PCB$V_PSWAPM   = 00000004            PHD$L_PGFLQUOTA  0000005C            
DYN$C_RVT      = 0000000E            PCB$V_PWRAST   = 00000016            PHD$L_PSL        000000C4            
DYN$C_SFT      = 00000024            PCB$V_RES      = 00000000            PHD$L_PSTBASOFF  00000020            
DYN$C_SSB      = 0000001D            PCB$V_RESPEN   = 00000005            PHD$L_PTWSLELCK  00000064            
DYN$C_TQE      = 0000000F            PCB$V_SSFEXC   = 00000006            PHD$L_PTWSLEVAL  00000068            
DYN$C_TYPAHD   = 00000014            PCB$V_SSFEXCE  = 00000007            PHD$L_R0         00000088            
DYN$C_UCB      = 00000010            PCB$V_SSFEXCS  = 00000008            PHD$L_R1         0000008C            
DYN$C_VCB      = 00000011            PCB$V_SSFEXCU  = 00000009            PHD$L_R10        000000B0            
DYN$C_WCB      = 00000012            PCB$V_SSRWAIT  = 0000000A            PHD$L_R11        000000B4            
GBL...         = 00000000            PCB$V_SUSPEN   = 0000000B            PHD$L_R12        000000B8            
IPL$_ASTDEL    = 00000002            PCB$V_SWPVBN   = 00000010            PHD$L_R13        000000BC            
IPL$_HWCLK     = 00000018            PCB$V_WAKEPEN  = 0000000C            PHD$L_R2         00000090            
IPL$_IOPOST    = 00000004            PCB$V_WALL     = 0000000D            PHD$L_R3         00000094            
IPL$_MAILBOX   = 0000000B            PCB$W_APTCNT     00000034            PHD$L_R4         00000098            
IPL$_POWER     = 0000001F            PCB$W_ASTCNT     0000003C            PHD$L_R5         0000009C            
IPL$_QUEUEAST  = 00000006            PCB$W_BIOCNT     0000003E            PHD$L_R6         000000A0            
IPL$_SCHED     = 00000003            PCB$W_BIOLM      00000040            PHD$L_R7         000000A4            
IPL$_SYNCH     = 00000007            PCB$W_BYTCNT     00000042            PHD$L_R8         000000A8            
IPL$_TIMER     = 00000007            PCB$W_BYTLM      00000068            PHD$L_R9         000000AC            
PCB$B_ASTACT     0000000C            PCB$W_DIOCNT     00000044            PHD$L_REFERFLT   00000014            
PCB$B_ASTEN      0000000D            PCB$W_DIOLM      00000046            PHD$L_SSP        00000080            
PCB$B_PRI        0000000B            PCB$W_FILCNT     00000048            PHD$L_USP        00000084            
PCB$B_PRIB       00000033            PCB$W_GPGCNT     00000038            PHD$L_WSL        00000118            
PCB$B_TYPE       0000000A            PCB$W_GRP        00000022            PHD$M_DALCSTX  = 00000002            
PCB$B_WEFC       00000032            PCB$W_MEM        00000020            PHD$M_PFMFLG   = 00000001            
PCB$C_LENGTH     0000007C            PCB$W_MTXCNT     0000000E            PHD$M_WSPEAKCHK= 00000004            
SCHED           RESCHEDULING INTERRUPT HANDLER                   21-AUG-1978 20:09:54   VAX-11 MACRO X0.3-11               Page   5
SYMBOL TABLE                                                                                                                     (1)

PHD$Q_PRIVMSK    00000000            PR$_SBIMT      = 00000033            
PHD$S_ASTLVL   = 00000008            PR$_SBIQC      = 00000036            
PHD$S_P0LR     = 00000018            PR$_SBIS       = 00000031            
PHD$V_ASTLVL   = 00000018            PR$_SBISC      = 00000032            
PHD$V_DALCSTX  = 00000001            PR$_SBITA      = 00000035            
PHD$V_P0LR     = 00000000            PR$_SBR        = 0000000C            
PHD$V_PFMFLG   = 00000000            PR$_SCBB       = 00000011            
PHD$V_WSPEAKCHK= 00000002            PR$_SID        = 0000003E            
PHD$W_ASTLM      00000044            PR$_SIRR       = 00000014            
PHD$W_BAK        00000048            PR$_SISR       = 00000015            
PHD$W_DFWSCNT    0000001A            PR$_SLR        = 0000000D            
PHD$W_EMPTPG     000000D8            PR$_SSP        = 00000002            
PHD$W_EXTDYNWS   00000076            PR$_TBIA       = 00000039            
PHD$W_FILLM      00000060            PR$_TBIS       = 0000003A            
PHD$W_FLAGS      0000003A            PR$_TODR       = 0000001B            
PHD$W_PHVINDEX   00000046            PR$_TXCS       = 00000022            
PHD$W_PRCLM      00000042            PR$_TXDB       = 00000023            
PHD$W_PST        00000020            PR$_USP        = 00000003            
PHD$W_PSTBASMAX  0000004A            PR$_WCSA       = 0000002C            
PHD$W_PSTFREE    00000026            PR$_WCSD       = 0000002D            
PHD$W_PSTLAST    00000024            QEMPTY           00000073 R     03   
PHD$W_PTCNTACT   00000070            SCH$AQ_COMH      ********   X   03   
PHD$W_PTCNTLCK   0000006C            SCH$AQ_COMT      ********   X   03   
PHD$W_PTCNTMAX   00000072            SCH$C_CEF      = 00000003            
PHD$W_PTCNTVAL   0000006E            SCH$C_COLPG    = 00000001            
PHD$W_QUANT      00000040            SCH$C_COM      = 0000000C            
PHD$W_TQLM       00000062            SCH$C_COMO     = 0000000D            
PHD$W_WSAUTH     0000000A            SCH$C_CUR      = 0000000E            
PHD$W_WSDYN      0000000E            SCH$C_FPG      = 0000000B            
PHD$W_WSFLUID    00000074            SCH$C_HIB      = 00000007            
PHD$W_WSLAST     00000012            SCH$C_HIBO     = 00000008            
PHD$W_WSLIST     00000008            SCH$C_LEF      = 00000005            
PHD$W_WSLOCK     0000000C            SCH$C_LEFO     = 00000006            
PHD$W_WSLX       0000004A            SCH$C_MWAIT    = 00000002            
PHD$W_WSNEXT     00000010            SCH$C_PFW      = 00000004            
PHD$W_WSQUOTA    00000018            SCH$C_SUSP     = 00000009            
PR$_ACCR       = 00000029            SCH$C_SUSPO    = 0000000A            
PR$_ACCS       = 00000028            SCH$GB_PRI       ********   X   03   
PR$_ASTLVL     = 00000013            SCH$GL_COMQS     ********   X   03   
PR$_ESP        = 00000001            SCH$GL_CURPCB    ********   X   03   
PR$_ICCS       = 00000018            SCH$IDLE         00000069 R     03   
PR$_ICR        = 0000001A            SCH$RESCHED      00000000 RG    03   
PR$_IPL        = 00000012            SCH$SCHED        00000020 RG    03   
PR$_ISP        = 00000004            
PR$_KSP        = 00000000            
PR$_MAPEN      = 00000038            
PR$_NICR       = 00000019            
PR$_P0BR       = 00000008            
PR$_P0LR       = 00000009            
PR$_P1BR       = 0000000A            
PR$_P1LR       = 0000000B            
PR$_PCBB       = 00000010            
PR$_PME        = 0000003D            
PR$_RXCS       = 00000020            
PR$_RXDB       = 00000021            
PR$_SBIER      = 00000034            
PR$_SBIFS      = 00000030            
SCHED           RESCHEDULING INTERRUPT HANDLER                   21-AUG-1978 20:09:54   VAX-11 MACRO X0.3-11               Page   6
PROGRAM SECTION SYNOPSIS                                                                                                         (1)



PROGRAM SECTION SYNOPSIS

.  ABS  .        00000000      00     NOPIC   USR   CON   ABS   LCL NOSHR NOEXE NORD  NOWRT BYTE  
. BLANK .        00000000      01     NOPIC   USR   CON   REL   LCL NOSHR   EXE   RD    WRT BYTE  
$ABS$            0000011C      02     NOPIC   USR   CON   ABS   LCL NOSHR   EXE   RD    WRT BYTE  
AEXENONPAGED     00000077      03     NOPIC   USR   CON   REL   LCL NOSHR   EXE   RD    WRT LONG  


THERE WERE NO ERRORS OR WARNINGS.
17838. BYTES LEFT IN FREE MEMORY POOL.
2876. BYTES OF RECLAIMED MEMORY.
OBJ$:SCHED,LIS$:SCHED/-SP=EXECML$/ML,SRC$:SCHED
4 MLB DIR RDS - 536 GETS TO DEFINE 17 MACROS. 29 INTER. FILE WRITES. 
