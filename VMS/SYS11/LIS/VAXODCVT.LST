MACFLM	MACRO M1110  22-AUG-78 01:25  PAGE 2


      1					;
      2					; PREFIX FILE FOR DECIMAL VERSION NUMBERS
      3					;
      4		000001 				R$$DVN=1
.ODCVT	MACRO M1110  22-AUG-78 01:25  PAGE 3


      1						.TITLE	.ODCVT
      2						.IDENT	/V6.0/
      3
      4					;
      5					; COPYRIGHT 1978, DIGITAL EQUIPMENT CORP., MAYNARD, MASS. 01754
      6					;
      7					; DEC ASSUMES NO RESPONSIBILITY FOR THE USE OR RELIABILITY OF ITS
      8					; SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DEC.
      9					;
     10					; THIS SOFTWARE IS FURNISHED TO PURCHASER UNDER A LICENSE FOR USE
     11					; ON A SINGLE COMPUTER SYSTEM AND CAN BE COPIED (WITH INCLUSION
     12					; OF DEC'S COPYRIGHT NOTICE) ONLY FOR USE IN SUCH SYSTEM, EXCEPT
     13					; AS MAY OTHERWISE BE PROVIDED IN WRITING BY DEC.
     14					;
     15					; THE INFORMATION IN THIS DOCUMENT IS SUBJECT TO CHANGE WITHOUT
     16					; NOTICE AND SHOULD NOT BE CONSTRUED AS A COMMITMENT BY DIGITAL
     17					; EQUIPMENT CORPORATION.
     18					;
     19					;++
     20					;
     21					; FACILITY:
     22					;
     23					;	VAX/VMS RSX11 SUPPORT ROUTINES
     24					;
     25					; ABSTRACT:
     26					;
     27					;	CONVERT ASCII DATA TO OCTAL OR DECIMAL.
     28					;
     29					; AUTHOR:
     30					;
     31					;	R.HEINEN 23-APR-1978
     32					;--
     33					;
     34					; CONDITIONALIZE DECIMAL OR OCTAL VERSION NUMBERS
     35					;
     36						.IIF	NDF,R$$DVN,R$$DVN=0	; 0 = OCTAL VERSION #
     37										; 1 = DECIMAL VERSION #
     38	000000					.PSECT	$$RESL
.ODCVT	MACRO M1110  22-AUG-78 01:25  PAGE 4


     40					;++
     41					; .ODCVT -- CONVERT WITH OCTAL DEFAULT
     42					; .VRCVT -- CONVERT VERSION NUMBER TO BINARY
     43					; .DCCVT -- CONVERT WITH DECIMAL DEFAULT
     44					;
     45					; FUNCTIONAL DESCRIPTION:
     46					;
     47					; THIS ROUTINE CONVERTS ASCII DATA TO OCTAL OR DECIMAL BASED ON
     48					; THE ENTRY POINT AND THE STRING ITSELF.
     49					;
     50					; UNARY MINUS AT THE STRING START CAUSES THE CONVERSION RESULT TO BE NEGATED
     51					; AFTER THE CONVERSION.
     52					;
     53					; A "#" FORCES OCTAL, A TRAILING "." FORCES DECIMAL IN THAT ORDER.
     54					;
     55					; INPUTS:
     56					;
     57					;	R3 = ADDRESS TO STORE THE RESULT
     58					;	R4 = SIZE OF THE STRING
     59					;	R5 = ADDRESS OF THE STRING
     60					;
     61					; OUTPUTS:
     62					;
     63					;	C-SET IF THE CONVERSION IS IN ERROR
     64					;
     65					;	R1,R2,R3,R4,R5 ARE SAVED.
     66					;--
     67						.ENABL	LSB
     68
     69						.IF	EQ,R$$DVN
     70
     71					.VRCVT::
     72
     73						.ENDC
     74
     75	000000	005013 			.ODCVT::CLR	(R3)			; SET OCTAL DEFUALT
     76	000002	000402 				BR	10$			;
     77
     78						.IF	EQ,R$$DVN-1
     79
     80	000004				.VRCVT::
     81
     82						.ENDC
     83
     84	000004	012713 	000002 		.DCCVT::MOV	#2,(R3)			; SET DECIMAL DEFUALT
     85					;
     86					; PERFORM THE CONVERSION
     87					;
     88	000010	004567 	000000G		10$:	JSR	R5,.SAVR1		; SAVE THE REGISTERS
     89	000014	010046 				MOV	R0,-(SP)		; SAVE R0
     90	000016	012746 	000214'			MOV	#80$,-(SP)		; SET UP CO-ROUTINE ADDRESS
     91	000022	005001 				CLR	R1			; ZERO ACCUM
     92	000024	010502 				MOV	R5,R2			; COPY THE STARTING ADDRESS
     93	000026	060402 				ADD	R4,R2			; ADDRESS FINISH OF THE STRING
     94	000030	122527 	000053 			CMPB	(R5)+,#'+		; PLUS SIGN?
     95	000034	001406 				BEQ	30$			; IF EQL THEN CONTINUE
     96	000036	124527 	000055 			CMPB	-(R5),#'-		; MINUS?
.ODCVT	MACRO M1110  22-AUG-78 01:25  PAGE 4-1


     97	000042	001003 				BNE	30$			; IF NE THEN NO
     98	000044	052713 	100000 			BIS	#100000,(R3)		; SET NEGATION FLAG - EXPLICIT MINUS
     99	000050	005205 			25$:	INC	R5			; PASS CHARACTER
    100	000052	020502 			30$:	CMP	R5,R2			; DONE?
    101	000054	103067 				BHIS	200$			; IF HIS THEN DONE
    102	000056	121527 	000043 			CMPB	(R5),#'#		; EXPLICIT OCTAL?
    103	000062	001002 				BNE	40$			; IF NE THEN NO
    104	000064	105013 				CLRB	(R3)			; SET OCTAL
    105	000066	000770 				BR	25$			; CONTINUE
    106	000070	122762 	000056 	177777 	40$:	CMPB	#'.,-1(R2)		; EXPLICT DECIMAL?
    107	000076	001003 				BNE	50$			; IF NE THEN NO
    108	000100	005302 				DEC	R2			; PASS DECIMAL POINT
    109	000102	152713 	000002 			BISB	#2,(R3)			; SET DECIMAL
    110	000106	062713 	000010 		50$:	ADD	#8.,(R3)		; CALC RANGE TEST VALUE FOR OCTAL OR DECMAL
    111	000112	005004 				CLR	R4			; ZERO TEMP
    112	000114	020502 			60$:	CMP	R5,R2			; DONE?
    113	000116	103046 				BHIS	200$			; IF HIS THEN YES
    114	000120	112504 				MOVB	(R5)+,R4		; GET A DIGIT
    115	000122	162704 	000060 			SUB	#'0,R4			; CONVERT FROM ASCII
    116	000126	100440 				BMI	100$			; ERROR IF MINUS
    117	000130	120413 				CMPB	R4,(R3)			; IN RANGE?
    118	000132	103036 				BHIS	100$			; IF HIS THEN NOT IN RANGE
    119	000134	010100 				MOV	R1,R0			; MULTIPLY BY 8 OR 10
    120	000136	006300 				ASL	R0			;
    121	000140	004776 	000000 			JSR	PC,@(SP)		; CHECK ARITHMETIC
    122	000144	006300 				ASL	R0			;
    123	000146	004776 	000000 			JSR	PC,@(SP)		;
    124	000152	006300 				ASL	R0			;
    125	000154	004776 	000000 			JSR	PC,@(SP)		;
    126	000160	122713 	000010 			CMPB	#8.,(R3)		; DECIMAL?
    127	000164	001406 				BEQ	70$			; IF EQL THEN NO
    128	000166	060100 				ADD	R1,R0			;
    129	000170	004776 	000000 			JSR	PC,@(SP)		;
    130	000174	060100 				ADD	R1,R0			;
    131	000176	004776 	000000 			JSR	PC,@(SP)		;
    132	000202	010001 			70$:	MOV	R0,R1			; ACCUM RESULT
    133	000204	060401 				ADD	R4,R1			;
    134	000206	004776 	000000 			JSR	PC,@(SP)		; CHECK ARITHMETIC
    135	000212	000740 				BR	60$			; AND CONTINUE
    136					;
    137					; ARITHMETIC TEST ROUTINE
    138					;
    139	000214	103404 			80$:	BCS	90$			; IF C-SET THEN ERROR
    140	000216	102401 				BVS	85$			; IF VSET THEN OTHER CHECK
    141	000220	100014 				BPL	230$			; IF PLUS THEN OK
    142	000222	005713 			85$:	TST	(R3)			; IF RESULT IS MINUS AND EXP MINUS THEN ERROR
    143	000224	100012 				BPL	230$			; IF PLUS THEN FALSE
    144	000226	005726 			90$:	TST	(SP)+			; POP RETURN ADDRESS
    145	000230	000261 			100$:	SEC
    146	000232	000404 				BR	220$			; RETURN ERROR
    147					;
    148					; DONE - NO ERROR
    149					;
    150	000234	005713 			200$:	TST	(R3)			; EXPLICIT MINUS?
    151	000236	100001 				BPL	210$			; IF PLUS THEN NO
    152	000240	005401 				NEG	R1			; CONVERT
    153	000242	000241 			210$:	CLC				; SET SUCCESS
.ODCVT	MACRO M1110  22-AUG-78 01:25  PAGE 4-2


    154	000244	010113 			220$:	MOV	R1,(R3)			; RETURN ACCUM RESLUT
    155	000246	012600 				MOV	(SP)+,R0		; POP TEMP
    156	000250	012600 				MOV	(SP)+,R0		; RESTORE R0
    157	000252	000207 			230$:	RTS	PC			; RETURN
    158		000001 				.END
.ODCVT	MACRO M1110  22-AUG-78 01:25  PAGE 4-3
SYMBOL TABLE

CR    = 000015   	LF    = 000012   	SPA   = 000040   	.DCCVT  000004RG    002	.SAVR1= ****** GX
FF    = 000014   	R$$DVN= 000001   	VT    = 000013   	.ODCVT  000000RG    002	.VRCVT  000004RG    002
HT    = 000011   	R$$11M= 000000

. ABS.	000000	   000
      	000000	   001
$$RESL	000254	   002
ERRORS DETECTED:  0

VIRTUAL MEMORY USED:  631 WORDS  ( 3 PAGES)
DYNAMIC MEMORY:  2772 WORDS  ( 10 PAGES)
ELAPSED TIME:  00:00:07
OBJ$:VAXODCVT,LIS$:VAXODCVT/-SP=SRC$:MACFLM,DECVER,VAXODCVT
