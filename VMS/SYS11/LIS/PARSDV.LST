PARSDV 0104MS, PARSE DEVICE STR	MACRO M1110  22-AUG-78 01:22  PAGE 7


      1						.TITLE	PARSDV 0104MS, PARSE DEVICE STRING
						.IDENT	/0104MS/
      2					; ALTERED:
      3					; E. H. MARISON	20-DEC-77
      4					; ANDREW C. GOLDSTEIN  8-SEP-77  14:12
      5					;
      6					; COPYRIGHT (C) 1975, DIGITAL EQUIPMENT CORP., MAYNARD MASS.
      7					; COPYRIGHT (C) 1973, DIGITAL EQUIPMENT CORP., MAYNARD MASS.
      8					; COPYRIGHT 1974, DIGITAL EQUIPMENT CORP., MAYNARD MASS.
      9
     10					; THIS SOFTWARE IS FURNISHED TO PURCHASER UNDER A LICENSE FOR USE
     11					; ON A SINGLE COMPUTER SYSTEM AND CAN BE COPIED (WITH INCLUSION
     12					; OF DEC'S COPYRIGHT NOTICE) ONLY FOR USE IN SUCH SYSTEM, EXCEPT
     13					; AS MAY OTHERWISE BE PROVIDED IN WRITING BY DEC.
     14
     15					; THE INFORMATION IN THIS DOCUMENT IS SUBJECT TO CHANGE WITHOUT
     16					; NOTICE AND SHOULD NOT BE CONSTRUED AS A COMMITMENT BY DIGITAL
     17					; EQUIPMENT CORPORATION.
     18
     19					; DEC ASSUMES NO RESPONSIBILITY FOR THE USE OR RELIABILITY
     20					; OF ITS SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DEC.
     21					;
     22					; PETER H. LIPMAN
     23					; MODIFIED BY SHAO-SUN CHIEN	28-JUN-74
     24					;+
     25					; PARSE DEVICE STRING - ZERO THE FILE NAME BLOCK AND PARSE AND
     26					; ASSIGN THE LUN FOR THE SPECIFIED DEVICE AND UNIT
     27					;
     28					; CALLING SEQUENCE:
     29					;	CALL	.PRSDV
     30					; INPUTS:
     31					;	R0=FDB ADDRESS
     32					;	R1=ADDRESS OF FILE NAME BLOCK
     33					;	R2=POINTER TO DEV, DIR, AND NAME DESCRIPTORS
     34					;	R3=DEFAULT FILE NAME BLOCK OR ZERO IF NONE SPECIFIED
     35					; OUTPUTS:
     36					;	C=0 IF SUCCESSFUL, C=1 IF ERROR, F.ERR SET TO REASON
     37					;	ALL REGISTER PRESERVED
     38					;	N.DVNM(R1), N.UNIT(R1) SET TO DEVICE NAME AND UNIT
     39					;	LUN IN F.LUN(R0) ASSIGNED
     40					;	F.RCTL(R0) SET TO DEVICE CHARACTERISTICS BITS
     41					;	F.BBFS(R0), F.VBSZ(R0) SET TO DEFAULT BUFFER SIZE
     42					;
     43					; OPERATION:
     44					;	IF THE DEVICE IS SPECIFIED IN THE ASCII STRING SPECIFIED BY R2
     45					; THEN THIS DEVICE IS USED, IF THIS IS NULL, THE THE DEFAULT NAME BLOCK
     46					; DEVICE AND UNIT FIELDS ARE USED (N.DVNM(R3), N.UNIT(R3)). FINALLY
     47					; IF THE DEFAULT NAME BLOCK IS MISSING, OR THE DEVICE FIELD IS 0, THEN
     48					; THE CURRENT ASSIGNMENT OF THE LUN IS USED AND READ BACK INTO
     49					; N.DVNM(R1) AND N.UNIT(R1).
     50					;
     51					;
     52					;-
     53	000000				.PRSDV::.SAVR1
     54	000004	012760 	000001 	000052 		MOV	#1,F.ERR(R0)
     55	000012				..PSDV::
     56	000012	010104 				MOV	R1,R4		;ZERO THE FILE NAME BLOCK
PARSDV 0104MS, PARSE DEVICE STR	MACRO M1110  22-AUG-78 01:22  PAGE 7-1


     57	000014	012705 	000017 			MOV	#S.FNBW,R5	;R5=SIZE IN WORDS OF FNB
     58	000020	005024 			4$:	CLR	(R4)+
     59	000022	077502 				SOB	R5,4$
     60
     61	000024					CALL	..ELP1		;ATTEMPT SYSTEM PARSE DIRECTIVE
     62	000030	103464 				BCS	90$		;BRANCH IF FAILURE
     63	000032	001063 				BNE	90$		;BRANCH IF SUCCESS
     64									;FALL THROUGH IF NOT SUPPORTED
PARSDV 0104MS, PARSE DEVICE STR	MACRO M1110  22-AUG-78 01:22  PAGE 8


     66					;
     67					; PARSE THE DEVICE NAME AND UNIT
     68	000034	010346 				MOV	R3,-(SP)
     69	000036	010246 				MOV	R2,-(SP)
     70	000040	001440 				BEQ	20$		;BRANCH IF NULL DEVICE DESCRIPTOR
     71	000042	016205 	000002 			MOV	N.DVPT(R2),R5	;R5=ADDRESS FOR DEVICE STRING
     72	000046	016202 	000000 			MOV	N.DVSZ(R2),R2	;R2=SIZE IN BYTES OF DEVICE STRING
     73	000052	001433 				BEQ	20$		;BRANCH IF NULL DEVICE DESCRIPTOR
     74	000054	052761 	000200 	000020 		BIS	#NB.DEV,N.STAT(R1) ;NOTE EXPLICIT DEVICE SEEN
     75	000062	112561 	000032 			MOVB	(R5)+,N.DVNM(R1) ;SET DEVICE NAME
     76	000066	112561 	000033 			MOVB	(R5)+,N.DVNM+1(R1)
     77	000072	162702 	000002 			SUB	#2,R2		;ADJUST BYTE COUNT
     78	000076	001431 				BEQ	40$		;BRANCH IF NO UNIT SPECIFIED
     79	000100	002433 				BLT	78$		;ERROR IF ONLY 1 CHAR STRING, C BIT SET
     80	000102	010503 				MOV	R5,R3		;SAVE R5=BEGINNING OF UNIT NO.
     81	000104	005004 				CLR	R4		;INIT UNIT NO. BYTE COUNT
     82	000106	122723 	000072 		10$:	CMPB	#':,(R3)+	;IF FIND :
     83	000112	001401 				BEQ	15$		;THEN DON'T COUNT IT
     84	000114	005204 				INC	R4		;COUNT ALL OTHERS
     85					; IF MORE CHARS AFTER : THEN .ODCVT WILL COMPLAIN OF BAD NUMERIC SYNTAX
     86	000116	077205 			15$:	SOB	R2,10$
     87	000120	005704 				TST	R4		; CHECK BYTE COUNT
     88	000122	001417 				BEQ	40$		; SKIP CONVERSION OF NULL NUMBER
     89	000124	010103 				MOV	R1,R3
     90	000126	062703 	000034 			ADD	#N.UNIT,R3	;R3=ADR TO RETURN NUMBER
     91	000132					CALL	.ODCVT		;R4=SIZE OF STRING, R5=ADDRESS
     92	000136	103414 				BCS	78$
     93	000140	000410 				BR	40$
     94					;
     95					; NO EXPLICIT DEVICE, USE DEFAULT FROM DEFAULT NAME BLOCK
     96	000142	005703 			20$:	TST	R3
     97	000144	001406 				BEQ	40$		;BRANCH IF NO DEFAULT NAME BLOCK
     98	000146	016361 	000034 	000034 		MOV	N.UNIT(R3),N.UNIT(R1)
     99	000154	016361 	000032 	000032 		MOV	N.DVNM(R3),N.DVNM(R1)
    100					;
    101					; ASSIGN THE LOGICAL UNIT NUMBER
    102	000162				40$:	CALL	..ALUN
    103	000166	000403 				BR	85$
    104	000170	112760 	177711 	000052 	78$:	MOVB	#IE.BDV,F.ERR(R0)
    105	000176	012602 			85$:	MOV	(SP)+,R2
    106	000200	012603 				MOV	(SP)+,R3
    107	000202				90$:	RETURN
    108					;
    109					;
    110	000204					$END	PARSDV
    111					;
    112		000001 				.END
PARSDV 0104MS, PARSE DEVICE STR	MACRO M1110  22-AUG-78 01:22  PAGE 8-1
SYMBOL TABLE

A.BFSR= 000004   	FD.RAN= 000002   	F.RCTL= 000017   	IE.FIX= 177767   	IE.SDP= 177635
A.DFBC= 000100   	FD.REC= 000001   	F.RSIZ= 000002   	IE.FLN= 177657   	IE.SNC= 177735
A.DFDR= 000050   	FD.RWM= 000001   	F.RTYP= 000000   	IE.FOP= 177713   	IE.SPC= 177772
A.DFUI= 000102   	FD.SDI= 000020   	F.SEQN= 000100   	IE.HFU= 177744   	IE.SQC= 177734
A.DPB = 000014   	FD.SPL= 000200   	F.SPDV= 000072   	IE.HWR= 177772   	IE.SRE= 177762
A.EFSR= 000006   	FD.SQD= 000040   	F.SPUN= 000074   	IE.IBS= 177647   	IE.STK= 177706
A.FIPR= 000012   	FD.TTY= 000004   	F.STBK= 000036   	IE.IDU= 177644   	IE.TCH= 177765
A.IOST= 000044   	FD.WBH= 000002   	F.UNIT= 000136   	IE.IEF= 177637   	IE.TMM= 177671
A.OWUI= 000010   	FD.WRT= 000001   	F.URBD= 000020   	IE.IES= 177656   	IE.TMO= 177666
BD.FRE= 000001   	FF.CHR= 000005   	F.VBN = 000064   	IE.IFC= 177776   	IE.ULK= 177653
BL.SZ = 000013   	FF.NV = 000003   	F.VBSZ= 000060   	IE.IFU= 177747   	IE.ULN= 177773
B.BBFS= 000010   	FF.POE= 000002   	HA.CHU= 000003   	IE.ILL= 177726   	IE.UNS= 177774
B.BFST= 000015   	FF.RWD= 000001   	HA.FP = 000002   	IE.ILU= 177640   	IE.UPN= 177777
B.NXBD= 000012   	FF.RWF= 000006   	HA.NAM= 000005   	IE.ILV= 177755   	IE.VER= 177774
B.VBN = 000004   	FF.SPC= 000004   	HA.TYP= 000006   	IE.INS= 177776   	IE.WAC= 177743
CH.AND= 000001   	FO.APD= 000106   	HA.UAT= 000004   	IE.IOP= 177655   	IE.WAT= 177741
DIRTYP= 015172   	FO.MFY= 000002   	HA.UI = 000001   	IE.IPR= 177641   	IE.WCK= 177652
D.DFDV= 000024   	FO.RD = 000001   	HA.VER= 000007   	IE.ISQ= 177703   	IE.WER= 177737
D.DFID= 000016   	FO.UPD= 000006   	IE.ABO= 177761   	IE.ITI= 177643   	IE.WLK= 177764
D.DFUN= 000026   	FO.WRT= 000016   	IE.ACT= 177771   	IE.ITP= 177650   	IE.WOV= 177653
FA.APD= 000100   	F.ACTL= 000076   	IE.ADP= 177636   	IE.ITS= 177770   	IE.2DV= 177720
FA.CRE= 000010   	F.ALOC= 000040   	IE.ALC= 177654   	IE.IUI= 177645   	IO.ACE= 007400
FA.DLK= 001000   	F.BBFS= 000062   	IE.ALG= 177654   	IE.LCK= 177745   	IO.ACR= 006400
FA.ENB= 100000   	F.BDB = 000070   	IE.ALN= 177736   	IE.LNL= 177646   	IO.ACW= 007000
FA.EXC= 002000   	F.BGBC= 000057   	IE.AST= 177660   	IE.MAP= 177657   	IO.APC= 014000
FA.EXT= 000004   	F.BKDN= 000026   	IE.BAD= 177777   	IE.MOD= 177753   	IO.APV= 014010
FA.NSP= 000100   	F.BKDS= 000020   	IE.BBE= 177710   	IE.NBF= 177731   	IO.ATT= 001400
FA.POS= 010000   	F.BKEF= 000050   	IE.BCC= 177676   	IE.NBK= 177727   	IO.CLN= 003400
FA.RD = 000001   	F.BKP1= 000051   	IE.BDI= 177714   	IE.NDR= 177670   	IO.CRE= 012000
FA.RWD= 004000   	F.BKST= 000024   	IE.BDR= 177716   	IE.NFI= 177704   	IO.DAC= 010000
FA.SEQ= 040000   	F.BKVB= 000064   	IE.BDV= 177711   	IE.NFW= 177673   	IO.DEL= 012400
FA.SHR= 000040   	F.CHR = 000075   	IE.BHD= 177700   	IE.NLK= 177661   	IO.DET= 002000
FA.TMP= 000020   	F.CNTG= 000034   	IE.BLB= 177672   	IE.NLN= 177733   	IO.ENA= 006000
FA.WCK= 020000   	F.DFNB= 000046   	IE.BLK= 177754   	IE.NNC= 177663   	IO.EXT= 011400
FA.WRT= 000002   	F.DSPT= 000044   	IE.BNM= 177712   	IE.NNL= 177662   	IO.FNA= 004400
FCSEFN= 000040   	F.DVNM= 000134   	IE.BTF= 177664   	IE.NNN= 177674   	IO.KIL= 000012
FD.BLK= 000010   	F.EFBK= 000010   	IE.BTP= 177725   	IE.NOD= 177751   	IO.LOV= 001010
FD.CCL= 000002   	F.EFN = 000050   	IE.BVR= 177701   	IE.NSF= 177746   	IO.LTK= 000050
FD.COM= 020000   	F.EOBB= 000032   	IE.BYT= 177755   	IE.NST= 177660   	IO.RAT= 013000
FD.CR = 000002   	F.ERR = 000052   	IE.CKP= 177766   	IE.NSW= 177756   	IO.RDN= 000022
FD.DIR= 000010   	F.FACC= 000043   	IE.CKS= 177742   	IE.NVR= 177652   	IO.RLB= 001000
FD.DVR= 000020   	F.FFBY= 000014   	IE.CLO= 177732   	IE.NVW= 177651   	IO.RNA= 005400
FD.EFB= 000004   	F.FNAM= 000110   	IE.CNR= 177667   	IE.OFL= 177677   	IO.RTK= 000060
FD.EF1= 000010   	F.FNB = 000102   	IE.CON= 177752   	IE.ONP= 177773   	IO.RVB= 010400
FD.EOF= 000002   	F.FTYP= 000116   	IE.DAA= 177770   	IE.OVR= 177756   	IO.SET= 000030
FD.FTN= 000001   	F.FVER= 000120   	IE.DAO= 177763   	IE.PES= 177655   	IO.ULK= 005000
FD.F11= 040000   	F.HIBK= 000004   	IE.DFU= 177750   	IE.PNS= 177642   	IO.UNL= 000042
FD.INS= 000010   	F.LUN = 000042   	IE.DNA= 177771   	IE.PRI= 177760   	IO.WAT= 013400
FD.INV= 000100   	F.MBCT= 000054   	IE.DNR= 177775   	IE.PTS= 177775   	IO.WLB= 000400
FD.ISP= 002000   	F.MBC1= 000055   	IE.DUN= 177767   	IE.RAC= 177724   	IO.WVB= 011000
FD.MNT= 100000   	F.MBFG= 000056   	IE.DUP= 177707   	IE.RAT= 177723   	IQ.Q  = 000002
FD.OER= 000040   	F.NRBD= 000024   	IE.EOF= 177766   	IE.RBG= 177730   	IQ.S  = 000004
FD.OSP= 004000   	F.NREC= 000030   	IE.EOT= 177702   	IE.RBS= 177761   	IQ.UMD= 000004
FD.PLC= 000004   	F.OVBS= 000030   	IE.EOV= 177765   	IE.RCN= 177722   	IQ.X  = 000001
FD.PRN= 000004   	F.RACC= 000016   	IE.EXP= 177665   	IE.RER= 177740   	IS.BV = 000005
FD.PSE= 010000   	F.RATT= 000001   	IE.FEX= 177717   	IE.RNM= 177715   	IS.CC = 001401
FD.RAH= 000001   	F.RCNM= 000034   	IE.FHE= 177705   	IE.RSU= 177757   	IS.CLR= 000000
PARSDV 0104MS, PARSE DEVICE STR	MACRO M1110  22-AUG-78 01:22  PAGE 8-2
SYMBOL TABLE

IS.CR = 006401   	NB.SD2= 001000   	N.FTYP= 000014   	R$$SPL= 000000   	S.FTYP= 000002
IS.EOT= 002001   	NB.SMI= 040000   	N.FVER= 000016   	R$$VMS= 000001   	S.NFEN= 000020
IS.ESC= 015401   	NB.SNM= 000040   	N.NEXT= 000022   	R$$11M= 000001   	WI.DLK= 000002
IS.ESQ= 115401   	NB.STP= 000020   	N.STAT= 000020   	R.FIX = 000001   	WI.LCK= 000001
IS.PES= 100001   	NB.SVR= 000010   	N.UNIT= 000034   	R.SEQ = 000003   	WI.SPL= 000020
IS.PND= 000000   	NB.TYP= 000002   	PP.SEP= 000002   	R.VAR = 000002   	WI.UPD= 000100
IS.RDD= 000002   	NB.VER= 000001   	PP.ZER= 000001   	SYDEV = 054523   	$$MSG = 000000
IS.SET= 000002   	N.DID = 000024   	P$$ARS= 000001   	SYUNIT= 000000   	.ODCVT= ****** GX
IS.SPD= 000002   	N.DRPT= 000006   	R$$ANI= 000001   	S.BFHD= 000020   	.PRSDV  000000RG    002
IS.SUC= 000001   	N.DRSZ= 000004   	R$$BBF= 000000   	S.FATT= 000016   	.SAVR1= ****** GX
IS.TAB= 004401   	N.DVNM= 000032   	R$$DPB= 000001   	S.FDB = 000140   	..ALUN= ****** GX
IS.TMO= 000002   	N.DVPT= 000002   	R$$EIS= 000001   	S.FNAM= 000006   	..ELP1= ****** GX
NB.DEV= 000200   	N.DVSZ= 000000   	R$$LCL= 000001   	S.FNB = 000036   	..PSDV  000012RG    002
NB.DIR= 000100   	N.FID = 000000   	R$$MUL= 000000   	S.FNBW= 000017   	...CTL= 000001
NB.DOT= 100000   	N.FNAM= 000006   	R$$OPF= 000000   	S.FNTY= 000004   	...GBL= 000000
NB.NAM= 000004   	N.FNPT= 000012   	R$$RSL= 000001   	S.FSR2= 000104   	...TPC= 000030
NB.SD1= 000400   	N.FNSZ= 000010   	R$$SEQ= 000000

. ABS.	000000	   000
      	000000	   001
$$RESL	000204	   002
ERRORS DETECTED:  0

VIRTUAL MEMORY USED:  4708 WORDS  ( 19 PAGES)
DYNAMIC MEMORY:  5940 WORDS  ( 22 PAGES)
ELAPSED TIME:  00:00:32
OBJ$:PARSDV,LIS$:PARSDV/-SP=SRC$:FCSPRE,PARSDV
