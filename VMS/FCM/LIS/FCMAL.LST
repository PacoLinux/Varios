FCMAL	MACRO M1110  21-AUG-78 23:22  PAGE 2


      1						.TITLE	FCMAL
      2						.IDENT	/03/                                                           ;**NEW**
      3					                                                                                ;**NEW**
      4					;                                                                               ;**NEW**
      5					; COPYRIGHT   1977,  DIGITAL  EQUIPMENT  CORP.,  MAYNARD,   MASS.
      6					;                                                                               ;**NEW**
      7					; THIS SOFTWARE IS FURNISHED TO PURCHASER UNDER A LICENSE FOR USE               ;**NEW**
      8					; ON A  SINGLE COMPUTER SYSTEM AND CAN BE COPIED (WITH INCLUSION                ;**NEW**
      9					; OF DEC'S COPYRIGHT NOTICE) ONLY FOR USE IN SUCH SYSTEM, EXCEPT                ;**NEW**
     10					; AS MAY OTHERWISE BE PROVIDED IN WRITING BY DEC.                               ;**NEW**
     11					;                                                                               ;**NEW**
     12					; THE  INFORMATION IN THIS DOCUMENT IS SUBJECT TO CHANGE WITHOUT                ;**NEW**
     13					; NOTICE AND  SHOULD NOT BE CONSTRUED AS A COMMITMENT BY DIGITAL                ;**NEW**
     14					; EQUIPMENT CORPORATION.                                                        ;**NEW**
     15					;                                                                               ;**NEW**
     16					; DEC  ASSUMES NO  RESPONSIBILITY  FOR  THE  USE  OR RELIABILITY                ;**NEW**
     17					; OF ITS  SOFTWARE ON  EQUIPMENT WHICH  IS NOT SUPPLIED BY DEC.                 ;**NEW**
     18					;                                                                               ;**NEW**
     19					; VERSION 03                                                                   ;**NEW**
     20					;                                                                               ;**NEW**
     21					; D. N. CUTLER/C. MONIA 04-MAR-74                                               ;**NEW**
     22					;+                                                                              ;**-13
     23					; **-$ALBLK-ALLOCATE BLOCK
     24					;
     25					; THIS ROUTINE IS CALLED TO ALLOCATE A BLOCK OF STORAGE FROM THE FREE
     26					; STORAGE POOL. IF THE BLOCK CANNOT BE ALLOCATED, THEN A FATAL ERROR
     27					; MESSAGE IS ISSUED. ELSE THE BLOCK IS ALLOCATED AND ZEROED AND THE
     28					; ADDRESS IS RETURNED TO THE CALLER.
     29					;
     30					; INPUTS:
     31					;
     32					;	R1=SIZE OF BLOCK TO ALLOCATE IN BYTES.
     33					;
     34					; OUTPUTS:
     35					;
     36					;	R0=ADDRESS OF ALLOCATED BLOCK.
     37					;-
     38
     39	000000				$ALBLK::			;                                               ;**NEW**
     40	000000	010146 				MOV	R1,-(SP)	;SAVE SIZE OF BLOCK                             ;**-1
     41	000002	016700 	000000G			MOV	.FSRPT,R0	;GET ADDRESS OF LISTHEAD
     42	000006					CALL	$RQCB		; REQUEST CORE BLOCK
     43	000012	103006 				BCC	10$		;IF CC GOT IT                                   ;**-1
     44	000014	016702 	000000G			MOV	.FSRPT,R2	; GET ADDRESS OF FREE POOL HEADER
     45	000020	012701 				MOV	(PC)+,R1	;GET ERROR/SEVERITY
     46	000022	   000G	   000G			.BYTE	E$R30,S$V2	;
     47	000024					CALL	$ERMSG		;ISSUE FATAL ERROR (NO RETURN)
     48	000030	012601 			10$:	MOV	(SP)+,R1	;RETRIEVE SIZE OF BLOCK
     49	000032	062701 	000003 			ADD	#3,R1		;ROUND TO NEXT 2 WORD BOUNDRY
     50	000036	042701 	000003 			BIC	#3,R1		;CLEAR EXECSS BITS
     51	000042	006201 				ASR	R1		;CONVERT TO WORDS
     52	000044	010002 				MOV	R0,R2		;COPY ADDRESS OF BLOCK
     53	000046	005022 			20$:	CLR	(R2)+		;CLEAR BLOCK
     54	000050					SOB	R1,20$		;REPEAT
     55	000054					RETURN			;
     56
     57		000001 				.END
FCMAL	MACRO M1110  21-AUG-78 23:22  PAGE 2-1
SYMBOL TABLE

CR    = 000015   	HT    = 000011   	SPA   = 000040   	$ALBLK  000000RG 	$$    = 000001
E$R30 = ****** GX	LF    = 000012   	S$V2  = ****** GX	$ERMSG= ****** GX	.FSRPT= ****** GX
FF    = 000014   	R$$11M= 000000   	VT    = 000013   	$RQCB = ****** GX

. ABS.	000000	   000
      	000056	   001
ERRORS DETECTED:  0

VIRTUAL MEMORY USED:  613 WORDS  ( 3 PAGES)
DYNAMIC MEMORY:  2772 WORDS  ( 10 PAGES)
ELAPSED TIME:  00:00:05
OBJ$:FCMAL,LIS$:FCMAL/-SP=SRC$:MACFLM,FCMAL
