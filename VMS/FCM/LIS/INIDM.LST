INIDM	MACRO M1110  21-AUG-78 23:23  PAGE 2


      1						.TITLE	INIDM
      2						.IDENT	/00/
      3
      4					;
      5					; COPYRIGHT   1974,  DIGITAL  EQUIPMENT  CORP.,  MAYNARD,   MASS.
      6					;
      7					; THIS SOFTWARE IS FURNISHED TO PURCHASER UNDER A LICENSE FOR USE
      8					; ON A SINGLE COMPUTER SYSTEM  AND  CAN BE COPIED (WITH INCLUSION
      9					; OF DEC'S COPYRIGHT NOTICE)  ONLY FOR USE IN SUCH SYSTEM, EXCEPT
     10					; AS MAY OTHERWISE BE PROVIDED IN WRITING BY DEC.
     11					;
     12					; THE INFORMATION IN  THIS DOCUMENT IS  SUBJECT TO CHANGE WITHOUT
     13					; NOTICE AND SHOULD NOT  BE CONSTRUED AS  A COMMITMENT BY DIGITAL
     14					; EQUIPMENT CORPORATION.
     15					;
     16					; DEC ASSUMES  NO  RESPONSIBILITY  FOR  THE  USE  OR  RELIABILITY
     17					; OF ITS  SOFTWARE  ON  EQUIPMENT  WHICH IS NOT  SUPPLIED BY DEC.
     18					;
     19					; VERSION 00
     20					;
     21					; C. MONIA 26-DEC-74
     22					;
     23					; INITIALIZE DYNAMIC MEMORY
     24					;
     25					; MACRO LIBRARY CALLS
     26					;
     27
     28						.MCALL	DIR$,GPRT$,GTSK$
     29					;
     30					; LOCAL DATA
     31					;
     32					; TASK MEMORY LIMITS
     33					;
     34
     35	000000	000000 	000000 		LIMIT:	.LIMIT			;
     36
     37					;
     38					; 'GET PARTITION PARAMTERS' DPB
     39					;
     40
     41	000004				PDPB:	GPRT$	,TBUF		;
     42
     43					;
     44					; 'GET TASK PARAMTERS' DPB
     45					;
     46
     47	000014				TDPB:	GTSK$	TBUF		;
     48
     49					;
     50					; PARAMETER BUFFER
     51					;
     52
     53	000020				TBUF:	.BLKW	16.		;
     54
     55					;+
     56					; **-$INIDM-INITIALIZE DYNAMICALLY ALLOCATED STORAGE
     57					;
INIDM	MACRO M1110  21-AUG-78 23:23  PAGE 2-1


     58					; THIS SUBROUTINE IS CALLED TO ESTABLISH THE INITIAL STATE
     59					; OF THE CORE POOL REFERENCED BY THE SUBROUTINES WHICH ALLO-
     60					; CATE AND DEALLOCATE CORE BLOCKS. THE POOL CONSISTS OF ALL
     61					; MEMORY EXTENDING FROM THE END OF THE TASK IMAGE TO THE LAST
     62					; PHYSICAL LOCATION OWNED BY THE TASK.
     63					;
     64					; INPUTS:
     65					;
     66					;	.FSRPT=POINTER TO DYNAMIC CORE POOL LISTHEAD
     67					;
     68					; OUTPUTS:
     69					;
     70					;	FREE LIST IN DYNAMICALLY ALLOCATED MEMORY
     71					;	IS INITIALIZED.
     72					;-
     73
     74	000060				$INIDM::			;
     75	000060					DIR$	#PDPB		; GET PARTITION PARAMETERS
     76	000066	016700 	000000G			MOV	$DSW,R0		; SAVE STARTING VIRTUAL ADDRESS OF PARTITION
     77	000072					DIR$	#TDPB		; GET TASK PARAMETERS
     78	000100	016701 	000000G			MOV	.FSRPT,R1	; GET CORE POOL LISTHEAD
     79	000104	016721 	177672 			MOV	LIMIT+2,(R1)+	; SET INITIAL ADDRESS OF CORE POOL
     80	000110	005011 				CLR	(R1)		; CLEAR SECOND WORD OF LISTHEAD
     81	000112	014101 				MOV	-(R1),R1	; GET FIRST LOCATION IN POOL
     82	000114	010146 				MOV	R1,-(SP)	; SAVE ADDRESS
     83	000116	005021 				CLR	(R1)+		; CLEAR FIRST WORD OF DYNAMIC STORE
     84	000120	016711 	177726 			MOV	TBUF+32,(R1)	; SET PHYSICAL SIZE OF TASK
     85	000124	160016 				SUB	R0,(SP)		; COMPUTE APPARENT TASK SIZE
     86	000126	162611 				SUB	(SP)+,(R1)	; SET SIZE OF FREE POOL
     87	000130	042711 	000003 			BIC	#3,(R1)		; TRUNCATE TO MULTIPLE OF 4 BYTES
     88	000134					RETURN			;
     89
     90		000001 				.END
INIDM	MACRO M1110  21-AUG-78 23:23  PAGE 2-2
SYMBOL TABLE

CR    = 000015   	G.TSDU= 000036   	G.TSRN= 000010   	LIMIT   000000R  	TBUF    000020R
FF    = 000014   	G.TSFW= 000024   	G.TSSY= 000034   	PDPB    000004R  	TDPB    000014R
G.PRBA= 000006   	G.TSGC= 000017   	G.TSTN= 000000   	RX$IAS= 000003   	VT    = 000013
G.PRFW= 000004   	G.TSMT= 000022   	G.TSTS= 000032   	RX$11D= 000000   	$DSW  = ****** GX
G.PRPB= 000000   	G.TSNL= 000020   	G.TSVA= 000026   	RX$11M= 000001   	$INIDM  000060RG
G.PRPN= 000002   	G.TSPC= 000016   	G.TSVL= 000030   	RX$11S= 000002   	$$$OST= 000004
G.PRPS= 000002   	G.TSPN= 000004   	HT    = 000011   	R$$11M= 000000   	$$$T1 = 000000
G.TSBA= 000002   	G.TSPR= 000014   	LF    = 000012   	SPA   = 000040   	.FSRPT= ****** GX

. ABS.	000000	   000
      	000136	   001
ERRORS DETECTED:  0

VIRTUAL MEMORY USED:  1450 WORDS  ( 6 PAGES)
DYNAMIC MEMORY:  2772 WORDS  ( 10 PAGES)
ELAPSED TIME:  00:00:09
OBJ$:INIDM,LIS$:INIDM/-SP=SRC$:MACFLM,INIDM
