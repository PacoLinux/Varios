CNTRL	MACRO M1110  21-AUG-78 23:21  PAGE 2


      1						.TITLE	CNTRL
      2						.IDENT	/00/
      3
      4					;
      5					; COPYRIGHT (C) 1976, 1977
      6					; DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASS.
      7					;
      8					; THIS SOFTWARE IS FURNISHED UNDER  A LICENSE FOR USE ONLY  ON  A
      9					; SINGLE COMPUTER SYSTEM AND MAY BE  COPIED ONLY WITH  THE INCLU-
     10					; SION OF  THE  ABOVE  COPYRIGHT NOTICE.  THIS SOFTWARE,  OR  ANY
     11					; OTHER COPIES THEREOF, MAY NOT BE  PROVIDED  OR  OTHERWISE  MADE
     12					; AVAILABLE TO ANY OTHER PERSON EXCEPT  FOR  USE  ON  SUCH SYSTEM
     13					; AND TO  ONE WHO AGREES  TO  THESE LICENSE  TERMS.  TITLE TO AND
     14					; OWNERSHIP OF THE SOFTWARE SHALL AT ALL TIMES REMAIN IN DEC.
     15					;
     16					; THE INFORMATION IN THIS SOFTWARE  IS  SUBJECT TO CHANGE WITHOUT
     17					; NOTICE AND SHOULD NOT BE CONSTRUED  AS  A COMMITMENT BY DIGITAL
     18					; EQUIPMENT CORPORATION.
     19					;
     20					; DEC ASSUMES NO RESPONSIBILITY FOR THE USE OR RELIABILITY OF ITS
     21					; SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DEC.
     22					;
     23					;
     24					; VERSION 00
     25					;
     26					; C. MONIA 17-OCT-1977
     27					;
     28					; EXECUTIVE CONTROL AND EXIT HANDLER
     29					;
     30					; MACRO LIBRARY CALLS
     31					;
     32
     33						.MCALL	EXIT$S,EXST$S
     34
     35					;
     36					; LOCAL DATA
     37					;
     38					; SAVED STACK POINTER
     39					;
     40
     41	000000				SPSAV:	.BLKW	1		;
     42
     43					;
     44					; PROGRAM DISPATCH TABLE
     45					;
     46
     47	000000					.PSECT	$$DSP0,OVR,GBL
     48
     49	000000				TV:	.BLKW	0		; TRANSFER VECTOR LIST
     50
     51	000000					.PSECT	$$DSP1,GBL
     52
     53	000000	000016'				.WORD	START1		; TERMINATE TRANSFER VECTOR LIST
     54
     55	000002					.PSECT
     56
     57	000002	000000 			$CLNUP::.WORD	0		; ADDRESS OF CLEANUP ROUTINE
CNTRL	MACRO M1110  21-AUG-78 23:21  PAGE 2-1


     58
     59					;+
     60					; **-$START-GENERAL FLOW CONTROLLER FOR RSX PROGRAMS
     61					;
     62					; THIS ROUTINE PERFORMS GENERAL FLOW CONTROL AND RESTART SERVICES FOR
     63					; A PROGRAM. IT CALLS A LIST OF TOP LEVEL ROUTINES WHOSE ADDRESSES ARE
     64					; STORED IN .PSECT $$DSP0. ROUTINES ARE CALLED IN ORDER. A CALL TO
     65					; RESTART THE PROGRAM IS AUTOMATICALLY APPENDED TO THE LIST.
     66					;
     67					; BY CONVENTION, EACH ROUTINE MUST PRESERVE THE CONTENTS OF R3 - R5. R0
     68					; THROUGH R2 MAY BE BE ALTERED.
     69					;
     70					; INPUTS:
     71					;
     72					;	NONE
     73					;
     74					; OUTPUTS:
     75					;
     76					;	NONE
     77					;
     78					;-
     79
     80						.ENABL	LSB
     81
     82	000004				$START::			;
     83	000004	010667 	177770 			MOV	SP,SPSAV	; MARK LOCATION OF STACK
     84	000010	012767 	000001 	000000G		MOV	#EX$SUC,$EXSTS	; SET EXIT STATUS
     85	000016				START1:				;
     86	000016	016706 	177756 			MOV	SPSAV,SP	; RESTORE STACK
     87	000022	012705 	000000'			MOV	#TV,R5		; POINT TO LIST OF TRANSFER VECTORS
     88	000026				10$:				;
     89	000026					CALL	@(R5)+		; CALL EACH ROUTINE IN SEQUENCE
     90	000030	000776 				BR	10$		; CONTINUE
     91
     92						.DSABL	LSB
     93
     94					;+
     95					; **-$RSTRT-RESTART AFTER FATAL ERROR
     96					;
     97					; THIS ROUTINE IS ENTERED VIA A JUMP AFTER A FATAL ERROR TO RESTART
     98					; PROGRAM EXECUTION. IT CALLS THE USER-SPECIFIED CLEANUP ROUTINE (IF
     99					; ANY) AND RESTARTS PROGRAM EXECUTION.
    100					;
    101					; INPUTS:
    102					;
    103					;	$CLNUP = ADDRESS OF USER-SPECIFIED CLEANUP ROUTINE (0 = NONE)
    104					;
    105					; OUTPUTS:
    106					;
    107					;	NONE
    108					;-
    109
    110	000032				$RSTRT::			;
    111	000032	016705 	177744 			MOV	$CLNUP,R5	; GET ADDRESS OF CLEANUP ROUTINE
    112	000036	001767 				BEQ	START1		; IF EQ, NONE, RESTART
    113	000040					CALL	(R5)		; CALL CLEANUP ROUTINE
    114	000042	000765 				BR	START1		; RESTART
CNTRL	MACRO M1110  21-AUG-78 23:21  PAGE 2-2


    115
    116					;+
    117					; **-$EXIT-EXIT HANDLER
    118					;
    119					; THIS ROUTINE IS ENTERED VIA A JUMP TO PERFORM EXIT SERVICES FOR THE PRO-
    120					; GRAM. IT CALLS THE USER-SPECIFIED CLEANUP ROUTINE THEN PERFORMS AN EXIT
    121					; WITH STATUS.
    122					;
    123					; INPUTS:
    124					;
    125					;	$CLNUP = ADDRESS OF USER-SPECIFIED CLEANUP ROUTINE (0=NONE)
    126					;	$EXSTS = EXIT STATUS
    127					;
    128					; OUTPUTS:
    129					;
    130					;	NONE
    131					;
    132					;-
    133
    134	000044				$EXIT::				;
    135	000044	016705 	177732 			MOV	$CLNUP,R5	; GET ADDRESS OF CLEANUP ROUTINE
    136	000050	001401 				BEQ	10$		; IF EQ NONE
    137	000052					CALL	(R5)		; CALL CLEANUP ROUTINE
    138	000054				10$:				;
    139	000054					EXST$S	$EXSTS		; EXIT WITH STATUS
    140	000066					EXIT$S			; EXIT
    141
    142		000004'				.END	$START
CNTRL	MACRO M1110  21-AUG-78 23:21  PAGE 2-3
SYMBOL TABLE

CR    = 000015   	FF    = 000014   	SPA   = 000040   	VT    = 000013   	$RSTRT  000032RG
EX$ERR= 000002   	HT    = 000011   	SPSAV   000000R  	$CLNUP  000002RG 	$START  000004RG
EX$SEV= 000004   	LF    = 000012   	START1  000016R  	$EXIT   000044RG 	$$    = 000001
EX$SUC= 000001   	R$$11M= 000000   	TV      000000R     002	$EXSTS= ****** GX	$$$OST= 000005
EX$WAR= 000000

. ABS.	000000	   000
      	000074	   001
$$DSP0	000000	   002
$$DSP1	000002	   003
ERRORS DETECTED:  0

VIRTUAL MEMORY USED:  1071 WORDS  ( 5 PAGES)
DYNAMIC MEMORY:  2772 WORDS  ( 10 PAGES)
ELAPSED TIME:  00:00:07
OBJ$:CNTRL,LIS$:CNTRL/-SP=SRC$:MACFLM,CNTRL
