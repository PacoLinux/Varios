
                22-Aug-1978 02:49:10	VAX-11 FORTRAN IV-PLUS V1.0-2      Page 1   
					DVHEAD.FOR.16       

0001    	SUBROUTINE	DVHEAD ( LUN, ERROR, FLAG)
         
        C
        C	INCLUDE FILES:
        C
0002    	INCLUDE	'SRC$:EMBDEF.FOR/NOLIST'
0159    	INCLUDE 'SRC$:SYECOM.FOR/NOLIST'
         
        C
        C	OWN STORAGE:
        C			None.
         
        C
        C	EXTERNAL REFERENCES:
        C
0173    	INTEGER*2	DEVCHK
         
         
        C++
        C
        C	FUNCTIONAL DESCRIPTION:
        C
        C	Produces device independent header output for hardware device errors.
         
        C
        C	FORMAL PARAMETERS:
        C
0174    	BYTE		LUN
0175    	CHARACTER*(*)	ERROR
0176    	BYTE		FLAG
         
        C
        C	IMPLICIT INPUTS:
        C
        C				Error record in labeled common EMB.
         
        C
        C	IMPLICIT OUTPUTS:
        C
        C				None.
         
        C
        C	SIDE EFFECTS:
        C
        C				None.
        C--
         
        C
        C	If formal parameter FLAG is non-zero,
        C	a top of form is performed.
        C
0177    	IF(FLAG .NE. 0)  CALL FRCTOF(LUN)
         
0178    	IF(EMB$B_DV_ENTRY .EQ. '60'X)	! IF EQ 60, TIMEOUT
        	1	THEN
0179    			CALL HEADER (LUN, (ERROR // ' timeout error'))

DVHEAD          22-Aug-1978 02:49:10	VAX-11 FORTRAN IV-PLUS V1.0-2      Page 2   
					DVHEAD.FOR.16       

0180    		ELSE
0181    			CALL HEADER (LUN, (ERROR // ' device error'))
0182    	ENDIF
         
0183    	IF(FLAG .EQ. 0)
        	1  THEN
0184    		CALL LINCHK(LUN,2)
0185    		WRITE(LUN,401)  (EMB$T_DV_NAME(I),I=1,EMB$T_DV_NAME(0)),
        	1				EMB$W_DV_UNIT
0186     401		FORMAT('0',<EMB$T_DV_NAME(0)>A1,I1,':')
         
0187    		RETURN
0188    	ENDIF
         
          
0189    	CALL LINCHK(LUN,7)
         
0190    	WRITE( LUN, 501)
        	1		EMB$B_DV_TYPE,
        	2		(EMB$T_DV_NAME(I),I=1,EMB$T_DV_NAME(0)),
        	3		EMB$W_DV_UNIT,
        	4		EMB$B_DV_SLAVE
         
0191     501	FORMAT('0Unit Identification:'/
        	1	' ',T10,'Device Type:',T40,Z2/
        	2	' ',T10,'Device Name:',T40,<EMB$T_DV_NAME(0)>A1/
        	3	' ',T10,'Unit Number:',T40,I1,'.'/
        	4	' ',T10,'Slave Controller:',T40,I1,'.')
         
0192    	I	= DEVCHK(EMB$T_DV_NAME)
         
0193    	WRITE(LUN,511)  (VOLNAM(I,EMB$W_DV_UNIT,J),J=1,12)
0194     511	FORMAT(' ',T10,'Volume Label:',T40,12A1)
         
0195    	RETURN
0196    	END

DVHEAD          22-Aug-1978 02:49:10	VAX-11 FORTRAN IV-PLUS V1.0-2      Page 3   
					DVHEAD.FOR.16       

		.TITLE	DVHEAD
		.IDENT	01

    0000	.PSECT	EMB
    0000  EMB:

    0000	.PSECT	SYECOM
    0000  L_QUESTION:
    0004  TTY:
    0008  DEVSUMCNT:
    000A  RECCNT:
    000C  NAMDEVSUM:
    0160  VOLNAM:

    0004	.PSECT	EMB
    0004  EMB$W_HD_ENTRY:
    0004  EMB$B_HD_ENTRY:
    0004  EMB$W_DV_ENTRY:
    0004  EMB$B_DV_ENTRY:
    0004  EMB$W_TS_ENTRY:
    0004  EMB$B_TS_ENTRY:
    0004  EMB$W_SS_ENTRY:
    0004  EMB$B_SS_ENTRY:
    0004  EMB$W_VM_ENTRY:
    0004  EMB$B_VM_ENTRY:
    0010  EMB$L_SU_DAYTIM:
    000E  EMB$W_SU_ERRSEQ:
    0006  EMB$Q_SU_TIME:
    0004  EMB$W_SU_ENTRY:
    0032  EMB$T_VM_LABEL:
    0030  EMB$W_VM_NUMSET:
    002E  EMB$W_VM_VOLNUM:
    001F  EMB$T_VM_NAMTXT:
    001E  EMB$B_VM_NAMLNG:
    001C  EMB$W_VM_UNIT:
    0018  EMB$L_VM_OPRCNT:
    0014  EMB$L_VM_ERRCNT:
    0010  EMB$L_VM_OWNUIC:
    000E  EMB$W_VM_ERRSEQ:
    0006  EMB$Q_VM_TIME:
    0012  EMB$B_SS_MSGTXT:
    0010  EMB$W_SS_MSGSZ:
    000E  EMB$W_SS_ERRSEQ:
    0006  EMB$Q_SS_TIME:
    000E  EMB$W_TS_ERRSEQ:
    0006  EMB$Q_TS_TIME:
    004E  EMB$L_DV_REGSAV:
    003E  EMB$T_DV_NAME:
    003C  EMB$W_DV_FUNC:
    003A  EMB$B_DV_SLAVE:
    0036  EMB$L_DV_CHAR:
    0032  EMB$L_DV_OWNUIC:
    002E  EMB$L_DV_OPCNT:
    002C  EMB$W_DV_ERRCNT:
    002A  EMB$W_DV_UNIT:
    0026  EMB$L_DV_MEDIA:

DVHEAD          22-Aug-1978 02:49:10	VAX-11 FORTRAN IV-PLUS V1.0-2      Page 4   
					DVHEAD.FOR.16       

    0024  EMB$W_DV_BCNT:
    0022  EMB$W_DV_BOFF:
    001E  EMB$L_DV_RQPID:
    001D  EMB$B_DV_TYPE:
    001C  EMB$B_DV_CLASS:
    001A  EMB$W_DV_DEVSTS:
    0012  EMB$Q_DV_IOSB:
    0011  EMB$B_DV_ERTMAX:
    0010  EMB$B_DV_ERTCNT:
    000E  EMB$W_DV_ERRSEQ:
    0006  EMB$Q_DV_TIME:
    000E  EMB$W_HD_ERRSEQ:
    0006  EMB$Q_HD_TIME:
    0000  EMB$L_SID:

    0000	.PSECT	$PDATA
    0000	.LONG	^X00000002
    0004	.LONG	^X00000007

    0008	.PSECT	$LOCAL
    0008	.LONG	^X010E0000
    000C	.LONG	^X00000000
    0010	.LONG	^X00000001
    0014	.LONG	^X00000000
    0018	.LONG	^X010E0000
    001C	.LONG	^X00000000
    0020	.LONG	^X00000002
    0024	.LONG	^X00000000
    0028	.ADDR	$LOCAL+^X18
    002C	.LONG	^X00000002
    0030	.LONG	^X00000000
    0034	.ADDR	$PDATA
    0038	.LONG	^X00000002
    003C	.LONG	^X00000000
    0040	.ADDR	$PDATA+^X4
    0044	.LONG	^X00000001
    0048	.ADDR	EMB$T_DV_NAME

    0008	.PSECT	$PDATA
    0008  .401:
    0008	.XBYTE	0F,01,30,95,80
    000D	.ADDR	L$NBFP
    0011	.XBYTE	01,18,01,0F,01,3A,04
    0018  .501:
    0018	.XBYTE	0F,15,30,55,6E,69,74,20,49,64,65,6E,74,69,66,69
    0028	.XBYTE	63,61,74,69,6F,6E,3A,05,0F,01,20,0D,0A,0F,0C,44
    0038	.XBYTE	65,76,69,63,65,20,54,79,70,65,3A,0D,28,19,02,05
    0048	.XBYTE	0F,01,20,0D,0A,0F,0C,44,65,76,69,63,65,20,4E,61
    0058	.XBYTE	6D,65,3A,0D,28,95,80
    005F	.ADDR	L$ACPB
    0063	.XBYTE	01,05,0F,01,20,0D,0A,0F,0C,55,6E,69,74,20,4E,75
    0073	.XBYTE	6D,62,65,72,3A,0D,28,18,01,0F,01,2E,05,0F,01,20
    0083	.XBYTE	0D,0A,0F,11,53,6C,61,76,65,20,43,6F,6E,74,72,6F
    0093	.XBYTE	6C,6C,65,72,3A,0D,28,18,01,0F,01,2E,04
    00A0  .511:
    00A0	.XBYTE	0F,01,20,0D,0A,0F,0D,56,6F,6C,75,6D,65,20,4C,61

DVHEAD          22-Aug-1978 02:49:10	VAX-11 FORTRAN IV-PLUS V1.0-2      Page 5   
					DVHEAD.FOR.16       

    00B0	.XBYTE	62,65,6C,3A,0D,28,95,01,0C,01,04

    0000	.PSECT	$CODE
    0000  DVHEAD::
    0000	.WORD	^M<IV,R2,R3,R4,R5,R6,R7,R8,R9,R10,R11>
    0002	MOVAL	$LOCAL, R11
    0009	MOVQ	@ERROR(AP), R0
    000D	MOVL	R1, $LOCAL+^XC(R11)
    0011	MOVW	R0, $LOCAL+^X8(R11)
									    ; 0177
    0015	TSTB	@FLAG(AP)
    0018	BEQL	L$NBOJ
    001A	MOVAB	@LUN(AP), $LOCAL+^X14(R11)
    001F	CALLG	$LOCAL+^X10(R11), FRCTOF
    0027  L$NBOJ:
									    ; 0178
    0027	CMPB	EMB$B_DV_ENTRY, #96
    002F	BNEQ	L$NBMK
									    ; 0179
    0031	CLRL	R6
    0033	MOVAB	@LUN(AP), $LOCAL+^X24(R11)
    0038	SUBL2	#14, SP
    003B	MOVC3	#14, $PDATA+^XBB, (SP)
    0043	MOVZWL	$LOCAL+^X8(R11), R7
    0047	SUBL2	R7, SP
    004A	MOVC3	R7, @$LOCAL+^XC(R11), (SP)
    004F	ADDL2	#14, R7
    0052	MOVW	R7, $LOCAL+^X18(R11)
    0056	ADDL2	R7, R6
    0059	MOVL	SP, $LOCAL+^X1C(R11)
    005D	CALLG	$LOCAL+^X20(R11), HEADER
    0065	ADDL2	R6, SP
									    ; 0180
    0068	BRB	L$NBKL
    006A  L$NBMK:
									    ; 0181
    006A	CLRL	R6
    006C	MOVAB	@LUN(AP), $LOCAL+^X24(R11)
    0071	SUBL2	#13, SP
    0074	MOVC3	#13, $PDATA+^XC9, (SP)
    007C	MOVZWL	$LOCAL+^X8(R11), R7
    0080	SUBL2	R7, SP
    0083	MOVC3	R7, @$LOCAL+^XC(R11), (SP)
    0088	ADDL2	#13, R7
    008B	MOVW	R7, $LOCAL+^X18(R11)
    008F	ADDL2	R7, R6
    0092	MOVL	SP, $LOCAL+^X1C(R11)
    0096	CALLG	$LOCAL+^X20(R11), HEADER
    009E	ADDL2	R6, SP
									    ; 0182
    00A1  L$NBKL:
									    ; 0183
    00A1	TSTB	@FLAG(AP)
    00A4	BNEQ	L$NBAM
									    ; 0184
    00A6	MOVAB	@LUN(AP), $LOCAL+^X30(R11)

DVHEAD          22-Aug-1978 02:49:10	VAX-11 FORTRAN IV-PLUS V1.0-2      Page 6   
					DVHEAD.FOR.16       

    00AB	CALLG	$LOCAL+^X2C(R11), LINCHK
									    ; 0185
    00B3	PUSHAL	.401
    00B9	CVTBL	@LUN(AP), -(SP)
    00BD	CALLS	#2, FOR$WRITE_SF
    00C4	CVTBL	EMB$T_DV_NAME, R9
    00CB	MOVL	#1, R10
    00CE  L$NBMN:
    00CE	PUSHAB	EMB$T_DV_NAME[R10]
    00D5	CALLS	#1, FOR$IO_B_R
    00DC	AOBLEQ	R9, R10, L$NBMN
    00E0	MOVL	R10, I(R11)
    00E3	PUSHAW	EMB$W_DV_UNIT
    00E9	CALLS	#1, FOR$IO_W_R
    00F0	CALLS	#0, FOR$IO_END
									    ; 0187
    00F7	RET	
									    ; 0188
    00F8  L$NBAM:
									    ; 0189
    00F8	MOVAB	@LUN(AP), $LOCAL+^X3C(R11)
    00FD	CALLG	$LOCAL+^X38(R11), LINCHK
									    ; 0190
    0105	PUSHAL	.501
    010B	CVTBL	@LUN(AP), -(SP)
    010F	CALLS	#2, FOR$WRITE_SF
    0116	MOVAL	EMB, R8
    011D	PUSHAB	EMB$B_DV_TYPE(R8)
    0120	CALLS	#1, FOR$IO_B_R
    0127	CVTBL	EMB$T_DV_NAME(R8), R9
    012B	MOVL	#1, R10
    012E  L$ACGA:
    012E	PUSHAB	EMB$T_DV_NAME(R8)[R10]
    0132	CALLS	#1, FOR$IO_B_R
    0139	AOBLEQ	R9, R10, L$ACGA
    013D	MOVL	R10, I(R11)
    0140	PUSHAW	EMB$W_DV_UNIT(R8)
    0143	CALLS	#1, FOR$IO_W_R
    014A	PUSHAB	EMB$B_DV_SLAVE(R8)
    014D	CALLS	#1, FOR$IO_B_R
    0154	CALLS	#0, FOR$IO_END
									    ; 0192
    015B	CALLG	$LOCAL+^X44(R11), DEVCHK
    0163	CVTWL	R0, I(R11)
									    ; 0193
    0166	PUSHAL	.511
    016C	CVTBL	@LUN(AP), -(SP)
    0170	CALLS	#2, FOR$WRITE_SF
    0177	MOVL	#1, R10
    017A  L$ACID:
    017A	MULL3	#8, R10, R0
    017E	CVTWL	EMB$W_DV_UNIT, R1
    0185	ADDL2	R1, R0
    0188	MULL2	#20, R0
    018B	ADDL2	I(R11), R0
    018E	PUSHAB	VOLNAM-161[R0]

DVHEAD          22-Aug-1978 02:49:10	VAX-11 FORTRAN IV-PLUS V1.0-2      Page 7   
					DVHEAD.FOR.16       

    0195	CALLS	#1, FOR$IO_B_R
    019C	AOBLEQ	#12, R10, L$ACID
    01A0	MOVL	R10, J(R11)
    01A4	CALLS	#0, FOR$IO_END
									    ; 0195
    01AB	RET	
    01AC  L$NBFP:
    01AC	.WORD	^M<IV>
    01AE	CVTBL	EMB$T_DV_NAME, R0
    01B5	RET	
    01B6  L$ACPB:
    01B6	.WORD	^M<IV>
    01B8	CVTBL	EMB$T_DV_NAME, R0
    01BF	RET	

    00BB	.PSECT	$PDATA
    00BB	.XBYTE	20,74,69,6D,65,6F,75,74,20,65,72,72,6F,72
    00C9	.XBYTE	20,64,65,76,69,63,65,20,65,72,72,6F,72
		.END

DVHEAD          22-Aug-1978 02:49:10	VAX-11 FORTRAN IV-PLUS V1.0-2      Page 8   
					DVHEAD.FOR.16       

PROGRAM SECTIONS

    Name                 Bytes   Attributes

  0 $CODE                  448   PIC CON REL LCL   SHR   EXE   RD NOWRT LONG
  1 $PDATA                 214   PIC CON REL LCL   SHR NOEXE   RD NOWRT LONG
  2 $LOCAL                  76   PIC CON REL LCL NOSHR NOEXE   RD   WRT LONG
  3 EMB                    500   PIC OVR REL GBL   SHR NOEXE   RD   WRT LONG
  4 SYECOM                2272   PIC OVR REL GBL   SHR NOEXE   RD   WRT LONG


ENTRY POINTS

    Address  Type Name           

  0-00000000      DVHEAD         


VARIABLES

    Address  Type Name               Address  Type Name               Address  Type Name               Address  Type Name           

  4-00000008  I*2 DEVSUMCNT        3-0000001C  L*1 EMB$B_DV_CLASS   3-00000004  L*1 EMB$B_DV_ENTRY   3-00000010  L*1 EMB$B_DV_ERTCNT
  3-00000011  L*1 EMB$B_DV_ERTMAX  3-0000003A  L*1 EMB$B_DV_SLAVE   3-0000001D  L*1 EMB$B_DV_TYPE    3-00000004  L*1 EMB$B_HD_ENTRY 
  3-00000004  L*1 EMB$B_SS_ENTRY   3-00000012  L*1 EMB$B_SS_MSGTXT  3-00000004  L*1 EMB$B_TS_ENTRY   3-00000004  L*1 EMB$B_VM_ENTRY 
  3-0000001E  L*1 EMB$B_VM_NAMLNG  3-00000036  I*4 EMB$L_DV_CHAR    3-00000026  I*4 EMB$L_DV_MEDIA   3-0000002E  I*4 EMB$L_DV_OPCNT 
  3-00000032  I*4 EMB$L_DV_OWNUIC  3-0000004E  I*4 EMB$L_DV_REGSAV  3-0000001E  I*4 EMB$L_DV_RQPID   3-00000000  I*4 EMB$L_SID      
  3-00000010  I*4 EMB$L_SU_DAYTIM  3-00000014  I*4 EMB$L_VM_ERRCNT  3-00000018  I*4 EMB$L_VM_OPRCNT  3-00000010  I*4 EMB$L_VM_OWNUIC
  3-00000012  R*8 EMB$Q_DV_IOSB    3-00000006  I*4 EMB$Q_DV_TIME    3-00000006  R*8 EMB$Q_HD_TIME    3-00000006  R*8 EMB$Q_SS_TIME  
  3-00000006  R*8 EMB$Q_SU_TIME    3-00000006  R*8 EMB$Q_TS_TIME    3-00000006  R*8 EMB$Q_VM_TIME    3-00000024  I*2 EMB$W_DV_BCNT  
  3-00000022  I*2 EMB$W_DV_BOFF    3-0000001A  I*2 EMB$W_DV_DEVSTS  3-00000004  I*2 EMB$W_DV_ENTRY   3-0000002C  I*2 EMB$W_DV_ERRCNT
  3-0000000E  I*2 EMB$W_DV_ERRSEQ  3-0000003C  I*2 EMB$W_DV_FUNC    3-0000002A  I*2 EMB$W_DV_UNIT    3-00000004  I*2 EMB$W_HD_ENTRY 
  3-0000000E  I*2 EMB$W_HD_ERRSEQ  3-00000004  I*2 EMB$W_SS_ENTRY   3-0000000E  I*2 EMB$W_SS_ERRSEQ  3-00000010  I*2 EMB$W_SS_MSGSZ 
  3-00000004  I*2 EMB$W_SU_ENTRY   3-0000000E  I*2 EMB$W_SU_ERRSEQ  3-00000004  I*2 EMB$W_TS_ENTRY   3-0000000E  I*2 EMB$W_TS_ERRSEQ
  3-00000004  I*2 EMB$W_VM_ENTRY   3-0000000E  I*2 EMB$W_VM_ERRSEQ  3-00000030  I*2 EMB$W_VM_NUMSET  3-0000001C  I*2 EMB$W_VM_UNIT  
  3-0000002E  I*2 EMB$W_VM_VOLNUM AP-00000008@ CHR ERROR           AP-0000000C@ L*1 FLAG             2-00000000  I*4 I              
  2-00000004  I*4 J               AP-00000004@ L*1 LUN              4-00000000  L*4 L_QUESTION       4-0000000A  I*2 RECCNT         
  4-00000004  L*4 TTY            


ARRAYS

    Address  Type Name		       Bytes  Dimensions

  3-00000000  L*1 EMB                    500  (0:499)
  3-0000003E  L*1 EMB$T_DV_NAME           16  (0:15)
  3-00000032  L*1 EMB$T_VM_LABEL          12  (12)
  3-0000001F  L*1 EMB$T_VM_NAMTXT         15  (15)
  4-0000000C  L*1 NAMDEVSUM              340  (20,0:16)
  4-00000160  L*1 VOLNAM                1920  (20,0:7,12)


LABELS

    Address   Label       Address   Label       Address   Label   


DVHEAD          22-Aug-1978 02:49:10	VAX-11 FORTRAN IV-PLUS V1.0-2      Page 9   
					DVHEAD.FOR.16       

  1-00000008  401'      1-00000018  501'      1-000000A0  511'    


FUNCTIONS AND SUBROUTINES REFERENCED

DEVCHK            FRCTOF            HEADER            LINCHK         


Total Space Allocated = 3510 Bytes


COMPILER OPTIONS

/CHECK=(NOBOUNDS,OVERFLOW)
/DEBUG=(NOSYMBOLS,TRACEBACK)
/OPTIMIZE  /WARNINGS  /I4  /NOD_LINES  
