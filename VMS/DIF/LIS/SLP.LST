FORTRAN IV-PLUS V02-51D		02:46:38    22-AUG-78		PAGE 1   
SLP.FTN      	/TR:BLOCKS/WR

        C
        C
        C
        C
        C	SLPOUT -- OUTPUT SLP DATA
        C
        C
        C
        C
        C	COPYRIGHT (C) 1976
        C	DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASS.
        C
        C	THIS SOFTWARE IS FURNISHED UNDER  A LICENSE FOR USE ONLY  ON  A
        C	SINGLE COMPUTER SYSTEM AND MAY BE  COPIED ONLY WITH  THE INCLU-
        C	SION OF  THE  ABOVE  COPYRIGHT NOTICE.  THIS SOFTWARE,  OR  ANY
        C	OTHER COPIES THEREOF, MAY NOT BE  PROVIDED  OR  OTHERWISE  MADE
        C	AVAILABLE TO ANY OTHER PERSON EXCEPT  FOR  USE  ON  SUCH SYSTEM
        C	AND TO  ONE WHO AGREES  TO  THESE LICENSE  TERMS.  TITLE TO AND
        C	OWNERSHIP OF THE SOFTWARE SHALL AT ALL TIMES REMAIN IN DEC.
        C
        C	THE INFORMATION IN THIS SOFTWARE  IS  SUBJECT TO CHANGE WITHOUT
        C	NOTICE AND SHOULD NOT BE CONSTRUED  AS  A COMMITMENT BY DIGITAL
        C	EQUIPMENT CORPORATION.
        C
        C	DEC ASSUMES NO RESPONSIBILITY FOR THE USE OR RELIABILITY OF ITS
        C	SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DEC.
        C
        C
        C	K.D. MORSE  22-NOV-76
        C
        C
        C
        C
        C	THIS SUBROUTINE CREATES A SLP INPUT FILE TO CHANGE THE
        C	INPUT-FILE INTO THE COMPARE-FILE.
        C
        C
        C
        C
        C
        C  MODIFICATIONS:
        C
        C NO		DATE		PROGRAMMER		PURPOSE
        C --		-----		----------		-------
        C
        C
        C
        C
FORTRAN IV-PLUS V02-51D		02:46:38    22-AUG-78		PAGE 2   
SLP.FTN      	/TR:BLOCKS/WR

         
        C
        C
        C  VARIABLES:
        C
        C	CLUN--LOGICAL UNIT NUMBER FOR OPENING COMPARE FILE CHANNEL
        C	CNMLNG--LENGTH OF THE COMPARE FILE SPECIFICATION
        C	COMNAM--COMPARE FILE SPECIFICATION
        C	COMREC--I/O BUFFER FOR COMPARE FILE RECORDS
        C	CSTAT--INDICATOR OF TYPE OF CLOSE FOR COMPARE FILE LUN
        C	CTYPE--TYPE OF OPEN FOR COMPARE FILE (0=INPUT, 1=OUTPUT)
        C	IERR1--ERROR INDICATOR FROM FORTRAN ROUTINES
        C	IERR2--ERROR INDICATOR FROM MACRO ROUTINES
        C	ILUN--LOGICAL UNIT NUMBER FOR OPENING INPUT FILE CHANNEL
        C	INMLNG--LENGTH OF THE INPUT FILE SPECIFICATION
        C	INPNAM--ASCII INPUT FILE SPECIFICATION
        C	IRECNM--CURRENT INPUT FILE RECORD NUMBER
        C	IRECSZ--NUMBER OF CHARACTERS IN AN I/O BUFFER
        C	ISTAT--INDICATOR OF TYPE OF CLOSE FOR INPUT FILE CHANNEL
        C	ISUB--RECORD NUMBER OF THE INPUT RECORD BEING CURRECNTLY EXAMINED
        C	ISWTCH--VALUE OF SWITCHES SPECIFIED WITH INPUT FILE SPECIFICATION
        C	ITYPE--TYPE OF OPEN FOR INPUT FILE (0=INPUT, 1=OUTPUT)
        C	LENCOM--LENGTH OF COMPARE FILE RECORD
        C	LENINP--LENGTH OF INPUT FILE RECORD
        C	MAP--MAPPING TABLE OF COMPARE FILE RECORDS ONTO INPUT FILE
        C		RECORDS, AND INPUT FILE RECORDS ONTO COMPARE FILE RECORDS
        C	MAPEND--RECORD NUMBER OF LAST RECORD THAT CAN BE MAPPED IN
        C		THE MAP TABLE
        C	MAPMRK--POINTERS TO NEXT MAP FILE RECORD TO BE READ
        C	MAPNAM--NAME OF MAP FILE
        C	MAPTOP--RECORD NUMBER OF THE FIRST RECORD THAT CAN BE MAPPED IN
        C		THE MAP TABLE
        C	MLUN--MAP FILE LUN
        C	MNMLNG--LENGTH OF MAP FILE NAME
        C	NOW--CURRENT RECORD NUMBER
        C	OLUN--LOGICAL UNIT NUMBER FOR OPENING OUTPUT FILE CHANNEL
        C	ONMLNG--LENGTH OF THE OUTPUT FILE SPECIFICATION
        C	OSTAT--STATUS OF TYPE OF CLOSE FOR OUTPUT FILE CHANNEL
        C	RECORD--I/O BUFFER
        C
        C
FORTRAN IV-PLUS V02-51D		02:46:38    22-AUG-78		PAGE 3   
SLP.FTN      	/TR:BLOCKS/WR

         
0001    	SUBROUTINE SLP(ILUN,RECORD,LENINP,ISTAT,INPNAM,INMLNG,ITYPE,
        	1CLUN,CSTAT,COMREC,LENCOM,COMNAM,CNMLNG,CTYPE)
        C
        C
0002    	COMMON MAP(100,2),NUMLIN,MAPTOP(2),LSTMAP(2),MLUN,
        	1IHOLD(30,2),NINCOR,IFREE(2),IFIRST(2),LAST(2),MAXBUF,
        	2BUFR,ISWTCH,COMCHR,NSWVAL(10),LSTMAT(2),IRECSZ,
        	3MRKPNT(4,2),INOUT,MAPEND(2),LINSIZ,MAPNAM,MNMLNG,MTYPE,MSTAT
        	4,IERR1,IERR2,IKIND,OLUN,MAPMRK(3,2),MPRINT,BARCHR
        C
        C
0003    	DIMENSION NOW(2)
0004    	INTEGER OLUN,CLUN,CSTAT,CNMLNG,CTYPE,CPRNT
0005    	BYTE INPNAM(1),COMNAM(1),COMCHR(16),BUFR(7680,2),MAPNAM(12)
0006    	BYTE COMREC(1),RECORD(1),BARCHR
         
        C
        C	FORMAT STATEMENTS.
        C
0007    101	FORMAT('-',I5,',',I5)
0008    102	FORMAT('-',I5)
0009    103	FORMAT('/')
         
        C
        C	OPEN MAP, INPUT, AND COMPARE FILE.
        C
0010    	CALL OPNFIL(MAPNAM,MNMLNG,MLUN,RECORD,IRECSZ,MTYPE,IERR2)
0011    	IF (IERR2 .LE. 0) GOTO 924
0012    400	CALL OPNFIL(COMNAM,CNMLNG,CLUN,COMREC,IRECSZ,CTYPE,IERR2)
0013    	IF (IERR2 .LE. 0) GOTO 920
        C
        C	INITIALIZE RECORD NUMBERS AND COUNTERS.
        C
0014    	NOW(1)=1
0015    	NOW(2)=1
0016    	CPRNT=0
0017    	IPRNT=0
        C
        C	READ A BUFFER'S WORTH OF OF THE NON-SLP-INPUT FILE.
        C
0018    	CALL FILBUF(CLUN,COMREC,LENCOM,CSTAT,COMNAM,CNMLNG,CTYPE)
0019    	IF (IERR2 .EQ. 0) GOTO 360
0020    	IF (IERR1 .LT. 0) GOTO 1000
0021    360	IERR1=1
0022    	CALL MRKREC(MLUN,MAPMRK(1,1),IERR2)
0023    	IF (IERR2 .LE. 0) GOTO 927
        C
        C	MARK THE MAP FILE FOR THE NEXT READ FOR INPUT MAPPING VALUES AND
        C	COMPARE MAPPING VALUES.
        C
0024    	CALL MRKREC(MLUN,MAPMRK(1,2),IERR2)
0025    	IF (IERR2 .LE. 0) GOTO 927
0026    	ISUB=1
        C
        C	GET A TABLE'S WORTH OF INPUT MAPPING VALUES AND COMPARE MAPPING
FORTRAN IV-PLUS V02-51D		02:46:38    22-AUG-78		PAGE 4   
SLP.FTN      	/TR:BLOCKS/WR

        C	VALUES.
        C
0027    410	CALL READMP(ISUB)
0028    	IF (IERR2 .EQ. 0) GOTO 470
0029    	IF (IERR1 .LT. 0) GOTO 1000
0030    	ISUB=2
0031    	CALL READMP(ISUB)
0032    	IF (IERR2 .EQ. 0) GOTO 460
0033    	IF (IERR1 .LT. 0) GOTO 1000
        C
        C	CHECK IF A DIFFERENCE OCCURRED.
        C
0034    415	IF (NOW(1) .LE. MAPEND(1)) GOTO 420
0035    	ISUB=1
0036    	CALL READMP(ISUB)
0037    	IF (IERR2 .EQ. 0) GOTO 470
0038    	IF (IERR1 .LT. 0) GOTO 1000
0039    420	IF (NOW(2) .LE. MAPEND(2)) GOTO 425
0040    	ISUB=2
0041    	CALL READMP(ISUB)
0042    	IF (IERR2 .EQ. 0) GOTO 460
0043    	IF (IERR1 .LT. 0) GOTO 1000
0044    425	IF ((MAP(NOW(1)-MAPTOP(1)+1,1) .EQ. 0) .OR.
        	1(MAP(NOW(2)-MAPTOP(2)+1,2) .EQ. 0)) GOTO 430
0045    	IF (MAP(NOW(1)-MAPTOP(1)+1,1) .GE. 0) GOTO 416
0046    	NOW(1)=NOW(1)+1
0047    	IF (MAP(NOW(2)-MAPTOP(2)+1,2) .GE. 0) GOTO 415
0048    	NOW(2)=NOW(2)+1
0049    	GOTO 415
0050    416	IF (MAP(NOW(1)-MAPTOP(1)+1,1) .GE. 0) GOTO 417
0051    	NOW(2)=NOW(2)+1
0052    	GOTO 415
        C
        C	NO DIFFERENCE, INCREMENT TO NEXT SEQUENTIAL RECORD.
        C
0053    417	NOW(1)=NOW(1)+1
0054    	NOW(2)=NOW(2)+1
0055    	GOTO 415
        C
        C	WRITE OUT SLP COMMAND LINES.
        C
0056    430	ISUB=1
        C
        C	WRITE COMMANDS TO DELETE LINES, I.E., IF THE MAP VALUE IS ZERO.
        C	IF IT IS NON-ZERO, JUST USE THE LINE NUMBER TO POSITION THE FILE.
        C
        C
0057    435	IF (MAP(NOW(1)-MAPTOP(1)+1,1) .EQ. 0) WRITE(OLUN,101,ERR=918)
        	1NOW(1),NOW(1)
0058    	IF ((MAP(NOW(1)-MAPTOP(1)+1,1) .GT. 0) .AND. (NOW(1)-1 .GT. 0))
        	1 WRITE(OLUN,102,ERR=918)NOW(1)-1
0059    	NOW(1)=NOW(1)+1
0060    	IF (NOW(1) .LE. MAPEND(1)) GOTO 438
0061    	CALL READMP(ISUB)
0062    	IF (IERR2 .EQ. 0) GOTO 470
0063    	IF (IERR1 .LT. 0) GOTO 1000
FORTRAN IV-PLUS V02-51D		02:46:38    22-AUG-78		PAGE 5   
SLP.FTN      	/TR:BLOCKS/WR

        C
        C	CONTINUE IF THERE ARE MORE RECORDS TO DELETE.
        C
0064    438	IF (MAP(NOW(1)-MAPTOP(1)+1,1) .EQ. 0)GOTO 435
        C
        C	NOW WRITE THE LINES TO BE INSERTED, I.E., THOSE WITH A MAP VALUE
        C	OF ZERO.
        C
0065    440	ISUB=2
0066    445	IF (MAP(NOW(2)-MAPTOP(2)+1,2) .NE. 0) GOTO 415
0067    	LSTMAT(2)=NOW(2)-1
0068    	CALL SLPOUT(CLUN,RECORD,LENINP,CSTAT,COMNAM,CNMLNG,CTYPE,NOW(2))
0069    	IF (NOW(2) .EQ. 0) GOTO 460
0070    	IF (IERR1 .LT. 0) GOTO 1000
0071    447	NOW(2)=NOW(2)+1
0072    	IF (NOW(2) .LE. MAPEND(2)) GOTO 448
0073    	CALL READMP(ISUB)
0074    	IF (IERR2 .EQ. 0) GOTO 460
0075    	IF (IERR1 .LT. 0) GOTO 1000
0076    448	IF (MAP(NOW(2)-MAPTOP(2)+1,2) .EQ. 0)GOTO 445
        C
        C	DONE WRITING RECORDS TO INSERT.
        C
0077    450	GOTO 415
        C
        C	WRITE REST OF SLP COMMAND LINES.
        C
0078    460	IERR1=1
0079    	ISUB=1
0080    462	IF (NOW(1) .LE. MAPEND(1)) GOTO 465
0081    	CALL READMP(ISUB)
0082    	IF (IERR2 .EQ. 0) GOTO 480
0083    	IF (IERR1 .LT. 0) GOTO 1000
0084    465	IF (MAP(NOW(1)-MAPTOP(1)+1,1) .EQ. 0)WRITE(OLUN,101,ERR=918)
        	1NOW(1),NOW(1)
0085    	NOW(1)=NOW(1)+1
0086    	GOTO 462
        C
        C	WRITE REST OF COMPARE FILE LINES TO INSERT.
        C
0087    470	IERR1=1
0088    	ISUB=2
0089    472	IF (NOW(2) .LE. MAPEND(2)) GOTO 473
0090    	CALL READMP(ISUB)
0091    	IF (IERR2 .EQ. 0) GOTO 480
0092    	IF (IERR1 .LT. 0) GOTO 1000
0093    473	IF (MAP(NOW(2)-MAPTOP(2)+1,2) .NE. 0) GOTO 475
0094    	CALL SLPOUT(CLUN,RECORD,LENINP,CSTAT,COMNAM,CNMLNG,CTYPE,NOW(2))
0095    	IF (NOW(2) .EQ. 0) GOTO 480
0096    	IF (IERR1 .LT. 0) GOTO 1000
0097    	LSTMAT(2)=NOW(2)-1
0098    475	NOW(2)=NOW(2)+1
0099    	GOTO 472
        C
        C	CLOSE ALL FILES.
        C
FORTRAN IV-PLUS V02-51D		02:46:38    22-AUG-78		PAGE 6   
SLP.FTN      	/TR:BLOCKS/WR

0100    480	IERR1=1
0101    490	CALL CLSFIL(CLUN,CSTAT,IERR2)
0102    	IF (IERR2 .LE. 0) GOTO 921
0103    	GOTO 1000
        C
        C	ERROR CODES
        C
        C	OUTPUT FILE:
        C
        C		-18 = READ/WRITE ERROR
        C
        C	COMPARE FILE:
        C
        C		-20 = OPEN ERROR
        C		-21 = CLOSE ERROR
        C	MAP FILE:
        C
        C		-24 = OPEN ERROR
        C		-25 = CLOSE ERROR
        C		-27 = MARK/POINT ERROR
        C
0104    918	IERR1=-18
0105    	GOTO 1010
0106    920	IERR1=-8-CLUN*4
0107    	GOTO 1000
0108    921	IERR1=-9-CLUN*4
0109    	GOTO 1000
0110    924	IERR1=-24
0111    	GOTO 1010
0112    925	IERR1=-25
0113    	GOTO 1010
0114    927	IERR1=-27
0115    	GOTO 1000
0116    1000	WRITE(OLUN,103,ERR=918)
0117    	CALL CLSFIL(MLUN,MSTAT,IERR2)
0118    	IF (IERR2 .LE. 0) GOTO 925
0119    1010	RETURN
0120    	END
FORTRAN IV-PLUS V02-51D		02:46:38    22-AUG-78		PAGE 7   
SLP.FTN      	/TR:BLOCKS/WR

PROGRAM SECTIONS

NUMBER	 NAME	    SIZE		ATTRIBUTES

  1	$CODE1	002654   726		RW,I,CON,LCL
  3	$IDATA	000242    81		RW,D,CON,LCL
  4	$VARS	000012     5		RW,D,CON,LCL
  6	.$$$$.	037222  8009		RW,D,OVR,GBL


ENTRY POINTS

 NAME   TYPE  ADDRESS    NAME   TYPE  ADDRESS    NAME   TYPE  ADDRESS    NAME   TYPE  ADDRESS    NAME   TYPE  ADDRESS   

 SLP	      1-000000


VARIABLES

 NAME   TYPE  ADDRESS    NAME   TYPE  ADDRESS    NAME   TYPE  ADDRESS    NAME   TYPE  ADDRESS    NAME   TYPE  ADDRESS   

 BARCHR	L*1   6-037220	 CLUN	I*2   F-000020*	 CNMLNG	I*2   F-000032*	 CPRNT	I*2   4-000004	 CSTAT	I*2   F-000022*
 CTYPE	I*2   F-000034*	 IERR1	I*2   6-037172	 IERR2	I*2   6-037174	 IKIND	I*2   6-037176	 ILUN	I*2   F-000002*
 INMLNG	I*2   F-000014*	 INOUT	I*2   6-037140	 IPRNT	I*2   4-000006	 IRECSZ	I*2   6-037116	 ISTAT	I*2   F-000010*
 ISUB	I*2   4-000010	 ISWTCH	I*2   6-037044	 ITYPE	I*2   F-000016*	 LENCOM	I*2   F-000026*	 LENINP	I*2   F-000006*
 LINSIZ	I*2   6-037146	 MAXBUF	I*2   6-001042	 MLUN	I*2   6-000632	 MNMLNG	I*2   6-037164	 MPRINT	I*2   6-037216
 MSTAT	I*2   6-037170	 MTYPE	I*2   6-037166	 NINCOR	I*2   6-001024	 NUMLIN	I*2   6-000620	 OLUN	I*2   6-037200


ARRAYS

 NAME   TYPE  ADDRESS	    SIZE 	DIMENSIONS

 BUFR	L*1   6-001044	036000  7680	(7680,2)
 COMCHR	L*1   6-037046	000020     8	(16)
 COMNAM	L*1   F-000030*	000001     0	(1)
 COMREC	L*1   F-000024*	000001     0	(1)
 IFIRST	I*2   6-001032	000004     2	(2)
 IFREE	I*2   6-001026	000004     2	(2)
 IHOLD	I*2   6-000634	000170    60	(30,2)
 INPNAM	L*1   F-000012*	000001     0	(1)
 LAST	I*2   6-001036	000004     2	(2)
 LSTMAP	I*2   6-000626	000004     2	(2)
 LSTMAT	I*2   6-037112	000004     2	(2)
 MAP	I*2   6-000000	000620   200	(100,2)
 MAPEND	I*2   6-037142	000004     2	(2)
 MAPMRK	I*2   6-037202	000014     6	(3,2)
 MAPNAM	L*1   6-037150	000014     6	(12)
 MAPTOP	I*2   6-000622	000004     2	(2)
 MRKPNT	I*2   6-037120	000020     8	(4,2)
 NOW	I*2   4-000000	000004     2	(2)
 NSWVAL	I*2   6-037066	000024    10	(10)
 RECORD	L*1   F-000004*	000001     0	(1)


LABELS
FORTRAN IV-PLUS V02-51D		02:46:38    22-AUG-78		PAGE 8   
SLP.FTN      	/TR:BLOCKS/WR


 LABEL   ADDRESS 	 LABEL   ADDRESS 	 LABEL   ADDRESS 	 LABEL   ADDRESS 	 LABEL   ADDRESS 	

 101'	 3-000000	 102'	 3-000012	 103'	 3-000020	 360	 1-000362	 400	    **   
 410	    **   	 415	 1-000566	 416	 1-001046	 417	 1-001102	 420	 1-000652
 425	 1-000736	 430	 1-001122	 435	 1-001136	 438	 1-001366	 440	    **   
 445	 1-001422	 447	    **   	 448	 1-001644	 450	    **   	 460	 1-001676
 462	 1-001720	 465	 1-001772	 470	 1-002074	 472	 1-002116	 473	 1-002170
 475	 1-002332	 480	 1-002346	 490	    **   	 918	 1-002422	 920	 1-002440
 921	 1-002472	 924	 1-002524	 925	 1-002542	 927	 1-002560	 1000	 1-002574
 1010	 1-002652


FUNCTIONS AND SUBROUTINES REFERENCED

 CLSFIL	 FILBUF	 MRKREC	 OPNFIL	 READMP	 SLPOUT


TOTAL SPACE ALLOCATED = 042352  8821

NO FPP INSTRUCTIONS GENERATED

OBJ$:SLP,LIS$:SLP/-SP=SRC$:SLP
