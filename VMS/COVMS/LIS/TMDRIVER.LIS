TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page   0
TABLE OF CONTENTS   

   (1)     375  TE16/TU77 FUNCTION DECISION TABLE
   (1)     461  CANCEL I/O ON CHANNEL
   (1)     501  START I/O OPERATION
   (1)     662  WRITE TAPE MARK FUNCTION
   (1)     713  ERASE TAPE FUNCTION
   (1)     763  HOUSEKEEPING FUNCTIONS
   (1)     857  REWIND AND UNLOAD FUNCTIONS
   (1)     906  SPACING FUNCTIONS
   (1)    1135  READ DATA FORWARD AND WRITECHECK DATA FORWARD F
   (1)    1271  READ DATA REVERSE AND WRITECHECK DATA REVERSE F
   (1)    1415  WRITE DATA FORWARD FUNCTION
   (1)    1481  CHECK FOR FATAL OR RETRIABLE SPACING ERROR
   (1)    1555  TEST FOR REMAINING RETRIES
   (1)    1619  TAPE POSITION LOST
   (1)    1695  FUNCTION COMPLETION COMMON EXIT
   (1)    1783  TM03-TE16/TU77 HARDWARE FUNCTION EXECUTION
   (1)    2103  TM03-TE16/TU77 REGISTER DUMP ROUTINE
   (1)    2147  TM03-TE16/TU77 SLAVE CONTROLLER INTERRUPT DISPA
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page   1
01                                                                                                                               (1)

                                     0000     1 	.TITLE	TMDRIVER - TM03-TE16/TU77 MAGTAPE DRIVER
                                     0000     2 	.IDENT	/01/
                                     0000     3  
                                     0000     4 ;
                                     0000     5 ; COPYRIGHT (C) 1977
                                     0000     6 ; DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASS.
                                     0000     7 ;
                                     0000     8 ; THIS SOFTWARE IS FURNISHED UNDER  A LICENSE FOR USE ONLY  ON  A
                                     0000     9 ; SINGLE COMPUTER SYSTEM AND MAY BE  COPIED ONLY WITH  THE INCLU-
                                     0000    10 ; SION OF  THE  ABOVE  COPYRIGHT NOTICE.  THIS SOFTWARE,  OR  ANY
                                     0000    11 ; OTHER COPIES THEREOF, MAY NOT BE  PROVIDED  OR  OTHERWISE  MADE
                                     0000    12 ; AVAILABLE TO ANY OTHER PERSON EXCEPT  FOR  USE  ON  SUCH SYSTEM
                                     0000    13 ; AND TO  ONE WHO AGREES  TO  THESE LICENSE  TERMS.  TITLE TO AND
                                     0000    14 ; OWNERSHIP OF THE SOFTWARE SHALL AT ALL TIMES REMAIN IN DEC.
                                     0000    15 ;
                                     0000    16 ; THE INFORMATION IN THIS SOFTWARE  IS  SUBJECT TO CHANGE WITHOUT
                                     0000    17 ; NOTICE AND SHOULD NOT BE CONSTRUED  AS  A COMMITMENT BY DIGITAL
                                     0000    18 ; EQUIPMENT CORPORATION.
                                     0000    19 ;
                                     0000    20 ; DEC ASSUMES NO RESPONSIBILITY FOR THE USE OR RELIABILITY OF ITS
                                     0000    21 ; SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DEC.
                                     0000    22 ;
                                     0000    23 ; D. N. CUTLER 20-JUN-77
                                     0000    24 ;
                                     0000    25 ; TM03-TE16/TU77 MAGTAPE DRIVER
                                     0000    26 ;
                                     0000    27 ; MACRO LIBRARY CALLS
                                     0000    28 ;
                                     0000    29  
                                     0000    30 	$CRBDEF				;DEFINE CRB OFFSETS
                                     0000    31 	$DDBDEF				;DEFINE DDB OFFSETS
                                     0000    32 	$DDTDEF				;DEFINE DDT OFFSETS
                                     0000    33 	$EMBDEF				;DEFINE EMB OFFSETS
                                     0000    34 	$IDBDEF				;DEFINE IDB OFFSETS
                                     0000    35 	$IODEF				;DEFINE I/O FUNCTION CODES
                                     0000    36 	$IRPDEF				;DEFINE IRP OFFSETS
                                     0000    37 	$MBADEF				;DEFINE MBA REGISTER OFFSETS
                                     0000    38 	$MTDEF				;DEFINE MAGTAPE STATUS BITS
                                     0000    39 	$PRDEF				;DEFINE PROCESSOR REGISTERS
                                     0000    40 	$UCBDEF				;DEFINE UCB OFFSETS
                                     0000    41 ;	$VCBDEF				;DEFINE VCB OFFSETS
                                     0000    42 	$VECDEF				;DEFINE INTERRUPT DISPATCH VECTOR OFFSETS
                                     0000    43 	$WCBDEF				;DEFINE WCB OFFSETS
                                     0000    44  
                                     0000    45 ;
                                     0000    46 ; LOCAL MACROS
                                     0000    47 ;
                                     0000    48 ; CHECK FOR FATAL OR RETRIABLE ERROR
                                     0000    49 ;
                                     0000    50  
                                     0000    51 	.MACRO	CHECK_ERROR
                                     0000    52 		BSBW	CHECK_ERROR
                                     0000    53 	.ENDM	CHECK_ERROR
                                     0000    54  
                                     0000    55 ;
                                     0000    56 ; EXECUTE FUNCTION AND BRANCH ON RETRIABLE ERROR CONDITION
                                     0000    57 ;
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page   2
01                                                                                                                               (1)

                                     0000    58  
                                     0000    59 	.MACRO	EXFUNC BDST,FCODE
                                     0000    60 		.IF NB	FCODE
                                     0000    61 		MOVZBL	#CD'FCODE,R0
                                     0000    62 		.ENDC
                                     0000    63 		BSBW	FEX
                                     0000    64 		.WORD	BDST-.-2
                                     0000    65 	.ENDM	EXFUNC
                                     0000    66  
                                     0000    67 ;
                                     0000    68 ; GENERATE FUNCTION TABLE ENTRY AND CASE TABLE INDEX SYMBOL
                                     0000    69 ;
                                     0000    70  
                                     0000    71 	.MACRO	GENF FCODE
                                     0000    72 		CD'FCODE=.-FTAB
                                     0000    73 		.BYTE	FCODE!MT_CS1_M_GO
                                     0000    74 	.ENDM	GENF
                                     0000    75  
                                     0000    76 ;
                                     0000    77 ; GENERATE ERROR MASK TABLE ENTRY
                                     0000    78 ;
                                     0000    79  
                                     0000    80 	.MACRO	MASK LIST
                                     0000    81 $.$=0
                                     0000    82 	.IRP	X,<LIST>
                                     0000    83 $.$=$.$!MT_ER_M_'X
                                     0000    84 	.ENDM
                                     0000    85 	.WORD	$.$
                                     0000    86 	.ENDM	MASK
                                     0000    87  
                                     0000    88 ;
                                     0000    89 ; TEST IF ANY RETRIES REMAINING
                                     0000    90 ;
                                     0000    91  
                                     0000    92 	.MACRO	TESTR BDST
                                     0000    93 		BSBW	TESTR
                                     0000    94 		.WORD	BDST-.-2
                                     0000    95 	.ENDM	TESTR
                                     0000    96  
                                     0000    97 ;
                                     0000    98 ; LOCAL SYMBOLS
                                     0000    99 ;
                                     0000   100 ; TE16/TU77 MASSBUS REGISTER OFFSETS
                                     0000   101 ;
                                     0000   102  
                                     0000   103 	$DEFINI	MT
                                     0000   104  
                                     0000   105 $DEF	MT_CS1		.BLKL	1	;DRIVE CONTROL REGISTER
                                     0004   106 	_VIELD	MT_CS1,0,<-		; DRIVE CONTROL REGISTER BIT DEFINITIONS
                                     0004   107 		<GO,,M>,-		; GO BIT
                                     0004   108 		<FCODE,5>-		; FUNCTION CODE
                                     0004   109 	>				;
                                     0004   110 $DEF	MT_DS		.BLKL	1	;DRIVE STATUS REGISTER
                                     0008   111 	_VIELD	MT_DS,0,<-		; DRIVE STATUS REGISTER BIT DEFINITIONS
                                     0008   112 		<SLA,,M>,-		; SLAVE ATTENTION
                                     0008   113 		<BOT,,M>,-		; BEGINNING OF TAPE
                                     0008   114 		<TM,,M>,-		; TAPE MARK
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page   3
01                                                                                                                               (1)

                                     0008   115 		<IDB,,M>,-		; IDENTIFICATION BURST
                                     0008   116 		<SDWN,,M>,-		; SLOWING DOWN
                                     0008   117 		<PES,,M>,-		; PHASE ENCODED
                                     0008   118 		<SSC,,M>,-		; SLAVE STATUS CHANGE
                                     0008   119 		<DRY,,M>,-		; DRIVE READY
                                     0008   120 		<DPR,,M>,-		; DRIVE PRESENT
                                     0008   121 		<,1>,-			; RESERVED BIT
                                     0008   122 		<EOT,,M>,-		; END OF TAPE
                                     0008   123 		<WRL,,M>,-		; DRIVE WRITE LOCKED
                                     0008   124 		<MOL,,M>,-		; MEDIUM ONLINE
                                     0008   125 		<PIP,,M>,-		; POSITIONING IN PROGRESS
                                     0008   126 		<ERR,,M>,-		; COMPOSITE ERROR
                                     0008   127 		<ATA,,M>-		; ATTENTION ACTIVE
                                     0008   128 	>				;
                                     0008   129 $DEF	MT_ER		.BLKL	1	;ERROR REGISTER
                                     000C   130 	_VIELD	MT_ER,0,<-		; ERROR REGISTER BIT DEFINITIONS
                                     000C   131 		<ILF,,M>,-		; ILLEGAL FUNCTION
                                     000C   132 		<ILR,,M>,-		; ILLEGAL REGISTER
                                     000C   133 		<RMR,,M>,-		; REGISTER MODIFY REFUSED
                                     000C   134 		<CPAR,,M>,-		; CONTROL BUS PARITY ERROR
                                     000C   135 		<FMT,,M>,-		; FORMAT ERROR
                                     000C   136 		<DPAR,,M>,-		; DATA BUS PARITY ERROR
                                     000C   137 		<INC,0,M>,-		; INCORRECTABLE ERROR (PE)
                                     000C   138 		<VPE,,M>,-		; VERTICLE PARITY ERROR (NRZI)
                                     000C   139 		<PEF,0,M>,-		; FORMAT ERROR (PE)
                                     000C   140 		<LRC,,M>,-		; LONGITUDINAL PARITY ERROR (NRZI)
                                     000C   141 		<NSG,,M>,-		; NONSTANDARD GAP
                                     000C   142 		<FCE,,M>,-		; FRAME COUNT ERROR
                                     000C   143 		<CS,0,M>,-		; CORRECTABLE SKEW (PE)
                                     000C   144 		<ITM,,M>,-		; ILLEGAL TAPE MARK
                                     000C   145 		<NEF,,M>,-		; NONEXECUTABLE FUNCTION
                                     000C   146 		<DTE,,M>,-		; DRIVE TIMING ERROR
                                     000C   147 		<OPI,,M>,-		; OPERATION INCOMPLETE
                                     000C   148 		<UNS,,M>,-		; DRIVE UNSAFE
                                     000C   149 		<COR,0,M>,-		; CORRECTABLE DATA ERROR (PE)
                                     000C   150 		<CRC,,M>,-		; CRC ERROR (NRZI)
                                     000C   151 	>				;
                                     000C   152 $DEF	MT_MR		.BLKL	1	;MAINTENANCE REGISTER
                                     0010   153 $DEF	MT_AS		.BLKL	1	;ATTENTION SUMMARY REGISTER
                                     0014   154 $DEF	MT_FC		.BLKL	1	;FRAME COUNT REGISTER
                                     0018   155 $DEF	MT_DT		.BLKL	1	;DRIVE TYPE REGISTER
                                     001C   156 	_VIELD	MT_DT,0,<-		; DRIVE TYPE REGISTER FIELD DEFINITIONS
                                     001C   157 		<DTN,9>,-		; DRIVE TYPE NUMBER
                                     001C   158 		<,1>,-			; RESERVED BIT
                                     001C   159 		<SPR,,M>,-		; SLAVE PRESENT
                                     001C   160 		<DRQ,,M>,-		; DRIVE REQUEST REQUIRED (ALWAYS 0)
                                     001C   161 		<7CH,,M>,-		; 7-CHANNEL TAPE (ALWAYS 0)
                                     001C   162 		<MOH,,M>,-		; MOVING HEAD (ALWAYS 0)
                                     001C   163 		<TAP,,M>,-		; TAPE DRIVE (ALWAYS 1)
                                     001C   164 	>				;
                                     001C   165 $DEF	MT_CC		.BLKL	1	;CHECK CHARACTER REGISTER
                                     0020   166 $DEF	MT_SN		.BLKL	1	;SERIAL NUMBER REGISTER
                                     0024   167 $DEF	MT_TC		.BLKL	1	;MAGTAPE CONTROL REGISTER
                                     0028   168 	_VIELD	MT_TC,0,<-		; TAPE CONTROL REGISTER FIELD DEFFINITIONS
                                     0028   169 		<SSEL,3>,-		; SLAVE SELECT
                                     0028   170 		<EPAR,1,M>,-		; EVEN PARITY
                                     0028   171 		<FSEL,4,M>,-		; FORMAT SELECT
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page   4
01                                                                                                                               (1)

                                     0028   172 		<DEN,3,M>,-		; DENSITY
                                     0028   173 		<,1>,-			; RESERVED BIT
                                     0028   174 		<EABO,,M>,-		; ENABLE ABORT ON TRANSFER ERROR
                                     0028   175 		<TCW,,M>,-		; TAPE CONTROL WRITE
                                     0028   176 		<FCS,,M>,-		; FRAME COUNT STATUS
                                     0028   177 		<ACCL,,M>,-		; ACCELERATOR
                                     0028   178 	>				;
                                     0028   179  
                                     0028   180 	$DEFEND	MT
                                     0000   181  
                                     0000   182 ;
                                     0000   183 ; DEFINE DEVICE DEPENDENT UNIT CONTROL BLOCK OFFSETS
                                     0000   184 ;
                                     0000   185  
                                     0000   186 	$DEFINI	UCB,GLOBAL
                                     0000   187  
                           00000080  0000   188 .=UCB$L_DPC+4				;
                                     0080   189  
                                     0080   190 $DEF	UCB$L_MT_SR	.BLKL	1	;SAVED MBA STATUS REGISTER
                                     0084   191 $DEF	UCB$W_MT_DS	.BLKW	1	;SAVED DRIVE STATUS REGISTER
                                     0086   192 $DEF	UCB$W_MT_ER	.BLKW	1	;SAVED DRIVE ERROR REGISTER
                                     0088   193 $DEF	UCB$W_MT_FC	.BLKW	1	;SAVED DRIVE FRAME COUNT REGISTER
                                     008A   194 $DEF	UCB$W_MT_SPACNT	.BLKW	1	;CURRENT SPACING COUNT
                                     008C   195 $DEF	UCB$W_MT_CS1	.BLKW	1	;SAVED DRIVE CONTROL REGISTER
                                     008E   196 $DEF	UCB$W_MT_FUNC	.BLKW	1	;CURRENT FUNCTION CODE
                                     0090   197 $DEF	UCB$L_MT_RECORD	.BLKL	1	;CURRENT TAPE POSITION
                                     0094   198 $DEF	UCB$W_MT_FORCNT	.BLKW	1	;FORWARD SPACE COUNT DURING RETRY
                                     0096   199 $DEF	UCB$W_MT_TC	.BLKW	1	;TAPE CONTROL REGISTER CONTENTS
                                     0098   200 $DEF	UCB$W_MT_TC_SAV	.BLKW	1	;SAVED TAPE CONTROL REGISTER
                           0000009C  009A   201 			.BLKW	1	;SPARE UNUSED WORD
                                     009C   202  
                                     009C   203 	$DEFEND	UCB
                                     0000   204  
                                     0000   205 ;
                                     0000   206 ; MAXIMUM SPACING ON READ AND WRITECHECK ERRORS
                                     0000   207 ;
                                     0000   208  
                           00000005  0000   209 ERR_SPACING=5				;FIVE RECORDS
                                     0000   210  
                                     0000   211 ;
                                     0000   212 ; HARDWARE FUNCTION CODES
                                     0000   213 ;
                                     0000   214  
                           00000000  0000   215 F_NOP=0*2				;NO OPERATION
                           00000000  0000   216 F_SENSECHAR=0*2				;SENSE TAPE CHARACTERISTICS
                           00000000  0000   217 F_SETCHAR=0*2				;SET TAPE CHARACTERISTICS
                           00000002  0000   218 F_UNLOAD=1*2				;UNLOAD DRIVE
                           00000006  0000   219 F_REWIND=3*2				;REWIND
                           00000008  0000   220 F_DRVCLR=4*2				;DRIVE CLEAR
                           00000010  0000   221 F_READPRESET=8*2			;READ IN PRESET
                           00000014  0000   222 F_ERASE=10*2				;ERASE TAPE
                           00000016  0000   223 F_WRITEMARK=11*2			;WRITE TAPE MARK
                           00000018  0000   224 F_SPCFILFOR=12*2			;SPACE FILE FORWARD
                           0000001A  0000   225 F_SPCFILREV=13*2			;SPACE FILE REVERSE
                           00000018  0000   226 F_SPCRECFOR=12*2			;SPACE RECORD FORWARD
                           0000001A  0000   227 F_SPCRECREV=13*2			;SPACE RECORD REVERSE
                           00000028  0000   228 F_WRITECHECK=20*2			;WRITE CHECK DATA FORWARD
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page   5
01                                                                                                                               (1)

                           0000002E  0000   229 F_WRITECHECKR=23*2			;WRITE CHECK DATA REVERSE
                           00000030  0000   230 F_WRITE=24*2				;WRITE DATA FORWARD
                           00000030  0000   231 F_WRITEDATA=24*2			;WRITE DATA FORWARD
                           00000038  0000   232 F_READDATA=28*2				;READ DATA FORWARD
                           0000003E  0000   233 F_READDATAR=31*2			;READ DATA REVERSE
                                     0000   234  
                                     0000   235 ;
                                     0000   236 ; MINIMUM RECORD SIZE
                                     0000   237 ;
                                     0000   238  
                           0000000E  0000   239 MIN_RECORD=14				;FOURTEEN BYTES
                                     0000   240  
                                     0000   241 ;
                                     0000   242 ; HARWARE DENSITY DEFINITIONS
                                     0000   243 ;
                                     0000   244  
                           00000003  0000   245 NRZI=3					;800 BPI
                           00000004  0000   246 PE=4					;PHASE ENCODED
                                     0000   247  
                                     0000   248 ;
                                     0000   249 ; ERROR COUNT THRESHOLD BEFORE ALTERNATE RECOVERY ATTEMPTED
                                     0000   250 ;
                                     0000   251  
                           00000008  0000   252 THRESHOLD=8				;EIGHT RETRIES BEFORE ALTERNATE METHOD
                                     0000   253  
                                     0000   254 ;
                                     0000   255 ; LOCAL DATA
                                     0000   256 ;
                                     0000   257 ; DRIVER DISPATCH TABLE
                                     0000   258 ;
                                     0000   259  
                                 00000000   260 	.PSECT	WIONONPAGED
                                     0000   261 TM$DDT::				;ADDRESS OF DRIVER DISPATCH TABLE
                           0000016F' 0000   262 	.LONG	STARTIO			;START I/O OPERATION
                           00000AB6' 0004   263 	.LONG	UNSOLNT			;UNSOLICITED INTERRUPT
                           000000B9' 0008   264 	.LONG	FUNCTABLE		;FUNCTION DECISION TABLE
                           00000135' 000C   265 	.LONG	CANCELIO		;CANCEL I/O ENTRY POINT
                           00000A5F' 0010   266 	.LONG	REGDUMP			;REGISTER DUMP ROUTINE
                               0068' 0014   267 	.WORD	<MT_TC+4+MBA$L_BCR+4+8>+<<3+5+1>*4> ;SIZE OF DIAGNOSTIC BUFFER
                               0098' 0016   268 	.WORD	<MT_TC+4+MBA$L_BCR+4+8>+<1*4>+<EMB$L_DV_REGSAV> ;SIZE OF ERROR BUFFER
                           00000000  0018   269 	.LONG	0			; NO UNIT INTIALIZATION POINT
                                     001C   270  
                                     001C   271 ;
                                     001C   272 ; DENSITY CODE TRANSLATION TABLE
                                     001C   273 ;
                                     001C   274 ;	DENSITY CODES ARE TRANSLATED BY TAKING THE FIVE BIT ENCODED DENSITY
                                     001C   275 ;	VALUE, MULTIPLYING BY FOUR TO FORM THE STARTING BIT NUMBER, AND THEN
                                     001C   276 ;	EXTRACTING THE APPROPRIATE DENSITY CODE FROM THE TRANSLATION TABLE.
                                     001C   277 ;
                                     001C   278  
                                     001C   279 DENSITY:				;
                           33343333  001C   280 	.LONG	^X33343333		;DENSITY CODES 0-7
                           33333333  0020   281 	.LONG	^X33333333		;DENSITY CODES 8-15
                           33333333  0024   282 	.LONG	^X33333333		;DENSITY CODES 16-23
                           33333333  0028   283 	.LONG	^X33333333		;DENSITY CODES 24-31
                                     002C   284  
                                     002C   285 ;
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page   6
01                                                                                                                               (1)

                                     002C   286 ; HARDWARE I/O FUNCTION CODE TABLE
                                     002C   287 ;
                                     002C   288  
                                     002C   289 FTAB:					;
                                     002C   290 	GENF	F_NOP			;NO OPERATION
                                     002D   291 	GENF	F_UNLOAD		;UNLOAD VOLUME
                                     002E   292 	GENF	F_SPCFILFOR		;SPACE FILE FORWARD
                                     002F   293 	GENF	F_REWIND		;REWIND
                                     0030   294 	GENF	F_DRVCLR		;DRIVE CLEAR
                                     0031   295 	GENF	F_SPCFILREV		;SPACE FILE REVERSE
                                     0032   296 	GENF	F_ERASE			;ERASE TAPE
                                     0033   297 	GENF	F_SPCRECREV		;SPACE RECORD REVERSE
                                     0034   298 	GENF	F_SETCHAR		;SET TAPE CHARACTERISTICS
                                     0035   299 	GENF	F_SPCRECFOR		;SPACE RECORD FORWARD
                                     0036   300 	GENF	F_WRITECHECK		;WRITE CHECK FORWARD
                                     0037   301 	GENF	F_WRITEDATA		;WRITE DATA FORWARD
                                     0038   302 	GENF	F_READDATA		;READ DATA FORWARD
                                     0039   303 	GENF	F_WRITECHECKR		;WRITE CHECK REVERSE
                                     003A   304 	GENF	F_WRITE			;WRITE DATA FORWARD
                                     003B   305 	GENF	F_READDATAR		;READ DATA REVERSE
                                     003C   306 	GENF	F_READPRESET		;READ IN PRESET
                                     003D   307 	GENF	F_SENSECHAR		;SENSE TAPE CHARACTERISTICS
                                     003E   308 	GENF	F_WRITEMARK		;WRITE TAPE MARK
                                     003F   309  
                                     003F   310 ;
                                     003F   311 ; FORMAT CODE TRANSLATION TABLE
                                     003F   312 ;
                                     003F   313 ;	FORMAT CODES ARE TRANSLATED BY TAKING THE FOUR BIT ENCODED FORMAT VALUE,
                                     003F   314 ;	MULTIPLYING BY FOUR TO FORM THE STARTING BIT NUMBER, AND THEN EXTRACTING
                                     003F   315 ;	THE APPROPRIATE FORMAT CODE FROM THE TRANSLATION TABLE.
                                     003F   316 ;
                                     003F   317  
                                     003F   318 FORMAT:					;
                           CCCCCCCC  003F   319 	.LONG	^XCCCCCCCC		;FORMAT CODES 0-7
                           CEDCCCCC  0043   320 	.LONG	^XCEDCCCCC		;FORMAT CODES 8-15
                                     0047   321  
                                     0047   322 ;
                                     0047   323 ; FUNCTION TIME OUT TABLE
                                     0047   324 ;
                                     0047   325  
                                     0047   326 TIME_OUT:				;
                           00000000  0047   327 	.LONG	0			;NO OPERATION
                           00000006  004B   328 	.LONG	6			;UNLOAD VOLUME
                           00000258  004F   329 	.LONG	60*10			;SPACE FILE FORWARD
                           000001A4  0053   330 	.LONG	60*7			;REWIND
                           00000000  0057   331 	.LONG	0			;DRIVE CLEAR
                           00000258  005B   332 	.LONG	60*10			;SPACE FILE REVERSE
                           00000006  005F   333 	.LONG	6			;ERASE TAPE
                           00000258  0063   334 	.LONG	60*10			;SPACE RECORD REVERSE
                           00000000  0067   335 	.LONG	0			;SET TAPE CHARACTERISTICS
                           00000258  006B   336 	.LONG	60*10			;SPACE RECORD FORWARD
                           0000000C  006F   337 	.LONG	12			;WRITE CHECK DATA FORWARD
                           0000000C  0073   338 	.LONG	12			;WRITE DATA FORWARD
                           0000000C  0077   339 	.LONG	12			;READ DATA FORWARD
                           0000000C  007B   340 	.LONG	12			;WRITE CHECK DATA REVERSE
                           0000000C  007F   341 	.LONG	12			;WRITE DATA FORWARD
                           0000000C  0083   342 	.LONG	12			;READ DATA REVERSE
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page   7
01                                                                                                                               (1)

                           000001A4  0087   343 	.LONG	60*7			;READ IN PRESET
                           00000000  008B   344 	.LONG	0			;SENSE TAPE CHARACTERISITCS
                           00000006  008F   345 	.LONG	6			;WRITE TAPE MARK
                                     0093   346  
                                     0093   347 ;
                                     0093   348 ; DON'T CARE ERROR MASK TABLE
                                     0093   349 ;
                                     0093   350 ; THIS TABLE CONTAINS A MASK OF THE ERROR BITS THAT ARE TO BE IGNORED FOR EACH
                                     0093   351 ; FUNCTION WHEN EXAMINING THE DRIVE ERROR REGISTER.
                                     0093   352 ;
                                     0093   353  
                                     0093   354 XTAB:					;
                                     0093   355 	MASK	<FMT,DPAR,INC,PEF,NSG,FCE,CS,DTE,OPI,COR> ;NO-OP
                                     0095   356 	MASK	<FMT,DPAR,INC,PEF,NSG,FCE,CS,DTE,OPI,COR> ;UNLOAD
                                     0097   357 	MASK	<FMT,DPAR,INC,PEF,NSG,CS,DTE,COR> ;SPACE FILE FORWARD
                                     0099   358 	MASK	<FMT,DPAR,INC,PEF,NSG,FCE,CS,DTE,OPI,COR> ;REWIND
                                     009B   359 	MASK	<FMT,DPAR,INC,PEF,NSG,FCE,CS,NEF,DTE,OPI,COR> ;DRIVE CLEAR
                                     009D   360 	MASK	<FMT,DPAR,INC,PEF,NSG,CS,DTE,COR> ;SPACE FILE REVERSE
                                     009F   361 	MASK	<FMT,DPAR,INC,PEF,NSG,FCE,DTE,OPI,COR> ;ERASE
                                     00A1   362 	MASK	<FMT,DPAR,INC,PEF,NSG,CS,DTE,COR> ;SPACE RECORD REVERSE
                                     00A3   363 	MASK	<FMT,DPAR,INC,PEF,NSG,FCE,CS,DTE,OPI,COR> ;SET CHARACTERISTICS
                                     00A5   364 	MASK	<FMT,DPAR,INC,PEF,NSG,CS,DTE,COR> ;SPACE RECORD FORWARD
                                     00A7   365 	MASK	<DPAR>			;WRITE CHECK FORWARD
                                     00A9   366 	MASK	<>			;WRITE DATA FORWARD
                                     00AB   367 	MASK	<DPAR>			;READ DATA FORWARD
                                     00AD   368 	MASK	<DPAR>			;WRITE CHECK REVERSE
                                     00AF   369 	MASK	<>			;WRITE DATA FORWARD
                                     00B1   370 	MASK	<DPAR>			;READ DATA REVERSE
                                     00B3   371 	MASK	<FMT,DPAR,INC,PEF,NSG,FCE,CS,DTE,OPI,COR> ;READIN PRESET
                                     00B5   372 	MASK	<FMT,DPAR,INC,PEF,NSG,FCE,CS,DTE,OPI,COR> ;SENSE CHARACTERISTICS
                                     00B7   373 	MASK	<FMT,DPAR,FCE,DTE,COR>	;WRITE TAPE MARK
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page   8
01              TE16/TU77 FUNCTION DECISION TABLE                                                                                (1)

                                     00B9   375 	.SBTTL	TE16/TU77 FUNCTION DECISION TABLE
                                     00B9   376 ;+
                                     00B9   377 ; TE16/TU77 FUNCTION DECISION TABLE
                                     00B9   378 ;-
                                     00B9   379  
                                     00B9   380 FUNCTABLE:				;FUNCTION DECISION TABLE
                                     00B9   381 	FUNCTAB	,-			;LEGAL FUNCTIONS
                                     00B9   382 		<NOP,-			;NO OPERATION
                                     00B9   383 		 UNLOAD,-		;UNLOAD VOLUME
                                     00B9   384 		 SPACERECORD,-		;SPACE RECORDS
                                     00B9   385 		 RECAL,-		;RECALIBRATE (REWIND)
                                     00B9   386 		 DRVCLR,-		;DRIVE CLEAR
                                     00B9   387 		 READPRESET,-		;READ IN PRESET
                                     00B9   388 		 ERASETAPE,-		;ERASE TAPE
                                     00B9   389 		 SENSECHAR,-		;SENSE TAPE CHARACTERISTICS
                                     00B9   390 		 SETCHAR,-		;SET CHARACTERISTICS
                                     00B9   391 		 SPACEFILE,-		;SPACE FILE
                                     00B9   392 		 WRITECHECK,-		;WRITE CHECK FORWARD
                                     00B9   393 		 WRITEPBLK,-		;WRITE PHYSICAL BLOCK
                                     00B9   394 		 READPBLK,-		;READ PHYSICAL BLOCK
                                     00B9   395 		 WRITEMARK,-		;WRITE TAPE MARK
                                     00B9   396 		 READLBLK,-		;READ LOGICAL BLOCK
                                     00B9   397 		 WRITELBLK,-		;WRITE LOGICAL BLOCK
                                     00B9   398 		 SENSEMODE,-		;SENSE TAPE MODE
                                     00B9   399 		 SETMODE,-		;SET MODE
                                     00B9   400 		 REWIND,-		;REWIND
                                     00B9   401 		 REWINDOFF,-		;REWIND AND SET OFFLINE
                                     00B9   402 		 SKIPRECORD,-		;SKIP RECORDS
                                     00B9   403 		 SKIPFILE,-		;SKIP FILES
                                     00B9   404 		 WRITEOF,-		;WRITE END OF FILE
                                     00B9   405 		 READVBLK,-		;READ VIRTUAL BLOCK
                                     00B9   406 		 WRITEVBLK,-		;WRITE VIRTUAL BLOCK
                                     00B9   407 		 ACCESS,-		;ACCESS FILE AND/OR FIND DIRECTORY ENTRY
                                     00B9   408 		 ACPCONTROL,-		;ACP CONTROL FUNCTION
                                     00B9   409 		 CREATE,-		;CREATE FILE AND/OR CREATE DIRECTORY ENTRY
                                     00B9   410 		 DEACCESS,-		;DEACCESS FILE
                                     00B9   411 		 DELETE,-		;DELETE FILE AND/OR DIRECTORY ENTRY
                                     00B9   412 		 MODIFY>		;MODIFY FILE ATTRIBUTES
                                     00C1   413 	FUNCTAB	,-			;BUFFERED I/O FUNCTIONS
                                     00C1   414 		<ACCESS,-		;ACCESS FILE AND/OR FIND DIRECTORY ENTRY
                                     00C1   415 		 ACPCONTROL,-		;ACP CONTROL FUNCTION
                                     00C1   416 		 CREATE,-		;CREATE FILE AND/OR CREATE DIRECTORY ENTRY
                                     00C1   417 		 DEACCESS,-		;DEACCESS FILE
                                     00C1   418 		 DELETE,-		;DELETE FILE AND/OR DIRECTORY ENTRY
                                     00C1   419 		 MODIFY>		;MODIFY FILE ATTRIBUTES
                                     00C9   420 	FUNCTAB	ACP$READBLK,-		;READ FUNCTIONS
                                     00C9   421 		<READLBLK,-		;READ LOGICAL BLOCK FORWARD
                                     00C9   422 		 READPBLK,-		;READ PHYSICAL BLOCK FORWARD
                                     00C9   423 		 READVBLK>		;READ VIRTUAL BLOCK
                                     00D5   424 	FUNCTAB	ACP$WRITEBLK,-		;WRITE FUNCTIONS
                                     00D5   425 		<WRITECHECK,-		;WRITE CHECK FORWARD
                                     00D5   426 		 WRITELBLK,-		;WRITE LOGICAL BLOCK
                                     00D5   427 		 WRITEPBLK,-		;WRITE PHYSICAL BLOCK
                                     00D5   428 		 WRITEVBLK>		;WRITE VIRTUAL BLOCK
                                     00E1   429 	FUNCTAB	ACP$ACCESS,<ACCESS,CREATE> ;ACCESS AND CREATE FILE OR DIRECTORY
                                     00ED   430 	FUNCTAB	ACP$DEACCESS,<DEACCESS>	;DEACCESS FILE
                                     00F9   431 	FUNCTAB	ACP$MODIFY,-		;
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page   9
01              TE16/TU77 FUNCTION DECISION TABLE                                                                                (1)

                                     00F9   432 		<ACPCONTROL,-		;ACP CONTROL FUNCTION
                                     00F9   433 		 DELETE,-		;DELETE FILE OR DIRECTORY ENTRY
                                     00F9   434 		 MODIFY>		;MODIFY FILE ATTRIBUTES
                                     0105   435 	FUNCTAB	MT$CHECK_ACCESS,-	;MAGTAPE CHECK ACCESS FUNCTIONS
                                     0105   436 		<ERASETAPE,-		;ERASE TAPE
                                     0105   437 		 WRITEMARK,-		;WRITE TAPE MARK
                                     0105   438 		 WRITEOF>		;WRITE END OF FILE
                                     0111   439 	FUNCTAB	EXE$ZEROPARM,-		;ZERO PARAMETER FUNCTIONS
                                     0111   440 		<NOP,-			;NO OPERATION
                                     0111   441 		 UNLOAD,-		;UNLOAD VOLUME
                                     0111   442 		 RECAL,-		;RECALIBRATE (REWIND)
                                     0111   443 		 REWIND,-		;REWIND
                                     0111   444 		 REWINDOFF,-		;REWIND AND SET OFFLINE
                                     0111   445 		 DRVCLR,-		;DRIVE CLEAR
                                     0111   446 		 READPRESET,-		;READ IN PRESET
                                     0111   447 		 ERASETAPE,-		;ERASE TAPE
                                     0111   448 		 SENSECHAR,-		;SENSE TAPE CHARACTERISTICS
                                     0111   449 		 SENSEMODE,-		;SENSE TAPE MODE
                                     0111   450 		 WRITEMARK,-		;WRITE TAPE MARK
                                     0111   451 		 WRITEOF>		;WRITE END OF FILE
                                     011D   452 	FUNCTAB	EXE$ONEPARM,-		;ONE PARAMETER FUNCTIONS
                                     011D   453 		<SPACERECORD,-		;SPACE RECORDS
                                     011D   454 		 SPACEFILE,-		;SPACE FILES
                                     011D   455 		 SKIPRECORD,-		;SKIP RECORDS
                                     011D   456 		 SKIPFILE>		;SKIP FILES
                                     0129   457 	FUNCTAB	EXE$SETMODE,-		;SET TAPE CHARACTERISTICS
                                     0129   458 		<SETCHAR,-		;
                                     0129   459 		 SETMODE>		;
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page  10
01              CANCEL I/O ON CHANNEL                                                                                            (1)

                                     0135   461 	.SBTTL	CANCEL I/O ON CHANNEL
                                     0135   462 ;+
                                     0135   463 ; CANCELIO - CANCEL I/O ON CHANNEL
                                     0135   464 ;
                                     0135   465 ; THIS ROUTINE IS CALLED WHEN THE LAST CHANNEL ASSIGNED TO A DEVICE IS DEASSIGNED,
                                     0135   466 ; THE DEVICE IS DEALLOCATED, AND WHEN THE CANCEL I/O ON CHANNEL SYSTEM SERVICE IS
                                     0135   467 ; EXECUTED.
                                     0135   468 ;
                                     0135   469 ; INPUTS:
                                     0135   470 ;
                                     0135   471 ;	R2 = NEGATIVE CHANNEL NUMBER.
                                     0135   472 ;	R3 = ADDRESS OF CURRENT I/O REQUEST PACKET.
                                     0135   473 ;	R4 = CURRENT PROCESS PCB ADDRESS.
                                     0135   474 ;	R5 = DEVICE UCB ADDRESS.
                                     0135   475 ;
                                     0135   476 ; OUTPUTS:
                                     0135   477 ;
                                     0135   478 ;	IF THE DEVICE IS CURRENTLY BUSY, DOING A REWIND, AND IN A WAITFOR INTERRUPT
                                     0135   479 ;	STATE, THEN THE REWIND FUNCTION IS CANCELLED.
                                     0135   480 ;-
                                     0135   481  
                                     0135   482 CANCELIO:				;CANCEL I/O ON CHANNEL
                          FEC8'  30  0135   483 	BSBW	IOC$CANCELIO		;TEST IF FUNCTION SHOULD BE CANCELLED
         58 A5            03     E1  0138   484 	BBC	#UCB$V_CANCEL,UCB$W_STS(R5),30$ ;IF CLR, NO CANCEL PENDING
                          31         013C       
                                     013D   485 	DSBINT	UCB$B_DIPL(R5)		;RAISE TO DEVICE INTERRUPT LEVEL
         77 A5            03     91  0144   486 	CMPB	#CDF_REWIND,UCB$B_CEX(R5) ;REWIND IN PROGRESS?
                          06     13  0148   487 	BEQL	10$			;IF EQL YES
         77 A5            10     91  014A   488 	CMPB	#CDF_READPRESET,UCB$B_CEX(R5) ;READIN PRESET?
                          1B     12  014E   489 	BNEQ	20$			;IF NEQ NO
         58 A5            03     B3  0150   490 10$:	BITW	#UCB$M_INT!UCB$M_TIM,UCB$W_STS(R5) ;INTERRUPT OR TIMEOUT EXPECTED?
                          15     13  0154   491 	BEQL	20$			;IF EQL NO
         58 A5            03     AA  0156   492 	BICW	#UCB$M_INT!UCB$M_TIM,UCB$W_STS(R5) ;CLEAR INTERRUPT AND TIMEOUT EXPECTED
                                     015A   493 	SETIPL	UCB$B_FIPL(R5)		;LOWER TO FORK LEVEL
            50       0000'8F     3C  015E   494 	MOVZWL	#SS$_ABORT,R0		;SET ABORT STATUS
                          54     DD  0163   495 	PUSHL	R4			;SAVE CURRENT PROCESS PCB ADDRESS
                          06D0   30  0165   496 	BSBW	STSXIT			;FINISH I/O OPERATION
                          54   8ED0  0168   497 	POPL	R4			;RESTORE CURRENT PROCESS PCB ADDRESS
                                     016B   498 20$:	ENBINT				;LOWER TO FORK LEVEL
                                 05  016E   499 30$:	RSB				;
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page  11
01              START I/O OPERATION                                                                                              (1)

                                     016F   501 	.SBTTL	START I/O OPERATION
                                     016F   502 ;+
                                     016F   503 ; STARTIO - START I/O OPERATION ON DEVICE UNIT
                                     016F   504 ;
                                     016F   505 ; THIS ENTRY POINT IS ENTERED TO START AN I/O OPERATION ON A DEVICE UNIT.
                                     016F   506 ;
                                     016F   507 ; INPUTS:
                                     016F   508 ;
                                     016F   509 ;	R3 = ADDRESS OF I/O PACKET.
                                     016F   510 ;	R5 = UCB ADDRESS OF DEVICE UNIT.
                                     016F   511 ;
                                     016F   512 ; OUTPUTS:
                                     016F   513 ;
                                     016F   514 ;	******OUTPUTS*******
                                     016F   515 ;-
                                     016F   516  
                                     016F   517 STARTIO:				;START I/O OPERATION
         70 A5         71 A5     90  016F   518 	MOVB	UCB$B_ERTMAX(R5),UCB$B_ERTCNT(R5) ;INITIALIZE ERROR RETRY COUNT
       008E C5         20 A3     B0  0174   519 	MOVW	IRP$W_FUNC(R3),UCB$W_MT_FUNC(R5) ;SAVE FUNCTION CODE AND MODIFIERS
       008A C5            01     AE  017A   520 	MNEGW	#1,UCB$W_MT_SPACNT(R5)	;SET DEFAULT SPACING COUNT
            50         34 A3     D0  017F   521 	MOVL	IRP$L_MEDIA(R3),R0	;GET PARAMETER LONGWORD
                                     0183   522  
                                     0183   523 ;
                                     0183   524 ; MOVE FUNCTION DEPENDENT PARAMETERS TO UCB
                                     0183   525 ;
                                     0183   526  
                          00     EF  0183   527 	EXTZV	#IRP$V_FCODE,#IRP$S_FCODE,- ;EXTRACT I/O FUNCTION CODE
         20 A3            06         0185   528 		IRP$W_FUNC(R3),R1	;
                          51         0188       
            51            02     D1  0189   529 	CMPL	#IO$_SPACEFILE,R1	;SPACE FILE FUNCTION?
                          26     13  018C   530 	BEQL	10$			;IF EQL YES
            51            09     D1  018E   531 	CMPL	#IO$_SPACERECORD,R1	;SPACE RECORD FUNCTION?
                          31     13  0191   532 	BEQL	20$			;IF EQL YES
            51            1A     D1  0193   533 	CMPL	#IO$_SETCHAR,R1		;SET CHARACTERISTICS FUNCTION?
                          50     13  0196   534 	BEQL	50$			;IF EQL YES
            51            0D     D1  0198   535 	CMPL	#IO$_READPBLK+1,R1	;DISJOINT FUNCTION CODE?
                          6E     1A  019B   536 	BGTRU	100$			;IF GTRU NO
                                     019D   537 	CASE	R1,<-			;DISPATCH LOGICAL FUNCTIONS
                                     019D   538 		70$,-			;REWIND AND SET OFFLINE
                                     019D   539 		60$,-			;SET MODE
                                     019D   540 		80$,-			;REWIND
                                     019D   541 		10$,-			;SKIP FILE
                                     019D   542 		20$,-			;SKIP RECORD
                                     019D   543 		90$,-			;SENSE TAPE MODE
                                     019D   544 		90$,-			;WRITE EOF
                                     019D   545 		>,LIMIT=#IO$_REWINDOFF ;
            51            09     A2  01AF   546 	SUBW	#IO$_READPRESET-IO$_READPBLK-4,R1 ;CONVERT TO DENSE FUNCTION CODE
                          65     11  01B2   547 	BRB	110$			;
                                     01B4   548  
                                     01B4   549 ;
                                     01B4   550 ; SPACE FILE FUNCTION - SET SPACE COUNT AND PROPER FUNCTION
                                     01B4   551 ;
                                     01B4   552  
            51            02     9A  01B4   553 10$:	MOVZBL	#CDF_SPCFILFOR,R1	;SET FOR SPACE FILE FORWARD
                     008A C5     B6  01B7   554 	INCW	UCB$W_MT_SPACNT(R5)	;SET DEFAULT SPACING COUNT TO LARGEST VALUE
                          50     B5  01BB   555 	TSTW	R0			;SPACE FILE FORWARD?
                          1A     14  01BD   556 	BGTR	40$			;IF GTR YES
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page  12
01              START I/O OPERATION                                                                                              (1)

            51            05     9A  01BF   557 	MOVZBL	#CDF_SPCFILREV,R1	;SET FOR SPACE FILE REVERSE
                          12     11  01C2   558 	BRB	30$			;
                                     01C4   559  
                                     01C4   560 ;
                                     01C4   561 ; SPACE RECORD FUNCTION - SET SPACE COUNT AND PROPER FUNCTION
                                     01C4   562 ;
                                     01C4   563  
            51            09     9A  01C4   564 20$:	MOVZBL	#CDF_SPCRECFOR,R1	;SET FOR SPACE RECORD FORWARD
       008A C5            50     AE  01C7   565 	MNEGW	R0,UCB$W_MT_SPACNT(R5)	;SET SPACING COUNT
                          0B     19  01CC   566 	BLSS	40$			;IF LSS SPACE FORWARD FUNCTION
            51            07     9A  01CE   567 	MOVZBL	#CDF_SPCRECREV,R1	;SET FOR SPACE RECORD REVERSE
       008A C5            50     B0  01D1   568 	MOVW	R0,UCB$W_MT_SPACNT(R5)	;SET SPACING COUNT
            50            50     AE  01D6   569 30$:	MNEGW	R0,R0			;CONVERT TO POSITIVE COUNT
         6C A5            50     B0  01D9   570 40$:	MOVW	R0,UCB$W_BOFF(R5)	;SET SPACE COUNT
         6E A5            50     B0  01DD   571 	MOVW	R0,UCB$W_BCNT(R5)	;SET SPACE COUNT
                          36     12  01E1   572 	BNEQ	110$			;IF NEQ SPACING REQUIRED
            51            00     9A  01E3   573 	MOVZBL	#CDF_NOP,R1		;SET FOR NO OPERATION
                          31     11  01E6   574 	BRB	110$			;
                                     01E8   575  
                                     01E8   576 ;
                                     01E8   577 ; SET CHARACTERISTICS FUNCTION - STORE NEW TAPE CHARACTERISTICS
                                     01E8   578 ;
                                     01E8   579  
         38 A5         34 A3     B0  01E8   580 50$:	MOVW	IRP$L_MEDIA(R3),UCB$B_DEVCLASS(R5) ;SET NEW DEVICE CLASS AND TYPE
                                     01ED   581  
                                     01ED   582 ;
                                     01ED   583 ; SET MODE FUNCTION - STORE NEW TAPE MODE
                                     01ED   584 ;
                                     01ED   585  
         3A A5         36 A3     B0  01ED   586 60$:	MOVW	IRP$L_MEDIA+2(R3),UCB$W_DEVBUFSIZ(R5) ;SET NEW DEFAULT BUFFER SIZE
         6C A5         38 A3     B0  01F2   587 	MOVW	IRP$L_MEDIA+4(R3),UCB$W_BOFF(R5) ;SAVE NEW TAPE CONTROL PARAMETERS
            51            08     9A  01F7   588 	MOVZBL	#CDF_SETCHAR,R1		;SET FUNCTION DISPATCH INDEX
                          1D     11  01FA   589 	BRB	110$			;
                                     01FC   590  
                                     01FC   591 ;
                                     01FC   592 ; LOGICAL REWIND AND SET TAPE OFFLINE - CONVERT TO UNLOAD FUNCTION
                                     01FC   593 ;
                                     01FC   594  
            51            01     9A  01FC   595 70$:	MOVZBL	#CDF_UNLOAD,R1		;SET FOR UNLOAD FUNCTION
                          18     11  01FF   596 	BRB	110$			;
                                     0201   597  
                                     0201   598 ;
                                     0201   599 ; LOGICAL REWIND FUNCTION - CONVERT TO PHYSICAL FUNCTION
                                     0201   600 ;
                                     0201   601  
            51            03     9A  0201   602 80$:	MOVZBL	#CDF_REWIND,R1		;SET FOR REWIND FUNCTION
                          13     11  0204   603 	BRB	110$			;
                                     0206   604  
                                     0206   605 ;
                                     0206   606 ; LOGICAL WRITE EOF OR SENSE MODE FUNCTION - CONVERT TO PHYSICAL FUNCTION
                                     0206   607 ;
                                     0206   608  
            51            16     A2  0206   609 90$:	SUBW	#IO$_SENSEMODE-IO$_READPBLK-5,R1 ;CONVERT TO PHYSICAL FUNCTION
                          0E     11  0209   610 	BRB	110$			;
                                     020B   611  
                                     020B   612 ;
                                     020B   613 ; DENSE FUNCTION CODE - CHECK FOR READ, WRITE, OR WRITECHECK FUNCTION
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page  13
01              START I/O OPERATION                                                                                              (1)

                                     020B   614 ;
                                     020B   615  
            51            0A     D1  020B   616 100$:	CMPL	#IO$_WRITECHECK,R1	;DATA TRANSFER FUNCTION?
                          09     1A  020E   617 	BGTRU	110$			;IF GTRU NO
       008E C5            06     E1  0210   618 	BBC	#IO$V_REVERSE,UCB$W_MT_FUNC(R5),110$ ;IF CLR, NOT REVERSE FUNCTION
                          03         0215       
            51            03     A0  0216   619 	ADDW	#CDF_WRITECHECKR-CDF_WRITECHECK,R1 ;CONVERT TO REVERSE FUNCTION
                                     0219   620  
                                     0219   621 ;
                                     0219   622 ; FINISH PREPROCESSING
                                     0219   623 ;
                                     0219   624  
         76 A5            51     90  0219   625 110$:	MOVB	R1,UCB$B_FEX(R5)	;SAVE FUNCTION DISPATCH INDEX
                                     021D   626  
                                     021D   627 ;
                                     021D   628 ; CENTRAL FUNCTION DISPATCH
                                     021D   629 ;
                                     021D   630  
                                     021D   631 FDISPATCH:				;FUNCTION DISPATCH
                                     021D   632 	REQPCHAN			;REQUEST PRIMARY I/O CHANNEL
            53            54     D0  0220   633 	MOVL	R4,R3			;SAVE ADDRESS OF TM03/DRIVE REGISTERS
            54         20 A5     D0  0223   634 	MOVL	UCB$L_CRB(R5),R4	;GET ADDRESS OF CRB
            54         10 A4     D0  0227   635 	MOVL	CRB$L_LINK(R4),R4	;GET ADDRESS OF SECONDARY CRB
            54         1C B4     D0  022B   636 	MOVL	@CRB$L_INTD+VEC$L_IDB(R4),R4 ;GET ADDRESS OF MBA CSR
            50         76 A5     9A  022F   637 	MOVZBL	UCB$B_FEX(R5),R0	;GET DISPATCH FUNCTION CODE
         58 A5       0068 8F     AA  0233   638 	BICW	#UCB$M_CANCEL!-		;CLEAR CANCEL I/O,
                                     0239   639 		UCB$M_POWER!-		;POWERFAIL, AND
                                     0239   640 		UCB$M_TIMOUT,UCB$W_STS(R5) ;TIMEOUT STATUS BITS
                                     0239   641 	CASE	R0,<-			;DISPATCH TO FUNCTION HANDLING ROUTINE
                                     0239   642 		NOP,-			;NO OPERATION
                                     0239   643 		UNLOAD,-		;UNLOAD VOLUME
                                     0239   644 		SPCFILFOR,-		;SPACE FILE FORWARD
                                     0239   645 		REWIND,-		;REWIND
                                     0239   646 		DRVCLR,-		;DRIVE CLEAR
                                     0239   647 		SPCFILREV,-		;SPACE FILE REVERSE
                                     0239   648 		ERASE,-			;ERASE TAPE
                                     0239   649 		SPCRECREV,-		;SPACE RECORD REVERSE
                                     0239   650 		SETCHAR,-		;SET TAPE CHARACTERISTICS
                                     0239   651 		SPCRECFOR,-		;SPACE RECORD FORWARD
                                     0239   652 		WRITECHECK,-		;WRITE CHECK FORWARD
                                     0239   653 		WRITEDATA,-		;WRITE DATA FORWARD
                                     0239   654 		READDATA,-		;READ DATA FORWARD
                                     0239   655 		WRITECHECKR,-		;WRITE CHECK REVERSE
                                     0239   656 		WRITEDATA,-		;WRITE DATA FORWARD
                                     0239   657 		READDATAR,-		;READ DATA REVERSE
                                     0239   658 		READPRESET,-		;READ IN PRESET
                                     0239   659 		SENSECHAR,-		;SENSE TAPE CHARACTERISTICS
                                     0239   660 		>			;
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page  14
01              WRITE TAPE MARK FUNCTION                                                                                         (1)

                                     0261   662 	.SBTTL	WRITE TAPE MARK FUNCTION
                                     0261   663 ;
                                     0261   664 ; WRITE TAPE MARK FUNCTION
                                     0261   665 ;
                                     0261   666  
                                     0261   667 WRITEMARK:				;WRITE TAPE MARK
                                     0261   668 	EXFUNC	10$,F_WRITEMARK		;EXECUTE FUNCTION
                     0090 C5     D6  0269   669 	INCL	UCB$L_MT_RECORD(R5)	;UPDATE TAPE POSITION
            50            00'    3C  026D   670 	MOVZWL	S^#SS$_NORMAL,R0	;SET NORMAL COMPLETION STATUS
                          0517   31  0270   671 	BRW	FUNCXT			;
                                     0273   672  
                                     0273   673 ;
                                     0273   674 ; FUNCTION ENDED IN AN ERROR
                                     0273   675 ;
                                     0273   676 ; THE ERROR COULD BE A NONFATAL CONTROLLER OR DRIVE ERROR. FATAL ERRORS TERMINATE
                                     0273   677 ; THE FUNCTION IN THE FUNCTION EXECUTOR.
                                     0273   678 ;
                                     0273   679 ; FATAL CONTROLLER ERRORS ARE:
                                     0273   680 ;
                                     0273   681 ;	ERCONF	= ERROR CONFIRMATION.
                                     0273   682 ;	ISTO	= INTERFACE SEQUENCE TIMEOUT.
                                     0273   683 ;	PGE	= PROGRAMMING ERROR.
                                     0273   684 ;	NED	= NONEXISTENT DRIVE.
                                     0273   685 ;	RDTO	= READ DATA TIMEOUT.
                                     0273   686 ;
                                     0273   687 ; FATAL DRIVE ERRORS ARE:
                                     0273   688 ;
                                     0273   689 ;	ILF	= ILLEGAL FUNCTION.
                                     0273   690 ;	ILR	= ILLEGAL REGISTER.
                                     0273   691 ;	NEF	= NONEXECUTABLE FUNCTION.
                                     0273   692 ;	RMR	= REGISTER MODIFY REFUSE.
                                     0273   693 ;	UNS	= UNSAFE.
                                     0273   694 ;
                                     0273   695 ; IGNORED DRIVE ERRORS ARE:
                                     0273   696 ;
                                     0273   697 ;	FMT	= FORMAT.
                                     0273   698 ;	DPAR	= DATA BUS PARITY.
                                     0273   699 ;	FCE	= FRAME COUNT.
                                     0273   700 ;	DTE	= DRIVE TIMING.
                                     0273   701 ;	COR/CRC	= CORRECTABLE OR CHECK CHARACTER ERROR.
                                     0273   702 ;
                                     0273   703 ; NOTE THAT IT IS ASSUMED THAT MASSBUS EXCEPTION (MBEXC) WILL OCCUR ONLY IN
                                     0273   704 ; COMBINATION WITH ANOTHER DRIVE OR CONTROLLER ERROR.
                                     0273   705 ;
                                     0273   706  
                                     0273   707 10$:	TESTR	20$			;TEST REMAINING RETRIES AND RELEASE CHANNEL
                                     0278   708 	EXFUNC	DOUBLE,F_SPCRECREV	;SPACE RECORD REVERSE
       008E C5            0C     E0  0280   709 20$:	BBS	#IO$V_INHEXTGAP,UCB$W_MT_FUNC(R5),30$ ;IF SET, NO EXTENDED GAPS
                          08         0285       
                                     0286   710 	EXFUNC	DOUBLE,F_ERASE		;WRITE EXTENDED INTER-RECORD GAP
                          D1     11  028E   711 30$:	BRB	WRITEMARK		;
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page  15
01              ERASE TAPE FUNCTION                                                                                              (1)

                                     0290   713 	.SBTTL	ERASE TAPE FUNCTION
                                     0290   714 ;
                                     0290   715 ; ERASE TAPE FUNCTION
                                     0290   716 ;
                                     0290   717  
                                     0290   718 ERASE:					;ERASE TAPE
                                     0290   719 	EXFUNC	10$			;EXECUTE FUNCTION
            50            00'    3C  0295   720 	MOVZWL	S^#SS$_NORMAL,R0	;SET NORMAL COMPLETION
                     0088 C5     B4  0298   721 	CLRW	UCB$W_MT_FC(R5)		;CLEAR FRAME COUNT
                          04EB   31  029C   722 	BRW	FUNCXT			;
                                     029F   723  
                                     029F   724 ;
                                     029F   725 ; FUNCTION ENDED IN AN ERROR
                                     029F   726 ;
                                     029F   727 ; THE ERROR COULD BE A NONFATAL CONTROLLER OR DRIVE ERROR. FATAL ERRORS TERMINATE
                                     029F   728 ; THE FUNCTION IN THE FUNCTION EXECUTOR.
                                     029F   729 ;
                                     029F   730 ; FATAL CONTROLLER ERRORS ARE:
                                     029F   731 ;
                                     029F   732 ;	ERCONF	= ERROR CONFIRMATION.
                                     029F   733 ;	ISTO	= INTERFACE SEQUENCE TIMEOUT.
                                     029F   734 ;	PGE	= PROGRAMMING ERROR.
                                     029F   735 ;	NED	= NONEXISTENT DRIVE.
                                     029F   736 ;	RDTO	= READ DATA TIMEOUT.
                                     029F   737 ;
                                     029F   738 ; FATAL DRIVE ERRORS ARE:
                                     029F   739 ;
                                     029F   740 ;	ILF	= ILLEGAL FUNCTION.
                                     029F   741 ;	ILR	= ILLEGAL REGISTER.
                                     029F   742 ;	NEF	= NONEXECUTABLE FUNCTION.
                                     029F   743 ;	RMR	= REGISTER MODIFY REFUSE.
                                     029F   744 ;	UNS	= UNSAFE.
                                     029F   745 ;
                                     029F   746 ; IGNORED DRIVE ERRORS ARE:
                                     029F   747 ;
                                     029F   748 ;	FMT	= FORMAT.
                                     029F   749 ;	DPAR	= DATA BUS PARITY.
                                     029F   750 ;	INC/VPE	= INCORRECTABLE OR VERTICLE PARITY ERROR.
                                     029F   751 ;	PEF/LRC	= FORMAT (PE) OR LONGITUDINAL PARITY ERROR.
                                     029F   752 ;	NSG	= NONSTANDARD GAP.
                                     029F   753 ;	FCE	= FRAME COUNT.
                                     029F   754 ;	DTE	= DRIVE TIMING.
                                     029F   755 ;	OPI	= OPERATION INCOMPLETE.
                                     029F   756 ;	COR/CRC	= CORRECTABLE OR CHECK CHARACTER ERROR.
                                     029F   757 ;
                                     029F   758  
                                     029F   759 10$:	EXFUNC	DOUBLE,F_SPCRECREV	;BACK SPACE RECORD
                                     02A7   760 	EXFUNC	DOUBLE,F_SPCRECFOR	;SPACE RECORD FORWARD
                          045A   31  02AF   761 	BRW	RETRY			;
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page  16
01              HOUSEKEEPING FUNCTIONS                                                                                           (1)

                                     02B2   763 	.SBTTL	HOUSEKEEPING FUNCTIONS
                                     02B2   764 ;
                                     02B2   765 ; HOUSEKEEPING FUNCTIONS INCLUDE:
                                     02B2   766 ;
                                     02B2   767 ;	NO OPERATION,
                                     02B2   768 ;	DRIVE CLEAR,
                                     02B2   769 ;	SENSE TAPE CHARACTERISTICS, AND
                                     02B2   770 ;	SET TAPE CHARACTERISTICS.
                                     02B2   771 ;
                                     02B2   772 ; IF THE FUNCTION ENDS IN A NONFATAL DRIVE ERROR IT IS RETRIED. FATAL ERRORS
                                     02B2   773 ; TERMINATE THE FUNCTION IN THE FUNCTION EXECUTOR.
                                     02B2   774 ;
                                     02B2   775 ; FATAL DRIVE ERRORS ARE:
                                     02B2   776 ;
                                     02B2   777 ;	ILF	= ILLEGAL FUNCTION.
                                     02B2   778 ;	ILR	= ILLEGAL REGISTER.
                                     02B2   779 ;	NEF	= NONEXECUTABLE FUNCTION (EXCEPT FOR DRIVE CLEAR).
                                     02B2   780 ;	RMR	= REGISTER MODIFY REFUSE.
                                     02B2   781 ;	UNS	= UNSAFE.
                                     02B2   782 ;
                                     02B2   783 ; IGNORED DRIVE ERRORS ARE:
                                     02B2   784 ;
                                     02B2   785 ;	FMT	= FORMAT.
                                     02B2   786 ;	DPAR	= DATA BUS PARITY.
                                     02B2   787 ;	INC/VPE	= INCORRECTABLE OR VERTICLE PARITY ERROR.
                                     02B2   788 ;	PEF/LRC	= FORMAT (PE) OR LONGITUDINAL PARITY ERROR.
                                     02B2   789 ;	NSG	= NONSTANDARD GAP.
                                     02B2   790 ;	FCE	= FRAME COUNT.
                                     02B2   791 ;	CS/ITM	= CORRECTABLE SKEW OR INVALID TAPE MARK.
                                     02B2   792 ;	DTE	= DRIVE TIMING.
                                     02B2   793 ;	OPI	= OPERATION INCOMPLETE.
                                     02B2   794 ;	COR/CRC	= CORRECTABLE OR CHECK CHARACTER ERROR.
                                     02B2   795 ;
                                     02B2   796 ; ADDITIONAL IGNORED DRIVE ERRORS FOR DRIVE CLEAR ARE:
                                     02B2   797 ;
                                     02B2   798 ;	NEF	= NONEXECUTABLE FUNCTION.
                                     02B2   799 ;
                                     02B2   800 ; NO OPERATION, SENSE CHARACTERISTICS, AND DRIVE CLEAR.
                                     02B2   801 ;
                                     02B2   802 ;
                                     02B2   803  
                                     02B2   804 	.ENABL	LSB
                                     02B2   805 NOP:					;NO OPERATION
                                     02B2   806 SENSECHAR:				;SENSE CHARACTERISTICS
                                     02B2   807 DRVCLR:					;DRIVE CLEAR
                                     02B2   808 	EXFUNC	RETRY			;EXECUTE HOUSEKEEPING FUNCTION
                          6D     11  02B7   809 	BRB	30$			;
                                     02B9   810  
                                     02B9   811 ;
                                     02B9   812 ; SET TAPE CHARACTERISTICS
                                     02B9   813 ;
                                     02B9   814  
                                     02B9   815 SETCHAR:				;SET TAPE CHARACTERISTICS
                                     02B9   816 	EXFUNC	RETRY			;EXECUTE FUNCTION
                          08     EF  02BE   817 	EXTZV	#MT$V_DENSITY,#MT$S_DENSITY,- ;EXTRACT DENSITY CODE
         6C A5            05         02C0   818 		UCB$W_BOFF(R5),R0	;
                          50         02C3       
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page  17
01              HOUSEKEEPING FUNCTIONS                                                                                           (1)

            50            04     C4  02C4   819 	MULL	#4,R0			;CALCULATE BIT NUMBER
            04            50     EF  02C7   820 	EXTZV	R0,#4,DENSITY,R0	;EXTRACT DENSITY CODE
            50       FD4F CF         02CA       
                          04     EF  02CE   821 	EXTZV	#MT$V_FORMAT,#MT$S_FORMAT,- ;EXTRACT FORMAT CODE
         6C A5            04         02D0   822 		UCB$W_BOFF(R5),R1	;
                          51         02D3       
            51            04     C4  02D4   823 	MULL	#4,R1			;CALCULATE BIT NUMBER
            04            51     EF  02D7   824 	EXTZV	R1,#4,FORMAT,R1		;EXTRACT FORMAT CODE
            51       FD62 CF         02DA       
            53       00F0 8F     3C  02DE   825 	MOVZWL	#MT$M_FORMAT,R3		;SET INITIAL MASK WORD
            52            01     E1  02E3   826 	BBC	#MT_DS_V_BOT,R2,10$	;IF CLR, TAPE NOT AT BEGINNING
                          0C         02E6       
                                     02E7   827  
                                     02E7   828 ;
                                     02E7   829 ; TAPE DENSITY CAN ONLY BE SET WHEN THE SELECTED DRIVE IS AT BEGINNING OF TAPE
                                     02E7   830 ;
                                     02E7   831  
                          50     F0  02E7   832 	INSV	R0,#MT_TC_V_DEN,-	;SET NEW DENSITY
            03            08         02E9   833 		#MT_TC_S_DEN,UCB$W_MT_TC(R5) ;
                     0096 C5         02EB       
            53       1F00 8F     A8  02EE   834 	BISW	#MT$M_DENSITY,R3	;SET DENSITY MASK BITS
       0096 C5            08     AA  02F3   835 10$:	BICW	#MT_TC_M_EPAR,UCB$W_MT_TC(R5) ;CLEAR EVEN PARITY
         3C A5            08     AA  02F8   836 	BICW	#MT$M_PARITY,UCB$L_DEVDEPEND(R5) ;CLEAR EVEN PARITY
       0096 C5            0A     E0  02FC   837 	BBS	#MT_TC_V_DEN+2,UCB$W_MT_TC(R5),20$ ;IF SET, PHASE ENCODED TAPE
                          0D         0301       
                                     0302   838  
                                     0302   839 ;
                                     0302   840 ; TAPE PARITY CAN ONLY BE SET IF NRZI FORMATTED TAPE IS BEING READ OR WRITTEN
                                     0302   841 ;
                                     0302   842  
         6C A5            03     E1  0302   843 	BBC	#MT$V_PARITY,UCB$W_BOFF(R5),20$ ;IF CLR, ODD PARITY
                          08         0306       
       0096 C5            08     A8  0307   844 	BISW	#MT_TC_M_EPAR,UCB$W_MT_TC(R5) ;SET EVEN PARITY
            53            08     A8  030C   845 	BISW	#MT$M_PARITY,R3		;SET PARITY MASK BIT
                          51     F0  030F   846 20$:	INSV	R1,#MT_TC_V_FSEL,-	;SET NEW FORMAT
            04            04         0311   847 		#MT_TC_S_FSEL,UCB$W_MT_TC(R5) ;
                     0096 C5         0313       
         3C A5            53     AA  0316   848 	BICW	R3,UCB$L_DEVDEPEND(R5)	;CLEAR OLD FIELD VALUES
            53            53     D2  031A   849 	MCOML	R3,R3			;COMPLEMENT MASK
         6C A5            53     AA  031D   850 	BICW	R3,UCB$W_BOFF(R5)	;CLEAR FIELDS NOT BE BE INSERTED
         3C A5         6C A5     A8  0321   851 	BISW	UCB$W_BOFF(R5),UCB$L_DEVDEPEND(R5) ;INSERT NEW FIELD VALUES
                     0088 C5     B4  0326   852 30$:	CLRW	UCB$W_MT_FC(R5)		;CLEAR SAVED FRAME COUNT REGISTER
            50            00'    3C  032A   853 	MOVZWL	S^#SS$_NORMAL,R0	;SET NORMAL COMPLETION
                          045A   31  032D   854 	BRW	FUNCXT			;
                                     0330   855 	.DSABL	LSB
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page  18
01              REWIND AND UNLOAD FUNCTIONS                                                                                      (1)

                                     0330   857 	.SBTTL	REWIND AND UNLOAD FUNCTIONS
                                     0330   858 ;
                                     0330   859 ; REWIND AND UNLOAD FUNCTIONS INCLUDE:
                                     0330   860 ;
                                     0330   861 ;	READIN PRESET,
                                     0330   862 ;	REWIND, AND
                                     0330   863 ;	UNLOAD.
                                     0330   864 ;
                                     0330   865 ; IF THE FUNCTION ENDS WITH A NONFATAL DRIVE ERRORS IT IS RETRIED. FATAL ERRORS
                                     0330   866 ; TERMINATE THE FUNCTION IN THE FUNCTION EXECUTOR.
                                     0330   867 ;
                                     0330   868 ; FATAL DRIVE ERRORS ARE:
                                     0330   869 ;
                                     0330   870 ;	ILF	= ILLEGAL FUNCTION.
                                     0330   871 ;	ILR	= ILLEGAL REGISTER.
                                     0330   872 ;	NEF	= NONEXECUTABLE FUNCTION.
                                     0330   873 ;	RMR	= REGISTER MODIFY REFUSE.
                                     0330   874 ;	UNS	= UNSAFE.
                                     0330   875 ;
                                     0330   876 ; IGNORED DRIVE ERRORS ARE:
                                     0330   877 ;
                                     0330   878 ;	FMT	= FORMAT.
                                     0330   879 ;	DPAR	= DATA BUS PARITY.
                                     0330   880 ;	INC/VPE	= INCORRECTABLE OR VERTICLE PARITY ERROR.
                                     0330   881 ;	PEF/LRC	= FORMAT (PE) OR LONGITUDINAL PARITY ERROR.
                                     0330   882 ;	NSG	= NONSTANDARD GAP.
                                     0330   883 ;	FCE	= FRAME COUNT.
                                     0330   884 ;	CS/ITM	= CORRECTABLE SKEW OR INVALID TAPE MARK.
                                     0330   885 ;	DTE	= DRIVE TIMING.
                                     0330   886 ;	OPI	= OPERATION INCOMPLETE.
                                     0330   887 ;	COR/CRC	= CORRECTABLE OR CHECK CHARACTER ERROR.
                                     0330   888 ;
                                     0330   889  
                                     0330   890 READPRESET:				;READ IN PRESET
                       48 A5     B5  0330   891 	TSTW	UCB$W_UNIT(R5)		;UNIT ZERO?
                          03     13  0333   892 	BEQL	REWIND			;IF EQL YES
            50            03     9A  0335   893 	MOVZBL	#CDF_REWIND,R0		;CONVERT FUNCTION TO REWIND
                                     0338   894  
                                     0338   895 ;
                                     0338   896 ; UNLOAD AND REWIND FUNCTIONS
                                     0338   897 ;
                                     0338   898  
                                     0338   899 REWIND:					;REWIND TO BEGINNING OF TAPE
                                     0338   900 UNLOAD:					;UNLOAD VOLUME
                                     0338   901 	EXFUNC	LOSTPOS			;EXECUTE FUNCTION
                     0088 C5     B4  033D   902 	CLRW	UCB$W_MT_FC(R5)		;CLEAR SAVED FRAME COUNT REGISTER
            50            00'    3C  0341   903 	MOVZWL	S^#SS$_NORMAL,R0	;SET NORMAL COMPLETION STATUS
                          0443   31  0344   904 	BRW	FUNCXT			;
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page  19
01              SPACING FUNCTIONS                                                                                                (1)

                                     0347   906 	.SBTTL	SPACING FUNCTIONS
                                     0347   907 ;
                                     0347   908 ; SPACING FUNCTIONS INCLUDE:
                                     0347   909 ;
                                     0347   910 ;	SPACE FILE FORWARD,
                                     0347   911 ;	SPACE FILE REVERSE,
                                     0347   912 ;	SPACE RECORD FORWARD, AND
                                     0347   913 ;	SPACE RECORD REVERSE.
                                     0347   914 ;
                                     0347   915 ; ALL ARE IMPLEMENTED VIA THE SPACE RECORD FUNCTIONS.
                                     0347   916 ;
                                     0347   917 ; A SPACING FUNCTION CAN END WITH A NONFATAL DRIVE ERROR. FATAL ERRORS TERMINATE
                                     0347   918 ; THE FUNCTION IN THE FUNCTION EXECUTOR.
                                     0347   919 ;
                                     0347   920 ; FATAL DRIVE ERRORS ARE:
                                     0347   921 ;
                                     0347   922 ;	ILF	= ILLEGAL FUNCTION.
                                     0347   923 ;	ILR	= ILLEGAL REGISTER.
                                     0347   924 ;	NEF	= NONEXECUTABLE FUNCTION (FORWARD FUNCTIONS).
                                     0347   925 ;	RMR	= REGISTER MODIFY REFUSE.
                                     0347   926 ;	UNS	= UNSAFE.
                                     0347   927 ;
                                     0347   928 ; NONFATAL DRIVE ERRORS ARE:
                                     0347   929 ;
                                     0347   930 ;	CPAR	= CONTROL BUS PARITY.
                                     0347   931 ;	FCE	= FRAME COUNT.
                                     0347   932 ;	NEF	= NONEXECUTABLE FUNCTION (REVERSE FUNCTIONS INTO BEGINNING OF TAPE).
                                     0347   933 ;	OPI	= OPERATION INCOMPLETE (REVERSE FUNCTIONS INTO BEGINNING OF TAPE).
                                     0347   934 ;
                                     0347   935 ; IGNORED DRIVE ERRORS ARE:
                                     0347   936 ;
                                     0347   937 ;	FMT	= FORMAT.
                                     0347   938 ;	DPAR	= DATA BUS PARITY.
                                     0347   939 ;	INC/VPE	= INCORRECTABLE OR VERTICLE PARITY ERROR.
                                     0347   940 ;	PEF/LRC	= FORMAT (PE) OR LONGITUDINAL PARITY ERROR.
                                     0347   941 ;	NSG	= NONSTANDARD GAP.
                                     0347   942 ;	CS/ITM	= CORRECTABLE SKEW OR INVALID TAPE MARK.
                                     0347   943 ;	DTE	= DRIVE TIMING.
                                     0347   944 ;	COR/CRC	= CORRECTABLE OR CHECK CHARACTER ERROR.
                                     0347   945 ;
                                     0347   946 ; SPACE FILE FORWARD
                                     0347   947 ;
                                     0347   948 ;	SPACING FILES IS ACCOMPLISHED BY SPACING A VERY LARGE NUMBER OF RECORDS.
                                     0347   949 ;	IF THE RECORD SPACING OPERATION COMPLETES WITHOUT ERROR, THEN THE RECORD
                                     0347   950 ;	COUNT IS INCREASED BY 65,536 AND THE SPACING OPERATION IS CONTINUED.
                                     0347   951 ;
                                     0347   952 ;	SEVERAL SPECIAL CONDITIONS CAN ARISE DURING A SPACE FILE FORWARD:
                                     0347   953 ;
                                     0347   954 ;		1. A CONTROL BUS PARITY ERROR OCCURS.
                                     0347   955 ;
                                     0347   956 ;			THE OPERATION IS MERELY RETRIED SINCE TAPE MOTION COULD
                                     0347   957 ;			NOT HAVE OCCURED.
                                     0347   958 ;
                                     0347   959 ;		2. AN END OF TAPE IS ENCOUNTERED WITHOUT AN END OF FILE.
                                     0347   960 ;
                                     0347   961 ;			THE OPERATION IS CONTINUED SINCE END OF TAPE WHILE FILE
                                     0347   962 ;			SKIPPING DOES NOT TERMINATE THE OPERATION.
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page  20
01              SPACING FUNCTIONS                                                                                                (1)

                                     0347   963 ;
                                     0347   964 ;		3. AN END OF FILE IS ENCOUNTERED.
                                     0347   965 ;
                                     0347   966 ;			THE FILE SKIP COUNT IS DECREMENTED AND IF NONZERO, THE
                                     0347   967 ;			OPERATION IS CONTINUED.
                                     0347   968 ;
                                     0347   969 ;	UNLESS A HARD ERROR IS ENCOUNTERED, NORMAL COMPLETION IS ALWAYS RETURNED
                                     0347   970 ;	FOR A SKIP FILE FORWARD FUNCTION.
                                     0347   971 ;
                                     0347   972 ;	AS RECORDS ARE SKIPPED FORWARD ON THE TAPE, THE CURRENT TAPE POSITION IS
                                     0347   973 ;	MAINTAINED BY ADDING THE NUMBER OF RECORDS AND TAPE MARKS SKIPPED OVER.
                                     0347   974 ;
                                     0347   975  
                                     0347   976 SPCFILFOR:				;SPACE FILE FORWARD
                                     0347   977 	EXFUNC	10$,F_SPCFILFOR		;EXECUTE FUNCTION
                     0092 C5     B6  034F   978 	INCW	UCB$L_MT_RECORD+2(R5)	;UPDATE TAPE POSITION
                          F2     11  0353   979 	BRB	SPCFILFOR		;
                                     0355   980 10$:	CHECK_ERROR			;CHECK FOR FATAL OF RETRIABLE ERROR
            50       0088 C5     3C  0358   981 	MOVZWL	UCB$W_MT_FC(R5),R0	;GET NUMBER OF RECORDS SKIPPED OVER
       0090 C5            50     C0  035D   982 	ADDL	R0,UCB$L_MT_RECORD(R5)	;UPDATE TAPE POSITION
            52            02     E1  0362   983 	BBC	#MT_DS_V_TM,R2,SPCFILFOR ;IF CLR, TAPE MARK NOT ENCOUNTERED
                          E1         0365       
                       6C A5     B7  0366   984 	DECW	UCB$W_BOFF(R5)		;DECREMENT NUMBER OF FILES TO SKIP
                          DC     12  0369   985 	BNEQ	SPCFILFOR		;IF NEQ MORE TO GO
                          0085   31  036B   986 	BRW	NORXIT			;
                                     036E   987  
                                     036E   988 ;
                                     036E   989 ; SPACE FILE REVERSE
                                     036E   990 ;
                                     036E   991 ;	SPACING FILES IS ACCOMPLISHED BY SPACING A VERY LARGE NUMBER OF RECORDS.
                                     036E   992 ;	IF THE RECORD SPACING OPERATION COMPLETES WITHOUT ERROR, THE THE RECORD
                                     036E   993 ;	COUNT IS REDUCED BY 65,536 AND THE SPACING OPERATION IS CONTINUED.
                                     036E   994 ;
                                     036E   995 ;	SEVERAL SPECIAL CONDITIONS CAN ARISE DURING A SPACE FILE REVERSE:
                                     036E   996 ;
                                     036E   997 ;		1. A CONTROL BUS PARITY ERROR OCCURS.
                                     036E   998 ;
                                     036E   999 ;			THE OPERATION IS MERELY RETRIED SINCE TAPE MOTION COULD
                                     036E  1000 ;			NOT HAVE OCCURED.
                                     036E  1001 ;
                                     036E  1002 ;		2. AN END OF TAPE IS ENCOUNTERED WITHOUT AN END OF FILE.
                                     036E  1003 ;
                                     036E  1004 ;			THE OPERATION IS CONTINUED SINCE END OF TAPE WHILE FILE
                                     036E  1005 ;			SKIPPING DOES NOT TERMINATE THE OPERATION.
                                     036E  1006 ;
                                     036E  1007 ;		3. A BEGINNING OF TAPE IS ENCOUNTERED.
                                     036E  1008 ;
                                     036E  1009 ;			THE OPERATION IS IMMEDIATELY TERMINATED.
                                     036E  1010 ;
                                     036E  1011 ;		4. AN END OF FILE IS ENCOUNTERED.
                                     036E  1012 ;
                                     036E  1013 ;			THE FILE SKIP COUNT IS DECREMENTED AND IF NONZERO, THE
                                     036E  1014 ;			OPERATION IS CONTINUED.
                                     036E  1015 ;
                                     036E  1016 ;	UNLESS A HARD ERROR IS ENCOUNTERED, NORMAL COMPLETION IS ALWAYS RETURNED
                                     036E  1017 ;	FOR A SKIP FILE REVERSE OPERATION.
                                     036E  1018 ;
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page  21
01              SPACING FUNCTIONS                                                                                                (1)

                                     036E  1019 ;	AS RECORDS ARE SKIPPED BACKWARDS ON THE TAPE, THE CURRENT TAPE POSITION
                                     036E  1020 ;	IS MAINTAINED BY SUBTRACTING THE NUMBER RECORDS AND TAPE MARKS SKIPPED
                                     036E  1021 ;	OVER.
                                     036E  1022 ;
                                     036E  1023  
                                     036E  1024 SPCFILREV:				;SPACE FILE REVERSE
                                     036E  1025 	EXFUNC	10$,F_SPCFILREV		;EXECUTE FUNCTION
                     0092 C5     B7  0376  1026 	DECW	UCB$L_MT_RECORD+2(R5)	;UPDATE RECORD POSITION
                          F2     11  037A  1027 	BRB	SPCFILREV		;
                                     037C  1028 10$:	CHECK_ERROR			;CHECK FOR FATAL OR RETRIABLE ERROR
            50       0088 C5     3C  037F  1029 	MOVZWL	UCB$W_MT_FC(R5),R0	;GET NUMBER OF RECORDS SKIPPED OVER
       0090 C5            50     C2  0384  1030 	SUBL	R0,UCB$L_MT_RECORD(R5)	;UPDATE TAPE POSITION
            52            06     B3  0389  1031 	BITW	#MT_DS_M_BOT!MT_DS_M_TM,R2 ;NOT AT BOT AND NO TAPE MARK ENCOUNTERED?
                          E0     13  038C  1032 	BEQL	SPCFILREV		;IF EQL YES
            52            01     E0  038E  1033 	BBS	#MT_DS_V_BOT,R2,20$	;IF SET, BEGINNING OF TAPE
                          05         0391       
                       6C A5     B7  0392  1034 	DECW	UCB$W_BOFF(R5)		;ANY MORE FILES TO SKIP?
                          D7     12  0395  1035 	BNEQ	SPCFILREV		;IF NEQ YES
                          5A     11  0397  1036 20$:	BRB	NORXIT			;
                                     0399  1037  
                                     0399  1038 ;
                                     0399  1039 ; SPACE RECORD FORWARD
                                     0399  1040 ;
                                     0399  1041 ;	SEVERAL SPECIAL CONDITIONS CAN ARISE DURING A SPACE FORWARD:
                                     0399  1042 ;
                                     0399  1043 ;		1. A CONTROL BUS PARITY ERROR OCCURS.
                                     0399  1044 ;
                                     0399  1045 ;			THE OPERATION IS MERELY RETRIED SINCE TAPE MOTION COULD
                                     0399  1046 ;			NOT HAVE OCCURED.
                                     0399  1047 ;
                                     0399  1048 ;		2. AN END OF TAPE IS ENCOUNTERED WITHOUT AN END OF FILE.
                                     0399  1049 ;
                                     0399  1050 ;			THE OPERATION IS TERMINATED WITH A FINAL STATUS OF END OF
                                     0399  1051 ;			TAPE.
                                     0399  1052 ;
                                     0399  1053 ;		3. AN END OF FILE IS ENCOUNTERED.
                                     0399  1054 ;
                                     0399  1055 ;			THE OPERATION IS TERMINATED WITH A FINAL STATUS OF END OF
                                     0399  1056 ;			FILE.
                                     0399  1057 ;
                                     0399  1058 ;	UNLESS A HARD ERROR IS ENCOUNTERED, THE CURRENT TAPE POSITION IS MAINTAINED
                                     0399  1059 ;	BY ADDING THE TOTAL NUMBER OF RECORDS SKIPPED OVER.
                                     0399  1060 ;
                                     0399  1061  
                                     0399  1062 SPCRECFOR:				;SPACE RECORD FORWARD
                                     0399  1063 	EXFUNC	10$			;EXECUTE FUNCTION
                          03     11  039E  1064 	BRB	20$			;
                                     03A0  1065 10$:	CHECK_ERROR			;CHECK FOR FATAL OR RETRIABLE ERROR
                          50     D4  03A3  1066 20$:	CLRL	R0			;CLEAR UPPER HALF OF REGISTER
         6C A5       0088 C5     A1  03A5  1067 	ADDW3	UCB$W_MT_FC(R5),UCB$W_BOFF(R5),R0 ;CALCULATE RECORDS SKIPPED
                          50         03AB       
       0090 C5            50     C0  03AC  1068 	ADDL	R0,UCB$L_MT_RECORD(R5)	;UPDATE TAPE POSITION
         6C A5       0088 C5     AE  03B1  1069 	MNEGW	UCB$W_MT_FC(R5),UCB$W_BOFF(R5) ;SET REMAINING RECORD SKIP COUNT
            52            02     E0  03B7  1070 	BBS	#MT_DS_V_TM,R2,SETEOF	;IF SET, END OF FILE ENCOUNTERED
                          3D         03BA       
                          36     11  03BB  1071 	BRB	NORXIT			;
                                     03BD  1072  
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page  22
01              SPACING FUNCTIONS                                                                                                (1)

                                     03BD  1073 ;
                                     03BD  1074 ; SPACE RECORD REVERSE
                                     03BD  1075 ;
                                     03BD  1076 ;	SEVERAL SPECIAL CONDITIONS CAN ARISE DURING A SPACE RECORD REVERSE:
                                     03BD  1077 ;
                                     03BD  1078 ;		1. A CONTROL BUS PARITY ERROR.
                                     03BD  1079 ;
                                     03BD  1080 ;			THE OPERATION IS MERELY RETRIED SINCE TAPE MOTION COULD
                                     03BD  1081 ;			NOT HAVE OCCURED.
                                     03BD  1082 ;
                                     03BD  1083 ;		2. A BEGINNING OF TAPE IS ENCOUNTERED.
                                     03BD  1084 ;
                                     03BD  1085 ;			THE OPERATION IS TERMINATED WITH A FINAL STATUS OF END OF
                                     03BD  1086 ;			FILE.
                                     03BD  1087 ;
                                     03BD  1088 ;		3. AN END OF TAPE IS ENCOUNTERED WITHOUT AN END OF FILE.
                                     03BD  1089 ;
                                     03BD  1090 ;			THE OPERATION IS CONTINUED SINCE AN END OF TAPE WHILE
                                     03BD  1091 ;			SKIPPING RECORDS BACKWARDS DOES NOT TERMINATE THE OPER-
                                     03BD  1092 ;			ATION.
                                     03BD  1093 ;
                                     03BD  1094 ;		4. AN END OF FILE IS ENCOUNTERED.
                                     03BD  1095 ;
                                     03BD  1096 ;			THE OPERATION IS TERMINATED WITH A FINAL STATUS OF END OF
                                     03BD  1097 ;			FILE.
                                     03BD  1098 ;
                                     03BD  1099 ;	UNLESS A HARD ERROR IS ENCOUNTERED, THE CURRENT TAPE POSITION IS MAINTAINED
                                     03BD  1100 ;	BY SUBTRACTING THE TOTAL NUMBER OF RECORDS SKIPPED OVER.
                                     03BD  1101 ;
                                     03BD  1102  
                                     03BD  1103 SPCRECREV:				;SPACE RECORD REVERSE
                                     03BD  1104 	EXFUNC	10$,F_SPCRECREV		;EXECUTE FUNCTION
                          03     11  03C5  1105 	BRB	20$			;
                                     03C7  1106 10$:	CHECK_ERROR			;CHECK FOR FATAL OR RETRIABLE ERROR
                          50     D4  03CA  1107 20$:	CLRL	R0			;CLEAR UPPER HALF OF REGISTER
         6C A5       0088 C5     A1  03CC  1108 	ADDW3	UCB$W_MT_FC(R5),UCB$W_BOFF(R5),R0 ;CALCULATE RECORD SKIP COUNT
                          50         03D2       
       0090 C5            50     C2  03D3  1109 	SUBL	R0,UCB$L_MT_RECORD(R5)	;UPDATE TAPE POSITION
         6C A5       0088 C5     AE  03D8  1110 	MNEGW	UCB$W_MT_FC(R5),UCB$W_BOFF(R5) ;SET REMAINING RECORD SKIP COUNT
       008A C5       0088 C5     B0  03DE  1111 	MOVW	UCB$W_MT_FC(R5),UCB$W_MT_SPACNT(R5) ;RESET SPACING COUNT
            52            02     E0  03E5  1112 	BBS	#MT_DS_V_TM,R2,SETEOF	;IF SET, END OF FILE ENCOUNTERED
                          0F         03E8       
                          08     13  03E9  1113 	BEQL	NORXIT			;IF EQL ALL RECORDS SPACED OVER
            52            01     E0  03EB  1114 	BBS	#MT_DS_V_BOT,R2,SETEOF	;IF SET, BEGINNING OF TAPE ENCOUNTERED
                          09         03EE       
            52            0A     E0  03EF  1115 	BBS	#MT_DS_V_EOT,R2,SPCRECREV ;IF SET, AT END OF TAPE
                          CA         03F2       
                                     03F3  1116  
                                     03F3  1117 ;
                                     03F3  1118 ; NORMAL SPACING FUNCTION EXIT
                                     03F3  1119 ;
                                     03F3  1120  
                                     03F3  1121 	.ENABL	LSB
            50            00'    3C  03F3  1122 NORXIT:	MOVZWL	S^#SS$_NORMAL,R0	;SET NORMAL COMPLETION STATUS
                          05     11  03F6  1123 	BRB	10$			;
                                     03F8  1124  
                                     03F8  1125 ;
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page  23
01              SPACING FUNCTIONS                                                                                                (1)

                                     03F8  1126 ; SET EOF OF FILE STATUS
                                     03F8  1127 ;
                                     03F8  1128  
            50       0000'8F     3C  03F8  1129 SETEOF:	MOVZWL	#SS$_ENDOFFILE,R0	;SET END OF FILE STATUS
                       6C A5     A3  03FD  1130 10$:	SUBW3	UCB$W_BOFF(R5),UCB$W_BCNT(R5),- ;CALCULATE TOTAL NUMBER OF FILES
       0088 C5         6E A5         0400  1131 		UCB$W_MT_FC(R5)		;OR RECORDS SKIPPED OVER
                          0382   31  0405  1132 	BRW	FUNCXT			;
                                     0408  1133 	.DSABL	LSB
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page  24
01              READ DATA FORWARD AND WRITECHECK DATA FORWARD F                                                                  (1)

                                     0408  1135 	.SBTTL	READ DATA FORWARD AND WRITECHECK DATA FORWARD FUNCTIONS
                                     0408  1136 ;
                                     0408  1137 ; READ DATA FORWARD AND WRITECHECK DATA FORWARD FUNCTIONS
                                     0408  1138 ;
                                     0408  1139  
                                     0408  1140 WRITECHECK:				;WRITE CHECK FORWARD
       008E C5       4000 8F     AA  0408  1141 	BICW	#IO$M_DATACHECK,UCB$W_MT_FUNC(R5) ;CLEAR DATA CHECK REQUEST
                                     040F  1142 READDATA:				;READ DATA FORWARD
                                     040F  1143 	REQSCHAN			;REQUEST SECONDARY I/O CHANNEL
            50         76 A5     9A  0412  1144 	MOVZBL	UCB$B_FEX(R5),R0	;RETRIEVE FUNCTION INDEX
                                     0416  1145 	EXFUNC	20$			;EXECUTE FUNCTION
       008E C5            0E     E1  041B  1146 10$:	BBC	#IO$V_DATACHECK,UCB$W_MT_FUNC(R5),50$ ;IF CLR, NO DATA CHECK
                          5A         0420       
                                     0421  1147 	RELSCHAN			;RELEASE SECONDARY I/O CHANNEL
                                     0424  1148 	EXFUNC	DOUBLE,F_SPCRECREV	;SPACE RECORD REVERSE
                                     042C  1149 	REQSCHAN			;REQUEST SECONDARY I/O CHANNEL
                                     042F  1150 	EXFUNC	20$,F_WRITECHECK	;WRITE CHECK DATA
                          42     11  0437  1151 	BRB	50$			;
                                     0439  1152  
                                     0439  1153 ;
                                     0439  1154 ; FUNCTION ENDED IN AN ERROR
                                     0439  1155 ;
                                     0439  1156 ; THE ERROR COULD BE A NONFATAL CONTROLLER OR DRIVE ERROR. FATAL ERRORS TERMINATE
                                     0439  1157 ; THE FUNCTION IN THE FUNCTION EXECUTOR.
                                     0439  1158 ;
                                     0439  1159 ; FATAL CONTROLLER ERRORS ARE:
                                     0439  1160 ;
                                     0439  1161 ;	ERCONF	= ERROR CONFIRMATION.
                                     0439  1162 ;	ISTO	= INTERFACE SEQUENCE TIMEOUT.
                                     0439  1163 ;	PGE	= PROGRAMMING ERROR.
                                     0439  1164 ;	NED	= NONEXISTENT DRIVE.
                                     0439  1165 ;	RDTO	= READ DATA TIMEOUT.
                                     0439  1166 ;
                                     0439  1167 ; FATAL DRIVE ERRORS ARE:
                                     0439  1168 ;
                                     0439  1169 ;	ILF	= ILLEGAL FUNCTION.
                                     0439  1170 ;	ILR	= ILLEGAL REGISTER.
                                     0439  1171 ;	NEF	= NONEXECUTABLE FUNCTION.
                                     0439  1172 ;	RMR	= REGISTER MODIFY REFUSE.
                                     0439  1173 ;	UNS	= UNSAFE.
                                     0439  1174 ;
                                     0439  1175 ; IGNORED DRIVE ERRORS ARE:
                                     0439  1176 ;
                                     0439  1177 ;	DPAR	= DATA BUS PARITY.
                                     0439  1178 ;
                                     0439  1179 ; NOTE THAT IT IS ASSUMED THAT MASSBUS EXCEPTION (MBEXC) WILL OCCUR ONLY IN
                                     0439  1180 ; COMBINATION WITH ANOTHER DRIVE OR CONTROLLER ERROR.
                                     0439  1181 ;
                                     0439  1182  
            51   00020974 8F     D3  0439  1183 20$:	BITL	#MBA$M_SR_DLT!-		;DATA LATE OR,
                                     0440  1184 		MBA$M_SR_INVMAP!-	;INVALID MAP REGISTER OR,
                                     0440  1185 		MBA$M_SR_MAPPE!-	;MAP PARITY ERROR OR,
                                     0440  1186 		MBA$M_SR_MCPE!-		;MASSBUS CONTROL PARITY ERROR OR,
                                     0440  1187 		MBA$M_SR_MDPE!-		;MASSBUS DATA PARITY ERROR OR,
                                     0440  1188 		MBA$M_SR_MXF!-		;MISSED TRANSFER OR,
                                     0440  1189 		MBA$M_SR_RDS,R1		;READ DATA SUBSTITUTE?
                          50     12  0440  1190 	BNEQ	80$			;IF NEQ YES
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page  25
01              READ DATA FORWARD AND WRITECHECK DATA FORWARD F                                                                  (1)

            52            02     E0  0442  1191 	BBS	#MT_DS_V_TM,R2,30$	;IF SET, TAPE MARK DETECTED
                          07         0445       
            51       0600 8F     B3  0446  1192 	BITW	#MBA$M_SR_WCKLWR!-	;WRITE CHECK LOWER BYTE OR,
                                     044B  1193 		MBA$M_SR_WCKUPR,R1	;WRITE CHECK UPPER BYTE?
                          45     12  044B  1194 	BNEQ	80$			;IF NEQ YES
            50       31D8 8F     B3  044D  1195 30$:	BITW	#MT_ER_M_CPAR!-		;CONTROL BUS PARITY ERROR OR,
                                     0452  1196 		MT_ER_M_DTE!-		;DRIVE TIMING ERROR OR,
                                     0452  1197 		MT_ER_M_FMT!-		;FORMAT ERROR OR,
                                     0452  1198 		MT_ER_M_INC!-		;INCORRECTABLE ERROR (PE) OR,
                                     0452  1199 		MT_ER_M_LRC!-		;LONGITUDINAL PARITY ERROR (NRZI) OR,
                                     0452  1200 		MT_ER_M_NSG!-		;NONSTANDARD GAP OR,
                                     0452  1201 		MT_ER_M_OPI!-		;OPERATION INCOMPLETE OR,
                                     0452  1202 		MT_ER_M_PEF!-		;FORMAT ERROR (PE) OR,
                                     0452  1203 		MT_ER_M_VPE,R0		;VERTICLE PARITY ERROR (NRZI)?
                          31     12  0452  1204 	BNEQ	70$			;IF NEQ YES
            52            05     E0  0454  1205 	BBS	#MT_DS_V_PES,R2,40$	;IF SET, PHASE ENCODED TAPE
                          07         0457       
            50       8400 8F     B3  0458  1206 	BITW	#MT_ER_M_CRC!MT_ER_M_ITM,R0 ;CRC OR INVALID TAPE MARK?
                          33     12  045D  1207 	BNEQ	80$			;IF NEQ YES
                                     045F  1208  
                                     045F  1209 ;
                                     045F  1210 ; FRAME COUNT ERROR
                                     045F  1211 ;
                                     045F  1212 ; IF THE RECORD CONTAINED MORE BYTES THAN THE SPECIFIED BUFFER, THEN A DATA OVERRUN
                                     045F  1213 ; ERROR IS RETURNED. ELSE A CHECK IS MADE FOR END OF FILE AND IMPLICIT WRITECHECK.
                                     045F  1214 ;
                                     045F  1215  
            50       0000'8F     3C  045F  1216 40$:	MOVZWL	#SS$_DATAOVERUN,R0	;SET DATA OVER RUN STATUS
         6E A5       0088 C5     B1  0464  1217 	CMPW	UCB$W_MT_FC(R5),UCB$W_BCNT(R5) ;DATA OVER RUN?
                          12     1A  046A  1218 	BGTRU	60$			;IF GTR YES
            50       0000'8F     3C  046C  1219 	MOVZWL	#SS$_ENDOFFILE,R0	;ASSUME END OF FILE
            52            02     E0  0471  1220 	BBS	#MT_DS_V_TM,R2,60$	;IF SET, TAPE MARK ENCOUNTERED
                          09         0474       
         77 A5            0C     91  0475  1221 	CMPB	#CDF_READDATA,UCB$B_CEX(R5) ;LAST FUNCTION READ DATA?
                          A0     13  0479  1222 	BEQL	10$			;IF EQL YES
            50            00'    3C  047B  1223 50$:	MOVZWL	S^#SS$_NORMAL,R0	;SET NORMAL COMPLETION STATUS
                     0090 C5     D6  047E  1224 60$:	INCL	UCB$L_MT_RECORD(R5)	;INCREMENT RECORD POSITION
                          0305   31  0482  1225 	BRW	FUNCXT			;
                                     0485  1226  
                                     0485  1227 ;
                                     0485  1228 ; RECOVERABLE CONTROLLER OR DRIVE ERROR
                                     0485  1229 ;
                                     0485  1230 ; A CHECK IS MADE TO DETERMINE IF OPERATION INCOMPLETE IS THE ONLY ERROR AND THAT
                                     0485  1231 ; THE TRANSFERED BYTE COUNT WAS ZERO. IF THIS CHECK IS SATISFIED, THEN BLANK TAPE
                                     0485  1232 ; IS BEING READ AND THE FATAL ERROR EXIT IS TAKEN.
                                     0485  1233 ;
                                     0485  1234 ; A CHECK IS MADE TO DETERMINE IF ANY RETRIES REMAIN. IF THE NUMBER OF RETRIES IS
                                     0485  1235 ; EXHAUSTED, THEN AN ERROR IS RETURNED. ELSE RECOVERY IS ATTEMPTED. THE METHOD USED
                                     0485  1236 ; DEPENDS ON THE PREVIOUS NUMBER OF RETRIES.
                                     0485  1237 ;
                                     0485  1238 ; IF THE PREVIOUSLY ATTEMPTED RETRIES HAVE EXCEEDED A THRESHOLD, THEN THE TAPE IS
                                     0485  1239 ; BACKSPACED THE ERROR BACKSPACE COUNT, FORWARD SPACED THAT NUMBER MINUS ONE, AND
                                     0485  1240 ; THE OPERATION IS REPEATED.
                                     0485  1241 ;
                                     0485  1242 ; IF THE PREVIOULY ATTEMPTED RETRIES HAVE NOT EXCEEDED THE THRESHOLD, THEN THE TAPE
                                     0485  1243 ; IS BACKSPACED ONE RECORD AND THE OPERATION IS RETRIED.
                                     0485  1244 ;
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page  26
01              READ DATA FORWARD AND WRITECHECK DATA FORWARD F                                                                  (1)

                                     0485  1245  
            50       DFFF 8F     B3  0485  1246 70$:	BITW	#^C<MT_ER_M_OPI>,R0	;OPERATION INCOMPLETE ONLY ERROR?
                          06     12  048A  1247 	BNEQ	80$			;IF NEQ NO
                     0088 C5     B5  048C  1248 	TSTW	UCB$W_MT_FC(R5)		;TRANSFERED BYTE COUNT ZERO?
                          5D     13  0490  1249 	BEQL	140$			;IF EQL YES
                                     0492  1250 80$:	TESTR	130$			;TEST REMAINING RETRIES AND RELEASE CHANNEL
         70 A5            08     91  0497  1251 	CMPB	#THRESHOLD,UCB$B_ERTCNT(R5) ;TIME TO USE ALTERNATE RECOVERY?
                          3F     1B  049B  1252 	BLEQU	120$			;IF LEQU NO
       008A C5            05     AE  049D  1253 	MNEGW	#ERR_SPACING,UCB$W_MT_SPACNT(R5) ;SET ERROR RECORD SPACING
       0090 C5            05     D1  04A2  1254 	CMPL	#ERR_SPACING,UCB$L_MT_RECORD(R5) ;ENOUGH RECORDS WRITTEN ON TAPE?
                          11     1B  04A7  1255 	BLEQU	90$			;IF LEQU YES
                                     04A9  1256 	EXFUNC	DOUBLE,F_REWIND		;REWIND TAPE
       0094 C5       0090 C5     AE  04B1  1257 	MNEGW	UCB$L_MT_RECORD(R5),UCB$W_MT_FORCNT(R5) ;SET PROPER RECORD COUNT
                          0D     11  04B8  1258 	BRB	100$			;
                                     04BA  1259 90$:	EXFUNC	DOUBLE,F_SPCRECREV	;SPACE RECORDS REVERSE
       0094 C5            04     AE  04C2  1260 	MNEGW	#ERR_SPACING-1,UCB$W_MT_FORCNT(R5) ;SET FORWARD SPACING COUNT
       008A C5            01     AE  04C7  1261 100$:	MNEGW	#1,UCB$W_MT_SPACNT(R5)	;RESET SPACE COUNT FOR ONE RECORD
                                     04CC  1262 110$:	EXFUNC	DOUBLE,F_SPCRECFOR	;SPACE RECORD FORWARD
                     0094 C5     B6  04D4  1263 	INCW	UCB$W_MT_FORCNT(R5)	;ANY MORE RECORDS TO SPACE OVER?
                          F2     19  04D8  1264 	BLSS	110$			;IF LSS YES
                          10     11  04DA  1265 	BRB	130$			;
                                     04DC  1266 120$:	EXFUNC	DOUBLE,F_SPCRECREV	;SPACE RECORD REVERSE
                                     04E4  1267 	EXFUNC	DOUBLE,F_SPCRECFOR	;SPACE RECORD FORWARD
                          FF20   31  04EC  1268 130$:	BRW	READDATA		;
                          0229   31  04EF  1269 140$:	BRW	FATALERR		;
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page  27
01              READ DATA REVERSE AND WRITECHECK DATA REVERSE F                                                                  (1)

                                     04F2  1271 	.SBTTL	READ DATA REVERSE AND WRITECHECK DATA REVERSE FUNCTIONS
                                     04F2  1272 ;
                                     04F2  1273 ; READ DATA REVERSE AND WRITECHECK DATA REVERSE FUNCTIONS
                                     04F2  1274 ;
                                     04F2  1275  
                                     04F2  1276 WRITECHECKR:				;WRITE CHECK REVERSE
       008E C5       4000 8F     AA  04F2  1277 	BICW	#IO$M_DATACHECK,UCB$W_MT_FUNC(R5) ;CLEAR DATA CHECK REQUEST
                                     04F9  1278 READDATAR:				;READ DATA REVERSE
                                     04F9  1279 	REQSCHAN			;REQUEST SECONDARY I/O CHANNEL
            50         76 A5     9A  04FC  1280 	MOVZBL	UCB$B_FEX(R5),R0	;RETRIEVE FUNCTION INDEX
                                     0500  1281 	EXFUNC	20$			;EXECUTE FUNCTION
       008E C5            0E     E1  0505  1282 10$:	BBC	#IO$V_DATACHECK,UCB$W_MT_FUNC(R5),50$ ;IF CLR, NO DATA CHECK
                          5E         050A       
                                     050B  1283 	RELSCHAN			;RELEASE SECONDARY I/O CHANNEL
                                     050E  1284 	EXFUNC	DOUBLE,F_SPCRECFOR	;SPACE RECORD FORWARD
                                     0516  1285 	REQSCHAN			;REQUEST SECONDARY I/O CHANNEL
                                     0519  1286 	EXFUNC	20$,F_WRITECHECKR	;WRITE CHECK DATA REVERSE
                          46     11  0521  1287 	BRB	50$			;
                                     0523  1288  
                                     0523  1289 ;
                                     0523  1290 ; FUNCTION ENDED IN AN ERROR
                                     0523  1291 ;
                                     0523  1292 ; THE ERROR COULD BE A NONFATAL CONTROLLER OR DRIVE ERROR. FATAL ERRORS TERMINATE
                                     0523  1293 ; THE FUNCTION IN THE FUNCTION EXECUTOR.
                                     0523  1294 ;
                                     0523  1295 ; FATAL CONTROLLER ERRORS ARE:
                                     0523  1296 ;
                                     0523  1297 ;	ERCONF	= ERROR CONFIRMATION.
                                     0523  1298 ;	ISTO	= INTERFACE SEQUENCE TIMEOUT.
                                     0523  1299 ;	PGE	= PROGRAMMING ERROR.
                                     0523  1300 ;	NED	= NONEXISTENT DRIVE.
                                     0523  1301 ;	RDTO	= READ DATA TIMEOUT.
                                     0523  1302 ;
                                     0523  1303 ; FATAL DRIVE ERRORS ARE:
                                     0523  1304 ;
                                     0523  1305 ;	ILF	= ILLEGAL FUNCTION.
                                     0523  1306 ;	ILR	= ILLEGAL REGISTER.
                                     0523  1307 ;	RMR	= REGISTER MODIFY REFUSE.
                                     0523  1308 ;	UNS	= UNSAFE.
                                     0523  1309 ;
                                     0523  1310 ; IGNORED DRIVE ERRORS ARE:
                                     0523  1311 ;
                                     0523  1312 ;	DPAR	= DATA BUS PARITY.
                                     0523  1313 ;
                                     0523  1314 ; NOTE THAT IT IS ASSUMED THAT MASSBUS EXCEPTION (MBEXC) WILL OCCUR ONLY IN
                                     0523  1315 ; COMBINATION WITH ANOTHER DRIVE OR CONTROLLER ERROR.
                                     0523  1316 ;
                                     0523  1317  
            51   00020974 8F     D3  0523  1318 20$:	BITL	#MBA$M_SR_DLT!-		;DATA LATE OR,
                                     052A  1319 		MBA$M_SR_INVMAP!-	;INVALID MAP REGISTER OR,
                                     052A  1320 		MBA$M_SR_MAPPE!-	;MAP PARITY ERROR OR,
                                     052A  1321 		MBA$M_SR_MCPE!-		;MASSBUS CONTROL PARITY ERROR OR,
                                     052A  1322 		MBA$M_SR_MDPE!-		;MASSBUS DATA PARITY ERROR OR,
                                     052A  1323 		MBA$M_SR_MXF!-		;MISSED TRANSFER OR,
                                     052A  1324 		MBA$M_SR_RDS,R1		;READ DATA SUBSTITUTE OR,
                          47     12  052A  1325 	BNEQ	70$			;IF NEQ YES
            52            02     E0  052C  1326 	BBS	#MT_DS_V_TM,R2,30$	;IF SET, TAPE MARK DETECTED
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page  28
01              READ DATA REVERSE AND WRITECHECK DATA REVERSE F                                                                  (1)

                          07         052F       
            51       0600 8F     B3  0530  1327 	BITW	#MBA$M_SR_WCKLWR!-	;WRITE CHECK LOWER BYTE OR,
                                     0535  1328 		MBA$M_SR_WCKUPR,R1	;WRITE CHECK UPPER BYTE?
                          3C     12  0535  1329 	BNEQ	70$			;IF NEQ YES
            50       31D8 8F     B3  0537  1330 30$:	BITW	#MT_ER_M_CPAR!-		;CONTROL BUS PARITY ERROR OR,
                                     053C  1331 		MT_ER_M_DTE!-		;DRIVE TIMING ERROR OR,
                                     053C  1332 		MT_ER_M_FMT!-		;FORMAT ERROR OR,
                                     053C  1333 		MT_ER_M_INC!-		;INCORRECTABLE ERROR (PE) OR,
                                     053C  1334 		MT_ER_M_LRC!-		;LONGITUDINAL PARITY ERROR (NRZI) OR,
                                     053C  1335 		MT_ER_M_NSG!-		;NONSTANDARD GAP OR,
                                     053C  1336 		MT_ER_M_OPI!-		;OPERATION INCOMPLETE OR,
                                     053C  1337 		MT_ER_M_PEF!-		;FORMAT ERROR (PE) OR,
                                     053C  1338 		MT_ER_M_VPE,R0		;VERTICLE PARITY ERROR (NRZI)?
                          35     12  053C  1339 	BNEQ	70$			;IF NEQ YES
            52            05     E0  053E  1340 	BBS	#MT_DS_V_PES,R2,40$	;IF SET, PHASE ENCODED TAPE
                          07         0541       
            50       8400 8F     B3  0542  1341 	BITW	#MT_ER_M_CRC!MT_ER_M_ITM,R0 ;CRC OR INVALID TAPE MARK?
                          2A     12  0547  1342 	BNEQ	70$			;IF NEQ YES
                                     0549  1343  
                                     0549  1344 ;
                                     0549  1345 ; FRAME COUNT OR NONEXECUTABLE FUNCTION
                                     0549  1346 ;
                                     0549  1347 ; IF THE RECORD CONTAINED MORE BYTES THAN THE SPECIFIED BUFFER, THEN A DATA OVERRUN
                                     0549  1348 ; IS RETURNED. ELSE A CHECK IS MADE FOR END OF FILE, BEGINNING OF TAPE, AND
                                     0549  1349 ; IMPLICIT WRITECHECK.
                                     0549  1350 ;
                                     0549  1351  
            50       0000'8F     3C  0549  1352 40$:	MOVZWL	#SS$_DATAOVERUN,R0	;SET DATA OVER RUN STATUS
         6E A5       0088 C5     B1  054E  1353 	CMPW	UCB$W_MT_FC(R5),UCB$W_BCNT(R5) ;DATA OVER RUN?
                          16     1A  0554  1354 	BGTRU	60$			;IF GTR YES
            50       0000'8F     3C  0556  1355 	MOVZWL	#SS$_ENDOFFILE,R0	;SET END OF FILE STATUS
            52            02     E0  055B  1356 	BBS	#MT_DS_V_TM,R2,60$	;IF SET, TAPE MARK ENCOUNTERED
                          0D         055E       
            52            01     E0  055F  1357 	BBS	#MT_DS_V_BOT,R2,60$	;IF SET, BEGINNING OF TAPE
                          09         0562       
         77 A5            0F     91  0563  1358 	CMPB	#CDF_READDATAR,UCB$B_CEX(R5) ;LAST FUNCTION READ DATA?
                          9C     13  0567  1359 	BEQL	10$			;IF EQL YES
            50            00'    3C  0569  1360 50$:	MOVZWL	S^#SS$_NORMAL,R0	;SET NORMAL COMPLETION STATUS
                     0090 C5     D7  056C  1361 60$:	DECL	UCB$L_MT_RECORD(R5)	;DECREMENT TAPE POSITION
                          0217   31  0570  1362 	BRW	FUNCXT			;
                                     0573  1363  
                                     0573  1364 ;
                                     0573  1365 ; FUNCTION ENDED IN A RETRIABLE ERROR
                                     0573  1366 ;
                                     0573  1367  
                                     0573  1368 70$:	TESTR	130$			;TEST FOR RETRIES AND RELEASE CHANNEL
         6C A5         6E A5     A0  0578  1369 	ADDW	UCB$W_BCNT(R5),UCB$W_BOFF(R5) ;CALCULATE CORRECT BUFFER ADDRESS
         6C A5       0088 C5     A2  057D  1370 	SUBW	UCB$W_MT_FC(R5),UCB$W_BOFF(R5) ;
         6E A5       0088 C5     B0  0583  1371 	MOVW	UCB$W_MT_FC(R5),UCB$W_BCNT(R5) ;SET BYTE COUNT TO ACTUAL RECORD SIZE
         70 A5            08     91  0589  1372 	CMPB	#THRESHOLD,UCB$B_ERTCNT(R5) ;TIME TO USE ALTERNATE RECOVERY?
                          25     1B  058D  1373 	BLEQU	90$			;IF LEQU NO
       0094 C5            05     AE  058F  1374 	MNEGW	#ERR_SPACING,UCB$W_MT_FORCNT(R5) ;SET FORWARD SPACING COUNT
                                     0594  1375 80$:	EXFUNC	DOUBLE,F_SPCRECFOR	;SPACE RECORD FORWARD
                     0094 C5     B6  059C  1376 	INCW	UCB$W_MT_FORCNT(R5)	;ANY MORE RECORDS TO SPACE?
                          F2     19  05A0  1377 	BLSS	80$			;IF LSS YES
       008A C5            05     AE  05A2  1378 	MNEGW	#ERR_SPACING,UCB$W_MT_SPACNT(R5) ;SET REVERSE SPACE COUNT
                                     05A7  1379 	EXFUNC	DOUBLE,F_SPCRECREV	;SPACE RECORDS REVERSE
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page  29
01              READ DATA REVERSE AND WRITECHECK DATA REVERSE F                                                                  (1)

       008A C5            01     AE  05AF  1380 	MNEGW	#1,UCB$W_MT_SPACNT(R5)	;RESET SPACE COUNT FOR ONE RECORD
         77 A5            0D     91  05B4  1381 90$:	CMPB	#CDF_WRITECHECKR,UCB$B_CEX(R5) ;WRITE CHECK REVERSE?
                          49     13  05B8  1382 	BEQL	120$			;IF EQL YES
                                     05BA  1383 	REQSCHAN			;REQUEST SECONDARY CHANNEL
                                     05BD  1384 	EXFUNC	100$,F_READDATA		;READ DATA FORWARD
            51   00060974 8F     D3  05C5  1385 100$:	BITL	#MBA$M_SR_DLT!-		;DATA LATE OR,
                                     05CC  1386 		MBA$M_SR_INVMAP!-	;INVALID MAP REGISTER OR,
                                     05CC  1387 		MBA$M_SR_MAPPE!-	;MAP PARITY ERROR OR,
                                     05CC  1388 		MBA$M_SR_MCPE!-		;MASSBUS CONTROL PARITY ERROR OR,
                                     05CC  1389 		MBA$M_SR_MDPE!-		;MASSBUS DATA PARITY ERROR OR,
                                     05CC  1390 		MBA$M_SR_MXF!-		;MISSED TRANSFER OR,
                                     05CC  1391 		MBA$M_SR_NED!-		;NONEXISTENT DISK OR,
                                     05CC  1392 		MBA$M_SR_RDS,R1		;READ DATA SUBSTITUTE.
                          2B     12  05CC  1393 	BNEQ	110$			;IF NEQ YES
            50       3718 8F     B3  05CE  1394 	BITW	#MT_ER_M_CPAR!-		;CONTROL BUS PARITY ERRROR, OR
                                     05D3  1395 		MT_ER_M_DTE!-		;DRIVE TIMING ERROR ,OR
                                     05D3  1396 		MT_ER_M_FCE!-		;FRAME COUNT ERROR OR,
                                     05D3  1397 		MT_ER_M_FMT!-		;FORMAT ERROR OR,
                                     05D3  1398 		MT_ER_M_ITM!-		;INVALID TAPE MARK OR,
                                     05D3  1399 		MT_ER_M_NSG!-		;NONSTANDARD GAP OR,
                                     05D3  1400 		MT_ER_M_OPI,R0		;OPERATION INCOMPLETE.
                          24     12  05D3  1401 	BNEQ	110$			;IF NEQ YES
                                     05D5  1402 	RELSCHAN			;RELEASE SECONDARY I/O CHANNEL
                                     05D8  1403 	EXFUNC	DOUBLE,F_SPCRECREV	;SPACE RECORD REVERSE
                                     05E0  1404 	REQSCHAN			;REQUEST SECONDARY I/O CHANNEL
                                     05E3  1405 	EXFUNC	110$,F_READDATA		;READ DATA FORWARD
                                     05EB  1406 	RELSCHAN			;RELEASE SECONDARY I/O CHANNEL
                                     05EE  1407 	EXFUNC	DOUBLE,F_SPCRECREV	;SPACE RECORD REVERSE
                          FF0C   31  05F6  1408 	BRW	10$			;
                       70 A5     96  05F9  1409 110$:	INCB	UCB$B_ERTCNT(R5)	;BIAS ERROR RETRY COUNT
                                     05FC  1410 	TESTR	120$			;TEST FOR TAPE MOVEMENT
                          08     11  0601  1411 	BRB	130$			;
                                     0603  1412 120$:	EXFUNC	DOUBLE,F_SPCRECFOR	;SPACE RECORD FORWARD
                          FEEB   31  060B  1413 130$:	BRW	READDATAR		;
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page  30
01              WRITE DATA FORWARD FUNCTION                                                                                      (1)

                                     060E  1415 	.SBTTL	WRITE DATA FORWARD FUNCTION
                                     060E  1416 ;
                                     060E  1417 ; WRITE DATA FORWARD FUNCTION
                                     060E  1418 ;
                                     060E  1419  
                                     060E  1420 WRITEDATA:				;WRITE DATA FORWARD
                                     060E  1421 	REQSCHAN			;REQUEST SECONDARY CHANNEL
                                     0611  1422 	EXFUNC	20$,F_WRITEDATA		;EXECUTE FUNCTION
       008E C5            0E     E1  0619  1423 	BBC	#IO$V_DATACHECK,UCB$W_MT_FUNC(R5),10$ ;IF CLR, NO DATA CHECK
                          16         061E       
                                     061F  1424 	RELSCHAN			;RELEASE SECONDARY CHANNEL
                                     0622  1425 	EXFUNC	DOUBLE,F_SPCRECREV	;SPACE RECORD REVERSE
                                     062A  1426 	REQSCHAN			;REQUEST SECONDARY CHANNEL
                                     062D  1427 	EXFUNC	50$,F_WRITECHECK	;WRITE CHECK DATA
       0088 C5         6E A5     B0  0635  1428 10$:	MOVW	UCB$W_BCNT(R5),UCB$W_MT_FC(R5) ;SET TRANSFER BYTE COUNT
                     0090 C5     D6  063B  1429 	INCL	UCB$L_MT_RECORD(R5)	;INCREMENT TAPE POSITION
            50            00'    3C  063F  1430 	MOVZWL	S^#SS$_NORMAL,R0	;SET NORMAL COMPLETION STATUS
                          0145   31  0642  1431 	BRW	FUNCXT			;
                                     0645  1432  
                                     0645  1433 ;
                                     0645  1434 ; WRITE FUNCTION ENDED IN AN ERROR
                                     0645  1435 ;
                                     0645  1436 ; THE ERROR COULD BE A NONFATAL CONTROLLER OR DRIVE ERROR. FATAL ERRORS TERMINATE
                                     0645  1437 ; THE FUNCTION IN THE FUNCTION EXECUTOR.
                                     0645  1438 ;
                                     0645  1439 ; FATAL CONTROLLER ERRORS ARE:
                                     0645  1440 ;
                                     0645  1441 ;	ERCONF	= ERROR CONFIRMATION.
                                     0645  1442 ;	ISTO	= INTERFACE SEQUENCE TIMEOUT.
                                     0645  1443 ;	PGE	= PROGRAMMING ERROR.
                                     0645  1444 ;	NED	= NONEXISTENT DRIVE.
                                     0645  1445 ;	RDTO	= READ DATA TIMEOUT.
                                     0645  1446 ;
                                     0645  1447 ; FATAL DRIVE ERRORS ARE:
                                     0645  1448 ;
                                     0645  1449 ;	ILF	= ILLEGAL FUNCTION.
                                     0645  1450 ;	ILR	= ILLEGAL REGISTER.
                                     0645  1451 ;	NEF	= NONEXECUTABLE FUNCTION.
                                     0645  1452 ;	RMR	= REGISTER MODIFY REFUSE.
                                     0645  1453 ;	UNS	= UNSAFE.
                                     0645  1454 ;
                                     0645  1455 ; IGNORED DRIVE ERRORS ARE:
                                     0645  1456 ;
                                     0645  1457 ;	NONE.
                                     0645  1458 ;
                                     0645  1459  
       008E C5       4000 8F     A8  0645  1460 20$:	BISW	#IO$M_DATACHECK,UCB$W_MT_FUNC(R5) ;FORCE DATA CHECK
       0088 C5         6E A5     A0  064C  1461 	ADDW	UCB$W_BCNT(R5),UCB$W_MT_FC(R5) ;CALCULATE ACTUAL BYTES TRANSFERED
                                     0652  1462 	TESTR	30$			;TEST REMAINING RETRIES AND RELEASE CHANNEL
                                     0657  1463 	EXFUNC	DOUBLE,F_SPCRECREV	;SPACE RECORD REVERSE
       008E C5            0C     E0  065F  1464 30$:	BBS	#IO$V_INHEXTGAP,UCB$W_MT_FUNC(R5),40$ ;IF SET, NO EXTENDED GAP
                          08         0664       
                                     0665  1465 	EXFUNC	DOUBLE,F_ERASE		;ERASE TAPE
                          9F     11  066D  1466 40$:	BRB	WRITEDATA		;
                                     066F  1467  
                                     066F  1468 ;
                                     066F  1469 ; WRITECHECK FUNCTION ENDED IN ERROR
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page  31
01              WRITE DATA FORWARD FUNCTION                                                                                      (1)

                                     066F  1470 ;
                                     066F  1471 ; THE WRITECHECK ERROR IS NOT COUNTED AGAINST THE RETRY COUNT, BUT RATHER THE
                                     066F  1472 ; TAPE IS REPOSITIONED AND THE WRITE IS RETRIED.
                                     066F  1473 ;
                                     066F  1474  
       0088 C5         6E A5     A0  066F  1475 50$:	ADDW	UCB$W_BCNT(R5),UCB$W_MT_FC(R5) ;CALCULATE TRANSFERED BYTE COUNT
                       70 A5     96  0675  1476 	INCB	UCB$B_ERTCNT(R5)	;BIAS ERROR RETRY COUNT
                                     0678  1477 	TESTR	WRITEDATA		;TEST REMAINING RETRIES AND RELEASE CHANNEL
                                     067D  1478 	EXFUNC	DOUBLE,F_SPCRECREV	;SPACE RECORD REVERSE
                          87     11  0685  1479 	BRB	WRITEDATA		;
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page  32
01              CHECK FOR FATAL OR RETRIABLE SPACING ERROR                                                                       (1)

                                     0687  1481 	.SBTTL	CHECK FOR FATAL OR RETRIABLE SPACING ERROR
                                     0687  1482 ;
                                     0687  1483 ; CHECK_ERROR - CHECK FOR FATAL OR RETRIABLE SPACING ERROR
                                     0687  1484 ;
                                     0687  1485 ; THIS ROUTINE IS CALLED FROM THE SPACE FILE FORWARD, SPACE RECORD FORWARD, SPACE
                                     0687  1486 ; FILE REVERSE, AND SPACE RECORD REVERSE FUNCTION ROUTINES TO TEST WHETHER A
                                     0687  1487 ; SPACING ERROR IS FATAL AND WHETHER ANY RETRIES REMAIN.
                                     0687  1488 ;
                                     0687  1489 ; INPUTS:
                                     0687  1490 ;
                                     0687  1491 ;	R0 = DRIVE ERROR REGISTER.
                                     0687  1492 ;	R1 = MBA STATUS REGISTER.
                                     0687  1493 ;	R2 = DRIVE STATUS REGISTER.
                                     0687  1494 ;
                                     0687  1495 ;	UCB$B_CEX(R5) = FUNCTION INDEX OF LAST FUNCTION EXECUTED.
                                     0687  1496 ;	UCB$B_ERTCNT(R5) = NUMBER OF ERROR RETRIES REMAINING.
                                     0687  1497 ;	UCB$W_BCNT(R5) = ORIGINAL SPACING COUNT.
                                     0687  1498 ;	UCB$W_BOFF(R5) = REMAINING SPACING COUNT.
                                     0687  1499 ;
                                     0687  1500 ; OUTPUTS:
                                     0687  1501 ;
                                     0687  1502 ;	IF ONLY A FRAME COUNT ERROR OCCURED, OR THE FUNCTION WAS A REVERSE DIRECTION
                                     0687  1503 ;	FUNCTION AND A CONTROL BUS PARITY ERROR DID NOT OCCUR, THEN AN IMMEDIATE
                                     0687  1504 ;	RETURN TO THE CALLER IS EXECUTED. ELSE THE REMAINING RETRY COUNT IS DE-
                                     0687  1505 ;	CREMENTED, AND IF THE RESULT IS ZERO, THEN THE FUNCTION IS TERMINATED VIA
                                     0687  1506 ;	THE DOUBLE ERROR EXIT. ELSE THE FUNCTION IS REDISPATCHED.
                                     0687  1507 ;
                                     0687  1508  
                                     0687  1509 CHECK_ERROR:				;
                          51   8ED0  0687  1510 	POPL	R1			;REMOVE RETURN ADDRESS FROM STACK
            50       FDFF 8F     B3  068A  1511 	BITW	#^C<MT_ER_M_FCE>,R0	;RETRIABLE OR FATAL ERROR?
                          14     13  068F  1512 	BEQL	20$			;IF EQL NO
                                     0691  1513  
                                     0691  1514 ;
                                     0691  1515 ; RETRIABLE OR FATAL DRIVE ERROR
                                     0691  1516 ;
                                     0691  1517 ;	CPAR	= CONTROL BUS PARITY ERROR.
                                     0691  1518 ;	NEF	= NONEXECUTABLE FUNCTION.
                                     0691  1519 ;	OPI	= OPERATION INCOMPLETE.
                                     0691  1520 ;
                                     0691  1521  
            50            03     E0  0691  1522 	BBS	#MT_ER_V_CPAR,R0,40$	;IF SET, CONTROL BUS PARITY ERROR
                          16         0694       
                                     0695  1523  
                                     0695  1524 ;
                                     0695  1525 ; ERROR WAS EITHER A NONEXECUTABLE FUNCTION OR OPERATION INCOMPLETE
                                     0695  1526 ;
                                     0695  1527  
         77 A5            05     91  0695  1528 	CMPB	#CDF_SPCFILREV,UCB$B_CEX(R5) ;SPACE FILE REVERSE?
                          06     13  0699  1529 	BEQL	10$			;IF EQL YES
         77 A5            07     91  069B  1530 	CMPB	#CDF_SPCRECREV,UCB$B_CEX(R5) ;SPACE RECORD REVERSE?
                          06     12  069F  1531 	BNEQ	30$			;IF NEQ NO
            52            01     E1  06A1  1532 10$:	BBC	#MT_DS_V_BOT,R2,30$	;IF CLR, NOT AT BEGINNING OF TAPE
                          02         06A4       
                          61     17  06A5  1533 20$:	JMP	(R1)			;
                                     06A7  1534  
                                     06A7  1535 ;
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page  33
01              CHECK FOR FATAL OR RETRIABLE SPACING ERROR                                                                       (1)

                                     06A7  1536 ; FORCE FATAL ERROR ON NONEXECUTABLE FUNCTION OR OPERATION INCOMPLETE FOR A FORWARD
                                     06A7  1537 ; DIRECTION FUNCTION, OR A REVERSE DIRECTION FUNCTION THAT DID NOT END UP AT BEGINNI
                                     06A7  1538 ; OF TAPE.
                                     06A7  1539 ;
                                     06A7  1540  
         70 A5            01     90  06A7  1541 30$:	MOVB	#1,UCB$B_ERTCNT(R5)	;SET RETRY COUNT TO ONE
                                     06AB  1542  
                                     06AB  1543 ;
                                     06AB  1544 ; ERROR WAS A CONTROL BUS PARITY ERROR OR A NONEXECUTABLE FUNCTION OR OPERATION
                                     06AB  1545 ; INCOMPLETE IN COMBINATION WITH A REVERSE DIRECTION FUNCTION
                                     06AB  1546 ;
                                     06AB  1547  
                       6C A5     A3  06AB  1548 40$:	SUBW3	UCB$W_BOFF(R5),UCB$W_BCNT(R5),- ;CALCULATE TOTAL SPACE COUNT
       0088 C5         6E A5         06AE  1549 		UCB$W_MT_FC(R5)		;
                          F94A'  30  06B3  1550 	BSBW	ERL$DEVICERR		;LOG DEVICE ERROR
                       70 A5     97  06B6  1551 	DECB	UCB$B_ERTCNT(R5)	;ANY RETRIES REMAINING?
                          5C     13  06B9  1552 	BEQL	DOUBLE			;IF EQL NO
                          FB5F   31  06BB  1553 	BRW	FDISPATCH		;
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page  34
01              TEST FOR REMAINING RETRIES                                                                                       (1)

                                     06BE  1555 	.SBTTL	TEST FOR REMAINING RETRIES
                                     06BE  1556 ;
                                     06BE  1557 ; TESTR - TEST FOR REMAINING RETRIES
                                     06BE  1558 ;
                                     06BE  1559 ; THIS ROUTINE IS CALLED FROM THE READ DATA, READ DATA REVERSE, WRITECHECK,
                                     06BE  1560 ; WRITECHECK REVERSE, WRITE DATA, AND WRITE TAPE MARK FUNCTION ROUTINES TO
                                     06BE  1561 ; TEST FOR REMAINING RETRIES.
                                     06BE  1562 ;
                                     06BE  1563 ; INPUTS:
                                     06BE  1564 ;
                                     06BE  1565 ;	R0 = DRIVE ERROR REGISTER.
                                     06BE  1566 ;	R1 = MBA STATUS REGISTER.
                                     06BE  1567 ;	R2 = DRIVE STATUS REGISTER.
                                     06BE  1568 ;
                                     06BE  1569 ;	UCB$B_CEX(R5) = FUNCTION INDEX OF LAST FUNCTION EXECUTED.
                                     06BE  1570 ;	UCB$B_ERTCNT(R5) = NUMBER OF ERROR RETRIES REMAINING.
                                     06BE  1571 ;	UCB$L_MT_RECORD(R5) = CURRENT TAPE POSITION BEFORE FUNCTION EXECUTION.
                                     06BE  1572 ;	UCB$W_MT_DS(R5) = SAVED DRIVE STATUS REGISTER.
                                     06BE  1573 ;	UCB$W_MT_FUNC(R5) = ORIGINAL FUNCTION WORD.
                                     06BE  1574 ;	UCB$W_MT_FC(R5) = NUMBER OF BYTES THAT WERE READ OR WRITTEN TO/FROM TAPE.
                                     06BE  1575 ;
                                     06BE  1576 ;	@(SP) = SIGNED BRANCH DISPLACEMENT TO CONDITIONAL EXIT POINT.
                                     06BE  1577 ;
                                     06BE  1578 ; OUTPUTS:
                                     06BE  1579 ;
                                     06BE  1580 ;	THE REMAINING RETRY COUNT IS DECREMENTED AND IF THE RESULT IS ZERO, THEN
                                     06BE  1581 ;	THE FUNCTION IS TERMINATED WITH AN ERROR VIA THE FATAL ERROR EXIT AFTER
                                     06BE  1582 ;	HAVING ADJUSTED THE CURRENT TAPE POSITION. ELSE THE SECONDARY CHANNEL IS
                                     06BE  1583 ;	RELEASED AND THE CONDITIONAL BRANCH EXIT IS TAKEN IF NO TAPE MOVEMENT
                                     06BE  1584 ;	OCCURED.
                                     06BE  1585 ;
                                     06BE  1586  
                                     06BE  1587 TESTR:					;
                          F93F'  30  06BE  1588 	BSBW	ERL$DEVICERR		;LOG DEVICE ERROR
                       70 A5     97  06C1  1589 	DECB	UCB$B_ERTCNT(R5)	;ANY RETRIES REMAINING?
                          1B     13  06C4  1590 	BEQL	20$			;IF EQL NO
                                     06C6  1591 	RELSCHAN			;RELEASE SECONDARY I/O CHANNEL
       0088 C5            0E     B1  06C9  1592 	CMPW	#MIN_RECORD,UCB$W_MT_FC(R5) ;ANY TAPE MOVEMENT?
                          0D     1B  06CE  1593 	BLEQU	10$			;IF LEQU YES
       0084 C5            02     E0  06D0  1594 	BBS	#MT_DS_V_TM,UCB$W_MT_DS(R5),10$ ;IF SET, TAPE MARK DETECTED
                          07         06D5       
            7E         00 BE     32  06D6  1595 	CVTWL	@(SP),-(SP)		;GET DISPLACEMENT VALUE
            6E            8E     C0  06DA  1596 	ADDL	(SP)+,(SP)		;CALCULATE BRANCH ADDRESS
            6E            02     C0  06DD  1597 10$:	ADDL	#2,(SP)			;
                                 05  06E0  1598 	RSB				;
                                     06E1  1599  
                                     06E1  1600 ;
                                     06E1  1601 ; ERROR RETRIES EXHAUSTED
                                     06E1  1602 ;
                                     06E1  1603 ; CHECK FOR TAPE MOVEMENT, ADJUST TAPE POSITION AS APPROPRIATE, AND TAKE FATAL
                                     06E1  1604 ; ERROR EXIT.
                                     06E1  1605 ;
                                     06E1  1606  
                          8E     D5  06E1  1607 20$:	TSTL	(SP)+			;REMOVE RETURN FROM STACK
       0084 C5            02     E0  06E3  1608 	BBS	#MT_DS_V_TM,UCB$W_MT_DS(R5),30$ ;IF SET, TAPE MARK DETECTED
                          07         06E8       
       0088 C5            0E     B1  06E9  1609 	CMPW	#MIN_RECORD,UCB$W_MT_FC(R5) ;ANY TAPE MOVEMENT?
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page  35
01              TEST FOR REMAINING RETRIES                                                                                       (1)

                          15     1A  06EE  1610 	BGTRU	40$			;IF GTRU NO
                     0090 C5     D7  06F0  1611 30$:	DECL	UCB$L_MT_RECORD(R5)	;ASSUME REVERSE TAPE OPERATION
         77 A5            0F     91  06F4  1612 	CMPB	#CDF_READDATAR,UCB$B_CEX(R5) ;READ DATA REVERSE?
                          0B     13  06F8  1613 	BEQL	40$			;IF EQL YES
         77 A5            0D     91  06FA  1614 	CMPB	#CDF_WRITECHECKR,UCB$B_CEX(R5) ;WRITE CHECK REVERSE?
                          05     13  06FE  1615 	BEQL	40$			;IF EQL YES
       0090 C5            02     C0  0700  1616 	ADDL	#2,UCB$L_MT_RECORD(R5)	;ADJUST FOR FORWARD TAPE OPERATION
                          0013   31  0705  1617 40$:	BRW	FATALERR		;
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page  36
01              TAPE POSITION LOST                                                                                               (1)

                                     0708  1619 	.SBTTL	TAPE POSITION LOST
                                     0708  1620 ;
                                     0708  1621 ; TAPE POSITION LOST
                                     0708  1622 ;
                                     0708  1623  
                                     0708  1624 LOSTPOS:				;
         3E A5            10     A8  0708  1625 	BISW	#<MT$M_LOST@-16>,UCB$L_DEVDEPEND+2(R5) ;SET TAPE POSITION LOST
                                     070C  1626  
                                     070C  1627 ;
                                     070C  1628 ; TEST FOR RETRY
                                     070C  1629 ;
                                     070C  1630  
                                     070C  1631 RETRY:					;TEST FOR RETRY
                          F8F1'  30  070C  1632 	BSBW	ERL$DEVICERR		;LOG DEVICE ERROR
                       70 A5     97  070F  1633 	DECB	UCB$B_ERTCNT(R5)	;ANY RETRIES REMAINING?
                          07     13  0712  1634 	BEQL	FATALERR		;IF EQL NO
                          FB06   31  0714  1635 	BRW	FDISPATCH		;
                                     0717  1636  
                                     0717  1637 ;
                                     0717  1638 ; DOUBLE ERROR WHILE TRYING TO REPOSITION TAPE - TAPE POSITION LOST
                                     0717  1639 ;
                                     0717  1640  
                                     0717  1641 DOUBLE:					;
         3E A5            10     A8  0717  1642 	BISW	#<MT$M_LOST@-16>,UCB$L_DEVDEPEND+2(R5) ;SET LOST POSITION STATUS
                                     071B  1643  
                                     071B  1644 ;
                                     071B  1645 ; FATAL CONTROLLER/DRIVE ERROR, ERROR RETRY COUNT EXHAUSTED, ERROR RETRY
                                     071B  1646 ; INHIBITED, OR FINAL OFFSET TRIED
                                     071B  1647 ;
                                     071B  1648  
                                     071B  1649 FATALERR:				;FATAL ERROR - SET STATUS
            53            50     D0  071B  1650 	MOVL	R0,R3			;COPY ERROR STATUS REGISTER
            50       0000'8F     3C  071E  1651 	MOVZWL	#SS$_MEDOFL,R0		;SET MEDIUM OFFLINE STATUS
            52            0C     E1  0723  1652 	BBC	#MT_DS_V_MOL,R2,FUNCXT	;IF CLR, MEDIUM OFFLINE
                          63         0726       
            53            0B     E1  0727  1653 	BBC	#MT_ER_V_NEF,R3,10$	;IF CLR, EXECUTABLE FUNCTION
                          09         072A       
            50       0000'8F     3C  072B  1654 	MOVZWL	#SS$_WRITLCK,R0		;SET WRITE LOCK ERROR STATUS
            52            0B     E0  0730  1655 	BBS	#MT_DS_V_WRL,R2,FUNCXT	;IF SET, DRIVE HARDWARE WRITE LOCKED
                          56         0733       
            50       0000'8F     3C  0734  1656 10$:	MOVZWL	#SS$_UNSAFE,R0		;SET DRIVE UNSAFE STATUS
            53            0E     E0  0739  1657 	BBS	#MT_ER_V_UNS,R3,FUNCXT	;IF SET, DRIVE UNSAFE
                          4D         073C       
            50       0000'8F     3C  073D  1658 	MOVZWL	#SS$_OPINCOMPL,R0	;SET OPERATION INCOMPLETE STATUS
            53            0D     E0  0742  1659 	BBS	#MT_ER_V_OPI,R3,FUNCXT	;IF SET, OPERATION INCOMPLETE
                          44         0745       
            50       0000'8F     3C  0746  1660 	MOVZWL	#SS$_FORMAT,R0		;SET FORMAT ERROR STATUS
            53            04     E0  074B  1661 	BBS	#MT_ER_V_FMT,R3,FUNCXT	;IF SET, FORMAT ERROR
                          3B         074E       
            50       0000'8F     3C  074F  1662 	MOVZWL	#SS$_DRVERR,R0		;SET DRIVE ERROR STATUS
            53       1807 8F     B3  0754  1663 	BITW	#MT_ER_M_DTE!-		;DRIVE TIMING ERROR OR,
                                     0759  1664 		MT_ER_M_ILF!-		;ILLEGAL FUNCTION OR,
                                     0759  1665 		MT_ER_M_ILR!-		;ILLEGAL REGISTER OR,
                                     0759  1666 		MT_ER_M_NEF!-		;NON-EXECUTABLE FUNCTION OR,
                                     0759  1667 		MT_ER_M_RMR,R3		;REGISTER MODIFY REFUSE
                          2F     12  0759  1668 	BNEQ	FUNCXT			;IF NEQ YES
            50       0000'8F     3C  075B  1669 	MOVZWL	#SS$_PARITY,R0		;SET PARITY ERROR STATUS
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page  37
01              TAPE POSITION LOST                                                                                               (1)

            53       85E8 8F     B3  0760  1670 	BITW	#MT_ER_M_CRC!-		;CRC ERROR OR,
                                     0765  1671 		MT_ER_M_CPAR!-		;CONTROL BUS PARITY ERROR OR,
                                     0765  1672 		MT_ER_M_COR!-		;CORRECTABLE DATA ERROR (PE) OR,
                                     0765  1673 		MT_ER_M_CS!-		;CORRECTABLE SKEW (PE) OR,
                                     0765  1674 		MT_ER_M_DPAR!-		;DATA PARITY ERROR OR,
                                     0765  1675 		MT_ER_M_INC!-		;INCORRECTABLE ERROR (PE) OR,
                                     0765  1676 		MT_ER_M_ITM!-		;INVALID TAPE MARK OR,
                                     0765  1677 		MT_ER_M_LRC!-		;LONGITUDINAL PARITY ERROR (NRZI) OR,
                                     0765  1678 		MT_ER_M_NSG!-		;NONSTANDARD GAP OR,
                                     0765  1679 		MT_ER_M_PEF!-		;FORMAT ERROR (PE) OR,
                                     0765  1680 		MT_ER_M_VPE,R3		;VERTICLE PARITY ERROR (NRZI)?
                          23     12  0765  1681 	BNEQ	FUNCXT			;IF NEQ YES
            51   00020064 8F     D3  0767  1682 	BITL	#MBA$M_SR_MAPPE!-	;MAP PARITY ERROR OR,
                                     076E  1683 		MBA$M_SR_MCPE!-		;MASSBUS CONTROL PARITY ERROR OR,
                                     076E  1684 		MBA$M_SR_MDPE!-		;MASSBUS DATA PARITY ERROR OR,
                                     076E  1685 		MBA$M_SR_RDS,R1		;READ DATA SUBSTITUTE?
                          1A     12  076E  1686 	BNEQ	FUNCXT			;IF NEQ YES
            50       0000'8F     3C  0770  1687 	MOVZWL	#SS$_DATACHECK,R0	;SET DATA CHECK ERROR STATUS
            51       0600 8F     B3  0775  1688 	BITW	#MBA$M_SR_WCKLWR!-	;WRITE CHECK ERROR LOWER BYTE OR,
                                     077A  1689 		MBA$M_SR_WCKUPR,R1	;WRITE CHECK ERROR UPPER BYTE?
                          0E     12  077A  1690 	BNEQ	FUNCXT			;IF NEQ YES
            50       0000'8F     3C  077C  1691 	MOVZWL	#SS$_NONEXDRV,R0	;SET NONEXISTENT DRIVE STATUS
            51            12     E0  0781  1692 	BBS	#MBA$V_SR_NED,R1,FUNCXT	;IF SET, NONEXISTENT DRIVE
                          05         0784       
            50       0000'8F     3C  0785  1693 	MOVZWL	#SS$_CTRLERR,R0		;SET CONTROLLER ERROR STATUS
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page  38
01              FUNCTION COMPLETION COMMON EXIT                                                                                  (1)

                                     078A  1695 	.SBTTL	FUNCTION COMPLETION COMMON EXIT
                                     078A  1696 ;
                                     078A  1697 ; FUNCTION COMPLETION COMMON EXIT
                                     078A  1698 ;
                                     078A  1699 ; THIS ROUTINE IS JUMPED TO AT THE END OF ALL MAGTAPE OPERATIONS.
                                     078A  1700 ;
                                     078A  1701 ; INPUTS:
                                     078A  1702 ;
                                     078A  1703 ;	R0 = FINAL I/O COMPLETION STATUS.
                                     078A  1704 ;	R2 = DRIVE STATUS REGISTER.
                                     078A  1705 ;
                                     078A  1706 ;	UCB$B_FEX(R5) = FUNCTION EXECUTION INDEX.
                                     078A  1707 ;
                                     078A  1708 ; OUTPUTS:
                                     078A  1709 ;
                                     078A  1710 ;	THE FINAL DRIVE STATUS IS TESTED AND THE FOLLOWING STATUS BITS ARE SET
                                     078A  1711 ;	IN THE SECOND WORD OF THE DEVICE DEPENDENT CHARACTERISTICS LONGWORD.
                                     078A  1712 ;
                                     078A  1713 ;		MT$M_BOT = SET IF TAPE IS AT BEGINNING OF TAPE AT END OF FUNCTION.
                                     078A  1714 ;		MT$M_EOF = SET IF A VALID TAPE MARK WAS DETECTED DURING THE TAPE
                                     078A  1715 ;			OPERATION.
                                     078A  1716 ;		MT$M_EOT = SET IF AN END OF TAPE CONDITION WAS PRESENT AT THE END
                                     078A  1717 ;			OF THE TAPE OPERATION AND THE FUNCTION WAS A READ DATA
                                     078A  1718 ;			FORWARD, WRITECHECK DATA FORWARD, WRITE DATA FORWARD, OR
                                     078A  1719 ;			SPACE RECORD FORWARD FUNCTION.
                                     078A  1720 ;		MT$M_HWL = SET IF THE SLAVE DRIVE HAS A TAPE MOUNTED THAT DOES NOT
                                     078A  1721 ;			CONTAIN A WRITE RING.
                                     078A  1722 ;
                                     078A  1723  
                                     078A  1724 FUNCXT:					;FUNCTION EXIT
            51         76 A5     9A  078A  1725 	MOVZBL	UCB$B_FEX(R5),R1	;GET FUNCTION DISPATCH INDEX
         3E A5            0F     AA  078E  1726 	BICW	#<MT$M_BOT!-		;CLEAR BEGINNING OF TAPE AND,
                                     0792  1727 		MT$M_EOF!-		;END OF FILE AND,
                                     0792  1728 		MT$M_EOT!-		;END OF TAPE AND,
                                     0792  1729 		MT$M_HWL>@-16,UCB$L_DEVDEPEND+2(R5) ;HARDWARE WRITE LOCK
            52            01     E1  0792  1730 	BBC	#MT_DS_V_BOT,R2,10$	;IF CLR, NOT AT BEGINNING OF TAPE
                          0C         0795       
         3E A5            01     A8  0796  1731 	BISW	#<MT$M_BOT@-16>,UCB$L_DEVDEPEND+2(R5) ;SET BEGINNING OF TAPE
         3E A5            10     AA  079A  1732 	BICW	#<MT$M_LOST@-16>,UCB$L_DEVDEPEND+2(R5) ;CLEAR TAPE POSITION LOST
                     0090 C5     D4  079E  1733 	CLRL	UCB$L_MT_RECORD(R5)	;CLEAR TAPE POSITION
            52            02     E1  07A2  1734 10$:	BBC	#MT_DS_V_TM,R2,30$	;IF CLR, NO TAPE MARK DETECTED
                          23         07A5       
         3E A5            02     A8  07A6  1735 	BISW	#<MT$M_EOF@-16>,UCB$L_DEVDEPEND+2(R5) ;SET END OF FILE
            51            0A     91  07AA  1736 	CMPB	#CDF_WRITECHECK,R1	;DATA TRANSFER FUNCTION?
                          1A     1A  07AD  1737 	BGTRU	30$			;IF GTRU NO
            51            12     91  07AF  1738 	CMPB	#CDF_WRITEMARK,R1	;WRITE TAPE MARK FUNCTION?
                          05     13  07B2  1739 	BEQL	20$			;IF EQL YES
            51            10     91  07B4  1740 	CMPB	#CDF_READPRESET,R1	;DATA TRANSFER FUNCTION?
                          10     1B  07B7  1741 	BLEQU	30$			;IF LEQU NO
                     0088 C5     B4  07B9  1742 20$:	CLRW	UCB$W_MT_FC(R5)		;CLEAR FRAME COUNT
            50       0000'8F     B1  07BD  1743 	CMPW	#SS$_DATACHECK,R0	;WRITE CHECK ERROR?
                          05     12  07C2  1744 	BNEQ	30$			;IF NEQ NO
            50       0000'8F     3C  07C4  1745 	MOVZWL	#SS$_ENDOFFILE,R0	;SET END OF FILE STATUS
            52            0A     E1  07C9  1746 30$:	BBC	#MT_DS_V_EOT,R2,40$	;IF CLR, NOT AT END OF TAPE
                          20         07CC       
            51            05     91  07CD  1747 	CMPB	#CDF_SPCFILREV,R1	;SPACE FILE REVERSE?
                          1B     13  07D0  1748 	BEQL	40$			;IF EQL YES
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page  39
01              FUNCTION COMPLETION COMMON EXIT                                                                                  (1)

            51            07     91  07D2  1749 	CMPB	#CDF_SPCRECREV,R1	;SPACE RECORD REVERSE?
                          16     13  07D5  1750 	BEQL	40$			;IF EQL YES
            51            0D     91  07D7  1751 	CMPB	#CDF_WRITECHECKR,R1	;WRITE CHECK REVERSE?
                          11     13  07DA  1752 	BEQL	40$			;IF EQL YES
            51            0F     91  07DC  1753 	CMPB	#CDF_READDATAR,R1	;READ DATA REVERSE?
                          0C     13  07DF  1754 	BEQL	40$			;IF EQL YES
         3E A5            04     A8  07E1  1755 	BISW	#<MT$M_EOT@-16>,UCB$L_DEVDEPEND+2(R5) ;SET END OF TAPE
            05            50     E9  07E5  1756 	BLBC	R0,40$			;IF LBC ALREADY RETURNING ERROR
            50       0000'8F     3C  07E8  1757 	MOVZWL	#SS$_ENDOFTAPE,R0	;SET END OF TAPE STATUS
            52            0B     E1  07ED  1758 40$:	BBC	#MT_DS_V_WRL,R2,50$	;IF CLR, NOT HARDWARE WRITE LOCKED
                          04         07F0       
         3E A5            08     A8  07F1  1759 	BISW	#<MT$M_HWL@-16>,UCB$L_DEVDEPEND+2(R5) ;SET HARDWARE WRITE LOCKED
                          50     DD  07F5  1760 50$:	PUSHL	R0			;SAVE FINAL STATUS
                          F806'  30  07F7  1761 	BSBW	IOC$DIAGBUFILL		;FILL DIAGNOSTIC BUFFER IF PRESENT
         02 AE       0088 C5     B0  07FA  1762 	MOVW	UCB$W_MT_FC(R5),2(SP)	;SET BYTES TRANSFERED OR RECORDS/FILES SKIPPED
            32            6E     E8  0800  1763 	BLBS	(SP),70$		;IF LBS SUCCESSFUL COMPLETION
            54         4C A5     D0  0803  1764 	MOVL	UCB$L_IRP(R5),R4	;GET ADDRESS OF CURRENT I/O PACKET
         2A A4            04     E1  0807  1765 	BBC	#IRP$V_VIRTUAL,IRP$W_STS(R4),70$ ;IF CLR, NOT VIRTUAL FUNCTION
                          29         080B       
            54         18 A4     D0  080C  1766 	MOVL	IRP$L_WIND(R4),R4	;GET ADDRESS OF WINDOW BLOCK
                       16 A4     B4  0810  1767 	CLRW	WCB$W_NMAP(R4)		;CLEAR NUMBER OF MAPPING POINTERS
            54         30 A5     D0  0813  1768 	MOVL	UCB$L_VCB(R5),R4	;GET ADDRESS OF VCB
                                     0817  1769 ;	MOVAB	VCB$L_FCBFL(R4),R4	;GET ADDRESS OF BLOCKED I/O LISTHEAD
            53            54     D0  0817  1770 	MOVL	R4,R3			;SET ADDRESS OF PREVIOUS ENTRY
            53            63     D0  081A  1771 60$:	MOVL	(R3),R3			;GET ADDRESS OF NEXT ENTRY
            54            53     D1  081D  1772 	CMPL	R3,R4			;END OF LIST?
                          13     13  0820  1773 	BEQL	70$			;IF EQL YES
         2A A3            04     E1  0822  1774 	BBC	#IRP$V_VIRTUAL,IRP$W_STS(R3),60$ ;IF CLR, NOT VIRTUAL FUNCTION
                          F3         0826       
            53         04 A3     D0  0827  1775 	MOVL	4(R3),R3		;RETRIEVE ADDRESS OF PREVIOUS ENTRY
            52         00 B3     0F  082B  1776 	REMQUE	@(R3),R2		;REMOVE ENTRY FROM DRIVER QUEUE
         04 B4            62     0E  082F  1777 	INSQUE	(R2),@4(R4)		;INSERT ENTRY IN BLOCKED I/O LIST
                          E5     11  0833  1778 	BRB	60$			;
                          50   8ED0  0835  1779 70$:	POPL	R0			;RETRIEVE FINAL STATUS
            51         3C A5     D0  0838  1780 STSXIT:	MOVL	UCB$L_DEVDEPEND(R5),R1	;SET MAGTAPE STATUS AND CHARACTERISTICS
                                     083C  1781 	REQCOM				;COMPLETE REQUEST
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page  40
01              TM03-TE16/TU77 HARDWARE FUNCTION EXECUTION                                                                       (1)

                                     083F  1783 	.SBTTL	TM03-TE16/TU77 HARDWARE FUNCTION EXECUTION
                                     083F  1784 ;
                                     083F  1785 ; FEX - TM03-TE16/TU77 HARDWARE FUNCTION EXECUTION
                                     083F  1786 ;
                                     083F  1787 ; THIS ROUTINE IS CALLED VIA A BSB WITH A WORD IMMEDIATELY FOLLOWING THAT
                                     083F  1788 ; SPECIFIES THE ADDRESS OF AN ERROR ROUTINE. ALL DATA IS ASSUMED TO HAVE BEEN
                                     083F  1789 ; SET UP IN THE UCB BEFORE THE CALL. THE APPROPRIATE PARAMETERS ARE LOADED
                                     083F  1790 ; INTO DEVICE REGISTERS AND THE FUNCTION IS INITIATED. IF THE FUNCTION IS AN
                                     083F  1791 ; IMMEDIATE FUNCTION CONTROL RETURNS IMMEDIATELY. ELSE THE RETURN ADDRESS
                                     083F  1792 ; IS STORED IN THE UCB AND A WAITFOR INTERRUPT IS EXECUTED. WHEN THE INTER-
                                     083F  1793 ; RUPT OCCURS, CONTROL IS RETURNED TO THE CALLER.
                                     083F  1794 ;
                                     083F  1795 ; INPUTS:
                                     083F  1796 ;
                                     083F  1797 ;	R0 = FUNCTION TABLE DISPATCH INDEX.
                                     083F  1798 ;	R3 = ADDRESS OF DRIVE CONTROL STATUS REGISTER 1.
                                     083F  1799 ;	R4 = ADDRESS OF MBA CONFIGURATION STATUS REGISTER.
                                     083F  1800 ;	R5 = DEVICE UNIT UCB ADDRESS.
                                     083F  1801 ;
                                     083F  1802 ;	00(SP) = RETURN ADDRESS OF CALLER.
                                     083F  1803 ;	04(SP) = RETURN ADDRESS OF CALLER'S CALLER.
                                     083F  1804 ;
                                     083F  1805 ;	IMMEDIATELY FOLLOWING INLINE AT THE CALL SITE IS A WORD WHICH CONTAINS
                                     083F  1806 ;	A BRANCH DESTINATION TO AN ERROR RETRY ROUTINE.
                                     083F  1807 ;
                                     083F  1808 ; OUTPUTS:
                                     083F  1809 ;
                                     083F  1810 ;	THERE ARE FOUR EXITS FROM THIS ROUTINE:
                                     083F  1811 ;
                                     083F  1812 ;	1. SPECIAL CONDITION - THIS EXIT IS TAKEN IF A POWER FAILURE OCCURS
                                     083F  1813 ;		OR THE OPERATION TIMES OUT. IT IS A JUMP TO THE APPROPRIATE
                                     083F  1814 ;		ERROR ROUTINE.
                                     083F  1815 ;
                                     083F  1816 ;	2. FATAL ERROR - THIS EXIT IS TAKEN IF A FATAL CONTROLLER OR DRIVE
                                     083F  1817 ;		ERROR OCCURS OR IF ANY ERROR OCCURS AND ERROR RETRY IS
                                     083F  1818 ;		INHIBITED. IT IS A JUMP TO THE FATAL ERROR EXIT ROUTINE.
                                     083F  1819 ;
                                     083F  1820 ;	3. RETRIABLE ERROR - THIS EXIT IS TAKEN IF A RETRIABLE CONTROLLER
                                     083F  1821 ;		OR DRIVE ERROR OCCURS AND ERROR RETRY IS NOT INHIBITED.
                                     083F  1822 ;		IT CONSISTS OF TAKING THE ERROR BRANCH EXIT.
                                     083F  1823 ;
                                     083F  1824 ;	4. SUCCESSFUL OPERATION - THIS EXIT IS TAKEN IF NO ERROR OCCURS
                                     083F  1825 ;		DURING THE OPERATION. IT CONSISTS OF A RETURN INLINE.
                                     083F  1826 ;
                                     083F  1827 ;	IN ALL CASES IF AN ERROR OCCURS, AN ATTEMPT IS MADE TO LOG THE ERROR.
                                     083F  1828 ;
                                     083F  1829 ;	IN ALL CASES FINAL DRIVE AND CONTROLLER REGISTERS ARE RETURNED VIA
                                     083F  1830 ;	THE GENERAL REGISTERS R0, R1, AND R2, AND THE UCB.
                                     083F  1831 ;
                                     083F  1832 ;	R0 = DRIVE ERROR REGISTER.
                                     083F  1833 ;	R1 = MBA STATUS REGISTER.
                                     083F  1834 ;	R2 = DRIVE STATUS REGISTER.
                                     083F  1835 ;
                                     083F  1836 ;	UCB$W_MT_FC(R5) = FRAME COUNT REGISTER.
                                     083F  1837 ;
                                     083F  1838  
                                     083F  1839 FEX:					;FUNCTION EXECUTOR
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page  41
01              TM03-TE16/TU77 HARDWARE FUNCTION EXECUTION                                                                       (1)

                       7C A5   8ED0  083F  1840 	POPL	UCB$L_DPC(R5)		;SAVE DRIVER PC VALUE
         24 A3       0096 C5     3C  0843  1841 	MOVZWL	UCB$W_MT_TC(R5),MT_TC(R3) ;SELECT DRIVE AND SET CHARACTERISTICS
            63            09     9A  0849  1842 	MOVZBL	#F_DRVCLR!1,MT_CS1(R3)	;CLEAR DRIVE
         77 A5            50     90  084C  1843 	MOVB	R0,UCB$B_CEX(R5)	;SAVE CASE INDEX
                                     0850  1844 	CASE	R0,<-			;DISPATCH TO PROPER FUNCTION ROUTINE
                                     0850  1845 		IMMED,-			;NO OPERATION
                                     0850  1846 		POSIT,-			;UNLOAD VOLUME
                                     0850  1847 		POSIT,-			;SPACE FILE FORWARD
                                     0850  1848 		RECAL,-			;REWIND
                                     0850  1849 		IMMED,-			;DRIVE CLEAR
                                     0850  1850 		POSIT,-			;SPACE FILE REVERSE
                                     0850  1851 		POSIT,-			;ERASE TAPE
                                     0850  1852 		POSIT,-			;SPACE RECORD REVERSE
                                     0850  1853 		IMMED,-			;SET TAPE CHARACTERISTICS
                                     0850  1854 		POSIT,-			;SPACE RECORD FORWARD
                                     0850  1855 		XFER,-			;WRITE CHECK FORWARD
                                     0850  1856 		XFER,-			;WRITE DATA FORWARD
                                     0850  1857 		XFER,-			;READ DATA FORWARD
                                     0850  1858 		XFER,-			;WRITECHECK REVERSE
                                     0850  1859 		XFER,-			;WRITE DATA FORWARD
                                     0850  1860 		XFER,-			;READ DATA REVERSE
                                     0850  1861 		RECAL,-			;READ IN PRESET
                                     0850  1862 		IMMED,-			;SENSE CHARACTERISTICS
                                     0850  1863 		>			;
                                     0878  1864  
                                     0878  1865 ;
                                     0878  1866 ; POSITIONING FUNCTION EXECUTION
                                     0878  1867 ;
                                     0878  1868 ;	FUNCTIONS INCLUDE:
                                     0878  1869 ;
                                     0878  1870 ;		SPACE FILE FORWARD,
                                     0878  1871 ;		SPACE FILE REVERSE,
                                     0878  1872 ;		ERASE TAPE,
                                     0878  1873 ;		SPACE RECORD REVERSE,
                                     0878  1874 ;		SPACE RECORD FORWARD,
                                     0878  1875 ;		UNLOAD, AND
                                     0878  1876 ;		WRITE TAPE MARK.
                                     0878  1877 ;
                                     0878  1878 ; THE FUNCTION IS INITIATED AND A WAITFOR INTERRUPT IS EXECUTED. WHEN THE INTERRUPT
                                     0878  1879 ; OCCURS FINAL DEVICE REGISTERS ARE RETURNED TO THE CALLER.
                                     0878  1880 ;
                                     0878  1881  
                                     0878  1882 POSIT:					;POSITIONING FUNCTION EXECUTION
                                     0878  1883 	DSBINT				;DISABLE ALL INTERRUPTS
         58 A5            05     E0  087E  1884 	BBS	#UCB$V_POWER,UCB$W_STS(R5),ENBEXT ;IF SET, POWER HAS FAILED
                          2A         0882       
         14 A3       008A C5     32  0883  1885 	CVTWL	UCB$W_MT_SPACNT(R5),MT_FC(R3) ;LOAD FRAME COUNT REGISTER
            63       F79E CF40   9A  0889  1886 	MOVZBL	FTAB[R0],MT_CS1(R3)	;EXECUTE FUNCTION
                                     088F  1887 	WFIKPCH	RETREG,TIME_OUT[R0]	;WAITFOR INTERRUPT AND KEEP CHANNEL
                          00C2   31  0899  1888 	BRW	DRVREG			;
                                     089C  1889  
                                     089C  1890 ;
                                     089C  1891 ; IMMEDIATE FUNCTION EXECUTION
                                     089C  1892 ;
                                     089C  1893 ;	FUNCTIONS INCLUDE:
                                     089C  1894 ;
                                     089C  1895 ;		NO OPERATION, AND
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page  42
01              TM03-TE16/TU77 HARDWARE FUNCTION EXECUTION                                                                       (1)

                                     089C  1896 ;		DRIVE CLEAR.
                                     089C  1897 ;
                                     089C  1898 ; THESE FUNCTIONS ARE EXECUTED IMMEDIATELY AND THE FINAL DEVICE REGISTERS
                                     089C  1899 ; ARE RETURNED TO THE CALLER.
                                     089C  1900 ;
                                     089C  1901  
                                     089C  1902 IMMED:					;IMMEDIATE FUNCTION EXECUTION
                                     089C  1903 	DSBINT				;DISABLE INTERRUPTS
         58 A5            05     E0  08A2  1904 	BBS	#UCB$V_POWER,UCB$W_STS(R5),ENBEXT ;IF SET, POWER HAS FAILED
                          06         08A6       
            63       F780 CF40   9A  08A7  1905 	MOVZBL	FTAB[R0],MT_CS1(R3)	;EXECUTE FUNCTION
                                     08AD  1906 ENBEXT:					;
                          00D3   31  08AD  1907 	BRW	ENBXIT			;
                                     08B0  1908  
                                     08B0  1909 ;
                                     08B0  1910 ; RECALIBRATE FUNCTION EXECUTION
                                     08B0  1911 ;
                                     08B0  1912 ;	FUNCTIONS INCLUDE:
                                     08B0  1913 ;
                                     08B0  1914 ;		READ IN PRESET, AND
                                     08B0  1915 ;		REWIND.
                                     08B0  1916 ;
                                     08B0  1917 ; THE FUNCTION IS INITIATED AND A WAITFOR INTERRUPT IS EXECUTED. WHEN THE INTERRUPT
                                     08B0  1918 ; OCCURS A TEST IS MADE TO SEE IF POSITIONING IS STILL IN PROGRESS. IF POSITIONING
                                     08B0  1919 ; IS STILL IN PROGRESS, THEN ANOTHER WAITFOR INTERRUPT IS EXECUTED. ELSE FINAL DRIVE
                                     08B0  1920 ; REGISTERS ARE RETURNED TO THE CALLED.
                                     08B0  1921 ;
                                     08B0  1922  
                                     08B0  1923 RECAL:					;RECALIBRATE FUNCTION EXECUTION
                                     08B0  1924 	DSBINT				;DISABLE INTERRUPTS
         58 A5            05     E0  08B6  1925 	BBS	#UCB$V_POWER,UCB$W_STS(R5),ENBEXT ;IF SET, POWER HAS FAILED
                          F2         08BA       
            63       F76C CF40   9A  08BB  1926 	MOVZBL	FTAB[R0],MT_CS1(R3)	;EXECUTE FUNCTION
                                     08C1  1927 	WFIRLCH	TIMEO,#60*7		;WAITFOR INTERRUPT
         04 A3            12     78  08CC  1928 	ASHL	#31-MT_DS_V_PIP,MT_DS(R3),R2 ;POSITIONING IN PROGRESS?
                          52         08D0       
                          1B     18  08D1  1929 	BGEQ	20$			;IF GEQ NO
                                     08D3  1930 	DSBINT				;DISABLE INTERRUPTS FOR SECOND WAIT
         58 A5            05     E0  08D9  1931 	BBS	#UCB$V_POWER,UCB$W_STS(R5),10$ ;IF SET, POWER HAS FAILED
                          0D         08DD       
                                     08DE  1932 	WFIKPCH	TIMEO,#60*7		;WAITFOR FINAL INTERRUPT
                          73     11  08E9  1933 	BRB	DRVREG			;
                                     08EB  1934 10$:	ENBINT				;ENABLE INTERRUPTS
                          6E     11  08EE  1935 20$:	BRB	DRVREG			;
                                     08F0  1936  
                                     08F0  1937 ;
                                     08F0  1938 ; TRANSFER FUNCTION EXECUTION
                                     08F0  1939 ;
                                     08F0  1940 ;	FUNCTIONS INCLUDE:
                                     08F0  1941 ;
                                     08F0  1942 ;		WRITE CHECK,
                                     08F0  1943 ;		WRITE DATA,
                                     08F0  1944 ;		READ DATA,
                                     08F0  1945 ;		READ DATA REVERSE, AND
                                     08F0  1946 ;		WRITECHECK DATA REVERSE.
                                     08F0  1947 ;
                                     08F0  1948 ; THE MAP REGISTERS, BYTE COUNT REGISTER, AND VIRTUAL ADDRESS REGISTERS ARE LOADED.
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page  43
01              TM03-TE16/TU77 HARDWARE FUNCTION EXECUTION                                                                       (1)

                                     08F0  1949 ; THE FUNCTION IS INITIATED AND A WAITFOR INTERRUPT IS EXECUTED. WHEN THE INTERRUPT
                                     08F0  1950 ; OCCURS FINAL DEVICE REGISTERS ARE RETURNED TO THE CALLER.
                                     08F0  1951 ;
                                     08F0  1952  
                                     08F0  1953 XFER:					;TRANSFER FUNCTION EXECUTION
         08 A4            00     D2  08F0  1954 	MCOML	#0,MBA$L_SR(R4)		;CLEAR MASSBUS ADAPTER ERRORS
                                     08F4  1955 	LOADMBA				;LOAD MAP, BYTE COUNT, AND VIRTUAL ADDRESS
         14 A3         10 A4     D0  08F7  1956 	MOVL	MBA$L_BCR(R4),MT_FC(R3)	;LOAD FRAME COUNT REGISTER
            50         77 A5     9A  08FC  1957 	MOVZBL	UCB$B_CEX(R5),R0	;RETRIEVE FUNCTION TABLE INDEX
            50            0F     91  0900  1958 	CMPB	#CDF_READDATAR,R0	;READ DATA REVERSE?
                          05     13  0903  1959 	BEQL	10$			;IF EQL YES
            50            0D     91  0905  1960 	CMPB	#CDF_WRITECHECKR,R0	;WRITE CHECK DATA REVERSE?
                          0A     12  0908  1961 	BNEQ	20$			;IF NEQ NO
            51         6E A5     3C  090A  1962 10$:	MOVZWL	UCB$W_BCNT(R5),R1	;GET TRANSFER BYTE COUNT
                          51     D7  090E  1963 	DECL	R1			;REDUCE BYTE COUNT BY ONE
         0C A4            51     C0  0910  1964 	ADDL	R1,MBA$L_VAR(R4)	;CALCULATE ENDING ADDRESS OF BUFFER
                                     0914  1965 20$:	DSBINT				;DISABLE INTERRUPTS
         58 A5            05     E0  091A  1966 	BBS	#UCB$V_POWER,UCB$W_STS(R5),ENBXIT ;IF SET, POWER FAILED
                          64         091E       
            63       F708 CF40   9A  091F  1967 	MOVZBL	FTAB[R0],MT_CS1(R3)	;INITIATE FUNCTION
                                     0925  1968 	WFIKPCH	RETREG,TIME_OUT[R0]	;WAITFOR INTERRUPT AND KEEP CHANNEL
       0080 C5         08 A4     D0  092F  1969 	MOVL	MBA$L_SR(R4),UCB$L_MT_SR(R5) ;SAVE FINAL CONTROLLER STATUS
                          03     F0  0935  1970 	INSV	#MT$K_NRZI_800,#MT$V_DENSITY,- ;SET CORRECT DENSITY CODE
            05            08         0937  1971 		#MT$S_DENSITY,UCB$L_DEVDEPEND(R5) ;
                       3C A5         0939       
                          03     F0  093B  1972 	INSV	#3,#MT_TC_V_DEN,-	;
            03            08         093D  1973 		#MT_TC_S_DEN,UCB$W_MT_TC(R5) ;
                     0096 C5         093F       
         04 A3            20     D3  0942  1974 	BITL	#MT_DS_M_PES,MT_DS(R3)	;NRZI ENCODED TAPE?
                          16     13  0946  1975 	BEQL	DRVREG			;IF EQL YES
                          04     F0  0948  1976 	INSV	#MT$K_PE_1600,#MT$V_DENSITY,- ;SWITCH TO PHASE ENCODED TAPE
            05            08         094A  1977 		#MT$S_DENSITY,UCB$L_DEVDEPEND(R5) ;
                       3C A5         094C       
                          04     F0  094E  1978 	INSV	#4,#MT_TC_V_DEN,-	;
            03            08         0950  1979 		#MT_TC_S_DEN,UCB$W_MT_TC(R5) ;
                     0096 C5         0952       
         3C A5            08     AA  0955  1980 	BICW	#MT$M_PARITY,UCB$L_DEVDEPEND(R5) ;CLEAR EVEN PARITY
       0096 C5            08     AA  0959  1981 	BICW	#MT_TC_M_EPAR,UCB$W_MT_TC(R5) ;
                                     095E  1982 DRVREG:					;SAVE DRIVE REGISTERS
       0088 C5         14 A3     F7  095E  1983 	CVTLW	MT_FC(R3),UCB$W_MT_FC(R5) ;SAVE FRAME COUNT REGISTER
       0086 C5         08 A3     F7  0964  1984 	CVTLW	MT_ER(R3),UCB$W_MT_ER(R5) ;SAVE ERROR STATUS REGISTER
       0084 C5         04 A3     F7  096A  1985 	CVTLW	MT_DS(R3),UCB$W_MT_DS(R5) ;SAVE DRIVE STATUS REGISTER
       0098 C5         24 A3     F7  0970  1986 	CVTLW	MT_TC(R3),UCB$W_MT_TC_SAV(R5) ;SAVE TAPE CONTROL REGISTER
       008C C5            63     F7  0976  1987 	CVTLW	MT_CS1(R3),UCB$W_MT_CS1(R5) ;SAVE DRIVE CONTROL REGISTER
            63            09     9A  097B  1988 	MOVZBL	#F_DRVCLR!1,MT_CS1(R3)	;CLEAR DRIVE
                                     097E  1989 	IOFORK				;CREATE FORK PROCESS
                          1A     11  0981  1990 	BRB	RETREG			;
                                     0983  1991  
                                     0983  1992 ;
                                     0983  1993 ; ENABLE INTERRUPTS
                                     0983  1994 ;
                                     0983  1995  
                                     0983  1996 ENBXIT:					;
       0086 C5         08 A3     F7  0983  1997 	CVTLW	MT_ER(R3),UCB$W_MT_ER(R5) ;SAVE ERROR STATUS REGISTER
       0084 C5         04 A3     F7  0989  1998 	CVTLW	MT_DS(R3),UCB$W_MT_DS(R5) ;SAVE DRIVE STATUS REGISTER
       0098 C5         24 A3     F7  098F  1999 	CVTLW	MT_TC(R3),UCB$W_MT_TC_SAV(R5) ;SAVE TAPE CONTROL REGISTER
       008C C5            63     F7  0995  2000 	CVTLW	MT_CS1(R3),UCB$W_MT_CS1(R5) ;SAVE DRIVE CONTROL REGISTER
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page  44
01              TM03-TE16/TU77 HARDWARE FUNCTION EXECUTION                                                                       (1)

                                     099A  2001 	ENBINT				;ENABLE INTERRUPTS
                                     099D  2002  
                                     099D  2003 ;
                                     099D  2004 ; RETURN REGISTERS
                                     099D  2005 ;
                                     099D  2006  
                                     099D  2007 RETREG:					;RETURN FINAL DEVICE REGISTERS
            50       0086 C5     3C  099D  2008 	MOVZWL	UCB$W_MT_ER(R5),R0	;RETRIEVE CONTENTS OF DRIVE ERROR REGISTER
            51         77 A5     9A  09A2  2009 	MOVZBL	UCB$B_CEX(R5),R1	;GET CURRENT FUNCTION INDEX
            50       F6E8 CF41   AA  09A6  2010 	BICW	XTAB[R1],R0		;CLEAR DON'T CARE BITS
            51       0080 C5     D0  09AC  2011 	MOVL	UCB$L_MT_SR(R5),R1	;RETRIEVE FINAL CONTROLLER STATUS
            52       0084 C5     3C  09B1  2012 	MOVZWL	UCB$W_MT_DS(R5),R2	;RETRIEVE CONTENTS OF DRIVE STATUS REGISTER
         58 A5       0060 8F     B3  09B6  2013 	BITW	#UCB$M_POWER!-		;POWER FAIL OR DEVICE TIMEOUT?
                                     09BC  2014 		UCB$M_TIMOUT,UCB$W_STS(R5) ;
                          7B     12  09BC  2015 	BNEQ	SPECON			;IF NEQ YES - SPECIAL CONDITION
         77 A5            0A     91  09BE  2016 	CMPB	#CDF_WRITECHECK,UCB$B_CEX(R5) ;DRIVE RELATED FUNCTION?
                          27     1A  09C2  2017 	BGTRU	10$			;IF GTRU YES
         77 A5            10     91  09C4  2018 	CMPB	#CDF_READPRESET,UCB$B_CEX(R5) ;DRIVE RELATED FUNCTION?
                          21     1B  09C8  2019 	BLEQU	10$			;IF LEQU YES
                                     09CA  2020  
                                     09CA  2021 ;
                                     09CA  2022 ; CONTROLLER RELATED FUNCTION
                                     09CA  2023 ;
                                     09CA  2024  
            51   000E1FFF 8F     D3  09CA  2025 	BITL	#MBA$M_ERROR,R1		;ANY CONTROLLER ERRORS?
                          59     13  09D1  2026 	BEQL	50$			;IF EQL NO
       008E C5            0F     E0  09D3  2027 	BBS	#IO$V_INHRETRY,UCB$W_MT_FUNC(R5),60$ ;IF SET, RETRY INHIBITED
                          5A         09D8       
            51   000C000B 8F     D3  09D9  2028 	BITL	#MBA$M_SR_ERCONF!-	;ERROR CONFIRMATION OR,
                                     09E0  2029 		MBA$M_SR_ISTO!-		;INTERFACE SEQUENCE TIMEOUT OR,
                                     09E0  2030 		MBA$M_SR_PGE!-		;PROGRAMMING ERROR OR,
                                     09E0  2031 		MBA$M_SR_NED!-		;NONEXISTENT DRIVE, OR
                                     09E0  2032 		MBA$M_SR_RDTO,R1	;READ TIMEOUT?
                          51     12  09E0  2033 	BNEQ	60$			;IF NEQ YES - FATAL CONTROLLER ERROR
            51   00020F74 8F     D3  09E2  2034 	BITL	#MBA$M_SR_DLT!-		;DATA LATE OR,
                                     09E9  2035 		MBA$M_SR_INVMAP!-	;INVALID MAP REGISTER OR,
                                     09E9  2036 		MBA$M_SR_MAPPE!-	;MAP REGISTER PARITY ERROR OR,
                                     09E9  2037 		MBA$M_SR_MCPE!-		;MASSBUS CONTROL PARITY ERROR OR,
                                     09E9  2038 		MBA$M_SR_MDPE!-		;MASSBUS DATA PARITY ERROR OR,
                                     09E9  2039 		MBA$M_SR_MXF!-		;MISSED TRANSFER OR,
                                     09E9  2040 		MBA$M_SR_RDS!-		;READ DATA SUBSTITUTE OR,
                                     09E9  2041 		MBA$M_SR_WCKLWR!-	;WRITE CHECK LOWER BYTE OR,
                                     09E9  2042 		MBA$M_SR_WCKUPR,R1	;WRITE CHECK UPPER BYTE?
                          0C     12  09E9  2043 	BNEQ	20$			;IF NEQ YES - RETRIABLE CONTROLLER ERROR
                                     09EB  2044  
                                     09EB  2045 ;
                                     09EB  2046 ; DRIVE RELATED FUNCTION
                                     09EB  2047 ;
                                     09EB  2048  
                          51     D4  09EB  2049 10$:	CLRL	R1			;CLEAR CONTENTS OF STATUS REGISTER
                          50     B5  09ED  2050 	TSTW	R0			;ANY DRIVE ERRORS?
                          3B     13  09EF  2051 	BEQL	50$			;IF EQL NO
       008E C5            0F     E0  09F1  2052 	BBS	#IO$V_INHRETRY,UCB$W_MT_FUNC(R5),60$ ;IF SET, RETRY INHIBITED
                          3C         09F6       
            50       4007 8F     B3  09F7  2053 20$:	BITW	#MT_ER_M_ILF!-		;ILLEGAL FUNCTION OR,
                                     09FC  2054 		MT_ER_M_ILR!-		;ILLEGAL REGISTER OR,
                                     09FC  2055 		MT_ER_M_RMR!-		;REGISTER MODIFY REFUSE OR,
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page  45
01              TM03-TE16/TU77 HARDWARE FUNCTION EXECUTION                                                                       (1)

                                     09FC  2056 		MT_ER_M_UNS,R0		;DRIVE UNSAFE
                          35     12  09FC  2057 	BNEQ	60$			;IF NEQ YES - FATAL DRIVE ERROR
            50            0B     E1  09FE  2058 	BBC	#MT_ER_V_NEF,R0,40$	;IF CLR, NOT NONEXECUTABLE FUNCTION
                          22         0A01       
         77 A5            04     91  0A02  2059 	CMPB	#CDF_DRVCLR,UCB$B_CEX(R5) ;DRIVE CLEAR?
                          18     13  0A06  2060 	BEQL	30$			;IF EQL YES
         77 A5            0F     91  0A08  2061 	CMPB	#CDF_READDATAR,UCB$B_CEX(R5) ;READ DATA REVERSE?
                          12     13  0A0C  2062 	BEQL	30$			;IF EQL YES
         77 A5            05     91  0A0E  2063 	CMPB	#CDF_SPCFILREV,UCB$B_CEX(R5) ;SPACE FILE REVERSE?
                          0C     13  0A12  2064 	BEQL	30$			;IF EQL YES
         77 A5            07     91  0A14  2065 	CMPB	#CDF_SPCRECREV,UCB$B_CEX(R5) ;SPACE RECORD REVERSE?
                          06     13  0A18  2066 	BEQL	30$			;IF EQL YES
         77 A5            0D     91  0A1A  2067 	CMPB	#CDF_WRITECHECKR,UCB$B_CEX(R5) ;WRITECHECK REVERSE?
                          13     12  0A1E  2068 	BNEQ	60$			;IF NEQ NO
                     0088 C5     B4  0A20  2069 30$:	CLRW	UCB$W_MT_FC(R5)		;CLEAR SAVED FRAME COUNT REGISTER
                                     0A24  2070  
                                     0A24  2071 ;
                                     0A24  2072 ; RETRIABLE ERROR EXIT
                                     0A24  2073 ;
                                     0A24  2074  
            7E         7C B5     32  0A24  2075 40$:	CVTWL	@UCB$L_DPC(R5),-(SP)	;GET BRANCH DISPLACEMENT
         7C A5            8E     C0  0A28  2076 	ADDL	(SP)+,UCB$L_DPC(R5)	;CALCULATE RETURN ADDRESS - 2
         7C A5            02     C0  0A2C  2077 50$:	ADDL	#2,UCB$L_DPC(R5)	;ADJUST TO CORRECT RETURN ADDRESS
                       7C B5     17  0A30  2078 	JMP	@UCB$L_DPC(R5)		;RETURN TO DRIVER
                                     0A33  2079  
                                     0A33  2080 ;
                                     0A33  2081 ; FATAL CONTROLLER OR DRIVE ERROR
                                     0A33  2082 ;
                                     0A33  2083  
                          F5CA'  30  0A33  2084 60$:	BSBW	ERL$DEVICERR		;LOG DEVICE ERROR
                          FCE2   31  0A36  2085 	BRW	FATALERR		;
                                     0A39  2086  
                                     0A39  2087 ;
                                     0A39  2088 ; SPECIAL CONDITION EXIT
                                     0A39  2089 ;
                                     0A39  2090  
            63            09     9A  0A39  2091 SPECON:	MOVZBL	#F_DRVCLR!1,MT_CS1(R3)	;CLEAR SLAVE CONTROLLER AND TRANSPORT
         77 A5            0A     91  0A3C  2092 	CMPB	#CDF_WRITECHECK,UCB$B_CEX(R5) ;DRIVE RELATED FUNCTION?
                          0E     1A  0A40  2093 	BGTRU	TIMEO			;IF GTRU YES
         77 A5            10     91  0A42  2094 	CMPB	#CDF_READPRESET,UCB$B_CEX(R5) ;DRIVE RELATED FUNCTION?
                          08     1B  0A46  2095 	BLEQU	TIMEO			;IF LEQU YES
         04 A4            02     D0  0A48  2096 	MOVL	#MBA$M_CR_ABORT,MBA$L_CR(R4) ;ABORT CURRENT TRANSFER
         04 A4            04     D0  0A4C  2097 	MOVL	#MBA$M_CR_IE,MBA$L_CR(R4) ;ENABLE MBA INTERRUPTS
                                     0A50  2098 TIMEO:	SETIPL	UCB$B_FIPL(R5)		;LOWER IPL TO DEVICE FORK LEVEL
                          F5A9'  30  0A54  2099 	BSBW	ERL$DEVICTMO		;LOG DEVICE TIMEOUT
            50       0000'8F     3C  0A57  2100 	MOVZWL	#SS$_TIMEOUT,R0		;SET FINAL COMPLETION STATUS
                          FDD9   31  0A5C  2101 	BRW	STSXIT			;
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page  46
01              TM03-TE16/TU77 REGISTER DUMP ROUTINE                                                                             (1)

                                     0A5F  2103 	.SBTTL	TM03-TE16/TU77 REGISTER DUMP ROUTINE
                                     0A5F  2104 ;
                                     0A5F  2105 ; REGDUMP - TM03-TE16/TU77 REGISTER DUMP ROUTINE
                                     0A5F  2106 ;
                                     0A5F  2107 ; THIS ROUTINE IS CALLED TO SAVE THE CONTROLLER AND DRIVE REGISTERS IN A
                                     0A5F  2108 ; SPECIFIED BUFFER. IT IS CALLED FROM THE DEVICE ERROR LOGGING ROUTINE AND
                                     0A5F  2109 ; FROM THE DIAGNOSTIC BUFFER FILL ROUTINE.
                                     0A5F  2110 ;
                                     0A5F  2111 ; INPUTS:
                                     0A5F  2112 ;
                                     0A5F  2113 ;	R0 = ADDRESS OF REGISTER SAVE BUFFER.
                                     0A5F  2114 ;	R4 = ADDRESS OF ADAPTER CONFIGURATION REGISTER.
                                     0A5F  2115 ;	R5 = DEVICE UNIT UCB ADDRESS.
                                     0A5F  2116 ;
                                     0A5F  2117 ; OUTPUTS:
                                     0A5F  2118 ;
                                     0A5F  2119 ;	THE CONTROLLER AND DRIVE REGISTERS ARE SAVED IN THE SPECIFIED BUFFER.
                                     0A5F  2120 ;
                                     0A5F  2121  
                                     0A5F  2122 REGDUMP:				;TM03-TE16/TU77 REGISTER DUMP ROUTINE
            80            11     D0  0A5F  2123 	MOVL	#<MT_TC+4+MBA$L_BCR+4+8>/4,(R0)+ ;INSERT NUMBER OF DEVICE REGISTERS
            80            64     D0  0A62  2124 	MOVL	MBA$L_CSR(R4),(R0)+	;SAVE CONFIGURATION REGISTER
            80         04 A4     D0  0A65  2125 	MOVL	MBA$L_CR(R4),(R0)+	;SAVE CONTROL REGISTER
            80       0080 C5     D0  0A69  2126 	MOVL	UCB$L_MT_SR(R5),(R0)+	;SAVE STATUS REGISTER
            80         0C A4     D0  0A6E  2127 	MOVL	MBA$L_VAR(R4),(R0)+	;SAVE VIRTUAL ADDRESS REGISTER
            80         10 A4     D0  0A72  2128 	MOVL	MBA$L_BCR(R4),(R0)+	;SAVE BYTE COUNT REGISTER
            08            09     EF  0A76  2129 	EXTZV	#9,#8,-8(R0),R1		;GET FINAL MAP REGISTER NUMBER
            51         F8 A0         0A79       
            80       0800 C441   D0  0A7C  2130 	MOVL	MBA$L_MAP(R4)[R1],(R0)+	;SAVE FINAL MAP REGISTER CONTENTS
                          80     D4  0A82  2131 	CLRL	(R0)+			;ASSUME NO PREVIOUS MAP REGISTER
                          51     D7  0A84  2132 	DECL	R1			;CALCULATE PREVIOUS MAP REGISTER NUMBER
                          07     19  0A86  2133 	BLSS	10$			;IF LSS NONE
         FC A0       0800 C441   D0  0A88  2134 	MOVL	MBA$L_MAP(R4)[R1],-4(R0) ;SAVE PREVIOUS MAP REGISTER CONTENTS
            51            06     9A  0A8F  2135 10$:	MOVZBL	#<MT_TC>/4-3,R1		;SET NUMBER OF DRIVE REGISTERS TO SAVE
            52         20 A5     D0  0A92  2136 	MOVL	UCB$L_CRB(R5),R2	;GET ADDRESS OF PRIMARY CRB
         1C B2            0C     C1  0A96  2137 	ADDL3	#3*4,@CRB$L_INTD+VEC$L_IDB(R2),R2 ;GET ADDRESS OF TM03-TE16/TU77 REGISTERS
                          52         0A9A       
            80       008C C5     3C  0A9B  2138 	MOVZWL	UCB$W_MT_CS1(R5),(R0)+	;SAVE DRIVE CONTROL REGISTER
            80       0084 C5     3C  0AA0  2139 	MOVZWL	UCB$W_MT_DS(R5),(R0)+	;SAVE DRIVE STATUS REGISTER
            80       0086 C5     3C  0AA5  2140 	MOVZWL	UCB$W_MT_ER(R5),(R0)+	;SAVE DRIVE ERROR REGISTER
            80            82     D0  0AAA  2141 20$:	MOVL	(R2)+,(R0)+		;SAVE DRIVE REGISTER
            FA            51     F5  0AAD  2142 	SOBGTR	R1,20$			;ANY MORE TO SAVE?
            80       0098 C5     3C  0AB0  2143 	MOVZWL	UCB$W_MT_TC_SAV(R5),(R0)+ ;SAVE TAPE CONTROL REGISTER
                                 05  0AB5  2144 	RSB				;
                                 05  0AB6  2145 UNSOLNT:	RSB			;******TEMP*******
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page  47
01              TM03-TE16/TU77 SLAVE CONTROLLER INTERRUPT DISPA                                                                  (1)

                                     0AB7  2147 	.SBTTL	TM03-TE16/TU77 SLAVE CONTROLLER INTERRUPT DISPATCHER
                                     0AB7  2148 ;+
                                     0AB7  2149 ; TM$INT - TM03-TE16/TU77 SLAVE CONTROLLER INTERRUPT DISPATCHER
                                     0AB7  2150 ;
                                     0AB7  2151 ; THIS ROUTINE IS ENTERED VIA A JSB INSTRUCTION WHEN AN INTERRUPT OCCURS ON A
                                     0AB7  2152 ; TM03-TE16/TU77 SLAVE CONTROLLER. THE STATE OF THE STACK ON ENTRY IS:
                                     0AB7  2153 ;
                                     0AB7  2154 ;	00(SP) = ADDRESS OF IDB ADDRESS.
                                     0AB7  2155 ;	04(SP) = SAVED R2.
                                     0AB7  2156 ;	08(SP) = SAVED R3.
                                     0AB7  2157 ;	12(SP) = SAVED R4.
                                     0AB7  2158 ;	16(SP) = SAVED R5.
                                     0AB7  2159 ;	20(SP) = INTERRUPT PC.
                                     0AB7  2160 ;	24(SP) = INTERRUPT PSL.
                                     0AB7  2161 ;
                                     0AB7  2162 ; INTERRUPT DISPATCHING OCCURS AS FOLLOWS:
                                     0AB7  2163 ;
                                     0AB7  2164 ;	IF THE INTERRUPTING CONTROLLER IS CURRENTLY OWNED AND THE OWNER UNIT IS
                                     0AB7  2165 ;	EXPECTING AN INTERRUPT, THEN THAT UNIT IS DISPATCHED FIRST. ALL OTHER
                                     0AB7  2166 ;	UNITS ARE DISPATCHED BY SELECTING THE CORRESPONDING SLAVE DRIVE, READING
                                     0AB7  2167 ;	ITS STATUS, AND DISPATCHING IF AN ATTENTION CONDITION EXISTS. AS EACH UNIT
                                     0AB7  2168 ;	IS FOUND, A TEST IS MADE TO DETERMINE IF AN INTERRUPT IS EXPECTED ON THE
                                     0AB7  2169 ;	UNIT. IF YES, THEN THE DRIVER IS CALLED AT ITS INTERRUPT RETURN ADDRESS.
                                     0AB7  2170 ;	ELSE THE DRIVER IS CALLED AT ITS UNSOLICITED INTERRUPT ADDRESS. AS EACH
                                     0AB7  2171 ;	CALL TO THE DRIVER RETURNS, THE NEXT SLAVE UNIT IS SELECTED AND AN ATTEMPT
                                     0AB7  2172 ;	IS MADE TO DISPATCH THAT UNIT. WHEN ALL UNITS HAVE BEEN SELECTED AND NO
                                     0AB7  2173 ;	ATTENTION CONDITIONS REMAIN, THE INTERRUPT IS DISMISSED.
                                     0AB7  2174 ;-
                                     0AB7  2175  
                                     0AB7  2176 TM$INT::				;TM03-TE16/TU77 SLAVE CONTROLLER INTERRUPT DISPATHCER
            53         00 BE     D0  0AB7  2177 	MOVL	@(SP),R3		;GET ADDRESS OF IDB
            54            63     D0  0ABB  2178 	MOVL	IDB$L_CSR(R3),R4	;GET ADDRESS OF TM03-TE16/TU77 REGISTERS
                       24 A4     DD  0ABE  2179 	PUSHL	MT_TC(R4)		;SAVE CONTENTS OF TAPE CONTROL REGISTER
            55         04 A3     D0  0AC1  2180 	MOVL	IDB$L_OWNER(R3),R5	;GET OWNER UCB ADDRESS
                          05     13  0AC5  2181 	BEQL	10$			;IF EQL NONE
         58 A5            01     E4  0AC7  2182 	BBSC	#UCB$V_INT,UCB$W_STS(R5),70$ ;IF SET, INTERRUPT EXPECTED
                          45         0ACB       
         04 A4            19     78  0ACC  2183 10$:	ASHL	#31-MT_DS_V_SSC,MT_DS(R4),R2 ;ANY SLAVE CHANGE STATUS?
                          52         0AD0       
                          59     18  0AD1  2184 	BGEQ	100$			;IF GEQ NO
            53         04 BE     D0  0AD3  2185 20$:	MOVL	@4(SP),R3		;RETRIEVE ADDRESS OF IDB
            54            63     D0  0AD7  2186 	MOVL	IDB$L_CSR(R3),R4	;RETRIEVE ADDRESS OF OF TM03-TE16/TU77 REGISTERS
         04 A4            19     78  0ADA  2187 	ASHL	#31-MT_DS_V_SSC,MT_DS(R4),R2 ;ANY SLAVE STATUS CHANGE?
                          52         0ADE       
                          1A     18  0ADF  2188 	BGEQ	50$			;IF GEQ NO
                          52     D4  0AE1  2189 	CLRL	R2			;CLEAR STARTING SLAVE UNIT NUMBER
         24 A4            52     D0  0AE3  2190 30$:	MOVL	R2,MT_TC(R4)		;SELECT SLAVE UNIT
            55         04 A4     D0  0AE7  2191 	MOVL	MT_DS(R4),R5		;READ SLAVE DRIVE STATUS
            55            00     E0  0AEB  2192 	BBS	#MT_DS_V_SLA,R5,90$	;IF SET, SLAVE TRANSITION TO ONLINE
                          38         0AEE       
            55            0D     E0  0AEF  2193 	BBS	#MT_DS_V_PIP,R5,40$	;IF SET, POSITIONING IN PROGRESS
                          04         0AF2       
            55            01     E0  0AF3  2194 	BBS	#MT_DS_V_BOT,R5,60$	;IF SET, SLAVE AT BEGINNING OF TAPE
                          0E         0AF6       
            52            07     F3  0AF7  2195 40$:	AOBLEQ	#7,R2,30$		;ANY MORE SLAVE UNITS TO SCAN?
                          E8         0AFA       
                       24 A4   8ED0  0AFB  2196 50$:	POPL	MT_TC(R4)		;RESTORE CONTENTS OF TAPE CONTROL REGISTER
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page  48
01              TM03-TE16/TU77 SLAVE CONTROLLER INTERRUPT DISPA                                                                  (1)

            5E            04     C0  0AFF  2197 	ADDL	#4,SP			;CLEAN STACK
                          3C     BA  0B02  2198 	POPR	#^M<R2,R3,R4,R5>	;RESTORE REGISTERS
                                 02  0B04  2199 	REI				;
            55         10 A342   D0  0B05  2200 60$:	MOVL	IDB$L_UCBLST(R3)[R2],R5	;GET ADDRESS OF UCB
                          1B     13  0B0A  2201 	BEQL	90$			;IF EQL UNDEFINED DEVICE
         58 A5            01     E5  0B0C  2202 	BBCC	#UCB$V_INT,UCB$W_STS(R5),90$ ;IF CLR, INTERRUPT NOT EXPECTED
                          16         0B10       
            53         10 A5     7D  0B11  2203 70$:	MOVQ	UCB$L_FR3(R5),R3	;RESTORE DRIVER CONTEXT
                       0C B5     16  0B15  2204 	JSB	@UCB$L_FPC(R5)		;CALL DRIVER AT INTERRUPT RETURN ADDRESS
                          B9     11  0B18  2205 	BRB	20$			;
            53         24 A5     D0  0B1A  2206 80$:	MOVL	UCB$L_DDB(R5),R3	;GET ADDRESS OF DDB
            53         0C A3     D0  0B1E  2207 	MOVL	DDB$L_DDT(R3),R3	;GET ADDRESS OF DDT
                       04 B3     16  0B22  2208 	JSB	@DDT$L_UNSOLINT(R3)	;CALL DRIVER AT UNSOLICITED INTERRUPT ADDRESS
                          AC     11  0B25  2209 	BRB	20$			;
            64            09     9A  0B27  2210 90$:	MOVZBL	#F_DRVCLR!1,MT_CS1(R4)	;CLEAR DRIVE
                          CB     11  0B2A  2211 	BRB	40$			;
                                     0B2C  2212 ;**************
                                     0B2C  2213 ; LOG/UNEXPECTED INTERRUPT
                                     0B2C  2214 ;**************
                                     0B2C  2215 100$:					;
                          A5     11  0B2C  2216 	BRB	20$			;
                                     0B2E  2217  
                                     0B2E  2218 	.END
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page  49
SYMBOL TABLE                                                                                                                     (1)

$.$            = 00009230            DDT$L_START      00000000            EMB$L_BC_R5      00000038            
ACP$ACCESS       ********   X   03   DDT$L_UNSOLINT   00000004            EMB$L_BC_R6      0000003C            
ACP$DEACCESS     ********   X   03   DDT$W_DIAGBUF    00000014            EMB$L_BC_R7      00000040            
ACP$MODIFY       ********   X   03   DDT$W_ERRORBUF   00000016            EMB$L_BC_R8      00000044            
ACP$READBLK      ********   X   03   DENSITY          0000001C R     03   EMB$L_BC_R9      00000048            
ACP$WRITEBLK     ********   X   03   DOUBLE           00000717 R     03   EMB$L_BC_SP      0000005C            
BIT...         = 00000010            DRVCLR           000002B2 R     03   EMB$L_BC_SSP     00000018            
CANCELIO         00000135 R     03   DRVREG           0000095E R     03   EMB$L_BC_USP     0000001C            
CDF_DRVCLR     = 00000004            EMB$B_BC_PCB     0000006E            EMB$L_CR_ACCS    0000009C            
CDF_ERASE      = 00000006            EMB$B_BUFIND     00000002            EMB$L_CR_AP      00000054            
CDF_NOP        = 00000000            EMB$B_DV_CLASS   00000012            EMB$L_CR_ASTLVL  00000088            
CDF_READDATA   = 0000000C            EMB$B_DV_ERTCNT  00000006            EMB$L_CR_CODE    000000F4            
CDF_READDATAR  = 0000000F            EMB$B_DV_ERTMAX  00000007            EMB$L_CR_ESP     00000014            
CDF_READPRESET = 00000010            EMB$B_DV_SLAVE   0000003C            EMB$L_CR_FP      00000058            
CDF_REWIND     = 00000003            EMB$B_DV_TYPE    00000013            EMB$L_CR_ICCS    00000090            
CDF_SENSECHAR  = 00000011            EMB$B_SS_MSGTXT  00000012            EMB$L_CR_ICR     00000094            
CDF_SETCHAR    = 00000008            EMB$B_VALID      00000003            EMB$L_CR_ISP     00000020            
CDF_SPCFILFOR  = 00000002            EMB$C_BC_LENGTH  0000006E            EMB$L_CR_KSP     00000010            
CDF_SPCFILREV  = 00000005            EMB$C_BE       = 00000004            EMB$L_CR_P0BR    00000068            
CDF_SPCRECFOR  = 00000009            EMB$C_CR_LENGTH  000000FA            EMB$L_CR_P0LR    0000006C            
CDF_SPCRECREV  = 00000007            EMB$C_CS       = 00000020            EMB$L_CR_P1BR    00000070            
CDF_UNLOAD     = 00000001            EMB$C_DE       = 00000001            EMB$L_CR_P1LR    00000074            
CDF_WRITE      = 0000000E            EMB$C_DT       = 00000096            EMB$L_CR_PC      00000060            
CDF_WRITECHECK = 0000000A            EMB$C_LENGTH     00000004            EMB$L_CR_PCBB    00000080            
CDF_WRITECHECKR= 0000000D            EMB$C_OM       = 00000028            EMB$L_CR_PSL     00000064            
CDF_WRITEDATA  = 0000000B            EMB$C_SS       = 00000027            EMB$L_CR_R0      00000024            
CDF_WRITEMARK  = 00000012            EMB$C_SS_LENGTH  00000012            EMB$L_CR_R1      00000028            
CHECK_ERROR      00000687 R     03   EMB$C_TS       = 00000026            EMB$L_CR_R10     0000004C            
CRB$B_MASK       0000000E            EMB$C_TS_LENGTH  00000010            EMB$L_CR_R11     00000050            
CRB$B_TT_ATTN    00000004            EMB$C_UI       = 00000061            EMB$L_CR_R2      0000002C            
CRB$B_TT_EXPEC   00000005            EMB$C_VD       = 00000041            EMB$L_CR_R3      00000030            
CRB$B_TYPE       0000000A            EMB$C_VM       = 00000040            EMB$L_CR_R4      00000034            
CRB$C_LENGTH     00000028            EMB$C_WS       = 00000024            EMB$L_CR_R5      00000038            
CRB$K_LENGTH     00000028            EMB$K_BC_LENGTH  0000006E            EMB$L_CR_R6      0000003C            
CRB$L_INTD       00000014            EMB$K_CR       = 00000025            EMB$L_CR_R7      00000040            
CRB$L_LINK       00000010            EMB$K_CR_LENGTH  000000FA            EMB$L_CR_R8      00000044            
CRB$L_TT_DIAL    00000000            EMB$K_LENGTH     00000004            EMB$L_CR_R9      00000048            
CRB$L_WQBL       00000004            EMB$K_MC       = 00000002            EMB$L_CR_SBIER   000000AC            
CRB$L_WQFL       00000000            EMB$K_SBC      = 00000028            EMB$L_CR_SBIFS   000000A0            
CRB$M_BSY      = 00000001            EMB$K_SS_LENGTH  00000012            EMB$L_CR_SBIMT   000000A8            
CRB$V_BSY      = 00000000            EMB$K_TS_LENGTH  00000010            EMB$L_CR_SBIS    000000B4            
CRB$W_REFC       0000000C            EMB$K_UBC      = 00000080            EMB$L_CR_SBISC   000000A4            
CRB$W_SIZE       00000008            EMB$L_BC_AP      00000054            EMB$L_CR_SBITA   000000B0            
DDB$B_ACPCLASS   00000013            EMB$L_BC_CODE    00000068            EMB$L_CR_SBR     00000078            
DDB$B_TYPE       0000000A            EMB$L_BC_ESP     00000014            EMB$L_CR_SCBB    00000084            
DDB$C_LENGTH     00000014            EMB$L_BC_FP      00000058            EMB$L_CR_SISR    0000008C            
DDB$K_LENGTH     00000014            EMB$L_BC_ISP     00000020            EMB$L_CR_SLR     0000007C            
DDB$L_ACPD       00000010            EMB$L_BC_KSP     00000010            EMB$L_CR_SP      0000005C            
DDB$L_DDT        0000000C            EMB$L_BC_PC      00000060            EMB$L_CR_SSP     00000018            
DDB$L_LINK       00000000            EMB$L_BC_PSL     00000064            EMB$L_CR_TODR    00000098            
DDB$L_UCB        00000004            EMB$L_BC_R0      00000024            EMB$L_CR_USP     0000001C            
DDB$T_NAME       00000014            EMB$L_BC_R1      00000028            EMB$L_DV_CHAR    00000038            
DDB$W_SIZE       00000008            EMB$L_BC_R10     0000004C            EMB$L_DV_ERRSEQ  0000001C            
DDT$L_CANCEL     0000000C            EMB$L_BC_R11     00000050            EMB$L_DV_MEDIA   00000028            
DDT$L_FDT        00000008            EMB$L_BC_R2      0000002C            EMB$L_DV_OPCNT   00000030            
DDT$L_INIT       00000018            EMB$L_BC_R3      00000030            EMB$L_DV_OWNUIC  00000034            
DDT$L_REGDUMP    00000010            EMB$L_BC_R4      00000034            EMB$L_DV_REGSAV  00000050            
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page  50
SYMBOL TABLE                                                                                                                     (1)

EMB$L_DV_RQPID   00000020            F_UNLOAD       = 00000002            IO$V_ACCESS    = 00000006            
EMB$Q_BC_TIME    00000006            F_WRITE        = 00000030            IO$V_ATTNAST   = 00000008            
EMB$Q_CR_TIME    00000006            F_WRITECHECK   = 00000028            IO$V_BINARY    = 00000006            
EMB$Q_DV_ERTIME  00000014            F_WRITECHECKR  = 0000002E            IO$V_CANCTRLO  = 00000006            
EMB$Q_DV_IOSB    00000008            F_WRITEDATA    = 00000030            IO$V_COMMOD    = 00000006            
EMB$Q_SS_TIME    00000006            F_WRITEMARK    = 00000016            IO$V_CREATE    = 00000007            
EMB$Q_TS_TIME    00000006            GBL...         = 00000001            IO$V_CTRLCAST  = 00000008            
EMB$T_DV_NAME    00000040            IDB$B_TYPE       0000000A            IO$V_CTRLYAST  = 00000007            
EMB$W_BC_ENTRY   00000004            IDB$B_UNITS      0000000B            IO$V_CVTLOW    = 00000008            
EMB$W_BC_ERRSEQ  0000000E            IDB$C_LENGTH     00000014            IO$V_DATACHECK = 0000000E            
EMB$W_BC_PCBSZ   0000006C            IDB$K_LENGTH     00000014            IO$V_DELETE    = 00000008            
EMB$W_CR_ENTRY   00000004            IDB$L_ADP        0000000C            IO$V_DMOUNT    = 0000000A            
EMB$W_CR_ERRSEQ  0000000E            IDB$L_CSR        00000000            IO$V_DSABLMBX  = 0000000A            
EMB$W_CR_PCBSZ   000000F8            IDB$L_OWNER      00000004            IO$V_ENABLMBX  = 00000007            
EMB$W_DV_BCNT    00000026            IDB$L_UCBLST     00000010            IO$V_FCODE     = 00000000            
EMB$W_DV_BOFF    00000024            IDB$W_SIZE       00000008            IO$V_HANGUP    = 00000009            
EMB$W_DV_DEVSTS  00000010            IMMED            0000089C R     03   IO$V_INHERLOG  = 0000000B            
EMB$W_DV_ENTRY   00000004            IO$M_ABORT     = 00000100            IO$V_INHEXTGAP = 0000000C            
EMB$W_DV_ERRCNT  0000002E            IO$M_ACCESS    = 00000040            IO$V_INHRETRY  = 0000000F            
EMB$W_DV_FUNC    0000003E            IO$M_ATTNAST   = 00000100            IO$V_INHSEEK   = 0000000C            
EMB$W_DV_UNIT    0000002C            IO$M_BINARY    = 00000040            IO$V_INTERRUPT = 00000006            
EMB$W_SIZE       00000000            IO$M_CANCTRLO  = 00000040            IO$V_MOUNT     = 00000009            
EMB$W_SS_ENTRY   00000004            IO$M_COMMOD    = 00000040            IO$V_NOECHO    = 00000006            
EMB$W_SS_ERRSEQ  0000000E            IO$M_CREATE    = 00000080            IO$V_NOFILTR   = 00000009            
EMB$W_SS_MSGSZ   00000010            IO$M_CTRLCAST  = 00000100            IO$V_NOFORMAT  = 00000008            
EMB$W_TS_ENTRY   00000004            IO$M_CTRLYAST  = 00000080            IO$V_NOW       = 00000006            
EMB$W_TS_ERRSEQ  0000000E            IO$M_CVTLOW    = 00000100            IO$V_NOWAIT    = 00000007            
ENBEXT           000008AD R     03   IO$M_DATACHECK = 00004000            IO$V_PACKED    = 00000007            
ENBXIT           00000983 R     03   IO$M_DELETE    = 00000100            IO$V_PURGE     = 0000000B            
ERASE            00000290 R     03   IO$M_DMOUNT    = 00000400            IO$V_READATTN  = 00000007            
ERL$DEVICERR     ********   X   03   IO$M_DSABLMBX  = 00000400            IO$V_REVERSE   = 00000006            
ERL$DEVICTMO     ********   X   03   IO$M_ENABLMBX  = 00000080            IO$V_SHUTDOWN  = 00000007            
ERR_SPACING    = 00000005            IO$M_FCODE     = 0000003F            IO$V_STARTUP   = 00000006            
EXE$IOFORK       ********   X   03   IO$M_HANGUP    = 00000200            IO$V_SYNCH     = 00000009            
EXE$ONEPARM      ********   X   03   IO$M_INHERLOG  = 00000800            IO$V_TIMED     = 00000007            
EXE$SETMODE      ********   X   03   IO$M_INHEXTGAP = 00001000            IO$V_TRMNOECHO = 0000000C            
EXE$ZEROPARM     ********   X   03   IO$M_INHRETRY  = 00008000            IO$V_WRTATTN   = 00000008            
FATALERR         0000071B R     03   IO$M_INHSEEK   = 00001000            IO$_ACCESS     = 00000032            
FDISPATCH        0000021D R     03   IO$M_INTERRUPT = 00000040            IO$_ACPCONTROL = 00000038            
FEX              0000083F R     03   IO$M_MOUNT     = 00000200            IO$_CREATE     = 00000033            
FORMAT           0000003F R     03   IO$M_NOECHO    = 00000040            IO$_DEACCESS   = 00000034            
FTAB             0000002C R     03   IO$M_NOFILTR   = 00000200            IO$_DELETE     = 00000035            
FUNCTABLE        000000B9 R     03   IO$M_NOFORMAT  = 00000100            IO$_DIAGNOSE   = 0000001D            
FUNCXT           0000078A R     03   IO$M_NOW       = 00000040            IO$_DRVCLR     = 00000004            
F_DRVCLR       = 00000008            IO$M_NOWAIT    = 00000080            IO$_ERASETAPE  = 00000006            
F_ERASE        = 00000014            IO$M_PACKED    = 00000080            IO$_LOGICAL    = 0000002F            
F_NOP          = 00000000            IO$M_PURGE     = 00000800            IO$_MODIFY     = 00000036            
F_READDATA     = 00000038            IO$M_READATTN  = 00000080            IO$_MOUNT      = 00000039            
F_READDATAR    = 0000003E            IO$M_REVERSE   = 00000040            IO$_NOP        = 00000000            
F_READPRESET   = 00000010            IO$M_SHUTDOWN  = 00000080            IO$_OFFSET     = 00000006            
F_REWIND       = 00000006            IO$M_STARTUP   = 00000040            IO$_PACKACK    = 00000008            
F_SENSECHAR    = 00000000            IO$M_SYNCH     = 00000200            IO$_PHYSICAL   = 0000001F            
F_SETCHAR      = 00000000            IO$M_TIMED     = 00000080            IO$_READHEAD   = 0000000E            
F_SPCFILFOR    = 00000018            IO$M_TRMNOECHO = 00001000            IO$_READLBLK   = 00000021            
F_SPCFILREV    = 0000001A            IO$M_WRTATTN   = 00000100            IO$_READPBLK   = 0000000C            
F_SPCRECFOR    = 00000018            IO$S_FCODE     = 00000006            IO$_READPRESET = 00000019            
F_SPCRECREV    = 0000001A            IO$V_ABORT     = 00000008            IO$_READPROMPT = 00000037            
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page  51
SYMBOL TABLE                                                                                                                     (1)

IO$_READTRACKD = 00000010            IRP$L_SVAPTE     0000002C            MBA$M_CSR_PU   = 00400000            
IO$_READVBLK   = 00000031            IRP$L_TT_TERM    00000038            MBA$M_CSR_URD  = 20000000            
IO$_RECAL      = 00000003            IRP$L_UCB        0000001C            MBA$M_CSR_WS   = 40000000            
IO$_RELEASE    = 00000005            IRP$L_WIND       00000018            MBA$M_CSR_XMFLT= 04000000            
IO$_RETCENTER  = 00000007            IRP$M_BUFIO    = 00000001            MBA$M_ERROR    = 000E1FFF            
IO$_REWIND     = 00000024            IRP$M_CHAINED  = 00000020            MBA$M_SR_ATTN  = 00010000            
IO$_REWINDOFF  = 00000022            IRP$M_COMPLX   = 00000008            MBA$M_SR_CRD   = 20000000            
IO$_SEARCH     = 00000009            IRP$M_DIAGBUF  = 00000080            MBA$M_SR_DLT   = 00000800            
IO$_SEEK       = 00000002            IRP$M_FUNC     = 00000002            MBA$M_SR_DTABT = 00001000            
IO$_SENSECHAR  = 0000001B            IRP$M_PAGIO    = 00000004            MBA$M_SR_DTBUSY= 80000000            
IO$_SENSEMODE  = 00000027            IRP$M_PHYSIO   = 00000100            MBA$M_SR_DTCOMP= 00002000            
IO$_SETCHAR    = 0000001A            IRP$M_PRIVIO   = 00000200            MBA$M_SR_ERCONF= 00000008            
IO$_SETMODE    = 00000023            IRP$M_SWAPIO   = 00000040            MBA$M_SR_INVMAP= 00000010            
IO$_SKIPFILE   = 00000025            IRP$M_VIRTUAL  = 00000010            MBA$M_SR_ISTO  = 00000002            
IO$_SKIPRECORD = 00000026            IRP$S_FCODE    = 00000006            MBA$M_SR_MAPPE = 00000020            
IO$_SPACEFILE  = 00000002            IRP$S_FMOD     = 0000000A            MBA$M_SR_MBEXC = 00000080            
IO$_SPACERECORD= 00000009            IRP$S_MODE     = 00000002            MBA$M_SR_MCPE  = 00020000            
IO$_STARTSPNDL = 00000019            IRP$V_BUFIO    = 00000000            MBA$M_SR_MDPE  = 00000040            
IO$_UNLOAD     = 00000001            IRP$V_CHAINED  = 00000005            MBA$M_SR_MXF   = 00000100            
IO$_VIRTUAL    = 0000003F            IRP$V_COMPLX   = 00000003            MBA$M_SR_NED   = 00040000            
IO$_WRITECHECK = 0000000A            IRP$V_DIAGBUF  = 00000007            MBA$M_SR_NRCONF= 40000000            
IO$_WRITECHECKH= 00000018            IRP$V_FCODE    = 00000000            MBA$M_SR_PGE   = 00080000            
IO$_WRITEHEAD  = 0000000D            IRP$V_FMOD     = 00000006            MBA$M_SR_RDS   = 00000004            
IO$_WRITELBLK  = 00000020            IRP$V_FUNC     = 00000001            MBA$M_SR_RDTO  = 00000001            
IO$_WRITEMARK  = 0000001C            IRP$V_MODE     = 00000000            MBA$M_SR_WCKLWR= 00000200            
IO$_WRITEOF    = 00000028            IRP$V_PAGIO    = 00000002            MBA$M_SR_WCKUPR= 00000400            
IO$_WRITEPBLK  = 0000000B            IRP$V_PHYSIO   = 00000008            MBA$S_CSR_ADCOD= 00000008            
IO$_WRITETRACKD= 0000000F            IRP$V_PRIVIO   = 00000009            MBA$S_ERB_UNIT = 00000003            
IO$_WRITEVBLK  = 00000030            IRP$V_SWAPIO   = 00000006            MBA$V_CR_ABORT = 00000001            
IOC$CANCELIO     ********   X   03   IRP$V_VIRTUAL  = 00000004            MBA$V_CR_IE    = 00000002            
IOC$DIAGBUFILL   ********   X   03   IRP$W_ABCNT      0000003C            MBA$V_CR_INIT  = 00000000            
IOC$LOADMBAMAP   ********   X   03   IRP$W_BCNT       00000032            MBA$V_CSR_ADCOD= 00000000            
IOC$RELSCHAN     ********   X   03   IRP$W_BOFF       00000030            MBA$V_CSR_MT   = 0000001B            
IOC$REQCOM       ********   X   03   IRP$W_CHAN       00000028            MBA$V_CSR_OT   = 00000015            
IOC$REQPCHANL    ********   X   03   IRP$W_FUNC       00000020            MBA$V_CSR_PD   = 00000017            
IOC$REQSCHANL    ********   X   03   IRP$W_OBCNT      0000003E            MBA$V_CSR_PE   = 0000001F            
IOC$WFIKPCH      ********   X   03   IRP$W_SIZE       00000008            MBA$V_CSR_PU   = 00000016            
IOC$WFIRLCH      ********   X   03   IRP$W_STS        0000002A            MBA$V_CSR_URD  = 0000001D            
IRP$B_CARCON     00000038            IRP$W_TT_PRMPT   0000003C            MBA$V_CSR_WS   = 0000001E            
IRP$B_EFN        00000022            LOSTPOS          00000708 R     03   MBA$V_CSR_XMFLT= 0000001A            
IRP$B_PRI        00000023            MASKH          = 00000008            MBA$V_ERB_UNIT = 00000007            
IRP$B_RMOD       0000000B            MASKL          = 04000000            MBA$V_SR_ATTN  = 00000010            
IRP$B_TYPE       0000000A            MBA$L_AS         00000410            MBA$V_SR_CRD   = 0000001D            
IRP$C_LENGTH     0000004C            MBA$L_BCR        00000010            MBA$V_SR_DLT   = 0000000B            
IRP$K_LENGTH     0000004C            MBA$L_CR         00000004            MBA$V_SR_DTABT = 0000000C            
IRP$L_AST        00000010            MBA$L_CSR        00000000            MBA$V_SR_DTBUSY= 0000001F            
IRP$L_ASTPRM     00000014            MBA$L_ERB        00000400            MBA$V_SR_DTCOMP= 0000000D            
IRP$L_DIAGBUF    00000044            MBA$L_MAP        00000800            MBA$V_SR_ERCONF= 00000003            
IRP$L_IOQBL      00000004            MBA$L_SR         00000008            MBA$V_SR_INVMAP= 00000004            
IRP$L_IOQFL      00000000            MBA$L_VAR        0000000C            MBA$V_SR_ISTO  = 00000001            
IRP$L_IOSB       00000024            MBA$M_CR_ABORT = 00000002            MBA$V_SR_MAPPE = 00000005            
IRP$L_IOST1      00000034            MBA$M_CR_IE    = 00000004            MBA$V_SR_MBEXC = 00000007            
IRP$L_IOST2      00000038            MBA$M_CR_INIT  = 00000001            MBA$V_SR_MCPE  = 00000011            
IRP$L_MEDIA      00000034            MBA$M_CSR_MT   = 08000000            MBA$V_SR_MDPE  = 00000006            
IRP$L_PID        0000000C            MBA$M_CSR_OT   = 00200000            MBA$V_SR_MXF   = 00000008            
IRP$L_SEGVBN     00000040            MBA$M_CSR_PD   = 00800000            MBA$V_SR_NED   = 00000012            
IRP$L_SEQNUM     00000048            MBA$M_CSR_PE   = 80000000            MBA$V_SR_NRCONF= 0000001E            
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page  52
SYMBOL TABLE                                                                                                                     (1)

MBA$V_SR_PGE   = 00000013            MT_DS_V_DRY    = 00000007            MT_ER_V_ITM    = 0000000A            
MBA$V_SR_RDS   = 00000002            MT_DS_V_EOT    = 0000000A            MT_ER_V_LRC    = 00000007            
MBA$V_SR_RDTO  = 00000000            MT_DS_V_ERR    = 0000000E            MT_ER_V_NEF    = 0000000B            
MBA$V_SR_WCKLWR= 00000009            MT_DS_V_IDB    = 00000003            MT_ER_V_NSG    = 00000008            
MBA$V_SR_WCKUPR= 0000000A            MT_DS_V_MOL    = 0000000C            MT_ER_V_OPI    = 0000000D            
MIN_RECORD     = 0000000E            MT_DS_V_PES    = 00000005            MT_ER_V_PEF    = 00000007            
MT$CHECK_ACCESS  ********   X   03   MT_DS_V_PIP    = 0000000D            MT_ER_V_RMR    = 00000002            
MT$K_CORDMP11  = 0000000D            MT_DS_V_SDWN   = 00000004            MT_ER_V_UNS    = 0000000E            
MT$K_DEFAULT   = 00000000            MT_DS_V_SLA    = 00000000            MT_ER_V_VPE    = 00000006            
MT$K_NORMAL11  = 0000000C            MT_DS_V_SSC    = 00000006            MT_FC            00000014            
MT$K_NORMAL15  = 0000000E            MT_DS_V_TM     = 00000002            MT_MR            0000000C            
MT$K_NRZI_800  = 00000003            MT_DS_V_WRL    = 0000000B            MT_SN            00000020            
MT$K_PE_1600   = 00000004            MT_DT            00000018            MT_TC            00000024            
MT$M_BOT       = 00010000            MT_DT_M_7CH    = 00001000            MT_TC_M_ACCL   = 00008000            
MT$M_DENSITY   = 00001F00            MT_DT_M_DRQ    = 00000800            MT_TC_M_DEN    = 00000700            
MT$M_EOF       = 00020000            MT_DT_M_MOH    = 00002000            MT_TC_M_EABO   = 00001000            
MT$M_EOT       = 00040000            MT_DT_M_SPR    = 00000400            MT_TC_M_EPAR   = 00000008            
MT$M_FORMAT    = 000000F0            MT_DT_M_TAP    = 00004000            MT_TC_M_FCS    = 00004000            
MT$M_HWL       = 00080000            MT_DT_S_DTN    = 00000009            MT_TC_M_FSEL   = 000000F0            
MT$M_LOST      = 00100000            MT_DT_V_7CH    = 0000000C            MT_TC_M_TCW    = 00002000            
MT$M_PARITY    = 00000008            MT_DT_V_DRQ    = 0000000B            MT_TC_S_DEN    = 00000003            
MT$S_DENSITY   = 00000005            MT_DT_V_DTN    = 00000000            MT_TC_S_EPAR   = 00000001            
MT$S_FORMAT    = 00000004            MT_DT_V_MOH    = 0000000D            MT_TC_S_FSEL   = 00000004            
MT$V_BOT       = 00000010            MT_DT_V_SPR    = 0000000A            MT_TC_S_SSEL   = 00000003            
MT$V_DENSITY   = 00000008            MT_DT_V_TAP    = 0000000E            MT_TC_V_ACCL   = 0000000F            
MT$V_EOF       = 00000011            MT_ER            00000008            MT_TC_V_DEN    = 00000008            
MT$V_EOT       = 00000012            MT_ER_M_COR    = 00008000            MT_TC_V_EABO   = 0000000C            
MT$V_FORMAT    = 00000004            MT_ER_M_CPAR   = 00000008            MT_TC_V_EPAR   = 00000003            
MT$V_HWL       = 00000013            MT_ER_M_CRC    = 00008000            MT_TC_V_FCS    = 0000000E            
MT$V_LOST      = 00000014            MT_ER_M_CS     = 00000400            MT_TC_V_FSEL   = 00000004            
MT$V_PARITY    = 00000003            MT_ER_M_DPAR   = 00000020            MT_TC_V_SSEL   = 00000000            
MT_AS            00000010            MT_ER_M_DTE    = 00001000            MT_TC_V_TCW    = 0000000D            
MT_CC            0000001C            MT_ER_M_FCE    = 00000200            NOP              000002B2 R     03   
MT_CS1           00000000            MT_ER_M_FMT    = 00000010            NORXIT           000003F3 R     03   
MT_CS1_M_GO    = 00000001            MT_ER_M_ILF    = 00000001            NRZI           = 00000003            
MT_CS1_S_FCODE = 00000005            MT_ER_M_ILR    = 00000002            PE             = 00000004            
MT_CS1_V_FCODE = 00000001            MT_ER_M_INC    = 00000040            POSIT            00000878 R     03   
MT_CS1_V_GO    = 00000000            MT_ER_M_ITM    = 00000400            PR$_ACCR       = 00000029            
MT_DS            00000004            MT_ER_M_LRC    = 00000080            PR$_ACCS       = 00000028            
MT_DS_M_ATA    = 00008000            MT_ER_M_NEF    = 00000800            PR$_ASTLVL     = 00000013            
MT_DS_M_BOT    = 00000002            MT_ER_M_NSG    = 00000100            PR$_ESP        = 00000001            
MT_DS_M_DPR    = 00000100            MT_ER_M_OPI    = 00002000            PR$_ICCS       = 00000018            
MT_DS_M_DRY    = 00000080            MT_ER_M_PEF    = 00000080            PR$_ICR        = 0000001A            
MT_DS_M_EOT    = 00000400            MT_ER_M_RMR    = 00000004            PR$_IPL        = 00000012            
MT_DS_M_ERR    = 00004000            MT_ER_M_UNS    = 00004000            PR$_ISP        = 00000004            
MT_DS_M_IDB    = 00000008            MT_ER_M_VPE    = 00000040            PR$_KSP        = 00000000            
MT_DS_M_MOL    = 00001000            MT_ER_V_COR    = 0000000F            PR$_MAPEN      = 00000038            
MT_DS_M_PES    = 00000020            MT_ER_V_CPAR   = 00000003            PR$_NICR       = 00000019            
MT_DS_M_PIP    = 00002000            MT_ER_V_CRC    = 0000000F            PR$_P0BR       = 00000008            
MT_DS_M_SDWN   = 00000010            MT_ER_V_CS     = 0000000A            PR$_P0LR       = 00000009            
MT_DS_M_SLA    = 00000001            MT_ER_V_DPAR   = 00000005            PR$_P1BR       = 0000000A            
MT_DS_M_SSC    = 00000040            MT_ER_V_DTE    = 0000000C            PR$_P1LR       = 0000000B            
MT_DS_M_TM     = 00000004            MT_ER_V_FCE    = 00000009            PR$_PCBB       = 00000010            
MT_DS_M_WRL    = 00000800            MT_ER_V_FMT    = 00000004            PR$_RXCS       = 00000020            
MT_DS_V_ATA    = 0000000F            MT_ER_V_ILF    = 00000000            PR$_RXDB       = 00000021            
MT_DS_V_BOT    = 00000001            MT_ER_V_ILR    = 00000001            PR$_SBIER      = 00000034            
MT_DS_V_DPR    = 00000008            MT_ER_V_INC    = 00000006            PR$_SBIFS      = 00000030            
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page  53
SYMBOL TABLE                                                                                                                     (1)

PR$_SBIMT      = 00000033            TIME_OUT         00000047 R     03   UCB$L_MEDIA      00000088            
PR$_SBIQC      = 00000036            TM$DDT           00000000 RG    03   UCB$L_MT_RECORD  00000090  G         
PR$_SBIS       = 00000031            TM$INT           00000AB7 RG    03   UCB$L_MT_SR      00000080  G         
PR$_SBISC      = 00000032            UCB$B_AMOD       00000053            UCB$L_NT_DATSSB  00000074            
PR$_SBITA      = 00000035            UCB$B_CEX        00000077            UCB$L_NT_INTSSB  00000078            
PR$_SBR        = 0000000C            UCB$B_CM1        0000004A            UCB$L_OPCNT      00000060            
PR$_SCBB       = 00000011            UCB$B_CM2        0000004B            UCB$L_OWNUIC     0000001C            
PR$_SID        = 0000003E            UCB$B_DEVCLASS   00000038            UCB$L_PID        00000028            
PR$_SIRR       = 00000014            UCB$B_DEVTYPE    00000039            UCB$L_RQBL       00000004            
PR$_SISR       = 00000015            UCB$B_DIPL       00000052            UCB$L_RQFL       00000000            
PR$_SLR        = 0000000D            UCB$B_DX_SCTCNT  FFFFFFFE            UCB$L_SVAPTE     00000068            
PR$_SSP        = 00000002            UCB$B_DX_SPARE   FFFFFFFF            UCB$L_SVPN       00000064            
PR$_TBIA       = 00000039            UCB$B_ERTCNT     00000070            UCB$L_TTCHAR     0000003C            
PR$_TBIS       = 0000003A            UCB$B_ERTMAX     00000071            UCB$L_VCB        00000030            
PR$_TODR       = 0000001B            UCB$B_ESCAPE     0000004B            UCB$M_BSY      = 00000100            
PR$_TXCS       = 00000022            UCB$B_FEX        00000076            UCB$M_CANCEL   = 00000008            
PR$_TXDB       = 00000023            UCB$B_FIPL       0000000B            UCB$M_DEADMO   = 00000400            
PR$_USP        = 00000003            UCB$B_LOCSRV     0000003C            UCB$M_DELMBX   = 00000002            
PR$_WCSA       = 0000002C            UCB$B_OFFNDX     00000090            UCB$M_DIAGBUF  = 00000002            
PR$_WCSD       = 0000002D            UCB$B_OFFRTC     00000091            UCB$M_DX_WRITE = 00000008            
READDATA         0000040F R     03   UCB$B_REMSRV     0000003D            UCB$M_ECC      = 00000001            
READDATAR        000004F9 R     03   UCB$B_SECTORS    0000003C            UCB$M_ERLOGIP  = 00000004            
READPRESET       00000330 R     03   UCB$B_SLAVE      00000074            UCB$M_INT      = 00000002            
RECAL            000008B0 R     03   UCB$B_SPR        00000075            UCB$M_INTTYPE  = 00000080            
REGDUMP          00000A5F R     03   UCB$B_STATE      00000052            UCB$M_JOB      = 00000001            
RETREG           0000099D R     03   UCB$B_TRACKS     0000003D            UCB$M_MOUNTING = 00000200            
RETRY            0000070C R     03   UCB$B_TYPE       0000000A            UCB$M_NOCNVRT  = 00000004            
REWIND           00000338 R     03   UCB$B_VERTSZ     0000003F            UCB$M_NT_BFROVF= 00000004            
SENSECHAR        000002B2 R     03   UCB$C_LENGTH     00000074            UCB$M_NT_BREAK = 00000020            
SETCHAR          000002B9 R     03   UCB$C_LOGLNK   = 00000001            UCB$M_NT_NAME  = 00000010            
SETEOF           000003F8 R     03   UCB$K_LENGTH     00000074            UCB$M_NT_NONTR = 00000040            
SPCFILFOR        00000347 R     03   UCB$L_AMB        00000054            UCB$M_NT_SDP   = 00000008            
SPCFILREV        0000036E R     03   UCB$L_ASTQBL     00000010            UCB$M_ONLINE   = 00000010            
SPCRECFOR        00000399 R     03   UCB$L_ASTQFL     0000000C            UCB$M_POWER    = 00000020            
SPCRECREV        000003BD R     03   UCB$L_CPID       0000005C            UCB$M_PRMMBX   = 00000001            
SPECON           00000A39 R     03   UCB$L_CRB        00000020            UCB$M_TIM      = 00000001            
SS$_ABORT        ********   X   03   UCB$L_DDB        00000024            UCB$M_TIMOUT   = 00000040            
SS$_CTRLERR      ********   X   03   UCB$L_DEVCHAR    00000034            UCB$M_TT_NOTIF = 00000004            
SS$_DATACHECK    ********   X   03   UCB$L_DEVDEPEND  0000003C            UCB$M_TT_TIMO  = 00000002            
SS$_DATAOVERUN   ********   X   03   UCB$L_DPC        0000007C            UCB$M_VALID    = 00000800            
SS$_DRVERR       ********   X   03   UCB$L_DUETIM     0000005C            UCB$S_LNKPRI   = 00000002            
SS$_ENDOFFILE    ********   X   03   UCB$L_DX_BFPNT   FFFFFFF4            UCB$S_LTYPE    = 00000002            
SS$_ENDOFTAPE    ********   X   03   UCB$L_DX_BUF     FFFFFFF0            UCB$T_PARTNER    0000000C            
SS$_FORMAT       ********   X   03   UCB$L_DX_RXDB    FFFFFFF8            UCB$V_BACKP    = 00000005            
SS$_MEDOFL       ********   X   03   UCB$L_EMB        00000078            UCB$V_BSY      = 00000008            
SS$_NONEXDRV     ********   X   03   UCB$L_FIRST      00000014            UCB$V_CANCEL   = 00000003            
SS$_NORMAL       ********   X   03   UCB$L_FPC        0000000C            UCB$V_DEADMO   = 0000000A            
SS$_OPINCOMPL    ********   X   03   UCB$L_FQBL       00000004            UCB$V_DELMBX   = 00000001            
SS$_PARITY       ********   X   03   UCB$L_FQFL       00000000            UCB$V_DIAGBUF  = 00000001            
SS$_TIMEOUT      ********   X   03   UCB$L_FR3        00000010            UCB$V_DX_WRITE = 00000003            
SS$_UNSAFE       ********   X   03   UCB$L_FR4        00000014            UCB$V_ECC      = 00000000            
SS$_WRITLCK      ********   X   03   UCB$L_IOQBL      00000044            UCB$V_ERLOGIP  = 00000002            
STARTIO          0000016F R     03   UCB$L_IOQFL      00000040            UCB$V_INT      = 00000001            
STSXIT           00000838 R     03   UCB$L_IRP        0000004C            UCB$V_INTTYPE  = 00000007            
TESTR            000006BE R     03   UCB$L_LINK       0000002C            UCB$V_JOB      = 00000000            
THRESHOLD      = 00000008            UCB$L_LOGADR     00000064            UCB$V_LNKPRI   = 00000006            
TIMEO            00000A50 R     03   UCB$L_MAXBLOCK   00000080            UCB$V_LTYPE    = 00000000            
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page  54
SYMBOL TABLE                                                                                                                     (1)

UCB$V_MOUNTING = 00000009            VEC$B_DATAPATH   00000013            WCB$W_REFCNT     0000000E            
UCB$V_MSGACK   = 00000004            VEC$B_NUMREG     00000012            WCB$W_SIZE       00000008            
UCB$V_MSGFLO   = 00000003            VEC$L_ADP        00000014            WRITECHECK       00000408 R     03   
UCB$V_NOCNVRT  = 00000002            VEC$L_IDB        00000008            WRITECHECKR      000004F2 R     03   
UCB$V_NT_BFROVF= 00000002            VEC$L_INITIAL    0000000C            WRITEDATA        0000060E R     03   
UCB$V_NT_BREAK = 00000005            VEC$L_TT_DISC    00000020            WRITEMARK        00000261 R     03   
UCB$V_NT_NAME  = 00000004            VEC$L_TT_ILINE   00000018            XFER             000008F0 R     03   
UCB$V_NT_NONTR = 00000006            VEC$L_TT_STRTIO  0000001C            XTAB             00000093 R     03   
UCB$V_NT_SDP   = 00000003            VEC$M_MAPLOCK  = 00008000            
UCB$V_ONLINE   = 00000004            VEC$M_PATHLOCK = 00000080            
UCB$V_POWER    = 00000005            VEC$Q_DISPATCH   00000000            
UCB$V_PRMMBX   = 00000000            VEC$S_DATAPATH = 00000007            
UCB$V_SEGFLO   = 00000002            VEC$S_MAPREG   = 0000000F            
UCB$V_TIM      = 00000000            VEC$V_DATAPATH = 00000000            
UCB$V_TIMOUT   = 00000006            VEC$V_MAPLOCK  = 0000000F            
UCB$V_TT_NOTIF = 00000002            VEC$V_MAPREG   = 00000000            
UCB$V_TT_TIMO  = 00000001            VEC$V_PATHLOCK = 00000007            
UCB$V_VALID    = 0000000B            VEC$W_MAPREG     00000010            
UCB$W_BCNT       0000006E            WCB$B_ACCESS     0000000B            
UCB$W_BCR        00000092            WCB$B_TYPE       0000000A            
UCB$W_BOFF       0000006C            WCB$C_LENGTH     00000024            
UCB$W_BUFQUO     00000018            WCB$C_MAP        00000024            
UCB$W_BYTESTOGO  0000003E            WCB$K_LENGTH     00000024            
UCB$W_CHARGE     0000004A            WCB$K_MAP        00000024            
UCB$W_CYLINDERS  0000003E            WCB$L_FCB        00000018            
UCB$W_DA         00000088            WCB$L_LBN        00000002            
UCB$W_DC         0000008A            WCB$L_ORGUCB     00000010            
UCB$W_DEVBUFSIZ  0000003A            WCB$L_P1_LBN     00000026            
UCB$W_DEVSTS     0000005A            WCB$L_P2_LBN     0000002C            
UCB$W_DSTADDR    00000018            WCB$L_PID        0000000C            
UCB$W_DX_BCR     FFFFFFFC            WCB$L_PREVLBN    FFFFFFFC            
UCB$W_EC1        0000008C            WCB$L_RVT        0000001C            
UCB$W_EC2        0000008E            WCB$L_STVBN      00000020            
UCB$W_ERRCNT     00000072            WCB$L_WLBL       00000004            
UCB$W_FUNC       00000084            WCB$L_WLFL       00000000            
UCB$W_MB_SEED    FFFFFFFC            WCB$M_NOTFCP   = 00000004            
UCB$W_MSGCNT     00000016            WCB$M_READ     = 00000001            
UCB$W_MSGMAX     00000014            WCB$M_SHRWCB   = 00000008            
UCB$W_MT_CS1     0000008C  G         WCB$M_WRITE    = 00000002            
UCB$W_MT_DS      00000084  G         WCB$V_DLOCK    = 00000001            
UCB$W_MT_ER      00000086  G         WCB$V_NOREAD   = 0000000A            
UCB$W_MT_FC      00000088  G         WCB$V_NOTFCP   = 00000002            
UCB$W_MT_FORCNT  00000094  G         WCB$V_NOWRITE  = 00000000            
UCB$W_MT_FUNC    0000008E  G         WCB$V_READ     = 00000000            
UCB$W_MT_SPACNT  0000008A  G         WCB$V_READCK   = 00000009            
UCB$W_MT_TC      00000096  G         WCB$V_SEQONLY  = 00000006            
UCB$W_MT_TC_SAV  00000098  G         WCB$V_SHRWCB   = 00000003            
UCB$W_NT_CHAN    0000007C            WCB$V_SPOOL    = 00000004            
UCB$W_OFFSET     00000086            WCB$V_WRITE    = 00000001            
UCB$W_REFC       00000050            WCB$V_WRITEAC  = 00000008            
UCB$W_SIZE       00000008            WCB$V_WRITECK  = 00000005            
UCB$W_SRCADDR    0000001A            WCB$W_ACON       00000014            
UCB$W_STS        00000058            WCB$W_COUNT      00000000            
UCB$W_UNIT       00000048            WCB$W_NMAP       00000016            
UCB$W_VPROT      0000001A            WCB$W_P1_COUNT   00000024            
UNLOAD           00000338 R     03   WCB$W_P2_COUNT   0000002A            
UNSOLNT          00000AB6 R     03   WCB$W_PREVCOUNT  FFFFFFFA            
TMDRIVER        - TM03-TE16/TU77 MAGTAPE DRIVER                  21-AUG-1978 23:57:20   VAX-11 MACRO X0.3-11               Page  55
PROGRAM SECTION SYNOPSIS                                                                                                         (1)



PROGRAM SECTION SYNOPSIS

.  ABS  .        00000000      00     NOPIC   USR   CON   ABS   LCL NOSHR NOEXE NORD  NOWRT BYTE  
. BLANK .        00000000      01     NOPIC   USR   CON   REL   LCL NOSHR   EXE   RD    WRT BYTE  
$ABS$            FFFFFFFF      02     NOPIC   USR   CON   ABS   LCL NOSHR   EXE   RD    WRT BYTE  
WIONONPAGED      00000B2E      03     NOPIC   USR   CON   REL   LCL NOSHR   EXE   RD    WRT BYTE  


THERE WERE NO ERRORS OR WARNINGS.
1394. BYTES LEFT IN FREE MEMORY POOL.
34. BYTES OF RECLAIMED MEMORY.
OBJ$:TMDRIVER,LIS$:TMDRIVER/-SP=LIB$:LIB/ML,SRC$:TMDRIVER
24 MLB DIR RDS - 1265 GETS TO DEFINE 36 MACROS. 129 INTER. FILE WRITES. 
