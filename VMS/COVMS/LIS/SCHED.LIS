SCHED           RESCHEDULING INTERRUPT HANDLER                   21-AUG-1978 23:32:41   VAX-11 MACRO X0.3-11               Page   0
TABLE OF CONTENTS   

   (1)      32  SCH$RESCHED RESCHEDULING INTERRUPT HANDLER
SCHED           RESCHEDULING INTERRUPT HANDLER                   21-AUG-1978 23:32:41   VAX-11 MACRO X0.3-11               Page   1
X01                                                                                                                              (1)

                                     0000     1 	.TITLE	SCHED RESCHEDULING INTERRUPT HANDLER
                                     0000     2 	.IDENT	/X01/
                                     0000     3 ; COPYRIGHT (C) 1977
                                     0000     4 ; DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASS.
                                     0000     5 ;
                                     0000     6 ; THIS SOFTWARE IS FURNISHED UNDER  A LICENSE FOR USE ONLY  ON  A
                                     0000     7 ; SINGLE COMPUTER SYSTEM AND MAY BE  COPIED ONLY WITH  THE INCLU-
                                     0000     8 ; SION OF  THE  ABOVE  COPYRIGHT NOTICE.  THIS SOFTWARE,  OR  ANY
                                     0000     9 ; OTHER COPIES THEREOF, MAY NOT BE  PROVIDED  OR  OTHERWISE  MADE
                                     0000    10 ; AVAILABLE TO ANY OTHER PERSON EXCEPT  FOR  USE  ON  SUCH SYSTEM
                                     0000    11 ; AND TO  ONE WHO AGREES  TO  THESE LICENSE  TERMS.  TITLE TO AND
                                     0000    12 ; OWNERSHIP OF THE SOFTWARE SHALL AT ALL TIMES REMAIN IN DEC.
                                     0000    13 ;
                                     0000    14 ; THE INFORMATION IN THIS SOFTWARE  IS  SUBJECT TO CHANGE WITHOUT
                                     0000    15 ; NOTICE AND SHOULD NOT BE CONSTRUED  AS  A COMMITMENT BY DIGITAL
                                     0000    16 ; EQUIPMENT CORPORATION.
                                     0000    17 ;
                                     0000    18 ; DEC ASSUMES NO RESPONSIBILITY FOR THE USE OR RELIABILITY OF ITS
                                     0000    19 ; SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DEC.
                                     0000    20 ;
                                     0000    21 ; INCLUDE FILES:
                                     0000    22 
                                     0000    23 	$CADEF				;DEFINE CONDITIONAL ASSEMBLY
                                     0000    24 	$DYNDEF				;STRUCTURE TYPE CODE DEFINITIONS
                                     0000    25 	$IPLDEF				;INTERRUPT PRIORITY LEVEL DEFINITIONS
                                     0000    26 	$PCBDEF				;PCB DEFINITIONS
                                     0000    27 	$PHDDEF				;PHD DEFINITIONS
                                     0000    28 	$PRDEF				;PROCESSOR REGISTER DEFINITIONS
                                     0000    29 	$STATEDEF			;STATE DEFINITIONS
                                 00000000    30 	.PSECT	AEXENONPAGED,LONG	; NONPAGED EXEC
SCHED           RESCHEDULING INTERRUPT HANDLER                   21-AUG-1978 23:32:41   VAX-11 MACRO X0.3-11               Page   2
X01             SCH$RESCHED RESCHEDULING INTERRUPT HANDLER                                                                       (1)

                                     0000    32 	.SBTTL	SCH$RESCHED RESCHEDULING INTERRUPT HANDLER
                                     0000    33 ;++
                                     0000    34 ; SCH$RESCHED - RESCHEDULING INTERRUPT HANDLER
                                     0000    35 ;
                                     0000    36 ; THIS ROUTINE IS ENTERED VIA THE IPL 3 RESCHEDULING INTERRUPT.
                                     0000    37 ; THE VECTOR FOR THIS INTERRUPT IS CODED TO CAUSE EXECUTION
                                     0000    38 ; ON THE KERNEL STACK.
                                     0000    39 ;
                                     0000    40 ; ENVIRONMENT:
                                     0000    41 ;	IPL=3 MODE=KERNEL IS=0
                                     0000    42 ; INPUT:
                                     0000    43 ;	00(SP)=PC AT RESCHEDULE INTERRUPT
                                     0000    44 ;	04(SP)=PSL AT INTERRUPT.
                                     0000    45 ;--
                                     0000    46 SCH$RESCHED::				;RESCHEDULE INTERRUPT HANDLER
                                     0000    47 	SETIPL	#IPL$_SYNCH		;SYNCHRONIZE SCHEDULER WITH EVENT REPORTING
                                 07  0003    48 	SVPCTX				;SAVE CONTEXT OF PROCESS
            51       0000'CF     D0  0004    49 	MOVL	W^SCH$GL_CURPCB,R1	;GET ADDRESS OF CURRENT PCB
            52         0B A1     9A  0009    50 	MOVZBL	PCB$B_PRI(R1),R2	;CURRENT PRIORITY
       0000'CF            52     E2  000D    51 	BBSS	R2,W^SCH$GL_COMQS,10$	;MARK QUEUE NON-EMPTY
                          00         0012       
         30 A1            0C     B0  0013    52 10$:	MOVW	#SCH$C_COM,PCB$W_STATE(R1) ;SET STATE TO RES COMPUTE
            53       0000'CF42   7E  0017    53 	MOVAQ	W^SCH$AQ_COMT[R2],R3	;COMPUTE ADDRESS OF QUEUE
            93            61     0E  001D    54 	INSQUE	(R1),@(R3)+		;INSERT AT TAIL OF QUEUE
                                     0020    55 
                           00000002  0020    56 	.IF NE CA$_MEASURE		;CHECK IF MEASUREMENT ENABLED
                 00000000'EF     D6  0020    57 	INCL	PMS$GL_SWITCH		;NOTE SWITCHED FROM CURRENT PROCESS
                                     0026    58 	.ENDC
                                     0026    59 ;+
                                     0026    60 ; SCH$SCHED - SCHEDULE NEW PROCESS FOR EXECUTION
                                     0026    61 ;
                                     0026    62 ; THIS ROUTINE SELECTS THE HIGHEST PRIORITY EXECUTABLE PROCESS
                                     0026    63 ; AND PLACES IT IN EXECUTION.
                                     0026    64 ;-
                                     0026    65 SCH$SCHED::				;SCHEDULE FOR EXECUTION
                                     0026    66 	SETIPL	#IPL$_SYNCH		;SYNCHRONIZE SCHEDULER WITH EVENT REPORTING
            20            00     EA  0029    67 	FFS	#0,#32,W^SCH$GL_COMQS,R2	;FIND FIRST FULL STATE
            52       0000'CF         002C       
                          F4     13  0030    68 	BEQL	SCH$SCHED		;NO EXECUTABLE PROCESS??
            53       0000'CF42   7E  0032    69 	MOVAQ	W^SCH$AQ_COMH[R2],R3	;COMPUTE QUEUE HEAD ADDRESS
            54            93     0F  0038    70 	REMQUE	@(R3)+,R4		;GET HEAD OF QUEUE
                          38     1D  003B    71 	BVS	QEMPTY			;BR IF QUEUE WAS EMPTY (BUG CHECK)
                          06     12  003D    72 	BNEQ	20$			;QUEUE NOT EMPTY
       0000'CF            52     E5  003F    73 	BBCC	R2,W^SCH$GL_COMQS,20$	;SET QUEUE EMPTY
                          00         0044       
                                     0045    74 20$:					;
         0A A4            0C     91  0045    75 	CMPB	#DYN$C_PCB,PCB$B_TYPE(R4)  ;MUST BE A PROCESS CONTROL BLOCK
                          2A     12  0049    76 	BNEQ	QEMPTY			;OTHERWISE FATAL ERROR
         30 A4            0E     B0  004B    77 	MOVW	#SCH$C_CUR,PCB$W_STATE(R4) ;SET STATE TO CURRENT
       0000'CF            54     D0  004F    78 	MOVL	R4,W^SCH$GL_CURPCB	;NOTE CURRENT PCB LOC
         0B A4         33 A4     91  0054    79 	CMPB	PCB$B_PRIB(R4),PCB$B_PRI(R4) ;CHECK FOR BASE
                                     0059    80 					;PRIORITY=CURRENT
                          08     13  0059    81 	BEQL	30$			;YES, DONT FLOAT PRIORITY
         0B A4            04     E1  005B    82 	BBC	#4,PCB$B_PRI(R4),30$	;DONT FLOAT REAL TIME PRIORITY
                          03         005F       
                       0B A4     96  0060    83 	INCB	PCB$B_PRI(R4)		;MOVE TOWARD BASE PRIO
       0000'CF         0B A4     90  0063    84 30$:	MOVB	PCB$B_PRI(R4),W^SCH$GB_PRI	;SET GLOBAL PRIORITY
SCHED           RESCHEDULING INTERRUPT HANDLER                   21-AUG-1978 23:32:41   VAX-11 MACRO X0.3-11               Page   3
X01             SCH$RESCHED RESCHEDULING INTERRUPT HANDLER                                                                       (1)

            10         18 A4     DA  0069    85 	MTPR	PCB$L_PHYPCB(R4),#PR$_PCBB 	;SET PCB BASE PHYS ADDR
                                 06  006D    86 	LDPCTX				;RESTORE CONTEXT
                                     006E    87 
                           00000002  006E    88 	.IF NE CA$_MEASURE		;CHECK MEASUREMENT ENABLED
                 00000000'EF     D6  006E    89 	INCL	PMS$GL_LDPCTX		;COUNT PROCESS START
                                     0074    90 	.ENDC
                                     0074    91 
                                 02  0074    92 	REI				;NORMAL RETURN
                                     0075    93 
                                     0075    94 
                                     0075    95 QEMPTY:	BUG_CHECK QUEUEMPTY,FATAL	;SCHEDULING QUEUE EMPTY
                                     0079    96 
                                     0079    97 	.END
SCHED           RESCHEDULING INTERRUPT HANDLER                   21-AUG-1978 23:32:41   VAX-11 MACRO X0.3-11               Page   4
SYMBOL TABLE                                                                                                                     (1)

BIT...         = 0000000F            PCB$B_TYPE       0000000A            PCB$W_PPGCNT     0000003A            
BUG$_QUEUEMPTY   ********   X   03   PCB$B_WEFC       00000032            PCB$W_PRCCNT     0000006A            
CA$_MEASURE    = 00000002            PCB$C_LENGTH     0000007C            PCB$W_SIZE       00000008            
CA$_MEASURE_IOT= 00000004            PCB$K_LENGTH     0000007C            PCB$W_STATE      00000030            
CA$_SIMULATOR  = 00000001            PCB$L_ASTQBL     00000014            PCB$W_TMBU       00000036            
DYN$C_ACB      = 00000002            PCB$L_ASTQFL     00000010            PCB$W_TQCNT      0000004A            
DYN$C_ADP      = 00000001            PCB$L_EFC2P      00000058            PHD$B_ASTLVL     000000CF            
DYN$C_AQB      = 00000003            PCB$L_EFC3P      0000005C            PHD$B_DFPFC      00000038            
DYN$C_BRDCST   = 0000001A            PCB$L_EFCS       00000050            PHD$B_PAGFIL     0000001F            
DYN$C_BUFIO    = 00000013            PCB$L_EFCU       00000054            PHD$C_LENGTH     000000D8            
DYN$C_CEB      = 00000004            PCB$L_EFWM       0000004C            PHD$K_LENGTH     000000D8            
DYN$C_CIR      = 0000001E            PCB$L_OWNER      0000001C            PHD$L_BIOCNT     00000054            
DYN$C_CRB      = 00000005            PCB$L_PHD        00000064            PHD$L_CPULIM     00000058            
DYN$C_CXB      = 0000001B            PCB$L_PHYPCB     00000018            PHD$L_CPUTIM     0000003C            
DYN$C_DDB      = 00000006            PCB$L_PID        00000060            PHD$L_DIOCNT     00000050            
DYN$C_FCB      = 00000007            PCB$L_PQB        0000004C            PHD$L_ESP        0000007C            
DYN$C_FRK      = 00000008            PCB$L_SQBL       00000004            PHD$L_FREP0VA    00000028            
DYN$C_GSD      = 00000015            PCB$L_SQFL       00000000            PHD$L_FREP1VA    00000030            
DYN$C_IDB      = 00000009            PCB$L_STS        00000028            PHD$L_FREPTECNT  0000002C            
DYN$C_IRP      = 0000000A            PCB$L_UIC        00000020            PHD$L_KSP        00000078            
DYN$C_JPB      = 0000001F            PCB$L_WSSWP      00000024            PHD$L_P0BR       000000C8            
DYN$C_KFH      = 00000026            PCB$L_WTIME      0000002C            PHD$L_P0LRASTL   000000CC            
DYN$C_KFI      = 00000018            PCB$T_LNAME      0000006C            PHD$L_P1BR       000000D0            
DYN$C_LOG      = 0000000B            PCB$V_ASTPEN   = 00000011            PHD$L_P1LR       000000D4            
DYN$C_MTL      = 00000019            PCB$V_BATCH    = 0000000E            PHD$L_PAGEFLTS   0000004C            
DYN$C_MVL      = 00000016            PCB$V_DELPEN   = 00000001            PHD$L_PAGFIL     0000001C            
DYN$C_NDB      = 0000001C            PCB$V_FORCPEN  = 00000002            PHD$L_PC         000000C0            
DYN$C_NET      = 00000017            PCB$V_HIBER    = 00000013            PHD$L_PCB        00000078            
DYN$C_PBH      = 00000020            PCB$V_INQUAN   = 00000003            PHD$L_PGFLCNT    00000034            
DYN$C_PCB      = 0000000C            PCB$V_LOGIN    = 00000014            PHD$L_PGFLQUOTA  0000005C            
DYN$C_PDB      = 00000021            PCB$V_NOACNT   = 0000000F            PHD$L_PSL        000000C4            
DYN$C_PFL      = 00000023            PCB$V_PHDRES   = 00000012            PHD$L_PSTBASOFF  00000020            
DYN$C_PIB      = 00000022            PCB$V_PSWAPM   = 00000004            PHD$L_PTWSLELCK  00000064            
DYN$C_PQB      = 0000000D            PCB$V_RES      = 00000000            PHD$L_PTWSLEVAL  00000068            
DYN$C_PTR      = 00000025            PCB$V_RESPEN   = 00000005            PHD$L_R0         00000088            
DYN$C_RVT      = 0000000E            PCB$V_SSFEXC   = 00000006            PHD$L_R1         0000008C            
DYN$C_SFT      = 00000024            PCB$V_SSFEXCE  = 00000007            PHD$L_R10        000000B0            
DYN$C_SSB      = 0000001D            PCB$V_SSFEXCS  = 00000008            PHD$L_R11        000000B4            
DYN$C_TQE      = 0000000F            PCB$V_SSFEXCU  = 00000009            PHD$L_R12        000000B8            
DYN$C_TYPAHD   = 00000014            PCB$V_SSRWAIT  = 0000000A            PHD$L_R13        000000BC            
DYN$C_UCB      = 00000010            PCB$V_SUSPEN   = 0000000B            PHD$L_R2         00000090            
DYN$C_VCB      = 00000011            PCB$V_SWPVBN   = 00000010            PHD$L_R3         00000094            
DYN$C_WCB      = 00000012            PCB$V_WAKEPEN  = 0000000C            PHD$L_R4         00000098            
GBL...         = 00000000            PCB$V_WALL     = 0000000D            PHD$L_R5         0000009C            
IPL$_ASTDEL    = 00000002            PCB$W_APTCNT     00000034            PHD$L_R6         000000A0            
IPL$_HWCLK     = 00000018            PCB$W_ASTCNT     0000003C            PHD$L_R7         000000A4            
IPL$_IOPOST    = 00000004            PCB$W_BIOCNT     0000003E            PHD$L_R8         000000A8            
IPL$_MAILBOX   = 0000000B            PCB$W_BIOLM      00000040            PHD$L_R9         000000AC            
IPL$_POWER     = 0000001F            PCB$W_BYTCNT     00000042            PHD$L_SSP        00000080            
IPL$_QUEUEAST  = 00000006            PCB$W_BYTLM      00000068            PHD$L_USP        00000084            
IPL$_SCHED     = 00000003            PCB$W_DIOCNT     00000044            PHD$L_WSL        000000D8            
IPL$_SYNCH     = 00000007            PCB$W_DIOLM      00000046            PHD$M_DALCSTX  = 00000002            
IPL$_TIMER     = 00000007            PCB$W_FILCNT     00000048            PHD$M_PFMFLG   = 00000001            
PCB$B_ASTACT     0000000C            PCB$W_GPGCNT     00000038            PHD$Q_PRIVMSK    00000000            
PCB$B_ASTEN      0000000D            PCB$W_GRP        00000022            PHD$S_ASTLVL   = 00000008            
PCB$B_PRI        0000000B            PCB$W_MEM        00000020            PHD$S_P0LR     = 00000018            
PCB$B_PRIB       00000033            PCB$W_MTXCNT     0000000E            PHD$V_ASTLVL   = 00000018            
SCHED           RESCHEDULING INTERRUPT HANDLER                   21-AUG-1978 23:32:41   VAX-11 MACRO X0.3-11               Page   5
SYMBOL TABLE                                                                                                                     (1)

PHD$V_DALCSTX  = 00000001            PR$_SBR        = 0000000C            
PHD$V_P0LR     = 00000000            PR$_SCBB       = 00000011            
PHD$V_PFMFLG   = 00000000            PR$_SID        = 0000003E            
PHD$W_ASTLM      00000044            PR$_SIRR       = 00000014            
PHD$W_BAK        00000048            PR$_SISR       = 00000015            
PHD$W_DFWSCNT    0000001A            PR$_SLR        = 0000000D            
PHD$W_EXTDYNWS   00000076            PR$_SSP        = 00000002            
PHD$W_FILLM      00000060            PR$_TBIA       = 00000039            
PHD$W_FLAGS      0000003A            PR$_TBIS       = 0000003A            
PHD$W_PFMFLG     0000003A            PR$_TODR       = 0000001B            
PHD$W_PHVINDEX   00000046            PR$_TXCS       = 00000022            
PHD$W_PRCLM      00000042            PR$_TXDB       = 00000023            
PHD$W_PST        00000020            PR$_USP        = 00000003            
PHD$W_PSTFREE    00000026            PR$_WCSA       = 0000002C            
PHD$W_PSTLAST    00000024            PR$_WCSD       = 0000002D            
PHD$W_PTCNTACT   00000070            QEMPTY           00000075 R     03   
PHD$W_PTCNTLCK   0000006C            SCH$AQ_COMH      ********   X   03   
PHD$W_PTCNTMAX   00000072            SCH$AQ_COMT      ********   X   03   
PHD$W_PTCNTVAL   0000006E            SCH$C_CEF      = 00000003            
PHD$W_QUANT      00000040            SCH$C_COLPG    = 00000001            
PHD$W_TQLM       00000062            SCH$C_COM      = 0000000C            
PHD$W_WSAUTH     0000000A            SCH$C_COMO     = 0000000D            
PHD$W_WSDYN      0000000E            SCH$C_CUR      = 0000000E            
PHD$W_WSFLUID    00000074            SCH$C_FPG      = 0000000B            
PHD$W_WSLAST     00000012            SCH$C_HIB      = 00000007            
PHD$W_WSLIST     00000008            SCH$C_HIBO     = 00000008            
PHD$W_WSLOCK     0000000C            SCH$C_LEF      = 00000005            
PHD$W_WSLX       0000004A            SCH$C_LEFO     = 00000006            
PHD$W_WSNEXT     00000010            SCH$C_MWAIT    = 00000002            
PHD$W_WSQUOTA    00000018            SCH$C_PFW      = 00000004            
PMS$GL_LDPCTX    ********   X   03   SCH$C_SUSP     = 00000009            
PMS$GL_SWITCH    ********   X   03   SCH$C_SUSPO    = 0000000A            
PR$_ACCR       = 00000029            SCH$GB_PRI       ********   X   03   
PR$_ACCS       = 00000028            SCH$GL_COMQS     ********   X   03   
PR$_ASTLVL     = 00000013            SCH$GL_CURPCB    ********   X   03   
PR$_ESP        = 00000001            SCH$RESCHED      00000000 RG    03   
PR$_ICCS       = 00000018            SCH$SCHED        00000026 RG    03   
PR$_ICR        = 0000001A            
PR$_IPL        = 00000012            
PR$_ISP        = 00000004            
PR$_KSP        = 00000000            
PR$_MAPEN      = 00000038            
PR$_NICR       = 00000019            
PR$_P0BR       = 00000008            
PR$_P0LR       = 00000009            
PR$_P1BR       = 0000000A            
PR$_P1LR       = 0000000B            
PR$_PCBB       = 00000010            
PR$_RXCS       = 00000020            
PR$_RXDB       = 00000021            
PR$_SBIER      = 00000034            
PR$_SBIFS      = 00000030            
PR$_SBIMT      = 00000033            
PR$_SBIQC      = 00000036            
PR$_SBIS       = 00000031            
PR$_SBISC      = 00000032            
PR$_SBITA      = 00000035            
SCHED           RESCHEDULING INTERRUPT HANDLER                   21-AUG-1978 23:32:41   VAX-11 MACRO X0.3-11               Page   6
PROGRAM SECTION SYNOPSIS                                                                                                         (1)



PROGRAM SECTION SYNOPSIS

.  ABS  .        00000000      00     NOPIC   USR   CON   ABS   LCL NOSHR NOEXE NORD  NOWRT BYTE  
. BLANK .        00000000      01     NOPIC   USR   CON   REL   LCL NOSHR   EXE   RD    WRT BYTE  
$ABS$            000000DC      02     NOPIC   USR   CON   ABS   LCL NOSHR   EXE   RD    WRT BYTE  
AEXENONPAGED     00000079      03     NOPIC   USR   CON   REL   LCL NOSHR   EXE   RD    WRT LONG  


THERE WERE NO ERRORS OR WARNINGS.
18210. BYTES LEFT IN FREE MEMORY POOL.
2608. BYTES OF RECLAIMED MEMORY.
OBJ$:SCHED,LIS$:SCHED/-SP=LIB$:LIB/ML,SRC$:SCHED
3 MLB DIR RDS - 519 GETS TO DEFINE 18 MACROS. 28 INTER. FILE WRITES. 
