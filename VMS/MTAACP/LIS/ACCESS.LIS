
; Bliss-32 7.352	Saturday 21-AUG-1978 23:25:34	DBB3:[MTAACP.SRC]ACCESS.B32;4					Page 1
; Digital Equipment Corporation
;
;	0001	MODULE ACCESS (
;	0002			LANGUAGE (BLISS32),
;	0003			IDENT = 'A0001'
;	0004			) =
;	0005	BEGIN
;	0006	
;	0007	!
;	0008	! COPYRIGHT (C) 1977
;	0009	! DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASSACHUSETTS 01754
;	0010	!
;	0011	! THIS SOFTWARE IS FURNISHED  UNDER A LICENSE FOR USE ONLY ON A SINGLE
;	0012	! COMPUTER  SYSTEM AND  MAY BE  COPIED ONLY WITH  THE INCLUSION OF THE
;	0013	! ABOVE COPYRIGHT NOTICE.  THIS SOFTWARE, OR ANY OTHER COPIES THEREOF,
;	0014	! MAY NOT BE PROVIDED OR  OTHERWISE MADE AVAILABLE TO ANY OTHER PERSON
;	0015	! EXCEPT FOR USE ON SUCH SYSTEM AND TO ONE WHO AGREES TO THESE LICENSE
;	0016	! TERMS.  TITLE TO AND  OWNERSHIP OF THE  SOFTWARE  SHALL AT ALL TIMES
;	0017	! REMAIN IN DEC.
;	0018	!
;	0019	! THE INFORMATION IN THIS SOFTWARE IS SUBJECT TO CHANGE WITHOUT NOTICE
;	0020	! AND SHOULD  NOT BE CONSTRUED  AS A COMMITMENT  BY DIGITAL  EQUIPMENT
;	0021	! CORPORATION.
;	0022	!
;	0023	! DEC ASSUMES  NO  RESPONSIBILITY  FOR  THE USE OR  RELIABILITY OF ITS
;	0024	! SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DEC.
;	0025	
;	0026	!++
;	0027	!
;	0028	! FACILITY:  MTAACP
;	0029	!
;	0030	! ABSTRACT:
;	0031	!	THIS MODULE PERFORMS THE ACCESS FUNCTION FOR MTAACP
;	0032	!
;	0033	! ENVIRONMENT:
;	0034	!
;	0035	!	STARLET OPERATING SYSTEM, INCLUDING PRIVILEGED SYSTEM SERVICES
;	0036	!	AND INTERNAL EXEC ROUTINES.
;	0037	!
;	0038	!--
;	0039	!
;	0040	!
;	0041	! AUTHOR:  D. H. GILLESPIE,	 CREATION DATE: 13-MAY-77 16:20  
;	0042	!
;	0043	! REVISION HISTORY:
;	0044	!
;	0045	!   D. H. Gillespie, 11-May-78  15:38
;	0046	!   A0001 - change CURRENT_VCB to register
;	0047	!
;	0048	!**
;	0049	
;	0050	LIBRARY 'SYS$LIBRARY:LIB.L32';
;	0051	REQUIRE 'SRC$:MTADEF.B32';
;	0347	
;	0348	FORWARD ROUTINE
;	0349		MTA_ACCESS	: NOPRES NOVALUE,	!MAIN  CONTROL FOR ACCESS FUNCTION
;	0350		CHECK_FIND	: COMMON_CALL,		!CONDITIONAL DIRECTORY SEARCH

; Bliss-32 7.352	Saturday 21-AUG-1978 23:25:34	DBB3:[MTAACP.SRC]ACCESS.B32;4					Page 1-1
; Digital Equipment Corporation
;
;	0351		HANDLER;				!CONDITIONAL HANDLER TO CATCH ERROR EXIT

; Bliss-32 7.352	Saturday 21-AUG-1978 23:25:34	DBB3:[MTAACP.SRC]ACCESS.B32;4					Page 2
; Digital Equipment Corporation
;
;	0352	GLOBAL ROUTINE MTA_ACCESS : NOPRES NOVALUE =
;	0353	
;	0354	!++
;	0355	!
;	0356	! FUNCTIONAL DESCRIPTION:
;	0357	!	THIS IS THE MAIN PROCESSING ROUTINE FOR MTAACP ACCESS FUNCTION
;	0358	!
;	0359	! CALLING SEQUENCE:
;	0360	!	MTA_ACCESS()
;	0361	!
;	0362	! INPUT PARAMETERS:
;	0363	!	NONE
;	0364	!
;	0365	! IMPLICIT INPUTS:
;	0366	!	CURRENT_UCB - ADDRESS OF CURRENT UCB
;	0367	!	CURRENT_WCB - ADDRESS OF CURRENT WCB
;	0368	!	CURRENT_VCB - ADDRESS OF CURRENT VCB
;	0369	!	IO_PACKET   - ADDRESS OF CURRENT IO REQUEST PACKET
;	0370	!
;	0371	! OUTPUT PARAMETERS:
;	0372	!	NONE
;	0373	!
;	0374	! IMPLICIT OUTPUTS:
;	0375	!	NONE
;	0376	!
;	0377	! ROUTINE VALUE:
;	0378	!	NONE
;	0379	!
;	0380	! SIDE EFFECTS:
;	0381	!	ACCESS REQUEST PROCESSED
;	0382	
;	0383	! USER ERRORS
;	0384	!	SS$_FILALRACC - FILE ALREADY ACCESSED
;	0385	!	SS$_BADPARAM - BAD INPUT PARAMETERS
;	0386	!
;	0387	!--
;	0388	
;	0389	BEGIN
;	0390	EXTERNAL REGISTER
;	0391		COMMON_REG;
;	0392	
;	0393	LOCAL
;	0394		FUNCTION:	BLOCK [1],			!FUNCTION AND QUALIFIERS
;	0395		PACKET:		REF BBLOCK,			!ADDRESS OF IO PACKET
;	0396		ABD:		REF BBLOCKVECTOR [,ABD$C_LENGTH],!ADDRESS OF BUFFER DESCRIPTORS
;	0397		FIB:		REF BBLOCK;			!ADDRESS OF FILE INFORMATION BLOCK
;	0398	
;	0399	EXTERNAL
;	0400		CURRENT_UCB:	REF BBLOCK,			!ADDRESS OF CURRENT UCB
;	0401		CURRENT_WCB:	REF BBLOCK,			!ADDRESS OF WINDOW CONTROL BLOCK
;	0402		IO_PACKET:	REF BBLOCK,			!ADDRESS OF IO REQUEST PACKET
;	0403		USER_STATUS:	VECTOR;				!STATUS TO RETURN TO USER
;	0404	
;	0405	EXTERNAL ROUTINE
;	0406		ACCESS_FILE,					!MAKE DATA BASE CHANGES NEC FOR ACCESS

; Bliss-32 7.352	Saturday 21-AUG-1978 23:25:34	DBB3:[MTAACP.SRC]ACCESS.B32;4					Page 2-1
; Digital Equipment Corporation
;
;	0407		ACCESS_NEW_FILE,				!ACCESS NEWLY CREATED FILE
;	0408		BLOCK,						!BLOCK CURRENT REQUEST
;	0409		CHECK_ACCESS,					!CHECK VOLUME PROTECTION ON EACH FILE ACCESS
;	0410		CHECK_FILE_ACC,					!CHECK ACCESS TO THE FILE
;	0411		CLOSE_FILE	: L$CLOSE_FILE,	!CLOSE OUT FILE
;	0412		GET_FIB,					!GET FILE INFORMATION BLOCK
;	0413		QUEUE_AST,					!ISSUE AST TO USER FOR USER LABEL PROCESSING
;	0414		MTA_CREATE,					!MAIN CONTROL FOR CREATE FUNCTION
;	0415		POSITION_BY_FID,				!POSITION TO FILE BY FID
;	0416		READ_ATTRIBUTE,					!READ FILE ATTRIBUTES
;	0417		SPACE_TM,					!SPACE TM
;	0418		START_VIO;					!START UP VIRTUAL IO
;	0419	! SETUP POINTERS
;	0420	PACKET = .IO_PACKET;					!ADDRESS OF IO PACKET
;	0421	ABD = .BBLOCK[.PACKET[IRP$L_SVAPTE],AIB$L_DESCRIPT];	!ADDRESS OF BUFFER DESCRIPTORS
;	0422	FIB = GET_FIB(.ABD);					!GET FILE INFORMATION BLOCK
;	0423	
;	0424	! GET THE FUNCTION TO BE PERFORMED
;	0425	FUNCTION = .PACKET[IRP$W_FUNC];
;	0426	
;	0427	! IF ANYONE HAS A FILE ACCESSED THEN ANOTHER FILE CAN NOT BE ACCESS NOR CAN
;	0428	! THE TAPE BE SEARCHED
;	0429	IF .CURRENT_WCB NEQ 0 AND (.FUNCTION[IO$V_ACCESS] OR .FIB[FIB$W_DID_NUM] NEQ 0)
;	0430	THEN ERR_EXIT(SS$_FILALRACC);
;	0431	IF .FIB[FIB$V_TRUNC] OR .FUNCTION[IO$V_DELETE]
;	0432	THEN ERR_EXIT(SS$_BADPARAM);
;	0433	
;	0434	! IT IS POSSIBLE THAT A CREATE WAS ISSUED WITHOUT AN ACCESS IN WHICH CASE
;	0435	! THERE IS A PARTIAL FILE ON THIS TAPE.  IF THE ACCESS IS TO A DIFFERENT
;	0436	! FILE THEN CLOSE OUT THE PARTIAL FILE BEFORE PRECEDING
;	0437	IF .CURRENT_VCB[VCB$V_PARTFILE]				!IF THERE IS A PARTIAL FILE
;	0438	THEN
;	0439	    BEGIN
;	0440	    IF .FIB[FIB$W_DID_NUM] NEQ 0			!IS THIS A FIND OR A REQUEST FOR A DIFFERENT FILE
;	0441	    OR .(FIB[FIB$W_FID])<0,32> NEQU .CURRENT_VCB[VCB$L_CUR_FID]
;	0442	    THEN CLOSE_FILE()					!CLOSE PARTIAL FILE BEFORE PRECEDING
;	0443	    ELSE
;	0444		BEGIN
;	0445		IF .PACKET[IRP$W_BCNT] GTR ABD$C_ATTRIB		!IF ANY ATTRIBUTES REQUESTED,
;	0446		THEN READ_ATTRIBUTE(.ABD);			!THEN READ THEM
;	0447		IF .FUNCTION[IO$V_ACCESS]
;	0448		THEN
;	0449		    BEGIN
;	0450		    IF NOT .FIB[FIB$V_WRITE] THEN ERR_EXIT(SS$_BADPARAM);	!MUST WRITE NEW FILE
;	0451		    ACCESS_NEW_FILE(.FIB,.PACKET,.ABD);		!ACCESS PARTIAL FILE
;	0452		    END;
;	0453		RETURN;
;	0454		END;
;	0455	    END;
;	0456	

; Bliss-32 7.352	Saturday 21-AUG-1978 23:25:34	DBB3:[MTAACP.SRC]ACCESS.B32;4					Page 3
; Digital Equipment Corporation
;
;	0457	! IF FILE IS ACCESSED, THE ONLY FUNCTION THAT CAN BE PERFORMED IS READ ATTRIBUTES
;	0458	IF .CURRENT_WCB NEQ 0 THEN
;	0459	    BEGIN
;	0460	    IF .PACKET[IRP$W_BCNT] GTR ABD$C_ATTRIB THEN READ_ATTRIBUTE(.ABD);
;	0461	    RETURN;
;	0462	    END;
;	0463	
;	0464	! IF DIRECTORY ID GIVEN, FIND FILE BY FILE NAME STRING
;	0465	IF .FIB[FIB$W_DID_NUM] NEQ 0 THEN
;	0466	    IF NOT CHECK_FIND() THEN
;	0467		BEGIN
;	0468		IF NOT .FUNCTION[IO$V_CREATE] THEN ERR_EXIT(SS$_NOSUCHFILE);
;	0469		USER_STATUS[0] = SS$_CREATED;
;	0470		RETURN MTA_CREATE();				!EXECUTE CREATE FUNCTION
;	0471		END;
;	0472	
;	0473	! POSITION VOLUME SET BY FID
;	0474	POSITION_BY_FID(.(FIB[FIB$W_FID])<0,32>,.FIB[FIB$W_FID_RVN]);
;	0475	
;	0476	IF .PACKET[IRP$W_BCNT] GTR ABD$C_ATTRIB THEN READ_ATTRIBUTE(.ABD);
;	0477	
;	0478	! IF ACCESS REQUESTED
;	0479	IF .FUNCTION[IO$V_ACCESS] THEN
;	0480	    BEGIN
;	0481	    CHECK_ACCESS(.FIB[FIB$V_WRITE]);			!CHECK VOLUME ACCESS
;	0482	    CHECK_FILE_ACC();					!CHECK ACCESS TO FILE
;	0483	    KERNEL_CALL(ACCESS_FILE,.FIB[FIB$L_ACCTL],.PACKET[IRP$L_PID],1,.FIB[FIB$V_WRITE],.ABD);
;	0484	    IF .CURRENT_VCB[VCB$L_USRLBLAST] NEQ 0 THEN
;	0485	        IF KERNEL_CALL(QUEUE_AST) THEN BLOCK(VCB$M_WAIUSRLBL);	!REQUEST USER LABELS AND WAIT FOR THEM
;	0486	    IF .CURRENT_VCB[VCB$B_TM] EQLU 0 THEN SPACE_TM(1);	!POSITION TO DATA
;	0487	    KERNEL_CALL(START_VIO);				!START VIRTUAL IO
;	0488	    RETURN;
;	0489	    END;
;	0490	END;


							    .TITLE  ACCESS
							    .IDENT  \A0001\

							    .GLOBL  CURRENT_UCB, CURRENT_WCB, IO_PACKET, USER_STATUS
							    .GLOBL  ACCESS_FILE, ACCESS_NEW_FILE, BLOCK, CHECK_ACCESS
							    .GLOBL  CHECK_FILE_ACC, CLOSE_FILE, GET_FIB, QUEUE_AST
							    .GLOBL  MTA_CREATE, POSITION_BY_FID, READ_ATTRIBUTE, SPACE_TM
							    .GLOBL  START_VIO, SYS$CMKRNL

							    .PSECT  $CODE$,NOWRT,2

					 0000 00000 	    .ENTRY  MTA_ACCESS, Save nothing				      ; 0352
		         53	0000G  CF  D0 00002 	    MOVL    IO_PACKET, PACKET					      ; 0420
		         54	  2C   B3  D0 00007 	    MOVL    @44(PACKET), ABD					      ; 0421
				       54  DD 0000B 	    PUSHL   ABD							      ; 0422
		  0000G  CF	       01  FB 0000D 	    CALLS   #1, GET_FIB						      ;
		         52	       50  D0 00012 	    MOVL    R0, FIB						      ;
		         55	  20   A3  3C 00015 	    MOVZWL  32(PACKET), FUNCTION				      ; 0425
				0000G  CF  D5 00019 	    TSTL    CURRENT_WCB						      ; 0429

; Bliss-32 7.352	Saturday 21-AUG-1978 23:25:34	DBB3:[MTAACP.SRC]ACCESS.B32;4					Page 3-1
; Digital Equipment Corporation
;
				       0D  13 0001D 	    BEQL    2$							      ;
	   05	         55	       06  E0 0001F 	    BBS     #6, FUNCTION, 1$					      ;
				  0A   A2  B5 00023 	    TSTW    10(FIB)						      ;
				       04  13 00026 	    BEQL    2$							      ;
				00A4   8F  BF 00028 1$:     CHMU    #164						      ; 0430
		         04	  17   A2  E8 0002C 2$:     BLBS    23(FIB), 3$						      ; 0431
	   02	         55	       08  E1 00030 	    BBC     #8, FUNCTION, 4$					      ;
				       14  BF 00034 3$:     CHMU    #20							      ; 0432
		         30	  0B   AB  E9 00036 4$:     BLBC    11(CURRENT_VCB), 9$					      ; 0437
				  0A   A2  B5 0003A 	    TSTW    10(FIB)						      ; 0440
				       07  12 0003D 	    BNEQ    5$							      ;
		    24   AB	  04   A2  D1 0003F 	    CMPL    4(FIB), 36(CURRENT_VCB)				      ; 0441
				       05  13 00044 	    BEQL    6$							      ;
				     0000  30 00046 5$:     BSBW    CLOSE_FILE						      ; 0442
				       1F  11 00049 	    BRB     9$							      ; 0440
		         05	  32   A3  B1 0004B 6$:     CMPW    50(PACKET), #5					      ; 0445
				       07  1B 0004F 	    BLEQU   7$							      ;
				       54  DD 00051 	    PUSHL   ABD							      ; 0446
		  0000G  CF	       01  FB 00053 	    CALLS   #1, READ_ATTRIBUTE					      ;
	   5E	         55	       06  E1 00058 7$:     BBC     #6, FUNCTION, 14$					      ; 0447
		         02	  01   A2  E8 0005C 	    BLBS    1(FIB), 8$						      ; 0450
				       14  BF 00060 	    CHMU    #20							      ;
				       1C  BB 00062 8$:     PUSHR   #^M<R2,R3,R4>					      ; 0451
		  0000G  CF	       03  FB 00064 	    CALLS   #3, ACCESS_NEW_FILE					      ;
					   04 00069 	    RET     							      ; 0453
				0000G  CF  D5 0006A 9$:     TSTL    CURRENT_WCB						      ; 0458
				       0F  13 0006E 	    BEQL    11$							      ;
		         05	  32   A3  B1 00070 	    CMPW    50(PACKET), #5					      ; 0460
				       01  1A 00074 	    BGTRU   10$							      ;
					   04 00076 	    RET     							      ;
				       54  DD 00077 10$:    PUSHL   ABD							      ;
		  0000G  CF	       01  FB 00079 	    CALLS   #1, READ_ATTRIBUTE					      ;
					   04 0007E 	    RET     							      ; 0461
				  0A   A2  B5 0007F 11$:    TSTW    10(FIB)						      ; 0465
				       1D  13 00082 	    BEQL    13$							      ;
		  0000V  CF	       00  FB 00084 	    CALLS   #0, CHECK_FIND					      ; 0466
		         15	       50  E8 00089 	    BLBS    R0, 13$						      ;
	   04	         55	       07  E0 0008C 	    BBS     #7, FUNCTION, 12$					      ; 0468
				0910   8F  BF 00090 	    CHMU    #2320						      ;
		  0000G  CF	0619   8F  3C 00094 12$:    MOVZWL  #1561, USER_STATUS					      ; 0469
		  0000G  CF	       00  FB 0009B 	    CALLS   #0, MTA_CREATE					      ; 0470
					   04 000A0 	    RET     							      ;
		         7E	  08   A2  3C 000A1 13$:    MOVZWL  8(FIB), -(SP)					      ; 0474
				  04   A2  DD 000A5 	    PUSHL   4(FIB)						      ;
		  0000G  CF	       02  FB 000A8 	    CALLS   #2, POSITION_BY_FID					      ;
		         05	  32   A3  B1 000AD 	    CMPW    50(PACKET), #5					      ; 0476
				       07  1B 000B1 	    BLEQU   14$							      ;
				       54  DD 000B3 	    PUSHL   ABD							      ;
		  0000G  CF	       01  FB 000B5 	    CALLS   #1, READ_ATTRIBUTE					      ;
	   67	         55	       06  E1 000BA 14$:    BBC     #6, FUNCTION, 17$					      ; 0479
      01   A2	         01	       00  EF 000BE 	    EXTZV   #0, #1, 1(FIB), -(SP)				      ; 0481
				       7E     000C3									      ;
		  0000G  CF	       01  FB 000C4 	    CALLS   #1, CHECK_ACCESS					      ;
		  0000G  CF	       00  FB 000C9 	    CALLS   #0, CHECK_FILE_ACC					      ; 0482
				       54  DD 000CE 	    PUSHL   ABD							      ; 0483

; Bliss-32 7.352	Saturday 21-AUG-1978 23:25:34	DBB3:[MTAACP.SRC]ACCESS.B32;4					Page 3-2
; Digital Equipment Corporation
;
      01   A2	         01	       00  EF 000D0 	    EXTZV   #0, #1, 1(FIB), -(SP)				      ;
				       7E     000D5									      ;
				       01  DD 000D6 	    PUSHL   #1							      ;
				  0C   A3  DD 000D8 	    PUSHL   12(PACKET)						      ;
				       62  DD 000DB 	    PUSHL   (FIB)						      ;
				       05  DD 000DD 	    PUSHL   #5							      ;
				       5E  DD 000DF 	    PUSHL   SP							      ;
				0000G  CF  9F 000E1 	    PUSHAB  ACCESS_FILE						      ;
	      00000000G  9F	       08  FB 000E5 	    CALLS   #8, @#SYS$CMKRNL					      ;
				  44   AB  D5 000EC 	    TSTL    68(CURRENT_VCB)					      ; 0484
				       19  13 000EF 	    BEQL    15$							      ;
				       7E  D4 000F1 	    CLRL    -(SP)						      ; 0485
				       5E  DD 000F3 	    PUSHL   SP							      ;
				0000G  CF  9F 000F5 	    PUSHAB  QUEUE_AST						      ;
	      00000000G  9F	       03  FB 000F9 	    CALLS   #3, @#SYS$CMKRNL					      ;
		         07	       50  E9 00100 	    BLBC    R0, 15$						      ;
				       10  DD 00103 	    PUSHL   #16							      ;
		  0000G  CF	       01  FB 00105 	    CALLS   #1, BLOCK						      ;
				  2E   AB  95 0010A 15$:    TSTB    46(CURRENT_VCB)					      ; 0486
				       07  12 0010D 	    BNEQ    16$							      ;
				       01  DD 0010F 	    PUSHL   #1							      ;
		  0000G  CF	       01  FB 00111 	    CALLS   #1, SPACE_TM					      ;
				       7E  D4 00116 16$:    CLRL    -(SP)						      ; 0487
				       5E  DD 00118 	    PUSHL   SP							      ;
				0000G  CF  9F 0011A 	    PUSHAB  START_VIO						      ;
	      00000000G  9F	       03  FB 0011E 	    CALLS   #3, @#SYS$CMKRNL					      ;
					   04 00125 17$:    RET     							      ; 0352

; Routine Size:  294 bytes



; Bliss-32 7.352	Saturday 21-AUG-1978 23:25:34	DBB3:[MTAACP.SRC]ACCESS.B32;4					Page 4
; Digital Equipment Corporation
;
;	0491	ROUTINE CHECK_FIND : COMMON_CALL  =
;	0492	
;	0493	!++
;	0494	!
;	0495	! FUNCTIONAL DESCRIPTION:
;	0496	!
;	0497	!	This routine calls the directory search and intercepts any error
;	0498	!	exits to handle the create if non-existent function. If the search
;	0499	!	is successful, the routine returns success; if the search fails with
;	0500	!	no such file and the create subfunction bit is set, it returns failure;
;	0501	!	all other errors are resignaled.
;	0502	!
;	0503	!
;	0504	! CALLING SEQUENCE:
;	0505	!	CHECK_FIND ()
;	0506	!
;	0507	! INPUT PARAMETERS:
;	0508	!	NONE
;	0509	!
;	0510	! IMPLICIT INPUTS:
;	0511	!	NONE
;	0512	!
;	0513	! OUTPUT PARAMETERS:
;	0514	!	NONE
;	0515	!
;	0516	! IMPLICIT OUTPUTS:
;	0517	!	NONE
;	0518	!
;	0519	! ROUTINE VALUE:
;	0520	!	1 if find is successful
;	0521	!	0 if file is to be created
;	0522	!
;	0523	! SIDE EFFECTS:
;	0524	!	NONE
;	0525	!
;	0526	!--
;	0527	
;	0528	BEGIN
;	0529	EXTERNAL REGISTER
;	0530		COMMON_REG;
;	0531	
;	0532	BUILTIN
;	0533		FP;
;	0534	
;	0535	EXTERNAL ROUTINE
;	0536		FIND_FILE;				! find file in directory
;	0537	
;	0538	
;	0539	! Establish the condition handler and call FIND. If we hear from it we
;	0540	! return true. Any signals cause either unwind or resignal.
;	0541	!
;	0542	
;	0543	.FP = HANDLER;
;	0544	
;	0545	FIND_FILE ();

; Bliss-32 7.352	Saturday 21-AUG-1978 23:25:34	DBB3:[MTAACP.SRC]ACCESS.B32;4					Page 4-1
; Digital Equipment Corporation
;
;	0546	RETURN 1;
;	0547	
;	0548	END;					! end of routine CHECK_FIND



							    .GLOBL  FIND_FILE

					 0000 00126 CHECK_FIND:
							    .WORD   Save nothing					      ; 0491
		         6D	0000V  CF  9E 00128 	    MOVAB   HANDLER, (FP)					      ; 0543
		  0000G  CF	       00  FB 0012D 	    CALLS   #0, FIND_FILE					      ; 0545
		         50	       01  D0 00132 	    MOVL    #1, R0						      ; 0546
					   04 00135 	    RET     							      ; 0491

; Routine Size:  16 bytes



; Bliss-32 7.352	Saturday 21-AUG-1978 23:25:34	DBB3:[MTAACP.SRC]ACCESS.B32;4					Page 5
; Digital Equipment Corporation
;
;	0549	ROUTINE HANDLER (SIGNAL, MECHANISM) =
;	0550	
;	0551	!++
;	0552	!
;	0553	! FUNCTIONAL DESCRIPTION:
;	0554	!
;	0555	!	This routine is the condition handler for the conditional find call.
;	0556	!	It intercepts the error exit from FIND and unwinds to CHECK_FIND's
;	0557	!	caller when appropriate.
;	0558	!
;	0559	!
;	0560	! CALLING SEQUENCE:
;	0561	!	HANDLER (ARG1, ARG2)
;	0562	!
;	0563	! INPUT PARAMETERS:
;	0564	!	ARG1: address of signal array
;	0565	!	ARG2: address of mechanism array
;	0566	!
;	0567	! IMPLICIT INPUTS:
;	0568	!	NONE
;	0569	!
;	0570	! OUTPUT PARAMETERS:
;	0571	!	NONE
;	0572	!
;	0573	! IMPLICIT OUTPUTS:
;	0574	!	NONE
;	0575	!
;	0576	! ROUTINE VALUE:
;	0577	!	SS$_RESIGNAL or none if unwind
;	0578	!
;	0579	! SIDE EFFECTS:
;	0580	!	NONE
;	0581	!
;	0582	!--
;	0583	
;	0584	
;	0585	BEGIN
;	0586	
;	0587	MAP
;	0588		SIGNAL		: REF BBLOCK,	! signal arg array
;	0589		MECHANISM	: REF BBLOCK;	! mechanism arg array
;	0590	
;	0591	EXTERNAL ROUTINE
;	0592		SYS$UNWIND	: ADDRESSING_MODE (ABSOLUTE);
;	0593						! system unwind service
;	0594	
;	0595	EXTERNAL
;	0596		LOCAL_FIB	: BBLOCK;	!COPY OF USER'S FIB
;	0597	
;	0598	! If the condition is change mode to user (error exit) and the status is
;	0599	! no such file, cause an unwind to return 0 to the access main line.
;	0600	! Otherwise, just resignal the condition.
;	0601	!
;	0602	
;	0603	IF .SIGNAL[CHF$L_SIG_NAME] EQL SS$_CMODUSER

; Bliss-32 7.352	Saturday 21-AUG-1978 23:25:34	DBB3:[MTAACP.SRC]ACCESS.B32;4					Page 5-1
; Digital Equipment Corporation
;
;	0604	AND .SIGNAL[CHF$L_SIG_ARG1] EQL SS$_NOSUCHFILE THEN
;	0605	    BEGIN
;	0606	! CLEAR CONTEXT IF AT END OF SEARCH
;	0607	    LOCAL_FIB[FIB$L_WCC] = 0;
;	0608	    IF .LOCAL_FIB[FIB$V_WILD] THEN SIGNAL[CHF$L_SIG_ARG1] = SS$_NOMOREFILES
;	0609	    ELSE
;	0610	        BEGIN
;	0611	        MECHANISM[CHF$L_MCH_SAVR0] = 0;
;	0612	        SYS$UNWIND (0, 0);
;	0613	        END;
;	0614	    END;
;	0615	
;	0616	RETURN SS$_RESIGNAL;			! status is irrelevant if unwinding
;	0617	
;	0618	END;					! end of routine HANDLER



							    .GLOBL  SYS$UNWIND, LOCAL_FIB

					 0000 00136 HANDLER:.WORD   Save nothing					      ; 0549
		         50	  04   AC  D0 00138 	    MOVL    SIGNAL, R0						      ; 0603
	      00000424   8F	  04   A0  D1 0013C 	    CMPL    4(R0), #1060					      ;
				       2B  12 00144 	    BNEQ    2$							      ;
	      00000910   8F	  08   A0  D1 00146 	    CMPL    8(R0), #2320					      ; 0604
				       21  12 0014E 	    BNEQ    2$							      ;
				0000G  CF  D4 00150 	    CLRL    LOCAL_FIB+16					      ; 0607
		         08	0000G  CF  E9 00154 	    BLBC    LOCAL_FIB+21, 1$					      ; 0608
		    08   A0	0930   8F  3C 00159 	    MOVZWL  #2352, 8(R0)					      ;
				       10  11 0015F 	    BRB     2$							      ;
		         50	  08   AC  D0 00161 1$:     MOVL    MECHANISM, R0					      ; 0611
				  0C   A0  D4 00165 	    CLRL    12(R0)						      ;
				       7E  7C 00168 	    CLRQ    -(SP)						      ; 0612
	      00000000G  9F	       02  FB 0016A 	    CALLS   #2, @#SYS$UNWIND					      ;
		         50	0918   8F  3C 00171 2$:     MOVZWL  #2328, R0						      ; 0616
					   04 00176 	    RET     							      ; 0549

; Routine Size:  65 bytes


;	0619	
;	0620	END
;	0621	ELUDOM






;				       PSECT SUMMARY
;
;	Name		 Bytes			       Attributes
;
;  $CODE$         	   375  NOWRT,  RD ,  EXE,NOSHR,  LCL,  REL,  CON,NOPIC,ALIGN(2)


; Bliss-32 7.352	Saturday 21-AUG-1978 23:25:34	DBB3:[MTAACP.SRC]ACCESS.B32;4					Page 5-2
; Digital Equipment Corporation
;



;				LIBRARY STATISTICS
;
;					     -------- Symbols --------    Blocks
;	File				     Total    Loaded   Percent      Read
;
;  DBA4:[SYSLIB]LIB.L32;1		      5582        39         0       254





; Size:		375 code + 0 data bytes
; Run Time:	00:12.1
; Elapsed Time:	00:30.1
; Memory Used:	326 pages
; Compilation Complete
