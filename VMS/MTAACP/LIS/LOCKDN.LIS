LOCKDN          - LOCK FCP INTO REAL MEMORY                      21-AUG-1978 23:25:27   VAX-11 MACRO X0.3-11               Page   1
A0001                                                                                                                            (1)

                                     0000     1 	.TITLE	LOCKDN - LOCK FCP INTO REAL MEMORY
                                     0000     2 	.IDENT	"A0001"
                                     0000     3 
                                     0000     4 ;
                                     0000     5 ; COPYRIGHT (C) 1976
                                     0000     6 ; DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASSACHUSETTS 01754
                                     0000     7 ;
                                     0000     8 ; THIS SOFTWARE IS FURNISHED  UNDER A LICENSE FOR USE ONLY ON A SINGLE
                                     0000     9 ; COMPUTER  SYSTEM AND  MAY BE  COPIED ONLY WITH  THE INCLUSION OF THE
                                     0000    10 ; ABOVE COPYRIGHT NOTICE.  THIS SOFTWARE, OR ANY OTHER COPIES THEREOF,
                                     0000    11 ; MAY NOT BE PROVIDED OR  OTHERWISE MADE AVAILABLE TO ANY OTHER PERSON
                                     0000    12 ; EXCEPT FOR USE ON SUCH SYSTEM AND TO ONE WHO AGREES TO THESE LICENSE
                                     0000    13 ; TERMS.  TITLE TO AND  OWNERSHIP OF THE  SOFTWARE  SHALL AT ALL TIMES
                                     0000    14 ; REMAIN IN DEC.
                                     0000    15 ;
                                     0000    16 ; THE INFORMATION IN THIS SOFTWARE IS SUBJECT TO CHANGE WITHOUT NOTICE
                                     0000    17 ; AND SHOULD  NOT BE CONSTRUED  AS A COMMITMENT  BY DIGITAL  EQUIPMENT
                                     0000    18 ; CORPORATION.
                                     0000    19 ;
                                     0000    20 ; DEC ASSUMES  NO  RESPONSIBILITY  FOR  THE USE OR  RELIABILITY OF ITS
                                     0000    21 ; SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DEC.
                                     0000    22 
                                     0000    23 ;++
                                     0000    24 ;
                                     0000    25 ; FACILITY:  F11ACP STRUCTURE LEVEL 1
                                     0000    26 ;
                                     0000    27 ; ABSTRACT:
                                     0000    28 ;
                                     0000    29 ;	THIS ROUTINE TOUCHES ALL OF THE PAGES IN FCP TO BRING THEM
                                     0000    30 ;	INTO REAL MEMORY.
                                     0000    31 ;
                                     0000    32 ; ENVIRONMENT:
                                     0000    33 ;
                                     0000    34 ;	STARLET OPERATING SYSTEM, INCLUDING PRIVILEGED SYSTEM SERVICES
                                     0000    35 ;	AND INTERNAL EXEC ROUTINE.
                                     0000    36 ;
                                     0000    37 ; AUTHOR:  ANDREW C. GOLDSTEIN, CREATION DATE:  22-DEC-1976  14:46
                                     0000    38 ;
                                     0000    39 ; MODIFIED BY:
                                     0000    40 ;
                                     0000    41 ;  , VERSION  ,
                                     0000    42 ; 01	- 
                                     0000    43 ;--
                                     0000    44 
                                     0000    45 ;
                                     0000    46 ; DEFINE LABELS FOR THE START AND END OF THE LOCKED DOWN AREAS
                                     0000    47 ;
                                 00000000    48 	.PSECT	$LOCKEDC0$,NOWRT,PAGE
                                     0000    49 LCODE_START:
                                     0000    50 
                                 00000000    51 	.PSECT	$LOCKEDC9$,NOWRT,LONG
                                     0000    52 LCODE_END:
                                     0000    53 
                                 00000000    54 	.PSECT	$LOCKEDD0$,NOEXE,LONG
                                     0000    55 LDATA_START:
                                     0000    56 
                                 00000000    57 	.PSECT	$LOCKEDD9$,NOEXE,LONG
LOCKDN          - LOCK FCP INTO REAL MEMORY                      21-AUG-1978 23:25:27   VAX-11 MACRO X0.3-11               Page   2
A0001                                                                                                                            (1)

                                     0000    58 LDATA_END:
                                     0000    59 
                                 00000000    60 	.PSECT	$LOCKEDD1$,NOEXE,LONG
                                     0000    61 ;
                                     0000    62 ; OWN STORAGE:
                                     0000    63 ;
                           00000004  0000    64 WORKING_SET:	.BLKL	1		; SPACE TO RECEIVE WORKING SET SIZE
                           00000040  0004    65 SET_SIZE::	.LONG	64		; SIZE TO ADJUST WORKING SET TO
                           00000010  0008    66 LAST_PAGE:	.BLKL	2		; SPACE TO RECEIVE LAST PAGE POINTERS
                                     0010    67 
                                     0010    68 ;
                                     0010    69 ; DESCRIPTORS TO LOCK DOWN THE CODE AND DATA AREAS THAT ARE TO BE LOCKED INTO
                                     0010    70 ; THE WORKING SET
                                     0010    71 ;
                                 00000000    72 	.PSECT	$CODE$,NOWRT,LONG
                                     0000    73 
                  FFFFFFFF'00000000' 0000    74 LOCKED_CODE:	.LONG	LCODE_START,LCODE_END-1
                  FFFFFFFF'00000000' 0008    75 LOCKED_DATA:	.LONG	LDATA_START,LDATA_END-1
LOCKDN          - LOCK FCP INTO REAL MEMORY                      21-AUG-1978 23:25:27   VAX-11 MACRO X0.3-11               Page   3
A0001                                                                                                                            (2)

                                     0010    77 ;++
                                     0010    78 ;
                                     0010    79 ; FUNCTIONAL DESCRIPTION:
                                     0010    80 ;
                                     0010    81 ;	THIS ROUTINE TOUCHES ALL OF THE PAGES IN FCP TO BRING THEM
                                     0010    82 ;	INTO REAL MEMORY.
                                     0010    83 ;
                                     0010    84 ; CALLING SEQUENCE:
                                     0010    85 ;	CALL LOCKDOWN ()
                                     0010    86 ;	NONE
                                     0010    87 ;
                                     0010    88 ; INPUT PARAMETERS:
                                     0010    89 ;	NONE
                                     0010    90 ;
                                     0010    91 ; IMPLICIT INPUTS:
                                     0010    92 ;	NONE
                                     0010    93 ;
                                     0010    94 ; OUTPUT PARAMETERS:
                                     0010    95 ;	NONE
                                     0010    96 ;
                                     0010    97 ; IMPLICIT OUTPUTS:
                                     0010    98 ;	NONE
                                     0010    99 ;
                                     0010   100 ; ROUTINE VALUE:
                                     0010   101 ;	NONE
                                     0010   102 ;
                                     0010   103 ; SIDE EFFECTS:
                                     0010   104 ;	ALL OF FCP RESIDING IN REAL MEMORY
                                     0010   105 ;
                                     0010   106 ;--
                                     0010   107 
                                     0010   108 LOCKDOWN::
                               0000  0010   109 	.WORD	^M<>
                                     0012   110 ;
                                     0012   111 ; ADJUST THE WORKING SET SIZE TO A SUITABLE VALUE
                                     0012   112 ;
                                     0012   113 	$ADJWSL_S  #0,W^WORKING_SET	; READ CURRENT SIZE
       0004'CF       0000'CF     C3  001F   114 	SUBL3	   W^WORKING_SET,W^SET_SIZE,R0 ; COMPUTE INCREMENT
                          50         0026       
                                     0027   115 	$ADJWSL_S  R0,W^WORKING_SET	; AND SET TO DESIRED SIZE
                                     0034   116 ;
                                     0034   117 ; LOCK INTO THE WORKING SET THE CODE AND DATA AREAS THAT SHOULD BE.
                                     0034   118 ;
                                     0034   119 	$LKWSET_S  LOCKED_CODE
                                     0042   120 	$LKWSET_S  LOCKED_DATA
                                     0050   121 ;
                                     0050   122 ; EXPAND THE PROGRAM REGION BY ONE PAGE TO GET THE ADDRESS OF THE TOP.
                                     0050   123 ; THIS PAGE WILL NEVER BE TOUCHED AND WILL THEREFORE REMAIN DEMAND ZERO.
                                     0050   124 ;
                                     0050   125 	$EXPREG_S  #1,LAST_PAGE,REGION=#0
                                     0063   126 ;
                                     0063   127 ; NOW TOUCH ALL PAGES UP TO THE ONE CREATED.
                                     0063   128 ;
            50   00000200 9F     9E  0063   129 	MOVAB	@#^X200,R0	; START WITH PAGE 1
                          60     D5  006A   130 10$:	TSTL	(R0)		; TOUCH IT
   00000200 8F   00000008'EF     F1  006C   131 	ACBL	LAST_PAGE,#^X200,R0,10$  ; NEXT PAGE AND LOOP
            FFF0          50         0077       
LOCKDN          - LOCK FCP INTO REAL MEMORY                      21-AUG-1978 23:25:27   VAX-11 MACRO X0.3-11               Page   4
A0001                                                                                                                            (2)

                                 04  007A   132 	RET
                                     007B   133 
                                     007B   134 
                                     007B   135 
                                     007B   136 	.END
LOCKDN          - LOCK FCP INTO REAL MEMORY                      21-AUG-1978 23:25:27   VAX-11 MACRO X0.3-11               Page   5
SYMBOL TABLE                                                                                                                     (2)

AQB_TYPE       = 00000005            
FCB_TYPE       = 00000000            
LAST_PAGE        00000008 R     06   
LCODE_END        00000000 R     03   
LCODE_START      00000000 R     02   
LDATA_END        00000000 R     05   
LDATA_START      00000000 R     04   
LOCKDOWN         00000010 RG    07   
LOCKED_CODE      00000000 R     07   
LOCKED_DATA      00000008 R     07   
MVL_TYPE       = 00000004            
RVT_TYPE       = 00000003            
SET_SIZE         00000004 RG    06   
SYS$ADJWSL       ********   X   07   
SYS$EXPREG       ********   X   07   
SYS$LKWSET       ********   X   07   
VCB_TYPE       = 00000002            
WCB_TYPE       = 00000001            
WORKING_SET      00000000 R     06   


PROGRAM SECTION SYNOPSIS

.  ABS  .        00000000      00     NOPIC   USR   CON   ABS   LCL NOSHR NOEXE NORD  NOWRT BYTE  
. BLANK .        00000000      01     NOPIC   USR   CON   REL   LCL NOSHR   EXE   RD    WRT BYTE  
$LOCKEDC0$       00000000      02     NOPIC   USR   CON   REL   LCL NOSHR   EXE   RD  NOWRT PAGE  
$LOCKEDC9$       00000000      03     NOPIC   USR   CON   REL   LCL NOSHR   EXE   RD  NOWRT LONG  
$LOCKEDD0$       00000000      04     NOPIC   USR   CON   REL   LCL NOSHR NOEXE   RD    WRT LONG  
$LOCKEDD9$       00000000      05     NOPIC   USR   CON   REL   LCL NOSHR NOEXE   RD    WRT LONG  
$LOCKEDD1$       00000010      06     NOPIC   USR   CON   REL   LCL NOSHR NOEXE   RD    WRT LONG  
$CODE$           0000007B      07     NOPIC   USR   CON   REL   LCL NOSHR   EXE   RD  NOWRT LONG  


THERE WERE NO ERRORS OR WARNINGS.
25960. BYTES LEFT IN FREE MEMORY POOL.
OBJ$:LOCKDN,LIS$:LOCKDN/-SP=EXECML$/ML,SRC$:MTADEF,LOCKDN
2 MLB DIR RDS - 25 GETS TO DEFINE 4 MACROS. 3 INTER. FILE WRITES. 
