
; Bliss-32 7.352	Saturday 21-AUG-1978 23:27:16	DBB3:[MTAACP.SRC]CALVER.B32;3					Page 1
; Digital Equipment Corporation
;
;	0001	MODULE CALVER (
;	0002			LANGUAGE (BLISS32),
;	0003			IDENT = 'A0001'
;	0004			) =
;	0005	BEGIN
;	0006	
;	0007	!
;	0008	! COPYRIGHT (C) 1977
;	0009	! DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASSACHUSETTS 01754
;	0010	!
;	0011	! THIS SOFTWARE IS FURNISHED  UNDER A LICENSE FOR USE ONLY ON A SINGLE
;	0012	! COMPUTER  SYSTEM AND  MAY BE  COPIED ONLY WITH  THE INCLUSION OF THE
;	0013	! ABOVE COPYRIGHT NOTICE.  THIS SOFTWARE, OR ANY OTHER COPIES THEREOF,
;	0014	! MAY NOT BE PROVIDED OR  OTHERWISE MADE AVAILABLE TO ANY OTHER PERSON
;	0015	! EXCEPT FOR USE ON SUCH SYSTEM AND TO ONE WHO AGREES TO THESE LICENSE
;	0016	! TERMS.  TITLE TO AND  OWNERSHIP OF THE  SOFTWARE  SHALL AT ALL TIMES
;	0017	! REMAIN IN DEC.
;	0018	!
;	0019	! THE INFORMATION IN THIS SOFTWARE IS SUBJECT TO CHANGE WITHOUT NOTICE
;	0020	! AND SHOULD  NOT BE CONSTRUED  AS A COMMITMENT  BY DIGITAL  EQUIPMENT
;	0021	! CORPORATION.
;	0022	!
;	0023	! DEC ASSUMES  NO  RESPONSIBILITY  FOR  THE USE OR  RELIABILITY OF ITS
;	0024	! SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DEC.
;	0025	
;	0026	!++
;	0027	!
;	0028	! FACILITY:  MTAACP
;	0029	!
;	0030	! ABSTRACT:
;	0031	!	THIS MODULE CALCULATES VERSION NUMBER FROM GENERATION AND GENERATION VERSION
;	0032	!
;	0033	! ENVIRONMENT:
;	0034	!
;	0035	!	STARLET OPERATING SYSTEM, INCLUDING PRIVILEGED SYSTEM SERVICES
;	0036	!	AND INTERNAL EXEC ROUTINES.
;	0037	!
;	0038	!--
;	0039	!
;	0040	!
;	0041	! AUTHOR:  D. H. GILLESPIE,	 CREATION DATE:	19-MAY-77  	11:35
;	0042	!
;	0043	! REVISION HISTORY:
;	0044	!
;	0045	!   D. H. Gillespie, 12-May-78  8:42
;	0046	!   A0001 - change CURRENT_VCB to register
;	0047	!
;	0048	!**
;	0049	
;	0050	
;	0051	LIBRARY 'SYS$LIBRARY:LIB.L32';
;	0052	REQUIRE 'SRC$:MTADEF.B32';

; Bliss-32 7.352	Saturday 21-AUG-1978 23:27:16	DBB3:[MTAACP.SRC]CALVER.B32;3					Page 2
; Digital Equipment Corporation
;
;	0348	GLOBAL ROUTINE CALC_VERSION(BINVER) : COMMON_CALL NOVALUE =
;	0349	
;	0350	!++
;	0351	!
;	0352	! FUNCTIONAL DESCRIPTION:
;	0353	!	THIS ROUTINE CALCULATES VERSION NUMBER FROM GENERATION AND GENERATION VERSION
;	0354	!
;	0355	! CALLING SEQUENCE:
;	0356	!	CALC_VERSION(ARG1)
;	0357	!
;	0358	! INPUT PARAMETERS:
;	0359	!	ARG1 - ADDRESS OF TWO BYTES TO RECEIVE BINARY VERSION NUMBER
;	0360	!
;	0361	! IMPLICIT INPUTS:
;	0362	!	HDR1		- ADDRESS OF HDR1 LABEL FOR CURRENT FILE
;	0363	!
;	0364	! OUTPUT PARAMETERS:
;	0365	!	ARG1
;	0366	!
;	0367	! IMPLICIT OUTPUTS:
;	0368	!	NONE
;	0369	!
;	0370	! ROUTINE VALUE:
;	0371	!	NONE
;	0372	!
;	0373	! SIDE EFFECTS:
;	0374	!	ARG1 RECEIVES BINARY VERSION NUMBER
;	0375	!
;	0376	!--
;	0377	
;	0378	BEGIN
;	0379	
;	0380	EXTERNAL REGISTER
;	0381		COMMON_REG;
;	0382	
;	0383	
;	0384	EXTERNAL
;	0385		HDR1:		REF BBLOCK;			!ADDRESS OF HDR1(EOF1) LABEL
;	0386	
;	0387	EXTERNAL ROUTINE
;	0388		LIB$CVT_DTB:	ADDRESSING_MODE(ABSOLUTE);	!CONVERT DECIMAL TO BINARY
;	0389	
;	0390	
;	0391	LOCAL
;	0392		GENNO,						!BINARY GENERATION NUMBER
;	0393		GENVER;						!BINARY GENERATION VERSION
;	0394	
;	0395	! CLEAR VERSION #
;	0396	(.BINVER)<0,16> = 0;
;	0397	
;	0398	! BINARY VERSION # =
;	0399	! (GENERATION NUMBER - 1) * 100 + GENERATION VERSION + 1
;	0400	IF LIB$CVT_DTB(HD1$S_GENNO,HDR1[HD1$T_GENNO],GENNO)	!CONVERT GENERATION NUMBER TO BINARY
;	0401	THEN							!CONTINUE IF NO ERROR
;	0402	        IF LIB$CVT_DTB(HD1$S_GENVER,HDR1[HD1$T_GENVER],GENVER)	!CONVERT GEN VERSION NUMBER TO BINARY

; Bliss-32 7.352	Saturday 21-AUG-1978 23:27:16	DBB3:[MTAACP.SRC]CALVER.B32;3					Page 2-1
; Digital Equipment Corporation
;
;	0403	        THEN						!CONTINUE WITH CONVERSION IF NO ERROR
;	0404	            (.BINVER)<0,15> = (.GENNO - 1) * 100 + .GENVER + 1;
;	0405	END;							!END OF ROUTINE


							    .TITLE  CALVER
							    .IDENT  \A0001\

							    .GLOBL  HDR1, LIB$CVT_DTB

							    .PSECT  $CODE$,NOWRT,2

					 0400 00000 	    .ENTRY  CALC_VERSION, Save R10				      ; 0348
		         5A 00000000G  9F  9E 00002 	    MOVAB   @#LIB$CVT_DTB, R10					      ;
		         5E	       08  C2 00009 	    SUBL2   #8, SP						      ;
				  04   BC  B4 0000C 	    CLRW    @BINVER						      ; 0396
				  04   AE  9F 0000F 	    PUSHAB  GENNO						      ; 0400
	   7E	  0000G  CF	       23  C1 00012 	    ADDL3   #35, HDR1, -(SP)					      ;
				       04  DD 00018 	    PUSHL   #4							      ;
		         6A	       03  FB 0001A 	    CALLS   #3, LIB$CVT_DTB					      ;
		         26	       50  E9 0001D 	    BLBC    R0, 1$						      ;
				       5E  DD 00020 	    PUSHL   SP							      ; 0402
	   7E	  0000G  CF	       27  C1 00022 	    ADDL3   #39, HDR1, -(SP)					      ;
				       02  DD 00028 	    PUSHL   #2							      ;
		         6A	       03  FB 0002A 	    CALLS   #3, LIB$CVT_DTB					      ;
		         16	       50  E9 0002D 	    BLBC    R0, 1$						      ;
	   50	    04   AE 00000064   8F  C5 00030 	    MULL3   #100, GENNO, R0					      ; 0404
		         50	       6E  C0 00039 	    ADDL2   GENVER, R0						      ;
		         51	  9D   A0  9E 0003C 	    MOVAB   -99(R0), R1						      ;
	   0F	         00	       51  F0 00040 	    INSV    R1, #0, #15, @BINVER				      ;
				  04   BC     00044									      ;
					   04 00046 1$:     RET     							      ; 0348

; Routine Size:  71 bytes


;	0406	
;	0407	END
;	0408	ELUDOM






;				       PSECT SUMMARY
;
;	Name		 Bytes			       Attributes
;
;  $CODE$         	    71  NOWRT,  RD ,  EXE,NOSHR,  LCL,  REL,  CON,NOPIC,ALIGN(2)




;				LIBRARY STATISTICS

; Bliss-32 7.352	Saturday 21-AUG-1978 23:27:16	DBB3:[MTAACP.SRC]CALVER.B32;3					Page 2-2
; Digital Equipment Corporation
;
;
;					     -------- Symbols --------    Blocks
;	File				     Total    Loaded   Percent      Read
;
;  DBA4:[SYSLIB]LIB.L32;1		      5582         6         0       224





; Size:		71 code + 0 data bytes
; Run Time:	00:04.7
; Elapsed Time:	00:15.2
; Memory Used:	254 pages
; Compilation Complete
