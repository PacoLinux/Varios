
; Bliss-32 7.352	Saturday 21-AUG-1978 23:45:48	DBB3:[MTAACP.SRC]RWVOL.B32;10					Page 1
; Digital Equipment Corporation
;
;	0001	MODULE RWVOL (
;	0002			LANGUAGE (BLISS32),
;	0003			IDENT = 'A0003'
;	0004			) =
;	0005	BEGIN
;	0006	
;	0007	!
;	0008	! COPYRIGHT (C) 1977
;	0009	! DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASSACHUSETTS 01754
;	0010	!
;	0011	! THIS SOFTWARE IS FURNISHED  UNDER A LICENSE FOR USE ONLY ON A SINGLE
;	0012	! COMPUTER  SYSTEM AND  MAY BE  COPIED ONLY WITH  THE INCLUSION OF THE
;	0013	! ABOVE COPYRIGHT NOTICE.  THIS SOFTWARE, OR ANY OTHER COPIES THEREOF,
;	0014	! MAY NOT BE PROVIDED OR  OTHERWISE MADE AVAILABLE TO ANY OTHER PERSON
;	0015	! EXCEPT FOR USE ON SUCH SYSTEM AND TO ONE WHO AGREES TO THESE LICENSE
;	0016	! TERMS.  TITLE TO AND  OWNERSHIP OF THE  SOFTWARE  SHALL AT ALL TIMES
;	0017	! REMAIN IN DEC.
;	0018	!
;	0019	! THE INFORMATION IN THIS SOFTWARE IS SUBJECT TO CHANGE WITHOUT NOTICE
;	0020	! AND SHOULD  NOT BE CONSTRUED  AS A COMMITMENT  BY DIGITAL  EQUIPMENT
;	0021	! CORPORATION.
;	0022	!
;	0023	! DEC ASSUMES  NO  RESPONSIBILITY  FOR  THE USE OR  RELIABILITY OF ITS
;	0024	! SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DEC.
;	0025	
;	0026	!++
;	0027	!
;	0028	! FACILITY:  MTAACP
;	0029	!
;	0030	! ABSTRACT:
;	0031	!	THIS MODULES REWINDS A VOLUME SET
;	0032	!
;	0033	!
;	0034	! ENVIRONMENT:
;	0035	!
;	0036	!	STARLET OPERATING SYSTEM, INCLUDING PRIVILEGED SYSTEM SERVICES
;	0037	!	AND INTERNAL EXEC ROUTINES.
;	0038	!
;	0039	!--
;	0040	!
;	0041	!
;	0042	! AUTHOR:  D. H. GILLESPIE,	 CREATION DATE:  16-JUL-1977  
;	0043	!
;	0044	! REVISION HISTORY:
;	0045	!
;	0046	!   D. H. Gillespie, 15-May-78  8:45
;	0047	!   X0002 - change CURRENT_VCB to a register
;	0048	!
;	0049	!   D. H. Gillespie, 18-May-78  15:31
;	0050	!   A0002 -  set VALID bit and do some rewinds with IO$M_NOWAIT
;	0051	!
;	0052	!   D. H. Gillespie, 8-Jun-78  8:26
;	0053	!   A0003 - change CTL$GL_CCB to @CTL$GL_CCBBASE
;	0054	!
;	0055	!**

; Bliss-32 7.352	Saturday 21-AUG-1978 23:45:48	DBB3:[MTAACP.SRC]RWVOL.B32;10					Page 1-1
; Digital Equipment Corporation
;
;	0056	
;	0057	LIBRARY 'SYS$LIBRARY:LIB.L32';
;	0058	REQUIRE 'SRC$:MTADEF.B32';
;	0354	
;	0355	FORWARD ROUTINE
;	0356		REWIND_AND_WAIT	: COMMON_CALL,	!REWIND AND WAIT FOR COMPLETION
;	0357		REQUEST_UNBLOCK	: COMMON_CALL NOVALUE,	!AST TO HANDLES COMPLETION OF REWIND
;	0358		REWIND_VOL_SET	: COMMON_CALL NOVALUE,	!REWIND VOLUME SET
;	0359		SET_AMB_POS	: COMMON_CALL NOVALUE,	!SET THE POSITION OF VOL SET TO AMBIGUOUS
;	0360		SET_VALID	: COMMON_CALL NOVALUE;	!SET VALID BIT
;	0361	EXTERNAL
;	0362		CTL$GL_CCBBASE	: REF BBLOCK ADDRESSING_MODE(ABSOLUTE),	!CHANNEL CONTROL BLOCK
;	0363		CURRENT_UCB	: REF BBLOCK,		!ADDRESS OF CURRENT UNIT CONTROL BLOCK
;	0364		CURRENT_WCB	: REF BBLOCK,		!ADDRESS OF CURRENT WINDOW CONTROL BLOCK
;	0365		IO_CHANNEL,				!ACP IO CHANNEL
;	0366		IO_PACKET,				!ADDRESS OF CURRENT IO PACKET
;	0367		USER_STATUS	: VECTOR[2];		!USER IO STATUS
;	0368	
;	0369	EXTERNAL ROUTINE
;	0370		BLOCK,					!BLOCK CURRENT REQUEST
;	0371		CLOSE_FILE	: L$CLOSE_FILE,		!CLOSE A FILE
;	0372		DO_CANCEL,				!CANCEL ALL IO
;	0373		SYS$QIO		: ADDRESSING_MODE(ABSOLUTE),	!FORMAT ASCII OUTPUT
;	0374		UNBLOCK;				!UNBLOCK A REQUEST

; Bliss-32 7.352	Saturday 21-AUG-1978 23:45:48	DBB3:[MTAACP.SRC]RWVOL.B32;10					Page 2
; Digital Equipment Corporation
;
;	0375	GLOBAL ROUTINE REWIND_VOL_SET : COMMON_CALL NOVALUE  =
;	0376	
;	0377	!++
;	0378	!
;	0379	! FUNCTIONAL DESCRIPTION:
;	0380	!	THIS ROUTINE REWINDS THE VOLUMES IN A VOLUME SET
;	0381	!	WAITS FOR THE COMPLETION OF THE REWIND OF VOLUME ONE
;	0382	!	AND SETS THE CURRENT VOLUME SET POSITION TO AMBIGUOUS
;	0383	!
;	0384	! CALLING SEQUENCE:
;	0385	!	REWIND_VOL_SET()
;	0386	!
;	0387	! INPUT PARAMETERS:
;	0388	!	NONE
;	0389	!
;	0390	! IMPLICIT INPUTS:
;	0391	!	CURRENT_VCB - ADDRESS OF CURRENT VOLUME CONTROL BLOCK
;	0392	!	CURRENT_WCB - ADDRESS OF CURRENT WINDOW CONTROL BLOCK
;	0393	!
;	0394	! OUTPUT PARAMETERS:
;	0395	!	NONE
;	0396	!
;	0397	! IMPLICIT OUTPUTS:
;	0398	!	VOLUMES REWOUND
;	0399	!	CURRENT RELATIVE VOLUME NUMBER AND CHANNEL SET TO FIRST VOLUME
;	0400	!
;	0401	! ROUTINE VALUE:
;	0402	!	NONE
;	0403	!
;	0404	! SIDE EFFECTS:
;	0405	!	SS$_FILALRACC - CAN NOT REWIND VOLUME SET IF A FILE IS CURRENTLY ACCESSED
;	0406	!	SS$_FCPREWNDERR - FILE CONTROL PROCESS REWIND ERROR
;	0407	!
;	0408	!--
;	0409	
;	0410	BEGIN
;	0411	
;	0412	EXTERNAL REGISTER
;	0413		COMMON_REG;
;	0414	
;	0415	
;	0416	LOCAL
;	0417		MVL		: REF BBLOCK,		!ADDRESS OF MVL CONTROL BLOCK
;	0418		NVOLS,					!NUMBER OF VOLUMES IN VOLUME SET
;	0419		VOLLIST		: REF BBLOCKVECTOR[,MVL$K_LENGTH],	!VOLUME LIST IN MVL
;	0420		CCB		: REF BBLOCK,		!CHANNEL CONTROL BLOCK
;	0421		UCBLIST		: REF VECTOR;		!UCB LIST
;	0422	
;	0423	! FIRST MAKE SURE THAT THERE ARE NO FILES ACCESSED
;	0424	IF .CURRENT_WCB NEQU 0 THEN ERR_EXIT(SS$_FILALRACC);
;	0425	IF .CURRENT_VCB[VCB$V_PARTFILE] THEN CLOSE_FILE();
;	0426	
;	0427	! SETUP POINTERS TO INTERESTING STRUCTURES
;	0428	MVL = .CURRENT_VCB[VCB$L_MVL];
;	0429	NVOLS = .MVL[MVL$B_NVOLS] - 1;

; Bliss-32 7.352	Saturday 21-AUG-1978 23:45:48	DBB3:[MTAACP.SRC]RWVOL.B32;10					Page 2-1
; Digital Equipment Corporation
;
;	0430	VOLLIST = .MVL + MVL$K_FIXLEN;
;	0431	UCBLIST = BBLOCK[.CURRENT_VCB[VCB$L_RVT],RVT$L_UCBLST];
;	0432	CCB = .CTL$GL_CCBBASE - .IO_CHANNEL;
;	0433	KERNEL_CALL(SET_AMB_POS);
;	0434	
;	0435	! NOW ISSUE REWINDS
;	0436	DECR I FROM .NVOLS TO 0 DO
;	0437	    BEGIN
;	0438	    IF .VOLLIST[.I,MVL$V_MOUNTED] THEN
;	0439		BEGIN
;	0440		CCB[CCB$L_UCB] = .UCBLIST[.VOLLIST[.I,MVL$B_RVN]];	!ASSIGN CHANNEL
;	0441		IF .I NEQU 0 					!DON'T WAIT FOR ALL BUT FIRST
;	0442		THEN  $QIOW	( CHAN = .IO_CHANNEL,
;     P 0443				  FUNC = IO$_REWIND OR IO$M_NOWAIT)
;	0444		ELSE REWIND_AND_WAIT();
;	0445		END;
;	0446	    END;
;	0447	
;	0448	END;				!END OF ROUTINE


							    .TITLE  RWVOL
							    .IDENT  \A0003\

							    .GLOBL  CTL$GL_CCBBASE, CURRENT_UCB, CURRENT_WCB, IO_CHANNEL
							    .GLOBL  IO_PACKET, USER_STATUS, BLOCK, CLOSE_FILE, DO_CANCEL
							    .GLOBL  SYS$QIO, UNBLOCK, SYS$CMKRNL, SYS$QIOW

							    .PSECT  $CODE$,NOWRT,2

					 043C 00000 	    .ENTRY  REWIND_VOL_SET, Save R2,R3,R4,R5,R10		      ; 0375
				0000G  CF  D5 00002 	    TSTL    CURRENT_WCB						      ; 0424
				       04  13 00006 	    BEQL    1$							      ;
				00A4   8F  BF 00008 	    CHMU    #164						      ;
		         03	  0B   AB  E9 0000C 1$:     BLBC    11(CURRENT_VCB), 2$					      ; 0425
				     0000  30 00010 	    BSBW    CLOSE_FILE						      ;
		         50	  34   AB  D0 00013 2$:     MOVL    52(CURRENT_VCB), MVL				      ; 0428
		         52	  0B   A0  9A 00017 	    MOVZBL  11(MVL), NVOLS					      ; 0429
				       52  D7 0001B 	    DECL    NVOLS						      ;
	   53	         50	       0C  C1 0001D 	    ADDL3   #12, MVL, VOLLIST					      ; 0430
	   55	    20   AB	       0C  C1 00021 	    ADDL3   #12, 32(CURRENT_VCB), UCBLIST			      ; 0431
	   54 00000000G  9F	0000G  CF  C3 00026 	    SUBL3   IO_CHANNEL, @#CTL$GL_CCBBASE, CCB			      ; 0432
				       7E  D4 00030 	    CLRL    -(SP)						      ; 0433
				       5E  DD 00032 	    PUSHL   SP							      ;
				0000V  CF  9F 00034 	    PUSHAB  SET_AMB_POS						      ;
	      00000000G  9F	       03  FB 00038 	    CALLS   #3, @#SYS$CMKRNL					      ;
				       52  D6 0003F 	    INCL    I							      ; 0436
				       38  11 00041 	    BRB     5$							      ;
				  07 A342  7F 00043 3$:     PUSHAQ  7(VOLLIST)[I]					      ; 0438
		         31	       9E  E9 00047 	    BLBC    @(SP)+, 5$						      ;
				  06 A342  7F 0004A 	    PUSHAQ  6(VOLLIST)[I]					      ; 0440
		         50	       9E  9A 0004E 	    MOVZBL  @(SP)+, R0						      ;
		         64	     6540  D0 00051 	    MOVL    (UCBLIST)[R0], (CCB)				      ;
				       52  D5 00055 	    TSTL    I							      ; 0441
				       1D  13 00057 	    BEQL    4$							      ;

; Bliss-32 7.352	Saturday 21-AUG-1978 23:45:48	DBB3:[MTAACP.SRC]RWVOL.B32;10					Page 2-2
; Digital Equipment Corporation
;
				       7E  7C 00059 	    CLRQ    -(SP)						      ; 0443
				       7E  7C 0005B 	    CLRQ    -(SP)						      ;
				       7E  7C 0005D 	    CLRQ    -(SP)						      ;
				       7E  7C 0005F 	    CLRQ    -(SP)						      ;
				       7E  D4 00061 	    CLRL    -(SP)						      ;
		         7E	  A4   8F  9A 00063 	    MOVZBL  #164, -(SP)						      ;
				0000G  CF  DD 00067 	    PUSHL   IO_CHANNEL						      ;
				       7E  D4 0006B 	    CLRL    -(SP)						      ;
	      00000000G  9F	       0C  FB 0006D 	    CALLS   #12, @#SYS$QIOW					      ;
				       05  11 00074 	    BRB     5$							      ; 0441
		  0000V  CF	       00  FB 00076 4$:     CALLS   #0, REWIND_AND_WAIT					      ; 0444
		         C5	       52  F4 0007B 5$:     SOBGEQ  I, 3$						      ; 0436
					   04 0007E 	    RET     							      ; 0375

; Routine Size:  127 bytes



; Bliss-32 7.352	Saturday 21-AUG-1978 23:45:48	DBB3:[MTAACP.SRC]RWVOL.B32;10					Page 3
; Digital Equipment Corporation
;
;	0449	GLOBAL ROUTINE SET_AMB_POS : COMMON_CALL NOVALUE  =
;	0450	
;	0451	!++
;	0452	!
;	0453	! FUNCTIONAL DESCRIPTION:
;	0454	!	THIS ROUTINE SET THE POSITION OF THE VOLUME SET TO AMBIGUOUS
;	0455	!
;	0456	! CALLING SEQUENCE:
;	0457	!	SET_AMB_POS()
;	0458	!	CALL IN KERNEL MODE
;	0459	!
;	0460	! INPUT PARAMETERS:
;	0461	!	NONE
;	0462	!
;	0463	! IMPLICIT INPUTS:
;	0464	!	CURRENT_VCB - ADDRESS OF CURRENT VOLUME CONTROL BLOCK
;	0465	!
;	0466	! OUTPUT PARAMETERS:
;	0467	!	NONE
;	0468	!
;	0469	! IMPLICIT OUTPUTS:
;	0470	!	NONE
;	0471	!
;	0472	! ROUTINE VALUE:
;	0473	!	NONE
;	0474	!
;	0475	! SIDE EFFECTS:
;	0476	!	NONE
;	0477	!
;	0478	!--
;	0479	
;	0480	BEGIN
;	0481	
;	0482	EXTERNAL REGISTER
;	0483		COMMON_REG;
;	0484	
;	0485	CURRENT_VCB[VCB$B_TM] = 0;
;	0486	CURRENT_VCB[VCB$L_ST_RECORD] = 0;
;	0487	CURRENT_VCB[VCB$V_LOGICEOVS] = 0;
;	0488	CURRENT_VCB[VCB$B_CUR_RVN] = 0;
;	0489	CURRENT_VCB[VCB$L_CUR_FID] = 0;
;	0490	
;	0491	END;							!END OF ROUTINE





					 0000 0007F 	    .ENTRY  SET_AMB_POS, Save nothing				      ; 0449
				  2E   AB  94 00081 	    CLRB    46(CURRENT_VCB)					      ; 0485
				  30   AB  D4 00084 	    CLRL    48(CURRENT_VCB)					      ; 0486
		    0B   AB	       02  8A 00087 	    BICB2   #2, 11(CURRENT_VCB)					      ; 0487
				  2F   AB  94 0008B 	    CLRB    47(CURRENT_VCB)					      ; 0488
				  24   AB  D4 0008E 	    CLRL    36(CURRENT_VCB)					      ; 0489
					   04 00091 	    RET     							      ; 0449

; Bliss-32 7.352	Saturday 21-AUG-1978 23:45:48	DBB3:[MTAACP.SRC]RWVOL.B32;10					Page 3-1
; Digital Equipment Corporation
;

; Routine Size:  19 bytes


;	0492	

; Bliss-32 7.352	Saturday 21-AUG-1978 23:45:48	DBB3:[MTAACP.SRC]RWVOL.B32;10					Page 4
; Digital Equipment Corporation
;
;	0493	GLOBAL ROUTINE REQUEST_UNBLOCK(VCB) : COMMON_CALL NOVALUE  =
;	0494	
;	0495	!++
;	0496	!
;	0497	! FUNCTIONAL DESCRIPTION:
;	0498	!	HANDLES REQUESTS TO UNBLOCK CURRENT VOLUME OPERATION
;	0499	!
;	0500	! CALLING SEQUENCE:
;	0501	!	REWIND_DONE(ARG1)
;	0502	!
;	0503	! INPUT PARAMETERS:
;	0504	!	ARG1 - ADDRESS OF VCB
;	0505	!
;	0506	! IMPLICIT INPUTS:
;	0507	!	SAVED STACK AND IMPURE AREA
;	0508	!
;	0509	! OUTPUT PARAMETERS:
;	0510	!	NONE
;	0511	!
;	0512	! IMPLICIT OUTPUTS:
;	0513	!	NONE
;	0514	!
;	0515	! ROUTINE VALUE:
;	0516	!	NONE
;	0517	!
;	0518	! SIDE EFFECTS:
;	0519	!	NEVER RETURNS TO PC WHERE AST'S WERE ENABLED
;	0520	!	INSTEAD IT RESUMES WHERE THE BLOCKED REQUEST LEFT OFF
;	0521	!
;	0522	!--
;	0523	
;	0524	BEGIN
;	0525	
;	0526	EXTERNAL REGISTER
;	0527		COMMON_REG;
;	0528	
;	0529	
;	0530	CURRENT_VCB = .VCB;				!RESTORE VCB
;	0531	
;	0532	IF .CURRENT_VCB[VCB$V_CANCELIO] THEN
;	0533	    BEGIN
;	0534	    ERROR(SS$_CANCEL);
;	0535	    KERNEL_CALL(DO_CANCEL);			!CANCEL IO
;	0536	    IO_PACKET = 0;				!NO REQUEST PACKET TO PROCESS
;	0537	    RETURN;
;	0538	    END;
;	0539	UNBLOCK();					!UNBLOCK AND CONTINUE WERE REQUEST PROCESSING LEFT OFF
;	0540	END;						!END OF ROUTINE





					 0000 00092 	    .ENTRY  REQUEST_UNBLOCK, Save nothing			      ; 0493
		         5B	  04   AC  D0 00094 	    MOVL    VCB, CURRENT_VCB					      ; 0530

; Bliss-32 7.352	Saturday 21-AUG-1978 23:45:48	DBB3:[MTAACP.SRC]RWVOL.B32;10					Page 4-1
; Digital Equipment Corporation
;
	   1B	    0B   AB	       05  E1 00098 	    BBC     #5, 11(CURRENT_VCB), 1$				      ; 0532
		  0000G  CF	0830   8F  B0 0009D 	    MOVW    #2096, USER_STATUS					      ; 0534
				       7E  D4 000A4 	    CLRL    -(SP)						      ; 0535
				       5E  DD 000A6 	    PUSHL   SP							      ;
				0000G  CF  9F 000A8 	    PUSHAB  DO_CANCEL						      ;
	      00000000G  9F	       03  FB 000AC 	    CALLS   #3, @#SYS$CMKRNL					      ;
				0000G  CF  D4 000B3 	    CLRL    IO_PACKET						      ; 0536
					   04 000B7 	    RET     							      ; 0537
		  0000G  CF	       00  FB 000B8 1$:     CALLS   #0, UNBLOCK						      ; 0539
					   04 000BD 	    RET     							      ; 0493

; Routine Size:  44 bytes


;	0541	
;	0542	

; Bliss-32 7.352	Saturday 21-AUG-1978 23:45:48	DBB3:[MTAACP.SRC]RWVOL.B32;10					Page 5
; Digital Equipment Corporation
;
;	0543	GLOBAL ROUTINE REWIND_AND_WAIT : COMMON_CALL  =
;	0544	
;	0545	!++
;	0546	!
;	0547	! FUNCTIONAL DESCRIPTION:
;	0548	!	THIS ROUTINE REWINDS THE UNIT ASSIGNED TO IO_CHANNEL
;	0549	!	AND WAITS FOR COMPLETION OF THE REWIND
;	0550	!
;	0551	! CALLING SEQUENCE:
;	0552	!	REWIND_AND_WAIT()
;	0553	!
;	0554	! INPUT PARAMETERS:
;	0555	!	NONE
;	0556	!
;	0557	! IMPLICIT INPUTS:
;	0558	!	CURRENT_VCB - ADDRESS OF CURRENT VOLUME CONTROL BLOCK
;	0559	!	IO_CHANNEL - ACP IO CHANNEL
;	0560	!
;	0561	! OUTPUT PARAMETERS:
;	0562	!	NONE
;	0563	!
;	0564	! IMPLICIT OUTPUTS:
;	0565	!	NONE
;	0566	!
;	0567	! ROUTINE VALUE:
;	0568	!	0 - UNIT OFF_LINE
;	0569	!	1 - SUCCESSFUL
;	0570	!
;	0571	! SIDE EFFECTS:
;	0572	!	NONE
;	0573	!
;	0574	!--
;	0575	
;	0576	BEGIN
;	0577	
;	0578	EXTERNAL REGISTER
;	0579		COMMON_REG;
;	0580	
;	0581	
;	0582	LOCAL
;	0583		STATUS;				!STATUS OF IO
;	0584	
;	0585	KERNEL_CALL(SET_VALID);
;	0586	SYS$QIO(,.IO_CHANNEL,IO$_REWIND,BBLOCK[.CURRENT_VCB[VCB$L_VPFL],VVP$L_STATUS],
;	0587		REQUEST_UNBLOCK,.CURRENT_VCB, ,,,,,);
;	0588	BLOCK($FIELDMASK(VCB$V_WAIREWIND));
;	0589	STATUS = .BBLOCK[.CURRENT_VCB[VCB$L_VPFL],VVP$L_STATUS];
;	0590	IF .STATUS<0,16> EQL SS$_MEDOFL OR .STATUS<0,16> EQL SS$_VOLINV THEN RETURN 0;
;	0591	IF NOT .STATUS THEN
;	0592	BEGIN
;	0593	    USER_STATUS[0] = .STATUS;
;	0594	    USER_STATUS[1] = SS$_FCPREWNDERR;
;	0595	    ERR_EXIT();
;	0596	    END;
;	0597	RETURN 1;

; Bliss-32 7.352	Saturday 21-AUG-1978 23:45:48	DBB3:[MTAACP.SRC]RWVOL.B32;10					Page 5-1
; Digital Equipment Corporation
;
;	0598	END;			!END OF ROUTINE





					 0004 000BE 	    .ENTRY  REWIND_AND_WAIT, Save R2				      ; 0543
				       7E  D4 000C0 	    CLRL    -(SP)						      ; 0585
				       5E  DD 000C2 	    PUSHL   SP							      ;
				0000V  CF  9F 000C4 	    PUSHAB  SET_VALID						      ;
	      00000000G  9F	       03  FB 000C8 	    CALLS   #3, @#SYS$CMKRNL					      ;
				       7E  7C 000CF 	    CLRQ    -(SP)						      ; 0586
				       7E  7C 000D1 	    CLRQ    -(SP)						      ;
				       7E  7C 000D3 	    CLRQ    -(SP)						      ;
				       5B  DD 000D5 	    PUSHL   CURRENT_VCB						      ;
				  B8   AF  9F 000D7 	    PUSHAB  REQUEST_UNBLOCK					      ;
	   52	    3C   AB 000000FC   8F  C1 000DA 	    ADDL3   #252, 60(CURRENT_VCB), R2				      ;
				       52  DD 000E3 	    PUSHL   R2							      ;
				       24  DD 000E5 	    PUSHL   #36							      ;
				0000G  CF  DD 000E7 	    PUSHL   IO_CHANNEL						      ;
				       7E  D4 000EB 	    CLRL    -(SP)						      ;
	      00000000G  9F	       0C  FB 000ED 	    CALLS   #12, @#SYS$QIO					      ;
				       08  DD 000F4 	    PUSHL   #8							      ; 0588
		  0000G  CF	       01  FB 000F6 	    CALLS   #1, BLOCK						      ;
		         50	       62  D0 000FB 	    MOVL    (R2), STATUS					      ; 0589
		  01A4   8F	       50  B1 000FE 	    CMPW    STATUS, #420					      ; 0590
				       1C  13 00103 	    BEQL    2$							      ;
		  0254   8F	       50  B1 00105 	    CMPW    STATUS, #596					      ;
				       15  13 0010A 	    BEQL    2$							      ;
		         0E	       50  E8 0010C 	    BLBS    STATUS, 1$						      ; 0591
		  0000G  CF	       50  D0 0010F 	    MOVL    STATUS, USER_STATUS					      ; 0593
		  0000G  CF	0890   8F  3C 00114 	    MOVZWL  #2192, USER_STATUS+4				      ; 0594
				       00  BF 0011B 	    CHMU    #0							      ; 0595
		         50	       01  D0 0011D 1$:     MOVL    #1, R0						      ; 0597
					   04 00120 	    RET     							      ;
				       50  D4 00121 2$:     CLRL    R0							      ; 0543
					   04 00123 	    RET     							      ;

; Routine Size:  102 bytes


;	0599	
;	0600	
;	0601	ROUTINE SET_VALID  : COMMON_CALL NOVALUE =
;	0602	
;	0603	!++
;	0604	!
;	0605	! FUNCTIONAL DESCRIPTION:
;	0606	!	 This routine sets the VALID bit in the UCB
;	0607	!
;	0608	!
;	0609	!
;	0610	! CALLING SEQUENCE:
;	0611	!
;	0612	! INPUT PARAMETERS:

; Bliss-32 7.352	Saturday 21-AUG-1978 23:45:48	DBB3:[MTAACP.SRC]RWVOL.B32;10					Page 5-2
; Digital Equipment Corporation
;
;	0613	!	NONE
;	0614	!
;	0615	! IMPLICIT INPUTS:
;	0616	!	CURRENT_UCB - address of current unit control block
;	0617	!
;	0618	! OUTPUT PARAMETERS:
;	0619	!	NONE
;	0620	!
;	0621	! IMPLICIT OUTPUTS:
;	0622	!	VALID bit set
;	0623	!
;	0624	! ROUTINE VALUE:
;	0625	!	NONE
;	0626	!
;	0627	! SIDE EFFECTS:
;	0628	!	NONE
;	0629	!
;	0630	!--
;	0631	
;	0632	BEGIN
;	0633	
;	0634	CURRENT_UCB[UCB$V_VALID] = 1;
;	0635	END;





					 0000 00124 SET_VALID:
							    .WORD   Save nothing					      ; 0601
		         50	0000G  CF  D0 00126 	    MOVL    CURRENT_UCB, R0					      ; 0634
		    59   A0	       08  88 0012B 	    BISB2   #8, 89(R0)						      ;
					   04 0012F 	    RET     							      ; 0601

; Routine Size:  12 bytes


;	0636	 
;	0637	END
;	0638	ELUDOM






;				       PSECT SUMMARY
;
;	Name		 Bytes			       Attributes
;
;  $CODE$         	   304  NOWRT,  RD ,  EXE,NOSHR,  LCL,  REL,  CON,NOPIC,ALIGN(2)





; Bliss-32 7.352	Saturday 21-AUG-1978 23:45:48	DBB3:[MTAACP.SRC]RWVOL.B32;10					Page 5-3
; Digital Equipment Corporation
;
;				LIBRARY STATISTICS
;
;					     -------- Symbols --------    Blocks
;	File				     Total    Loaded   Percent      Read
;
;  DBA4:[SYSLIB]LIB.L32;1		      5582        34         0       248





; Size:		304 code + 0 data bytes
; Run Time:	00:10.8
; Elapsed Time:	00:24.9
; Memory Used:	286 pages
; Compilation Complete
