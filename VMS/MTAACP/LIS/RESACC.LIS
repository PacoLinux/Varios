
; Bliss-32 7.352	Saturday 21-AUG-1978 23:44:32	DBB3:[MTAACP.SRC]RESACC.B32;4					Page 1
; Digital Equipment Corporation
;
;	0001	MODULE RESACC (
;	0002			LANGUAGE (BLISS32),
;	0003			IDENT = 'A0001'		) =
;	0004	BEGIN
;	0005	
;	0006	!
;	0007	! COPYRIGHT (C) 1977
;	0008	! DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASSACHUSETTS 01754
;	0009	!
;	0010	! THIS SOFTWARE IS FURNISHED  UNDER A LICENSE FOR USE ONLY ON A SINGLE
;	0011	! COMPUTER  SYSTEM AND  MAY BE  COPIED ONLY WITH  THE INCLUSION OF THE
;	0012	! ABOVE COPYRIGHT NOTICE.  THIS SOFTWARE, OR ANY OTHER COPIES THEREOF,
;	0013	! MAY NOT BE PROVIDED OR  OTHERWISE MADE AVAILABLE TO ANY OTHER PERSON
;	0014	! EXCEPT FOR USE ON SUCH SYSTEM AND TO ONE WHO AGREES TO THESE LICENSE
;	0015	! TERMS.  TITLE TO AND  OWNERSHIP OF THE  SOFTWARE  SHALL AT ALL TIMES
;	0016	! REMAIN IN DEC.
;	0017	!
;	0018	! THE INFORMATION IN THIS SOFTWARE IS SUBJECT TO CHANGE WITHOUT NOTICE
;	0019	! AND SHOULD  NOT BE CONSTRUED  AS A COMMITMENT  BY DIGITAL  EQUIPMENT
;	0020	! CORPORATION.
;	0021	!
;	0022	! DEC ASSUMES  NO  RESPONSIBILITY  FOR  THE USE OR  RELIABILITY OF ITS
;	0023	! SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DEC.
;	0024	
;	0025	!++
;	0026	!
;	0027	! FACILITY:  MTAACP
;	0028	!
;	0029	! ABSTRACT:
;	0030	!	THIS MODULE RESTORES THE FILE ACCESS TO WHAT WAS ORIGINALLY REQUESTED
;	0031	!
;	0032	!
;	0033	! ENVIRONMENT:
;	0034	!
;	0035	!	STARLET OPERATING SYSTEM, INCLUDING PRIVILEGED SYSTEM SERVICES
;	0036	!	AND INTERNAL EXEC ROUTINES.
;	0037	!
;	0038	!--
;	0039	!
;	0040	!
;	0041	! AUTHOR:  D. H. GILLESPIE,	 CREATION DATE:  06-AUG-1977  
;	0042	!
;	0043	! REVISION HISTORY:
;	0044	!
;	0045	!   D. H. Gillespie, 12-May-78  16:37
;	0046	!   'A0001 - change CURRENT_VCB to a register
;	0047	!
;	0048	!**
;	0049	
;	0050	LIBRARY 'SYS$LIBRARY:LIB.L32';
;	0051	REQUIRE	'SRC$:MTADEF.B32';
;	0347	
;	0348	LOCK_CODE;

; Bliss-32 7.352	Saturday 21-AUG-1978 23:44:32	DBB3:[MTAACP.SRC]RESACC.B32;4					Page 2
; Digital Equipment Corporation
;
;	0349	GLOBAL ROUTINE RESTORE_ACCESS : COMMON_CALL NOVALUE  =
;	0350	
;	0351	!++
;	0352	!
;	0353	! FUNCTIONAL DESCRIPTION:
;	0354	!	THIS ROUTINE RESTORES THE FILE ACCESS TO WHAT WAS ORIGINALLY REQUESTED
;	0355	!	AND RESTORES MAPPING POINTER
;	0356	!
;	0357	! CALLING SEQUENCE:
;	0358	!	RESTORE_ACCESS()
;	0359	!	CALLED IN KERNEL_MODE
;	0360	!
;	0361	! INPUT PARAMETERS:
;	0362	!	NONE
;	0363	!
;	0364	! IMPLICIT INPUTS:
;	0365	!	CURRENT_WCB - ADDRESS OF CURRENT WINDOW CONTROL BLOCK
;	0366	!	THIS CODE IS LOCKED INTO CORE BECAUSE IT RUNS AT SYNCH LEVEL
;	0367	!	TO SYNCHRONIZE WITH QIO CODE
;	0368	!
;	0369	! OUTPUT PARAMETERS:
;	0370	!	NONE
;	0371	!
;	0372	! IMPLICIT OUTPUTS:
;	0373	!	FILE ACCESS RESTORED
;	0374	!
;	0375	! ROUTINE VALUE:
;	0376	!	NONE
;	0377	!
;	0378	! SIDE EFFECTS:
;	0379	!	NONE
;	0380	!
;	0381	!--
;	0382	
;	0383	BEGIN
;	0384	
;	0385	EXTERNAL REGISTER
;	0386		COMMON_REG;
;	0387	
;	0388	
;	0389	EXTERNAL
;	0390		CURRENT_UCB	: REF BBLOCK,		!ADDRESS OF CURRENT UNIT CONTROL BLOCK
;	0391		CURRENT_WCB	: REF BBLOCK;		!ADDRESS OF CURRENT WINDOW CONTROL BLOCK
;	0392	
;	0393	! ABOUT TO CHANGE ACCESS TO FILE
;	0394	SET_IPL(IPL$_SYNCH);				!SYNCHRONIZE WITH QIO
;	0395	CURRENT_WCB[WCB$V_READ] = 1;			!ALWAYS GET READ ACCESS
;	0396	CURRENT_WCB[WCB$V_WRITE] = .CURRENT_WCB[WCB$V_WRITEAC];
;	0397	
;	0398	! RESTORE MAPPING PTER
;	0399	CURRENT_WCB[WCB$W_NMAP] = 1;
;	0400	(CURRENT_WCB[WCB$W_P1_COUNT])<0,32> = .CURRENT_UCB;
;	0401	SET_IPL(0);					!LOWER IPL
;	0402	CURRENT_VCB[VCB$V_LOGICEOVS] = 0;
;	0403	END;						!END OF ROUTINE

; Bliss-32 7.352	Saturday 21-AUG-1978 23:44:32	DBB3:[MTAACP.SRC]RESACC.B32;4					Page 2-1
; Digital Equipment Corporation
;


							    .TITLE  RESACC
							    .IDENT  \A0001\

							    .GLOBL  CURRENT_UCB, CURRENT_WCB

							    .PSECT  $LOCKEDC1$,NOWRT,2

					 0000 00000 	    .ENTRY  RESTORE_ACCESS, Save nothing			      ; 0349
		         12	       07  DA 00002 	    MTPR    #7, #18						      ; 0394
		         50	0000G  CF  D0 00005 	    MOVL    CURRENT_WCB, R0					      ; 0395
		    0B   A0	       01  88 0000A 	    BISB2   #1, 11(R0)						      ;
	   01	         01	  15   A0  F0 0000E 	    INSV    21(R0), #1, #1, 11(R0)				      ; 0396
				  0B   A0     00013									      ;
		    16   A0	       01  B0 00015 	    MOVW    #1, 22(R0)						      ; 0399
		    24   A0	0000G  CF  D0 00019 	    MOVL    CURRENT_UCB, 36(R0)					      ; 0400
		         12	       00  DA 0001F 	    MTPR    #0, #18						      ; 0401
		    0B   AB	       02  8A 00022 	    BICB2   #2, 11(CURRENT_VCB)					      ; 0402
					   04 00026 	    RET     							      ; 0349

; Routine Size:  39 bytes


;	0404	
;	0405	END
;	0406	ELUDOM






;				       PSECT SUMMARY
;
;	Name		 Bytes			       Attributes
;
;  $LOCKEDC1$     	    39  NOWRT,  RD ,  EXE,NOSHR,  LCL,  REL,  CON,NOPIC,ALIGN(2)
;  $CODE$         	     0  NOWRT,  RD ,  EXE,NOSHR,  LCL,  REL,  CON,NOPIC,ALIGN(2)




;				LIBRARY STATISTICS
;
;					     -------- Symbols --------    Blocks
;	File				     Total    Loaded   Percent      Read
;
;  DBA4:[SYSLIB]LIB.L32;1		      5582        13         0       228





; Size:		39 code + 0 data bytes

; Bliss-32 7.352	Saturday 21-AUG-1978 23:44:32									Page 2-2
; Digital Equipment Corporation
;
; Run Time:	00:04.5
; Elapsed Time:	00:12.7
; Memory Used:	251 pages
; Compilation Complete
