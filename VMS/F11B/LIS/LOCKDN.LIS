LOCKDN          - LOCK FCP INTO REAL MEMORY                      21-AUG-1978 23:06:54   VAX-11 MACRO X0.3-11               Page   1
B0004                                                                                                                            (1)

                                     0000     1 	.TITLE	LOCKDN - LOCK FCP INTO REAL MEMORY
                                     0000     2 	.IDENT	"B0004"
                                     0000     3 
                                     0000     4 ;
                                     0000     5 ; COPYRIGHT (C) 1976
                                     0000     6 ; DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASSACHUSETTS 01754
                                     0000     7 ;
                                     0000     8 ; THIS SOFTWARE IS FURNISHED  UNDER A LICENSE FOR USE ONLY ON A SINGLE
                                     0000     9 ; COMPUTER  SYSTEM AND  MAY BE  COPIED ONLY WITH  THE INCLUSION OF THE
                                     0000    10 ; ABOVE COPYRIGHT NOTICE.  THIS SOFTWARE, OR ANY OTHER COPIES THEREOF,
                                     0000    11 ; MAY NOT BE PROVIDED OR  OTHERWISE MADE AVAILABLE TO ANY OTHER PERSON
                                     0000    12 ; EXCEPT FOR USE ON SUCH SYSTEM AND TO ONE WHO AGREES TO THESE LICENSE
                                     0000    13 ; TERMS.  TITLE TO AND  OWNERSHIP OF THE  SOFTWARE  SHALL AT ALL TIMES
                                     0000    14 ; REMAIN IN DEC.
                                     0000    15 ;
                                     0000    16 ; THE INFORMATION IN THIS SOFTWARE IS SUBJECT TO CHANGE WITHOUT NOTICE
                                     0000    17 ; AND SHOULD  NOT BE CONSTRUED  AS A COMMITMENT  BY DIGITAL  EQUIPMENT
                                     0000    18 ; CORPORATION.
                                     0000    19 ;
                                     0000    20 ; DEC ASSUMES  NO  RESPONSIBILITY  FOR  THE USE OR  RELIABILITY OF ITS
                                     0000    21 ; SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DEC.
                                     0000    22 
                                     0000    23 ;++
                                     0000    24 ;
                                     0000    25 ; FACILITY:  F11ACP STRUCTURE LEVEL 1
                                     0000    26 ;
                                     0000    27 ; ABSTRACT:
                                     0000    28 ;
                                     0000    29 ;	THIS ROUTINE TOUCHES ALL OF THE PAGES IN FCP TO BRING THEM
                                     0000    30 ;	INTO REAL MEMORY.
                                     0000    31 ;
                                     0000    32 ; ENVIRONMENT:
                                     0000    33 ;
                                     0000    34 ;	STARLET OPERATING SYSTEM, INCLUDING PRIVILEGED SYSTEM SERVICES
                                     0000    35 ;	AND INTERNAL EXEC ROUTINE.
                                     0000    36 ;
                                     0000    37 ; AUTHOR:  ANDREW C. GOLDSTEIN, CREATION DATE:  22-DEC-1976  14:46
                                     0000    38 ;
                                     0000    39 ; REVISION HISTORY:
                                     0000    40 ;
                                     0000    41 ;**
                                     0000    42 
                                     0000    43 ;
                                     0000    44 ; DEFINE LABELS FOR THE START AND END OF THE LOCKED DOWN AREAS
                                     0000    45 ;
                                 00000000    46 	.PSECT	$LOCKEDC0$,NOWRT,PAGE
                                     0000    47 LCODE_START:
                                     0000    48 
                                 00000000    49 	.PSECT	$LOCKEDC9$,NOWRT,LONG
                                     0000    50 LCODE_END:
                                     0000    51 
                                 00000000    52 	.PSECT	$LOCKEDD0$,NOEXE,LONG
                                     0000    53 LDATA_START:
                                     0000    54 
                                 00000000    55 	.PSECT	$LOCKEDD9$,NOEXE,LONG
                                     0000    56 LDATA_END:
                                     0000    57 
LOCKDN          - LOCK FCP INTO REAL MEMORY                      21-AUG-1978 23:06:54   VAX-11 MACRO X0.3-11               Page   2
B0004                                                                                                                            (1)

                                 00000000    58 	.PSECT	$LOCKEDD1$,NOEXE,LONG
                                     0000    59 ;
                                     0000    60 ; OWN STORAGE:
                                     0000    61 ;
                           00000004  0000    62 WORKING_SET:	.BLKL	1		; SPACE TO RECEIVE WORKING SET SIZE
                           00000046  0004    63 SET_SIZE::	.LONG	70		; SIZE TO ADJUST WORKING SET TO
                           00000010  0008    64 LAST_PAGE:	.BLKL	2		; SPACE TO RECEIVE LAST PAGE POINTERS
                                     0010    65 
                                     0010    66 ;
                                     0010    67 ; DESCRIPTORS TO LOCK DOWN THE CODE AND DATA AREAS THAT ARE TO BE LOCKED INTO
                                     0010    68 ; THE WORKING SET
                                     0010    69 ;
                                 00000000    70 	.PSECT	$CODE$,NOWRT,LONG
                                     0000    71 
                  FFFFFFFF'00000000' 0000    72 LOCKED_CODE:	.LONG	LCODE_START,LCODE_END-1
                  FFFFFFFF'00000000' 0008    73 LOCKED_DATA:	.LONG	LDATA_START,LDATA_END-1
LOCKDN          - LOCK FCP INTO REAL MEMORY                      21-AUG-1978 23:06:54   VAX-11 MACRO X0.3-11               Page   3
B0004                                                                                                                            (2)

                                     0010    75 ;++
                                     0010    76 ;
                                     0010    77 ; FUNCTIONAL DESCRIPTION:
                                     0010    78 ;
                                     0010    79 ;	THIS ROUTINE TOUCHES ALL OF THE PAGES IN FCP TO BRING THEM
                                     0010    80 ;	INTO REAL MEMORY.
                                     0010    81 ;
                                     0010    82 ; CALLING SEQUENCE:
                                     0010    83 ;	CALL LOCKDOWN ()
                                     0010    84 ;	NONE
                                     0010    85 ;
                                     0010    86 ; INPUT PARAMETERS:
                                     0010    87 ;	NONE
                                     0010    88 ;
                                     0010    89 ; IMPLICIT INPUTS:
                                     0010    90 ;	NONE
                                     0010    91 ;
                                     0010    92 ; OUTPUT PARAMETERS:
                                     0010    93 ;	NONE
                                     0010    94 ;
                                     0010    95 ; IMPLICIT OUTPUTS:
                                     0010    96 ;	NONE
                                     0010    97 ;
                                     0010    98 ; ROUTINE VALUE:
                                     0010    99 ;	NONE
                                     0010   100 ;
                                     0010   101 ; SIDE EFFECTS:
                                     0010   102 ;	ALL OF FCP RESIDING IN REAL MEMORY
                                     0010   103 ;
                                     0010   104 ;--
                                     0010   105 
                                     0010   106 LOCKDOWN::
                               0000  0010   107 	.WORD	^M<>
                                     0012   108 ;
                                     0012   109 ; ADJUST THE WORKING SET SIZE TO A SUITABLE VALUE
                                     0012   110 ;
                                     0012   111 	$ADJWSL_S  #0,W^WORKING_SET	; READ CURRENT SIZE
       0004'CF       0000'CF     C3  001F   112 	SUBL3	   W^WORKING_SET,W^SET_SIZE,R0 ; COMPUTE INCREMENT
                          50         0026       
                                     0027   113 	$ADJWSL_S  R0,W^WORKING_SET	; AND SET TO DESIRED SIZE
                                     0034   114 ;
                                     0034   115 ; LOCK INTO THE WORKING SET THE CODE AND DATA AREAS THAT SHOULD BE.
                                     0034   116 ;
                                     0034   117 	$LKWSET_S  LOCKED_CODE
                                     0042   118 	$LKWSET_S  LOCKED_DATA
                                     0050   119 ;
                                     0050   120 ; EXPAND THE PROGRAM REGION BY ONE PAGE TO GET THE ADDRESS OF THE TOP.
                                     0050   121 ; THIS PAGE WILL NEVER BE TOUCHED AND WILL THEREFORE REMAIN DEMAND ZERO.
                                     0050   122 ;
                                     0050   123 	$EXPREG_S  #1,LAST_PAGE,REGION=#0
                                     0063   124 ;
                                     0063   125 ; NOW TOUCH ALL PAGES UP TO THE ONE CREATED.
                                     0063   126 ;
            50   00000200 9F     9E  0063   127 	MOVAB	@#^X200,R0	; START WITH PAGE 1
                          60     D5  006A   128 10$:	TSTL	(R0)		; TOUCH IT
   00000200 8F   00000008'EF     F1  006C   129 	ACBL	LAST_PAGE,#^X200,R0,10$  ; NEXT PAGE AND LOOP
            FFF0          50         0077       
LOCKDN          - LOCK FCP INTO REAL MEMORY                      21-AUG-1978 23:06:54   VAX-11 MACRO X0.3-11               Page   4
B0004                                                                                                                            (2)

                                 04  007A   130 	RET
                                     007B   131 
                                     007B   132 
                                     007B   133 
                                     007B   134 	.END
LOCKDN          - LOCK FCP INTO REAL MEMORY                      21-AUG-1978 23:06:54   VAX-11 MACRO X0.3-11               Page   5
SYMBOL TABLE                                                                                                                     (2)

LAST_PAGE        00000008 R     06   
LCODE_END        00000000 R     03   
LCODE_START      00000000 R     02   
LDATA_END        00000000 R     05   
LDATA_START      00000000 R     04   
LOCKDOWN         00000010 RG    07   
LOCKED_CODE      00000000 R     07   
LOCKED_DATA      00000008 R     07   
SET_SIZE         00000004 RG    06   
SYS$ADJWSL       ********   X   07   
SYS$EXPREG       ********   X   07   
SYS$LKWSET       ********   X   07   
WORKING_SET      00000000 R     06   


PROGRAM SECTION SYNOPSIS

.  ABS  .        00000000      00     NOPIC   USR   CON   ABS   LCL NOSHR NOEXE NORD  NOWRT BYTE  
. BLANK .        00000000      01     NOPIC   USR   CON   REL   LCL NOSHR   EXE   RD    WRT BYTE  
$LOCKEDC0$       00000000      02     NOPIC   USR   CON   REL   LCL NOSHR   EXE   RD  NOWRT PAGE  
$LOCKEDC9$       00000000      03     NOPIC   USR   CON   REL   LCL NOSHR   EXE   RD  NOWRT LONG  
$LOCKEDD0$       00000000      04     NOPIC   USR   CON   REL   LCL NOSHR NOEXE   RD    WRT LONG  
$LOCKEDD9$       00000000      05     NOPIC   USR   CON   REL   LCL NOSHR NOEXE   RD    WRT LONG  
$LOCKEDD1$       00000010      06     NOPIC   USR   CON   REL   LCL NOSHR NOEXE   RD    WRT LONG  
$CODE$           0000007B      07     NOPIC   USR   CON   REL   LCL NOSHR   EXE   RD  NOWRT LONG  


THERE WERE NO ERRORS OR WARNINGS.
27580. BYTES LEFT IN FREE MEMORY POOL.
OBJ$:LOCKDN,LIS$:LOCKDN/-SP=SRC$:LOCKDN
2 MLB DIR RDS - 25 GETS TO DEFINE 4 MACROS. 2 INTER. FILE WRITES. 
