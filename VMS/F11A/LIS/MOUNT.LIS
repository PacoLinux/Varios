
; Bliss-32 10.1-416	Monday 21-AUG-1978 23:01:12	DBB3:[F11A.SRC]MOUNT.B32;4					Page 1
;
;	0001	MODULE MOUNT (
;	0002			LANGUAGE (BLISS32),
;	0003			IDENT = 'A0001'
;	0004			) =
;	0005	BEGIN
;	0006	
;	0007	!
;	0008	! Copyright (c) 1977
;	0009	! Digital Equipment Corporation, Maynard, Massachusetts 01754
;	0010	!
;	0011	! This software is furnished  under a license for use only on a single
;	0012	! computer  system and  may be  copied only with  the inclusion of the
;	0013	! above copyright notice.  This software, or any other copies thereof,
;	0014	! may not be provided or  otherwise made available to any other person
;	0015	! except for use on such system and to one who agrees to these license
;	0016	! terms.  Title to and  ownership of the  software  shall at all times
;	0017	! remain in DEC.
;	0018	!
;	0019	! The information in this software is subject to change without notice
;	0020	! and should  not be construed  as a commitment  by Digital  Equipment
;	0021	! Corporation.
;	0022	!
;	0023	! DEC assumes  no  responsibility  for  the use or  reliability of its
;	0024	! software on equipment which is not supplied by DEC.
;	0025	
;	0026	!++
;	0027	!
;	0028	! FACILITY:  F11ACP Structure Level 1
;	0029	!
;	0030	! ABSTRACT:
;	0031	!
;	0032	!	This routine performs the MOUNT function.
;	0033	!
;	0034	! ENVIRONMENT:
;	0035	!
;	0036	!	STARLET operating system, including privileged system services
;	0037	!	and internal exec routines.
;	0038	!
;	0039	!--
;	0040	!
;	0041	!
;	0042	! AUTHOR:  Andrew C. Goldstein,	 CREATION DATE:  10-May-1978  14:12
;	0043	!
;	0044	! REVISION HISTORY:
;	0045	!
;	0046	!**
;	0047	
;	0048	
;	0049	LIBRARY 'SYS$LIBRARY:LIB.L32';
;	0050	REQUIRE 'SRC$:FCPDEF.B32';
;	0369	
;	0370	
;	0371	FORWARD ROUTINE
;	0372		MOUNT,				! main MOUNT routine
;	0373		SET_MOUNTED;			! set mounted bit in UCB

; Bliss-32 10.1-416	Monday 21-AUG-1978 23:01:12	DBB3:[F11A.SRC]MOUNT.B32;4					Page 1-1
;

; Bliss-32 10.1-416	Monday 21-AUG-1978 23:01:12	DBB3:[F11A.SRC]MOUNT.B32;4					Page 2
;
;	0374	GLOBAL ROUTINE MOUNT =
;	0375	
;	0376	!++
;	0377	!
;	0378	! FUNCTIONAL DESCRIPTION:
;	0379	!
;	0380	!	This routine performs the MOUNT function. It checks that the ACP
;	0381	!	is of the correct type and then turns on the mounted bits in the UCB.
;	0382	!
;	0383	!
;	0384	! CALLING SEQUENCE:
;	0385	!	MOUNT ()
;	0386	!
;	0387	! INPUT PARAMETERS:
;	0388	!	NONE
;	0389	!
;	0390	! IMPLICIT INPUTS:
;	0391	!	NONE
;	0392	!
;	0393	! OUTPUT PARAMETERS:
;	0394	!	NONE
;	0395	!
;	0396	! IMPLICIT OUTPUTS:
;	0397	!	NONE
;	0398	!
;	0399	! ROUTINE VALUE:
;	0400	!	NONE
;	0401	!
;	0402	! SIDE EFFECTS:
;	0403	!	volume enabled for I/O
;	0404	!
;	0405	!--
;	0406	
;	0407	BEGIN
;	0408	
;	0409	EXTERNAL
;	0410		QUEUE_HEAD	: REF BBLOCK;	! ACP queue header
;	0411	
;	0412	
;	0413	! Check the ACP type code in the AQB, having been set by the MOUNT command
;	0414	! to indicate the nature of the device.
;	0415	!
;	0416	
;	0417	IF .QUEUE_HEAD[AQB$B_ACPTYPE] NEQ AQB$K_F11V1
;	0418	THEN ERR_EXIT (SS$_WRONGACP);
;	0419	
;	0420	KERNEL_CALL (SET_MOUNTED);
;	0421	
;	0422	RETURN 1;
;	0423	
;	0424	END;					! end of routine MOUNT


							    .TITLE  MOUNT
							    .IDENT  \A0001\

; Bliss-32 10.1-416	Monday 21-AUG-1978 23:01:12	DBB3:[F11A.SRC]MOUNT.B32;4					Page 2-1
;

							    .EXTRN  QUEUE_HEAD, SYS$CMKRNL

							    .PSECT  $CODE$,NOWRT,2

					 0000 00000 	    .ENTRY  MOUNT, Save nothing					      ; 0374
		         50 	0000G  CF  D0 00002 	    MOVL    QUEUE_HEAD, R0					      ; 0417
		         01 	  15   A0  91 00007 	    CMPB    21(R0), #1						      ;
				       04  13 0000B 	    BEQL    1$							      ;
				031C   8F  BF 0000D 	    CHMU    #796						      ; 0418
				       7E  D4 00011 1$:     CLRL    -(SP)						      ; 0420
				       5E  DD 00013 	    PUSHL   SP							      ;
				0000V  CF  9F 00015 	    PUSHAB  SET_MOUNTED						      ;
	      00000000G  9F	       03  FB 00019 	    CALLS   #3, @#SYS$CMKRNL					      ;
		         50 	       01  D0 00020 	    MOVL    #1, R0						      ; 0422
					   04 00023 	    RET     							      ; 0374

; Routine Size:  36 bytes



; Bliss-32 10.1-416	Monday 21-AUG-1978 23:01:12	DBB3:[F11A.SRC]MOUNT.B32;4					Page 3
;
;	0425	ROUTINE SET_MOUNTED =
;	0426	
;	0427	!++
;	0428	!
;	0429	! FUNCTIONAL DESCRIPTION:
;	0430	!
;	0431	
;	0432	!	This routine sets the mounted bit in the UCB.
;	0433	!
;	0434	!
;	0435	! CALLING SEQUENCE:
;	0436	!
;	0437	! INPUT PARAMETERS:
;	0438	!	NONE
;	0439	!
;	0440	! IMPLICIT INPUTS:
;	0441	!	CURRENT_UCB: address of device UCB
;	0442	!
;	0443	! OUTPUT PARAMETERS:
;	0444	!	NONE
;	0445	!
;	0446	! IMPLICIT OUTPUTS:
;	0447	!	NONE
;	0448	!
;	0449	! ROUTINE VALUE:
;	0450	!	1
;	0451	!
;	0452	! SIDE EFFECTS:
;	0453	!	mounted bit set
;	0454	!
;	0455	!--
;	0456	
;	0457	BEGIN
;	0458	
;	0459	EXTERNAL
;	0460		CURRENT_UCB	: REF BBLOCK;	! UCB of device
;	0461	
;	0462	
;	0463	! Set the bits in the UCB.
;	0464	!
;	0465	
;	0466	CURRENT_UCB[UCB$L_DEVCHAR] = .CURRENT_UCB[UCB$L_DEVCHAR] OR
;	0467		(DEV$M_MNT OR DEV$M_DIR);
;	0468	
;	0469	RETURN 1;
;	0470	
;	0471	END;					! end of routine SET_MOUNTED



							    .EXTRN  CURRENT_UCB

					 0000 00024 SET_MOUNTED:
							    .WORD   Save nothing					      ; 0425
		         50 	0000G  CF  D0 00026 	    MOVL    CURRENT_UCB, R0					      ; 0466

; Bliss-32 10.1-416	Monday 21-AUG-1978 23:01:12	DBB3:[F11A.SRC]MOUNT.B32;4					Page 3-1
;
		    34   A0 00080008   8F  C8 0002B 	    BISL2   #524296, 52(R0)					      ;
		         50 	       01  D0 00033 	    MOVL    #1, R0						      ; 0469
					   04 00036 	    RET     							      ; 0425

; Routine Size:  19 bytes


;	0472	
;	0473	END
;	0474	ELUDOM






;				       PSECT SUMMARY
;
;	Name		 Bytes			       Attributes
;
;  $CODE$         	    55  NOWRT,  RD ,  EXE,NOSHR,  LCL,  REL,  CON,NOPIC,ALIGN(2)




;				LIBRARY STATISTICS
;
;					     -------- Symbols --------    Blocks
;	File				     Total    Loaded   Percent      Read
;
;  DBA4:[SYSLIB]LIB.L32;1		      5582         7         0       226





; Size:		55 code + 0 data bytes
; Run Time:	00:03.8
; Elapsed Time:	00:10.6
; Memory Used:	245 pages
; Compilation Complete
