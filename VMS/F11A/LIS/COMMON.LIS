
; Bliss-32 10.1-416	Monday 21-AUG-1978 22:51:10	DBB3:[F11A.SRC]COMMON.B32;8					Page 1
;
;	0001	MODULE COMMON (
;	0002			LANGUAGE (BLISS32),
;	0003			IDENT = 'A0012'
;	0004			) =
;	0005	BEGIN
;	0006	
;	0007	!
;	0008	! Copyright (c) 1977
;	0009	! Digital Equipment Corporation, Maynard, Massachusetts 01754
;	0010	!
;	0011	! This software is furnished  under a license for use only on a single
;	0012	! computer  system and  may be  copied only with  the inclusion of the
;	0013	! above copyright notice.  This software, or any other copies thereof,
;	0014	! may not be provided or  otherwise made available to any other person
;	0015	! except for use on such system and to one who agrees to these license
;	0016	! terms.  Title to and  ownership of the  software  shall at all times
;	0017	! remain in DEC.
;	0018	!
;	0019	! The information in this software is subject to change without notice
;	0020	! and should  not be construed  as a commitment  by Digital  Equipment
;	0021	! Corporation.
;	0022	!
;	0023	! DEC assumes  no  responsibility  for  the use or  reliability of its
;	0024	! software on equipment which is not supplied by DEC.
;	0025	
;	0026	!++
;	0027	!
;	0028	! FACILITY:  F11ACP Structure Level 1
;	0029	!
;	0030	! ABSTRACT:
;	0031	!
;	0032	!	This module is the common impure area of FCP, including the
;	0033	!	routine that initializes it for each request.
;	0034	!
;	0035	! ENVIRONMENT:
;	0036	!
;	0037	!	STARLET operating system, including privileged system services
;	0038	!	and internal exec routines.
;	0039	!
;	0040	!--
;	0041	!
;	0042	!
;	0043	! AUTHOR:  Andrew C. Goldstein,	 CREATION DATE:  20-Dec-1976  23:42
;	0044	!
;	0045	! REVISION HISTORY:
;	0046	!
;	0047	!   Andrew C. Goldstein, 24-Feb-1977  16:29
;	0048	!   X0002 - Add context for extend cleanup
;	0049	!
;	0050	!   Andrew C. Goldstein, 29-Mar-1977  11:01
;	0051	!   X0003 - Add highest version cell
;	0052	!
;	0053	!   Andrew C. Goldstein, 7-Apr-1977  13:19
;	0054	!   X0004 - Add storage for both FIBs and pointer
;	0055	!

; Bliss-32 10.1-416	Monday 21-AUG-1978 22:51:10	DBB3:[F11A.SRC]COMMON.B32;8					Page 1-1
;
;	0056	!   Andrew C. Goldstein, 13-Apr-1977  17:06
;	0057	!   X0005 - Add context save area for secondary operations
;	0058	!
;	0059	!   Andrew C. Goldstein, 28-Jun-1977  16:13
;	0060	!   X0006 - Add DIR_VBN and DIR_BUFFER
;	0061	!
;	0062	!   Andrew C. Goldstein, 5-Aug-1977  10:51
;	0063	!   X0007 - Add EXTEND_FID cell
;	0064	!
;	0065	!   Andrew C. Goldstein, 26-Sep-1977  15:29
;	0066	!   X0008 - Add LOWEST_VERSION cell
;	0067	!
;	0068	!   Andrew C. Goldstein, 27-Oct-1977  11:14
;	0069	!   X0009 - Add DISK_UCB longword
;	0070	!
;	0071	!   Andrew C. Goldstein, 12-Dec-1977  13:21
;	0072	!   X0010 - Change EXTEND_FID to NEW_FID
;	0073	!
;	0074	!   Andrew C. Goldstein, 27-Dec-1977  15:55
;	0075	!   X0011 - Add storage map VBN cells
;	0076	!
;	0077	!   Andrew C. Goldstein, 21-Jun-78  17:07
;	0078	!   A0012 - Add storage for superseded file ID
;	0079	!
;	0080	!**
;	0081	
;	0082	
;	0083	LIBRARY 'SYS$LIBRARY:LIB.L32';
;	0084	REQUIRE 'SRC$:FCPDEF.B32';

; Bliss-32 10.1-416	Monday 21-AUG-1978 22:51:10	DBB3:[F11A.SRC]COMMON.B32;8					Page 2
;
;	0403	GLOBAL ROUTINE INIT_COMMON : NOVALUE =
;	0404	
;	0405	!++
;	0406	!
;	0407	! FUNCTIONAL DESCRIPTION:
;	0408	!
;	0409	!	This routine contains the impure data base for FCP, and is called
;	0410	!	to initialize it.
;	0411	!
;	0412	! CALLING SEQUENCE:
;	0413	!	INIT_COMMON ()
;	0414	!
;	0415	! INPUT PARAMETERS:
;	0416	!	NONE
;	0417	!
;	0418	! IMPLICIT INPUTS:
;	0419	!	NONE
;	0420	!
;	0421	! OUTPUT PARAMETERS:
;	0422	!	NONE
;	0423	!
;	0424	! IMPLICIT OUTPUTS:
;	0425	!	NONE
;	0426	!
;	0427	! ROUTINE VALUE:
;	0428	!	NONE
;	0429	!
;	0430	! SIDE EFFECTS:
;	0431	!	DATABASE INITIALIZED
;	0432	!
;	0433	!--
;	0434	
;	0435	BEGIN
;	0436	
;	0437	GLOBAL
;	0438		QUEUE_HEAD	: REF BBLOCK,	! pointer to ACP queue header
;	0439		IO_CHANNEL,			! channel number for all I/O
;	0440		DISK_UCB	: REF BBLOCK,	! original UCB of our channel
;	0441	
;	0442	! The remaining locations are initialized to known values (mainly zero)
;	0443	! by the routine.
;	0444	!
;	0445		USER_STATUS	: VECTOR [2],	! I/O status to be returned to user
;	0446		IO_STATUS	: VECTOR [2],	! status block for FCP I/O
;	0447		IO_PACKET	: REF BBLOCK,	! address of current I/O request packet
;	0448		CURRENT_UCB	: REF BBLOCK,	! address of UCB of current request
;	0449		CURRENT_VCB	: REF BBLOCK,	! address of VCB of current request
;	0450		NEW_FID,			! file number of unrecorded file ID
;	0451		HEADER_LBN,			! LBN of last file header read
;	0452		DIR_FCB		: REF BBLOCK,	! FCB of directory file
;	0453		DIR_WINDOW	: REF BBLOCK,	! window of current directory
;	0454		BITMAP_VBN,			! VBN of current storage map block
;	0455		BITMAP_BUFFER	: REF BBLOCK,	! address of current storage map block
;	0456		DIR_VBN,			! VBN of current directory block
;	0457		DIR_BUFFER	: REF BBLOCK,	! address of current directory block

; Bliss-32 10.1-416	Monday 21-AUG-1978 22:51:10	DBB3:[F11A.SRC]COMMON.B32;8					Page 2-1
;
;	0458		DIR_RECORD,			! record number of found directory entry
;	0459		HIGHEST_VERSION,		! highest version number in directory
;	0460		LOWEST_VERSION,			! lowest version number in directory
;	0461		FIRST_FREE,			! record number of first free entry
;	0462		SUPER_FID	: BBLOCK [FID$C_LENGTH], ! file ID of superseded file
;	0463		LOCAL_FIB	: BBLOCK [FIB$C_LENGTH], ! primary FIB of this operation
;	0464		SECOND_FIB	: BBLOCK [FIB$C_LENGTH], ! FIB for secondary file operation
;	0465	
;	0466						! The following locations are the re-enterable
;	0467						! context area and must be saved when an
;	0468						! secondary operation is performed.
;	0469		CONTEXT_START	: VECTOR [0],
;	0470		CLEANUP_FLAGS	: BITVECTOR [32], ! cleanup action flags
;	0471		FILE_HEADER	: REF BBLOCK,	! address of current file header
;	0472		UNREC_LBN,			! start LBN of unrecorded blocks
;	0473		UNREC_COUNT,			! count of unrecorded blocks
;	0474		PRIMARY_FCB	: REF BBLOCK,	! address of primary file FCB
;	0475		CURRENT_WINDOW	: REF BBLOCK,	! address of file window
;	0476		CURRENT_FIB	: REF BBLOCK,	! pointer to FIB currently in use
;	0477		CONTEXT_END	: VECTOR [0];
;	0478	
;	0479	GLOBAL LITERAL
;	0480		CONTEXT_SIZE	= CONTEXT_END - CONTEXT_START; ! byte count of context area
;	0481	
;	0482	GLOBAL
;	0483		CONTEXT_SAVE	: VECTOR [CONTEXT_SIZE, BYTE], ! area to save primary context
;	0484	
;	0485		IMPURE_END	: VECTOR [0];	! end of impure area
;	0486	
;	0487	GLOBAL LITERAL
;	0488		IMPURE_SIZE	= IMPURE_END - USER_STATUS; ! byte count of impure area
;	0489	
;	0490	! Initialization consists of zeroing the impure area and then setting the
;	0491	! user request status to 1 (success).
;	0492	!
;	0493	
;	0494	CH$FILL (0, IMPURE_SIZE, USER_STATUS);
;	0495	USER_STATUS[0] = 1;
;	0496	
;	0497	END;					! end of routine INIT_COMMON


							    .TITLE  COMMON
							    .IDENT  \A0012\

							    .PSECT  $LOCKEDD1$,NOEXE,2

					      00000 QUEUE_HEAD::
							    .BLKB   4
					      00004 IO_CHANNEL::
							    .BLKB   4
					      00008 DISK_UCB::
							    .BLKB   4
					      0000C USER_STATUS::
							    .BLKB   8

; Bliss-32 10.1-416	Monday 21-AUG-1978 22:51:10	DBB3:[F11A.SRC]COMMON.B32;8					Page 2-2
;
					      00014 IO_STATUS::
							    .BLKB   8
					      0001C IO_PACKET::
							    .BLKB   4
					      00020 CURRENT_UCB::
							    .BLKB   4
					      00024 CURRENT_VCB::
							    .BLKB   4
					      00028 NEW_FID::
							    .BLKB   4
					      0002C HEADER_LBN::
							    .BLKB   4
					      00030 DIR_FCB::
							    .BLKB   4
					      00034 DIR_WINDOW::
							    .BLKB   4
					      00038 BITMAP_VBN::
							    .BLKB   4
					      0003C BITMAP_BUFFER::
							    .BLKB   4
					      00040 DIR_VBN::
							    .BLKB   4
					      00044 DIR_BUFFER::
							    .BLKB   4
					      00048 DIR_RECORD::
							    .BLKB   4
					      0004C HIGHEST_VERSION::
							    .BLKB   4
					      00050 LOWEST_VERSION::
							    .BLKB   4
					      00054 FIRST_FREE::
							    .BLKB   4
					      00058 SUPER_FID::
							    .BLKB   6
					      0005E	    .BLKB   2
					      00060 LOCAL_FIB::
							    .BLKB   44
					      0008C SECOND_FIB::
							    .BLKB   44
					      000B8 CONTEXT_START::
							    .BLKB   0
					      000B8 CLEANUP_FLAGS::
							    .BLKB   4
					      000BC FILE_HEADER::
							    .BLKB   4
					      000C0 UNREC_LBN::
							    .BLKB   4
					      000C4 UNREC_COUNT::
							    .BLKB   4
					      000C8 PRIMARY_FCB::
							    .BLKB   4
					      000CC CURRENT_WINDOW::
							    .BLKB   4
					      000D0 CURRENT_FIB::
							    .BLKB   4

; Bliss-32 10.1-416	Monday 21-AUG-1978 22:51:10	DBB3:[F11A.SRC]COMMON.B32;8					Page 2-3
;
					      000D4 CONTEXT_END::
							    .BLKB   0
					      000D4 CONTEXT_SAVE::
							    .BLKB   28
					      000F0 IMPURE_END::
							    .BLKB   0

						    CONTEXT_SIZE==	28
						    IMPURE_SIZE==	228


							    .PSECT  $CODE$,NOWRT,2

					 003C 00000 	    .ENTRY  INIT_COMMON, Save R2,R3,R4,R5			      ; 0403
	   00 	         6E 	       00  2C 00002 	    MOVC5   #0, (SP), #0, #228, USER_STATUS			      ; 0494
		  0000'  CF	00E4   8F     00006									      ;
		  0000'  CF	       01  D0 0000C 	    MOVL    #1, USER_STATUS					      ; 0495
					   04 00011 	    RET     							      ; 0403

; Routine Size:  18 bytes


;	0498	
;	0499	END
;	0500	ELUDOM






;				       PSECT SUMMARY
;
;	Name		 Bytes			       Attributes
;
;  $LOCKEDD1$     	   240    WRT,  RD ,NOEXE,NOSHR,  LCL,  REL,  CON,NOPIC,ALIGN(2)
;  $CODE$         	    18  NOWRT,  RD ,  EXE,NOSHR,  LCL,  REL,  CON,NOPIC,ALIGN(2)
;  .  ABS  .      	     0  NOWRT,NORD ,NOEXE,NOSHR,  LCL,  ABS,  CON,NOPIC,ALIGN(0)




;				LIBRARY STATISTICS
;
;					     -------- Symbols --------    Blocks
;	File				     Total    Loaded   Percent      Read
;
;  DBA4:[SYSLIB]LIB.L32;1		      5582         3         0       224





; Size:		18 code + 240 data bytes
; Run Time:	00:04.0

; Bliss-32 10.1-416	Monday 21-AUG-1978 22:51:10									Page 2-4
;
; Elapsed Time:	00:10.7
; Memory Used:	249 pages
; Compilation Complete
