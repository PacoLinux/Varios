GETACC          - GET ACCESS PRIVILEGE BITS                      21-AUG-1978 22:46:48   VAX-11 MACRO X0.3-11               Page   1
X0004                                                                                                                            (1)

                                     0000     1 	.TITLE	GETACC - GET ACCESS PRIVILEGE BITS
                                     0000     2 	.IDENT	"X0004"
                                     0000     3 
                                     0000     4 ;
                                     0000     5 ; COPYRIGHT (C) 1976
                                     0000     6 ; DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASSACHUSETTS 01754
                                     0000     7 ;
                                     0000     8 ; THIS SOFTWARE IS FURNISHED  UNDER A LICENSE FOR USE ONLY ON A SINGLE
                                     0000     9 ; COMPUTER  SYSTEM AND  MAY BE  COPIED ONLY WITH  THE INCLUSION OF THE
                                     0000    10 ; ABOVE COPYRIGHT NOTICE.  THIS SOFTWARE, OR ANY OTHER COPIES THEREOF,
                                     0000    11 ; MAY NOT BE PROVIDED OR  OTHERWISE MADE AVAILABLE TO ANY OTHER PERSON
                                     0000    12 ; EXCEPT FOR USE ON SUCH SYSTEM AND TO ONE WHO AGREES TO THESE LICENSE
                                     0000    13 ; TERMS.  TITLE TO AND  OWNERSHIP OF THE  SOFTWARE  SHALL AT ALL TIMES
                                     0000    14 ; REMAIN IN DEC.
                                     0000    15 ;
                                     0000    16 ; THE INFORMATION IN THIS SOFTWARE IS SUBJECT TO CHANGE WITHOUT NOTICE
                                     0000    17 ; AND SHOULD  NOT BE CONSTRUED  AS A COMMITMENT  BY DIGITAL  EQUIPMENT
                                     0000    18 ; CORPORATION.
                                     0000    19 ;
                                     0000    20 ; DEC ASSUMES  NO  RESPONSIBILITY  FOR  THE USE OR  RELIABILITY OF ITS
                                     0000    21 ; SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DEC.
                                     0000    22 
                                     0000    23 ;++
                                     0000    24 ;
                                     0000    25 ; FACILITY:  F11ACP STRUCTURE LEVEL 1
                                     0000    26 ;
                                     0000    27 ; ABSTRACT:
                                     0000    28 ;
                                     0000    29 ;	THIS ROUTINE OBTAINS THE FILE OR VOLUME ACCESS BITS TO WHICH THE
                                     0000    30 ;	INDICATED PROCESS IS ELIGIBLE.
                                     0000    31 ;
                                     0000    32 ; ENVIRONMENT:
                                     0000    33 ;
                                     0000    34 ;	STARLET OPERATING SYSTEM, INCLUDING PRIVILEGED SYSTEM SERVICES
                                     0000    35 ;	AND INTERNAL EXEC ROUTINE.
                                     0000    36 ;
                                     0000    37 ; AUTHOR:  ANDREW C. GOLDSTEIN, CREATION DATE:  4-MAY-1977  11:44
                                     0000    38 ;
                                     0000    39 ; REVISION HISTORY:
                                     0000    40 ;
                                     0000    41 ;   Andrew C. Goldstein, 26-APR-78  17:34
                                     0000    42 ;   X0003 - ADD SYSTEM PRIVILEGE IF CALLER HAS LOGICAL I/O PRIVILEGE
                                     0000    43 ;
                                     0000    44 ;   Andrew C. Goldstein, 12-Jun-78  21:01
                                     0000    45 ;   X0004 - PCB VECTOR NAME CHANGE
                                     0000    46 ;
                                     0000    47 ;**
                                     0000    48 
                                     0000    49 ;
                                     0000    50 ; EQUATED SYMBOLS
                                     0000    51 ;
                           00000004  0000    52 OWNER_UIC	= 4			; OBJECT OWNER UIC
                           00000008  0000    53 PROTECTION	= 8			; OBJECT PROTECTION MASK
                                     0000    54 
                                     0000    55 	$IRPDEF				; DEFINE I/O PACKET OFFSETS
GETACC          - GET ACCESS PRIVILEGE BITS                      21-AUG-1978 22:46:48   VAX-11 MACRO X0.3-11               Page   2
X0004                                                                                                                            (2)

                                     0000    57 ;++
                                     0000    58 ;
                                     0000    59 ; FUNCTIONAL DESCRIPTION:
                                     0000    60 ;
                                     0000    61 ;	THIS ROUTINE OBTAINS THE FILE OR VOLUME ACCESS BITS TO WHICH THE
                                     0000    62 ;	INDICATED PROCESS IS ELIGIBLE.
                                     0000    63 ;
                                     0000    64 ; CALLING SEQUENCE:
                                     0000    65 ;	CALL GET_ACCESS (ARG1, ARG2)
                                     0000    66 ;
                                     0000    67 ; INPUT PARAMETERS:
                                     0000    68 ;	ARG1: OWNER UIC OF OBJECT
                                     0000    69 ;	ARG2: PROTECTION MASK OF OBJECT
                                     0000    70 ;
                                     0000    71 ; IMPLICIT INPUTS:
                                     0000    72 ;	IO_PACKET: ADDRESS OF CALLER'S I/O PACKET
                                     0000    73 ;
                                     0000    74 ; OUTPUT PARAMETERS:
                                     0000    75 ;	NONE
                                     0000    76 ;
                                     0000    77 ; IMPLICIT OUTPUTS:
                                     0000    78 ;	NONE
                                     0000    79 ;
                                     0000    80 ; ROUTINE VALUE:
                                     0000    81 ;	ACCESS BITS (IN RWED FORM, RIGHT TO LEFT, SET TO ALLOW)
                                     0000    82 ;
                                     0000    83 ; SIDE EFFECTS:
                                     0000    84 ;	NONE
                                     0000    85 ;
                                     0000    86 ;--
                                     0000    87 
                                 00000000    88 	.PSECT	$CODE$,NOWRT
                                     0000    89 
                                     0000    90 GET_ACCESS::
                               007C  0000    91 	.WORD	^M<R2,R3,R4,R5,R6>	; SAVE REGISTERS
            51         08 AC     D0  0002    92 	MOVL	PROTECTION(AP),R1	; GET OBJECT PROTECTION
            52         04 AC     D0  0006    93 	MOVL	OWNER_UIC(AP),R2	; GET OWNER UIC
            56       0000'CF     D0  000A    94 	MOVL	W^IO_PACKET,R6		; GET I/O PACKET ADDRESS
            54         0C A6     3C  000F    95 	MOVZWL	IRP$L_PID(R6),R4	; GET ACCESSOR PID
            54   00000000'FF44   D0  0013    96 	MOVL	@SCH$GL_PCBVEC[R4],R4	; GET ACCESSOR PCB
                 00000000'9F     16  001B    97 	JSB	@#EXE$GETACCESS		; GET ACCESS BITS
                                     0021    98 
         2A A6            09     E1  0021    99 	BBC	#IRP$V_PRIVIO,IRP$W_STS(R6),10$ ; BRANCH IF CALLER NOT PRIVILEGED
                          12         0025       
                          50     DD  0026   100 	PUSHL	R0			; SAVE REGULAR PRIVILEGE BITS
            54   00000000'9F     D0  0028   101 	MOVL	@#SCH$GL_CURPCB,R4	; GET OWN PCB (WE RUN UNDER [1,3]!!)
                 00000000'9F     16  002F   102 	JSB	@#EXE$GETACCESS		; AND GET SYSTEM PRIVILEGES ON OBJECT
            50            8E     C8  0035   103 	BISL	(SP)+,R0		; MERGE WITH NORMAL PRIVILEGES
                                     0038   104 
            50            08     78  0038   105 10$:	ASHL	#8,R0,R1		; SHIFT UP A COPY
                          51         003B       
            50            51     C8  003C   106 	BISL	R1,R0			; AND OR HIGH AND LOW BYTES TOGETHER
            50            04     78  003F   107 	ASHL	#4,R0,R1		; SHIFT UP AGAIN
                          51         0042       
            50            51     C8  0043   108 	BISL	R1,R0			; OR ADJACENT FIELDS
            04            0C     EF  0046   109 	EXTZV	#12,#4,R0,R0		; EXTRACT THE COMPOSITE ACCESS BITS
            50            50         0049       
GETACC          - GET ACCESS PRIVILEGE BITS                      21-AUG-1978 22:46:48   VAX-11 MACRO X0.3-11               Page   3
X0004                                                                                                                            (2)

                                 04  004B   110 	RET				; AND RETURN THEM
                                     004C   111 
                                     004C   112 
                                     004C   113 
                                     004C   114 	.END
GETACC          - GET ACCESS PRIVILEGE BITS                      21-AUG-1978 22:46:48   VAX-11 MACRO X0.3-11               Page   4
SYMBOL TABLE                                                                                                                     (2)

AQB_TYPE       = 00000005            IRP$V_MODE     = 00000000            
BIT...         = 0000000B            IRP$V_PAGIO    = 00000002            
BITMAP_TYPE    = 00000001            IRP$V_PHYSIO   = 00000008            
DIRECTORY_TYPE = 00000002            IRP$V_PRIVIO   = 00000009            
EXE$GETACCESS    ********   X   03   IRP$V_SWAPIO   = 00000006            
FCB_TYPE       = 00000000            IRP$V_VIRTUAL  = 00000004            
GBL...         = 00000000            IRP$W_ABCNT      0000003C            
GET_ACCESS       00000000 RG    03   IRP$W_BCNT       00000032            
HEADER_TYPE    = 00000000            IRP$W_BOFF       00000030            
INDEX_TYPE     = 00000003            IRP$W_CHAN       00000028            
IO_PACKET        ********   X   03   IRP$W_FUNC       00000020            
IRP$B_CARCON     00000038            IRP$W_OBCNT      0000003E            
IRP$B_EFN        00000022            IRP$W_SIZE       00000008            
IRP$B_PRI        00000023            IRP$W_STS        0000002A            
IRP$B_RMOD       0000000B            IRP$W_TT_PRMPT   0000003C            
IRP$B_TYPE       0000000A            MVL_TYPE       = 00000004            
IRP$C_LENGTH     0000004C            OWNER_UIC      = 00000004            
IRP$K_LENGTH     0000004C            PROTECTION     = 00000008            
IRP$L_AST        00000010            RVT_TYPE       = 00000003            
IRP$L_ASTPRM     00000014            SCH$GL_CURPCB    ********   X   03   
IRP$L_DIAGBUF    00000044            SCH$GL_PCBVEC    ********   X   03   
IRP$L_IOQBL      00000004            VCB_TYPE       = 00000002            
IRP$L_IOQFL      00000000            WCB_TYPE       = 00000001            
IRP$L_IOSB       00000024            
IRP$L_IOST1      00000034            
IRP$L_IOST2      00000038            
IRP$L_MEDIA      00000034            
IRP$L_PID        0000000C            
IRP$L_SEGVBN     00000040            
IRP$L_SEQNUM     00000048            
IRP$L_SVAPTE     0000002C            
IRP$L_TT_TERM    00000038            
IRP$L_UCB        0000001C            
IRP$L_WIND       00000018            
IRP$M_BUFIO    = 00000001            
IRP$M_CHAINED  = 00000020            
IRP$M_COMPLX   = 00000008            
IRP$M_DIAGBUF  = 00000080            
IRP$M_FUNC     = 00000002            
IRP$M_MBXIO    = 00000400            
IRP$M_PAGIO    = 00000004            
IRP$M_PHYSIO   = 00000100            
IRP$M_PRIVIO   = 00000200            
IRP$M_SWAPIO   = 00000040            
IRP$M_VIRTUAL  = 00000010            
IRP$Q_NT_PRVMSK  0000003C            
IRP$S_FCODE    = 00000006            
IRP$S_FMOD     = 0000000A            
IRP$S_MODE     = 00000002            
IRP$V_BUFIO    = 00000000            
IRP$V_CHAINED  = 00000005            
IRP$V_COMPLX   = 00000003            
IRP$V_DIAGBUF  = 00000007            
IRP$V_FCODE    = 00000000            
IRP$V_FMOD     = 00000006            
IRP$V_FUNC     = 00000001            
IRP$V_MBXIO    = 0000000A            
GETACC          - GET ACCESS PRIVILEGE BITS                      21-AUG-1978 22:46:48   VAX-11 MACRO X0.3-11               Page   5
PROGRAM SECTION SYNOPSIS                                                                                                         (2)



PROGRAM SECTION SYNOPSIS

.  ABS  .        00000000      00     NOPIC   USR   CON   ABS   LCL NOSHR NOEXE NORD  NOWRT BYTE  
. BLANK .        00000000      01     NOPIC   USR   CON   REL   LCL NOSHR   EXE   RD    WRT BYTE  
$ABS$            0000004C      02     NOPIC   USR   CON   ABS   LCL NOSHR   EXE   RD    WRT BYTE  
$CODE$           0000004C      03     NOPIC   USR   CON   REL   LCL NOSHR   EXE   RD  NOWRT BYTE  


THERE WERE NO ERRORS OR WARNINGS.
23906. BYTES LEFT IN FREE MEMORY POOL.
1310. BYTES OF RECLAIMED MEMORY.
OBJ$:GETACC,LIS$:GETACC/-SP=EXECML$/ML,SRC$:FCPDEF,GETACC
2 MLB DIR RDS - 156 GETS TO DEFINE 8 MACROS. 8 INTER. FILE WRITES. 
