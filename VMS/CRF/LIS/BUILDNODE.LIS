CRFPREFIX                                                        22-AUG-1978 04:40:40   VAX-11 MACRO X0.3-11               Page   0
TABLE OF CONTENTS   

   (2)      41  DECLARATIONS
   (2)     180  DECLARATIONS
   (3)     205  BUILD_NODE 
BUILDNODE                                                        22-AUG-1978 04:40:40   VAX-11 MACRO X0.3-11               Page   1
X01.00          DECLARATIONS                                                                                                     (1)

                                     0000     1 	.TITLE	BUILDNODE  
                                     0000     2 	.IDENT	/X01.00/
                                     0000     3 
                                     0000     4 ;
                                     0000     5 ; COPYRIGHT (C) 1977
                                     0000     6 ; DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASSACHUSETTS 01754
                                     0000     7 ;
                                     0000     8 ; THIS SOFTWARE IS FURNISHED  UNDER A LICENSE FOR USE ONLY ON A SINGLE
                                     0000     9 ; COMPUTER  SYSTEM AND  MAY BE  COPIED ONLY WITH  THE INCLUSION OF THE
                                     0000    10 ; ABOVE COPYRIGHT NOTICE.  THIS SOFTWARE, OR ANY OTHER COPIES THEREOF,
                                     0000    11 ; MAY NOT BE PROVIDED OR  OTHERWISE MADE AVAILABLE TO ANY OTHER PERSON
                                     0000    12 ; EXCEPT FOR USE ON SUCH SYSTEM AND TO ONE WHO AGREES TO THESE LICENSE
                                     0000    13 ; TERMS.  TITLE TO AND  OWNERSHIP OF THE  SOFTWARE  SHALL AT ALL TIMES
                                     0000    14 ; REMAIN IN DEC.
                                     0000    15 ;
                                     0000    16 ; THE INFORMATION IN THIS SOFTWARE IS SUBJECT TO CHANGE WITHOUT NOTICE
                                     0000    17 ; AND SHOULD  NOT BE CONSTRUED  AS A COMMITMENT  BY DIGITAL  EQUIPMENT
                                     0000    18 ; CORPORATION.
                                     0000    19 ;
                                     0000    20 ; DEC ASSUMES  NO  RESPONSIBILITY  FOR  THE USE OR  RELIABILITY OF ITS
                                     0000    21 ; SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DEC.
                                     0000    22 ;
                                     0000    23 
                                     0000    24 ;++
                                     0000    25 ; FACILITY:  CROSS REFERENCE PROGRAM
                                     0000    26 ;
                                     0000    27 ; ABSTRACT:  THIS ROUTINE BUILDS A NODE OF THE B-TREE USED BY CRF.
                                     0000    28 ;
                                     0000    29 ;
                                     0000    30 ; ENVIRONMENT:  IT IS PART OF A LINKABLE IMAGE.
                                     0000    31 ;
                                     0000    32 ; AUTHOR:  K.D. MORSE, CREATION DATE:  22-APR-77
                                     0000    33 ;
                                     0000    34 ; MODIFIED BY:
                                     0000    35 ;
                                     0000    36 ;	, : VERSION
                                     0000    37 ; 01	- 
                                     0000    38 ;--
BUILDNODE                                                        22-AUG-1978 04:40:40   VAX-11 MACRO X0.3-11               Page   2
X01.00          DECLARATIONS                                                                                                     (2)

                                     0000    40 	.SBTTL	DECLARATIONS
                                     0000    41 ;
                                     0000    42 ; INCLUDE FILES:
                                     0000    43 ;
                                     0000    44 
                                     0000    45 ;
                                     0000    46 ; MACROS:
                                     0000    47 ;
                                     0000    48 
                                     0000    49 	$CRFDEF					; DEFINE CRF GLOBALS
                                     0000    50 
                                     0000    51 ;
                                     0000    52 ; EQUATED SYMBOLS:
                                     0000    53 ;
                                     0000    54 
                                     0000    55 ;
                                     0000    56 ; OWN STORAGE:
                                     0000    57 ;
                                     0000    58 
                                     0000    59 
                                 00000000    60 	.PSECT	CRF$DATA,RD,WRT,NOEXE,NOSHR,PIC
                                     0000    61 
                                     0000    62 DMY$T_SYM:					; DUMMY KEY SYMBOL
FF FF FF FF FF FF FF FF FF FF FF 0F  0000    63 	.BYTE	15,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1
                        FF FF FF FF  000C       
BUILDNODE                                                        22-AUG-1978 04:40:40   VAX-11 MACRO X0.3-11               Page   3
X01.00          BUILD_NODE                                                                                                       (3)

                                     0010    65 	.SBTTL	BUILD_NODE 
                                     0010    66 ;++
                                     0010    67 ; FUNCTIONAL DESCRIPTION:
                                     0010    68 ;
                                     0010    69 ; THIS ROUTINE BUILDS A NEW NODE FOR THE B-TREE AND INITIALIZES IT.
                                     0010    70 ; THE SLOTS ARE ALL LINKED ONTO A FREE LIST.
                                     0010    71 ;
                                     0010    72 ; CALLING SEQUENCE:
                                     0010    73 ;
                                     0010    74 ;	BSBW	BUILD_NODE
                                     0010    75 ;
                                     0010    76 ; INPUT PARAMETERS:
                                     0010    77 ;
                                     0010    78 ;	NONE
                                     0010    79 ;
                                     0010    80 ; IMPLICIT INPUTS:
                                     0010    81 ;
                                     0010    82 ;	R6 - CONTAINS THE OUTPUT FORMAT TABLE ADDR ( TREE LISTHEAD )
                                     0010    83 ;
                                     0010    84 ; OUTPUT PARAMETERS:
                                     0010    85 ;
                                     0010    86 ;	NONE
                                     0010    87 ;
                                     0010    88 ; IMPLICIT OUTPUTS:
                                     0010    89 ;
                                     0010    90 ;	SUCCESS
                                     0010    91 ;		R0 = ADDRESS OF NEW NODE
                                     0010    92 ;	FAILURE
                                     0010    93 ;		R0 = CRF$_BLDNODFAIL - FAILURE TO BUILD NODE (ALLOCATION ERROR)
                                     0010    94 ;
                                     0010    95 ; COMPLETION CODES:
                                     0010    96 ;
                                     0010    97 ;	CRF$_BLDNODFAIL - FAILURE TO BUILD NODE (ALLOCATION ERROR)
                                     0010    98 ;
                                     0010    99 ; SIDE EFFECTS:
                                     0010   100 ;
                                     0010   101 ;	R0 AND R1 ARE WIPED OUT
                                     0010   102 ;
                                     0010   103 ;--
                                     0010   104 
                                     0010   105 
                                     0010   106 
                                 00000000   107 	.PSECT	CRF$CODE,RD,NOWRT,EXE,SHR,PIC
                                     0000   108 
                                     0000   109 BUILD_NODE::
                          0C     BB  0000   110 	PUSHR	#^M<R2,R3>			; SAVE REGISTERS
                          51     DD  0002   111 	PUSHL	R1				; SAVE R1
            50         06 A6     3C  0004   112 	MOVZWL	CRF$W_NODSIZE(R6),R0		; GET SIZE TO ALLOCATE
   00000000'EF            00     FB  0008   113 	CALLS	#0,CRF$ALBLK			; ALLOCATE NEW NODE
            09            50     E8  000F   114 	BLBS	R0,10$				; BRANCH ON SUCCESS
            50   00658052 8F     D0  0012   115 	MOVL	#CRF$_BLDNODFAIL,R0		; SET BUILD NODE FAILURE CODE
                          3C     11  0019   116 	BRB	BLD_NOD_EXIT			; ERROR EXIT
                       04 A1     D4  001B   117 10$:	CLRL	DMY$L_LINKUP(R1)		; SET NO LINK UP ADDR
                          61     D4  001E   118 	CLRL	DMY$W_FIRST(R1)			; CLEAR FIRST, LAST PNTRS
         0C A1            0C     9B  0020   119 	MOVZBW	#NOD$K_NUMFREE,DMY$W_NUMFREE(R1) ; SET # FREE SLOTS MINUS FIRST
         0E A1            10     9B  0024   120 	MOVZBW	#NOD$K_1STFREE,DMY$W_1STFREE(R1) ; SET FIRST FREE SLOT OFFSET
         08 A1       0000'CF     9E  0028   121 	MOVAB	W^DMY$T_SYM,KEY$L_KEYADDR(R1)	; SET UP DUMMY KEY ADDRESS
BUILDNODE                                                        22-AUG-1978 04:40:40   VAX-11 MACRO X0.3-11               Page   4
X01.00          BUILD_NODE                                                                                                       (3)

         08 A6         00'8F     91  002E   122 	CMPB	#CRF$K_ASCIC,CRF$B_KEYTYPE(R6)	; ARE THE KEYS ASCIC?
                          03     13  0033   123 	BEQL	15$				; BRANCH ON YES
                       08 A1     D6  0035   124 	INCL	KEY$L_KEYADDR(R1)		; POINT KEY ADDR PAST LENGTH
            51            10     C0  0038   125 15$:	ADDL2	#DMY$K_SIZE,R1			; INCR TO FIRST FREE SLOT
            53            0B     9A  003B   126 	MOVZBL	#NOD$K_NUMFREE-1,R3		; GET NUMBER OF ENTRIES IN NODE
            52            10     9A  003E   127 	MOVZBL	#DMY$K_SIZE,R2			; INITIALIZE OFFSET
            52            28     C0  0041   128 20$:	ADDL2	#KEY$K_SIZE,R2			; INCREMENT OFFSET
            61            52     B0  0044   129 	MOVW	R2,KEY$W_NEXT(R1)		; SET OFFSET OF NEXT SLOT
            51            28     C0  0047   130 	ADDL2	#KEY$K_SIZE,R1			; POINT TO NEXT FREE SLOT
            F4            53     F5  004A   131 	SOBGTR	R3,20$				; REPEAT FOR EACH ENTRY
                          61     B4  004D   132 	CLRW	KEY$W_NEXT(R1)			; SET NO NEXT ENTRY
            51   000001C8 8F     C3  004F   133 	SUBL3	#NOD$K_SIZE-KEY$K_SIZE,R1,R0	; POINT TO NODE
                          50         0056       
                                     0057   134 
                                     0057   135 BLD_NOD_EXIT:
            51            8E     D0  0057   136 	MOVL	(SP)+,R1			; RESTORE R1
                          0C     BA  005A   137 	POPR	#^M<R2,R3>			; RESTORE REGISTERS
                                 05  005C   138 	RSB					; RETURN
                                     005D   139 
                                     005D   140 
                                     005D   141 	.END
BUILDNODE                                                        22-AUG-1978 04:40:40   VAX-11 MACRO X0.3-11               Page   5
SYMBOL TABLE                                                                                                                     (3)

BIT...         = 006580AA            DMY$W_LAST     = 00000002            
BLD_NOD_EXIT     00000057 R     04   DMY$W_NUMFREE  = 0000000C            
BUILD_NODE       00000000 RG    04   FLD$B_MAXLNG   = 00000003            
CRF$ALBLK        ********   X   04   FLD$B_SET_CLR  = 00000002            
CRF$B_FLAGS      00000009            FLD$K_LENGTH   = 0000000C            
CRF$B_IR_DEFIND  00000014            FLD$L_FAODSC   = 00000004            
CRF$B_KEYTYPE    00000008            FLD$W_MASK     = 00000000            
CRF$B_OU_PAG1    0000000C            GBL...         = 00000000            
CRF$B_OU_PRTIND  00000014            HIS$K_ENTRYSIZE= 00000010            
CRF$B_OU_SAVIND  00000018            HIS$K_LISTSIZE = 00000070            
CRF$B_OU_SUCPAG  00000010            HIS$L_FATHER   = FFFFFFF0            
CRF$K_ASCIC      ********   X   04   HIS$L_FATHROFF = FFFFFFF4            
CRF$K_FACILCOD = 00000065            HIS$L_LEFTBRO  = FFFFFFF8            
CRF$L_ERROR      0000000C            HIS$L_LEFTSON  = 00000008            
CRF$L_IK_CTLTBL  00000004            HIS$L_LINKUP   = 00000008            
CRF$L_IK_KEYADR  00000008            HIS$L_LINKUPOFF= 0000000C            
CRF$L_IK_VALADR  0000000C            HIS$L_NODE     = 00000000            
CRF$L_IR_CTLTBL  00000004            HIS$L_NTH      = 0000000C            
CRF$L_IR_KEYADR  00000008            HIS$L_OFFSET   = 00000004            
CRF$L_IR_REFADR  0000000C            HIS$L_RIGHTBRO = FFFFFFFC            
CRF$L_K1FMTBL    00000014            HIS$L_RIGHTSON = 0000000C            
CRF$L_K2FMTBL    00000018            HIS$L_TOP      = 00000004            
CRF$L_OUTPUT     00000010            KEY$B_DEFLNG   = 00000018            
CRF$L_OU_CTLTBL  00000004            KEY$K_DATASIZE = 0000001C            
CRF$L_OU_LINWID  00000008            KEY$K_SIZE     = 00000028            
CRF$L_R1FMTBL    00000024            KEY$L_DATA     = 0000000C            
CRF$L_R2FMTBL    00000028            KEY$L_KEYADDR  = 00000008            
CRF$L_ROOT       00000000            KEY$L_LINKUP   = 00000004            
CRF$L_V1FMTBL    0000001C            KEY$L_REFLIST  = 00000010            
CRF$L_V2FMTBL    00000020            KEY$L_VALADDR  = 0000000C            
CRF$W_ENTSIZE    00000004            KEY$T_DEFNAME  = 00000019            
CRF$W_ERRSTS     0000000A            KEY$W_DEFFLAG  = 00000016            
CRF$W_IK_VALFLG  00000010            KEY$W_NEXT     = 00000000            
CRF$W_IR_REFLAG  00000010            KEY$W_PREV     = 00000002            
CRF$W_NODSIZE    00000006            KEY$W_VALFLAG  = 00000014            
CRF$_BLDNODFAIL= 00658052            NOD$K_1STFREE  = 00000010            
CRF$_BLKWTHINBL= 00658072            NOD$K_NUMFREE  = 0000000C            
CRF$_EXPREGFAIL= 0065806A            NOD$K_SIZE     = 000001F0            
CRF$_FAILINSRT = 0065807A            REF$B_REFLNG   = 00000006            
CRF$_FAOFAIL   = 0065809A            REF$K_SIZE     = 00000016            
CRF$_FOUNDKEY  = 00658021            REF$L_FLINK    = 00000000            
CRF$_HISTOVRFLO= 00658062            REF$T_REFNAME  = 00000007            
CRF$_ILLBLKSIZE= 00658082            REF$W_REFFLAG  = 00000004            
CRF$_KEY1STENTR= 00658011            
CRF$_KEYPRVENTR= 00658009            
CRF$_KEYTYPE   = 006580A2            
CRF$_LINELNG   = 00658092            
CRF$_NO_OUTRTN = 0065808A            
CRF$_REFLNG    = 0065805A            
CRF$_REFPRVENTR= 00658019            
CRF$_SUCCESS   = 00658001            
DMY$K_SIZE     = 00000010            
DMY$L_KEYADDR  = 00000008            
DMY$L_LINKUP   = 00000004            
DMY$T_SYM        00000000 R     03   
DMY$W_1STFREE  = 0000000E            
DMY$W_FIRST    = 00000000            
BUILDNODE                                                        22-AUG-1978 04:40:40   VAX-11 MACRO X0.3-11               Page   6
PROGRAM SECTION SYNOPSIS                                                                                                         (3)



PROGRAM SECTION SYNOPSIS

.  ABS  .        00000000      00     NOPIC   USR   CON   ABS   LCL NOSHR NOEXE NORD  NOWRT BYTE  
. BLANK .        00000000      01     NOPIC   USR   CON   REL   LCL NOSHR   EXE   RD    WRT BYTE  
$ABS$            0000002C      02     NOPIC   USR   CON   ABS   LCL NOSHR   EXE   RD    WRT BYTE  
CRF$DATA         00000010      03       PIC   USR   CON   REL   LCL NOSHR NOEXE   RD    WRT BYTE  
CRF$CODE         0000005D      04       PIC   USR   CON   REL   LCL   SHR   EXE   RD  NOWRT BYTE  


THERE WERE NO ERRORS OR WARNINGS.
23566. BYTES LEFT IN FREE MEMORY POOL.
1472. BYTES OF RECLAIMED MEMORY.
OBJ$:BUILDNODE,LIS$:BUILDNODE/-SP=LIB$:CRF/ML,SRC$:CRFPREFIX,BUILDNODE
16 MLB DIR RDS - 149 GETS TO DEFINE 8 MACROS. 7 INTER. FILE WRITES. 
