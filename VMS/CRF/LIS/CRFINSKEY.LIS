CRFPREFIX                                                        22-AUG-1978 04:40:18   VAX-11 MACRO X0.3-11               Page   0
TABLE OF CONTENTS   

   (2)      41  DECLARATIONS
   (2)     183  DECLARATIONS
   (3)     206  CRF$INSRTKEY 
CRFINSKEY                                                        22-AUG-1978 04:40:18   VAX-11 MACRO X0.3-11               Page   1
X01.01          DECLARATIONS                                                                                                     (1)

                                     0000     1 	.TITLE	CRFINSKEY 
                                     0000     2 	.IDENT	/X01.01/
                                     0000     3 
                                     0000     4 ;
                                     0000     5 ; COPYRIGHT (C) 1977,1978
                                     0000     6 ; DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASSACHUSETTS 01754
                                     0000     7 ;
                                     0000     8 ; THIS SOFTWARE IS FURNISHED  UNDER A LICENSE FOR USE ONLY ON A SINGLE
                                     0000     9 ; COMPUTER  SYSTEM AND  MAY BE  COPIED ONLY WITH  THE INCLUSION OF THE
                                     0000    10 ; ABOVE COPYRIGHT NOTICE.  THIS SOFTWARE, OR ANY OTHER COPIES THEREOF,
                                     0000    11 ; MAY NOT BE PROVIDED OR  OTHERWISE MADE AVAILABLE TO ANY OTHER PERSON
                                     0000    12 ; EXCEPT FOR USE ON SUCH SYSTEM AND TO ONE WHO AGREES TO THESE LICENSE
                                     0000    13 ; TERMS.  TITLE TO AND  OWNERSHIP OF THE  SOFTWARE  SHALL AT ALL TIMES
                                     0000    14 ; REMAIN IN DEC.
                                     0000    15 ;
                                     0000    16 ; THE INFORMATION IN THIS SOFTWARE IS SUBJECT TO CHANGE WITHOUT NOTICE
                                     0000    17 ; AND SHOULD  NOT BE CONSTRUED  AS A COMMITMENT  BY DIGITAL  EQUIPMENT
                                     0000    18 ; CORPORATION.
                                     0000    19 ;
                                     0000    20 ; DEC ASSUMES  NO  RESPONSIBILITY  FOR  THE USE OR  RELIABILITY OF ITS
                                     0000    21 ; SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DEC.
                                     0000    22 ;
                                     0000    23 
                                     0000    24 ;++
                                     0000    25 ; FACILITY:  CROSS REFERENCE PROGRAM
                                     0000    26 ;
                                     0000    27 ; ABSTRACT:  THIS ROUTINE INSERTS A KEY INTO THE B-TREE, INSERTING
                                     0000    28 ;		THE VALUE ADDRESS AND VALUE FLAGS.
                                     0000    29 ;
                                     0000    30 ;
                                     0000    31 ; ENVIRONMENT:  IT IS PART OF A LINKABLE IMAGE.
                                     0000    32 ;
                                     0000    33 ; AUTHOR:  K.D. MORSE, CREATION DATE:  6-MAY-77
                                     0000    34 ;
                                     0000    35 ; MODIFIED BY:
                                     0000    36 ;
                                     0000    37 ;	K.D. MORSE, 20-JUN-78, X01.01
                                     0000    38 ;	CRF$INSRTKEY IS DECLARED BY .ENTRY TO MAKE CRF A SHARABLE IMAGE.
                                     0000    39 ;
                                     0000    40 ; 01	- 
                                     0000    41 ;--
CRFINSKEY                                                        22-AUG-1978 04:40:18   VAX-11 MACRO X0.3-11               Page   2
X01.01          DECLARATIONS                                                                                                     (2)

                                     0000    43 	.SBTTL	DECLARATIONS
                                     0000    44 ;
                                     0000    45 ; INCLUDE FILES:
                                     0000    46 ;
                                     0000    47 
                                     0000    48 ;
                                     0000    49 ; MACROS:
                                     0000    50 ;
                                     0000    51 
                                     0000    52 	$CRFDEF					; DEFINE CRF GLOBALS
                                     0000    53 
                                     0000    54 ;
                                     0000    55 ; EQUATED SYMBOLS:
                                     0000    56 ;
                                     0000    57 
                                     0000    58 ;
                                     0000    59 ; OWN STORAGE:
                                     0000    60 ;
                                     0000    61 
                                 00000000    62 	.PSECT	CRF$DATA,RD,WRT,NOEXE,NOSHR,PIC
                                     0000    63 
                           00000050  0000    64 CRF$L_TEMPKEY::	.BLKB	2*KEY$K_SIZE		; TEMP STOR FOR INSERTION
CRFINSKEY                                                        22-AUG-1978 04:40:18   VAX-11 MACRO X0.3-11               Page   3
X01.01          CRF$INSRTKEY                                                                                                     (3)

                                     0050    66 	.SBTTL	CRF$INSRTKEY 
                                     0050    67 ;++
                                     0050    68 ; FUNCTIONAL DESCRIPTION:
                                     0050    69 ;
                                     0050    70 ;	THIS ROUTINE INSERTS A KEY INTO THE B-TREE.  IF THE KEY IS NOT
                                     0050    71 ;	ALREADY IN THE B-TREE, THEN THE KEY ADDRESS, THE VALUE ADDRESS,
                                     0050    72 ;	AND THE VALUE FLAGS ARE INSERTED IN THE ENTRY AND THE OTHER
                                     0050    73 ;	INFORMATION IS INITIALIZED.  IF THE KEY IS ALREADY IN THE B-TREE,
                                     0050    74 ;	THEN ONLY THE VALUE ADDRESS AND THE VALUE FLAGS ARE ALTERED.
                                     0050    75 ;	THE REST OF THE ENTRY REMAINS UNTOUCHED.
                                     0050    76 ;
                                     0050    77 ; CALLING SEQUENCE:
                                     0050    78 ;
                                     0050    79 ;	CALLS	#4,CRF$INSRTKEY
                                     0050    80 ;
                                     0050    81 ; INPUT PARAMETERS:
                                     0050    82 ;
                                     0050    83 ;	CRF$L_IK_CTLTBL(AP) - CONTAINS THE ADDRESS OF THE OUTPUT FORMAT TABLE
                                     0050    84 ;	CRF$L_IK_KEYADR(AP) - CONTAINS THE ADDRESS OF THE KEY
                                     0050    85 ;	CRF$L_IK_VALADR(AP) - CONTAINS THE ADDRESS OF THE VALUE
                                     0050    86 ;	CRF$W_IK_VALFLG(AP) - CONTAINS THE VALUE FLAGS
                                     0050    87 ;
                                     0050    88 ; IMPLICIT INPUTS:
                                     0050    89 ;
                                     0050    90 ;	NONE
                                     0050    91 ;
                                     0050    92 ; OUTPUT PARAMETERS:
                                     0050    93 ;
                                     0050    94 ;	NONE
                                     0050    95 ;
                                     0050    96 ; IMPLICIT OUTPUTS:
                                     0050    97 ;
                                     0050    98 ;	SUCCESS:
                                     0050    99 ;		R0 -  HAS LOW BIT SET
                                     0050   100 ;	FAILURE:
                                     0050   101 ;		R0 -  LOW BIT CLEAR
                                     0050   102 ;
                                     0050   103 ; COMPLETION CODES:
                                     0050   104 ;
                                     0050   105 ;			CRF$_KEYPRVENTR - KEY PREVIOUSLY ENTERED IN TABLE
                                     0050   106 ;			CRF$_KEY1STENTR - KEY ENTERED FOR FIRST TIME IN TABLE
                                     0050   107 ;			CRF$_HISTOVRFLO - HISTORY LIST OVERFLOWED
                                     0050   108 ;			CRF$_BLDNODFAIL - FAILURE TO ALLOC SPACE FOR NEW NODE
                                     0050   109 ;
                                     0050   110 ; SIDE EFFECTS:
                                     0050   111 ;
                                     0050   112 ;	R1 - IS WIPED OUT
                                     0050   113 ;
                                     0050   114 ;--
                                     0050   115 
                                     0050   116 
                                     0050   117 
                                 00000000   118 	.PSECT	CRF$CODE,RD,NOWRT,EXE,SHR,PIC
                               0070' 0000   119 	.ENTRY	CRF$INSRTKEY, ^M<R4,R5,R6>
            56         04 AC     D0  0002   120 	MOVL	CRF$L_IK_CTLTBL(AP),R6		; GET OUTPUT FORMAT TBL
            54       0000'CF     9E  0006   121 	MOVAB	W^CRF_HISTORY,R4		; GET THE HISTORY LIST
            55         08 AC     D0  000B   122 	MOVL	CRF$L_IK_KEYADR(AP),R5		; GET KEY ADDRESS
CRFINSKEY                                                        22-AUG-1978 04:40:18   VAX-11 MACRO X0.3-11               Page   4
X01.01          CRF$INSRTKEY                                                                                                     (3)

   00000000'EF            00     FB  000F   123 	CALLS	#0,SRCH_INSRT			; FIND KEY IN B-TREE
            09            50     E8  0016   124 	BLBS	R0,10$				; BRANCH ON SUCCESS
            50   00658062 8F     D0  0019   125 	MOVL	#CRF$_HISTOVRFLO,R0		; REPORT HISTORY LIST OVERFLOW
                          49     11  0020   126 	BRB	ERROR_EXIT			; RETURN
                          51     D5  0022   127 10$:	TSTL	R1				; KEY IN B-TREE?
                          13     13  0024   128 	BEQL	20$				; NO, GO INSERT IT
         0C A1         0C AC     D0  0026   129 	MOVL	CRF$L_IK_VALADR(AP),KEY$L_VALADDR(R1) ; SET NEW VALUE ADDR
         14 A1         10 AC     B0  002B   130 	MOVW	CRF$W_IK_VALFLG(AP),KEY$W_VALFLAG(R1) ; SET NEW VALUE FLAGS
            50   00658009 8F     D0  0030   131 	MOVL	#CRF$_KEYPRVENTR,R0		; SET PREVIOUSLY ENTERED CODE
                          46     11  0037   132 	BRB	INSRT_EXIT			; RETURN
            50            0A     9A  0039   133 20$:	MOVZBL	#KEY$K_SIZE/4,R0		; GET # QUADS IN B-TREE ENTRY
            55       0000'CF     9E  003C   134 	MOVAB	W^CRF$L_TEMPKEY,R5		; GET TEMP KEY STORAGE
            51            55     D0  0041   135 	MOVL	R5,R1				; SET KEY ENTRY ADDR
                          81     7C  0044   136 30$:	CLRQ	(R1)+				; INITIALIZE NEW KEY ENTRY
            FB            50     F5  0046   137 	SOBGTR	R0,30$				; REPEAT FOR WHOLE ENTRY
         08 A5         08 AC     D0  0049   138 	MOVL	CRF$L_IK_KEYADR(AP),KEY$L_KEYADDR(R5) ; STORE KEY ADDR
         0C A5         0C AC     D0  004E   139 	MOVL	CRF$L_IK_VALADR(AP),KEY$L_VALADDR(R5) ; STORE VALUE ADDR
         14 A5         10 AC     B0  0053   140 	MOVW	CRF$W_IK_VALFLG(AP),KEY$W_VALFLAG(R5) ; STORE VALUE FLAGS
   00000000'EF            00     FB  0058   141 	CALLS	#0,INSRT_KEY			; INSERT KEY INTO B-TREE
            09            50     E9  005F   142 	BLBC	R0,ERROR_EXIT			; BRANCH ON FAILURE
            50   00658011 8F     D0  0062   143 	MOVL	#CRF$_KEY1STENTR,R0		; SET 1ST TIME ENTERED CODE
                          14     11  0069   144 	BRB	INSRT_EXIT			; RETURN ON SUCCESS
                                     006B   145 
                                     006B   146 ERROR_EXIT:
            51         65 8F     9A  006B   147 	MOVZBL	#CRF$K_FACILCOD,R1		; GET CRF FACILITY CODE
            10            51     F0  006F   148 	INSV	R1,#16,#8,R0			; SET UP ERROR CODE
            50            08         0072       
            51         0C A6     D0  0074   149 	MOVL	CRF$L_ERROR(R6),R1		; GET ERROR ROUTINE ADDR
                          05     13  0078   150 	BEQL	INSRT_EXIT			; BRANCH ON NO ROUTINE
                          50     DD  007A   151 	PUSHL	R0				; PUSH ERROR CODE
            61            01     FB  007C   152 	CALLS	#1,(R1)				; CALL ERROR ROUTINE
                                     007F   153 
                                     007F   154 INSRT_EXIT:
                                 04  007F   155 	RET					; RETURN
                                     0080   156 	.END
CRFINSKEY                                                        22-AUG-1978 04:40:18   VAX-11 MACRO X0.3-11               Page   5
SYMBOL TABLE                                                                                                                     (3)

BIT...         = 006580AA            ERROR_EXIT       0000006B R     04   
CRF$B_FLAGS      00000009            FLD$B_MAXLNG   = 00000003            
CRF$B_IR_DEFIND  00000014            FLD$B_SET_CLR  = 00000002            
CRF$B_KEYTYPE    00000008            FLD$K_LENGTH   = 0000000C            
CRF$B_OU_PAG1    0000000C            FLD$L_FAODSC   = 00000004            
CRF$B_OU_PRTIND  00000014            FLD$W_MASK     = 00000000            
CRF$B_OU_SAVIND  00000018            GBL...         = 00000000            
CRF$B_OU_SUCPAG  00000010            HIS$K_ENTRYSIZE= 00000010            
CRF$INSRTKEY     00000000 RG    04   HIS$K_LISTSIZE = 00000070            
CRF$K_FACILCOD = 00000065            HIS$L_FATHER   = FFFFFFF0            
CRF$L_ERROR      0000000C            HIS$L_FATHROFF = FFFFFFF4            
CRF$L_IK_CTLTBL  00000004            HIS$L_LEFTBRO  = FFFFFFF8            
CRF$L_IK_KEYADR  00000008            HIS$L_LEFTSON  = 00000008            
CRF$L_IK_VALADR  0000000C            HIS$L_LINKUP   = 00000008            
CRF$L_IR_CTLTBL  00000004            HIS$L_LINKUPOFF= 0000000C            
CRF$L_IR_KEYADR  00000008            HIS$L_NODE     = 00000000            
CRF$L_IR_REFADR  0000000C            HIS$L_NTH      = 0000000C            
CRF$L_K1FMTBL    00000014            HIS$L_OFFSET   = 00000004            
CRF$L_K2FMTBL    00000018            HIS$L_RIGHTBRO = FFFFFFFC            
CRF$L_OUTPUT     00000010            HIS$L_RIGHTSON = 0000000C            
CRF$L_OU_CTLTBL  00000004            HIS$L_TOP      = 00000004            
CRF$L_OU_LINWID  00000008            INSRT_EXIT       0000007F R     04   
CRF$L_R1FMTBL    00000024            INSRT_KEY        ********   X   04   
CRF$L_R2FMTBL    00000028            KEY$B_DEFLNG   = 00000018            
CRF$L_ROOT       00000000            KEY$K_DATASIZE = 0000001C            
CRF$L_TEMPKEY    00000000 RG    03   KEY$K_SIZE     = 00000028            
CRF$L_V1FMTBL    0000001C            KEY$L_DATA     = 0000000C            
CRF$L_V2FMTBL    00000020            KEY$L_KEYADDR  = 00000008            
CRF$W_ENTSIZE    00000004            KEY$L_LINKUP   = 00000004            
CRF$W_ERRSTS     0000000A            KEY$L_REFLIST  = 00000010            
CRF$W_IK_VALFLG  00000010            KEY$L_VALADDR  = 0000000C            
CRF$W_IR_REFLAG  00000010            KEY$T_DEFNAME  = 00000019            
CRF$W_NODSIZE    00000006            KEY$W_DEFFLAG  = 00000016            
CRF$_BLDNODFAIL= 00658052            KEY$W_NEXT     = 00000000            
CRF$_BLKWTHINBL= 00658072            KEY$W_PREV     = 00000002            
CRF$_EXPREGFAIL= 0065806A            KEY$W_VALFLAG  = 00000014            
CRF$_FAILINSRT = 0065807A            NOD$K_1STFREE  = 00000010            
CRF$_FAOFAIL   = 0065809A            NOD$K_NUMFREE  = 0000000C            
CRF$_FOUNDKEY  = 00658021            NOD$K_SIZE     = 000001F0            
CRF$_HISTOVRFLO= 00658062            REF$B_REFLNG   = 00000006            
CRF$_ILLBLKSIZE= 00658082            REF$K_SIZE     = 00000016            
CRF$_KEY1STENTR= 00658011            REF$L_FLINK    = 00000000            
CRF$_KEYPRVENTR= 00658009            REF$T_REFNAME  = 00000007            
CRF$_KEYTYPE   = 006580A2            REF$W_REFFLAG  = 00000004            
CRF$_LINELNG   = 00658092            SRCH_INSRT       ********   X   04   
CRF$_NO_OUTRTN = 0065808A            
CRF$_REFLNG    = 0065805A            
CRF$_REFPRVENTR= 00658019            
CRF$_SUCCESS   = 00658001            
CRF_HISTORY      ********   X   04   
DMY$K_SIZE     = 00000010            
DMY$L_KEYADDR  = 00000008            
DMY$L_LINKUP   = 00000004            
DMY$W_1STFREE  = 0000000E            
DMY$W_FIRST    = 00000000            
DMY$W_LAST     = 00000002            
DMY$W_NUMFREE  = 0000000C            
CRFINSKEY                                                        22-AUG-1978 04:40:18   VAX-11 MACRO X0.3-11               Page   6
PROGRAM SECTION SYNOPSIS                                                                                                         (3)



PROGRAM SECTION SYNOPSIS

.  ABS  .        00000000      00     NOPIC   USR   CON   ABS   LCL NOSHR NOEXE NORD  NOWRT BYTE  
. BLANK .        00000000      01     NOPIC   USR   CON   REL   LCL NOSHR   EXE   RD    WRT BYTE  
$ABS$            0000002C      02     NOPIC   USR   CON   ABS   LCL NOSHR   EXE   RD    WRT BYTE  
CRF$DATA         00000050      03       PIC   USR   CON   REL   LCL NOSHR NOEXE   RD    WRT BYTE  
CRF$CODE         00000080      04       PIC   USR   CON   REL   LCL   SHR   EXE   RD  NOWRT BYTE  


THERE WERE NO ERRORS OR WARNINGS.
23566. BYTES LEFT IN FREE MEMORY POOL.
1428. BYTES OF RECLAIMED MEMORY.
OBJ$:CRFINSKEY,LIS$:CRFINSKEY/-SP=LIB$:CRF/ML,SRC$:CRFPREFIX,CRFINSKEY
16 MLB DIR RDS - 149 GETS TO DEFINE 8 MACROS. 7 INTER. FILE WRITES. 
