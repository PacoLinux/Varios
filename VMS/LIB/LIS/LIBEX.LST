FORMAT	MACRO M1110  22-AUG-78 02:11
TABLE OF CONTENTS

     1-  300	OBJECT LANGUAGE DEFS
FORMAT	MACRO M1110  22-AUG-78 02:11  PAGE 1


    100						.TITLE	FORMAT
    200						.IDENT	/X0300/
    300						.SBTTL	OBJECT LANGUAGE DEFS
FORMAT	MACRO M1110  22-AUG-78 02:11  PAGE 3


      1					; COPYRIGHT (C) 1976, 1977
      2					; DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASS.
      3					;
      4					; THIS SOFTWARE IS FURNISHED UNDER  A LICENSE FOR USE ONLY  ON  A
      5					; SINGLE COMPUTER SYSTEM AND MAY BE  COPIED ONLY WITH  THE INCLU-
      6					; SION OF  THE  ABOVE  COPYRIGHT NOTICE.  THIS SOFTWARE,  OR  ANY
      7					; OTHER COPIES THEREOF, MAY NOT BE  PROVIDED  OR  OTHERWISE  MADE
      8					; AVAILABLE TO ANY OTHER PERSON EXCEPT  FOR  USE  ON  SUCH SYSTEM
      9					; AND TO  ONE WHO AGREES  TO  THESE LICENSE  TERMS.  TITLE TO AND
     10					; OWNERSHIP OF THE SOFTWARE SHALL AT ALL TIMES REMAIN IN DEC.
     11					;
     12					; THE INFORMATION IN THIS SOFTWARE  IS  SUBJECT TO CHANGE WITHOUT
     13					; NOTICE AND SHOULD NOT BE CONSTRUED  AS  A COMMITMENT BY DIGITAL
     14					; EQUIPMENT CORPORATION.
     15					;
     16					; DEC ASSUMES NO RESPONSIBILITY FOR THE USE OR RELIABILITY OF ITS
     17					; SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DEC.
LIBEX	MACRO M1110  22-AUG-78 02:11  PAGE 4


      1						.TITLE	LIBEX
      2						.IDENT	/01/
      3
      4					; COPYRIGHT (C) 1976, 1977
      5					; DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASS.
      6					;
      7					; THIS SOFTWARE IS FURNISHED UNDER  A LICENSE FOR USE ONLY  ON  A
      8					; SINGLE COMPUTER SYSTEM AND MAY BE  COPIED ONLY WITH  THE INCLU-
      9					; SION OF  THE  ABOVE  COPYRIGHT NOTICE.  THIS SOFTWARE,  OR  ANY
     10					; OTHER COPIES THEREOF, MAY NOT BE  PROVIDED  OR  OTHERWISE  MADE
     11					; AVAILABLE TO ANY OTHER PERSON EXCEPT  FOR  USE  ON  SUCH SYSTEM
     12					; AND TO  ONE WHO AGREES  TO  THESE LICENSE  TERMS.  TITLE TO AND
     13					; OWNERSHIP OF THE SOFTWARE SHALL AT ALL TIMES REMAIN IN DEC.
     14					;
     15					; THE INFORMATION IN THIS SOFTWARE  IS  SUBJECT TO CHANGE WITHOUT
     16					; NOTICE AND SHOULD NOT BE CONSTRUED  AS  A COMMITMENT BY DIGITAL
     17					; EQUIPMENT CORPORATION.
     18					;
     19					; DEC ASSUMES NO RESPONSIBILITY FOR THE USE OR RELIABILITY OF ITS
     20					; SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DEC.
     21					;
     22					; VERSION 01
     23					;
     24					; WRITTEN BY:
     25					;
     26					;	THOMAS J. MILLER 11-JAN-76
     27					;	K.D. MORSE  21-JAN-77
     28					;
     29					;		KM001 -- FIX EXTRACT BUG -- STAR RECORDS HAVE LENGTH UP TO 512.
     30					;
     31					;
     32					; LIBRARY MODULE EXTRACTION.
     33					;
     34					;
     35					; MACRO CALLS.
     36					;
     37
     38						.MCALL	FDOFF$
     39	000000					FDOFF$	DEF$L
     40						.MCALL	FCSBT$
     41	000000					FCSBT$
     42						.MCALL	CLOSE$,PUT$
     43
     44
     50
     51						.MCALL	GET$S
     52
     54
     55
     56					;
     57					; LOCAL SYMBOL DEFINITIONS.
     58					;
     59
     60		001000 			RECSIZ=	512.			;++KM001 MAXIMUM INPUT RECORD SIZE
     61
     62					;
     63					; LOCAL DATA.
LIBEX	MACRO M1110  22-AUG-78 02:11  PAGE 4-1


     64					;
     65
     66	000000				DFTYP:				;TABLE OF DEFAULT FILE TYPES FOR OUTPUT
     67	000000	057032 				.RAD50	/OBJ/		;DEFAULT FOR OBJECT MODULE OUTPUT
     68	000002	050572 				.RAD50	/MAR/		;DEFAULT FOR MACRO DEFINITION OUTPUT
     69	000004				NXTHD:	.BLKW	2		;VBN / BYTE IN BLOCK OF END OF MODULE
     70	000010				VBLOCK:	.BLKW	2		;+++STAR CMD BLOCK FOR $EDMSG
     71	000014				RECBUF:	.BLKB	RECSIZ		;EXTRACT MODULE INPUT BUFFER
     72
     73					;+
     74					;
     75					; **-$EXT-MODULE EXTRACT FUNCTION
     76					;
     77					; THIS ROUTINE CONCATENATES THE SPECIFIED MODULES IN THE INPUT LIBRARY
     78					; FILE INTO THE SPECIFIED OUTPUT FILE.
     79					;
     80					; INPUTS:
     81					;
     82					;	THE INPUT LIB FDB IS SET UP.
     83					;+++STAR THE DESIRED MODULE NAMES ARE STORED, AS A BYTE COUNT FOLLOWED BY
     84					;+++STAR  'N' BYTES OF ASCII NAME, IN THE VECTOR AT
     85					;		$DMN.
     86					;
     87					; OUTPUTS:
     88					;
     89					;	NONE.
     90					;
     91					;-
     92
     93	001014				$EXT::	SAVRG			;SAVE R3-R5
     94	001020	016700 	000000G			MOV	$EXTPT,R0	;POINT TO OUTPUT FDB
     95	001024	012701 	000000G			MOV	#$CSIBK,R1	;POINT TO CSI BLOCK
     96	001030					CALL	$SCANO		;GET OUTPUT FILE SPEC
     97	001034	103003 				BCC	10$		;IF CC GOT ONE
     98	001036	012701 				MOV	(PC)+,R1	;OUTPUT FILE SPEC MISSING
     99	001040	   000G	   000G			.BYTE	E$R34,S$V2	;
    100	001042	000404 				BR	15$		;
    101	001044	005700 			10$:	TST	R0		;MORE OUTPUT SPECS?
    102	001046	001004 				BNE	20$		;IF NE NO
    103	001050	012701 				MOV	(PC)+,R1	;TOO MANY OUTPUT FILES (INFORMATIONAL)
    104	001052	   000G	   000G			.BYTE	E$R24,S$V0	;
    105	001054				15$:	CALL	$ERMSG		;ISSUE ERROR MESSAGE
    106	001060	012701 	000001 		20$:	MOV	#FO.RD,R1	;SET FOR READ ACCESS
    107	001064					CALL	$RDHD		;READ LIBRARY HEADER, EPT AND MNT
    108	001070	116701 	000000G			MOVB	L$TYP,R1	;GET LIBRARY TYPE
    109	001074	006301 				ASL	R1		;CONVERT TO WORD OFFSET
    110	001076	016167 	000000'	000014G		MOV	DFTYP(R1),EXTNAM+N.FTYP ;SET DEFAULT FILE TYPE
    111	001104	016700 	000000G			MOV	$EXTPT,R0	;POINT TO OUTPUT FDB
    112	001110	012701 	000016 			MOV	#FO.WRT,R1	;OPEN FOR WRITE
    113	001114	152760 	000002 	000001 		BISB	#FD.CR,F.RATT(R0) ;SET CARRIAGE CONTROL ATTRIBUTE
    114
    115
    122
    123	001122					CALL	$OPEN		;CREATE OUTPUT FILE
    124
    126
    127
LIBEX	MACRO M1110  22-AUG-78 02:11  PAGE 4-2


    128	001126	103003 				BCC	30$		;IF CC NO ERRORS
    129	001130	012701 				MOV	(PC)+,R1	;OUTPUT FILE OPEN FAILURE
    130	001132	   000G	   000G			.BYTE	E$R11,S$V2	;
    131	001134	000522 				BR	105$		;PICK UP POINTER TO FILE SPEC
    132	001136	010067 	000000G		30$:	MOV	R0,$OPNFL	;INDICATE OPEN FILE
    133	001142	012705 	000000G			MOV	#$DMN,R5	;POINT TO MODULE NAME VECTOR
    134	001146				40$:
    135	001146	105715 				TSTB	(R5)		;+++STAR ANY MORE
    136	001150	001517 				BEQ	110$		;IF EQ NO MORE
    137	001152	010500 				MOV	R5,R0		;+++STAR SET UP FOR $FINDA
    138	001154	012702 	000000G			MOV	#$MNBLK,R2	;POINT TO MNT DESCRIPTOR BLOCK
    139	001160					CALL	$FINDA		;SEARCH FOR MODULE NAME
    140	001164	103011 				BCC	50$		;IF CC FOUND IT
    141	001166	012701 				MOV	(PC)+,R1	;MODULE DOES NOT EXIST
    142	001170	   000G	   000G			.BYTE	E$R18,S$V2	;
    143	001172	012702 	000012'			MOV	#VBLOCK+2,R2	;+++STAR GET ADDR OF CMD BLOCK
    144	001176	010512 				MOV	R5,(R2)		;+++STAR PUT ADDR OF NAME IN BLOCK
    145	001200	005212 				INC	(R2)		;+++STAR SKIP ADDR OVER COUNT
    146	001202	005042 				CLR	-(R2)		;+++STAR ZERO WORD COUNT IN CMD BLOCK
    147	001204	111512 				MOVB	(R5),(R2)	;+++STAR PUT NAME LENGTH IN CMD BLOCK
    148	001206	000722 				BR	15$		;
    149	001210				50$:
    150	001210	111504 				MOVB	(R5),R4		;+++STAR GET STRING LENGTH
    151	001212	060405 				ADD	R4,R5		;+++STAR UPDATE STRING POINTER (ADD BYTE)
    152	001214	005205 				INC	R5		;+++STAR ADD ONE FOR STRING LENGTH
    153	001216	010001 				MOV	R0,R1		;COPY MNT ENTRY POINTER
    154	001220	062701 	000004 			ADD	#T$HEAD+2+V$MEML,R1 ;+++STAR POINT TO END OF MODULE ADDRESS
    155	001224	011146 				MOV	(R1),-(SP)	;SAVE BYTE OFFSET
    156	001226	014146 				MOV	-(R1),-(SP)	;SAVE VBN
    157	001230					CALL	$RDMH		;READ MODULE HEADER
    158	001234	103005 				BCC	70$		;IF CC NO ERRORS
    159	001236	012701 			60$:	MOV	(PC)+,R1	;I/O ERROR ON INPUT FILE
    160	001240	   000G	   000G			.BYTE	E$R01,S$V2	;
    161	001242	016702 	000000C			MOV	LIBPT+R$NAME,R2	;POINT TO FILE SPEC
    162	001246	000702 				BR	15$		;
    163	001250	012601 			70$:	MOV	(SP)+,R1	;RETRIEVE MODULE ADDRESS
    164	001252	012602 				MOV	(SP)+,R2	;
    165	001254					CALL	$NEXT		;COMPUTE ADDRESS OF NEXT MODULE HEADER
    166	001260	010167 	176520 			MOV	R1,NXTHD	;SAVE ADDRESS OF NEXT MODULE HEADER
    167	001264	010267 	176516 			MOV	R2,NXTHD+2	;
    168	001270	016700 	000000G		80$:	MOV	$LIBPT,R0	;POINT TO LIBRARY FILE FDB
    169	001274					CALL	.MARK		;GET CURRENT POSITION IN FILE
    170	001300	042703 	001000 			BIC	#1000,R3	;EXACT END OF BLOCK?
    171	001304	001001 				BNE	90$		;IF NE NO
    172	001306	005202 				INC	R2		;CONVERT TO BYTE 0 OF NEXT BLOCK
    173	001310	020267 	176470 		90$:	CMP	R2,NXTHD	;REACHED END OF MODULE?
    174	001314	001003 				BNE	100$		;IF NE NO
    175	001316	020367 	176464 			CMP	R3,NXTHD+2	;
    176	001322	001711 				BEQ	40$		;IF EQ YES
    177	001324				100$:				;REF LABEL
    178
    179
    185
    186	001324					GET$S	R0,#RECBUF,#RECSIZ ;READ NEXT RECORD
    187
    189
    190
LIBEX	MACRO M1110  22-AUG-78 02:11  PAGE 4-3


    191	001344	103734 				BCS	60$		;IF CS REPORT ERROR
    192	001346	010001 				MOV	R0,R1		;COPY LIB FDB POINTER
    193	001350	016700 	000000G			MOV	$EXTPT,R0	;POINT TO OUTPUT FILE
    194	001354					PUT$	R0,F.NRBD+2(R1),F.NRBD(R1) ;OUTPUT RECORD
    195	001374	103335 				BCC	80$		;IF CC NO ERRORS
    196	001376	012701 				MOV	(PC)+,R1	;ERROR ON OUTPUT FILE
    197	001400	   000G	   000G			.BYTE	E$R02,S$V2	;
    198	001402	016702 	000000C		105$:	MOV	EXTPT+R$NAME,R2	;POINT TO FILE SPEC
    199	001406	000622 				BR	15$		;
    200	001410				110$:	CLOSE$	$EXTPT		;CLOSE OUTPUT FILE
    201	001420	005067 	000000G			CLR	$OPNFL		;NO OPEN FILE
    202	001424					RETURN			;
    203
    204		000001 				.END
LIBEX	MACRO M1110  22-AUG-78 02:11  PAGE 4-4
SYMBOL TABLE

CH.AND= 000001   	FD.WBH= 000002   	F.RTYP= 000000   	N.UNIT= 000034   	S$MXLN= 000017
CTLGRP= 000120   	FF.CHR= 000005   	F.SEQN= 000100   	OBJ$SL= 000000   	S$RNAM  000006      010
DFTYP   000000R  	FF.NV = 000003   	F.SPDV= 000072   	OB$DBG= 000004   	S$RNLN  000005      010
EOM$MX= 000007   	FF.POE= 000002   	F.SPUN= 000074   	OB$EOM= 000003   	S$SDTY  000002      007
EXTNAM= ****** GX	FF.RWD= 000001   	F.STBK= 000036   	OB$GSD= 000001   	S$SFL0  000003      007
EXTPT = ****** GX	FF.RWF= 000006   	F.UNIT= 000136   	OB$HDR= 000000   	S$SFL1  000004      007
E$OMAD  000003      012	FF.SPC= 000004   	F.URBD= 000020   	OB$LNK= 000005   	S$V0  = ****** GX
E$OMER  000001      012	FO.APD= 000106   	F.VBN = 000064   	OB$TIR= 000002   	S$V2  = ****** GX
E$OMPS  000002      012	FO.MFY= 000002   	F.VBSZ= 000060   	OPRGRP= 000062   	S$$LIB= 000000
E$R01 = ****** GX	FO.RD = 000001   	GS$ARG= 000003   	O$BJTY  000000      002	S.FATT= 000016
E$R02 = ****** GX	FO.UPD= 000006   	GS$EPM= 000002   	PAGALI= 000011   	S.FDB = 000140
E$R11 = ****** GX	FO.WRT= 000016   	GS$PSC= 000000   	PAR$$$= 000067   	S.FNAM= 000006
E$R18 = ****** GX	F.ACTL= 000076   	GS$SYM= 000001   	PF$GBL= 000020   	S.FNB = 000036
E$R24 = ****** GX	F.ALOC= 000040   	G$SDTY  000001      005	PF$OVL= 000004   	S.FNBW= 000017
E$R34 = ****** GX	F.BBFS= 000062   	LIBPT = ****** GX	PF$PIC= 000001   	S.FNTY= 000004
FA.APD= 000100   	F.BDB = 000070   	L$TYP = ****** GX	PF$RD = 000200   	S.FTYP= 000002
FA.CRE= 000010   	F.BGBC= 000057   	MAXALI= 000011   	PF$REL= 000010   	S.NFEN= 000020
FA.DLK= 001000   	F.BKDN= 000026   	MHD$MX= 000111   	PF$SHR= 000040   	TIRMAX= 000121
FA.ENB= 100000   	F.BKDS= 000020   	MH$CPY= 000004   	PF$UNI= 000002   	T$CHAR= 000005
FA.EXC= 002000   	F.BKEF= 000050   	MH$GTX= 000006   	PF$WRT= 000001   	T$HEAD= 000000
FA.EXT= 000004   	F.BKP1= 000051   	MH$LNM= 000001   	PF$XEQ= 000100   	T$SLEN= 000004
FA.NSP= 000100   	F.BKST= 000024   	MH$MHD= 000000   	PSD$MX= 000031   	T$SMBL= 000004
FA.POS= 010000   	F.BKVB= 000064   	MH$MTC= 000005   	P$SALI  000002      006	VBLOCK  000010R
FA.RD = 000001   	F.CHR = 000075   	MH$SRC= 000002   	P$SALO  000005      006	V$MEML= 000002
FA.RWD= 004000   	F.CNTG= 000034   	MH$TTL= 000003   	P$SFL0  000003      006	$     = 000000      012
FA.SEQ= 040000   	F.DFNB= 000046   	MTC$MX= 000213   	P$SFL1  000004      006	$CSIBK= ****** GX
FA.SHR= 000040   	F.DSPT= 000044   	M$HDMS  000003      003	P$SNAM  000012      006	$DMN  = ****** GX
FA.TMP= 000020   	F.DVNM= 000134   	M$HDNM  000005      003	P$SNLN  000011      006	$ERMSG= ****** GX
FA.WCK= 020000   	F.EFBK= 000010   	M$HDSL  000002      003	Q$$CMO= 000000   	$EXT    001014RG
FA.WRT= 000002   	F.EFN = 000050   	M$HDST  000001      003	RECBUF  000014R  	$EXTPT= ****** GX
FD.BLK= 000010   	F.EOBB= 000032   	M$TCPN  000002      004	RECSIZ= 001000   	$FINDA= ****** GX
FD.CCL= 000002   	F.ERR = 000052   	NB.DEV= 000200   	R$MXLN= 001000   	$LIBPT= ****** GX
FD.COM= 020000   	F.FACC= 000043   	NB.DIR= 000100   	R$NAME= ****** GX	$MNBLK= ****** GX
FD.CR = 000002   	F.FFBY= 000014   	NB.NAM= 000004   	R$$11M= 000000   	$NEXT = ****** GX
FD.DIR= 000010   	F.FNAM= 000110   	NB.SD1= 000400   	R.FIX = 000001   	$OPEN = ****** GX
FD.FTN= 000001   	F.FNB = 000102   	NB.SD2= 001000   	R.SEQ = 000003   	$OPNFL= ****** GX
FD.F11= 040000   	F.FTYP= 000116   	NB.SNM= 000040   	R.VAR = 000002   	$RDHD = ****** GX
FD.INS= 000010   	F.FVER= 000120   	NB.STP= 000020   	SDF$MX= 000032   	$RDMH = ****** GX
FD.ISP= 002000   	F.HIBK= 000004   	NB.SVR= 000010   	SF$DEF= 000002   	$SAVRG= ****** GX
FD.MNT= 100000   	F.LUN = 000042   	NB.TYP= 000002   	SF$REL= 000010   	$SCANO= ****** GX
FD.OSP= 004000   	F.MBCT= 000054   	NB.VER= 000001   	SF$UNI= 000004   	$$    = 000001
FD.PLC= 000004   	F.MBC1= 000055   	NXTHD   000004R  	SF$VAL= 000020   	$$S   = 000005
FD.PRN= 000004   	F.MBFG= 000056   	N.DID = 000024   	SF$WK = 000001   	$$0   = 000002
FD.PSE= 010000   	F.NRBD= 000024   	N.DVNM= 000032   	SRF$MX= 000025   	$$1   = 000002
FD.RAH= 000001   	F.NREC= 000030   	N.FID = 000000   	STAGRP= 000000   	.CLOSE= ****** G
FD.RAN= 000002   	F.OVBS= 000030   	N.FNAM= 000006   	STOGRP= 000024   	.GETSQ= ****** G
FD.REC= 000001   	F.RACC= 000016   	N.FTYP= 000014   	S$DNAM  000013      011	.MARK = ****** GX
FD.RWM= 000001   	F.RATT= 000001   	N.FVER= 000016   	S$DNLN  000012      011	.PUT  = ****** G
FD.SDI= 000020   	F.RCNM= 000034   	N.NEXT= 000022   	S$DPSI  000005      011	...GBL= 000000
FD.SQD= 000040   	F.RCTL= 000017   	N.STAT= 000020   	S$DVAL  000006      011	...TPC= 000140
FD.TTY= 000004   	F.RSIZ= 000002

. ABS.	000000	   000
      	001426	   001
OBJREC	000001	   002
MHDREC	000111	   003
MTCREC	000213	   004
LIBEX	MACRO M1110  22-AUG-78 02:11  PAGE 4-5
SYMBOL TABLE

GSDREC	000002	   005
PSDEF 	000031	   006
SYMBOL	000005	   007
SYMREF	000025	   010
SYMDEF	000032	   011
EOMREC	000007	   012
ERRORS DETECTED:  0

VIRTUAL MEMORY USED:  2717 WORDS  ( 11 PAGES)
DYNAMIC MEMORY:  3828 WORDS  ( 14 PAGES)
ELAPSED TIME:  00:00:16
OBJ$:LIBEX,LIS$:LIBEX/-SP=SRC$:NEWFORMAT.,LIBPRE,LIBEX
