FORMAT	MACRO M1110  22-AUG-78 02:14
TABLE OF CONTENTS

     1-  300	OBJECT LANGUAGE DEFS
FORMAT	MACRO M1110  22-AUG-78 02:14  PAGE 1


    100						.TITLE	FORMAT
    200						.IDENT	/X0300/
    300						.SBTTL	OBJECT LANGUAGE DEFS
FORMAT	MACRO M1110  22-AUG-78 02:14  PAGE 3


      1					; COPYRIGHT (C) 1976, 1977
      2					; DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASS.
      3					;
      4					; THIS SOFTWARE IS FURNISHED UNDER  A LICENSE FOR USE ONLY  ON  A
      5					; SINGLE COMPUTER SYSTEM AND MAY BE  COPIED ONLY WITH  THE INCLU-
      6					; SION OF  THE  ABOVE  COPYRIGHT NOTICE.  THIS SOFTWARE,  OR  ANY
      7					; OTHER COPIES THEREOF, MAY NOT BE  PROVIDED  OR  OTHERWISE  MADE
      8					; AVAILABLE TO ANY OTHER PERSON EXCEPT  FOR  USE  ON  SUCH SYSTEM
      9					; AND TO  ONE WHO AGREES  TO  THESE LICENSE  TERMS.  TITLE TO AND
     10					; OWNERSHIP OF THE SOFTWARE SHALL AT ALL TIMES REMAIN IN DEC.
     11					;
     12					; THE INFORMATION IN THIS SOFTWARE  IS  SUBJECT TO CHANGE WITHOUT
     13					; NOTICE AND SHOULD NOT BE CONSTRUED  AS  A COMMITMENT BY DIGITAL
     14					; EQUIPMENT CORPORATION.
     15					;
     16					; DEC ASSUMES NO RESPONSIBILITY FOR THE USE OR RELIABILITY OF ITS
     17					; SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DEC.
LIBWHD	MACRO M1110  22-AUG-78 02:14  PAGE 4


      1						.TITLE	LIBWHD
      2						.IDENT	/04/
      3
      4					;
      5					; VERSION 04
      6					;
      7					; WRITTEN BY:
      8					;	GEORGE W. BERRY
      9					;
     10					; MODIFIED BY:
     11					;	C.A. D'ELIA	10-JUN-74
     12					;	C.A. D'ELIA	07-JUL-74 (VIRTUAL TABLES)
     13					;	THOMAS J. MILLER 07-NOV-74
     14					;			18-MAR-75
     15					;
     16					;
     17
     18					;
     19					; MACRO CALLS
     20					;
     21
     22						.MCALL	FDOFF$
     23	000000					FDOFF$	DEF$L
     24						.MCALL	FCSBT$
     25	000000					FCSBT$
     26						.MCALL	IOERR$,PUT$
     27	000000					IOERR$
     28
     29					;+
     30					; **-$WTHD=WRITE LIBRARY HEADER,EPT,AND MNT.
     31					;
     32					; THIS ROUTINE WRITES THE LIBRARY HEADER, EPT AND MNT
     33					; ONTO THE LIBRARY FILE.
     34					;
     35					; INPUTS:
     36					;
     37					;	NONE
     38					;
     39					; OUTPUTS:
     40					;
     41					;	NONE
     42					;-
     43	000000	032767 	000000G	000002G	$WTHD::	BIT	#LB$DTY,$SWTCH+2 ;HAS LIBRARY BEEN MODIFIED
     44	000006	001554 				BEQ	EXIT		;EXIT IF IT HAS NOT
     45	000010	042767 	000000G	000002G		BIC	#LB$DTY,$SWTCH+2 ;INDICATE UPDATE
     46	000016					SAVRG			;SAVE R3-R5
     47	000022	016700 	000000G			MOV	$LIBPT,R0	;POINT R0 TO LIBRARY FDB, ETC
     48	000026	112760 	000001 	000000 		MOVB	#R.FIX,F.RTYP(R0)  ;SPECIFY FIXED LENGTH RECORDS
     49	000034	112760 	000010 	000001 		MOVB	#FD.BLK,F.RATT(R0) ;CAN'T CROSS BLOCK BOUNDRIES
     50	000042	016702 	000000G			MOV	L$ET,R2		;GET START BLOCK OF EPT
     51	000046	012705 	000000G			MOV	#$EPBLK,R5	;POINT R5 TO EPT DESCRIPTOR BLOCK
     52	000052					CALL	WTR		;WRITE EPT
     53	000056	016702 	000000G			MOV	L$MT,R2		;GET START BLOCK OF MNT
     54	000062	012705 	000000G			MOV	#$MNBLK,R5	;POINT R5 TO MNT DESCRIPTOR BLOCK
     55	000066				WTR:	CALL	SETUP		;POSITION FILE
     56	000072	012560 	000002 			MOV	(R5)+,F.RSIZ(R0)  ;SET RECORD SIZE
     57	000076	016504 	000002 			MOV	2(R5),R4	;PUT NUMBER OF ENTRIES IN R4
LIBWHD	MACRO M1110  22-AUG-78 02:14  PAGE 4-1


     58	000102	001474 				BEQ	50$		;NULL TABLE, DONE
     59	000104	005003 				CLR	R3		;INITIAL PARTITION LIST OFFSET IS ZERO
     60	000106	011546 				MOV	(R5),-(SP)	;PUT ADDR OF LIST HEADS ON STACK
     61	000110	013601 			10$:	MOV	@(SP)+,R1	;PUT VIRTUAL LOCN OF NEXT ENTRY IN R1
     62	000112	001431 				BEQ	20$		;BRANCH IF THE LINK IS NULL
     63	000114					CALL	$CVRL		;ELSE, OBTAIN ITS REAL ADDRESS
     64	000120	010046 				MOV	R0,-(SP)	;SAVE THIS ENTRY'S LINK
     65	000122	005760 	000002 			TST	T$HEAD+V$MEML(R0) ;+++STAR EXAMINE ASSOCIATED MODULE HEADER ADDR
     66	000126	001770 				BEQ	10$		;BRANCH IF SYMBOL IS LOGICALLY DELETED
     67	000130	010001 				MOV	R0,R1		;POINT R1 TO THE ENTRY
     68	000132	005721 				TST	(R1)+		;AND PAST THE LINK WORD
     69	000134	005761 	000002 			TST	T$HEAD+V$MEML(R1) ;+++STAR WAS ENTRY NEGATED IN COMPRESS?
     70	000140	100002 				BPL	15$		;IF PL NO
     71	000142	005461 	000002 			NEG	T$HEAD+V$MEML(R1) ;+++STAR ELSE MAKE POSITIVE AGAIN
     72	000146				15$:	PUT$	$LIBPT,R1,F.RSIZ(R0)  ;WRITE THE ENTRY INTO LIBRARY FILE
     73	000170	103464 				BCS	WTERR		;BRANCH IF WRITE ERROR DETECTED
     74	000172	005304 				DEC	R4		;DECREMENT NUMBER OF ENTRIES
     75	000174	000745 				BR	10$		;REPEAT FOR NEXT ENTRY
     76	000176	062703 	000002 		20$:	ADD	#2,R3		;UPDATE PARTITION LIST OFFSET
     77	000202	020327 	000000C			CMP	R3,#<NU$PAR*2>-2  ;COMPARE IT WITH MAXIMUM
     78	000206	003003 				BGT	30$		;BRANCH IF END OF TABLE
     79	000210	011546 				MOV	(R5),-(SP)	;CALC ADDR OF THE NEXT PARTITION ...
     80	000212	060316 				ADD	R3,(SP)		;... LIST HEAD
     81	000214	000735 				BR	10$		;EMPTY THIS LIST
     82	000216	005704 			30$:	TST	R4		;MUST WE PAD FILE WITH DUMMY ENTRIES?
     83	000220	001425 				BEQ	50$		;NO, JUST LEAVE
     84	000222	012702 	000200G			MOV	#$OUTBF+128.,R2	;POINT R2 TO END OF TEMP BUFFER
     85	000226	164502 				SUB	-(R5),R2	;BACKUP BY AN ENTRY SIZE
     86	000230	012722 	177777 		35$:	MOV	#177777,(R2)+	;FILL THE ENTRY WITH ALL ONES
     87	000234	020227 	000200G			CMP	R2,#$OUTBF+128.	;
     88	000240	103773 				BLO	35$		;
     89	000242	161502 				SUB	(R5),R2		;POINT R2 BACK TO START OF DUMMY RECORD
     90	000244	016700 	000000G			MOV	$LIBPT,R0	;POINT R0 TO LIBRARY FDB
     91	000250				40$:	PUT$	R0,R2,F.RSIZ(R0)  ;OUTPUT A DUMMY ENTRY
     92	000266	103425 				BCS	WTERR		;BRANCH ON ERROR
     93	000270					SOB	R4,40$		;FILL OUT THE ENTIRE DISK TABLE WITH THEM
     94	000274	012702 	000001 		50$:	MOV	#1,R2		;PREPARE TO POINT TO VBN ONE
     95	000300					CALL	SETUP		;POSITION FILE TO THE BLOCK
     96	000304	012760 	001000 	000002 		MOV	#512.,F.RSIZ(R0)  ;SET RECORD SIZE FOR LATER OPENS
     97	000312					CALL	$FIXLA		;RECOMPUTE L$LA
     98	000316					PUT$	R0,#L$BUF,#512.	;WRITE OUT LIBRARY HEADER RECORD
     99	000336	103401 				BCS	WTERR		;BRANCH IF ERROR
    100	000340				EXIT:	RETURN			;EXIT
    101
    102	000342	012701 			WTERR:	MOV	(PC)+,R1	;FATAL WRITE ERROR
    103	000344	   000G	   000G			.BYTE	E$R02,S$V2
    104	000346	000402 				BR	ERRNM
    105
    106	000350	012701 			PERR:	MOV	(PC)+,R1	;ERROR IN POSITIONING FILE
    107	000352	   000G	   000G			.BYTE	E$R14,S$V2	;WITH .POINT
    108
    109	000354	016002 	000000G		ERRNM:	MOV	R$NAME(R0),R2	;POINT R2 TO FILE NAME
    110	000360	000167 	000000G			JMP	$ERMSG		;FATAL ERROR EXIT
    111
    112					;+
    113					;
    114					; SETUP FOR EPT OR MNT WRITE.
LIBWHD	MACRO M1110  22-AUG-78 02:14  PAGE 4-2


    115					;
    116					; THIS ROUTINE POSITIONS THE FILE AT THE DESIRED TABLE BLOCK.
    117					;
    118					; INPUTS:
    119					;
    120					;	R0 = $LIBPT
    121					;	R2 = STARTING BLOCK OF TABLE
    122					;
    123					; OUTPUTS:
    124					;
    125					;	R0 IS UNCHANGED
    126					;	R1 AND R3  ARE LOST
    127					;
    128					;-
    129
    130	000364	005001 			SETUP:	CLR	R1		;CLEAR HIGH VBN
    131	000366	005003 				CLR	R3		;CLEAR BYTE ADDRESS
    132	000370					CALL	.POINT		;POSITION FILE
    133	000374	103005 				BCC	10$
    134	000376	122760 	177766 	000052 		CMPB	#IE.EOF,F.ERR(R0) ;IGNORE EOF ERRORS
    135	000404	001361 				BNE	PERR		;BRANCH IF NOT EOF ERROR
    136	000406	006203 				ASR	R3		;DIVIDE BY 512. TO GET BLOCKS
    137	000410				10$:	RETURN
    138
    139
    140
    141		000001 				.END
LIBWHD	MACRO M1110  22-AUG-78 02:14  PAGE 4-3
SYMBOL TABLE

CH.AND= 000001   	FO.WRT= 000016   	IE.AST= 177660   	IE.OVR= 177756   	NB.DIR= 000100
CTLGRP= 000120   	F.ACTL= 000076   	IE.BAD= 177777   	IE.PES= 177655   	NB.NAM= 000004
EOM$MX= 000007   	F.ALOC= 000040   	IE.BBE= 177710   	IE.PRI= 177760   	NB.SD1= 000400
ERRNM   000354R  	F.BBFS= 000062   	IE.BCC= 177676   	IE.RAC= 177724   	NB.SD2= 001000
EXIT    000340R  	F.BDB = 000070   	IE.BDI= 177714   	IE.RAT= 177723   	NB.SNM= 000040
E$OMAD  000003      012	F.BGBC= 000057   	IE.BDR= 177716   	IE.RBG= 177730   	NB.STP= 000020
E$OMER  000001      012	F.BKDN= 000026   	IE.BDV= 177711   	IE.RCN= 177722   	NB.SVR= 000010
E$OMPS  000002      012	F.BKDS= 000020   	IE.BHD= 177700   	IE.RER= 177740   	NB.TYP= 000002
E$R02 = ****** GX	F.BKEF= 000050   	IE.BLB= 177672   	IE.RNM= 177715   	NB.VER= 000001
E$R14 = ****** GX	F.BKP1= 000051   	IE.BLK= 177754   	IE.RSU= 177757   	NU$PAR= ****** GX
FA.APD= 000100   	F.BKST= 000024   	IE.BNM= 177712   	IE.SNC= 177735   	N.DID = 000024
FA.CRE= 000010   	F.BKVB= 000064   	IE.BTF= 177664   	IE.SPC= 177772   	N.DVNM= 000032
FA.DLK= 001000   	F.CHR = 000075   	IE.BTP= 177725   	IE.SQC= 177734   	N.FID = 000000
FA.ENB= 100000   	F.CNTG= 000034   	IE.BVR= 177701   	IE.SRE= 177762   	N.FNAM= 000006
FA.EXC= 002000   	F.DFNB= 000046   	IE.BYT= 177755   	IE.STK= 177706   	N.FTYP= 000014
FA.EXT= 000004   	F.DSPT= 000044   	IE.CKS= 177742   	IE.TMM= 177671   	N.FVER= 000016
FA.NSP= 000100   	F.DVNM= 000134   	IE.CLO= 177732   	IE.TMO= 177666   	N.NEXT= 000022
FA.POS= 010000   	F.EFBK= 000010   	IE.CNR= 177667   	IE.ULK= 177653   	N.STAT= 000020
FA.RD = 000001   	F.EFN = 000050   	IE.CON= 177752   	IE.VER= 177774   	N.UNIT= 000034
FA.RWD= 004000   	F.EOBB= 000032   	IE.DAA= 177770   	IE.WAC= 177743   	OBJ$SL= 000000
FA.SEQ= 040000   	F.ERR = 000052   	IE.DAO= 177763   	IE.WAT= 177741   	OB$DBG= 000004
FA.SHR= 000040   	F.FACC= 000043   	IE.DFU= 177750   	IE.WCK= 177652   	OB$EOM= 000003
FA.TMP= 000020   	F.FFBY= 000014   	IE.DNA= 177771   	IE.WER= 177737   	OB$GSD= 000001
FA.WCK= 020000   	F.FNAM= 000110   	IE.DNR= 177775   	IE.WLK= 177764   	OB$HDR= 000000
FA.WRT= 000002   	F.FNB = 000102   	IE.DUN= 177767   	IE.2DV= 177720   	OB$LNK= 000005
FD.BLK= 000010   	F.FTYP= 000116   	IE.DUP= 177707   	IS.BV = 000005   	OB$TIR= 000002
FD.CCL= 000002   	F.FVER= 000120   	IE.EOF= 177766   	IS.CC = 001401   	OPRGRP= 000062
FD.COM= 020000   	F.HIBK= 000004   	IE.EOT= 177702   	IS.CR = 006401   	O$BJTY  000000      002
FD.CR = 000002   	F.LUN = 000042   	IE.EOV= 177765   	IS.EOT= 002001   	PAGALI= 000011
FD.DIR= 000010   	F.MBCT= 000054   	IE.EXP= 177665   	IS.ESC= 015401   	PAR$$$= 000000
FD.FTN= 000001   	F.MBC1= 000055   	IE.FEX= 177717   	IS.ESQ= 115401   	PERR    000350R
FD.F11= 040000   	F.MBFG= 000056   	IE.FHE= 177705   	IS.PES= 100001   	PF$GBL= 000020
FD.INS= 000010   	F.NRBD= 000024   	IE.FLN= 177657   	IS.PND= 000000   	PF$OVL= 000004
FD.ISP= 002000   	F.NREC= 000030   	IE.FOP= 177713   	IS.RDD= 000002   	PF$PIC= 000001
FD.MNT= 100000   	F.OVBS= 000030   	IE.HFU= 177744   	IS.SUC= 000001   	PF$RD = 000200
FD.OSP= 004000   	F.RACC= 000016   	IE.IES= 177656   	IS.TAB= 004401   	PF$REL= 000010
FD.PLC= 000004   	F.RATT= 000001   	IE.IFC= 177776   	IS.TMO= 000002   	PF$SHR= 000040
FD.PRN= 000004   	F.RCNM= 000034   	IE.IFU= 177747   	LB$DTY= ****** GX	PF$UNI= 000002
FD.PSE= 010000   	F.RCTL= 000017   	IE.ILL= 177726   	L$BUF = ****** GX	PF$WRT= 000001
FD.RAH= 000001   	F.RSIZ= 000002   	IE.ISQ= 177703   	L$ET  = ****** GX	PF$XEQ= 000100
FD.RAN= 000002   	F.RTYP= 000000   	IE.LCK= 177745   	L$MT  = ****** GX	PSD$MX= 000031
FD.REC= 000001   	F.SEQN= 000100   	IE.MOD= 177753   	MAXALI= 000011   	P$SALI  000002      006
FD.RWM= 000001   	F.SPDV= 000072   	IE.NBF= 177731   	MHD$MX= 000111   	P$SALO  000005      006
FD.SDI= 000020   	F.SPUN= 000074   	IE.NBK= 177727   	MH$CPY= 000004   	P$SFL0  000003      006
FD.SQD= 000040   	F.STBK= 000036   	IE.NDR= 177670   	MH$GTX= 000006   	P$SFL1  000004      006
FD.TTY= 000004   	F.UNIT= 000136   	IE.NFI= 177704   	MH$LNM= 000001   	P$SNAM  000012      006
FD.WBH= 000002   	F.URBD= 000020   	IE.NFW= 177673   	MH$MHD= 000000   	P$SNLN  000011      006
FF.CHR= 000005   	F.VBN = 000064   	IE.NLK= 177661   	MH$MTC= 000005   	Q$$CMO= 000000
FF.NV = 000003   	F.VBSZ= 000060   	IE.NLN= 177733   	MH$SRC= 000002   	R$MXLN= 001000
FF.POE= 000002   	GS$ARG= 000003   	IE.NNC= 177663   	MH$TTL= 000003   	R$NAME= ****** GX
FF.RWD= 000001   	GS$EPM= 000002   	IE.NNL= 177662   	MTC$MX= 000213   	R$$11M= 000000
FF.RWF= 000006   	GS$PSC= 000000   	IE.NNN= 177674   	M$HDMS  000003      003	R.FIX = 000001
FF.SPC= 000004   	GS$SYM= 000001   	IE.NOD= 177751   	M$HDNM  000005      003	R.SEQ = 000003
FO.APD= 000106   	G$SDTY  000001      005	IE.NSF= 177746   	M$HDSL  000002      003	R.VAR = 000002
FO.MFY= 000002   	IE.ABO= 177761   	IE.NST= 177660   	M$HDST  000001      003	SDF$MX= 000032
FO.RD = 000001   	IE.ALC= 177654   	IE.OFL= 177677   	M$TCPN  000002      004	SETUP   000364R
FO.UPD= 000006   	IE.ALN= 177736   	IE.ONP= 177773   	NB.DEV= 000200   	SF$DEF= 000002
LIBWHD	MACRO M1110  22-AUG-78 02:14  PAGE 4-4
SYMBOL TABLE

SF$REL= 000010   	S$MXLN= 000017   	S.FNB = 000036   	WTERR   000342R  	$SWTCH= ****** GX
SF$UNI= 000004   	S$RNAM  000006      010	S.FNBW= 000017   	WTR     000066R  	$WTHD   000000RG
SF$VAL= 000020   	S$RNLN  000005      010	S.FNTY= 000004   	$     = 000000      012	$$    = 000001
SF$WK = 000001   	S$SDTY  000002      007	S.FTYP= 000002   	$CVRL = ****** GX	$$MSG = 000000
SRF$MX= 000025   	S$SFL0  000003      007	S.NFEN= 000020   	$EPBLK= ****** GX	$$S   = 000005
STAGRP= 000000   	S$SFL1  000004      007	TIRMAX= 000121   	$ERMSG= ****** GX	$$0   = 000002
STOGRP= 000024   	S$V2  = ****** GX	T$CHAR= 000005   	$FIXLA= ****** GX	$$1   = 000002
S$DNAM  000013      011	S$$LIB= 000000   	T$HEAD= 000000   	$LIBPT= ****** GX	.POINT= ****** GX
S$DNLN  000012      011	S.FATT= 000016   	T$SLEN= 000004   	$MNBLK= ****** GX	.PUT  = ****** G
S$DPSI  000005      011	S.FDB = 000140   	T$SMBL= 000004   	$OUTBF= ****** GX	...GBL= 000000
S$DVAL  000006      011	S.FNAM= 000006   	V$MEML= 000002   	$SAVRG= ****** GX	...TPC= 000140

. ABS.	000000	   000
      	000412	   001
OBJREC	000001	   002
MHDREC	000111	   003
MTCREC	000213	   004
GSDREC	000002	   005
PSDEF 	000031	   006
SYMBOL	000005	   007
SYMREF	000025	   010
SYMDEF	000032	   011
EOMREC	000007	   012
ERRORS DETECTED:  0

VIRTUAL MEMORY USED:  3811 WORDS  ( 15 PAGES)
DYNAMIC MEMORY:  4884 WORDS  ( 18 PAGES)
ELAPSED TIME:  00:00:21
OBJ$:LIBWHD,LIS$:LIBWHD/-SP=SRC$:NEWFORMAT.,LIBPRE,LIBWHD
