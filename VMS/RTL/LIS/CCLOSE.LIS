
; Bliss-32 10.1-416	Monday 21-AUG-1978 19:11:40	DBB3:[RTL.SRC]CCLOSE.B32;6					Page 1
;
;	0001	MODULE COM$CLOSE (		! FORTRAN  compatibility CALL CLOSE
;	0002		IDENT = '0-05',		! File: CCLOSE.B32
;	0003		LINKAGE (FORTRAN)	! Specify call by-reference
;	0004		) =
;	0005	BEGIN
;	0006	
;	0007	!
;	0008	!			  COPYRIGHT (c) 1977 BY
;	0009	!	      DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASS.
;	0010	!
;	0011	! THIS SOFTWARE IS FURNISHED UNDER A LICENSE AND MAY BE USED AND  COPIED
;	0012	! ONLY  IN  ACCORDANCE  WITH  THE  TERMS  OF  SUCH  LICENSE AND WITH THE
;	0013	! INCLUSION OF THE ABOVE COPYRIGHT NOTICE.  THIS SOFTWARE OR  ANY  OTHER
;	0014	! COPIES  THEREOF MAY NOT BE PROVIDED OR OTHERWISE MADE AVAILABLE TO ANY
;	0015	! OTHER PERSON.  NO TITLE TO AND OWNERSHIP OF  THE  SOFTWARE  IS  HEREBY
;	0016	! TRANSFERRED.
;	0017	!
;	0018	! THE INFORMATION IN THIS SOFTWARE IS SUBJECT TO CHANGE  WITHOUT  NOTICE
;	0019	! AND  SHOULD  NOT  BE  CONSTRUED  AS  A COMMITMENT BY DIGITAL EQUIPMENT
;	0020	! CORPORATION.
;	0021	!
;	0022	! DIGITAL ASSUMES NO RESPONSIBILITY FOR THE USE OR  RELIABILITY  OF  ITS
;	0023	! SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DIGITAL.
;	0024	!
;	0025	
;	0026	!++
;	0027	! FACILITY:  FORTRAN Compatibility Library
;	0028	!
;	0029	! ABSTRACT:
;	0030	!
;	0031	!	CALL CLOSE Procedure - Close specified locical unit.
;	0032	!
;	0033	! ENVIRONMENT:  User Mode - AST re-entrant - not part of shared section
;	0034	!
;	0035	! AUTHOR:  Thomas N. Hastings, CREATION DATE:  4-Dec-1977
;	0036	!
;	0037	! MODIFIED BY:
;	0038	!
;	0039	! 	Thomas N. Hastings, 4-Dec-1977: VERSION 0
;	0040	! 0-1	- original
;	0041	! 0-2	- Use PSECT COM$.  TNH 8-Dec-77
;	0042	! 0-3	- Fix dot problem.  TNH 9-Dec-77
;	0043	! 0-4	- PSECT F4PCOMPAT$CODE.  TNH 9-Jan-78
;	0044	! 0-05	- Change REQUIRE files for VAX system build.  DGP 28-Apr-78
;	0045	!--

; Bliss-32 10.1-416	Monday 21-AUG-1978 19:11:40	DBB3:[RTL.SRC]CCLOSE.B32;6					Page 2
;
;	0046	!
;	0047	! TABLE OF CONTENTS:
;	0048	!
;	0049	
;	0050	FORWARD ROUTINE
;	0051		CLOSE: NOVALUE;			! CALL CLOSE _ no prefix since not mapped by compiler.
;	0052	
;	0053	!
;	0054	! INCLUDE FILES:
;	0055	!
;	0056		REQUIRE	'RTLML:FERR';	! Define FORTRAN Eerror numbers
; %PRINT:	Filename: FERR.MDL! Version 0, edit 36, TNH 19-June-78
;	0174		REQUIRE 'RTLML:FPAR';	! FORTRAN inter-module parameters
; %PRINT:	File: FPAR.MDL! version 0, edit 11, TNH, 30-May-78
;	0276		REQUIRE 'RTLIN:FOPN';	! OPEN paramter symbols
; %PRINT:	Filename: FOPN.B32; version 0, edit 22, TNH, 30-May-78
;65535  0415		REQUIRE 'RTLIN:LPSECT';	! Define DECLARE_PSECTS macro
; %PRINT:	 REQUIRE FILE: LPSECT.B32, VERSION 01-5, TNH, 27-Jun-78
;65535  0469	!
;65535  0470	! MACROS:
;65535  0471	!
;65535  0472	
;65535  0473	!
;65535  0474	! EQUATED SYMBOLS:
;65535  0475	!
;65535  0476	
;65535  0477	!
;65535  0478	! PSECT DECLARATIONS:
;65535  0479	!
;65535  0480	
;65535  0481		DECLARE_PSECTS (F4PCOMPAT);	! declare PSECTs for COM$ facility
;65535  0482						! F4PCOMPAT$CODE and F4PCOMPAT$DATA
;65535  0483						! Must be same PSECT else use GENERAL ADDRESSING
;65535  0484	
;65535  0485	!
;65535  0486	! OWN STORAGE:
;65535  0487	!
;65535  0488	
;65535  0489	!
;65535  0490	! EXTERNAL REFERENCES:
;65535  0491	!
;65535  0492	
;65535  0493	EXTERNAL ROUTINE
;65535  0494		FOR$CLOSE: NOVALUE ADDRESSING_MODE (GENERAL),		! Returns success ar failure
;65535  0495		FOR$$ERR_OPECLO: NOVALUE ADDRESSING_MODE (GENERAL),	! Error handler to set user PC in signal arg list
;65535  0496		FOR$$SIG_NO_LUB: NOVALUE ADDRESSING_MODE (GENERAL);	! Signal_stop when no LUB allocated

; Bliss-32 10.1-416	Monday 21-AUG-1978 19:11:40	DBB3:[RTL.SRC]CCLOSE.B32;6					Page 3
;
;65535  0497	GLOBAL ROUTINE CLOSE (		! FORTRAN compatibility CALL CLOSE routine
;65535  0498		LOGICAL_UNIT_NO)	! Adr. of logical unit nubmer
;65535  0499		:NOVALUE =		! no value
;65535  0500	
;65535  0501	!++
;65535  0502	! FUNCTIONAL DESCRIPTION:
;65535  0503	!
;65535  0504	!	Close file on specified logical unit.
;65535  0505	!	Perform any disposition specified in OPEN.
;65535  0506	!	This is done by performing a FORTRAN CLOSE (UNIT = LOGICAL_UNIT_NO)
;65535  0507	!
;65535  0508	! FORMAL PARAMETERS:
;65535  0509	!
;65535  0510	!	LOGICAL_UNIT_NO.rw.r	! Adr. of word (SIC) containing logical unit number
;65535  0511	!
;65535  0512	! IMPLICIT INPUTS:
;65535  0513	!
;65535  0514	!	See FOR$CLOSE.
;65535  0515	!
;65535  0516	! IMPLICIT OUTPUTS:
;65535  0517	!
;65535  0518	!	See FOR$CLOSE.
;65535  0519	!
;65535  0520	! ROUTINE VALUE:
;65535  0521	! COMPLETION CODES:
;65535  0522	!
;65535  0523	!	NONE
;65535  0524	!
;65535  0525	! SIDE EFFECTS:
;65535  0526	!
;65535  0527	!	SIGNAL_STOPs FOR$_INVARGFOR (48='INVALID ARGUMENT TO FORTRAN I/O LIBRARY')
;65535  0528	!	See FOR$CLOSE for rest of errors.
;65535  0529	!--
;65535  0530	
;65535  0531	    BEGIN
;65535  0532	    LOCAL
;65535  0533		CLOSE_KEY_WORD: BLOCK[4, BYTE];			! CLOSE keyword storage
;65535  0534	    BIND
;65535  0535		L_UNWIND_ACTION = UPLIT (FOR$K_UNWINDNOP);	! No action on unwind
;65535  0536	    MAP
;65535  0537		L_UNWIND_ACTION: VOLATILE;			! ARg to handler
;65535  0538	    ENABLE
;65535  0539		FOR$$ERR_OPECLO (L_UNWIND_ACTION);	! Enable error handler
;65535  0540							! Indicate no unwind action, since FOR$CLOSE will also
;65535  0541							! have setup a handler.  Don't pass 2nd arg since not an ERR=
;65535  0542	
;65535  0543	    !+
;65535  0544	    ! SIGNAL_STOP FOR$_INVARGFOR (48='INVALID ARGUMENT TO FFORTRAN I/O LIBRARY')
;65535  0545	    ! if no argument at all.
;65535  0546	    !-
;65535  0547	
;65535  0548	    IF NULLPARAMETER (1) THEN FOR$$SIG_NO_LUB (FOR$K_INVARGFOR, 0);
;65535  0549	    
;65535  0550	    !+
;65535  0551	    ! Build OPEN/CLOSE Keyword arg list

; Bliss-32 10.1-416	Monday 21-AUG-1978 19:11:40	DBB3:[RTL.SRC]CCLOSE.B32;6					Page 3-1
;
;65535  0552	    ! Pass address of word containing LOGICAL UNIT
;65535  0553	    ! Since no ERR= specified, any errors will be signaled.
;65535  0554	    !-
;65535  0555	
;65535  0556	    CLOSE_KEY_WORD[OPEN$B_KEY] = OPEN$K_UNIT;
;65535  0557	    CLOSE_KEY_WORD[OPEN$B_ARG_TYPE] =  OPEN$K_ARG_W_R;
;65535  0558	    FOR$CLOSE (.CLOSE_KEY_WORD, .LOGICAL_UNIT_NO);
;65535  0559	    RETURN
;65535  0560	    END;


							    .TITLE  COM$CLOSE
							    .IDENT  \0-05\

							    .PSECT  F4PCOMPAT$CODE,NOWRT,  SHR,  PIC,2

				    00000001  00000 P.AAA:  .LONG   1							      ;

						    L_UNWIND_ACTION=	P.AAA
							    .EXTRN  FOR$CLOSE, FOR$$ERR_OPECLO, FOR$$SIG_NO_LUB

					 0000 00004 	    .ENTRY  CLOSE, Save nothing					      ; 0497
		         6D 0000002A   EF  DE 00006 	    MOVAL   3$, (FP)						      ; 0531
		         01 	       6C  91 0000D 	    CMPB    (AP), #1						      ; 0548
				       05  1F 00010 	    BLSSU   1$							      ;
				  04   AC  D5 00012 	    TSTL    4(AP)						      ;
				       0A  12 00015 	    BNEQ    2$							      ;
		         7E 	       30  7D 00017 1$:     MOVQ    #48, -(SP)						      ;
	      00000000G  00	       02  FB 0001A 	    CALLS   #2, FOR$$SIG_NO_LUB					      ;
		         50 	       01  90 00021 2$:     MOVB    #1, CLOSE_KEY_WORD					      ; 0556
	   08 	         08 	       03  F0 00024 	    INSV    #3, #8, #8, CLOSE_KEY_WORD				      ; 0557
				       50     00028									      ;
				  04   AC  DD 00029 	    PUSHL   LOGICAL_UNIT_NO					      ; 0558
				       50  DD 0002C 	    PUSHL   CLOSE_KEY_WORD					      ;
	      00000000G  00	       02  FB 0002E 	    CALLS   #2, FOR$CLOSE					      ;
					   04 00035 	    RET     							      ; 0497
					 0000 00036 3$:     .WORD   Save nothing					      ; 0531
				  C5   AF  9F 00038 	    PUSHAB  L_UNWIND_ACTION					      ;
				       01  DD 0003B 	    PUSHL   #1							      ;
				       5E  DD 0003D 	    PUSHL   SP							      ;
		         7E 	  04   AC  7D 0003F 	    MOVQ    4(AP), -(SP)					      ;
	      00000000G  00	       03  FB 00043 	    CALLS   #3, FOR$$ERR_OPECLO					      ;
					   04 0004A 	    RET     							      ;

; Routine Size:  71 bytes


;65535  0561	END			! End of module
;65535  0562	ELUDOM







; Bliss-32 10.1-416	Monday 21-AUG-1978 19:11:40	DBB3:[RTL.SRC]CCLOSE.B32;6					Page 3-2
;
;				       PSECT SUMMARY
;
;	Name		 Bytes			       Attributes
;
;  F4PCOMPAT$CODE 	    75  NOWRT,  RD ,  EXE,  SHR,  LCL,  REL,  CON,  PIC,ALIGN(2)





; Size:		71 code + 4 data bytes
; Run Time:	00:04.0
; Elapsed Time:	00:06.4
; Memory Used:	36 pages
; Compilation Complete
