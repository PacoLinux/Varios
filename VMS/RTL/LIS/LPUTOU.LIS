
; Bliss-32 10.1-416	Monday 21-AUG-1978 19:35:30	DBB3:[RTL.SRC]LPUTOU.B32;7					Page 1
;
;00100  0001	MODULE LIB$PUT_OUTPUT (	! Library $PUT on device SYS$OUTPUT
;00200  0002		IDENT = '0-14'	! File: LPUTOU.B32
;00300  0003			) =
;00400  0004	BEGIN
;00500  0005	
;00600  0006	!
;00700  0007	!			  COPYRIGHT (c) 1977 BY
;00800  0008	!	      DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASS.
;00900  0009	!
;01000  0010	! THIS SOFTWARE IS FURNISHED UNDER A LICENSE AND MAY BE USED AND  COPIED
;01100  0011	! ONLY  IN  ACCORDANCE  WITH  THE  TERMS  OF  SUCH  LICENSE AND WITH THE
;01200  0012	! INCLUSION OF THE ABOVE COPYRIGHT NOTICE.  THIS SOFTWARE OR  ANY  OTHER
;01300  0013	! COPIES  THEREOF MAY NOT BE PROVIDED OR OTHERWISE MADE AVAILABLE TO ANY
;01400  0014	! OTHER PERSON.  NO TITLE TO AND OWNERSHIP OF  THE  SOFTWARE  IS  HEREBY
;01500  0015	! TRANSFERRED.
;01600  0016	!
;01700  0017	! THE INFORMATION IN THIS SOFTWARE IS SUBJECT TO CHANGE  WITHOUT  NOTICE
;01800  0018	! AND  SHOULD  NOT  BE  CONSTRUED  AS  A COMMITMENT BY DIGITAL EQUIPMENT
;01900  0019	! CORPORATION.
;02000  0020	!
;02100  0021	! DIGITAL ASSUMES NO RESPONSIBILITY FOR THE USE OR  RELIABILITY  OF  ITS
;02200  0022	! SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DIGITAL.
;02300  0023	!
;02400  0024	
;02500  0025	!++
;02600  0026	! FACILITY:  General Uitlity Library
;02700  0027	!
;02800  0028	! ABSTRACT:
;02900  0029	!
;03000  0030	!	Output a string as a record on device SYS$OUTPUT.
;03100  0031	!
;03200  0032	! ENVIRONMENT:  User Mode - AST re-entrant
;03300  0033	!
;03400  0034	! AUTHOR:  Thomas N. Hastings, CREATION DATE:  8-Aug-1977
;03500  0035	!
;03600  0036	! MODIFIED BY:
;03700  0037	!
;03800  0038	! 	Thomas N. Hastings, 8-Aug-1977: VERSION 0
;03900  0039	! 01	- original
;04000  0040	! 04	- change to SYS$OUTPUT
;04100  0041	! 05	- change to do OPEN at first time
;04200  0042	! 06	- change to set up RAB for message
;04300  0043	! 0-7	- fix comment
;04400  0044	! 0-9	- Put in carriage control.  TNH 28-Oct-77
;04500  0045	! 0-11	- Change to STARLET library.  DGP 20-Apr-78
;04600  0046	! 0-12	- Change REQUIRE files for VAX system build.  DGP 28-Apr-78
;04700  0047	! 0-13	- Change STARLET to RTLSTARLE to avoid conflicts.  DGP 1-May-78
;04800  0048	! 0-14	- Make wait if stream active, so AST re-entrant.  TNH 29-July-78
;04900  0049	!--

; Bliss-32 10.1-416	Monday 21-AUG-1978 19:35:30	DBB3:[RTL.SRC]LPUTOU.B32;7					Page 2
;
;00100  0050	!
;00200  0051	! TABLE OF CONTENTS:
;00300  0052	!
;00400  0053	
;00500  0054	FORWARD ROUTINE
;00600  0055		LIB$PUT_OUTPUT;		! Output string on device SYS$OUTPUT
;00700  0056	
;00800  0057	!
;00900  0058	! INCLUDE FILES:
;01000  0059	!
;01100  0060		REQUIRE 'RTLIN:FMAC';		! Define macros
; %PRINT:	Filename: FMAC.B32; Version 1, edit 29, TNH, 7-JUN-78
; %PRINT:	 REQUIRE FILE: LPSECT.B32, VERSION 01-5, TNH, 27-Jun-78
;01200  0240		LIBRARY	'RTLSTARLE';	! STARLET library for macros and symbols
;01300  0241	!
;01400  0242	! MACROS:
;01500  0243	!
;01600  0244	
;01700  0245	!
;01800  0246	! EQUATED SYMBOLS:
;01900  0247	!
;02000  0248	
;02100  0249	!
;02200  0250	! PSECT DECLARATIONS:
;02300  0251	!
;02400  0252	
;02500  0253		DECLARE_PSECTS (LIB);		! declare PSECTs for LIB$ facility
;02600  0254	
;02700  0255	!
;02800  0256	! OWN STORAGE:
;02900  0257	!
;03000  0258	
;03100  0259	OWN	SYS_OUTPUT_ISI: WORD INITIAL (0);
;03200  0260						! ISI for SYS$OUTPUT
;03300  0261	
;03400  0262	!
;03500  0263	! EXTERNAL REFERENCES:
;03600  0264	!	NONE
;03700  0265	!
;03800  0266	

; Bliss-32 10.1-416	Monday 21-AUG-1978 19:35:30	DBB3:[RTL.SRC]LPUTOU.B32;7					Page 3
;
;00100  0267	GLOBAL ROUTINE LIB$PUT_OUTPUT (	! Output string to SYS$OUTPUT
;00200  0268		MESSAGE)		! Adr. of string descriptor
;00300  0269		=			! Value returned is RMS completion code
;00400  0270	!++
;00500  0271	! FUNCTIONAL DESCRIPTION:
;00600  0272	!
;00700  0273	!	Outputs a record on device SYS$OUTPUT using RMS $PUT.
;00800  0274	!	On first call, device SYS$OUTPUT is opened
;00900  0275	!	(or created if it doesn't exist yet).  Thus the logical
;01000  0276	!	name SYS$OUTPUT can be assigned to any file name in order
;01100  0277	!	to redirect I/O.
;01200  0278	!
;01300  0279	! FORMAL PARAMETERS:
;01400  0280	!
;01500  0281	!	MESSAGE.rt.dx		Adr. of string descriptor of string
;01600  0282	!				to be output.
;01700  0283	!
;01800  0284	! IMPLICIT INPUTS:
;01900  0285	!
;02000  0286	!	NONE
;02100  0287	!
;02200  0288	! IMPLICIT OUTPUTS:
;02300  0289	!
;02400  0290	!	SYS_OUTPUT_ISI		! RMS internal stream id for all but first call
;02500  0291	!
;02600  0292	! COMPLETION CODES:
;02700  0293	!
;02800  0294	!	RMS completion code
;02900  0295	!
;03000  0296	! SIDE EFFECTS:
;03100  0297	!
;03200  0298	!	Opens (creates if not existent) file SYS$OUTPUT on first call.
;03300  0299	!--
;03400  0300	
;03500  0301	    BEGIN
;03600  0302	
;03700  0303	    LOCAL
;03800  0304		RMS_STATUS,			 ! RMS status
;03900  0305		FAB: $FAB_DECL,			 ! FAB
;04000  0306		RAB: $RAB_DECL;			 ! RAB
;04100  0307	    MAP
;04200  0308		MESSAGE: REF DSC$DESCRIPTOR;	! String descriptor
;04300  0309	
;04400  0310	    IF .SYS_OUTPUT_ISI EQL 0
;04500  0311	    THEN
;04600  0312	
;04700  0313		!+
;04800  0314		! First call, initialize FAB
;04900  0315		!-
;05000  0316	
;05100  0317		BEGIN
;05200  0318		$FAB_INIT (
;05300P 0319		    FAB = FAB,
;05400P 0320		    FAC = PUT,			! file access: PUT
;05500P 0321		    FNA = UPLIT ('SYS$OUTPUT'),	! file name: SYS$output

; Bliss-32 10.1-416	Monday 21-AUG-1978 19:35:30	DBB3:[RTL.SRC]LPUTOU.B32;7					Page 3-1
;
;05600P 0322		    FNS = 10,			! file name size: 10 bytes
;05700P 0323		    RAT = CR,			! carriage control - each record on separate line
;05800P 0324		    FOP = CIF);			! file options: create if file not exist
;05900  0325	
;06000  0326		!+
;06100  0327		! Create SYS$OUTPUT, open if exist and position to end-of-file,
;06200  0328		! remember ISI
;06300  0329		!-
;06400  0330	
;06500  0331		RMS_STATUS = $CREATE (FAB = FAB);		! fab addr : FAB
;06600  0332		IF NOT .RMS_STATUS THEN RETURN .RMS_STATUS;	! if create fail
;06700  0333								! then return with RMS status code
;06800  0334		$RAB_INIT (
;06900P 0335		    FAB = FAB,		! FAB address
;07000P 0336		    RAB = RAB,		! RAB address
;07100P 0337		    ROP = EOF);		! position at end-of-file if file exists
;07200  0338		RMS_STATUS = $CONNECT (RAB = RAB);	! connect RAB to the file
;07300  0339		IF NOT .RMS_STATUS THEN RETURN .RMS_STATUS;
;07400  0340		SYS_OUTPUT_ISI = .RAB[RAB$W_ISI];	! remember ISI
;07500  0341		END
;07600  0342	
;07700  0343	    !+
;07800  0344	    ! file already exist, just initialize RAB
;07900  0345	    ! including internal stream identifier returned from first $OPEN
;08000  0346	    !-
;08100  0347	
;08200  0348	    ELSE
;08300  0349		BEGIN
;08400  0350		$RAB_INIT (
;08500P 0351		    FAB = FAB,		! FAB address
;08600P 0352		    RAB = RAB,		! RAB address
;08700P 0353		    ROP = EOF);		! position at end-of-file if file exists
;08800  0354		RAB[RAB$W_ISI] = .SYS_OUTPUT_ISI;
;08900  0355		END;
;09000  0356	
;09100  0357	    !+
;09200  0358	    ! Setup buffer address and length on first and subsequent $PUTs
;09300  0359	    !-
;09400  0360	
;09500  0361	    RAB[RAB$L_RBF] = .MESSAGE[DSC$A_POINTER];
;09600  0362	    RAB[RAB$W_RSZ] = .MESSAGE[DSC$W_LENGTH];
;09700  0363	
;09800  0364	    !+
;09900  0365	    ! Output the string as a single record and return RMS completion status
;10000  0366	    ! If error and it is RECORD STREAM ACTIVE, wait and try again, thus
;10100  0367	    ! making routine AST re-entrant.  Return SS$_NORMAL (00000001) if
;10200  0368	    ! success, rather than LIB$_NORMAL (00010001).
;10300  0369	    !-
;10400  0370	
;10500  0371	    IF NOT $PUT (RAB = RAB)
;10600  0372	    THEN
;10700  0373		WHILE .RAB[RAB$L_STS] EQL RMS$_RSA DO
;10800  0374		    BEGIN
;10900  0375		    $WAIT (RAB=RAB);
;11000  0376		    $PUT (RAB=RAB);

; Bliss-32 10.1-416	Monday 21-AUG-1978 19:35:30	DBB3:[RTL.SRC]LPUTOU.B32;7					Page 3-2
;
;11100  0377		    END;
;11200  0378	
;11300  0379	    RETURN (IF .RAB[RAB$L_STS] THEN SS$_NORMAL ELSE .RAB[RAB$L_STS]);
;11400  0380	    END;			! End of routine LIB$PUT_OUTPUT


							    .TITLE  LIB$PUT_OUTPUT
							    .IDENT  \0-14\

							    .PSECT  LIB$DATA,NOEXE,  PIC,2

					0000  00000 SYS_OUTPUT_ISI:
							    .WORD   0							      ;

							    .PSECT  LIB$CODE,NOWRT,  SHR,  PIC,2

  00  54  55  50  54  55  4F  24  53  59  53  00000 P.AAA:  .ASCII  \SYS$OUTPUT\<0><0>					      ;
					  00  0000B									      ;

							    .EXTRN  SYS$CREATE, SYS$CONNECT, SYS$PUT, SYS$WAIT

					 03FC 0000C 	    .ENTRY  LIB$PUT_OUTPUT, Save R2,R3,R4,R5,R6,R7,R8,R9	      ; 0267
		         59 00000000'  EF  9E 0000E 	    MOVAB   SYS_OUTPUT_ISI, R9					      ;
		         58 00000000G  9F  9E 00015 	    MOVAB   @#SYS$PUT, R8					      ;
		         5E 	FF6C   CE  9E 0001C 	    MOVAB   -148(SP), SP					      ;
		         57 	       69  3C 00021 	    MOVZWL  SYS_OUTPUT_ISI, R7					      ; 0310
				       70  12 00024 	    BNEQ    3$							      ;
		         56 	  44   AE  9E 00026 	    MOVAB   FAB, $RMS_PTR					      ; 0324
	   00 	         6E 	       00  2C 0002A 	    MOVC5   #0, (SP), #0, #80, ($RMS_PTR)			      ;
		         66 	0050   8F     0002E									      ;
		         66 	5003   8F  B0 00032 	    MOVW    #20483, ($RMS_PTR)					      ;
		    04   A6 02000000   8F  D0 00037 	    MOVL    #33554432, 4($RMS_PTR)				      ;
		    16   A6	       01  90 0003F 	    MOVB    #1, 22($RMS_PTR)					      ;
		    1E   A6	0202   8F  B0 00043 	    MOVW    #514, 30($RMS_PTR)					      ;
		    2C   A6	  B4   AF  9E 00049 	    MOVAB   P.AAA, 44($RMS_PTR)					      ;
		    34   A6	       0A  90 0004E 	    MOVB    #10, 52($RMS_PTR)					      ;
				  44   AE  9F 00052 	    PUSHAB  FAB							      ; 0331
	      00000000G  9F	       01  FB 00055 	    CALLS   #1, @#SYS$CREATE					      ;
		         57 	       50  D0 0005C 	    MOVL    R0, RMS_STATUS					      ;
		         2A 	       57  E9 0005F 	    BLBC    RMS_STATUS, 1$					      ; 0332
		         56 	       6E  9E 00062 	    MOVAB   RAB, $RMS_PTR					      ; 0337
	   00 	         6E 	       00  2C 00065 	    MOVC5   #0, (SP), #0, #68, ($RMS_PTR)			      ;
		         66 	0044   8F     00069									      ;
		         66 	4401   8F  B0 0006D 	    MOVW    #17409, ($RMS_PTR)					      ;
		    04   A6	0100   8F  3C 00072 	    MOVZWL  #256, 4($RMS_PTR)					      ;
		    3C   A6	  44   AE  9E 00078 	    MOVAB   FAB, 60($RMS_PTR)					      ;
				       5E  DD 0007D 	    PUSHL   SP							      ; 0338
	      00000000G  9F	       01  FB 0007F 	    CALLS   #1, @#SYS$CONNECT					      ;
		         57 	       50  D0 00086 	    MOVL    R0, RMS_STATUS					      ;
		         04 	       57  E8 00089 	    BLBS    RMS_STATUS, 2$					      ; 0339
		         50 	       57  D0 0008C 1$:     MOVL    RMS_STATUS, R0					      ;
					   04 0008F 	    RET     							      ;
		         69 	  02   AE  B0 00090 2$:     MOVW    RAB+2, SYS_OUTPUT_ISI				      ; 0340
				       1F  11 00094 	    BRB     4$							      ; 0310
		         56 	       6E  9E 00096 3$:     MOVAB   RAB, $RMS_PTR					      ; 0353

; Bliss-32 10.1-416	Monday 21-AUG-1978 19:35:30	DBB3:[RTL.SRC]LPUTOU.B32;7					Page 3-3
;
	   00 	         6E 	       00  2C 00099 	    MOVC5   #0, (SP), #0, #68, ($RMS_PTR)			      ;
		         66 	0044   8F     0009D									      ;
		         66 	4401   8F  B0 000A1 	    MOVW    #17409, ($RMS_PTR)					      ;
		    04   A6	0100   8F  3C 000A6 	    MOVZWL  #256, 4($RMS_PTR)					      ;
		    3C   A6	  44   AE  9E 000AC 	    MOVAB   FAB, 60($RMS_PTR)					      ;
		    02   AE	       57  B0 000B1 	    MOVW    R7, RAB+2						      ; 0354
		         50 	  04   AC  D0 000B5 4$:     MOVL    MESSAGE, R0						      ; 0361
		    28   AE	  04   A0  D0 000B9 	    MOVL    4(R0), RAB+40					      ;
		    22   AE	       60  B0 000BE 	    MOVW    (R0), RAB+34					      ; 0362
				       5E  DD 000C2 	    PUSHL   SP							      ; 0371
		         68 	       01  FB 000C4 	    CALLS   #1, SYS$PUT						      ;
		         1A 	       50  E8 000C7 	    BLBS    R0, 6$						      ;
	      000182DA   8F	  08   AE  D1 000CA 5$:     CMPL    RAB+8, #99034					      ; 0373
				       10  12 000D2 	    BNEQ    6$							      ;
				       5E  DD 000D4 	    PUSHL   SP							      ; 0375
	      00000000G  9F	       01  FB 000D6 	    CALLS   #1, @#SYS$WAIT					      ;
				       5E  DD 000DD 	    PUSHL   SP							      ; 0376
		         68 	       01  FB 000DF 	    CALLS   #1, SYS$PUT						      ;
				       E6  11 000E2 	    BRB     5$							      ; 0373
		         04 	  08   AE  E9 000E4 6$:     BLBC    RAB+8, 7$						      ; 0379
		         50 	       01  D0 000E8 	    MOVL    #1, R0						      ;
					   04 000EB 	    RET     							      ;
		         50 	  08   AE  D0 000EC 7$:     MOVL    RAB+8, R0						      ;
					   04 000F0 	    RET     							      ; 0267

; Routine Size:  229 bytes


;11500  0381	END				! End of module LIB$PUT_OUTPUT
;11600  0382	ELUDOM






;				       PSECT SUMMARY
;
;	Name		 Bytes			       Attributes
;
;  LIB$DATA       	     2    WRT,  RD ,NOEXE,NOSHR,  LCL,  REL,  CON,  PIC,ALIGN(2)
;  LIB$CODE       	   241  NOWRT,  RD ,  EXE,  SHR,  LCL,  REL,  CON,  PIC,ALIGN(2)




;				LIBRARY STATISTICS
;
;					     -------- Symbols --------    Blocks
;	File				     Total    Loaded   Percent      Read
;
;  DBA4:[SYSLIB]STARLET.L32;1		      2688        69         2       145




; Bliss-32 10.1-416	Monday 21-AUG-1978 19:35:30	DBB3:[RTL.SRC]LPUTOU.B32;7					Page 3-4
;


; Size:		229 code + 14 data bytes
; Run Time:	00:09.3
; Elapsed Time:	00:32.5
; Memory Used:	208 pages
; Compilation Complete
