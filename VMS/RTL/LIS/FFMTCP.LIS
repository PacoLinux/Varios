
; Bliss-32 10.1-416	Monday 21-AUG-1978 19:17:23	DBB3:[RTL.SRC]FFMTCP.B32;17					Page 1
;
;00100  0001	MODULE FOR$$FMTCP (	! FORTRAN OBJECT TIME FORMAT COMPILER
;00200  0002		IDENT = '0-24'	! File: FFMTCP.B32
;00300  0003		) =
;00400  0004	BEGIN
;00500  0005	
;00600  0006	
;00700  0007	! COPYRIGHT (C) 1977
;00800  0008	! DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASSACHUSETTS 01754
;00900  0009	!
;01000  0010	! THIS SOFTWARE IS FURNISHED  UNDER A LICENSE FOR USE ONLY ON A SINGLE
;01100  0011	! COMPUTER  SYSTEM AND  MAY BE  COPIED ONLY WITH  THE INCLUSION OF THE
;01200  0012	! ABOVE COPYRIGHT NOTICE.  THIS SOFTWARE, OR ANY OTHER COPIES THEREOF,
;01300  0013	! MAY NOT BE PROVIDED OR  OTHERWISE MADE AVAILABLE TO ANY OTHER PERSON
;01400  0014	! EXCEPT FOR USE ON SUCH SYSTEM AND TO ONE WHO AGREES TO THESE LICENSE
;01500  0015	! TERMS.  TITLE TO AND  OWNERSHIP OF THE  SOFTWARE  SHALL AT ALL TIMES
;01600  0016	! REMAIN IN DEC.
;01700  0017	!
;01800  0018	! THE INFORMATION IN THIS SOFTWARE IS SUBJECT TO CHANGE WITHOUT NOTICE
;01900  0019	! AND SHOULD  NOT BE CONSTRUED  AS A COMMITMENT  BY DIGITAL  EQUIPMENT
;02000  0020	! CORPORATION.
;02100  0021	!
;02200  0022	! DEC ASSUMES  NO  RESPONSIBILITY  FOR  THE USE OR  RELIABILITY OF ITS
;02300  0023	! SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DEC.
;02400  0024	!
;02500  0025	!++
;02600  0026	! FACILITY: FORTRAN SUPPORT LIBRARY
;02700  0027	!
;02800  0028	! ABSTRACT:
;02900  0029	!
;03000  0030	!	This module is the run-time FORTRAN format statement compiler
;03100  0031	!	, FOR$$FMT_COMPIL. It is independent of READ and WRITE semantics
;03200  0032	!	and is called from both the READ Formatted and WRITE Formatted
;03300  0033	!	User Data Formatters (UDF) level of abstraction.
;03400  0034	!
;03500  0035	! ENVIRONMENT: User access mode; AST level or not \not reentrant yet\
;03600  0036	!
;03700  0037	! AUTHOR: Peter Yuo, CREATION DATE: 07-Junn-77
;03800  0038	!
;03900  0039	! MODIFIED BY:
;04000  0040	!
;04100  0041	! 01	- 	original
;04200  0042	! 0-08	- fix naked X bug.  TNH 14-Oct-77
;04300  0043	! 0-9	- Remove code after errors JMT 19-OCT-77
;04400  0044	! 0-10	- Fix naked T.  TNH 21-Oct-77
;04500  0045	! 0-11	- Use FOR$K_abcmno11yz as E11TERNAL LITERALs.  TNH 27-Oct-77
;04600  0046	! 0-13	- Change RECTOOBIG to INVARGFOR.  TNH 29-Oct-77
;04700  0047	! 0-14	- Use FERR.  TNH 26-Dec-77
;04800  0048	! 0-15	- Return size of dynamic memory allocated in ALLOCATED_LEN,
;04900  0049	!	  not number of bytes used.  JMT 27-Dec-77
;05000  0050	! 0-16	- Change VM_GET to GET_VM.  JMT 17-Jan-78
;05100  0051	! 0-18	- Change REQUIRE files for VAX system build.  DGP 28-Apr-78
;05200  0052	! 0-19	- Make re-entrant.  TNH 10-June-78
;05300  0053	! 0-21	- Make format buffer be 3200.  TNH 30-June-78
;05400  0054	! 0-22	- Expand format buffer dynamically.  TNH 1-July-78
;05410  0055	! 0-24	- Copy a byte at a time.  TNH 7-July-78

; Bliss-32 10.1-416	Monday 21-AUG-1978 19:17:23	DBB3:[RTL.SRC]FFMTCP.B32;17					Page 1-1
;
;05500  0056	!--

; Bliss-32 10.1-416	Monday 21-AUG-1978 19:17:23	DBB3:[RTL.SRC]FFMTCP.B32;17					Page 2
;
;00100  0057	!
;00200  0058	! LINKAGES:
;00300  0059	!
;00400  0060	
;00500  0061	LINKAGE
;00600  0062	    CALL_G3 = CALL: GLOBAL(SAVVAL=11,SAVTYP=10,PTR=9);
;00700  0063	
;00800  0064	! TABLE OF CONTENTS:
;00900  0065	!
;01000  0066	
;01100  0067	FORWARD ROUTINE
;01200  0068		FOR$$FMT_COMPIL: NOVALUE,
;01300  0069		REDUCE: NOVALUE CALL_G3,
;01400  0070		DEFER: NOVALUE CALL_G3,
;01500  0071		UNDEFER: NOVALUE CALL_G3,
;01600  0072		NZERO: NOVALUE CALL_G3,
;01700  0073		NSAVE: NOVALUE CALL_G3,
;01800  0074		PUTBYT: NOVALUE CALL_G3,
;01900  0075		BYTSIZ;
;02000  0076	
;02100  0077	!
;02200  0078	! INCLUDE FILES:
;02300  0079	!
;02400  0080	
;02500  0081		REQUIRE 'RTLML:FERR';		! FORTRAN error number definitions
; %PRINT:	Filename: FERR.MDL! Version 0, edit 36, TNH 19-June-78
;02600  0199		REQUIRE 'RTLIN:ODBG';		! Debugging macros
; %PRINT:	Filename: NODBG.B32; Version 0, edit 20, JMT, 17-Jan-78
;02700  0275		REQUIRE 'RTLIN:FMAC';		! FORTRAN macros
; %PRINT:	Filename: FMAC.B32; Version 1, edit 29, TNH, 7-JUN-78
; %PRINT:	 REQUIRE FILE: LPSECT.B32, VERSION 01-5, TNH, 27-Jun-78
;02800  0455	
;02900  0456	!
;03000  0457	! MACROS:
;03100  0458	!
;03200  0459	
;03300  0460	
;03400  0461	MACRO
;03500  0462	    ERROR (ERR_SYM) =
;03600M 0463		(FOR$$SIGNAL_STO (FOR$K_SYNERRFOR);
;03700M 0464		RETURN; 0) % ,
;03800  0465	    EXT_REG =
;03900M 0466		EXTERNAL REGISTER
;04000M 0467		    SAVVAL: REF VECTOR[3],
;04100M 0468		    SAVTYP: REF VECTOR[3],
;04200M 0469		    PTR: REF VECTOR[9] % ;
;04300  0470	
;04400  0471	
;04500  0472	
;04600  0473	
;04700  0474	!
;04800  0475	! EXTERNAL REFERENCES:
;04900  0476	!
;05000  0477	
;05100  0478	EXTERNAL ROUTINE

; Bliss-32 10.1-416	Monday 21-AUG-1978 19:17:23	DBB3:[RTL.SRC]FFMTCP.B32;17					Page 2-1
;
;05200  0479		FOR$$GET_VM,			! Get dynamic virtual memory
;05300  0480		FOR$$FREE_VM: NOVALUE,		! Free dynamic virtual memory
;05400  0481		FOR$$SIGNAL_STO: NOVALUE;	! signal-stop FOR$_abcmnoxyz, given
;05500  0482						! (short) Fortran error number (FOR$K_abcmnoxyz)
;05600  0483						! as a parameter
;05700  0484	
;05800  0485	!
;05900  0486	! PSECT DECLARATIONS:
;06000  0487	!
;06100  0488	
;06200  0489		DECLARE_PSECTS (FOR);	! declare PSECTs for FOR$ facility
;06300  0490	
;06400  0491	!
;06500  0492	! OWN STORAGE:
;06600  0493	!
;06700  0494	!	NONE
;06800  0495	
;06900  0496	!
;07000  0497	! EQUATED SYMBOLS:
;07100  0498	!
;07200  0499	
;07300  0500	LITERAL
;07400  0501		TRUE	= 1,
;07500  0502		K_FMT_BUF_INIT	= 256,		! initila length (bytes) of format buffer
;07600  0503		K_MAX_LENGTH	= 65535,	! max. length of input character array
;07700  0504	
;07800  0505		!+
;07900  0506		! Define offsets into LOCAL VECTOR pointed to by GLOBAL register PTR
;08000  0507		!-
;08100  0508	
;08200  0509		L_FDEFER	= 0,	! format code for deffered item
;08300  0510		L_FCOUNT	= 1,	! count of W, D, for deferred item
;08400  0511		L_PHASE		= 2,	! index to SAVVAL and SAVTYP
;08500  0512		L_NEST		= 3,	! parenthesis nest level
;08600  0513		L_SIGN		= 4,	! non-zero if minus sign seen
;08700  0514		L_NVAL		= 5,	! value of numberic item
;08800  0515		L_TYPE		= 6,	! type of numeric item
;08900  0516		L_NCHAR		= 7,	! character index within FMT_BUF
;09000  0517		A_FMT_BUF_BEG	= 8,	! pointer to beginning of compiled output
;09100  0518		L_CPRIME	= 9,	! previous character
;09200  0519		L_FMT_BUF_SIZ	=10,	! current size (bytes) of dynamically allocated format buffer
;09300  0520	
;09310  0521		!+
;09320  0522		! Define size constants for the LOCAL structures
;09330  0523		!-
;09340  0524	
;09400  0525		K_PTR_SIZ	=11,	! No. of local variables pointed to by PTR
;09500  0526		K_SAVVAL_SIZ	= 3,	! No. of longwords in SAVVAL
;09600  0527		K_SAVTYP_SIZ	= 3,	! No. of longwords in SAVTYP
;09700  0528		K_LOCAL_SIZ	= K_SAVVAL_SIZ + K_SAVTYP_SIZ + K_PTR_SIZ;	! Total size of LOCAL storage (longwords)
;09800  0529	
;09900  0530	
;10000  0531	
;10100  0532	BIND
;10200  0533		! CHARACTER CLASS TABLE

; Bliss-32 10.1-416	Monday 21-AUG-1978 19:17:23	DBB3:[RTL.SRC]FFMTCP.B32;17					Page 2-2
;
;10300  0534		!
;10400  0535	
;10500  0536		K_CLASS_TAB_MAX = 132,	! MAX. LEGAL CHARACTER (OUTSIDE OF STRING
;10600  0537					! CONSTANT)
;10700  0538		CLASS = UPLIT BYTE (
;10800  0539		     1,  0,  0,  0,  0,  0,  0,  0,	! 000
;10900  0540		     0,  0,  0,  0,  0,  0,  0,  0,	! 010
;11000  0541		     0,  0,  0,  0,  0,  0,  0,  0,	! 020
;11100  0542		     0,  0,  0,  0,  0,  0,  0,  0,	! 030
;11200  0543		     0,  0,  0,  0,  8,  0,  0, 12,	! 040
;11300  0544		     5,  6,  0,  0, 10,  2, 11,  7,	! 050
;11400  0545		     4,  4,  4,  4,  4,  4,  4,  4,	! 060
;11500  0546		     4,  4,  9,  0,  3,  0,  0,  0,	! 070
;11600  0547		     0, 13,  0,  0, 14, 15, 16, 17,	! 100
;11700  0548		    18, 19,  0,  0, 20,  0,  0, 21,	! 110
;11800  0549		    22, 23,  0,  0, 24,  0,  0,  0,	! 120
;11900  0550		    25,  0, 26) : VECTOR[K_CLASS_TAB_MAX+1,BYTE];
;12000  0551	
;12100  0552	BIND
;12200  0553	
;12300  0554		! FORMAT CODES
;12400  0555		!
;12500  0556		TOPLVL=	1,		! FORMAT REVERSION POINT
;12600  0557		LPAREN=	2,		! LEFT PARENTHESIS
;12700  0558		RPAREN=	3,		! RIGHT PARENTHESIS
;12800  0559		ENDFMT=	4,		! END OF FORMAT
;12900  0560		SLASH=	5,		! SLASH
;13000  0561		DOLLAR=	6,		! DOLLAR SIGN
;13100  0562		COLON=	7,		! COLON
;13200  0563		PCODE=	12,		! P
;13300  0564		TCODE=	13,		! T
;13400  0565		XCODE=	14,		! X
;13500  0566		HCODE=	15,		! H OR QUOTE
;13600  0567		QCODE=  20,		! Q
;13700  0568		ACODE=	21,		! A
;13800  0569		LCODE=	22,		! L
;13900  0570		OCODE=	23,		! O
;14000  0571		ICODE=	24,		! I
;14100  0572		ZCODE=  25,		! Z
;14200  0573		FCODE=	30,		! F
;14300  0574		ECODE=	31,		! E
;14400  0575		GCODE=	32,		! G
;14500  0576		DCODE=	33,		! D
;14600  0577		OFFSET=	20;		! OFFSET TO DEFAULT A...D CODES
;14700  0578	
;14800  0579	
;14900  0580	

; Bliss-32 10.1-416	Monday 21-AUG-1978 19:17:23	DBB3:[RTL.SRC]FFMTCP.B32;17					Page 3
;
;00100  0581	GLOBAL ROUTINE FOR$$FMT_COMPIL (	! RUN-TIME FORMAT COMPILER
;00200  0582		FORMAT,		! Address of the source format statement
;00300  0583		ALLOCATED_LEN,	! Length of the encoded format
;00400  0584		ALLOCATED_ADR	! Address of the encoded format
;00500  0585		): NOVALUE =
;00600  0586	!++
;00700  0587	! FUNCTIONAL DESCRIPTION:
;00800  0588	!
;00900  0589	!	Process the format statement.  If there is any illegal 
;01000  0590	!	character encounted, calls error routine and return.
;01100  0591	!	Otherwise, it will process each format code one at a time
;01200  0592	!	and output compiled encoding whenever all the information
;01300  0593	!	has been gathered.
;01400  0594	
;01500  0595	!
;01600  0596	! FORMAL PARAMETERS:
;01700  0597	!
;01800  0598	!	FORMAT.rbu,ra		Address of the source format statment text
;01900  0599	!	ALLOCATED_LEN.ww.r	Address of a word containing the length of the
;02000  0600	!				compiled format encoding fori the source
;02100  0601	!				format statement
;02200  0602	!	ALLOCATED_ADR.wa.r	Address of a longword containing the
;02300  0603	!				address of the compiled format encoding for
;02400  0604	!				the source format statement
;02500  0605	!
;02600  0606	! IMPLICIT INPUTS:
;02700  0607	!
;02800  0608	!	NONE
;02900  0609	!
;03000  0610	!
;03100  0611	! IMPLICIT OUTPUTS:
;03200  0612	!
;03300  0613	!	FMTDAT array
;03400  0614	!
;03500  0615	! ROUTINE VALUE:
;03600  0616	!
;03700  0617	!	NONE
;03800  0618	!
;03900  0619	! SIDE EFFECTS:
;04000  0620	!
;04100  0621	!	SIGNAL_STOPs FOR$SYNERRFOR (62="SYNTAX ERROR IN FORMAT")
;04200  0622	!
;04300  0623	!--
;04400  0624	

; Bliss-32 10.1-416	Monday 21-AUG-1978 19:17:23	DBB3:[RTL.SRC]FFMTCP.B32;17					Page 4
;
;00100  0625	    BEGIN
;00200  0626	
;00300  0627	    MAP
;00400  0628		ALLOCATED_LEN: REF VECTOR[1, WORD],
;00500  0629		ALLOCATED_ADR: REF VECTOR[1, LONG];
;00600  0630	
;00700  0631	    GLOBAL REGISTER
;00800  0632		SAVVAL = 11: REF VECTOR[K_SAVVAL_SIZ],		! pointer to value N, W, D
;00900  0633		SAVTYP = 10: REF VECTOR[K_SAVTYP_SIZ],	! pointer to type of N, W, D
;01000  0634		PTR = 9: REF VECTOR[K_PTR_SIZ];	! pointer to rest of LOCAL array
;01100  0635	
;01200  0636	    LOCAL
;01300  0637		CHAR,		! LAST CHARACTER FROM SOURCE
;01400  0638		FORMAT_PTR,	! Address of last character from source
;01500  0639		FMTDAT: VECTOR[K_LOCAL_SIZ];	! impure data for format processing
;01600  0640	
;01700  0641	!+
;01800  0642	! Bind names to LOCAL storage for this routine only.  Calls to other routines
;01900  0643	! access these locations using .PTR[L_name].
;02000  0644	!-
;02100  0645	
;02200  0646	BIND
;02300  0647		FDEFER = FMTDAT[6],	! FORMAT CODE FOR DEFERRED ITEM
;02400  0648		FCOUNT = FMTDAT[7],	! COUNT OF W, D FOR DEFERRED ITEM
;02500  0649		PHASE  = FMTDAT[8],	! INDEX TO SAVVAL AND SAVTYP
;02600  0650		NEST   = FMTDAT[9],	! PARENTHESIS NEST LEVEL
;02700  0651		SIGN   = FMTDAT[10],	! NONZERO IF MINUS SIGN SEEN
;02800  0652		NVAL   = FMTDAT[11],	! VALUE OF NUMERIC ITEM
;02900  0653		TYPE   = FMTDAT[12],	! TYPE OF NUMERIC ITEM
;03000  0654					! -1 = VARIABLE FORMAT EXPRESSION
;03100  0655					!  0 = NOT PRESENT
;03200  0656					! +1 = CONSTANT
;03300  0657		NCHAR  = FMTDAT[13],	! CHARACTER INDEX WITHIN FMT_BUF
;03400  0658		FMT_BUF_BEG = FMTDAT[14],! POINTER TO BEGINING OF COMPILED OUTPUT
;03500  0659					! FORMAT BUFFER
;03600  0660		CPRIME = FMTDAT[15],	! PREVIOUS CHARACTER
;03700  0661		FMT_BUF_SIZ = FMTDAT[16];	! CURRENT ALLOCATION FOR DYNAMICALLY ALLOCATED FORMAT BUFFER
;03800  0662	
;03900  0663	    !+
;04000  0664	    ! Setup GLOBAL registers to be passed to other routines
;04100  0665	    !-
;04200  0666	
;04300  0667	    SAVVAL = FMTDAT[0];		! Set pointer to value of N, W, D parameters
;04400  0668	    SAVTYP = FMTDAT[3];		! Set pointer to type of N, W, D parameters
;04500  0669	    PTR = FMTDAT[6];		! Set pointer to remainder of local storage
;04600  0670	
;04700  0671	
;04800  0672	    ! ACTUALLY PROCESS THE FORMAT SPECIFICATION
;04900  0673	    ! Clear LOCAL storage, and allocate initial format buffer
;05000  0674	    !
;05100  0675	    FILL_VAL (0, K_LOCAL_SIZ, FMTDAT);
;05200  0676	    FMT_BUF_BEG = FOR$$GET_VM (K_FMT_BUF_INIT);
;05300  0677	    FMT_BUF_SIZ = K_FMT_BUF_INIT;
;05400  0678	    CPRIME = '(';
;05500  0679	    FORMAT_PTR = CH$PTR(.FORMAT);

; Bliss-32 10.1-416	Monday 21-AUG-1978 19:17:23	DBB3:[RTL.SRC]FFMTCP.B32;17					Page 4-1
;
;05600  0680	    FORMAT_PTR = CH$FIND_NOT_CH (K_MAX_LENGTH, .FORMAT_PTR, %C' ');
;05700  0681	
;05800  0682	    IF CH$FAIL(.FORMAT_PTR) OR CH$RCHAR_A (FORMAT_PTR) NEQ %C'('
;05900  0683	    THEN
;06000  0684		ERROR(ERRMISSDLM)
;06100  0685	    ELSE
;06200  0686		BEGIN
;06300  0687	
;06400  0688		WHILE 1 DO
;06500  0689		    BEGIN
;06600  0690		    FORMAT_PTR = CH$FIND_NOT_CH (K_MAX_LENGTH, .FORMAT_PTR, %C' ');
;06700  0691		    CHAR = CH$RCHAR_A (FORMAT_PTR);
;06800  0692		    IF .CHAR GTRU K_CLASS_TAB_MAX THEN ERROR (ERRFMTCHAR);
;06900  0693		    CASE .CLASS[.CHAR]
;07000  0694		    FROM 0 TO 26 OF
;07100  0695			SET
;07200  0696	
;07300  0697			[0]:
;07400  0698			! 0 - INVALID CHARACTER
;07500  0699			!
;07600  0700	
;07700  0701			ERROR(ERRFMTCHAR);
;07800  0702	
;07900  0703			[1]:
;08000  0704			! 1 - NULL CHARACTER
;08100  0705			!
;08200  0706	
;08300  0707			ERROR(ERRFMTRPAR);
;08400  0708	
;08500  0709			[2]:
;08600  0710			! 2 - MINUS SIGN
;08700  0711			!
;08800  0712	
;08900  0713			BEGIN
;09000  0714			IF .SIGN NEQ 0 OR .TYPE NEQ 0 THEN ERROR(ERRFMTCHAR);
;09100  0715			SIGN = 1;
;09200  0716			TYPE = 0;
;09300  0717			END;
;09400  0718	
;09500  0719			[3]:
;09600  0720			! 3 - LEFT ANGLE BRACKET
;09700  0721			!
;09800  0722	
;09900  0723			ERROR(ERRFMTCHAR);
;10000  0724	
;10100  0725			[4]:
;10200  0726			! 4 - DIGIT
;10300  0727			!
;10400  0728	
;10500  0729			BEGIN
;10600  0730			TYPE = 1;
;10700  0731			NVAL = .NVAL*10 + .CHAR-'0';
;10800  0732			END;
;10900  0733	
;11000  0734			[5]:

; Bliss-32 10.1-416	Monday 21-AUG-1978 19:17:23	DBB3:[RTL.SRC]FFMTCP.B32;17					Page 4-2
;
;11100  0735			! 5 - LEFT PARENTHESIS
;11200  0736			!
;11300  0737	
;11400  0738			BEGIN
;11500  0739			NZERO();
;11600  0740			NSAVE();
;11700  0741			IF .NEST EQL 0 THEN PUTBYT(TOPLVL);
;11800  0742			IF (NEST = .NEST + 1) GTR 8 THEN ERROR(ERRFMTNEST);
;11900  0743			REDUCE(LPAREN);
;12000  0744			END;
;12100  0745	
;12200  0746			[6]:
;12300  0747			! 6 - RIGHT PARENTHESIS
;12400  0748			!
;12500  0749	
;12600  0750			BEGIN
;12700  0751			IF .CPRIME EQL ',' THEN ERROR(ERRFMXTCOM);
;12800  0752			UNDEFER();
;12900  0753			IF (NEST = .NEST - 1) LSS 0 THEN EXITLOOP;
;13000  0754			PUTBYT(RPAREN);
;13100  0755			END;
;13200  0756	
;13300  0757			[7]:
;13400  0758			! 7 - SLASH
;13500  0759			!
;13600  0760	
;13700  0761			BEGIN
;13800  0762			UNDEFER();
;13900  0763			PUTBYT(SLASH);
;14000  0764			END;
;14100  0765	
;14200  0766			[8]:
;14300  0767			! 8 - DOLLAR SIGN
;14400  0768			!
;14500  0769	
;14600  0770			BEGIN
;14700  0771			UNDEFER();
;14800  0772			PUTBYT(DOLLAR);
;14900  0773			END;
;15000  0774	
;15100  0775			[9]:
;15200  0776			! 9 - COLON
;15300  0777			!
;15400  0778	
;15500  0779			BEGIN
;15600  0780			UNDEFER();
;15700  0781			PUTBYT(COLON);
;15800  0782			END;
;15900  0783	
;16000  0784			[10]:
;16100  0785			! 10 - COMMA
;16200  0786			!
;16300  0787	
;16400  0788			BEGIN
;16500  0789			IF .CPRIME EQL ',' OR .CPRIME EQL '('

; Bliss-32 10.1-416	Monday 21-AUG-1978 19:17:23	DBB3:[RTL.SRC]FFMTCP.B32;17					Page 4-3
;
;16600  0790			    THEN ERROR(ERRFMXTCOM);
;16700  0791			UNDEFER();
;16800  0792			END;
;16900  0793	
;17000  0794			[11]:
;17100  0795			! 11 - DECIMAL POINT
;17200  0796			!
;17300  0797	
;17400  0798			BEGIN
;17500  0799			IF .TYPE EQL 0 THEN ERROR(ERRFMTNUMB);
;17600  0800			IF .SIGN NEQ 0 THEN ERROR(ERRFMTRNGE);
;17700  0801			IF .FCOUNT NEQ 2 OR .PHASE NEQ 1
;17800  0802			THEN
;17900  0803			    ERROR(ERRFMTCHAR);
;18000  0804			NSAVE();
;18100  0805			END;
;18200  0806	
;18300  0807			[12]:
;18400  0808			! 12 - QUOTE
;18500  0809			!
;18600  0810			BEGIN
;18700  0811			LOCAL P;
;18800  0812			UNDEFER();
;18900  0813			P = .FORMAT_PTR;
;19000  0814			DO
;19100  0815			    BEGIN
;19200  0816			    DO
;19300  0817				BEGIN
;19400  0818				CHAR = CH$RCHAR_A (FORMAT_PTR);
;19500  0819				NVAL = .NVAL + 1;
;19600  0820				END
;19700  0821			    WHILE .CHAR NEQ '''' AND .CHAR NEQ 0;
;19800  0822			    IF .CHAR EQL 0 THEN ERROR(ERRRTQUOTE);
;19900  0823			    CHAR = CH$RCHAR_A (FORMAT_PTR);
;20000  0824			    END
;20100  0825			WHILE .CHAR EQL '''';
;20200  0826			FORMAT_PTR = .P;
;20300  0827			IF (NVAL = P = .NVAL - 1) EQL 0
;20400  0828			    THEN ERROR(ERRZLSTR);
;20500  0829			TYPE = 1;
;20600  0830			PHASE = 1;
;20700  0831			NSAVE();
;20800  0832			REDUCE(HCODE);
;20900  0833			DECR I FROM .P TO 1 DO
;21000  0834			    BEGIN
;21100  0835			    IF (CHAR = CH$RCHAR_A (FORMAT_PTR)) EQL ''''
;21200  0836			    THEN CH$RCHAR_A (FORMAT_PTR);
;21300  0837			    PUTBYT(.CHAR);
;21400  0838			    END;
;21500  0839			CHAR = CH$RCHAR_A (FORMAT_PTR);
;21600  0840			END;
;21700  0841	
;21800  0842	
;21900  0843			[13]:
;22000  0844			! 13 - LETTER A

; Bliss-32 10.1-416	Monday 21-AUG-1978 19:17:23	DBB3:[RTL.SRC]FFMTCP.B32;17					Page 4-4
;
;22100  0845			!
;22200  0846	
;22300  0847			DEFER(ACODE, 1);
;22400  0848	
;22500  0849			[14]:
;22600  0850			! 14 - LETTER D
;22700  0851			!
;22800  0852	
;22900  0853			DEFER(DCODE, 2);
;23000  0854	
;23100  0855	
;23200  0856			[15]:
;23300  0857			! 15 - LETTER E
;23400  0858			!
;23500  0859	
;23600  0860			DEFER(ECODE, 2);
;23700  0861	
;23800  0862			[16]:
;23900  0863			! 16 - LETTER F
;24000  0864			!
;24100  0865	
;24200  0866			DEFER(FCODE, 2);
;24300  0867	
;24400  0868	
;24500  0869			[17]:
;24600  0870			! 17 - LETTER G
;24700  0871			!
;24800  0872	
;24900  0873			DEFER(GCODE, 2);
;25000  0874	
;25100  0875	
;25200  0876			[18]:
;25300  0877			! 18 - LETTER H
;25400  0878			!
;25500  0879	
;25600  0880			BEGIN
;25700  0881			LOCAL P;
;25800  0882			NZERO();
;25900  0883			IF .TYPE LSS 0 THEN ERROR(ERRFMTCHAR);
;26000  0884			IF .TYPE EQL 0 THEN (NVAL = 1;  TYPE = 1);
;26100  0885			IF (P = .NVAL) EQL 0 THEN ERROR(ERRZLSTR);
;26200  0886			PHASE = 1;
;26300  0887			NSAVE();
;26400  0888			REDUCE(HCODE);
;26500  0889			DECR I FROM .P TO 1 DO
;26600  0890			    BEGIN
;26700  0891			    IF (CHAR = CH$RCHAR_A (FORMAT_PTR)) EQL 0
;26800  0892			    THEN
;26900  0893				ERROR(ERRHOLLCNT);
;27000  0894			    PUTBYT(.CHAR);
;27100  0895			    END;
;27200  0896			CHAR = 0;
;27300  0897			END;
;27400  0898	
;27500  0899			[19]:

; Bliss-32 10.1-416	Monday 21-AUG-1978 19:17:23	DBB3:[RTL.SRC]FFMTCP.B32;17					Page 4-5
;
;27600  0900			! 19 - LETTER I
;27700  0901			!
;27800  0902	
;27900  0903			DEFER(ICODE, 1);
;28000  0904	
;28100  0905			[20]:
;28200  0906			! 20 - LETTER L
;28300  0907			!
;28400  0908	
;28500  0909			DEFER(LCODE, 1);
;28600  0910	
;28700  0911			[21]:
;28800  0912			! 21 - LETTER O
;28900  0913			!
;29000  0914	
;29100  0915			DEFER(OCODE, 1);
;29200  0916	
;29300  0917	
;29400  0918			[22]:
;29500  0919			! 22 - LETTER P
;29600  0920			!
;29700  0921	
;29800  0922			BEGIN
;29900  0923			NZERO();
;30000  0924			IF .TYPE EQL 0
;30100  0925			THEN
;30200  0926			    BEGIN
;30300  0927			    IF .SIGN NEQ 0 THEN ERROR(ERRFMTNUMB);
;30400  0928			    TYPE = 1;  NVAL = 1;
;30500  0929			    END;
;30600  0930			IF .SIGN NEQ 0 THEN NVAL = - .NVAL;
;30700  0931			SIGN = 0;
;30800  0932			PHASE = 1;
;30900  0933			NSAVE();
;31000  0934			REDUCE(PCODE);
;31100  0935			END;
;31200  0936	
;31300  0937			[23]:
;31400  0938			! 23 - LETTER Q
;31500  0939			!
;31600  0940			BEGIN
;31700  0941			UNDEFER();
;31800  0942			PUTBYT(QCODE);
;31900  0943			END;
;32000  0944	
;32100  0945			[24]:
;32200  0946			! 24 - LETTER T
;32300  0947			!
;32400  0948	
;32500  0949			BEGIN
;32600  0950			UNDEFER();
;32700  0951			DEFER(TCODE, 1);
;32800  0952			END;
;32900  0953	
;33000  0954			[25]:

; Bliss-32 10.1-416	Monday 21-AUG-1978 19:17:23	DBB3:[RTL.SRC]FFMTCP.B32;17					Page 4-6
;
;33100  0955			! 25 - LETTER X
;33200  0956			!
;33300  0957	
;33400  0958			BEGIN
;33500  0959			NZERO();
;33600  0960			PHASE = 1;
;33700  0961			NSAVE();
;33800  0962			REDUCE(XCODE);
;33900  0963			END;
;34000  0964	
;34100  0965			[26]:
;34200  0966			! 26 - LETTER Z
;34300  0967			!
;34400  0968	
;34500  0969			DEFER(ZCODE,1)
;34600  0970	
;34700  0971	
;34800  0972			TES;
;34900  0973	
;35000  0974		    CPRIME = .CHAR;
;35100  0975		    END;
;35200  0976	
;35300  0977	 	!+
;35400  0978		! Put end of format code.
;35500  0979		! Then return size and location of format buffer.
;35600  0980		!-
;35700  0981	
;35800  0982		PUTBYT(ENDFMT);
;35900  0983		ALLOCATED_LEN[0] = .FMT_BUF_SIZ;
;36000  0984		ALLOCATED_ADR[0] = .FMT_BUF_BEG;
;36100  0985		END;
;36200  0986	
;36300  0987	
;36400  0988	    !
;36500  0989	    ! PRINT FUNCTION VALUE, OUTPUT FORMALS, IMPLICIT OUTPUTS, IF DEBUGGING
;36600  0990	    !
;36700  0991	
;36800  0992	    FUNCTION_VALUE (FOR$$FMT_COMPIL);
;36900  0993	    OUTPUT_FORMALS (FOR$$FMT_COMPIL, '.ALLOCATED_LEN[0]', .ALLOCATED_LEN[0],
;37000P 0994		'.ALLOCATED_ADR[0]', .ALLOCATED_ADR[0],
;37100P 0995		'.ALLOCATED_ADR[0] + %UPVAL', .(ALLOCATED_ADR[0] + %UPVAL),
;37200P 0996		'.ALLOCATED_ADR[0] + 2*%UPVAL', .(ALLOCATED_ADR[0] + 2*%UPVAL),
;37300P 0997		'.ALLOCATED_ADR[0] + 3*%UPVAL', .(ALLOCATED_ADR[0] + 3*%UPVAL));
;37400  0998	
;37500  0999	    END;


							    .TITLE  FOR$$FMTCP
							    .IDENT  \0-24\

							    .PSECT  FOR$CODE,NOWRT,  SHR,  PIC,2

  00  00  00  00  00  00  00  00  00  00  01  00000 P.AAA:  .BYTE   1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -;
  00  00  00  00  00  00  00  00  00  00  00  0000B		    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 8, 0, -;
  00  00  00  00  00  00  00  00  00  00  00  00016		    0, 12, 5, 6, 0, 0, 10, 2, 11, 7, 4, 4, 4, 4, 4, 4, 4, 4, -;

; Bliss-32 10.1-416	Monday 21-AUG-1978 19:17:23	DBB3:[RTL.SRC]FFMTCP.B32;17					Page 4-7
;
  00  00  06  05  0C  00  00  08  00  00  00  00021		    4, 4, 9, 0, 3, 0, 0, 0, 0, 13, 0, 0, 14, 15, 16, 17, 18, -;
  04  04  04  04  04  04  04  07  0B  02  0A  0002C		    19, 0, 0, 20, 0, 0, 21, 22, 23, 0, 0, 24, 0, 0, 0, 25, -  ;
  0D  00  00  00  00  03  00  09  04  04  04  00037		    0, 26						      ;
  14  00  00  13  12  11  10  0F  0E  00  00  00042									      ;
  00  00  00  18  00  00  17  16  15  00  00  0004D									      ;
				  1A  00  19  00058									      ;
					      0005B	    .BLKB   1

						    K_CLASS_TAB_MAX=	132
						    CLASS=		P.AAA
						    TOPLVL=		1
						    LPAREN=		2
						    RPAREN=		3
						    ENDFMT=		4
						    SLASH=		5
						    DOLLAR=		6
						    COLON=		7
						    PCODE=		12
						    TCODE=		13
						    XCODE=		14
						    HCODE=		15
						    QCODE=		20
						    ACODE=		21
						    LCODE=		22
						    OCODE=		23
						    ICODE=		24
						    ZCODE=		25
						    FCODE=		30
						    ECODE=		31
						    GCODE=		32
						    DCODE=		33
						    OFFSET=		20
							    .EXTRN  FOR$$GET_VM, FOR$$FREE_VM, FOR$$SIGNAL_STO

					 0FFC 0005C 	    .ENTRY  FOR$$FMT_COMPIL, Save R2,R3,R4,R5,R6,R7,R8,R9,R10,R11     ; 0581
		         58 	0000V  CF  9E 0005E 	    MOVAB   PUTBYT, R8						      ;
		         57 	0000V  CF  9E 00063 	    MOVAB   NSAVE, R7						      ;
		         56 	0000V  CF  9E 00068 	    MOVAB   UNDEFER, R6						      ;
		         5E 	  BC   AE  9E 0006D 	    MOVAB   -68(SP), SP						      ;
		         5B 	       6E  9E 00071 	    MOVAB   FMTDAT, SAVVAL					      ; 0667
		         5A 	  0C   AE  9E 00074 	    MOVAB   FMTDAT+12, SAVTYP					      ; 0668
		         59 	  18   AE  9E 00078 	    MOVAB   FMTDAT+24, PTR					      ; 0669
	   00 	         6E 	       00  2C 0007C 	    MOVC5   #0, (SP), #0, #68, FMTDAT				      ; 0675
		         6E 	0044   8F     00080									      ;
		         7E 	0100   8F  3C 00084 	    MOVZWL  #256, -(SP)						      ; 0676
		  0000G  CF	       01  FB 00089 	    CALLS   #1, FOR$$GET_VM					      ;
		    38   AE	       50  D0 0008E 	    MOVL    R0, FMT_BUF_BEG					      ;
		    40   AE	0100   8F  3C 00092 	    MOVZWL  #256, FMT_BUF_SIZ					      ; 0677
		    3C   AE	       28  D0 00098 	    MOVL    #40, CPRIME						      ; 0678
		         53 	  04   AC  D0 0009C 	    MOVL    FORMAT, FORMAT_PTR					      ; 0679
	   63 	  FFFF   8F	       20  3B 000A0 	    SKPC    #32, #65535, (FORMAT_PTR)				      ; 0680
				       02  12 000A6 	    BNEQ    1$							      ;
				       51  D4 000A8 	    CLRL    R1							      ;
		         53 	       51  D0 000AA 1$:     MOVL    R1, FORMAT_PTR					      ;
				       5E  13 000AD 	    BEQL    5$							      ; 0682

; Bliss-32 10.1-416	Monday 21-AUG-1978 19:17:23	DBB3:[RTL.SRC]FFMTCP.B32;17					Page 4-8
;
		         50 	       83  9A 000AF 	    MOVZBL  (FORMAT_PTR)+, R0					      ;
		         28 	       50  91 000B2 	    CMPB    R0, #40						      ;
				       56  12 000B5 	    BNEQ    5$							      ;
	   63 	  FFFF   8F	       20  3B 000B7 2$:     SKPC    #32, #65535, (FORMAT_PTR)				      ; 0690
				       02  12 000BD 	    BNEQ    3$							      ;
				       51  D4 000BF 	    CLRL    R1							      ;
		         53 	       51  D0 000C1 3$:     MOVL    R1, FORMAT_PTR					      ;
		         52 	       83  9A 000C4 	    MOVZBL  (FORMAT_PTR)+, CHAR					      ; 0691
	      00000084   8F	       52  D1 000C7 	    CMPL    CHAR, #132						      ; 0692
				       3D  1A 000CE 	    BGTRU   5$							      ;
	   1A 	         00 	FF2B CF42  8F 000D0 	    CASEB   CLASS[CHAR], #0, #26				      ; 0693
	 0039 	       01B4 	     01B4     000D7 4$:     .WORD   46$-4$,-						      ;
	 005D 	       004C 	     01B4     000DD		    46$-4$,-						      ;
	 009E 	       0097 	     0082     000E3		    6$-4$,-						      ;
	 00BE 	       00AD 	     00A5     000E9		    46$-4$,-						      ;
	 013E 	       0138 	     00DC     000EF		    7$-4$,-						      ;
	 0150 	       014A 	     0144     000F5		    8$-4$,-						      ;
	 0199 	       0193 	     0156     000FB		    10$-4$,-						      ;
	 01DC 	       01A5 	     019F     00101		    12$-4$,-						      ;
	 0204 	       01EF 	     01E6     00107		    13$-4$,-						      ;
								    14$-4$,-						      ;
								    16$-4$,-						      ;
								    18$-4$,-						      ;
								    23$-4$,-						      ;
								    31$-4$,-						      ;
								    32$-4$,-						      ;
								    33$-4$,-						      ;
								    34$-4$,-						      ;
								    35$-4$,-						      ;
								    36$-4$,-						      ;
								    41$-4$,-						      ;
								    42$-4$,-						      ;
								    43$-4$,-						      ;
								    45$-4$,-						      ;
								    50$-4$,-						      ;
								    52$-4$,-						      ;
								    53$-4$,-						      ;
								    55$-4$						      ;
				     017B  31 0010D 5$:     BRW     46$							      ; 0701
				  28   AE  D5 00110 6$:     TSTL    SIGN						      ; 0714
				       F8  12 00113 	    BNEQ    5$							      ;
				  30   AE  D5 00115 	    TSTL    TYPE						      ;
				       F3  12 00118 	    BNEQ    5$							      ;
		    28   AE	       01  D0 0011A 	    MOVL    #1, SIGN						      ; 0715
				  30   AE  D4 0011E 	    CLRL    TYPE						      ; 0716
				       70  11 00121 	    BRB     17$							      ; 0693
		    30   AE	       01  D0 00123 7$:     MOVL    #1, TYPE						      ; 0730
	   50 	    2C   AE	       0A  C5 00127 	    MULL3   #10, NVAL, R0					      ; 0731
		    2C   AE	  D0 A240  9E 0012C 	    MOVAB   -48(CHAR)[R0], NVAL					      ;
				       7D  11 00132 	    BRB     22$							      ; 0693
		  0000V  CF	       00  FB 00134 8$:     CALLS   #0, NZERO						      ; 0739
		         67 	       00  FB 00139 	    CALLS   #0, NSAVE						      ; 0740
				  24   AE  D5 0013C 	    TSTL    NEST						      ; 0741
				       05  12 0013F 	    BNEQ    9$							      ;
				       01  DD 00141 	    PUSHL   #1							      ;

; Bliss-32 10.1-416	Monday 21-AUG-1978 19:17:23	DBB3:[RTL.SRC]FFMTCP.B32;17					Page 4-9
;
		         68 	       01  FB 00143 	    CALLS   #1, PUTBYT						      ;
	   50 	    24   AE	       01  C1 00146 9$:     ADDL3   #1, NEST, R0					      ; 0742
		    24   AE	       50  D0 0014B 	    MOVL    R0, NEST						      ;
		         08 	       50  D1 0014F 	    CMPL    R0, #8						      ;
				       B9  14 00152 	    BGTR    5$							      ;
				       02  DD 00154 	    PUSHL   #2							      ; 0743
				     017B  31 00156 	    BRW     54$							      ;
		         2C 	  3C   AE  D1 00159 10$:    CMPL    CPRIME, #44						      ; 0751
				       AE  13 0015D 	    BEQL    5$							      ;
		         66 	       00  FB 0015F 	    CALLS   #0, UNDEFER						      ; 0752
				  24   AE  D7 00162 	    DECL    NEST						      ; 0753
				       03  18 00165 	    BGEQ    11$							      ;
				     0181  31 00167 	    BRW     58$							      ;
				       03  DD 0016A 11$:    PUSHL   #3							      ; 0754
				       13  11 0016C 	    BRB     15$							      ;
		         66 	       00  FB 0016E 12$:    CALLS   #0, UNDEFER						      ; 0762
				       05  DD 00171 	    PUSHL   #5							      ; 0763
				       0C  11 00173 	    BRB     15$							      ;
		         66 	       00  FB 00175 13$:    CALLS   #0, UNDEFER						      ; 0771
				       06  DD 00178 	    PUSHL   #6							      ; 0772
				       05  11 0017A 	    BRB     15$							      ;
		         66 	       00  FB 0017C 14$:    CALLS   #0, UNDEFER						      ; 0780
				       07  DD 0017F 	    PUSHL   #7							      ; 0781
				     0134  31 00181 15$:    BRW     51$							      ;
		         2C 	  3C   AE  D1 00184 16$:    CMPL    CPRIME, #44						      ; 0789
				       83  13 00188 	    BEQL    5$							      ;
		         28 	  3C   AE  D1 0018A 	    CMPL    CPRIME, #40						      ;
				       50  13 0018E 	    BEQL    26$							      ;
		         66 	       00  FB 00190 	    CALLS   #0, UNDEFER						      ; 0791
				       78  11 00193 17$:    BRB     30$							      ; 0693
				  30   AE  D5 00195 18$:    TSTL    TYPE						      ; 0799
				       46  13 00198 	    BEQL    26$							      ;
				  28   AE  D5 0019A 	    TSTL    SIGN						      ; 0800
				       0A  12 0019D 	    BNEQ    19$							      ;
		         02 	  1C   AE  D1 0019F 	    CMPL    FCOUNT, #2						      ; 0801
				       04  12 001A3 	    BNEQ    19$							      ;
		         01 	  20   AE  D1 001A5 	    CMPL    PHASE, #1						      ;
				       03  13 001A9 19$:    BEQL    21$							      ;
				     00DD  31 001AB 20$:    BRW     46$							      ;
		         67 	       00  FB 001AE 21$:    CALLS   #0, NSAVE						      ; 0804
				       5A  11 001B1 22$:    BRB     30$							      ; 0693
		         66 	       00  FB 001B3 23$:    CALLS   #0, UNDEFER						      ; 0812
		         54 	       53  D0 001B6 	    MOVL    FORMAT_PTR, P					      ; 0813
		         52 	       83  9A 001B9 24$:    MOVZBL  (FORMAT_PTR)+, CHAR					      ; 0818
				  2C   AE  D6 001BC 	    INCL    NVAL						      ; 0819
		         27 	       52  D1 001BF 	    CMPL    CHAR, #39						      ; 0821
				       04  13 001C2 	    BEQL    25$							      ;
				       52  D5 001C4 	    TSTL    CHAR						      ;
				       F1  12 001C6 	    BNEQ    24$							      ;
				       52  D5 001C8 25$:    TSTL    CHAR						      ; 0822
				       DF  13 001CA 	    BEQL    20$							      ;
		         52 	       83  9A 001CC 	    MOVZBL  (FORMAT_PTR)+, CHAR					      ; 0823
		         27 	       52  D1 001CF 	    CMPL    CHAR, #39						      ; 0825
				       E5  13 001D2 	    BEQL    24$							      ;
		         53 	       54  D0 001D4 	    MOVL    P, FORMAT_PTR					      ; 0826

; Bliss-32 10.1-416	Monday 21-AUG-1978 19:17:23	DBB3:[RTL.SRC]FFMTCP.B32;17					Page 4-10
;
	   54 	    2C   AE	       01  C3 001D7 	    SUBL3   #1, NVAL, P						      ; 0827
		    2C   AE	       54  D0 001DC 	    MOVL    P, NVAL						      ;
				       C9  13 001E0 26$:    BEQL    20$							      ;
		    30   AE	       01  D0 001E2 	    MOVL    #1, TYPE						      ; 0829
		    20   AE	       01  D0 001E6 	    MOVL    #1, PHASE						      ; 0830
		         67 	       00  FB 001EA 	    CALLS   #0, NSAVE						      ; 0831
				       0F  DD 001ED 	    PUSHL   #15							      ; 0832
		  0000V  CF	       01  FB 001EF 	    CALLS   #1, REDUCE						      ;
				       54  D6 001F4 	    INCL    I							      ; 0833
				       0F  11 001F6 	    BRB     29$							      ;
		         52 	       83  9A 001F8 27$:    MOVZBL  (FORMAT_PTR)+, CHAR					      ; 0835
		         27 	       52  D1 001FB 	    CMPL    CHAR, #39						      ;
				       02  12 001FE 	    BNEQ    28$							      ;
				       53  D6 00200 	    INCL    FORMAT_PTR						      ; 0836
				       52  DD 00202 28$:    PUSHL   CHAR						      ; 0837
		         68 	       01  FB 00204 	    CALLS   #1, PUTBYT						      ;
		         EE 	       54  F5 00207 29$:    SOBGTR  I, 27$						      ; 0833
		         52 	       83  9A 0020A 	    MOVZBL  (FORMAT_PTR)+, CHAR					      ; 0839
				       59  11 0020D 30$:    BRB     40$							      ; 0693
				       01  DD 0020F 31$:    PUSHL   #1							      ; 0847
				       15  DD 00211 	    PUSHL   #21							      ;
				       65  11 00213 	    BRB     44$							      ;
				       02  DD 00215 32$:    PUSHL   #2							      ; 0853
				       21  DD 00217 	    PUSHL   #33							      ;
				       5F  11 00219 	    BRB     44$							      ;
				       02  DD 0021B 33$:    PUSHL   #2							      ; 0860
				       1F  DD 0021D 	    PUSHL   #31							      ;
				       59  11 0021F 	    BRB     44$							      ;
				       02  DD 00221 34$:    PUSHL   #2							      ; 0866
				       1E  DD 00223 	    PUSHL   #30							      ;
				       53  11 00225 	    BRB     44$							      ;
				       02  DD 00227 35$:    PUSHL   #2							      ; 0873
				       20  DD 00229 	    PUSHL   #32							      ;
				       4D  11 0022B 	    BRB     44$							      ;
		  0000V  CF	       00  FB 0022D 36$:    CALLS   #0, NZERO						      ; 0882
				  30   AE  D5 00232 	    TSTL    TYPE						      ; 0883
				       54  19 00235 	    BLSS    46$							      ;
				       08  12 00237 	    BNEQ    37$							      ; 0884
		    2C   AE	       01  D0 00239 	    MOVL    #1, NVAL						      ;
		    30   AE	       01  D0 0023D 	    MOVL    #1, TYPE						      ;
		         54 	  2C   AE  D0 00241 37$:    MOVL    NVAL, P						      ; 0885
				       44  13 00245 	    BEQL    46$							      ;
		    20   AE	       01  D0 00247 	    MOVL    #1, PHASE						      ; 0886
		         67 	       00  FB 0024B 	    CALLS   #0, NSAVE						      ; 0887
				       0F  DD 0024E 	    PUSHL   #15							      ; 0888
		  0000V  CF	       01  FB 00250 	    CALLS   #1, REDUCE						      ;
				       54  D6 00255 	    INCL    I							      ; 0889
				       0A  11 00257 	    BRB     39$							      ;
		         52 	       83  9A 00259 38$:    MOVZBL  (FORMAT_PTR)+, CHAR					      ; 0891
				       2D  13 0025C 	    BEQL    46$							      ;
				       52  DD 0025E 	    PUSHL   CHAR						      ; 0894
		         68 	       01  FB 00260 	    CALLS   #1, PUTBYT						      ;
		         F3 	       54  F5 00263 39$:    SOBGTR  I, 38$						      ; 0889
				       52  D4 00266 	    CLRL    CHAR						      ; 0896
				       7A  11 00268 40$:    BRB     57$							      ; 0693

; Bliss-32 10.1-416	Monday 21-AUG-1978 19:17:23	DBB3:[RTL.SRC]FFMTCP.B32;17					Page 4-11
;
				       01  DD 0026A 41$:    PUSHL   #1							      ; 0903
				       18  DD 0026C 	    PUSHL   #24							      ;
				       6F  11 0026E 	    BRB     56$							      ;
				       01  DD 00270 42$:    PUSHL   #1							      ; 0909
				       16  DD 00272 	    PUSHL   #22							      ;
				       69  11 00274 	    BRB     56$							      ;
				       01  DD 00276 43$:    PUSHL   #1							      ; 0915
				       17  DD 00278 	    PUSHL   #23							      ;
				       63  11 0027A 44$:    BRB     56$							      ;
		  0000V  CF	       00  FB 0027C 45$:    CALLS   #0, NZERO						      ; 0923
				  30   AE  D5 00281 	    TSTL    TYPE						      ; 0924
				       15  12 00284 	    BNEQ    48$							      ;
				  28   AE  D5 00286 	    TSTL    SIGN						      ; 0927
				       08  13 00289 	    BEQL    47$							      ;
				       3E  DD 0028B 46$:    PUSHL   #62							      ;
		  0000G  CF	       01  FB 0028D 	    CALLS   #1, FOR$$SIGNAL_STO					      ;
					   04 00292 	    RET     							      ;
		    30   AE	       01  D0 00293 47$:    MOVL    #1, TYPE						      ; 0928
		    2C   AE	       01  D0 00297 	    MOVL    #1, NVAL						      ;
				  28   AE  D5 0029B 48$:    TSTL    SIGN						      ; 0930
				       05  13 0029E 	    BEQL    49$							      ;
		    2C   AE	  2C   AE  CE 002A0 	    MNEGL   NVAL, NVAL						      ;
				  28   AE  D4 002A5 49$:    CLRL    SIGN						      ; 0931
		    20   AE	       01  D0 002A8 	    MOVL    #1, PHASE						      ; 0932
		         67 	       00  FB 002AC 	    CALLS   #0, NSAVE						      ; 0933
				       0C  DD 002AF 	    PUSHL   #12							      ; 0934
				       21  11 002B1 	    BRB     54$							      ;
		         66 	       00  FB 002B3 50$:    CALLS   #0, UNDEFER						      ; 0941
				       14  DD 002B6 	    PUSHL   #20							      ; 0942
		         68 	       01  FB 002B8 51$:    CALLS   #1, PUTBYT						      ;
				       27  11 002BB 	    BRB     57$							      ; 0693
		         66 	       00  FB 002BD 52$:    CALLS   #0, UNDEFER						      ; 0950
				       01  DD 002C0 	    PUSHL   #1							      ; 0951
				       0D  DD 002C2 	    PUSHL   #13							      ;
				       19  11 002C4 	    BRB     56$							      ;
		  0000V  CF	       00  FB 002C6 53$:    CALLS   #0, NZERO						      ; 0959
		    20   AE	       01  D0 002CB 	    MOVL    #1, PHASE						      ; 0960
		         67 	       00  FB 002CF 	    CALLS   #0, NSAVE						      ; 0961
				       0E  DD 002D2 	    PUSHL   #14							      ; 0962
		  0000V  CF	       01  FB 002D4 54$:    CALLS   #1, REDUCE						      ;
				       09  11 002D9 	    BRB     57$							      ; 0693
				       01  DD 002DB 55$:    PUSHL   #1							      ; 0969
				       19  DD 002DD 	    PUSHL   #25							      ;
		  0000V  CF	       02  FB 002DF 56$:    CALLS   #2, DEFER						      ;
		    3C   AE	       52  D0 002E4 57$:    MOVL    CHAR, CPRIME					      ; 0974
				     FDCC  31 002E8 	    BRW     2$							      ; 0688
				       04  DD 002EB 58$:    PUSHL   #4							      ; 0982
		         68 	       01  FB 002ED 	    CALLS   #1, PUTBYT						      ;
		    08   BC	  40   AE  B0 002F0 	    MOVW    FMT_BUF_SIZ, @ALLOCATED_LEN				      ; 0983
		    0C   BC	  38   AE  D0 002F5 	    MOVL    FMT_BUF_BEG, @ALLOCATED_ADR				      ; 0984
					   04 002FA 	    RET     							      ; 0581

; Routine Size:  671 bytes



; Bliss-32 10.1-416	Monday 21-AUG-1978 19:17:23	DBB3:[RTL.SRC]FFMTCP.B32;17					Page 4-12
;
;37600  1000	

; Bliss-32 10.1-416	Monday 21-AUG-1978 19:17:23	DBB3:[RTL.SRC]FFMTCP.B32;17					Page 5
;
;00100  1001	ROUTINE REDUCE(C): CALL_G3 NOVALUE =
;00200  1002	
;00300  1003	!++
;00400  1004	! FUNCTIONAL DESCRIPTION:
;00500  1005	!
;00600  1006	!	Output the compiled text corresponding to the format item
;00700  1007	!	just scanned
;00800  1008	!
;00900  1009	! FORMAL PARAMETERS:
;01000  1010	!
;01100  1011	!	C	- format code
;01200  1012	!
;01300  1013	! IMPLICIT INPUTS:
;01400  1014	!
;01500  1015	!	FMTDAT array
;01600  1016	!
;01700  1017	!
;01800  1018	! IMPLICIT OUTPUTS:
;01900  1019	!
;02000  1020	!	Compiled text output through argument
;02100  1021	!	Reinitialization for another format item (per format code related
;02200  1022	!	FMTDAT array updated)
;02300  1023	!
;02400  1024	! ROUTINE VALUE:
;02500  1025	!
;02600  1026	!	NONE
;02700  1027	!
;02800  1028	! SIDE EFFECTS:
;02900  1029	!
;03000  1030	!	SIGNAL_STOPs FOR$SYNERRFOR (62="SYNTAX ERROR IN FORMAT")
;03100  1031	!
;03200  1032	!--
;03300  1033	
;03400  1034	    BEGIN
;03500  1035	
;03600  1036	    EXT_REG;			! Declare external registers
;03700  1037	
;03800  1038	    MACRO
;03900  1039		ALLBITS=0,0,32,0%,! WHOLE WORD
;04000  1040		RSBITS=0,0,2,0%,	! REP COUNT SIZE
;04100  1041		SBIT=0,2,1,0%,	! W FIELD SIZE
;04200  1042		XBIT=0,7,1,0%;	! REPETITION COUNT EXISTS
;04300  1043	
;04400  1044	    LOCAL
;04500  1045		FC: BLOCK[1],		! FORMAT CODE WITH MODIFICATIONS
;04600  1046		TMP,			!
;04700  1047		VFEM: BLOCK[1];		! VFE MASK BYTE
;04800  1048	
;04900  1049	
;05000  1050	
;05100  1051	    ! IF C IS ZERO, THERE IS NOTHING TO REDUCE
;05200  1052	    !
;05300  1053	    IF (FC = .C) NEQ 0
;05400  1054	    THEN
;05500  1055		BEGIN

; Bliss-32 10.1-416	Monday 21-AUG-1978 19:17:23	DBB3:[RTL.SRC]FFMTCP.B32;17					Page 5-1
;
;05600  1056	
;05700  1057		! IF W.D WAS NOT PRESENT AND WE ARE PROCESSING A...D,
;05800  1058		! THEN MODIFY THE FORMAT CODE BY THE APPROPRIATE OFFSET
;05900  1059		! TO SIGNAL THAT DEFAULTS ARE BEING TAKEN
;06000  1060		!
;06100  1061		IF .C GEQ ACODE AND .SAVTYP[1] EQL 0
;06200  1062		THEN
;06300  1063		    BEGIN
;06400  1064		    FC = .FC + OFFSET;
;06500  1065		    SAVTYP[2] = 0;
;06600  1066		    END;
;06700  1067	
;06800  1068	
;06900  1069		! CHECK FOR W-FIELD WITH MISSING D-FIELD
;07000  1070		!
;07100  1071		IF
;07200  1072		    .PTR[L_FCOUNT] EQL 2 AND
;07300  1073		    .SAVTYP[1] NEQ 0 AND
;07400  1074		    .SAVTYP[2] EQL 0
;07500  1075		THEN
;07600  1076		    ERROR(ERRFMTNUMB);
;07700  1077	
;07800  1078	
;07900  1079		! CHECK COUNT FOR X, T AND H CODES
;08000  1080		!
;08100  1081		IF .C EQL XCODE OR .C EQL TCODE
;08200  1082		THEN
;08300  1083		    BEGIN
;08400  1084		    IF .SAVTYP[1] EQL 0
;08500  1085		    THEN
;08600  1086			IF .C EQL XCODE
;08700  1087			THEN
;08800  1088			    ! WE MUST SUPPLY A COUNT OF 1
;08900  1089			    !
;09000  1090			    BEGIN
;09100  1091			    SAVTYP[1] = 1;
;09200  1092			    SAVVAL[1] = 1;
;09300  1093			    END
;09400  1094			ELSE
;09500  1095			    ! T WITH NO N
;09600  1096			    !
;09700  1097			    ERROR(ERRFMTNUMB)
;09800  1098		    ELSE
;09900  1099			IF .SAVTYP[1] GTR 0 AND .SAVVAL[1] LSS 0
;10000  1100		    	THEN
;10100  1101			    ERROR(ERRFMTRNGE);
;10200  1102		    END;
;10300  1103	
;10400  1104		IF .C EQL HCODE AND (.SAVVAL[1] LSS 0 OR .SAVTYP[1] LEQ 0)
;10500  1105		THEN
;10600  1106		    ERROR(ERRHOLLCNT);
;10700  1107	
;10800  1108		! COMPUTE THE VFE-MASK
;10900  1109		!
;11000  1110		VFEM[ALLBITS] = 0;

; Bliss-32 10.1-416	Monday 21-AUG-1978 19:17:23	DBB3:[RTL.SRC]FFMTCP.B32;17					Page 5-2
;
;11100  1111		
;11200  1112		! COMPUTE S AND RS FIELDS
;11300  1113		!
;11400  1114		! REPETITION COUNT IS PRESENT IF IT IS
;11500  1115		! A VFE OR A CONSTANT NOT EQUAL TO ONE
;11600  1116		!
;11700  1117		IF
;11800  1118		    .SAVTYP[0] LEQ 0 OR
;11900  1119		    .SAVTYP[0] GTR 0 AND .SAVVAL[0] EQL 1
;12000  1120		THEN
;12100  1121		    VFEM[RSBITS] = 0
;12200  1122		ELSE
;12300  1123		    VFEM[RSBITS] = BYTSIZ(.SAVVAL[0]);
;12400  1124	
;12500  1125		IF .C NEQ PCODE AND .SAVTYP[1] NEQ -1
;12600  1126		THEN
;12700  1127		    VFEM[SBIT] = BYTSIZ(.SAVVAL[1]) - 1
;12800  1128		ELSE
;12900  1129		    VFEM[SBIT] = 0;
;13000  1130	
;13100  1131		IF .VFEM[ALLBITS] NEQ 0 THEN FC[XBIT] = TRUE;
;13200  1132	
;13300  1133	
;13400  1134		! OUTPUT THE CODE
;13500  1135		! ALSO, CHECK RANGE OF CONSTANT PARAMETERS
;13600  1136		!
;13700  1137		PUTBYT(.FC);
;13800  1138		IF .VFEM[ALLBITS] NEQ 0 THEN PUTBYT(.VFEM[ALLBITS]);
;13900  1139		INCR I FROM 0 TO 2 DO
;14000  1140		    CASE .SAVTYP[.I]+1 FROM 0 TO 2 OF
;14100  1141			SET
;14200  1142	
;14300  1143			[0]:
;14400  1144			! CASE -1  VARIABLE FORMAT EXPRESSION
;14500  1145			!
;14600  1146	
;14700  1147			ERROR(ERRFMTCHAR);
;14800  1148	
;14900  1149	
;15000  1150			[1]:
;15100  1151			! CASE 0   NOT PRESENT
;15200  1152			!
;15300  1153			0;
;15400  1154	
;15500  1155	
;15600  1156			[2]:
;15700  1157			! CASE +1  CONSTANT
;15800  1158			!
;15900  1159			BEGIN
;16000  1160			CASE .I FROM 0 TO 2 OF
;16100  1161			    SET
;16200  1162	
;16300  1163			    [0]:
;16400  1164			    ! 0 - REPETITION FACTOR
;16500  1165			    !

; Bliss-32 10.1-416	Monday 21-AUG-1978 19:17:23	DBB3:[RTL.SRC]FFMTCP.B32;17					Page 5-3
;
;16600  1166			    BEGIN
;16700  1167			    IF .SAVVAL[0] LEQ 0
;16800  1168			    THEN
;16900  1169				ERROR(ERRFMTRNGE);
;17000  1170			    IF .SAVVAL[0] NEQ 1
;17100  1171			    THEN
;17200  1172				BEGIN
;17300  1173				PUTBYT(.SAVVAL[0]);
;17400  1174				IF .VFEM[RSBITS] EQL 2
;17500  1175				THEN
;17600  1176				    PUTBYT(.SAVVAL[0]/256);
;17700  1177				END;
;17800  1178			    END;
;17900  1179	
;18000  1180			    [1]:
;18100  1181			    ! 1 - WIDTH OR SCALING FACTOR
;18200  1182			    !
;18300  1183			    BEGIN
;18400  1184			    IF .C EQL PCODE
;18500  1185			    THEN
;18600  1186				BEGIN
;18700  1187				IF
;18800  1188				    .SAVVAL[1] LSS -128 OR
;18900  1189				    .SAVVAL[1] GTR 127
;19000  1190				THEN
;19100  1191				    ERROR(ERRFMTRNGE);
;19200  1192				END
;19300  1193			    ELSE
;19400  1194				IF
;19500  1195				    .SAVVAL[1] EQL 0
;19600  1196				THEN
;19700  1197				    ERROR(ERRFMTRNGE);
;19800  1198			    PUTBYT(.SAVVAL[1]);
;19900  1199			    IF .VFEM[SBIT] NEQ 0
;20000  1200			    THEN
;20100  1201				PUTBYT(.SAVVAL[1]/256);
;20200  1202			    END;
;20300  1203	
;20400  1204			    [2]:
;20500  1205			    ! 2 - DECIMAL FIELD WIDTH
;20600  1206			    !
;20700  1207			    BEGIN
;20800  1208			    IF
;20900  1209				.SAVVAL[2] LSS 0 OR
;21000  1210				.SAVVAL[2] GTR 255
;21100  1211			    THEN
;21200  1212				ERROR(ERRFMTRNGE);
;21300  1213			    PUTBYT(.SAVVAL[2]);
;21400  1214			    END
;21500  1215	
;21600  1216			    TES;
;21700  1217	
;21800  1218			END
;21900  1219	
;22000  1220			TES;

; Bliss-32 10.1-416	Monday 21-AUG-1978 19:17:23	DBB3:[RTL.SRC]FFMTCP.B32;17					Page 5-4
;
;22100  1221	
;22200  1222		END;
;22300  1223	
;22400  1224	    FILL_VAL (0, 9, SAVVAL[0]);		!\\\ shouldn't all of FMTDAT be cleared?
;22500  1225	    END;





					 007C 002FB REDUCE: .WORD   Save R2,R3,R4,R5,R6					      ; 1001
		         56 	0000V  CF  9E 002FD 	    MOVAB   PUTBYT, R6						      ;
		         55 	  04   AC  D0 00302 	    MOVL    C, R5						      ; 1053
		         53 	       55  D0 00306 	    MOVL    R5, FC						      ;
				       03  12 00309 	    BNEQ    1$							      ;
				     014C  31 0030B 	    BRW     31$							      ;
		         15 	       55  D1 0030E 1$:     CMPL    R5, #21						      ; 1061
				       0B  19 00311 	    BLSS    2$							      ;
				  04   AA  D5 00313 	    TSTL    4(SAVTYP)						      ;
				       06  12 00316 	    BNEQ    2$							      ;
		         53 	       14  C0 00318 	    ADDL2   #20, FC						      ; 1064
				  08   AA  D4 0031B 	    CLRL    8(SAVTYP)						      ; 1065
		         02 	  04   A9  D1 0031E 2$:     CMPL    4(PTR), #2						      ; 1072
				       0A  12 00322 	    BNEQ    3$							      ;
				  04   AA  D5 00324 	    TSTL    4(SAVTYP)						      ; 1073
				       05  13 00327 	    BEQL    3$							      ;
				  08   AA  D5 00329 	    TSTL    8(SAVTYP)						      ; 1074
				       18  13 0032C 	    BEQL    6$							      ;
				       50  D4 0032E 3$:     CLRL    R0							      ; 1081
		         0E 	       55  D1 00330 	    CMPL    R5, #14						      ;
				       04  12 00333 	    BNEQ    4$							      ;
				       50  D6 00335 	    INCL    R0							      ;
				       05  11 00337 	    BRB     5$							      ;
		         0D 	       55  D1 00339 4$:     CMPL    R5, #13						      ;
				       1C  12 0033C 	    BNEQ    9$							      ;
				  04   AA  D5 0033E 5$:     TSTL    4(SAVTYP)						      ; 1084
				       10  12 00341 	    BNEQ    8$							      ;
		         03 	       50  E8 00343 	    BLBS    R0, 7$						      ; 1086
				     00FE  31 00346 6$:     BRW     27$							      ;
		    04   AA	       01  D0 00349 7$:     MOVL    #1, 4(SAVTYP)					      ; 1091
		    04   AB	       01  D0 0034D 	    MOVL    #1, 4(SAVVAL)					      ; 1092
				       07  11 00351 	    BRB     9$							      ; 1086
				       05  15 00353 8$:     BLEQ    9$							      ; 1099
				  04   AB  D5 00355 	    TSTL    4(SAVVAL)						      ;
				       EC  19 00358 	    BLSS    6$							      ;
		         0F 	       55  D1 0035A 9$:     CMPL    R5, #15						      ; 1104
				       0A  12 0035D 	    BNEQ    10$							      ;
				  04   AB  D5 0035F 	    TSTL    4(SAVVAL)						      ;
				       E2  19 00362 	    BLSS    6$							      ;
				  04   AA  D5 00364 	    TSTL    4(SAVTYP)						      ;
				       DD  15 00367 	    BLEQ    6$							      ;
				       54  D4 00369 10$:    CLRL    VFEM						      ; 1110
				       6A  D5 0036B 	    TSTL    (SAVTYP)						      ; 1118
				       07  15 0036D 	    BLEQ    11$							      ;
				       0A  15 0036F 	    BLEQ    12$							      ; 1119

; Bliss-32 10.1-416	Monday 21-AUG-1978 19:17:23	DBB3:[RTL.SRC]FFMTCP.B32;17					Page 5-5
;
		         01 	       6B  D1 00371 	    CMPL    (SAVVAL), #1					      ;
				       05  12 00374 	    BNEQ    12$							      ;
		         54 	       03  8A 00376 11$:    BICB2   #3, VFEM						      ; 1121
				       0C  11 00379 	    BRB     13$							      ; 1117
				       6B  DD 0037B 12$:    PUSHL   (SAVVAL)						      ; 1123
		  0000V  CF	       01  FB 0037D 	    CALLS   #1, BYTSIZ						      ;
	   02 	         00 	       50  F0 00382 	    INSV    R0, #0, #2, VFEM					      ;
				       54     00386									      ;
		         0C 	       55  D1 00387 13$:    CMPL    R5, #12						      ; 1125
				       1D  13 0038A 	    BEQL    14$							      ;
	      FFFFFFFF   8F	  04   AA  D1 0038C 	    CMPL    4(SAVTYP), #-1					      ;
				       13  13 00394 	    BEQL    14$							      ;
				  04   AB  DD 00396 	    PUSHL   4(SAVVAL)						      ; 1127
		  0000V  CF	       01  FB 00399 	    CALLS   #1, BYTSIZ						      ;
		         51 	  FF   A0  9E 0039E 	    MOVAB   -1(R0), R1						      ;
	   01 	         02 	       51  F0 003A2 	    INSV    R1, #2, #1, VFEM					      ;
				       54     003A6									      ;
				       03  11 003A7 	    BRB     15$							      ; 1125
		         54 	       04  8A 003A9 14$:    BICB2   #4, VFEM						      ; 1129
				       52  D4 003AC 15$:    CLRL    R2							      ; 1131
				       54  D5 003AE 	    TSTL    VFEM						      ;
				       06  13 003B0 	    BEQL    16$							      ;
				       52  D6 003B2 	    INCL    R2							      ;
		         53 	  80   8F  88 003B4 	    BISB2   #128, FC						      ;
				       53  DD 003B8 16$:    PUSHL   FC							      ; 1137
		         66 	       01  FB 003BA 	    CALLS   #1, PUTBYT						      ;
		         05 	       52  E9 003BD 	    BLBC    R2, 17$						      ; 1138
				       54  DD 003C0 	    PUSHL   VFEM						      ;
		         66 	       01  FB 003C2 	    CALLS   #1, PUTBYT						      ;
				       52  D4 003C5 17$:    CLRL    I							      ; 1139
	   02 FFFFFFFF   8F	     6A42  CF 003C7 18$:    CASEL   (SAVTYP)[I], #-1, #2				      ; 1140
	 0008 	       0084 	     0077     003D0 19$:    .WORD   27$-19$,-						      ;
								    30$-19$,-						      ;
								    20$-19$						      ;
				       6F  11 003D6 	    BRB     27$							      ; 1147
	   02 	         00 	       52  CF 003D8 20$:    CASEL   I, #0, #2						      ; 1160
	 005C 	       0025 	     0006     003DC 21$:    .WORD   22$-21$,-						      ;
								    23$-21$,-						      ;
								    26$-21$						      ;
				       6B  D5 003E2 22$:    TSTL    (SAVVAL)						      ; 1167
				       61  15 003E4 	    BLEQ    27$							      ;
		         01 	       6B  D1 003E6 	    CMPL    (SAVVAL), #1					      ; 1170
				       69  13 003E9 	    BEQL    30$							      ;
				       6B  DD 003EB 	    PUSHL   (SAVVAL)						      ; 1173
		         66 	       01  FB 003ED 	    CALLS   #1, PUTBYT						      ;
	   54 	         02 	       00  ED 003F0 	    CMPZV   #0, #2, VFEM, #2					      ; 1174
				       02     003F4									      ;
				       5D  12 003F5 	    BNEQ    30$							      ;
	   7E 	         6B 00000100   8F  C7 003F7 	    DIVL3   #256, (SAVVAL), -(SP)				      ; 1176
				       50  11 003FF 	    BRB     29$							      ;
		         0C 	       55  D1 00401 23$:    CMPL    R5, #12						      ; 1184
				       18  12 00404 	    BNEQ    24$							      ;
		         53 	  04   AB  D0 00406 	    MOVL    4(SAVVAL), R3					      ; 1188
	      FFFFFF80   8F	       53  D1 0040A 	    CMPL    R3, #-128						      ;
				       34  19 00411 	    BLSS    27$							      ;

; Bliss-32 10.1-416	Monday 21-AUG-1978 19:17:23	DBB3:[RTL.SRC]FFMTCP.B32;17					Page 5-6
;
	      0000007F   8F	       53  D1 00413 	    CMPL    R3, #127						      ; 1189
				       08  15 0041A 	    BLEQ    25$							      ;
				       29  11 0041C 	    BRB     27$							      ; 1191
		         53 	  04   AB  D0 0041E 24$:    MOVL    4(SAVVAL), R3					      ; 1195
				       23  13 00422 	    BEQL    27$							      ;
				       53  DD 00424 25$:    PUSHL   R3							      ; 1198
		         66 	       01  FB 00426 	    CALLS   #1, PUTBYT						      ;
	   27 	         54 	       02  E1 00429 	    BBC     #2, VFEM, 30$					      ; 1199
	   7E 	    04   AB 00000100   8F  C7 0042D 	    DIVL3   #256, 4(SAVVAL), -(SP)				      ; 1201
				       19  11 00436 	    BRB     29$							      ;
		         53 	  08   AB  D0 00438 26$:    MOVL    8(SAVVAL), R3					      ; 1209
				       09  19 0043C 	    BLSS    27$							      ;
	      000000FF   8F	       53  D1 0043E 	    CMPL    R3, #255						      ; 1210
				       08  15 00445 	    BLEQ    28$							      ;
				       3E  DD 00447 27$:    PUSHL   #62							      ; 1212
		  0000G  CF	       01  FB 00449 	    CALLS   #1, FOR$$SIGNAL_STO					      ;
					   04 0044E 	    RET     							      ;
				       53  DD 0044F 28$:    PUSHL   R3							      ; 1213
		         66 	       01  FB 00451 29$:    CALLS   #1, PUTBYT						      ;
	   52 	         01 	       02  F1 00454 30$:    ACBL    #2, #1, I, 18$					      ; 1139
				     FF6D     00458									      ;
	   00 	         6E 	       00  2C 0045A 31$:    MOVC5   #0, (SP), #0, #36, (SAVVAL)				      ; 1224
		         6B 	       24     0045E									      ;
					   04 00460 	    RET     							      ; 1001

; Routine Size:  358 bytes


;22600  1226	
;22700  1227	

; Bliss-32 10.1-416	Monday 21-AUG-1978 19:17:23	DBB3:[RTL.SRC]FFMTCP.B32;17					Page 6
;
;00100  1228	ROUTINE DEFER(C,N): CALL_G3 NOVALUE =
;00200  1229	
;00300  1230	!++
;00400  1231	! FUNCTIONAL DESCRIPTION:
;00500  1232	!
;00600  1233	!	Cuase the reduction of the current format item to be deferred
;00700  1234	!	until the W.D portion has been read
;00800  1235	!
;00900  1236	! FORMAL PARAMETERS:
;01000  1237	!
;01100  1238	!	C	- format code
;01200  1239	!	N	- number of parameters to follow (1 or 2)
;01300  1240	!
;01400  1241	! IMPLICIT INPUTS:
;01500  1242	!
;01600  1243	!	FMTDAT array
;01700  1244	!
;01800  1245	!
;01900  1246	! IMPLICIT OUTPUTS:
;02000  1247	!
;02100  1248	!	repetition count, if any, saved in FMTDAT
;02200  1249	!	format code and parameter count saved also in FMTDAT
;02300  1250	!
;02400  1251	! ROUTINE VALUE:
;02500  1252	!
;02600  1253	!	NONE
;02700  1254	!
;02800  1255	! SIDE EFFECTS:
;02900  1256	!
;03000  1257	!	SIGNAL_STOPs FOR$SYNERRFOR (62="SYNTAX ERROR IN FORMAT")
;03100  1258	!
;03200  1259	!--
;03300  1260	
;03400  1261	    BEGIN
;03500  1262	
;03600  1263	    EXT_REG;			! Declare external registers
;03700  1264	
;03800  1265	    NZERO();
;03900  1266	    NSAVE();
;04000  1267	    PTR[L_FDEFER] = .C;
;04100  1268	    PTR[L_FCOUNT] = .N;
;04200  1269	    END;





					 0000 00461 DEFER:  .WORD   Save nothing					      ; 1228
		  0000V  CF	       00  FB 00463 	    CALLS   #0, NZERO						      ; 1265
		  0000V  CF	       00  FB 00468 	    CALLS   #0, NSAVE						      ; 1266
		         69 	  04   AC  7D 0046D 	    MOVQ    C, (PTR)						      ; 1267
					   04 00471 	    RET     							      ; 1228

; Routine Size:  17 bytes


; Bliss-32 10.1-416	Monday 21-AUG-1978 19:17:23	DBB3:[RTL.SRC]FFMTCP.B32;17					Page 6-1
;

;04300  1270	
;04400  1271	

; Bliss-32 10.1-416	Monday 21-AUG-1978 19:17:23	DBB3:[RTL.SRC]FFMTCP.B32;17					Page 7
;
;00100  1272	ROUTINE UNDEFER: CALL_G3 NOVALUE =
;00200  1273	
;00300  1274	!++
;00400  1275	! FUNCTIONAL DESCRIPTION:
;00500  1276	!
;00600  1277	!	Complete the reduction of a format item which was deferred
;00700  1278	!
;00800  1279	! FORMAL PARAMETERS:
;00900  1280	!
;01000  1281	!
;01100  1282	! IMPLICIT INPUTS:
;01200  1283	!
;01300  1284	!	FMTDAT array
;01400  1285	!
;01500  1286	! IMPLICIT OUTPUTS:
;01600  1287	!
;01700  1288	!	FMTDAT array
;01800  1289	!
;01900  1290	! ROUTINE VALUE:
;02000  1291	!
;02100  1292	!	NONE
;02200  1293	!
;02300  1294	! SIDE EFFECTS:
;02400  1295	!
;02500  1296	!	SIGNAL_STOPs FOR$SYNERRFOR (62="SYNTAX ERROR IN FORMAT")
;02600  1297	!
;02700  1298	!--
;02800  1299	
;02900  1300	    BEGIN
;03000  1301	
;03100  1302	    EXT_REG;			! Declare external registers
;03200  1303	
;03300  1304	    IF .PTR[L_FDEFER] NEQ 0
;03400  1305	    THEN
;03500  1306		BEGIN
;03600  1307		NSAVE();
;03700  1308		REDUCE(.PTR[L_FDEFER]);
;03800  1309		END
;03900  1310	    ELSE
;04000  1311		BEGIN
;04100  1312		IF .PTR[L_TYPE] NEQ 0 THEN ERROR(ERRFMXTNUM);
;04200  1313		IF .PTR[L_SIGN] NEQ 0 THEN ERROR(ERRFMTCHAR);
;04300  1314		PTR[L_NVAL] = 0;
;04400  1315		PTR[L_TYPE] = 0;
;04500  1316		PTR[L_SIGN] = 0;
;04600  1317		END;
;04700  1318	    END;





					 0000 00472 UNDEFER:.WORD   Save nothing					      ; 1272
				       69  D5 00474 	    TSTL    (PTR)						      ; 1304
				       0D  13 00476 	    BEQL    1$							      ;

; Bliss-32 10.1-416	Monday 21-AUG-1978 19:17:23	DBB3:[RTL.SRC]FFMTCP.B32;17					Page 7-1
;
		  0000V  CF	       00  FB 00478 	    CALLS   #0, NSAVE						      ; 1307
				       69  DD 0047D 	    PUSHL   (PTR)						      ; 1308
		  FE77   CF	       01  FB 0047F 	    CALLS   #1, REDUCE						      ;
					   04 00484 	    RET     							      ; 1304
				  18   A9  D5 00485 1$:     TSTL    24(PTR)						      ; 1312
				       05  12 00488 	    BNEQ    2$							      ;
				  10   A9  D5 0048A 	    TSTL    16(PTR)						      ; 1313
				       08  13 0048D 	    BEQL    3$							      ;
				       3E  DD 0048F 2$:     PUSHL   #62							      ;
		  0000G  CF	       01  FB 00491 	    CALLS   #1, FOR$$SIGNAL_STO					      ;
					   04 00496 	    RET     							      ;
				  14   A9  7C 00497 3$:     CLRQ    20(PTR)						      ; 1314
				  10   A9  D4 0049A 	    CLRL    16(PTR)						      ; 1316
					   04 0049D 	    RET     							      ; 1272

; Routine Size:  44 bytes


;04800  1319	
;04900  1320	

; Bliss-32 10.1-416	Monday 21-AUG-1978 19:17:23	DBB3:[RTL.SRC]FFMTCP.B32;17					Page 8
;
;00100  1321	ROUTINE NZERO: CALL_G3 NOVALUE =
;00200  1322	
;00300  1323	!++
;00400  1324	! FUNCTIONAL DESCRIPTION:
;00500  1325	!
;00600  1326	!	Check context for a format item with has an optional leading
;00700  1327	!	number field. If there is a deferred item, then a separator is 
;00800  1328	!	required, and we have an ambiguous case.  The leading numeric
;00900  1329	!	will be attached to the preceding format item.
;01000  1330	!
;01100  1331	! FORMAL PARAMETERS:
;01200  1332	!
;01300  1333	!	None
;01400  1334	!
;01500  1335	! IMPLICIT INPUTS:
;01600  1336	!
;01700  1337	!	FMTDAT array
;01800  1338	!
;01900  1339	!
;02000  1340	! IMPLICIT OUTPUTS:
;02100  1341	!
;02200  1342	!	NONE
;02300  1343	!
;02400  1344	! ROUTINE VALUE:
;02500  1345	!
;02600  1346	!	NONE
;02700  1347	!
;02800  1348	! SIDE EFFECTS:
;02900  1349	!
;03000  1350	!	SIGNAL_STOPs FOR$SYNERRFOR (62="SYNTAX ERROR IN FORMAT")
;03100  1351	!
;03200  1352	!--
;03300  1353	
;03400  1354	    BEGIN
;03500  1355	
;03600  1356	    EXT_REG;			! Declare external registers
;03700  1357	
;03800  1358	    IF .PTR[L_FDEFER] NEQ 0
;03900  1359	    THEN
;04000  1360		ERROR(ERRFMTSEPR);
;04100  1361	    END;





					 0000 0049E NZERO:  .WORD   Save nothing					      ; 1321
				       69  D5 004A0 	    TSTL    (PTR)						      ; 1358
				       07  13 004A2 	    BEQL    1$							      ;
				       3E  DD 004A4 	    PUSHL   #62							      ; 1360
		  0000G  CF	       01  FB 004A6 	    CALLS   #1, FOR$$SIGNAL_STO					      ;
					   04 004AB 1$:     RET     							      ; 1321

; Routine Size:  14 bytes


; Bliss-32 10.1-416	Monday 21-AUG-1978 19:17:23	DBB3:[RTL.SRC]FFMTCP.B32;17					Page 8-1
;

;04200  1362	
;04300  1363	

; Bliss-32 10.1-416	Monday 21-AUG-1978 19:17:23	DBB3:[RTL.SRC]FFMTCP.B32;17					Page 9
;
;00100  1364	ROUTINE NSAVE: CALL_G3 NOVALUE =
;00200  1365	
;00300  1366	!++
;00400  1367	! FUNCTIONAL DESCRIPTION:
;00500  1368	!
;00600  1369	!	Save the values of PTR[L_NVAL] and PTR[L_TYPE] in SAVTYP and SAVVAL
;00700  1370	!
;00800  1371	! FORMAL PARAMETERS:
;00900  1372	!
;01000  1373	!	None
;01100  1374	!
;01200  1375	! IMPLICIT INPUTS:
;01300  1376	!
;01400  1377	!	PTR[L_NVAL]	- value of a  numeric term
;01500  1378	!	PTR[L_TYPE]	- PTR[L_TYPE] of the numeric term
;01600  1379	!	PTR[L_SIGN]	- indicator if a minus PTR[L_SIGN] has been encounted
;01700  1380	!	PTR[L_PHASE]	- indicator of what the PTR[L_NVAL] and PTR[L_TYPE] associate
;01800  1381	!		  to repetition count, W or D.
;01900  1382	!
;02000  1383	! IMPLICIT OUTPUTS:
;02100  1384	!
;02200  1385	!	FMTDAT array
;02300  1386	!
;02400  1387	! ROUTINE VALUE:
;02500  1388	!
;02600  1389	!	NONE
;02700  1390	!
;02800  1391	! SIDE EFFECTS:
;02900  1392	!
;03000  1393	!	SIGNAL_STOPs FOR$SYNERRFOR (62="SYNTAX ERROR IN FORMAT")
;03100  1394	!
;03200  1395	!--
;03300  1396	
;03400  1397	    BEGIN
;03500  1398	
;03600  1399	    EXT_REG;			! Declare external registers
;03700  1400	
;03800  1401	    IF .PTR[L_SIGN] NEQ 0 THEN ERROR(ERRFMTPTR[L_SIGN]);
;03900  1402	    SAVVAL[.PTR[L_PHASE]] = .PTR[L_NVAL];
;04000  1403	    SAVTYP[.PTR[L_PHASE]] = .PTR[L_TYPE];
;04100  1404	    PTR[L_PHASE] = .PTR[L_PHASE] + 1;
;04200  1405	    PTR[L_SIGN] = 0;
;04300  1406	    PTR[L_NVAL] = 0;
;04400  1407	    PTR[L_TYPE] = 0;
;04500  1408	    END;





					 0000 004AC NSAVE:  .WORD   Save nothing					      ; 1364
				  10   A9  D5 004AE 	    TSTL    16(PTR)						      ; 1401
				       08  13 004B1 	    BEQL    1$							      ;
				       3E  DD 004B3 	    PUSHL   #62							      ;
		  0000G  CF	       01  FB 004B5 	    CALLS   #1, FOR$$SIGNAL_STO					      ;

; Bliss-32 10.1-416	Monday 21-AUG-1978 19:17:23	DBB3:[RTL.SRC]FFMTCP.B32;17					Page 9-1
;
					   04 004BA 	    RET     							      ;
		         50 	  08   A9  D0 004BB 1$:     MOVL    8(PTR), R0						      ; 1402
		       6B40 	  14   A9  D0 004BF 	    MOVL    20(PTR), (SAVVAL)[R0]				      ;
		       6A40 	  18   A9  D0 004C4 	    MOVL    24(PTR), (SAVTYP)[R0]				      ; 1403
				  08   A9  D6 004C9 	    INCL    8(PTR)						      ; 1404
				  10   A9  7C 004CC 	    CLRQ    16(PTR)						      ; 1405
				  18   A9  D4 004CF 	    CLRL    24(PTR)						      ; 1407
					   04 004D2 	    RET     							      ; 1364

; Routine Size:  39 bytes


;04600  1409	
;04700  1410	

; Bliss-32 10.1-416	Monday 21-AUG-1978 19:17:23	DBB3:[RTL.SRC]FFMTCP.B32;17					Page 10
;
;00100  1411	ROUTINE PUTBYT(V): CALL_G3 NOVALUE =
;00200  1412	
;00300  1413	!++
;00400  1414	! FUNCTIONAL DESCRIPTION:
;00500  1415	!
;00600  1416	!	Output a byte through argument
;00700  1417	!
;00800  1418	! FORMAL PARAMETERS:
;00900  1419	!
;01000  1420	!	V	- vaule to be output
;01100  1421	!
;01200  1422	! IMPLICIT INPUTS:
;01300  1423	!
;01400  1424	!	FMTDAT array
;01500  1425	!
;01600  1426	! IMPLICIT OUTPUTS:
;01700  1427	!
;01800  1428	!	FMTDAT array
;01900  1429	!
;02000  1430	! ROUTINE VALUE:
;02100  1431	!
;02200  1432	!	NONE
;02300  1433	!
;02400  1434	! SIDE EFFECTS:
;02500  1435	!
;02600  1436	!	SIGNAL_STOPs FOR$SYNERRFOR (62="SYNTAX ERROR IN FORMAT")
;02700  1437	!
;02800  1438	!--
;02900  1439	
;03000  1440	    BEGIN
;03100  1441	
;03200  1442	    LOCAL
;03300  1443		A_OLD_BUF_BEG;		! Place to save old format buffer address
;03400  1444	
;03500  1445	    EXT_REG;			! Declare external registers
;03600  1446	
;03700  1447	    !+
;03800  1448	    ! Check if room in currently allocated format buffer.
;03900  1449	    ! If not allocate twice as much and copy old format buffer,
;04000  1450	    ! then deallocate old format buffer.
;04100  1451	    !-
;04200  1452	
;04300  1453	    IF .PTR[L_NCHAR] GEQ .PTR[L_FMT_BUF_SIZ]
;04400  1454	    THEN
;04500  1455		BEGIN
;04600  1456		A_OLD_BUF_BEG = .PTR[A_FMT_BUF_BEG];
;04610  1457		IF .PTR[L_FMT_BUF_SIZ] GEQ 32768 THEN ERROR ();
;04700  1458		PTR[A_FMT_BUF_BEG] = FOR$$GET_VM (.PTR[L_FMT_BUF_SIZ] * 2);
;04800  1459		CH$MOVE (.PTR[L_FMT_BUF_SIZ], .A_OLD_BUF_BEG, .PTR[A_FMT_BUF_BEG]);
;04900  1460		FOR$$FREE_VM (.PTR[L_FMT_BUF_SIZ], .A_OLD_BUF_BEG);
;05000  1461		PTR[L_FMT_BUF_SIZ] = .PTR[L_FMT_BUF_SIZ] * 2;
;05100  1462		END;
;05200  1463	
;05300  1464	    !+
;05400  1465	    ! Store away the byte in format buffer

; Bliss-32 10.1-416	Monday 21-AUG-1978 19:17:23	DBB3:[RTL.SRC]FFMTCP.B32;17					Page 10-1
;
;05500  1466	    !-
;05600  1467	
;05700  1468	    (.PTR[A_FMT_BUF_BEG] + .PTR[L_NCHAR])<0,8> = .V;
;05800  1469	    PTR[L_NCHAR] = .PTR[L_NCHAR] + 1;
;05900  1470	    END;





					 00FC 004D3 PUTBYT: .WORD   Save R2,R3,R4,R5,R6,R7				      ; 1411
		         57 	  28   A9  D0 004D5 	    MOVL    40(PTR), R7						      ; 1453
		         57 	  1C   A9  D1 004D9 	    CMPL    28(PTR), R7						      ;
				       34  19 004DD 	    BLSS    2$							      ;
		         56 	  20   A9  D0 004DF 	    MOVL    32(PTR), A_OLD_BUF_BEG				      ; 1456
	      00008000   8F	       57  D1 004E3 	    CMPL    R7, #32768						      ; 1457
				       08  19 004EA 	    BLSS    1$							      ;
				       3E  DD 004EC 	    PUSHL   #62							      ;
		  0000G  CF	       01  FB 004EE 	    CALLS   #1, FOR$$SIGNAL_STO					      ;
					   04 004F3 	    RET     							      ;
	   7E 	         57 	       01  78 004F4 1$:     ASHL    #1, R7, -(SP)					      ; 1458
		  0000G  CF	       01  FB 004F8 	    CALLS   #1, FOR$$GET_VM					      ;
		    20   A9	       50  D0 004FD 	    MOVL    R0, 32(PTR)						      ;
      20   B9	         66 	       57  28 00501 	    MOVC3   R7, (A_OLD_BUF_BEG), @32(PTR)			      ; 1459
				       56  DD 00506 	    PUSHL   A_OLD_BUF_BEG					      ; 1460
				       57  DD 00508 	    PUSHL   R7							      ;
		  0000G  CF	       02  FB 0050A 	    CALLS   #2, FOR$$FREE_VM					      ;
		    28   A9	       02  C4 0050F 	    MULL2   #2, 40(PTR)						      ; 1461
	   50 	    20   A9	  1C   A9  C1 00513 2$:     ADDL3   28(PTR), 32(PTR), R0				      ; 1468
		         60 	  04   AC  90 00519 	    MOVB    V, (R0)						      ;
				  1C   A9  D6 0051D 	    INCL    28(PTR)						      ; 1469
					   04 00520 	    RET     							      ; 1411

; Routine Size:  78 bytes


;06000  1471	
;06100  1472	

; Bliss-32 10.1-416	Monday 21-AUG-1978 19:17:23	DBB3:[RTL.SRC]FFMTCP.B32;17					Page 11
;
;00100  1473	ROUTINE BYTSIZ(VAL) =
;00200  1474	
;00300  1475	!++
;00400  1476	! FUNCTIONAL DESCRIPTION:
;00500  1477	!
;00600  1478	!	Calculate the number of bytes to hold VAL
;00700  1479	!
;00800  1480	! FORMAL PARAMETERS:
;00900  1481	!
;01000  1482	!	VAL	- value to be sized
;01100  1483	!
;01200  1484	! IMPLICIT INPUTS:
;01300  1485	!
;01400  1486	!	NONE
;01500  1487	!
;01600  1488	!
;01700  1489	! IMPLICIT OUTPUTS:
;01800  1490	!
;01900  1491	!	NONE
;02000  1492	!
;02100  1493	! ROUTINE VALUE:
;02200  1494	!
;02300  1495	!	NONE
;02400  1496	!
;02500  1497	! SIDE EFFECTS:
;02600  1498	!
;02700  1499	!	SIGNAL_STOPs FOR$SYNERRFOR (62="SYNTAX ERROR IN FORMAT")
;02800  1500	!
;02900  1501	!--
;03000  1502	
;03100  1503	    BEGIN
;03200  1504	    MAP VAL: LONG UNSIGNED;
;03300  1505	    IF .VAL LSS 0
;03400  1506	    THEN
;03500  1507		ERROR (ERRFMTRNGE)
;03600  1508	    ELSE
;03700  1509		IF .VAL LSS 256
;03800  1510		THEN
;03900  1511		    RETURN 1
;04000  1512		ELSE
;04100  1513		    IF .VAL LSS 65536
;04200  1514		    THEN
;04300  1515			RETURN 2
;04400  1516		    ELSE
;04500  1517			ERROR (ERRFMTRNGE);
;04600  1518	    END;





					 0004 00521 BYTSIZ: .WORD   Save R2						      ; 1473
		         52 	  04   AC  D0 00523 	    MOVL    VAL, R2						      ; 1505
				       1A  19 00527 	    BLSS    2$							      ;
	      00000100   8F	       52  D1 00529 	    CMPL    R2, #256						      ; 1509

; Bliss-32 10.1-416	Monday 21-AUG-1978 19:17:23	DBB3:[RTL.SRC]FFMTCP.B32;17					Page 11-1
;
				       04  18 00530 	    BGEQ    1$							      ;
		         50 	       01  D0 00532 	    MOVL    #1, R0						      ; 1511
					   04 00535 	    RET     							      ;
	      00010000   8F	       52  D1 00536 1$:     CMPL    R2, #65536						      ; 1513
				       04  18 0053D 	    BGEQ    2$							      ;
		         50 	       02  D0 0053F 	    MOVL    #2, R0						      ; 1515
					   04 00542 	    RET     							      ;
				       3E  DD 00543 2$:     PUSHL   #62							      ; 1517
		  0000G  CF	       01  FB 00545 	    CALLS   #1, FOR$$SIGNAL_STO					      ;
				       50  D4 0054A 	    CLRL    R0							      ; 1473
					   04 0054C 	    RET     							      ;

; Routine Size:  44 bytes



; Bliss-32 10.1-416	Monday 21-AUG-1978 19:17:23	DBB3:[RTL.SRC]FFMTCP.B32;17					Page 12
;
;00100  1519	END ELUDOM






;				       PSECT SUMMARY
;
;	Name		 Bytes			       Attributes
;
;  FOR$CODE       	  1357  NOWRT,  RD ,  EXE,  SHR,  LCL,  REL,  CON,  PIC,ALIGN(2)





; Size:		1265 code + 92 data bytes
; Run Time:	00:32.0
; Elapsed Time:	01:07.5
; Memory Used:	199 pages
; Compilation Complete
