
; Bliss-32 7.352	Saturday 21-AUG-1978 23:50:01	DBB3:[MOUNT.SRC]CHKHM2.B32;8					Page 1
; Digital Equipment Corporation
;
;	0001	MODULE CHKHM2 (
;	0002			LANGUAGE (BLISS32),
;	0003			IDENT = 'X0001'
;	0004			) =
;	0005	BEGIN
;	0006	
;	0007	!
;	0008	! Copyright (c) 1977
;	0009	! Digital Equipment Corporation, Maynard, Massachusetts 01754
;	0010	!
;	0011	! This software is furnished  under a license for use only on a single
;	0012	! computer  system and  may be  copied only with  the inclusion of the
;	0013	! above copyright notice.  This software, or any other copies thereof,
;	0014	! may not be provided or  otherwise made available to any other person
;	0015	! except for use on such system and to one who agrees to these license
;	0016	! terms.  Title to and  ownership of the  software  shall at all times
;	0017	! remain in DEC.
;	0018	!
;	0019	! The information in this software is subject to change without notice
;	0020	! and should  not be construed  as a commitment  by Digital  Equipment
;	0021	! Corporation.
;	0022	!
;	0023	! DEC assumes  no  responsibility  for  the use or  reliability of its
;	0024	! software on equipment which is not supplied by DEC.
;	0025	
;	0026	!++
;	0027	!
;	0028	! FACILITY:  MOUNT Utility Structure Level 2
;	0029	!
;	0030	! ABSTRACT:
;	0031	!
;	0032	!	This routine verifies whether a given block is Files-11 Structure
;	0033	!	Level 2 home block.
;	0034	!
;	0035	! ENVIRONMENT:
;	0036	!
;	0037	!	STARLET operating system, including privileged system services
;	0038	!	and internal exec routines.
;	0039	!
;	0040	!--
;	0041	!
;	0042	!
;	0043	! AUTHOR:  Andrew C. Goldstein,	 CREATION DATE:  21-Nov-1977  19:23
;	0044	!
;	0045	! REVISION HISTORY:
;	0046	!
;	0047	!**
;	0048	
;	0049	
;	0050	LIBRARY 'SYS$LIBRARY:LIB.L32';
;	0051	REQUIRE 'SRC$:MOUDEF.B32';
;	0358	REQUIRE 'LIBD$:[VMSLIB.OBJ]MOUNTMSG.B32';

; Bliss-32 7.352	Saturday 21-AUG-1978 23:50:01	DBB3:[MOUNT.SRC]CHKHM2.B32;8					Page 2
; Digital Equipment Corporation
;
;	0458	GLOBAL ROUTINE CHECK_HOMEBLK2 (HOME_BLOCK, LBN, VOLUME_LABEL) =
;	0459	
;	0460	!++
;	0461	!
;	0462	! FUNCTIONAL DESCRIPTION:
;	0463	!
;	0464	!	This routine verifies whether the given block is a Files-11 Structure
;	0465	!	Level 2 home block.
;	0466	!
;	0467	!
;	0468	! CALLING SEQUENCE:
;	0469	!	CHECK_HOMEBLK2 (ARG1, ARG2, ARG3)
;	0470	!
;	0471	! INPUT PARAMETERS:
;	0472	!	ARG1: address of buffer containing block
;	0473	!	ARG2: LBN of block
;	0474	!	ARG3: string descriptor of user specified volume label
;	0475	!
;	0476	! IMPLICIT INPUTS:
;	0477	!	NONE
;	0478	!
;	0479	! OUTPUT PARAMETERS:
;	0480	!	NONE
;	0481	!
;	0482	! IMPLICIT OUTPUTS:
;	0483	!	MOUNT_OPTIONS: structure level 2 bit set if so
;	0484	!
;	0485	! ROUTINE VALUE:
;	0486	!	1 if valid and correct
;	0487	!	0 if not
;	0488	!	SS$_INCVOLLABEL if valid but volume label is wrong
;	0489	!
;	0490	! SIDE EFFECTS:
;	0491	!	NONE
;	0492	!
;	0493	!--
;	0494	
;	0495	BEGIN
;	0496	
;	0497	MAP
;	0498		HOME_BLOCK	: REF BBLOCK,	! home block buffer
;	0499		VOLUME_LABEL	: REF VECTOR;	! volume label descriptor
;	0500	
;	0501	EXTERNAL
;	0502		MOUNT_OPTIONS	: BITVECTOR;	! command options
;	0503	
;	0504	EXTERNAL ROUTINE
;	0505		CHECKSUM2;			! compute home block checksums
;	0506	
;	0507	
;	0508	! Check the required non-zero fields and compute the checksums.
;	0509	!
;	0510	
;	0511	IF NOT (
;	0512		.HOME_BLOCK[HM2$L_HOMELBN] EQL .LBN

; Bliss-32 7.352	Saturday 21-AUG-1978 23:50:01	DBB3:[MOUNT.SRC]CHKHM2.B32;8					Page 2-1
; Digital Equipment Corporation
;
;	0513	    AND .HOME_BLOCK[HM2$L_ALTIDXLBN] NEQ 0
;	0514	    AND .HOME_BLOCK[HM2$W_CLUSTER] NEQ 0
;	0515	    AND .HOME_BLOCK[HM2$W_HOMEVBN] NEQ 0
;	0516	    AND .HOME_BLOCK[HM2$W_ALHOMEVBN] NEQ 0
;	0517	    AND .HOME_BLOCK[HM2$W_ALTIDXVBN] NEQ 0
;	0518	    AND .HOME_BLOCK[HM2$W_IBMAPVBN] NEQ 0
;	0519	    AND .HOME_BLOCK[HM2$L_IBMAPLBN] NEQ 0
;	0520	    AND .HOME_BLOCK[HM2$L_MAXFILES] NEQ 0
;	0521	    AND .HOME_BLOCK[HM2$W_IBMAPSIZE] NEQ 0
;	0522	    AND .HOME_BLOCK[HM2$W_RESFILES] NEQ 0
;	0523	    AND CHECKSUM2 (.HOME_BLOCK, $BYTEOFFSET (HM2$W_CHECKSUM1))
;	0524	    AND CHECKSUM2 (.HOME_BLOCK, $BYTEOFFSET (HM2$W_CHECKSUM2))
;	0525		)
;	0526	THEN RETURN 0;
;	0527	
;	0528	MOUNT_OPTIONS[OPT_IS_FILES11B] = 1;	! set structure level 2 flag
;	0529	
;	0530	IF CH$NEQ (.VOLUME_LABEL[0], .VOLUME_LABEL[1],
;	0531		   HM2$S_VOLNAME, HOME_BLOCK[HM2$T_VOLNAME], ' ')
;	0532	THEN RETURN (SS$_INCVOLLABEL);
;	0533	
;	0534	RETURN 1;
;	0535	
;	0536	END;					! end of routine CHECK_HOMEBLK2


							    .TITLE  CHKHM2
							    .IDENT  \X0001\

							    .GLOBL  MOUNT_OPTIONS, CHECKSUM2

							    .PSECT  $CODE$,NOWRT,2

					 000C 00000 	    .ENTRY  CHECK_HOMEBLK2, Save R2,R3				      ; 0458
		         52	  04   AC  D0 00002 	    MOVL    HOME_BLOCK, R2					      ; 0512
		    08   AC	       62  D1 00006 	    CMPL    (R2), LBN						      ;
				       6C  12 0000A 	    BNEQ    3$							      ;
				  08   A2  D5 0000C 	    TSTL    8(R2)						      ; 0513
				       67  13 0000F 	    BEQL    3$							      ;
				  0E   A2  B5 00011 	    TSTW    14(R2)						      ; 0514
				       62  13 00014 	    BEQL    3$							      ;
				  10   A2  B5 00016 	    TSTW    16(R2)						      ; 0515
				       5D  13 00019 	    BEQL    3$							      ;
				  12   A2  B5 0001B 	    TSTW    18(R2)						      ; 0516
				       58  13 0001E 	    BEQL    3$							      ;
				  14   A2  B5 00020 	    TSTW    20(R2)						      ; 0517
				       53  13 00023 	    BEQL    3$							      ;
				  16   A2  B5 00025 	    TSTW    22(R2)						      ; 0518
				       4E  13 00028 	    BEQL    3$							      ;
				  18   A2  D5 0002A 	    TSTL    24(R2)						      ; 0519
				       49  13 0002D 	    BEQL    3$							      ;
				  1C   A2  D5 0002F 	    TSTL    28(R2)						      ; 0520
				       44  13 00032 	    BEQL    3$							      ;
				  20   A2  B5 00034 	    TSTW    32(R2)						      ; 0521
				       3F  13 00037 	    BEQL    3$							      ;

; Bliss-32 7.352	Saturday 21-AUG-1978 23:50:01	DBB3:[MOUNT.SRC]CHKHM2.B32;8					Page 2-2
; Digital Equipment Corporation
;
				  22   A2  B5 00039 	    TSTW    34(R2)						      ; 0522
				       3A  13 0003C 	    BEQL    3$							      ;
				       3A  DD 0003E 	    PUSHL   #58							      ; 0523
				       52  DD 00040 	    PUSHL   R2							      ;
		  0000G  CF	       02  FB 00042 	    CALLS   #2, CHECKSUM2					      ;
		         2E	       50  E9 00047 	    BLBC    R0, 3$						      ;
		         7E	01FE   8F  3C 0004A 	    MOVZWL  #510, -(SP)						      ; 0524
				       52  DD 0004F 	    PUSHL   R2							      ;
		  0000G  CF	       02  FB 00051 	    CALLS   #2, CHECKSUM2					      ;
		         1F	       50  E9 00056 	    BLBC    R0, 3$						      ;
	   00	  0000G  CF	       22  E2 00059 	    BBSS    #34, MOUNT_OPTIONS, 1$				      ; 0528
		         50	  0C   AC  D0 0005F 1$:     MOVL    VOLUME_LABEL, R0					      ; 0530
	   20	    04   B0	       60  2D 00063 	    CMPC5   (R0), @4(R0), #32, #12, 472(R2)			      ;
		  01D8   C2	       0C     00068									      ;
				       06  13 0006C 	    BEQL    2$							      ;
		         50	010C   8F  3C 0006E 	    MOVZWL  #268, R0						      ; 0532
					   04 00073 	    RET     							      ;
		         50	       01  D0 00074 2$:     MOVL    #1, R0						      ; 0534
					   04 00077 	    RET     							      ;
				       50  D4 00078 3$:     CLRL    R0							      ; 0458
					   04 0007A 	    RET     							      ;

; Routine Size:  123 bytes


;	0537	
;	0538	END
;	0539	ELUDOM






;				       PSECT SUMMARY
;
;	Name		 Bytes			       Attributes
;
;  $CODE$         	   123  NOWRT,  RD ,  EXE,NOSHR,  LCL,  REL,  CON,NOPIC,ALIGN(2)




;				LIBRARY STATISTICS
;
;					     -------- Symbols --------    Blocks
;	File				     Total    Loaded   Percent      Read
;
;  DBA4:[SYSLIB]LIB.L32;1		      5582        21         0       229





; Size:		123 code + 0 data bytes

; Bliss-32 7.352	Saturday 21-AUG-1978 23:50:01									Page 2-3
; Digital Equipment Corporation
;
; Run Time:	00:13.2
; Elapsed Time:	00:39.8
; Memory Used:	279 pages
; Compilation Complete
