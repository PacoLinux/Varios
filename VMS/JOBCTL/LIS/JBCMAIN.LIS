JBCMAIN         -JOB_CONTROLLER MAIN ROUTINE                     22-AUG-1978 00:42:39   VAX-11 MACRO X0.3-11               Page   0
TABLE OF CONTENTS   

   (1)      40  DECLARATIONS
   (2)     154  JOB_CONTROL INITIALIZATION
   (5)     306  READ MAILBOX
   (6)     356  JBC MAILBOX READ AST
   (7)     495  TERMINAL/CARD_READER UNSOLICTED DATA
JBCMAIN         -JOB_CONTROLLER MAIN ROUTINE                     22-AUG-1978 00:42:39   VAX-11 MACRO X0.3-11               Page   1
V01                                                                                                                              (1)

                                     0000     1 	.TITLE	JBCMAIN-JOB_CONTROLLER MAIN ROUTINE
                                     0000     2 	.IDENT	/V01/
                                     0000     3 
                                     0000     4 ;
                                     0000     5 ; COPYRIGHT (C) 1977
                                     0000     6 ; DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASSACHUSETTS 01754
                                     0000     7 ;
                                     0000     8 ; THIS SOFTWARE IS FURNISHED  UNDER A LICENSE FOR USE ONLY ON A SINGLE
                                     0000     9 ; COMPUTER  SYSTEM AND  MAY BE  COPIED ONLY WITH  THE INCLUSION OF THE
                                     0000    10 ; ABOVE COPYRIGHT NOTICE.  THIS SOFTWARE, OR ANY OTHER COPIES THEREOF,
                                     0000    11 ; MAY NOT BE PROVIDED OR  OTHERWISE MADE AVAILABLE TO ANY OTHER PERSON
                                     0000    12 ; EXCEPT FOR USE ON SUCH SYSTEM AND TO ONE WHO AGREES TO THESE LICENSE
                                     0000    13 ; TERMS.  TITLE TO AND  OWNERSHIP OF THE  SOFTWARE  SHALL AT ALL TIMES
                                     0000    14 ; REMAIN IN DEC.
                                     0000    15 ;
                                     0000    16 ; THE INFORMATION IN THIS SOFTWARE IS SUBJECT TO CHANGE WITHOUT NOTICE
                                     0000    17 ; AND SHOULD  NOT BE CONSTRUED  AS A COMMITMENT  BY DIGITAL  EQUIPMENT
                                     0000    18 ; CORPORATION.
                                     0000    19 ;
                                     0000    20 ; DEC ASSUMES  NO  RESPONSIBILITY  FOR  THE USE OR  RELIABILITY OF ITS
                                     0000    21 ; SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DEC.
                                     0000    22 
                                     0000    23 ;++
                                     0000    24 ; FACILITY:	STARLET JOB_CONTROLLER
                                     0000    25 ;
                                     0000    26 ; ABSTRACT:	THIS MODULE CONTAINS THE JOB_CONTROLLER
                                     0000    27 ;		ROOT SEGMENT, PURE AND IMPURE DATA AREAS.
                                     0000    28 ;
                                     0000    29 ; ENVIRONMENT:	THIS MODULE MAKES UP PART OF THE JOB_CONTROLLER
                                     0000    30 ;		SYSTEM PROCESS.
                                     0000    31 ;
                                     0000    32 ; AUTHOR:	W.H.BROWN, CREATION DATE: 3-JAN-77
                                     0000    33 ;
                                     0000    34 ; MODIFIED BY:
                                     0000    35 ;
                                     0000    36 ;  , VERSION  ,
                                     0000    37 ; 01	- 
                                     0000    38 ;--
JBCMAIN         -JOB_CONTROLLER MAIN ROUTINE                     22-AUG-1978 00:42:39   VAX-11 MACRO X0.3-11               Page   2
V01             DECLARATIONS                                                                                                     (1)

                                     0000    40 	.SBTTL	DECLARATIONS
                                     0000    41 ;
                                     0000    42 ; INCLUDE FILES:
                                     0000    43 ;
                                     0000    44 ;	[235,10]J/ML
                                     0000    45 ;
                                     0000    46 ; EQUATED SYMBOLS:
                                     0000    47 ;
                                     0000    48 	$MSGDEF				; SYSTEM WIDE MESSAGE CODES
                                     0000    49 	$STSDEF				; STATUS FIELD DEFINITIONS
                                     0000    50 	JBCPARDEF			; DEFINE JOB CONTROLLER PARAMETERS
                                     0000    51 	JBCSCTDEF			; SYMBIONT CONTROL TABLE DEFINITIONS
                                     0000    52 ;
                                     0000    53 ;
                                     0000    54 ; OWN STORAGE:
                                     0000    55 ;
                                     0000    56 
                                     0000    57 	PURE_SECTION			; DEFINE PURE DATA SEGMENT
                                     0000    58  
                                     0000    59 JBC$Q_JBCNAM::				; THE NAME OF THE PROCESS
                                     0000    60 	STRING_DESC <JOB_CONTROL>
                                     0013    61  
                                     0013    62 JBC$Q_LOGIN::				; NAME OF INITIAL IMAGE TO ACTIVATE
                                     0013    63 	STRING_DESC	<SYS$SYSTEM:LOGINOUT.EXE> ; INITIAL IMAGE TO EXECUTE
                                     0032    64  
                                     0032    65 JBC$Q_INPSMB::				; CARD READER INPUT SYMBIONT
                                     0032    66 	STRING_DESC	<SYS$SYSTEM:INPSMB.EXE>	;
                                     004F    67  
                  FFFFFFFF FFFFFFFF  004F    68 JBC$Q_PRIVMASK::	.LONG	-1,-1	; NEW PROCESS PRIVLEDGE MASK
                                     0057    69  
                                     0057    70 ;
                                     0057    71 ; DEFINE PSECT TO BOUND ALL OF THE WRITABLE SECTIONS
                                     0057    72 ;
                                     0057    73 	IMPURE_DATA	JBC$$RWDTOP
                                     0000    74 JBC$RWDTOP::				; START OF ALL READ/WRITE DATA
                                     0000    75 	IMPURE_DATA	JBC__RWDEND
                                     0000    76 JBC$RWDEND::				; END OF ALL WRITABLE DATA
                                     0000    77 ;
                                     0000    78 ; ALLOCATE SPACE FOR MESSAGE BUFFERS
                                     0000    79 ; THESE BUFFERS ARE MAINTAINED IN A SEPARATE PROGRAM SECTION
                                     0000    80 ; TO PERMIT AN EXTEND SECTION TO ADD BUFFER SPACE
                                     0000    81 ;
                                     0000    82 	IMPURE_DATA	JBC$RWDMSGBFR	; READ/WRITE DATA-MESSAGE BUFFERS
                                     0000    83  
                                     0000    84 JBC$T_MSGBUFR::				; SPACE FOR MESSAGE BUFFERS
                                     0000    85  
                                     0000    86 	.BLKB	<JCM_K_SIZE*-		; SIZE OF BUFFER TIMES
                           00000300  0000    87 		JBC_K_MAXBUFR>		; NUMBER TO ALLOCATE
                                     0300    88  
                                     0300    89 	IMPURE_DATA	JBC$RWDMSGBFS	;
                                     0000    90 JBC$T_MBUFEND::				; END OF MESSAGE BUFFER SPACE
                                     0000    91  
                                     0000    92 ;
                                     0000    93 ; ALLOCATE THE SYMBIONT CONTROL TABLES
                                     0000    94 ; THESE TABLES ARE MAINTAINED IN A SPARATE PROGRAM SECITON
                                     0000    95 ; TO PERMIT AN EXTEND SECTION TO ADD TABLE SPACE
                                     0000    96 ;
JBCMAIN         -JOB_CONTROLLER MAIN ROUTINE                     22-AUG-1978 00:42:39   VAX-11 MACRO X0.3-11               Page   3
V01             DECLARATIONS                                                                                                     (1)

                                     0000    97 	IMPURE_DATA	JBC$RWDSYMCTL
                                     0000    98  
                                     0000    99 SYM$G_SYMCTLTBL::			; SYMBIONT CONTROL TABLE AREA
                                     0000   100  
                                     0000   101 	.BLKB	<SYM_K_MAXSYMB-		; ALLOCATE A BLOCK FOR EVERY SYMBIONT
                           00000280  0000   102 		* SCT_K_SIZE>		; BY THE SIZE OF THE BLOCK
                                     0280   103  
                                     0280   104 	IMPURE_DATA	JBC$RWDSYMCTM	;
                                     0000   105 SYM$G_SYMCTLTBE::			; END OF TABLE SPACE
                                     0000   106  
                                     0000   107 ;
                                     0000   108 ; DEFINE AREA FOR INTERACTIVE JOB BIT ARRAY
                                     0000   109 ;
                                     0000   110  
                                     0000   111 	IMPURE_DATA	JBC$RWDINTJOB	;
                                     0000   112  
                                     0000   113 JBC$G_INTJOBFLG::			; INTERACTIVE JOB FLAG BIT ARRAY
                           00000020  0000   114 	.BLKB	<256/8>			; ALLOCATE ENOUGH FOR 256 PROCESSES
                                     0020   115  
                                     0020   116 	IMPURE_DATA	JBC$RWDINTJOC	;
                                     0000   117 JBC$G_INTJOBEND::			;
                                     0000   118  
                                     0000   119 	IMPURE_DATA
                                     0000   120  
                                     0000   121 ;
                                     0000   122 ; ALLOCATE THE JOB CONTROLLER'S DATA BLOCK
                                     0000   123 ;
                                     0000   124  
                           0000003C  0000   125 JBC$T_DATABLK == . + <JCD_T_INDEX0-JCD_T_START> ; FIND OFFSET TO INDEX ZERO IN BLOCK
                                     0000   126  
                           000000FC  0000   127 	.BLKB	JCD_K_SIZE		; ALLOCATE SPACE FOR THE BLOCK
                                     00FC   128  
                                     00FC   129  
                                     00FC   130 ;
                                     00FC   131 ; AREA FOR PARAMETERS FROM CREATE/MAP GLOBAL SECTION FOR THE PRINT QUEUE
                                     00FC   132 ;
                                     00FC   133  
                           00000104  00FC   134 JBC$Q_INADR::	.BLKQ	1		; INPUT ADDRESS TO MAP SECTION
                                     0104   135  
                           0000010C  0104   136 JBC$Q_RETADR::	.BLKQ	1		; RETURN ADDRESS FROM MAP SECTION
                                     010C   137  
                           00000114  010C   138 JBC$Q_UPDADR::	.BLKQ	1		; ADDRESSES UPDATED
                                     0114   139  
                           0000011C  0114   140 JBC$Q_UPDIOSB::	.BLKQ	1		; IO STATUS FOR SECTION UPDATE
                                     011C   141  
                                 00  011C   142 JBC$B_QUEWRT::	.BYTE	0		; FLAG FOR QUEUE UPDATING
                                     011D   143 ;
                                     011D   144  
                                     011D   145 ; PROTOTYPE NAME FOR CONSTRUCTION OF MAILBOX RESPONCE DEVICE NAMES
                                     011D   146 ;
                                     011D   147  
                                     011D   148 JBC$T_MBOXNAME::
                                 00  011D   149 	.BYTE	0			; COUNT GOES HERE
                           42 4D 5F  011E   150 	.ASCII	\_MB\			; NAME WITH "_"TO PREVENT SUBSTITUTION
                                     0121   151 JBC$T_MBOXUNIT::			; THE UNIT NUMBER GOES HERE
                           00000126  0121   152 	.BLKB	5			; BIGGEST UNIT IS 65K
JBCMAIN         -JOB_CONTROLLER MAIN ROUTINE                     22-AUG-1978 00:42:39   VAX-11 MACRO X0.3-11               Page   4
V01             JOB_CONTROL INITIALIZATION                                                                                       (2)

                                     0126   154 	.SBTTL	JOB_CONTROL INITIALIZATION
                                     0126   155 ;++
                                     0126   156 ; FUNCTIONAL DESCRIPTION:
                                     0126   157 ;
                                     0126   158 ;	JOB CONTROL MAIN LOOP IS ACTIVATED BY THE AST ROUTINE.
                                     0126   159 ;	ALL OF THE POSSIBLE WORK LISTS ARE SCANNED TO DETERMIN
                                     0126   160 ;	WHAT FUNCTIONS ARE TO BE DONE.  THE LIST ARE ORDERED BY
                                     0126   161 ;	THEIR IMPORTANCE AND ARE ALWAYS CHECKED FROM THE TOP.
                                     0126   162 ;
                                     0126   163 ; CALLING SEQUENCE:
                                     0126   164 ;
                                     0126   165 ;	NONE-ENTERED DIRECTLY FROM THE INITIALIZATION ROUTINE.
                                     0126   166 ;
                                     0126   167 ; INPUT PARAMETERS:	NONE
                                     0126   168 ;
                                     0126   169 ; OUTPUT PARAMETERS:	NONE
                                     0126   170 ;
                                     0126   171 ; COMPLETION CODES:	NONE
                                     0126   172 ;
                                     0126   173 ; SIDE EFFECTS:		NONE
                                     0126   174 ;--
                                     0126   175 	PURE_SECTION			; START CODE SEGMENT
                                     0057   176  
                                     0057   177 JBC$LOOP::				;
                                 E5  0057   178 	BBCC	#JBC_V_SYMCREREQ,-	; BR IF SYMBIONT CREATE
         04 AB            01         0058   179 		JCD_W_FLAGS(R11),10$	; IS NOT REQUIRED
                          03         005B       
                          FFA1'  30  005C   180 	BSBW	SYM$CREPRTSYM		; TRY TO CREATE ONE
                                 E5  005F   181 10$:	BBCC	#JBC_V_CREJOBREQ,-	; BR IF CREATE DETCHED (BATCH)
         04 AB            03         0060   182 		JCD_W_FLAGS(R11),20$	; JOB IS NOT REQUIRED
                          03         0063       
                          FF99'  30  0064   183 	BSBW	JBC$STADET		; TRY TO START ONE IF YES
                                 E5  0067   184 20$:	BBCC	#JBC_V_MBREADREQ,-	; BR IF THERE IS NO REQUIREMENT FOR
         04 AB            00         0068   185 		JCD_W_FLAGS(R11),30$	; A MAILBOX READ
                          03         006B       
                          00F5   30  006C   186 	BSBW	JBC$READMB		; ELSE ISSUE A READ REQUEST
                                 E5  006F   187 30$:	BBCC	#JBC_V_SYMINIREQ,-	; CHECK IF SYMBIONT SERVICE FLAG IS
         04 AB            02         0070   188 		JCD_W_FLAGS(R11),40$	; SET AND CLEAR IT,BR IF NO
                          09         0073       
            52         F8 BB     0F  0074   189 	REMQUE	@JCD_Q_SYMBWAIT(R11),R2	; GET SYMBIONT THAT IS WAITING
                          03     1D  0078   190 	BVS	40$			; BR IF NO SYMBIONTS WAITING
                          FF83'  30  007A   191 	BSBW	JBC$SYMBSERV		; GO TAKE CARE OF SYMBIONT
                                 E5  007D   192 40$:	BBCC	#JBC_V_MBREADREQ,-	; CHECK FOR AN OUTSTANDING NEED FOR
         04 AB            00         007E   193 		JCD_W_FLAGS(R11),50$	; A MAIL BOX READ
                          03         0081       
                          00DF   30  0082   194 	BSBW	JBC$READMB		; READ THE MAILBOX
                     011C'CF     95  0085   195 50$:	TSTB	W^JBC$B_QUEWRT		; TIME TO WRITE THE QUEUE BACK
                          08     14  0089   196 	BGTR	70$			; BR IF NO
       011C'CF            10     90  008B   197 	MOVB	#16,W^JBC$B_QUEWRT	; RESET WRITE FLAG
                          FF6D'  30  0090   198 	BSBW	JBC$VFYUPDQUE		; VERIFY AND UPDATE THE QUEUE
                                     0093   199 70$:					; 
                                     0093   200  
                                     0093   201 	.ENABL	LSB
                                     0093   202  
                                     0093   203 WAIT:	$HIBER_S			; SLEEP
                                     009A   204  
                                     009A   205 ;
JBCMAIN         -JOB_CONTROLLER MAIN ROUTINE                     22-AUG-1978 00:42:39   VAX-11 MACRO X0.3-11               Page   5
V01             JOB_CONTROL INITIALIZATION                                                                                       (2)

                                     009A   206 ; SCAN WORK LISTS FOR SOMETHING TO DO
                                     009A   207 ;
                                     009A   208  
                                     009A   209 10$:	$GETTIM_S  JCD_Q_TIME(R11)	; GET THE TIME OF DAY
         04 AB            04     E5  00A4   210 	BBCC	#JBC_V_SRVTIMQUE,JCD_W_FLAGS(R11),15$ ; BR IF NO TIME WORK
                          03         00A8       
                          FF54'  30  00A9   211 	BSBW	SYM$SRVTIMER		; REMOVE TIME ENTRIES
                          50     D4  00AC   212 15$:	CLRL	R0			; SET INDEX FOR FIRST WORK LIST
            51         D0 AB40   7E  00AE   213 20$:	MOVAQ	JCD_G_WORKLIST(R11)[R0],R1 ; FIND ADDRESS OF QUEUE
            52            91     0F  00B3   214 	REMQUE	@(R1)+,R2		; REMOVE ITEM FROM LIST
                          0A     1C  00B6   215 	BVC	30$			; BR IF REMOVED SOMETHING
                          50     D6  00B8   216 	INCL	R0			; NOTHING IN QUEUE-ADD 1 TO INDEX
            04            50     D1  00BA   217 	CMPL	R0,S^#<<JCD_G_WLEND-JCD_G_WORKLIST>/8> ; CHECK AGAINST LIMIT
                          EF     1F  00BD   218 	BLSSU	20$			; BR IF MORE TO CHECK
                          FF95   31  00BF   219 	BRW	JBC$LOOP		; WAIT SOME MORE
                                     00C2   220  
                                     00C2   221 ;
                                     00C2   222 ; ITEM REMOVED FROM WORK LIST-CALL ASSOCIATED ROUTINE
                                     00C2   223 ;
                                     00C2   224  
            62         0A A2     3C  00C2   225 30$:	MOVZWL	JCM_Q_IOSB+2(R2),(R2)	; SET LENGTH OF TRANSFER
            62            10     C0  00C6   226 	ADDL	#JCM_T_MSGDATA,(R2)	; FIND END OF VALID DATA
            62            52     C0  00C9   227 	ADDL	R2,(R2)			; THAT POINTS AT END OF RECORD
                       04 A2     D4  00CC   228 	CLRL	4(R2)			; ZERO RETURNED ARGUMENT
            5A         18 AB     D0  00CF   229 	MOVL	JCD_A_QUEBASE(R11),R10	; SET BASE ADDRESS OF SYSTEM QUEUE
                          02     10  00D3   230 	BSBB	40$			; SET SUBROUTINE RETURN FOR CASE
                          C3     11  00D5   231 	BRB	10$			; LOOP FROM THE TOP
                                     00D7   232 40$:	CASE	R0,<-
                                     00D7   233 		JBC$SYMBSERV,-		; SYMBIONT SERVICE REQUIRED
                                     00D7   234 		JBC$SYMBMAN,-
                                     00D7   235 		JBC$PRCDEL,-
                                     00D7   236 		JBC$ACNTMAN,-		; MESSAGE FOR ACCOUNTING MANAGER
                                     00D7   237 	>
                                     00E3   238  
                                     00E3   239 	.DSABL	LSB
JBCMAIN         -JOB_CONTROLLER MAIN ROUTINE                     22-AUG-1978 00:42:39   VAX-11 MACRO X0.3-11               Page   6
V01             JOB_CONTROL INITIALIZATION                                                                                       (3)

                                     00E3   241 ;+
                                     00E3   242 ; SYMBIONT AND ACCOUNTING MANAGER DISPATCHER
                                     00E3   243 ;
                                     00E3   244 ; THIS ROUTINE PERFORMS THE COMMON PROCESSING FOR THE SEND SERVICE
                                     00E3   245 ; PROCESSING AND RESPONCE.  THIS INCLUDES  ASSIGNING THE RESPONCE
                                     00E3   246 ; MAILBOX, THEN SENDING THE RESPONCE WHEN PROCESSING IS DONE.
                                     00E3   247 ;-
                                     00E3   248 	.ENABL	LSB
                                     00E3   249 JBC$ACNTMAN:				; ACCOUNTING MANAGER REQUEST
                     0000'CF     9F  00E3   250 	PUSHAB	W^ACM$ACNTMAN		; ENTRY TO ACCOUNTING MANAGER
                          04     11  00E7   251 	BRB	10$			;
                                     00E9   252  
                                     00E9   253 JBC$SYMBMAN::				; SYMBIONT MANAGER SEVICE
                     0000'CF     9F  00E9   254 	PUSHAB	W^SYM$SYMBMAN		; ENTRY TO SYMBIONT MANAGER
            52            10     C1  00ED   255 10$:	ADDL3	#JCM_T_MSGDATA,R2,R9	; POINT R9 AT MESSAGE DATA
                          59         00F0       
                                     00F1   256 	ASSUME	ACM$W_MAILBOX EQ SMR$W_MAILBOX
            50         02 A9     3C  00F1   257 	MOVZWL	SMR$W_MAILBOX(R9),R0	; GET MAIL BOX UNIT
                          06     13  00F5   258 	BEQL	20$			; BR IF NONE HERE
            51            6B     3E  00F7   259 	MOVAW	JCD_W_TMPCHAN(R11),R1	; CHANNEL RETURN ADDRESS
                          FF03'  30  00FA   260 	BSBW	JBC$ASSIGNMB		; ASSIGN THE MAILBOX
                          9E     16  00FD   261 20$:	JSB	@(SP)+			; ENTER PROPER MANAGER
            0E            50     E8  00FF   262 	BLBS	R0,30$			; BR IF STATUS IS GOOD
            51            50     CE  0102   263 	MNEGL	R0,R1			; INVERT ERROR CODE
                          0E     19  0105   264 	BLSS	40$			; BR IF ERROR FROM THE SYSTEM
            51            02     78  0107   265 	ASHL	#2,R1,R0		; SET REAL ERROR MESSAGE CODE
                          50         010A       
            50       8002 8F     A8  010B   266 	BISW	#<STS$M_FAC_SP!-	; SET FACILITY SPECIFIC AND-
                                     0110   267 		STS$K_ERROR>,R0		; AND "ERROR" SEVERITY INTO VALUE
                                 F0  0110   268 30$:	INSV	#<JBC$_NORMAL@-STS$V_FAC_NO>,- ; AND JOBCTL FACILITY CODE
            10            04         0111   269 		#STS$V_FAC_NO,#STS$S_FAC_NO,R0 ; INTO RETURN VALUE
            50            0C         0113       
            53         0C BB     9E  0115   270 40$:	MOVAB	@JCD_A_LBUFADR(R11),R3	; SET POINTER TO RESPONCE MESSAGE BUFFER
            83            52     B0  0119   271 	MOVW	R2,(R3)+		; STORE MESSAGE TYPE
            83         F4 A9     B0  011C   272 	MOVW	-<JCM_T_MSGDATA-4>(R9),(R3)+ ; STORE RESPONCE DATA
            83            50     D0  0120   273 	MOVL	R0,(R3)+		; SET FINAL STATUS
                                 0E  0123   274 	INSQUE	-JCM_T_MSGDATA(R9),-	; RELEASE MESSAGE BUFFER TO
         F4 BB         F0 A9         0124   275 		@JCD_Q_FREEBUFR+4(R11)	; END OF THE FREE MESSAGE BUFFER LIST
                          6B     B5  0128   276 	TSTW	JCD_W_TMPCHAN(R11)	; ANY RESPONCE MAILBOX?
                          13     13  012A   277 	BEQL	50$			; BR IF NO - DON'T SEND RESPONCE
                          12     10  012C   278 	BSBB	JBC$SNDRESP		; SEND RESPONCE TO REQUESTOR
                                     012E   279 	$DASSGN_S JCD_W_TMPCHAN(R11)	; RELEASE THE CHANNEL
                                     0138   280 	CHECK_ERROR	DASSGN_MB	; WATCH FOR ERROR DEASSIGNING MAILBOX
                          6B     B4  013D   281 	CLRW	JCD_W_TMPCHAN(R11)	; CLEAR CHANNEL NUMBER FOR NEXT TIME
                                 05  013F   282 50$:	RSB				; RETURN TO DISPATCHER
                                     0140   283  
                                     0140   284 	.DSABL	LSB			;
JBCMAIN         -JOB_CONTROLLER MAIN ROUTINE                     22-AUG-1978 00:42:39   VAX-11 MACRO X0.3-11               Page   7
V01             JOB_CONTROL INITIALIZATION                                                                                       (4)

                                     0140   286  
                                     0140   287 ;+
                                     0140   288 ; JBC$SNDRESP - SEND RESPONCE
                                     0140   289 ;
                                     0140   290 ; 	THIS SUBROUTINE IS CALLED TO SEND A MESSAGE TO THE REQUESTING
                                     0140   291 ;	PROCESS VIA THE SUPPLIED MAILBOX.
                                     0140   292 ;
                                     0140   293 ; INPUTS:	R3 IS END OF MESSAGE IN JBC LINE BUFFER
                                     0140   294 ;
                                     0140   295 ;-
                                     0140   296  
                                     0140   297 JBC$SNDRESP::				;
            53         0C AB     C3  0140   298 	SUBL3	JCD_A_LBUFADR(R11),R3,R1 ; FIND LENGTH
                          51         0144       
                                     0145   299 	$QIO_S	EFN = #0,-		; WRITE MAILBOX, EVENT FLAG IS 0
                                     0145   300 		CHAN = JCD_W_TMPCHAN(R11),-; CHANNEL NUMBER
                                     0145   301 		FUNC = #<IO$_WRITEVBLK!IO$M_NOW>,- ; OPERATION IS WRITE-NOW!
                                     0145   302 		P1 = @JCD_A_LBUFADR(R11),- ; BUFFER ADDRESS
                                     0145   303 		P2 = R1			; LENGTH
                                 05  0163   304 	RSB				;
JBCMAIN         -JOB_CONTROLLER MAIN ROUTINE                     22-AUG-1978 00:42:39   VAX-11 MACRO X0.3-11               Page   8
V01             READ MAILBOX                                                                                                     (5)

                                     0164   306 	.SBTTL	READ MAILBOX
                                     0164   307 ;++
                                     0164   308 ; FUNCTIONAL DESCRIPTION:
                                     0164   309 ;
                                     0164   310 ;	THIS ROUTINE IS CALLED TO ISSUE A READ ON
                                     0164   311 ;	THE SYSTEM PERMANENT MAILBOX USED FOR
                                     0164   312 ;	COMMUNICTION TO THE JOB CONTROLLER.
                                     0164   313 ;
                                     0164   314 ; CALLING SEQUENCE:
                                     0164   315 ;
                                     0164   316 ;	BSB	JBC$READMB
                                     0164   317 ;
                                     0164   318 ; INPUT PARAMETERS:
                                     0164   319 ;
                                     0164   320 ;	LOCATION "JBC$Q_FREEBUFR" CONTAINS A LIST
                                     0164   321 ;	OF BUFFERS AVAILIABLE FOR READING THE
                                     0164   322 ;	MAILBOX.
                                     0164   323 ;
                                     0164   324 ; OUTPUT PARAMETERS:
                                     0164   325 ;
                                     0164   326 ;	BUFFER IS ALLOCATED AND READ IS ISSUED
                                     0164   327 ;	IF BUFFER ALLOCATION FAILS, FLAG IS SET
                                     0164   328 ;	SO THAT READ CAN BE RE-ATTEMPTED AT SOME
                                     0164   329 ;	LATER TIME.
                                     0164   330 ;
                                     0164   331 ; COMPLETION CODES:	NONE
                                     0164   332 ;
                                     0164   333 ; SIDE EFFECTS:		NONE
                                     0164   334 ;
                                     0164   335 ;--
                                     0164   336 
                                     0164   337 JBC$READMB::				; READ JOB CONTROLLER'S MAIL BOX
            52         F0 BB     0F  0164   338 	REMQUE	@JCD_Q_FREEBUFR(R11),R2	; ALLOCATE A BUFFER FOR READ
                          31     1D  0168   339 	BVS	90$			; BR IF ALLOCATION FAILED
                                     016A   340 	$QIO_S	#0,-			; EVENTFLAG IS 0
                                     016A   341 		JCD_W_MBCHAN(R11),-	; CHANNEL IS MAILBOX
                                     016A   342 		#IO$_READVBLK,-		; FUNCTION IS READ
                                     016A   343 		JCM_Q_IOSB(R2),-	; IO STATUS BLOCK IN PACKET
                                     016A   344 		W^JBC$MBAST,-		; ADDRESS OF AST ROUTINE
                                     016A   345 		R2,-			; AST PARM IS MESSAGE PACKET
                                     016A   346 		JCM_T_MSGDATA(R2),-	; BUFFER AREA OF PACKER
                                     016A   347 		#JCM_K_SIZE-JCM_T_MSGDATA ; SIZE OF MESSAGE DATA AREA
            0A            50     E8  0192   348 	BLBS	R0,99$			; BR IF OPERATION A SUCCESS
         F4 BB            62     0E  0195   349 	INSQUE	(R2),@JCD_Q_FREEBUFR+4(R11) ; REALLOCATE THE BUFFER FOR LATER
                                     0199   350 	SHOW_ERROR  MAILBOX_READ	; REPORT ERROR
                                     019B   351 90$:	SETBIT	JBC_V_MBREADREQ,-	; SET FLAG TO INDICATE READ NEEDS
                                     019B   352 		JCD_W_FLAGS(R11)	; TO BE ISSUED
                                 05  019F   353 99$:	RSB				; ALL DONE
                                     01A0   354 
JBCMAIN         -JOB_CONTROLLER MAIN ROUTINE                     22-AUG-1978 00:42:39   VAX-11 MACRO X0.3-11               Page   9
V01             JBC MAILBOX READ AST                                                                                             (6)

                                     01A0   356 	.SBTTL	JBC MAILBOX READ AST
                                     01A0   357 ;++
                                     01A0   358 ; FUNCTIONAL DESCRIPTION:
                                     01A0   359 ;
                                     01A0   360 ;	THIS ROUTINE IS ENTERED WHEN A MESSAGE HAS BEEN
                                     01A0   361 ;	DELIVERED THRU THE JOB CONTROLLERS MAILBOX.
                                     01A0   362 ;	THE AST PARAMETER IS THE ADDRESS OF THE JOB CONTROLLER
                                     01A0   363 ;	MESSAGE BUFFER, THAT IS THE ADDRESS OF THE QWAD WORD LIST
                                     01A0   364 ;	HEADER, WHICH IS FOLLOWED BY A QUAD WORD I/O STATUS BLOCK.
                                     01A0   365 ;	THIS IS THEN FOLLOWED BY THE DATA.  IN ALL CASES THE FIRST
                                     01A0   366 ;	WORD IN THE DATA IS MESSAGE TYPE IDENTIFIER FOLLOWED BY
                                     01A0   367 ;	THE ACTUAL DATA ASSOCIATED WITH THE MESSAGE.
                                     01A0   368 ;	THIS ROUTINE ENTERS A SPECFIC ROUTINE DEPENDING ON THE
                                     01A0   369 ;	THE MESSAGE TYPE.
                                     01A0   370 ;
                                     01A0   371 ; CALLING SEQUENCE:
                                     01A0   372 ;
                                     01A0   373 ;	THIS ROUTINE IS ENTERED FROM THE SYSTEM AST
                                     01A0   374 ;	DELIVERY ROUTINE USING THE CALLG INSTRUCTION.
                                     01A0   375 ;
                                     01A0   376 ; INPUT PARAMETERS:
                                     01A0   377 ;
                                     01A0   378 ;	AN ARQUMENT BLOCK WITH THE FIRST ARGUMENT THE
                                     01A0   379 ;	ADDRESS OF THE MESSAGE BUFFER INTO WHICH THE
                                     01A0   380 ;	MESSAGE HAS BEEN DELIVERED.
                                     01A0   381 ;
                                     01A0   382 ; OUTPUT PARAMETERS:	NONE
                                     01A0   383 ;
                                     01A0   384 ; COMPLETION CODES:	NONE
                                     01A0   385 ;
                                     01A0   386 ; SIDE EFFECTS:		NONE
                                     01A0   387 ;--
                                     01A0   388 
                                     01A0   389 JBC$MBAST::				; AST ENTRY POINT
                               083C  01A0   390 	.WORD	^M<R2,R3,R4,R5,R11>	; REGISTER SAVE MASK
            5B       003C'CF     9E  01A2   391 	MOVAB	W^JBC$T_DATABLK,R11	; SET WORKING DATA BLOCK ADDRESS
            55         04 AC     D0  01A7   392 	MOVL	4(AP),R5		; GET MESSAGE PACKET ADDRESS
            54         0A A5     3C  01AB   393 	MOVZWL	JCM_Q_IOSB+2(R5),R4	; PICK UP MESSAGE BYTE COUNT
            55            10     C0  01AF   394 	ADDL	#JCM_T_MSGDATA,R5	; POINT REGISTER AT DATA AREA
            50            85     32  01B2   395 	CVTWL	(R5)+,R0		; GET MESSAGE TYPE FROM PACKET
                       D4'AF     DF  01B5   396 	PUSHAL	B^100$			; SET RETURN FROM MESSAGE PROCESSING ROUTINE
                                     01B8   397 	CASE	R0,-			; DECODE MESSAGE TYPE
                                     01B8   398 		LIMIT = #MSG$_TRMUNSOLIC,-;BASE VALUE FOR CASE
                                     01B8   399 		<JBC$TTUNSOLIN,-	; TERMINAL UNSOLICTED DATA
                                     01B8   400 		JBC$CRUNSOLIN,-		; CARD READER UNSOLICTED INPUT
                                     01B8   401 		JBC$DELETPRC,-		; DELETE PROCESS
                                     01B8   402 		JBC$SNDSYMAN,-		; SEND TO SYMBIONT MANAGER
                                     01B8   403 		10$,-			; RESERVED CODE
                                     01B8   404 		10$,-			; RESERVED CODE
                                     01B8   405 		10$,-			; RESERVED CODE
                                     01B8   406 		JBC$SYMBINIT,-		; SYMBIONT INIT COMPLETE
                                     01B8   407 		JBC$SYMBDONE,-		; SYMBIONT HAS COMPLETED JOB
                                     01B8   408 		JBC$SNDACMAN,-		; SEND MESSAGE TO ACCOUNTING MANAGER
                                     01B8   409 	>
                                     01D0   410 10$:	SHOW_ERROR	INVALID_MESG	; BAD MESSAGE RECEIVED
                          03     11  01D2   411 	BRB	110$			; DEALLOCATE THE MESSAGE BUFFER
            05            50     E9  01D4   412 100$:	BLBC	R0,120$			; BR IF MESSAGE BUFFER STILL IN USE
JBCMAIN         -JOB_CONTROLLER MAIN ROUTINE                     22-AUG-1978 00:42:39   VAX-11 MACRO X0.3-11               Page  10
V01             JBC MAILBOX READ AST                                                                                             (6)

         F4 BB         04 BC     0E  01D7   413 110$:	INSQUE	@4(AP),@JCD_Q_FREEBUFR+4(R11) ; RELEASE CURRENT BUFFER IF FREE
                          FF85   30  01DC   414 120$:	BSBW	JBC$READMB		; RESTART I/O ON MAILBOX
                                 04  01DF   415 	RET				; DISMISS AST
                                     01E0   416  
                                     01E0   417 ;
                                     01E0   418 ; MESSAGE IS SYMBIONT DONE
                                     01E0   419 ;
                                     01E0   420 ;	ADJUST STATE FOR SYMBIONT TO READY FOR NEXT FILE
                                     01E0   421 ;	INSERT ITS TABLE IN SEVICE LIST
                                     01E0   422 ;	SET THE MAIN LINE SYNC FLAG
                                     01E0   423 ;
                                     01E0   424 JBC$SYMBDONE::				; SYMBIONT IS COMPLETE
                          55     DD  01E0   425 	PUSHL	R5			; SAVE MESSAGE BUFFER ADDRESS
            51         FA A5     D0  01E2   426 	MOVL	<JCM_Q_IOSB+4-<JCM_T_MSGDATA+2>>(R5),R1 ; GET SENDER'S ID
                          FE17'  30  01E6   427 	BSBW	SYM$FINDSYMCTL		; LOCATE THE SYMBIONT CONTROL TABLE
                          02     BA  01E9   428 	POPR	#^M<R1>			; POP BUFFER ADDRESS TO WORK REGISTER
         16 A5            81     B0  01EB   429 	MOVW	(R1)+,SCT_W_JOBSTAT(R5)	; SAVE THE JOB STATUS FOR MAINLINE
         24 A5            81     C0  01EF   430 	ADDL	(R1)+,SCT_L_GETCNT(R5)	; ACCUMULATE ACCOUNTING
         20 A5            81     C0  01F3   431 	ADDL	(R1)+,SCT_L_QIOCNT(R5)	; INFORMATION ON GET'S ,QIO'S
            50            81     3C  01F7   432 	MOVZWL	(R1)+,R0		; GET PAGES AS A LONG WORD
         1C A5            50     C0  01FA   433 	ADDL	R0,SCT_L_PAGCNT(R5)	; AND ACCOUNT FOR PAGES
                          0D     11  01FE   434 	BRB	SYMBEXIT		; EXIT SYMBIONT SERVICE AST
                                     0200   435 ;
                                     0200   436 ; MESSAGE IS A SYMBIONT HAS INITED.
                                     0200   437 ;	SAVE THE MAILBOX UNIT IN THE SYMBIONT CONTROL TABLE
                                     0200   438 ;	AND INSERT TABLE IN SYMBIONT SERVICE LIST
                                     0200   439 ;	SET THE SYNCRONIZING EVENT FLAG TO GET THE MAIN STARTED.
                                     0200   440 ;
                                     0200   441 JBC$SYMBINIT::				;
                          65     DD  0200   442 	PUSHL	(R5)			; SAVE MAILBOX UNIT NUMBER
            51         FA A5     D0  0202   443 	MOVL	<JCM_Q_IOSB+4-<JCM_T_MSGDATA+2>>(R5),R1 ; PICK UP SENDER ID
                          FDF7'  30  0206   444 	BSBW	SYM$FINDSYMCTL		; LOOK FOR SYMBIONT CONTROL TABLE
         0A A5            8E     F7  0209   445 	CVTLW	(SP)+,SCT_W_MBCHAN(R5)	; STORE MAILBOX UNIT IN CONTROL TABLE
                                     020D   446 SYMBEXIT:				; COMMON EXIT FOR SYMBIONT SERVICE
         D4 BB            65     0E  020D   447 	INSQUE	(R5),@JCD_Q_SYMBSRV+4(R11) ; PUT THIS SYMBIONT IN SERVICE QUEUE
                          01     DD  0211   448 	PUSHL	#1			; SET STATUS TO AST DISPATCHER
                          16     11  0213   449 	BRB	JBC$SYNCMAIN		; SYNCRONIZE WITH MAINLINE
                                     0215   450  
                                     0215   451 ;
                                     0215   452 ; MESSAGE FOR THE ACCOUNTING MANAGER
                                     0215   453 ;	INSERT MESSAGE IN THE PROPER QUEUE
                                     0215   454 ;	AND SET THE SYNCRONIZING FLAG FOR THE MAIN LINE
                                     0215   455 ;	THIS MESSAGE IS PROCESSED AT THAT LEVEL
                                     0215   456 ;
                                     0215   457  
                                     0215   458 JBC$SNDACMAN:				; SEND MESSAGE TO ACCOUNTING MANAGER
            50         E8 AB     7E  0215   459 	MOVAQ	JCD_Q_ACNTFIL(R11),R0	; GET ADDRESS OF PROPER QUEUE
                          0A     11  0219   460 	BRB	JBC$INSWORKLIST		; INSERT IN WORK LIST AND START THE MAIN
                                     021B   461  
                                     021B   462 ;
                                     021B   463 ; MESSAGE IS FOR THE SYMBIONT MANAGER
                                     021B   464 ;	INSERT MESSAGE IN THE PROPER QUEUE
                                     021B   465 ;	AND SET THE SYNCRONIZING FLAG FOR THE MAIN LINE
                                     021B   466 ;	THIS MESSAGE IS PROCESSED AT THAT LEVEL
                                     021B   467 ;
                                     021B   468  
                                     021B   469 JBC$SNDSYMAN::				;
JBCMAIN         -JOB_CONTROLLER MAIN ROUTINE                     22-AUG-1978 00:42:39   VAX-11 MACRO X0.3-11               Page  11
V01             JBC MAILBOX READ AST                                                                                             (6)

            50         D8 AB     7E  021B   470 	MOVAQ	JCD_Q_SYMBMAN(R11),R0	; SET PROPER LIST HEADER
                          04     11  021F   471 	BRB	JBC$INSWORKLIST		; INSERT THIS IN WORK LIST
                                     0221   472  
                                     0221   473 ;
                                     0221   474 ; HANDLE DELETE PROCESS MESSAGE
                                     0221   475 ;	INSERT MESSAGE IN THE PROPER QUEUE
                                     0221   476 ;	AND SET THE SYNCRONIZING FLAG FOR THE MAIN LINE
                                     0221   477 ;	THIS MESSAGE IS PROCESSED AT THAT LEVEL
                                     0221   478 ;
                                     0221   479  
                                     0221   480 JBC$DELETPRC::				; PROCESS DELETE HAS OCCURRED
            50         E0 AB     7E  0221   481 	MOVAQ	JCD_Q_PROCDEL(R11),R0	; SET LIST ADDRESS
                                     0225   482 					; FALL INTO INSERT IN WORK LIST
                                     0225   483 ;
                                     0225   484 ; INSERT IN WORK LIST
                                     0225   485 ;	
                                     0225   486 JBC$INSWORKLIST:			;
                          00     DD  0225   487 	PUSHL	#0			; GET RETURN STATUS FLAG
            90         04 BC     0E  0227   488 	INSQUE	@4(AP),@(R0)+		; INSERT RECORD IN LIST
                                     022B   489 JBC$SYNCMAIN:				; SET MAIN-LINE SYNC FLAG
                                     022B   490 	$WAKE_S				; WAKE UP THE MAINLINE LOOP
                          01     BA  0236   491 	POPR	#^M<R0>			; GET RETURN STATUS
                                 05  0238   492 	RSB				; RETURN TO AST DISPATCHER
JBCMAIN         -JOB_CONTROLLER MAIN ROUTINE                     22-AUG-1978 00:42:39   VAX-11 MACRO X0.3-11               Page  12
V01             TERMINAL/CARD_READER UNSOLICTED DATA                                                                             (7)

                                     0239   495 	.SBTTL	TERMINAL/CARD_READER UNSOLICTED DATA
                                     0239   496 ;++
                                     0239   497 ; FUNCTIONAL DESCRIPTION:
                                     0239   498 ;
                                     0239   499 ;	THIS ROUTINE IS ENTER BY THE AST DISPATCHER WHEN THE
                                     0239   500 ;	MESSAGE RECEIVED INDICATES THAT UNSOLICTED INPUT HAS
                                     0239   501 ;	BEEN RECEIVED FROM A UN-ASSIGNED UNIT RECORD DEVICE.  THIS 
                                     0239   502 ;	ROUTINE ISSUES A REQUEST TO CREATE A PROCESS WITH ITS
                                     0239   503 ;	DEVICES "INPUT" AND "OUTPUT" ASSIGNED TO THE ASSOCIATED
                                     0239   504 ;	DEVICE. IN ORDER TO PERFORM THIS, THE DEVICE NAME STRING
                                     0239   505 ;	IN THE MESSAGE BUFFER.  THE FIRST 2 LONGWORDS (LIST LINKS)
                                     0239   506 ;	ARE USED TO CREATE THE STRING DESCRIPTOR, AND NAME STRING
                                     0239   507 ;	IS BUILT USING THE CONTROLLER NAME AS IS AND ADDING
                                     0239   508 ;	THE UNIT NUMBER ON THE END, CONVERTING FROM BINARY TO
                                     0239   509 ;	ASCII.
                                     0239   510 ;
                                     0239   511 ; CALLING SEQUENCE:
                                     0239   512 ;
                                     0239   513 ;	BSB	JBC$TTUNSOLIN		; FOR TERMINALS
                                     0239   514 ;	BSB	JBC$CRUNSOLIN		; FOR CARD READRERS
                                     0239   515 ;
                                     0239   516 ; INPUT PARAMETERS:
                                     0239   517 ;
                                     0239   518 ;	R5 POINTS BEYOND THE MESSAGE TYPE CODE IN THE MESSAGE BUFFER.
                                     0239   519 ;	THAT IS, POINTS AT A WORD CONTAINING THE BINARY UNIT NUMBER
                                     0239   520 ;	FOR THE TERMINAL. THIS IS FOLLOWED BY THE CONTROLLER NAME
                                     0239   521 ;	AS A COUNTED ASCII STRING.
                                     0239   522 ;
                                     0239   523 ; IMPLICIT INPUTS:
                                     0239   524 ;
                                     0239   525 ;	REGISTERED R0 TO R5 HAVE BEEN SAVED AND MAY BE
                                     0239   526 ;	USED AS NEEDED BY THIS ROUTINE.
                                     0239   527 ;
                                     0239   528 ; OUTPUT PARAMETERS:
                                     0239   529 ;
                                     0239   530 ;	R0 IS RETURNED TRUE TO INDICATE BUFFER IS FREE
                                     0239   531 ;	AND, THEREFORE, MAY BE REUSED.
                                     0239   532 ;
                                     0239   533 ; IMPLICIT OUTPUTS:
                                     0239   534 ;
                                     0239   535 ;	A PROCESS IS CREATED RUNNING THE LOGIN OR THE INPUT SYMBIONT IMAGE
                                     0239   536 ;
                                     0239   537 ; COMPLETION CODES:	NONE
                                     0239   538 ;
                                     0239   539 ; SIDE EFFECTS:		NONE
                                     0239   540 ;
                                     0239   541 ;--
                                     0239   542 	.ENABL	LSB
                                     0239   543 
                                     0239   544 JBC$TTUNSOLIN::				; TERMINAL UNSOLICETED INPUT
            53       FDD6 CF     7E  0239   545 	MOVAQ	W^JBC$Q_LOGIN,R3	; SET IMAGE NAME TO START
                          35     10  023E   546 	BSBB	PROCRE			; PERFORM A PROCESS CREATE
            2E            50     E9  0240   547 	BLBC	R0,50$			; BR IF COULDN'T CREATE ONE
            50            51     3C  0243   548 	MOVZWL	R1,R0			; GET PROCESS INDEX
       0000'8F            50     B1  0246   549 	CMPW	R0,#<JBC$G_INTJOBEND-JBC$G_INTJOBFLG>*8 ; INDEX WITHIN BIT ARRAY
                          24     14  024B   550 	BGTR	50$			; IF NO - DON'T COUNT INTERACTIVE JOB
       0000'CF            50     E2  024D   551 	BBSS	R0,W^JBC$G_INTJOBFLG,50$; SET FLAG AND BR IF SET, DON,T BUMP CNT
JBCMAIN         -JOB_CONTROLLER MAIN ROUTINE                     22-AUG-1978 00:42:39   VAX-11 MACRO X0.3-11               Page  13
V01             TERMINAL/CARD_READER UNSOLICTED DATA                                                                             (7)

                          1E         0252       
                                     0253   552 	$CMKRNL_S B^20$			; ADD 1 TO COUNT OF INTERACTIVE JOBS
                          10     11  025F   553 	BRB	50$			;
                               0000  0261   554 20$:	.WORD	0			; KERNAL ACCESS MODE ENTRY MASK
                 00000000'9F     B6  0263   555 	INCW	@#SYS$GW_IJOBCNT	; COUNT NUMBER OF INTERACTIVE JOBS
                                 04  0269   556 	RET				;
                                     026A   557  
                                     026A   558 JBC$CRUNSOLIN::				; CARD READER UNSOLICETED INPUT
            53       FDC4 CF     7E  026A   559 	MOVAQ	JBC$Q_INPSMB,R3		; SET ADDRESS OF IMAGE TO ACTIVATE FIRST
                          04     10  026F   560 	BSBB	PROCRE			; CREATE THE PROCESS
            50            01     D0  0271   561 50$:	MOVL	#1,R0			; SET RELASE THE BUFFER FLAG
                                 05  0274   562 	RSB				; RETURN TO AST DISPATCHER
                                     0275   563  
                                     0275   564 	.DSABL	LSB
JBCMAIN         -JOB_CONTROLLER MAIN ROUTINE                     22-AUG-1978 00:42:39   VAX-11 MACRO X0.3-11               Page  14
V01             TERMINAL/CARD_READER UNSOLICTED DATA                                                                             (7)

                                     0275   566  
                                     0275   567 ;
                                     0275   568 ; LOCAL SUBROUTINE TO CREATE A PROCESS FOR UNSOLICITED INPUT
                                     0275   569 ;
                                     0275   570  
            55            0E     C3  0275   571 PROCRE:	SUBL3	#JCM_T_MSGDATA-2,R5,R4	; FIND SECOND WORD OF LIST HEADER
                          54         0278       
            50            85     3C  0279   572 	MOVZWL	(R5)+,R0		; PICK UP BINARY UNIT NUMBER
            64            55     D0  027C   573 	MOVL	R5,(R4)			; SET START OF NAME IN STRING DESCRIPTOR
            52            65     9A  027F   574 	MOVZBL	(R5),R2			; GET LENGTH OF CONTROLLER NAME
            65         5F 8F     90  0282   575 	MOVB	#^A/_/,(R5)		; PUT UNDERSCORE AS FIRST CHAR IN NAME
            52         01 A542   9E  0286   576 	MOVAB	1(R5)[R2],R2		; FIND ADDRESS OF END OF CONTROLLER NAME
                          FD72'  30  028B   577 	BSBW	JBC$BIN2ASC		; CONVERT UNIT TO ASCII
            82            3A     90  028E   578 	MOVB	#^A/:/,(R2)+		; TERMINATE DEVICE NAME WITH COLON
            52            55     C3  0291   579 	SUBL3	R5,R2,-(R4)		; COMPUTE & STORE LENGTH OF DEVICE NAME
                          74         0294       
            55            54     D0  0295   580 	MOVL	R4,R5			; INITIAL PROCESS NAME IS DEVICE NAME
                          7E     D5  0298   581 	TSTL	-(SP)			; GET A SCRATCH LOCATION
            50            6E     DE  029A   582 10$:	MOVAL	(SP),R0			; AND GET THE ADDRESS OF SCRATCH CELL
            51   00000000'9F     9A  029D   583 	MOVZBL	@#SYS$GB_DEFPRI,R1	; SET SYSTEM DEFINED PRIORITY
                                     02A4   584 	$CREPRC_S	-		; CREATE A PROCESS
                                     02A4   585 		INPUT=	(R4),-		; DEIVICE INPUT IS TERMINAL
                                     02A4   586 		OUTPUT=	(R4),-		; LIKEWISE FOR THE DEVICE OUTPUT
                                     02A4   587 		ERROR=	(R4),-		; AND ALSO DEVICE ERROR
                                     02A4   588 		BASPRI=	R1,-		; INITIAL PRIORITY OF JOB
                                     02A4   589 		PIDADR= (R0),-		; PLACE TO STORE PROCESS ID
                                     02A4   590 		PRCNAM=	(R5),-		; ESTABLISH PROCESS NAME SAME AS DEVICE
                                     02A4   591 		IMAGE=	(R3),-		; IMAGE TO RUN
                                     02A4   592 		PRVADR=	W^JBC$Q_PRIVMASK,-; PROCESS DEFAULT PRIVILEGE
                                     02A4   593 		UIC=#<^O10@16+^O40>	; UIC IS [10,40]
            50            50     E8  02CA   594 	BLBS	R0,60$			; BR IF ALL IS OK
                          55     D4  02CD   595 	CLRL	R5			; ASSUME DUPLICATE PROCESS NAME
       0000'8F            50     B1  02CF   596 	CMPW	R0,#SS$_DUPLNAM		; IS ERROR DUPLICATE NAME
                          C4     13  02D4   597 	BEQL	10$			; BR IF YES, TRY TO CREATE WITH NO NAME
                                     02D6   598 	SHOW_ERROR	CREATE_PROC	; REPORT THE ERROR
            52            6E     9E  02D8   599 	MOVAB	(SP),R2			; GET ADDRESS OF SCRATCH WORD
                                     02DB   600 	$ASSIGN_S (R4),(R2)		; ASSIGN A CHANNEL TO THE DEVICE
            32            50     E9  02E8   601 	BLBC	R0,60$			; BR IF THIS FAILED
                                     02EB   602 	$QIO_S	CHAN=(R2),-		; WRITE MESSAGE TO TERMINAL
                                     02EB   603 		FUNC=#IO$_WRITEVBLK,-	; WRITE THE DATA
                                     02EB   604 		ASTADR=B^TTMSGAST,-	; AST WHEN WRITE IS DONE
                                     02EB   605 		ASTPRM=(R2),-		; CHANNEL NUMBER IS AST PARAMETER
                                     02EB   606 		P1=B^100$,-		; ADDRESS OF MESSAGE STRING
                                     02EB   607 		P2=S^#<110$-100$>,-	; LENGTH OF MESSAGE
                                     02EB   608 		P4=#32			; NORMAL CARRAIGE CONTROL
            0A            50     E8  030E   609 	BLBS	R0,50$			; BR IF QIO WAS ACCEPTED
                                     0311   610 	$DASSGN_S (R2)			; ELSE DEASSIGN TO RE-ENABLE UNSOL INPUT
                          50     D4  031B   611 50$:	CLRL	R0			; R0=LBC=PROCESS CREATE ERROR
                          02     BA  031D   612 60$:	POPR	#^M<R1>			; CLEAR SCRATCH WORD OR GET PROCESS ID
                                 05  031F   613 	RSB				;
                                     0320   614  
45 52 43 52 50 5F 57 5F 43 42 4A 25  0320   615 100$:	.ASCII	\%JBC_W_PRCREAT, process create error\
20 73 73 65 63 6F 72 70 20 2C 54 41  032C       
72 6F 72 72 65 20 65 74 61 65 72 63  0338       
                                     0344   616 110$:
                                     0344   617  
                               0000' 0344   618 	.ENTRY	TTMSGAST,0		; AST ENTRY POINT
JBCMAIN         -JOB_CONTROLLER MAIN ROUTINE                     22-AUG-1978 00:42:39   VAX-11 MACRO X0.3-11               Page  15
V01             TERMINAL/CARD_READER UNSOLICTED DATA                                                                             (7)

                                     0346   619 	$DASSGN_S 4(AP)			; DEASSIGN THE CHANNEL
                                 04  0351   620 	RET				;
                                     0352   621  
                                     0352   622 	.END
JBCMAIN         -JOB_CONTROLLER MAIN ROUTINE                     22-AUG-1978 00:42:39   VAX-11 MACRO X0.3-11               Page  16
SYMBOL TABLE                                                                                                                     (7)

$$T1           = 00000000            JBC$T_MBUFEND    00000000 RG    07   JBC_M_MBREADREQ= 00000001            
.$$.           = 00000015            JBC$T_MSGBUFR    00000000 RG    06   JBC_M_SRVTIMQUE= 00000010            
ACM$ACNTMAN      ********   X   03   JBC$VFYUPDQUE    ********   X   03   JBC_M_SYMCREREQ= 00000002            
ACM$B_PROCPRI    00000024            JBC$_ACMINVOP  = 00048088            JBC_M_SYMINIREQ= 00000004            
ACM$L_PROCID     FFFFFFFC            JBC$_ACNTOPN   = 00048478            JBC_V_CREJOBREQ= 00000003            
ACM$L_UIC        0000000C            JBC$_ACNTWRT   = 00048480            JBC_V_MBREADREQ= 00000000            
ACM$Q_ACNTNAM    0000001C            JBC$_ENTQUE    = 000484A8            JBC_V_SRVTIMQUE= 00000004            
ACM$Q_PRVMSK     00000004            JBC$_ILLDEVNAM = 00048000            JBC_V_SYMCREREQ= 00000001            
ACM$T_DATA       00000028            JBC$_ILLDEVTYP = 00048008            JBC_V_SYMINIREQ= 00000002            
ACM$T_USERNAM    00000010            JBC$_ILLFILNAM = 00048010            JCD_A_LBUFADR    0000000C            
ACM$W_MAILBOX    00000002            JBC$_ILLQUENAM = 00048018            JCD_A_QUEBASE    00000018            
ACM$W_TYPE       00000000            JBC$_INPASGN   = 00048488            JCD_B_CURPDEV    0000001D            
ACM$W_USERREQ    00000026            JBC$_INPREAD   = 00048490            JCD_B_CURSYMB    0000001C            
BIT...         = 00000009            JBC$_INVMSG    = 00048418            JCD_G_LISTS      00000000            
CREATE_PROC      ********   X   03   JBC$_INVSCT    = 00048468            JCD_G_WLEND      FFFFFFF0            
DASSGN_MB        ********   X   03   JBC$_JOBABORT  = 00048080            JCD_G_WORKLIST   FFFFFFD0            
GBL...         = 00000000            JBC$_JOBCRD    = 000484B0            JCD_K_SIZE     = 000000FC            
INVALID_MESG     ********   X   03   JBC$_LOSTREC   = 00048438            JCD_L_SMBPID     FFFFFFCC            
IO$M_NOW         ********   X   03   JBC$_MBASGN    = 00048400            JCD_Q_ACNTFIL    FFFFFFE8            
IO$_READVBLK     ********   X   03   JBC$_MBDEAS    = 00048460            JCD_Q_FREEBUFR   FFFFFFF0            
IO$_WRITEVBLK    ********   X   03   JBC$_MBREAD    = 00048408            JCD_Q_LBUFDES    00000008            
JBC$ACNTMAN      000000E3 R     03   JBC$_MBSETAST  = 000484C8            JCD_Q_PROCDEL    FFFFFFE0            
JBC$ASSIGNMB     ********   X   03   JBC$_MBWRITE   = 000484D0            JCD_Q_SYMBMAN    FFFFFFD8            
JBC$BIN2ASC      ********   X   03   JBC$_MULTREC   = 00048430            JCD_Q_SYMBSRV    FFFFFFD0            
JBC$B_QUEWRT     0000011C RG    0C   JBC$_NOOPENJOB = 00048048            JCD_Q_SYMBWAIT   FFFFFFF8            
JBC$CRUNSOLIN    0000026A RG    03   JBC$_NOPRIV    = 00048020            JCD_Q_TIME       FFFFFFC4            
JBC$DELETPRC     00000221 RG    03   JBC$_NOQUEHDR  = 00048028            JCD_Q_TMPDESC    00000010            
JBC$G_INTJOBEND  00000000 RG    0B   JBC$_NOQUESPACE= 00048030            JCD_T_INDEX0     00000000            
JBC$G_INTJOBFLG  00000000 RG    0A   JBC$_NORMAL    = 00040001            JCD_T_LINBFE     000000C0            
JBC$INSWORKLIST  00000225 R     03   JBC$_NOSUCHJOB = 00048040            JCD_T_LINBUF     0000001E            
JBC$LOOP         00000057 RG    03   JBC$_NOSUCHQUE = 00048038            JCD_T_START      FFFFFFC4            
JBC$MBAST        000001A0 RG    03   JBC$_PASSCRD   = 000484B8            JCD_W_FLAGS      00000004            
JBC$PRCDEL       ********   X   03   JBC$_PRCREAT   = 00048410            JCD_W_JOBSEQ     00000006            
JBC$Q_INADR      000000FC RG    0C   JBC$_PRINTOUT  = 000484E0            JCD_W_LBUFCNT    00000008            
JBC$Q_INPSMB     00000032 RG    03   JBC$_QUECNT    = 00048428            JCD_W_LBUFSIZ    0000000A            
JBC$Q_JBCNAM     00000000 RG    03   JBC$_QUEERR    = 00048458            JCD_W_MBCHAN     00000002            
JBC$Q_LOGIN      00000013 RG    03   JBC$_QUENOSTOP = 00048050            JCD_W_TMPCHAN    00000000            
JBC$Q_PRIVMASK   0000004F RG    03   JBC$_QUEUPD    = 000484E8            JCM_K_SIZE       000000C0            
JBC$Q_RETADR     00000104 RG    0C   JBC$_SCTERR    = 00048450            JCM_Q_IOSB       00000008            
JBC$Q_UPDADR     0000010C RG    0C   JBC$_SMINVOPR  = 00048058            JCM_Q_LINKS      00000000            
JBC$Q_UPDIOSB    00000114 RG    0C   JBC$_SMINVOPT  = 00048060            JCM_T_MSGDATA    00000010            
JBC$READMB       00000164 RG    03   JBC$_SMINVREQ  = 00048068            MAILBOX_READ     ********   X   03   
JBC$RWDEND       00000000 RG    05   JBC$_SMZEROJOB = 00048070            MSG$_ABOOPR    = 00000011            
JBC$RWDTOP       00000000 RG    04   JBC$_SNDRESP   = 00048420            MSG$_ABORT     = 00000030            
JBC$SNDACMAN     00000215 R     03   JBC$_SYMBASN   = 00048440            MSG$_ACCRSP    = 00000021            
JBC$SNDRESP      00000140 RG    03   JBC$_SYMBCRE   = 000484D8            MSG$_CONFIRM   = 00000031            
JBC$SNDSYMAN     0000021B RG    03   JBC$_SYMBDSAB  = 00048078            MSG$_CONNECT   = 00000032            
JBC$STADET       ********   X   03   JBC$_SYMBWRT   = 00048448            MSG$_CRUNSOLIC = 00000002            
JBC$SYMBDONE     000001E0 RG    03   JBC$_SYMDEL    = 00048470            MSG$_DELPROC   = 00000003            
JBC$SYMBINIT     00000200 RG    03   JBC$_UAFOPN    = 000484A0            MSG$_DELSMB    = 00000014            
JBC$SYMBMAN      000000E9 RG    03   JBC$_UNESYMMSG = 000484C0            MSG$_DEVOFFLIN = 00000005            
JBC$SYMBSERV     ********   X   03   JBC$_USERVAL   = 00048498            MSG$_DEVONLIN  = 00000007            
JBC$SYNCMAIN     0000022B R     03   JBC_K_MAXBUFR  = 00000004            MSG$_DISCON    = 00000033            
JBC$TTUNSOLIN    00000239 RG    03   JBC_K_PRTIMFLAG= 00000002            MSG$_EXIT      = 00000034            
JBC$T_DATABLK  = 0000003C RG    0C   JBC_K_SYNCFLAG = 00000001            MSG$_INIOPR    = 00000010            
JBC$T_MBOXNAME   0000011D RG    0C   JBC_K_UPDFLG   = 00000008            MSG$_INTMSG    = 00000035            
JBC$T_MBOXUNIT   00000121 RG    0C   JBC_M_CREJOBREQ= 00000008            MSG$_OPREPLY   = 00000009            
JBCMAIN         -JOB_CONTROLLER MAIN ROUTINE                     22-AUG-1978 00:42:39   VAX-11 MACRO X0.3-11               Page  17
SYMBOL TABLE                                                                                                                     (7)

MSG$_OPRQST    = 00000008            STS$K_SUCCESS  = 00000001            WAIT             00000093 R     03   
MSG$_PATHLOST  = 00000036            STS$K_WARNING  = 00000000            _$$_           = 000000EF            
MSG$_PROTOCOL  = 00000037            STS$M_CODE     = 00007FF8            
MSG$_REJECT    = 00000038            STS$M_COND_ID  = 0FFFFFF8            
MSG$_RESOPR    = 00000013            STS$M_CONTROL  = F0000000            
MSG$_SCANBAD   = 00000028            STS$M_CUST_DEF = 08000000            
MSG$_SCANRSP   = 00000029            STS$M_FAC_NO   = 0FFF0000            
MSG$_SMBDON    = 00000009            STS$M_FAC_SP   = 00008000            
MSG$_SMBINI    = 00000008            STS$M_INHIB_MSG= 10000000            
MSG$_SMBRSP    = 00000020            STS$M_MSG_NO   = 0000FFF8            
MSG$_SNDACC    = 0000000A            STS$M_SEVERITY = 00000007            
MSG$_SNDSMB    = 00000004            STS$M_SUCCESS  = 00000001            
MSG$_SUSOPR    = 00000012            STS$S_CODE     = 0000000C            
MSG$_THIRDPARTY= 00000039            STS$S_COND_ID  = 00000019            
MSG$_TIMEOUT   = 0000003A            STS$S_CONTROL  = 00000004            
MSG$_TRMHANGUP = 00000006            STS$S_CUST_DEF = 00000001            
MSG$_TRMUNSOLIC= 00000001            STS$S_FAC_NO   = 0000000C            
MSG$_XM_ATTN   = 0000000D            STS$S_FAC_SP   = 00000001            
MSG$_XM_DATAVL = 0000000B            STS$S_INHIB_MSG= 00000001            
MSG$_XM_SHUTDN = 0000000C            STS$S_MSG_NO   = 0000000D            
PROCRE           00000275 R     03   STS$S_SEVERITY = 00000003            
SCT_B_FLAGS      00000009            STS$S_SUCCESS  = 00000001            
SCT_B_STATE      00000008            STS$V_CODE     = 00000003            
SCT_K_ABOREQ   = 00000005            STS$V_COND_ID  = 00000003            
SCT_K_DEQFIL   = 00000003            STS$V_CONTROL  = 0000001C            
SCT_K_DEQJOB   = 00000002            STS$V_CUST_DEF = 0000001B            
SCT_K_FREE     = 00000000            STS$V_FAC_NO   = 00000010            
SCT_K_INIT     = 00000001            STS$V_FAC_SP   = 0000000F            
SCT_K_MRKDEL   = 00000008            STS$V_INHIB_MSG= 0000001C            
SCT_K_REQUE    = 00000006            STS$V_MSG_NO   = 00000003            
SCT_K_SIZE       00000028            STS$V_SEVERITY = 00000000            
SCT_K_SUSPND   = 00000007            STS$V_SUCCESS  = 00000000            
SCT_K_TRMJOB   = 00000004            SYM$CREPRTSYM    ********   X   03   
SCT_L_CPUTIM     00000018            SYM$FINDSYMCTL   ********   X   03   
SCT_L_CURFIL     00000010            SYM$G_SYMCTLTBE  00000000 RG    09   
SCT_L_GETCNT     00000024            SYM$G_SYMCTLTBL  00000000 RG    08   
SCT_L_PAGCNT     0000001C            SYM$SRVTIMER     ********   X   03   
SCT_L_PROCID     0000000C            SYM$SYMBMAN      ********   X   03   
SCT_L_QIOCNT     00000020            SYMBEXIT         0000020D R     03   
SCT_Q_LINKS      00000000            SYM_K_MAXDEVNAM= 0000000F            
SCT_W_JOBSTAT    00000016            SYM_K_MAXFILNAM= 00000013            
SCT_W_MBCHAN     0000000A            SYM_K_MAXSYMB  = 00000010            
SCT_W_QINDEX     00000014            SYM_K_NUMQUEUE = 0000001F            
SMR$B_PROCPRI    00000024            SYM_K_NUMRECORD= 00000400            
SMR$L_PROCID     FFFFFFFC            SYM_K_PRTPRI   = 00000020            
SMR$L_UIC        0000000C            SYM_K_QUENAM   = 0000000F            
SMR$Q_ACNTNAM    0000001C            SYS$ASSIGN       ********   X   03   
SMR$Q_PRVMSK     00000004            SYS$CMKRNL       ********   X   03   
SMR$T_DATA       00000028            SYS$CREPRC       ********   X   03   
SMR$T_USERNAM    00000010            SYS$DASSGN       ********   X   03   
SMR$W_MAILBOX    00000002            SYS$GB_DEFPRI    ********   X   03   
SMR$W_TYPE       00000000            SYS$GETTIM       ********   X   03   
SMR$W_USERREQ    00000026            SYS$GW_IJOBCNT   ********   X   03   
SS$_DUPLNAM      ********   X   03   SYS$HIBER        ********   X   03   
STS$K_ERROR    = 00000002            SYS$QIO          ********   X   03   
STS$K_INFO     = 00000003            SYS$WAKE         ********   X   03   
STS$K_SEVERE   = 00000004            TTMSGAST         00000344 RG    03   
JBCMAIN         -JOB_CONTROLLER MAIN ROUTINE                     22-AUG-1978 00:42:39   VAX-11 MACRO X0.3-11               Page  18
PROGRAM SECTION SYNOPSIS                                                                                                         (7)



PROGRAM SECTION SYNOPSIS

.  ABS  .        00000000      00     NOPIC   USR   CON   ABS   LCL NOSHR NOEXE NORD  NOWRT BYTE  
. BLANK .        00000000      01     NOPIC   USR   CON   REL   LCL NOSHR   EXE   RD    WRT BYTE  
$ABS$            FFFFFFFC      02     NOPIC   USR   CON   ABS   LCL NOSHR   EXE   RD    WRT BYTE  
JBC_PURE         00000352      03     NOPIC   USR   CON   REL   LCL NOSHR   EXE   RD  NOWRT BYTE  
JBC$$RWDTOP      00000000      04     NOPIC   USR   CON   REL   LCL NOSHR NOEXE   RD    WRT LONG  
JBC__RWDEND      00000000      05     NOPIC   USR   CON   REL   LCL NOSHR NOEXE   RD    WRT LONG  
JBC$RWDMSGBFR    00000300      06     NOPIC   USR   CON   REL   LCL NOSHR NOEXE   RD    WRT LONG  
JBC$RWDMSGBFS    00000000      07     NOPIC   USR   CON   REL   LCL NOSHR NOEXE   RD    WRT LONG  
JBC$RWDSYMCTL    00000280      08     NOPIC   USR   CON   REL   LCL NOSHR NOEXE   RD    WRT LONG  
JBC$RWDSYMCTM    00000000      09     NOPIC   USR   CON   REL   LCL NOSHR NOEXE   RD    WRT LONG  
JBC$RWDINTJOB    00000020      0A     NOPIC   USR   CON   REL   LCL NOSHR NOEXE   RD    WRT LONG  
JBC$RWDINTJOC    00000000      0B     NOPIC   USR   CON   REL   LCL NOSHR NOEXE   RD    WRT LONG  
JBC_RWDATA       00000126      0C     NOPIC   USR   CON   REL   LCL NOSHR NOEXE   RD    WRT LONG  


THERE WERE NO ERRORS OR WARNINGS.
13260. BYTES LEFT IN FREE MEMORY POOL.
OBJ$:JBCMAIN,LIS$:JBCMAIN/-SP=EXECML$/ML,LIB$:JOBCTL/ML,SRC$:JBCMAIN
54 MLB DIR RDS - 523 GETS TO DEFINE 35 MACROS. 33 INTER. FILE WRITES. 
