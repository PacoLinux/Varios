SOSLST - OPEN AND CLOSE LISTING	MACRO M1110  22-AUG-78 05:33  PAGE 2


    100						.TITLE	SOSLST - OPEN AND CLOSE LISTING FILE
    200						.IDENT	/020600/
    300					;
    400					; COPYRIGHT 1978, DIGITAL EQUIPMENT CORP., MAYNARD, MASS. 01754
    500					;
    600					; DEC ASSUMES NO RESPONSIBILITY FOR THE USE OR RELIABILITY OF ITS
    700					; SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DEC.
    800					;
    900					; THIS SOFTWARE IS FURNISHED TO PURCHASER UNDER A LICENSE FOR USE
   1000					; ON A SINGLE COMPUTER SYSTEM AND CAN BE COPIED (WITH INCLUSION
   1100					; OF DEC'S COPYRIGHT NOTICE) ONLY FOR USE IN SUCH SYSTEM, EXCEPT
   1200					; AS MAY OTHERWISE BE PROVIDED IN WRITING BY DEC.
   1300					;
   1400					; THE INFORMATION IN THIS DOCUMENT IS SUBJECT TO CHANGE WITHOUT
   1500					; NOTICE AND SHOULD NOT BE CONSTRUED AS A COMMITMENT BY DIGITAL
   1600					; EQUIPMENT CORPORATION.
   1700					;
   1800					; PETER H. LIPMAN	29-AUG-76
   1900					;
   2000						.MCALL	FDOF$L,FCSBT$,QIOSY$
   2100	000000					FDOF$L
   2200	000000					FCSBT$
   2250	000000					QIOSY$
   2300						.MCALL	CCML$,OFNB$,CLOSE$
   2350						.MCALL	QIO$,DIR$,WTSE$S,GTIM$S,ALUN$S
SOSLST - OPEN AND CLOSE LISTING	MACRO M1110  22-AUG-78 05:33  PAGE 3


    100	000000					CODE$	LST
    200
    300	000000				ENTRY	PUTLST				;PUT TO LISTING FILE
    400	000000	004167 	000000G			JSR	R1,$SAV3		;SAVE 3 REGS
    500	000004	016601 	000016 			MOV	16(SP),R1		;FDB POINTER
    600	000010	117600 	000020 			MOVB	@20(SP),R0		;GET FLAGS WORD
    700	000014	032700 	000001 			BIT	#1,R0			;ALREADY INITIALIZED?
    800	000020	001004 				BNE	10$			;BRANCH IF YES
    900	000022	004767 	000000G			JSR	PC,SETPUT		;GET PUT FLAGS WORD, SET RECORD TYPE
   1000	000026	110076 	000020 			MOVB	R0,@20(SP)		;STORE IT BACK
   1100	000032	016602 	000014 		10$:	MOV	14(SP),R2		;LINE ADDRESS
   1200	000036	016603 	000012 			MOV	12(SP),R3		;PAGE # ADDRESS
   1300	000042	000167 	000000G			JMP	PUTLS1
   1400
   1500	000046				ENTRY	OPNLST				;OPNLST(DSTFLG,FDB)
   1550										;NOTE ADDRESS OF DSTFLG, NOT VALUE
   1600
   1700	000046					CCML$	#GCMLB			;CLOSE CMD FILE
   1800										;FREEING SOME FSR SPACE
   1900	000056	016600 	000002 			MOV	2(SP),R0		;FDB ADDRESS
   2000	000062	112760 	000002 	000000 		MOVB	#R.VAR,F.RTYP(R0)	;SET RECORD TYPE TO DEFAULT
   2100	000070	112760 	000002 	000001 		MOVB	#FD.CR,F.RATT(R0)	;AND SET CARRIAGE CONTROL
   2200
   2300						.IF	DF,R$$STS
   2400						OFNB$	,#FO.WRT		;OPEN THE .LST FILE
   2500
   2600						.IFF				;RSX ONLY
   2650	000076	004167 	000000G			JSR	R1,$SAV2		;SAVE SOME REGISTERS
   2700	000102	004767 	000000G			JSR	PC,DETACH		;IN CASE LST LUN = TI:
   2800	000106	017601 	000012 			MOV	@10.(SP),R1		;GET DESTINATION FLAG
   2850	000112	100431 				BMI	20$			;NEGATIVE IT TO A FILE
   2900	000114	012760 	050114 	000134 		MOV	#"LP,F.DVNM(R0)		;OTHERWISE ASSUME A PRINTER
   2950	000122	010160 	000136 			MOV	R1,F.UNIT(R0)		;WITH THAT UNIT NUMBER
   3000	000126	001023 				BNE	20$			;IF NOT UNIT 0, THEN GO DIRECT
   3050	000130	032767 	000000C	000000G		BIT	#SYS11D!SYSIAS!SYSMPL!SYSCME,SYSTEM ;AUTO SPOOLING OF LP?
   3100	000136	001403 				BEQ	10$			;BRANCH IF MUST SPOOL MANUALLY
   3150	000140	005276 	000012 			INC	@10.(SP)		;DON'T SPOOL ON CLOSE
   3200	000144	000414 				BR	20$
   3250	000146	012760 	054523 	000134 	10$:	MOV	#"SY,F.DVNM(R0)		;USE SY0: AS INTERMEDIATE DEVICE
   3300	000154	032767 	000000G	000000G		BIT	#SYSCME,SYSTEM		;AND FOR 11M ETC
   3350	000162	001005 				BNE	20$
   3400	000164	012760 	046600 	000110 		MOV	#^RLP ,F.FNAM(R0)	;USE LP.LST WHICH WILL AUTO DELETE
   3450	000172	005060 	000112 			CLR	F.FNAM+2(R0)
   4100	000176				20$:	OFNB$	R0,#FO.WRT		;OPEN FOR OUTPUT
   4200	000210	103404 				BCS	30$
   4300	000212	012701 	001400 			MOV	#IO.ATT,R1		;FUNCTION CODE FOR ATTACH
   4400	000216	004767 	000150 			JSR	PC,ADLST		;ATTACH LST DEV IF NECESSARY
   4500	000222	004767 	000000G		30$:	JSR	PC,ATTACH		;REATTACH THE TERMINAL
   4600						.ENDC
   4700
   4800	000226	000167 	000000G			JMP	FCSDON			;SET RETURN CODE AND EXIT
   4900
   5000	000232				ENTRY	CLOLST			;CLOSE LIST FILE
   5100
   5200						.IF	DF,R$$STS
   5300						MOV	2(SP),-(SP)		;FDB ADR
   5400						JSR	PC,CLOSE		;CLOSE THE FILE
SOSLST - OPEN AND CLOSE LISTING	MACRO M1110  22-AUG-78 05:33  PAGE 3-1


   5500						MOV	#CLOMSG,(SP)		;MESSAGE TO TELL USER
   5600						JSR	PC,PRINT
   5700						MOV	4(SP),(SP)		;FDB ADR AS PARAMETER
   5800						CLR	-(SP)			;NO [FILE] OR (NO CHG)
   5900						JSR	PC,PRTFIL
   6000						CMP	(SP)+,(SP)+		;POP 2
   6100
   6200						.IFF
   6300	000232	016600 	000002 			MOV	2(SP),R0
   6600	000236	005766 	000004 			TST	4(SP)			;0 MEANS SPOOLED
   6700	000242	001002 				BNE	10$
   6800	000244	000167 	000000G			JMP	.PRINT			;SPOOL IT AND RETURN TO CALLER
   6900	000250	004167 	000000G		10$:	JSR	R1,$SAV2
   7000	000254	012701 	002000 			MOV	#IO.DET,R1		;FUNCTION CODE FOR DETACH
   7100	000260	004767 	000106 			JSR	PC,ADLST		;DETACH .LST FILE IF NECESSARY
   7200	000264					CLOSE$	R0			;AND FINALLY CLOSE THE FILE
   7250	000270	116001 	000042 			MOVB	F.LUN(R0),R1		;FETCH LOGICAL UNIT TO WORD
   7300	000274					ALUN$S	R1,#"SY,#0		;FORCE LUN AWAY FROM RECORD DEVICE
   7400										;REQUIRED TO RELEASE OWNERSHIP IN VAX
   7500						.ENDC
   7600
   7700	000312	000207 				RTS	PC
   7800
   7900					;
   8000					; GDATIM(OUTADR);
   8100					;	CONVERT DATE AND TIME TO ASCII STRING STARTING AT OUTADR
   8200					;	RETURN R0 = ADDRESS OF BYTE JUST BEYOND LAST STORED.
   8300					;
   8400	000314				ENTRY	GDATIM				;GET DATE AND TIME TO STRING
   8500	000314	016600 	000002 			MOV	2(SP),R0		;ADDRESS TO RETURN STRING
   8600	000320	004167 	000000G			JSR	R1,$SAV3		;PRESERVE R1, R2, R3
   8700	000324	162706 	000020 			SUB	#16.,SP			;MAKE ROOM FOR TIME PARAMETERS
   8800	000330	010601 				MOV	SP,R1			;ADDRESS OF AREA TO STORE TIME DATA
   8900	000332					GTIM$S	R1
   9000	000342	103410 				BCS	10$			;BRANCH IF ERROR
   9100	000344	004767 	000000G			JSR	PC,$DAT			;CONVERT DATE TO ASCII
   9200	000350	112720 	000040 			MOVB	#' ,(R0)+		;PUT IN A SEPARATOR
   9300	000354	012702 	000003 			MOV	#3,R2			;TIME TO SECONDS
   9400	000360	004767 	000000G			JSR	PC,$TIM			;CONVERT TIME TO ASCII
   9500	000364	062706 	000020 		10$:	ADD	#16.,SP			;CLEAN OFF TIME DATA
   9600	000370	000207 				RTS	PC			;AND RETURN WITH R0=ADR OF NEXT CHAR
   9700					;
   9800					; ATTACH OR DETACH LISTING DEVICE IF NECESSARY
   9900					;
  10000					; INPUTS:
  10100					;
  10200					;	R0 = FDB ADDRESS
  10300					;	R1 = IO.ATT OR IO.DET FUNCTION CODE
  10400					;
  10500
  10600						.IF	NDF,R$$STS		;RSX ONLY
  10700	000372	032767 	000000G	000000G	ADLST:	BIT	#SYSCME,SYSTEM		;DON'T BOTHER WITH ATTACH/DETACH
  10800	000400	001007 				BNE	20$			;IF THIS IS VAX CME
  10900	000402	132760 	000034 	000017 		BITB	#FD.TTY!FD.DIR!FD.SDI,F.RCTL(R0) ;ATTACH NECESSARY?
  11000	000410	001003 				BNE	20$			;BRANCH IF NOT ATTACHING FDB
  11100	000412	005002 				CLR	R2			;NO ADDITIONAL PARAMETERS
  11200	000414	004767 	000000G			JSR	PC,.XQIO		;ISSUE THE ATTACH QI/O
SOSLST - OPEN AND CLOSE LISTING	MACRO M1110  22-AUG-78 05:33  PAGE 3-2


  11300	000420	000207 			20$:	RTS	PC
  11400
  11500						.IFF				;RSTS ONLY
  11600
  11700						PLIT$	LST
  11800
  11900						.WORD	CLOL+1/2
  12000					CLOMSG:	.ASCII	/Output file=/
  12100					CLOL	=	.-CLOMSG
  12200						.EVEN
  12300						.ENDC
  12400
  12500		000001 				.END
SOSLST - OPEN AND CLOSE LISTING	MACRO M1110  22-AUG-78 05:33  PAGE 3-3
SYMBOL TABLE

ADLST   000372R     002	F.BDB = 000070   	IE.ADP= 177636   	IE.ITS= 177770   	IE.2DV= 177720
ATTACH= ****** GX	F.BGBC= 000057   	IE.ALC= 177654   	IE.IUI= 177645   	IO.ACE= 007400
CH.AND= 000001   	F.BKDN= 000026   	IE.ALG= 177654   	IE.LCK= 177745   	IO.ACR= 006400
CLOLST  000232RG    002	F.BKDS= 000020   	IE.ALN= 177736   	IE.LNL= 177646   	IO.ACW= 007000
DETACH= ****** GX	F.BKEF= 000050   	IE.AST= 177660   	IE.MAP= 177657   	IO.ADS= 014000
FA.APD= 000100   	F.BKP1= 000051   	IE.BAD= 177777   	IE.MOD= 177753   	IO.APC= 014000
FA.CRE= 000010   	F.BKST= 000024   	IE.BBE= 177710   	IE.NBF= 177731   	IO.APV= 014010
FA.DLK= 001000   	F.BKVB= 000064   	IE.BCC= 177676   	IE.NBK= 177727   	IO.ATA= 001410
FA.ENB= 100000   	F.CHR = 000075   	IE.BDI= 177714   	IE.NDR= 177670   	IO.ATT= 001400
FA.EXC= 002000   	F.CNTG= 000034   	IE.BDR= 177716   	IE.NFI= 177704   	IO.CAS= 015420
FA.EXT= 000004   	F.DFNB= 000046   	IE.BDV= 177711   	IE.NFW= 177673   	IO.CBO= 015510
FA.NSP= 000100   	F.DSPT= 000044   	IE.BHD= 177700   	IE.NLK= 177661   	IO.CCI= 014000
FA.POS= 010000   	F.DVNM= 000134   	IE.BLB= 177672   	IE.NLN= 177733   	IO.CCO= 000440
FA.RD = 000001   	F.EFBK= 000010   	IE.BLK= 177754   	IE.NNC= 177663   	IO.CIN= 016500
FA.RWD= 004000   	F.EFN = 000050   	IE.BNM= 177712   	IE.NNL= 177662   	IO.CLK= 015000
FA.SEQ= 040000   	F.EOBB= 000032   	IE.BTF= 177664   	IE.NNN= 177674   	IO.CLN= 003400
FA.SHR= 000040   	F.ERR = 000052   	IE.BTP= 177725   	IE.NOD= 177751   	IO.CNT= 017000
FA.TMP= 000020   	F.FACC= 000043   	IE.BVR= 177701   	IE.NSF= 177746   	IO.CON= 015400
FA.WCK= 020000   	F.FFBY= 000014   	IE.BYT= 177755   	IE.NST= 177660   	IO.CPR= 015410
FA.WRT= 000002   	F.FNAM= 000110   	IE.CKP= 177766   	IE.NSW= 177756   	IO.CPW= 016520
FCSDON= ****** GX	F.FNB = 000102   	IE.CKS= 177742   	IE.NVR= 177652   	IO.CRC= 001040
FD.BLK= 000010   	F.FTYP= 000116   	IE.CLO= 177732   	IE.NVW= 177651   	IO.CRE= 012000
FD.CCL= 000002   	F.FVER= 000120   	IE.CNR= 177667   	IE.OFL= 177677   	IO.CRJ= 015440
FD.COM= 020000   	F.HIBK= 000004   	IE.CON= 177752   	IE.ONP= 177773   	IO.CSI= 013000
FD.CR = 000002   	F.LUN = 000042   	IE.DAA= 177770   	IE.OVR= 177756   	IO.CSM= 016470
FD.DIR= 000010   	F.MBCT= 000054   	IE.DAO= 177763   	IE.PES= 177655   	IO.CTI= 015400
FD.FTN= 000001   	F.MBC1= 000055   	IE.DFU= 177750   	IE.PNS= 177642   	IO.CTL= 016400
FD.F11= 040000   	F.MBFG= 000056   	IE.DNA= 177771   	IE.PRI= 177760   	IO.CTR= 015610
FD.INS= 000010   	F.NRBD= 000024   	IE.DNR= 177775   	IE.PTS= 177775   	IO.CTY= 003400
FD.ISP= 002000   	F.NREC= 000030   	IE.DUN= 177767   	IE.RAC= 177724   	IO.DAC= 010000
FD.MNT= 100000   	F.OVBS= 000030   	IE.DUP= 177707   	IE.RAT= 177723   	IO.DCI= 014400
FD.OSP= 004000   	F.RACC= 000016   	IE.EOF= 177766   	IE.RBG= 177730   	IO.DEL= 012400
FD.PLC= 000004   	F.RATT= 000001   	IE.EOT= 177702   	IE.RBS= 177761   	IO.DET= 002000
FD.PRN= 000004   	F.RCNM= 000034   	IE.EOV= 177765   	IE.RCN= 177722   	IO.DIS= 016000
FD.PSE= 010000   	F.RCTL= 000017   	IE.EXP= 177665   	IE.RER= 177740   	IO.DLB= 016540
FD.RAH= 000001   	F.RSIZ= 000002   	IE.FEX= 177717   	IE.RNM= 177715   	IO.DSI= 013400
FD.RAN= 000002   	F.RTYP= 000000   	IE.FHE= 177705   	IE.RSU= 177757   	IO.DTI= 016000
FD.REC= 000001   	F.SEQN= 000100   	IE.FIX= 177767   	IE.SDP= 177635   	IO.DTY= 006400
FD.RWM= 000001   	F.SPDV= 000072   	IE.FLN= 177657   	IE.SNC= 177735   	IO.ENA= 006000
FD.SDI= 000020   	F.SPUN= 000074   	IE.FOP= 177713   	IE.SPC= 177772   	IO.EOF= 003000
FD.SQD= 000040   	F.STBK= 000036   	IE.HFU= 177744   	IE.SQC= 177734   	IO.EXT= 011400
FD.TTY= 000004   	F.UNIT= 000136   	IE.HWR= 177772   	IE.SRE= 177762   	IO.FDX= 003020
FD.WBH= 000002   	F.URBD= 000020   	IE.IBS= 177647   	IE.STK= 177706   	IO.FLN= 012400
FF.CHR= 000005   	F.VBN = 000064   	IE.IDU= 177644   	IE.TCH= 177765   	IO.FNA= 004400
FF.NV = 000003   	F.VBSZ= 000060   	IE.IEF= 177637   	IE.TMM= 177671   	IO.GLC= 016430
FF.POE= 000002   	GCMLB = ****** GX	IE.IES= 177656   	IE.TMO= 177666   	IO.GLI= 016420
FF.RWD= 000001   	GDATIM  000314RG    002	IE.IFC= 177776   	IE.ULK= 177653   	IO.GNI= 016410
FF.RWF= 000006   	G.TICP= 000016   	IE.IFU= 177747   	IE.ULN= 177773   	IO.GRC= 016450
FF.SPC= 000004   	G.TICT= 000014   	IE.ILL= 177726   	IE.UNS= 177774   	IO.GRI= 016440
FO.APD= 000106   	G.TIDA= 000004   	IE.ILU= 177640   	IE.UPN= 177777   	IO.GRN= 016460
FO.MFY= 000002   	G.TIHR= 000006   	IE.ILV= 177755   	IE.VER= 177774   	IO.GTS= 002400
FO.RD = 000001   	G.TIMI= 000010   	IE.INS= 177776   	IE.WAC= 177743   	IO.HDX= 003010
FO.UPD= 000006   	G.TIMO= 000002   	IE.IOP= 177655   	IE.WAT= 177741   	IO.HIS= 015000
FO.WRT= 000016   	G.TISC= 000012   	IE.IPR= 177641   	IE.WCK= 177652   	IO.HNG= 003000
F.ACTL= 000076   	G.TIYR= 000000   	IE.ISQ= 177703   	IE.WER= 177737   	IO.INI= 014400
F.ALOC= 000040   	IE.ABO= 177761   	IE.ITI= 177643   	IE.WLK= 177764   	IO.INL= 002400
F.BBFS= 000062   	IE.ACT= 177771   	IE.ITP= 177650   	IE.WOV= 177653   	IO.ITI= 017000
SOSLST - OPEN AND CLOSE LISTING	MACRO M1110  22-AUG-78 05:33  PAGE 3-4
SYMBOL TABLE

IO.KIL= 000012   	IO.RLV= 001100   	IO.TRM= 002410   	IS.ESC= 015401   	RONLY$= 000001
IO.LDI= 007000   	IO.RMT= 010020   	IO.UDI= 011410   	IS.ESQ= 115401   	R$$EIS= 000001
IO.LED= 012000   	IO.RNA= 005400   	IO.UEI= 011450   	IS.PES= 100001   	R$$SHR= 000001
IO.LEI= 007410   	IO.RNC= 001040   	IO.UER= 011440   	IS.PND= 000000   	R.FIX = 000001
IO.LKE= 012000   	IO.RNE= 001020   	IO.ULK= 005000   	IS.RDD= 000002   	R.SEQ = 000003
IO.LOD= 014000   	IO.RNS= 001020   	IO.UNL= 000042   	IS.SET= 000002   	R.VAR = 000002
IO.LOV= 001010   	IO.RPB= 001040   	IO.USI= 011460   	IS.SPD= 000002   	SETPUT= ****** GX
IO.LSI= 011000   	IO.RPR= 004400   	IO.UTI= 011420   	IS.SUC= 000001   	SYSCME= ****** GX
IO.LTI= 007400   	IO.RST= 001001   	IO.UTY= 011430   	IS.TAB= 004401   	SYSIAS= ****** GX
IO.LTK= 000050   	IO.RTC= 003400   	IO.WAL= 000410   	IS.TMO= 000002   	SYSMPL= ****** GX
IO.LTY= 010000   	IO.RTI= 016400   	IO.WAT= 013400   	NB.DEV= 000200   	SYSTEM= ****** GX
IO.MAO= 003410   	IO.RTK= 000060   	IO.WBT= 000500   	NB.DIR= 000100   	SYS11D= ****** GX
IO.MCS= 013400   	IO.RTM= 001200   	IO.WDD= 000444   	NB.NAM= 000004   	S.FATT= 000016
IO.MDA= 016000   	IO.RVB= 010400   	IO.WLB= 000400   	NB.SD1= 000400   	S.FDB = 000140
IO.MDI= 014400   	IO.RWD= 002400   	IO.WLC= 000420   	NB.SD2= 001000   	S.FNAM= 000006
IO.MDO= 015400   	IO.RWU= 002540   	IO.WLS= 000410   	NB.SNM= 000040   	S.FNB = 000036
IO.MLO= 006000   	IO.R1C= 002400   	IO.WLT= 000410   	NB.STP= 000020   	S.FNBW= 000017
IO.MOD= 003000   	IO.SAO= 004000   	IO.WLV= 000500   	NB.SVR= 000010   	S.FNTY= 000004
IO.MSO= 005000   	IO.SCS= 013000   	IO.WMS= 000420   	NB.TYP= 000002   	S.FTYP= 000002
IO.NLB= 016530   	IO.SDI= 013000   	IO.WNS= 000420   	NB.VER= 000001   	S.NFEN= 000020
IO.NLK= 011400   	IO.SDO= 012400   	IO.WPB= 000440   	N.DID = 000024   	$DAT  = ****** GX
IO.ONL= 017400   	IO.SEC= 002520   	IO.WVB= 011000   	N.DVNM= 000032   	$SAV2 = ****** GX
IO.RAD= 010400   	IO.SET= 000030   	IO.XMT= 014400   	N.FID = 000000   	$SAV3 = ****** GX
IO.RAL= 001010   	IO.SLO= 005400   	IO.XNA= 014410   	N.FNAM= 000006   	$TIM  = ****** GX
IO.RAT= 013000   	IO.SMO= 002560   	IQ.Q  = 000002   	N.FTYP= 000014   	$$MSG = 000000
IO.RBC= 003000   	IO.SPB= 002420   	IQ.S  = 000004   	N.FVER= 000016   	$$$OST= 000020
IO.RCI= 015000   	IO.SPF= 002440   	IQ.UMD= 000004   	N.NEXT= 000022   	.CLOSE= ****** G
IO.RCV= 015000   	IO.SPW= 016510   	IQ.X  = 000001   	N.STAT= 000020   	.GCML3= ****** G
IO.RDB= 001200   	IO.SSO= 004400   	IS.BV = 000005   	N.UNIT= 000034   	.OPFNB= ****** G
IO.RDD= 010010   	IO.STA= 015400   	IS.CC = 001401   	OPNLST  000046RG    002	.PRINT= ****** GX
IO.RDN= 000022   	IO.STC= 002500   	IS.CLR= 000000   	PAR$$$= 000000   	.XQIO = ****** GX
IO.REL= 013400   	IO.STP= 016400   	IS.CR = 006401   	PUTLST  000000RG    002	...GBL= 000000
IO.RHD= 001010   	IO.SYN= 003040   	IS.EOT= 002001   	PUTLS1= ****** GX	...TPC= 000140
IO.RLB= 001000

. ABS.	000000	   000
      	000000	   001
CODE  	000422	   002
ERRORS DETECTED:  0

VIRTUAL MEMORY USED:  5280 WORDS  ( 21 PAGES)
DYNAMIC MEMORY:  5940 WORDS  ( 22 PAGES)
ELAPSED TIME:  00:00:23
OBJ$:SOSLST,LIS$:SOSLST/-SP/NL:TOC=SRC$:PREFIX,SOSLST
