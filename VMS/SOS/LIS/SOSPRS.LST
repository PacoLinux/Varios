SOSPRS	MACRO M1110  22-AUG-78 05:34  PAGE 2


    100						.TITLE	SOSPRS
    200						.IDENT	/6B01/
    300					;
    400					; COPYRIGHT 1976, DIGITAL EQUIPMENT CORP., MAYNARD, MASS. 01754
    500					;
    600					; DEC ASSUMES NO RESPONSIBILITY FOR THE USE OR RELIABILITY OF ITS
    700					; SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DEC.
    800					;
    900					; THIS SOFTWARE IS FURNISHED TO PURCHASER UNDER A LICENSE FOR USE
   1000					; ON A SINGLE COMPUTER SYSTEM AND CAN BE COPIED (WITH INCLUSION
   1100					; OF DEC'S COPYRIGHT NOTICE) ONLY FOR USE IN SUCH SYSTEM, EXCEPT
   1200					; AS MAY OTHERWISE BE PROVIDED IN WRITING BY DEC.
   1300					;
   1400					; THE INFORMATION IN THIS DOCUMENT IS SUBJECT TO CHANGE WITHOUT
   1500					; NOTICE AND SHOULD NOT BE CONSTRUED AS A COMMITMENT BY DIGITAL
   1600					; EQUIPMENT CORPORATION.
   1700					;
   1800					; PETER H. LIPMAN	24-FEB-76
   1900					;
   2000						.MCALL	NMBLK$,FDOF$L,FCSBT$
   2100	000000					FDOF$L
   2150	000000					FCSBT$
   2200
   2300	000000					DATA$	PRS
   2400
   2500	000000				DFNAM:	NMBLK$
   2600
   2650						.IF	DF,R$$STS
   2700					SOSTMP:	.WORD	0,0,0,0		;NULL DEVICE & DIRECTORY
   2800						.WORD	LSOS0NN,SOS0NN	;NAME OF TEMP FILE
   2900
   3000					SOS0NN:	.ASCII	/SOS0NN.XXX/		;TEMP FILE NAME
   3100					LSOS0NN	=	.-SOS0NN		;ITS LENGTH
   3200						.ENDC
SOSPRS	MACRO M1110  22-AUG-78 05:34  PAGE 3


    100	000036					CODE$	PRS
    200					;
    300					; R0=FDB ADDRESS
    400					; R2=ADDRESS OF 6 WORD STRING DESCRIPTOR
    500					; PARSE THE FILE NAME
    600					; OUTPUT: R1, R3 ALTERED, C=0 IF OK, C=1 IF ERROR
    700					;
    800	000000	012703 	000000'		PARSE::	MOV	#DFNAM,R3		;DEFAULT NAME BLOCK
    900	000004	016763 	000000G	000032 		MOV	DFDEV,N.DVNM(R3)
   1000	000012	016763 	000000G	000034 		MOV	DFUNIT,N.UNIT(R3)
   1100					;
   1200					; ENTER HERE WITH R3 = DESIRED DEFAULT NAME BLOCK
   1300					;
   1400	000020	010001 			PARSE1::MOV	R0,R1			;FORM R1 = FNB ADDRESS
   1500	000022	062701 	000102 			ADD	#F.FNB,R1
   1600
   1700						.IF	NDF,R$$STS
   1800	000026	004767 	000000G			JSR	PC,DETACH		;IN CASE TI: IS INVOLVED
   1900
   2000						.IFTF
   2100	000032	004767 	000000G			JSR	PC,.PARSE
   2200
   2300						.IFT
   2400	000036	006046 				ROR	-(SP)			;SAVE C BIT
   2500	000040	004767 	000000G			JSR	PC,ATTACH		;REATTACH
   2600	000044	006126 				ROL	(SP)+			;AND RESTORE C
   2700						.ENDC
   2800
   2900	000046	000207 				RTS	PC
   3000
   3010					;
   3020					; SET UP FILE NAME BLOCK OF SPECIFIED FDB
   3030					;
   3050					; 2(SP) = FILE TYPE IN RAD50
   3060					; 4(SP) = FDB ADDRESS
   3070					;
   3100	000050				ENTRY	SETFIL
   3120
   3140						.IF	DF,R$$STS
   3200						JSR	R1,$SAV3		;SAVE 3 REGS
   3300						MOV	14(SP),R0		;GET FDB ADDRESS
   3500						MOV	#SOSTMP,R2		;FILE NAME BLOCK
   3600						MOV	SOSTNM,SOS0NN+4		;STORE JOB NUMBER
   3700						JSR	PC,PARSE		;PARSE THE FILENAME
   3800						MOV	12(SP),N.FTYP(R1)	;SET DIFFERENT EXTENSION
   3900						RTS	PC			;RETURN
   4000
   4100						.IFF
   4200	000050	010146 				MOV	R1,-(SP)		;SAVE A REGISTER
   4300	000052	016600 	000006 			MOV	6(SP),R0		;FDB ADDRESS
   4400	000056	062700 	000140 			ADD	#F.FNB+S.FNB,R0		;ADDRESS OF LAST + 1 WORD OF FNB
   4500	000062	012701 	000017 			MOV	#S.FNBW,R1		;SIZE OF FILE NAME BLOCK (WORDS)
   4600					;
   4700					; ZERO THE FILE NAME BLOCK PORTION OF THE FDB
   4800					; LEAVE R0 POINTING AT THE FRONT OF THE FNB
   4900					;
   5000	000066	005040 			10$:	CLR	-(R0)			;ZERO EACH WORD
SOSPRS	MACRO M1110  22-AUG-78 05:34  PAGE 3-1


   5100	000070	077102 				SOB	R1,10$			;OF THE FILE NAME BLOCK
   5200	000072	012701 	000000G			MOV	#SOSTNM,R1		;ADDRESS OF DATA TO FILL IN
   5300	000076	012760 	074453 	000006 		MOV	#^RSOS,N.FNAM(R0)	;FILL IN TEMP FILE NAME
   5400	000104	012160 	000010 			MOV	(R1)+,N.FNAM+2(R0)	;FROM SAVED RAD50
   5500	000110	005060 	000012 			CLR	N.FNAM+4(R0)		;TERMINAL NUMBER
   5550	000114	016660 	000004 	000014 		MOV	4(SP),N.FTYP(R0)	;SET SPECIFIED FILE TYPE
   5600	000122	012760 	000100 	000020 		MOV	#NB.DIR,N.STAT(R0)	;SET THIS BIT SO THAT PRTFIL WILL
   5700										;PRINT TEMP FILE DIRECTORIES CORRECTLY
   5800	000130	012160 	000024 			MOV	(R1)+,N.DID(R0)		;SET DEFAULT DIRECTORY ID
   5900	000134	012160 	000026 			MOV	(R1)+,N.DID+2(R0)
   6000	000140	012160 	000030 			MOV	(R1)+,N.DID+4(R0)
   6200	000144	012160 	000032 			MOV	(R1)+,N.DVNM(R0)	;SET DEFAULT DEVICE
   6300	000150	012160 	000034 			MOV	(R1)+,N.UNIT(R0)	;AND UNIT
   6400	000154	012601 				MOV	(SP)+,R1		;RESTORE SAVED REGISTER
   6500	000156	000207 				RTS	PC			;AND RETURN
   6600
   6700						.ENDC
   6800
   6900
   7000		000001 				.END
SOSPRS	MACRO M1110  22-AUG-78 05:34  PAGE 3-2
SYMBOL TABLE

ATTACH= ****** GX	FD.ISP= 002000   	F.BGBC= 000057   	F.OVBS= 000030   	N.FTYP= 000014
CH.AND= 000001   	FD.MNT= 100000   	F.BKDN= 000026   	F.RACC= 000016   	N.FVER= 000016
DETACH= ****** GX	FD.OSP= 004000   	F.BKDS= 000020   	F.RATT= 000001   	N.NEXT= 000022
DFDEV = ****** GX	FD.PLC= 000004   	F.BKEF= 000050   	F.RCNM= 000034   	N.STAT= 000020
DFNAM   000000R     002	FD.PRN= 000004   	F.BKP1= 000051   	F.RCTL= 000017   	N.UNIT= 000034
DFUNIT= ****** GX	FD.PSE= 010000   	F.BKST= 000024   	F.RSIZ= 000002   	PARSE   000000RG    003
FA.APD= 000100   	FD.RAH= 000001   	F.BKVB= 000064   	F.RTYP= 000000   	PARSE1  000020RG    003
FA.CRE= 000010   	FD.RAN= 000002   	F.CHR = 000075   	F.SEQN= 000100   	RONLY$= 000001
FA.DLK= 001000   	FD.REC= 000001   	F.CNTG= 000034   	F.SPDV= 000072   	R$$EIS= 000001
FA.ENB= 100000   	FD.RWM= 000001   	F.DFNB= 000046   	F.SPUN= 000074   	R$$SHR= 000001
FA.EXC= 002000   	FD.SDI= 000020   	F.DSPT= 000044   	F.STBK= 000036   	R.FIX = 000001
FA.EXT= 000004   	FD.SQD= 000040   	F.DVNM= 000134   	F.UNIT= 000136   	R.SEQ = 000003
FA.NSP= 000100   	FD.TTY= 000004   	F.EFBK= 000010   	F.URBD= 000020   	R.VAR = 000002
FA.POS= 010000   	FD.WBH= 000002   	F.EFN = 000050   	F.VBN = 000064   	SETFIL  000050RG    003
FA.RD = 000001   	FF.CHR= 000005   	F.EOBB= 000032   	F.VBSZ= 000060   	SOSTNM= ****** GX
FA.RWD= 004000   	FF.NV = 000003   	F.ERR = 000052   	NB.DEV= 000200   	S.FATT= 000016
FA.SEQ= 040000   	FF.POE= 000002   	F.FACC= 000043   	NB.DIR= 000100   	S.FDB = 000140
FA.SHR= 000040   	FF.RWD= 000001   	F.FFBY= 000014   	NB.NAM= 000004   	S.FNAM= 000006
FA.TMP= 000020   	FF.RWF= 000006   	F.FNAM= 000110   	NB.SD1= 000400   	S.FNB = 000036
FA.WCK= 020000   	FF.SPC= 000004   	F.FNB = 000102   	NB.SD2= 001000   	S.FNBW= 000017
FA.WRT= 000002   	FO.APD= 000106   	F.FTYP= 000116   	NB.SNM= 000040   	S.FNTY= 000004
FD.BLK= 000010   	FO.MFY= 000002   	F.FVER= 000120   	NB.STP= 000020   	S.FTYP= 000002
FD.CCL= 000002   	FO.RD = 000001   	F.HIBK= 000004   	NB.SVR= 000010   	S.NFEN= 000020
FD.COM= 020000   	FO.UPD= 000006   	F.LUN = 000042   	NB.TYP= 000002   	.PARSE= ****** GX
FD.CR = 000002   	FO.WRT= 000016   	F.MBCT= 000054   	NB.VER= 000001   	...GBL= 000000
FD.DIR= 000010   	F.ACTL= 000076   	F.MBC1= 000055   	N.DID = 000024   	...PC1= 000000
FD.FTN= 000001   	F.ALOC= 000040   	F.MBFG= 000056   	N.DVNM= 000032   	...PC2= 000014R     002
FD.F11= 040000   	F.BBFS= 000062   	F.NRBD= 000024   	N.FID = 000000   	...PC3= 000000
FD.INS= 000010   	F.BDB = 000070   	F.NREC= 000030   	N.FNAM= 000006   	...TPC= 000140

. ABS.	000000	   000
      	000000	   001
PRS.D 	000036	   002
CODE  	000160	   003
ERRORS DETECTED:  0

VIRTUAL MEMORY USED:  3177 WORDS  ( 13 PAGES)
DYNAMIC MEMORY:  3828 WORDS  ( 14 PAGES)
ELAPSED TIME:  00:00:08
OBJ$:SOSPRS,LIS$:SOSPRS/-SP/NL:TOC=SRC$:PREFIX,SOSPRS
