SOSSW - SWITCH PROCESSING	MACRO M1110  22-AUG-78 05:35  PAGE 2


    100						.TITLE	SOSSW - SWITCH PROCESSING
    200						.IDENT	/6B0201/
    300					;
    400					; COPYRIGHT 1977, DIGITAL EQUIPMENT CORP., MAYNARD, MASS. 01754
    500					;
    600					; DEC ASSUMES NO RESPONSIBILITY FOR THE USE OR RELIABILITY OF ITS
    700					; SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DEC.
    800					;
    900					; THIS SOFTWARE IS FURNISHED TO PURCHASER UNDER A LICENSE FOR USE
   1000					; ON A SINGLE COMPUTER SYSTEM AND CAN BE COPIED (WITH INCLUSION
   1100					; OF DEC'S COPYRIGHT NOTICE) ONLY FOR USE IN SUCH SYSTEM, EXCEPT
   1200					; AS MAY OTHERWISE BE PROVIDED IN WRITING BY DEC.
   1300					;
   1400					; THE INFORMATION IN THIS DOCUMENT IS SUBJECT TO CHANGE WITHOUT
   1500					; NOTICE AND SHOULD NOT BE CONSTRUED AS A COMMITMENT BY DIGITAL
   1600					; EQUIPMENT CORPORATION.
   1700					;
   1800					; PETER H. LIPMAN	23-FEB-76
   1900					;
   2000						.MCALL	CSI$
   2100	000000					CSI$
   2200						.MCALL	CSI$1,CSI$2,CCML$
SOSSW - SWITCH PROCESSING	MACRO M1110  22-AUG-78 05:35  PAGE 3
SWITCH AND GIVE COMMAND ROUTINES

    100						.SBTTL	SWITCH AND GIVE COMMAND ROUTINES
    200
    300	000000					CODE$	SW
    400
    500	000000				ENTRY	SWITCH
    600	000000	004167 	000000G			JSR	R1,$SAV2		;SAVE R1,,R2
    650	000004	004767 	000000G			JSR	PC,LODSWT		;LOAD THE SWITCH TABLE
    700	000010	016701 	000000G			MOV	TTICTL,R1		;NEXT INPUT LOCATION
    800	000014	016702 	000002G			MOV	TTICTL+2,R2		;LENGTH LEFT IN BUF
    900	000020	112741 	000057 			MOVB	#'/,-(R1)		;FUDGE A / IN BUF
   1000	000024	005067 	000002G			CLR	TTICTL+2		;FORCE READ ON NEXT LISTEN
   1025	000030	005067 	000000G			CLR	GIVWRD			;/HELP AND =HELP ARE EQUIVALENT
   1030	000034	005067 	000000G			CLR	HELPAG			;INIT HELP STARTING PAGE
   1050	000040	005067 	000000G			CLR	OPTNAM			;CLEAR ANY OLD VALUE FOR /OPT:X
   1066	000044	005067 	000000G			CLR	ALTSWT			;NO /ALT OR /MAT SEEN YET
   1082	000050	012767 	037444 	000000G		MOV	#"$?,ALTSTR		;DEFAULT CHARS FOR /ALT AND /MAT
   1100	000056					CSI$1	#CSIBLK,R1,R2		;SCAN COMMAND STRING
   1200	000076	103436 				BCS	SWBAD			;SOMETHING VERY BAD
   1300	000100	132760 	000067 	000001 		BITB	#CS.EQU!CS.MOR!CS.DVF!CS.DIF!CS.NMF,C.STAT(R0)
   1400	000106	001032 				BNE	SWBAD			;ONLY SWITCHES AND VALUES
   1500	000110					CSI$2	#CSIBLK,OUTPUT,#SWTAB	;PROCESS SWITCHES
   1600	000132	103420 				BCS	SWBAD			;INVALID SWITCH FOUND
   1620	000134	016702 	000000G			MOV	GIVWRD,R2		;REALLY A "=" COMMAND?
   1640	000140	001110 				BNE	GCALL			;BRANCH IF YES
   1700	000142	032760 	000000G	000024 		BIT	#NOOPT,C.MKW1(R0)	;/OPTION?
   1800	000150	001406 				BEQ	20$			;BRANCH IF NO
   1850	000152					CCML$	#GCMLB			;CLOSE CMD FILE, FOR BUFFER SPACE
   1900	000162	004767 	000000G			JSR	PC,INITSW		;YES, GO READ SWITCH.INI
   2000
   2200	000166	004767 	000000G		20$:	JSR	PC,SWSET		;FINISH SETTING SWITCHES
   2600	000172	000207 			30$:	RTS	PC			;RETURN ALL OK
   2700
   2800	000174	012746 	000002 		SWBAD:	MOV	#2,-(SP)		;ERROR SEVERITY - CMD ABORT
   2900	000200	012746 	000004 			MOV	#4,-(SP)		;CODE FOR BAD SWITCH NAME
   3000	000204	004767 	000000G			JSR	PC,SOSERR
SOSSW - SWITCH PROCESSING	MACRO M1110  22-AUG-78 05:35  PAGE 4
SWITCH AND GIVE COMMAND ROUTINES

    100	000210				ENTRY	GIVE
    200	000210	004167 	000000G			JSR	R1,$SAV3		;SAVE SOME REGS
    250	000214	004767 	000000G			JSR	PC,LODSWT		;LOAD THE SWITCH TABLE
    300	000220	016701 	000000G			MOV	TTICTL,R1		;POINTER TO INPUT TEXT
    400	000224	016702 	000002G			MOV	TTICTL+2,R2		;LENGTH OF INPUT
    500	000230	112741 	000057 			MOVB	#'/,-(R1)		;FUDGE A /
    600	000234	005067 	000002G			CLR	TTICTL+2		;NEXT LISTEN IS READ
    700	000240	016703 	000000G			MOV	SOSFLG,R3		;SAVE CURRENT FLAG
    800	000244					CSI$1	#CSIBLK,R1,R2		;SCAN IT FIRST
    900	000264	103743 				BCS	SWBAD
   1000	000266	005067 	000024G			CLR	CSIBLK+C.MKW1		;CLEAR SWITCH WORDS
   1100	000272	005067 	000000G			CLR	SOSFLG
   1200	000276	005067 	000000G			CLR	GIVWRD
   1300	000302	005067 	000000G			CLR	GIVW2
   1350	000306	005067 	000000G			CLR	ALTSWT			;NO /ALT OR /MAT SEEN YET
   1400	000312					CSI$2	#CSIBLK,OUTPUT,#GIVTBL	;PROCESS AS SWITCHES
   1500	000334	016767 	000000G	000026G		MOV	SOSFLG,CSIBLK+C.MKW2	;SAVE FLAG CHANGES
   1600	000342	010367 	000000G			MOV	R3,SOSFLG		;RESTORE FLAGS FIRST
   1700	000346	103712 				BCS	SWBAD			;BAD SWITCH
   1800					;	CHECK FOR A ROUTINE TO CALL
   1900	000350	016702 	000000G			MOV	GIVWRD,R2		;SECOND FLAG WORD
   1920	000354	056702 	000000G			BIS	ALTSWT,R2		;/ALT IS 1, /MAT IS 2
   1940										;OTHERS START AT 3,
   1960										;ONLY ONE CAN BE REQUESTED
   2000	000360	001410 				BEQ	GVALUE			;WAS NOT ONE OF THEM
   2100	000362	006302 			GCALL:	ASL	R2
   2200	000364	020227 	000024 			CMP	R2,#GIVT2L		;WITHIN RANGE
   2300	000370	003301 				BGT	SWBAD			;NO
   2400	000372	016202 	000706'			MOV	GIVT2-2(R2),R2		;ADDRESS OF ROUTINE
   2500	000376	004712 				JSR	PC,(R2)
   2600	000400	000207 				RTS	PC			;DONE
   2650					;
   2700					;	CHECK FOR VALUE TO DISPLAY
   2750					;
   2800	000402	016702 	000000G		GVALUE:	MOV	GIVW2,R2		;FIRST FLAG WORD
   2900	000406	001422 				BEQ	20$			;NOT ONE OF THEM
   3000	000410	020227 	000000G			CMP	R2,#SOSFLL		;WITHIN RANGE?
   3100	000414	003267 				BGT	SWBAD			;NO
   3200	000416	012746 	000610'			MOV	#GIVM1,-(SP)		;START OF MSG
   3300	000422	004767 	000000G			JSR	PC,PRINT
   3400	000426	006302 				ASL	R2			;INDEX SOSFLG VALUES
   3500	000430	016216 	000000G			MOV	SOSFLG(R2),(SP)		;GET VALUE
   3600	000434	012746 	000001 			MOV	#1,-(SP)		;AT LEAST ONE DIGIT
   3700	000440	004767 	000000G			JSR	PC,PRINTN		;TELL VALUE
   3800	000444	004767 	000000G			JSR	PC,TYPECR		;THEN RETURN LINE
   4000	000450	022626 				CMP	(SP)+,(SP)+
   4100	000452	000207 				RTS	PC
   4150					;
   4200					;	CHECK SOSFLG BIT VALUE
   4250					;
   4300	000454	005103 			20$:	COM	R3			;THIS
   4400	000456	040367 	000024G			BIC	R3,CSIBLK+C.MKW1	;  SHOULD
   4500	000462	026767 	000024G	000026G		CMP	CSIBLK+C.MKW1,CSIBLK+C.MKW2; TEST
   4600	000470	001403 				BEQ	25$			;      SWITCH
   4700	000472	012746 	000654'			MOV	#GIVOFF,-(SP)		;SWITCH IS OFF
   4800	000476	000413 				BR	PRTRET
   4900	000500	012746 	000674'		25$:	MOV	#GIVON,-(SP)		;SWITCH IS ON
SOSSW - SWITCH PROCESSING	MACRO M1110  22-AUG-78 05:35  PAGE 4-1
SWITCH AND GIVE COMMAND ROUTINES

   5000	000504	000410 				BR	PRTRET
   5400
   5450						.ENABL	LSB
   5500	000506	116746 	000000G		GIVALT:	MOVB	ALTCHR,-(SP)		;GET ALTMODE CHARACTER IF ANY
   5600	000512	000402 				BR	10$
   5700	000514	116746 	000000G		GIVMAT:	MOVB	MATCHR,-(SP)		;GET MATCH CHARACTER IF ANY
   5800	000520	001005 			10$:	BNE	30$			;BRANCH IF CHARACTER ENABLED
   5900	000522	012716 	000624'			MOV	#GIVM2,(SP)		;SAY NOT ENABLED
   6000	000526	004767 	000000G		PRTRET:	JSR	PC,PRINTC		;PRINT MSG ON TOP OF STACK
   6100	000532	000416 				BR	50$
   6300	000534	012746 	000610'		30$:	MOV	#GIVM1,-(SP)		;"VALUE IS: "
   6400	000540	004767 	000000G			JSR	PC,PRINT
   6500	000544	005726 				TST	(SP)+
   6600	000546	004767 	000000G			JSR	PC,TYPE			;TYPE THE CHARACTER
   6620	000552	000404 				BR	40$
   6640
   6660	000554	012746 	000000G		GIVID::	MOV	#MSGIN,-(SP)		;TYPE THE SOS IDENT MESSAGE
   6670	000560	004767 	000000G			JSR	PC,PRINT
   6680
   6690						.IF	DF,R$$STS
   6700						MOV	#FIRQB+FQFUN,R0		;THEN SYSTEM NAME
   6710						MOVB	#ERRFQ,(R0)+
   6720						CLRB	(R0)+
   6730						CALFIP
   6740						MOV	#FIRQB+FQERNO,(SP)	;SYSTEM NAME MESSAGE
   6750						JSR	PC,PRINTZ
   6760						.ENDC
   6770
   6780	000564	004767 	000000G		40$:	JSR	PC,TYPECR		;RETURN THE CARRIAGE
   6950	000570	005726 			50$:	TST	(SP)+
   6960	000572	000207 				RTS	PC
   6970
   6990	000574	016746 	000000G		GIVHLP:	MOV	HELPAG,-(SP)		;STARTING PAGE NUMBER
   7000	000600	004767 	000000G			JSR	PC,CMDHDO		;OPEN AND TYPE THE HELP FILE
   7010	000604	000771 				BR	50$			;CLEAN UP AND EXIT
   7020
   7080						.DSABL	LSB
   7090
   7100	000606	000005 				.WORD	GIVM1L+1/2
   7200	000610	   126 	   101 	   114 	GIVM1:	.ASCII	/VALUE IS: /
	000613	   125 	   105 	   040
	000616	   111 	   123 	   072
	000621	   040
   7300		000012 			GIVM1L	=	.-GIVM1
   7400						.EVEN
   7410	000622	000013 				.WORD	GIVM2L+1/2
   7420	000624	   103 	   110 	   101 	GIVM2:	.ASCII	/CHARACTER IS DISABLED/
	000627	   122 	   101 	   103
	000632	   124 	   105 	   122
	000635	   040 	   111 	   123
	000640	   040 	   104 	   111
	000643	   123 	   101 	   102
	000646	   114 	   105 	   104
   7430		000025 			GIVM2L	=	.-GIVM2
   7440						.EVEN
   7500
   7600	000652	000007 				.WORD	GIVOFL+1/2
SOSSW - SWITCH PROCESSING	MACRO M1110  22-AUG-78 05:35  PAGE 4-2
SWITCH AND GIVE COMMAND ROUTINES

   7700	000654	   123 	   127 	   111 	GIVOFF:	.ASCII	/SWITCH IS OFF/
	000657	   124 	   103 	   110
	000662	   040 	   111 	   123
	000665	   040 	   117 	   106
	000670	   106
   7800		000015 			GIVOFL	=	.-GIVOFF
   7900						.EVEN
   8000
   8100	000672	000006 				.WORD	GIVONL+1/2
   8200	000674	   123 	   127 	   111 	GIVON:	.ASCII	/SWITCH IS ON/
	000677	   124 	   103 	   110
	000702	   040 	   111 	   123
	000705	   040 	   117 	   116
   8300		000014 			GIVONL	=	.-GIVON
   8400						.EVEN
   8500
   8600	000710					GLOBAL	<GIVDOT,GERROR,GIVLOC,GIVSTR,GIVBIG,GIVNAM>
   8700
   8710					; SPECIAL COMMAND DISPATCH TABLE
   8720	000710	000506'			GIVT2:	.WORD	GIVALT
   8740	000712	000514'				.WORD	GIVMAT
   8800	000714	000000G				.WORD	GIVDOT
   8900	000716	000000G				.WORD	GERROR
   9000	000720	000000G				.WORD	GIVLOC
   9100	000722	000000G				.WORD	GIVSTR
   9200	000724	000000G				.WORD	GIVBIG
   9300	000726	000000G				.WORD	GIVNAM
   9400	000730	000554'				.WORD	GIVID
   9410	000732	000574'				.WORD	GIVHLP
   9420
   9430						.IF	DF,R$$DBG
   9500						.WORD	GIVEVT			;***** GIVE EVENT BUFFER (DEBUG)
   9520						.ENDC
   9540
   9600		000024 			GIVT2L	=	.-GIVT2		;LENGTH OF TABLE
   9700
   9800
   9900		000001 				.END
SOSSW - SWITCH PROCESSING	MACRO M1110  22-AUG-78 05:35  PAGE 4-3
SYMBOL TABLE

ALTCHR= ****** GX	C.FILD= 000016   	GIVLOC= ****** G 	GIVW2 = ****** GX	R$$SHR= 000001
ALTSTR= ****** GX	C.MKW1= 000024   	GIVMAT  000514R     002	GVALUE  000402R     002	SOSERR= ****** GX
ALTSWT= ****** GX	C.MKW2= 000026   	GIVM1   000610R     002	HELPAG= ****** GX	SOSFLG= ****** GX
CMDHDO= ****** GX	C.SIZE= 000054   	GIVM1L= 000012   	INITSW= ****** GX	SOSFLL= ****** GX
CSIBLK= ****** GX	C.STAT= 000001   	GIVM2   000624R     002	LODSWT= ****** GX	SWBAD   000174R     002
CS.DIF= 000002   	C.SWAD= 000022   	GIVM2L= 000025   	MATCHR= ****** GX	SWITCH  000000RG    002
CS.DVF= 000004   	C.TYPR= 000000   	GIVNAM= ****** G 	MSGIN = ****** GX	SWSET = ****** GX
CS.EQU= 000040   	GCALL   000362R     002	GIVOFF  000654R     002	NOOPT = ****** GX	SWTAB = ****** GX
CS.INP= 000001   	GCMLB = ****** GX	GIVOFL= 000015   	OPTNAM= ****** GX	TTICTL= ****** GX
CS.MOR= 000020   	GERROR= ****** G 	GIVON   000674R     002	PAR$$$= 000027   	TYPE  = ****** GX
CS.NMF= 000001   	GIVALT  000506R     002	GIVONL= 000014   	PRINT = ****** GX	TYPECR= ****** GX
CS.OUT= 000002   	GIVBIG= ****** G 	GIVSTR= ****** G 	PRINTC= ****** GX	$SAV2 = ****** GX
CS.WLD= 000010   	GIVDOT= ****** G 	GIVTBL= ****** GX	PRINTN= ****** GX	$SAV3 = ****** GX
C.CMLD= 000002   	GIVE    000210RG    002	GIVT2   000710R     002	PRTRET  000526R     002	.CSI1 = ****** G
C.DEVD= 000006   	GIVHLP  000574R     002	GIVT2L= 000024   	RONLY$= 000001   	.CSI2 = ****** G
C.DIRD= 000012   	GIVID   000554RG    002	GIVWRD= ****** GX	R$$EIS= 000001   	.GCML3= ****** G
C.DSDS= 000006

. ABS.	000000	   000
      	000000	   001
CODE  	000734	   002
ERRORS DETECTED:  0

VIRTUAL MEMORY USED:  1606 WORDS  ( 7 PAGES)
DYNAMIC MEMORY:  2772 WORDS  ( 10 PAGES)
ELAPSED TIME:  00:00:07
OBJ$:SOSSW,LIS$:SOSSW/-SP/NL:TOC=SRC$:PREFIX,SOSSW
