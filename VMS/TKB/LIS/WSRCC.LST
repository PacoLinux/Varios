WSRCC	MACRO M1110  22-AUG-78 02:02  PAGE 2


      1						.TITLE	WSRCC
      2						.IDENT	/00/
      3
      4					; VERSION 00
      5					;
      6					; C. MONIA 27-SEP-75
      7					;
      8					; LOCAL DATA
      9					;
     10					; CURRENT PATH LIST ADDRESS
     11					;
     12
     13	000000				PATH:	.BLKW	1		;
     14
     15					;
     16					; SYMBOL DESCRIPTOR ADDRESS
     17					;
     18
     19	000002				SYMDIS:	.BLKW	1		;
     20
     21					;+
     22					; **-$WSRCC-PERFORM WHOLE SEARCH FOR SECTION NAME
     23					;
     24					; THIS ROUTINE IS CALLED TO SEARCH FOR A .PSECT THAT IS
     25					; DEFINED  ON A PATH INTERSECTING THE CURRENT SEGMENT.
     26					;  PRIOR TO CALLING THIS ROUTINE $WSINI MUST BE
     27					; INVOKED TO BUILD THE PATH LIST CONTAINING THE VIRTUAL
     28					; ADDRESSES OF ALL SUCH SEGMENTS. THE SEARCH IS ORDERED
     29					; IN SEQUENCE ACCORDING TO ENTRIES IN THIS LIST. THIS
     30					; ORDERING RESULTS IN THE FOLLOWING SEARCH PATTERN:
     31					;
     32					;	THE CURRENT SEGMENT
     33					;	ALL SEGMENTS TOWARDS THE ROOT
     34					;	ALL SEGMENTS UP-TREE FROM THE CURRENT SEGMENT
     35					;	ALL CO-TREES
     36					;
     37					; EACH TIME THE SECTION NAME IS FOUND, A CO-ROUTINE CALL
     38					; IS MADE TO THE CALLER WITH C/CLEAR AND A VALUE IN R1
     39					; THAT DESCRIBES WHERE THE SECTION NAME WAS FOUND. WHEN
     40					; ALL PATHS HAVE BEEN SEARCHED, THIS ROUTINE EXITS VIA
     41					; A RETURN WITH C/SET.
     42					;
     43					; INPUTS:
     44					;
     45					;	R1=ADDRESS OF SYMBOL DESCRIPTOR
     46					;	$PATH=ADDRESS OF PATH LIST CONSTRUCTED BY $WSINI
     47					;
     48					; OUTPUTS:
     49					;
     50					;	C/CLEAR -- FOUND SECTION, EXIT IS VIA CO-ROUTINE CALL
     51					;
     52					;		R0=REAL ADDRESS OF DESCRIPTOR
     53					;		R1=PATH FLAG SET AS FOLLOWS:
     54					;
     55					;			R1=0; FOUND IN CURRENT SEGMENT
     56					;			R1<0; FOUND TOWARDS THE ROOT
     57					;			R1=1; FOUND UP-TREE
WSRCC	MACRO M1110  22-AUG-78 02:02  PAGE 2-1


     58					;			R1=2; FOUND IN CO-TREE
     59					;
     60					;	CONDITION CODES REFLECT THE CONTENTS OF R1
     61					;
     62					;		$CRVSM=VIRTUAL ADDRESS OF FOUND SECTION
     63					;		$CRVSR=VIRTUAL ADDRESS OF FOUND SEGMENT
     64					;
     65					;	C/SET -- ALL SEGMENTS SEARCHED, EXIT IS VIA RETURN
     66					;		 WITH R1 CLEARED.
     67					;
     68					;	CONDITION CODES REFLECT THE CONTENTS OF R1
     69					;
     70					;-
     71
     72	000004				$WSRCC::			;
     73	000004	016767 	000000G	177766 		MOV	$PATH,PATH	; SET CURRENT PATH LIST ADDRESS
     74	000012	010167 	177764 			MOV	R1,SYMDIS	; SAVE DESCRIPTOR ADDRESS
     75	000016				10$:				;
     76	000016	016702 	177756 			MOV	PATH,R2		; GET CURRENT PATH LIST ADDRESS
     77	000022	012201 				MOV	(R2)+,R1	; GET VIRTUAL ADDRESS OF SEGMENT
     78	000024	001433 				BEQ	20$		; IF EQ SEARCHED ALL SEGMENTS
     79	000026	012246 				MOV	(R2)+,-(SP)	; PUSH PATH FLAG
     80	000030	010267 	177744 			MOV	R2,PATH		; SAVE PATH LIST ADDRESS
     81	000034					CALL	$CVLOK		; CONVERT TO REAL, LOCK IN MEMORY
     82	000040	010167 	000000G			MOV	R1,$CRVSR	; SAVE CURRENT SEARCH SEGMENT
     83	000044	016701 	177732 			MOV	SYMDIS,R1	; GET ADDRESS OF DESCRIPTOR
     84	000050	062700 	000000G			ADD	#S$GCST,R0	; OFFSET TO SECTION TABLE LISTHEAD
     85	000054					CALL	$SRCH		; SEARCH FOR SYMBOL
     86	000060	006146 				ROL	-(SP)		; SAVE C/BIT
     87	000062	010046 				MOV	R0,-(SP)	; SAVE REAL ADDRESS OF SECTION
     88	000064	010167 	000000G			MOV	R1,$CRVSM	; SAVE VIRTUAL ADDRES OF SECTION
     89	000070	016701 	000000G			MOV	$CRVSR,R1	; GET VIRTUAL ADDRESS OF SEARCH SEGMENT
     90	000074					CALL	$UNLPG		; UNLOCK PAGE
     91	000100	012600 				MOV	(SP)+,R0	; RESTORE R0
     92	000102	006026 				ROR	(SP)+		; RESTORE C/BIT
     93	000104	012601 				MOV	(SP)+,R1	; RESTORE PATH FLAG
     94	000106	103743 				BCS	10$		; IF C/S SYMBOL NOT FOUND
     95	000110					CALL	@(SP)+		; CALL THE CALLER
     96	000112	000741 				BR	10$		; GO AGAIN
     97	000114				20$:				;
     98	000114	000261 				SEC			; TERMINATE SEARCH
     99	000116					RETURN			;
    100
    101		000001 				.END
WSRCC	MACRO M1110  22-AUG-78 02:02  PAGE 2-2
SYMBOL TABLE

CR    = 000015   	PATH    000000R  	S$GCST= ****** GX	$CVLOK= ****** GX	$UNLPG= ****** GX
FF    = 000014   	R$$11M= 000000   	VT    = 000013   	$PATH = ****** GX	$WSRCC  000004RG
HT    = 000011   	SPA   = 000040   	$CRVSM= ****** GX	$SRCH = ****** GX	$$    = 000001
LF    = 000012   	SYMDIS  000002R  	$CRVSR= ****** GX

. ABS.	000000	   000
      	000120	   001
ERRORS DETECTED:  0

VIRTUAL MEMORY USED:  600 WORDS  ( 3 PAGES)
DYNAMIC MEMORY:  2772 WORDS  ( 10 PAGES)
ELAPSED TIME:  00:00:06
OBJ$:WSRCC,LIS$:WSRCC/-SP=SRC$:MACFLM,WSRCC
