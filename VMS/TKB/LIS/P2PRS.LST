P2PRS                          	MACRO M1110  22-AUG-78 01:52  PAGE 2


      1						.TITLE	P2PRS                                                           ;**NEW**
      2						.IDENT	/01/                                                           ;**NEW**
      3					                                                                                ;**NEW**
      4					;                                                                               ;**NEW**
      5					; COPYRIGHT   1973,  DIGITAL  EQUIPMENT  CORP.,  MAYNARD,   MASS.               ;**NEW**
      6					;                                                                               ;**NEW**
      7					; THIS SOFTWARE IS FURNISHED TO PURCHASER UNDER A LICENSE FOR USE               ;**NEW**
      8					; ON A  SINGLE COMPUTER SYSTEM AND CAN BE COPIED (WITH INCLUSION                ;**NEW**
      9					; OF DEC'S COPYRIGHT NOTICE) ONLY FOR USE IN SUCH SYSTEM, EXCEPT                ;**NEW**
     10					; AS MAY OTHERWISE BE PROVIDED IN WRITING BY DEC.                               ;**NEW**
     11					;                                                                               ;**NEW**
     12					; THE  INFORMATION IN THIS DOCUMENT IS SUBJECT TO CHANGE WITHOUT                ;**NEW**
     13					; NOTICE AND  SHOULD NOT BE CONSTRUED AS A COMMITMENT BY DIGITAL                ;**NEW**
     14					; EQUIPMENT CORPORATION.                                                        ;**NEW**
     15					;                                                                               ;**NEW**
     16					; DEC  ASSUMES NO  RESPONSIBILITY  FOR  THE  USE  OR RELIABILITY                ;**NEW**
     17					; OF ITS  SOFTWARE ON  EQUIPMENT WHICH  IS NOT SUPPLIED BY DEC.                 ;**NEW**
     18					;                                                                               ;**NEW**
     19					; VERSION 01                                                                   ;**NEW**
     20					;                                                                               ;**NEW**
     21					; D.N. CUTLER/C. MONIA 27-DEC-73                                                ;**NEW**
     22					;                                                                               ;**NEW**
     23					; PARSE PHASE TWO OPTION INPUTS                                                 ;**NEW**
     24					;                                                                               ;**NEW**
     25					;+                                                                              ;**NEW**
     26					; **-$P2PRS-PARSE OPTION INPUTS                                                 ;**NEW**
     27					;                                                                               ;**NEW**
     28					; INPUTS:                                                                       ;**NEW**
     29					;                                                                               ;**NEW**
     30					;	R0:	ADDRESS OF NEXT BYTE TO PROCESS                                 ;**NEW**
     31					;	R2:	LAST BYTE PROCESSED **                                          ;**NEW**
     32					;	R4:	ADDRESS OF LAST OPTION BLOCK PROCESSED                          ;**NEW**
     33					;                                                                               ;**NEW**
     34					; OUTPUTS:                                                                      ;**NEW**
     35					;                                                                               ;**NEW**
     36					;	C-CLEAR: OPTION INPUT FOUND AND SATISFACTORILY PARSED                   ;**NEW**
     37					;	R0:	 ADDRESS OF NEXT BYTE AFTER OPTION TERMINATOR                   ;**NEW**
     38					;	R2:	 BYTE TERMINATING OPTION SPECIFICATION                          ;**NEW**
     39					;	R4:	 ADDRESS OF CORRESPONDING OPTION BLOCK                          ;**NEW**
     40					;	R5:	 ADDRESS OF PARAMETER STORAGE                                   ;**NEW**
     41					;                                                                               ;**NEW**
     42					;	C-SET:   END OF LINE OR SYNTAX ERROR DETECTED                           ;**NEW**
     43					;                                                                               ;**NEW**
     44					; ** R2 IS LOADED WITH THE CHARACTER "!" WHEN PROCESSING                        ;**NEW**
     45					;    A NEW LINE OF KEYWORD INPUT.                                               ;**NEW**
     46					;-                                                                              ;**NEW**
     47					;                                                                               ;**NEW**
     48					                                                                                ;**NEW**
     49	000000				$P2PRS::			;                                               ;**NEW**
     50	000000	005702 				TST	R2		; END OF LINE?                                  ;**NEW**
     51	000002	001547 				BEQ	120$		; IF EQ YES                                     ;**NEW**
     52	000004	122702 	000073 			CMPB	#';,R2		; COMMENT TERMINATOR?                           ;**NEW**
     53	000010	001544 				BEQ	120$		; IF EQ YES                                     ;**NEW**
     54	000012	122702 	000041 			CMPB	#'!,R2		; KEYWORD DELIMITER?                            ;**NEW**
     55	000016	001036 				BNE	40$		; IF NE NO                                      ;**NEW**
     56	000020				10$:				;                                               ;**NEW**
     57	000020					CALL	$SETNB		; BYPASS LEADING BLANKS AND HT'S                ;**NEW**
P2PRS                          	MACRO M1110  22-AUG-78 01:52  PAGE 2-1


     58	000024	122710 	000073 			CMPB	#';,(R0)	;COMMENT DELIMITER?                             ;**-269
     59	000030	001534 				BEQ	120$		; IF EQ YES                                     ;**NEW**
     60	000032	012705 	000000G			MOV	#$PARM,R5	; GET ADDRESS OF PARAMETER STORAGE              ;**NEW**
     61	000036					CALL	$RP		;CONVERT KEYWORD                                ;**-2
     62	000042	122702 	000075 			CMPB	#'=,R2		;TERMINATED PROPERLY?
     63	000046	001067 				BNE	60$		;IF NE SYNTAX ERROR
     64	000050	024545 				CMP	-(R5),-(R5)	;POINT TO KEYWORD
     65	000052	012704 	000000G			MOV	#$KWRD,R4	; GET ADDRESS OF OPTION CONTROL BLOCKS          ;**NEW**
     66	000056				30$:				;                                               ;**NEW**
     67	000056	021564 	000000G			CMP	(R5),K$EY(R4)	; KEYWORD MATCH                                 ;**NEW**
     68	000062	001004 				BNE	35$		;IF NE NO                                       ;**-2
     69	000064	026564 	000002 	000002G		CMP	2(R5),K$EY+2(R4) ; KEY MATCH?                                   ;**NEW**
     70	000072	001410 				BEQ	40$		;IF EQ YES                                      ;**-1
     71	000074				35$:				;                                               ;**NEW**
     72	000074	062704 	000000G			ADD	#L$NG,R4	; INREMENT TO NEXT BLOCK                        ;**NEW**
     73	000100	020427 	000000G			CMP	R4,#$KWRDE	; ANY MORE CONTROL BLOCKS                       ;**NEW**
     74	000104	103764 				BLO	30$		;IF LO YES                                      ;**-2
     75	000106	012701 				MOV	(PC)+,R1	;GET ERROR/SEVERITY
     76	000110	   000G	   000G			.BYTE	E$R29,S$V1	;
     77	000112	000470 				BR	100$		;
     78	000114				40$:				;                                               ;**NEW**
     79	000114	005067 	000000G			CLR	$NUMP		; CLEAR NUMBER OF PARAMETERS                    ;**NEW**
     80	000120	005002 				CLR	R2		;ASSUME NO MORE PARAMETERS                      ;**-1
     81	000122	105710 				TSTB	(R0)		;ANY MORE PARAMETERS?
     82	000124	001455 				BEQ	90$		;IF EQ NO
     83	000126	122710 	000073 			CMPB	#';,(R0)	;COMMENT DELIMITER?
     84	000132	001452 				BEQ	90$		;IF EQ YES
     85	000134	016403 	000000G			MOV	A$RG(R4),R3	; GET ADDRESS OF ARGUMENT BLOCK                 ;**NEW**
     86	000140	042703 	000001 			BIC	#1,R3		;CLEAR LOW BIT                                  ;**-1
     87	000144	012705 	000000G			MOV	#$PARM,R5	; GET ADDRESS OF PARAMETER STORAGE              ;**NEW**
     88	000150				50$:				;                                               ;**NEW**
     89	000150	005267 	000000G			INC	$NUMP		; INCREMENT NUMBER OF PARAMETERS                ;**NEW**
     90	000154	126764 	000000G	000000G		CMPB	$NUMP,M$AX(R4)	; TOO MANY PARAMETERS?                          ;**NEW**
     91	000162	003024 				BGT	70$		;IF GT YES                                      ;**-3
     92	000164					CALL	$SETNB		;BYPASS LEADING BLANKS AND HT'S
     93	000170					CALL	@(R3)+		;CONVERT PARAMETER
     94	000172	122702 	000054 			CMPB	#',,R2		;COMMA TERMINATOR?
     95	000176	001421 				BEQ	80$		;IF EQ YES
     96	000200	122702 	000041 			CMPB	#'!,R2		;KEYWORD DELIMITER?
     97	000204	001425 				BEQ	90$		;IF EQ YES
     98	000206	005702 				TST	R2		;ZERO BYTE?
     99	000210	001423 				BEQ	90$		;IF EQ YES
    100	000212	122702 	000073 			CMPB	#';,R2		;COMMENT DELIMITER?
    101	000216	001420 				BEQ	90$		;IF EQ YES
    102	000220	122702 	000072 			CMPB	#':,R2		;COLON TERMINATOR?
    103	000224	001751 				BEQ	50$		;IF EQ YES
    104	000226	012701 			60$:	MOV	(PC)+,R1	;GET ERROR/SEVERITY
    105	000230	   000G	   000G			.BYTE	E$R30,S$V1	;
    106	000232	000420 				BR	100$		;
    107	000234	012701 			70$:	MOV	(PC)+,R1	;GET ERROR/SEVERITY
    108	000236	   000G	   000G			.BYTE	E$R31,S$V1	;
    109	000240	000415 				BR	100$		;
    110	000242				80$:				;                                               ;**NEW**
    111	000242	032764 	000001 	000000G		BIT	#1,A$RG(R4)	; MULTI-SETS ALLOWED?                           ;**NEW**
    112	000250	001003 				BNE	90$		;IF NE YES                                      ;**-1
    113	000252	012701 				MOV	(PC)+,R1	;GET ERROR/SEVERITY
    114	000254	   000G	   000G			.BYTE	E$R32,S$V1	;
P2PRS                          	MACRO M1110  22-AUG-78 01:52  PAGE 2-2


    115	000256	000406 				BR	100$		;
    116	000260				90$:				;                                               ;**NEW**
    117	000260	126764 	000000G	000000G		CMPB	$NUMP,M$IN(R4)	; ENOUGH PARAMETERS                             ;**NEW**
    118	000266	002007 				BGE	110$		;IF GE YES                                      ;**-1
    119	000270	012701 				MOV	(PC)+,R1	;GET ERROR/SEVERITY
    120	000272	   000G	   000G			.BYTE	E$R33,S$V1	;
    121	000274	012702 	000000G		100$:	MOV	#$LNDES,R2	;GET ADDRESS OF LINE DESCRIPTOR
    122	000300					CALL	$ERMSG		;OUTPUT ERROR MESSAGE
    123	000304	000406 				BR	120$		; TERMINATE SCAN                                ;**NEW**
    124	000306				110$:				;                                               ;**NEW**
    125	000306	012705 	000000G			MOV	#$PARM,R5	; GET ADDRESS OF PARAMETER STORAGE              ;**NEW**
    126	000312	016703 	000000G			MOV	$NUMP,R3	; GET NUMBER OF PARAMETERS                      ;**NEW**
    127	000316	000241 				CLC			; SET SUCCESS                                   ;**NEW**
    128	000320	000401 				BR	130$		; EXIT                                          ;**NEW**
    129	000322				120$:				;                                               ;**NEW**
    130	000322	000261 				SEC			; SET ERROR FLAG                                ;**NEW**
    131	000324				130$:				;                                               ;**NEW**
    132	000324					RETURN			;                                               ;**NEW**
    133					                                                                                ;**-714
    134		000001 				.END
P2PRS                          	MACRO M1110  22-AUG-78 01:52  PAGE 2-3
SYMBOL TABLE

A$RG  = ****** GX	E$R33 = ****** GX	M$AX  = ****** GX	$ERMSG= ****** GX	$PARM = ****** GX
CR    = 000015   	FF    = 000014   	M$IN  = ****** GX	$KWRD = ****** GX	$P2PRS  000000RG
E$R29 = ****** GX	HT    = 000011   	R$$11M= 000000   	$KWRDE= ****** GX	$RP   = ****** GX
E$R30 = ****** GX	K$EY  = ****** GX	SPA   = 000040   	$LNDES= ****** GX	$SETNB= ****** GX
E$R31 = ****** GX	LF    = 000012   	S$V1  = ****** GX	$NUMP = ****** GX	$$    = 000001
E$R32 = ****** GX	L$NG  = ****** GX	VT    = 000013

. ABS.	000000	   000
      	000326	   001
ERRORS DETECTED:  0

VIRTUAL MEMORY USED:  720 WORDS  ( 3 PAGES)
DYNAMIC MEMORY:  2772 WORDS  ( 10 PAGES)
ELAPSED TIME:  00:00:07
OBJ$:P2PRS,LIS$:P2PRS/-SP=SRC$:MACFLM,P2PRS
