BLMNT	MACRO M1110  22-AUG-78 01:39  PAGE 2


      1						.TITLE	BLMNT
      2						.IDENT	/00/
      3					;
      4					; COPYRIGHT   1974,  DIGITAL  EQUIPMENT  CORP.,  MAYNARD,   MASS.
      5					;
      6					; THIS SOFTWARE IS FURNISHED TO PURCHASER UNDER A LICENSE FOR USE
      7					; ON A  SINGLE COMPUTER SYSTEM AND CAN BE  COPIED (WITH INCLUSION
      8					; OF DEC'S COPYRIGHT  NOTICE) ONLY FOR USE IN SUCH SYSTEM, EXCEPT
      9					; AS MAY OTHERWISE BE PROVIDED IN WRITING BY DEC.
     10					;
     11					; THE  INFORMATION  IN THIS DOCUMENT IS SUBJECT TO CHANGE WITHOUT
     12					; NOTICE  AND  SHOULD NOT BE CONSTRUED AS A COMMITMENT BY DIGITAL
     13					; EQUIPMENT CORPORATION.
     14					;
     15					; DEC  ASSUMES NO  RESPONSIBILITY  FOR  THE  USE  OR  RELIABILITY
     16					; OF  ITS  SOFTWARE ON  EQUIPMENT WHICH  IS  NOT SUPPLIED BY DEC.
     17					;
     18					; VERSION 00
     19					;
     20					; C. MONIA	29-APR-74
     21					;
     22					; INITIALIZE AND BUILD LIBRARY MODULE NAME LISTS
     23					;
     24					; LOCAL DATA
     25					;
     26
     27
     28	000000				LCLMOD:	.BLKW	17.		; LOCAL STORAGE FOR MODULE NAMES
     29	000042				$LBMOD::.BLKW	1		; VIRTUAL ADDRESS OF NAME TABLE
     30
     31					;+
     32					; **-$CLRMN-INITIALIZE MODULE SWITCH VALUE TABLE
     33					;
     34					; INPUTS:
     35					;
     36					;	NONE
     37					;
     38					; OUTPUTS:
     39					;
     40					;	CSI SWITCH VALUE LIST FOR MODULE NAMES IS INITIALIZED
     41					;
     42					; THIS SUBROUTINE IS CALLED TO SETUP THE MODULE NAME LIST FOR
     43					; SUBSEQUENT SCANNING BY $BLMNT
     44					;-
     45
     46	000044				$CLRMN::			;
     47	000044	012700 	000000G			MOV	#$LBSVT,R0	; GET ADDRESS OF VALUE TABLE
     48	000050	012701 	000010 			MOV	#8.,R1		; GET MAX. NO OF NAMES
     49	000054				10$:				;
     50	000054	105010 				CLRB	(R0)		; CLEAR FIRST BYTE OF ENTRY
     51	000056	062700 	000007 			ADD	#7,R0		; POINT TO START OF NEXT ENTRY
     52	000062					SOB	R1,10$		; REPEAT
     53	000066					RETURN			;
     54
     55					;+
     56					; **-$BLMNT-SCAN CSI SWITCH VALUE LIST FOR MODULE NAMES
     57					;
BLMNT	MACRO M1110  22-AUG-78 01:39  PAGE 2-1


     58					; INPUTS:
     59					;
     60					;	$INIPT RECORD BLOCK
     61					;	$LBSVL CSI SWITCH VALUE LIST
     62					;
     63					; OUTPUTS:
     64					;
     65					;	C-CLEAR
     66					;	$LBMOD=VIRTUAL ADDRESS OF MODULE LIST (0=NONE)
     67					;
     68					;	C-SET
     69					;	NON RADIX-50 NAME SPECIFIED.
     70					;
     71					; THIS ROUTINE IS CALLED TO CONSTRUCT A LIST OF MODULE NAMES FOR A LIBRARY
     72					; FILE. THE LIST CONSISTS OF TWO-WORD RADIX-50 VALUES TERMINATED BY A ZERO.
     73					; LIST STORAGE IS OBTAINED FROM VIRTUAL MEMORY. INPUT IS THE SWITCH VALUE
     74					; TABLE CONTAINING ASCII DATA AS BUILT BY CSI2. IF THE TABLE IS EMPTY NO LIST
     75					; IS CONSTRUCTED.
     76					;-
     77
     78	000070				$BLMNT::			;
     79	000070					SAVRG			; SAVE NON-VILATILE REGISTERS
     80	000074	005067 	177742 			CLR	$LBMOD		; ASSUME TABLE EMPTY (CLEAR C)
     81	000100	016700 	000000G			MOV	$INIPT,R0	; GET INPUT FILE RECORD BLOCK
     82	000104	032760 	000000G	000000G		BIT	#SW$LB,R$SWTH(R0) ; LIBRARY FILE?
     83	000112	001444 				BEQ	40$		; IF EQ NO
     84	000114	012705 	000000'			MOV	#LCLMOD,R5	; GET LOCAL STORAGE ADDRESS
     85	000120	012703 	177771G			MOV	#$LBSVT-7,R3	; GET ADDRESS OF SWITCH VALUE LIST
     86	000124	012746 	000011 			MOV	#9.,-(SP)	; SET LOOP COUNT
     87	000130				10$:				;
     88	000130	062703 	000007 			ADD	#7,R3		; POINT TO NEXT STRING
     89	000134	005316 				DEC	(SP)		; DECREMENT COUNT
     90	000136	003411 				BLE	20$		; IF LE FINISHED SCAN
     91	000140	105713 				TSTB	(R3)		; ANYTHING AT THIS ENTRY?
     92	000142	001772 				BEQ	10$		; IF EQ NO
     93	000144	010300 				MOV	R3,R0		; SET STRING POINTER
     94	000146					CALL	$RR		; CONVERT NAME
     95	000152	005702 				TST	R2		; ANY BAD CHARACTERS?
     96	000154	000261 				SEC			; ASSUME YES
     97	000156	001021 				BNE	35$		; IF NE NO
     98	000160	000763 				BR	10$		; GO AGAIN
     99	000162				20$:				;
    100	000162	005015 				CLR	(R5)		; MARK END OF LIST
    101	000164	012704 	000000'			MOV	#LCLMOD,R4	; GET TABLE ADDRESS
    102	000170	020405 				CMP	R4,R5		; ANY ENTRIES?
    103	000172	001413 				BEQ	35$		; IF EQ NO
    104	000174	012701 	000042 			MOV	#17.*2,R1	; SET TABLE SIZE
    105	000200					CALL	$ALVRT		; ALLOCATE VIRTUAL STORAGE
    106	000204	010167 	177632 			MOV	R1,$LBMOD	; SAVE VIRTUAL ADDRESS
    107	000210	000241 				CLC			; SET SUCCESS
    108	000212				30$:				;
    109	000212	012420 				MOV	(R4)+,(R0)+	; BUILD NAME LIST
    110	000214	001402 				BEQ	35$		; IF EQ DONE WITH LIST
    111	000216	012420 				MOV	(R4)+,(R0)+	; MOVE SECOND HALF OF NAME
    112	000220	000774 				BR	30$		;
    113	000222				35$:				;
    114	000222	005226 				INC	(SP)+		; CLEAN STACK
BLMNT	MACRO M1110  22-AUG-78 01:39  PAGE 2-2


    115	000224				40$:				;
    116	000224					RETURN			;
    117
    118		000001 				.END
BLMNT	MACRO M1110  22-AUG-78 01:39  PAGE 2-3
SYMBOL TABLE

CR    = 000015   	LF    = 000012   	SW$LB = ****** GX	$CLRMN  000044RG 	$RR   = ****** GX
FF    = 000014   	R$SWTH= ****** GX	VT    = 000013   	$INIPT= ****** GX	$SAVRG= ****** GX
HT    = 000011   	R$$11M= 000000   	$ALVRT= ****** GX	$LBMOD  000042RG 	$$    = 000001
LCLMOD  000000R  	SPA   = 000040   	$BLMNT  000070RG 	$LBSVT= ****** GX

. ABS.	000000	   000
      	000226	   001
ERRORS DETECTED:  0

VIRTUAL MEMORY USED:  635 WORDS  ( 3 PAGES)
DYNAMIC MEMORY:  2772 WORDS  ( 10 PAGES)
ELAPSED TIME:  00:00:06
OBJ$:BLMNT,LIS$:BLMNT/-SP=SRC$:MACFLM,BLMNT
